From goyalk at vmware.com  Thu May  1 00:00:17 2014
From: goyalk at vmware.com (Kapil Goyal)
Date: Wed, 30 Apr 2014 16:00:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ backward compatibility policy
In-Reply-To: <935B4F66-3FB4-451F-AE66-E1AA2CA93BF5@rabbitmq.com>
References: <d7547f91.00000e74.000000cb@KAPILPC.vmware.com>
 <935B4F66-3FB4-451F-AE66-E1AA2CA93BF5@rabbitmq.com>
Message-ID: <ebdd5540.00000e74.000000d7@KAPILPC.vmware.com>

Thanks Michael. This helped.

-----Original Message-----
From: rabbitmq-discuss
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael
Klishin
Sent: Wednesday, April 30, 2014 3:42 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ backward compatibility policy

As far as the server features go, I don't think we've had anything that
broke amqp 0-9-1 compatibility in quite a while.

In general, versions roughly follow semantic versioning.

HTH.

MK

> On 01/05/2014, at 00:23, Kapil Goyal <goyalk at vmware.com> wrote:
> 
> Does RabbitMQ have a policy about when it can break backward
compatibility with older clients, for example a major version update? Is
this documented somewhere?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-
bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&
r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=5DPtKKzfbzgBoZIw
zLM7r03pKze0BNrhZGx3oDfF8Jo%3D%0A&s=19779fbfc4bdbde50cd58af2aebef5b21740ee
38e4a0963d45fb7b8674bc84a4

From srinatsr at cisco.com  Thu May  1 00:17:13 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 30 Apr 2014 23:17:13 +0000
Subject: [rabbitmq-discuss] How to resolve this issue?
In-Reply-To: <405CBD98-FB34-48C0-A3A8-F99064296439@rabbitmq.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB041B5@xmb-aln-x10.cisco.com>
 <405CBD98-FB34-48C0-A3A8-F99064296439@rabbitmq.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0421C@xmb-aln-x10.cisco.com>

It is working with rest client.  Then problem is I am passing url as ?http://qot-job-03:15672/api/queues/%2F/validate.monitor/get? and it is coverting to http://qot-job-03:15672/api/queues/%252F/validate.monitor/get

How can I overcome this issue.  I am trying to hit get messages api.

/api/queues/vhost/name/get

Vhost = ?/?

Name = ?validate.monitor?
Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Wednesday, April 30, 2014 3:46 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] How to resolve this issue?

This means the server is not reachable (over TCP). Check if the IP is correct, possible firewall settings, if management plugin is enabled and binds to the IP address and port you expect, etc.

Try connecting via telnet first.

MK

On 01/05/2014, at 02:39, "Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)" <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Apr 30, 2014 3:38:24 PM org.apache.catalina.core.StandardWrapperValve invoke
SEVERE: Servlet.service() for servlet [Q2OServiceEngine Servlet] in context with path [/QOTService-1.0] threw exception [Request processing failed; nested exception is org.springframework.web.client.ResourceAccessException: I/O error on POST request for "http://qot-job-03:15672/api/queues/%252F/validate.monitor/get": The target server failed to respond; nested exception is org.apache.http.NoHttpResponseException: The target server failed to respond] with root cause
org.apache.http.NoHttpResponseException: The target server failed to respond
       at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:95)
       at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:62)
       at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:254)
       at org.apache.http.impl.AbstractHttpClientConnection.receiveResponseHeader(AbstractHttpClientConnection.java:289)
       at org.apache.http.impl.conn.DefaultClientConnection.receiveResponseHeader(DefaultClientConnection.java:252)
       at org.apache.http.impl.conn.ManagedClientConnectionImpl.receiveResponseHeader(ManagedClientConnectionImpl.java:191)
       at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:300)
       at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:127)
       at org.apache.http.impl.client.DefaultRequestDirector.tryExecute(DefaultRequestDirector.java:717)
       at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:522)
       at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)
       at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:805)
       at org.springframework.http.client.HttpComponentsClientHttpRequest.executeInternal(HttpComponentsClientHttpRequest.java:88)
       at org.springframework.http.client.AbstractBufferingClientHttpRequest.executeInternal(AbstractBufferingClientHttpRequest.java:46)
       at org.springframework.http.client.AbstractClientHttpRequest.execute(AbstractClientHttpRequest.java:49)
       at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:509)
       at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:472)
       at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:420)
       at com.cisco.ccrc.service.controller.PushRequestToQueueController.getMessagesFromQueue(PushRequestToQueueController.java:94)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
       at java.lang.reflect.Method.invoke(Method.java:606)
       at org.springframework.web.method.support.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:219)
       at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:132)
       at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:104)
       at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandleMethod(RequestMappingHandlerAdapter.java:745)
       at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:686)
       at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:80)
       at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:925)
       at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:856)
       at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:953)
       at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:855)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)
       at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:829)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:728)
       at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
       at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
       at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)
       at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)
       at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:502)
       at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)
       at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)
       at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)
       at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
       at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)
       at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1023)
       at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)
       at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)
       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
       at java.lang.Thread.run(Thread.java:724)



Regards ??
Srinath

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/5d698b08/attachment.html>

From ngoc.tang at quant-edge.com  Thu May  1 01:44:15 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Wed, 30 Apr 2014 17:44:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <48cb2622-c6a8-4854-8a15-a6d4726fa390@googlegroups.com>

Dear Simon

I have enable the Ldap Plugin, But I can not login with OpenLdap, this is 
the contents of log file
------ --- -- --------      -------------

> Server startup complete; 10 plugins started.
>  * amqp_client
>  * eldap
>  * mochiweb
>  * rabbitmq_auth_backend_ldap
>  * rabbitmq_auth_mechanism_ssl
>  * rabbitmq_federation_management
>  * rabbitmq_management
>  * rabbitmq_management_agent
>  * rabbitmq_web_dispatch
>  * webmachine
> =INFO REPORT==== 30-Apr-2014::09:31:56 === LDAP CHECK: login for 
> test.rabbit
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>         LDAP filling template "${username}" with
>             [{username,<<"test.rabbit">>}]
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>         LDAP template result: " test.rabbit "
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP connecting to servers: ["openldap.com"]
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP network traffic: bind request = {'BindRequest',3,"test.rabbit",
>                                           {simple,<<"Mypassword">>}}
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP network traffic: bind reply = {ok,
>                                         {'LDAPMessage',1,
>                                          {bindResponse,
>                                           
> {'BindResponse',invalidDNSyntax,[],
>                                            "invalid DN",asn1_NOVALUE,
>                                            asn1_NOVALUE}},
>                                          asn1_NOVALUE}}
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP bind error: test.rabbit invalidDNSyntax
> =INFO REPORT==== 30-Apr-2014::09:31:56 === LDAP DECISION: login for 
> test.rabbit: {error,invalidDNSyntax}
> =ERROR REPORT==== 30-Apr-2014::09:31:56 === webmachine error: 
> path="/api/whoami"
> "Unauthorized"

--------- -------------- -------------

And this is the contents of config file

--------------  ------------------

> [
>   {rabbit, [
>      {tcp_listeners, [{"10.x.x.x",5672}]},
>      {ssl_listeners, [{"10.x.x.x",5671}]},
>      {ssl_options, [{cacertfile,"/etc/rabbitmq/ssl/nvca/cacert.pem"},
>                     {certfile,"/etc/rabbitmq/ssl/server/cert.pem"},
>                     {keyfile,"/etc/rabbitmq/ssl/server/key.pem"},
>                     {verify,verify_none},
>                     {fail_if_no_peer_cert,false}]},
>      {heartbeat, 15},
>      {vm_memory_high_watermark_paging_ratio, 0.75},
>      {vm_memory_high_watermark, 0.4},
>      {auth_backends, [{rabbit_auth_backend_ldap, 
> rabbit_auth_backend_internal},
>                           rabbit_auth_backend_internal]},
>      {disk_free_limit, 40000000000}
>   ]},
>   {rabbitmq_auth_backend_ldap,
>    [ {servers,               ["openldap.com"]},
>      {dn_lookup_attribute,   {"uid=${username}}},
>      {dn_lookup_base,        {"dc=openldap,dc=com"}},
>      {other_bind,           
>  ["cn=manager,cn=internal,dc=openldap,dc=com"," Ad09DSJwidjdwf89D"]},
>      {use_ssl,               false},
>      {port,                  389},
>      {log,                   network},
>    {vhost_access_query,    {exists, "cn=${username},ou=allusers, 
> dc=openldap,dc=com"}},
>      {resource_access_query,
>      {for, [{resource, exchange, {for, [{permission, configure,
>                                      {in_group, "cn=${username}, 
> dc=openldap,dc=com "}
>                                     },
>                                     {permission, write, {constant, true}},
>                                     {permission, read,  {constant, true}}
>                                    ]}},
>         {resource, queue,    {constant, true}}]}},
>      {tag_queries,           [{administrator, {constant, true}},
>                               {management,    {constant, true}}]}
>    ]
>   }
> ].

-------------------- ------------

Help me, please.
Thanks so much 
Ngoc Tang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/76581d49/attachment.html>

From ngoc.tang at quant-edge.com  Thu May  1 01:44:15 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Wed, 30 Apr 2014 17:44:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <48cb2622-c6a8-4854-8a15-a6d4726fa390@googlegroups.com>

Dear Simon

I have enable the Ldap Plugin, But I can not login with OpenLdap, this is 
the contents of log file
------ --- -- --------      -------------

> Server startup complete; 10 plugins started.
>  * amqp_client
>  * eldap
>  * mochiweb
>  * rabbitmq_auth_backend_ldap
>  * rabbitmq_auth_mechanism_ssl
>  * rabbitmq_federation_management
>  * rabbitmq_management
>  * rabbitmq_management_agent
>  * rabbitmq_web_dispatch
>  * webmachine
> =INFO REPORT==== 30-Apr-2014::09:31:56 === LDAP CHECK: login for 
> test.rabbit
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>         LDAP filling template "${username}" with
>             [{username,<<"test.rabbit">>}]
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>         LDAP template result: " test.rabbit "
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP connecting to servers: ["openldap.com"]
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP network traffic: bind request = {'BindRequest',3,"test.rabbit",
>                                           {simple,<<"Mypassword">>}}
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP network traffic: bind reply = {ok,
>                                         {'LDAPMessage',1,
>                                          {bindResponse,
>                                           
> {'BindResponse',invalidDNSyntax,[],
>                                            "invalid DN",asn1_NOVALUE,
>                                            asn1_NOVALUE}},
>                                          asn1_NOVALUE}}
> =INFO REPORT==== 30-Apr-2014::09:31:56 ===
>     LDAP bind error: test.rabbit invalidDNSyntax
> =INFO REPORT==== 30-Apr-2014::09:31:56 === LDAP DECISION: login for 
> test.rabbit: {error,invalidDNSyntax}
> =ERROR REPORT==== 30-Apr-2014::09:31:56 === webmachine error: 
> path="/api/whoami"
> "Unauthorized"

--------- -------------- -------------

And this is the contents of config file

--------------  ------------------

> [
>   {rabbit, [
>      {tcp_listeners, [{"10.x.x.x",5672}]},
>      {ssl_listeners, [{"10.x.x.x",5671}]},
>      {ssl_options, [{cacertfile,"/etc/rabbitmq/ssl/nvca/cacert.pem"},
>                     {certfile,"/etc/rabbitmq/ssl/server/cert.pem"},
>                     {keyfile,"/etc/rabbitmq/ssl/server/key.pem"},
>                     {verify,verify_none},
>                     {fail_if_no_peer_cert,false}]},
>      {heartbeat, 15},
>      {vm_memory_high_watermark_paging_ratio, 0.75},
>      {vm_memory_high_watermark, 0.4},
>      {auth_backends, [{rabbit_auth_backend_ldap, 
> rabbit_auth_backend_internal},
>                           rabbit_auth_backend_internal]},
>      {disk_free_limit, 40000000000}
>   ]},
>   {rabbitmq_auth_backend_ldap,
>    [ {servers,               ["openldap.com"]},
>      {dn_lookup_attribute,   {"uid=${username}}},
>      {dn_lookup_base,        {"dc=openldap,dc=com"}},
>      {other_bind,           
>  ["cn=manager,cn=internal,dc=openldap,dc=com"," Ad09DSJwidjdwf89D"]},
>      {use_ssl,               false},
>      {port,                  389},
>      {log,                   network},
>    {vhost_access_query,    {exists, "cn=${username},ou=allusers, 
> dc=openldap,dc=com"}},
>      {resource_access_query,
>      {for, [{resource, exchange, {for, [{permission, configure,
>                                      {in_group, "cn=${username}, 
> dc=openldap,dc=com "}
>                                     },
>                                     {permission, write, {constant, true}},
>                                     {permission, read,  {constant, true}}
>                                    ]}},
>         {resource, queue,    {constant, true}}]}},
>      {tag_queries,           [{administrator, {constant, true}},
>                               {management,    {constant, true}}]}
>    ]
>   }
> ].

-------------------- ------------

Help me, please.
Thanks so much 
Ngoc Tang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/76581d49/attachment-0001.html>

From loganathan.ms at gmail.com  Thu May  1 07:21:19 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Thu, 1 May 2014 11:51:19 +0530
Subject: [rabbitmq-discuss] Need clarification on RabbitMq Connection
Message-ID: <CAD_i5MFVTj=p9uckh0YxC69-8zi-RNqyfu+BdTcfi_=b=DL8xg@mail.gmail.com>

Hi All,

I have a requirement where I need to develop an ruby library which needs to
listen to RabbitMQ messages and forward the messages to some other
applications with some additional changes in message. This library needs to
* ?? run always and should not close the connection at all*, hence it needs
to listen & publish messages always, also this library is running to of ROR
application.

For this requirement I have build an rake task to start listening to
RabbitMQ, also I have placed the same code in initializers file in order to
start the library along with Apache server in production mode. In
production mode initializer file is starting my library to listen & publish
the messages to RabbitMq.  I have noticed that connectiong to RabbitMq
behaves differently via rake task & initilazer file, copied below the
rabbitmq log for your reference.


*RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA RAKE TASK: (Connection
made one time only)*

=INFO REPORT==== 30-Apr-2014::20:43:24 ===
accepting AMQP connection <0.7409.18> (10.146.14.118:54932 ->
10.112.187.58:5671)

*RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA INITIALIZER
FILE:(Connection made multiple times)*

=INFO REPORT==== 30-Apr-2014::20:28:35 ===
accepting AMQP connection <0.6325.18> (10.146.14.118:54928 ->
10.112.187.58:5671)

=INFO REPORT==== 30-Apr-2014::20:28:35 ===
accepting AMQP connection <0.6329.18> (10.146.14.118:54929 ->
10.112.187.58:5671)


=WARNING REPORT==== 30-Apr-2014::20:28:37 ===
closing AMQP connection <0.6325.18> (10.146.14.118:54928 ->
10.112.187.58:5671):
connection_closed_abruptly

=INFO REPORT==== 30-Apr-2014::20:28:37 ===
accepting AMQP connection <0.6368.18> (10.146.14.118:54930 ->
10.112.187.58:5671)

=WARNING REPORT==== 30-Apr-2014::20:28:37 ===
closing AMQP connection <0.6329.18> (10.146.14.118:54929 ->
10.112.187.58:5671):
connection_closed_abruptly

=INFO REPORT==== 30-Apr-2014::20:28:37 ===
accepting AMQP connection <0.6373.18> (10.146.14.118:54931 ->
10.112.187.58:5671)


=ERROR REPORT==== 30-Apr-2014::20:28:42 ===
error on AMQP connection <0.6368.18>: {ssl_upgrade_error,timeout} (unknown
POSIX error)

=ERROR REPORT==== 30-Apr-2014::20:28:42 ===
error on AMQP connection <0.6373.18>: {ssl_upgrade_error,timeout} (unknown
POSIX error)


Can
?anybody
  let me know whether the issue with my code or with RabbitMq
configuration,  you can see my code
HERE<https://gist.github.com/loganathan-s/22256c01127065c9d659>.
While re
?-?
connecting on tcp connection loss AMQP gem passes guest as username &
password even though I am connecting to RabbitMq via SSL certificates.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/09bfbb13/attachment.html>

From rikatee at gmail.com  Thu May  1 00:13:05 2014
From: rikatee at gmail.com (Richard Tier)
Date: Wed, 30 Apr 2014 16:13:05 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq behind nginx
Message-ID: <7893bd26-0160-4270-96bc-17abadbea951@googlegroups.com>

I am trying to setup rabbitmq it can be accessed externally (from 
non-localhost) through nginx.

nginx-rabbitmq.conf:

server {
    listen       5672;
    server_name  x.x.x.x;
    location / {
        proxy_pass http://localhost:55672/;
    }
}

rabbitmq.conf:

[
 {rabbit,
  [
   {tcp_listeners, [{"127.0.0.1", 55672}]}
  ]
 }
]


By default guest user can only interact from localhost, so we need to 
create another user with required permissions, like so:

sudo rabbitmqctl add_user my_user my_password
sudo rabbitmqctl set_permissions my_user ".*" ".*" ".*"

However, when I attempt a connection to rabbitmq through pika I get 
ConnectionClosed exception

import pika
credentials = pika.credentials.PlainCredentials('my_username', 
'my_password')
pika.BlockingConnection(
    pika.ConnectionParameters(host=ip_address, port=55672, 
credentials=credentials)
)

However, if I use the same credentials via localhost and change to port 
5672 then it connects ok:

I have opened port 5672 on the GCE web console, and communication through 
nginx is happening: nginx access.log file shows

[30/Apr/2014:22:59:41 +0000] "AMQP\x00\x00\x09\x01" 400 172 "-" "-" "-"

Which shows a 400 status code response (bad request).

So by the looks the request fails when going through nginx, but works when 
we request rabbitmq directly.

Has anyone else had similar problems/got rabbitmq working for external 
users through nginx? is there a rabbitmq log file where I can see each 
request and help further troubleshooting?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/147bf7a5/attachment.html>

From phil.at.hp at gmail.com  Thu May  1 00:19:27 2014
From: phil.at.hp at gmail.com (Phillip Corchary)
Date: Wed, 30 Apr 2014 16:19:27 -0700 (PDT)
Subject: [rabbitmq-discuss] remote guest connections in 3.3.x versus
	previous versions
Message-ID: <af997cd4-c55e-4914-bfa3-60053df9c7d9@googlegroups.com>

I have a test environment where I found that rabbitmq was refusing remote 
guest connections (yes, I know, insecure, bad idea), where as my other 
environments had been accepting the guest connections. I fixed it with the 
loopback [] config, but the only difference is that this environment has 
v3.3.0 ... all the others have 3.2.0 or earlier. 

Does anyone know if there was an explicit change to the default behaviour 
that causes this? I didn't see it in the release notes, so if this is a 
known thing can you please point me to the documentation for it ... thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/8e8706b2/attachment.html>

From simon at rabbitmq.com  Thu May  1 08:33:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 08:33:31 +0100
Subject: [rabbitmq-discuss] rabbitmq behind nginx
In-Reply-To: <7893bd26-0160-4270-96bc-17abadbea951@googlegroups.com>
References: <7893bd26-0160-4270-96bc-17abadbea951@googlegroups.com>
Message-ID: <5361F8CB.9080307@rabbitmq.com>

Port 5672 is AMQP. Port 55672 is the old HTTP management plugin port. 
(It's moved to port 15672.)

nginx can't proxy AMQP.

So are you trying to proxy AMQP or HTTP? If you are just trying to 
access RabbitMQ from non-localhost, why do you need nginx?

For default log file locations it depends how you installed RabbitMQ, 
see http://www.rabbitmq.com/relocate.html for the various possibilities.

Cheers, Simon

On 01/05/2014 00:13, Richard Tier wrote:
> I am trying to setup rabbitmq it can be accessed externally (from
> non-localhost) through nginx.
>
> nginx-rabbitmq.conf:
>
> server {
>      listen       5672;
>      server_name  x.x.x.x;
>      location / {
>          proxy_pass http://localhost:55672/;
>      }
> }
>
> rabbitmq.conf:
>
> [
>   {rabbit,
>    [
>     {tcp_listeners, [{"127.0.0.1", 55672}]}
>    ]
>   }
> ]
>
>
> By default guest user can only interact from localhost, so we need to
> create another user with required permissions, like so:
>
> sudo rabbitmqctl add_user my_user my_password
> sudo rabbitmqctl set_permissions my_user ".*" ".*" ".*"
>
> However, when I attempt a connection to rabbitmq through pika I get
> ConnectionClosed exception
>
> import pika
> credentials = pika.credentials.PlainCredentials('my_username',
> 'my_password')
> pika.BlockingConnection(
>      pika.ConnectionParameters(host=ip_address, port=55672,
> credentials=credentials)
> )
>
> However, if I use the same credentials via localhost and change to port
> 5672 then it connects ok:
>
> I have opened port 5672 on the GCE web console, and communication
> through nginx is happening: nginx access.log file shows
>
> [30/Apr/2014:22:59:41 +0000] "AMQP\x00\x00\x09\x01" 400 172 "-" "-" "-"
>
> Which shows a 400 status code response (bad request).
>
> So by the looks the request fails when going through nginx, but works
> when we request rabbitmq directly.
>
> Has anyone else had similar problems/got rabbitmq working for external
> users through nginx? is there a rabbitmq log file where I can see each
> request and help further troubleshooting?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Thu May  1 08:36:06 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 08:36:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
 ????
In-Reply-To: <48cb2622-c6a8-4854-8a15-a6d4726fa390@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
 <48cb2622-c6a8-4854-8a15-a6d4726fa390@googlegroups.com>
Message-ID: <5361F966.6080007@rabbitmq.com>

On 01/05/2014 01:44, Ng?c T?ng V?n wrote:
> Help me, please.

Please see my response here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2014-April/035671.html

Cheers, Simon

From simon at rabbitmq.com  Thu May  1 08:40:02 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 08:40:02 +0100
Subject: [rabbitmq-discuss] remote guest connections in 3.3.x versus
 previous versions
In-Reply-To: <af997cd4-c55e-4914-bfa3-60053df9c7d9@googlegroups.com>
References: <af997cd4-c55e-4914-bfa3-60053df9c7d9@googlegroups.com>
Message-ID: <5361FA52.3010605@rabbitmq.com>

On 01/05/2014 00:19, Phillip Corchary wrote:
> Does anyone know if there was an explicit change to the default
> behaviour that causes this?

Yes.

> I didn't see it in the release notes,

Really? It's the first item at 
http://www.rabbitmq.com/release-notes/README-3.3.0.txt :-)

> so if
> this is a known thing can you please point me to the documentation for
> it ... thanks!

Other documentation is at:

http://www.rabbitmq.com/access-control.html
http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/

But people are still not finding this, you're not the only one. Where 
were you looking? Where else should we document this?

Cheers, Simon

From simon at rabbitmq.com  Thu May  1 08:47:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 08:47:37 +0100
Subject: [rabbitmq-discuss] Redelivery of unacked messages.
In-Reply-To: <85BDDAE422FE734992DD233B5E1873C0766263D4@INWPIEXC02.SATS.CORP>
References: <85BDDAE422FE734992DD233B5E1873C0766263D4@INWPIEXC02.SATS.CORP>
Message-ID: <5361FC19.7090209@rabbitmq.com>

On 30/04/2014 22:02, Jochum, Jeffrey wrote:
> I have a queue that I am consuming many messages off of but I am not
> acking them immediately.  I wait a period and then ack them all at
> once.  However I notice I seem to be getting these messages again ever
> couple of minutes.  I don?t believe the publisher is republishing these
> messages, so I was wondering if the broker sends these out again, of if
> the messages go back to a recovery state at some point.

The messages will be returned to the main queue and eligible for 
redelivery if:

* The channel on which they were consumed closes (because you closed it 
explicitly or an error occured or the connection went down) OR

* You reject the messages with basic.reject / basic.nack OR

* You invoke basic.recover

There is no timeout or similar; messages can stay in the unacknowledged 
state forever as long as none of the above happens.

Cheers, Simon

From simon at rabbitmq.com  Thu May  1 10:47:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 10:47:12 +0100
Subject: [rabbitmq-discuss] Mirrored HA queues disappeared on one out of
 two nodes restarting
In-Reply-To: <56058353-7C00-4AA6-85E7-38F17355E7D1@nationalfibre.net>
References: <FDB5A57F-17AD-4AD0-B274-A61F49562130@nationalfibre.net>
 <53611597.6060100@rabbitmq.com>
 <56058353-7C00-4AA6-85E7-38F17355E7D1@nationalfibre.net>
Message-ID: <53621820.9060700@rabbitmq.com>

On 30/04/14 16:34, Mark Steele wrote:
>      exception exit: {function_clause,
>                          [{gb_trees,delete_1,[4227,nil]},
>                           {gb_trees,delete,2},
>                           {rabbit_variable_queue,remove_pending_ack,2},
>                           {rabbit_variable_queue,'-ack/2-fun-0-',2},
>                           {lists,foldl,3},
>                           {rabbit_variable_queue,ack,2},
>                           {rabbit_mirror_queue_slave,process_instruction,2},
>                           {rabbit_mirror_queue_slave,handle_cast,2}]}

Hi. That's not a stack trace we've seen before - however it's quite 
plausible that one of bug 25615 or 25602 could cause this (fixed in 
3.1.4 and 3.2.0 respectively) as they could both lead to slave VQ state 
being corrupted in some cases.

Which version are you running?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mldz at hotmail.com  Thu May  1 12:13:11 2014
From: mldz at hotmail.com (Matthijs de Z)
Date: Thu, 1 May 2014 11:13:11 +0000
Subject: [rabbitmq-discuss]
	'RabbitMQ.Client.Exceptions.BrokerUnreachableException'
Message-ID: <DUB124-W43D333C090BEB36727836AD0400@phx.gbl>



 Hi,


I was looking into RabbitQM and checked out this website http://www.jarloo.com/rabbitmq-c-tutorial/ and http://www.rabbitmq.com/tutorials/tutorial-three-dotnet.html
But when I run the example files (in visual studio 2013) I get this error:


"An unhandled exception of type 'RabbitMQ.Client.Exceptions.BrokerUnreachableException' occurred in RabbitMQ.Client.dll" when trying using(IConnection connection = factory.CreateConnection())


I did install rabbitqm-dotnet-client-2.4.1.msi.
The references seems to be OK and I can build the program.
Hopefully someone can help me out, so I can give rabbitQM a try compared to my WCF solution (hoping rabbitQM will be faster)
Kind regards,


Matthijs


 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/85628616/attachment.html>

From simon at rabbitmq.com  Thu May  1 14:35:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 14:35:14 +0100
Subject: [rabbitmq-discuss]
	'RabbitMQ.Client.Exceptions.BrokerUnreachableException'
In-Reply-To: <DUB124-W43D333C090BEB36727836AD0400@phx.gbl>
References: <DUB124-W43D333C090BEB36727836AD0400@phx.gbl>
Message-ID: <53624D92.3090101@rabbitmq.com>

On 01/05/14 12:13, Matthijs de Z wrote:
> "An unhandled exception of type
> 'RabbitMQ.Client.Exceptions.BrokerUnreachableException' occurred in
> RabbitMQ.Client.dll" when trying using(IConnection connection =
> factory.CreateConnection())

The key is BrokerUnreachableException - the client app was not able to 
connect to the server. I think newer versions of the .net client might 
give better diagnostics here.

> I did install rabbitqm-dotnet-client-2.4.1.msi.

Why 2.4.1? 3.3.1 is the current version, 2.4.1 is three years old at 
this point.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ershad.rahimikia at desire2learn.com  Thu May  1 15:14:37 2014
From: ershad.rahimikia at desire2learn.com (ershad)
Date: Thu, 1 May 2014 14:14:37 +0000 (UTC)
Subject: [rabbitmq-discuss] RabbitMQ SDKs and version upgrades
Message-ID: <loom.20140501T155242-147@post.gmane.org>

We are doing experiments using RabbitMQ as a message bus for our service 
oriented architecture. One concern that we have is what happens to the 
publishers and consumers when we upgrade RabbitMQ. I see on the download page 
that for every new version of RabbitMQ a new version of SDK gets released, 
does that mean upgrading RabbitMQ but not the SDKs for publishers and 
consumers would be a breaking change? This is important for us to know because 
each service is implemented by a different team and coordinating SDK version 
upgrades would be very difficult for us in future. We were even considering 
different options such as adding a middleman service that consumers 
(publishers are less of a concern for us) can talk to read from their queues 
and that service is responsible for talking to RabbitMQ to protect our 
consumers against Rabbit version upgrades. But this is definitely not an ideal 
solution for us mainly for performance reasons. Wondering if this is something 
that we need to be worried about at all and if there are any better solutions 
for that.




From simon at rabbitmq.com  Thu May  1 15:24:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 15:24:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ SDKs and version upgrades
In-Reply-To: <loom.20140501T155242-147@post.gmane.org>
References: <loom.20140501T155242-147@post.gmane.org>
Message-ID: <5362592F.6010003@rabbitmq.com>

On 01/05/14 15:14, ershad wrote:
> I see on the download page
> that for every new version of RabbitMQ a new version of SDK gets released,
> does that mean upgrading RabbitMQ but not the SDKs for publishers and
> consumers would be a breaking change?

No, you can mix versions quite happily. Sometimes you don't get access 
to new features until you upgrade both client and server but other than 
that there's no issue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ron.cordell at gmail.com  Thu May  1 16:04:33 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Thu, 1 May 2014 08:04:33 -0700
Subject: [rabbitmq-discuss] RabbitMQ SDKs and version upgrades
In-Reply-To: <5362592F.6010003@rabbitmq.com>
References: <loom.20140501T155242-147@post.gmane.org>
 <5362592F.6010003@rabbitmq.com>
Message-ID: <CAFtA53x0eiR5pNYictGu4FM3SoPS2ypdq8eA6JgnCJSpOjFF=Q@mail.gmail.com>

We use RabbitMQ as a message bus and we use the MassTransit .NET libraries
to implement all of the features around the AMQP message brokers; the
application is not directly exposed to the .NET RabbitMQ client. However,
MT is updated with the new RMQ .Net client for each release, and we have
been keeping up with RabbitMQ updates on our infrastructure because it's
not completely "baked" in place, yet, giving us that flexibility. We
haven't had any issues with the upgrades only the RabbitMQ nodes but not
the application code/.NET client on minor version upgrades nor on the most
recent major version upgrade (to 3.3.1).

HTH,

-ronc


On Thu, May 1, 2014 at 7:24 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 01/05/14 15:14, ershad wrote:
>
>> I see on the download page
>> that for every new version of RabbitMQ a new version of SDK gets released,
>> does that mean upgrading RabbitMQ but not the SDKs for publishers and
>> consumers would be a breaking change?
>>
>
> No, you can mix versions quite happily. Sometimes you don't get access to
> new features until you upgrade both client and server but other than that
> there's no issue.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/8497d570/attachment.html>

From marks at nationalfibre.net  Thu May  1 16:09:15 2014
From: marks at nationalfibre.net (Mark Steele)
Date: Thu, 1 May 2014 11:09:15 -0400
Subject: [rabbitmq-discuss] Mirrored HA queues disappeared on one out of
	two nodes restarting
In-Reply-To: <53621820.9060700@rabbitmq.com>
References: <FDB5A57F-17AD-4AD0-B274-A61F49562130@nationalfibre.net>
 <53611597.6060100@rabbitmq.com>
 <56058353-7C00-4AA6-85E7-38F17355E7D1@nationalfibre.net>
 <53621820.9060700@rabbitmq.com>
Message-ID: <67D281CE-B8E1-4FB4-996B-644524A1BEDD@nationalfibre.net>

3.1.3

Mark Steele, CISSP, CSM, GCIA, GPEN
Director of development
Instaclick Inc.
marks at nationalfibre.net
m: (416) 844-9221

On May 1, 2014, at 5:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 30/04/14 16:34, Mark Steele wrote:
>>     exception exit: {function_clause,
>>                         [{gb_trees,delete_1,[4227,nil]},
>>                          {gb_trees,delete,2},
>>                          {rabbit_variable_queue,remove_pending_ack,2},
>>                          {rabbit_variable_queue,'-ack/2-fun-0-',2},
>>                          {lists,foldl,3},
>>                          {rabbit_variable_queue,ack,2},
>>                          {rabbit_mirror_queue_slave,process_instruction,2},
>>                          {rabbit_mirror_queue_slave,handle_cast,2}]}
> 
> Hi. That's not a stack trace we've seen before - however it's quite plausible that one of bug 25615 or 25602 could cause this (fixed in 3.1.4 and 3.2.0 respectively) as they could both lead to slave VQ state being corrupted in some cases.
> 
> Which version are you running?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/478dd664/attachment.html>

From ian.dallas at hp.com  Thu May  1 17:11:17 2014
From: ian.dallas at hp.com (Dallas, Ian)
Date: Thu, 1 May 2014 16:11:17 +0000
Subject: [rabbitmq-discuss] Any Issues With Running an Older Client with a
	Newer Server?
Message-ID: <485101FECCB6564BBBE712751EC3F01A65964C80@G9W0735.americas.hpqcorp.net>

Hey Everyone,

I'm working with Spring AMQP in my project that uses RabbitMQ and the latest version uses the 3.2.4 Java client. Would using this 3.2.4 client with a server version of 3.3.x cause any issues? Does RabbitMQ server usually (always?) maintain compatibility with older clients?

Cheers,
Ian Dallas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/f7e9f503/attachment.html>

From phil.at.hp at gmail.com  Thu May  1 17:17:06 2014
From: phil.at.hp at gmail.com (Phillip Corchary)
Date: Thu, 1 May 2014 10:17:06 -0600
Subject: [rabbitmq-discuss] remote guest connections in 3.3.x versus
 previous versions
In-Reply-To: <5361FA52.3010605@rabbitmq.com>
References: <af997cd4-c55e-4914-bfa3-60053df9c7d9@googlegroups.com>
 <5361FA52.3010605@rabbitmq.com>
Message-ID: <CAARqtZomnCVbQd+VGK5MiaOyUJGFYaXtjoQWPZtAyjU6EC_HkA@mail.gmail.com>

Simon et al -

Well, mea culpa. I vistied that exact release-notes before posting.
(verified my web history). Sad. I cannot explain how I missed that, I
really can't.
I'm not familiar enough with the community yet to suggest documentation
improvements.

Thank you!



On Thu, May 1, 2014 at 1:40 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 01/05/2014 00:19, Phillip Corchary wrote:
>
>> Does anyone know if there was an explicit change to the default
>> behaviour that causes this?
>>
>
> Yes.
>
>  I didn't see it in the release notes,
>>
>
> Really? It's the first item at http://www.rabbitmq.com/
> release-notes/README-3.3.0.txt :-)
>
>  so if
>> this is a known thing can you please point me to the documentation for
>> it ... thanks!
>>
>
> Other documentation is at:
>
> http://www.rabbitmq.com/access-control.html
> http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/
>
> But people are still not finding this, you're not the only one. Where were
> you looking? Where else should we document this?
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/7556b94b/attachment.html>

From simon at rabbitmq.com  Thu May  1 17:20:52 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 17:20:52 +0100
Subject: [rabbitmq-discuss] Mirrored HA queues disappeared on one out of
 two nodes restarting
In-Reply-To: <67D281CE-B8E1-4FB4-996B-644524A1BEDD@nationalfibre.net>
References: <FDB5A57F-17AD-4AD0-B274-A61F49562130@nationalfibre.net>
 <53611597.6060100@rabbitmq.com>
 <56058353-7C00-4AA6-85E7-38F17355E7D1@nationalfibre.net>
 <53621820.9060700@rabbitmq.com>
 <67D281CE-B8E1-4FB4-996B-644524A1BEDD@nationalfibre.net>
Message-ID: <53627464.1080802@rabbitmq.com>

On 01/05/14 16:09, Mark Steele wrote:
> 3.1.3

I am inclined to chalk that up to one of the previously mentioned bugs 
then - and suggest an upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  1 17:28:22 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 May 2014 17:28:22 +0100
Subject: [rabbitmq-discuss] Any Issues With Running an Older Client with
 a Newer Server?
In-Reply-To: <485101FECCB6564BBBE712751EC3F01A65964C80@G9W0735.americas.hpqcorp.net>
References: <485101FECCB6564BBBE712751EC3F01A65964C80@G9W0735.americas.hpqcorp.net>
Message-ID: <53627626.8060908@rabbitmq.com>

On 01/05/14 17:11, Dallas, Ian wrote:
> Would using this 3.2.4 client with a server version of 3.3.x cause any
> issues?

No.

> Does RabbitMQ server usually (always?) maintain compatibility
> with older clients?

Yes, at least as far as the wire protocol is concerned.

There may be semantic differences between versions, see 
http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/ 
for example. We obviously try to minimise these, but we can't eliminate 
them without becoming completely static or covered in a mass of 
compatibility-mode scar tissue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From grussell at gopivotal.com  Thu May  1 17:59:50 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 1 May 2014 12:59:50 -0400
Subject: [rabbitmq-discuss] Any Issues With Running an Older Client with
 a Newer Server?
In-Reply-To: <53627626.8060908@rabbitmq.com>
References: <485101FECCB6564BBBE712751EC3F01A65964C80@G9W0735.americas.hpqcorp.net>
 <53627626.8060908@rabbitmq.com>
Message-ID: <CADtU9_vAPNMJZEYb4e=MQZjBTkP9XmtrfnMShewxhCxZLeRdhg@mail.gmail.com>

It is also generally true that you should be able to run Spring-AMQP with a
newer rabbit client; the version in our pom just happens to be the current
version at the time of a release and is generally the recommended minimum
required version (although, in most cases, it will work just fine with
older clients/brokers too, certainly back to the 2.8.x era).

If you ever hit specific compatibility issues, please raise them here:
https://jira.spring.io/browse/AMQP


On Thu, May 1, 2014 at 12:28 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 01/05/14 17:11, Dallas, Ian wrote:
>
>> Would using this 3.2.4 client with a server version of 3.3.x cause any
>> issues?
>>
>
> No.
>
>
>  Does RabbitMQ server usually (always?) maintain compatibility
>> with older clients?
>>
>
> Yes, at least as far as the wire protocol is concerned.
>
> There may be semantic differences between versions, see
> http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/for example. We obviously try to minimise these, but we can't eliminate
> them without becoming completely static or covered in a mass of
> compatibility-mode scar tissue.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/40801f8b/attachment.html>

From srinatsr at cisco.com  Thu May  1 18:25:42 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 1 May 2014 17:25:42 +0000
Subject: [rabbitmq-discuss] Rest services to get messages from Queue
In-Reply-To: <CF870812.1095A1%egu@cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB042E7@xmb-aln-x10.cisco.com>
 <CF870812.1095A1%egu@cisco.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB04411@xmb-aln-x10.cisco.com>

Hello,

I couldn't hit this service from Java Class.  But I could hit through rest client Url : http://qot-job-03:15672/api/queues/%2F/validate.monitor/get

I know the issue with url encoding and decoding.


             String url ="http://qot-job-03:15672/api/queues/%2F/validate.monitor/get";

try {
                    result = restTemplate.exchange(url, HttpMethod.POST, entity, QueueMonitorRespone.class);
                    System.out.println("Sample Response :: "+result.getBody());

             }
                    catch (HttpClientErrorException e) {
                           e.printStackTrace();
                    }
Please need your help to resolve this.

As per above code, the url is taking something like  http://qot-job-03:15672/api/queues/%252F/validate.monitor/get because "%" is decoded as "%25" and don't want this to happen.

Request Json :

{"vhost":"/","name":"validate.monitor","truncate":"50000","requeue":"true","encoding":"auto","count":"1000"}
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/f5640030/attachment.html>

From vish.ramachandran at gmail.com  Thu May  1 18:50:11 2014
From: vish.ramachandran at gmail.com (vish.ramachandran)
Date: Thu, 1 May 2014 10:50:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Hostname Verification for SSL connections
Message-ID: <1398966611684-35278.post@n5.nabble.com>

Hi,

My clients connect to RMQ using mutual ssl authentication using
rabbitmq-auth-mechanism-ssl plugin.
I would like my client to do hostname verification while accepting the SSL
connection from the server.

The code example in the RabbitMQ SSL documentation allows the server to use
any CN. For example, the server certificate could be CN=SomeHost.com and the
client could be connecting to amqps://someIpWhichResolvesTo.SomeHost.com and
yet, the connection would succeed.


Has anyone been able to configure the client with a HostnameVerifier ?
http://docs.oracle.com/javase/7/docs/api/javax/net/ssl/HostnameVerifier.html

Thanks.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Hostname-Verification-for-SSL-connections-tp35278.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From srikanthtns at gmail.com  Thu May  1 20:26:47 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Thu, 1 May 2014 12:26:47 -0700
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
Message-ID: <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>

Also , we are trying to use 2DISC 1RAM in the cluster . Is this good enough
? Also which node should be set as RAM , is there any preference to set
only a particular node the cluster to be RAM ?

Thanks
Srikanth


On Wed, Apr 30, 2014 at 1:48 PM, srikanth tns <srikanthtns at gmail.com> wrote:

> Thanks Micheal , here is the settings we are doing on rabbitmq cluster
>
> {rabbit, [{vm_memory_high_watermark_paging_ratio,
> 0.8},{vm_memory_high_watermark, 0.9},{disk_free_limit, 1000000000}]}
>
> Apart from this ,is there any QoS value that we need to set ?
>
>
> On Tue, Apr 29, 2014 at 1:13 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>>
>>
>> On 29 April 2014 at 07:22:03, srikanth tns (srikanthtns at gmail.com) wrote:
>> > > Can you let us know what would be optimal settings on rabbitmq
>> > cluster to prevent it from crashing and having reliable messaging?
>>
>> It's really hard to make general recommendations without knowing what
>> kind of workload you use.
>>
>> > 1) sysctl configurations
>>
>> nlimit > 20,000 or so (definitely can't be less than ~ 6K)
>>
>> > 2) Disk limitations to setup on cluster . the default is 50MB
>>
>> I'd use 500 MB or so if RabbitMQ is the primary thing that runs on the
>> machine.
>>
>> > 3) Memory to used , right now its default 40%
>>
>> Can be up to 90%, again, depending on what else may run on the same
>> machine.
>>
>>
>> > 6) any disk space limitation on the hosts
>>
>> Host is this different from 2) above?
>>
>> > For HA , we are using ha-mode all to duplicate the queues across
>> > all nodes in the cluster. Do you think its reliable during the
>> > failover scenario ?During the failover it would like 100k queues
>> > on nthe new master? Or should we use ha-mode = exactly/nodes ?
>>
>> With 3 nodes ha-mode=all is a reasonable amount of duplication. If you
>> are confident
>> you will never lose more than 1 node at a time, use ha-mode=exactly with
>> 2 nodes.
>> Less duplication means better throughput.
>>
>> As to how well new master election will work with 100K queues, try it.
>> --
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/c1e57ac3/attachment.html>

From mrtndimitrov at gmail.com  Thu May  1 20:42:41 2014
From: mrtndimitrov at gmail.com (Martin Koroudjiev)
Date: Thu, 01 May 2014 22:42:41 +0300
Subject: [rabbitmq-discuss] Trying to implement RPC between Erlang and Java
	clients
Message-ID: <5362A3B1.2030902@gmail.com>

Hello,

The Erlang client is acting as a server, waiting for messages and
replying to them. The code is very simple. It is wrapped in a
gen_server. On startup, a Channel is created and then it's kept in the
state for later use. Then I do amqp_channel:subscribe/3. The Java client
sends a message, then declares an anonymous queue and starts waiting on
it. The initial message is handled as expected. I see the Erlang code to
pick the message, do its thing and when it tries to send back a
response, I get this:

=ERROR REPORT==== 1-May-2014::22:31:01 ===
** Generic server harmony_mom terminating
** Last message in was {'$gen_cast',
                           {send,"amq.gen-xbmvAa-yp5Ws_QkNwrFN7g",
                               [<message>],
                               "b60f9f9f-fccd-4a66-aff2-0b2ea60aa0af"}}
** When Server state == [{conn,{<0.134.0>,<0.143.0>}},
                         {queues,["dev.set_credentials","dev.inbound"]},
                        
{mom_config,[{protocol,"amqp"},{host,"localhost"}]}]
** Reason for termination ==
** {noproc,{gen_server,call,[<0.143.0>,{close,200,<<"Goodbye">>},infinity]}}


Thanks in advance,

Martin


From Petr.Gotthard at Honeywell.com  Thu May  1 21:14:02 2014
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 1 May 2014 20:14:02 +0000
Subject: [rabbitmq-discuss] priority field in web-management generated
	messages
Message-ID: <F9E85480F62349458DF67CE8BA000D8D3FC7FCA5@FR44EX3005.global.ds.honeywell.com>

Hello,

I've been reading the README file for the emerging priority-queue (quite exciting!) and found this statememt:

* The message `priority` field is defined as an unsigned byte, so in practice priorities should be between 0 and 255.

However, when a message is sent from the rabbitmq-management website, the priority property is encoded as a binary string. I thought the priority is a number 0-9 encoded as binary (e.g. <<"0">>), but if it's a byte (0-255), then it should be encoded as <<0>> instead. This is probably the correct behavior, but in such case the management plugin encodes the priority property incorrectly (I guess).


Regards,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/82cab7b2/attachment.html>

From videlalvaro at gmail.com  Thu May  1 21:25:59 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 1 May 2014 22:25:59 +0200
Subject: [rabbitmq-discuss] Rest services to get messages from Queue
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB04411@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB042E7@xmb-aln-x10.cisco.com>
 <CF870812.1095A1%egu@cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB04411@xmb-aln-x10.cisco.com>
Message-ID: <CAMcAHLXkRVM3B5uQeAcvt6hJOm=j0=uCMK0Dj42_C0AG5F5WEQ@mail.gmail.com>

Is there a reason why you are doing this via REST which is very slow
compared to using a default AMQP consumer?

On Thu, May 1, 2014 at 7:25 PM, Srinath Sridharan -X (srinatsr -
ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
> Hello,
>
>
>
> I couldn?t hit this service from Java Class.  But I could hit through rest
> client Url : http://qot-job-03:15672/api/queues/%2F/validate.monitor/get
>
>
>
> I know the issue with url encoding and decoding.
>
>
>
>
>
>              String url
> ="http://qot-job-03:15672/api/queues/%2F/validate.monitor/get";
>
>
>
> try {
>
>                     result = restTemplate.exchange(url, HttpMethod.POST,
> entity, QueueMonitorRespone.class);
>
>                     System.out.println("Sample Response ::
> "+result.getBody());
>
>
>
>              }
>
>                     catch (HttpClientErrorException e) {
>
>                            e.printStackTrace();
>
>                     }
>
> Please need your help to resolve this.
>
>
>
> As per above code, the url is taking something like
> http://qot-job-03:15672/api/queues/%252F/validate.monitor/get because ?%? is
> decoded as ?%25? and don?t want this to happen.
>
>
>
> Request Json :
>
>
>
> {"vhost":"/","name":"validate.monitor","truncate":"50000","requeue":"true","encoding":"auto","count":"1000"}
>
> Regards ??
>
> Srinath
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From srinatsr at cisco.com  Thu May  1 21:31:53 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 1 May 2014 20:31:53 +0000
Subject: [rabbitmq-discuss] Rest services to get messages from Queue
In-Reply-To: <CAMcAHLXkRVM3B5uQeAcvt6hJOm=j0=uCMK0Dj42_C0AG5F5WEQ@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB042E7@xmb-aln-x10.cisco.com>
 <CF870812.1095A1%egu@cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB04411@xmb-aln-x10.cisco.com>
 <CAMcAHLXkRVM3B5uQeAcvt6hJOm=j0=uCMK0Dj42_C0AG5F5WEQ@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB04663@xmb-aln-x10.cisco.com>

Yes.  I have binded my queue with trace and log exchange, so I need to get all information and logging those message

Regards ??
Srinath


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alvaro Videla
Sent: Thursday, May 01, 2014 1:26 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Rest services to get messages from Queue

Is there a reason why you are doing this via REST which is very slow compared to using a default AMQP consumer?

On Thu, May 1, 2014 at 7:25 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
> Hello,
>
>
>
> I couldn?t hit this service from Java Class.  But I could hit through 
> rest client Url : 
> http://qot-job-03:15672/api/queues/%2F/validate.monitor/get
>
>
>
> I know the issue with url encoding and decoding.
>
>
>
>
>
>              String url
> ="http://qot-job-03:15672/api/queues/%2F/validate.monitor/get";
>
>
>
> try {
>
>                     result = restTemplate.exchange(url, 
> HttpMethod.POST, entity, QueueMonitorRespone.class);
>
>                     System.out.println("Sample Response ::
> "+result.getBody());
>
>
>
>              }
>
>                     catch (HttpClientErrorException e) {
>
>                            e.printStackTrace();
>
>                     }
>
> Please need your help to resolve this.
>
>
>
> As per above code, the url is taking something like 
> http://qot-job-03:15672/api/queues/%252F/validate.monitor/get because 
> ?%? is decoded as ?%25? and don?t want this to happen.
>
>
>
> Request Json :
>
>
>
> {"vhost":"/","name":"validate.monitor","truncate":"50000","requeue":"t
> rue","encoding":"auto","count":"1000"}
>
> Regards ??
>
> Srinath
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Thu May  1 21:50:08 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 1 May 2014 22:50:08 +0200
Subject: [rabbitmq-discuss] Rest services to get messages from Queue
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB04663@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB042E7@xmb-aln-x10.cisco.com>
 <CF870812.1095A1%egu@cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB04411@xmb-aln-x10.cisco.com>
 <CAMcAHLXkRVM3B5uQeAcvt6hJOm=j0=uCMK0Dj42_C0AG5F5WEQ@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB04663@xmb-aln-x10.cisco.com>
Message-ID: <CAMcAHLXjq9ou9Jgzqmtp8v-KmpnUfAirGdSSzmx7rNN_9u0mEQ@mail.gmail.com>

You can do that with an AMQP consumer, there's no need to use the REST
API for that, therefore my question about _why_ you are trying to
consume messages using REST when an AMQP client will suffice.

On Thu, May 1, 2014 at 10:31 PM, Srinath Sridharan -X (srinatsr -
ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
> Yes.  I have binded my queue with trace and log exchange, so I need to get all information and logging those message
>
> Regards ??
> Srinath
>
>
> -----Original Message-----
> From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alvaro Videla
> Sent: Thursday, May 01, 2014 1:26 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Rest services to get messages from Queue
>
> Is there a reason why you are doing this via REST which is very slow compared to using a default AMQP consumer?
>
> On Thu, May 1, 2014 at 7:25 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>> Hello,
>>
>>
>>
>> I couldn?t hit this service from Java Class.  But I could hit through
>> rest client Url :
>> http://qot-job-03:15672/api/queues/%2F/validate.monitor/get
>>
>>
>>
>> I know the issue with url encoding and decoding.
>>
>>
>>
>>
>>
>>              String url
>> ="http://qot-job-03:15672/api/queues/%2F/validate.monitor/get";
>>
>>
>>
>> try {
>>
>>                     result = restTemplate.exchange(url,
>> HttpMethod.POST, entity, QueueMonitorRespone.class);
>>
>>                     System.out.println("Sample Response ::
>> "+result.getBody());
>>
>>
>>
>>              }
>>
>>                     catch (HttpClientErrorException e) {
>>
>>                            e.printStackTrace();
>>
>>                     }
>>
>> Please need your help to resolve this.
>>
>>
>>
>> As per above code, the url is taking something like
>> http://qot-job-03:15672/api/queues/%252F/validate.monitor/get because
>> ?%? is decoded as ?%25? and don?t want this to happen.
>>
>>
>>
>> Request Json :
>>
>>
>>
>> {"vhost":"/","name":"validate.monitor","truncate":"50000","requeue":"t
>> rue","encoding":"auto","count":"1000"}
>>
>> Regards ??
>>
>> Srinath
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu May  1 22:46:00 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 May 2014 22:46:00 +0100
Subject: [rabbitmq-discuss] priority field in web-management generated
 messages
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D3FC7FCA5@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC7FCA5@FR44EX3005.global.ds.honeywell.com>
Message-ID: <5362C098.6020502@rabbitmq.com>

On 01/05/14 21:14, Gotthard, Petr wrote:
> However, when a message is sent from the rabbitmq-management website,
> the priority property is encoded as a binary string.

 From the 3.3.1 release notes 
(http://www.rabbitmq.com/release-notes/README-3.3.1.txt)

<quote>
26140 prevent malformed message being created when publishing with 
priority or timestamp properties set (since 2.4.0)
</quote>

So I guess you are running an older version.

Matthias.

From srinatsr at cisco.com  Thu May  1 22:50:21 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 1 May 2014 21:50:21 +0000
Subject: [rabbitmq-discuss] How to resolve this issue?
In-Reply-To: <405CBD98-FB34-48C0-A3A8-F99064296439@rabbitmq.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB041B5@xmb-aln-x10.cisco.com>
 <405CBD98-FB34-48C0-A3A8-F99064296439@rabbitmq.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0475D@xmb-aln-x10.cisco.com>

Hello Michael,

I could consume other RabbitMQ APIs from my system.  Why I am facing problem with this alone?

Telnet is working fine.  Management  Plugin is enabled to the IP address and port.

Please need your suggestions.

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Wednesday, April 30, 2014 3:46 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] How to resolve this issue?

This means the server is not reachable (over TCP). Check if the IP is correct, possible firewall settings, if management plugin is enabled and binds to the IP address and port you expect, etc.

Try connecting via telnet first.

MK

On 01/05/2014, at 02:39, "Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)" <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Apr 30, 2014 3:38:24 PM org.apache.catalina.core.StandardWrapperValve invoke
SEVERE: Servlet.service() for servlet [Q2OServiceEngine Servlet] in context with path [/QOTService-1.0] threw exception [Request processing failed; nested exception is org.springframework.web.client.ResourceAccessException: I/O error on POST request for "http://qot-job-03:15672/api/queues/%252F/validate.monitor/get": The target server failed to respond; nested exception is org.apache.http.NoHttpResponseException: The target server failed to respond] with root cause
org.apache.http.NoHttpResponseException: The target server failed to respond
       at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:95)
       at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:62)
       at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:254)
       at org.apache.http.impl.AbstractHttpClientConnection.receiveResponseHeader(AbstractHttpClientConnection.java:289)
       at org.apache.http.impl.conn.DefaultClientConnection.receiveResponseHeader(DefaultClientConnection.java:252)
       at org.apache.http.impl.conn.ManagedClientConnectionImpl.receiveResponseHeader(ManagedClientConnectionImpl.java:191)
       at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:300)
       at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:127)
       at org.apache.http.impl.client.DefaultRequestDirector.tryExecute(DefaultRequestDirector.java:717)
       at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:522)
       at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)
       at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:805)
       at org.springframework.http.client.HttpComponentsClientHttpRequest.executeInternal(HttpComponentsClientHttpRequest.java:88)
       at org.springframework.http.client.AbstractBufferingClientHttpRequest.executeInternal(AbstractBufferingClientHttpRequest.java:46)
       at org.springframework.http.client.AbstractClientHttpRequest.execute(AbstractClientHttpRequest.java:49)
       at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:509)
       at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:472)
       at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:420)
       at com.cisco.ccrc.service.controller.PushRequestToQueueController.getMessagesFromQueue(PushRequestToQueueController.java:94)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
       at java.lang.reflect.Method.invoke(Method.java:606)
       at org.springframework.web.method.support.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:219)
       at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:132)
       at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:104)
       at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandleMethod(RequestMappingHandlerAdapter.java:745)
       at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:686)
       at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:80)
       at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:925)
       at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:856)
       at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:953)
       at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:855)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)
       at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:829)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:728)
       at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
       at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
       at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)
       at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)
       at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:502)
       at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)
       at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)
       at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)
       at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
       at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)
       at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1023)
       at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)
       at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)
       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
       at java.lang.Thread.run(Thread.java:724)



Regards ??
Srinath

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/7ab44eb5/attachment.html>

From mrtndimitrov at gmail.com  Thu May  1 23:57:01 2014
From: mrtndimitrov at gmail.com (Martin Koroudjiev)
Date: Fri, 02 May 2014 01:57:01 +0300
Subject: [rabbitmq-discuss] Reusing a channel or creating new ones
Message-ID: <5362D13D.2000606@gmail.com>

Hello,

Should I reuse the channel when sending messages or create a new one for
each send operation? Do I keep it around while listening for messages
and acknowledging them with the old channel or should I create a new one
for the acknowledge operation?

Thanks,

Martin

From videlalvaro at gmail.com  Fri May  2 01:17:51 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 2 May 2014 02:17:51 +0200
Subject: [rabbitmq-discuss] Reusing a channel or creating new ones
In-Reply-To: <5362D13D.2000606@gmail.com>
References: <5362D13D.2000606@gmail.com>
Message-ID: <CAMcAHLXU7k9R07zOVJ+Ba06h96hdEwUBvAWU1TR8g6Fy3SyDPA@mail.gmail.com>

Hi,

There's no need to open a new channel for every message published, in
fact, it will be faster to use the same channel.

About message acks, you have to send the acks on the same channel
where the message where received, since the delivery tags of messages
are scoped per channel.

Regards,

Alvaro

On Fri, May 2, 2014 at 12:57 AM, Martin Koroudjiev
<mrtndimitrov at gmail.com> wrote:
> Hello,
>
> Should I reuse the channel when sending messages or create a new one for
> each send operation? Do I keep it around while listening for messages
> and acknowledging them with the old channel or should I create a new one
> for the acknowledge operation?
>
> Thanks,
>
> Martin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Fri May  2 01:32:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 1 May 2014 20:32:05 -0400
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
Message-ID: <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>

Unless you mostly do request-reply workloads, just use disk nodes.

MK

> On 01/05/2014, at 15:26, srikanth tns <srikanthtns at gmail.com> wrote:
> 
> Also , we are trying to use 2DISC 1RAM in the cluster . Is this good enough ? Also which node should be set as RAM , is there any preference to set only a particular node the cluster to be RAM ?
> 
> Thanks
> Srikanth
> 
> 
>> On Wed, Apr 30, 2014 at 1:48 PM, srikanth tns <srikanthtns at gmail.com> wrote:
>> Thanks Micheal , here is the settings we are doing on rabbitmq cluster
>> 
>> {rabbit, [{vm_memory_high_watermark_paging_ratio, 0.8},{vm_memory_high_watermark, 0.9},{disk_free_limit, 1000000000}]}
>> 
>> Apart from this ,is there any QoS value that we need to set ?
>> 
>> 
>>> On Tue, Apr 29, 2014 at 1:13 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
>>> 
>>> 
>>> On 29 April 2014 at 07:22:03, srikanth tns (srikanthtns at gmail.com) wrote:
>>> > > Can you let us know what would be optimal settings on rabbitmq
>>> > cluster to prevent it from crashing and having reliable messaging?
>>> 
>>> It's really hard to make general recommendations without knowing what
>>> kind of workload you use.
>>> 
>>> > 1) sysctl configurations
>>> 
>>> nlimit > 20,000 or so (definitely can't be less than ~ 6K)
>>> 
>>> > 2) Disk limitations to setup on cluster . the default is 50MB
>>> 
>>> I'd use 500 MB or so if RabbitMQ is the primary thing that runs on the machine.
>>> 
>>> > 3) Memory to used , right now its default 40%
>>> 
>>> Can be up to 90%, again, depending on what else may run on the same machine.
>>> 
>>> 
>>> > 6) any disk space limitation on the hosts
>>> 
>>> Host is this different from 2) above?
>>> 
>>> > For HA , we are using ha-mode all to duplicate the queues across
>>> > all nodes in the cluster. Do you think its reliable during the
>>> > failover scenario ?During the failover it would like 100k queues
>>> > on nthe new master? Or should we use ha-mode = exactly/nodes ?
>>> 
>>> With 3 nodes ha-mode=all is a reasonable amount of duplication. If you are confident
>>> you will never lose more than 1 node at a time, use ha-mode=exactly with 2 nodes.
>>> Less duplication means better throughput.
>>> 
>>> As to how well new master election will work with 100K queues, try it. 
>>> --
>>> MK
>>> 
>>> Software Engineer, Pivotal/RabbitMQ
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/891c8a7a/attachment.html>

From carl.hoerberg at gmail.com  Fri May  2 03:17:14 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 1 May 2014 19:17:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Alternate Bunny RPC tutorial client
Message-ID: <1398997034146-35290.post@n5.nabble.com>

The client in the RPC tutorial for Bunny isn't super performant (maybe not a
hard requirement for RPC) because it creates new consumers over and over
again, but it also has a race condition bug, where messages with "wrong"
correlation_id would be discarded. 
http://www.rabbitmq.com/tutorials/tutorial-six-ruby.html

Here's an alternate implementation: 
https://gist.github.com/carlhoerberg/96eb730f4c533f61a856




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Alternate-Bunny-RPC-tutorial-client-tp35290.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From srikanthtns at gmail.com  Fri May  2 04:33:13 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Thu, 1 May 2014 20:33:13 -0700
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
Message-ID: <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>

Thanks Micheal , we use mcollective application for publishing the requests
to target nodes and receive the response from the consumers to validate if
the command was successful or not . In this case , should we use 1 RAM node
2 DISC nodes ?


On Thu, May 1, 2014 at 5:32 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> Unless you mostly do request-reply workloads, just use disk nodes.
>
> MK
>
> On 01/05/2014, at 15:26, srikanth tns <srikanthtns at gmail.com> wrote:
>
> Also , we are trying to use 2DISC 1RAM in the cluster . Is this good
> enough ? Also which node should be set as RAM , is there any preference to
> set only a particular node the cluster to be RAM ?
>
> Thanks
> Srikanth
>
>
> On Wed, Apr 30, 2014 at 1:48 PM, srikanth tns <srikanthtns at gmail.com>wrote:
>
>> Thanks Micheal , here is the settings we are doing on rabbitmq cluster
>>
>> {rabbit, [{vm_memory_high_watermark_paging_ratio,
>> 0.8},{vm_memory_high_watermark, 0.9},{disk_free_limit, 1000000000}]}
>>
>> Apart from this ,is there any QoS value that we need to set ?
>>
>>
>> On Tue, Apr 29, 2014 at 1:13 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>
>>>
>>>
>>> On 29 April 2014 at 07:22:03, srikanth tns (srikanthtns at gmail.com)
>>> wrote:
>>> > > Can you let us know what would be optimal settings on rabbitmq
>>> > cluster to prevent it from crashing and having reliable messaging?
>>>
>>> It's really hard to make general recommendations without knowing what
>>> kind of workload you use.
>>>
>>> > 1) sysctl configurations
>>>
>>> nlimit > 20,000 or so (definitely can't be less than ~ 6K)
>>>
>>> > 2) Disk limitations to setup on cluster . the default is 50MB
>>>
>>> I'd use 500 MB or so if RabbitMQ is the primary thing that runs on the
>>> machine.
>>>
>>> > 3) Memory to used , right now its default 40%
>>>
>>> Can be up to 90%, again, depending on what else may run on the same
>>> machine.
>>>
>>>
>>> > 6) any disk space limitation on the hosts
>>>
>>> Host is this different from 2) above?
>>>
>>> > For HA , we are using ha-mode all to duplicate the queues across
>>> > all nodes in the cluster. Do you think its reliable during the
>>> > failover scenario ?During the failover it would like 100k queues
>>> > on nthe new master? Or should we use ha-mode = exactly/nodes ?
>>>
>>> With 3 nodes ha-mode=all is a reasonable amount of duplication. If you
>>> are confident
>>> you will never lose more than 1 node at a time, use ha-mode=exactly with
>>> 2 nodes.
>>> Less duplication means better throughput.
>>>
>>> As to how well new master election will work with 100K queues, try it.
>>> --
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/1d2ea48a/attachment.html>

From loganathan.ms at gmail.com  Fri May  2 06:26:37 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Fri, 2 May 2014 10:56:37 +0530
Subject: [rabbitmq-discuss] RabbitMQ CLIENT LOAD BALANCING IN RUBY/ROR
Message-ID: <CAD_i5MGbkfqfFqE2KAQphBn-Qg2Y_x-WjNp4uLMuMSN+xrudvw@mail.gmail.com>

Hi All,

How can we set up load balancing for RabbitMq in ROR/RUBY(Client
application which listens & publishes messages to RabbitMq). I don't want
to loose any message from RabbitMq, if one of my application is down then I
need to make other application to consume & publish the messages to
RabbitMq. I assumed that HTTP load balancing wont make any sense with
RabbitMq since it uses AMQP protocol.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/2706effa/attachment.html>

From mrtndimitrov at gmail.com  Fri May  2 06:51:53 2014
From: mrtndimitrov at gmail.com (Martin Koroudjiev)
Date: Fri, 02 May 2014 08:51:53 +0300
Subject: [rabbitmq-discuss] Reusing a channel or creating new ones
In-Reply-To: <CAMcAHLXU7k9R07zOVJ+Ba06h96hdEwUBvAWU1TR8g6Fy3SyDPA@mail.gmail.com>
References: <5362D13D.2000606@gmail.com>
 <CAMcAHLXU7k9R07zOVJ+Ba06h96hdEwUBvAWU1TR8g6Fy3SyDPA@mail.gmail.com>
Message-ID: <53633279.9020801@gmail.com>

Thank you, Alvaro. I wonder why we then have both channels and
connections...

Martin

On 5/2/2014 3:17 AM, Alvaro Videla wrote:
> Hi,
>
> There's no need to open a new channel for every message published, in
> fact, it will be faster to use the same channel.
>
> About message acks, you have to send the acks on the same channel
> where the message where received, since the delivery tags of messages
> are scoped per channel.
>
> Regards,
>
> Alvaro
>
> On Fri, May 2, 2014 at 12:57 AM, Martin Koroudjiev
> <mrtndimitrov at gmail.com> wrote:
>> Hello,
>>
>> Should I reuse the channel when sending messages or create a new one for
>> each send operation? Do I keep it around while listening for messages
>> and acknowledging them with the old channel or should I create a new one
>> for the acknowledge operation?
>>
>> Thanks,
>>
>> Martin
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ngoc.tang at quant-edge.com  Fri May  2 07:35:15 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Thu, 1 May 2014 23:35:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <05b33fb1-1e8b-4b34-99b9-2aacb8095c18@googlegroups.com>

Dear Simon
I have use other way to convert usernames into DNs
-----------------

> {rabbitmq_auth_backend_ldap,
> [ {servers, ["openldap.com"]},
> {user_dn_pattern, "cn=${username},dc=openldap,dc=com"},
> {dn_lookup_base, "dc=openldap,dc=com"},
> {other_bind, 
> {"cn=manager,cn=internal,dc=openldap,dc=com","Ad09DSJwidjdwf89D"}},
> {use_ssl, false},
> {port, 389},
> {log, network},
> {tag_queries, [{administrator, {constant, true}},
> {management, {constant, true}}]}
> ]
> }

---------------------
I am try to login, And this is the log file
------

> Server startup complete; 10 plugins started.
> * amqp_client
> * eldap
> * mochiweb
> * rabbitmq_auth_backend_ldap
> * rabbitmq_auth_mechanism_ssl
> * rabbitmq_federation_management
> * rabbitmq_management
> * rabbitmq_management_agent
> * rabbitmq_web_dispatch
> * webmachine =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP CHECK: login for ngoc.tang =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP filling template "cn=${username},dc=openldap,dc=com" with
> [{username,<<"ngoc.tang">>}] =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP template result: "cn=ngoc.tang,dc=openldap,dc=com" =INFO REPORT==== 
> 2-May-2014::13:28:41 ===
> LDAP connecting to servers: ["openldap.com"] =INFO REPORT==== 
> 2-May-2014::13:28:41 ===
> LDAP network traffic: bind request = {'BindRequest',3,
> "cn=ngoc.tang,dc=openldap,dc=com",
> {simple,<<"Pa$$w0rd">>}} =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP network traffic: bind reply = {ok,
> {'LDAPMessage',1,
> {bindResponse,
> {'BindResponse',invalidCredentials,
> [],[],asn1_NOVALUE,asn1_NOVALUE}},
> asn1_NOVALUE}} =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP bind returned "invalid credentials": cn=ngoc.tang,dc=openldap,dc=com =INFO 
> REPORT==== 2-May-2014::13:28:41 ===
> LDAP DECISION: login for ngoc.tang: denied =ERROR REPORT==== 
> 2-May-2014::13:28:41 ===
> webmachine error: path="/api/whoami"
> "Unauthorized"


----
I have try to resolve this problem, but isn't result
Thanks & Best Regards
Ngoc Tang 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/b4c17d3c/attachment.html>

From ngoc.tang at quant-edge.com  Fri May  2 07:35:15 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Thu, 1 May 2014 23:35:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <05b33fb1-1e8b-4b34-99b9-2aacb8095c18@googlegroups.com>

Dear Simon
I have use other way to convert usernames into DNs
-----------------

> {rabbitmq_auth_backend_ldap,
> [ {servers, ["openldap.com"]},
> {user_dn_pattern, "cn=${username},dc=openldap,dc=com"},
> {dn_lookup_base, "dc=openldap,dc=com"},
> {other_bind, 
> {"cn=manager,cn=internal,dc=openldap,dc=com","Ad09DSJwidjdwf89D"}},
> {use_ssl, false},
> {port, 389},
> {log, network},
> {tag_queries, [{administrator, {constant, true}},
> {management, {constant, true}}]}
> ]
> }

---------------------
I am try to login, And this is the log file
------

> Server startup complete; 10 plugins started.
> * amqp_client
> * eldap
> * mochiweb
> * rabbitmq_auth_backend_ldap
> * rabbitmq_auth_mechanism_ssl
> * rabbitmq_federation_management
> * rabbitmq_management
> * rabbitmq_management_agent
> * rabbitmq_web_dispatch
> * webmachine =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP CHECK: login for ngoc.tang =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP filling template "cn=${username},dc=openldap,dc=com" with
> [{username,<<"ngoc.tang">>}] =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP template result: "cn=ngoc.tang,dc=openldap,dc=com" =INFO REPORT==== 
> 2-May-2014::13:28:41 ===
> LDAP connecting to servers: ["openldap.com"] =INFO REPORT==== 
> 2-May-2014::13:28:41 ===
> LDAP network traffic: bind request = {'BindRequest',3,
> "cn=ngoc.tang,dc=openldap,dc=com",
> {simple,<<"Pa$$w0rd">>}} =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP network traffic: bind reply = {ok,
> {'LDAPMessage',1,
> {bindResponse,
> {'BindResponse',invalidCredentials,
> [],[],asn1_NOVALUE,asn1_NOVALUE}},
> asn1_NOVALUE}} =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP bind returned "invalid credentials": cn=ngoc.tang,dc=openldap,dc=com =INFO 
> REPORT==== 2-May-2014::13:28:41 ===
> LDAP DECISION: login for ngoc.tang: denied =ERROR REPORT==== 
> 2-May-2014::13:28:41 ===
> webmachine error: path="/api/whoami"
> "Unauthorized"


----
I have try to resolve this problem, but isn't result
Thanks & Best Regards
Ngoc Tang 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/b4c17d3c/attachment-0001.html>

From johnmeier.utah at gmail.com  Thu May  1 18:33:15 2014
From: johnmeier.utah at gmail.com (John Meier)
Date: Thu, 1 May 2014 11:33:15 -0600
Subject: [rabbitmq-discuss] Syslog
Message-ID: <CAGzaBa5nfxNKy7s7q73VY0joQ4gR0nVqwsEgHdQ+iGH+0YKC9A@mail.gmail.com>

Hello,

There was a thread on the discuss list about a year ago about ways to
direct rabbitmq broker logs to syslog, with the conclusion at the time that
there was no way within rabbitmq itself to configure that behavior.  Have
there been any changes or plugins released since then that might allow the
logging destination to be configured to syslog within the broker?

Thanks,
John M
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/ade3b88a/attachment.html>

From SoderquistMV at ldschurch.org  Thu May  1 20:04:40 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Thu, 1 May 2014 19:04:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>

We are trying to connect Rabbit with our Active Directory LDAP server but still have not found the right configuration. Let me give you the use case:

We want to be able to authenticate administrative users against LDAP for the management console. Our LDAP server is ldschurch.org. We are required to authenticate using the svc-ldap account before making queries. We have tried several different configuration options but nothing has worked so far. Here is the configuration we thought most likely to work:

[
  {rabbit, [{auth_backends, [rabbit_auth_backend_ldap, rabbit_auth_backend_internal]}]},
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["ldschurch.org"]},
     {dn_lookup_bind,        {"cn=svc-ldap,ou=srv-app-accts,dc=ldschurch,dc=org", "password"}},
     {dn_lookup_base,        "dc=ldschurch,dc=org"},
     {dn_lookup_attribute,   "cn"},
     {use_ssl,               false},
     {port,                  389},
     {log,                   false}
   ]
  }
].

We can tell by watching the TCP traffic that the bind user is not part of the request, only the authenticating user, which is admmvs1 in our situation.

Here is the log output:
=INFO REPORT==== 1-May-2014::11:22:29 ===
LDAP CHECK: login for admmvs1

=INFO REPORT==== 1-May-2014::11:22:29 ===
        LDAP filling template "${username}" with
            [{username,<<"admmvs1">>}]

=INFO REPORT==== 1-May-2014::11:22:29 ===
        LDAP template result: "admmvs1"

=INFO REPORT==== 1-May-2014::11:22:29 ===
    LDAP bind returned "invalid credentials": admmvs1

=INFO REPORT==== 1-May-2014::11:22:29 ===
LDAP DECISION: login for admmvs1: denied

What did we do wrong in our configuration?


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140501/125f4290/attachment.html>

From simon at rabbitmq.com  Fri May  2 08:46:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 May 2014 08:46:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
 ????
In-Reply-To: <05b33fb1-1e8b-4b34-99b9-2aacb8095c18@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
 <05b33fb1-1e8b-4b34-99b9-2aacb8095c18@googlegroups.com>
Message-ID: <53634D66.4050207@rabbitmq.com>

On 02/05/2014 07:35, Ng?c T?ng V?n wrote:
> =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP bind returned "invalid credentials":
> cn=ngoc.tang,dc=openldap,dc=com
> =INFO REPORT==== 2-May-2014::13:28:41 ===
> LDAP DECISION: login for ngoc.tang: denied

So the plugin is being told the LDAP login is refused, and is refusing 
AMQP login in return.

Cheers, Simon

From simon at rabbitmq.com  Fri May  2 08:48:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 May 2014 08:48:45 +0100
Subject: [rabbitmq-discuss] Trying to implement RPC between Erlang and
 Java clients
In-Reply-To: <5362A3B1.2030902@gmail.com>
References: <5362A3B1.2030902@gmail.com>
Message-ID: <53634DDD.9090305@rabbitmq.com>

On 01/05/2014 20:42, Martin Koroudjiev wrote:
> ** Reason for termination ==
> ** {noproc,{gen_server,call,[<0.143.0>,{close,200,<<"Goodbye">>},infinity]}}

In other words, your gen_server tried to call into its channel, but 
found it had already closed normally. Something else in your system will 
be closing it.

Cheers, Simon

From simon at rabbitmq.com  Fri May  2 08:52:50 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 May 2014 08:52:50 +0100
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <CAGzaBa5nfxNKy7s7q73VY0joQ4gR0nVqwsEgHdQ+iGH+0YKC9A@mail.gmail.com>
References: <CAGzaBa5nfxNKy7s7q73VY0joQ4gR0nVqwsEgHdQ+iGH+0YKC9A@mail.gmail.com>
Message-ID: <53634ED2.3020208@rabbitmq.com>

On 01/05/2014 18:33, John Meier wrote:
> There was a thread on the discuss list about a year ago about ways to
> direct rabbitmq broker logs to syslog, with the conclusion at the time
> that there was no way within rabbitmq itself to configure that behavior.
>   Have there been any changes or plugins released since then that might
> allow the logging destination to be configured to syslog within the broker?

You might be able to use Basho's lager logging framework:

https://github.com/basho/lager

which is available as a plugin for RabbitMQ:

http://www.rabbitmq.com/community-plugins.html#logging

but you'd need to add lager_syslog:

https://github.com/basho/lager_syslog

which is not available pre-compiled for RabbitMQ.

I don't know if anyone has actually done this, but it stands a 
reasonable chance of working.

Cheers, Simon


From arunrao.seattle at gmail.com  Fri May  2 08:54:45 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 2 May 2014 00:54:45 -0700
Subject: [rabbitmq-discuss] Memory Usage in Management API
Message-ID: <CAEJg2GBxrob16E-FDj_maWjoGpjxi7oDFMuEUgvZvjSqGtRtTQ@mail.gmail.com>

Hello -

Can someone please clarify the following:

1. Memory Usage (by node) shown in Management API: Sum of total_heap_size
of all registered processes (including rabbit_mgmt_agent_sup,
rabbit_mgmt_sup etc.,)?

2. Where does virtual hosts/exchanges/queues live? Everything related to
rabbitmq amqp server functionality is on "rabbit" erlang process?

3. Has anyone had success with erlang:trace? I am trying the following but
couldnt get this to work:

rabbitmqctl eval
'PID=erlang:whereis(rabbit),erlang:trace(PID,gc_start,info).'

Thanks for your help!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/b549dfd4/attachment.html>

From simon at rabbitmq.com  Fri May  2 09:03:05 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 May 2014 09:03:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
In-Reply-To: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>
Message-ID: <53635139.8020807@rabbitmq.com>

On 01/05/2014 20:04, Mark Soderquist wrote:
> We are
> required to authenticate using the svc-ldap account before making
> queries.

Just to be clear, are you saying that you want to bind first with 
svc-ldap to look up a user's DN, before binding with their credentials 
(which is supported) or that you want to only ever bind with svc-ldap 
and never with the user's creds (which is not)?

> We have tried several different configuration options but
> nothing has worked so far. Here is the configuration we thought most
> likely to work:

<snip>

If you are going for the former choice, that should work. However, from 
your log it looks like dn_lookup_bind is being ignored. dn_lookup_bind 
is new in RabbitMQ 3.3.0, so are you using an earlier version?

Cheers, Simon


From ngoc.tang at quant-edge.com  Fri May  2 09:04:02 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Fri, 2 May 2014 01:04:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <28b1a711-b4cf-4c02-a7ec-bd566cb51c6a@googlegroups.com>


>
> So the plugin is being told the LDAP login is refused, and is refusing 
> AMQP login in return.
>
>  
>
> Cheers, Simon
>

What does this mean, Simon ?
I don't understand it. 

Thanks & Best Regards
Ngoc Tang 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/de6b856d/attachment.html>

From ngoc.tang at quant-edge.com  Fri May  2 09:04:02 2014
From: ngoc.tang at quant-edge.com (=?UTF-8?Q?Ng=E1=BB=8Dc_T=C4=83ng_V=C4=83n?=)
Date: Fri, 2 May 2014 01:04:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 doesn't working with OpenLDAP
	????
In-Reply-To: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
References: <a9870bc1-3999-4e32-881f-1e90525d8b43@googlegroups.com>
Message-ID: <28b1a711-b4cf-4c02-a7ec-bd566cb51c6a@googlegroups.com>


>
> So the plugin is being told the LDAP login is refused, and is refusing 
> AMQP login in return.
>
>  
>
> Cheers, Simon
>

What does this mean, Simon ?
I don't understand it. 

Thanks & Best Regards
Ngoc Tang 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/de6b856d/attachment-0001.html>

From simon at rabbitmq.com  Fri May  2 09:21:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 May 2014 09:21:43 +0100
Subject: [rabbitmq-discuss] Memory Usage in Management API
In-Reply-To: <CAEJg2GBxrob16E-FDj_maWjoGpjxi7oDFMuEUgvZvjSqGtRtTQ@mail.gmail.com>
References: <CAEJg2GBxrob16E-FDj_maWjoGpjxi7oDFMuEUgvZvjSqGtRtTQ@mail.gmail.com>
Message-ID: <53635597.8000209@rabbitmq.com>

These are rather general questions, so it would help a great deal if I 
knew what you were trying to do.

On 02/05/2014 08:54, Arun Rao wrote:
> Can someone please clarify the following:
>
> 1. Memory Usage (by node) shown in Management API: Sum of
> total_heap_size of all registered processes (including
> rabbit_mgmt_agent_sup, rabbit_mgmt_sup etc.,)?

The memory use per node is that reported by erlang:memory(total). This 
includes all processes, registered and unregistered as well as all 
binaries, atoms, ETS tables, code and so on. It's supposed to correspond 
to how much memory is used at the OS level. Sadly in practice it doesn't 
take account of memory fragmentation so it can differ, but it's the 
closest thing Erlang gives us.

> 2. Where does virtual hosts/exchanges/queues live? Everything related to
> rabbitmq amqp server functionality is on "rabbit" erlang process?

No, not at all. That process is the top of the tree but there are many 
others. All the objects (i.e. vhosts, exchanges, queues and so on) exist 
as records in Mnesia / ETS tables, and queues also exist as processes.

> 3. Has anyone had success with erlang:trace? I am trying the following
> but couldnt get this to work:
>
> rabbitmqctl eval
> 'PID=erlang:whereis(rabbit),erlang:trace(PID,gc_start,info).'

Well, the second argument to trace/3 is a boolean, and the third is a 
list of flags, of which 'info' is not one. But trace/3 is very low 
level. You probably want to use the debugger instead?

Cheers, Simon

From pranjal4uyar at gmail.com  Fri May  2 12:09:00 2014
From: pranjal4uyar at gmail.com (Pranjal Jaju)
Date: Fri, 2 May 2014 04:09:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Is there any timeout we can specify for queue to
	exchange binding
Message-ID: <901dfec1-4f72-4332-ba93-8c25753ae0b9@googlegroups.com>

I want to auto time out for queue to exchange bindings. is this possible 
using native rabbitmq API's
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/7e3c61e5/attachment.html>

From SoderquistMV at ldschurch.org  Fri May  2 14:11:28 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Fri, 2 May 2014 13:11:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
In-Reply-To: <53635139.8020807@rabbitmq.com>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>
 <53635139.8020807@rabbitmq.com>
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39ABC81E@W12112.ldschurch.org>

We definitely need to bind first with svc-ldap, I'm not sure yet whether we bind with the user credentials or just do a lookup. I have to figure that one out.

We currently have 3.2.4 installed so that makes sense why dn_lookup_bind is not working as expected. We'll update to the latest and give that a try.

Mark

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, May 02, 2014 2:03 AM
To: Discussions about RabbitMQ; Mark Soderquist
Subject: Re: [rabbitmq-discuss] RabbitMQ LDAP Configuration

On 01/05/2014 20:04, Mark Soderquist wrote:
> We are
> required to authenticate using the svc-ldap account before making 
> queries.

Just to be clear, are you saying that you want to bind first with svc-ldap to look up a user's DN, before binding with their credentials (which is supported) or that you want to only ever bind with svc-ldap and never with the user's creds (which is not)?

> We have tried several different configuration options but nothing has 
> worked so far. Here is the configuration we thought most likely to 
> work:

<snip>

If you are going for the former choice, that should work. However, from your log it looks like dn_lookup_bind is being ignored. dn_lookup_bind is new in RabbitMQ 3.3.0, so are you using an earlier version?

Cheers, Simon


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.


From mcintoshj at gmail.com  Fri May  2 14:22:21 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 2 May 2014 08:22:21 -0500
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
In-Reply-To: <CDC7045479A93A4FB2E32D4B83A22B5F39ABC81E@W12112.ldschurch.org>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>
 <53635139.8020807@rabbitmq.com>
 <CDC7045479A93A4FB2E32D4B83A22B5F39ABC81E@W12112.ldschurch.org>
Message-ID: <CAD6m6fGmoqBTRYv=sauhqYT7m5NONofAH37PEMuSZBMQOYyzKA@mail.gmail.com>

On Active Directory - the only way to do authentication is by bind
authentication.  Authorization of course is a different discussion.  AD
doesn't give you direct access to the passwords for users via ldap.

Jason


On Fri, May 2, 2014 at 8:11 AM, Mark Soderquist
<SoderquistMV at ldschurch.org>wrote:

> We definitely need to bind first with svc-ldap, I'm not sure yet whether
> we bind with the user credentials or just do a lookup. I have to figure
> that one out.
>
> We currently have 3.2.4 installed so that makes sense why dn_lookup_bind
> is not working as expected. We'll update to the latest and give that a try.
>
> Mark
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Friday, May 02, 2014 2:03 AM
> To: Discussions about RabbitMQ; Mark Soderquist
> Subject: Re: [rabbitmq-discuss] RabbitMQ LDAP Configuration
>
> On 01/05/2014 20:04, Mark Soderquist wrote:
> > We are
> > required to authenticate using the svc-ldap account before making
> > queries.
>
> Just to be clear, are you saying that you want to bind first with svc-ldap
> to look up a user's DN, before binding with their credentials (which is
> supported) or that you want to only ever bind with svc-ldap and never with
> the user's creds (which is not)?
>
> > We have tried several different configuration options but nothing has
> > worked so far. Here is the configuration we thought most likely to
> > work:
>
> <snip>
>
> If you are going for the former choice, that should work. However, from
> your log it looks like dn_lookup_bind is being ignored. dn_lookup_bind is
> new in RabbitMQ 3.3.0, so are you using an earlier version?
>
> Cheers, Simon
>
>
>  NOTICE: This email message is for the sole use of the intended
> recipient(s) and may contain confidential and privileged information. Any
> unauthorized review, use, disclosure or distribution is prohibited. If you
> are not the intended recipient, please contact the sender by reply email
> and destroy all copies of the original message.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/19034559/attachment.html>

From SoderquistMV at ldschurch.org  Fri May  2 14:32:46 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Fri, 2 May 2014 13:32:46 +0000
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
In-Reply-To: <CAD6m6fGmoqBTRYv=sauhqYT7m5NONofAH37PEMuSZBMQOYyzKA@mail.gmail.com>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39ABBD77@W12112.ldschurch.org>
 <53635139.8020807@rabbitmq.com>
 <CDC7045479A93A4FB2E32D4B83A22B5F39ABC81E@W12112.ldschurch.org>
 <CAD6m6fGmoqBTRYv=sauhqYT7m5NONofAH37PEMuSZBMQOYyzKA@mail.gmail.com>
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39ABC8C1@W12112.ldschurch.org>

We upgraded to 3.3.0 and it is working now with dn_lookup_bind. We bind first with svc-ldap and then bind as the user.

Thank you for the assistance.

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jason McIntosh
Sent: Friday, May 02, 2014 7:22 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ LDAP Configuration

On Active Directory - the only way to do authentication is by bind authentication.  Authorization of course is a different discussion.  AD doesn't give you direct access to the passwords for users via ldap.

Jason

On Fri, May 2, 2014 at 8:11 AM, Mark Soderquist <SoderquistMV at ldschurch.org<mailto:SoderquistMV at ldschurch.org>> wrote:
We definitely need to bind first with svc-ldap, I'm not sure yet whether we bind with the user credentials or just do a lookup. I have to figure that one out.

We currently have 3.2.4 installed so that makes sense why dn_lookup_bind is not working as expected. We'll update to the latest and give that a try.

Mark

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com<mailto:simon at rabbitmq.com>]
Sent: Friday, May 02, 2014 2:03 AM
To: Discussions about RabbitMQ; Mark Soderquist
Subject: Re: [rabbitmq-discuss] RabbitMQ LDAP Configuration

On 01/05/2014 20:04, Mark Soderquist wrote:
> We are
> required to authenticate using the svc-ldap account before making
> queries.

Just to be clear, are you saying that you want to bind first with svc-ldap to look up a user's DN, before binding with their credentials (which is supported) or that you want to only ever bind with svc-ldap and never with the user's creds (which is not)?

> We have tried several different configuration options but nothing has
> worked so far. Here is the configuration we thought most likely to
> work:

<snip>

If you are going for the former choice, that should work. However, from your log it looks like dn_lookup_bind is being ignored. dn_lookup_bind is new in RabbitMQ 3.3.0, so are you using an earlier version?

Cheers, Simon

 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=wlPCrglRP6kzT4RbABWMaw%3D%3D%0A&r=x%2BoSSw1f95Au%2BZ5GVcjhyy%2BZIjVIfBi1eHMAQKueqpE%3D%0A&m=SHF9jdT6LhyH%2B15mY2Nq4G361dnX4VWvrzpDBHsGsWg%3D%0A&s=76abe78b7bf4c29713761810bfecc6515c7b171d06022c325fdb2c1913da30d4>



--
Jason McIntosh
https://github.com/jasonmcintosh/<https://urldefense.proofpoint.com/v1/url?u=https://github.com/jasonmcintosh/&k=wlPCrglRP6kzT4RbABWMaw%3D%3D%0A&r=x%2BoSSw1f95Au%2BZ5GVcjhyy%2BZIjVIfBi1eHMAQKueqpE%3D%0A&m=SHF9jdT6LhyH%2B15mY2Nq4G361dnX4VWvrzpDBHsGsWg%3D%0A&s=05cd5c03421a13cd0f248384b6192e568b9c4c1cf6c0216a2e930dfcb5f99cf0>
573-424-7612


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/06bec742/attachment.html>

From michael at rabbitmq.com  Fri May  2 14:32:53 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 2 May 2014 09:32:53 -0400
Subject: [rabbitmq-discuss] Is there any timeout we can specify for
	queue to exchange binding
In-Reply-To: <901dfec1-4f72-4332-ba93-8c25753ae0b9@googlegroups.com>
References: <901dfec1-4f72-4332-ba93-8c25753ae0b9@googlegroups.com>
Message-ID: <2C183532-CE1A-4B22-B40E-0A8871D6036A@rabbitmq.com>

Can you be more specific? There are no timeouts related to bindings in the protocol.

MK

> On 02/05/2014, at 07:09, Pranjal Jaju <pranjal4uyar at gmail.com> wrote:
> 
> I want to auto time out for queue to exchange bindings. is this possible using native rabbitmq API's
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael at rabbitmq.com  Fri May  2 14:34:12 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 2 May 2014 09:34:12 -0400
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
Message-ID: <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>

I would still start with 2 disk nodes.

MK

> On 01/05/2014, at 23:33, srikanth tns <srikanthtns at gmail.com> wrote:
> 
> Thanks Micheal , we use mcollective application for publishing the requests to target nodes and receive the response from the consumers to validate if the command was successful or not . In this case , should we use 1 RAM node 2 DISC nodes ?
> 
> 
>> On Thu, May 1, 2014 at 5:32 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>> Unless you mostly do request-reply workloads, just use disk nodes.
>> 
>> MK
>> 
>>> On 01/05/2014, at 15:26, srikanth tns <srikanthtns at gmail.com> wrote:
>>> 
>>> Also , we are trying to use 2DISC 1RAM in the cluster . Is this good enough ? Also which node should be set as RAM , is there any preference to set only a particular node the cluster to be RAM ?
>>> 
>>> Thanks
>>> Srikanth
>>> 
>>> 
>>>> On Wed, Apr 30, 2014 at 1:48 PM, srikanth tns <srikanthtns at gmail.com> wrote:
>>>> Thanks Micheal , here is the settings we are doing on rabbitmq cluster
>>>> 
>>>> {rabbit, [{vm_memory_high_watermark_paging_ratio, 0.8},{vm_memory_high_watermark, 0.9},{disk_free_limit, 1000000000}]}
>>>> 
>>>> Apart from this ,is there any QoS value that we need to set ?
>>>> 
>>>> 
>>>>> On Tue, Apr 29, 2014 at 1:13 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
>>>>> 
>>>>> 
>>>>> On 29 April 2014 at 07:22:03, srikanth tns (srikanthtns at gmail.com) wrote:
>>>>> > > Can you let us know what would be optimal settings on rabbitmq
>>>>> > cluster to prevent it from crashing and having reliable messaging?
>>>>> 
>>>>> It's really hard to make general recommendations without knowing what
>>>>> kind of workload you use.
>>>>> 
>>>>> > 1) sysctl configurations
>>>>> 
>>>>> nlimit > 20,000 or so (definitely can't be less than ~ 6K)
>>>>> 
>>>>> > 2) Disk limitations to setup on cluster . the default is 50MB
>>>>> 
>>>>> I'd use 500 MB or so if RabbitMQ is the primary thing that runs on the machine.
>>>>> 
>>>>> > 3) Memory to used , right now its default 40%
>>>>> 
>>>>> Can be up to 90%, again, depending on what else may run on the same machine.
>>>>> 
>>>>> 
>>>>> > 6) any disk space limitation on the hosts
>>>>> 
>>>>> Host is this different from 2) above?
>>>>> 
>>>>> > For HA , we are using ha-mode all to duplicate the queues across
>>>>> > all nodes in the cluster. Do you think its reliable during the
>>>>> > failover scenario ?During the failover it would like 100k queues
>>>>> > on nthe new master? Or should we use ha-mode = exactly/nodes ?
>>>>> 
>>>>> With 3 nodes ha-mode=all is a reasonable amount of duplication. If you are confident
>>>>> you will never lose more than 1 node at a time, use ha-mode=exactly with 2 nodes.
>>>>> Less duplication means better throughput.
>>>>> 
>>>>> As to how well new master election will work with 100K queues, try it. 
>>>>> --
>>>>> MK
>>>>> 
>>>>> Software Engineer, Pivotal/RabbitMQ
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/aa8ab79b/attachment.html>

From michael at rabbitmq.com  Fri May  2 14:35:59 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Fri, 2 May 2014 09:35:59 -0400
Subject: [rabbitmq-discuss] RabbitMQ CLIENT LOAD BALANCING IN RUBY/ROR
In-Reply-To: <CAD_i5MGbkfqfFqE2KAQphBn-Qg2Y_x-WjNp4uLMuMSN+xrudvw@mail.gmail.com>
References: <CAD_i5MGbkfqfFqE2KAQphBn-Qg2Y_x-WjNp4uLMuMSN+xrudvw@mail.gmail.com>
Message-ID: <59FA1643-17D9-4886-81D8-FA192CF39610@rabbitmq.com>

Use a proxy in front of a cluster and publisher confirms. The proxy can even be local to the client machine.

MK

> On 02/05/2014, at 01:26, Loganathan Sellapa <loganathan.ms at gmail.com> wrote:
> 
> Hi All, 
> 
> How can we set up load balancing for RabbitMq in ROR/RUBY(Client application which listens & publishes messages to RabbitMq). I don't want to loose any message from RabbitMq, if one of my application is down then I need to make other application to consume & publish the messages to RabbitMq. I assumed that HTTP load balancing wont make any sense with RabbitMq since it uses AMQP protocol.
> 
> regards,
> Loganathan
> Mob: +91 7760780741 | +91 9944414388
> Skype: loganathan.sellappa
> ViewMe
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/b29d9e10/attachment.html>

From matthias at rabbitmq.com  Fri May  2 14:41:59 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 14:41:59 +0100
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
 <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
Message-ID: <5363A0A7.9030901@rabbitmq.com>

On 02/05/14 14:34, Michael Klishin wrote:
> I would still start with 2 disk nodes.

...and I wouldn't touch the memory watermark settings unless 
experimentation shows that even in extreme usage scenarios memory is 
underutilised.

Matthias.

From pompermaier at okkam.it  Fri May  2 14:43:21 2014
From: pompermaier at okkam.it (Flavio Pompermaier)
Date: Fri, 2 May 2014 06:43:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue consumers deployment and monitoring
Message-ID: <d0b22b4a-b439-47a4-832d-99144b4434f8@googlegroups.com>

Hi to everybody,
in my experience with RabbitMQ everything is nice apart from the consumers 
deployment and monitoring.

If I have to add a new consumers I have to go to a shell on a server, run a 
standalone java app and I have to invent how to query its status.
Is there any standard way of doing this? Celery seems to be a solution for 
this but I just heard today about it and it's python-oriented (or not 
java-friendly).

Any suggestion?

Best,
Flavio

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/789cae80/attachment.html>

From mcintoshj at gmail.com  Fri May  2 14:49:04 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 2 May 2014 08:49:04 -0500
Subject: [rabbitmq-discuss] Queue consumers deployment and monitoring
In-Reply-To: <d0b22b4a-b439-47a4-832d-99144b4434f8@googlegroups.com>
References: <d0b22b4a-b439-47a4-832d-99144b4434f8@googlegroups.com>
Message-ID: <CAD6m6fHGJx0g8=dGbAS3df9xK+Agi6jEwZbdC7V9fpuvAhwPqg@mail.gmail.com>

Monitoring RabbitMQ is a whole different discussion usually.  If you're
interested, I've got monitoring plugins for Zabbix here (I also had some
for Nagios):
Zabbix:  https://github.com/jasonmcintosh/rabbitmq-zabbix
Nagios:  https://github.com/jasonmcintosh/rabbitmq-nagios-plugins

Jason


On Fri, May 2, 2014 at 8:43 AM, Flavio Pompermaier <pompermaier at okkam.it>wrote:

> Hi to everybody,
> in my experience with RabbitMQ everything is nice apart from the consumers
> deployment and monitoring.
>
> If I have to add a new consumers I have to go to a shell on a server, run
> a standalone java app and I have to invent how to query its status.
> Is there any standard way of doing this? Celery seems to be a solution for
> this but I just heard today about it and it's python-oriented (or not
> java-friendly).
>
> Any suggestion?
>
> Best,
> Flavio
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/31500056/attachment.html>

From matthias at rabbitmq.com  Fri May  2 14:49:55 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 14:49:55 +0100
Subject: [rabbitmq-discuss] Error report explanation
In-Reply-To: <1398783931040-35203.post@n5.nabble.com>
References: <1398783931040-35203.post@n5.nabble.com>
Message-ID: <5363A283.3060102@rabbitmq.com>

On 29/04/14 16:05, carlhoerberg wrote:
> Had some server crashes, got these error msgs in the log:
>
> =ERROR REPORT==== 19-Apr-2014::00:47:50 ===
> webmachine error: path="/api/nodes/rabbit at node01"
> {error,badarg,
>         [{ets,lookup,[rabbit_user,<<"admin">>],[]},
>          {rabbit_misc,dirty_read,1,[]},
>          {rabbit_auth_backend_internal,internal_check_user_login,2,[]},
>          {rabbit_access_control,try_login,3,[]},
>          {lists,foldl,3,[{file,"lists.erl"},{line,1261}]},
>          {rabbit_access_control,check_user_login,2,[]},
>          {rabbit_mgmt_util,is_authorized,6,[]},
>          {webmachine_resource,resource_call,3,[]}]}
>
>
> =ERROR REPORT==== 19-Apr-2014::00:48:32 ===
> ** Generic server rabbit_error_logger_lifecycle terminating
> ** Last message in was {'EXIT',<0.157.0>,shutdown}
> ** When Server state == {rabbit_error_logger,stop,[]}
> ** Reason for termination ==
> ** {{badmatch,{error,module_not_found}},
>      [{rabbit_error_logger,stop,0,[]},
>       {supervised_lifecycle,terminate,2,[]},
>       {gen_server,terminate,6,[{file,"gen_server.erl"},{line,721}]},
>       {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}
>
> Possible to say what might have gone wrong?

Both of these look like errors you might get in a half-dead rabbit. Is 
there anything in the logs before those?

Matthias.


From matthias at rabbitmq.com  Fri May  2 14:51:49 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 14:51:49 +0100
Subject: [rabbitmq-discuss] Failure to Connect RabbitMQ/Celery across
 two EC2 instances
In-Reply-To: <5023f150-c7c2-4fec-a2a7-eafc94b56518@googlegroups.com>
References: <5023f150-c7c2-4fec-a2a7-eafc94b56518@googlegroups.com>
Message-ID: <5363A2F5.1010007@rabbitmq.com>

On 29/04/14 23:57, JD wrote:
>     I keep getting:`*ERROR/MainProcess] consumer: Cannot connect to
>     amqp://ec2celeryuser*` when I run `celery -A tasks worker` on terminal.
>
>
> Basically what I'm trying to do is get celery/rabbitmq working properly
> across (2) ec2 instances.

You may want to ask your question on 
https://groups.google.com/forum/#!forum/celery-users

Matthias.

From mcintoshj at gmail.com  Fri May  2 14:55:10 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 2 May 2014 08:55:10 -0500
Subject: [rabbitmq-discuss] Queue consumers deployment and monitoring
In-Reply-To: <CAD6m6fHGJx0g8=dGbAS3df9xK+Agi6jEwZbdC7V9fpuvAhwPqg@mail.gmail.com>
References: <d0b22b4a-b439-47a4-832d-99144b4434f8@googlegroups.com>
 <CAD6m6fHGJx0g8=dGbAS3df9xK+Agi6jEwZbdC7V9fpuvAhwPqg@mail.gmail.com>
Message-ID: <CAD6m6fGwuOLVO+d4diOKsE8htjwJFToKiMhme=boBDiu5wJCuA@mail.gmail.com>

Oh some other things I've seen on consumer processes:

We have standard libraries to do the "main" method kinda stuff.  We
actually build RPM's to install consumers on dedicated rabbit consumer
servers.  You could just as easily though deploy to a web container as war
files with the init for the war setup to startup the consumers (gives you
benefits like connection pooling, but adds complexities too).  Monitoring
that consumer and how it's running is a more complicated question - on a
Java system, look at JMX.  I'd highly recommend the servo libraries by
Netflix to make JMX monitoring easy.

Thinking of JMX, I think I'm going to play with some of the Rabbit
libraries and see if I build a patch to add some of those JMX metrics.
 Good project for my spare time!  But you could add this stuff to your
consumer code independent of the core rabbit libraries.

Jason




On Fri, May 2, 2014 at 8:49 AM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Monitoring RabbitMQ is a whole different discussion usually.  If you're
> interested, I've got monitoring plugins for Zabbix here (I also had some
> for Nagios):
> Zabbix:  https://github.com/jasonmcintosh/rabbitmq-zabbix
> Nagios:  https://github.com/jasonmcintosh/rabbitmq-nagios-plugins
>
> Jason
>
>
> On Fri, May 2, 2014 at 8:43 AM, Flavio Pompermaier <pompermaier at okkam.it>wrote:
>
>> Hi to everybody,
>> in my experience with RabbitMQ everything is nice apart from the
>> consumers deployment and monitoring.
>>
>> If I have to add a new consumers I have to go to a shell on a server, run
>> a standalone java app and I have to invent how to query its status.
>> Is there any standard way of doing this? Celery seems to be a solution
>> for this but I just heard today about it and it's python-oriented (or not
>> java-friendly).
>>
>> Any suggestion?
>>
>> Best,
>> Flavio
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/c60e94a8/attachment.html>

From matthias at rabbitmq.com  Fri May  2 14:57:49 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 14:57:49 +0100
Subject: [rabbitmq-discuss] dynamic binding
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0187751B@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D01876F97@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <CADtU9_udUTyzyyAfPsv8FMumUEsgj8LfZy0G5OCQ+SJQLhi5ng@mail.gmail.com>
 <59BF56992750434F89F8EBE141E64B1D01877432@GAALPA1MSGUSR9C.ITServices.sbc.com>
 <CADtU9_ugPjQ2Mpj1pHvSJStzVm5JPqhPe+TXz2jmNUUGQsqphQ@mail.gmail.com>
 <59BF56992750434F89F8EBE141E64B1D0187751B@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <5363A45D.2080005@rabbitmq.com>

On 30/04/14 14:56, PATAR, SAGAR wrote:
> Just wondering what is the maximum number of binding Rabbit MQ supports
> and also does that depend on the resources like ram, disk space,
> processes rabbit mq is running

iirc bindings typically take up a 100-200 bytes of memory each (more if 
you have very long exchange, queue or vhost names, or binding keys). and 
similarly on disk space, if they are between durable resources.

Matthias.


From matthias at rabbitmq.com  Fri May  2 15:02:33 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 15:02:33 +0100
Subject: [rabbitmq-discuss] Frequent disconnection of rabbitmq
In-Reply-To: <CAD_i5MGk+oyfsUpfn5VWi-EYS6QkzLoDM5C_dxJcrFO1jm+-cA@mail.gmail.com>
References: <CAD_i5MFidHQhfs7Ra0H2WNf=5o6MgOgXUX7LQkh57ZzQ9tdW-Q@mail.gmail.com>
 <CAD_i5MGk+oyfsUpfn5VWi-EYS6QkzLoDM5C_dxJcrFO1jm+-cA@mail.gmail.com>
Message-ID: <5363A579.3020809@rabbitmq.com>

On 30/04/14 14:56, Loganathan Sellapa wrote:
> Yes Micheal, We are using the port 5671, and connecting over SSL. Do you
> know why we are getting this error.
>
> Also on another RMQ, when we communicate we see the same behaviour of
> connection getting disconnected. However the error there was
> ssl_upgrade_error,closed
>
> =ERROR REPORT==== 30-Apr-2014::12:01:29 ===
> error on AMQP connection <0.4491.3>: {ssl_upgrade_error,closed} (unknown
> POSIX error)

Both of these errors are often (but not always) an indication that the 
connecting client isn't speaking ssl.

I suggest you follow http://www.rabbitmq.com/troubleshooting-ssl.html to 
track down the problem.

Matthias.

From reparker23 at gmail.com  Fri May  2 15:15:37 2014
From: reparker23 at gmail.com (Robert Parker)
Date: Fri, 2 May 2014 07:15:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Reset Queues/Exchanges Only?
Message-ID: <baf4cfe0-cd9a-4c5e-90f5-45b79eda2545@googlegroups.com>

We are running rabbitmq 3.1.5 under Erlang R16B02.  We're running with 
2-node clusters where both consumers and producers are .NET services using 
either Borrow or MassTransit wrappers.  These services do ALL of the 
queue/exchange definition/initialization.  Periodically, we will have a 
code change where we will abandon certain queues and we will need to clean 
out all available queues on a cluster and have these services 
 re-initialize them.  The way we have been doing it is to take one node of 
the cluster and run:

node1# rabbitmqctl stop_app
node1# rabbitmqctl reset

However, when we do this for the purpose of simply cleaning out the unused 
old queues and exchanges, it also destroys the clustering config, HA policy 
config, and any local users we might have defined.

Is there an easy way to force the destruction of all the queues and 
exchanges on a rabbitmq cluster, but leave all other configurations 
(clustering, federation, shovel, users, policies) alone?  All I want to do 
is nuke all queues/exchanges and have the client services re-initialize 
them.  Having to re-setup all the other configs after doing a "rabbitmqctl 
reset" or "rabbitmqctl force_reset" is becoming cumbersome and a source of 
mistakes.  We're not interested in using the API from the consumer or 
publisher end to delete named individual queues/exchanges, we need a 
generic process that can be initiated as an administrative task from the 
rabbitmq server itself.

Thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/fd020129/attachment.html>

From matthias at rabbitmq.com  Fri May  2 15:19:29 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 15:19:29 +0100
Subject: [rabbitmq-discuss] Core Dump when /proc is not mounted (chroot)
In-Reply-To: <13002772-cda9-46c9-bd0e-aff6ff37ab30@googlegroups.com>
References: <13002772-cda9-46c9-bd0e-aff6ff37ab30@googlegroups.com>
Message-ID: <5363A971.3010601@rabbitmq.com>

On 30/04/14 16:43, Yanis Guenane wrote:
> Today I tried to install rabbitmq-server on a debian chroot running on
> fedora and it crashed during package installation.
>
> This was due to the fact that my chroot did not have its /proc mounted.
> [...]
> I was wondering if this situation could be improved, by checking if
> /proc is mounted else reporting that it should be mounted ?

Rabbit accesses /proc/meminfo to obtain total memory information so it 
can tune its memory monitoring and paging. I've filed a bug to make this 
more robust.

There should have been an error in the rabbit.log and rabbit-sasl.log 
files. Can you post that please? That way we can make sure that it was 
really the /proc/meminfo access that was the issue.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri May  2 15:35:00 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 May 2014 15:35:00 +0100
Subject: [rabbitmq-discuss] How to resolve this issue?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0475D@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB041B5@xmb-aln-x10.cisco.com>
 <405CBD98-FB34-48C0-A3A8-F99064296439@rabbitmq.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB0475D@xmb-aln-x10.cisco.com>
Message-ID: <5363AD14.1060405@rabbitmq.com>

On 01/05/14 22:50, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES 
INC at Cisco) wrote:
> I could consume other RabbitMQ APIs from my system.  Why I am facing
> problem with this alone?
>
> Telnet is working fine.  Management  Plugin is enabled to the IP address
> and port.

I think, as you observed in your original post, it looks like the URL 
gets mangled. This has nothing to do with rabbit; look at the stacktrace 
- none of the classes are in the com.rabbitmq namespace. I suggest you 
ask for help on the spring forums.

As Alvaro pointed out at 
http://rabbitmq.1065348.n5.nabble.com/Rest-services-to-get-messages-from-Queue-tp35277p35284.html 
though, you may want to use AMQP to retrieve the messages, not the 
management api.

Matthias.

From jluzuria2001 at gmail.com  Fri May  2 17:21:08 2014
From: jluzuria2001 at gmail.com (Jorg Eloy)
Date: Fri, 2 May 2014 09:21:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Heatbeat configuration
Message-ID: <3227c99f-ee70-480b-b0aa-9e173e288cf0@googlegroups.com>

Hi All,

a little question, In RabbitMQ, how I can change the heartbeat time in the 
broker configuration?
Or how I can make that the timeout expire and the heartbeat works closing 
the connection?

I have proved with SetRequestedHeartbeat in the declaration of the factory 
in the java client,
making a inactive connection but it's is not dropping and It's not closed.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/7365728c/attachment.html>

From mpietrek at skytap.com  Fri May  2 17:46:56 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 2 May 2014 09:46:56 -0700
Subject: [rabbitmq-discuss] Best way to live migrate RabbitMQ consumer
 load from one cluster to another
In-Reply-To: <CACLE7iz0A2U6TeHVv7-+dV+4Hj1AF=nzwWwomGsJs56+bB-osQ@mail.gmail.com>
References: <CACLE7iz0A2U6TeHVv7-+dV+4Hj1AF=nzwWwomGsJs56+bB-osQ@mail.gmail.com>
Message-ID: <CACLE7ixVyCaFHdF8-4cGhm4QLJi4jg6L3NA5t7RSmYz16EUC6Q@mail.gmail.com>

Pinging on this thread - No responses as of yet, and given other traffic
topics here, I'd think somebody would have some thoughts or opinions.

Thanks,

Matt


On Wed, Apr 30, 2014 at 10:49 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Apologies if this has been answered somewhere already, but my searching
> isn't turning up anything.
>
> I'm looking for advice on how to best move client traffic from one
> RabbitMQ cluster to another without service interruption. I suspect it can
> be done with HA-proxy, but I can't figure out the steps. I'm open to other
> ideas as well.
>
> Scenario: We have a 2-node cluster with all queues mirrored. Let's say
> it's running RabbitMQ 3.2.2. Clients connect to this cluster through a VIP
> maintained by keepalived on both RabbitMQ hosts.
>
> We now want to move to a different identical cluster, but running 3.3.1.
> I'm thinking I can bring up this new cluster "side-by-side" with the old
> cluster, such that they're running concurrently. All new connections would
> go to the new cluster, while already established connections to the 3.2.2
> cluster will remain alive and working, until all clients have eventually
> connected to the new cluster. At that point the 3.2.2 cluster can be shut
> down.
>
> I have a hunch I can put HA-proxy in front of both clusters, and though
> live configuration changes have it migrate the traffic to the new cluster
> while leaving existing cluster connections alone. What I don't know is the
> commands/configuration options/steps to implement it.
>
> Thoughts and guidance on how to best do this?
>
> Thanks,
>
> Matt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/7ba8a613/attachment.html>

From loganathan.ms at gmail.com  Fri May  2 19:51:54 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Sat, 3 May 2014 00:21:54 +0530
Subject: [rabbitmq-discuss] RabbitMQ CLIENT LOAD BALANCING IN RUBY/ROR
In-Reply-To: <CAD_i5MGbkfqfFqE2KAQphBn-Qg2Y_x-WjNp4uLMuMSN+xrudvw@mail.gmail.com>
References: <CAD_i5MGbkfqfFqE2KAQphBn-Qg2Y_x-WjNp4uLMuMSN+xrudvw@mail.gmail.com>
Message-ID: <CAD_i5MFFVC3XeWPaaK_Uc0t=H5OmwvEopDzpbc25wqm5aJpSWg@mail.gmail.com>

Hi All,

Implemented by setting up the two applications, and made the each
application to listen same queue & exchange.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Fri, May 2, 2014 at 10:56 AM, Loganathan Sellapa <loganathan.ms at gmail.com
> wrote:

> Hi All,
>
> How can we set up load balancing for RabbitMq in ROR/RUBY(Client
> application which listens & publishes messages to RabbitMq). I don't want
> to loose any message from RabbitMq, if one of my application is down then I
> need to make other application to consume & publish the messages to
> RabbitMq. I assumed that HTTP load balancing wont make any sense with
> RabbitMq since it uses AMQP protocol.
>
> regards,
> Loganathan
> Mob: +91 7760780741 | +91 9944414388
> Skype: loganathan.sellappa
> ViewMe <http://vizualize.me/loganathan>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140503/598c26fd/attachment.html>

From loganathan.ms at gmail.com  Fri May  2 19:54:26 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Sat, 3 May 2014 00:24:26 +0530
Subject: [rabbitmq-discuss] Frequent disconnection of rabbitmq
In-Reply-To: <5363A579.3020809@rabbitmq.com>
References: <CAD_i5MFidHQhfs7Ra0H2WNf=5o6MgOgXUX7LQkh57ZzQ9tdW-Q@mail.gmail.com>
 <CAD_i5MGk+oyfsUpfn5VWi-EYS6QkzLoDM5C_dxJcrFO1jm+-cA@mail.gmail.com>
 <5363A579.3020809@rabbitmq.com>
Message-ID: <CAD_i5MGRAoqiSHjQzOKeZ-guDWY2RLPQJgZmif=py5AoO9tFSQ@mail.gmail.com>

HI Matthias,

For me its happening every 5 minutes, anything do I need to do from code
level?

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Fri, May 2, 2014 at 7:32 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 30/04/14 14:56, Loganathan Sellapa wrote:
>
>> Yes Micheal, We are using the port 5671, and connecting over SSL. Do you
>> know why we are getting this error.
>>
>> Also on another RMQ, when we communicate we see the same behaviour of
>> connection getting disconnected. However the error there was
>> ssl_upgrade_error,closed
>>
>> =ERROR REPORT==== 30-Apr-2014::12:01:29 ===
>> error on AMQP connection <0.4491.3>: {ssl_upgrade_error,closed} (unknown
>> POSIX error)
>>
>
> Both of these errors are often (but not always) an indication that the
> connecting client isn't speaking ssl.
>
> I suggest you follow http://www.rabbitmq.com/troubleshooting-ssl.html to
> track down the problem.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140503/421cd8e6/attachment.html>

From mcintoshj at gmail.com  Fri May  2 20:30:18 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 2 May 2014 14:30:18 -0500
Subject: [rabbitmq-discuss] Frequent disconnection of rabbitmq
In-Reply-To: <CAD_i5MGRAoqiSHjQzOKeZ-guDWY2RLPQJgZmif=py5AoO9tFSQ@mail.gmail.com>
References: <CAD_i5MFidHQhfs7Ra0H2WNf=5o6MgOgXUX7LQkh57ZzQ9tdW-Q@mail.gmail.com>
 <CAD_i5MGk+oyfsUpfn5VWi-EYS6QkzLoDM5C_dxJcrFO1jm+-cA@mail.gmail.com>
 <5363A579.3020809@rabbitmq.com>
 <CAD_i5MGRAoqiSHjQzOKeZ-guDWY2RLPQJgZmif=py5AoO9tFSQ@mail.gmail.com>
Message-ID: <CAD6m6fGguDbxt44JTSO1+-XN_7NsCh1pMFuRKUJ4n_n9WR_KTw@mail.gmail.com>

If it's happening every 5 minutes consistently, I've gotta ask - do you
have a load balancer in front?  If so, does that load balancer have a short
TTL?  We had to upgrade our various libraries to rabbit 3 (not sure what
version you're running) and then make sure that the Load balancer had a
timeout that was LONGER than the default timeout in rabbit.  I saw this on
our side and it was due to our F5 load balancers and the default timeout
networking team had set at 5 minutes.

Jason


On Fri, May 2, 2014 at 1:54 PM, Loganathan Sellapa
<loganathan.ms at gmail.com>wrote:

> HI Matthias,
>
> For me its happening every 5 minutes, anything do I need to do from code
> level?
>
> regards,
> Loganathan
> Mob: +91 7760780741 | +91 9944414388
> Skype: loganathan.sellappa
> ViewMe <http://vizualize.me/loganathan>
>
>
>
> On Fri, May 2, 2014 at 7:32 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:
>
>> On 30/04/14 14:56, Loganathan Sellapa wrote:
>>
>>> Yes Micheal, We are using the port 5671, and connecting over SSL. Do you
>>> know why we are getting this error.
>>>
>>> Also on another RMQ, when we communicate we see the same behaviour of
>>> connection getting disconnected. However the error there was
>>> ssl_upgrade_error,closed
>>>
>>> =ERROR REPORT==== 30-Apr-2014::12:01:29 ===
>>> error on AMQP connection <0.4491.3>: {ssl_upgrade_error,closed} (unknown
>>> POSIX error)
>>>
>>
>> Both of these errors are often (but not always) an indication that the
>> connecting client isn't speaking ssl.
>>
>> I suggest you follow http://www.rabbitmq.com/troubleshooting-ssl.html to
>> track down the problem.
>>
>> Matthias.
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/790e9ae8/attachment.html>

From arunrao.seattle at gmail.com  Fri May  2 20:45:42 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 2 May 2014 12:45:42 -0700
Subject: [rabbitmq-discuss] Memory Usage in Management API
In-Reply-To: <53635597.8000209@rabbitmq.com>
References: <CAEJg2GBxrob16E-FDj_maWjoGpjxi7oDFMuEUgvZvjSqGtRtTQ@mail.gmail.com>
 <53635597.8000209@rabbitmq.com>
Message-ID: <CAEJg2GBx74A4PUMxQf=8YeTZT5BTCtL7bVLq8iz+3ay_Rdbsnw@mail.gmail.com>

Thanks for your response.

I am looking for overall Heap usage stats (Available Heap
(vm_memory_high_watermark), Heap Used) for RabbitMQ server functionality
(excluding Management APIs, etc.,) and Garbage Collection Pause time.

I am trying to index these data into Splunk so I can do post-mortem
analysis. For example, when i see a huge backup of messages (within the
heap limits) in one cluster, after the messages were delivered Erlang would
try to garbage collect, I would like to get visibility into pause time in
this scenario.
Does Erlang use multiple CPUs for garbage collection?

I am sorry I know this is beyond your scope but your thoughts/learnings are
much appreciated.


On Fri, May 2, 2014 at 1:21 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> These are rather general questions, so it would help a great deal if I
> knew what you were trying to do.
>
>
> On 02/05/2014 08:54, Arun Rao wrote:
>
>> Can someone please clarify the following:
>>
>> 1. Memory Usage (by node) shown in Management API: Sum of
>> total_heap_size of all registered processes (including
>> rabbit_mgmt_agent_sup, rabbit_mgmt_sup etc.,)?
>>
>
> The memory use per node is that reported by erlang:memory(total). This
> includes all processes, registered and unregistered as well as all
> binaries, atoms, ETS tables, code and so on. It's supposed to correspond to
> how much memory is used at the OS level. Sadly in practice it doesn't take
> account of memory fragmentation so it can differ, but it's the closest
> thing Erlang gives us.
>
>
>  2. Where does virtual hosts/exchanges/queues live? Everything related to
>> rabbitmq amqp server functionality is on "rabbit" erlang process?
>>
>
> No, not at all. That process is the top of the tree but there are many
> others. All the objects (i.e. vhosts, exchanges, queues and so on) exist as
> records in Mnesia / ETS tables, and queues also exist as processes.
>
>
>  3. Has anyone had success with erlang:trace? I am trying the following
>> but couldnt get this to work:
>>
>> rabbitmqctl eval
>> 'PID=erlang:whereis(rabbit),erlang:trace(PID,gc_start,info).'
>>
>
> Well, the second argument to trace/3 is a boolean, and the third is a list
> of flags, of which 'info' is not one. But trace/3 is very low level. You
> probably want to use the debugger instead?
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/ececdab5/attachment.html>

From arunrao.seattle at gmail.com  Fri May  2 20:50:24 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 2 May 2014 12:50:24 -0700
Subject: [rabbitmq-discuss] Heatbeat configuration
In-Reply-To: <3227c99f-ee70-480b-b0aa-9e173e288cf0@googlegroups.com>
References: <3227c99f-ee70-480b-b0aa-9e173e288cf0@googlegroups.com>
Message-ID: <CAEJg2GBod6rGm_y_b+dk5b=sdHvh8AoBmzCBdPjRJhiS1yFOsQ@mail.gmail.com>

On the rabbitmq server side, you can add a field under
/etc/rabbitmq/rabbitmq.config (https://www.rabbitmq.com/configure.html)
with heartbeat interval value. Setting that to 0 disables the hearbeat.
Default is 600.


On Fri, May 2, 2014 at 9:21 AM, Jorg Eloy <jluzuria2001 at gmail.com> wrote:

> Hi All,
>
> a little question, In RabbitMQ, how I can change the heartbeat time in the
> broker configuration?
> Or how I can make that the timeout expire and the heartbeat works closing
> the connection?
>
> I have proved with SetRequestedHeartbeat in the declaration of the factory
> in the java client,
> making a inactive connection but it's is not dropping and It's not closed.
>
> Thanks.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/c0f9d164/attachment.html>

From shuki.licht at gmail.com  Fri May  2 21:07:28 2014
From: shuki.licht at gmail.com (Shuki Licht)
Date: Fri, 2 May 2014 23:07:28 +0300
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
Message-ID: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>

I need to publish high rates of messages to 3,000 queues that bind to one
exchange.
the message may go to several queues or to all queues.

need help of how to improve the perofmance (its work really slow)
1. try with fanout (to all queues) - the faster solution ,but still not
fast enough.
2. try with BCC/CC list in routing key message if i need to send it to
several queues (60% of the queues) - work very slow
3. when i moved to cluster(HA) the performance is really poor


any ideas? or other design to achive that? i would like to prevent of going
to several child nodes approch.

thanks,
Shuki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/8e64eb89/attachment.html>

From arunrao.seattle at gmail.com  Fri May  2 21:11:39 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 2 May 2014 13:11:39 -0700
Subject: [rabbitmq-discuss] Best way to live migrate RabbitMQ consumer
 load from one cluster to another
In-Reply-To: <CACLE7ixVyCaFHdF8-4cGhm4QLJi4jg6L3NA5t7RSmYz16EUC6Q@mail.gmail.com>
References: <CACLE7iz0A2U6TeHVv7-+dV+4Hj1AF=nzwWwomGsJs56+bB-osQ@mail.gmail.com>
 <CACLE7ixVyCaFHdF8-4cGhm4QLJi4jg6L3NA5t7RSmYz16EUC6Q@mail.gmail.com>
Message-ID: <CAEJg2GDzSSDAAfp_tbwkKguL1PxOhC9Lz5TVcqWKxCMa-PojyA@mail.gmail.com>

I have not used HA-proxy but I will give you my experience on this
scenario: I have 3 clusters setup, so even during peak traffic, I can
safely remove one cluster out and upgrade or do any maintenance.

Key understanding: Your clients catch Shutdownsignals and reconnect.

I have F5 loadbalancer and 3 clusters behind the VIP. During maintenance, I
take one cluster completely out of rotation and wait for the traffic to
switch over to other clusters. After an hour or so, there are still few
connections left behind because the active connections dont switch over so
I do a restart of the cluster I took out of rotation. When you do the
restart of the cluster, there should be no pending messages in the cluster
so ideally you would want to find out the clients connected to this cluster
and restart them so they connect to the cluster you are wanting to connect.

This is purely based on my experience, please use with caution :)


On Fri, May 2, 2014 at 9:46 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Pinging on this thread - No responses as of yet, and given other traffic
> topics here, I'd think somebody would have some thoughts or opinions.
>
> Thanks,
>
> Matt
>
>
> On Wed, Apr 30, 2014 at 10:49 AM, Matt Pietrek <mpietrek at skytap.com>wrote:
>
>> Apologies if this has been answered somewhere already, but my searching
>> isn't turning up anything.
>>
>> I'm looking for advice on how to best move client traffic from one
>> RabbitMQ cluster to another without service interruption. I suspect it can
>> be done with HA-proxy, but I can't figure out the steps. I'm open to other
>> ideas as well.
>>
>> Scenario: We have a 2-node cluster with all queues mirrored. Let's say
>> it's running RabbitMQ 3.2.2. Clients connect to this cluster through a VIP
>> maintained by keepalived on both RabbitMQ hosts.
>>
>> We now want to move to a different identical cluster, but running 3.3.1.
>> I'm thinking I can bring up this new cluster "side-by-side" with the old
>> cluster, such that they're running concurrently. All new connections would
>> go to the new cluster, while already established connections to the 3.2.2
>> cluster will remain alive and working, until all clients have eventually
>> connected to the new cluster. At that point the 3.2.2 cluster can be shut
>> down.
>>
>> I have a hunch I can put HA-proxy in front of both clusters, and though
>> live configuration changes have it migrate the traffic to the new cluster
>> while leaving existing cluster connections alone. What I don't know is the
>> commands/configuration options/steps to implement it.
>>
>> Thoughts and guidance on how to best do this?
>>
>> Thanks,
>>
>> Matt
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/b15cd6f3/attachment.html>

From scott.kendall.mcfadden at gmail.com  Fri May  2 23:05:11 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Fri, 2 May 2014 15:05:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Retrieve N messages from queue?
Message-ID: <7f873639-c19c-40d6-9d9c-27a594e5a54d@googlegroups.com>

Is it possible to look at the queue size in rabbit MQ from client code?  Is 
it possible to pop multiple messages off the queue at the same time? I have 
a queue full of error messages that needs to periodically be emailed to a 
given list of people.   Don't necessarily want to send an email for each 
message as the rate of errors could occasionally be quite high resulting in 
email spam and pressure on the mail server.  Was thinking I could 
periodically poll a rabbit queue and send one email every 5 minutes where 
each email could contain N messages from RabbitMQ.  Please advise.

thanks


scott


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/6103f977/attachment.html>

From mklishin at gopivotal.com  Sat May  3 03:18:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 2 May 2014 22:18:39 -0400
Subject: [rabbitmq-discuss] Retrieve N messages from queue?
In-Reply-To: <7f873639-c19c-40d6-9d9c-27a594e5a54d@googlegroups.com>
References: <7f873639-c19c-40d6-9d9c-27a594e5a54d@googlegroups.com>
Message-ID: <etPan.5364520d.6b8b4567.716a@giove.local>

On May 2, 2014 at 6:19:35 PM, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > Is it possible to look at the queue size in rabbit MQ from client  
> code?

declare the queue (possibly with passive = true) and see message count on
the response (queue.declare-ok)

> Is it possible to pop multiple messages off the queue at  
> the same time? I have a queue full of error messages that needs  
> to periodically be emailed to a given list of people. Don't necessarily  
> want to send an email for each message as the rate of errors could  
> occasionally be quite high resulting in email spam and pressure  
> on the mail server.

You can do the batching in the client or consume N times with basic.get, one by one.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sat May  3 03:21:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 2 May 2014 22:21:49 -0400
Subject: [rabbitmq-discuss] Reset Queues/Exchanges Only?
In-Reply-To: <baf4cfe0-cd9a-4c5e-90f5-45b79eda2545@googlegroups.com>
References: <baf4cfe0-cd9a-4c5e-90f5-45b79eda2545@googlegroups.com>
Message-ID: <etPan.536452cd.327b23c6.716a@giove.local>

On May 2, 2014 at 10:17:53 AM, Robert Parker (reparker23 at gmail.com) wrote:
> > Is there an easy way to force the destruction of all the queues 
> and exchanges on a rabbitmq cluster, but leave all other configurations 
> (clustering, federation, shovel, users, policies) alone? 

You can fetch a list of queues over HTTP API and delete some or all of them (possibly also
over HTTP API).
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From eknath.iyer at gmail.com  Fri May  2 23:22:23 2014
From: eknath.iyer at gmail.com (Eknath Iyer)
Date: Fri, 2 May 2014 15:22:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Priority Queue with RabbitMQ
In-Reply-To: <10933760.344.1324397479932.JavaMail.geo-discussion-forums@prht13>
References: <21179877.384.1324361111000.JavaMail.geo-discussion-forums@yqba2>
 <10933760.344.1324397479932.JavaMail.geo-discussion-forums@prht13>
Message-ID: <01f2183a-7ed5-4c1b-9e23-00980b52db25@googlegroups.com>

To jump on this conversation, 
let's say there is 2 messages in "high" and "med" each. consumer c1 is 
subscribed to both of them.
let's say "med" got both the messages first, so it sends 1 it to c1. But 
before "med" sends the next message to c1, how would you configure "high" 
to send both its messages to c1.

I'm not looking to pre-empt c1's processing of the first "med" message, but 
definitely process "high" messages before "med".

Thanks

On Tuesday, 20 December 2011 08:11:19 UTC-8, Pranav Prakash wrote:
>
> Awesome. This is approx the same as what I was thinking. I am really 
> excited about rabbit mq and would come up with more questions :)
>
> Kudos to the team !!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140502/04716a54/attachment.html>

From videlalvaro at gmail.com  Sat May  3 07:35:52 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 3 May 2014 08:35:52 +0200
Subject: [rabbitmq-discuss] Reusing a channel or creating new ones
In-Reply-To: <53633279.9020801@gmail.com>
References: <5362D13D.2000606@gmail.com>
 <CAMcAHLXU7k9R07zOVJ+Ba06h96hdEwUBvAWU1TR8g6Fy3SyDPA@mail.gmail.com>
 <53633279.9020801@gmail.com>
Message-ID: <CAMcAHLVhqFFjmL+ihVwvRMpiwjZUbaH7_idWQL8TMxQw1m+SpA@mail.gmail.com>

You can have one TCP connection and then multiple channels. Usually in
something like Java you will have one channel per consumer thread.

Have you seen the explanation given here:
http://www.rabbitmq.com/tutorials/amqp-concepts.html ?

On Fri, May 2, 2014 at 7:51 AM, Martin Koroudjiev
<mrtndimitrov at gmail.com> wrote:
> Thank you, Alvaro. I wonder why we then have both channels and
> connections...
>
> Martin
>
> On 5/2/2014 3:17 AM, Alvaro Videla wrote:
>> Hi,
>>
>> There's no need to open a new channel for every message published, in
>> fact, it will be faster to use the same channel.
>>
>> About message acks, you have to send the acks on the same channel
>> where the message where received, since the delivery tags of messages
>> are scoped per channel.
>>
>> Regards,
>>
>> Alvaro
>>
>> On Fri, May 2, 2014 at 12:57 AM, Martin Koroudjiev
>> <mrtndimitrov at gmail.com> wrote:
>>> Hello,
>>>
>>> Should I reuse the channel when sending messages or create a new one for
>>> each send operation? Do I keep it around while listening for messages
>>> and acknowledging them with the old channel or should I create a new one
>>> for the acknowledge operation?
>>>
>>> Thanks,
>>>
>>> Martin
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Sat May  3 07:38:00 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 3 May 2014 08:38:00 +0200
Subject: [rabbitmq-discuss] Retrieve N messages from queue?
In-Reply-To: <etPan.5364520d.6b8b4567.716a@giove.local>
References: <7f873639-c19c-40d6-9d9c-27a594e5a54d@googlegroups.com>
 <etPan.5364520d.6b8b4567.716a@giove.local>
Message-ID: <CAMcAHLWxwcGsF=pW-cT_8-RztgTGDqc+Dt=YH9WPe-e6j2ZV4w@mail.gmail.com>

On Sat, May 3, 2014 at 4:18 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
> You can do the batching in the client or consume N times with basic.get, one by one.

Or you could do similar by setting a prefetch count of N, and when you
get the Nth message you send the email and then multi ack all those
messages.

From videlalvaro at gmail.com  Sat May  3 07:44:19 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 3 May 2014 08:44:19 +0200
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
In-Reply-To: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
References: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
Message-ID: <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>

On Fri, May 2, 2014 at 10:07 PM, Shuki Licht <shuki.licht at gmail.com> wrote:
> I need to publish high rates of messages to 3,000 queues that bind to one
> exchange.
> the message may go to several queues or to all queues.

What kind of filters are you using? Are you using topic exchange or
which kind for the filtering? Fanout as you said, won't filter by
routing key.

-Alvaro

From matthias at rabbitmq.com  Sat May  3 09:18:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 May 2014 09:18:31 +0100
Subject: [rabbitmq-discuss] Heatbeat configuration
In-Reply-To: <3227c99f-ee70-480b-b0aa-9e173e288cf0@googlegroups.com>
References: <3227c99f-ee70-480b-b0aa-9e173e288cf0@googlegroups.com>
Message-ID: <5364A657.8040307@rabbitmq.com>

On 02/05/14 17:21, Jorg Eloy wrote:
> Or how I can make that the timeout expire and the heartbeat works
> closing the connection?
>
> I have proved with SetRequestedHeartbeat in the declaration of the
> factory in the java client,
> making a inactive connection but it's is not dropping and It's not closed.

I think you are mis-understanding what heartbeats are for. See the 
'Heartbeats' section in
https://www.rabbitmq.com/reliability.html#connection-failures

i.e. the purpose of heartbeats is to detect and prevent tcp-level 
connection failure. So they are quite the opposite of dropping inactive 
connections. If that is what you want to do then you'll have to 
implement the logic for that yourself in your application.

Matthias.

From shuki.licht at gmail.com  Sat May  3 09:25:37 2014
From: shuki.licht at gmail.com (shuki Licht)
Date: Sat, 3 May 2014 01:25:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
In-Reply-To: <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>
References: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
 <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>
Message-ID: <1399105537681-35339.post@n5.nabble.com>

for broadcast the messages to all the 3,000 queues , i use fanout - it take
about 8msg/sec (to publish to the exchange with publish confirm)
for send the message to several queues (up to 60% of the queues) i use
direct exchange with BCC/CC list of all other queus - it take less than 1
msg/sec (to publsih to the exchange)


any options to imporve the performance for both scenarios?
any other option to that?

i tried the change the size of the messages ,but the rate it the same ,so
its seems issue of how the route manage in RMQ/Erlang

of course by adding cluster(HA) ,the perfromance get worse.

thanks,
Shuki



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Fanout-and-Route-for-3-000-queues-tp35329p35339.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From arun.achutha at gmail.com  Sat May  3 09:52:36 2014
From: arun.achutha at gmail.com (arun kumar)
Date: Sat, 3 May 2014 14:22:36 +0530
Subject: [rabbitmq-discuss] Hi Everybody
Message-ID: <CAKj_R0r6rfs4xHjG5=e_5m+qwfnid9S3M2chCVk03OA-=q+juA@mail.gmail.com>

Could any one give python rabbitmq rpc sample using kombu library


any ideas will be greatly thankful
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140503/449b1adc/attachment.html>

From videlalvaro at gmail.com  Sat May  3 10:11:16 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 3 May 2014 11:11:16 +0200
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
In-Reply-To: <1399105537681-35339.post@n5.nabble.com>
References: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
 <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>
 <1399105537681-35339.post@n5.nabble.com>
Message-ID: <CAMcAHLXdjufHiTDe+XbaCDVSYnWVq3YFVNdJxREuOjeSwZa2Eg@mail.gmail.com>

As you point out, I think the problem here is not the routing
algorithm used, but the fact that you use Publisher Confirms and
Clustering.

On Sat, May 3, 2014 at 10:25 AM, shuki Licht <shuki.licht at gmail.com> wrote:
> for broadcast the messages to all the 3,000 queues , i use fanout - it take
> about 8msg/sec (to publish to the exchange with publish confirm)
> for send the message to several queues (up to 60% of the queues) i use
> direct exchange with BCC/CC list of all other queus - it take less than 1
> msg/sec (to publsih to the exchange)
>
>
> any options to imporve the performance for both scenarios?
> any other option to that?
>
> i tried the change the size of the messages ,but the rate it the same ,so
> its seems issue of how the route manage in RMQ/Erlang
>
> of course by adding cluster(HA) ,the perfromance get worse.
>
> thanks,
> Shuki
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Fanout-and-Route-for-3-000-queues-tp35329p35339.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shuki.licht at gmail.com  Sat May  3 10:56:07 2014
From: shuki.licht at gmail.com (shuki Licht)
Date: Sat, 3 May 2014 02:56:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
In-Reply-To: <CAMcAHLXdjufHiTDe+XbaCDVSYnWVq3YFVNdJxREuOjeSwZa2Eg@mail.gmail.com>
References: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
 <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>
 <1399105537681-35339.post@n5.nabble.com>
 <CAMcAHLXdjufHiTDe+XbaCDVSYnWVq3YFVNdJxREuOjeSwZa2Eg@mail.gmail.com>
Message-ID: <1399110966818-35342.post@n5.nabble.com>

thanks for your replies,
1. is the BCC/CC direction is the only option that i have to broadcast the
message to several queues(about 60% of the queues), if every time i need to
send it to diffrent list of queues?
2. any other alternatives to imporve my performance of broadcast direction?

Shuki





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Fanout-and-Route-for-3-000-queues-tp35329p35342.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat May  3 11:12:14 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 May 2014 11:12:14 +0100
Subject: [rabbitmq-discuss] Fanout and Route for 3,000 queues
In-Reply-To: <1399110966818-35342.post@n5.nabble.com>
References: <CAKkYEvuQc17i4dqTr_1Tjp3vg6uONV34bSeEbMMyP9wFzGGOcw@mail.gmail.com>
 <CAMcAHLUjZ6zDRb-1c_3LWAAz3heOr12h9=eUbRrti+FaFAsMoA@mail.gmail.com>
 <1399105537681-35339.post@n5.nabble.com>
 <CAMcAHLXdjufHiTDe+XbaCDVSYnWVq3YFVNdJxREuOjeSwZa2Eg@mail.gmail.com>
 <1399110966818-35342.post@n5.nabble.com>
Message-ID: <5364C0FE.8000502@rabbitmq.com>

On 03/05/14 10:56, shuki Licht wrote:
> thanks for your replies,
> 1. is the BCC/CC direction is the only option that i have to broadcast the
> message to several queues(about 60% of the queues), if every time i need to
> send it to diffrent list of queues?

That's what cc/bcc is designed for, so it is pretty much your only option.

> 2. any other alternatives to imporve my performance of broadcast direction?

As Alvaro said, the issue is your use of confirms. The absolutely worst 
thing you can possibly do is wait for confirmation after every publish. 
So don't do that. Instead design your app s.t. confirmations are 
processed asynchronously.

Matthias.

From surendarft at gmail.com  Sat May  3 13:57:57 2014
From: surendarft at gmail.com (Surendar Marudhachalam)
Date: Sat, 3 May 2014 05:57:57 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq java client android issues
Message-ID: <fee9cecf-65f6-4789-b8f0-735fada43153@googlegroups.com>

we have implemented android to android chat with rabbitmq using fanout and 
facing issues with it
we are using a unique queue per device and unique fanout exchange per user 

but the issue with both are if a user  diconnects from network and connects 
again some messages are missed. the issue being with a new customer tag is 
created if a user disconnects and connects again i think so. so we created 
a manual customer tag but still facing the issue. so if a user is offline 
messages delivered to the queue are sometimes not received by user
 we are using a server intermediate. so android client sends a message to 
server and the server publishes it

the code is at 

https://github.com/barterli/barterli_android/tree/development/barter.li/src/li/barter/chat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140503/a0ba274a/attachment.html>

From mklishin at gopivotal.com  Sun May  4 13:01:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 4 May 2014 08:01:15 -0400
Subject: [rabbitmq-discuss] rabbitmq java client android issues
In-Reply-To: <fee9cecf-65f6-4789-b8f0-735fada43153@googlegroups.com>
References: <fee9cecf-65f6-4789-b8f0-735fada43153@googlegroups.com>
Message-ID: <etPan.53662c1a.643c9869.716a@giove.local>

?On May 3, 2014 at 2:50:35 PM, Surendar Marudhachalam (surendarft at gmail.com) wrote:
> > so if a user is offline messages delivered to the queue are sometimes  
> not received by user
> we are using a server intermediate. so android client sends a  
> message to server and the server publishes it

Messages will be routed to queues regardless of whether there are consumers on them.

Do you use automatic acknowledgements? With consumers disconnecting frequently,
you may want to consider manual acks:

http://www.rabbitmq.com/tutorials/tutorial-two-java.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sun May  4 20:16:17 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 4 May 2014 15:16:17 -0400
Subject: [rabbitmq-discuss] rabbitmq java client android issues
In-Reply-To: <CAKJsns0pVY6erSeqi7nrBVCNVfNFdicLM65k879cnz8Gbjk5Eg@mail.gmail.com>
References: <fee9cecf-65f6-4789-b8f0-735fada43153@googlegroups.com>
 <etPan.53662c1a.643c9869.716a@giove.local>
 <CAKJsns0pVY6erSeqi7nrBVCNVfNFdicLM65k879cnz8Gbjk5Eg@mail.gmail.com>
Message-ID: <4357A173-D98E-4A07-A22E-B098E021FAD0@gopivotal.com>

There are no timeouts for acknowledgement but you can and should set a lower heartbeat interval for your connection

MK

> On 04/05/2014, at 12:22, Surendar Marudhachalam <surendarft at gmail.com> wrote:
> 
> yes i will change to manual ack. the problem is a new channel is being created when android disconnects from network while previous is still alive. so the situation is  same queue but multiple channels and consumer tags. the old channel takes long time to close. so even if i change to manual acknowledgement the message delivered to old channel which is still alive will be in unacknowledged state. so i will be missing one message as the message is requeued only after connection closes. is there a way to set timeout for message acknowledgements?
> 
> 
>> On Sun, May 4, 2014 at 5:31 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>>  On May 3, 2014 at 2:50:35 PM, Surendar Marudhachalam (surendarft at gmail.com) wrote:
>> > > so if a user is offline messages delivered to the queue are sometimes
>> > not received by user
>> > we are using a server intermediate. so android client sends a
>> > message to server and the server publishes it
>> 
>> Messages will be routed to queues regardless of whether there are consumers on them.
>> 
>> Do you use automatic acknowledgements? With consumers disconnecting frequently,
>> you may want to consider manual acks:
>> 
>> http://www.rabbitmq.com/tutorials/tutorial-two-java.html
>> --
>> MK
>> 
>> Software Engineer, Pivotal/RabbitMQ
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140504/7f08a081/attachment.html>

From pmaisenovich at blizzard.com  Mon May  5 04:25:44 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Sun, 4 May 2014 20:25:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting maximum performance from RabbitMQ cluster
Message-ID: <1399260344334-35347.post@n5.nabble.com>

I'm running series of performance tests on clustered RabbitMQ 3.1.5 and would
like to share and validate my test results. 

In current test I'm running single-threaded Java clients publishing
non-persistent messages of a fixed size (~200 bytes) as fast as they can via
single connection/channel (per thread) to a direct exchange on a target
Rabbit node. Exchange has multiple queues bound, but there is always exactly
one queue matching the routing key used by the publisher. Queues are created
on different nodes in cluster, so there is a choice to publish to "master"
or "slave" node. Because I'm not interested in consumers (yet) and want to
avoid memory flow control, all queues are size bounded with "x-max-length:
100" (if there are any performance implications of this, please let me
know!). All non-mentioned parameters are using default settings.

I have two Rabbit nodes in a current cluster, each box has 16 CPU cores. Can
provide spec details if needed.

First of all I wanted to achieve best publish TPS numbers, where I'd max out
Rabbit CPU while keeping cluster stable. For that I setup non-mirrored
queues and configured publishers to always use master node (where
destination queue was created). Since each thread is publishing with same
unique routing key (i.e. to the same queue), it's expected that flow control
will throttle each thread at certain (about same across all threads) rate
and total throughput will scale linearly with thread count until Rabbit runs
out of CPU. The expectation was confirmed by tests:

1 threads - ~18K/s
2 threads - ~40K/s
4 threads - ~80K/s
8 threads - ~130K/s
16 threads - ~160K/s

Note, that throughput reached it's ceiling around 8-9 threads, while total
number of CPU cores is 16. CPU on Rabbit was 80-95% (total across all cores,
constantly going up and down) busy at 8 threads and at 97-99% at 16
publishing threads. In all tests management ui was showing "flow" for all
publishing connections.

Running the same test in parallel against both nodes shows that (so far)
cluster throughput scales almost linearly with number of nodes:

4 + 4 threads - ~153K/s
8 + 8 threads - ~260K/s
16 + 16 threads - ~310K/s

To find the point of complete CPU saturation, I've added publish rate
throttling and tuned it so that flow control almost never kicks in (on 1
thread test). Running with that, I got Rabbit CPU constantly 99% busy at 9
threads test with same (as in the unlimited publish test) ~130K/s total
publish rate. Limiting publish rate per thread allowed to evenly load Rabbit
cores, but didn't improve the overall throughput, so I'm wondering if there
are any other benefits in explicitly limiting publish rate instead of
letting per-connection flow control do that?

Next I've tried to publish to a slave node (member of cluster, which doesn't
host the non-mirrored queue). In these tests the throughput will only scale
up to ~20K/s and remain roughly the same from 2 threads and above (with
slave node running at ~13-20% CPU and master at ~4-7%). It looks like the
flow control in this case is shared between all threads publishing to slave
node (which share slave-master connection to deliver messages). Running
parallel threads publishing to master confirms that they are throttled at an
independent, same as in a baseline test rate. This suggests that for best
performance, publishers must be aware of queue master node and use it at all
times. Which seems to be non-trivial given that publishers usually only
aware of exchange and routing key, while queues could be redeclared by
clients at runtime at any nodes in the cluster (in case of node outage). Is
there any good reading on how to address this problem? 

Next I've tried publishing to HA queues (set_policy ha-all). This proved to
be limiting the throughput and horizontal scaling even further - max
throughput went down to ~8-9K/s achieved on 1 thread and remained the same
with more threads added. Removing HA policy on selected queues during the
test unblocks affected publishers within ~3 seconds to their baseline rate,
while keeping others throttled heavily. This suggests that all HA queues are
sharing flow control threshold between all their publishers, is this
correct?

Furthermore, I've noticed in my tests that the rate at which HA publishers
could be impacted by non-HA publishers depends on which node they are
pointing to. This was consistent through multiple retries, but I'm not sure
if it's intended or a bug. Below is best description of the process I can
get so far for this test case:

    1) Running 2 publishers to HA queues and 2 publishers to non-HA queues
(all publishing to the same node, all queues are different and 'owned' by
this node):
     - non-HA queues throughput is same as baseline (~16K/s per queue)
     - HA queues throughput is throttled based on assumingly HA-shared
threshold (~4.5K/s per thread)
 
    2) Running 2 publishers to HA queues on node 1 and 2 publishers to
non-HA queues on node 2 (all queues are different and 'owned' by the node
being published to):
     - non-HA queues throughput is same as baseline (~16K/s per queue)
     - HA queues throughput is throttled as if there were 4 threads
publishing to HA queues! (~2K/s) Flow control bug?

It's obvious that for high performance/scalability HA queues are not good
(currently we run all queues in production under HA policy). I'm going to
add consumers next.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Getting-maximum-performance-from-RabbitMQ-cluster-tp35347.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From shuki.licht at gmail.com  Mon May  5 11:16:05 2014
From: shuki.licht at gmail.com (shuki Licht)
Date: Mon, 5 May 2014 03:16:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Develop rabbitmq plugin on windows
Message-ID: <1399284965341-35348.post@n5.nabble.com>

I tried to to establish envirement on windows for start develop rabbitMQ
plugin.
i stuk now that during the build ,the escript failed to open(or not find)
the generate_deps file.

may i miss something? is this is something that should work on windows?

Shuki



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Develop-rabbitmq-plugin-on-windows-tp35348.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andra.dinu09 at gmail.com  Mon May  5 13:33:46 2014
From: andra.dinu09 at gmail.com (Andra Dinu)
Date: Mon, 5 May 2014 05:33:46 -0700 (PDT)
Subject: [rabbitmq-discuss] EUC 2014: All Speakers Up,
 Free tutorials on 11 June, Early Bird Ends on 9 May
Message-ID: <20cd5ade-5fc5-4073-8828-ee6b271433bc@googlegroups.com>

All the speakers at the Erlang User Conference June 9-10 Stockholm are now 
published on the conference website. The event also includes a day of 
tutorials on 11 June, the EUC Which all delegates have free access.
 
Stuart Bailey, CTO and Founder of Infoblox and Katie Miller, OpenShift 
Developer Advocate and Co-founder of the Lambda Ladies will deliver the 
keynotes. Other speakers include 'Seven Languages ??in Seven Weeks' author 
Bruce Tate, co-designer of Haskell and QuickCheck John Hughes, O'Reilly 
author Erik Stenman, Rakuten lead technologist Yosuke Hara, Feuerlabs 
Co-founder and Developer Advocate Ulf Wiger and many more. 

http://www.erlang-factory.com/conference/show/conference-23/home/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140505/b92b5afd/attachment.html>

From srikanthtns at gmail.com  Mon May  5 18:15:53 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Mon, 5 May 2014 10:15:53 -0700
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <5363A0A7.9030901@rabbitmq.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
 <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
 <5363A0A7.9030901@rabbitmq.com>
Message-ID: <CAOU_jKBbFKBNgDFTMMSwMYVmOF+tQ5CXopJHzkkh5rnyGmigQA@mail.gmail.com>

here is the settings we have now on rabbitmq

Memory and Disk settings:
{rabbit, [{reverse_dns_lookups,
true},{vm_memory_high_watermark_paging_ratio,
0.8},{vm_memory_high_watermark, 0.7},{disk_free_limit, 1000000000}]}

HA queues : we made ha-mode=exactly with 2 nodes

2 DISC , 1 RAM

OS level changes : we made /var diskspace to 20G and ulimit open files to
327679

Are these changes good enough for better performance ? Also I noticed in
the management UI , the listconnections does not show the connections
status as running or blocked , it just shows blank ? does it mean something
?



On Fri, May 2, 2014 at 6:41 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 02/05/14 14:34, Michael Klishin wrote:
>
>> I would still start with 2 disk nodes.
>>
>
> ...and I wouldn't touch the memory watermark settings unless
> experimentation shows that even in extreme usage scenarios memory is
> underutilised.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140505/97ad0876/attachment.html>

From mpietrek at skytap.com  Mon May  5 23:20:21 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 5 May 2014 15:20:21 -0700
Subject: [rabbitmq-discuss] Best way to live migrate RabbitMQ consumer
 load from one cluster to another
In-Reply-To: <CAEJg2GDzSSDAAfp_tbwkKguL1PxOhC9Lz5TVcqWKxCMa-PojyA@mail.gmail.com>
References: <CACLE7iz0A2U6TeHVv7-+dV+4Hj1AF=nzwWwomGsJs56+bB-osQ@mail.gmail.com>
 <CACLE7ixVyCaFHdF8-4cGhm4QLJi4jg6L3NA5t7RSmYz16EUC6Q@mail.gmail.com>
 <CAEJg2GDzSSDAAfp_tbwkKguL1PxOhC9Lz5TVcqWKxCMa-PojyA@mail.gmail.com>
Message-ID: <CACLE7ixUX1SBohCsWG-wqnAWPHSqHGUZfoFUQ-Ak176=mptFug@mail.gmail.com>

Thanks for the reply Arun,

Your scenario is similar to mine, and using multiple clusters is hopefully
in our future. The difference is that I'm trying to achieve it with
haproxy, rather than a dedicated load balancer like F5. My haproxy
experience is limited so I'm hoping somebody has done something like that
and can point me in a general direction.

Matt


On Fri, May 2, 2014 at 1:11 PM, Arun Rao <arunrao.seattle at gmail.com> wrote:

> I have not used HA-proxy but I will give you my experience on this
> scenario: I have 3 clusters setup, so even during peak traffic, I can
> safely remove one cluster out and upgrade or do any maintenance.
>
> Key understanding: Your clients catch Shutdownsignals and reconnect.
>
> I have F5 loadbalancer and 3 clusters behind the VIP. During maintenance,
> I take one cluster completely out of rotation and wait for the traffic to
> switch over to other clusters. After an hour or so, there are still few
> connections left behind because the active connections dont switch over so
> I do a restart of the cluster I took out of rotation. When you do the
> restart of the cluster, there should be no pending messages in the cluster
> so ideally you would want to find out the clients connected to this cluster
> and restart them so they connect to the cluster you are wanting to connect.
>
> This is purely based on my experience, please use with caution :)
>
>
> On Fri, May 2, 2014 at 9:46 AM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> Pinging on this thread - No responses as of yet, and given other traffic
>> topics here, I'd think somebody would have some thoughts or opinions.
>>
>> Thanks,
>>
>> Matt
>>
>>
>> On Wed, Apr 30, 2014 at 10:49 AM, Matt Pietrek <mpietrek at skytap.com>wrote:
>>
>>> Apologies if this has been answered somewhere already, but my searching
>>> isn't turning up anything.
>>>
>>> I'm looking for advice on how to best move client traffic from one
>>> RabbitMQ cluster to another without service interruption. I suspect it can
>>> be done with HA-proxy, but I can't figure out the steps. I'm open to other
>>> ideas as well.
>>>
>>> Scenario: We have a 2-node cluster with all queues mirrored. Let's say
>>> it's running RabbitMQ 3.2.2. Clients connect to this cluster through a VIP
>>> maintained by keepalived on both RabbitMQ hosts.
>>>
>>> We now want to move to a different identical cluster, but running 3.3.1.
>>> I'm thinking I can bring up this new cluster "side-by-side" with the old
>>> cluster, such that they're running concurrently. All new connections would
>>> go to the new cluster, while already established connections to the 3.2.2
>>> cluster will remain alive and working, until all clients have eventually
>>> connected to the new cluster. At that point the 3.2.2 cluster can be shut
>>> down.
>>>
>>> I have a hunch I can put HA-proxy in front of both clusters, and though
>>> live configuration changes have it migrate the traffic to the new cluster
>>> while leaving existing cluster connections alone. What I don't know is the
>>> commands/configuration options/steps to implement it.
>>>
>>> Thoughts and guidance on how to best do this?
>>>
>>> Thanks,
>>>
>>> Matt
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140505/b39ffd42/attachment.html>

From carl.hoerberg at gmail.com  Tue May  6 00:44:36 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 5 May 2014 16:44:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Segfaults
Message-ID: <1399333476554-35353.post@n5.nabble.com>

Getting a lot of segfaults on one server lately (the server is not part of a
cluster). RabbitMQ 3.3.1 and Erlang 17. Do have swap enabled. More likely a
hardware problem than a Erlang problem? 

May  5 02:00:14 node1 kernel: [323583.009397] beam[9365] general protection
ip:4422c8 sp:7fff81ca1c30 error:0 in beam[400000+1f8000]
May  5 04:26:09 node1 kernel: [332337.943342] beam[12362]: segfault at
7f1204b71e ip 0000000000493fa0 sp 00007fff024f9d80 error 4 in
beam[400000+1f8000]
May  5 05:15:10 node1 kernel: [335278.529107] beam[15301]: segfault at e4 ip
0000000000446fe9 sp 00007fff26f01a78 error 4 in beam[400000+1f8000]
May  5 13:37:51 node1 kernel: [365439.781019] beam[16389]: segfault at 118
ip 0000000000447664 sp 00007fff61e89748 error 6 in beam[400000+1f8000]




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Segfaults-tp35353.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue May  6 00:47:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 5 May 2014 19:47:06 -0400
Subject: [rabbitmq-discuss] Segfaults
In-Reply-To: <1399333476554-35353.post@n5.nabble.com>
References: <1399333476554-35353.post@n5.nabble.com>
Message-ID: <etPan.53682309.6b8b4567.82a6@giove.local>

On May 5, 2014 at 7:45:53 PM, carlhoerberg (carl.hoerberg at gmail.com) wrote:
> > More likely a
> hardware problem than a Erlang problem?
>  
> May 5 02:00:14(http://airmail.calendar/2014-05-05%2014:00:14%20AST)  
> node1 kernel: [323583.009397] beam[9365] general protection  
> ip:4422c8 sp:7fff81ca1c30 error:0 in beam[400000+1f8000]  
> May 5 04:26:09(http://airmail.calendar/2014-05-05%2016:26:09%20AST)  
> node1 kernel: [332337.943342] beam[12362]: segfault at
> 7f1204b71e ip 0000000000493fa0 sp 00007fff024f9d80 error  
> 4 in
> beam[400000+1f8000]

It?s hard to tell but run a memory test if you can.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From leechang at 126.com  Tue May  6 05:03:32 2014
From: leechang at 126.com (leechang)
Date: Tue, 6 May 2014 12:03:32 +0800 (CST)
Subject: [rabbitmq-discuss] in rabbitmq a exchange can bind a queue or bind
	more queue?
Message-ID: <2d962ee2.20f38.145cfb368b0.Coremail.leechang@126.com>

 Hi,all:
    I am a RabbitMQ user in China.I have a question,a exchange can bind a queue or bind more queue,What are their different?which one high performer?
    Thank all of you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/8b21c6d4/attachment.html>

From pmaisenovich at blizzard.com  Tue May  6 05:16:23 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Mon, 5 May 2014 21:16:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting maximum performance from RabbitMQ
	cluster
In-Reply-To: <1399260344334-35347.post@n5.nabble.com>
References: <1399260344334-35347.post@n5.nabble.com>
Message-ID: <1399349783225-35358.post@n5.nabble.com>

Today I've tested the overhead that "x-consistent-hash" exchange adds. In
this test setup I had 16 queues with same weights behind hash exchange (by
custom hash-header). All queues declared on same node, non-HA, publisher
threads connecting to that node as well. Throughput numbers

1 thread - 9K/s
2 threads - 18K/s
4 threads - 40K/s
8 threads - 82K/s
16 threads - 95K/s

Publish rate is reduced by about a half, Rabbit CPU at 16 threads was
constantly 99%+ busy.

The more I think about scaling RabbitMQ, the more I come with conclusion
that cluster is no help. In the test case above for example it would not
help at all to have a cluster as publishers have no means to know which node
the message would end up going to and thus can't pick which node to connect
for most efficient publishing (to avoid cross node synchronization
overhead). It would be better to have multiple independent RabbitMQ brokers,
each having multiple consumers with even load distribution (via hash
exchange) and publishers randomly choosing which node to connect to.

Am I going crazy here or  clustering feature
<https://www.rabbitmq.com/clustering.html>   of RabbitMQ is suited best for
reliability and not scalability? I just don't see how it helps so far.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Getting-maximum-performance-from-RabbitMQ-cluster-tp35347p35358.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Tue May  6 10:04:20 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 6 May 2014 11:04:20 +0200
Subject: [rabbitmq-discuss] in rabbitmq a exchange can bind a queue or
 bind more queue?
In-Reply-To: <2d962ee2.20f38.145cfb368b0.Coremail.leechang@126.com>
References: <2d962ee2.20f38.145cfb368b0.Coremail.leechang@126.com>
Message-ID: <CAMcAHLXMe1Ck3aq8VLDX4avCve6t-ywEd1+w_n3+paNt8_eE0w@mail.gmail.com>

Hi,

You can bind as many queues as your machine memory resources would allow.

About performance, you need to run your own benchmarks, but exchanges
should easily accommodate thousands of bindings.

Regards,

Alvaro

On Tue, May 6, 2014 at 6:03 AM, leechang <leechang at 126.com> wrote:
>  Hi,all:
>     I am a RabbitMQ user in China.I have a question,a exchange can bind a
> queue or bind more queue,What are their different?which one high performer?
>     Thank all of you very much.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Mark.deVilliers at Aeriandi.com  Tue May  6 10:05:57 2014
From: Mark.deVilliers at Aeriandi.com (Mark DeVilliers)
Date: Tue, 6 May 2014 09:05:57 +0000
Subject: [rabbitmq-discuss] Develop rabbitmq plugin on windows
In-Reply-To: <1399284965341-35348.post@n5.nabble.com>
References: <1399284965341-35348.post@n5.nabble.com>
Message-ID: <F8529FD7D0704748807B0F0A1B7B4AAB6A94B6F3@1AERDCEXCHMBX1.AER.AERCO.local>


I know its a bit of a cop out but I've got a vagrant (http://www.vagrantup.com/) script to develop on rabbitmq plugins on windows

https://github.com/mdevilliers/vagrant-rabbitmq-development-environment

It checks the code out to the same folder as you run the script from so you can work on windows, you then do all of the compiling and testing on linux from the /vagrant share

Mark


________________________________________
From: rabbitmq-discuss [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of shuki Licht [shuki.licht at gmail.com]
Sent: Monday, May 05, 2014 11:16 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Develop rabbitmq plugin on windows

I tried to to establish envirement on windows for start develop rabbitMQ
plugin.
i stuk now that during the build ,the escript failed to open(or not find)
the generate_deps file.

may i miss something? is this is something that should work on windows?

Shuki



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Develop-rabbitmq-plugin-on-windows-tp35348.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From leechang at 126.com  Mon May  5 05:27:08 2014
From: leechang at 126.com (leechang)
Date: Mon, 5 May 2014 12:27:08 +0800 (CST)
Subject: [rabbitmq-discuss] rabbitmq java api question!!!
Message-ID: <2c73bba9.4a7d.145caa2a572.Coremail.leechang@126.com>

hello:
    i use java client api operator rabbitmq?i have a question?how get all change ? all queue?
                         thank you!!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140505/df3e06f9/attachment.html>

From ankit2186 at gmail.com  Tue May  6 00:23:10 2014
From: ankit2186 at gmail.com (ankit2186)
Date: Mon, 5 May 2014 16:23:10 -0700 (PDT)
Subject: [rabbitmq-discuss] How to get list of declared exchanges and queues
 in rabbitmq using Java?
Message-ID: <1399332190635-35352.post@n5.nabble.com>

How to get list of declared exchanges and queues in rabbitmq using Java?

I am looking for a way to list all declared exchanges, queues in rabbitmq
using Java code. I am aware of command line tool: command "rabbitmqctl
list_queues" also I am aware of management tool "rabbitmqadmin list queues"



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-get-list-of-declared-exchanges-and-queues-in-rabbitmq-using-Java-tp35352.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Tue May  6 10:34:06 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 6 May 2014 11:34:06 +0200
Subject: [rabbitmq-discuss] rabbitmq java api question!!!
In-Reply-To: <2c73bba9.4a7d.145caa2a572.Coremail.leechang@126.com>
References: <2c73bba9.4a7d.145caa2a572.Coremail.leechang@126.com>
Message-ID: <CAMcAHLWW87tsN9Sz4O4Cv9kNsT=2AxZctPfUtkg7kUkmxrhx+A@mail.gmail.com>

Hi,

To get information about exchanges and queues you have to use the HTTP API.

More info here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/10f29da5b9f0/priv/www/api/index.html

Regards,

Alvaro

On Mon, May 5, 2014 at 6:27 AM, leechang <leechang at 126.com> wrote:
> hello:
>     i use java client api operator rabbitmq?i have a question?how get all
> change ? all queue?
>                          thank you!!!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Tue May  6 10:35:02 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 6 May 2014 11:35:02 +0200
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <1399332190635-35352.post@n5.nabble.com>
References: <1399332190635-35352.post@n5.nabble.com>
Message-ID: <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>

Hi,

You need to use the HTTP API to get that information.

More info on the API here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/10f29da5b9f0/priv/www/api/index.html

Regards,

Alvaro

On Tue, May 6, 2014 at 1:23 AM, ankit2186 <ankit2186 at gmail.com> wrote:
> How to get list of declared exchanges and queues in rabbitmq using Java?
>
> I am looking for a way to list all declared exchanges, queues in rabbitmq
> using Java code. I am aware of command line tool: command "rabbitmqctl
> list_queues" also I am aware of management tool "rabbitmqadmin list queues"
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-get-list-of-declared-exchanges-and-queues-in-rabbitmq-using-Java-tp35352.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue May  6 10:56:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 May 2014 10:56:57 +0100
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
Message-ID: <5368B1E9.1070500@rabbitmq.com>

On 06/05/2014 10:35, Alvaro Videla wrote:
> You need to use the HTTP API to get that information.

Note that you can use this to bridge the two:

https://github.com/simonmacmullen/rabbitmq-management-exchange

Cheers, Simon

From simon at rabbitmq.com  Tue May  6 11:00:55 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 May 2014 11:00:55 +0100
Subject: [rabbitmq-discuss] Develop rabbitmq plugin on windows
In-Reply-To: <1399284965341-35348.post@n5.nabble.com>
References: <1399284965341-35348.post@n5.nabble.com>
Message-ID: <5368B2D7.1030905@rabbitmq.com>

On 05/05/2014 11:16, shuki Licht wrote:
> is this is something that should work on windows?

I'm afraid not - our build scripts are quite Unix-specific.

Mark's suggestion of using Vagrant is probably your best route forward.

Cheers, Simon

From simon at rabbitmq.com  Tue May  6 11:05:02 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 May 2014 11:05:02 +0100
Subject: [rabbitmq-discuss] Priority Queue with RabbitMQ
In-Reply-To: <01f2183a-7ed5-4c1b-9e23-00980b52db25@googlegroups.com>
References: <21179877.384.1324361111000.JavaMail.geo-discussion-forums@yqba2>
 <10933760.344.1324397479932.JavaMail.geo-discussion-forums@prht13>
 <01f2183a-7ed5-4c1b-9e23-00980b52db25@googlegroups.com>
Message-ID: <5368B3CE.9050907@rabbitmq.com>

On 02/05/2014 23:22, Eknath Iyer wrote:
> To jump on this conversation,

Note that the conversation is 2.5 years old now :-)

> let's say there is 2 messages in "high" and "med" each. consumer c1 is
> subscribed to both of them.
> let's say "med" got both the messages first, so it sends 1 it to c1. But
> before "med" sends the next message to c1, how would you configure
> "high" to send both its messages to c1.
>
> I'm not looking to pre-empt c1's processing of the first "med" message,
> but definitely process "high" messages before "med".

That is definitely a problem with this approach.

Note that real priority queues are coming soon:

https://github.com/rabbitmq/rabbitmq-priority-queue

Cheers, Simon


From rikatee at gmail.com  Tue May  6 14:46:39 2014
From: rikatee at gmail.com (Richard Tier)
Date: Tue, 6 May 2014 06:46:39 -0700 (PDT)
Subject: [rabbitmq-discuss] clustering on google app engine
Message-ID: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>

The docs <https://www.rabbitmq.com/clustering.html> on clustering state 
that "clustering does not tolerate network partitions well", and states to 
avoid clustering on WAN.

I'm using Google Cloud Engine instances - all of which are in the same zone.

Should this setup be considered a WAN?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/71fff854/attachment.html>

From tech191 at yoox.com  Tue May  6 14:47:16 2014
From: tech191 at yoox.com (Miglianti Marco)
Date: Tue, 6 May 2014 13:47:16 +0000
Subject: [rabbitmq-discuss] 3.3.1 shovel status problem
Message-ID: <2558125424F0F4469D1861F8593FA4AA692BE49E@YMAIL02BLQ.yoox.net>

Hello,
after upgrade RabbitMQ to version 3.3.1 in http://localhost:15672/#/shovels the status of the shovel is "... no shovel ..."

but the command rabbitmqctl.bat eval "rabbit_shovel_status:status()." show:

[{test_01,static,
          {running,[{src_uri,<<"amqp:///test">>},
                    {dest_uri,<<"amqp:///vhosttest">>}]},
          {{2014,5,6},{13,23,18}}}]
...done.

and the shovel work correctly.

Thi is my "rabbitmq-plugins.bat list"

[e] amqp_client                       3.3.1
[ ] cowboy                            0.5.0-rmq3.3.1-git4b93c2d
[ ] eldap                             3.3.1-gite309de4
[e] mochiweb                          2.7.0-rmq3.3.1-git680dba8
[ ] rabbitmq_amqp1_0                  3.3.1
[ ] rabbitmq_auth_backend_ldap        3.3.1
[ ] rabbitmq_auth_mechanism_ssl       3.3.1
[ ] rabbitmq_consistent_hash_exchange 3.3.1
[ ] rabbitmq_federation               3.3.1
[ ] rabbitmq_federation_management    3.3.1
[e] rabbitmq_jsonrpc                  3.3.x-24fb08eb
[e] rabbitmq_jsonrpc_channel          3.3.x-40bdb08c
[E] rabbitmq_jsonrpc_channel_examples 3.3.x-b2932861
[E] rabbitmq_management               3.3.1
[e] rabbitmq_management_agent         3.3.1
[E] rabbitmq_management_visualiser    3.3.1
[ ] rabbitmq_mqtt                     3.3.1
[E] rabbitmq_shovel                   3.3.1
[E] rabbitmq_shovel_management        3.3.1
[ ] rabbitmq_stomp                    3.3.1
[E] rabbitmq_top                      3.3.x-52014a9c
[ ] rabbitmq_tracing                  3.3.1
[e] rabbitmq_web_dispatch             3.3.1
[ ] rabbitmq_web_stomp                3.3.1
[ ] rabbitmq_web_stomp_examples       3.3.1
[e] rfc4627_jsonrpc                   3.3.x-git5e67120
[ ] sockjs                            0.3.4-rmq3.3.1-git3132eb9
[e] webmachine                        1.10.3-rmq3.3.1-gite9359c7

In version 3.3.0 all was correct.

Can you help me?

Marco Miglianti
Website Operation Team
YOOX Group
Zola Predosa - Bologna - Italia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/d3bb6550/attachment.html>

From ryankbrown at gmail.com  Tue May  6 18:31:21 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Tue, 6 May 2014 11:31:21 -0600
Subject: [rabbitmq-discuss] Scaling RabbitMQ in "the cloud"
Message-ID: <CAChGYf-pfaGQ_f1c-AKVUii6=rg5_qY5oQCXqacHH8=FrnYodg@mail.gmail.com>

I hate using that term because it is so over/misused. However, I am in the
process of re-structuring my application to be deployed to ec2. My
application wraps RabbitMQ with a friendly REST interface that does some
additional routing and management for us. Right now, we have RabbitMQ in a
four node active/active/active/active cluster behind F5 in our data center.
What we need to do is push this out and have an instance of our application
and a RabbitMQ cluster in each region of ec2 (if not each az). Ideally we
would like to have the queues federated in such a manner that if a
publisher of a given exists in New York City, that a subscriber in Sydney
will get their message delivered from their nearest az. (This may be naive
by me and par of what I am trying to determine.)

What I would like to know is if anybody has experience doing this. Has any
lessons-learned to share. Gotcha's? Maybe has something documented or knows
of some documentation that exists that I am not finding.

Best.

Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/a650f275/attachment.html>

From jasonjwwilliams at gmail.com  Tue May  6 18:54:07 2014
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 6 May 2014 10:54:07 -0700
Subject: [rabbitmq-discuss] Scaling RabbitMQ in "the cloud"
In-Reply-To: <CAChGYf-pfaGQ_f1c-AKVUii6=rg5_qY5oQCXqacHH8=FrnYodg@mail.gmail.com>
References: <CAChGYf-pfaGQ_f1c-AKVUii6=rg5_qY5oQCXqacHH8=FrnYodg@mail.gmail.com>
Message-ID: <CAHZAEpf2Q9pz=3YY9_JNLeOf=3cKK7RKfhMVtgz8Ft8E_LpmTw@mail.gmail.com>

I think the NYT description of their new Rabbit deployments is a great
place to start:

http://highscalability.com/blog/2014/1/13/nytimes-architecture-no-head-no-master-no-single-point-of-fa.html

-J


On Tue, May 6, 2014 at 10:31 AM, Ryan Brown <ryankbrown at gmail.com> wrote:

> I hate using that term because it is so over/misused. However, I am in the
> process of re-structuring my application to be deployed to ec2. My
> application wraps RabbitMQ with a friendly REST interface that does some
> additional routing and management for us. Right now, we have RabbitMQ in a
> four node active/active/active/active cluster behind F5 in our data center.
> What we need to do is push this out and have an instance of our application
> and a RabbitMQ cluster in each region of ec2 (if not each az). Ideally we
> would like to have the queues federated in such a manner that if a
> publisher of a given exists in New York City, that a subscriber in Sydney
> will get their message delivered from their nearest az. (This may be naive
> by me and par of what I am trying to determine.)
>
> What I would like to know is if anybody has experience doing this. Has any
> lessons-learned to share. Gotcha's? Maybe has something documented or knows
> of some documentation that exists that I am not finding.
>
> Best.
>
> Ryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/bafe34ba/attachment.html>

From vvasuki at expedia.com  Tue May  6 19:48:17 2014
From: vvasuki at expedia.com (Vidya Vasuki)
Date: Tue, 6 May 2014 18:48:17 +0000
Subject: [rabbitmq-discuss]  Local time in overview charts?
Message-ID: <7d40a46c73964327978936ccd392231a@CHCXEXCHMBX005.SEA.CORP.EXPECN.com>

Hi Simon,

Any idea if the timezone issue in RabbitMQ Management Console has been fixed?

Thanks,
Vidya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/40a79f84/attachment.html>

From simon at rabbitmq.com  Tue May  6 21:25:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 May 2014 21:25:30 +0100
Subject: [rabbitmq-discuss] Local time in overview charts?
In-Reply-To: <7d40a46c73964327978936ccd392231a@CHCXEXCHMBX005.SEA.CORP.EXPECN.com>
References: <7d40a46c73964327978936ccd392231a@CHCXEXCHMBX005.SEA.CORP.EXPECN.com>
Message-ID: <5369453A.5060208@rabbitmq.com>

On 06/05/2014 7:48PM, Vidya Vasuki wrote:
> Any idea if the timezone issue in RabbitMQ Management Console has been
> fixed?

Yes, last October :-) in 3.2.0:

http://www.rabbitmq.com/release-notes/README-3.2.0.txt

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From srinatsr at cisco.com  Tue May  6 22:48:05 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 6 May 2014 21:48:05 +0000
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in Spring
	Project
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>

Hello all,

I need to configure following queues under some vhost,


    <rabbit:connection-factory id="connectionFactory"/>

       <rabbit:queue id="validateRequestQueue.dev" name="validateRequestQueue.dev"/>
       <rabbit:queue id="validateFeedQueue.dev" name="validateFeedQueue.demo"/>
       <rabbit:queue id="monitorQueue" name="monitorQueue"/>

But based on above code, it adding with vhost as "/".. How to change this in configuration file??
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/a48b18b2/attachment.html>

From pmaisenovich at blizzard.com  Tue May  6 23:47:07 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Tue, 6 May 2014 15:47:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting maximum performance from RabbitMQ
	cluster
In-Reply-To: <1399260344334-35347.post@n5.nabble.com>
References: <1399260344334-35347.post@n5.nabble.com>
Message-ID: <1399416427422-35375.post@n5.nabble.com>

Correction: my test machines have 2 CPUs with 4 cores each. Additional 8
cores appeared as a result of hyperthreading. This explains why scaling
pretty much stops at 8 concurrent publishers. 

I should say that ~160K/s publishes per box is quite impressive and I'd be
happy if I can get 50-70K/s throughput for simple publish/consume scenario.
With that I wonder if  performance improvements in 3.3 release
<http://www.rabbitmq.com/blog/2014/04/03/an-end-to-synchrony-performance-improvements-in-3-3/>  
will improve cross-node synchronization and throughput for HA queues. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Getting-maximum-performance-from-RabbitMQ-cluster-tp35347p35375.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jason.novotny at gmail.com  Wed May  7 00:07:15 2014
From: jason.novotny at gmail.com (Jason Novotny)
Date: Tue, 06 May 2014 16:07:15 -0700
Subject: [rabbitmq-discuss] =?windows-1252?q?amqp_error_involving_=93unexp?=
	=?windows-1252?q?ected_frame=94?=
Message-ID: <53696B23.1040701@gmail.com>


Hi,

I'm trying to load test an application that uses Celery task management
with RabbitMQ as the broker. I hit my server with 100 client connections
and for the first 45 minutes everything is humming along fine. At some
point later, I see the clery tasks are not running and I see these
messages in my celery log file:

    [2014-05-06 18:32:14,405: ERROR/MainProcess] consumer: Cannot
connect to amqp://guest at 127.0.0.1:5672//: [Errno 111] Connection refused.
    Trying again in 32.00 seconds...

I check my RabbitMQ log file and see these messages:

    =INFO REPORT==== 6-May-2014::18:25:50 ===
    accepting AMQP connection <0.9738.30> (127.0.0.1:50034 ->
127.0.0.1:5672)

    =ERROR REPORT==== 6-May-2014::18:25:50 ===
    closing AMQP connection <0.25069.29> (127.0.0.1:50030 ->
127.0.0.1:5672):
    {handshake_error,starting,28366,
                 {amqp_error,unexpected_frame,
                             "type 1, first 16 octets =        
<<0,50,0,10,0,0,32,53,54,51,55,54,53,55,56,57>>",
                             none}}

    =WARNING REPORT==== 6-May-2014::18:25:50 ===
    Mnesia('rabbit at ip-172-31-45-115'): ** WARNING ** Mnesia is
overloaded: {dump_log,
                                                                       
write_threshold}

    =INFO REPORT==== 6-May-2014::18:25:51 ===
    accepting AMQP connection <0.19640.30> (127.0.0.1:50036 ->
127.0.0.1:5672)

Any ideas on what is going on? I don't understand what AMQP unexpected
frame means.

Thanks, Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/1720c5ce/attachment.html>

From rikatee at gmail.com  Wed May  7 01:06:09 2014
From: rikatee at gmail.com (Richard Tier)
Date: Tue, 6 May 2014 17:06:09 -0700 (PDT)
Subject: [rabbitmq-discuss] clustering on google app engine
In-Reply-To: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
References: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
Message-ID: <09b62ced-5e37-486a-8d5b-f964ba3276ef@googlegroups.com>

sorry - to confirm - tite should read "google compute engine"

On Tuesday, May 6, 2014 2:46:39 PM UTC+1, Richard Tier wrote:
>
> The docs <https://www.rabbitmq.com/clustering.html> on clustering state 
> that "clustering does not tolerate network partitions well", and states to 
> avoid clustering on WAN.
>
> I'm using Google Cloud Engine instances - all of which are in the same 
> zone.
>
> Should this setup be considered a WAN?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/4ccb41f7/attachment.html>

From jkuch at gopivotal.com  Wed May  7 02:28:07 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Tue, 6 May 2014 18:28:07 -0700
Subject: [rabbitmq-discuss] clustering on google app engine
In-Reply-To: <09b62ced-5e37-486a-8d5b-f964ba3276ef@googlegroups.com>
References: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
 <09b62ced-5e37-486a-8d5b-f964ba3276ef@googlegroups.com>
Message-ID: <1FC4D93B-9C9E-4DD6-B45C-EFDADF6561B8@gopivotal.com>

I think you can consider those suitable for clustering. Also we will have more to say on this topic presently. 

Sent from my iPhone

> On May 6, 2014, at 5:06 PM, Richard Tier <rikatee at gmail.com> wrote:
> 
> sorry - to confirm - tite should read "google compute engine"
> 
>> On Tuesday, May 6, 2014 2:46:39 PM UTC+1, Richard Tier wrote:
>> The docs on clustering state that "clustering does not tolerate network partitions well", and states to avoid clustering on WAN.
>> 
>> I'm using Google Cloud Engine instances - all of which are in the same zone.
>> 
>> Should this setup be considered a WAN?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140506/44cf2af4/attachment.html>

From matthias at rabbitmq.com  Wed May  7 08:17:27 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 08:17:27 +0100
Subject: [rabbitmq-discuss]
 =?windows-1252?q?amqp_error_involving_=93unexp?=
 =?windows-1252?q?ected_frame=94?=
In-Reply-To: <53696B23.1040701@gmail.com>
References: <53696B23.1040701@gmail.com>
Message-ID: <5369DE07.9010201@rabbitmq.com>

On 07/05/14 00:07, Jason Novotny wrote:
>      =ERROR REPORT==== 6-May-2014::18:25:50 ===
>      closing AMQP connection <0.25069.29> (127.0.0.1:50030 ->
> 127.0.0.1:5672):
>      {handshake_error,starting,28366,
>                   {amqp_error,unexpected_frame,
>                               "type 1, first 16 octets =
> <<0,50,0,10,0,0,32,53,54,51,55,54,53,55,56,57>>",
>                               none}}
> [...]
> Any ideas on what is going on? I don't understand what AMQP unexpected
> frame means.

See 
http://rabbitmq.1065348.n5.nabble.com/UNEXPECTED-FRAME-expected-content-header-for-class-60-got-non-content-header-frame-instead-td34981.html

You may want to ask for further help on 
https://groups.google.com/forum/#!forum/celery-users

Matthias,

From gerald.preissler at innoq.com  Wed May  7 10:38:26 2014
From: gerald.preissler at innoq.com (Gerald Preissler)
Date: Wed, 7 May 2014 11:38:26 +0200
Subject: [rabbitmq-discuss] Use of
	com.rabbitmq.client.AMQP.BasicProperties#Type
Message-ID: <5369FF12.1040808@innoq.com>

Hi all,

can anyone clarify the use of the attribute 
com.rabbitmq.client.AMQP.BasicProperties#Type ? Is an application free 
to use this attribute to define application-specific message types and 
will these types be propagated along with the message to the message 
consumer?

Context: I'm developing an application that uses RabbitMQ to send event 
date to several message consumers. Events are all serialized to JSON for 
transport, but each event belongs to one of several event types. One of 
the message consumers has requested the event type to be provided as a 
property with the message to ease processing on their side.

Thanks in advance.

Best regards

Jerry Preissler

From matthias at rabbitmq.com  Wed May  7 10:46:43 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 10:46:43 +0100
Subject: [rabbitmq-discuss] Use of
	com.rabbitmq.client.AMQP.BasicProperties#Type
In-Reply-To: <5369FF12.1040808@innoq.com>
References: <5369FF12.1040808@innoq.com>
Message-ID: <536A0103.1070204@rabbitmq.com>

On 07/05/14 10:38, Gerald Preissler wrote:
> can anyone clarify the use of the attribute
> com.rabbitmq.client.AMQP.BasicProperties#Type ? Is an application free
> to use this attribute to define application-specific message types and
> will these types be propagated along with the message to the message
> consumer?

 From http://www.rabbitmq.com/resources/specs/amqp0-9-1.xml

     <!--  For application use, no formal behaviour -->
     <field name = "type"            domain = "shortstr"   label = 
"message type name" />

The RabbitMQ server passes along content properties unaltered.

Matthias.

From gerald.preissler at innoq.com  Wed May  7 11:05:12 2014
From: gerald.preissler at innoq.com (Gerald Preissler)
Date: Wed, 7 May 2014 12:05:12 +0200
Subject: [rabbitmq-discuss] Use of
	com.rabbitmq.client.AMQP.BasicProperties#Type
In-Reply-To: <536A0103.1070204@rabbitmq.com>
References: <5369FF12.1040808@innoq.com> <536A0103.1070204@rabbitmq.com>
Message-ID: <536A0558.9020308@innoq.com>

Hi Matthias,

On 07.05.2014 11:46, Matthias Radestock wrote:
>
>  From http://www.rabbitmq.com/resources/specs/amqp0-9-1.xml
>
>      <!--  For application use, no formal behaviour -->
>      <field name = "type"            domain = "shortstr"   label =
> "message type name" />
>
> The RabbitMQ server passes along content properties unaltered.
>
> Matthias.

Thanks for the clarification.

Best regards

Jerry


From muhammad.kamrana at gmail.com  Wed May  7 11:26:28 2014
From: muhammad.kamrana at gmail.com (Kamran Afridi)
Date: Wed, 7 May 2014 03:26:28 -0700 (PDT)
Subject: [rabbitmq-discuss] File Transfer or Jingle like Framework
Message-ID: <1b9c6024-be4b-4ffd-ab4c-d28e1b1bedda@googlegroups.com>

Hi,
   I would like to know if RabbitMQ is working on File Transfer or 
Voice/Video Libraries/Classes as compared to XMPP's jingle? Keep in the 
mind it assumes that it working on TCP as streaming is usually done over 
UDP. 

Regards,
Kamran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/f5aec555/attachment.html>

From haster2004 at yandex.ru  Wed May  7 11:27:50 2014
From: haster2004 at yandex.ru (Haster)
Date: Wed, 7 May 2014 03:27:50 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ block incoming traffic
Message-ID: <1399458470580-35388.post@n5.nabble.com>

Hi folks,

On RabbitMQ server I have got such message:
"The disk free space alarm <http://www.rabbitmq.com/memory.html#diskfreesup> 
for this node has gone off. It will block incoming network traffic until the
amount of free space exceeds the limit."

If I will send messages to RabbitMQ should it close a connection? Or it just
will throw away messages and won't answer to me?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-block-incoming-traffic-tp35388.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed May  7 12:16:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 May 2014 12:16:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ block incoming traffic
In-Reply-To: <1399458470580-35388.post@n5.nabble.com>
References: <1399458470580-35388.post@n5.nabble.com>
Message-ID: <536A15F7.4010107@rabbitmq.com>

On 07/05/14 11:27, Haster wrote:
> On RabbitMQ server I have got such message:
> "The disk free space alarm<http://www.rabbitmq.com/memory.html#diskfreesup>
> for this node has gone off. It will block incoming network traffic until the
> amount of free space exceeds the limit."
>
> If I will send messages to RabbitMQ should it close a connection? Or it just
> will throw away messages and won't answer to me?

Neither - it will just stop reading from the socket, so (eventually) 
publishing will block.

See http://www.rabbitmq.com/memory.html for more information and 
http://www.rabbitmq.com/connection-blocked.html for how to find out when 
this has happened.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From haster2004 at yandex.ru  Wed May  7 12:26:09 2014
From: haster2004 at yandex.ru (Haster)
Date: Wed, 7 May 2014 04:26:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ block incoming traffic
In-Reply-To: <536A15F7.4010107@rabbitmq.com>
References: <1399458470580-35388.post@n5.nabble.com>
 <536A15F7.4010107@rabbitmq.com>
Message-ID: <1399461969963-35391.post@n5.nabble.com>

Simon, 
thanks for reply and for links!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-block-incoming-traffic-tp35388p35391.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed May  7 12:49:04 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 12:49:04 +0100
Subject: [rabbitmq-discuss] Hi Everybody
In-Reply-To: <CAKj_R0r6rfs4xHjG5=e_5m+qwfnid9S3M2chCVk03OA-=q+juA@mail.gmail.com>
References: <CAKj_R0r6rfs4xHjG5=e_5m+qwfnid9S3M2chCVk03OA-=q+juA@mail.gmail.com>
Message-ID: <536A1DB0.80105@rabbitmq.com>

On 03/05/14 09:52, arun kumar wrote:
> Could any one give python rabbitmq rpc sample using kombu library

I've never used kombu, but a quick google suggests 
http://pythonhosted.org/callme/introduction.html might be worth looking 
at for you.

Matthias.

From matthias at rabbitmq.com  Wed May  7 12:56:13 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 12:56:13 +0100
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in
 Spring Project
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
Message-ID: <536A1F5D.1020906@rabbitmq.com>

On 06/05/14 22:48, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES 
INC at Cisco) wrote:
> I need to configure following queues under some vhost,
>
> <rabbit:connection-factoryid=/"connectionFactory"//>
>
> <rabbit:queueid=/"validateRequestQueue.dev"/
> name=/"validateRequestQueue.dev"//>
>
> <rabbit:queueid=/"validateFeedQueue.dev"/ name=/"validateFeedQueue.demo"//>
>
> <rabbit:queueid=/"monitorQueue"/ name=/"monitorQueue"//>
>
> But based on above code, it adding with vhost as ?/?.. How to change
> this in configuration file??

I suggest you ask your question over on 
http://forum.spring.io/forum/spring-projects/integration/amqp

Matthias.

From simon at rabbitmq.com  Wed May  7 13:00:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 May 2014 13:00:59 +0100
Subject: [rabbitmq-discuss] 3.3.1 shovel status problem
In-Reply-To: <2558125424F0F4469D1861F8593FA4AA692BE49E@YMAIL02BLQ.yoox.net>
References: <2558125424F0F4469D1861F8593FA4AA692BE49E@YMAIL02BLQ.yoox.net>
Message-ID: <536A207B.5010007@rabbitmq.com>

On 06/05/14 14:47, Miglianti Marco wrote:
> Hello,

Hi.

> after upgrade RabbitMQ to version 3.3.1 in
> http://localhost:15672/#/shovels the status of the shovel is "... no
> shovel ..."
> but the command rabbitmqctl.bat eval "rabbit_shovel_status:status()."show:

<snip>

> and the shovel work correctly.

Damn. It looks like RabbitMQ 3.3.1 broke the shovel-status plugin for 
static shovels. This will be fixed in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Wed May  7 13:03:13 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 13:03:13 +0100
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <CAOU_jKBbFKBNgDFTMMSwMYVmOF+tQ5CXopJHzkkh5rnyGmigQA@mail.gmail.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
 <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
 <5363A0A7.9030901@rabbitmq.com>
 <CAOU_jKBbFKBNgDFTMMSwMYVmOF+tQ5CXopJHzkkh5rnyGmigQA@mail.gmail.com>
Message-ID: <536A2101.9080103@rabbitmq.com>

On 05/05/14 18:15, srikanth tns wrote:
> here is the settings we have now on rabbitmq
>
> Memory and Disk settings:
> {rabbit, [{reverse_dns_lookups,
> true},{vm_memory_high_watermark_paging_ratio,
> 0.8},{vm_memory_high_watermark, 0.7},{disk_free_limit, 1000000000}]}

As I said: "I wouldn't touch the memory watermark settings unless 
experimentation shows that even in extreme usage scenarios memory is 
underutilised."

> HA queues : we made ha-mode=exactly with 2 nodes
>
> 2 DISC , 1 RAM
>
> OS level changes : we made /var diskspace to 20G and ulimit open files
> to 327679
>
> Are these changes good enough for better performance ?

That's impossible to say. I suggest you run some tests.

> Also I noticed in the management UI , the listconnections does not
> show the connections status as running or blocked , it just shows
> blank ? does it mean something ?

That shouldn't happen. Please post a screenshot.

Matthias.

From matthias at rabbitmq.com  Wed May  7 13:08:25 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 13:08:25 +0100
Subject: [rabbitmq-discuss] Memory Usage in Management API
In-Reply-To: <CAEJg2GBx74A4PUMxQf=8YeTZT5BTCtL7bVLq8iz+3ay_Rdbsnw@mail.gmail.com>
References: <CAEJg2GBxrob16E-FDj_maWjoGpjxi7oDFMuEUgvZvjSqGtRtTQ@mail.gmail.com>
 <53635597.8000209@rabbitmq.com>
 <CAEJg2GBx74A4PUMxQf=8YeTZT5BTCtL7bVLq8iz+3ay_Rdbsnw@mail.gmail.com>
Message-ID: <536A2239.7090802@rabbitmq.com>

On 02/05/14 20:45, Arun Rao wrote:
> Does Erlang use multiple CPUs for garbage collection?

Yes.

http://www.erlang.org/faq/academic.html#id58328

Matthias.

From matthias at rabbitmq.com  Wed May  7 13:34:14 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 13:34:14 +0100
Subject: [rabbitmq-discuss] [SPAM] Re: Certificate with more than one
 intermediate CA
In-Reply-To: <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
References: <62573470865EAA41A09BB261D33F2DDF64148E@pragmail3.pragmatics.com>
 <etPan.535e54cc.333ab105.170@mercurio.local>
 <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
Message-ID: <536A2846.1090104@rabbitmq.com>

On 28/04/14 14:22, Karras, Thomas wrote:
> We have them both federating to each other so both sides report the
> error. The error message comes from the federation plugin attempting
> to connect to the server and failing to successfully negotiate a SSL
> connection.

Can you connect to the upstream using an ordinary client? If not, follow
http://www.rabbitmq.com/troubleshooting-ssl.html to narrow down the problem.

Regarding your earlier question...

> I could not find a way to specify client ssl_options for the
> federation plugin.

There isn't one; the SSL-related URI parameters documented at 
http://www.rabbitmq.com/uri-query-parameters.html are the only ones 
supported.

Matthias.

From grussell at gopivotal.com  Wed May  7 13:47:16 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Wed, 7 May 2014 08:47:16 -0400
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in
	Spring Project
In-Reply-To: <536A1F5D.1020906@rabbitmq.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
 <536A1F5D.1020906@rabbitmq.com>
Message-ID: <CADtU9_sVk4uyrfA4-u-bziHXHJS7FCjrjuAY956qe811XjnkkQ@mail.gmail.com>

 <rabbit:connection-factory id="connectionFactory" virtual-host="/foo" />



On Wed, May 7, 2014 at 7:56 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 06/05/14 22:48, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES
> INC at Cisco) wrote:
>
>> I need to configure following queues under some vhost,
>>
>> <rabbit:connection-factoryid=/"connectionFactory"//>
>>
>> <rabbit:queueid=/"validateRequestQueue.dev"/
>> name=/"validateRequestQueue.dev"//>
>>
>> <rabbit:queueid=/"validateFeedQueue.dev"/ name=/"validateFeedQueue.demo"
>> //>
>>
>> <rabbit:queueid=/"monitorQueue"/ name=/"monitorQueue"//>
>>
>>
>> But based on above code, it adding with vhost as ?/?.. How to change
>> this in configuration file??
>>
>
> I suggest you ask your question over on http://forum.spring.io/forum/
> spring-projects/integration/amqp
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/323d4e64/attachment.html>

From KarrasT at Pragmatics.com  Wed May  7 14:10:27 2014
From: KarrasT at Pragmatics.com (Karras, Thomas)
Date: Wed, 7 May 2014 09:10:27 -0400
Subject: [rabbitmq-discuss] [SPAM] Re: [SPAM] Re: Certificate with more
	than one intermediate CA
In-Reply-To: <536A2846.1090104@rabbitmq.com>
References: <62573470865EAA41A09BB261D33F2DDF64148E@pragmail3.pragmatics.com>
 <etPan.535e54cc.333ab105.170@mercurio.local>
 <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
 <536A2846.1090104@rabbitmq.com>
Message-ID: <62573470865EAA41A09BB261D33F2DDF6414C5@pragmail3.pragmatics.com>

The standard openssl s_client and s_server work without problem with these certificates. This problem I believe comes from the Erlang ssl library having default values set on properties that cannot be set through the uri query params. 

From the erlang docs, http://www.erlang.org/doc/man/ssl.html

"{depth, integer()}
The depth is the maximum number of non-self-issued intermediate certificates that may follow the peer certificate in a valid certification path. So if depth is 0 the PEER must be signed by the trusted ROOT-CA directly, if 1 the path can be PEER, CA, ROOT-CA, if it is 2 PEER, CA, CA, ROOT-CA and so on. The default value is 1."

Thanks,

Thomas

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, May 07, 2014 8:34 AM
To: Discussions about RabbitMQ; Karras, Thomas
Subject: [SPAM] Re: [rabbitmq-discuss] [SPAM] Re: Certificate with more than one intermediate CA
Importance: Low

On 28/04/14 14:22, Karras, Thomas wrote:
> We have them both federating to each other so both sides report the 
> error. The error message comes from the federation plugin attempting 
> to connect to the server and failing to successfully negotiate a SSL 
> connection.

Can you connect to the upstream using an ordinary client? If not, follow http://www.rabbitmq.com/troubleshooting-ssl.html to narrow down the problem.

Regarding your earlier question...

> I could not find a way to specify client ssl_options for the 
> federation plugin.

There isn't one; the SSL-related URI parameters documented at http://www.rabbitmq.com/uri-query-parameters.html are the only ones supported.

Matthias.

From matthias at rabbitmq.com  Wed May  7 14:22:49 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 14:22:49 +0100
Subject: [rabbitmq-discuss] [SPAM] Re: [SPAM] Re: Certificate with more
 than one intermediate CA
In-Reply-To: <62573470865EAA41A09BB261D33F2DDF6414C5@pragmail3.pragmatics.com>
References: <62573470865EAA41A09BB261D33F2DDF64148E@pragmail3.pragmatics.com>
 <etPan.535e54cc.333ab105.170@mercurio.local>
 <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
 <536A2846.1090104@rabbitmq.com>
 <62573470865EAA41A09BB261D33F2DDF6414C5@pragmail3.pragmatics.com>
Message-ID: <536A33A9.40508@rabbitmq.com>

On 07/05/14 14:10, Karras, Thomas wrote:
> The standard openssl s_client and s_server work without problem with
> these certificates.

Can s_client connect to the rabbit server?

> This problem I believe comes from the Erlang ssl library having
> default values set on properties that cannot be set through the uri
> query params. ...{depth, integer()}

I hear you, but I want to make sure that is really the issue here. If 
you don't mind writing a little bit of Erlang, you could try connecting 
to the upstream with the Erlang client, which *does* permit arbitrary 
ssl_options? It would be informative to know whether that works.

Matthias.

From KarrasT at Pragmatics.com  Wed May  7 14:33:46 2014
From: KarrasT at Pragmatics.com (Karras, Thomas)
Date: Wed, 7 May 2014 09:33:46 -0400
Subject: [rabbitmq-discuss] [SPAM] Re: [SPAM] Re: Certificate with more
	than one intermediate CA
In-Reply-To: <536A33A9.40508@rabbitmq.com>
References: <62573470865EAA41A09BB261D33F2DDF64148E@pragmail3.pragmatics.com>
 <etPan.535e54cc.333ab105.170@mercurio.local>
 <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
 <536A2846.1090104@rabbitmq.com>
 <62573470865EAA41A09BB261D33F2DDF6414C5@pragmail3.pragmatics.com>
 <536A33A9.40508@rabbitmq.com>
Message-ID: <62573470865EAA41A09BB261D33F2DDF6414C6@pragmail3.pragmatics.com>

Yes, the s_client is able to connect to the rabbit server. It will take me some time to add the option to set ssl_options since I have no experience with Erlang and am also busy with some other tasks. We currently have a workaround by using an ssh tunnel to secure the connections between rabbit servers but it would be nice to use built in configuration instead. If someone else can test it out that would be great but otherwise I will see what I can do about testing it out with the depth option set on the client. This issue can actually be reproduced with a standard single intermediary cert by setting the depth setting to 0 in the ssl_options in rabbitmq.config.

Thanks,

Thomas

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, May 07, 2014 9:23 AM
To: Discussions about RabbitMQ
Cc: Karras, Thomas
Subject: Re: [SPAM] Re: [rabbitmq-discuss] [SPAM] Re: Certificate with more than one intermediate CA

On 07/05/14 14:10, Karras, Thomas wrote:
> The standard openssl s_client and s_server work without problem with 
> these certificates.

Can s_client connect to the rabbit server?

> This problem I believe comes from the Erlang ssl library having 
> default values set on properties that cannot be set through the uri 
> query params. ...{depth, integer()}

I hear you, but I want to make sure that is really the issue here. If you don't mind writing a little bit of Erlang, you could try connecting to the upstream with the Erlang client, which *does* permit arbitrary ssl_options? It would be informative to know whether that works.

Matthias.

From matthias at rabbitmq.com  Wed May  7 15:03:15 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 15:03:15 +0100
Subject: [rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
In-Reply-To: <1e6f76f9-f85e-4f73-8b42-588e504a3c37@googlegroups.com>
References: <e0533f6d-f09c-48ba-89d5-d4f72eb78baa@googlegroups.com>
 <1e6f76f9-f85e-4f73-8b42-588e504a3c37@googlegroups.com>
Message-ID: <536A3D23.8060503@rabbitmq.com>

On 30/04/14 23:04, brad at debtpaypro.com wrote:
> When starting up, a message is logged that says "rabbit_web_stomp:
> listening for HTTPS connections on 0.0.0.0:15675", but netstat shows
> that nothing is listening on port 15675. [...]
> rabbitmq.config:
>
> [
>    {rabbitmq_web_stomp, [
>      {ssl_config, [
>        {port,       15674},
>        {backlog,    1024},
>        {certfile,   "/etc/pki/tls/certs/dpp.crt"},
>        {keyfile,    "/etc/pki/tls/private/dpp.key"}
>      ]}
>    ]}
> ].

I have reproduced this.

If you check the rabbit-sasl.log you'll find some cryptic error.

The root cause is that you are missing a password in the above config, 
which is mandatory (but can be "") for the ssl config in cowboy, the web 
server library used by web_stomp.

I have just updated our docs at 
http://www.rabbitmq.com/web-stomp.html#config to make that clear.

Matthias.

From matthias at rabbitmq.com  Wed May  7 15:09:52 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 15:09:52 +0100
Subject: [rabbitmq-discuss] Getting maximum performance from RabbitMQ
 cluster
In-Reply-To: <1399416427422-35375.post@n5.nabble.com>
References: <1399260344334-35347.post@n5.nabble.com>
 <1399416427422-35375.post@n5.nabble.com>
Message-ID: <536A3EB0.7070307@rabbitmq.com>

On 06/05/14 23:47, Pavel wrote:
> I wonder if  performance improvements in 3.3 release
> <http://www.rabbitmq.com/blog/2014/04/03/an-end-to-synchrony-performance-improvements-in-3-3/>
> will improve cross-node synchronization and throughput for HA queues.

The specific improvements listed there won't improve throughput for HA 
queues, unless you are publishing with 'mandatory' or are consuming with 
a prefetch limit. However, there are other performance improvements in 
3.3.x. Generally, I recommend performing tests with the latest RabbitMQ 
and latest Erlang.

Matthias.

From matthias at rabbitmq.com  Wed May  7 15:48:45 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 May 2014 15:48:45 +0100
Subject: [rabbitmq-discuss] [SPAM] Re: [SPAM] Re: Certificate with more
 than one intermediate CA
In-Reply-To: <62573470865EAA41A09BB261D33F2DDF6414C6@pragmail3.pragmatics.com>
References: <62573470865EAA41A09BB261D33F2DDF64148E@pragmail3.pragmatics.com>
 <etPan.535e54cc.333ab105.170@mercurio.local>
 <62573470865EAA41A09BB261D33F2DDF641490@pragmail3.pragmatics.com>
 <536A2846.1090104@rabbitmq.com>
 <62573470865EAA41A09BB261D33F2DDF6414C5@pragmail3.pragmatics.com>
 <536A33A9.40508@rabbitmq.com>
 <62573470865EAA41A09BB261D33F2DDF6414C6@pragmail3.pragmatics.com>
Message-ID: <536A47CD.3070804@rabbitmq.com>

On 07/05/14 14:33, Karras, Thomas wrote:
> I will see what I can do about testing it out
> with the depth option set on the client.

Thanks. Meanwhile I have filed a bug to make the Erlang client ssl 
configuration more comprehensive.

Matthias.

From martin.rogan.inc at gmail.com  Wed May  7 17:58:03 2014
From: martin.rogan.inc at gmail.com (mrogan)
Date: Wed, 7 May 2014 09:58:03 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.3.0: How to achieve channel.flow(0) with
	basic.qos?
Message-ID: <1399481883761-35405.post@n5.nabble.com>

Hi,

Support for channel.flow(bit active) was removed in RabbitMq 3.3.0 (
changelog <https://www.rabbitmq.com/release-notes/README-3.3.0.txt>  ). I
was using it to suspend flow on a channel when initially consuming a queue
with basic.consume. The reason is that I need to determine if I am the
exclusive consumer of that queue and perform business logic before starting
to receive already pending messages.

I read that "basic.qos is superior in all cases" but I don't see how to
completely suspend the flow by setting the prefetch-count. If I set the
prefetch-count to zero then then it is effectively unlimited. This is not
the same as channel.flow(0)!

I can work around this by buffering messages until I can perform my business
logic after the (successful) basic.consume. But this would seem to be
reimplementing the channel.flow that has disappeared!

If I am missing something please let me know. Maybe there's a special value
I can pass to basic.qos to achieve the same effect as channel.flow? Or is
there a way I can determine if I can exclusively basic.consume a queue
without actually starting to receive messages? I am using the Java client.

Thanks,

Martin



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-3-0-How-to-achieve-channel-flow-0-with-basic-qos-tp35405.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From srinatsr at cisco.com  Wed May  7 18:37:28 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 7 May 2014 17:37:28 +0000
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in
 Spring	Project
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB05B6D@xmb-aln-x10.cisco.com>

Please need help on this?

Regards ...*
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Tuesday, May 06, 2014 2:48 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in Spring Project

Hello all,

I need to configure following queues under some vhost,


    <rabbit:connection-factory id="connectionFactory"/>

       <rabbit:queue id="validateRequestQueue.dev" name="validateRequestQueue.dev"/>
       <rabbit:queue id="validateFeedQueue.dev" name="validateFeedQueue.demo"/>
       <rabbit:queue id="monitorQueue" name="monitorQueue"/>

But based on above code, it adding with vhost as "/".. How to change this in configuration file??
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/f010cd11/attachment.html>

From grussell at gopivotal.com  Wed May  7 18:56:10 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Wed, 7 May 2014 13:56:10 -0400
Subject: [rabbitmq-discuss] Configure Queue under specific vhost in
	Spring Project
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB05B6D@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0585E@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB05B6D@xmb-aln-x10.cisco.com>
Message-ID: <CADtU9_v=gjWP=UH8gy9SiqyGXNkH56NsW7fu_dXn+XwCX8xqoQ@mail.gmail.com>

I already replied this morning.

http://article.gmane.org/gmane.comp.networking.rabbitmq.general/31653

You need to add a virtual-host attribute to the connection factory.


On Wed, May 7, 2014 at 1:37 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>  Please need help on this?
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Srinath
> Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
> *Sent:* Tuesday, May 06, 2014 2:48 PM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* [rabbitmq-discuss] Configure Queue under specific vhost in
> Spring Project
>
>
>
> Hello all,
>
>
>
> I need to configure following queues under some vhost,
>
>
>
>
>
>     <rabbit:connection-factory id=*"connectionFactory"*/>
>
>
>
>        <rabbit:queue id=*"validateRequestQueue.dev"* name=
> *"validateRequestQueue.dev"*/>
>
>        <rabbit:queue id=*"validateFeedQueue.dev"* name=
> *"validateFeedQueue.demo"*/>
>
>        <rabbit:queue id=*"monitorQueue"* name=*"monitorQueue"*/>
>
>
>
> But based on above code, it adding with vhost as ?/?.. How to change this
> in configuration file??
>
> Regards ?*?*
>
> Srinath
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/d924938f/attachment.html>

From srinatsr at cisco.com  Wed May  7 19:10:46 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 7 May 2014 18:10:46 +0000
Subject: [rabbitmq-discuss] Couldn't see rabbitmq.log exchange under my
 vhost (ccrcrabbitmqcluster)
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB05BFB@xmb-aln-x10.cisco.com>

Please advice.

[cid:image001.png at 01CF69E4.F6F735D0]

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/4914aff9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 250197 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/4914aff9/attachment.png>

From simon at rabbitmq.com  Wed May  7 19:44:50 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 May 2014 19:44:50 +0100
Subject: [rabbitmq-discuss] Couldn't see rabbitmq.log exchange under my
 vhost (ccrcrabbitmqcluster)
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB05BFB@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB05BFB@xmb-aln-x10.cisco.com>
Message-ID: <536A7F22.5090408@rabbitmq.com>

On 07/05/2014 19:10, Srinath Sridharan -X (srinatsr - ZENSAR 
TECHNOLOGIES INC at Cisco) wrote:
> Please advice.

You're not supposed to be able to. Since logs are a broker-wide thing, 
there's only one amq.rabbitmq.log exchange, in the default vhost.

Cheers, Simon


From srinatsr at cisco.com  Wed May  7 19:57:05 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 7 May 2014 18:57:05 +0000
Subject: [rabbitmq-discuss] Couldn't see rabbitmq.log exchange under my
 vhost (ccrcrabbitmqcluster)
In-Reply-To: <536A7F22.5090408@rabbitmq.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB05BFB@xmb-aln-x10.cisco.com>
 <536A7F22.5090408@rabbitmq.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB05C91@xmb-aln-x10.cisco.com>

What is the advantage of using different virtual hosts then? Please help

Regards ......
Srinath


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, May 07, 2014 11:45 AM
To: Discussions about RabbitMQ
Cc: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Subject: Re: [rabbitmq-discuss] Couldn't see rabbitmq.log exchange under my vhost (ccrcrabbitmqcluster)

On 07/05/2014 19:10, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) wrote:
> Please advice.

You're not supposed to be able to. Since logs are a broker-wide thing, 
there's only one amq.rabbitmq.log exchange, in the default vhost.

Cheers, Simon


From srikanthtns at gmail.com  Wed May  7 23:21:19 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Wed, 7 May 2014 15:21:19 -0700
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <536A2101.9080103@rabbitmq.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
 <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
 <5363A0A7.9030901@rabbitmq.com>
 <CAOU_jKBbFKBNgDFTMMSwMYVmOF+tQ5CXopJHzkkh5rnyGmigQA@mail.gmail.com>
 <536A2101.9080103@rabbitmq.com>
Message-ID: <CAOU_jKCa1Nd+n2S2dcBeXJpWR+N_Kw9YD-di0q-nxkxvBz-LzA@mail.gmail.com>

here's the screenshot

[image: Inline image 1]


On Wed, May 7, 2014 at 5:03 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 05/05/14 18:15, srikanth tns wrote:
>
>> here is the settings we have now on rabbitmq
>>
>> Memory and Disk settings:
>> {rabbit, [{reverse_dns_lookups,
>> true},{vm_memory_high_watermark_paging_ratio,
>> 0.8},{vm_memory_high_watermark, 0.7},{disk_free_limit, 1000000000}]}
>>
>
> As I said: "I wouldn't touch the memory watermark settings unless
> experimentation shows that even in extreme usage scenarios memory is
> underutilised."
>
>
>  HA queues : we made ha-mode=exactly with 2 nodes
>>
>> 2 DISC , 1 RAM
>>
>> OS level changes : we made /var diskspace to 20G and ulimit open files
>> to 327679
>>
>> Are these changes good enough for better performance ?
>>
>
> That's impossible to say. I suggest you run some tests.
>
>
>  Also I noticed in the management UI , the listconnections does not
>> show the connections status as running or blocked , it just shows
>> blank ? does it mean something ?
>>
>
> That shouldn't happen. Please post a screenshot.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/68d2debc/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 60534 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/68d2debc/attachment.png>

From carl.hoerberg at gmail.com  Thu May  8 02:36:06 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 7 May 2014 18:36:06 -0700 (PDT)
Subject: [rabbitmq-discuss] beam blocking
Message-ID: <1399512966246-35412.post@n5.nabble.com>

Have a cluster where the nodes sometimes crash on high load, nothing is shown
in the rabbitmq logs, but this shows up in syslog:

kernel: [582840.748073] INFO: task beam:9794 blocked for more than 120
seconds.
kernel: [582840.748082] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs"
disables this message.
kernel: [582840.748088] beam            D ffff8800efc13700     0  9794  
9718 0x00000000
kernel: [582840.748092]  ffff8800e7bc3cb8 0000000000000282 0000000000000000
ffffffffffffffe0
kernel: [582840.748095]  ffff8800e7bc3fd8 ffff8800e7bc3fd8 ffff8800e7bc3fd8
0000000000013700
kernel: [582840.748098]  ffff88000249c4d0 ffff88000249ade0 00007f7c2aa289e0
ffff8800024b1180
kernel: [582840.748101] Call Trace:
kernel: [582840.748109]  [<ffffffff81659bbf>] schedule+0x3f/0x60
kernel: [582840.748113]  [<ffffffff8106c535>] exit_mm+0x85/0x130
kernel: [582840.748116]  [<ffffffff8106c74e>] do_exit+0x16e/0x450
kernel: [582840.748120]  [<ffffffff8109e4d9>] ?
futex_wait_queue_me+0xc9/0x100
kernel: [582840.748122]  [<ffffffff8109e14f>] ? __unqueue_futex+0x3f/0x80
kernel: [582840.748126]  [<ffffffff8107ad4a>] ? __dequeue_signal+0x6a/0xb0
kernel: [582840.748128]  [<ffffffff8106cbd4>] do_group_exit+0x44/0xa0
kernel: [582840.748131]  [<ffffffff8107d8cc>]
get_signal_to_deliver+0x21c/0x420
kernel: [582840.748135]  [<ffffffff81014825>] do_signal+0x45/0x130
kernel: [582840.748137]  [<ffffffff810a126c>] ? do_futex+0x7c/0x1b0
kernel: [582840.748139]  [<ffffffff810a14e2>] ? sys_futex+0x142/0x1a0
kernel: [582840.748142]  [<ffffffff81091d7f>] ? __put_cred+0x3f/0x50
kernel: [582840.748144]  [<ffffffff81014ad5>] do_notify_resume+0x65/0x80
kernel: [582840.748147]  [<ffffffff81664350>] int_signal+0x12/0x17

RabbitMQ 3.3.1, Erlang 17, ubuntu 12.04



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/beam-blocking-tp35412.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brett.r.cameron at gmail.com  Thu May  8 02:57:23 2014
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 8 May 2014 13:57:23 +1200
Subject: [rabbitmq-discuss] beam blocking
In-Reply-To: <1399512966246-35412.post@n5.nabble.com>
References: <1399512966246-35412.post@n5.nabble.com>
Message-ID: <CALPqkio1wkCQLKNj+-QDymRvH_6L-yHFs2s+ML8mrOu-AzcJiQ@mail.gmail.com>

Carl,

Possibly an I/O problem. When the the operating system flushes cached file
system data to disk there is a default timeout of 120s and while flushing
is occurring writes will become blocked/synchronous. If your server has a
lot of RAM and slow storage, and you're doing a lot of writes, this could
happen. By default the kernel param vm.dirty_ratio (% RAM used for file
system caching) is 40% (see /etc/sysctl.conf). You could try playing with
this value to increase the frequency of I/O flushes but reduce their size...

Brett



On Thu, May 8, 2014 at 1:36 PM, carlhoerberg <carl.hoerberg at gmail.com>wrote:

> Have a cluster where the nodes sometimes crash on high load, nothing is
> shown
> in the rabbitmq logs, but this shows up in syslog:
>
> kernel: [582840.748073] INFO: task beam:9794 blocked for more than 120
> seconds.
> kernel: [582840.748082] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs"
> disables this message.
> kernel: [582840.748088] beam            D ffff8800efc13700     0  9794
> 9718 0x00000000
> kernel: [582840.748092]  ffff8800e7bc3cb8 0000000000000282 0000000000000000
> ffffffffffffffe0
> kernel: [582840.748095]  ffff8800e7bc3fd8 ffff8800e7bc3fd8 ffff8800e7bc3fd8
> 0000000000013700
> kernel: [582840.748098]  ffff88000249c4d0 ffff88000249ade0 00007f7c2aa289e0
> ffff8800024b1180
> kernel: [582840.748101] Call Trace:
> kernel: [582840.748109]  [<ffffffff81659bbf>] schedule+0x3f/0x60
> kernel: [582840.748113]  [<ffffffff8106c535>] exit_mm+0x85/0x130
> kernel: [582840.748116]  [<ffffffff8106c74e>] do_exit+0x16e/0x450
> kernel: [582840.748120]  [<ffffffff8109e4d9>] ?
> futex_wait_queue_me+0xc9/0x100
> kernel: [582840.748122]  [<ffffffff8109e14f>] ? __unqueue_futex+0x3f/0x80
> kernel: [582840.748126]  [<ffffffff8107ad4a>] ? __dequeue_signal+0x6a/0xb0
> kernel: [582840.748128]  [<ffffffff8106cbd4>] do_group_exit+0x44/0xa0
> kernel: [582840.748131]  [<ffffffff8107d8cc>]
> get_signal_to_deliver+0x21c/0x420
> kernel: [582840.748135]  [<ffffffff81014825>] do_signal+0x45/0x130
> kernel: [582840.748137]  [<ffffffff810a126c>] ? do_futex+0x7c/0x1b0
> kernel: [582840.748139]  [<ffffffff810a14e2>] ? sys_futex+0x142/0x1a0
> kernel: [582840.748142]  [<ffffffff81091d7f>] ? __put_cred+0x3f/0x50
> kernel: [582840.748144]  [<ffffffff81014ad5>] do_notify_resume+0x65/0x80
> kernel: [582840.748147]  [<ffffffff81664350>] int_signal+0x12/0x17
>
> RabbitMQ 3.3.1, Erlang 17, ubuntu 12.04
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/beam-blocking-tp35412.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/f9a51200/attachment.html>

From garrett at recurly.com  Thu May  8 05:26:10 2014
From: garrett at recurly.com (Garrett Johnson)
Date: Thu, 8 May 2014 00:26:10 -0400
Subject: [rabbitmq-discuss] Messages that can never touch disk
Message-ID: <CAAKWE9iTwkTETBOL_Gvsw8uLFzc6UzbuwYeXFkR48gz_TLM4eA@mail.gmail.com>

Hello all ? I have a question about making sure a message NEVER hits disk.
Assuming the messages are not published as persistent (duh) and we cancel
connections at a given memory threshold rather than paging to disk, what
else is there to keep in mind?

If it is even possible, can you still mirror the queues in a cluster?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/e284bf9d/attachment.html>

From carl.hoerberg at gmail.com  Thu May  8 07:56:54 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 7 May 2014 23:56:54 -0700 (PDT)
Subject: [rabbitmq-discuss] beam blocking
In-Reply-To: <CALPqkio1wkCQLKNj+-QDymRvH_6L-yHFs2s+ML8mrOu-AzcJiQ@mail.gmail.com>
References: <1399512966246-35412.post@n5.nabble.com>
 <CALPqkio1wkCQLKNj+-QDymRvH_6L-yHFs2s+ML8mrOu-AzcJiQ@mail.gmail.com>
Message-ID: <1399532214699-35415.post@n5.nabble.com>

Ah, makes sense, I'm trying that, thank! 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/beam-blocking-tp35412p35415.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu May  8 08:46:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 08:46:37 +0100
Subject: [rabbitmq-discuss] Messages that can never touch disk
In-Reply-To: <CAAKWE9iTwkTETBOL_Gvsw8uLFzc6UzbuwYeXFkR48gz_TLM4eA@mail.gmail.com>
References: <CAAKWE9iTwkTETBOL_Gvsw8uLFzc6UzbuwYeXFkR48gz_TLM4eA@mail.gmail.com>
Message-ID: <536B365D.1080904@rabbitmq.com>

On 08/05/2014 05:26, Garrett Johnson wrote:
> Hello all ? I have a question about making sure a message NEVER hits
> disk. Assuming the messages are not published as persistent (duh) and we
> cancel connections at a given memory threshold rather than paging to
> disk, what else is there to keep in mind?

Assuming this is broker-wide, you would want to set 
vm_memory_high_watermark_paging_ratio to some large number. You should 
not need to cancel connections if you do that.

> If it is even possible, can you still mirror the queues in a cluster?

HA is still fine; it's orthogonal to persistence.

Cheers, Simon


From jeffdoto at gmail.com  Wed May  7 17:41:21 2014
From: jeffdoto at gmail.com (Jeffrey Doto)
Date: Wed, 7 May 2014 12:41:21 -0400
Subject: [rabbitmq-discuss] Writes to Rabbit Occasionally Hang
	Indefinitely
In-Reply-To: <etPan.535ed6df.614fd4a1.170@mercurio.local>
References: <6ee00146-26d3-4a89-9c1f-5811d4ba058d@googlegroups.com>
 <etPan.535ed6df.614fd4a1.170@mercurio.local>
Message-ID: <A758C1AE-8EDB-4C69-A507-7B57970E0481@gmail.com>

Hi Michael,

Thanks very much for your response.  I have a bit more data about this that could be interesting.

Our producer node dysfunction seems to be correlated with a heartbeat timeout event:

5/7/14 12:44:11.000 AM	
=INFO REPORT==== 7-May-2014::00:44:11 ===
accepting AMQP connection <0.17458.855> (172.20.153.34:36684 -> 172.20.153.185:5672)


5/7/14 12:44:11.000 AM	
=ERROR REPORT==== 7-May-2014::00:44:11 ===
closing AMQP connection <0.30506.852> (172.20.153.34:37769 -> 172.20.153.185:5672):
{heartbeat_timeout,running}


If we check netstat on the producer / rabbit-server sides, we see a very large Send-Q value on the producer, and nothing on the rabbit-server side; the producer Send-Q size just continues to grow larger, with no response from the server:

producer:
[ccpmer-po-cb48-p ~ ]$ netstat -an | grep 5672
tcp        0 1066985 ::ffff:172.20.153.34:36684  ::ffff:172.20.153.185:5672  ESTABLISHED 
tcp        1      0 ::ffff:172.20.153.34:60075  ::ffff:172.20.149.41:15672  CLOSE_WAIT  

rabbit side:
[ccpmer-po-cb176-p ~ ]$ netstat -an | grep 5672 | grep 34
tcp        0      0 ::ffff:172.20.153.185:5672  ::ffff:172.20.153.34:36684  ESTABLISHED 

producer Send-Q keeps growing.
[ccpmer-po-cb48-p ~ ]$ netstat -an | grep 5672
tcp        0 1074230 ::ffff:172.20.153.34:36684  ::ffff:172.20.153.185:5672  ESTABLISHED 
tcp        1      0 ::ffff:172.20.153.34:60075  ::ffff:172.20.149.41:15672  CLOSE_WAIT


Again we?re running the 3.2.2 version of the server - I do see that bugfix 25457 fixed a similar issue in the 3.0.3 release, but we?re past that now.

Is this still indicative of the socketWrite timeout issue you referred me to in your last response, or could this be something else?  Is there more data you?d like to see that could help diagnose this further?

Are there any plans to fix https://github.com/rabbitmq/rabbitmq-java-client/issues/11 soon?  There?s not another more recent version of rabbit we could upgrade to that would help us, is there?  

Thanks again,

Jeff



On Apr 28, 2014, at 6:31 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 29 April 2014 at 02:29:30, Jeff Doto (jeffdoto at gmail.com) wrote:
>>> We?re wondering if anyone has encountered an issue similar  
>> to this running the versions of Rabbit server / client we are.  
>> Are there any suggestions for what we can do to prevent this? Could  
>> upgrading the server version help?
> 
> This is a known Java client (or, well, JDK Socket) limitation:
> http://markmail.org/thread/w7ay4hslxwqirfsc 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/fbfb2fa9/attachment.html>

From garrett at recurly.com  Thu May  8 09:13:36 2014
From: garrett at recurly.com (Garrett Johnson)
Date: Thu, 8 May 2014 04:13:36 -0400
Subject: [rabbitmq-discuss] Messages that can never touch disk
In-Reply-To: <536B365D.1080904@rabbitmq.com>
References: <CAAKWE9iTwkTETBOL_Gvsw8uLFzc6UzbuwYeXFkR48gz_TLM4eA@mail.gmail.com>
 <536B365D.1080904@rabbitmq.com>
Message-ID: <CAAKWE9joBTeihdi_vvssqO+TrMM4opMgkBWio1gMLQ1qz9jBtA@mail.gmail.com>

On Thu, May 8, 2014 at 3:46 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/05/2014 05:26, Garrett Johnson wrote:
>
>> Hello all ? I have a question about making sure a message NEVER hits
>> disk. Assuming the messages are not published as persistent (duh) and we
>> cancel connections at a given memory threshold rather than paging to
>> disk, what else is there to keep in mind?
>>
>
> Assuming this is broker-wide, you would want to set
> vm_memory_high_watermark_paging_ratio to some large number. You should
> not need to cancel connections if you do that.




>
>  If it is even possible, can you still mirror the queues in a cluster?
>>
>
> HA is still fine; it's orthogonal to persistence.
>


Okay cool, even when a new node joins and has to sync?


>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/17acd8e7/attachment.html>

From simon at rabbitmq.com  Thu May  8 10:27:03 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 10:27:03 +0100
Subject: [rabbitmq-discuss] Messages that can never touch disk
In-Reply-To: <CAAKWE9joBTeihdi_vvssqO+TrMM4opMgkBWio1gMLQ1qz9jBtA@mail.gmail.com>
References: <CAAKWE9iTwkTETBOL_Gvsw8uLFzc6UzbuwYeXFkR48gz_TLM4eA@mail.gmail.com>	<536B365D.1080904@rabbitmq.com>
 <CAAKWE9joBTeihdi_vvssqO+TrMM4opMgkBWio1gMLQ1qz9jBtA@mail.gmail.com>
Message-ID: <536B4DE7.1080808@rabbitmq.com>

On 08/05/14 09:13, Garrett Johnson wrote:
> Okay cool, even when a new node joins and has to sync?

Yes, if the queue is non-persistent and non-paging then all the syncing 
just happens in RAM.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  8 11:13:48 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 11:13:48 +0100
Subject: [rabbitmq-discuss] Federation link and partition handling
In-Reply-To: <1398292531569-35039.post@n5.nabble.com>
References: <1398292531569-35039.post@n5.nabble.com>
Message-ID: <536B58DC.6070902@rabbitmq.com>

On 23/04/14 23:35, lepolac wrote:
> When there's a partition on a cluster that's configured in ignore or
> autoheal, where both sides will stay active, a second federation link seems
> to be created.

Yes, that's correct.

It's hard to see how it could be otherwise - while the partition is 
ongoing, both halves of the cluster think that the other half is down, 
and that they need to keep things going. So the half that didn't have 
the federation link when the partition happened will start up a new one.

> Are both links active ? Will the downstream broker get messages from both
> partitions ? How will they be merged back ?

This is really more of a question about what happens to state in 
partitions; the federation link can just be thought of as a stateful 
thing that is involved in the partition.

So:

> Are both links active ?

While the partition is ongoing. Afterwards it depends on the partition 
handling mode - see below.

> Will the downstream broker get messages from both partitions ?

Well, federation links retrieve messages from the upstream; so we are 
talking about the downstream partitioning. Both halves of the downstream 
will retrieve messages from the same upstream (if the upstream is also a 
cluster they may decide to connect to different nodes of course). Since 
both halves of the downstream partition will have the same cluster-id, 
they will end up sharing the message stream from the upstream in a 
round-robin-ish way.

> How will they be merged back ?

After the partition heals (at the network level) it depends whether the 
partition handling mode is "ignore" or "autoheal. In "ignore" mode both 
links will continue to be active and publishing into their respective 
halves of the cluster. In "autoheal" mode enough nodes will be restarted 
that the partition will heal - and the excess links will get shut down.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  8 11:16:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 11:16:40 +0100
Subject: [rabbitmq-discuss] Rabbitmq cluster design and HA
In-Reply-To: <CAOU_jKCa1Nd+n2S2dcBeXJpWR+N_Kw9YD-di0q-nxkxvBz-LzA@mail.gmail.com>
References: <CAOU_jKBYfms1rk-_prs2rkbYX+8vj54CpxnUPTC=hPmbvbxmxg@mail.gmail.com>
 <etPan.535f5f61.74b0dc51.e858@mercurio.local>
 <CAOU_jKD1oY1fAj0J8n5S4Ma-PtMQShs3ZfMtkhUGmRxk7p3WFA@mail.gmail.com>
 <CAOU_jKBdm=eXSPKX+=ihtDJcC8X-+x05rNAfPH=29d4RvOwmYw@mail.gmail.com>
 <92A1E9E9-B0A1-4EC9-B8A8-373FD1584AEF@gopivotal.com>
 <CAOU_jKDv1Nuf3ZaN7gJE41BeiuhLyPzz_AUg7t0nVE4Z3x1Kow@mail.gmail.com>
 <15690081-D24F-42CA-AB79-445CBA00802B@rabbitmq.com>
 <5363A0A7.9030901@rabbitmq.com>
 <CAOU_jKBbFKBNgDFTMMSwMYVmOF+tQ5CXopJHzkkh5rnyGmigQA@mail.gmail.com>
 <536A2101.9080103@rabbitmq.com>
 <CAOU_jKCa1Nd+n2S2dcBeXJpWR+N_Kw9YD-di0q-nxkxvBz-LzA@mail.gmail.com>
Message-ID: <536B5988.8020807@rabbitmq.com>

On 07/05/14 23:21, srikanth tns wrote:
>>         Also I noticed in the management UI , the listconnections does not
>>         show the connections status as running or blocked , it just shows
>>         blank ? does it mean something ?
>>
>>     That shouldn't happen. Please post a screenshot.

> here's the screenshot

Ah, you're using STOMP. That's a known limitation I'm afraid, we don't 
show status information (or any stats) for non-AMQP connections. 
Hopefully one of these days we will.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From gdubicki at bidlab.pl  Thu May  8 14:00:31 2014
From: gdubicki at bidlab.pl (gdubicki)
Date: Thu, 8 May 2014 06:00:31 -0700 (PDT)
Subject: [rabbitmq-discuss] IPv6 issue?
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD17D60BA7@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD17D60BA7@G9W0721.americas.hpqcorp.net>
Message-ID: <1399554031930-35422.post@n5.nabble.com>

Hi,

For the reference I would like to report that I have had similar problem
with rabbitmq 2.6.16:

I have had IPv6 turned off in sysctl.conf via:

net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1

..but my rabbitmq still listened on tcp6:

2014-05-08 14:43:32 root at api:~ # netstat -an|grep 5672
tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:55672           0.0.0.0:*               LISTEN
tcp6       0      0 :::5672                 :::*                    LISTEN

Adding:

{tcp_listeners, [{5672, "0.0.0.0"}]}

..to rabbitmq.config *did not* help but adding:

RABBITMQ_NODE_IP_ADDRESS=0.0.0.0

..to the rabbitmq-env.conf did:

2014-05-08 14:59:27 root at api:~ # netstat -an|grep 5672
tcp        0      0 0.0.0.0:5672            0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:55672           0.0.0.0:*               LISTEN




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/IPv6-issue-tp11368p35422.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From xeonmailinglist at gmail.com  Thu May  8 14:06:17 2014
From: xeonmailinglist at gmail.com (xeon Mailinglist)
Date: Thu, 8 May 2014 06:06:17 -0700 (PDT)
Subject: [rabbitmq-discuss] UNEXPECTED_FRAME - expected content header for
 class 60, got non content header frame instead
Message-ID: <401f3f74-a9be-4a8b-97ea-fc1938a6dbfc@googlegroups.com>

I want to execute a set of actions in parallel, so I am trying to run 
python multiprocessing to execute a remote function that I call with the 
help of celery.
RabbitMQ is the message broker.

My program runs  ok if I just run one process. But when I run more than one 
process, I get the error below. As far as I got, the issue is with 
concurrent publishing on the same channel. 

RabbitMQ doesn't support concurrent call? I should make this call 
serializable?

  File "/usr/local/lib/python2.7/dist-packages/amqp/connection.py", line 
526, in _close
    (class_id, method_id), ConnectionError)
UnexpectedFrame: Basic.publish: (505) UNEXPECTED_FRAME - expected content 
header for class 60, got non content header frame instead



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/def8e94d/attachment.html>

From simon at rabbitmq.com  Thu May  8 14:24:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 14:24:57 +0100
Subject: [rabbitmq-discuss] UNEXPECTED_FRAME - expected content header
 for class 60, got non content header frame instead
In-Reply-To: <401f3f74-a9be-4a8b-97ea-fc1938a6dbfc@googlegroups.com>
References: <401f3f74-a9be-4a8b-97ea-fc1938a6dbfc@googlegroups.com>
Message-ID: <536B85A9.7040501@rabbitmq.com>

On 08/05/14 14:06, xeon Mailinglist wrote:
> I want to execute a set of actions in parallel, so I am trying to run
> python multiprocessing to execute a remote function that I call with the
> help of celery.
> RabbitMQ is the message broker.
>
> My program runs  ok if I just run one process. But when I run more than
> one process, I get the error below. As far as I got, the issue is with
> concurrent publishing on the same channel.
>
> RabbitMQ doesn't support concurrent call? I should make this call
> serializable?

Not on the same channel. As long as you open one channel per thread you 
should be good.

Cheers, Simon

>    File "/usr/local/lib/python2.7/dist-packages/amqp/connection.py",
> line 526, in _close
>      (class_id, method_id), ConnectionError)
> UnexpectedFrame: Basic.publish: (505) UNEXPECTED_FRAME - expected
> content header for class 60, got non content header frame instead

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May  8 14:33:32 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 May 2014 14:33:32 +0100
Subject: [rabbitmq-discuss] IPv6 issue?
In-Reply-To: <1399554031930-35422.post@n5.nabble.com>
References: <5F389C517756284F80239F55BCA5DDDD17D60BA7@G9W0721.americas.hpqcorp.net>
 <1399554031930-35422.post@n5.nabble.com>
Message-ID: <536B87AC.7050401@rabbitmq.com>

On 08/05/14 14:00, gdubicki wrote:
> For the reference I would like to report that I have had similar problem
> with rabbitmq 2.6.16:

There was no RabbitMQ 2.6.16 release.

> I have had IPv6 turned off in sysctl.conf via:
>
> net.ipv6.conf.all.disable_ipv6 = 1
> net.ipv6.conf.default.disable_ipv6 = 1
> net.ipv6.conf.lo.disable_ipv6 = 1
>
> ..but my rabbitmq still listened on tcp6:
>
> 2014-05-08 14:43:32 root at api:~ # netstat -an|grep 5672
> tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN
> tcp        0      0 0.0.0.0:55672           0.0.0.0:*               LISTEN
> tcp6       0      0 :::5672                 :::*                    LISTEN

If those disable_ipv6 config items had taken effect then your system 
would not permit IPv6 connections at all. Since we can see IPv6 
connections I suggest the sysctl.conf changes did not take effect.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From gdubicki at bidlab.pl  Thu May  8 14:56:09 2014
From: gdubicki at bidlab.pl (gdubicki)
Date: Thu, 8 May 2014 06:56:09 -0700 (PDT)
Subject: [rabbitmq-discuss] IPv6 issue?
In-Reply-To: <536B87AC.7050401@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD17D60BA7@G9W0721.americas.hpqcorp.net>
 <1399554031930-35422.post@n5.nabble.com> <536B87AC.7050401@rabbitmq.com>
Message-ID: <CAE4r1FEVmLBGQWE67tgfQv6Qh72JBLZLHkDueh3B5bR8vQ1J0w@mail.gmail.com>

2014-05-08 15:34 GMT+02:00 Simon MacMullen-2 [via RabbitMQ] <
ml-node+s1065348n35425h38 at n5.nabble.com>:

> On 08/05/14 14:00, gdubicki wrote:
> > For the reference I would like to report that I have had similar problem
> > with rabbitmq 2.6.16:
>
> There was no RabbitMQ 2.6.16 release.
>
> Rabbitmq 3.1.5, sorry.

> I have had IPv6 turned off in sysctl.conf via:
> >
> > net.ipv6.conf.all.disable_ipv6 = 1
> > net.ipv6.conf.default.disable_ipv6 = 1
> > net.ipv6.conf.lo.disable_ipv6 = 1
> >
> > ..but my rabbitmq still listened on tcp6:
> >
> > 2014-05-08 14:43:32 root at api:~ # netstat -an|grep 5672
> > tcp        0      0 0.0.0.0:15672           0.0.0.0:*
> LISTEN
> > tcp        0      0 0.0.0.0:55672           0.0.0.0:*
> LISTEN
> > tcp6       0      0 :::5672                 :::*
>  LISTEN
>
> If those disable_ipv6 config items had taken effect then your system
> would not permit IPv6 connections at all. Since we can see IPv6
> connections I suggest the sysctl.conf changes did not take effect.
>
> Cheers, Simon
>

Apparently you can still bind a socket to IPv6 even if it is turned off
with sysctl - see this http://askubuntu.com/a/381623/254957 and similar
stories about sshd etc. Maybe unloading a kernel IPv6 module (if it is
compiled as a module) would help but I do not need it so much to mess with
my server's kernel.


>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=35425&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
> http://rabbitmq.1065348.n5.nabble.com/IPv6-issue-tp11368p35425.html
>  To unsubscribe from IPv6 issue?, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=11368&code=Z2R1Ymlja2lAYmlkbGFiLnBsfDExMzY4fC00ODgxODEyMTY=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>



-- 
*Grzegorz Dubicki*

*Bidlab Sp. z o.o. *
*ul. Wo?na 9c/2, **61-777 Pozna?*



*visit our website! *
*http://bidlab.pl/* <http://bidlab.pl/>
*join us on facebook!*
*https://www.facebook.com/bidlab* <https://www.facebook.com/bidlab>
*follow us on instagram!*
*www.instagram.com/bidlab* <http://www.instagram.com/bidlab>

If you are not the named recipient and receive this correspondence in
error, you must not copy, distribute or take any action in reliance on it
and you should delete it from your system and notify the sender
immediately. Thank you. Unless otherwise stated, any views or opinions
expressed are solely those of the author and do not represent those of
Bidlab Sp. z o.o.
Niniejsza wiadomo?? zawiera poufne informacje przeznaczone tylko dla
adresata. Je?eli nie jeste?cie Pa?stwo jej adresatem, b?d? otrzymali?cie j?
przez pomy?k?, prosimy o powiadomienie o tym nadawcy oraz jej trwa?e
usuni?cie. Odmienne zachowanie jest niezgodne z interesem Bidlab Sp. z o.o
i mo?e narusza? prawo.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/IPv6-issue-tp11368p35426.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/52577ed1/attachment.html>

From mcintoshj at gmail.com  Thu May  8 17:02:44 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 8 May 2014 11:02:44 -0500
Subject: [rabbitmq-discuss] beam blocking
In-Reply-To: <1399532214699-35415.post@n5.nabble.com>
References: <1399512966246-35412.post@n5.nabble.com>
 <CALPqkio1wkCQLKNj+-QDymRvH_6L-yHFs2s+ML8mrOu-AzcJiQ@mail.gmail.com>
 <1399532214699-35415.post@n5.nabble.com>
Message-ID: <CAD6m6fHwAkck_8EM=wjMCYyPZCMgK82hkt+6eUqxwYDukPjoRA@mail.gmail.com>

Carl:

Also watch out for some nasty kernel bugs - what OS are you running?  We
saw the above error messages, and it wasn't disk IO but a kernel bug on
RHEL 6.2.  Well, Oracle Enterprise Linux, but there's an uptime bug on 6.2
that bit us that looked like a disk io error,

Jason


On Thu, May 8, 2014 at 1:56 AM, carlhoerberg <carl.hoerberg at gmail.com>wrote:

> Ah, makes sense, I'm trying that, thank!
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/beam-blocking-tp35412p35415.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/42fc7dc8/attachment.html>

From sdurgin at presencenetworks.com  Thu May  8 18:57:50 2014
From: sdurgin at presencenetworks.com (Scott Durgin)
Date: Thu, 8 May 2014 13:57:50 -0400
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between exchange
	'xxxxx' in vhost
Message-ID: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>

Using RabbitMQ 3.0.0

No cluster

Access via Spring Framework, RabbitMQ abstraction layer

Running on Amazon EC2

 

We?re using RabbitMQ for an event-driven ?RFID Data in the cloud? solution, and at the core we use RabbitMQ as our messaging layer. It?s been pretty much set-and-forget (which is probably the biggest compliment I can give to the developer community -- so thanks to you and all the contributors for your efforts!).

 

We are running into an issue with our implementation with the following error:

 

NOT_FOUND - no binding between exchange 'TripEvent.COMPLETED' in vhost '/' and queue 'fpms' in vhost '/'

 

We are dynamically creating bindings between exchanges and queues as part of an internal subscription event management function in our solution.  All of a sudden messages stop being delivered. When we go into the console, it shows all the bindings but when you go to unbind, we get the above error message.

 

I wanted to see anybody might be able to point us in a certain direction to understand the core problem we have ? configuration issue, calling something incorrectly, known issue with RabbitMQ, or something.

 

Rabbitmq is so core to our solution, that not knowing why this is happening makes me very uncomfortable. We are about 4-5 weeks away from a production pilot, so of course this issue came about! ?

 

Appreciate any insight, assistance or direction anybody can provide!

 

Thanks 

/Scott

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/aab01fc3/attachment.html>

From michael.laing at nytimes.com  Thu May  8 19:02:18 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 8 May 2014 14:02:18 -0400
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
 exchange 'xxxxx' in vhost
In-Reply-To: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
References: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
Message-ID: <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>

The first thing to do is to upgrade that old rabbit. -ml


On Thu, May 8, 2014 at 1:57 PM, Scott Durgin
<sdurgin at presencenetworks.com>wrote:

> Using RabbitMQ 3.0.0
>
> No cluster
>
> Access via Spring Framework, RabbitMQ abstraction layer
>
> Running on Amazon EC2
>
>
>
> We?re using RabbitMQ for an event-driven ?RFID Data in the cloud?
> solution, and at the core we use RabbitMQ as our messaging layer. It?s been
> pretty much set-and-forget (which is probably the biggest compliment I can
> give to the developer community -- so thanks to you and all the
> contributors for your efforts!).
>
>
>
> We are running into an issue with our implementation with the following
> error:
>
>
>
> NOT_FOUND - no binding between exchange 'TripEvent.COMPLETED' in vhost '/'
> and queue 'fpms' in vhost '/'
>
>
>
> We are dynamically creating bindings between exchanges and queues as part
> of an internal subscription event management function in our solution.  All
> of a sudden messages stop being delivered. When we go into the console, it
> shows all the bindings but when you go to unbind, we get the above error
> message.
>
>
>
> I wanted to see anybody might be able to point us in a certain direction
> to understand the core problem we have ? configuration issue, calling
> something incorrectly, known issue with RabbitMQ, or something.
>
>
>
> Rabbitmq is so core to our solution, that not knowing why this is
> happening makes me very uncomfortable. We are about 4-5 weeks away from a
> production pilot, so of course this issue came about! ?
>
>
>
> Appreciate any insight, assistance or direction anybody can provide!
>
>
>
> Thanks
>
> /Scott
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/2b0c34bb/attachment.html>

From ankit2186 at gmail.com  Thu May  8 20:11:28 2014
From: ankit2186 at gmail.com (ankit2186)
Date: Thu, 8 May 2014 12:11:28 -0700 (PDT)
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <5368B1E9.1070500@rabbitmq.com>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
 <5368B1E9.1070500@rabbitmq.com>
Message-ID: <1399576288237-35430.post@n5.nabble.com>

For some reason I have to create queue through shell script command as well
as same queue through Java code too.

For shell script I am trying to create with management plugin:
rabbitmqadmin declare queue name="FOO" durable=true auto_delete=false
`arguments={"x-message-ttl":86400000}`

which gives not error in rabbit at host.log

but when I create same queue with parameters in java:
Map<String, Object> args = new HashMap<String, Object>();
args.put("x-message-ttl", new Integer (messageTTL.intValue() *1000));
Ch.queueDeclare(FOO, true, false, false, args);

I am getting error in rabbit at host.log
=INFO REPORT==== 8-May-2014::18:54:22 ===
accepting AMQP connection <0.308.0> (10.3.14.107:41306 -> 10.3.14.107:5672)

=ERROR REPORT==== 8-May-2014::18:54:22 ===
connection <0.308.0>, channel 1 - error:
{amqp_error,precondition_failed,
            "inequivalent arg 'x-message-ttl'for queue 'FOO' in vhost '/':
received the value '86400000' of type 'signedint' but current is none",
            'queue.declare'}

and java code throws: 
ERROR : AMQPManager - clean connection shutdown; reason: Attempt to use
closed channel
ERROR : AMQPManager - Exception occurred while publishing event
UnknownException: com.rabbitmq.client.AlreadyClosedException: clean
connection shutdown; reason: Attempt to use closed channel
       




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-get-list-of-declared-exchanges-and-queues-in-rabbitmq-using-Java-tp35352p35430.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From srinatsr at cisco.com  Thu May  8 20:55:04 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 8 May 2014 19:55:04 +0000
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done through
	trace?
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB06303@xmb-aln-x10.cisco.com>

Hello All,

I have bind my queue with trace and log exchange,  I need to know which node actually consumed the message.

How to find out,

@Override
       public void onMessage(Message message, Channel channel) throws Exception {

             QueueMonitorRespone queueMonitorRespone = new QueueMonitorRespone();
              queueMonitorRespone.setExchange(message.getMessageProperties().getReceivedExchange());
              queueMonitorRespone.setRoutingKey(message.getMessageProperties().getReceivedRoutingKey());
              queueMonitorRespone.setDeliveryMode(message.getMessageProperties().getDeliveryMode().name());
              queueMonitorRespone.setTimestamp(message.getMessageProperties().getTimestamp());
             queueMonitorRespone.setMessageBody(new String(message.getBody()));

I getting trace log msgs and bind my queue to trace log.  From those messages I am getting the above info.

I am getting it delivered, but who acutally consumed?
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/7fa66508/attachment.html>

From sdurgin at presencenetworks.com  Thu May  8 21:32:44 2014
From: sdurgin at presencenetworks.com (Scott Durgin)
Date: Thu, 8 May 2014 16:32:44 -0400
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
	exchange 'xxxxx' in vhost
In-Reply-To: <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>
References: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
 <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>
Message-ID: <018c01cf6afc$ab3d0700$01b71500$@presencenetworks.com>

Thanks, yes, we?ve done that? we?re testing now; that said, it would be nice to know what the cause of the problem was because when I am in production this kind of service disruption would be incredibly painful (and kill my SLAs).

 

Appreciate any additional perspectives.

 

Thanks

 

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Laing, Michael
Sent: Thursday, May 08, 2014 2:02 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between exchange 'xxxxx' in vhost

 

The first thing to do is to upgrade that old rabbit. -ml

 

On Thu, May 8, 2014 at 1:57 PM, Scott Durgin <sdurgin at presencenetworks.com> wrote:

Using RabbitMQ 3.0.0

No cluster

Access via Spring Framework, RabbitMQ abstraction layer

Running on Amazon EC2

 

We?re using RabbitMQ for an event-driven ?RFID Data in the cloud? solution, and at the core we use RabbitMQ as our messaging layer. It?s been pretty much set-and-forget (which is probably the biggest compliment I can give to the developer community -- so thanks to you and all the contributors for your efforts!).

 

We are running into an issue with our implementation with the following error:

 

NOT_FOUND - no binding between exchange 'TripEvent.COMPLETED' in vhost '/' and queue 'fpms' in vhost '/'

 

We are dynamically creating bindings between exchanges and queues as part of an internal subscription event management function in our solution.  All of a sudden messages stop being delivered. When we go into the console, it shows all the bindings but when you go to unbind, we get the above error message.

 

I wanted to see anybody might be able to point us in a certain direction to understand the core problem we have ? configuration issue, calling something incorrectly, known issue with RabbitMQ, or something.

 

Rabbitmq is so core to our solution, that not knowing why this is happening makes me very uncomfortable. We are about 4-5 weeks away from a production pilot, so of course this issue came about! J

 

Appreciate any insight, assistance or direction anybody can provide!

 

Thanks 

/Scott

 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/f72cb512/attachment.html>

From srinatsr at cisco.com  Thu May  8 21:52:06 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 8 May 2014 20:52:06 +0000
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done
 through	trace?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB06303@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB06303@xmb-aln-x10.cisco.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB063AD@xmb-aln-x10.cisco.com>

Anyone please help

Regards ...*
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Thursday, May 08, 2014 12:55 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done through trace?

Hello All,

I have bind my queue with trace and log exchange,  I need to know which node actually consumed the message.

How to find out,

@Override
       public void onMessage(Message message, Channel channel) throws Exception {

             QueueMonitorRespone queueMonitorRespone = new QueueMonitorRespone();
              queueMonitorRespone.setExchange(message.getMessageProperties().getReceivedExchange());
              queueMonitorRespone.setRoutingKey(message.getMessageProperties().getReceivedRoutingKey());
              queueMonitorRespone.setDeliveryMode(message.getMessageProperties().getDeliveryMode().name());
              queueMonitorRespone.setTimestamp(message.getMessageProperties().getTimestamp());
             queueMonitorRespone.setMessageBody(new String(message.getBody()));

I getting trace log msgs and bind my queue to trace log.  From those messages I am getting the above info.

I am getting it delivered, but who acutally consumed?
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/d680776d/attachment.html>

From srinatsr at cisco.com  Thu May  8 21:55:15 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 8 May 2014 20:55:15 +0000
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done
 through	trace?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB063AD@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB06303@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB063AD@xmb-aln-x10.cisco.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB063C5@xmb-aln-x10.cisco.com>

>From the following how do I know who consumed (delivered to whom)

Firehose notification format
The firehose publishes messages to the topic exchange amq.rabbitmq.trace with
*        routing key either "publish.exchangename", for messages entering the broker, or "deliver.queuename", for messages leaving the broker;
*        headers containing metadata about the original message:
Header

Type

Description

exchange_name

longstr

name of the exchange to which the message was published

routing_keys

array

routing key plus contents of CC and BCC headers<http://www.rabbitmq.com/sender-selected.html>

properties

table

content properties<http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic>

node

longstr

Erlang node on which the trace message was generated

redelivered

signedint

whether the message has its redelivered flag set (messages leaving the broker only)

*        body corresponding to the body of the original message


Regards ...*
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Thursday, May 08, 2014 1:52 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Who conusmed messages - Can it be done through trace?

Anyone please help

Regards ...*
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Thursday, May 08, 2014 12:55 PM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done through trace?

Hello All,

I have bind my queue with trace and log exchange,  I need to know which node actually consumed the message.

How to find out,

@Override
       public void onMessage(Message message, Channel channel) throws Exception {

             QueueMonitorRespone queueMonitorRespone = new QueueMonitorRespone();
              queueMonitorRespone.setExchange(message.getMessageProperties().getReceivedExchange());
              queueMonitorRespone.setRoutingKey(message.getMessageProperties().getReceivedRoutingKey());
              queueMonitorRespone.setDeliveryMode(message.getMessageProperties().getDeliveryMode().name());
              queueMonitorRespone.setTimestamp(message.getMessageProperties().getTimestamp());
             queueMonitorRespone.setMessageBody(new String(message.getBody()));

I getting trace log msgs and bind my queue to trace log.  From those messages I am getting the above info.

I am getting it delivered, but who acutally consumed?
Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/98fb0565/attachment.html>

From arunrao.seattle at gmail.com  Fri May  9 02:19:06 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Thu, 8 May 2014 18:19:06 -0700
Subject: [rabbitmq-discuss] Basic.Acks terribly slow
Message-ID: <CAEJg2GDX_O-M+dm2ZD+fhs-KurN9skRkbdxR6MKAz9xxWVv4aQ@mail.gmail.com>

Hi guys -

Producers (.NET clients) are publishing messages to RabbitMQ cluster at a
rate of 800 to 900 messages/sec. At this rate, RabbitMQ response times to
Ack producers goes significantly higher. It takes longer than 500ms to ack
with a delivery-tag, per channel. (Total Connections: 3000+ at all times.)

Objective: Reduce RabbitMQ server response time to less than 100ms when
acknowledging messages on each channel. (Please see we are reusing
connections.)

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140508/631038ea/attachment.html>

From carl.hoerberg at gmail.com  Fri May  9 03:00:04 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 8 May 2014 19:00:04 -0700 (PDT)
Subject: [rabbitmq-discuss] beam blocking
In-Reply-To: <CAD6m6fHwAkck_8EM=wjMCYyPZCMgK82hkt+6eUqxwYDukPjoRA@mail.gmail.com>
References: <1399512966246-35412.post@n5.nabble.com>
 <CALPqkio1wkCQLKNj+-QDymRvH_6L-yHFs2s+ML8mrOu-AzcJiQ@mail.gmail.com>
 <1399532214699-35415.post@n5.nabble.com>
 <CAD6m6fHwAkck_8EM=wjMCYyPZCMgK82hkt+6eUqxwYDukPjoRA@mail.gmail.com>
Message-ID: <1399600804803-35436.post@n5.nabble.com>

ubuntu 12.04, with all upgrades applied.. It might have been an EC2 EBS
problem. We changed  instance type and enabled EBS optimization. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/beam-blocking-tp35412p35436.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri May  9 03:00:52 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 8 May 2014 19:00:52 -0700 (PDT)
Subject: [rabbitmq-discuss] silent crashes
Message-ID: <1399600852355-35437.post@n5.nabble.com>

Have a cluster (an independent cluster from the beam blocking issues reported
earlier) which sometimes crashes on traffic spikes, with absolutely nothing
in the logs. Apport does a crash dump, but nothing in syslog or anywhere.
How can we diagnose this better? 

RabbitMQ 3.3.1, Erlang 17, ubuntu 12.04 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/silent-crashes-tp35437.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri May  9 11:38:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 May 2014 11:38:14 +0100
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <1399576288237-35430.post@n5.nabble.com>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
 <5368B1E9.1070500@rabbitmq.com> <1399576288237-35430.post@n5.nabble.com>
Message-ID: <536CB016.4060108@rabbitmq.com>

On 08/05/14 20:11, ankit2186 wrote:
> For some reason I have to create queue through shell script command as well
> as same queue through Java code too.
>
> For shell script I am trying to create with management plugin:
> rabbitmqadmin declare queue name="FOO" durable=true auto_delete=false
> `arguments={"x-message-ttl":86400000}`
>
> which gives not error in rabbit at host.log

It will give an error if the queue already exists without the TTL 
argument...

> =ERROR REPORT==== 8-May-2014::18:54:22 ===
> connection <0.308.0>, channel 1 - error:
> {amqp_error,precondition_failed,
>              "inequivalent arg 'x-message-ttl'for queue 'FOO' in vhost '/':
> received the value '86400000' of type 'signedint' but current is none",
>              'queue.declare'}

...which is what's happening here. This is not management vs Java, this 
is whether the queue already exists with different arguments.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May  9 11:45:10 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 May 2014 11:45:10 +0100
Subject: [rabbitmq-discuss] Basic.Acks terribly slow
In-Reply-To: <CAEJg2GDX_O-M+dm2ZD+fhs-KurN9skRkbdxR6MKAz9xxWVv4aQ@mail.gmail.com>
References: <CAEJg2GDX_O-M+dm2ZD+fhs-KurN9skRkbdxR6MKAz9xxWVv4aQ@mail.gmail.com>
Message-ID: <536CB1B6.3000101@rabbitmq.com>

On 09/05/14 02:19, Arun Rao wrote:
> Hi guys -
>
> Producers (.NET clients) are publishing messages to RabbitMQ cluster at
> a rate of 800 to 900 messages/sec. At this rate, RabbitMQ response times
> to Ack producers goes significantly higher. It takes longer than 500ms
> to ack with a delivery-tag, per channel. (Total Connections: 3000+ at
> all times.)

Fundamentally latency is likely to go up when you push the server 
harder; when any given piece of work needs to be done the component that 
needs to do it is doing something else that's unlikely to be avoidable.

> Objective: Reduce RabbitMQ server response time to less than 100ms when
> acknowledging messages on each channel. (Please see we are reusing
> connections.)

You don't say whether the messages are persistent but I would guess from 
the performance numbers you give that they are. In that case you could 
lower latency by moving to an SSD.

But really, if it's a problem that publish confirms are taking 500ms to 
come back then you might have the wrong expectations; RabbitMQ tries to 
optimise for throughput rather than latency when deciding when to send 
confirms.

Is each producer waiting for each confirm to come back before publishing 
the next message? If so I suggest not doing that; allow publishers to 
have multiple outstanding messages and handle confirms as they come in. 
If you are already doing that, why is waiting 500ms a big deal?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May  9 11:51:02 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 May 2014 11:51:02 +0100
Subject: [rabbitmq-discuss] Who conusmed messages - Can it be done
 through trace?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB063C5@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB06303@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB063AD@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB063C5@xmb-aln-x10.cisco.com>
Message-ID: <536CB316.7050205@rabbitmq.com>

On 08/05/14 21:55, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES 
INC at Cisco) wrote:
>  From the following how do I know who consumed (delivered to whom)

I'm afraid you don't. This information might be added in the future but 
for the time being it's not there.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jon.bergli.heier at zisson.no  Fri May  9 12:26:11 2014
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Fri, 9 May 2014 11:26:11 +0000
Subject: [rabbitmq-discuss] Network partition queue issues
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BAB3D3786A@osl02-exc-001>

Hi,

Yesterday we had two unfortunate network partitions on one of our two-node
clusters, about an hour apart. After the second partition, when we restarted
one of the nodes, we encountered some issues:

1) one of the queues disappeared, including any queued messages.
2) two other queues appears hung and doesn't respond to anything.

We've managed to resolve 1) by recreating the queue and bindings and
republishing the messages, but 2) is still a problem, as we can't do anything
with these queues, not even delete them (the management interface and API just
hangs when trying to delete). Any consumers also appears to hang when
interacting with these queues. Restarting the entire cluster also didn't help.

Is there any way to prevent 1), and can we somehow solve 2) without resetting
the entire cluster? We're currently running RabbitMQ 3.2.4. I have logs
available, but I'd rather not post these publicly since there's some sensitive
data in there.

FTR we're using autoheal and all queues on the cluster have ha-mode=all and
ha-sync-mode=automatic. Also, according to heartbeat, the nodes only appears to
have lost contact for a few seconds (nothing seems to be logged during the
second split).

Thanks,
Jon

From arunrao.seattle at gmail.com  Fri May  9 14:03:59 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 9 May 2014 06:03:59 -0700
Subject: [rabbitmq-discuss] Basic.Acks terribly slow
In-Reply-To: <536CB1B6.3000101@rabbitmq.com>
References: <CAEJg2GDX_O-M+dm2ZD+fhs-KurN9skRkbdxR6MKAz9xxWVv4aQ@mail.gmail.com>
 <536CB1B6.3000101@rabbitmq.com>
Message-ID: <CAEJg2GDZDDHh1kcBV--z9qHu3uoy1RF8kFmiA5v74ROi464erA@mail.gmail.com>

Thanks Simon.

The messages are non-persistent but the queues are mirrored to exactly one
other node on a 4-node cluster. I was thinking if I created an exchange for
each routing key, rather than use one exchange and then route by routing
key, would that help? (I am not trying work around anything but I wanted to
know if I am overloading one Exchange when I could create multiple
exchanges. I understand that Exchanges are always HA'ed (even when not
specified) in a cluster. Does that mean that routing and acknowledging to
the messages happens out of just one node on a 4-node cluster? How about
Heartbeats? I am not saying this is a bottleneck but I am trying to
understand the functionality.)

One other key thing I missed to mention: (
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.3.1/rabbitmq-dotnet-client-3.3.1-user-guide.pdf
)

*There are two styles of interaction available to ModelBase:*
*? synchronous, RPC-style interaction, e.g. ExchangeDeclare, BasicGet and
BasicConsume.*
*? asynchronous, event-style interaction, e.g. BasicAck, BasicPublish.*

Is it true that .NET client library considers BasicPublish and BasicAck as
Events (on a tcp connection), meaning it is not holding up any resources?

(BTW, I am not a developer but I Admin RabbitMQ clusters in production.)
The other take away is to allow publish multiple messages and let .NET
client library keep track of the delivery-tag counts from the server.

Thanks!


On Fri, May 9, 2014 at 3:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 09/05/14 02:19, Arun Rao wrote:
>
>> Hi guys -
>>
>> Producers (.NET clients) are publishing messages to RabbitMQ cluster at
>> a rate of 800 to 900 messages/sec. At this rate, RabbitMQ response times
>> to Ack producers goes significantly higher. It takes longer than 500ms
>> to ack with a delivery-tag, per channel. (Total Connections: 3000+ at
>> all times.)
>>
>
> Fundamentally latency is likely to go up when you push the server harder;
> when any given piece of work needs to be done the component that needs to
> do it is doing something else that's unlikely to be avoidable.
>
>
>  Objective: Reduce RabbitMQ server response time to less than 100ms when
>> acknowledging messages on each channel. (Please see we are reusing
>> connections.)
>>
>
> You don't say whether the messages are persistent but I would guess from
> the performance numbers you give that they are. In that case you could
> lower latency by moving to an SSD.
>
> But really, if it's a problem that publish confirms are taking 500ms to
> come back then you might have the wrong expectations; RabbitMQ tries to
> optimise for throughput rather than latency when deciding when to send
> confirms.
>
> Is each producer waiting for each confirm to come back before publishing
> the next message? If so I suggest not doing that; allow publishers to have
> multiple outstanding messages and handle confirms as they come in. If you
> are already doing that, why is waiting 500ms a big deal?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/27c3ec6e/attachment.html>

From ankit2186 at gmail.com  Fri May  9 14:54:44 2014
From: ankit2186 at gmail.com (ankit2186)
Date: Fri, 9 May 2014 06:54:44 -0700 (PDT)
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <536CB016.4060108@rabbitmq.com>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
 <5368B1E9.1070500@rabbitmq.com> <1399576288237-35430.post@n5.nabble.com>
 <536CB016.4060108@rabbitmq.com>
Message-ID: <1399643684152-35443.post@n5.nabble.com>

I am trying to create queue with same parameters along with
x-message-ttlshell script:rabbitmqadmin declare queue name="FOO"
durable=true auto_delete=false `arguments={"x-message-ttl":86400000}`[I am
not sure how to pass exchange through commandline]Map<String, Object> args =
new HashMap<String, Object>();args.put("x-message-ttl", new Integer
(messageTTL.intValue() *1000));Ch.queueDeclare(FOO, rabbitDurable, false,
rabbitAutoDelete, args);where messageTTL =
864;rabbitDurable=true;rabbitAutoDelete=false



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-get-list-of-declared-exchanges-and-queues-in-rabbitmq-using-Java-tp35352p35443.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/904c0da7/attachment.html>

From simon at rabbitmq.com  Fri May  9 15:04:47 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 May 2014 15:04:47 +0100
Subject: [rabbitmq-discuss] Basic.Acks terribly slow
In-Reply-To: <CAEJg2GDZDDHh1kcBV--z9qHu3uoy1RF8kFmiA5v74ROi464erA@mail.gmail.com>
References: <CAEJg2GDX_O-M+dm2ZD+fhs-KurN9skRkbdxR6MKAz9xxWVv4aQ@mail.gmail.com>	<536CB1B6.3000101@rabbitmq.com>
 <CAEJg2GDZDDHh1kcBV--z9qHu3uoy1RF8kFmiA5v74ROi464erA@mail.gmail.com>
Message-ID: <536CE07F.4040002@rabbitmq.com>

On 09/05/14 14:03, Arun Rao wrote:
> Thanks Simon.
>
> The messages are non-persistent but the queues are mirrored to exactly
> one other node on a 4-node cluster.

Ah right, that might also account for the latency if there are some 
internal network round-trips before a messages is confirmed.

> I was thinking if I created an
> exchange for each routing key, rather than use one exchange and then
> route by routing key, would that help?  (I am not trying work around
> anything but I wanted to know if I am overloading one Exchange when I
> could create multiple exchanges. I understand that Exchanges are always
> HA'ed (even when not specified) in a cluster. Does that mean that
> routing and acknowledging to the messages happens out of just one node
> on a 4-node cluster?

No - exchanges are stateless routing logic so when we say "they are 
always HA" we mean the logic will be executed on whichever node the 
results are needed.

> How about Heartbeats? I am not saying this is a
> bottleneck but I am trying to understand the functionality.)

Heartbeaters live on the same node as the channel they are heartbeating for.

> One other key thing I missed to mention:
> (http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.3.1/rabbitmq-dotnet-client-3.3.1-user-guide.pdf)
> /
> /
> /There are two styles of interaction available to ModelBase:/
> /? synchronous, RPC-style interaction, e.g. ExchangeDeclare, BasicGet
> and BasicConsume./
> /? asynchronous, event-style interaction, e.g. BasicAck, BasicPublish./
> /
> /
> Is it true that .NET client library considers BasicPublish and BasicAck
> as Events (on a tcp connection), meaning it is not holding up any resources?

Yes.

> (BTW, I am not a developer but I Admin RabbitMQ clusters in production.)
> The other take away is to allow publish multiple messages and let .NET
> client library keep track of the delivery-tag counts from the server.

Definitely - that's likely to make an enormous difference.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May  9 15:07:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 May 2014 15:07:59 +0100
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
 exchange 'xxxxx' in vhost
In-Reply-To: <018c01cf6afc$ab3d0700$01b71500$@presencenetworks.com>
References: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
 <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>
 <018c01cf6afc$ab3d0700$01b71500$@presencenetworks.com>
Message-ID: <536CE13F.8020303@rabbitmq.com>

Unfortunately there's not much to go on here, but this does sound like 
it has some features in common with a bug we fixed in 3.2.0. So if 
anyone sees this behaviour with >= 3.2.0 I would be very interested to 
hear about it, but otherwise I am inclined to leave it.

Cheers, Simon

On 08/05/14 21:32, Scott Durgin wrote:
> Thanks, yes, we?ve done that? we?re testing now; that said, it would be
> nice to know what the cause of the problem was because when I am in
> production this kind of service disruption would be incredibly painful
> (and kill my SLAs).
>
> Appreciate any additional perspectives.
>
> Thanks
>
> *From:*rabbitmq-discuss
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of
> *Laing, Michael
> *Sent:* Thursday, May 08, 2014 2:02 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Problem: NOT_FOUND - no binding
> between exchange 'xxxxx' in vhost
>
> The first thing to do is to upgrade that old rabbit. -ml
>
> On Thu, May 8, 2014 at 1:57 PM, Scott Durgin
> <sdurgin at presencenetworks.com <mailto:sdurgin at presencenetworks.com>> wrote:
>
> Using RabbitMQ 3.0.0
>
> No cluster
>
> Access via Spring Framework, RabbitMQ abstraction layer
>
> Running on Amazon EC2
>
> We?re using RabbitMQ for an event-driven ?RFID Data in the cloud?
> solution, and at the core we use RabbitMQ as our messaging layer. It?s
> been pretty much set-and-forget (which is probably the biggest
> compliment I can give to the developer community -- so thanks to you and
> all the contributors for your efforts!).
>
> We are running into an issue with our implementation with the following
> error:
>
> NOT_FOUND - no binding between exchange 'TripEvent.COMPLETED' in vhost
> '/' and queue 'fpms' in vhost '/'
>
> We are dynamically creating bindings between exchanges and queues as
> part of an internal subscription event management function in our
> solution.  All of a sudden messages stop being delivered. When we go
> into the console, it shows all the bindings but when you go to unbind,
> we get the above error message.
>
> I wanted to see anybody might be able to point us in a certain direction
> to understand the core problem we have ? configuration issue, calling
> something incorrectly, known issue with RabbitMQ, or something.
>
> Rabbitmq is so core to our solution, that not knowing why this is
> happening makes me very uncomfortable. We are about 4-5 weeks away from
> a production pilot, so of course this issue came about! J
>
> Appreciate any insight, assistance or direction anybody can provide!
>
> Thanks
>
> /Scott
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From sdurgin at presencenetworks.com  Fri May  9 19:32:04 2014
From: sdurgin at presencenetworks.com (Scott Durgin)
Date: Fri, 9 May 2014 14:32:04 -0400
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
	exchange 'xxxxx' in vhost
In-Reply-To: <536CE13F.8020303@rabbitmq.com>
References: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
 <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>
 <018c01cf6afc$ab3d0700$01b71500$@presencenetworks.com>
 <536CE13F.8020303@rabbitmq.com>
Message-ID: <013d01cf6bb4$fa54cae0$eefe60a0$@presencenetworks.com>

Thank you for investigating. So far with the upgrade we have not been able
to reproduce, but will be keeping a keen eye on this for sure.

For purposes of helping with better information, is there a way to increase
debug logging information that we could turn on and provide if we can
reproduce this (or other issues).

Thanks again for the prompt response.
/sd

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, May 09, 2014 10:08 AM
To: Discussions about RabbitMQ; Scott Durgin
Subject: Re: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
exchange 'xxxxx' in vhost

Unfortunately there's not much to go on here, but this does sound like it
has some features in common with a bug we fixed in 3.2.0. So if anyone sees
this behaviour with >= 3.2.0 I would be very interested to hear about it,
but otherwise I am inclined to leave it.

Cheers, Simon

On 08/05/14 21:32, Scott Durgin wrote:
> Thanks, yes, we've done that. we're testing now; that said, it would 
> be nice to know what the cause of the problem was because when I am in 
> production this kind of service disruption would be incredibly painful 
> (and kill my SLAs).
>
> Appreciate any additional perspectives.
>
> Thanks
>
> *From:*rabbitmq-discuss
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of 
> *Laing, Michael
> *Sent:* Thursday, May 08, 2014 2:02 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Problem: NOT_FOUND - no binding 
> between exchange 'xxxxx' in vhost
>
> The first thing to do is to upgrade that old rabbit. -ml
>
> On Thu, May 8, 2014 at 1:57 PM, Scott Durgin 
> <sdurgin at presencenetworks.com <mailto:sdurgin at presencenetworks.com>>
wrote:
>
> Using RabbitMQ 3.0.0
>
> No cluster
>
> Access via Spring Framework, RabbitMQ abstraction layer
>
> Running on Amazon EC2
>
> We're using RabbitMQ for an event-driven "RFID Data in the cloud"
> solution, and at the core we use RabbitMQ as our messaging layer. It's 
> been pretty much set-and-forget (which is probably the biggest 
> compliment I can give to the developer community -- so thanks to you 
> and all the contributors for your efforts!).
>
> We are running into an issue with our implementation with the 
> following
> error:
>
> NOT_FOUND - no binding between exchange 'TripEvent.COMPLETED' in vhost 
> '/' and queue 'fpms' in vhost '/'
>
> We are dynamically creating bindings between exchanges and queues as 
> part of an internal subscription event management function in our 
> solution.  All of a sudden messages stop being delivered. When we go 
> into the console, it shows all the bindings but when you go to unbind, 
> we get the above error message.
>
> I wanted to see anybody might be able to point us in a certain 
> direction to understand the core problem we have - configuration 
> issue, calling something incorrectly, known issue with RabbitMQ, or
something.
>
> Rabbitmq is so core to our solution, that not knowing why this is 
> happening makes me very uncomfortable. We are about 4-5 weeks away 
> from a production pilot, so of course this issue came about! J
>
> Appreciate any insight, assistance or direction anybody can provide!
>
> Thanks
>
> /Scott
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal


From kansalneha28 at yahoo.com  Fri May  9 19:42:41 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Fri, 9 May 2014 11:42:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Questions on how to handle message reliability.
Message-ID: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>

Hi,

I have been reading about all the different features available to make sure that the message is not lost. I have some questions about the same:
- If I use publisher confirms and waitForConfirms, would the broker hold off on delivering the message to the consumer until ack has been sent to the publisher? 

- If a publisher receives a nack (i.e. waitForConfirms returns a false), the publisher code has to handle retry publishing by itself as many times as it want to in a loop or is there any config/setup in RabbitMQ that helps with republishing?
- How do I check the redelivery flag in the consumer code?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/982f390e/attachment.html>

From lndspereira-rabbit at yahoo.com  Fri May  9 20:18:16 2014
From: lndspereira-rabbit at yahoo.com (Leonardo N. S. Pereira)
Date: Fri, 9 May 2014 12:18:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
Message-ID: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>

Hi all.
I have a three nodes in a cluster deployed on different AWS AZs: A, B and C.
The queues are fully mirrored among nodes, the queues are persistent and cluster partition handler is configured to pause-minority. The RabbitMq version I'm using is 3.3.1
The queues policies are set as:? {"ha-mode":"all","ha-sync-mode":"automatic"} .

I'm bouncing the network connection between two nodes, for instance C and B, in the way that:
- A: can reach C and B
- C: can reach A
- B can reach A
In this case, the cluster get stuck and only recovers when all nodes are restarted.
Is it an expected behavior? 

And if I kill one node, instead of only bounce the connection as before, the cluster is still working.
What I think is expected

Thanks in advance for your time and help

Best Regards,
Leo


?
Leonardo Nogueira de S? Pereira
Tel.: +55 19 3307-5589
Cel.: +55 19 9122-5943
Skype: leonardo_pereira_77
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/1dc47040/attachment.html>

From mklishin at gopivotal.com  Fri May  9 22:24:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 May 2014 17:24:08 -0400
Subject: [rabbitmq-discuss] Questions on how to handle message
 reliability.
In-Reply-To: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>
References: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>
Message-ID: <etPan.536d4784.327b23c6.82a6@giove.local>



On May 9, 2014 at 2:44:06 PM, Neha Kansal (kansalneha28 at yahoo.com) wrote:
> > - If I use publisher confirms and waitForConfirms, would the  
> broker hold off on delivering the message to the consumer until  
> ack has been sent to the publisher?

No, consumers are not aware of publisher confirms, and vice versa.

> - If a publisher receives a nack (i.e. waitForConfirms returns  
> a false), the publisher code has to handle retry publishing by  
> itself as many times as it want to in a loop or is there any config/setup  
> in RabbitMQ that helps with republishing?

You have to handle nacks on your own. Note that it?s actually tricky to
trigger a nack:

http://markmail.org/thread/26va4wjuqbae5efi?

> - How do I check the redelivery flag in the consumer code?

See message properties. Exactly how depend on the client you use.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri May  9 22:36:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 9 May 2014 17:36:38 -0400
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <1399643684152-35443.post@n5.nabble.com>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
 <5368B1E9.1070500@rabbitmq.com> <1399576288237-35430.post@n5.nabble.com>
 <536CB016.4060108@rabbitmq.com> <1399643684152-35443.post@n5.nabble.com>
Message-ID: <etPan.536d4a73.238e1f29.82a6@giove.local>

? On May 9, 2014 at 9:55:55 AM, ankit2186 (ankit2186 at gmail.com) wrote:
> > I am not sure how to pass exchange through commandline

Using "x-dead-letter-exchange? in the JSON document
as documented on

http://www.rabbitmq.com/dlx.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From kansalneha28 at yahoo.com  Fri May  9 23:12:38 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Fri, 9 May 2014 15:12:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Questions on how to handle message
	reliability.
In-Reply-To: <etPan.536d4784.327b23c6.82a6@giove.local>
References: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>
 <etPan.536d4784.327b23c6.82a6@giove.local>
Message-ID: <1399673558.15455.YahooMailNeo@web141701.mail.bf1.yahoo.com>

Thank you for the reply. 

I am using java client and I was browsing the api but still not clear on how to check the redelivery flag in the consumer. Do I check something in delivery.getProperties()?


I am unable to open the link you provided for the nacks, any chance you have a updated link?

Thanks.


On Friday, May 9, 2014 2:24 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
 


On May 9, 2014 at 2:44:06 PM, Neha Kansal (kansalneha28 at yahoo.com) wrote:
> > - If I use publisher confirms and waitForConfirms, would the? 
> broker hold off on delivering the message to the consumer until? 
> ack has been sent to the publisher?

No, consumers are not aware of publisher confirms, and vice versa.

> - If a publisher receives a nack (i.e. waitForConfirms returns? 
> a false), the publisher code has to handle retry publishing by? 
> itself as many times as it want to in a loop or is there any config/setup? 
> in RabbitMQ that helps with republishing?

You have to handle nacks on your own. Note that it?s actually tricky to
trigger a nack:

http://markmail.org/thread/26va4wjuqbae5efi?

> - How do I check the redelivery flag in the consumer code?

See message properties. Exactly how depend on the client you use.
--? 
MK? 

Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/4f018a8a/attachment.html>

From ankit2186 at gmail.com  Fri May  9 23:59:44 2014
From: ankit2186 at gmail.com (ankit2186)
Date: Fri, 9 May 2014 15:59:44 -0700 (PDT)
Subject: [rabbitmq-discuss] How to get list of declared exchanges and
 queues in rabbitmq using Java?
In-Reply-To: <etPan.536d4a73.238e1f29.82a6@giove.local>
References: <1399332190635-35352.post@n5.nabble.com>
 <CAMcAHLVHCKceRqFNynMJP53dtcapME-05K3zY2+jG_3QXExmqQ@mail.gmail.com>
 <5368B1E9.1070500@rabbitmq.com> <1399576288237-35430.post@n5.nabble.com>
 <536CB016.4060108@rabbitmq.com> <1399643684152-35443.post@n5.nabble.com>
 <etPan.536d4a73.238e1f29.82a6@giove.local>
Message-ID: <1399676384060-35452.post@n5.nabble.com>

got answer from stackoverflow,
By default if no expires argument set, false value used, so you have to pass
it via argument json-formated argument. The shell command should looks like
this:

$ rabbitmqadmin declare queue name=FOOdurable=true
arguments='{"exclusive":false,"x-message-ttl":86400000}'
queue declared
Make sure you have valid json strnig, unless you'll get formatting issue.
Also, wrap json string in single quotes or double quotes inside will be
removed.

Now looking for command to validate output for x-message-TTL and exclusive? 

=ERROR REPORT==== 9-May-2014::22:49:24 === connection <0.345.0>, channel 1 -
error: {amqp_error,precondition_failed,  "inequivalent arg
'x-message-ttl'for queue 'FOO' in vhost '/': received the value '86400000'
of type 'signedint' but current is none", 'queue.declare'}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-get-list-of-declared-exchanges-and-queues-in-rabbitmq-using-Java-tp35352p35452.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat May 10 07:46:18 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 10 May 2014 07:46:18 +0100
Subject: [rabbitmq-discuss] Questions on how to handle message
	reliability.
In-Reply-To: <1399673558.15455.YahooMailNeo@web141701.mail.bf1.yahoo.com>
References: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>
 <etPan.536d4784.327b23c6.82a6@giove.local>
 <1399673558.15455.YahooMailNeo@web141701.mail.bf1.yahoo.com>
Message-ID: <536DCB3A.3040009@rabbitmq.com>

On 09/05/14 23:12, Neha Kansal wrote:
> I am using java client and I was browsing the api but still not clear on
> how to check the redelivery flag in the consumer. Do I check something
> in delivery.getProperties()?

http://www.rabbitmq.com/javadoc/com/rabbitmq/client/Envelope.html#isRedeliver%28%29

> I am unable to open the link you provided for the nacks, any chance you
> have a updated link?

http://rabbitmq.1065348.n5.nabble.com/Testing-lightweight-publisher-confirms-td834.html

Matthias.

From vin.degroote at gmail.com  Fri May  9 15:37:51 2014
From: vin.degroote at gmail.com (Vincent Degroote)
Date: Fri, 9 May 2014 07:37:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Purge based on a routing key
Message-ID: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>

Hi,

I would like to know if there is a way to purge messages with a specific 
routing key inside one queue.

Thanks for your answer.

ps: I'm using php-amqlib


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140509/4875df8b/attachment.html>

From michael at rabbitmq.com  Sat May 10 14:10:52 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Sat, 10 May 2014 09:10:52 -0400
Subject: [rabbitmq-discuss] Questions on how to handle message
	reliability.
In-Reply-To: <1399673558.15455.YahooMailNeo@web141701.mail.bf1.yahoo.com>
References: <1399660961.29120.YahooMailNeo@web141702.mail.bf1.yahoo.com>
 <etPan.536d4784.327b23c6.82a6@giove.local>
 <1399673558.15455.YahooMailNeo@web141701.mail.bf1.yahoo.com>
Message-ID: <817D6D80-A1A2-4A5F-9BAC-88BD0DF9D54A@rabbitmq.com>

Yes, see Javadoc

MK

> On 09/05/2014, at 18:12, Neha Kansal <kansalneha28 at yahoo.com> wrote:
> 
> I am using java client and I was browsing the api but still not clear on how to check the redelivery flag in the consumer. Do I check something in delivery.getProperties()?

From michael at rabbitmq.com  Sat May 10 14:11:16 2014
From: michael at rabbitmq.com (Michael Klishin)
Date: Sat, 10 May 2014 09:11:16 -0400
Subject: [rabbitmq-discuss] Purge based on a routing key
In-Reply-To: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>
References: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>
Message-ID: <CC70FB3D-7413-4B9C-814A-2BB81AA0C76E@rabbitmq.com>

No.

MK

> On 09/05/2014, at 10:37, Vincent Degroote <vin.degroote at gmail.com> wrote:
> 
> Hi,
> 
> I would like to know if there is a way to purge messages with a specific routing key inside one queue.
> 
> Thanks for your answer.
> 
> ps: I'm using php-amqlib
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jonstelly at gmail.com  Sun May 11 04:55:36 2014
From: jonstelly at gmail.com (Jon Stelly)
Date: Sat, 10 May 2014 20:55:36 -0700 (PDT)
Subject: [rabbitmq-discuss] dotnet client - Increasing prefetch with
 BasicQoS during HandleBasicDeliver doesn't trigger retrieval of next
 message
Message-ID: <fd20e8d1-8d5e-47ef-93dc-5b7aaae0d081@googlegroups.com>

I have a sort of odd scenario.  I want to process 1 message at a time so I 
call basic qos with a prefetch of 1 and call BasicConsume(), but sometimes 
my processing will end in a long blocking task.  When that happens, I would 
like to increase the qos prefetch to 2 to trigger the next message to be 
received and processed.  The issue is that I don't want to ack the first 
message until after the long blocking process completes successfully.

If I call BasicQoS before acking the first message, the 2nd message isn't 
received until after the long running task completes and the ack is sent. 
 Can anyone explain what's going on and possibly suggest an alternative?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140510/617b8e5b/attachment.html>

From femto.trader at gmail.com  Sun May 11 17:57:51 2014
From: femto.trader at gmail.com (Femto)
Date: Sun, 11 May 2014 09:57:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Using Pika and PyQtGraph (Qt event loop and
	BlockingConnection)
Message-ID: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>

Hello,

I'm trying to build as a data consumer a python script with both
pika (RabbitMQ) and PyQtGraph

Unfortunately I get a frozen PyQtGraph window

My script contains this main function

def main(args):
    #QtGui.QApplication.setGraphicsSystem('raster')
    app = QtGui.QApplication([])
    #mw = QtGui.QMainWindow()
    #mw.resize(800,800)

    pg.setConfigOption('background', 'w')
    pg.setConfigOption('foreground', 'k')

    win = pg.GraphicsWindow(title="Basic plotting examples")
    win.resize(1000,600)
    win.setWindowTitle('plot')

    # Enable antialiasing for prettier plots
    pg.setConfigOptions(antialias=True)
    
    order_book_plot = OrderBookPlot(args, win)
    
    import sys
    ## Start Qt event loop unless running in interactive mode or using 
pyside.
    if (sys.flags.interactive != 1) or not hasattr(QtCore, 'PYQT_VERSION'):
        QtGui.QApplication.instance().exec_()

and also this class

class ...:
    ....
    def init_rabbitmq_connection(self):
        connection = pika.BlockingConnection(pika.ConnectionParameters(
            host='localhost'))
        channel = connection.channel()

        exchange = 'topic_logs'

        channel.exchange_declare(exchange=exchange,
                         type='topic')

        result = channel.queue_declare(exclusive=True)
        queue_name = result.method.queue

        binding_keys = self.args.binding_keys.split(',')

        for binding_key in binding_keys:
            channel.queue_bind(exchange=exchange,
                       queue=queue_name,
                       routing_key=binding_key)

        logging.info(' [*] Waiting for data. To exit press CTRL+C')


        channel.basic_consume(self.rabbitmq_data_callback,
                      queue=queue_name,
                      no_ack=True)

        channel.start_consuming()


maybe you noticed Qt have an event loop

and I think it's doing odd things with pika.BlockingConnection


Any help is welcome.

Femto
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140511/838a70d1/attachment.html>

From sven_weber at excite.com  Mon May 12 02:05:22 2014
From: sven_weber at excite.com (Full Name)
Date: Sun, 11 May 2014 21:05:22 -0400
Subject: [rabbitmq-discuss] rabbitmq and cpp
Message-ID: <20140511210522.18702@web005.roc2.bluetie.com>

Hi,

I am new to RabbitMQ and to AMQP in general. I didn't find a forum/mailing list for general AMQP questions. Just a forum at amqp.org, but that is kind of dead. I want to exchange messages between Java and c++ applications. The Java tutorials for rabbitmq were easy, but the c++ client is really hard to build.

I watched a couple of amqp videos and it is always mentioned that amqp is a wire protocol just like http, and that that is a big plus (I agree).
So why is there a need for a rabbitmq cpp client and a Apache qpid client etc. in the first place?
Why isn't there only one generic amqp cpp client?

regards

sven

From liuguirong at knet.cn  Mon May 12 06:55:42 2014
From: liuguirong at knet.cn (liuguirong at knet.cn)
Date: Mon, 12 May 2014 13:55:42 +0800
Subject: [rabbitmq-discuss] rabbitmq server crash 3.1.3
Message-ID: <201405121355415499128@knet.cn>







the rabbitmq server crashed and in the log file I found the following error:=ERROR REPORT==== 9-May-2014::20:51:16 ===

** Generic server msg_store_transient terminating

** Last message in was {'$gen_cast',
                           {write,
                               <<108,11,99,2,157,64,15,250,16,213,109,69,84,
                                 104,76,198>>,
                               <<245,2,187,252,69,132,29,23,224,199,63,231,57,
                                 11,206,128>>,
                               flow}}
** When Server state == {msstate,
                            "/opt/rabbitmq_server-3.1.3/sbin/../var/lib/rabbitmq/mnesia/r
abbit at rabbitmq28/msg_store_transient",
                            rabbit_msg_store_ets_index,
                            {state,835648,
                                "/opt/rabbitmq_server-3.1.3/sbin/../var/lib/rabbitmq/mnes
ia/rabbit at rabbitmq28/msg_store_transient"},
                            0,#Ref<0.0.0.2639>,
                            {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            undefined,16764707,16777200,[],<0.589.0>,839743,
                            831533,843838,847932,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,23,16,16,8,80,48,** Reason for termination ==

** {{badmatch,{error,enoent}},

    [{filename,absname,1,[{file,"filename.erl"},{line,67}]},

     {file_handle_cache,open,3,[]},

     {rabbit_msg_store,maybe_roll_to_new_file,2,[]},

     {rabbit_msg_store,handle_cast,2,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

=INFO REPORT==== 9-May-2014::20:51:16 ===

stopped TCP Listener on [::]:5672

=ERROR REPORT==== 9-May-2014::20:51:19 ===

AMQP connection <0.25487.7> (running), channel 1 - error:

shutdownappendix:rabbitmq-server: rabbitmq-server-generic-unix-3.1.3.tar.gz
liuguirong

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/e72391d8/attachment.html>

From ramtinova at gmail.com  Sun May 11 22:25:23 2014
From: ramtinova at gmail.com (rafael)
Date: Sun, 11 May 2014 14:25:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Connecting To Rabbitmq Server On Ubuntu 14.04
 EC2 Instance From Outside
Message-ID: <1399843523718-35459.post@n5.nabble.com>

Hi, 
I cannot access rabbitmq server outside the amazon ec2 here is what I've
done my settings:

EC2 Instances Security Groups :

<http://rabbitmq.1065348.n5.nabble.com/file/n35459/1.png> 

my /etc/rabbitmq/rabbitmq-env.conf file :

NODE_IP_ADDRESS=<instance private ip taken from ifconfig = 177.31.*.*>

my /etc/hosts  file : 

127.0.0.1 localhost
172.31.*.* ip-172-31-*-*
# The following lines are desirable for IPv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts

my netstat -vpln command output :

Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
PID/Program name
tcp        0      0        0.0.0.0:22              0.0.0.0:*              
LISTEN      927/sshd        
tcp        0      0        172.31.*.*:5672      0.0.0.0:*              
LISTEN      4662/beam       
tcp        0      0        0.0.0.0:25672           0.0.0.0:*              
LISTEN      4662/beam       
tcp        0      0        0.0.0.0:4369            0.0.0.0:*              
LISTEN      2089/epmd       
tcp6       0      0        :::22                   :::*                   
LISTEN      927/sshd        
udp        0      0        0.0.0.0:68              0.0.0.0:*                          
501/dhclient    
udp        0      0        0.0.0.0:45419           0.0.0.0:*                          
501/dhclient    
udp6       0      0        :::61763                :::*                               
501/dhclient    


but whenever from my personal computer I perform :
$ telnet <instance public IP >  5672

Trying 54.86.148.143...
telnet: Unable to connect to remote host: Connection timed out

I've set the NODE_IP_ADDRESS to 0.0.0.0 and still no success.

any idea?








--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From liuguirong at knet.cn  Mon May 12 03:25:52 2014
From: liuguirong at knet.cn (liuguirong at knet.cn)
Date: Mon, 12 May 2014 10:25:52 +0800
Subject: [rabbitmq-discuss] rabbitmq server crash 3.1.3
Message-ID: <201405121025517663336@knet.cn>







the rabbitmq server crashed and in the log file I found the following error:=ERROR REPORT==== 9-May-2014::20:51:16 ===

** Generic server msg_store_transient terminating

** Last message in was {'$gen_cast',
                           {write,
                               <<108,11,99,2,157,64,15,250,16,213,109,69,84,
                                 104,76,198>>,
                               <<245,2,187,252,69,132,29,23,224,199,63,231,57,
                                 11,206,128>>,
                               flow}}
** When Server state == {msstate,
                            "/opt/rabbitmq_server-3.1.3/sbin/../var/lib/rabbitmq/mnesia/r
abbit at rabbitmq28/msg_store_transient",
                            rabbit_msg_store_ets_index,
                            {state,835648,
                                "/opt/rabbitmq_server-3.1.3/sbin/../var/lib/rabbitmq/mnes
ia/rabbit at rabbitmq28/msg_store_transient"},
                            0,#Ref<0.0.0.2639>,
                            {dict,0,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            undefined,16764707,16777200,[],<0.589.0>,839743,
                            831533,843838,847932,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,23,16,16,8,80,48,** Reason for termination ==

** {{badmatch,{error,enoent}},

    [{filename,absname,1,[{file,"filename.erl"},{line,67}]},

     {file_handle_cache,open,3,[]},

     {rabbit_msg_store,maybe_roll_to_new_file,2,[]},

     {rabbit_msg_store,handle_cast,2,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

=INFO REPORT==== 9-May-2014::20:51:16 ===

stopped TCP Listener on [::]:5672

=ERROR REPORT==== 9-May-2014::20:51:19 ===

AMQP connection <0.25487.7> (running), channel 1 - error:

shutdownappendix:rabbitmq-server: rabbitmq-server-generic-unix-3.1.3.tar.gz
liuguirong

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/7c294391/attachment.html>

From matthias at rabbitmq.com  Mon May 12 07:40:43 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 May 2014 07:40:43 +0100
Subject: [rabbitmq-discuss] rabbitmq server crash 3.1.3
In-Reply-To: <201405121355415499128@knet.cn>
References: <201405121355415499128@knet.cn>
Message-ID: <53706CEB.5090505@rabbitmq.com>

On 12/05/14 06:55, liuguirong at knet.cn wrote:
> the rabbitmq server crashed and in the log file I found the following error:
> ** {{badmatch,{error,enoent}},
>      [{filename,absname,1,[{file,"filename.erl"},{line,67}]},

The most likely cause is that the directory from which the rabbitmq 
server was started no longer exists.

Matthias.

From simon at rabbitmq.com  Mon May 12 10:02:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 10:02:28 +0100
Subject: [rabbitmq-discuss] Problem: NOT_FOUND - no binding between
 exchange 'xxxxx' in vhost
In-Reply-To: <013d01cf6bb4$fa54cae0$eefe60a0$@presencenetworks.com>
References: <013501cf6ae7$079a0e00$16ce2a00$@presencenetworks.com>
 <CAKgmDnHS03SnpvDL=Li0RZxOj_w_xKWQ6zz7yeZcAwqoGDz1vQ@mail.gmail.com>
 <018c01cf6afc$ab3d0700$01b71500$@presencenetworks.com>
 <536CE13F.8020303@rabbitmq.com>
 <013d01cf6bb4$fa54cae0$eefe60a0$@presencenetworks.com>
Message-ID: <53708E24.4030709@rabbitmq.com>

On 09/05/2014 19:32, Scott Durgin wrote:
> Thank you for investigating. So far with the upgrade we have not been able
> to reproduce, but will be keeping a keen eye on this for sure.

Good to hear, thanks.

> For purposes of helping with better information, is there a way to increase
> debug logging information that we could turn on and provide if we can
> reproduce this (or other issues).

No, the default configuration is as verbose as it gets.

Cheers, Simon

From simon at rabbitmq.com  Mon May 12 10:08:23 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 10:08:23 +0100
Subject: [rabbitmq-discuss] dotnet client - Increasing prefetch with
 BasicQoS during HandleBasicDeliver doesn't trigger retrieval of next
 message
In-Reply-To: <fd20e8d1-8d5e-47ef-93dc-5b7aaae0d081@googlegroups.com>
References: <fd20e8d1-8d5e-47ef-93dc-5b7aaae0d081@googlegroups.com>
Message-ID: <53708F87.7030507@rabbitmq.com>

On 11/05/2014 04:55, Jon Stelly wrote:
> I have a sort of odd scenario.  I want to process 1 message at a time so
> I call basic qos with a prefetch of 1 and call BasicConsume(), but
> sometimes my processing will end in a long blocking task.  When that
> happens, I would like to increase the qos prefetch to 2 to trigger the
> next message to be received and processed.  The issue is that I don't
> want to ack the first message until after the long blocking process
> completes successfully.
>
> If I call BasicQoS before acking the first message, the 2nd message
> isn't received until after the long running task completes and the ack
> is sent.  Can anyone explain what's going on and possibly suggest an
> alternative?

You are running 3.3.x? The new semantics for consumer prefetch mean that 
setting basicQos after consuming will only define a prefetch for *new* 
consumers. You could work around this by setting global=true.

See http://www.rabbitmq.com/consumer-prefetch.html for more information.

I am starting to wonder if the global=false qos should set the prefetch 
for all consumers on the channel; you wouldn't be able to have one 
channel with multiple consumers with different prefetch, but this is an 
area that seems to be unintuitive...

Cheers, Simon

From simon at rabbitmq.com  Mon May 12 10:12:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 10:12:13 +0100
Subject: [rabbitmq-discuss] Network partition queue issues
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BAB3D3786A@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BAB3D3786A@osl02-exc-001>
Message-ID: <5370906D.1090307@rabbitmq.com>

There are definitely several bugs which have been fixed in mirrored 
queues and in autoheal since 3.2.4 which might account for what you saw. 
If you send me logs privately I can look to see if there are signs of 
any of the bugs we have fixed.

Cheers, Simon

On 09/05/2014 12:26, Jon Bergli Heier wrote:
> Hi,
>
> Yesterday we had two unfortunate network partitions on one of our two-node
> clusters, about an hour apart. After the second partition, when we restarted
> one of the nodes, we encountered some issues:
>
> 1) one of the queues disappeared, including any queued messages.
> 2) two other queues appears hung and doesn't respond to anything.
>
> We've managed to resolve 1) by recreating the queue and bindings and
> republishing the messages, but 2) is still a problem, as we can't do anything
> with these queues, not even delete them (the management interface and API just
> hangs when trying to delete). Any consumers also appears to hang when
> interacting with these queues. Restarting the entire cluster also didn't help.
>
> Is there any way to prevent 1), and can we somehow solve 2) without resetting
> the entire cluster? We're currently running RabbitMQ 3.2.4. I have logs
> available, but I'd rather not post these publicly since there's some sensitive
> data in there.
>
> FTR we're using autoheal and all queues on the cluster have ha-mode=all and
> ha-sync-mode=automatic. Also, according to heartbeat, the nodes only appears to
> have lost contact for a few seconds (nothing seems to be logged during the
> second split).
>
> Thanks,
> Jon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Mon May 12 10:19:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 10:19:37 +0100
Subject: [rabbitmq-discuss] Connecting To Rabbitmq Server On Ubuntu
 14.04 EC2 Instance From Outside
In-Reply-To: <1399843523718-35459.post@n5.nabble.com>
References: <1399843523718-35459.post@n5.nabble.com>
Message-ID: <53709229.7070302@rabbitmq.com>

This is more of a question about EC2 networking / firewall really - the 
RabbitMQ instance looks like it is up and listening, that's as much as 
it can do.

I can only suggest traceroute and trying to connect from the machine 
itself to try to narrow down where the problem lies.

Cheers, Simon

On 11/05/2014 22:25, rafael wrote:
> Hi,
> I cannot access rabbitmq server outside the amazon ec2 here is what I've
> done my settings:
>
> EC2 Instances Security Groups :
>
> <http://rabbitmq.1065348.n5.nabble.com/file/n35459/1.png>
>
> my /etc/rabbitmq/rabbitmq-env.conf file :
>
> NODE_IP_ADDRESS=<instance private ip taken from ifconfig = 177.31.*.*>
>
> my /etc/hosts  file :
>
> 127.0.0.1 localhost
> 172.31.*.* ip-172-31-*-*
> # The following lines are desirable for IPv6 capable hosts
> ::1 ip6-localhost ip6-loopback
> fe00::0 ip6-localnet
> ff00::0 ip6-mcastprefix
> ff02::1 ip6-allnodes
> ff02::2 ip6-allrouters
> ff02::3 ip6-allhosts
>
> my netstat -vpln command output :
>
> Active Internet connections (only servers)
> Proto Recv-Q Send-Q Local Address           Foreign Address         State
> PID/Program name
> tcp        0      0        0.0.0.0:22              0.0.0.0:*
> LISTEN      927/sshd
> tcp        0      0        172.31.*.*:5672      0.0.0.0:*
> LISTEN      4662/beam
> tcp        0      0        0.0.0.0:25672           0.0.0.0:*
> LISTEN      4662/beam
> tcp        0      0        0.0.0.0:4369            0.0.0.0:*
> LISTEN      2089/epmd
> tcp6       0      0        :::22                   :::*
> LISTEN      927/sshd
> udp        0      0        0.0.0.0:68              0.0.0.0:*
> 501/dhclient
> udp        0      0        0.0.0.0:45419           0.0.0.0:*
> 501/dhclient
> udp6       0      0        :::61763                :::*
> 501/dhclient
>
>
> but whenever from my personal computer I perform :
> $ telnet <instance public IP >  5672
>
> Trying 54.86.148.143...
> telnet: Unable to connect to remote host: Connection timed out
>
> I've set the NODE_IP_ADDRESS to 0.0.0.0 and still no success.
>
> any idea?
>
>
>
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Mon May 12 10:27:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 10:27:31 +0100
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
In-Reply-To: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
References: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
Message-ID: <53709403.4080306@rabbitmq.com>

On 09/05/2014 20:18, Leonardo N. S. Pereira wrote:
> I'm bouncing the network connection between two nodes, for instance C
> and B, in the way that:
> - A: can reach C and B
> - C: can reach A
> - B can reach A
> In this case, the cluster get stuck and only recovers when all nodes are
> restarted.
> Is it an expected behavior?

We don't deal very well with partial partitions in general, and in this 
specific case it's unclear what pause_minority even *could* do. In this 
partial partition all three nodes think that they are in the majority - 
so pause_minority mode has nothing to do. So I'm afraid this is 
expected, yes.

Cheers, Simon

From matthias at rabbitmq.com  Mon May 12 10:42:42 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 May 2014 10:42:42 +0100
Subject: [rabbitmq-discuss] dotnet client - Increasing prefetch with
 BasicQoS during HandleBasicDeliver doesn't trigger retrieval of next
 message
In-Reply-To: <53708F87.7030507@rabbitmq.com>
References: <fd20e8d1-8d5e-47ef-93dc-5b7aaae0d081@googlegroups.com>
 <53708F87.7030507@rabbitmq.com>
Message-ID: <53709792.2000307@rabbitmq.com>

On 12/05/14 10:08, Simon MacMullen wrote:
> You are running 3.3.x? The new semantics for consumer prefetch mean that
> setting basicQos after consuming will only define a prefetch for *new*
> consumers. You could work around this by setting global=true.

...or by basic.cancel'ing the consumer and re-basic.consume'ing.

Matthias.

From smetj.net at gmail.com  Mon May 12 11:26:37 2014
From: smetj.net at gmail.com (Jelle Smet)
Date: Mon, 12 May 2014 03:26:37 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ queue out-rate settles to in-rate when
 many messages in queue
Message-ID: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>

Hi all,

RabbitMQ: 3.3.1
Erlang: 17

We have following situation:


   - A queue contains a large amount of messages (5 million because the 
   consumers are shutdown)
   - There's a constant  incoming message flow at a rate of ~2000 msg/s.
   - Messages are persistent though diskIO is far from being saturated.
   - Consumers have a prefetch value of 1000
   - We presume backpressure is applied to the producer in this situation 
   (difficult to observe).


What we observe is that out-rate settles to the in-rate, which I don't 
understand because:

   - There a large amount of messages in the queue so plenty to consume.
   - We KNOW consumers are able to write at a much higher throughput even 
   after bumping prefetch value.
   - When the queue is empty, in & outgoing rate is again 8000 msg/s


Any tips, leads why the consumption rate settles to the incoming rate in 
this situation?

cheers,

Jelle



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/b840602d/attachment.html>

From videlalvaro at gmail.com  Mon May 12 13:00:31 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 12 May 2014 14:00:31 +0200
Subject: [rabbitmq-discuss] Connecting To Rabbitmq Server On Ubuntu
 14.04 EC2 Instance From Outside
In-Reply-To: <53709229.7070302@rabbitmq.com>
References: <1399843523718-35459.post@n5.nabble.com>
 <53709229.7070302@rabbitmq.com>
Message-ID: <CAMcAHLWFBZAod0_jVfxQZ6-wS96PAEzrgi69J8bqFirhcmQ9ug@mail.gmail.com>

Also be aware about the guest:guest user limitation when connecting
from remote nodes. If you are using  different user, then ignore my
comment.

Cheers,

Alvaro

On Mon, May 12, 2014 at 11:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> This is more of a question about EC2 networking / firewall really - the
> RabbitMQ instance looks like it is up and listening, that's as much as it
> can do.
>
> I can only suggest traceroute and trying to connect from the machine itself
> to try to narrow down where the problem lies.
>
> Cheers, Simon
>
>
> On 11/05/2014 22:25, rafael wrote:
>>
>> Hi,
>> I cannot access rabbitmq server outside the amazon ec2 here is what I've
>> done my settings:
>>
>> EC2 Instances Security Groups :
>>
>> <http://rabbitmq.1065348.n5.nabble.com/file/n35459/1.png>
>>
>> my /etc/rabbitmq/rabbitmq-env.conf file :
>>
>> NODE_IP_ADDRESS=<instance private ip taken from ifconfig = 177.31.*.*>
>>
>> my /etc/hosts  file :
>>
>> 127.0.0.1 localhost
>> 172.31.*.* ip-172-31-*-*
>> # The following lines are desirable for IPv6 capable hosts
>> ::1 ip6-localhost ip6-loopback
>> fe00::0 ip6-localnet
>> ff00::0 ip6-mcastprefix
>> ff02::1 ip6-allnodes
>> ff02::2 ip6-allrouters
>> ff02::3 ip6-allhosts
>>
>> my netstat -vpln command output :
>>
>> Active Internet connections (only servers)
>> Proto Recv-Q Send-Q Local Address           Foreign Address         State
>> PID/Program name
>> tcp        0      0        0.0.0.0:22              0.0.0.0:*
>> LISTEN      927/sshd
>> tcp        0      0        172.31.*.*:5672      0.0.0.0:*
>> LISTEN      4662/beam
>> tcp        0      0        0.0.0.0:25672           0.0.0.0:*
>> LISTEN      4662/beam
>> tcp        0      0        0.0.0.0:4369            0.0.0.0:*
>> LISTEN      2089/epmd
>> tcp6       0      0        :::22                   :::*
>> LISTEN      927/sshd
>> udp        0      0        0.0.0.0:68              0.0.0.0:*
>> 501/dhclient
>> udp        0      0        0.0.0.0:45419           0.0.0.0:*
>> 501/dhclient
>> udp6       0      0        :::61763                :::*
>> 501/dhclient
>>
>>
>> but whenever from my personal computer I perform :
>> $ telnet <instance public IP >  5672
>>
>> Trying 54.86.148.143...
>> telnet: Unable to connect to remote host: Connection timed out
>>
>> I've set the NODE_IP_ADDRESS to 0.0.0.0 and still no success.
>>
>> any idea?
>>
>>
>>
>>
>>
>>
>>
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Mon May 12 13:37:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 12 May 2014 16:37:44 +0400
Subject: [rabbitmq-discuss] RabbitMQ queue out-rate settles to in-rate
 when many messages in queue
In-Reply-To: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>
References: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>
Message-ID: <etPan.5370c0b5.6b8b4567.2e1@mercurio>

On 12 May 2014 at 14:28:53, Jelle Smet (smetj.net at gmail.com) wrote:
> > We presume backpressure is applied to the producer in this situation 
> (difficult to observe)

Just in case , alarms will be logged in RabbitMQ log file.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Mon May 12 13:46:37 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 12 May 2014 13:46:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ queue out-rate settles to in-rate
 when many messages in queue
In-Reply-To: <etPan.5370c0b5.6b8b4567.2e1@mercurio>
References: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>
 <etPan.5370c0b5.6b8b4567.2e1@mercurio>
Message-ID: <5370C2AD.1040005@rabbitmq.com>

On 12/05/14 13:37, Michael Klishin wrote:
> On 12 May 2014 at 14:28:53, Jelle Smet (smetj.net at gmail.com) wrote:
>>> We presume backpressure is applied to the producer in this situation
>> (difficult to observe)
>
> Just in case , alarms will be logged in RabbitMQ log file.

Not for ordinary flow control; only when rabbit throttles producers due 
to disk or memory alarms.

The management UI does show the flow status of a connection, with "flow" 
indicating that backpressure was applied recently.

Matthias.


From jonstelly at gmail.com  Mon May 12 14:08:38 2014
From: jonstelly at gmail.com (Jon Stelly)
Date: Mon, 12 May 2014 08:08:38 -0500
Subject: [rabbitmq-discuss] dotnet client - Increasing prefetch with
 BasicQoS during HandleBasicDeliver doesn't trigger retrieval of next
 message
In-Reply-To: <53708F87.7030507@rabbitmq.com>
References: <fd20e8d1-8d5e-47ef-93dc-5b7aaae0d081@googlegroups.com>
 <53708F87.7030507@rabbitmq.com>
Message-ID: <CAAijfv0MBt34SMxCCZabz0yQur1Y-mnA=5wP=MzjaEs4qLBTCw@mail.gmail.com>

Thanks Simon,

I've tried global as true and false for BasicQoS and see the same behavior.
 I've got some quick example code below that demonstrates the issue I'm
having and a zip archive of the project is available
here<https://www.dropbox.com/s/x7q9e6ijuxzp9zn/RabbitQoSTest.zip>.
 I captured network traffic from WireShark and it seems that calling
BasicQoS() and increasing the prefetchCount, the qos change gets sent to
the server, and the server replies with a qos-ok, but the server doesn't
send more messages if the new prefetch count is greater than the
outstanding message count for the channel.  It's not until I Ack the first
message that the second one is sent.

It seems to me that an Ack from a client is causing the server to look at
the queue being consumed and do something like:

if(queue.has-messages && channel.unacked-messages < channel.prefetch-count)
    send-messages-to-channel-until-unacked-equals-prefetch-count(channel)

For the behavior I'd like to see, it seems like a call to basic.qos would
require the same logic.

Below is a snippet of my example code.  ActionConsumer is a simple
IBasicConsumer that invokes the action passed to it's constructor during
HandleBasicDeliver.  It also uses a simple extension method to List<T>
called WaitFor() which waits for the list to contain the specified number
of items.  I've added comments based on my network capture of this code
being executed.

Thanks for any help.  Right now, I've got a pretty ugly workaround, which
is that instead of increasing prefetch count and calling basicqos, I just
do a basicget, but this is definitely hacky and makes me poll using
basicget() on another thread, etc...

Thanks.


var consumer = new ActionConsumer(Model, message =>
    Task.Run(() =>
    {
        Log.DebugFormat("Received({0})", message);
        messages.Add(Encoding.UTF8.GetString(message.Body));
        if (messages.Count == 1)
        {
            //If this is the first message, send a second, set qos to 2 and
wait for second message to arrive
            Send("World"); //This message gets sent immediately
            Log.Debug("BasicQoS(0, 2, false)");
            Model.BasicQos(0, 2, false); //QoS is sent to server
immediately, prefetch shows as 2 in management console
            Log.Debug("WaitFor(2, 5000)");
            messages.WaitFor(2, 5000); //While waiting, 2nd message will
not be received
            Log.DebugFormat("BasicAck({0}, false)", message.DeliveryTag);
            Model.BasicAck(message.DeliveryTag, false); //As soon as Ack is
sent, 2nd message is transmitted to client
            messages.WaitFor(2, 2500);
            Log.Debug("Finished task 1 processing");
        }
    }));

//Start consuming
Model.BasicConsume(queue, false, consumer);

//Send starter message
Send("Hello");
var ret = messages.WaitFor(2, 15000);


On Mon, May 12, 2014 at 4:08 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/05/2014 04:55, Jon Stelly wrote:
>
>> I have a sort of odd scenario.  I want to process 1 message at a time so
>> I call basic qos with a prefetch of 1 and call BasicConsume(), but
>> sometimes my processing will end in a long blocking task.  When that
>> happens, I would like to increase the qos prefetch to 2 to trigger the
>> next message to be received and processed.  The issue is that I don't
>> want to ack the first message until after the long blocking process
>> completes successfully.
>>
>> If I call BasicQoS before acking the first message, the 2nd message
>> isn't received until after the long running task completes and the ack
>> is sent.  Can anyone explain what's going on and possibly suggest an
>> alternative?
>>
>
> You are running 3.3.x? The new semantics for consumer prefetch mean that
> setting basicQos after consuming will only define a prefetch for *new*
> consumers. You could work around this by setting global=true.
>
> See http://www.rabbitmq.com/consumer-prefetch.html for more information.
>
> I am starting to wonder if the global=false qos should set the prefetch
> for all consumers on the channel; you wouldn't be able to have one channel
> with multiple consumers with different prefetch, but this is an area that
> seems to be unintuitive...
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/920bae26/attachment.html>

From simon at rabbitmq.com  Mon May 12 14:28:04 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 14:28:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ queue out-rate settles to in-rate
 when many messages in queue
In-Reply-To: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>
References: <8d33f4c4-46e9-4865-9a9d-b89a3d2bd329@googlegroups.com>
Message-ID: <5370CC64.3010403@rabbitmq.com>

On 12/05/2014 11:26, Jelle Smet wrote:
> Hi all,
>
> RabbitMQ: 3.3.1
> Erlang: 17
>
> We have following situation:
>
>   * A queue contains a large amount of messages (5 million because the
>     consumers are shutdown)
>   * There's a constant  incoming message flow at a rate of ~2000 msg/s.
>   * Messages are persistent though diskIO is far from being saturated.
>   * Consumers have a prefetch value of 1000
>   * We presume backpressure is applied to the producer in this situation
>     (difficult to observe).

Check mgmt / ctl - do the producer connections have a state of "flow" 
(backpressure is applied) or "running" (it's not)?

> What we observe is that out-rate settles to the in-rate, which I don't
> understand because:

When queues in RabbitMQ 3.3.x are the bottleneck, they will deliver (at 
least) 10% more messages than they accept:

http://www.rabbitmq.com/blog/2014/04/10/consumer-bias-in-rabbitmq-3-3/

[I know you say in-rate == out-rate but do you mean exactly, or to the 
nearest 10%?]

Note that previous versions of RabbitMQ did not make guarantees about 
this at all.

You can see whether your queues are the bottleneck as discussed here:

http://www.rabbitmq.com/blog/2014/04/14/finding-bottlenecks-with-rabbitmq-3-3/

>   * There a large amount of messages in the queue so plenty to consume.
>   * We KNOW consumers are able to write at a much higher throughput even
>     after bumping prefetch value.
>   * When the queue is empty, in & outgoing rate is again 8000 msg/s

When the queue is empty then you might be hitting an optimisation which 
can make persistent messaging much faster.

When a persistent message reaches a queue, it is also added to an 
internal queue to go to the disc. It will not be confirmed to the 
publisher until it has made it through this queue and on to the disc.

But we *can* deliver it to consumers before it has made it to disc! If a 
consumer receives it, and acknowledges it (or consumed in autoack mode), 
and that ack makes it back to the queue before the message has reached 
disc, then we cancel the write and send the confirm to the producer 
straight away, since RabbitMQ has already fulfilled all its 
responsibilities for that message by delivering it.

Obviously this optimisation only works when you have (very) fast 
consumers, and an empty or near-empty queue.

Could that explain the difference in performance you are seeing?

Cheers, Simon


From simon at rabbitmq.com  Mon May 12 14:36:50 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 May 2014 14:36:50 +0100
Subject: [rabbitmq-discuss] 3.3.0: How to achieve channel.flow(0) with
 basic.qos?
In-Reply-To: <1399481883761-35405.post@n5.nabble.com>
References: <1399481883761-35405.post@n5.nabble.com>
Message-ID: <5370CE72.5010507@rabbitmq.com>

On 07/05/2014 17:58, mrogan wrote:
> Support for channel.flow(bit active) was removed in RabbitMq 3.3.0 (
> changelog <https://www.rabbitmq.com/release-notes/README-3.3.0.txt>  ). I
> was using it to suspend flow on a channel when initially consuming a queue
> with basic.consume. The reason is that I need to determine if I am the
> exclusive consumer of that queue and perform business logic before starting
> to receive already pending messages.
>
> I read that "basic.qos is superior in all cases" but I don't see how to
> completely suspend the flow by setting the prefetch-count. If I set the
> prefetch-count to zero then then it is effectively unlimited. This is not
> the same as channel.flow(0)!

This is true.

> I can work around this by buffering messages until I can perform my business
> logic after the (successful) basic.consume. But this would seem to be
> reimplementing the channel.flow that has disappeared!

You can set the basic.qos to 1 before consuming; that way you only have 
to buffer one message.

If that doesn't appeal you could also have your clients agree on the 
name of a queue to use as a mutex; exclusively declaring that queue 
could be taken as proving that the exclusive consume operation will 
succeed, and you could perform the business logic between declaring and 
consuming.

Cheers, Simon

From kansalneha28 at yahoo.com  Mon May 12 17:33:02 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Mon, 12 May 2014 09:33:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Questions on how to handle message reliability.
Message-ID: <1399912382.75538.YahooMailNeo@web141706.mail.bf1.yahoo.com>

I was referring the javadoc but missed the Envelope api.


Thank you, Michael and Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/311476af/attachment.html>

From SoderquistMV at ldschurch.org  Mon May 12 21:59:11 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Mon, 12 May 2014 20:59:11 +0000
Subject: [rabbitmq-discuss] LDAP SSL Configuration
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>

I'm attempting to connect to our LDAP server over SSL instead of plain sockets. The plain socket configuration works but simply enabling the use_ssl flag and changing the port does not appear to be enough. What else is required to connect to an LDAP server using SSL?

Here is my configuration:
  {rabbitmq_auth_backend_ldap,
    [ {servers,               ["ldschurch.org"]},

      %% Options removed for security

      {use_ssl,               true},
      {port,                  636},
      {log,                   true}
    ]
  }

The log simply reports a connection failure:
=INFO REPORT==== 12-May-2014::14:28:41 ===
    LDAP connect error: {error,"connect failed"}

I do not expect to need to create a certificate since my LDAP server does not do client certificate verification. What am I missing?

Mark


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/b6cd211e/attachment.html>

From ryanbarton at gmail.com  Mon May 12 23:17:04 2014
From: ryanbarton at gmail.com (Ryan S. Barton)
Date: Mon, 12 May 2014 15:17:04 -0700
Subject: [rabbitmq-discuss] LDAP SSL Configuration
In-Reply-To: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
Message-ID: <CAHcxYOPLNyvJED0bBu3J7WN4aC6HaEsB3coEf0XxiKDwe2HERQ@mail.gmail.com>

Greetings,

I included the full "ssl_opts" portion in the config, and it spun up just
fine (cacertfile, certfile, keyfile, verify, etc.).  Without the ssl_opts,
I wasn't getting SSL to connect.

-rsb



On Mon, May 12, 2014 at 1:59 PM, Mark Soderquist <SoderquistMV at ldschurch.org
> wrote:

>  I?m attempting to connect to our LDAP server over SSL instead of plain
> sockets. The plain socket configuration works but simply enabling the
> use_ssl flag and changing the port does not appear to be enough. What else
> is required to connect to an LDAP server using SSL?
>
>
>
> Here is my configuration:
>
>   {rabbitmq_auth_backend_ldap,
>
>     [ {servers,               ["ldschurch.org"]},
>
>
>
>       %% Options removed for security
>
>
>
>       {use_ssl,               true},
>
>       {port,                  636},
>
>       {log,                   true}
>
>     ]
>
>   }
>
>
>
> The log simply reports a connection failure:
>
> =INFO REPORT==== 12-May-2014::14:28:41 ===
>
>     LDAP connect error: {error,"connect failed"}
>
>
>
> I do not expect to need to create a certificate since my LDAP server does
> not do client certificate verification. What am I missing?
>
>
>
> Mark
>
>
>
> NOTICE: This email message is for the sole use of the intended
> recipient(s) and may contain confidential and privileged information. Any
> unauthorized review, use, disclosure or distribution is prohibited. If you
> are not the intended recipient, please contact the sender by reply email
> and destroy all copies of the original message.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/b3bb47cc/attachment.html>

From jay.hilden at gmail.com  Mon May 12 23:30:36 2014
From: jay.hilden at gmail.com (Jay Hilden)
Date: Mon, 12 May 2014 15:30:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Why does the UI say all messages are being
	redelivered?
Message-ID: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>

We have a 2 node cluster in production that has many vhosts and many 
queues, all working great.  There is one queue that when it processes the 
data it lists all messages are being redelivered.  So the UI will say 
"deliver/get (of which redelivered): 65/s (65/s)".  It looks like all of 
the messages are being redelivered.  This is only happening on one queue.  

Can anyone help me with the root cause of this issue?

Thank you in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140512/f32fac61/attachment.html>

From mklishin at gopivotal.com  Tue May 13 08:43:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 11:43:47 +0400
Subject: [rabbitmq-discuss] Why does the UI say all messages are being
 redelivered?
In-Reply-To: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
References: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
Message-ID: <etPan.5371cd4f.6b8b4567.11ca@mercurio.local>

On 13 May 2014 at 11:41:19, Jay Hilden (jay.hilden at gmail.com) wrote:
> > So the UI will say "deliver/get (of which redelivered): 65/s  
> (65/s)". It looks like all of the messages are being redelivered.  
> This is only happening on one queue.
>  
> Can anyone help me with the root cause of this issue?

Consumers on the queue keep re-queueing messages which are then delivered
back ?to them, over and over.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue May 13 08:48:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 May 2014 08:48:43 +0100
Subject: [rabbitmq-discuss] Why does the UI say all messages are being
 redelivered?
In-Reply-To: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
References: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
Message-ID: <5371CE5B.1010802@rabbitmq.com>

All the messages that are being delivered have been marked as 
redelivered at some point. Possible reasons include that they were all 
delivered to but not acked by a client which subsequently disconnected, 
or rejected/nacked them, or invoked basic.recover. Or that they were 
published to a mirrored queue which subsequently failed over.

Do any of those sound right?

Cheers, Simon

On 12/05/2014 23:30, Jay Hilden wrote:
> We have a 2 node cluster in production that has many vhosts and many
> queues, all working great.  There is one queue that when it processes
> the data it lists all messages are being redelivered.  So the UI will
> say "deliver/get (of which redelivered): 65/s (65/s)".  It looks like
> all of the messages are being redelivered.  This is only happening on
> one queue.
>
> Can anyone help me with the root cause of this issue?
>
> Thank you in advance.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue May 13 10:36:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 May 2014 10:36:35 +0100
Subject: [rabbitmq-discuss] LDAP SSL Configuration
In-Reply-To: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
Message-ID: <5371E7A3.9010802@rabbitmq.com>

On 12/05/2014 21:59, Mark Soderquist wrote:
> I?m attempting to connect to our LDAP server over SSL instead of plain
> sockets. The plain socket configuration works but simply enabling the
> use_ssl flag and changing the port does not appear to be enough. What
> else is required to connect to an LDAP server using SSL?

I believe that simple configuration should be able to work assuming your 
LDAP server accepts clients without certificates.

> Here is my configuration:

>        {log,                   true}

> The log simply reports a connection failure:
>
> =INFO REPORT==== 12-May-2014::14:28:41 ===
>
>      LDAP connect error: {error,"connect failed"}

If you change {log, true} to {log, network} then you should get better 
diagnostics on failed connections.

Cheers, Simon


From michael.s.klishin at gmail.com  Tue May 13 13:56:56 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 13 May 2014 16:56:56 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.10.1 is released
Message-ID: <CAE3HoVSkjjqEqWhS=R4Wa-KTY66h47iq0FwUp5uYVf4GRLQ2Bg@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure client for RabbitMQ.

Release notes:
http://blog.clojurewerkz.org/blog/2014/05/13/langohr-2-dot-10-dot-1-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/d086984e/attachment.html>

From mklishin at gopivotal.com  Tue May 13 14:11:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:11:19 +0400
Subject: [rabbitmq-discuss] ANN Hutch 0.9.0 is released
Message-ID: <etPan.53721a15.643c9869.11ca@mercurio.local>

Hutch [1][2] is a Ruby framework for inter-service communication
over RabbitMQ.

Release notes:
https://github.com/gocardless/hutch/blob/master/CHANGELOG.md#090--may-13-2014

1.?https://github.com/gocardless/hutch
2.?https://gocardless.com/blog/hutch-inter-service-communication-with-rabbitmq/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From SoderquistMV at ldschurch.org  Tue May 13 14:20:16 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Tue, 13 May 2014 13:20:16 +0000
Subject: [rabbitmq-discuss] LDAP SSL Configuration
In-Reply-To: <5371E7A3.9010802@rabbitmq.com>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
 <5371E7A3.9010802@rabbitmq.com>
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39AC49BB@W12112.ldschurch.org>

Still just getting: LDAP connect error: {error,"connect failed"}
Changing to {log, network} did not give me any more information.
I'm now going to assume that our LDAP server does not accept clients without certificates.

On 12/05/2014 21:59, Mark Soderquist wrote:
> I'm attempting to connect to our LDAP server over SSL instead of plain 
> sockets. The plain socket configuration works but simply enabling the 
> use_ssl flag and changing the port does not appear to be enough. What 
> else is required to connect to an LDAP server using SSL?

I believe that simple configuration should be able to work assuming your LDAP server accepts clients without certificates.

> Here is my configuration:

>        {log,                   true}

> The log simply reports a connection failure:
>
> =INFO REPORT==== 12-May-2014::14:28:41 ===
>
>      LDAP connect error: {error,"connect failed"}

If you change {log, true} to {log, network} then you should get better diagnostics on failed connections.

Cheers, Simon


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.


From mklishin at gopivotal.com  Tue May 13 14:21:58 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:21:58 +0400
Subject: [rabbitmq-discuss] ANN Starsky, a Node.js port of Hutch
Message-ID: <etPan.53721c94.19495cff.11ca@mercurio.local>

I've recently been told about a project that the authors ? Recurly ? haven't
announced here yet, so I decided to go ahead ;)

Starsky is a Node.js port of Hutch [1][2]:
https://github.com/recurly/starsky

1. https://github.com/gocardless/hutch?
2. https://gocardless.com/blog/hutch-inter-service-communication-with-rabbitmq/?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mouadino at gmail.com  Tue May 13 14:25:27 2014
From: mouadino at gmail.com (mouad ben)
Date: Tue, 13 May 2014 15:25:27 +0200
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
	synchronization
Message-ID: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>

Hi all,

I would like to start by apologizing for the long email but i have quiet a
few questions that i need to clarify :)

So about my problem, i would like to report a miss-behavior of the RabbitMQ
cluster (RabbitMQ 3.1.5, Erlang R14B04) that we come to notice in our
OpenStack cluster, that use RabbitMQ for message delivery. Understanding
OpenStack is not required here but i will try to abstract what is that as
much as i can.

Basically we have 3 nodes RabbitMQ cluster and a bunch OpenStack services
that use RabbitMQ to communicate between them, one of the mean of
communication is RPC, which is done by creating exchanges, queues with
auto-delete flag set, which are the one that exhibit the problem.

So usually all OpenStack services start using one node of the cluster and
when this node go down they connect to another node and make sure that all
exchanges and queues are re-created there, usually the re-creation part end
up being a no-op b/c of the cluster synchronization (Queues are also
created with x-ha-policy set to all).

But in the same time if a node of the cluster go down the Queue consumer
that are created in this node will be deleted, the Queues with auto-delete
will end up being deleted too and the same thing with the exchanges bounded
to them which also have auto-delete, all of this will be done
**eventually** in all RabbitMQ nodes that are still up.

So in detail from neutron side we have:

N1. Connect to node 2.
N2. Create Exchange X.
N3. Create Queue Q.
N4. Create Binding from Q to X.

>From cluster side we have:

R1. Delete consumer.
R2. Delete Queue Q (Binding is deleted explicitly).
R3. Delete Exchange X.

This actually can lead to a race condition that will result of N4 failing
with error stating that exchange doesn't exist because apparently R3 action
was executed after N2 and before N4.

A workaround that we have created is to retry creation if it fail as you
can see in the bug report in OpenStack side
https://bugs.launchpad.net/neutron/+bug/1318721.

But i think that this also a problem in RabbitMQ side, basically i believe
a more sane behavior will be for RabbitMQ to ignore **old** delete if a
newest exchange's declare was sent, instead of threading this later as a no
op.

Does my analyze above make sense !?

When reading also the AMQP 0-9-1 reference (
https://www.rabbitmq.com/amqp-0-9-1-reference.html) i found that:


   - The server SHOULD allow for a reasonable delay between the point when
   it determines that an exchange is not being used (or no longer used), and
   the point when it deletes the exchange. At the least it must allow a client
   to create an exchange and then bind a queue to it, with a small but
   non-zero delay between these two actions.


Does my finding contradict this ? And how big is the delay ?

One last thing is the auto-delete deprecation from
http://www.rabbitmq.com/amqp-0-9-1-errata.html, point 25:

   The 'auto-delete' flag on 'exchange.declare' got deprecated in 0-9-1.
Auto-delete exchanges are actually quite useful, so this flag should be
restored.

Does this mean the auto-delete flag will not be removed from RabbitMQ or
what ?

Thank you for you time and hope this was helpful

--
Mouad Benchchaoui
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/0272d3c5/attachment.html>

From haster2004 at yandex.ru  Tue May 13 14:33:34 2014
From: haster2004 at yandex.ru (Haster)
Date: Tue, 13 May 2014 06:33:34 -0700 (PDT)
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
	login_with_properties function
In-Reply-To: <CAAt2poJ0eQAV1HkW0t+Mf_V7RYS7g4cRpmQ4PzgAwe+7aQv0Sw@mail.gmail.com>
References: <1387786326818-32275.post@n5.nabble.com>
 <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
 <1388037935031-32306.post@n5.nabble.com>
 <CAAt2poJh10xbp1wAE_E_pHUne2KFf5qipskfMsCocsQAVgVF1Q@mail.gmail.com>
 <1398680404528-35118.post@n5.nabble.com>
 <CAAt2poJ0eQAV1HkW0t+Mf_V7RYS7g4cRpmQ4PzgAwe+7aQv0Sw@mail.gmail.com>
Message-ID: <1399988014417-35492.post@n5.nabble.com>

Alan,
I've investigated this problem and found that problem occurs when socket get
descriptor > 1024.
Because we are using select + fdset for wait data on socket, sometimes it
works incorrect (I have heard that select can control only descriptors with
number < 1024).

I see that you also use select in revc_with_timeout function.
Maybe it is better to use poll or epoll in Linux/Unix?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275p35492.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue May 13 14:44:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:44:45 +0400
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
 synchronization
In-Reply-To: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
References: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
Message-ID: <etPan.537221ea.2ae8944a.11ca@mercurio.local>

On 13 May 2014 at 17:28:06, mouad ben (mouadino at gmail.com) wrote:
> > But i think that this also a problem in RabbitMQ side, basically  
> i believe a more sane behavior will be for RabbitMQ to ignore **old**  
> delete if a newest exchange's declare was sent, instead of threading  
> this later as a no op.
>  
> Does my analyze above make sense !?

I personally think that systems that cannot tolerate the current behaviour
should not use auto-delete exchanges.

Is this realistic for OpenStack? Is it only auto-delete exchanges that
cause you practical issues or auto-delete queues, too? If the latter,
have you considered exclusive queues (note that they cannot be mirrored).?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 13 14:52:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:52:16 +0400
Subject: [rabbitmq-discuss] Need clarification on RabbitMq Connection
In-Reply-To: <CAD_i5MFVTj=p9uckh0YxC69-8zi-RNqyfu+BdTcfi_=b=DL8xg@mail.gmail.com>
References: <CAD_i5MFVTj=p9uckh0YxC69-8zi-RNqyfu+BdTcfi_=b=DL8xg@mail.gmail.com>
Message-ID: <etPan.537223ac.238e1f29.11ca@mercurio.local>

On 1 May 2014 at 10:24:19, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > This library needs to
>  
> run always and should not close the connection at all, hence it  
> needs to listen & publish messages always, also this library  
> is running to of ROR application.
>  
> For this requirement I have build an rake task to start listening  
> to RabbitMQ, also I have placed the same code in initializers  
> file in order to start the library along with Apache server in  
> production mode. In production mode initializer file is starting  
> my library to listen & publish the messages to RabbitMq. I have  
> noticed that connectiong to RabbitMq behaves differently via  
> rake task & initilazer file, copied below the rabbitmq log for  
> your reference.
>  
> RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA RAKE TASK: (Connection  
> made one time only)
>  
>  
> =INFO REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:43:24  
> ===
> accepting AMQP connection <0.7409.18> (10.146.14.118:54932(http://10.146.14.118:54932/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/))
>  
> RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA INITIALIZER  
> FILE:(Connection made multiple times)
>  
> =INFO REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:35  
> ===
> accepting AMQP connection <0.6325.18> (10.146.14.118:54928(http://10.146.14.118:54928/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/))
>  
> =INFO REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:35  
> ===
> accepting AMQP connection <0.6329.18> (10.146.14.118:54929(http://10.146.14.118:54929/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/))
>  
>  
> =WARNING REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:37  
> ===
> closing AMQP connection <0.6325.18> (10.146.14.118:54928(http://10.146.14.118:54928/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/)):
> connection_closed_abruptly
>  
> =INFO REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:37  
> ===
> accepting AMQP connection <0.6368.18> (10.146.14.118:54930(http://10.146.14.118:54930/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/))
>  
> =WARNING REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:37  
> ===
> closing AMQP connection <0.6329.18> (10.146.14.118:54929(http://10.146.14.118:54929/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/)):
> connection_closed_abruptly
>  
> =INFO REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:37  
> ===
> accepting AMQP connection <0.6373.18> (10.146.14.118:54931(http://10.146.14.118:54931/)  
> -> 10.112.187.58:5671(http://10.112.187.58:5671/))
>  
>  
> =ERROR REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:42  
> ===
> error on AMQP connection <0.6368.18>: {ssl_upgrade_error,timeout}  
> (unknown POSIX error)
>  
> =ERROR REPORT==== 30-Apr-2014(http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4)::20:28:42  
> ===
> error on AMQP connection <0.6373.18>: {ssl_upgrade_error,timeout}  
> (unknown POSIX error)
>  
>  
>  
>  
> Can
> anybody
> let me know whether the issue with my code or with RabbitMq configuration,  
> you can see my code HERE(https://gist.github.com/loganathan-s/22256c01127065c9d659).  

The initializer is loaded multiple times (I'm very rusty on Rails and Passenger to suggest why).
You need to change your code to not connect N times if $connection is not nil and alive.

And as I said before, if you don't use Thin or EventMachine heavily, please migrate from amqp
gem to Bunny ASAP. You will see your initializer code become much more straightforward
and easier to debug.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 13 14:53:03 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:53:03 +0400
Subject: [rabbitmq-discuss] Alternate Bunny RPC tutorial client
In-Reply-To: <1398997034146-35290.post@n5.nabble.com>
References: <1398997034146-35290.post@n5.nabble.com>
Message-ID: <etPan.537223dc.3d1b58ba.11ca@mercurio.local>

?On 2 May 2014 at 06:18:21, carlhoerberg (carl.hoerberg at gmail.com) wrote:
> > The client in the RPC tutorial for Bunny isn't super performant  
> (maybe not a
> hard requirement for RPC) because it creates new consumers over  
> and over
> again, but it also has a race condition bug, where messages with  
> "wrong"
> correlation_id would be discarded.
> http://www.rabbitmq.com/tutorials/tutorial-six-ruby.html  
>  
> Here's an alternate implementation:
> https://gist.github.com/carlhoerberg/96eb730f4c533f61a856  

Thanks, Carl.

Can you submit a PR to rabbitmq-tutorials? I will propagate your
version to rabbitmq.com after that.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 13 14:54:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 17:54:44 +0400
Subject: [rabbitmq-discuss] Using Pika and PyQtGraph (Qt event loop and
 BlockingConnection)
In-Reply-To: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>
References: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>
Message-ID: <etPan.53722442.2eb141f2.11ca@mercurio.local>

?On 12 May 2014 at 00:34:58, Femto (femto.trader at gmail.com) wrote:
> > maybe you noticed Qt have an event loop
>  
> and I think it's doing odd things with pika.BlockingConnection  
>  
>  
> Any help is welcome.

I doubt that it can, although I know nothing about Qt and little about
Pika implementation.

Have you tried using a different connect, e.g. Tornado?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue May 13 14:59:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 May 2014 14:59:37 +0100
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
	synchronization
In-Reply-To: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
References: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
Message-ID: <53722549.4030002@rabbitmq.com>

On 13/05/2014 14:25, mouad ben wrote:
> RabbitMQ cluster (RabbitMQ 3.1.5,Erlang R14B04)

> (Queues are also created with x-ha-policy set to all).

As an aside, note that x-ha-policy only controls queue mirroring in 2.x! 
In 3.x it does nothing at all. See http://www.rabbitmq.com/ha.html and 
http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/

Of course, autodelete RPC queues quite possibly do not need to be HA.

> But in the same time if a node of the cluster go down the Queue consumer
> that are created in this node will be deleted, the Queues with
> auto-delete will end up being deleted too and the same thing with the
> exchanges bounded to them which also have auto-delete, all of this will
> be done **eventually** in all RabbitMQ nodes that are still up.
>
> So in detail from neutron side we have:
>
> N1. Connect to node 2.
> N2. Create Exchange X.
> N3. Create Queue Q.
> N4. Create Binding from Q to X.
>
>  From cluster side we have:
>
> R1. Delete consumer.
> R2. Delete Queue Q (Binding is deleted explicitly).
> R3. Delete Exchange X.
>
> This actually can lead to a race condition that will result of N4
> failing with error stating that exchange doesn't exist because
> apparently R3 action was executed after N2 and before N4.

That makes sense. But note that R2 and R3 are an atomic event.

> A workaround that we have created is to retry creation if it fail as you
> can see in the bug report in OpenStack side
> https://bugs.launchpad.net/neutron/+bug/1318721.

And that would work as a workaround.

> But i think that this also a problem in RabbitMQ side, basically i
> believe a more sane behavior will be for RabbitMQ to ignore **old**
> delete if a newest exchange's declare was sent, instead of threading
> this later as a no op.

Hmm. Newer than what? The queue delete R2 is not necessarily older than 
then most recent exchange declare N2 in this scenario, is it? In fact, 
isn't R2 always newer than N2?

(Also, doing this would require timestamps in queues, exchanges and 
bindings, updated cluster-wide every time they are re-declared. That 
would be a big problem for performance.)

> Does my analyze above make sense !?

So I'm not sure it does.

> When reading also the AMQP 0-9-1 reference
> (https://www.rabbitmq.com/amqp-0-9-1-reference.html) i found that:
>
>   * The server SHOULD allow for a reasonable delay between the point
>     when it determines that an exchange is not being used (or no longer
>     used), and the point when it deletes the exchange. At the least it
>     must allow a client to create an exchange and then bind a queue to
>     it, with a small but non-zero delay between these two actions.
>
>
> Does my finding contradict this ? And how big is the delay ?

It does; there is no delay in RabbitMQ.

Note that if there were a delay then you'd still have exactly the same 
race anyway, it wouldn't solve anything.

You can get a similar delay for the queue deletion, by using x-expires 
instead of auto-delete. But once the queue goes, the bindings and 
exchange all go atomically.

So how to solve your problem? It sounds like each thing that can receive 
RPC replies declares an exchange, queue and binding for that purpiose, 
with the exchange and queue not linked in to anything else. Is that correct?

If that is so, why not only declare a queue, and have the RPC server 
publish to that queue directly? The queue could still be auto-delete, 
and everything would be simpler. Or is there some subtlety I'm not getting?

> One last thing is the auto-delete deprecation from
> http://www.rabbitmq.com/amqp-0-9-1-errata.html, point 25:
>
> The 'auto-delete' flag on 'exchange.declare' got deprecated in 0-9-1.
> Auto-delete exchanges are actually quite useful, so this flag should be
> restored.
>
> Does this mean the auto-delete flag will not be removed from RabbitMQ or
> what ?

It means we will continue to support it, yes.

Cheers, Simon

From simon at rabbitmq.com  Tue May 13 15:06:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 May 2014 15:06:35 +0100
Subject: [rabbitmq-discuss] silent crashes
In-Reply-To: <1399600852355-35437.post@n5.nabble.com>
References: <1399600852355-35437.post@n5.nabble.com>
Message-ID: <537226EB.8020002@rabbitmq.com>

If the Erlang VM exits abnormally it will usually at least print 
something to stderr. So is anything in /var/log/rabbitmq/startup_err or 
/var/log/rabbitmq/startup_log? If not I'm not sure what can be done.

Cheers, Simon

On 09/05/2014 03:00, carlhoerberg wrote:
> Have a cluster (an independent cluster from the beam blocking issues reported
> earlier) which sometimes crashes on traffic spikes, with absolutely nothing
> in the logs. Apport does a crash dump, but nothing in syslog or anywhere.
> How can we diagnose this better?
>
> RabbitMQ 3.3.1, Erlang 17, ubuntu 12.04
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/silent-crashes-tp35437.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From ask at rabbitmq.com  Tue May 13 15:07:14 2014
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 13 May 2014 15:07:14 +0100
Subject: [rabbitmq-discuss] Using Pika and PyQtGraph (Qt event loop and
	BlockingConnection)
In-Reply-To: <etPan.53722442.2eb141f2.11ca@mercurio.local>
References: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>
 <etPan.53722442.2eb141f2.11ca@mercurio.local>
Message-ID: <0BBC46FE-7FA0-4E0C-9D9B-9624AC45DCE2@rabbitmq.com>


On May 13, 2014, at 2:54 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

>  On 12 May 2014 at 00:34:58, Femto (femto.trader at gmail.com) wrote:
>>> maybe you noticed Qt have an event loop
>> 
>> and I think it's doing odd things with pika.BlockingConnection  
>> 
>> 
>> Any help is welcome.
> 
> I doubt that it can, although I know nothing about Qt and little about
> Pika implementation.
> 
> Have you tried using a different connect, e.g. Tornado?

If PyQt does indeed use an event loop then you will not be able to use a blocking connection.

You have several choices:

1) Implement a pika connection implementation using the PyQt event loop.
2) Use a ?eventlet on pyqt? or ?gevent on pyqt? implementation like eventlet-pyqt
    and use the eventlet or gevent connection in pika.
3) Run pyqt in a separate thread.  This is only an option if pyqt actually supports it, which may
    very well not be the case.


From mklishin at gopivotal.com  Tue May 13 15:09:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 18:09:29 +0400
Subject: [rabbitmq-discuss] Alternate Bunny RPC tutorial client
In-Reply-To: <etPan.537223dc.3d1b58ba.11ca@mercurio.local>
References: <1398997034146-35290.post@n5.nabble.com>
 <etPan.537223dc.3d1b58ba.11ca@mercurio.local>
Message-ID: <etPan.537227b3.79e2a9e3.11ca@mercurio.local>

On 13 May 2014 at 17:55:02, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Can you submit a PR to rabbitmq-tutorials? I will propagate  
> your
> version to rabbitmq.com(http://rabbitmq.com) after that.  

Also note that there were 2 or so RPC tutorial iterations before
we've settled on the current version. The one we have today has higher
throughput than the original one.

We definitely want to have a correct/safe version in the tutorials
but can also provide one or even multiple alternative implementations in rabbitmq-tutorials. Have you
tried running any benchmarks to see how they compare??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 13 15:13:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 18:13:20 +0400
Subject: [rabbitmq-discuss] Writes to Rabbit Occasionally Hang
 Indefinitely
In-Reply-To: <A758C1AE-8EDB-4C69-A507-7B57970E0481@gmail.com>
References: <6ee00146-26d3-4a89-9c1f-5811d4ba058d@googlegroups.com>
 <etPan.535ed6df.614fd4a1.170@mercurio.local>
 <A758C1AE-8EDB-4C69-A507-7B57970E0481@gmail.com>
Message-ID: <etPan.5372289e.515f007c.11ca@mercurio.local>

On 8 May 2014 at 12:12:27, Jeffrey Doto (jeffdoto at gmail.com) wrote:
> > Is this still indicative of the socketWrite timeout issue you  
> referred me to in your last response, or could this be something  
> else? Is there more data you?d like to see that could help diagnose  
> this further?

No, I was referring to?https://github.com/rabbitmq/rabbitmq-java-client/issues/11,
where the key issue is that socket input stream writes block forever
when TCP connection is lost before write finishes.

> Are there any plans to fix https://github.com/rabbitmq/rabbitmq-java-client/issues/11  
> soon? There?s not another more recent version of rabbit we could  
> upgrade to that would help us, is there?

It would be a pretty substantial change to the Java client. There are no
plans to do this in the next few months.

http://rabbitmq.1065348.n5.nabble.com/Long-timeout-if-server-host-becomes-unreachable-td30275.html
suggests a hacky but seemingly functional workaround.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From njay3585 at gmail.com  Tue May 13 16:55:15 2014
From: njay3585 at gmail.com (Jay G)
Date: Tue, 13 May 2014 09:55:15 -0600
Subject: [rabbitmq-discuss] gradual increase of File descriptors
	reaching-1024 (max limit)
Message-ID: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>

Hi All,
Am new to rabbitmq and I have built a 3 node rabbitmq cluster. the cluster
was build a week back and I already see a gradual increase in the # of File
descriptor used, which is now slowly reaching the max limit (1024)

On reading more about this, I know this limit can be increased by changing
the ulimit to XXXX in /etc/default/rabbitmq-server.

But before I increase this, which will need service restart,
What is the possible reason for this gradual increase?
Is there a way to find out if there is a connection leak?

Thank you!

Jay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/4921e898/attachment.html>

From mklishin at gopivotal.com  Tue May 13 17:05:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 20:05:25 +0400
Subject: [rabbitmq-discuss] gradual increase of File descriptors
 reaching-1024 (max limit)
In-Reply-To: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>
References: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>
Message-ID: <etPan.537242de.12200854.11ca@mercurio.local>

On 13 May 2014 at 19:57:30, Jay G (njay3585 at gmail.com) wrote:
> > What is the possible reason for this gradual increase?

Use lsof and netstat to see what file descriptors/sockets the process has open.?

> Is there a way to find out if there is a connection leak?

netstat and RabbitMQ management UI will help you tell if the number of connections
is growing.

It can also be your apps using more queues or vhosts.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From njay3585 at gmail.com  Tue May 13 17:07:19 2014
From: njay3585 at gmail.com (Jay G)
Date: Tue, 13 May 2014 09:07:19 -0700 (PDT)
Subject: [rabbitmq-discuss] gradual increase of File descriptors
	reaching-1024 (max limit)
Message-ID: <c169820f-c5d3-4b7c-9596-017efd60f962@googlegroups.com>

Hi All,
Am new to rabbitmq and I have built a 3 node rabbitmq cluster. the cluster 
was build a week back and I already see a gradual increase in the # of File 
descriptor used, which is now slowly reaching the max limit (1024)

On reading more about this, I know this limit can be increased by changing 
the ulimit to XXXX in /etc/default/rabbitmq-server. 

But before I increase this, which will need service restart, 
What is the possible reason for this gradual increase? 
Is there a way to find out if there is a connection leak? 

Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/0e63fa0c/attachment.html>

From matthias at rabbitmq.com  Tue May 13 17:16:59 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 May 2014 17:16:59 +0100
Subject: [rabbitmq-discuss] gradual increase of File descriptors
 reaching-1024 (max limit)
In-Reply-To: <etPan.537242de.12200854.11ca@mercurio.local>
References: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>
 <etPan.537242de.12200854.11ca@mercurio.local>
Message-ID: <5372457B.7070300@rabbitmq.com>

On 13/05/14 17:05, Michael Klishin wrote:
> On 13 May 2014 at 19:57:30, Jay G (njay3585 at gmail.com) wrote:
>>> What is the possible reason for this gradual increase?
>
> Use lsof and netstat to see what file descriptors/sockets the process has open.
>
>> Is there a way to find out if there is a connection leak?
>
> netstat and RabbitMQ management UI will help you tell if the number of connections
> is growing.
>
> It can also be your apps using more queues or vhosts.

Note also that rabbit will happily use as many file descriptors as it 
can get its hands on, if it thinks that will improve performance. It 
will make room for socket connections as necessary, by closing some 
descriptors for files. So getting close to the limit isn't necessarily 
an indication of a problem. What does the management UI say about the 
available *socket* descriptors?

Matthias.


From sean at monkeysnatchbanana.com  Tue May 13 17:31:28 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Tue, 13 May 2014 12:31:28 -0400
Subject: [rabbitmq-discuss] queue_procs question
Message-ID: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>

I'm trying to understand what I'm seeing with memory usage in our cluster.

We have a mirrored queue that we sometimes have large amounts of publishes
come in during a relatively short period of time. (Say 2 million messages
during 5-10 minutes)

While we are publishing, memory usage on both the primary and mirrored
nodes rises greatly. Almost all the memory used is queue_procs and binary.
Once publishing ceases, the primary node returns to an amount of memory
usage in line with the message size (whereas during publishing its 5 times
or so what you would expect just based on message size).

The mirrored queue trails behind in terms of memory usage dropping but
eventually levels out to similar usage some time later (couple hours later).

If I turn off the consumer of the queue, the memory still stabilizes
eventually.

This has led us to believe that the queue_procs and binary memory usage is
related to publishing and to moving data to the mirror on the other node.
Is that a reasonable assumption?

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/33674fc2/attachment.html>

From lndspereira-rabbit at yahoo.com  Tue May 13 18:04:40 2014
From: lndspereira-rabbit at yahoo.com (Leonardo N. S. Pereira)
Date: Tue, 13 May 2014 10:04:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
In-Reply-To: <1399999641.69566.YahooMailNeo@web125804.mail.ne1.yahoo.com>
References: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
 <1399999641.69566.YahooMailNeo@web125804.mail.ne1.yahoo.com>
Message-ID: <1400000680.65637.YahooMailNeo@web125803.mail.ne1.yahoo.com>



Hi Simon, thanks very much for your answer.
What is the recommended set up for HA running in AWS?
Is there a way to workaround the partition problem? 



> On May 12, 2014, at 6:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> > 
> > On 09/05/2014 20:18, Leonardo N. S. Pereira wrote:
> > I'm bouncing the network connection between two nodes, for instance C
> > and B, in the way that:
> > - A: can reach C and B
> > - C: can
 reach A
> > - B can reach A
> > In this case, the cluster get stuck and only recovers when all nodes are
> > restarted.
> > Is it an expected behavior?
> 
> We don't deal very well with partial partitions in general, and in this specific case it's unclear what pause_minority even *could* do. In this partial partition all >three nodes think that they are in the majority - so pause_minority mode has nothing to do. So I'm afraid this is expected, yes.

Cheers, Simon



?
Leonardo Nogueira de S? Pereira
Tel.: +55 19 3307-5589
Cel.: +55 19
 9122-5943
Skype: leonardo_pereira_77

On Friday, May 9, 2014 4:18 PM, Leonardo N. S. Pereira <lndspereira-rabbit at yahoo.com> wrote:
 
Hi all.
I have a three nodes in a
 cluster deployed on different AWS AZs: A, B and C.
The queues are fully mirrored among nodes, the queues are persistent and cluster partition handler is configured to pause-minority. The RabbitMq version I'm using is 3.3.1
The queues policies are set as:? {"ha-mode":"all","ha-sync-mode":"automatic"} .

I'm bouncing the network connection between two nodes, for instance C and B, in the way that:
- A: can reach C and B
- C: can reach A
- B can reach A
In this case, the cluster get stuck and only recovers when all nodes are restarted.
Is it an expected behavior? 

And if I kill one node, instead of only bounce the connection as before, the cluster is
 still working.
What I think is expected

Thanks in advance for your time and help

Best Regards,
Leo


?
Leonardo Nogueira de S? Pereira
Tel.: +55 19 3307-5589
Cel.: +55 19 9122-5943
Skype: leonardo_pereira_77
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/6b4576ef/attachment.html>

From njay3585 at gmail.com  Tue May 13 18:24:22 2014
From: njay3585 at gmail.com (Jay G)
Date: Tue, 13 May 2014 11:24:22 -0600
Subject: [rabbitmq-discuss] gradual increase of File descriptors
 reaching-1024 (max limit)
In-Reply-To: <5372457B.7070300@rabbitmq.com>
References: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>
 <etPan.537242de.12200854.11ca@mercurio.local>
 <5372457B.7070300@rabbitmq.com>
Message-ID: <CAF63xA+t0NWNeEfzhNBGQLkzkMXnd+h2KUEMjnzxS-5OzN5xHg@mail.gmail.com>

Thank you! The File descriptors D are at 600 and socket descriptors are at
20.


On Tue, May 13, 2014 at 10:16 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 13/05/14 17:05, Michael Klishin wrote:
>
>> On 13 May 2014 at 19:57:30, Jay G (njay3585 at gmail.com) wrote:
>>
>>> What is the possible reason for this gradual increase?
>>>>
>>>
>> Use lsof and netstat to see what file descriptors/sockets the process has
>> open.
>>
>>  Is there a way to find out if there is a connection leak?
>>>
>>
>> netstat and RabbitMQ management UI will help you tell if the number of
>> connections
>> is growing.
>>
>> It can also be your apps using more queues or vhosts.
>>
>
> Note also that rabbit will happily use as many file descriptors as it can
> get its hands on, if it thinks that will improve performance. It will make
> room for socket connections as necessary, by closing some descriptors for
> files. So getting close to the limit isn't necessarily an indication of a
> problem. What does the management UI say about the available *socket*
> descriptors?
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/b72f9840/attachment.html>

From srinatsr at cisco.com  Tue May 13 18:32:02 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 13 May 2014 17:32:02 +0000
Subject: [rabbitmq-discuss] How to get messages count which are not consumed
	from queue?
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>

Hi All,

I need to get only messages count which are not consumed ?

How to avoid requeueing mechanism ?  I don't want any messages to be requeued.  I want all consumed messages to be acknowledged even though if any exceptions occur.



Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/8743d69c/attachment.html>

From matthias at rabbitmq.com  Tue May 13 18:37:28 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 May 2014 18:37:28 +0100
Subject: [rabbitmq-discuss] gradual increase of File descriptors
 reaching-1024 (max limit)
In-Reply-To: <CAF63xA+t0NWNeEfzhNBGQLkzkMXnd+h2KUEMjnzxS-5OzN5xHg@mail.gmail.com>
References: <CAF63xAKDp15DjGowUEMPsmAo-iqkXKjnCuOOF5Wk9iT7Yy5Jeg@mail.gmail.com>	<etPan.537242de.12200854.11ca@mercurio.local>	<5372457B.7070300@rabbitmq.com>
 <CAF63xA+t0NWNeEfzhNBGQLkzkMXnd+h2KUEMjnzxS-5OzN5xHg@mail.gmail.com>
Message-ID: <53725858.2030807@rabbitmq.com>

On 13/05/14 18:24, Jay G wrote:
> Thank you! The File descriptors D are at 600 and socket descriptors are
> at 20.

Nothing to worry about then.

Note that the help (?) on the file descriptors count in the management 
UI does in fact explain exactly what I said:

"To optimize disk access RabbitMQ uses as many free descriptors as are 
available, so the count may safely approach the limit. However, if most 
of the file descriptors are used by sockets then persister performance 
will be negatively impacted."

Matthias.

From mklishin at gopivotal.com  Tue May 13 18:50:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 13 May 2014 21:50:09 +0400
Subject: [rabbitmq-discuss] How to get messages count which are not
 consumed from queue?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
Message-ID: <etPan.53725b6d.6b8b4567.7320@mercurio.local>

?On 13 May 2014 at 21:33:17, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > I need to get only messages count which are not consumed ?

Declare a queue and see the response (queue.declare-ok). Passive declare is
sufficient.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Tue May 13 19:19:26 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 13 May 2014 20:19:26 +0200
Subject: [rabbitmq-discuss] How to get messages count which are not
 consumed from queue?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
Message-ID: <CAMcAHLUVK-pWKdQ72_Ja_7=x5WkjDQLrWDP11-6Oo4Zmxp_RnA@mail.gmail.com>

On Tue, May 13, 2014 at 7:32 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
> How to avoid requeueing mechanism ?  I don?t want any messages to be
> requeued.  I want all consumed messages to be acknowledged even though if
> any exceptions occur.
>

So you essentially want RabbitMQ to discard your message as soon as the
message is send to the consumer. If that's the case, what you want is to
issue a basicConsume with no_ack = true. Be aware that is an unsafe
operation: if an exception occurs you will lose that message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/6148a8e0/attachment.html>

From srinatsr at cisco.com  Tue May 13 19:27:26 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 13 May 2014 18:27:26 +0000
Subject: [rabbitmq-discuss] How to get messages count which are not
 consumed from queue?
In-Reply-To: <etPan.53725b6d.6b8b4567.7320@mercurio.local>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
 <etPan.53725b6d.6b8b4567.7320@mercurio.local>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0DBB3@xmb-aln-x10.cisco.com>

Thanks Michael.

Can I have a piece of sample code in Java.  I have my queue declared and how to see the response for queue.declare-ok ??

Regards ??
Srinath

-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Tuesday, May 13, 2014 10:50 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] How to get messages count which are not consumed from queue?

?On 13 May 2014 at 21:33:17, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > I need to get only messages count which are not consumed ?

Declare a queue and see the response (queue.declare-ok). Passive declare is sufficient.
--
MK  

Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Tue May 13 19:49:18 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 13 May 2014 22:49:18 +0400
Subject: [rabbitmq-discuss] How to get messages count which are not
 consumed from queue?
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0DBB3@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0DACE@xmb-aln-x10.cisco.com>
 <etPan.53725b6d.6b8b4567.7320@mercurio.local>
 <1DB4F5481AB296448E8A5B5BC9D336541CB0DBB3@xmb-aln-x10.cisco.com>
Message-ID: <CAE3HoVTFerKhpSH7yvtz44Lk7pyEjZdmnMb21jkWys7-RFdkkg@mail.gmail.com>

2014-05-13 22:27 GMT+04:00 Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com>:

> I have my queue declared and how to see the response for queue.declare-ok
> ??


Channel#queueDeclare returns AMQP.Queue.DeclareOk. If you take a look at
the Javadoc,

http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.3.1/rabbitmq-java-client-javadoc-3.3.1/com/rabbitmq/client/AMQP.Queue.DeclareOk.html#getMessageCount()

is pretty easy to find.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/e0def9a0/attachment.html>

From femto.trader at gmail.com  Tue May 13 19:50:47 2014
From: femto.trader at gmail.com (Femto Trader)
Date: Tue, 13 May 2014 20:50:47 +0200
Subject: [rabbitmq-discuss] Using Pika and PyQtGraph (Qt event loop and
	BlockingConnection)
In-Reply-To: <0BBC46FE-7FA0-4E0C-9D9B-9624AC45DCE2@rabbitmq.com>
References: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>
 <etPan.53722442.2eb141f2.11ca@mercurio.local>
 <0BBC46FE-7FA0-4E0C-9D9B-9624AC45DCE2@rabbitmq.com>
Message-ID: <CAKz5CKR20H07ZsMP5CqDy19Oioah00eRY5jmD9w5sMo=wS3Hqw@mail.gmail.com>

Hello,

thanks for your reply.

I don't know Tornado at all.

I'm not a very talented developer....
Talking to me of "eventlet on pyqt" or "gevent on pyqt" looks like poetry
to me ;-)

Luke also said me something else:
"One solution that will likely work for you is to move your MQ code to a
new thread, and send a signal back to the GUI thread whenever a message
arrives."

Can someone from RabbitMQ dev team be in touch with PyQt / PySide dev teams
and also PyQtGraph devs in order to have a very basic sample example
because displaying realtime
data coming from a messaging queue could be useful.

One basic example could be:
one python script connect to RabbitMQ and send a random number
an other script receive data and plot them into a PyQtGraph.

I'm not very familiar with threading so I wonder
what will happen if thread that will receive data will take more time to
compute data
(do some calculations on these data) than task to display them


Femto



2014-05-13 16:07 GMT+02:00 Ask Solem <ask at rabbitmq.com>:

>
> On May 13, 2014, at 2:54 PM, Michael Klishin <mklishin at gopivotal.com>
> wrote:
>
> >  On 12 May 2014 at 00:34:58, Femto (femto.trader at gmail.com) wrote:
> >>> maybe you noticed Qt have an event loop
> >>
> >> and I think it's doing odd things with pika.BlockingConnection
> >>
> >>
> >> Any help is welcome.
> >
> > I doubt that it can, although I know nothing about Qt and little about
> > Pika implementation.
> >
> > Have you tried using a different connect, e.g. Tornado?
>
> If PyQt does indeed use an event loop then you will not be able to use a
> blocking connection.
>
> You have several choices:
>
> 1) Implement a pika connection implementation using the PyQt event loop.
> 2) Use a ?eventlet on pyqt? or ?gevent on pyqt? implementation like
> eventlet-pyqt
>     and use the eventlet or gevent connection in pika.
> 3) Run pyqt in a separate thread.  This is only an option if pyqt actually
> supports it, which may
>     very well not be the case.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/64e6e8d7/attachment.html>

From jay.hilden at gmail.com  Tue May 13 17:42:09 2014
From: jay.hilden at gmail.com (Jay Hilden)
Date: Tue, 13 May 2014 11:42:09 -0500
Subject: [rabbitmq-discuss] Why does the UI say all messages are being
	redelivered?
In-Reply-To: <5371CE5B.1010802@rabbitmq.com>
References: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
 <5371CE5B.1010802@rabbitmq.com>
Message-ID: <CAD3qxy55NhaVPZg=gs24KOF7m7+TGxaQ9xvU7VQMhZjZtzv0yw@mail.gmail.com>

Thanks for the response Simon.  I think it may be the "published to a
mirrored queue which subsequently failed over".  This would explain why I'm
only seeing it on one queue in one environment.  I will wait until this
queue is completely cleared out and see if my problem resolves itself.

Thank you again.


On Tue, May 13, 2014 at 2:48 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> All the messages that are being delivered have been marked as redelivered
> at some point. Possible reasons include that they were all delivered to but
> not acked by a client which subsequently disconnected, or rejected/nacked
> them, or invoked basic.recover. Or that they were published to a mirrored
> queue which subsequently failed over.
>
> Do any of those sound right?
>
> Cheers, Simon
>
> On 12/05/2014 23:30, Jay Hilden wrote:
>
>> We have a 2 node cluster in production that has many vhosts and many
>> queues, all working great.  There is one queue that when it processes
>> the data it lists all messages are being redelivered.  So the UI will
>>
>> say "deliver/get (of which redelivered): 65/s (65/s)".  It looks like
>> all of the messages are being redelivered.  This is only happening on
>> one queue.
>>
>> Can anyone help me with the root cause of this issue?
>>
>> Thank you in advance.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/11b55ba8/attachment.html>

From zbbentley at gmail.com  Tue May 13 18:49:06 2014
From: zbbentley at gmail.com (Zac Bentley)
Date: Tue, 13 May 2014 13:49:06 -0400
Subject: [rabbitmq-discuss] RabbitMQ cluster is intermittently failing after
 federating between different VHOSTs on the same cluster
Message-ID: <CAAFQqzRCSWszJy5ukcH=9_sBa3UpA-KUe8=H0_-v2=VgNfU=pw@mail.gmail.com>

I also posted this to StackOverflow.

We run several production rabbit clusters (two nodes each), and transfer
messages between them using federation. In development/testing, we only
have one cluster due to hardware/resource limitations. In order to (poorly,
but still better than nothing) test federation, we create federation
links *between
two virtual hosts on the same cluster*. This is sketchy, I know, but it
worked for us when using RabbitMQ 2.8.5, and usually works for us on 3.2.4
(see the issue below). Someday we may succeed in making the case that we
need a second development Rabbit cluster, but today is not that day.

*How I setup intra-cluster federation:*

Once the cluster is configured and all nodes report ready, I run a test
that does the following. It always talks to one node in the cluster; it
doesn't load-balance yet (once the test becomes stable, we will use a DNS
load balancer across both cluster nodes).

Frst, it sets up its environment. It creates a test user and a pair of
testing virtual hosts, granting the appropriate permissions, and ensuring
that it can access both vhosts via AMQP and the API as that user. Then, it
sets up the federation links by creating an upstream on the first vhost
(call it A) pointing to the second vhost on the same cluster (call it vhost
B). Then, it creates a policy which applies the upstream (directly; we only
use one, so I don't create any upstream sets, though I could if need be) to
an exchange. It then polls the federation link via the API until it reports
a status of "running". I could also poll the exchange for existence on the
upstream Vhost, but I haven't seen a need to do so.

Then, to make sure federation is actually usable, I publish AMQP messages
into the federated exchange on B, and make sure they are received on A.

This test usually works. We did something similar on RabbitMQ 2.8.5, and it
worked flawlessly (without the policies; using federation upstreams etc.
configured in the file).

*The problem:*

This test *usually* works. However, sometimes (about 20% of the time, by my
estimate) it breaks the cluster. Occasionally, between 1 and 5 minutes
after running the test, the cluster stops being fully responsive. A full
description of the symptoms follows:

   - When the cluster is in this state, I can open AMQP connections
   (authentication, tuning, etc all complete successfully), but I get no RPC
   replies for any subsequent AMQP methods (declare*, consume, etc).
   - The management API will not load the "Admin" section, doing nothing in
   GUI mode, and returning [] in JSON mode.
   - Attempting to publish a message via the management UI results in the
   entire API becoming permanently inaccessible (pages only render the
   RabbitMQ logo and no other components, and JSON requests time out).
   - Nothing is written to the log (main file or SASL) after a few seconds
   before the outage starts. The last log entry is unpredictable; sometimes it
   is a record of the test user created for federation having its password
   change, sometimes it is a record of test Vhost being automatically deleted
   after the test, sometimes it is a record of an AMQP connection being
   accepted. All subsequent events are not logged (even successful AMQP
   connections, though, as detailed above, I can't do anything via RPC once
   connected).
   - Both the Beam and rabbitmq-server processes on both nodes consume
   minimal resources while hung; running strace on rabbitmq-server, beam,
   and the Erlang helper inet_gethostprocesses just shows a lot of system
   select calls either sticking indefinitely or timing out and being
   immediately retried.
   - Checking the open sockets for processes owned by the rabbitmq user
   shows that there are two (bidirectional, two sockets each) IPV4 links from
   the master node of the cluster to itself (presumably those are the
   federation links, or some other manager process). It also shows every API
   HTTP connection initiated since the start of the outage in CLOSE_WAIT
    status.

Some interesting things happen when I try to shut down the cluster:

   - Attempting to shut down either node of the cluster via the init
   scripts or rabbitmqctl hangs indefinitely. Nothing is written to
   shutdown_err unless I interrupt the hung shutdown, in which case a
   notification of the interrupt is logged.
   - After an attempted shutdown the management API/UI becomes
   inaccessible, and any hung connections that were in CLOSE_WAIT status
   dissapear.
   - All RabbitMQ processes that were visible before the shutdown attempt
   remain visible. AMQP operations are still impossible.
   - Killing the RabbitMQ processes (via SIGTERM) and then restarting the
   master node in the cluster resolves the issue. Rabbit starts back up, and
   all objects, federation links, etc. created before the outage are available
   and working.

*Questions:*

   1. Why is this happening?
   2. Is this only happening because of the strange intra-cluster
   federation setup I have, or is there another cause?
   3. How do I resolve it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/28612a33/attachment.html>

From terry.jahelka at issinc.com  Tue May 13 21:35:38 2014
From: terry.jahelka at issinc.com (Theresa Jahelka)
Date: Tue, 13 May 2014 20:35:38 +0000
Subject: [rabbitmq-discuss]  STOMP & selector
Message-ID: <72bacaf5fbcd4b8dabb939c635ac0b67@DM2PR04MB367.namprd04.prod.outlook.com>

I'm using RabbitMQ 3.2.3,  does this version support the "selector" STOMP header ?

Terry Jahelka
Intelligent Software Solutions
5450 Tech Center Drive
Colorado Springs, CO  80919
(719)452-7773 (office)
terry.jahelka at issinc.com<mailto:terry.jahelka at issinc.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/17bfb1ad/attachment.html>

From mklishin at gopivotal.com  Wed May 14 02:58:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 05:58:06 +0400
Subject: [rabbitmq-discuss] STOMP & selector
In-Reply-To: <72bacaf5fbcd4b8dabb939c635ac0b67@DM2PR04MB367.namprd04.prod.outlook.com>
References: <72bacaf5fbcd4b8dabb939c635ac0b67@DM2PR04MB367.namprd04.prod.outlook.com>
Message-ID: <etPan.5372cdcd.66334873.7320@mercurio.local>

On 14 May 2014 at 01:46:58, Theresa Jahelka (terry.jahelka at issinc.com) wrote:
> > I?m using RabbitMQ 3.2.3, does this version support the ?selector?  
> STOMP header ?

No, the "selector" header is not supported.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ramtinova at gmail.com  Wed May 14 05:05:03 2014
From: ramtinova at gmail.com (rafael)
Date: Tue, 13 May 2014 21:05:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Connecting To Rabbitmq Server On Ubuntu
 14.04 EC2 Instance From Outside
In-Reply-To: <CAMcAHLWFBZAod0_jVfxQZ6-wS96PAEzrgi69J8bqFirhcmQ9ug@mail.gmail.com>
References: <1399843523718-35459.post@n5.nabble.com>
 <53709229.7070302@rabbitmq.com>
 <CAMcAHLWFBZAod0_jVfxQZ6-wS96PAEzrgi69J8bqFirhcmQ9ug@mail.gmail.com>
Message-ID: <CAO_tTRrNR4VAZtuD3rJbkVQammxB6LE9t6+kb-bEVnuLheDpng@mail.gmail.com>

Well,
The actual problem was issues by the VPN I used,
I used Kerio VPN from a provider and as I disabled the Kerio server I could
successfully connect to the
RabbitMQ.

Things happen ;)


On Mon, May 12, 2014 at 4:32 PM, Alvaro Videla-2 [via RabbitMQ] <
ml-node+s1065348n35473h14 at n5.nabble.com> wrote:

> Also be aware about the guest:guest user limitation when connecting
> from remote nodes. If you are using  different user, then ignore my
> comment.
>
> Cheers,
>
> Alvaro
>
> On Mon, May 12, 2014 at 11:19 AM, Simon MacMullen <[hidden email]<http://user/SendEmail.jtp?type=node&node=35473&i=0>>
> wrote:
>
> > This is more of a question about EC2 networking / firewall really - the
> > RabbitMQ instance looks like it is up and listening, that's as much as
> it
> > can do.
> >
> > I can only suggest traceroute and trying to connect from the machine
> itself
> > to try to narrow down where the problem lies.
> >
> > Cheers, Simon
> >
> >
> > On 11/05/2014 22:25, rafael wrote:
> >>
> >> Hi,
> >> I cannot access rabbitmq server outside the amazon ec2 here is what
> I've
> >> done my settings:
> >>
> >> EC2 Instances Security Groups :
> >>
> >> <http://rabbitmq.1065348.n5.nabble.com/file/n35459/1.png>
> >>
> >> my /etc/rabbitmq/rabbitmq-env.conf file :
> >>
> >> NODE_IP_ADDRESS=<instance private ip taken from ifconfig = 177.31.*.*>
> >>
> >> my /etc/hosts  file :
> >>
> >> 127.0.0.1 localhost
> >> 172.31.*.* ip-172-31-*-*
> >> # The following lines are desirable for IPv6 capable hosts
> >> ::1 ip6-localhost ip6-loopback
> >> fe00::0 ip6-localnet
> >> ff00::0 ip6-mcastprefix
> >> ff02::1 ip6-allnodes
> >> ff02::2 ip6-allrouters
> >> ff02::3 ip6-allhosts
> >>
> >> my netstat -vpln command output :
> >>
> >> Active Internet connections (only servers)
> >> Proto Recv-Q Send-Q Local Address           Foreign Address
> State
> >> PID/Program name
> >> tcp        0      0        0.0.0.0:22              0.0.0.0:*
> >> LISTEN      927/sshd
> >> tcp        0      0        172.31.*.*:5672      0.0.0.0:*
> >> LISTEN      4662/beam
> >> tcp        0      0        0.0.0.0:25672           0.0.0.0:*
> >> LISTEN      4662/beam
> >> tcp        0      0        0.0.0.0:4369            0.0.0.0:*
> >> LISTEN      2089/epmd
> >> tcp6       0      0        :::22                   :::*
> >> LISTEN      927/sshd
> >> udp        0      0        0.0.0.0:68              0.0.0.0:*
> >> 501/dhclient
> >> udp        0      0        0.0.0.0:45419           0.0.0.0:*
> >> 501/dhclient
> >> udp6       0      0        :::61763                :::*
> >> 501/dhclient
> >>
> >>
> >> but whenever from my personal computer I perform :
> >> $ telnet <instance public IP >  5672
> >>
> >> Trying 54.86.148.143...
> >> telnet: Unable to connect to remote host: Connection timed out
> >>
> >> I've set the NODE_IP_ADDRESS to 0.0.0.0 and still no success.
> >>
> >> any idea?
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> --
> >> View this message in context:
> >>
> http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459.html
> >> Sent from the RabbitMQ mailing list archive at Nabble.com.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> [hidden email] <http://user/SendEmail.jtp?type=node&node=35473&i=1>
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > [hidden email] <http://user/SendEmail.jtp?type=node&node=35473&i=2>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=35473&i=3>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459p35473.html
>  To unsubscribe from Connecting To Rabbitmq Server On Ubuntu 14.04 EC2
> Instance From Outside, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=35459&code=cmFtdGlub3ZhQGdtYWlsLmNvbXwzNTQ1OXw4NjY4OTYxMg==>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connecting-To-Rabbitmq-Server-On-Ubuntu-14-04-EC2-Instance-From-Outside-tp35459p35520.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140513/774b48f8/attachment.html>

From sekhar434145 at gmail.com  Wed May 14 07:52:29 2014
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 14 May 2014 12:22:29 +0530
Subject: [rabbitmq-discuss] Response message ClassCastException: Cannot cast
 java.util.LinkedHashMap (id=173) to com.sw.Employee
Message-ID: <CAH75Yb5wTKyd-sMbH1MwQDbobstchQb7Rx9XdBaNoJj-+0BDLQ@mail.gmail.com>

Hi Team,

Am getting cannot cast exception in Listener when I am trying to send
LinkedHashMap as request at producer end using Spring AMQP.

Request -
Map<String, Object> reqMap = new LinkedHashMap<String, Object>();
Employee emp = new Employee();
reqMap.put("empObj", emp);
reqMap.put("comp", "XYZ");
template.convertAndSend(reqMap);

Respons-
void handleMessage(Map myReqMsg){
 Employee emp = (Employee)  myReqMsg.get("empObj");
}

Exception at Consumer End :-
ClassCastException: Cannot cast java.util.LinkedHashMap (id=173) to
com.sw.Employee

Thanks,
Sekhar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/d1fefdcc/attachment.html>

From matthias at rabbitmq.com  Wed May 14 08:07:51 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 May 2014 08:07:51 +0100
Subject: [rabbitmq-discuss] Response message ClassCastException: Cannot
 cast java.util.LinkedHashMap (id=173) to com.sw.Employee
In-Reply-To: <CAH75Yb5wTKyd-sMbH1MwQDbobstchQb7Rx9XdBaNoJj-+0BDLQ@mail.gmail.com>
References: <CAH75Yb5wTKyd-sMbH1MwQDbobstchQb7Rx9XdBaNoJj-+0BDLQ@mail.gmail.com>
Message-ID: <53731647.40208@rabbitmq.com>

On 14/05/14 07:52, Rajasekhar P wrote:
> Am getting cannot cast exception in Listener when I am trying to send
> LinkedHashMap as request at producer end using Spring AMQP.

Looks like you are using spring-amqp, so I suggest you re-post your 
question on the spring-amqp forum: 
http://forum.spring.io/forum/spring-projects/integration/amqp.

Matthias.

From vin.degroote at gmail.com  Wed May 14 08:46:27 2014
From: vin.degroote at gmail.com (Vincent Degroote)
Date: Wed, 14 May 2014 00:46:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Purge based on a routing key
In-Reply-To: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>
References: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>
Message-ID: <2dc8ded7-e3f8-4067-9075-47e5b7399a9c@googlegroups.com>

Nobody?
aka disguised up...

Le vendredi 9 mai 2014 16:37:51 UTC+2, Vincent Degroote a ?crit :
>
> Hi,
>
> I would like to know if there is a way to purge messages with a specific 
> routing key inside one queue.
>
> Thanks for your answer.
>
> ps: I'm using php-amqlib
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/f8570b40/attachment.html>

From videlalvaro at gmail.com  Wed May 14 08:50:52 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 14 May 2014 09:50:52 +0200
Subject: [rabbitmq-discuss] Purge based on a routing key
In-Reply-To: <2dc8ded7-e3f8-4067-9075-47e5b7399a9c@googlegroups.com>
References: <705c8765-0d66-4fdf-8e94-342e034c8425@googlegroups.com>
 <2dc8ded7-e3f8-4067-9075-47e5b7399a9c@googlegroups.com>
Message-ID: <CAMcAHLXsUqwK06b-4HXBsm5JW6iDr8j1Egv97h0TP18hejDXxw@mail.gmail.com>

Hi,

My colleague Michael already replied to this. The answer is no.

Cheers,

Alvaro


On Wed, May 14, 2014 at 9:46 AM, Vincent Degroote <vin.degroote at gmail.com>wrote:

> Nobody?
> aka disguised up...
>
> Le vendredi 9 mai 2014 16:37:51 UTC+2, Vincent Degroote a ?crit :
>
>> Hi,
>>
>> I would like to know if there is a way to purge messages with a specific
>> routing key inside one queue.
>>
>> Thanks for your answer.
>>
>> ps: I'm using php-amqlib
>>
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/da3682db/attachment.html>

From simon at rabbitmq.com  Wed May 14 08:58:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 May 2014 08:58:07 +0100
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
In-Reply-To: <1400000680.65637.YahooMailNeo@web125803.mail.ne1.yahoo.com>
References: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
 <1399999641.69566.YahooMailNeo@web125804.mail.ne1.yahoo.com>
 <1400000680.65637.YahooMailNeo@web125803.mail.ne1.yahoo.com>
Message-ID: <5373220F.3090709@rabbitmq.com>

On 13/05/2014 18:04, Leonardo N. S. Pereira wrote:
> Hi Simon, thanks very much for your answer.
> What is the recommended set up for HA running in AWS?
> Is there a way to workaround the partition problem?

Don't cluster across more than two AZs.

Unless service availability is more important to you than avoiding data 
loss, don't cluster across AZs at all.

Cheers, Simon


From simon at rabbitmq.com  Wed May 14 09:05:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 May 2014 09:05:07 +0100
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
Message-ID: <537323B3.1020002@rabbitmq.com>

I'm not quite sure what the real question is here. The queue_procs and 
binary memory slices will describe memory used by queues (with message 
bodies in 'binary' and everything else in 'queue_procs'). This is a 
fairly raw count according to what the Erlang VM tells us, so for 
example this includes memory used by unreachable objects that have not 
yet been GCed.

So "related to publishing and to moving data to the mirror on the other 
node" - well, yes, those are things queues do, so they can use memory 
doing so. But they can do other things too, and thus might use memory 
for other purposes :-)

Cheers, Simon

On 13/05/2014 17:31, Sean Allen wrote:
> I'm trying to understand what I'm seeing with memory usage in our cluster.
>
> We have a mirrored queue that we sometimes have large amounts of
> publishes come in during a relatively short period of time. (Say 2
> million messages during 5-10 minutes)
>
> While we are publishing, memory usage on both the primary and mirrored
> nodes rises greatly. Almost all the memory used is queue_procs and
> binary. Once publishing ceases, the primary node returns to an amount of
> memory usage in line with the message size (whereas during publishing
> its 5 times or so what you would expect just based on message size).
>
> The mirrored queue trails behind in terms of memory usage dropping but
> eventually levels out to similar usage some time later (couple hours later).
>
> If I turn off the consumer of the queue, the memory still stabilizes
> eventually.
>
> This has led us to believe that the queue_procs and binary memory usage
> is related to publishing and to moving data to the mirror on the other
> node. Is that a reasonable assumption?


From matthias at rabbitmq.com  Wed May 14 09:05:34 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 May 2014 09:05:34 +0100
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
In-Reply-To: <5373220F.3090709@rabbitmq.com>
References: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
 <1399999641.69566.YahooMailNeo@web125804.mail.ne1.yahoo.com>
 <1400000680.65637.YahooMailNeo@web125803.mail.ne1.yahoo.com>
 <5373220F.3090709@rabbitmq.com>
Message-ID: <537323CE.3030607@rabbitmq.com>

On 14/05/14 08:58, Simon MacMullen wrote:
> On 13/05/2014 18:04, Leonardo N. S. Pereira wrote:
>> Hi Simon, thanks very much for your answer.
>> What is the recommended set up for HA running in AWS?
>> Is there a way to workaround the partition problem?
>
> Don't cluster across more than two AZs.
>
> Unless service availability is more important to you than avoiding data
> loss, don't cluster across AZs at all.

Also note that in practice the situation you created in your tests, and 
which causes the odd behaviour - partial partitions (where communication 
between nodes is severed in just one direction) - is less likely to 
occur in practice than full partitions.

Matthias.

From v.k.manik at gmail.com  Wed May 14 09:53:35 2014
From: v.k.manik at gmail.com (varun kumar manik)
Date: Wed, 14 May 2014 14:23:35 +0530
Subject: [rabbitmq-discuss] simple query
Message-ID: <CAP8Np5jYBCQhSMS+Np8eko7eBOY3TqvUfb51wmFqDO7bWjxJSw@mail.gmail.com>

Hello
 to whom it mar concern.

Plz let me know the detail that how we could plot the graph like  the
attached image.

I am using visual studio for C#

Thanks and Regards.......!

*Varun Kumar*

+91-933-641-4693/ 7275 99 33 11
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/00f448a9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pveoJkp.png
Type: image/png
Size: 22232 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/00f448a9/attachment.png>

From simon at rabbitmq.com  Wed May 14 10:28:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 May 2014 10:28:40 +0100
Subject: [rabbitmq-discuss] simple query
In-Reply-To: <CAP8Np5jYBCQhSMS+Np8eko7eBOY3TqvUfb51wmFqDO7bWjxJSw@mail.gmail.com>
References: <CAP8Np5jYBCQhSMS+Np8eko7eBOY3TqvUfb51wmFqDO7bWjxJSw@mail.gmail.com>
Message-ID: <53733748.7090909@rabbitmq.com>

On 14/05/14 09:53, varun kumar manik wrote:
> Plz let me know the detail that how we could plot the graph like  the
>  attached image.

I assume you mean "How do I obtain the raw data for the chart so I can
draw it?" rather than "How does the management UI draw charts?"

You can get this data from the HTTP API as documented here:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/4d126a7382d7/priv/www/api/index.html

Note in particular the paragraph:

> URIs which return some forms of numerical data (such as message rates
> and queue lengths) can return historical samples. To return samples
> you need to set an age and an increment for the samples you want. The
> end of the range returned will always correspond to the present. Use
> msg_rates_age and msg_rates_incr to return samples for messages sent
> and received, data_rates_age and data_rates_incr to return samples
> for bytes sent and received, and lengths_age and lengths_incr to
> return samples for queue lengths. For example, appending
> ?lengths_age=3600&lengths_incr=60 will return the last hour's data on
> queue lengths, with a sample for every minute.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Wed May 14 12:00:29 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 14 May 2014 07:00:29 -0400
Subject: [rabbitmq-discuss] Cluster problem after network bouncing
In-Reply-To: <537323CE.3030607@rabbitmq.com>
References: <1399663096.62497.YahooMailNeo@web125802.mail.ne1.yahoo.com>
 <1399999641.69566.YahooMailNeo@web125804.mail.ne1.yahoo.com>
 <1400000680.65637.YahooMailNeo@web125803.mail.ne1.yahoo.com>
 <5373220F.3090709@rabbitmq.com> <537323CE.3030607@rabbitmq.com>
Message-ID: <CAKgmDnGoQj9yJKejHbnDqJ9daKmRnbBB2nLi_E0sOsfr+k5a1g@mail.gmail.com>

Actually we have many clusters running across 3 zones in AWS :)

But we are prepared to lose entire regions, wholly or partially.

And we never persist messages in our rabbits - instead we use a
multi-region Cassandra cluster. Oh and S3 for large message bodies.

Plus important messages (anything not individually addressed) are
replicated for processing multiple times across multiple regions, racing to
resolution.

It is a 'rabbits everywhere' strategy: a global mesh of redundant
cooperating clusters that replicate, route, and resolve messages and use
Cassandra and S3 for persistence.

The key to keeping a cluster up across zones in AWS is to never, ever
overload it so there is no interruption of inter-cluster communications.
The key statistic to monitor is IO wait.

We over-provision our cluster members to be sure they have enough
instantaneous resource at all times. And, as I said, we never persist
messages on the cluster.

ml


On Wed, May 14, 2014 at 4:05 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 14/05/14 08:58, Simon MacMullen wrote:
>
>> On 13/05/2014 18:04, Leonardo N. S. Pereira wrote:
>>
>>> Hi Simon, thanks very much for your answer.
>>> What is the recommended set up for HA running in AWS?
>>> Is there a way to workaround the partition problem?
>>>
>>
>> Don't cluster across more than two AZs.
>>
>> Unless service availability is more important to you than avoiding data
>> loss, don't cluster across AZs at all.
>>
>
> Also note that in practice the situation you created in your tests, and
> which causes the odd behaviour - partial partitions (where communication
> between nodes is severed in just one direction) - is less likely to occur
> in practice than full partitions.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/1e6a67ba/attachment.html>

From carl.hoerberg at gmail.com  Wed May 14 12:54:47 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 14 May 2014 04:54:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ + TLS + default Erlang with Ubuntu 14.04
Message-ID: <1400068486848-35532.post@n5.nabble.com>

Seems to be a problem with the default erlang coming with ubuntu 14.04,
rabbitmq and TLS. 

When enabling TLS it causes problems with some TLS clients. 

Firefox: 
Secure Connection Failed
An error occurred during a connection to purple-fawn.rmq.cloudamqp.com. The
key does not support the requested operation. (Error code:
sec_error_invalid_key)

Chrome: 
Error code: ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED

Safari: Works

Java: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_DOMAIN_PARAMS_INVALID

When installing Erlang R17 from erlang-solutions it works fine. Erlang
R16B3-1 (the version coming with ubutu 14.04) from erlang-solutions on
ubuntu 12.04 works fine too. 

RabbitMQ logs: 

2014-05-14 11:38:45 UTC ERROR
SSL: certify: tls_connection.erl:375:Fatal error: unexpected message

2014-05-14 11:38:45 UTC ERROR
** gen_event handler rabbit_sasl_report_file_h crashed.
** Was installed in error_logger
** Last event was: {error_report,<0.339.0>,
                       {<0.348.0>,std_error,
                        {mochiweb_socket_server,295,
                            {acceptor_error,{error,accept_failed}}}}}
** When handler state == {<0.47.0>,
                         
"/var/log/rabbitmq/rabbit at purple-fawn-01-sasl.log",
                          error}
** Reason == {function_clause,
                 [{truncate,'-report/2-lc$^0/1-0-',
                      [{mochiweb_socket_server,295,
                           {acceptor_error,{error,accept_failed}}},
                       {2000,100,50,5}],
                      []},
                  {truncate,log_event,2,[]},
                  {rabbit_sasl_report_file_h,handle_event,2,[]},
                  {gen_event,server_update,4,
                      [{file,"gen_event.erl"},{line,522}]},
                  {gen_event,server_notify,4,
                      [{file,"gen_event.erl"},{line,504}]},
                  {gen_event,server_notify,4,
                      [{file,"gen_event.erl"},{line,506}]},
                 
{gen_event,handle_msg,5,[{file,"gen_event.erl"},{line,266}]},
                  {proc_lib,init_p_do_apply,3,
                      [{file,"proc_lib.erl"},{line,239}]}]}

2014-05-14 11:38:45 UTC ERROR
** gen_event handler rabbit_error_logger_file_h crashed.
** Was installed in error_logger
** Last event was: {error_report,<0.339.0>,
                       {<0.348.0>,std_error,
                        {mochiweb_socket_server,295,
                            {acceptor_error,{error,accept_failed}}}}}
** When handler state == {<0.46.0>,
                          "/var/log/rabbitmq/rabbit at purple-fawn-01.log",[]}
** Reason == {function_clause,
                 [{truncate,'-report/2-lc$^0/1-0-',
                      [{mochiweb_socket_server,295,
                           {acceptor_error,{error,accept_failed}}},
                       {2000,100,50,5}],
                      []},
                  {truncate,log_event,2,[]},
                  {rabbit_error_logger_file_h,handle_event,2,[]},
                  {gen_event,server_update,4,
                      [{file,"gen_event.erl"},{line,522}]},
                  {gen_event,server_notify,4,
                      [{file,"gen_event.erl"},{line,504}]},
                  {gen_event,server_notify,4,
                      [{file,"gen_event.erl"},{line,506}]},
                 
{gen_event,handle_msg,5,[{file,"gen_event.erl"},{line,266}]},
                  {proc_lib,init_p_do_apply,3,
                      [{file,"proc_lib.erl"},{line,239}]}]}

2014-05-14 11:38:59 UTC ERROR
SSL: certify: tls_connection.erl:375:Fatal error: unexpected message

2014-05-14 11:39:14 UTC ERROR
SSL: certify: tls_connection.erl:375:Fatal error: unexpected message




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-TLS-default-Erlang-with-Ubuntu-14-04-tp35532.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed May 14 13:05:27 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 16:05:27 +0400
Subject: [rabbitmq-discuss] RabbitMQ + TLS + default Erlang with Ubuntu
 14.04
In-Reply-To: <1400068486848-35532.post@n5.nabble.com>
References: <1400068486848-35532.post@n5.nabble.com>
Message-ID: <etPan.53735c24.2ae8944a.7320@mercurio.local>

On 14 May 2014 at 15:55:56, carlhoerberg (carl.hoerberg at gmail.com) wrote:
> > When installing Erlang R17 from erlang-solutions it works  
> fine. Erlang
> R16B3-1 (the version coming with ubutu 14.04) from erlang-solutions  
> on
> ubuntu 12.04 works fine too.

Have you tried openssl s_client? It's hard to tell what's going on.
There's a bunch of ssl app fixes in R17:
http://www.erlang.org/download/otp_src_17.0.readme

but I'm not sure why 2 different packages of R16B03-1 behave differently.
Can they use different OpenSSL versions??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From grussell at gopivotal.com  Wed May 14 13:47:19 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Wed, 14 May 2014 08:47:19 -0400
Subject: [rabbitmq-discuss] Response message ClassCastException: Cannot
 cast java.util.LinkedHashMap (id=173) to com.sw.Employee
In-Reply-To: <53731647.40208@rabbitmq.com>
References: <CAH75Yb5wTKyd-sMbH1MwQDbobstchQb7Rx9XdBaNoJj-+0BDLQ@mail.gmail.com>
 <53731647.40208@rabbitmq.com>
Message-ID: <CADtU9_usjpuJH2PVfjfiCZG+H-g_L4OqQMFp6T=9ARNLzxTryw@mail.gmail.com>

Yes, please post over there, or on Stack Overflow (http://stackoverflow.com/)
with tag "spring-amqp".

Please include the full stack trace for the exception and include a DEBUG
log on the listener side if possible.


On Wed, May 14, 2014 at 3:07 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 14/05/14 07:52, Rajasekhar P wrote:
>
>> Am getting cannot cast exception in Listener when I am trying to send
>> LinkedHashMap as request at producer end using Spring AMQP.
>>
>
> Looks like you are using spring-amqp, so I suggest you re-post your
> question on the spring-amqp forum: http://forum.spring.io/forum/
> spring-projects/integration/amqp.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/fc2c23f8/attachment.html>

From v.k.manik at gmail.com  Wed May 14 12:53:50 2014
From: v.k.manik at gmail.com (varun kumar manik)
Date: Wed, 14 May 2014 17:23:50 +0530
Subject: [rabbitmq-discuss] simple query
In-Reply-To: <53733748.7090909@rabbitmq.com>
References: <CAP8Np5jYBCQhSMS+Np8eko7eBOY3TqvUfb51wmFqDO7bWjxJSw@mail.gmail.com>
 <53733748.7090909@rabbitmq.com>
Message-ID: <CAP8Np5jfZSEp-_4QyZyvD_NBScDF4723-DzpF10LNFcwSc-spw@mail.gmail.com>

Thanks for your quick reply, Simon.
 Simon Pleas read this and, if possible help me

I am comparing some hypervisor (hyper-v, xen esxi and kvm.) through
rabbitmq.
my setup is like this.
1. Install the hypervisors on my laptop.
2. create a virtual machines of windows server 2008 R2 and install the
rabbitmq server on this virtual machin.
3. passing 10,00,000 message from one producer to two consumers. and get
the graph on browser.

result: on the basis of time taken to pass the messages and behavior of
graph, i am comparing the hypervisors.

*Weather this idea is genuine for hypervisor comparison...?*
*If notplease suggest me something good to compare the hypervisors. *

*Looking forward to hear from you.*

Thanks and Regards.......!

*Varun Kumar*

+91-933-641-4693/ 7275 99 33 11



On Wed, May 14, 2014 at 2:58 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/05/14 09:53, varun kumar manik wrote:
>
>> Plz let me know the detail that how we could plot the graph like  the
>>  attached image.
>>
>
> I assume you mean "How do I obtain the raw data for the chart so I can
> draw it?" rather than "How does the management UI draw charts?"
>
> You can get this data from the HTTP API as documented here:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/
> 4d126a7382d7/priv/www/api/index.html
>
> Note in particular the paragraph:
>
>  URIs which return some forms of numerical data (such as message rates
>> and queue lengths) can return historical samples. To return samples
>> you need to set an age and an increment for the samples you want. The
>> end of the range returned will always correspond to the present. Use
>> msg_rates_age and msg_rates_incr to return samples for messages sent
>> and received, data_rates_age and data_rates_incr to return samples
>> for bytes sent and received, and lengths_age and lengths_incr to
>> return samples for queue lengths. For example, appending
>> ?lengths_age=3600&lengths_incr=60 will return the last hour's data on
>> queue lengths, with a sample for every minute.
>>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/ca4bf0a0/attachment.html>

From sorrison at gmail.com  Wed May 14 13:53:55 2014
From: sorrison at gmail.com (Sam Morrison)
Date: Wed, 14 May 2014 05:53:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Phantom consumers
Message-ID: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>

Hi,

We've got 2 3 node rabbit clusters, one using 3.1.3 and one using 3.3.0. We 
mirror all queues.

Every so often we get queues filling up in the unacked counters. When we 
investigate we see the queue has 2 consumers both from the same client 
address.
One consumer links back to a connection that doesn't exist on the client or 
the server.

If we stop the client one of the consumers goes away but we are still left 
with a phantom one.

The only way we have been able to fix this is by deleting the queue and 
restarting the client.

While it is in this state the client doesn't get any messages.

This happens with both our clusters.

Anyone else seeing this or know what the issue is?

Thanks,
Sam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/a1632dce/attachment.html>

From sean at monkeysnatchbanana.com  Wed May 14 15:42:36 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Wed, 14 May 2014 10:42:36 -0400
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <537323B3.1020002@rabbitmq.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
 <537323B3.1020002@rabbitmq.com>
Message-ID: <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>

Let me ask in a different way:

Why would a node use more memory in binary and queue_procs while publishing
to an exchange and then have that memory drop dramatically without taking
any messages off of the queue? And by dramatically I mean 5-6x less memory
within a few minutes of publishing ending.




On Wed, May 14, 2014 at 4:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I'm not quite sure what the real question is here. The queue_procs and
> binary memory slices will describe memory used by queues (with message
> bodies in 'binary' and everything else in 'queue_procs'). This is a fairly
> raw count according to what the Erlang VM tells us, so for example this
> includes memory used by unreachable objects that have not yet been GCed.
>
> So "related to publishing and to moving data to the mirror on the other
> node" - well, yes, those are things queues do, so they can use memory doing
> so. But they can do other things too, and thus might use memory for other
> purposes :-)
>
> Cheers, Simon
>
>
> On 13/05/2014 17:31, Sean Allen wrote:
>
>> I'm trying to understand what I'm seeing with memory usage in our cluster.
>>
>> We have a mirrored queue that we sometimes have large amounts of
>> publishes come in during a relatively short period of time. (Say 2
>> million messages during 5-10 minutes)
>>
>> While we are publishing, memory usage on both the primary and mirrored
>> nodes rises greatly. Almost all the memory used is queue_procs and
>> binary. Once publishing ceases, the primary node returns to an amount of
>> memory usage in line with the message size (whereas during publishing
>> its 5 times or so what you would expect just based on message size).
>>
>> The mirrored queue trails behind in terms of memory usage dropping but
>> eventually levels out to similar usage some time later (couple hours
>> later).
>>
>> If I turn off the consumer of the queue, the memory still stabilizes
>> eventually.
>>
>> This has led us to believe that the queue_procs and binary memory usage
>> is related to publishing and to moving data to the mirror on the other
>> node. Is that a reasonable assumption?
>>
>
>


-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/f1f8f32b/attachment.html>

From ask at rabbitmq.com  Wed May 14 15:54:24 2014
From: ask at rabbitmq.com (Ask Solem)
Date: Wed, 14 May 2014 15:54:24 +0100
Subject: [rabbitmq-discuss] Using Pika and PyQtGraph (Qt event loop and
	BlockingConnection)
In-Reply-To: <CAKz5CKR20H07ZsMP5CqDy19Oioah00eRY5jmD9w5sMo=wS3Hqw@mail.gmail.com>
References: <feb40ff4-da7f-4172-bacc-e73926989166@googlegroups.com>
 <etPan.53722442.2eb141f2.11ca@mercurio.local>
 <0BBC46FE-7FA0-4E0C-9D9B-9624AC45DCE2@rabbitmq.com>
 <CAKz5CKR20H07ZsMP5CqDy19Oioah00eRY5jmD9w5sMo=wS3Hqw@mail.gmail.com>
Message-ID: <B96870A2-5300-4E84-BB23-96C268275F66@rabbitmq.com>


On May 13, 2014, at 7:50 PM, Femto Trader <femto.trader at gmail.com> wrote:

> Hello,
> 
> thanks for your reply.
> 
> I don't know Tornado at all.
> 
> I'm not a very talented developer....
> Talking to me of "eventlet on pyqt" or "gevent on pyqt" looks like poetry to me ;-)

Hah! While admitting to your own limitations is a sign of intelligence, resigning from a daunting
challenge is not a virtue.

It?s foreign now because you don?t know the terms, something a quick Google search would resolve.

PyQT uses an event loop to make multiple things happen at once, e.g. playing music while drawing the progress
bar of a file copy operation.  Your BlockingConnection is blocking this event loop so nothing can happen while you?re
reading from the RabbitMQ connection socket.

Every event driven network library like Twisted, Eventlet, Gevent, Tornado etc comes with a different event loop
implementation, but eventlet and gevent is special: it uses greenlets to yield control back
to the event loop so you can write normal, imperative style Python code.

Read about eventlet here: http://eventlet.net

So if you can replace eventlet?s event loop with pyqt, then you can use any existing (eventlet compatible) Python code
with pyqt.  I did a quick google search and found ?eventlet-pyqt?[0] that will let you do exactly this, but I don?t
know how recent this project is and there could be something better out there now.

In short: Using eventlet you can magically turn your BlockingConnection into a non-blocking one,
so if you can hook eventlet into pyqt you have solved your problem.

[0] https://code.google.com/p/eventlet-pyqt/



> 
> Luke also said me something else:
> "One solution that will likely work for you is to move your MQ code to a new thread, and send a signal back to the GUI thread whenever a message arrives."
> 
> Can someone from RabbitMQ dev team be in touch with PyQt / PySide dev teams
> and also PyQtGraph devs in order to have a very basic sample example because displaying realtime
> data coming from a messaging queue could be useful.

This seems like a fringe use case and I doubt there's a big audience for such a tutorial.
Doing so using threads would be a bad practice at that, so if there was an audience
it would make more sense to invest in a proper ?pika on the pyqt event loop? extension.

> 
> One basic example could be:
> one python script connect to RabbitMQ and send a random number
> an other script receive data and plot them into a PyQtGraph.
> 
> I'm not very familiar with threading so I wonder 
> what will happen if thread that will receive data will take more time to compute data
> (do some calculations on these data) than task to display them


Python has the global interpreter lock (GIL) so you cannot perform CPU bound operations
on multiple cores unless you drop down to C and unlock the GIL.

It would be the same situation as when you use an Async I/O framework like eventlet/twisted/tornado
and any CPU bound operation will block the rest of the program.

With eventlet there is a hack to yield control back to the event loop by using
`time.sleep(0)` (eventlet monkey patches must be applied, yuo did read about eventlet already right?).
But that means you must find control points in your CPU bound operations and inject sleeps into it,
which is not exactly pretty.  Usually the solution is to use IPC and start separate OS processes for
CPU bound calculations, e.g. using Python?s multiprocessing.

> 
> 
> Femto
> 
> 
> 
> 2014-05-13 16:07 GMT+02:00 Ask Solem <ask at rabbitmq.com>:
> 
> On May 13, 2014, at 2:54 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
> 
> >  On 12 May 2014 at 00:34:58, Femto (femto.trader at gmail.com) wrote:
> >>> maybe you noticed Qt have an event loop
> >>
> >> and I think it's doing odd things with pika.BlockingConnection
> >>
> >>
> >> Any help is welcome.
> >
> > I doubt that it can, although I know nothing about Qt and little about
> > Pika implementation.
> >
> > Have you tried using a different connect, e.g. Tornado?
> 
> If PyQt does indeed use an event loop then you will not be able to use a blocking connection.
> 
> You have several choices:
> 
> 1) Implement a pika connection implementation using the PyQt event loop.
> 2) Use a ?eventlet on pyqt? or ?gevent on pyqt? implementation like eventlet-pyqt
>     and use the eventlet or gevent connection in pika.
> 3) Run pyqt in a separate thread.  This is only an option if pyqt actually supports it, which may
>     very well not be the case.
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/1162e076/attachment.html>

From ranjitiyer at gmail.com  Wed May 14 18:31:14 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 14 May 2014 10:31:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover crashing node
Message-ID: <1400088674666-35540.post@n5.nabble.com>

I am at using RabbitMQ 3.2.3 and my situation is this

Machine A
> rabbitmq-server -detached

Machine B
> rabbitmq-server -detached
> rabbitmqctl stop_app
> rabbitmqctl join_cluster rabbit at A
*> rabbitmq stop (shutdown erl)*

Machine A
> rabbitmqctl stop_app

Machine B
> rabbimq-server -detached (starts erl but crashes after 30 secs because A
> isn't running)

> rabbitmqctl status (hangs)
> rabbitmqctl cluster_status (hangs)
> rabbitmqctl reset (errors)
> rabbitmqctl forget_cluster (errors)

How do I fix B?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-crashing-node-tp35540.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Wed May 14 18:35:28 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 14 May 2014 17:35:28 +0000
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
 login_with_properties function
References: <1387786326818-32275.post@n5.nabble.com>
 <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
 <1388037935031-32306.post@n5.nabble.com>
 <CAAt2poJh10xbp1wAE_E_pHUne2KFf5qipskfMsCocsQAVgVF1Q@mail.gmail.com>
 <1398680404528-35118.post@n5.nabble.com>
 <CAAt2poJ0eQAV1HkW0t+Mf_V7RYS7g4cRpmQ4PzgAwe+7aQv0Sw@mail.gmail.com>
 <1399988014417-35492.post@n5.nabble.com>
Message-ID: <CAAt2poJYwkO9j+EAb7sL6+PzWfw_GvL8gk2=4cxp4qTMUyFv-g@mail.gmail.com>

Use of poll(2) instead of select(2) was added
since<https://github.com/alanxz/rabbitmq-c/commit/a78aa8ab906c97dc3f4123048519a2953fa96fb2>v0.5.0.
Try pulling down the master branch and see if that works for your
use case.

-Alan

On Tue May 13 2014 at 6:34:10 AM, Haster <haster2004 at yandex.ru> wrote:

> Alan,
> I've investigated this problem and found that problem occurs when socket
> get
> descriptor > 1024.
> Because we are using select + fdset for wait data on socket, sometimes it
> works incorrect (I have heard that select can control only descriptors with
> number < 1024).
>
> I see that you also use select in revc_with_timeout function.
> Maybe it is better to use poll or epoll in Linux/Unix?
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.
> nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-
> tp32275p35492.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/8f3e8175/attachment.html>

From mklishin at gopivotal.com  Wed May 14 18:47:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 21:47:56 +0400
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <1400088674666-35540.post@n5.nabble.com>
References: <1400088674666-35540.post@n5.nabble.com>
Message-ID: <etPan.5373ac65.625558ec.b629@mercurio.local>



On 14 May 2014 at 21:32:26, ranjitiyer (ranjitiyer at gmail.com) wrote:
> > > rabbitmqctl status (hangs)
> > rabbitmqctl cluster_status (hangs)
> > rabbitmqctl reset (errors)
> > rabbitmqctl forget_cluster (errors)
>  
> How do I fix B?

See Breaking up a Cluster:
http://www.rabbitmq.com/clustering.html

but if you are willing to reset a node, you can simply wipe out
its database directory.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ranjitiyer at gmail.com  Wed May 14 19:06:09 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 14 May 2014 11:06:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <etPan.5373ac65.625558ec.b629@mercurio.local>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
Message-ID: <1400090769247-35543.post@n5.nabble.com>

Appreciate your quick response. The documentation assumes erl is running. I
have trouble starting erl and keeping it running when the master (A) isn't
available. Note that in our scenario someone could physically turn off
Machine B and so when B comes back up, I first need to "rabbitmq-server
-detached" and I am seeing erl will crash if A isn't available. So I don't
have an opportunity to fix the cluster using rabbitmqctl commands.

I deleted the database folders under /var/lib/rabbitmq/mnesia but erl
crashes right away when I start rabbit (rabbitmq-server -detached). I am
certain I am doing something wrong here. Please advise.

Thanks,
Ranjit 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-crashing-node-tp35540p35543.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ranjitiyer at gmail.com  Wed May 14 19:27:29 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 14 May 2014 11:27:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <1400090769247-35543.post@n5.nabble.com>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
Message-ID: <1400092049293-35544.post@n5.nabble.com>

Ok, deleting the Mnesia database worked and I can start the node. Is it
possible to pull out the persisted messages from the database? 

Back to my scenario. A had some persisted messages when it went down. When B
doesn't start because A is down I'll fix up B to start on its own but I want
A persisted msgs brought into B. (Assume A's mnesia database is only a
network file share that B has access to). Is this possible? This is really
important for our async job processing solution to work on RabbitMQ. We
don't want to lose jobs persisted on A when A went down. 





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-crashing-node-tp35540p35544.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed May 14 19:37:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 22:37:54 +0400
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <1400092049293-35544.post@n5.nabble.com>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
 <1400092049293-35544.post@n5.nabble.com>
Message-ID: <etPan.5373b81c.46e87ccd.b629@mercurio.local>

On 14 May 2014 at 22:28:40, ranjitiyer (ranjitiyer at gmail.com) wrote:
> > A had some persisted messages when it went down. When B
> doesn't start because A is down I'll fix up B to start on its own  
> but I want
> A persisted msgs brought into B. (Assume A's mnesia database  
> is only a
> network file share that B has access to). Is this possible? This  
> is really
> important for our async job processing solution to work on RabbitMQ.  
> We
> don't want to lose jobs persisted on A when A went down.

Everything on B is gone because you deleted its database. A's database
is just fine, so if you cluster B with it, mirrored
queues can be synchronised. See?http://www.rabbitmq.com/ha.html.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ranjitiyer at gmail.com  Wed May 14 20:03:26 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 14 May 2014 12:03:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <etPan.5373b81c.46e87ccd.b629@mercurio.local>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
 <1400092049293-35544.post@n5.nabble.com>
 <etPan.5373b81c.46e87ccd.b629@mercurio.local>
Message-ID: <1400094206608-35546.post@n5.nabble.com>

I am imagining a situation in which A never comes up. Assuming B has access
to A's DB, can it import the persisted queues into B's DB? I know this would
be getting into Erlang/Mnesia space.

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-crashing-node-tp35540p35546.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed May 14 20:14:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 23:14:33 +0400
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <1400094206608-35546.post@n5.nabble.com>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
 <1400092049293-35544.post@n5.nabble.com>
 <etPan.5373b81c.46e87ccd.b629@mercurio.local>
 <1400094206608-35546.post@n5.nabble.com>
Message-ID: <etPan.5373c0b5.507ed7ab.b629@mercurio.local>



On 14 May 2014 at 23:04:35, ranjitiyer (ranjitiyer at gmail.com) wrote:
> > I am imagining a situation in which A never comes up. Assuming  
> B has access
> to A's DB, can it import the persisted queues into B's DB? I know  
> this would
> be getting into Erlang/Mnesia space.

B has no access to A's message store. Messages and their positions ?are not stored in Mnesia.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From SoderquistMV at ldschurch.org  Wed May 14 20:27:05 2014
From: SoderquistMV at ldschurch.org (Mark Soderquist)
Date: Wed, 14 May 2014 19:27:05 +0000
Subject: [rabbitmq-discuss] LDAP SSL Configuration
References: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
 <5371E7A3.9010802@rabbitmq.com> 
Message-ID: <CDC7045479A93A4FB2E32D4B83A22B5F39AC5458@W12112.ldschurch.org>

I have now added ssl_options to my configuration:
{ssl_options,           [{certfile, "/etc/rabbitmq/rabbitmq.pub"},
                               {keyfile, "/etc/rabbitmq/rabbitmq.key"}
                              ]},

I believe this worked because I'm now getting a different error:

{exit,{ssl_options_requires_min_r16a}

I looked this up and it appears to be a version check. If I can read the code correctly it checks for version "5.10" which correlates to OTP release "R16A". I have version "5.9.2" installed which correlates to OTP release "R15B02". Clearly I have an older version than the SSL options support. Is this correct?

-----Original Message-----
From: Mark Soderquist 
Sent: Tuesday, May 13, 2014 7:20 AM
To: 'Simon MacMullen'; Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] LDAP SSL Configuration

Still just getting: LDAP connect error: {error,"connect failed"} Changing to {log, network} did not give me any more information.
I'm now going to assume that our LDAP server does not accept clients without certificates.

On 12/05/2014 21:59, Mark Soderquist wrote:
> I'm attempting to connect to our LDAP server over SSL instead of plain 
> sockets. The plain socket configuration works but simply enabling the 
> use_ssl flag and changing the port does not appear to be enough. What 
> else is required to connect to an LDAP server using SSL?

I believe that simple configuration should be able to work assuming your LDAP server accepts clients without certificates.

> Here is my configuration:

>        {log,                   true}

> The log simply reports a connection failure:
>
> =INFO REPORT==== 12-May-2014::14:28:41 ===
>
>      LDAP connect error: {error,"connect failed"}

If you change {log, true} to {log, network} then you should get better diagnostics on failed connections.

Cheers, Simon


 NOTICE: This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.


From mklishin at gopivotal.com  Wed May 14 20:52:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 14 May 2014 23:52:30 +0400
Subject: [rabbitmq-discuss] LDAP SSL Configuration
In-Reply-To: <CDC7045479A93A4FB2E32D4B83A22B5F39AC5458@W12112.ldschurch.org>
References: <CDC7045479A93A4FB2E32D4B83A22B5F39AC4472@W12112.ldschurch.org>
 <5371E7A3.9010802@rabbitmq.com>
 <CDC7045479A93A4FB2E32D4B83A22B5F39AC5458@W12112.ldschurch.org>
Message-ID: <etPan.5373c997.41b71efb.b629@mercurio.local>

On 14 May 2014 at 23:29:22, Mark Soderquist (soderquistmv at ldschurch.org) wrote:
> > {exit,{ssl_options_requires_min_r16a}
>  
> I looked this up and it appears to be a version check. If I can read  
> the code correctly it checks for version "5.10" which correlates  
> to OTP release "R16A". I have version "5.9.2" installed which  
> correlates to OTP release "R15B02". Clearly I have an older version  
> than the SSL options support. Is this correct?

Correct.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From srinatsr at cisco.com  Wed May 14 20:56:19 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 14 May 2014 19:56:19 +0000
Subject: [rabbitmq-discuss] Monitoring Queues and Messages transferred,
	consumed by whom
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0F77F@xmb-aln-x10.cisco.com>

Hello everyone,

I need good Monitoring plugin for RabbitMQ.

               From which host message published ?

               Delivered ?

               Who consumed(host which consumed)?

               What message ?

How to achieve all together ?  Please need help.

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/3fa6b22b/attachment.html>

From ranjitiyer at gmail.com  Wed May 14 21:20:06 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Wed, 14 May 2014 13:20:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <etPan.5373c0b5.507ed7ab.b629@mercurio.local>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
 <1400092049293-35544.post@n5.nabble.com>
 <etPan.5373b81c.46e87ccd.b629@mercurio.local>
 <1400094206608-35546.post@n5.nabble.com>
 <etPan.5373c0b5.507ed7ab.b629@mercurio.local>
Message-ID: <1400098806384-35551.post@n5.nabble.com>

MK, I'd configure the RABBITMQ_MNESIA_BASE to be a network share so B has
access to A's DB. 

If A went down last but never came up (say the machine was permanently taken
down), I don't want to lose those messages. So when B comes up (by resetting
itself because I can't reach A) I am looking for a way by which B can import
A's messages into it's own database. 

					\\share
						A
							mnesia
								rabbit at A
									rabbit_durable_queue.DCD
								
						B
							mnesia
								rabbit at B
									rabbit_durable_queue.DCD
 
            







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Recover-crashing-node-tp35540p35551.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gavinmroy at gmail.com  Wed May 14 22:56:28 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Wed, 14 May 2014 17:56:28 -0400
Subject: [rabbitmq-discuss] ANN: rabbitpy 0.18.0
Message-ID: <etPan.5373e68c.238e1f29.ef8e@s826.ofc.lair>

rabbitpy 0.18.0 is now available for download from pypi. It is considered the latest and greatest stable release and all users are urged to upgrade.

This release primarily improves performance and IO exceptions:

- Makes the IO thread daemonic, no longer blocking the python interpreter from exiting on exception
- Lower CPU utilization when blocking for a RPC reply by sleeping for 1 second instead of 100ms

Additionally, thanks to Victor Boivie for the patch adding redelivered as a read-only property on rabbitpy.Message

For more information, including installation instructions, please visit https://pypi.python.org/pypi/rabbitpy or the documentation at https://rabbitpy.readthedocs.org?

If you have any issues, please be sure to use the issue tracker at https://github.com/gmr/rabbitpy/issues

Regards,

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/87f77f13/attachment.html>

From mklishin at gopivotal.com  Thu May 15 04:40:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 07:40:19 +0400
Subject: [rabbitmq-discuss] Monitoring Queues and Messages transferred,
 consumed by whom
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0F77F@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0F77F@xmb-aln-x10.cisco.com>
Message-ID: <etPan.5374373d.7545e146.b629@mercurio.local>

?On 14 May 2014 at 23:57:36, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> >
> From which host message published ?
> Delivered ?
> Who consumed(host which consumed)?
> What message ?

I'm not aware of any off-the-shelf monitoring tool that tracks messages.
The closest you can get is Firehose [1], combined with the info you can get
via HTTP API.

1.?http://www.rabbitmq.com/firehose.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sekhar434145 at gmail.com  Thu May 15 05:27:28 2014
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Thu, 15 May 2014 09:57:28 +0530
Subject: [rabbitmq-discuss] Response message ClassCastException: Cannot
 cast java.util.LinkedHashMap (id=173) to com.sw.Employee
In-Reply-To: <CADtU9_usjpuJH2PVfjfiCZG+H-g_L4OqQMFp6T=9ARNLzxTryw@mail.gmail.com>
References: <CAH75Yb5wTKyd-sMbH1MwQDbobstchQb7Rx9XdBaNoJj-+0BDLQ@mail.gmail.com>
 <53731647.40208@rabbitmq.com>
 <CADtU9_usjpuJH2PVfjfiCZG+H-g_L4OqQMFp6T=9ARNLzxTryw@mail.gmail.com>
Message-ID: <CAH75Yb712BZ1HA1-r7XU5aA9TLdaoRG23B1SamM+jA_frbJ4OQ@mail.gmail.com>

updated with trace...

http://stackoverflow.com/questions/23647589/response-message-classcastexception-cannot-cast-java-util-linkedhashmap-id-173


On Wed, May 14, 2014 at 6:17 PM, Gary Russell <grussell at gopivotal.com>wrote:

> Yes, please post over there, or on Stack Overflow (
> http://stackoverflow.com/) with tag "spring-amqp".
>
> Please include the full stack trace for the exception and include a DEBUG
> log on the listener side if possible.
>
>
> On Wed, May 14, 2014 at 3:07 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> On 14/05/14 07:52, Rajasekhar P wrote:
>>
>>> Am getting cannot cast exception in Listener when I am trying to send
>>> LinkedHashMap as request at producer end using Spring AMQP.
>>>
>>
>> Looks like you are using spring-amqp, so I suggest you re-post your
>> question on the spring-amqp forum: http://forum.spring.io/forum/
>> spring-projects/integration/amqp.
>>
>> Matthias.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/8aee55ea/attachment.html>

From doroninbal1 at gmail.com  Thu May 15 06:56:20 2014
From: doroninbal1 at gmail.com (inbal doron)
Date: Thu, 15 May 2014 08:56:20 +0300
Subject: [rabbitmq-discuss] only ram nodes cluster
Message-ID: <CANPo+3VAwwXHE6S_vsXWRZRxn4JHLSQheuRGDsahbHHhR87sxw@mail.gmail.com>

Hi,

I know there are prevoius messages regarding this topic but I believe there
were changes in the matter.

I am interesting in creating a cluster with 2 nodes that both are disc
nodes.
We have no durability needs and interested in a cluster for failover
reasons.

>From previous messages I understand this is not recommended but could be
done by creating the cluster with a disc node and reseting it to create ram
only.

I tried to do that but got an error message that the node can not be reset
since it is the last disc node in the cluster. This is why I thought there
might have been a change in the matter.

Is there a way to create such a cluster?
And if so, is it still not recommended for the needs I specified before?

Thank you very much,

Inbal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/3e2d1345/attachment.html>

From videlalvaro at gmail.com  Thu May 15 07:12:55 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 May 2014 08:12:55 +0200
Subject: [rabbitmq-discuss] only ram nodes cluster
In-Reply-To: <CANPo+3VAwwXHE6S_vsXWRZRxn4JHLSQheuRGDsahbHHhR87sxw@mail.gmail.com>
References: <CANPo+3VAwwXHE6S_vsXWRZRxn4JHLSQheuRGDsahbHHhR87sxw@mail.gmail.com>
Message-ID: <CAMcAHLUyNLU759+BwGH_KA=mU1AmufTAtew5UQyLyFwUA0gMNQ@mail.gmail.com>

Hi,

disc node vs. ram node has nothing to do with message durability. This is
related to how Mnesia will store its data, but RabbitMQ doesn't uses Mnesia
to store messages. Mnesia is only used for storing things like exchange
metadata, routing information, queue metadata, and so on.

Cheers,

Alvaro


On Thu, May 15, 2014 at 7:56 AM, inbal doron <doroninbal1 at gmail.com> wrote:

> Hi,
>
> I know there are prevoius messages regarding this topic but I believe
> there were changes in the matter.
>
> I am interesting in creating a cluster with 2 nodes that both are disc
> nodes.
> We have no durability needs and interested in a cluster for failover
> reasons.
>
> From previous messages I understand this is not recommended but could be
> done by creating the cluster with a disc node and reseting it to create ram
> only.
>
> I tried to do that but got an error message that the node can not be reset
> since it is the last disc node in the cluster. This is why I thought there
> might have been a change in the matter.
>
> Is there a way to create such a cluster?
> And if so, is it still not recommended for the needs I specified before?
>
> Thank you very much,
>
> Inbal
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/3bbdbd8d/attachment.html>

From haster2004 at yandex.ru  Thu May 15 08:35:33 2014
From: haster2004 at yandex.ru (Haster)
Date: Thu, 15 May 2014 00:35:33 -0700 (PDT)
Subject: [rabbitmq-discuss] [rabbitmq_c] Infinite wait in
	login_with_properties function
In-Reply-To: <CAAt2poJYwkO9j+EAb7sL6+PzWfw_GvL8gk2=4cxp4qTMUyFv-g@mail.gmail.com>
References: <1387786326818-32275.post@n5.nabble.com>
 <CAAt2poJhK0ndFKbpMd17jY23NEj+ZQ_sUsB27z15W5pOB3mwhA@mail.gmail.com>
 <1388037935031-32306.post@n5.nabble.com>
 <CAAt2poJh10xbp1wAE_E_pHUne2KFf5qipskfMsCocsQAVgVF1Q@mail.gmail.com>
 <1398680404528-35118.post@n5.nabble.com>
 <CAAt2poJ0eQAV1HkW0t+Mf_V7RYS7g4cRpmQ4PzgAwe+7aQv0Sw@mail.gmail.com>
 <1399988014417-35492.post@n5.nabble.com>
 <CAAt2poJYwkO9j+EAb7sL6+PzWfw_GvL8gk2=4cxp4qTMUyFv-g@mail.gmail.com>
Message-ID: <1400139333319-35558.post@n5.nabble.com>

Alan, thanks for patch.
It works well



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-Infinite-wait-in-login-with-properties-function-tp32275p35558.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jay.hilden at gmail.com  Wed May 14 21:10:12 2014
From: jay.hilden at gmail.com (Jay Hilden)
Date: Wed, 14 May 2014 15:10:12 -0500
Subject: [rabbitmq-discuss] Why does the UI say all messages are being
	redelivered?
In-Reply-To: <CAD3qxy55NhaVPZg=gs24KOF7m7+TGxaQ9xvU7VQMhZjZtzv0yw@mail.gmail.com>
References: <154a5632-18d7-4b6e-9886-129e437a0a38@googlegroups.com>
 <5371CE5B.1010802@rabbitmq.com>
 <CAD3qxy55NhaVPZg=gs24KOF7m7+TGxaQ9xvU7VQMhZjZtzv0yw@mail.gmail.com>
Message-ID: <CAD3qxy6pc8KDybB-GX-zUaX8kL80UcPHFOrLWTEeZsk1FymBiQ@mail.gmail.com>

Simon, after the queue cleared all the existing records any new records
inserted are NOT being marked as "re-delivered".

Thank you again.

Cheers!


On Tue, May 13, 2014 at 11:42 AM, Jay Hilden <jay.hilden at gmail.com> wrote:

> Thanks for the response Simon.  I think it may be the "published to a
> mirrored queue which subsequently failed over".  This would explain why I'm
> only seeing it on one queue in one environment.  I will wait until this
> queue is completely cleared out and see if my problem resolves itself.
>
> Thank you again.
>
>
> On Tue, May 13, 2014 at 2:48 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> All the messages that are being delivered have been marked as redelivered
>> at some point. Possible reasons include that they were all delivered to but
>> not acked by a client which subsequently disconnected, or rejected/nacked
>> them, or invoked basic.recover. Or that they were published to a mirrored
>> queue which subsequently failed over.
>>
>> Do any of those sound right?
>>
>> Cheers, Simon
>>
>> On 12/05/2014 23:30, Jay Hilden wrote:
>>
>>> We have a 2 node cluster in production that has many vhosts and many
>>> queues, all working great.  There is one queue that when it processes
>>> the data it lists all messages are being redelivered.  So the UI will
>>>
>>> say "deliver/get (of which redelivered): 65/s (65/s)".  It looks like
>>> all of the messages are being redelivered.  This is only happening on
>>> one queue.
>>>
>>> Can anyone help me with the root cause of this issue?
>>>
>>> Thank you in advance.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140514/996a1252/attachment.html>

From mklishin at gopivotal.com  Thu May 15 09:47:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 12:47:20 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.2.0 is released
Message-ID: <etPan.53747f36.12200854.b629@mercurio.local>

March Hare [1] is an idiomatic, fast and well-maintained JRuby client for
RabbitMQ.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/05/15/march-hare-2-dot-2-0-is-released/?

1. http://rubymarchhare.info
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ceri at lshift.net  Thu May 15 10:15:42 2014
From: ceri at lshift.net (Ceri Storey)
Date: Thu, 15 May 2014 10:15:42 +0100
Subject: [rabbitmq-discuss] only ram nodes cluster
In-Reply-To: <CANPo+3VAwwXHE6S_vsXWRZRxn4JHLSQheuRGDsahbHHhR87sxw@mail.gmail.com>
References: <CANPo+3VAwwXHE6S_vsXWRZRxn4JHLSQheuRGDsahbHHhR87sxw@mail.gmail.com>
Message-ID: <537485BE.20807@lshift.net>

(15/05/14 06:56), inbal doron wrote:
> Hi,
>  
> I know there are prevoius messages regarding this topic but I believe
> there were changes in the matter.
>  
> I am interesting in creating a cluster with 2 nodes that both are disc
> nodes.
> We have no durability needs and interested in a cluster for failover
> reasons.
If you're absolutely 100% utterly sure that you do not care if you lose
messages in the case of an outage, then you can potentially mount an
in-memory tmpfs as your rabbit storage directory (typically
/var/lib/rabbitmq). For exactly how you'd do that, it's best to consult
your OS vendor's documentation, really.

>  
> From previous messages I understand this is not recommended but could
> be done by creating the cluster with a disc node and reseting it to
> create ram only.
>  
> I tried to do that but got an error message that the node can not be
> reset since it is the last disc node in the cluster. This is why I
> thought there might have been a change in the matter.
>  
> Is there a way to create such a cluster?
> And if so, is it still not recommended for the needs I specified before?
>  
> Thank you very much,
>  
> Inbal
>  
>  
>  
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/64b8eef3/attachment.html>

From simon at rabbitmq.com  Thu May 15 11:33:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 11:33:56 +0100
Subject: [rabbitmq-discuss] Phantom consumers
In-Reply-To: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
References: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
Message-ID: <53749814.1080507@rabbitmq.com>

On 14/05/14 13:53, Sam Morrison wrote:
> Hi,
>
> We've got 2 3 node rabbit clusters, one using 3.1.3 and one using 3.3.0.
> We mirror all queues.
>
> Every so often we get queues filling up in the unacked counters. When we
> investigate we see the queue has 2 consumers both from the same client
> address.
> One consumer links back to a connection that doesn't exist on the client
> or the server.

When you say "a connection that doesn't exist", how are you verifying 
this? What does mgmt show?

My suspicion is that somehow the connection still does exist, at least 
from the server's perspective.

Cheers, Simon

> If we stop the client one of the consumers goes away but we are still
> left with a phantom one.
>
> The only way we have been able to fix this is by deleting the queue and
> restarting the client.
>
> While it is in this state the client doesn't get any messages.
>
> This happens with both our clusters.
>
> Anyone else seeing this or know what the issue is?


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 15 11:36:10 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 11:36:10 +0100
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>	<537323B3.1020002@rabbitmq.com>
 <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>
Message-ID: <5374989A.6020002@rabbitmq.com>

On 14/05/14 15:42, Sean Allen wrote:
> Let me ask in a different way:
>
> Why would a node use more memory in binary and queue_procs while
> publishing to an exchange and then have that memory drop dramatically
> without taking any messages off of the queue? And by dramatically I mean
> 5-6x less memory within a few minutes of publishing ending.

The messages could be getting paged out? See 
http://www.rabbitmq.com/memory.html#memsup-paging.

Alternatively, it could just be that a lot of garbage is getting created 
while publishing, and it take that long to collect it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sp345s at att.com  Thu May 15 13:19:48 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Thu, 15 May 2014 12:19:48 +0000
Subject: [rabbitmq-discuss] restrict user to create bindings but not queues
Message-ID: <59BF56992750434F89F8EBE141E64B1D0188777B@GAALPA1MSGUSR9C.ITServices.sbc.com>

Hi ..

We have a requirement where we need to control access to user so he can create few number of bindings and  queues ..

We have 2 options ..

1)      Create an user a separate exchange and give him  configure/write/read access on it so he can create  queues and bindings dynamically ... we wanted to check if we can restrict an user to create only certain no. of queues and bindings ..say 1 queue and 10 bindings ... Not sure how to do it..

2)      Second approach is to create a queue and to create dynamic binding looks like we need to give configure/write/read permissions on the queue and exchange  ... which will allow him to create queues...Can we give access so he can just create bindings and not queues??

Appreciate all your help

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/1c6ce5f2/attachment.html>

From jsosic at gmail.com  Thu May 15 14:11:57 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Thu, 15 May 2014 15:11:57 +0200
Subject: [rabbitmq-discuss] Persistent messages/queues size on disk
Message-ID: <5374BD1D.2020602@gmail.com>

Hi,

I'm interested is there a way to calculate persistent messages size on disk?

For example, if I create new queue and fill it up with messages without 
any consumer actually consuming anything, that queue will fill up disk.

But, how can I know what queue is responsible?

I found this post:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-July/028440.html

but it's from last year. Is this answer still actual? :)


thank you

From simon at rabbitmq.com  Thu May 15 14:44:48 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 14:44:48 +0100
Subject: [rabbitmq-discuss] Persistent messages/queues size on disk
In-Reply-To: <5374BD1D.2020602@gmail.com>
References: <5374BD1D.2020602@gmail.com>
Message-ID: <5374C4D0.1000402@rabbitmq.com>

On 15/05/14 14:11, Jakov Sosic wrote:
> I found this post:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-July/028440.html
>
> but it's from last year. Is this answer still actual? :)

I'm afraid so, yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Jonathank at mdg.co.il  Thu May 15 15:02:15 2014
From: Jonathank at mdg.co.il (Jonathan Kallner)
Date: Thu, 15 May 2014 14:02:15 +0000
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
Message-ID: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>

Hi
I'm new at RabbitMQ and I would appreciate very much your help.

I'm am working on a system with 2 machine connected.
One machine is Win7 OS and the other one is RedHat OS installed on a virtual machine.
( The host computer for the second unit is also Win7).

I managed to install on both machine RabbitMQ and the shovel plugin.
I can work with the Web-UI plugin in both computers,
And I get also a ping from the Redhat VM to the Win7.

Both computer are on the same network.
The Redhat VM has a static ip.

My question is how do I configure each computer ?

1. The Win7 is a client
2. The RedHat is a server.

I need to open a new connection between both the computers.


Thanks

Jonathan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/b26bfd91/attachment.html>

From jkuch at gopivotal.com  Thu May 15 15:24:46 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 15 May 2014 07:24:46 -0700
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
In-Reply-To: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
References: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
Message-ID: <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>

How is networking set up for the VM?  You'll have to make sure it has an IP
address that's actually reachable from any external clients that have to
talk to it.



On Thu, May 15, 2014 at 7:02 AM, Jonathan Kallner <Jonathank at mdg.co.il>wrote:

>  Hi
>
> I'm new at RabbitMQ and I would appreciate very much your help.
>
>
>
> I'm am working on a system with 2 machine connected.
>
> One machine is Win7 OS and the other one is RedHat OS installed on a
> virtual machine.
>
> ( The host computer for the second unit is also Win7).
>
>
>
> I managed to install on both machine RabbitMQ and the shovel plugin.
>
> I can work with the Web-UI plugin in both computers,
>
> And I get also a ping from the Redhat VM to the Win7.
>
>
>
> Both computer are on the same network.
>
> The Redhat VM has a static ip.
>
>
>
> My question is how do I configure each computer ?
>
>
>
> 1. The Win7 is a client
>
> 2. The RedHat is a server.
>
>
>
> I need to open a new connection between both the computers.
>
>
>
>
>
> Thanks
>
>
>
> Jonathan
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/0db690ef/attachment.html>

From Jonathank at mdg.co.il  Thu May 15 15:30:20 2014
From: Jonathank at mdg.co.il (Jonathan Kallner)
Date: Thu, 15 May 2014 14:30:20 +0000
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
In-Reply-To: <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>
References: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
 <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>
Message-ID: <DA8A146FF3AF624BA2F5C9CE16E8882B35C02D@SRVMBOX.mdg.co.il>

The VM is reachable.
It is on the same network as the first unit.
It has a static IP address of its own.
The ping command from the win7 (first unit) to the IP of the VM
Works just fine.
The VM for that matter is just a another computer.



From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
Sent: Thursday, May 15, 2014 5:26 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)

How is networking set up for the VM?  You'll have to make sure it has an IP address that's actually reachable from any external clients that have to talk to it.


On Thu, May 15, 2014 at 7:02 AM, Jonathan Kallner <Jonathank at mdg.co.il<mailto:Jonathank at mdg.co.il>> wrote:
Hi
I'm new at RabbitMQ and I would appreciate very much your help.

I'm am working on a system with 2 machine connected.
One machine is Win7 OS and the other one is RedHat OS installed on a virtual machine.
( The host computer for the second unit is also Win7).

I managed to install on both machine RabbitMQ and the shovel plugin.
I can work with the Web-UI plugin in both computers,
And I get also a ping from the Redhat VM to the Win7.

Both computer are on the same network.
The Redhat VM has a static ip.

My question is how do I configure each computer ?

1. The Win7 is a client
2. The RedHat is a server.

I need to open a new connection between both the computers.


Thanks

Jonathan



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/8ffc01dc/attachment.html>

From mklishin at gopivotal.com  Thu May 15 15:54:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 18:54:49 +0400
Subject: [rabbitmq-discuss] restrict user to create bindings but not
 queues
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0188777B@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0188777B@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <etPan.5374d556.4db127f8.b629@mercurio.local>

?On 15 May 2014 at 16:21:34, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> 1) Create an user a separate exchange and give him configure/write/read  
> access on it so he can create queues and bindings dynamically  
> ? we wanted to check if we can restrict an user to create only certain  
> no. of queues and bindings ..say 1 queue and 10 bindings ? Not sure  
> how to do it..

There is no way to do it.

> 2) Second approach is to create a queue and to create dynamic binding  
> looks like we need to give configure/write/read permissions  
> on the queue and exchange ? which will allow him to create queues?Can  
> we give access so he can just create bindings and not queues??  

queue.bind requires write permissions on the queue and read permissions on the
exchange. To declare a queue, one needs configure permissions:
http://www.rabbitmq.com/access-control.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Sreyan.Sarkar at gmo.com  Thu May 15 16:00:50 2014
From: Sreyan.Sarkar at gmo.com (Sreyan Sarkar)
Date: Thu, 15 May 2014 15:00:50 +0000
Subject: [rabbitmq-discuss] |Spam| rabbitmq service dies when a large number
	of messages expire.
Message-ID: <855C3BF093A8E54D8DF03E05ADCD3147077337@MARINFPRDEXC004.gmo.tld>

Hi,

While stress testing rabbit mq to resolve a separate performance issue, we noticed that rabbit mq would crash when a queue with a large number of messages expired. When we held the total size of the all of the messages constant, but varied the number of messages we found that more messages meant a higher probability of the node dying.

I've attached some standalone test code below that applies this load. I've found that the parameters need to be varied depending on the strength of the machine, but in all cases there is a point where messages can be built up and happily served, but the expiry of the entire queue will fail.

I have tested this with Rabbit MQ 3.3.0 and RabbitMQ 3.2.4. Both of these clusters were running Erlang R16B03 on Windows Server 2008 R2.

It's not clear to me why the nodes will die with this sort of load. Is this a known issue with RabbitMQ or the version of Erlang I am running on?

-Sreyan

class Program
    {
        static void Main(string[] args)
        {
            var host = "127.0.0.1";
            const int loadSize = 1024*1024;
            var stressor = new Stressor(1, loadSize, host, "foo", "bar", TimeSpan.FromSeconds(10));
            stressor.ApplyLoad();
            stressor.CancellationTokenSource.Cancel();

            Console.WriteLine( "Applied a load of {0} KiB. Press [ENTER] to exit.", loadSize);
            Console.ReadLine();

        }
    }

    public sealed class Stressor
    {
        private const string QueueName = "TEST";
        private readonly int _messageSizeInKiB;
        private readonly int _totalQueueLoadInKiB;
        private readonly IConnection _connection;

        private readonly CancellationTokenSource _cancellationTokenSource = new CancellationTokenSource();
        public CancellationTokenSource CancellationTokenSource { get { return _cancellationTokenSource; } }

        private readonly Thread _consumptionThread;

        public Stressor(int messageSizeInKiB, int totalQueueLoadInKiB, string hostName, string userName, string password, TimeSpan connectionTimeout)
        {
            if (hostName == null) throw new ArgumentNullException("hostName");
            if (userName == null) throw new ArgumentNullException("userName");
            if (password == null) throw new ArgumentNullException("password");

            _messageSizeInKiB = messageSizeInKiB;
            _totalQueueLoadInKiB = totalQueueLoadInKiB;
            _connection = new ConnectionFactory
            {
                HostName = hostName,
                UserName = userName,
                Password = password,
                RequestedConnectionTimeout = (ushort)connectionTimeout.TotalMilliseconds
            }.CreateConnection();

            _junkMessageWrapper = new Lazy<byte[]>(() =>
            {
                var random = new Random();
                var message = new byte[_messageSizeInKiB * 1024];
                random.NextBytes(message);
                return message;
            });

            _consumptionThread = new Thread(Consume) {IsBackground = true};
            _consumptionThread.Start();
        }

        private readonly Lazy<Byte[]> _junkMessageWrapper;



        /// <summary>
        /// A consumer that doesn't take! We want to build up messagees then have them expire -- That's the behavior in question.
        /// </summary>
        private void Consume()
        {
            using (var channel = _connection.CreateModel())
            {
                channel.QueueDeclare(QueueName, false, false, false, new Dictionary<string, object> { { "x-expires", (int)TimeSpan.FromSeconds(60).TotalMilliseconds } });
                var consumer = new QueueingBasicConsumer(channel, new SharedQueue<BasicDeliverEventArgs>());
                channel.BasicConsume(QueueName, false, consumer);

                while (!_cancellationTokenSource.IsCancellationRequested)
                {
                    Thread.Sleep(TimeSpan.FromMilliseconds(100));
                }
            }
        }

        public void ApplyLoad()
        {
            using (var channel = _connection.CreateModel())
            {
                channel.ConfirmSelect();
                var properties = channel.CreateBasicProperties();
                properties.SetPersistent(true);

                var count = _totalQueueLoadInKiB/_messageSizeInKiB + 1;

                Console.WriteLine("Publishing {0} messages, each {1} bytes in size", count, _junkMessageWrapper.Value.Length);

                for (int i = 0; i < count; i++)
                {
                    channel.BasicPublish(string.Empty, QueueName, properties, _junkMessageWrapper.Value);
                }

                channel.WaitForConfirms();
            }
        }
    }


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/ad0e4169/attachment.html>

From sean at monkeysnatchbanana.com  Thu May 15 16:05:05 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 15 May 2014 11:05:05 -0400
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <5374989A.6020002@rabbitmq.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
 <537323B3.1020002@rabbitmq.com>
 <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>
 <5374989A.6020002@rabbitmq.com>
Message-ID: <CABm-WmdUDm2TH59AxKA0eU+LC9AZ7WjQnYDbvbafSmnJFKWR6Q@mail.gmail.com>

According to the UI, it isnt messages getting paged out.

If it is the latter, would it make sense to see the same issue on mirrored
versions of the queue but see if take much longer for that node to return
to a "normal" level of memory usage?




On Thu, May 15, 2014 at 6:36 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/05/14 15:42, Sean Allen wrote:
>
>> Let me ask in a different way:
>>
>> Why would a node use more memory in binary and queue_procs while
>> publishing to an exchange and then have that memory drop dramatically
>> without taking any messages off of the queue? And by dramatically I mean
>> 5-6x less memory within a few minutes of publishing ending.
>>
>
> The messages could be getting paged out? See http://www.rabbitmq.com/
> memory.html#memsup-paging.
>
> Alternatively, it could just be that a lot of garbage is getting created
> while publishing, and it take that long to collect it.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/75613435/attachment.html>

From simon at rabbitmq.com  Thu May 15 16:27:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 16:27:14 +0100
Subject: [rabbitmq-discuss] |Spam| rabbitmq service dies when a large
 number of messages expire.
In-Reply-To: <855C3BF093A8E54D8DF03E05ADCD3147077337@MARINFPRDEXC004.gmo.tld>
References: <855C3BF093A8E54D8DF03E05ADCD3147077337@MARINFPRDEXC004.gmo.tld>
Message-ID: <5374DCD2.5090203@rabbitmq.com>

No, this should not happen.

It would be expected that dead lettering huge numbers of messages at 
once could cause excessive memory use as dead-lettering isn't throttled. 
That's why we don't dead-letter on queue deletion. But you don't appear 
to be doing anything with DLX.

Assuming there aren't any policies in place to make individual messages 
expire then the "x-expires" argument will really just do the equivalent 
of a timed queue.delete - and that really should not cause additional 
resources to be used.

So is there anything else going on? Any policies set? Does memory use 
spike before the service dies? Anything interesting in the logs?

Cheers, Simon

On 15/05/14 16:00, Sreyan Sarkar wrote:
> Hi,
>
> While stress testing rabbit mq to resolve a separate performance issue,
> we noticed that rabbit mq would crash when a queue with a large number
> of messages expired. When we held the total size of the all of the
> messages constant, but varied the number of messages we found that more
> messages meant a higher probability of the node dying.
>
> I?ve attached some standalone test code below that applies this load.
> I?ve found that the parameters need to be varied depending on the
> strength of the machine, but in all cases there is a point where
> messages can be built up and happily served, but the expiry of the
> entire queue will fail.
>
> I have tested this with Rabbit MQ 3.3.0 and RabbitMQ 3.2.4. Both of
> these clusters were running Erlang R16B03 on Windows Server 2008 R2.
>
> It?s not clear to me why the nodes will die with this sort of load. Is
> this a known issue with RabbitMQ or the version of Erlang I am running on?
>
> -Sreyan
>
> class Program
>
>      {
>
>          static void Main(string[] args)
>
>          {
>
>              var host = "127.0.0.1";
>
>              const int loadSize = 1024*1024;
>
>              var stressor = new Stressor(1, loadSize, host, "foo",
> "bar", TimeSpan.FromSeconds(10));
>
>              stressor.ApplyLoad();
>
>              stressor.CancellationTokenSource.Cancel();
>
>              Console.WriteLine( "Applied a load of {0} KiB. Press
> [ENTER] to exit.", loadSize);
>
>              Console.ReadLine();
>
>          }
>
>      }
>
>      public sealed class Stressor
>
>      {
>
>          private const string QueueName = "TEST";
>
>          private readonly int _messageSizeInKiB;
>
>          private readonly int _totalQueueLoadInKiB;
>
>          private readonly IConnection _connection;
>
>          private readonly CancellationTokenSource
> _cancellationTokenSource = new CancellationTokenSource();
>
>          public CancellationTokenSource CancellationTokenSource { get {
> return _cancellationTokenSource; } }
>
>          private readonly Thread _consumptionThread;
>
>          public Stressor(int messageSizeInKiB, int totalQueueLoadInKiB,
> string hostName, string userName, string password, TimeSpan
> connectionTimeout)
>
>          {
>
>              if (hostName == null) throw new
> ArgumentNullException("hostName");
>
>              if (userName == null) throw new
> ArgumentNullException("userName");
>
>              if (password == null) throw new
> ArgumentNullException("password");
>
>              _messageSizeInKiB = messageSizeInKiB;
>
>              _totalQueueLoadInKiB = totalQueueLoadInKiB;
>
>              _connection = new ConnectionFactory
>
>              {
>
>                  HostName = hostName,
>
>                  UserName = userName,
>
>                  Password = password,
>
>                  RequestedConnectionTimeout =
> (ushort)connectionTimeout.TotalMilliseconds
>
>              }.CreateConnection();
>
>              _junkMessageWrapper = new Lazy<byte[]>(() =>
>
>              {
>
>                  var random = new Random();
>
>                  var message = new byte[_messageSizeInKiB * 1024];
>
>                  random.NextBytes(message);
>
>                  return message;
>
>              });
>
>              _consumptionThread = new Thread(Consume) {IsBackground = true};
>
>              _consumptionThread.Start();
>
>          }
>
>          private readonly Lazy<Byte[]> _junkMessageWrapper;
>
>          /// <summary>
>
>          /// A consumer that doesn't take! We want to build up messagees
> then have them expire -- That's the behavior in question.
>
>          /// </summary>
>
>          private void Consume()
>
>          {
>
>              using (var channel = _connection.CreateModel())
>
>              {
>
>                  channel.QueueDeclare(QueueName, false, false, false,
> new Dictionary<string, object> { { "x-expires",
> (int)TimeSpan.FromSeconds(60).TotalMilliseconds } });
>
>                  var consumer = new QueueingBasicConsumer(channel, new
> SharedQueue<BasicDeliverEventArgs>());
>
>                  channel.BasicConsume(QueueName, false, consumer);
>
>                  while (!_cancellationTokenSource.IsCancellationRequested)
>
>                  {
>
>                      Thread.Sleep(TimeSpan.FromMilliseconds(100));
>
>                  }
>
>              }
>
>          }
>
>          public void ApplyLoad()
>
>          {
>
>              using (var channel = _connection.CreateModel())
>
>              {
>
>                  channel.ConfirmSelect();
>
>                  var properties = channel.CreateBasicProperties();
>
>                  properties.SetPersistent(true);
>
>                  var count = _totalQueueLoadInKiB/_messageSizeInKiB + 1;
>
>                  Console.WriteLine("Publishing {0} messages, each {1}
> bytes in size", count, _junkMessageWrapper.Value.Length);
>
>                  for (int i = 0; i < count; i++)
>
>                  {
>
>                      channel.BasicPublish(string.Empty, QueueName,
> properties, _junkMessageWrapper.Value);
>
>                  }
>
>                  channel.WaitForConfirms();
>
>              }
>
>          }
>
>      }
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu May 15 16:28:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 16:28:13 +0100
Subject: [rabbitmq-discuss] Phantom consumers
In-Reply-To: <423A0585-7F9E-4943-8B51-A3A887320136@gmail.com>
References: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
 <53749814.1080507@rabbitmq.com>
 <423A0585-7F9E-4943-8B51-A3A887320136@gmail.com>
Message-ID: <5374DD0D.8010200@rabbitmq.com>

On 15/05/14 16:08, Sam Morrison wrote:
> The connection exists in the rabbit management interface but when
> doing something like an ?lsof -i? on the servers and clients I can?t
> see any connection with that port number. Is that correct?

Is the connection blocked?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu May 15 17:35:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 20:35:38 +0400
Subject: [rabbitmq-discuss] ANN Important change in RabbitMQ .NET client 3.4
Message-ID: <etPan.5374ecf8.66ef438d.b629@mercurio.local>

I'd like to give .NET client users a heads-up on an important change
coming in 3.4: the client will no longer support protocols other than AMQP 0-9-1.

This means a few things:

?* The client will only work with RabbitMQ 2.0 or later
?* App and environment configuration related to protocols will no longer be used
?* Some minor features specific to AMQP 0-8 were removed (e.g. streams and file properties)

Other than that, ~ 98% of the library is still backwards compatible and should
be a drop-in replacement when you upgrade.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mike at suteki.co.uk  Thu May 15 17:45:34 2014
From: mike at suteki.co.uk (Mike Hadlow)
Date: Thu, 15 May 2014 17:45:34 +0100
Subject: [rabbitmq-discuss] ANN Important change in RabbitMQ .NET client
	3.4
In-Reply-To: <etPan.5374ecf8.66ef438d.b629@mercurio.local>
References: <etPan.5374ecf8.66ef438d.b629@mercurio.local>
Message-ID: <CAAc6ZR8b9=qihEnaB_AQHBqTu8HzmLr9sP10F0_6LYr3OUnhmw@mail.gmail.com>

Thanks Michael,

This shouldn't affect EasyNetQ. We only use the AMQP 0-9-1 protocol. But
we'll be upgrading with some caution.

Mike


On Thu, May 15, 2014 at 5:35 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> I'd like to give .NET client users a heads-up on an important change
> coming in 3.4: the client will no longer support protocols other than AMQP
> 0-9-1.
>
> This means a few things:
>
>  * The client will only work with RabbitMQ 2.0 or later
>  * App and environment configuration related to protocols will no longer
> be used
>  * Some minor features specific to AMQP 0-8 were removed (e.g. streams and
> file properties)
>
> Other than that, ~ 98% of the library is still backwards compatible and
> should
> be a drop-in replacement when you upgrade.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/5a5d1ca2/attachment.html>

From 77.ears at gmail.com  Thu May 15 18:05:43 2014
From: 77.ears at gmail.com (RabbitLove)
Date: Thu, 15 May 2014 10:05:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Equally distribute load among servers with
	concurrent consumers
Message-ID: <1400173543401-35577.post@n5.nabble.com>

I set 5 concurrent consumers on each server total 10 consumers for two
servers. 10 consumers listen to the same queue.  What I found is that the
round robin dispatch only feed the first server with 5 first, the sixth one
will go to the second server. How could equally distributed among two
servers without losing the benefit of have 5 concurrent consumers on the
same server?

Your help is greatly appreciated.

Emily





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Equally-distribute-load-among-servers-with-concurrent-consumers-tp35577.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jkuch at gopivotal.com  Thu May 15 18:09:07 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 15 May 2014 10:09:07 -0700
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
In-Reply-To: <DA8A146FF3AF624BA2F5C9CE16E8882B35C02D@SRVMBOX.mdg.co.il>
References: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
 <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>
 <DA8A146FF3AF624BA2F5C9CE16E8882B35C02D@SRVMBOX.mdg.co.il>
Message-ID: <CANOx8N=+hMBRTJcTQk3v5pvGkgRE0Hn+1AyFYBuLEqS9dttoVA@mail.gmail.com>

And you want a client to open an AMQP connection to the Rabbit broker?  Can
you telnet to port 5672, the standard AMQP port? Does anything seem to be
listening there?



On Thu, May 15, 2014 at 7:30 AM, Jonathan Kallner <Jonathank at mdg.co.il>wrote:

>  The VM is reachable.
>
> It is on the same network as the first unit.
>
> It has a static IP address of its own.
>
> The ping command from the win7 (first unit) to the IP of the VM
>
> Works just fine.
>
> The VM for that matter is just a another computer.
>
>
>
>
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Jerry Kuch
> *Sent:* Thursday, May 15, 2014 5:26 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
>
>
>
> How is networking set up for the VM?  You'll have to make sure it has an
> IP address that's actually reachable from any external clients that have to
> talk to it.
>
>
>
>
>
> On Thu, May 15, 2014 at 7:02 AM, Jonathan Kallner <Jonathank at mdg.co.il>
> wrote:
>
> Hi
>
> I'm new at RabbitMQ and I would appreciate very much your help.
>
>
>
> I'm am working on a system with 2 machine connected.
>
> One machine is Win7 OS and the other one is RedHat OS installed on a
> virtual machine.
>
> ( The host computer for the second unit is also Win7).
>
>
>
> I managed to install on both machine RabbitMQ and the shovel plugin.
>
> I can work with the Web-UI plugin in both computers,
>
> And I get also a ping from the Redhat VM to the Win7.
>
>
>
> Both computer are on the same network.
>
> The Redhat VM has a static ip.
>
>
>
> My question is how do I configure each computer ?
>
>
>
> 1. The Win7 is a client
>
> 2. The RedHat is a server.
>
>
>
> I need to open a new connection between both the computers.
>
>
>
>
>
> Thanks
>
>
>
> Jonathan
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=WFM3QWeQPruE29iyWBiVFnG1NXFeODJxBHx8uJWGjQw%3D%0A&s=4a64f3768247534224ccb48250d0f4eaf554a0e937fcf680fbed46ad34c29cf3>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
>
> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=WFM3QWeQPruE29iyWBiVFnG1NXFeODJxBHx8uJWGjQw%3D%0A&s=4a64f3768247534224ccb48250d0f4eaf554a0e937fcf680fbed46ad34c29cf3
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/46432949/attachment.html>

From mklishin at gopivotal.com  Thu May 15 18:11:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 21:11:54 +0400
Subject: [rabbitmq-discuss] Equally distribute load among servers with
 concurrent consumers
In-Reply-To: <1400173543401-35577.post@n5.nabble.com>
References: <1400173543401-35577.post@n5.nabble.com>
Message-ID: <etPan.5374f576.3352255a.b629@mercurio.local>

On 15 May 2014 at 21:06:54, RabbitLove (77.ears at gmail.com) wrote:
> > I set 5 concurrent consumers on each server total 10 consumers  
> for two
> servers. 10 consumers listen to the same queue. What I found is  
> that the
> round robin dispatch only feed the first server with 5 first,  
> the sixth one
> will go to the second server. How could equally distributed among  
> two
> servers without losing the benefit of have 5 concurrent consumers  
> on the
> same server?

Message distribution between consumers is unaware of consumer (the app)
network location. What matters is basic.qos setting for the channels:
make sure they are equal.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu May 15 18:27:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 May 2014 18:27:28 +0100
Subject: [rabbitmq-discuss] ANN: Priority queue plugin
Message-ID: <5374F900.1010501@rabbitmq.com>

Right. I think the priority-queue plugin is now stable enough for 
testing by brave people. So have at it!

You can download a binary for 3.3.x from the community plugins repository:
http://www.rabbitmq.com/community-plugins.html

You can read some documentation in the README file, most legibly at:
https://github.com/rabbitmq/rabbitmq-priority-queue

Please post bug reports, praise etc here. Well, you can post the praise 
anywhere.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From videlalvaro at gmail.com  Thu May 15 18:32:16 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 May 2014 19:32:16 +0200
Subject: [rabbitmq-discuss] ANN: Priority queue plugin
In-Reply-To: <5374F900.1010501@rabbitmq.com>
References: <5374F900.1010501@rabbitmq.com>
Message-ID: <CAMcAHLV_ttPiukfGsP-x71adzxFrb+Z79ZbzYZrGgVFSA-CXRA@mail.gmail.com>

AWESOME


On Thu, May 15, 2014 at 7:27 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Right. I think the priority-queue plugin is now stable enough for testing
> by brave people. So have at it!
>
> You can download a binary for 3.3.x from the community plugins repository:
> http://www.rabbitmq.com/community-plugins.html
>
> You can read some documentation in the README file, most legibly at:
> https://github.com/rabbitmq/rabbitmq-priority-queue
>
> Please post bug reports, praise etc here. Well, you can post the praise
> anywhere.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/5bcca21d/attachment.html>

From srinatsr at cisco.com  Thu May 15 18:49:30 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 15 May 2014 17:49:30 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times and make it as dead
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB3D@xmb-aln-x10.cisco.com>

Hello,

How can I achieve the followings scenarios?

1. Retry unacknowledged RabbitMQ message in 10 second interval
2. Retry 3 times
3. Put the message into the Dead Letter queue after 3 retries.
4. Log a proper message for each action in RabbitMQ


Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/a9b01f3d/attachment.html>

From mklishin at gopivotal.com  Thu May 15 18:55:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 21:55:38 +0400
Subject: [rabbitmq-discuss] Retry Message for 3 times and make it as dead
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB3D@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB3D@xmb-aln-x10.cisco.com>
Message-ID: <etPan.5374ffb8.ded7263.b629@mercurio.local>



On 15 May 2014 at 21:50:50, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> >
> 1. Retry unacknowledged RabbitMQ message in 10 second interval  
> 2. Retry 3 times

Are you talking about publisher confirms or message acknowledgements? Although in both cases,
it's up to your applications:

?* With publisher confirms you fully control when and how many times you retry
?* With consumers you need to manually keep track of redeliveries (this means messages should have unique identifiers)

> 3. Put the message into the Dead Letter queue after 3 retries.?

RabbitMQ has dead letter exchanges:
http://www.rabbitmq.com/dlx.html

which can work in concert with TTL:
http://www.rabbitmq.com/ttl.html

or you could just publish a message to a queue of your choice using the default exchange
(see tutorial 1).?

> 4. Log a proper message for each action in RabbitMQ

Firehose and Tracer: http://www.rabbitmq.com/firehose.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From srinatsr at cisco.com  Thu May 15 19:01:06 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 15 May 2014 18:01:06 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times and make it as dead
In-Reply-To: <etPan.5374ffb8.ded7263.b629@mercurio.local>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB3D@xmb-aln-x10.cisco.com>
 <etPan.5374ffb8.ded7263.b629@mercurio.local>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB80@xmb-aln-x10.cisco.com>

Thanks for your response.
> 1. Retry unacknowledged RabbitMQ message in 10 second interval 2. 
> Retry 3 times



 * With consumers you need to manually keep track of redeliveries (this means messages should have unique identifiers)

How to keep tracke of redeliveries and message (payload) has unique identifier too.

Can you please help?


Regards ??
Srinath

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Thursday, May 15, 2014 10:56 AM
To: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco); Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times and make it as dead



On 15 May 2014 at 21:50:50, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> >
> 1. Retry unacknowledged RabbitMQ message in 10 second interval 2. 
> Retry 3 times

Are you talking about publisher confirms or message acknowledgements? Although in both cases, it's up to your applications:

?* With publisher confirms you fully control when and how many times you retry
?* With consumers you need to manually keep track of redeliveries (this means messages should have unique identifiers)

> 3. Put the message into the Dead Letter queue after 3 retries.

RabbitMQ has dead letter exchanges:
http://www.rabbitmq.com/dlx.html

which can work in concert with TTL:
http://www.rabbitmq.com/ttl.html

or you could just publish a message to a queue of your choice using the default exchange (see tutorial 1).?

> 4. Log a proper message for each action in RabbitMQ

Firehose and Tracer: http://www.rabbitmq.com/firehose.html
--
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 15 19:10:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 22:10:16 +0400
Subject: [rabbitmq-discuss] Retry Message for 3 times and make it as dead
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB80@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB0FB3D@xmb-aln-x10.cisco.com>
 <etPan.5374ffb8.ded7263.b629@mercurio.local>
 <1DB4F5481AB296448E8A5B5BC9D336541CB0FB80@xmb-aln-x10.cisco.com>
Message-ID: <etPan.53750326.1befd79f.b629@mercurio.local>

On 15 May 2014 at 22:02:22, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > How to keep tracke of redeliveries and message (payload) has  
> unique identifier too.

If you have only one consumer app, keeping a synchronised map around (message id => # of redeliveries) should be sufficient.

If you plan on deploy multiple instances of your app, use a data store that supports
counters (e.g. Redis).

Note that message id makes more sense in message properties or headers. This way you
won't waste cycles parsing message payload over and over.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From 77.ears at gmail.com  Thu May 15 19:14:42 2014
From: 77.ears at gmail.com (RabbitLove)
Date: Thu, 15 May 2014 11:14:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Convert sync to async by time
Message-ID: <1400177682486-35586.post@n5.nabble.com>

Is there a way to convert sync message to asynchronous by the timeout? For
example, if a sync request is running longer than 10 second, I would like to
change it to the async request. Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Convert-sync-to-async-by-time-tp35586.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From 77.ears at gmail.com  Thu May 15 19:17:16 2014
From: 77.ears at gmail.com (RabbitLove)
Date: Thu, 15 May 2014 11:17:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Equally distribute load among servers with
	concurrent consumers
In-Reply-To: <etPan.5374f576.3352255a.b629@mercurio.local>
References: <1400173543401-35577.post@n5.nabble.com>
 <etPan.5374f576.3352255a.b629@mercurio.local>
Message-ID: <1400177836614-35587.post@n5.nabble.com>

Thanks for the quick response. I'm using Spring AMQP. It doesn't have
basic.qos. I set prefetch to 1. It didn't work. It still dispatch 5 to the
first server, then started to distribute to the second server. any detail is
appreciated. thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Equally-distribute-load-among-servers-with-concurrent-consumers-tp35577p35587.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From grussell at gopivotal.com  Thu May 15 19:24:33 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 15 May 2014 14:24:33 -0400
Subject: [rabbitmq-discuss] Equally distribute load among servers with
 concurrent consumers
In-Reply-To: <1400177836614-35587.post@n5.nabble.com>
References: <1400173543401-35577.post@n5.nabble.com>
 <etPan.5374f576.3352255a.b629@mercurio.local>
 <1400177836614-35587.post@n5.nabble.com>
Message-ID: <CADtU9_tOTGjjYQ5JZgYFHzAJUMABf3HRL4qP9XsC+Ct1-RGWsQ@mail.gmail.com>

Prefetch sets the basic.qos.

Please re-check your configuration and check the logs; move this discussion
to the Spring AMQP forum or to stack overflow (spring-amqp tag).

Thanks.


On Thu, May 15, 2014 at 2:17 PM, RabbitLove <77.ears at gmail.com> wrote:

> Thanks for the quick response. I'm using Spring AMQP. It doesn't have
> basic.qos. I set prefetch to 1. It didn't work. It still dispatch 5 to the
> first server, then started to distribute to the second server. any detail
> is
> appreciated. thanks.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Equally-distribute-load-among-servers-with-concurrent-consumers-tp35577p35587.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/3058aeb3/attachment.html>

From gavinmroy at gmail.com  Thu May 15 19:36:14 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Thu, 15 May 2014 14:36:14 -0400
Subject: [rabbitmq-discuss] Management UI performance with 3.3.1 on OSX
Message-ID: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>

Hey,

I just updated from 3.2.4 on OSX to 3.3.1 via homebrew and the Management UI performance is pretty terrible (8 to 16 seconds per API call).?http://i.imgur.com/iIEzi7a.png?demonstrates the issue pretty clearly.

There?s nothing of note in either of the log files and 3.2.4 ran just fine. I?m just running this with defaults, no rabbitmq.config file.

I have Erlang R16B3 installed, but noticed that the homebrew install has a bundled R16B2.?

I doubt it?s erlang version related however, as I manually built 3.3.1 from rabbitmq-public-umbrella and am experiencing the same issue.?

I?ve also noticed that startup is significantly slower than I am used to.?

Note that compiling v3.2.4 manually and running it makes the problem go away. In each compile test, ?I?d nuke the data directory to ensure it?s not some issue with the previous mnesia data.

I?m not encountering an issue with 3.3.1 on linux, and I do not see any similar slowness with any other applications. ?

Output of rabbitmq-plugins list:

[e] amqp_client ? ? ? ? ? ? ? ? ? ? ? 3.3.1
[ ] cowboy ? ? ? ? ? ? ? ? ? ? ? ? ? ?0.5.0-rmq3.3.1-git4b93c2d
[ ] eldap ? ? ? ? ? ? ? ? ? ? ? ? ? ? 3.3.1-gite309de4
[e] mochiweb ? ? ? ? ? ? ? ? ? ? ? ? ?2.7.0-rmq3.3.1-git680dba8
[ ] rabbitmq_amqp1_0 ? ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_auth_backend_ldap ? ? ? ?3.3.1
[ ] rabbitmq_auth_mechanism_ssl ? ? ? 3.3.1
[ ] rabbitmq_consistent_hash_exchange 3.3.1
[ ] rabbitmq_federation ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_federation_management ? ?3.3.1
[E] rabbitmq_management ? ? ? ? ? ? ? 3.3.1
[e] rabbitmq_management_agent ? ? ? ? 3.3.1
[E] rabbitmq_management_visualiser ? ?3.3.1
[ ] rabbitmq_mqtt ? ? ? ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_shovel ? ? ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_shovel_management ? ? ? ?3.3.1
[ ] rabbitmq_stomp ? ? ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_tracing ? ? ? ? ? ? ? ? ?3.3.1
[e] rabbitmq_web_dispatch ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_web_stomp ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_web_stomp_examples ? ? ? 3.3.1
[ ] sockjs ? ? ? ? ? ? ? ? ? ? ? ? ? ?0.3.4-rmq3.3.1-git3132eb9
[e] webmachine ? ? ? ? ? ? ? ? ? ? ? ?1.10.3-rmq3.3.1-gite9359c7

Anyone have suggestions to figure out what may be going on?

Thanks in advance,

Gavin



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/fb913825/attachment.html>

From mklishin at gopivotal.com  Thu May 15 19:39:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 15 May 2014 22:39:54 +0400
Subject: [rabbitmq-discuss] Management UI performance with 3.3.1 on OSX
In-Reply-To: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
References: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
Message-ID: <etPan.53750a14.6b68079a.b629@mercurio.local>

?On 15 May 2014 at 22:38:33, Gavin M. Roy (gavinmroy at gmail.com) wrote:
> > Note that compiling v3.2.4 manually and running it makes the  
> problem go away. In each compile test, I?d nuke the data directory  
> to ensure it?s not some issue with the previous mnesia data.
>  
> I?m not encountering an issue with 3.3.1 on linux, and I do not  
> see any similar slowness with any other applications.

Does this happen with a completely clean database?
Have you tried 3.3.1 binary build?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Thu May 15 19:41:33 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 May 2014 20:41:33 +0200
Subject: [rabbitmq-discuss] Management UI performance with 3.3.1 on OSX
In-Reply-To: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
References: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
Message-ID: <CAMcAHLXEe0s60cgw0+=vAWxboMLPG6Cjrw+w_V80+kqz3Bzdaw@mail.gmail.com>

I've been using the latest standalone release this whole week "out of the
tarball" with the management plugin, and I haven't seen any issues.

I haven't tried using homebrew, tho.


On Thu, May 15, 2014 at 8:36 PM, Gavin M. Roy <gavinmroy at gmail.com> wrote:

> Hey,
>
> I just updated from 3.2.4 on OSX to 3.3.1 via homebrew and the Management
> UI performance is pretty terrible (8 to 16 seconds per API call).
> http://i.imgur.com/iIEzi7a.png demonstrates the issue pretty clearly.
>
> There?s nothing of note in either of the log files and 3.2.4 ran just
> fine. I?m just running this with defaults, no rabbitmq.config file.
>
> I have Erlang R16B3 installed, but noticed that the homebrew install has a
> bundled R16B2.
>
> I doubt it?s erlang version related however, as I manually built 3.3.1
> from rabbitmq-public-umbrella and am experiencing the same issue.
>
> I?ve also noticed that startup is significantly slower than I am used to.
>
> Note that compiling v3.2.4 manually and running it makes the problem go
> away. In each compile test,  I?d nuke the data directory to ensure it?s not
> some issue with the previous mnesia data.
>
> I?m not encountering an issue with 3.3.1 on linux, and I do not see any
> similar slowness with any other applications.
>
> Output of rabbitmq-plugins list:
>
> [e] amqp_client                       3.3.1
> [ ] cowboy                            0.5.0-rmq3.3.1-git4b93c2d
> [ ] eldap                             3.3.1-gite309de4
> [e] mochiweb                          2.7.0-rmq3.3.1-git680dba8
> [ ] rabbitmq_amqp1_0                  3.3.1
> [ ] rabbitmq_auth_backend_ldap        3.3.1
> [ ] rabbitmq_auth_mechanism_ssl       3.3.1
> [ ] rabbitmq_consistent_hash_exchange 3.3.1
> [ ] rabbitmq_federation               3.3.1
> [ ] rabbitmq_federation_management    3.3.1
> [E] rabbitmq_management               3.3.1
> [e] rabbitmq_management_agent         3.3.1
> [E] rabbitmq_management_visualiser    3.3.1
> [ ] rabbitmq_mqtt                     3.3.1
> [ ] rabbitmq_shovel                   3.3.1
> [ ] rabbitmq_shovel_management        3.3.1
> [ ] rabbitmq_stomp                    3.3.1
> [ ] rabbitmq_tracing                  3.3.1
> [e] rabbitmq_web_dispatch             3.3.1
> [ ] rabbitmq_web_stomp                3.3.1
> [ ] rabbitmq_web_stomp_examples       3.3.1
> [ ] sockjs                            0.3.4-rmq3.3.1-git3132eb9
> [e] webmachine                        1.10.3-rmq3.3.1-gite9359c7
>
> Anyone have suggestions to figure out what may be going on?
>
> Thanks in advance,
>
> Gavin
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/2fdbf754/attachment.html>

From gavinmroy at gmail.com  Thu May 15 19:42:54 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Thu, 15 May 2014 14:42:54 -0400
Subject: [rabbitmq-discuss] Management UI performance with 3.3.1 on OSX
In-Reply-To: <etPan.53750a14.6b68079a.b629@mercurio.local>
References: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
 <etPan.53750a14.6b68079a.b629@mercurio.local>
Message-ID: <etPan.53750aae.643c9869.49e@s826.ofc.lair>



On May 15, 2014 at 2:40:23 PM, Michael Klishin (mklishin at gopivotal.com) wrote:

?On 15 May 2014 at 22:38:33, Gavin M. Roy (gavinmroy at gmail.com) wrote:?
> > Note that compiling v3.2.4 manually and running it makes the?
> problem go away. In each compile test, I?d nuke the data directory?
> to ensure it?s not some issue with the previous mnesia data.?
>?
> I?m not encountering an issue with 3.3.1 on linux, and I do not?
> see any similar slowness with any other applications.?

Does this happen with a completely clean database??
Yes

Have you tried 3.3.1 binary build??
Yes, same behavior. Is there a flag I can set that does debug level tracing?

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/bd934748/attachment.html>

From gavinmroy at gmail.com  Thu May 15 19:55:37 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Thu, 15 May 2014 14:55:37 -0400
Subject: [rabbitmq-discuss] Management UI performance with 3.3.1 on OSX
In-Reply-To: <CAMcAHLXEe0s60cgw0+=vAWxboMLPG6Cjrw+w_V80+kqz3Bzdaw@mail.gmail.com>
References: <etPan.5375091e.6b8b4567.49e@s826.ofc.lair>
 <CAMcAHLXEe0s60cgw0+=vAWxboMLPG6Cjrw+w_V80+kqz3Bzdaw@mail.gmail.com>
Message-ID: <etPan.53750da9.74b0dc51.49e@s826.ofc.lair>

I believe I?ve traced it back to DNS. When I override the work provided DNS servers with Google?s Public DNS, everything behaves as expected. Reviewing release notes now to see if anything mentions changes with regard to DNS lookup.

Gavin
On May 15, 2014 at 2:43:25 PM, Alvaro Videla (videlalvaro at gmail.com) wrote:

I've been using the latest standalone release this whole week "out of the tarball" with the management plugin, and I haven't seen any issues.

I haven't tried using homebrew, tho.


On Thu, May 15, 2014 at 8:36 PM, Gavin M. Roy <gavinmroy at gmail.com> wrote:
Hey,

I just updated from 3.2.4 on OSX to 3.3.1 via homebrew and the Management UI performance is pretty terrible (8 to 16 seconds per API call).?http://i.imgur.com/iIEzi7a.png?demonstrates the issue pretty clearly.

There?s nothing of note in either of the log files and 3.2.4 ran just fine. I?m just running this with defaults, no rabbitmq.config file.

I have Erlang R16B3 installed, but noticed that the homebrew install has a bundled R16B2.?

I doubt it?s erlang version related however, as I manually built 3.3.1 from rabbitmq-public-umbrella and am experiencing the same issue.?

I?ve also noticed that startup is significantly slower than I am used to.?

Note that compiling v3.2.4 manually and running it makes the problem go away. In each compile test, ?I?d nuke the data directory to ensure it?s not some issue with the previous mnesia data.

I?m not encountering an issue with 3.3.1 on linux, and I do not see any similar slowness with any other applications. ?

Output of rabbitmq-plugins list:

[e] amqp_client ? ? ? ? ? ? ? ? ? ? ? 3.3.1
[ ] cowboy ? ? ? ? ? ? ? ? ? ? ? ? ? ?0.5.0-rmq3.3.1-git4b93c2d
[ ] eldap ? ? ? ? ? ? ? ? ? ? ? ? ? ? 3.3.1-gite309de4
[e] mochiweb ? ? ? ? ? ? ? ? ? ? ? ? ?2.7.0-rmq3.3.1-git680dba8
[ ] rabbitmq_amqp1_0 ? ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_auth_backend_ldap ? ? ? ?3.3.1
[ ] rabbitmq_auth_mechanism_ssl ? ? ? 3.3.1
[ ] rabbitmq_consistent_hash_exchange 3.3.1
[ ] rabbitmq_federation ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_federation_management ? ?3.3.1
[E] rabbitmq_management ? ? ? ? ? ? ? 3.3.1
[e] rabbitmq_management_agent ? ? ? ? 3.3.1
[E] rabbitmq_management_visualiser ? ?3.3.1
[ ] rabbitmq_mqtt ? ? ? ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_shovel ? ? ? ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_shovel_management ? ? ? ?3.3.1
[ ] rabbitmq_stomp ? ? ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_tracing ? ? ? ? ? ? ? ? ?3.3.1
[e] rabbitmq_web_dispatch ? ? ? ? ? ? 3.3.1
[ ] rabbitmq_web_stomp ? ? ? ? ? ? ? ?3.3.1
[ ] rabbitmq_web_stomp_examples ? ? ? 3.3.1
[ ] sockjs ? ? ? ? ? ? ? ? ? ? ? ? ? ?0.3.4-rmq3.3.1-git3132eb9
[e] webmachine ? ? ? ? ? ? ? ? ? ? ? ?1.10.3-rmq3.3.1-gite9359c7

Anyone have suggestions to figure out what may be going on?

Thanks in advance,

Gavin




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________  
rabbitmq-discuss mailing list  
rabbitmq-discuss at lists.rabbitmq.com  
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/febac63b/attachment.html>

From timon86.wang at gmail.com  Fri May 16 02:42:32 2014
From: timon86.wang at gmail.com (Timon Wang)
Date: Fri, 16 May 2014 09:42:32 +0800
Subject: [rabbitmq-discuss] Consumer get blocked after all connections
	exhausted.
Message-ID: <CA+DFwRE+wFDj69sWSgQ2Z7jU_M0xfCS8q=srb1N6LS2g+K_0zA@mail.gmail.com>

It seems that Consumer will get blocked after all connections exhausted.
Some rabbitmqctl commands such as `rabbitmqctl list_queues` and
`rabbitmqctl list_consumers` will get stucked as well.

Here is an example to demonstrate that:
https://gist.github.com/timonwong/238f2379d1acbbd4ef0a
After all connections are exhausted, consumer will get blocked after
several seconds, `rabbitmqadmin list queues` will indicate that there was
unacknowledged messages in the queue:

+-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
| vhost |   name    | auto_delete | consumer_utilisation | consumers |
durable | exclusive_consumer_tag |  memory  | messages | messages_ready |
messages_unacknowledged |       node       | policy |  state  |
+-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
| /     | test.msgs | False       | 0.105861902008       | 1         | True
   |                        | 74966600 | 46906    | 45664          | 1242
                 | rabbit at localhost |        | running |
+-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+


I've tried Python kombu library with both pyamqp and librabbitmq as
transport driver.

Am I doing something wrong? Or is it a expected behavior?

My environment

Server side:
CentOS 6.3 64bit
RabbitMQ: 3.3.1

Client side:
CentOS 6.3 64bit
Python 2.7.6
Kombu 3.0.16

Thanks in advance.

Regards,
Timon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/217daccf/attachment.html>

From timon86.wang at gmail.com  Thu May 15 10:07:49 2014
From: timon86.wang at gmail.com (Timon Wang)
Date: Thu, 15 May 2014 02:07:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Producers and consumers get blocked after all
 connections exhausted.
Message-ID: <2c0d4d30-2c0b-4856-a374-cdb04c30ee52@googlegroups.com>

It seems producers and consumers get blocked after all connections 
exhausted.

Some rabbitmqctl commands such as `rabbitmqctl list_queues` and 
`rabbitmqctl list_consumers` will get blocked as well.

Here is an example to demonstrate 
that: https://gist.github.com/timonwong/238f2379d1acbbd4ef0a

I've tried Python kombu library with both pyamqp and librabbitmq.

Am I doing something wrong? Or is it a expected behavior?

My environment

Server side:
CentOS 6.3 64bit
RabbitMQ: 3.3.1

Client side:
CentOS 6.3 64bit
Python 2.7.6
Kombu 3.0.16

Thanks in advance.

Regards,
  Timon Wong

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/233cdc23/attachment.html>

From sokann at gmail.com  Thu May 15 11:01:40 2014
From: sokann at gmail.com (Sok Ann Yap)
Date: Thu, 15 May 2014 18:01:40 +0800
Subject: [rabbitmq-discuss] loop_forever() from paho-mqtt python client
	prevents rabbitmq from stopping
Message-ID: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>

I just started playing with rabbitmq for a few days, mainly as a mqtt
broker. I noticed that as long as I have any active connection from a
paho-mqtt python client, then the rabbitmq process would just hang
forever following `rabbitmqctl stop <pid>`

Steps to reproduce (on debian/ubuntu):

1. Install rabbitmq-server version 3.3.1 following
http://www.rabbitmq.com/install-debian.html
2. As root, run `rabbitmq-plugins enable rabbitmq_mqtt;
/etc/init.d/rabbitmq-server restart` to enable the mqtt plugin
3. As root, run `easy_install paho-mqtt` to install paho-mqtt version 0.9
4. Copy the sample code from the "Getting Started" section of
https://pypi.python.org/pypi/paho-mqtt/0.9 as mqtt_test.py, replace
iot.eclipse.org with localhost
5. Run `python mqtt_test.py`, which will print "Connected with result
code 0" and then loop forever
6. As root, run `/etc/init.d/rabbitmq-server stop`

Attached is a sample log file. Step 5 happened on 09:33:28. Step 6
happened on 09:33:39. On 09:39:42, I went to the console running the
python script, and pressed Ctrl+C. The rabbitmq process was able to
stop following that.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.log
Type: text/x-log
Size: 5847 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/6ec0a1c0/attachment.bin>

From jonathan.kallner at gmail.com  Thu May 15 14:23:00 2014
From: jonathan.kallner at gmail.com (Jonathan K)
Date: Thu, 15 May 2014 06:23:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
Message-ID: <8214ddd0-98cd-4adc-a85c-81c0e2e23dfa@googlegroups.com>

Hi
I'm new at RabbitMQ and I would appreciate very much your help.

I'm am working on a system with 2 machine connected.
One machine is Win7 OS and the other one is RedHat OS installed on a 
virtual machine. 
( The host computer for the second unit is also Win7).

I managed to install on both machine RabbitMQ and the shovel plugin.
I can work with the Web-UI plugin in both computers,
And I get also a ping from the Redhat VM to the Win7.

Both computer are on the same network.
The Redhat VM has a static ip.

My question is how do I configure each computer ?

1. The Win7 is a client 
2. The RedHat is a server. 


Thanks

Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/251f211e/attachment.html>

From Jonathank at mdg.co.il  Thu May 15 14:56:04 2014
From: Jonathank at mdg.co.il (Jonathan Kallner)
Date: Thu, 15 May 2014 13:56:04 +0000
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
Message-ID: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFC7@SRVMBOX.mdg.co.il>

Hi
I'm new at RabbitMQ and I would appreciate very much your help.

I'm am working on a system with 2 machine connected.
One machine is Win7 OS and the other one is RedHat OS installed on a virtual machine.
( The host computer for the second unit is also Win7).

I managed to install on both machine RabbitMQ and the shovel plugin.
I can work with the Web-UI plugin in both computers,
And I get also a ping from the Redhat VM to the Win7.

Both computer are on the same network.
The Redhat VM has a static ip.

My question is how do I configure each computer ?

1. The Win7 is a client
2. The RedHat is a server.

I need to open a new connection between both the computers.


Thanks

Jonathan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/87f33de0/attachment.html>

From bwatson1979 at gmail.com  Thu May 15 15:44:29 2014
From: bwatson1979 at gmail.com (Ben Watson)
Date: Thu, 15 May 2014 07:44:29 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq_web_stomp plugin
Message-ID: <86cdf13e-24d4-436d-ae24-4310da76e196@googlegroups.com>

Greetings,

I've been running RabbitMQ with the rabbitmq_web_stomp plugin for quite 
some time to deliver "near real time" data to browsers.  

Some more pertinent information:

"Old" system config:

   - Ubuntu 12.04 LTS 
      - specifically 12.04.3
   - Erlang 14B04 
      - this is the version Ubuntu repos install by default
   - RabbitMQ 2.8.2-1 
      - this was the first version where the rabbitmq_web_stomp plugin was 
      available experimentally
   
This setup has been rock solid for quite some time and has fulfilled all of 
my needs.  

However, I'm building a "new" system to keep up-to-date on software.  I 
noticed that after RabbitMQ 3.x (and the specific "x" value escapes me at 
the moment), the rabbitmq_web_stomp plugin was bundled with the server 
software by default.  So my "new" system would look like this:

"New" system config:

   - Ubuntu 14.04 LTS
   - Erlang 16B03
   - RabbitMQ 3.3.1

Overall installation is a breeze.  The rabbitmq-server comes up fine and I 
can "use" it with familiar tools (e.g. the Python pika module).  However, 
when I use rabbitmq-plugins to enable rabbitmq_web_stomp, the 
rabbitmq-server fails to come back from a required restart.  That is, I see 
a message saying "starting server..." with a status of "FAIL".  The server 
logs have very little information, stating that there may be more 
information within the logs ("duh"), and that an erl crash dump was created 
(I've never been able to find this dump).  The only nugget of information 
I've gleaned from the logs is something cryptic:


   - "no such file or directory ranch.app"
   
My Google-fu hasn't turned up anything on this particular piece.  I'm not 
sure if this is an Erlang problem or a RabbitMQ plugin problem.

Any ideas?

v/r

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140515/0cdd7331/attachment.html>

From sorrison at gmail.com  Thu May 15 16:08:30 2014
From: sorrison at gmail.com (Sam Morrison)
Date: Thu, 15 May 2014 11:08:30 -0400
Subject: [rabbitmq-discuss] Phantom consumers
In-Reply-To: <53749814.1080507@rabbitmq.com>
References: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
 <53749814.1080507@rabbitmq.com>
Message-ID: <423A0585-7F9E-4943-8B51-A3A887320136@gmail.com>

Hi Simon,

On 15 May 2014, at 6:33 am, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/05/14 13:53, Sam Morrison wrote:
>> Hi,
>> 
>> We've got 2 3 node rabbit clusters, one using 3.1.3 and one using 3.3.0.
>> We mirror all queues.
>> 
>> Every so often we get queues filling up in the unacked counters. When we
>> investigate we see the queue has 2 consumers both from the same client
>> address.
>> One consumer links back to a connection that doesn't exist on the client
>> or the server.
> 
> When you say "a connection that doesn't exist", how are you verifying this? What does mgmt show?

The connection exists in the rabbit management interface but when doing something like an ?lsof -i? on the servers and clients I can?t see any connection with that port number. Is that correct?

Cheers,
Sam

> 
> My suspicion is that somehow the connection still does exist, at least from the server's perspective.
> 
> Cheers, Simon
> 
>> If we stop the client one of the consumers goes away but we are still
>> left with a phantom one.
>> 
>> The only way we have been able to fix this is by deleting the queue and
>> restarting the client.
>> 
>> While it is in this state the client doesn't get any messages.
>> 
>> This happens with both our clusters.
>> 
>> Anyone else seeing this or know what the issue is?
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal


From sorrison at gmail.com  Thu May 15 21:35:50 2014
From: sorrison at gmail.com (Sam Morrison)
Date: Thu, 15 May 2014 16:35:50 -0400
Subject: [rabbitmq-discuss] Phantom consumers
In-Reply-To: <5374DD0D.8010200@rabbitmq.com>
References: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
 <53749814.1080507@rabbitmq.com>
 <423A0585-7F9E-4943-8B51-A3A887320136@gmail.com>
 <5374DD0D.8010200@rabbitmq.com>
Message-ID: <DD178853-756F-4EF4-855A-6410936E2C3F@gmail.com>


On 15 May 2014, at 11:28 am, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 15/05/14 16:08, Sam Morrison wrote:
>> The connection exists in the rabbit management interface but when
>> doing something like an ?lsof -i? on the servers and clients I can?t
>> see any connection with that port number. Is that correct?
> 
> Is the connection blocked?

Do you mean via a firewall or iptables etc? There are no firewalls etc. in the way.

Thanks,
Sam


From mouadino at gmail.com  Fri May 16 10:42:57 2014
From: mouadino at gmail.com (mouad ben)
Date: Fri, 16 May 2014 11:42:57 +0200
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
	synchronization
In-Reply-To: <53722549.4030002@rabbitmq.com>
References: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
 <53722549.4030002@rabbitmq.com>
Message-ID: <CACU-xnop25AC6RD0q66=mj7sO+G3wjxC=BGqC2Ez9GSUbXJfCg@mail.gmail.com>

On Tue, May 13, 2014 at 3:59 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/05/2014 14:25, mouad ben wrote:
>
>> RabbitMQ cluster (RabbitMQ 3.1.5,Erlang R14B04)
>>
>
> (Queues are also created with x-ha-policy set to all).
>>
>
> As an aside, note that x-ha-policy only controls queue mirroring in 2.x!
> In 3.x it does nothing at all. Seehttp://www.rabbitmq.com/ha.html and
> http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/


Ohh thanks for the info, shamelessly i didn't knew that.


>
>
> Of course, autodelete RPC queues quite possibly do not need to be HA.


Well apparently my "chaos monkey" wasn't able to reproduce this problem
when mirroring queue was enabled !? I am actually still not sure why is
this the case !? I am probably missing something obvious !


>
>
> But in the same time if a node of the cluster go down the Queue consumer
>> that are created in this node will be deleted, the Queues with
>> auto-delete will end up being deleted too and the same thing with the
>> exchanges bounded to them which also have auto-delete, all of this will
>> be done **eventually** in all RabbitMQ nodes that are still up.
>>
>> So in detail from neutron side we have:
>>
>> N1. Connect to node 2.
>> N2. Create Exchange X.
>> N3. Create Queue Q.
>> N4. Create Binding from Q to X.
>>
>>  From cluster side we have:
>>
>> R1. Delete consumer.
>> R2. Delete Queue Q (Binding is deleted explicitly).
>> R3. Delete Exchange X.
>>
>> This actually can lead to a race condition that will result of N4
>> failing with error stating that exchange doesn't exist because
>> apparently R3 action was executed after N2 and before N4.
>>
>
> That makes sense. But note that R2 and R3 are an atomic event.


Just to be sure, you don't mean that (R2+R3) group is an atomic event !?


>
>
> A workaround that we have created is to retry creation if it fail as you
>> can see in the bug report in OpenStack side
>> https://bugs.launchpad.net/neutron/+bug/1318721.
>>
>
> And that would work as a workaround.
>
>
> But i think that this also a problem in RabbitMQ side, basically i
>> believe a more sane behavior will be for RabbitMQ to ignore **old**
>> delete if a newest exchange's declare was sent, instead of threading
>> this later as a no op.
>>
>
> Hmm. Newer than what? The queue delete R2 is not necessarily older than
> then most recent exchange declare N2 in this scenario, is it? In fact,
> isn't R2 always newer than N2?
>

Not necessarily, I don't see why there should be any order between
unrelated operation from client versus cluster side, when the connection is
broken this will raise the sequence of events in both sides but who is
faster ! in the "happy path" the order will be R1 -> R2 -> R3 -> N1 -> N2
-> N3 -> N4, but in reality all orders are possible e.g. R1 -> N1 -> N2 ->
R2 -> N3 -> R3 -> N4, right ? BTW when i say order, i am taking as
reference the RabbitMQ cluster b/c operation are atomics right ?


>
> (Also, doing this would require timestamps in queues, exchanges and
> bindings, updated cluster-wide every time they are re-declared. That would
> be a big problem for performance.)


Agree, timestamp are surely not that easy to manage in a distributed
environment b/c they require the clocks in the different nodes to be in
sync, vector clock may be another solution but well i am not well versed
enough in distributed system to give any real feedback on this, that was
just a dummy idea from my part anyway :)


>
>
> Does my analyze above make sense !?
>>
>
> So I'm not sure it does.
>
> When reading also the AMQP 0-9-1 reference
>> (https://www.rabbitmq.com/amqp-0-9-1-reference.html) i found that:
>>
>>   * The server SHOULD allow for a reasonable delay between the point
>>
>>     when it determines that an exchange is not being used (or no longer
>>     used), and the point when it deletes the exchange. At the least it
>>     must allow a client to create an exchange and then bind a queue to
>>     it, with a small but non-zero delay between these two actions.
>>
>>
>> Does my finding contradict this ? And how big is the delay ?
>>
>
> It does; there is no delay in RabbitMQ.
>
> Note that if there were a delay then you'd still have exactly the same
> race anyway, it wouldn't solve anything.
>
> You can get a similar delay for the queue deletion, by using x-expires
> instead of auto-delete. But once the queue goes, the bindings and exchange
> all go atomically.
>
> So how to solve your problem? It sounds like each thing that can receive
> RPC replies declares an exchange, queue and binding for that purpiose, with
> the exchange and queue not linked in to anything else. Is that correct?
>

Yes that's the main idea of how OpenStack implement RPC.


>
> If that is so, why not only declare a queue, and have the RPC server
> publish to that queue directly? The queue could still be auto-delete, and
> everything would be simpler. Or is there some subtlety I'm not getting?


You mean by publishing to the "nameless exchanger", that sounds much
easier, but i am not why that is not the case i need probably to ask in the
OpenStack mailing list first.


>
>
> One last thing is the auto-delete deprecation from
>> http://www.rabbitmq.com/amqp-0-9-1-errata.html, point 25:
>>
>> The 'auto-delete' flag on 'exchange.declare' got deprecated in 0-9-1.
>> Auto-delete exchanges are actually quite useful, so this flag should be
>> restored.
>>
>> Does this mean the auto-delete flag will not be removed from RabbitMQ or
>> what ?
>>
>
> It means we will continue to support it, yes.
>
> Cheers, Simon
>

Thanks for the quick answer too, and sorry for answering you directly
instead of answering to the mailing list, dummy mistake from my part :(


On Tue, May 13, 2014 at 3:59 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/05/2014 14:25, mouad ben wrote:
>
>> RabbitMQ cluster (RabbitMQ 3.1.5,Erlang R14B04)
>>
>
>  (Queues are also created with x-ha-policy set to all).
>>
>
> As an aside, note that x-ha-policy only controls queue mirroring in 2.x!
> In 3.x it does nothing at all. See http://www.rabbitmq.com/ha.html and
> http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/
>
> Of course, autodelete RPC queues quite possibly do not need to be HA.
>
>
>  But in the same time if a node of the cluster go down the Queue consumer
>> that are created in this node will be deleted, the Queues with
>> auto-delete will end up being deleted too and the same thing with the
>> exchanges bounded to them which also have auto-delete, all of this will
>> be done **eventually** in all RabbitMQ nodes that are still up.
>>
>> So in detail from neutron side we have:
>>
>> N1. Connect to node 2.
>> N2. Create Exchange X.
>> N3. Create Queue Q.
>> N4. Create Binding from Q to X.
>>
>>  From cluster side we have:
>>
>> R1. Delete consumer.
>> R2. Delete Queue Q (Binding is deleted explicitly).
>> R3. Delete Exchange X.
>>
>> This actually can lead to a race condition that will result of N4
>> failing with error stating that exchange doesn't exist because
>> apparently R3 action was executed after N2 and before N4.
>>
>
> That makes sense. But note that R2 and R3 are an atomic event.
>
>
>  A workaround that we have created is to retry creation if it fail as you
>> can see in the bug report in OpenStack side
>> https://bugs.launchpad.net/neutron/+bug/1318721.
>>
>
> And that would work as a workaround.
>
>
>  But i think that this also a problem in RabbitMQ side, basically i
>> believe a more sane behavior will be for RabbitMQ to ignore **old**
>> delete if a newest exchange's declare was sent, instead of threading
>> this later as a no op.
>>
>
> Hmm. Newer than what? The queue delete R2 is not necessarily older than
> then most recent exchange declare N2 in this scenario, is it? In fact,
> isn't R2 always newer than N2?
>
> (Also, doing this would require timestamps in queues, exchanges and
> bindings, updated cluster-wide every time they are re-declared. That would
> be a big problem for performance.)
>
>
>  Does my analyze above make sense !?
>>
>
> So I'm not sure it does.
>
>  When reading also the AMQP 0-9-1 reference
>> (https://www.rabbitmq.com/amqp-0-9-1-reference.html) i found that:
>>
>>   * The server SHOULD allow for a reasonable delay between the point
>>
>>     when it determines that an exchange is not being used (or no longer
>>     used), and the point when it deletes the exchange. At the least it
>>     must allow a client to create an exchange and then bind a queue to
>>     it, with a small but non-zero delay between these two actions.
>>
>>
>> Does my finding contradict this ? And how big is the delay ?
>>
>
> It does; there is no delay in RabbitMQ.
>
> Note that if there were a delay then you'd still have exactly the same
> race anyway, it wouldn't solve anything.
>
> You can get a similar delay for the queue deletion, by using x-expires
> instead of auto-delete. But once the queue goes, the bindings and exchange
> all go atomically.
>
> So how to solve your problem? It sounds like each thing that can receive
> RPC replies declares an exchange, queue and binding for that purpiose, with
> the exchange and queue not linked in to anything else. Is that correct?
>
> If that is so, why not only declare a queue, and have the RPC server
> publish to that queue directly? The queue could still be auto-delete, and
> everything would be simpler. Or is there some subtlety I'm not getting?
>
>
>  One last thing is the auto-delete deprecation from
>> http://www.rabbitmq.com/amqp-0-9-1-errata.html, point 25:
>>
>> The 'auto-delete' flag on 'exchange.declare' got deprecated in 0-9-1.
>> Auto-delete exchanges are actually quite useful, so this flag should be
>> restored.
>>
>> Does this mean the auto-delete flag will not be removed from RabbitMQ or
>> what ?
>>
>
> It means we will continue to support it, yes.
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/8f3c0458/attachment.html>

From mouadino at gmail.com  Fri May 16 10:43:47 2014
From: mouadino at gmail.com (mouad ben)
Date: Fri, 16 May 2014 11:43:47 +0200
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
	synchronization
In-Reply-To: <etPan.537221ea.2ae8944a.11ca@mercurio.local>
References: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
 <etPan.537221ea.2ae8944a.11ca@mercurio.local>
Message-ID: <CACU-xnrFMOwbdutfwCGdEumAkNNcn0vhekzBB+wv-Vj5gimD5g@mail.gmail.com>

On Tue, May 13, 2014 at 3:44 PM, Michael Klishin <mklishin at gopivotal.com>
 wrote:

> On 13 May 2014 at 17:28:06, mouad ben (mouadino at gmail.com) wrote:
> > > But i think that this also a problem in RabbitMQ side, basically
> > i believe a more sane behavior will be for RabbitMQ to ignore **old**
> > delete if a newest exchange's declare was sent, instead of threading
> > this later as a no op.
> >
> > Does my analyze above make sense !?
>
> I personally think that systems that cannot tolerate the current behaviour
> should not use auto-delete exchanges.
>
> Is this realistic for OpenStack? Is it only auto-delete exchanges that
> cause you practical issues or auto-delete queues, too? If the latter,
> have you considered exclusive queues (note that they cannot be mirrored).
>

Yes it's realistic for OpenStack and i have already filled a bug report
there (https://bugs.launchpad.net/neutron/+bug/1318721), The problem only
happen with auto-delete exchanges not the queues and i believe this is b/c
the queues wasn't mirrored b/c we were relaying on x-ha-policy argument
that do nothing in RabbitMQ 3.*, a misconfiguration from our side sadly,
But i still don't understand why this is the case, why in case of mirrored
queues the problem doesn't happen !


On Tue, May 13, 2014 at 3:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 13 May 2014 at 17:28:06, mouad ben (mouadino at gmail.com) wrote:
> > > But i think that this also a problem in RabbitMQ side, basically
> > i believe a more sane behavior will be for RabbitMQ to ignore **old**
> > delete if a newest exchange's declare was sent, instead of threading
> > this later as a no op.
> >
> > Does my analyze above make sense !?
>
> I personally think that systems that cannot tolerate the current behaviour
> should not use auto-delete exchanges.
>
> Is this realistic for OpenStack? Is it only auto-delete exchanges that
> cause you practical issues or auto-delete queues, too? If the latter,
> have you considered exclusive queues (note that they cannot be mirrored).
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/8a30631c/attachment.html>

From simon at rabbitmq.com  Fri May 16 10:52:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 10:52:30 +0100
Subject: [rabbitmq-discuss] Phantom consumers
In-Reply-To: <DD178853-756F-4EF4-855A-6410936E2C3F@gmail.com>
References: <6ee977e6-5383-45a5-a67e-a986cce0fcd9@googlegroups.com>
 <53749814.1080507@rabbitmq.com>
 <423A0585-7F9E-4943-8B51-A3A887320136@gmail.com>
 <5374DD0D.8010200@rabbitmq.com>
 <DD178853-756F-4EF4-855A-6410936E2C3F@gmail.com>
Message-ID: <5375DFDE.8040407@rabbitmq.com>

On 15/05/14 21:35, Sam Morrison wrote:
> On 15 May 2014, at 11:28 am, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> On 15/05/14 16:08, Sam Morrison wrote:
>>> The connection exists in the rabbit management interface but when
>>> doing something like an ?lsof -i? on the servers and clients I can?t
>>> see any connection with that port number. Is that correct?
>>
>> Is the connection blocked?
>
> Do you mean via a firewall or iptables etc? There are no firewalls etc. in the way.

No, I meant does the connection show as having status "blocked" in 
rabbitmqctl / management. If the memory or disk alarm has gone off then 
connections do not read from their sockets, and then it is impossible 
for them to detect that the underlying TCP connection has gone away 
(until the memory alarm clears anyway).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 16 11:10:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 11:10:16 +0100
Subject: [rabbitmq-discuss] rabbitmq_web_stomp plugin
In-Reply-To: <86cdf13e-24d4-436d-ae24-4310da76e196@googlegroups.com>
References: <86cdf13e-24d4-436d-ae24-4310da76e196@googlegroups.com>
Message-ID: <5375E408.2060305@rabbitmq.com>

On 15/05/14 15:44, Ben Watson wrote:
> "New" system config:
>
>   * Ubuntu 14.04 LTS
>   * Erlang 16B03
>   * RabbitMQ 3.3.1
>
> Overall installation is a breeze.  The rabbitmq-server comes up fine and
> I can "use" it with familiar tools (e.g. the Python pika module).
>   However, when I use rabbitmq-plugins to enable rabbitmq_web_stomp, the
> rabbitmq-server fails to come back from a required restart.  That is, I
> see a message saying "starting server..." with a status of "FAIL".  The
> server logs have very little information, stating that there may be more
> information within the logs ("duh"), and that an erl crash dump was
> created (I've never been able to find this dump).  The only nugget of
> information I've gleaned from the logs is something cryptic:
>
>   * "no such file or directory ranch.app"

That's... interesting. rabbitmq_web_stomp depends on a web server called 
cowboy. Cowboy in turn depends on a library called ranch - but only in 
more recent versions of cowboy than the version we ship.

So somehow you are picking up the wrong version of Cowboy.

Assuming you have not patched and built RabbitMQ yourself (which I hope 
you would have mentioned) then the most likely reason is that something 
else has installed a different version of cowboy in a system-wide 
location (probably /usr/lib/erlang/lib on Ubuntu). Is that what's happened?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 16 11:12:54 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 11:12:54 +0100
Subject: [rabbitmq-discuss] rabbitmq_web_stomp plugin
In-Reply-To: <5375E408.2060305@rabbitmq.com>
References: <86cdf13e-24d4-436d-ae24-4310da76e196@googlegroups.com>
 <5375E408.2060305@rabbitmq.com>
Message-ID: <5375E4A6.40101@rabbitmq.com>

On 16/05/14 11:10, Simon MacMullen wrote:
> Assuming you have not patched and built RabbitMQ yourself (which I hope
> you would have mentioned) then the most likely reason is that something
> else has installed a different version of cowboy in a system-wide
> location (probably /usr/lib/erlang/lib on Ubuntu). Is that what's happened?

And indeed I now see that Ubuntu ships a packaging of Cowboy which does 
exactly that:

http://packages.ubuntu.com/trusty/amd64/erlang-cowboy/filelist

I wish they wouldn't do that, especially for a fast-moving API like 
Cowboy...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From rao.yongquan at zte.com.cn  Fri May 16 09:31:23 2014
From: rao.yongquan at zte.com.cn (rao.yongquan at zte.com.cn)
Date: Fri, 16 May 2014 16:31:23 +0800
Subject: [rabbitmq-discuss] Ask for help about rabbitmq in Java coding.
Message-ID: <OF4052E304.9C8E7049-ON48257CDA.002BCF8A-48257CDA.002EDD8A@zte.com.cn>

Dear Sir/Madam, 

I am writing to ask a question about how to use rabbitmq library properly 
in Java coding.

The question is 

when I set the parameter of the method 'ConnectionFactory.setHost' with 
the true local ipaddress like '10.47.207.33' instead of the string 
'localhost',

failure emerges as 'ACCESS_REFUSED - Login was refused using 
authentication mechanism PLAIN. For details see the broker logfile.' 

when I try to call the 'ConnectionFactory.newConnection()'.


I have tried to find the answer from the internet and the community yet 
unfortunately failed. The following is my measure and I think it is close 
to the fact. 

Please help me amend it and let it work:

Background:

I have installed rabbitmq into "C:\Program Files\RabbitMQ 
Server\rabbitmq_server-3.3.1" and I have found a config example at 

"C:\Program Files\RabbitMQ 
Server\rabbitmq_server-3.3.1\etc\rabbitmq.config.example". 


Step:

1. Create a file in the directory "C:\Program Files\RabbitMQ 
Server\rabbitmq_server-3.3.1\etc\" and name it with 'rabbitmq.config';

2. Open this new file, write '[{rabbit, [{loopback_users, []}]}].', and 
save it;

3. Add an environment variable (system variable), name it with '
RABBITMQ_CONFIG_FILE' and set value with 'C:\Program Files\RabbitMQ 
Server\rabbitmq_server-3.3.1\etc\rabbitmq';

4. Stop the service 'RabbitMQ' and Run it again.

After all the steps above, the problem still exists. 


I look forward to receiving answer from you.

Your sincerely, 

Shrek 
--------------------------------------------------------
ZTE Information Security Notice: The information contained in this mail (and any attachment transmitted herewith) is privileged and confidential and is intended for the exclusive use of the addressee(s).  If you are not an intended recipient, any disclosure, reproduction, distribution or other dissemination or use of the information contained is strictly prohibited.  If you have received this mail in error, please delete it and notify us immediately.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/c7455924/attachment.html>

From simon at rabbitmq.com  Fri May 16 11:54:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 11:54:17 +0100
Subject: [rabbitmq-discuss] Ask for help about rabbitmq in Java coding.
In-Reply-To: <OF4052E304.9C8E7049-ON48257CDA.002BCF8A-48257CDA.002EDD8A@zte.com.cn>
References: <OF4052E304.9C8E7049-ON48257CDA.002BCF8A-48257CDA.002EDD8A@zte.com.cn>
Message-ID: <5375EE59.5010502@rabbitmq.com>

On 16/05/14 09:31, rao.yongquan at zte.com.cn wrote:
> I have installed rabbitmq into *"C:\Program Files\RabbitMQ
> Server\rabbitmq_server-3.3.1"*and I have found a config example at
>
> *"C:\Program Files\RabbitMQ
> Server\rabbitmq_server-3.3.1\etc\rabbitmq.config.example"*.

...unfortunately that's not the right location for the real config file.

Yes, this is confusing. I think we have to change that.

Check the server logs to see which location is really being read. It 
should be in %APPDATA%\RabbitMQ\rabbitmq.config.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 16 11:55:00 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 11:55:00 +0100
Subject: [rabbitmq-discuss] auto-delete queue/exchanges and cluster
	synchronization
In-Reply-To: <CACU-xnop25AC6RD0q66=mj7sO+G3wjxC=BGqC2Ez9GSUbXJfCg@mail.gmail.com>
References: <CACU-xnpjpSPetRv4zXsBXuyQkL-8afcQRKY0SHZn8gAuxJBtrA@mail.gmail.com>
 <53722549.4030002@rabbitmq.com>
 <CACU-xnop25AC6RD0q66=mj7sO+G3wjxC=BGqC2Ez9GSUbXJfCg@mail.gmail.com>
Message-ID: <5375EE84.7040606@rabbitmq.com>

On 16/05/14 10:42, mouad ben wrote:
> On Tue, May 13, 2014 at 3:59 PM, Simon MacMullen <simon at rabbitmq.com
>     Of course, autodelete RPC queues quite possibly do not need to be HA.
>
> Well apparently my "chaos monkey" wasn't able to reproduce this problem
> when mirroring queue was enabled !? I am actually still not sure why is
> this the case !? I am probably missing something obvious !

Possibly. Of course since this is a race anyway, the timings might have 
just changed. Especially since deleting an HA queue is quite a bit 
slower than deleting a non-HA one for obvious reasons.

>         But in the same time if a node of the cluster go down the Queue
>         consumer
>         that are created in this node will be deleted, the Queues with
>         auto-delete will end up being deleted too and the same thing
>         with the
>         exchanges bounded to them which also have auto-delete, all of
>         this will
>         be done **eventually** in all RabbitMQ nodes that are still up.
>
>         So in detail from neutron side we have:
>
>         N1. Connect to node 2.
>         N2. Create Exchange X.
>         N3. Create Queue Q.
>         N4. Create Binding from Q to X.
>
>           From cluster side we have:
>
>         R1. Delete consumer.
>         R2. Delete Queue Q (Binding is deleted explicitly).
>         R3. Delete Exchange X.
>
>         This actually can lead to a race condition that will result of N4
>         failing with error stating that exchange doesn't exist because
>         apparently R3 action was executed after N2 and before N4.
>
>
>     That makes sense. But note that R2 and R3 are an atomic event.
>
>
> Just to be sure, you don't mean that (R2+R3) group is an atomic event !?

I'm assuming here that "Binding is deleted explicitly" is a typo for 
"Binding is deleted implicitly" - that is, you explicitly delete the 
queue, which implicitly deletes the binding and thus auto-deletes the 
exchange. If so, then yes, that's atomic.

Or does your code explicitly delete the queue and the exchange? If so, 
the exchange.delete AMQP method will be ignored since deleting a 
non-existent exchange is now a no-op.

Sorry, I probably didn't explain that very clearly the first time round. 
Hope it's clearer now.

>         But i think that this also a problem in RabbitMQ side, basically i
>         believe a more sane behavior will be for RabbitMQ to ignore **old**
>         delete if a newest exchange's declare was sent, instead of threading
>         this later as a no op.
>
>     Hmm. Newer than what? The queue delete R2 is not necessarily older
>     than then most recent exchange declare N2 in this scenario, is it?
>     In fact, isn't R2 always newer than N2?
>
> Not necessarily, I don't see why there should be any order between
> unrelated operation from client versus cluster side, when the connection
> is broken this will raise the sequence of events in both sides but who
> is faster ! in the "happy path" the order will be R1 -> R2 -> R3 -> N1
> -> N2 -> N3 -> N4, but in reality all orders are possible e.g. R1 -> N1
> -> N2 -> R2 -> N3 -> R3 -> N4, right ?

Sorry, again I was unclear. When I said "in this scenario" I meant "in 
the scenario where the breakage that you're observing occurs". Yes, 
other interleavings are of course possible :-)

> BTW when i say order, i am taking
> as reference the RabbitMQ cluster b/c operation are atomics right ?

Yes.

>     So how to solve your problem? It sounds like each thing that can
>     receive RPC replies declares an exchange, queue and binding for that
>     purpiose, with the exchange and queue not linked in to anything
>     else. Is that correct?
>
> Yes that's the main idea of how OpenStack implement RPC.
>
>     If that is so, why not only declare a queue, and have the RPC server
>     publish to that queue directly? The queue could still be
>     auto-delete, and everything would be simpler. Or is there some
>     subtlety I'm not getting?
>
> You mean by publishing to the "nameless exchanger", that sounds much
> easier, but i am not why that is not the case i need probably to ask in
> the OpenStack mailing list first.

Yes, that was what I meant.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri May 16 12:46:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 12:46:12 +0100
Subject: [rabbitmq-discuss] Consumer get blocked after all connections
 exhausted.
In-Reply-To: <CA+DFwRE+wFDj69sWSgQ2Z7jU_M0xfCS8q=srb1N6LS2g+K_0zA@mail.gmail.com>
References: <CA+DFwRE+wFDj69sWSgQ2Z7jU_M0xfCS8q=srb1N6LS2g+K_0zA@mail.gmail.com>
Message-ID: <5375FA84.7060908@rabbitmq.com>

Congratulations, you've found a bug.

The way it's meant to work is that we ensure 
file-descriptors-used-for-sockets never exceeds a certain ratio of the 
total number of file descriptors, to make sure that we always have some 
left over for file operations.

But there are some file operations (particularly around creating and 
deleting queues) which are counted as if they were sockets. So they 
block immediately when you hit the socket limit. They will tend to 
unblock as soon as you bounce off the socket limit, but if you stay 
stuck hard *at* the limit then they will not unblock.

This has been wrong since 2.7.0, and will be fixed in 3.3.2 I guess.

Cheers, Simon

On 16/05/14 02:42, Timon Wang wrote:
> It seems that Consumer will get blocked after all connections exhausted.
> Some rabbitmqctl commands such as `rabbitmqctl list_queues` and
> `rabbitmqctl list_consumers` will get stucked as well.
>
> Here is an example to demonstrate that:
> https://gist.github.com/timonwong/238f2379d1acbbd4ef0a
> After all connections are exhausted, consumer will get blocked after
> several seconds, `rabbitmqadmin list queues` will indicate that there
> was unacknowledged messages in the queue:
>
> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
> | vhost |   name    | auto_delete | consumer_utilisation | consumers |
> durable | exclusive_consumer_tag |  memory  | messages | messages_ready
> | messages_unacknowledged |       node       | policy |  state  |
> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
> | /     | test.msgs | False       | 0.105861902008       | 1         |
> True    |                        | 74966600 | 46906    | 45664
>   | 1242                    | rabbit at localhost |        | running |
> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
>
>
> I've tried Python kombu library with both pyamqp and librabbitmq as
> transport driver.
>
> Am I doing something wrong? Or is it a expected behavior?
>
> My environment
>
> Server side:
> CentOS 6.3 64bit
> RabbitMQ: 3.3.1
>
> Client side:
> CentOS 6.3 64bit
> Python 2.7.6
> Kombu 3.0.16
>
> Thanks in advance.
>
> Regards,
> Timon
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From makita at blava.net  Fri May 16 13:30:33 2014
From: makita at blava.net (makita at blava.net)
Date: Fri, 16 May 2014 05:30:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Callbacks in Perl
Message-ID: <143e79eb-9312-4cb3-8d90-c3a8e36485bd@googlegroups.com>

Hi,
i am using Net::RabbitMQ v 1.16 from cpan. The callbacks for method publish 
does not work.
How can i publish with callbacks?
Any idea?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/3f5b1663/attachment.html>

From matthias at rabbitmq.com  Fri May 16 14:48:59 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 16 May 2014 14:48:59 +0100
Subject: [rabbitmq-discuss] rabbitmq and cpp
In-Reply-To: <20140511210522.18702@web005.roc2.bluetie.com>
References: <20140511210522.18702@web005.roc2.bluetie.com>
Message-ID: <5376174B.80700@rabbitmq.com>

On 12/05/14 02:05, Full Name wrote:
> I am new to RabbitMQ and to AMQP in general. I didn't find a
> forum/mailing list for general AMQP questions. Just a forum at
> amqp.org, but that is kind of dead. I want to exchange messages
> between Java and c++ applications. The Java tutorials for rabbitmq
> were easy, but the c++ client is really hard to build.

By "c++ client" are you referring to 
https://github.com/alanxz/SimpleAmqpClient ? What specifically did you 
find hard about the build process? Alan, the author, is on this mailing 
list and I am sure he'd welcome "constructive criticism" :)

> I watched a couple of amqp videos and it is always mentioned that
> amqp is a wire protocol just like http, and that that is a big plus
> (I agree). So why is there a need for a rabbitmq cpp client and a
> Apache qpid client etc. in the first place? Why isn't there only one
> generic amqp cpp client?

Two reasons:

- there are several versions of the protocol; different clients support 
different versions

- there are many ways of exposing AMQP functionality to applications; 
different clients provide different API

Regards,

Matthias

From mklishin at gopivotal.com  Fri May 16 15:09:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 May 2014 18:09:30 +0400
Subject: [rabbitmq-discuss] Callbacks in Perl
In-Reply-To: <143e79eb-9312-4cb3-8d90-c3a8e36485bd@googlegroups.com>
References: <143e79eb-9312-4cb3-8d90-c3a8e36485bd@googlegroups.com>
Message-ID: <etPan.53761c34.6b8b4567.456d@mercurio.local>

On 16 May 2014 at 17:34:09, makita at blava.net (makita at blava.net) wrote:
> > i am using Net::RabbitMQ v 1.16 from cpan. The callbacks for  
> method publish does not work.
> How can i publish with callbacks?

This is a question for Net::RabbitMQ maintainer.?
Note that there are no callbacks for basic.publish in the protocol,
so whenever the Perl client is supposed to invoke them, it's a client-specific
feature that may be misleading.

Also, I hear that RabbitFoot
is a better maintained client:
http://search.cpan.org/~ikuta/Net-RabbitFoot-1.03/?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Fri May 16 15:14:44 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 16 May 2014 10:14:44 -0400
Subject: [rabbitmq-discuss] Force Close all Connections from Management API
Message-ID: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>

Hello -

I am using 3.1.3 rabbitmq. Do we have an option to force close all
connections from Management API in the future releases?

If we dont, can we please add this as a feature? This is an useful feature
for those who have active-active/active-standby clusters running and to
force all the connections to reconnect to another cluster.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/59239c46/attachment.html>

From mklishin at gopivotal.com  Fri May 16 15:18:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 May 2014 18:18:15 +0400
Subject: [rabbitmq-discuss] Force Close all Connections from Management
 API
In-Reply-To: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>
References: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>
Message-ID: <etPan.53761e41.643c9869.456d@mercurio.local>



On 16 May 2014 at 18:16:57, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > Do we have an option to force close all connections from Management  
> API in the future releases?

No.

> If we dont, can we please add this as a feature? This is an useful  
> feature for those who have active-active/active-standby clusters  
> running and to force all the connections to reconnect to another  
> cluster.

Simply list all connections, map the response to connection names, and close
them one by one.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri May 16 15:21:50 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 15:21:50 +0100
Subject: [rabbitmq-discuss] Force Close all Connections from Management
 API
In-Reply-To: <etPan.53761e41.643c9869.456d@mercurio.local>
References: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>
 <etPan.53761e41.643c9869.456d@mercurio.local>
Message-ID: <53761EFE.8090004@rabbitmq.com>

On 16/05/14 15:18, Michael Klishin wrote:
> Simply list all connections, map the response to connection names, and close
> them one by one.

...for example, the last example at: 
http://www.rabbitmq.com/management-cli.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From arunrao.seattle at gmail.com  Fri May 16 15:25:38 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Fri, 16 May 2014 10:25:38 -0400
Subject: [rabbitmq-discuss] Force Close all Connections from Management
	API
In-Reply-To: <53761EFE.8090004@rabbitmq.com>
References: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>
 <etPan.53761e41.643c9869.456d@mercurio.local>
 <53761EFE.8090004@rabbitmq.com>
Message-ID: <CAEJg2GDB0aujS_B-NRMCP3BRzyYUW8Yer8=Sg-3GKO8hTCAMow@mail.gmail.com>

*...for example, the last example
at: http://www.rabbitmq.com/management-cli.html
<http://www.rabbitmq.com/management-cli.html>*

I should have mentioned that this is what I am doing in 3.1.3 :)

I was checking because there is a force connection button for each
connection. It would be nice to have Force all connections under
connections tab.


On Fri, May 16, 2014 at 10:21 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 16/05/14 15:18, Michael Klishin wrote:
>
>> Simply list all connections, map the response to connection names, and
>> close
>> them one by one.
>>
>
> ...for example, the last example at: http://www.rabbitmq.com/
> management-cli.html
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/d1809e3e/attachment.html>

From mklishin at gopivotal.com  Fri May 16 15:29:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 May 2014 18:29:30 +0400
Subject: [rabbitmq-discuss] Force Close all Connections from Management
 API
In-Reply-To: <CAEJg2GDB0aujS_B-NRMCP3BRzyYUW8Yer8=Sg-3GKO8hTCAMow@mail.gmail.com>
References: <CAEJg2GABk7GDeJWWaw59rLkBVyHuGgYW=oajoun18p53WYf0qw@mail.gmail.com>
 <etPan.53761e41.643c9869.456d@mercurio.local>
 <53761EFE.8090004@rabbitmq.com>
 <CAEJg2GDB0aujS_B-NRMCP3BRzyYUW8Yer8=Sg-3GKO8hTCAMow@mail.gmail.com>
Message-ID: <etPan.537620e8.74b0dc51.456d@mercurio.local>

On 16 May 2014 at 18:27:49, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > I was checking because there is a force connection button for  
> each connection. It would be nice to have Force all connections  
> under connections tab.

In the UI, it may be worth adding. When using the API, it's a matter
of adding 1 function which some clients (Ruby, Clojure ones) already have.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Fri May 16 16:24:50 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Fri, 16 May 2014 16:24:50 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
Message-ID: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>

Hiya

I?m seeing issues with what appears to be gradual memory leaking in RabbitMQ.

We?re currently running 3.2.1 in production, but I?ve also reproduced this issue with 3.3.1.

The memory is all in the ?binary? section, which would imply it?s message bodies or similar content. gcore on the rabbitmq process, followed by strings and grep also implies it?s holding onto message bodies that it shouldn?t be.

From the admin console or rabbitmqctl report, I can?t see any cause of the message bodies being kept (i.e. there is no significant amount of queued messages).

I?ve attached the rabbitmqctl report in the hope that someone with more clues than me will be able to read the runes better and point out what may be wrong or give me any hints for how to further investigate. 

TIA
Tom


-------------- next part --------------
A non-text attachment was scrubbed...
Name: server_report.txt.gz
Type: application/x-gzip
Size: 307205 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140516/417a3502/attachment.bin>

From mklishin at gopivotal.com  Fri May 16 16:29:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 16 May 2014 19:29:22 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
Message-ID: <etPan.53762edd.6b8b4567.4cff@giove.local>

?

On May 16, 2014 at 7:26:33 PM, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > I?ve attached the rabbitmqctl report in the hope that someone  
> with more clues than me will be able to read the runes better and  
> point out what may be wrong or give me any hints for how to further  
> investigate.

The title says you suspect STOMP plugin or Federation. Are those (and management)
are the only plugins enabled? Do you publish messages over STOMP and use federation??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Fri May 16 16:35:54 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Fri, 16 May 2014 16:35:54 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.53762edd.6b8b4567.4cff@giove.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <etPan.53762edd.6b8b4567.4cff@giove.local>
Message-ID: <90FE21CB-7260-4830-8A1E-8B15636430E3@bobtfish.net>


On May 16, 2014, at 4:29 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

>  
> 
> On May 16, 2014 at 7:26:33 PM, Tomas Doran (bobtfish at bobtfish.net) wrote:
>>> I?ve attached the rabbitmqctl report in the hope that someone  
>> with more clues than me will be able to read the runes better and  
>> point out what may be wrong or give me any hints for how to further  
>> investigate.
> 
> The title says you suspect STOMP plugin or Federation. Are those (and management)
> are the only plugins enabled? Do you publish messages over STOMP and use federation? 

Correct, both of these things - I?m using mcollective a lot (this is the vast bulk of the connections and traffic to the message queue).

Messages are published via STOMP to explicit rabbitmq exchanges, and these exchanges are federated to a couple of other brokers in a star distribution.

We seem to be seeing the most/fastest leaking on the machine which gets the most connections (and disconnections) - at the rate of a few a second (see end), however machines with less clients (and less ephemeral clients) are also leaking, just at a reduced rate.


Cheers
Tom

E.g.

=INFO REPORT==== 16-May-2014::08:33:09 ===
closing STOMP connection <0.1169.2> (10.56.6.52:46849 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:09 ===
accepting STOMP connection <0.1184.2> (10.56.6.52:46850 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:09 ===
closing STOMP connection <0.1184.2> (10.56.6.52:46850 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
accepting STOMP connection <0.1202.2> (10.56.5.51:51111 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
accepting STOMP connection <0.1207.2> (10.56.5.51:51112 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
closing STOMP connection <0.1202.2> (10.56.5.51:51111 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
closing STOMP connection <0.1207.2> (10.56.5.51:51112 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
accepting STOMP connection <0.1232.2> (10.56.5.51:51113 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
accepting STOMP connection <0.1240.2> (10.56.5.51:51114 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
closing STOMP connection <0.1232.2> (10.56.5.51:51113 -> 10.56.1.15:61614)

=INFO REPORT==== 16-May-2014::08:33:11 ===
closing STOMP connection <0.1240.2> (10.56.5.51:51114 -> 10.56.1.15:61614)

From simon at rabbitmq.com  Fri May 16 17:02:49 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 May 2014 17:02:49 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
Message-ID: <537636A9.5050305@rabbitmq.com>

On 16/05/14 16:24, Tomas Doran wrote:
> I?ve attached the rabbitmqctl report in the hope that someone with
> more clues than me will be able to read the runes better and point
> out what may be wrong or give me any hints for how to further
> investigate.

That definitely looks wrong!

Initial suspicion should fall on the management database since your 
queues are all empty and there shouldn't be a lot of other state 
anywhere. What happens if you invoke:

$ rabbitmqctl eval 
'application:stop(rabbitmq_management),application:start(rabbitmq_management).'

?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From bobtfish at bobtfish.net  Fri May 16 23:09:02 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Fri, 16 May 2014 23:09:02 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <537636A9.5050305@rabbitmq.com>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
Message-ID: <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>


On May 16, 2014, at 5:02 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/05/14 16:24, Tomas Doran wrote:
>> I?ve attached the rabbitmqctl report in the hope that someone with
>> more clues than me will be able to read the runes better and point
>> out what may be wrong or give me any hints for how to further
>> investigate.
> 
> That definitely looks wrong!
> 
> Initial suspicion should fall on the management database since your queues are all empty and there shouldn't be a lot of other state anywhere. What happens if you invoke:
> 
> $ rabbitmqctl eval 'application:stop(rabbitmq_management),application:start(rabbitmq_management).?


Exactly nothing.

Testing on an instance that?s currently using 5.9Gb before I restart it:

 - Nothing logged
 - No change in memory use in the management console.

On the off chance, I also tried stopping and starting rabbitmq_federation, and similarly saw no changes.

I then restarted rabbitmq_stomp, and bingo - memory use has dropped to 225Mb (at the penalty of having bounced ~400 clients).

So I assume that this indicates the STOMP adaptor is somehow leaking memory?

Cheers
Tom



From matthias at rabbitmq.com  Fri May 16 23:40:00 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 16 May 2014 23:40:00 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
Message-ID: <537693C0.4070701@rabbitmq.com>

On 16/05/14 23:09, Tomas Doran wrote:
> I then restarted rabbitmq_stomp, and bingo - memory use has dropped
> to 225Mb (at the penalty of having bounced ~400 clients).
>
> So I assume that this indicates the STOMP adaptor is somehow leaking
> memory?

Are these connections very long-lived and publish to / consume from lots 
of queue destinations? iirc one of the Erlang processes associated with 
a stomp connection keeps a set of all queue names it has ever 
encountered so it can avoid (re)declaring queues.

Matthias.

From bobtfish at bobtfish.net  Fri May 16 23:53:53 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Fri, 16 May 2014 23:53:53 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <537693C0.4070701@rabbitmq.com>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
Message-ID: <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>


On May 16, 2014, at 11:40 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 16/05/14 23:09, Tomas Doran wrote:
>> I then restarted rabbitmq_stomp, and bingo - memory use has dropped
>> to 225Mb (at the penalty of having bounced ~400 clients).
>> 
>> So I assume that this indicates the STOMP adaptor is somehow leaking
>> memory?
> 
> Are these connections very long-lived and publish to / consume from lots of queue destinations? iirc one of the Erlang processes associated with a stomp connection keeps a set of all queue names it has ever encountered so it can avoid (re)declaring queues.


The connections are (or at least can be) very long lived. I can/will try resetting all TCP connections to the broker though (tomorrow) and see if that causes the memory use to decrease...

However I?m guessing not, as no re queues - it?s all mcollective, so there is a persistent server process that listens to client messages:

all messages to a ?broadcast? queue
messages with a specific routing key to a ?direct? queue

and replies to a specific ?replies? queue that the client uses it?s name as a routing key on.

Clients are short lived..

Cheers
Tom




From matthias at rabbitmq.com  Sat May 17 04:58:18 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 17 May 2014 04:58:18 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
Message-ID: <5376DE5A.7090900@rabbitmq.com>

On 16/05/14 23:53, Tomas Doran wrote:
> The connections are (or at least can be) very long lived. I can/will
> try resetting all TCP connections to the broker though (tomorrow) and
> see if that causes the memory use to decrease...
>
> However I?m guessing not, as no re queues - it?s all mcollective, so
> there is a persistent server process that listens to client
> messages:
>
> all messages to a ?broadcast? queue messages with a specific routing
> key to a ?direct? queue
>
> and replies to a specific ?replies? queue that the client uses it?s
> name as a routing key on.
>
> Clients are short lived..

Hmm. Your report shows more than 3000 exclusive, auto-delete queues. 
Does that correspond to the number of concurrent client connections?

I see the memory alarm has gone off, so connections are blocked, which 
may skew the result somewhat since such connections won't be closable. 
It would be useful to get a report from a time when rabbit is getting 
close to the memory alarm threshold but hasn't reached it yet.

The reply queues you mention above... Does a new reply queue get created 
for every connecting client, and will the server end up publishing 
(reply) messages to that queue? If so then you have exactly the scenario 
I described, i.e. a stomp connections that over its lifetime publishes 
to an increasing number of queues.

Matthias.

From mklishin at gopivotal.com  Sat May 17 05:19:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 17 May 2014 08:19:38 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <537693C0.4070701@rabbitmq.com>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
Message-ID: <etPan.5376e373.6b8b4567.5891@mercurio.local>

?On 17 May 2014 at 02:41:16, Matthias Radestock (matthias at rabbitmq.com) wrote:
> > iirc one of the Erlang processes associated with
> a stomp connection keeps a set of all queue names it has ever
> encountered so it can avoid (re)declaring queues

This is correct. There needs to be a way to distinguish one-off
reply queues so that those are always declared (and not tracked
with the rest of the queues).
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sat May 17 05:28:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 17 May 2014 08:28:46 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
Message-ID: <etPan.5376e598.643c9869.5891@mercurio.local>

?On 17 May 2014 at 02:55:13, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > However I?m guessing not, as no re queues - it?s all mcollective,  
> so there is a persistent server process that listens to client  
> messages:
>  
> all messages to a ?broadcast? queue
> messages with a specific routing key to a ?direct? queue
>  
> and replies to a specific ?replies? queue that the client uses  
> it?s name as a routing key on.

Tomas,

We are not mcollective experts. Can you please post a code snippet
(in any language) that demonstrates what exactly mcollective does for request/reply
over STOMP?

This would be a great way for us to actually reproduce the problem.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From npetrace at gmail.com  Sun May 18 00:40:19 2014
From: npetrace at gmail.com (scguy)
Date: Sat, 17 May 2014 16:40:19 -0700 (PDT)
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
Message-ID: <1400370019523-35631.post@n5.nabble.com>

Question...I'm trying to use the RabbitMQ JMS client with an existing JMS
client application.  

I have written a sample java program, and am referencing a .bindings file
(below).  I have the following plugins installed on my RabbitMQ server (this
is on Windows):

C:\dev\rabbitmq330\rabbit\sbin>rabbitmq-plugins list
[e] amqp_client                       3.3.0
[ ] cowboy                            0.5.0-rmq3.3.0-git4b93c2d
[ ] eldap                             3.3.0-gite309de4
[e] mochiweb                          2.7.0-rmq3.3.0-git680dba8
[ ] rabbitmq_amqp1_0                  3.3.0
[ ] rabbitmq_auth_backend_ldap        3.3.0
[ ] rabbitmq_auth_mechanism_ssl       3.3.0
[ ] rabbitmq_consistent_hash_exchange 3.3.0
[ ] rabbitmq_federation               3.3.0
[ ] rabbitmq_federation_management    3.3.0
[E] rabbitmq_jms_topic_exchange       1.2.0-rmq3.3.0
[e] rabbitmq_jsonrpc                  3.3.x-24fb08eb
[E] rabbitmq_jsonrpc_channel          3.3.x-40bdb08c
[E] rabbitmq_management               3.3.0
[e] rabbitmq_management_agent         3.3.0
[E] rabbitmq_management_visualiser    3.3.0
[ ] rabbitmq_mqtt                     3.3.0
[ ] rabbitmq_shovel                   3.3.0
[ ] rabbitmq_shovel_management        3.3.0
[E] rabbitmq_stomp                    3.3.0
[ ] rabbitmq_tracing                  3.3.0
[e] rabbitmq_web_dispatch             3.3.0
[ ] rabbitmq_web_stomp                3.3.0
[ ] rabbitmq_web_stomp_examples       3.3.0
[e] rfc4627_jsonrpc                   3.3.x-git5e67120
[ ] sockjs                            0.3.4-rmq3.3.0-git3132eb9
[e] webmachine                        1.10.3-rmq3.3.0-gite9359c7

I have the following on my classpath:

<?xml version="1.0" encoding="UTF-8"?>
<classpath>
    <classpathentry kind="src" path="src"/>
    <classpathentry kind="con"
path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/jdk1.7.0_25"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/amqp-client-3.3.0.jar"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/fscontext.jar"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/geronimo-jms_1.1_spec-1.1.1.jar"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/providerutil.jar"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/slf4j-api-1.7.5.jar"/>
    <classpathentry kind="lib"
path="C:/dev/rabbitmq330/jms-package1.2.0/rabbitmq-jms-1.2.0.jar"/>
    <classpathentry kind="output" path="bin"/>
</classpath>

However, when I attempt to run my java program, I get the following error. 
This is where I am stuck...I'm not sure what is wrong...as the mentioned
class is in the rabbitmq-jms-1.2.0.jar file, and that jar is on my
classpath.  Any thoughts on what I have done wrong?  I need to use the JMS
client...otherwise I would just use the AMQP library.

Code snippet (the error occurs on the connection factory lookup):

Hashtable<String, String> env = new Hashtable<String, String>();
env.put(Context.INITIAL_CONTEXT_FACTORY,
"com.sun.jndi.fscontext.RefFSContextFactory");
env.put(Context.PROVIDER_URL, "file:/rabbitmq"); // directory where the
.bindings file is located
      
mContext = new InitialContext(env);

ConnectionFactory connectionFactory = (ConnectionFactory)
mContext.lookup("ConnectionFactory");
mConnection = connectionFactory.createConnection();
mConnection.start();      

.bindings file:

ConnectionFactory/ClassName=com.rabbitmq.jms.admin.RMQConnectionFactory
ConnectionFactory/FactoryName=com.rabbitmq.jms.admin.RMQObjectFactory
 
ConnectionFactory/RefAddr/0/Content=jms/ConnectionFactory
ConnectionFactory/RefAddr/0/Type=name
ConnectionFactory/RefAddr/0/Encoding=String
 
ConnectionFactory/RefAddr/1/Content=javax.jms.ConnectionFactory
ConnectionFactory/RefAddr/1/Type=type
ConnectionFactory/RefAddr/1/Encoding=String
 
ConnectionFactory/RefAddr/2/Content=com.rabbitmq.jms.admin.RMQObjectFactory
ConnectionFactory/RefAddr/2/Type=factory
ConnectionFactory/RefAddr/2/Encoding=String
 
# Change this line accordingly if the broker is not at localhost
ConnectionFactory/RefAddr/3/Content=localhost
ConnectionFactory/RefAddr/3/Type=host
ConnectionFactory/RefAddr/3/Encoding=String

#Destinations
TempQueue/ClassName=com.rabbitmq.jms.admin.RMQDestination
TempQueue/FactoryName=com.rabbitmq.jms.admin.RMQObjectFactory
 
TempQueue/RefAddr/0/Content=jms/Queue
TempQueue/RefAddr/0/Type=name
TempQueue/RefAddr/0/Encoding=String
 
TempQueue/RefAddr/1/Content=javax.jms.Queue
TempQueue/RefAddr/1/Type=type
TempQueue/RefAddr/1/Encoding=String
 
TempQueue/RefAddr/2/Content=com.rabbitmq.jms.admin.RMQObjectFactory
TempQueue/RefAddr/2/Type=factory
TempQueue/RefAddr/2/Encoding=String
 
TempQueue/RefAddr/3/Content=TempQueue
TempQueue/RefAddr/3/Type=destinationName
TempQueue/RefAddr/3/Encoding=String

C:\TEMP>java -jar rabbitmqjms.jar
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further
details.
Exception in thread "main" java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at
org.eclipse.jdt.internal.jarinjarloader.JarRsrcLoader.main(JarRsrcLoader.java:58)
Caused by: javax.naming.NamingException: Unknown class
[com.rabbitmq.jms.admin.RMQConnectionFactory]
        at
com.rabbitmq.jms.admin.RMQObjectFactory.getObjectInstance(RMQObjectFactory.java:132)
        at
javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:321)
        at com.sun.jndi.fscontext.RefFSContext.lookup(RefFSContext.java:146)
        at com.sun.jndi.fscontext.FSContext.lookup(FSContext.java:127)
        at javax.naming.InitialContext.lookup(InitialContext.java:411)
        at rabbitMQJMSTestDriver.<init>(rabbitMQJMSTestDriver.java:31)
        at rabbitMQJMSTestDriver.main(rabbitMQJMSTestDriver.java:107)
        ... 5 more



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Jonathank at mdg.co.il  Sun May 18 15:26:56 2014
From: Jonathank at mdg.co.il (Jonathan Kallner)
Date: Sun, 18 May 2014 14:26:56 +0000
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
In-Reply-To: <CANOx8N=+hMBRTJcTQk3v5pvGkgRE0Hn+1AyFYBuLEqS9dttoVA@mail.gmail.com>
References: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
 <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>
 <DA8A146FF3AF624BA2F5C9CE16E8882B35C02D@SRVMBOX.mdg.co.il>
 <CANOx8N=+hMBRTJcTQk3v5pvGkgRE0Hn+1AyFYBuLEqS9dttoVA@mail.gmail.com>
Message-ID: <DA8A146FF3AF624BA2F5C9CE16E8882B35D58C@SRVMBOX.mdg.co.il>

Hi,
I tested the telnet a few times.
It works very good.
I can telnet from Redhat to win7 and vice versa. ( port23 and port 5672 also)
All firewalls,  win7 and RedHat are set as needed.


1.       Can out tell me how to set a small message between the WIN7 and Redhat ?

Just an example message.

2.       How do I configure an exchange ( do I need  to ?)

3.       What are all the parameters I need ?

Thanks
Jonathan

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
Sent: Thursday, May 15, 2014 8:11 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)

And you want a client to open an AMQP connection to the Rabbit broker?  Can you telnet to port 5672, the standard AMQP port? Does anything seem to be listening there?


On Thu, May 15, 2014 at 7:30 AM, Jonathan Kallner <Jonathank at mdg.co.il<mailto:Jonathank at mdg.co.il>> wrote:
The VM is reachable.
It is on the same network as the first unit.
It has a static IP address of its own.
The ping command from the win7 (first unit) to the IP of the VM
Works just fine.
The VM for that matter is just a another computer.



From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Jerry Kuch
Sent: Thursday, May 15, 2014 5:26 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)

How is networking set up for the VM?  You'll have to make sure it has an IP address that's actually reachable from any external clients that have to talk to it.


On Thu, May 15, 2014 at 7:02 AM, Jonathan Kallner <Jonathank at mdg.co.il<mailto:Jonathank at mdg.co.il>> wrote:
Hi
I'm new at RabbitMQ and I would appreciate very much your help.

I'm am working on a system with 2 machine connected.
One machine is Win7 OS and the other one is RedHat OS installed on a virtual machine.
( The host computer for the second unit is also Win7).

I managed to install on both machine RabbitMQ and the shovel plugin.
I can work with the Web-UI plugin in both computers,
And I get also a ping from the Redhat VM to the Win7.

Both computer are on the same network.
The Redhat VM has a static ip.

My question is how do I configure each computer ?

1. The Win7 is a client
2. The RedHat is a server.

I need to open a new connection between both the computers.


Thanks

Jonathan



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=WFM3QWeQPruE29iyWBiVFnG1NXFeODJxBHx8uJWGjQw%3D%0A&s=4a64f3768247534224ccb48250d0f4eaf554a0e937fcf680fbed46ad34c29cf3>


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=WFM3QWeQPruE29iyWBiVFnG1NXFeODJxBHx8uJWGjQw%3D%0A&s=4a64f3768247534224ccb48250d0f4eaf554a0e937fcf680fbed46ad34c29cf3

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140518/59956ece/attachment.html>

From jkuch at gopivotal.com  Sun May 18 15:56:36 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Sun, 18 May 2014 07:56:36 -0700
Subject: [rabbitmq-discuss] Configuration Win7 and Redhat(VM)
In-Reply-To: <DA8A146FF3AF624BA2F5C9CE16E8882B35D58C@SRVMBOX.mdg.co.il>
References: <DA8A146FF3AF624BA2F5C9CE16E8882B35BFFC@SRVMBOX.mdg.co.il>
 <CANOx8NmG2Go2QE=WcC-hG=mMJGwr9Jg+3-Nx1q0T5C1dnCOzXA@mail.gmail.com>
 <DA8A146FF3AF624BA2F5C9CE16E8882B35C02D@SRVMBOX.mdg.co.il>
 <CANOx8N=+hMBRTJcTQk3v5pvGkgRE0Hn+1AyFYBuLEqS9dttoVA@mail.gmail.com>
 <DA8A146FF3AF624BA2F5C9CE16E8882B35D58C@SRVMBOX.mdg.co.il>
Message-ID: <CANOx8Nn6encGwciJZCOicixT5iWSerF_1L4GeLxW-raZuSRu_g@mail.gmail.com>

On Sun, May 18, 2014 at 7:26 AM, Jonathan Kallner <Jonathank at mdg.co.il>wrote:

>  1.       Can out tell me how to set a small message between the WIN7 and
> Redhat ?
>
> Just an example message.
>
What programming language/client are you using?

>  2.       How do I configure an exchange ( do I need  to ?)
>
For test purposes you could publish to the default exchange, which always
exists, and whose name is the empty string, "".  Every queue created will
be automatically bound to that exchange with the queue's name used as its
binding key.  That's often a good test.  It's essentially the first example
at:

http://www.rabbitmq.com/getstarted.html

where such a task and several others are explained and demonstrated in
Python, Java, Ruby, PHP and C#.

>  3.       What are all the parameters I need ?
>
It depends on what you want to do.  The publish to default exchange
scenario is probably the simplest way to sanity check things.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140518/545f78e9/attachment.html>

From greg.poirier at opower.com  Sun May 18 19:55:39 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Sun, 18 May 2014 11:55:39 -0700
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
Message-ID: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>

I mentioned this on Twitter and a couple of people have requested that I
bring this up on the mailing list.

It seems to be a given that RabbitMQ was not designed for the batch
processing use case (i.e. using RabbitMQ as a buffer between large serial
steps). We have a system in place that attempts to do just that, however.

I have been working with the developers of the software involved in an
attempt to help them redesign around a more ideal use of RabbitMQ (or to
help them move to a different bus altogether -- database or something like
kafka) and some of them have been able to simply operate in smaller batch
sizes (thus keeping their queues relatively small).

However, I cannot stem the tide of improper RabbitMQ use.

When things go poorly, millions of messages end up in the queues.

In 3.1.x we saw this regularly cause our clusters to partition.

In 3.1.x and 3.2.x when we would delete large queues (5+ million messages
enqueued), this would cause the cluster to become unresponsive, run out of
memory, and then crash.

During the 3.1 -> 3.2 upgrade, we had to completely rebuild our clusters.
When 3.2 came up, it soon crashed.

In the most recent upgrade, we saw a 3.2.3 cluster in our dev environment
crash. I performed an opportunistic upgrade to 3.3.1, because hey...
downtime already, so let's see if 3.3.1 addresses some of the issues we've
been seeing.

https://gist.github.com/grepory/384410ac90186ed0ce2a

After the upgrade, 3.3.1 would not startup at all. I removed
/var/lib/rabbitmq/mnesia on all of the nodes and brought RabbitMQ back up.

3.3.1 has been up and running alright so far, but we haven't done another
end-to-end test in our development environment in a while. One of these
tests can lead to at least a million messages in the queue over a period of
time on average.

So, I guess my question is:

If I know that I have people using RabbitMQ like this, and there is nothing
I can do to change that fact... what do I do?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140518/071d73df/attachment.html>

From michael.laing at nytimes.com  Mon May 19 00:50:28 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sun, 18 May 2014 19:50:28 -0400
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
Message-ID: <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>

I'll respond inline w our experience:

On Sun, May 18, 2014 at 2:55 PM, Greg Poirier <greg.poirier at opower.com>wrote:

> I mentioned this on Twitter and a couple of people have requested that I
> bring this up on the mailing list.
>
> It seems to be a given that RabbitMQ was not designed for the batch
> processing use case (i.e. using RabbitMQ as a buffer between large serial
> steps). We have a system in place that attempts to do just that, however.
>

It is not a 'given' as far as we are concerned. We have some processes that
result in a million or more messages being queued within a minute or so.
These messages are processed over the ensuing several minutes (for
'dismissals' of news items from individual devices) to several hours (for
lower-priority individualized  'offers'). This is the new 'batch'.


>
> I have been working with the developers of the software involved in an
> attempt to help them redesign around a more ideal use of RabbitMQ (or to
> help them move to a different bus altogether -- database or something like
> kafka) and some of them have been able to simply operate in smaller batch
> sizes (thus keeping their queues relatively small).
>

We put large message bodies in S3 and pass them by reference. We never use
RabbitMQ persistence and compensate for that with replication. For 'real'
persistence we use Cassandra. Most importantly, none of our internal users
know this, as we provide them with an abstracted interface.


>
> However, I cannot stem the tide of improper RabbitMQ use.
>

We try to make it easier to use us than not. We work hard to be the most
reliable, fastest, most scalable, most flexible and cheapest component of
our customers technology mix.


>
> When things go poorly, millions of messages end up in the queues.
>

We target zero length queues. If they grow unexpectedly we: 1) autoscale,
2) shift load, 3) start new regions - usually all those. Then we diagnose.


>
> In 3.1.x we saw this regularly cause our clusters to partition.
>

We have never had a partition in production because we always overprovision
RabbitMQ so it can maintain cluster communications. We basically avoid disk
IO due to the risk of IO wait interfering w the cluster heartbeat.


>
> In 3.1.x and 3.2.x when we would delete large queues (5+ million messages
> enqueued), this would cause the cluster to become unresponsive, run out of
> memory, and then crash.
>

When we have tested situations like this, we found it best to just wipe out
the cluster and restart. Before doing this, we shift the load to other
regions operating in parallel.


>
> During the 3.1 -> 3.2 upgrade, we had to completely rebuild our clusters.
> When 3.2 came up, it soon crashed.
>

We have not had that problem.


>
> In the most recent upgrade, we saw a 3.2.3 cluster in our dev environment
> crash. I performed an opportunistic upgrade to 3.3.1, because hey...
> downtime already, so let's see if 3.3.1 addresses some of the issues we've
> been seeing.
>
> https://gist.github.com/grepory/384410ac90186ed0ce2a
>
> After the upgrade, 3.3.1 would not startup at all. I removed
> /var/lib/rabbitmq/mnesia on all of the nodes and brought RabbitMQ back up.
>

We are not yet in production w 3.3.1 but 3.2.4 is running solidly in stage
and we will upgrade stage to 3.3.1 this coming week.


>
> 3.3.1 has been up and running alright so far, but we haven't done another
> end-to-end test in our development environment in a while. One of these
> tests can lead to at least a million messages in the queue over a period of
> time on average.
>

A million is not that many - depending on size of course. As I said - our
target is 0, but really the question is: what's your rate of change? I try
to have enough 'headroom' to easily handle the surges - volumes can vary 20
to 1 depending on the news of the moment etc. If a queue builds and stays
high we add resources until it goes down and then investigate.


>
> So, I guess my question is:
>
> If I know that I have people using RabbitMQ like this, and there is
> nothing I can do to change that fact... what do I do?
>

You need enough resource. And it is good to be able to autoscale.

A specific suggestion I would make for any internal service provider is to
use an amqp proxy. We locate proxy clusters that we control in our internal
customers' computing environments. They publish to and subscribe from these
proxies. We control the shoveling/federation of the proxies to/from our
core pipelines in regions, redirecting as needed. The proxies are an
additional buffer and also allow us to 'launder' incoming messages, e.g. by
forcing persistence off.

We also track and account for every message using metadata, and can charge
back... We are cheap but not free.

Anyway, I hope this helps.

ml


>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140518/9202c7ab/attachment.html>

From timon86.wang at gmail.com  Mon May 19 02:08:50 2014
From: timon86.wang at gmail.com (Timon Wong)
Date: Mon, 19 May 2014 09:08:50 +0800
Subject: [rabbitmq-discuss] Consumer get blocked after all connections
	exhausted.
In-Reply-To: <5375FA84.7060908@rabbitmq.com>
References: <CA+DFwRE+wFDj69sWSgQ2Z7jU_M0xfCS8q=srb1N6LS2g+K_0zA@mail.gmail.com>
 <5375FA84.7060908@rabbitmq.com>
Message-ID: <CA+DFwREK45AhswfAe65w1UkPsCmCvNF1seLs0S7WTxj2m9wfiA@mail.gmail.com>

Thanks Simon, it only appears during our boundary tests, we can
survival that by increasing the open files limit for now.


Best,
Timon Wong.


On Fri, May 16, 2014 at 7:46 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Congratulations, you've found a bug.
>
> The way it's meant to work is that we ensure
> file-descriptors-used-for-sockets never exceeds a certain ratio of the total
> number of file descriptors, to make sure that we always have some left over
> for file operations.
>
> But there are some file operations (particularly around creating and
> deleting queues) which are counted as if they were sockets. So they block
> immediately when you hit the socket limit. They will tend to unblock as soon
> as you bounce off the socket limit, but if you stay stuck hard *at* the
> limit then they will not unblock.
>
> This has been wrong since 2.7.0, and will be fixed in 3.3.2 I guess.
>
> Cheers, Simon
>
>
> On 16/05/14 02:42, Timon Wang wrote:
>>
>> It seems that Consumer will get blocked after all connections exhausted.
>> Some rabbitmqctl commands such as `rabbitmqctl list_queues` and
>> `rabbitmqctl list_consumers` will get stucked as well.
>>
>> Here is an example to demonstrate that:
>> https://gist.github.com/timonwong/238f2379d1acbbd4ef0a
>> After all connections are exhausted, consumer will get blocked after
>> several seconds, `rabbitmqadmin list queues` will indicate that there
>> was unacknowledged messages in the queue:
>>
>>
>> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
>> | vhost |   name    | auto_delete | consumer_utilisation | consumers |
>> durable | exclusive_consumer_tag |  memory  | messages | messages_ready
>> | messages_unacknowledged |       node       | policy |  state  |
>>
>> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
>> | /     | test.msgs | False       | 0.105861902008       | 1         |
>> True    |                        | 74966600 | 46906    | 45664
>>   | 1242                    | rabbit at localhost |        | running |
>>
>> +-------+-----------+-------------+----------------------+-----------+---------+------------------------+----------+----------+----------------+-------------------------+------------------+--------+---------+
>>
>>
>> I've tried Python kombu library with both pyamqp and librabbitmq as
>> transport driver.
>>
>> Am I doing something wrong? Or is it a expected behavior?
>>
>> My environment
>>
>> Server side:
>> CentOS 6.3 64bit
>> RabbitMQ: 3.3.1
>>
>> Client side:
>> CentOS 6.3 64bit
>> Python 2.7.6
>> Kombu 3.0.16
>>
>> Thanks in advance.
>>
>> Regards,
>> Timon
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal

From kurtrips at gmail.com  Sat May 17 22:45:00 2014
From: kurtrips at gmail.com (Aiman Ashraf)
Date: Sat, 17 May 2014 14:45:00 -0700 (PDT)
Subject: [rabbitmq-discuss] using autorecovery in case of broken connection
Message-ID: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>

I am trying to use the autorecovery feature in case connection breaks.
I have 2 problems:

1. The autorecovery code seemingly completely ignores the 
networkRecoveryInterval. In my log file, for the 1 minute that the 
connection is broken, the file grows to 1.5 GB. The following error is 
constantly repeated.

> Caught an exception during connection recovery!
>
> java.net.SocketException: Network is unreachable
>
> at java.net.PlainSocketImpl.socketConnect(Native Method)
>
> at 
>> java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
>
> at 
>> java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
>
> at 
>> java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
>
> at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391)
>
> at java.net.Socket.connect(Socket.java:579)
>
> at 
>> com.rabbitmq.client.impl.FrameHandlerFactory.create(FrameHandlerFactory.java:32)
>
> at 
>> com.rabbitmq.client.impl.recovery.RecoveryAwareAMQConnectionFactory.newConnection(RecoveryAwareAMQConnectionFactory.java:34)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.recoverConnection(AutorecoveringConnection.java:388)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.beginAutomaticRecovery(AutorecoveringConnection.java:360)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.access$000(AutorecoveringConnection.java:48)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection$1.shutdownCompleted(AutorecoveringConnection.java:345)
>
> at 
>> com.rabbitmq.client.impl.ShutdownNotifierComponent.notifyListeners(ShutdownNotifierComponent.java:75)
>
> at 
>> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:572)
>
> at java.lang.Thread.run(Thread.java:722)
>
>
>
 2. Finally when I do switch my router on, the network recovery does not 
work. I get this in my log file.

> Caught an exception when recovering topology Caught an exception while 
>> recovering queue 8923yrbk
>
> com.rabbitmq.client.TopologyRecoveryException: Caught an exception while 
>> recovering queue 8923yrbk
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.recoverQueues(AutorecoveringConnection.java:459)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.recoverEntities(AutorecoveringConnection.java:424)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.beginAutomaticRecovery(AutorecoveringConnection.java:365)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.access$000(AutorecoveringConnection.java:48)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection$1.shutdownCompleted(AutorecoveringConnection.java:345)
>
> at 
>> com.rabbitmq.client.impl.ShutdownNotifierComponent.notifyListeners(ShutdownNotifierComponent.java:75)
>
> at 
>> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:572)
>
> at java.lang.Thread.run(Thread.java:722)
>
> Caused by: com.rabbitmq.client.AlreadyClosedException: connection is 
>> already closed due to connection error; cause: 
>> com.rabbitmq.client.MissedHeartbeatException: Heartbeat missing with 
>> heartbeat = 45 seconds
>
> at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)
>
> at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)
>
> at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)
>
> at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
>
> at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:779)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringChannel.queueDeclare(AutorecoveringChannel.java:230)
>
> at 
>> com.rabbitmq.client.impl.recovery.RecordedQueue.recover(RecordedQueue.java:36)
>
> at 
>> com.rabbitmq.client.impl.recovery.AutorecoveringConnection.recoverQueues(AutorecoveringConnection.java:448)
>
> ... 7 more
>
>
>
Here is my rather simple consumer side code. Note that I write all the code 
in a new Thread because I don't want my constructor to block.

        private ConnectionFactory factory = null;

private Connection connection = null;

private Channel channel = null;

 private PaymentInfoFromGlobalServerConsumer() {

    new Thread(new Runnable() {

     public void run() {

    factory = new ConnectionFactory();

    try {

factory.setUri(amqpServerUrl);

factory.setAutomaticRecoveryEnabled(true);

factory.setNetworkRecoveryInterval(30000); // In case of broken connection, 
> try again every 30 seconds (hope this is correct understanding)

factory.setRequestedHeartbeat(45); //Keep sending the heartbeat every 45 
> seconds to prevent any routers from considering the connection stale.

} catch (KeyManagementException | NoSuchAlgorithmException | 
> URISyntaxException e) {

//Will never happen if configured properly

logger.error(e);

return;

}

    

     try {

    connection = factory.newConnection();

    channel = connection.createChannel();

//Create a durable queue (if not already present)

channel.queueDeclare(merchantId, true, false, false, null);

    

     QueueingConsumer consumer = new QueueingConsumer(channel);

    channel.basicConsume(merchantId, false, consumer);

    

while (true) {

    QueueingConsumer.Delivery delivery = consumer.nextDelivery();

    String billId = new String(delivery.getBody());

    //TODO - Redeliveries are possible as per design

    System.out.println(" [x] Received '" + billId + "'");

    System.out.println(" [x] Done" );

    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);

    } 

     } catch (IOException | ConsumerCancelledException | 
> InterruptedException e) {

     e.printStackTrace();

     logger.error(e);

} catch (ShutdownSignalException e) {

System.out.println(e.isInitiatedByApplication() + " " + e.isHardError());

} finally {

close();

}

} 

}).start();

}

 public void close() {

try {

if (channel != null) channel.close();

} catch (IOException | AlreadyClosedException e) {

//Cannot do anything now

}

try {

if (connection != null) connection.close();

} catch (IOException | AlreadyClosedException e) {

//Cannot do anything now

}

}

 


I am a newbie to amqp, so any help is appreciated. Thanks 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140517/372291a0/attachment.html>

From bs.stack at gmail.com  Mon May 19 09:06:11 2014
From: bs.stack at gmail.com (Billy Stack)
Date: Mon, 19 May 2014 01:06:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Monitoring delivery of async messages
Message-ID: <fae6b5c6-a7db-4a78-affb-7a3b99792d83@googlegroups.com>

All,

I have a question in relation to monitoring of async messages.

We have a "web application" where performance in very important, where 
rabbitmq messages are published to the broker.
Due to the importance of performance, we do not have any "acking" going on 
- so all messages are effectively "fire and forget"

We have a "reporting application" that subscribes to the messages and 
creates reports.
The problem is that these reports are also critical - i.e. we cannot afford 
to have messages that go missing/get dropped etc

So the question I have is how do we go about monitoring the all message 
data is in the reporting application i.e. what do people usually do in a 
scenario like this?

We were thinking of writing a database script that looks at the database of 
the "web application" and "reporting application" and compares results - 
but this certainly does not feel right!
Should we monitor at all?

Any help appreciated.

Billy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/9bf46053/attachment.html>

From mklishin at gopivotal.com  Mon May 19 11:06:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 14:06:00 +0400
Subject: [rabbitmq-discuss] using autorecovery in case of broken
 connection
In-Reply-To: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>
References: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>
Message-ID: <etPan.5379d7a6.6b8b4567.784c@mercurio.local>

On 19 May 2014 at 13:06:33, Aiman Ashraf (kurtrips at gmail.com) wrote:
> > 1. The autorecovery code seemingly completely ignores the  
> networkRecoveryInterval. In my log file, for the 1 minute that  
> the connection is broken, the file grows to 1.5 GB. The following  
> error is constantly repeated.
> > > Caught an exception during connection recovery!
> > > java.net.SocketException: Network is unreachable

It's true that network recovery interval is currently used

?* Before attempting the recovery
?* Between recovery attempts that throw?ConnectException

Perhaps it should be the case for SocketExceptions (and, by extension, IOExceptions).

> >
>  
> 2. Finally when I do switch my router on, the network recovery  
> does not work. I get this in my log file.
> > > Caught an exception when recovering topology Caught an exception  
> while recovering queue 8923yrbk

Unfortunately, it's not possible to tell what may be going on from this message.

Define a custom exception handler that overrides?handleConnectionRecoveryException
and inspects the cause. Also, see what may be in RabbitMQ log.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 19 11:09:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 14:09:24 +0400
Subject: [rabbitmq-discuss] Monitoring delivery of async messages
In-Reply-To: <fae6b5c6-a7db-4a78-affb-7a3b99792d83@googlegroups.com>
References: <fae6b5c6-a7db-4a78-affb-7a3b99792d83@googlegroups.com>
Message-ID: <etPan.5379d86f.643c9869.784c@mercurio.local>

On 19 May 2014 at 13:08:33, Billy Stack (bs.stack at gmail.com) wrote:
> > Due to the importance of performance, we do not have any "acking"  
> going on - so all messages are effectively "fire and forget"

> We have a "reporting application" that subscribes to the messages  
> and creates reports.
> The problem is that these reports are also critical - i.e. we cannot  
> afford to have messages that go missing/get dropped etc
>  
> So the question I have is how do we go about monitoring the all message  
> data is in the reporting application i.e. what do people usually  
> do in a scenario like this?

Use publisher confirms and delivery confirmation. Both (primarily the former)
will have performance effect but that's just how things are in distributed
systems: throughput is at odds with confirmations, which is the only way
to know that the peer got your message.

> We were thinking of writing a database script that looks at the  
> database of the "web application" and "reporting application"  
> and compares results - but this certainly does not feel right!  

If you know how to perform repairs when the two get out of sync, this is not unreasonable.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arinto at gmail.com  Mon May 19 11:53:47 2014
From: arinto at gmail.com (Arinto Murdopo)
Date: Mon, 19 May 2014 03:53:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client with different version compared to
	RabbitMQ server
Message-ID: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>

Hi all, 

Our group is currently using RabbitMQ server 3.2.3 with Erlang R24B04.
Is it safe to use Java AMQP client library version 3.3.1? I'm interested to 
use the automatic recovery feature and I notice it is not available in 
client library version 3.2.3.

Actually I'm currently doing some testing on this configuration and so far 
it works fine. What I have done so far is to create direct exchange, create 
persistent queue and publish some messages while using "publisher confirms".

Thank you and best regards, 

Arinto

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/75909012/attachment.html>

From mklishin at gopivotal.com  Mon May 19 11:57:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 14:57:50 +0400
Subject: [rabbitmq-discuss] Java client with different version compared
 to RabbitMQ server
In-Reply-To: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>
References: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>
Message-ID: <etPan.5379e3b0.74b0dc51.784c@mercurio.local>

On 19 May 2014 at 14:56:02, Arinto Murdopo (arinto at gmail.com) wrote:
> > Our group is currently using RabbitMQ server 3.2.3 with Erlang  
> R24B04.
> Is it safe to use Java AMQP client library version 3.3.1?

Yes. RabbitMQ Java client currently ?requires RabbitMQ server 2.0+.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 19 11:57:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 14:57:50 +0400
Subject: [rabbitmq-discuss] Java client with different version compared
 to RabbitMQ server
In-Reply-To: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>
References: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>
Message-ID: <etPan.5379e3cc.2ae8944a.784c@mercurio.local>

On 19 May 2014 at 14:56:02, Arinto Murdopo (arinto at gmail.com) wrote:
> > Our group is currently using RabbitMQ server 3.2.3 with Erlang  
> R24B04.
> Is it safe to use Java AMQP client library version 3.3.1?

Yes. RabbitMQ Java client currently ?requires RabbitMQ server 2.0+.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 19 12:17:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 15:17:04 +0400
Subject: [rabbitmq-discuss] using autorecovery in case of broken
 connection
In-Reply-To: <CAFfG3R-adaWDQbN+YoaBMGE7pwVPfLnq8=zLvemJ5QXcu3nESw@mail.gmail.com>
References: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>
 <etPan.5379d7a6.6b8b4567.784c@mercurio.local>
 <CAFfG3R-adaWDQbN+YoaBMGE7pwVPfLnq8=zLvemJ5QXcu3nESw@mail.gmail.com>
Message-ID: <etPan.5379e849.46e87ccd.784c@mercurio.local>

On 19 May 2014 at 15:13:15, Aiman Ashraf (kurtrips at gmail.com) wrote:
> > Not sure if you noticed but the cause of the
> Caught an exception when recovering topology Caught an exception 
> while recovering queue 8923yrbk
> is
> Caused by: com.rabbitmq.client.AlreadyClosedException: 
> connection is already closed due to connection error; cause: 
> com.rabbitmq.client.MissedHeartbeatException: Heartbeat 
> missing with heartbeat = 45 seconds

Connection was closed due to a *missing heartbeat* .

You need to adapt heartbeat interval to be (ideally, a few times) greater than
recovery interval.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 19 12:37:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 15:37:37 +0400
Subject: [rabbitmq-discuss] using autorecovery in case of broken
 connection
In-Reply-To: <etPan.5379d7a6.6b8b4567.784c@mercurio.local>
References: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>
 <etPan.5379d7a6.6b8b4567.784c@mercurio.local>
Message-ID: <etPan.5379ed1b.3d1b58ba.784c@mercurio.local>

On 19 May 2014 at 14:06:28, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Perhaps it should be the case for SocketExceptions (and, by  
> extension, IOExceptions).

With this change:
http://hg.rabbitmq.com/rabbitmq-java-client/rev/203001531502

network recovery interval will be respected no matter what exception is thrown.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 19 13:07:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 16:07:30 +0400
Subject: [rabbitmq-discuss] loop_forever() from paho-mqtt python client
 prevents rabbitmq from stopping
In-Reply-To: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
References: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
Message-ID: <etPan.5379f41f.507ed7ab.784c@mercurio.local>



On 16 May 2014 at 11:35:01, Sok Ann Yap (sokann at gmail.com) wrote:
> > Steps to reproduce (on debian/ubuntu):
>  
> 1. Install rabbitmq-server version 3.3.1 following
> http://www.rabbitmq.com/install-debian.html
> 2. As root, run `rabbitmq-plugins enable rabbitmq_mqtt;
> /etc/init.d/rabbitmq-server restart` to enable the mqtt plugin  
> 3. As root, run `easy_install paho-mqtt` to install paho-mqtt  
> version 0.9
> 4. Copy the sample code from the "Getting Started" section of  
> https://pypi.python.org/pypi/paho-mqtt/0.9 as mqtt_test.py,  
> replace
> iot.eclipse.org(http://iot.eclipse.org) with localhost  
> 5. Run `python mqtt_test.py`, which will print "Connected with  
> result
> code 0" and then loop forever
> 6. As root, run `/etc/init.d/rabbitmq-server stop`

Thanks for reporting. This looks like an MQTT plugin issue, investigating.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mcintoshj at gmail.com  Mon May 19 15:21:02 2014
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Mon, 19 May 2014 09:21:02 -0500
Subject: [rabbitmq-discuss] Monitoring delivery of async messages
In-Reply-To: <etPan.5379d86f.643c9869.784c@mercurio.local>
References: <fae6b5c6-a7db-4a78-affb-7a3b99792d83@googlegroups.com>
 <etPan.5379d86f.643c9869.784c@mercurio.local>
Message-ID: <548B71F2-A907-4D85-A223-326B60D12E6B@gmail.com>

We publish a message back after processing a batch to say how much data was processes for that batch.  Then the original publisher consumes those messages and republishes anything that was missed.  It's not quite a two phased commit but it works for us,
Jason

Sent from my iPhone

> On May 19, 2014, at 5:09 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
> 
> On 19 May 2014 at 13:08:33, Billy Stack (bs.stack at gmail.com) wrote:
>>> Due to the importance of performance, we do not have any "acking"  
>> going on - so all messages are effectively "fire and forget"
> 
>> We have a "reporting application" that subscribes to the messages  
>> and creates reports.
>> The problem is that these reports are also critical - i.e. we cannot  
>> afford to have messages that go missing/get dropped etc
>> 
>> So the question I have is how do we go about monitoring the all message  
>> data is in the reporting application i.e. what do people usually  
>> do in a scenario like this?
> 
> Use publisher confirms and delivery confirmation. Both (primarily the former)
> will have performance effect but that's just how things are in distributed
> systems: throughput is at odds with confirmations, which is the only way
> to know that the peer got your message.
> 
>> We were thinking of writing a database script that looks at the  
>> database of the "web application" and "reporting application"  
>> and compares results - but this certainly does not feel right!  
> 
> If you know how to perform repairs when the two get out of sync, this is not unreasonable. 
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mcintoshj at gmail.com  Mon May 19 15:29:17 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 19 May 2014 09:29:17 -0500
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <1400370019523-35631.post@n5.nabble.com>
References: <1400370019523-35631.post@n5.nabble.com>
Message-ID: <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>

Off hand, it appears that you're missing some libraries.  I'm not sure what
rabbitmqjms.jar is as I've not looked at the JMS stuff personally but
you're missing whatever library provides "com.rabbitmq.jms.admin.
RMQConnectionFactory".  What's interesting is that it's in the same class
structure as the instance loader (the RMQObjectFactory) - so I'd guess
there could be an issue someplace with URL class loading or similar.  If
the ObjectFactory and ConnectionFactory are with-in the same jar you
shouldn't be getting this, but if they're in a different jar file you'll
very likely have issues.  Java doesn't support loading JAR files from
with-in a JAR file for dependencies.

Jason


On Sat, May 17, 2014 at 6:40 PM, scguy <npetrace at gmail.com> wrote:

> Question...I'm trying to use the RabbitMQ JMS client with an existing JMS
> client application.
>
> I have written a sample java program, and am referencing a .bindings file
> (below).  I have the following plugins installed on my RabbitMQ server
> (this
> is on Windows):
>
> C:\dev\rabbitmq330\rabbit\sbin>rabbitmq-plugins list
> [e] amqp_client                       3.3.0
> [ ] cowboy                            0.5.0-rmq3.3.0-git4b93c2d
> [ ] eldap                             3.3.0-gite309de4
> [e] mochiweb                          2.7.0-rmq3.3.0-git680dba8
> [ ] rabbitmq_amqp1_0                  3.3.0
> [ ] rabbitmq_auth_backend_ldap        3.3.0
> [ ] rabbitmq_auth_mechanism_ssl       3.3.0
> [ ] rabbitmq_consistent_hash_exchange 3.3.0
> [ ] rabbitmq_federation               3.3.0
> [ ] rabbitmq_federation_management    3.3.0
> [E] rabbitmq_jms_topic_exchange       1.2.0-rmq3.3.0
> [e] rabbitmq_jsonrpc                  3.3.x-24fb08eb
> [E] rabbitmq_jsonrpc_channel          3.3.x-40bdb08c
> [E] rabbitmq_management               3.3.0
> [e] rabbitmq_management_agent         3.3.0
> [E] rabbitmq_management_visualiser    3.3.0
> [ ] rabbitmq_mqtt                     3.3.0
> [ ] rabbitmq_shovel                   3.3.0
> [ ] rabbitmq_shovel_management        3.3.0
> [E] rabbitmq_stomp                    3.3.0
> [ ] rabbitmq_tracing                  3.3.0
> [e] rabbitmq_web_dispatch             3.3.0
> [ ] rabbitmq_web_stomp                3.3.0
> [ ] rabbitmq_web_stomp_examples       3.3.0
> [e] rfc4627_jsonrpc                   3.3.x-git5e67120
> [ ] sockjs                            0.3.4-rmq3.3.0-git3132eb9
> [e] webmachine                        1.10.3-rmq3.3.0-gite9359c7
>
> I have the following on my classpath:
>
> <?xml version="1.0" encoding="UTF-8"?>
> <classpath>
>     <classpathentry kind="src" path="src"/>
>     <classpathentry kind="con"
>
> path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/jdk1.7.0_25"/>
>     <classpathentry kind="lib"
>
> path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/amqp-client-3.3.0.jar"/>
>     <classpathentry kind="lib"
> path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/fscontext.jar"/>
>     <classpathentry kind="lib"
>
> path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/geronimo-jms_1.1_spec-1.1.1.jar"/>
>     <classpathentry kind="lib"
> path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/providerutil.jar"/>
>     <classpathentry kind="lib"
>
> path="C:/dev/rabbitmq330/jms-package1.2.0/dependencies/slf4j-api-1.7.5.jar"/>
>     <classpathentry kind="lib"
> path="C:/dev/rabbitmq330/jms-package1.2.0/rabbitmq-jms-1.2.0.jar"/>
>     <classpathentry kind="output" path="bin"/>
> </classpath>
>
> However, when I attempt to run my java program, I get the following error.
> This is where I am stuck...I'm not sure what is wrong...as the mentioned
> class is in the rabbitmq-jms-1.2.0.jar file, and that jar is on my
> classpath.  Any thoughts on what I have done wrong?  I need to use the JMS
> client...otherwise I would just use the AMQP library.
>
> Code snippet (the error occurs on the connection factory lookup):
>
> Hashtable<String, String> env = new Hashtable<String, String>();
> env.put(Context.INITIAL_CONTEXT_FACTORY,
> "com.sun.jndi.fscontext.RefFSContextFactory");
> env.put(Context.PROVIDER_URL, "file:/rabbitmq"); // directory where the
> .bindings file is located
>
> mContext = new InitialContext(env);
>
> ConnectionFactory connectionFactory = (ConnectionFactory)
> mContext.lookup("ConnectionFactory");
> mConnection = connectionFactory.createConnection();
> mConnection.start();
>
> .bindings file:
>
> ConnectionFactory/ClassName=com.rabbitmq.jms.admin.RMQConnectionFactory
> ConnectionFactory/FactoryName=com.rabbitmq.jms.admin.RMQObjectFactory
>
> ConnectionFactory/RefAddr/0/Content=jms/ConnectionFactory
> ConnectionFactory/RefAddr/0/Type=name
> ConnectionFactory/RefAddr/0/Encoding=String
>
> ConnectionFactory/RefAddr/1/Content=javax.jms.ConnectionFactory
> ConnectionFactory/RefAddr/1/Type=type
> ConnectionFactory/RefAddr/1/Encoding=String
>
> ConnectionFactory/RefAddr/2/Content=com.rabbitmq.jms.admin.RMQObjectFactory
> ConnectionFactory/RefAddr/2/Type=factory
> ConnectionFactory/RefAddr/2/Encoding=String
>
> # Change this line accordingly if the broker is not at localhost
> ConnectionFactory/RefAddr/3/Content=localhost
> ConnectionFactory/RefAddr/3/Type=host
> ConnectionFactory/RefAddr/3/Encoding=String
>
> #Destinations
> TempQueue/ClassName=com.rabbitmq.jms.admin.RMQDestination
> TempQueue/FactoryName=com.rabbitmq.jms.admin.RMQObjectFactory
>
> TempQueue/RefAddr/0/Content=jms/Queue
> TempQueue/RefAddr/0/Type=name
> TempQueue/RefAddr/0/Encoding=String
>
> TempQueue/RefAddr/1/Content=javax.jms.Queue
> TempQueue/RefAddr/1/Type=type
> TempQueue/RefAddr/1/Encoding=String
>
> TempQueue/RefAddr/2/Content=com.rabbitmq.jms.admin.RMQObjectFactory
> TempQueue/RefAddr/2/Type=factory
> TempQueue/RefAddr/2/Encoding=String
>
> TempQueue/RefAddr/3/Content=TempQueue
> TempQueue/RefAddr/3/Type=destinationName
> TempQueue/RefAddr/3/Encoding=String
>
> C:\TEMP>java -jar rabbitmqjms.jar
> SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
> SLF4J: Defaulting to no-operation (NOP) logger implementation
> SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further
> details.
> Exception in thread "main" java.lang.reflect.InvocationTargetException
>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>         at
>
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
>         at
>
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
>         at java.lang.reflect.Method.invoke(Method.java:606)
>         at
>
> org.eclipse.jdt.internal.jarinjarloader.JarRsrcLoader.main(JarRsrcLoader.java:58)
> Caused by: javax.naming.NamingException: Unknown class
> [com.rabbitmq.jms.admin.RMQConnectionFactory]
>         at
>
> com.rabbitmq.jms.admin.RMQObjectFactory.getObjectInstance(RMQObjectFactory.java:132)
>         at
> javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:321)
>         at
> com.sun.jndi.fscontext.RefFSContext.lookup(RefFSContext.java:146)
>         at com.sun.jndi.fscontext.FSContext.lookup(FSContext.java:127)
>         at javax.naming.InitialContext.lookup(InitialContext.java:411)
>         at rabbitMQJMSTestDriver.<init>(rabbitMQJMSTestDriver.java:31)
>         at rabbitMQJMSTestDriver.main(rabbitMQJMSTestDriver.java:107)
>         ... 5 more
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/b42441db/attachment.html>

From devangana at gmail.com  Mon May 19 15:43:53 2014
From: devangana at gmail.com (Devangana Tarafdar)
Date: Mon, 19 May 2014 09:43:53 -0500
Subject: [rabbitmq-discuss] |Spam| Queue message replication in clusters
	with mirrored queues
Message-ID: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>

Hello,

I am trying to understand how clusters with mirrored queues operate on data
(messages as well as data about queues). From the doc at
https://www.rabbitmq.com/ha.html

"All actions other than publishes go only to the master, and the master
then broadcasts the effect of the actions to the slaves. Thus clients
consuming from a mirrored queue are in fact consuming from the master." So
I understand that;

1.  There is only one node that has the queue process running. Other nodes
have enough information to start up a queue process should the master go
down.
2. Queue data for persistent queues is stored on disk on all nodes of
cluster. So persistent data is replicated.
3. Queue data that is not persistent is stored on ram on all nodes of the
cluster. So ram data is replicated.

Am I correct in the above ?

Thank you for any explanations.

Devangana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/543ebc49/attachment.html>

From simon at rabbitmq.com  Mon May 19 16:18:03 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 May 2014 16:18:03 +0100
Subject: [rabbitmq-discuss] |Spam| Queue message replication in clusters
 with mirrored queues
In-Reply-To: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>
References: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>
Message-ID: <537A20AB.3080704@rabbitmq.com>

On 19/05/2014 15:43, Devangana Tarafdar wrote:
> I am trying to understand how clusters with mirrored queues operate on
> data (messages as well as data about queues). From the doc at
> https://www.rabbitmq.com/ha.html
>
> "All actions other than publishes go only to the master, and the master
> then broadcasts the effect of the actions to the slaves. Thus clients
> consuming from a mirrored queue are in fact consuming from the master."
> So I understand that;
>
> 1.  There is only one node that has the queue process running. Other
> nodes have enough information to start up a queue process should the
> master go down.

Other nodes have a slave process that is quite a lot of the way towards 
being a queue, it maintains (almost) all the same data structures, it 
just never talks to clients.

So it depends how you look at it.

> 2. Queue data for persistent queues is stored on disk on all nodes of
> cluster. So persistent data is replicated.
> 3. Queue data that is not persistent is stored on ram on all nodes of
> the cluster. So ram data is replicated.

Replication is orthogonal to persistence really. And it doesn't really 
make sense to think of queues as "persistent" or not since durable 
queues can contain transient messages, and transient queues can page to 
disk under memory pressure...

Cheers, Simon

From devangana at gmail.com  Mon May 19 16:46:22 2014
From: devangana at gmail.com (Devangana Tarafdar)
Date: Mon, 19 May 2014 10:46:22 -0500
Subject: [rabbitmq-discuss] |Spam| Re: Queue message replication in
	clusters	with mirrored queues
In-Reply-To: <537A20AB.3080704@rabbitmq.com>
References: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>
 <537A20AB.3080704@rabbitmq.com>
Message-ID: <CAHfHLPU1+afaHD+nJYc1EgVCnvTYs-tyG4U=qc8omz7H64rS9A@mail.gmail.com>

Hello,

Thanks for the prompt reply !

For point 2, I understand your answer. My phrasing of the question was
incorrect. I suppose my question is more about the messages that are routed
to the queue.  Would other nodes in a cluster hold a copy of the message ?

Thank you for the reply,

Devangana


On Mon, May 19, 2014 at 10:18 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 19/05/2014 15:43, Devangana Tarafdar wrote:
>
>> I am trying to understand how clusters with mirrored queues operate on
>> data (messages as well as data about queues). From the doc at
>> https://www.rabbitmq.com/ha.html
>>
>> "All actions other than publishes go only to the master, and the master
>> then broadcasts the effect of the actions to the slaves. Thus clients
>> consuming from a mirrored queue are in fact consuming from the master."
>> So I understand that;
>>
>> 1.  There is only one node that has the queue process running. Other
>> nodes have enough information to start up a queue process should the
>> master go down.
>>
>
> Other nodes have a slave process that is quite a lot of the way towards
> being a queue, it maintains (almost) all the same data structures, it just
> never talks to clients.
>
> So it depends how you look at it.
>
>  2. Queue data for persistent queues is stored on disk on all nodes of
>> cluster. So persistent data is replicated.
>> 3. Queue data that is not persistent is stored on ram on all nodes of
>> the cluster. So ram data is replicated.
>>
>
> Replication is orthogonal to persistence really. And it doesn't really
> make sense to think of queues as "persistent" or not since durable queues
> can contain transient messages, and transient queues can page to disk under
> memory pressure...
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/a61f7205/attachment.html>

From simon at rabbitmq.com  Mon May 19 16:47:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 May 2014 16:47:07 +0100
Subject: [rabbitmq-discuss] |Spam| Queue message replication in clusters
 with mirrored queues
In-Reply-To: <CAHfHLPU1+afaHD+nJYc1EgVCnvTYs-tyG4U=qc8omz7H64rS9A@mail.gmail.com>
References: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>	<537A20AB.3080704@rabbitmq.com>
 <CAHfHLPU1+afaHD+nJYc1EgVCnvTYs-tyG4U=qc8omz7H64rS9A@mail.gmail.com>
Message-ID: <537A277B.4000804@rabbitmq.com>

On 19/05/2014 16:46, Devangana Tarafdar wrote:
> For point 2, I understand your answer. My phrasing of the question was
> incorrect. I suppose my question is more about the messages that are
> routed to the queue.  Would other nodes in a cluster hold a copy of the
> message ?

Yes.

Cheers, Simon

From devangana at gmail.com  Mon May 19 16:51:15 2014
From: devangana at gmail.com (Devangana Tarafdar)
Date: Mon, 19 May 2014 10:51:15 -0500
Subject: [rabbitmq-discuss] |Spam| Re: Queue message replication in
	clusters	with mirrored queues
In-Reply-To: <537A277B.4000804@rabbitmq.com>
References: <CAHfHLPUsueRPh4=u_g8NV94S5jS7C21Kpe4+YttFX4xKCZZW8A@mail.gmail.com>
 <537A20AB.3080704@rabbitmq.com>
 <CAHfHLPU1+afaHD+nJYc1EgVCnvTYs-tyG4U=qc8omz7H64rS9A@mail.gmail.com>
 <537A277B.4000804@rabbitmq.com>
Message-ID: <CAHfHLPVWDEmABNHdgWgB=GG_oumAz6G9pCu55HprpdaHEPBepw@mail.gmail.com>

Thank you again for the prompt reply !


-Devangana


On Mon, May 19, 2014 at 10:47 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 19/05/2014 16:46, Devangana Tarafdar wrote:
>
>> For point 2, I understand your answer. My phrasing of the question was
>> incorrect. I suppose my question is more about the messages that are
>> routed to the queue.  Would other nodes in a cluster hold a copy of the
>> message ?
>>
>
> Yes.
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/fe11b01d/attachment.html>

From simon at rabbitmq.com  Mon May 19 16:51:23 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 May 2014 16:51:23 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?b?562U5aSNOiBSZTogIEFzayBmb3IgaGVscCBh?=
 =?utf-8?q?bout_rabbitmq_in_Java_coding=2E?=
In-Reply-To: <OF4F0934A3.60AE8762-ON48257CDD.0002646D-48257CDD.00031642@zte.com.cn>
References: <OF4F0934A3.60AE8762-ON48257CDD.0002646D-48257CDD.00031642@zte.com.cn>
Message-ID: <537A287B.2060405@rabbitmq.com>

Please keep rabbitmq-discuss on CC.

On 19/05/2014 01:33, rao.yongquan at zte.com.cn wrote:
> Yet I am still puzzled about the setting.
>
> In your letter, you said there should be something wrong with the
> directory of the config.
>
> But I have already set the new directory as an environment variable.
>
> Doesn't it work or something wrong with the variable value?

You should be able to set it by environment variable - but it's possible 
there's something wrong with the value you've set.

> One more thing is where the log you mentioned is and how to check the
> location information in the log file ?

It should be in %APPDATA%\RabbitMQ\log. See 
http://www.rabbitmq.com/relocate.html

Cheers, Simon

>
> Look forward to hearing from you.
>
> Best wishes.
>
> Shrek.
>
>
>
>
> *Simon MacMullen <simon at rabbitmq.com>*
>
> 2014-05-16 18:54
>
> 	
> ???
> 	Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> ??
> 	rao.yongquan at zte.com.cn
> ??
> 	Re: [rabbitmq-discuss] Ask for help about rabbitmq in Java coding.
>
>
> 	
>
>
>
>
>
> On 16/05/14 09:31, rao.yongquan at zte.com.cn wrote:
>  > I have installed rabbitmq into *"C:\Program Files\RabbitMQ
>  > Server\rabbitmq_server-3.3.1"*and I have found a config example at
>  >
>  > *"C:\Program Files\RabbitMQ
>  > Server\rabbitmq_server-3.3.1\etc\rabbitmq.config.example"*.
>
> ...unfortunately that's not the right location for the real config file.
>
> Yes, this is confusing. I think we have to change that.
>
> Check the server logs to see which location is really being read. It
> should be in %APPDATA%\RabbitMQ\rabbitmq.config.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
>
> --------------------------------------------------------
> ZTE Information Security Notice: The information contained in this mail (and any attachment transmitted herewith) is privileged and confidential and is intended for the exclusive use of the addressee(s).  If you are not an intended recipient, any disclosure, reproduction, distribution or other dissemination or use of the information contained is strictly prohibited.  If you have received this mail in error, please delete it and notify us immediately.
>
>


From matthew.c.duggan at gmail.com  Mon May 19 10:11:01 2014
From: matthew.c.duggan at gmail.com (Matthew Duggan)
Date: Mon, 19 May 2014 02:11:01 -0700 (PDT)
Subject: [rabbitmq-discuss] ssl_not_started using LDAP auth backend
Message-ID: <ecf3eece-87ad-4592-9f24-4da13963410c@googlegroups.com>

Hi,

I was setting up a test instance of RabbitMQ and the first thing I tried 
was to hook it up to a simple LDAP server. I started with a very simple 
config for testing:

[
  {rabbit, [ {auth_backends, [rabbit_auth_backend_ldap]} ]}, 
  {rabbitmq_auth_backend_ldap, 
    [{user_dn_pattern, "uid=${username},ou=people,o=myorg"}, 
     {use_ssl, true}, 
     {port, 636}, 
     {log, network} ] }
]

When I tried to connect with this config I got:

LDAP network traffic: Connect: "ldap" failed {error,ssl_not_started}


Not being familiar with Erlang, it took me a long time to work out that 
"ssl_not_started" meant the SSL application inside Erlang was not started, 
because I hadn't specified any ssl ports for the main rabbit config.  The 
simplest fix was to add an ssl listner:

{rabbit,
 [
   {auth_backends, [rabbit_auth_backend_ldap]},
   {ssl_listeners, [5671]}
 ]},
...

Not sure if this is a bug - maybe the ldap plugin should also try to start 
the ssl application to be sure it's running?.  Either way, I thought I'd 
send it along so the next person has a non-zero number of ghits for this 
error.

Thanks,

- Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/90c4f583/attachment.html>

From kurtrips at gmail.com  Mon May 19 12:21:33 2014
From: kurtrips at gmail.com (Aiman Ashraf)
Date: Mon, 19 May 2014 16:51:33 +0530
Subject: [rabbitmq-discuss] using autorecovery in case of broken
	connection
In-Reply-To: <etPan.5379e849.46e87ccd.784c@mercurio.local>
References: <ab97715b-d19b-495b-bf86-1e642aeb5000@googlegroups.com>
 <etPan.5379d7a6.6b8b4567.784c@mercurio.local>
 <CAFfG3R-adaWDQbN+YoaBMGE7pwVPfLnq8=zLvemJ5QXcu3nESw@mail.gmail.com>
 <etPan.5379e849.46e87ccd.784c@mercurio.local>
Message-ID: <CAFfG3R_bohRKGiNbv0tNrTNqxSuVfBOHMAvNO_V-ZJtkjVX5pA@mail.gmail.com>

The heartbeat interval is already greater than the recovery interval,
although only 1.5 times.


On Mon, May 19, 2014 at 4:47 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 19 May 2014 at 15:13:15, Aiman Ashraf (kurtrips at gmail.com) wrote:
> > > Not sure if you noticed but the cause of the
> > Caught an exception when recovering topology Caught an exception
> > while recovering queue 8923yrbk
> > is
> > Caused by: com.rabbitmq.client.AlreadyClosedException:
> > connection is already closed due to connection error; cause:
> > com.rabbitmq.client.MissedHeartbeatException: Heartbeat
> > missing with heartbeat = 45 seconds
>
> Connection was closed due to a *missing heartbeat* .
>
> You need to adapt heartbeat interval to be (ideally, a few times) greater
> than
> recovery interval.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/6c993301/attachment.html>

From sunny.dyal at gmail.com  Mon May 19 13:38:41 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Mon, 19 May 2014 05:38:41 -0700 (PDT)
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single machine"
 explained in https://www.rabbitmq.com/clustering.html
Message-ID: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>

root at sunny-workstation:~# 
              RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/hare.log
  ######  ##        /var/log/rabbitmq/hare-sasl.log
  ##########
              Starting broker...

BOOT FAILED
===========

Error description:
   {could_not_start,rabbitmq_stomp,
       {{shutdown,
            {failed_to_start_child,'rabbit_stomp_listener_sup_:::61613',
                {shutdown,
                    {failed_to_start_child,tcp_listener,
                        
{cannot_listen,{0,0,0,0,0,0,0,0},61613,eaddrinuse}}}}},
        {rabbit_stomp,start,[normal,[]]}}}

Above error indicates that 61613 address already in use. Stomp is listening 
on 61613 port. I am exploring how to change/define stomp listener port 
while creating a new node.
Please help if somebody already know solution.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/5343c05f/attachment.html>

From fredrik.sorensson at fritidsresor.se  Mon May 19 17:06:56 2014
From: fredrik.sorensson at fritidsresor.se (=?iso-8859-1?Q?Fredrik_S=F6rensson_=28Fredrik_Sorensson/STO/Fritidsresor?= =?iso-8859-1?Q?=29?=)
Date: Mon, 19 May 2014 16:06:56 +0000
Subject: [rabbitmq-discuss] Can't reject messages to DLX unless first
	published to an exchange
Message-ID: <767b4c828e4644eebdd161c4bde01e98@STOSPMS52.nordic.tuiad.org>

Hello.

I am looking at the RabbitMQ implementations in my organization, and right now how we handle errors. I made a very simple test in Perl using Net::AMQP::RabbitMQ to reject messages, to learn how it works.

I noticed that when I put a message directly to a queue which I then rejected, the message was not backed out to  the dead letter queue, it was just silently dropped. But if I posted a message to an exchange that was bound to my queue and then rejected that message, it was backed out to my dead letter queue. The dead letter exchange was configured using arguments to the queue.

So it seems a message can only be backed out to a dead letter exchange if it at one point in time has been published to an exchange. Is this the intended behavior? Or could it be an artefact of the Perl library I'm using?

/Fredrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/ec95c537/attachment.html>

From simon at rabbitmq.com  Mon May 19 17:12:29 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 May 2014 17:12:29 +0100
Subject: [rabbitmq-discuss] Can't reject messages to DLX unless first
 published to an exchange
In-Reply-To: <767b4c828e4644eebdd161c4bde01e98@STOSPMS52.nordic.tuiad.org>
References: <767b4c828e4644eebdd161c4bde01e98@STOSPMS52.nordic.tuiad.org>
Message-ID: <537A2D6D.7020000@rabbitmq.com>

On 19/05/2014 17:06, Fredrik S?rensson (Fredrik 
Sorensson/STO/Fritidsresor) wrote:
> So it seems a message can only be backed out to a dead letter exchange
> if it at one point in time has been published to an exchange. Is this
> the intended behavior? Or could it be an artefact of the Perl library
> I?m using?

No, that's not how it's meant to work. But I doubt there's a bug in this 
area.

Probably the problem that you have is that when the message is dead 
lettered it is published to the DLX with its original routing key - I 
would guess that when publishing via an exchange you are using a routing 
key that is also bound on the DLX. Does that sound plausible?

If this is the problem, you might find that the 
x-dead-letter-routing-key argument is the solution.

Cheers, Simon

From simon at rabbitmq.com  Mon May 19 17:14:02 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 May 2014 17:14:02 +0100
Subject: [rabbitmq-discuss] ssl_not_started using LDAP auth backend
In-Reply-To: <ecf3eece-87ad-4592-9f24-4da13963410c@googlegroups.com>
References: <ecf3eece-87ad-4592-9f24-4da13963410c@googlegroups.com>
Message-ID: <537A2DCA.9090601@rabbitmq.com>

On 19/05/2014 10:11, Matthew Duggan wrote:
> Not sure if this is a bug - maybe the ldap plugin should also try to
> start the ssl application to be sure it's running?.

Yeah, that sounds like a bug. Thanks for the very clear report. I will 
get it fixed.

I guess nobody's noticed until now because people using SSL tend to use 
it for more than just LDAP...

Cheers, Simon


From npetrace at gmail.com  Mon May 19 17:37:43 2014
From: npetrace at gmail.com (scguy)
Date: Mon, 19 May 2014 09:37:43 -0700 (PDT)
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
Message-ID: <1400517463441-35662.post@n5.nabble.com>

Yes...I had mentioned in my original post that
com.rabbitmq.jms.admin.RMQConnectionFactory is located in
rabbitmq-jms-1.2.0.jar, which is on my classpath (same jar as
RMQObjectFactory).  Do I need to configure something else so that the class
is found?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35662.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From greg.poirier at opower.com  Mon May 19 17:48:49 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Mon, 19 May 2014 09:48:49 -0700
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
Message-ID: <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>

Michael,

Good to hear from you again. If you don't mind, I have a few questions
about your setup.

I assume for the AMQP proxy, you are referring to something like your
Fabrik. Would that be correct? How is open sourcing that going? I've been
interested since your original post.

Being short on resources, but working with developers who have resources, I
am inclined to introduce them to the idea of the middle layer and seeing
what we can come up with that is equitable for all.

I think being able to not persist messages in RabbitMQ would be a big win
for us. This removes the bulk of the io, and I solves our still occasional
partitioning problems. I'm going to talk to other service owners about
persisting messages themselves in databases and passing only the ids of
their messages around. I don't think we can implement a unified middle
layer given some time constraints, but I'm going to propose that as well
(as I think it is the best way to approach this). Lacking the ability to
implement, does shifting persistence to databases and maintaining a batch
table (of ids in flight) seem like a reasonable interim solution? Or is
there another approach?

A couple of our service owners already do this. Most do not and instead
pass entire documents via RabbitMQ to persistent queues. I have a hard time
identifying who some are but am working on that as well. I think providing
an API for them would make a huge difference in getting them to standardize
around a better use of RabbitMQ.

I was toying with a simpler implementation of your cluster configuration,
but (and I think we discussed this) it will require that producers and
consumers connect to separate proxy hosts, correct? I am still largely
unfamiliar with how federation and shovel work--despite having read the
documentation. I am working on a test bed for myself in my spare time (ha).
It would be nice to have this proxy layer be single unclustered rabbit
nodes. I could then take do no downtime upgrades of RabbitMQ, add capacity
for certain vhosts, etc. Am I understanding federation and shovel
correctly? Is this even possible?

The idea here being

publisher - proxy - backing cluster - proxy - consumer

Where consumers take messages from queues bound to exchanges to which
publishers are connected.

I think this requires a database for persistence, because if you publish to
a proxy exchange and no consumers are connected, then the message gets
lost.

Is there a reasonable way to avoid this without Fabrik? Publisher confirms
don't help if no queues are bound. And if we are sharing a database between
producer and consumer, why bother with RabbitMQ at all?

The beauty of message buses is the ability to pass arbitrary messages over
them. Without that, what are they for? I realize that we don't want to pass
large documents in them, but a small JSON blob seems perfectly reasonable.

On Sunday, May 18, 2014, Laing, Michael <michael.laing at nytimes.com> wrote:

> I'll respond inline w our experience:
>
> On Sun, May 18, 2014 at 2:55 PM, Greg Poirier <greg.poirier at opower.com>wrote:
>
>> I mentioned this on Twitter and a couple of people have requested that I
>> bring this up on the mailing list.
>>
>> It seems to be a given that RabbitMQ was not designed for the batch
>> processing use case (i.e. using RabbitMQ as a buffer between large serial
>> steps). We have a system in place that attempts to do just that, however.
>>
>
> It is not a 'given' as far as we are concerned. We have some processes
> that result in a million or more messages being queued within a minute or
> so. These messages are processed over the ensuing several minutes (for
> 'dismissals' of news items from individual devices) to several hours (for
> lower-priority individualized  'offers'). This is the new 'batch'.
>
>
>>
>> I have been working with the developers of the software involved in an
>> attempt to help them redesign around a more ideal use of RabbitMQ (or to
>> help them move to a different bus altogether -- database or something like
>> kafka) and some of them have been able to simply operate in smaller batch
>> sizes (thus keeping their queues relatively small).
>>
>
> We put large message bodies in S3 and pass them by reference. We never use
> RabbitMQ persistence and compensate for that with replication. For 'real'
> persistence we use Cassandra. Most importantly, none of our internal users
> know this, as we provide them with an abstracted interface.
>
>
>>
>> However, I cannot stem the tide of improper RabbitMQ use.
>>
>
> We try to make it easier to use us than not. We work hard to be the most
> reliable, fastest, most scalable, most flexible and cheapest component of
> our customers technology mix.
>
>
>>
>> When things go poorly, millions of messages end up in the queues.
>>
>
> We target zero length queues. If they grow unexpectedly we: 1) autoscale,
> 2) shift load, 3) start new regions - usually all those. Then we diagnose.
>
>
>>
>> In 3.1.x we saw this regularly cause our clusters to partition.
>>
>
> We have never had a partition in production because we always
> overprovision RabbitMQ so it can maintain cluster communications. We
> basically avoid disk IO due to the risk of IO wait interfering w the
> cluster heartbeat.
>
>
>>
>> In 3.1.x and 3.2.x when we would delete large queues (5+ million messages
>> enqueued), this would cause the cluster to become unresponsive, run out of
>> memory, and then crash.
>>
>
> When we have tested situations like this, we found it best to just wipe
> out the cluster and restart. Before doing this, we shift the load to other
> regions operating in parallel.
>
>
>>
>> During the 3.1 -> 3.2 upgrade, we had to completely rebuild our clusters.
>> When 3.2 came up, it soon crashed.
>>
>
> We have not had that problem.
>
>
>>
>> In the most recent upgrade, we saw a 3.2.3 cluster in our dev environment
>> crash. I performed an opportunistic upgrade to 3.3.1, because hey...
>> downtime already, so let's see if 3.3.1 addresses some of the issues we've
>> been seeing.
>>
>> https://gist.github.com/grepory/384410ac90186ed0ce2a
>>
>> After the upgrade, 3.3.1 would not startup at all. I removed
>> /var/lib/rabbitmq/mnesia on all of the nodes and brought RabbitMQ back up.
>>
>
> We are not yet in production w 3.3.1 but 3.2.4 is running solidly in stage
> and we will upgrade stage to 3.3.1 this coming week.
>
>
>>
>> 3.3.1 has been up and running alright so far, but we haven't done another
>> end-to-end test in our development environment in a while. One of these
>> tests can lead to at least a million messages in the queue over a period of
>> time on average.
>>
>
> A million is not that many - depending on size of course. As I said - our
> target is 0, but really the question is: what's your rate of change? I try
> to have enough 'headroom' to easily handle the surges - volumes can vary 20
> to 1 depending on the news of the moment etc. If a queue builds and stays
> high we add resources until it goes down and then investigate.
>
>
>>
>> So, I guess my question is:
>>
>> If I know that I have people using RabbitMQ like this, and there is
>> nothing I can do to change that fact... what do I do?
>>
>
> You need enough resource. And it is good to be able to autoscale.
>
> A specific suggestion I would make for any internal service provider is to
> use an amqp proxy. We locate proxy clusters that we control in our internal
> customers' computing environments. They publish to and subscribe from these
> proxies. We control the shoveling/federation of the proxies to/from our
> core pipelines in regions, redirecting as needed. The proxies are an
> additional buffer and also allow us to 'launder' incoming messages, e.g. by
> forcing persistence off.
>
> We also track and account for every message using metadata, and can charge
> back... We are cheap but not free.
>
> Anyway, I hope this helps.
>
> ml
>
>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/71047723/attachment.html>

From mcintoshj at gmail.com  Mon May 19 17:59:03 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 19 May 2014 11:59:03 -0500
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
Message-ID: <CAD6m6fEMZrmkXWMOytw32Sqw9pZqUezejM4YD54q+SjsBM4C=Q@mail.gmail.com>

Greg:

I thought I'd share a bit of experience I've got.  In general, we've had
very little problems with rabbit, but DEFINITELY make sure you're on the
latest version (at least, latest minor version).  For example, we had a
mirrored queue crash due to a bug when we were on 3.2.0 and 3.2.1 fixed
that bug.  Also, be very careful of your disk IO.  Rabbit doesn't seem to
handle long pauses on the disk very well (not many things do handle this
well).  I've had more problems where the disk sub system slows down than
anything else.

With those two things under consideration, we've had systems where we've
had almost a billion messages backlogged waiting to be processed and we've
been running fine under this load.  I'm looking at a queue right now with
persistent messages (and queue persistent) with over 12 million messages
waiting to be processed.  We're looking to increase the batch performance,
and what else we need to do to increase processing of these messages, but
rabbit is handling this fine.

There ARE numerous methods you can use to handle these kinds of situations.
 For example, x-consistent hashes to distribute messages to additional
queues that get routed to different servers in a "tree" style pattern, with
additional consumers and distributed processing.

Regarding partitioning - I've not hit a partition yet, but we keep our
rabbit clustered nodes really close together to try and prevent any kinds
of issues from occurring.  In general, they're at least on the same switch
or virtual switch.  We then use shovels to distribute the messages to
remote systems.  We setup LTM's in between the shovels and the remote
system with round-robin dispatching of connections.  Though not a precise
load balanced of the messages due to hashing keys and other issues, it gets
us a moderately balanced solution that scales really really well.  Our big
slow down has usually been the database we're writing to on the remote side.

Jason




On Mon, May 19, 2014 at 11:48 AM, Greg Poirier <greg.poirier at opower.com>wrote:

> Michael,
>
> Good to hear from you again. If you don't mind, I have a few questions
> about your setup.
>
> I assume for the AMQP proxy, you are referring to something like your
> Fabrik. Would that be correct? How is open sourcing that going? I've been
> interested since your original post.
>
> Being short on resources, but working with developers who have resources,
> I am inclined to introduce them to the idea of the middle layer and seeing
> what we can come up with that is equitable for all.
>
> I think being able to not persist messages in RabbitMQ would be a big win
> for us. This removes the bulk of the io, and I solves our still occasional
> partitioning problems. I'm going to talk to other service owners about
> persisting messages themselves in databases and passing only the ids of
> their messages around. I don't think we can implement a unified middle
> layer given some time constraints, but I'm going to propose that as well
> (as I think it is the best way to approach this). Lacking the ability to
> implement, does shifting persistence to databases and maintaining a batch
> table (of ids in flight) seem like a reasonable interim solution? Or is
> there another approach?
>
> A couple of our service owners already do this. Most do not and instead
> pass entire documents via RabbitMQ to persistent queues. I have a hard time
> identifying who some are but am working on that as well. I think providing
> an API for them would make a huge difference in getting them to standardize
> around a better use of RabbitMQ.
>
> I was toying with a simpler implementation of your cluster configuration,
> but (and I think we discussed this) it will require that producers and
> consumers connect to separate proxy hosts, correct? I am still largely
> unfamiliar with how federation and shovel work--despite having read the
> documentation. I am working on a test bed for myself in my spare time (ha).
> It would be nice to have this proxy layer be single unclustered rabbit
> nodes. I could then take do no downtime upgrades of RabbitMQ, add capacity
> for certain vhosts, etc. Am I understanding federation and shovel
> correctly? Is this even possible?
>
> The idea here being
>
> publisher - proxy - backing cluster - proxy - consumer
>
> Where consumers take messages from queues bound to exchanges to which
> publishers are connected.
>
> I think this requires a database for persistence, because if you publish
> to a proxy exchange and no consumers are connected, then the message gets
> lost.
>
> Is there a reasonable way to avoid this without Fabrik? Publisher confirms
> don't help if no queues are bound. And if we are sharing a database between
> producer and consumer, why bother with RabbitMQ at all?
>
> The beauty of message buses is the ability to pass arbitrary messages over
> them. Without that, what are they for? I realize that we don't want to pass
> large documents in them, but a small JSON blob seems perfectly reasonable.
>
>
> On Sunday, May 18, 2014, Laing, Michael <michael.laing at nytimes.com> wrote:
>
>> I'll respond inline w our experience:
>>
>> On Sun, May 18, 2014 at 2:55 PM, Greg Poirier <greg.poirier at opower.com>wrote:
>>
>>> I mentioned this on Twitter and a couple of people have requested that I
>>> bring this up on the mailing list.
>>>
>>> It seems to be a given that RabbitMQ was not designed for the batch
>>> processing use case (i.e. using RabbitMQ as a buffer between large serial
>>> steps). We have a system in place that attempts to do just that, however.
>>>
>>
>> It is not a 'given' as far as we are concerned. We have some processes
>> that result in a million or more messages being queued within a minute or
>> so. These messages are processed over the ensuing several minutes (for
>> 'dismissals' of news items from individual devices) to several hours (for
>> lower-priority individualized  'offers'). This is the new 'batch'.
>>
>>
>>>
>>> I have been working with the developers of the software involved in an
>>> attempt to help them redesign around a more ideal use of RabbitMQ (or to
>>> help them move to a different bus altogether -- database or something like
>>> kafka) and some of them have been able to simply operate in smaller batch
>>> sizes (thus keeping their queues relatively small).
>>>
>>
>> We put large message bodies in S3 and pass them by reference. We never
>> use RabbitMQ persistence and compensate for that with replication. For
>> 'real' persistence we use Cassandra. Most importantly, none of our internal
>> users know this, as we provide them with an abstracted interface.
>>
>>
>>>
>>> However, I cannot stem the tide of improper RabbitMQ use.
>>>
>>
>> We try to make it easier to use us than not. We work hard to be the most
>> reliable, fastest, most scalable, most flexible and cheapest component of
>> our customers technology mix.
>>
>>
>>>
>>> When things go poorly, millions of messages end up in the queues.
>>>
>>
>> We target zero length queues. If they grow unexpectedly we: 1) autoscale,
>> 2) shift load, 3) start new regions - usually all those. Then we diagnose.
>>
>>
>>>
>>> In 3.1.x we saw this regularly cause our clusters to partition.
>>>
>>
>> We have never had a partition in production because we always
>> overprovision RabbitMQ so it can maintain cluster communications. We
>> basically avoid disk IO due to the risk of IO wait interfering w the
>> cluster heartbeat.
>>
>>
>>>
>>> In 3.1.x and 3.2.x when we would delete large queues (5+ million
>>> messages enqueued), this would cause the cluster to become unresponsive,
>>> run out of memory, and then crash.
>>>
>>
>> When we have tested situations like this, we found it best to just wipe
>> out the cluster and restart. Before doing this, we shift the load to other
>> regions operating in parallel.
>>
>>
>>>
>>> During the 3.1 -> 3.2 upgrade, we had to completely rebuild our
>>> clusters. When 3.2 came up, it soon crashed.
>>>
>>
>> We have not had that problem.
>>
>>
>>>
>>> In the most recent upgrade, we saw a 3.2.3 cluster in our dev
>>> environment crash. I performed an opportunistic upgrade to 3.3.1, because
>>> hey... downtime already, so let's see if 3.3.1 addresses some of the issues
>>> we've been seeing.
>>>
>>> https://gist.github.com/grepory/384410ac90186ed0ce2a
>>>
>>> After the upgrade, 3.3.1 would not startup at all. I removed
>>> /var/lib/rabbitmq/mnesia on all of the nodes and brought RabbitMQ back up.
>>>
>>
>> We are not yet in production w 3.3.1 but 3.2.4 is running solidly in
>> stage and we will upgrade stage to 3.3.1 this coming week.
>>
>>
>>>
>>> 3.3.1 has been up and running alright so far, but we haven't done
>>> another end-to-end test in our development environment in a while. One of
>>> these tests can lead to at least a million messages in the queue over a
>>> period of time on average.
>>>
>>
>> A million is not that many - depending on size of course. As I said - our
>> target is 0, but really the question is: what's your rate of change? I try
>> to have enough 'headroom' to easily handle the surges - volumes can vary 20
>> to 1 depending on the news of the moment etc. If a queue builds and stays
>> high we add resources until it goes down and then investigate.
>>
>>
>>>
>>> So, I guess my question is:
>>>
>>> If I know that I have people using RabbitMQ like this, and there is
>>> nothing I can do to change that fact... what do I do?
>>>
>>
>> You need enough resource. And it is good to be able to autoscale.
>>
>> A specific suggestion I would make for any internal service provider is
>> to use an amqp proxy. We locate proxy clusters that we control in our
>> internal customers' computing environments. They publish to and subscribe
>> from these proxies. We control the shoveling/federation of the proxies
>> to/from our core pipelines in regions, redirecting as needed. The proxies
>> are an additional buffer and also allow us to 'launder' incoming messages,
>> e.g. by forcing persistence off.
>>
>> We also track and account for every message using metadata, and can
>> charge back... We are cheap but not free.
>>
>> Anyway, I hope this helps.
>>
>> ml
>>
>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/42f4a713/attachment.html>

From srinatsr at cisco.com  Mon May 19 18:47:30 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Mon, 19 May 2014 17:47:30 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
	interval - in Consumer
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1074F@xmb-aln-x10.cisco.com>



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/e3e7d030/attachment.html>

From mcintoshj at gmail.com  Mon May 19 19:04:01 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 19 May 2014 13:04:01 -0500
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1074F@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1074F@xmb-aln-x10.cisco.com>
Message-ID: <CAD6m6fGYHDMsmgkhZAKM46TyLyDyoWDUno=eDWVeSiBvKLCWYQ@mail.gmail.com>

Take a look sometime at the newest AMQP libraries on this.  The latest
release adds a retry handler.  Before that, you can look at
spring-amqp-extras:
https://github.com/CARFAX/spring-amqp-extras/tree/e50d353a6fa83d85e5d1039ad504c917d812b062

For spring amqp 1.3:
http://docs.spring.io/spring-amqp/docs/1.3.3.RELEASE/reference/html/whats-new.html#d4e152

Jason



On Mon, May 19, 2014 at 12:47 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>
>
> Retry unacknowledged RabbitMQ message in 10 second interval
>
> And Retry 3 times using Spring framework in java .
>
>
>
> Please need help on this
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/82a0176f/attachment.html>

From mklishin at gopivotal.com  Mon May 19 20:20:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 19 May 2014 23:20:05 +0400
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single
 machine" explained in https://www.rabbitmq.com/clustering.html
In-Reply-To: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
References: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
Message-ID: <etPan.537a5981.41b71efb.784c@mercurio.local>

?On 19 May 2014 at 20:06:57, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > Above error indicates that 61613 address already in use. Stomp  
> is listening on 61613 port. I am exploring how to change/define  
> stomp listener port while creating a new node.

See Configuring the adapter on
http://www.rabbitmq.com/stomp.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From michael.laing at nytimes.com  Mon May 19 21:10:32 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 19 May 2014 16:10:32 -0400
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
Message-ID: <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>

On Mon, May 19, 2014 at 12:48 PM, Greg Poirier <greg.poirier at opower.com>wrote:

> Michael,
>
> Good to hear from you again. If you don't mind, I have a few questions
> about your setup.
>
> I assume for the AMQP proxy, you are referring to something like your
> Fabrik. Would that be correct? How is open sourcing that going? I've been
> interested since your original post.


It's taking longer than I thought :) Bits and pieces are in the pipeline -
our RabbitMQ / Python / Cassandra benchmarks will be out there by Cassandra
Day NYC, here at the NYTimes 21 Jun. A big piece of our rabbit_helpers
python framework is included.


>
> Being short on resources, but working with developers who have resources,
> I am inclined to introduce them to the idea of the middle layer and seeing
> what we can come up with that is equitable for all.
>
> I think being able to not persist messages in RabbitMQ would be a big win
> for us. This removes the bulk of the io, and I solves our still occasional
> partitioning problems. I'm going to talk to other service owners about
> persisting messages themselves in databases and passing only the ids of
> their messages around. I don't think we can implement a unified middle
> layer given some time constraints, but I'm going to propose that as well
> (as I think it is the best way to approach this). Lacking the ability to
> implement, does shifting persistence to databases and maintaining a batch
> table (of ids in flight) seem like a reasonable interim solution? Or is
> there another approach?
>

We let them pass whatever size message they want pretty much. If it is over
a configurable size, currently 10k, we try gzipping it; if it is still over
another configurable amount, currently 100k, we push it to S3 and place a
signed URL in the metadata.

The proxy clusters buy us a lot by: forcing non-persistence, buffering the
core clusters, making copies for message replay, allowing us to redirect
the message flows among core clusters, etc. And they are relatively local
to the our internal customers. We don't run any code on them other than
shovels and and federation. Each internal customer has its own vhost.


>
> A couple of our service owners already do this. Most do not and instead
> pass entire documents via RabbitMQ to persistent queues. I have a hard time
> identifying who some are but am working on that as well. I think providing
> an API for them would make a huge difference in getting them to standardize
> around a better use of RabbitMQ.
>

Our customers don't actually pay attention to the fact that they go through
a proxy - it is all 'fabrik' to them.


>
> I was toying with a simpler implementation of your cluster configuration,
> but (and I think we discussed this) it will require that producers and
> consumers connect to separate proxy hosts, correct? I am still largely
> unfamiliar with how federation and shovel work--despite having read the
> documentation. I am working on a test bed for myself in my spare time (ha).
> It would be nice to have this proxy layer be single unclustered rabbit
> nodes. I could then take do no downtime upgrades of RabbitMQ, add capacity
> for certain vhosts, etc. Am I understanding federation and shovel
> correctly? Is this even possible?
>

Our proxies are 2-way.


>
> The idea here being
>
> publisher - proxy - backing cluster - proxy - consumer
>
> Where consumers take messages from queues bound to exchanges to which
> publishers are connected.
>
> I think this requires a database for persistence, because if you publish
> to a proxy exchange and no consumers are connected, then the message gets
> lost.
>

The publish-to exchange in the proxy has a queue bound to it which is
shoveled to the core cluster. The queue will buffer the messages until they
are shoveled. The core does whatever. A proxy consume-from exchange is
federated to the core as its upstream. The core publishes whatever to that
exchange. Consumers create queues and bind to the proxy consume-from
exchange, implicitly signaling the upstream to send matching messages. This
is one way of configuring the plumbing.


>
> Is there a reasonable way to avoid this without Fabrik? Publisher confirms
> don't help if no queues are bound. And if we are sharing a database between
> producer and consumer, why bother with RabbitMQ at all?
>

Event-driven, no MxN, fast, reliable, flexible, cheap. We have 2 forms of
persistence: S3 for big messages, and Cassandra for memory. So most of the
fabrik focuses on the routing of small messages. Cassandra lets us 'replay'
messages selectively: show me the messages I missed, give me the messages
sent yesterday during a 5 minute period, give me the latest 10 messages on
this topic, etc. And it lets us gather event messages for near real-time
and longitudinal analysis.


>
> The beauty of message buses is the ability to pass arbitrary messages over
> them. Without that, what are they for? I realize that we don't want to pass
> large documents in them, but a small JSON blob seems perfectly reasonable.


That's what we do. Actually we store the json-like stuff in the headers
property as a 'metadata' item. The body is opaque to the fabrik - we treat
it as binary.

ml


>
>
> On Sunday, May 18, 2014, Laing, Michael <michael.laing at nytimes.com> wrote:
>
>> I'll respond inline w our experience:
>>
>> On Sun, May 18, 2014 at 2:55 PM, Greg Poirier <greg.poirier at opower.com>wrote:
>>
>>> I mentioned this on Twitter and a couple of people have requested that I
>>> bring this up on the mailing list.
>>>
>>> It seems to be a given that RabbitMQ was not designed for the batch
>>> processing use case (i.e. using RabbitMQ as a buffer between large serial
>>> steps). We have a system in place that attempts to do just that, however.
>>>
>>
>> It is not a 'given' as far as we are concerned. We have some processes
>> that result in a million or more messages being queued within a minute or
>> so. These messages are processed over the ensuing several minutes (for
>> 'dismissals' of news items from individual devices) to several hours (for
>> lower-priority individualized  'offers'). This is the new 'batch'.
>>
>>
>>>
>>> I have been working with the developers of the software involved in an
>>> attempt to help them redesign around a more ideal use of RabbitMQ (or to
>>> help them move to a different bus altogether -- database or something like
>>> kafka) and some of them have been able to simply operate in smaller batch
>>> sizes (thus keeping their queues relatively small).
>>>
>>
>> We put large message bodies in S3 and pass them by reference. We never
>> use RabbitMQ persistence and compensate for that with replication. For
>> 'real' persistence we use Cassandra. Most importantly, none of our internal
>> users know this, as we provide them with an abstracted interface.
>>
>>
>>>
>>> However, I cannot stem the tide of improper RabbitMQ use.
>>>
>>
>> We try to make it easier to use us than not. We work hard to be the most
>> reliable, fastest, most scalable, most flexible and cheapest component of
>> our customers technology mix.
>>
>>
>>>
>>> When things go poorly, millions of messages end up in the queues.
>>>
>>
>> We target zero length queues. If they grow unexpectedly we: 1) autoscale,
>> 2) shift load, 3) start new regions - usually all those. Then we diagnose.
>>
>>
>>>
>>> In 3.1.x we saw this regularly cause our clusters to partition.
>>>
>>
>> We have never had a partition in production because we always
>> overprovision RabbitMQ so it can maintain cluster communications. We
>> basically avoid disk IO due to the risk of IO wait interfering w the
>> cluster heartbeat.
>>
>>
>>>
>>> In 3.1.x and 3.2.x when we would delete large queues (5+ million
>>> messages enqueued), this would cause the cluster to become unresponsive,
>>> run out of memory, and then crash.
>>>
>>
>> When we have tested situations like this, we found it best to just wipe
>> out the cluster and restart. Before doing this, we shift the load to other
>> regions operating in parallel.
>>
>>
>>>
>>> During the 3.1 -> 3.2 upgrade, we had to completely rebuild our
>>> clusters. When 3.2 came up, it soon crashed.
>>>
>>
>> We have not had that problem.
>>
>>
>>>
>>> In the most recent upgrade, we saw a 3.2.3 cluster in our dev
>>> environment crash. I performed an opportunistic upgrade to 3.3.1, because
>>> hey... downtime already, so let's see if 3.3.1 addresses some of the issues
>>> we've been seeing.
>>>
>>> https://gist.github.com/grepory/384410ac90186ed0ce2a
>>>
>>> After the upgrade, 3.3.1 would not startup at all. I removed
>>> /var/lib/rabbitmq/mnesia on all of the nodes and brought RabbitMQ back up.
>>>
>>
>> We are not yet in production w 3.3.1 but 3.2.4 is running solidly in
>> stage and we will upgrade stage to 3.3.1 this coming week.
>>
>>
>>>
>>> 3.3.1 has been up and running alright so far, but we haven't done
>>> another end-to-end test in our development environment in a while. One of
>>> these tests can lead to at least a million messages in the queue over a
>>> period of time on average.
>>>
>>
>> A million is not that many - depending on size of course. As I said - our
>> target is 0, but really the question is: what's your rate of change? I try
>> to have enough 'headroom' to easily handle the surges - volumes can vary 20
>> to 1 depending on the news of the moment etc. If a queue builds and stays
>> high we add resources until it goes down and then investigate.
>>
>>
>>>
>>> So, I guess my question is:
>>>
>>> If I know that I have people using RabbitMQ like this, and there is
>>> nothing I can do to change that fact... what do I do?
>>>
>>
>> You need enough resource. And it is good to be able to autoscale.
>>
>> A specific suggestion I would make for any internal service provider is
>> to use an amqp proxy. We locate proxy clusters that we control in our
>> internal customers' computing environments. They publish to and subscribe
>> from these proxies. We control the shoveling/federation of the proxies
>> to/from our core pipelines in regions, redirecting as needed. The proxies
>> are an additional buffer and also allow us to 'launder' incoming messages,
>> e.g. by forcing persistence off.
>>
>> We also track and account for every message using metadata, and can
>> charge back... We are cheap but not free.
>>
>> Anyway, I hope this helps.
>>
>> ml
>>
>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/83c69e21/attachment.html>

From greg.poirier at opower.com  Mon May 19 22:00:04 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Mon, 19 May 2014 14:00:04 -0700
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
Message-ID: <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>

On Mon, May 19, 2014 at 1:10 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

>
> It's taking longer than I thought :) Bits and pieces are in the pipeline -
> our RabbitMQ / Python / Cassandra benchmarks will be out there by Cassandra
> Day NYC, here at the NYTimes 21 Jun. A big piece of our rabbit_helpers
> python framework is included.
>

I totally appreciate that. For about two files of Ruby code, it took me 2-3
weeks to get it open sourced. :) I appreciate the effort though! Looking
forward to its eventual announcement, whenever that may be.


> We let them pass whatever size message they want pretty much. If it is
> over a configurable size, currently 10k, we try gzipping it; if it is still
> over another configurable amount, currently 100k, we push it to S3 and
> place a signed URL in the metadata.
>

Yeah, we already have one of our users gzipping before sending their
messages. This actually helped considerably on memory and disk. I really
like the idea of doing this on the RabbitMQ side. We would have to support
Java and Ruby for this, but I think that's not entirely terrible... as we
could probably figure out away to do this reasonably with JRuby. We'll see.


> The proxy clusters buy us a lot by: forcing non-persistence, buffering the
> core clusters, making copies for message replay, allowing us to redirect
> the message flows among core clusters, etc. And they are relatively local
> to the our internal customers. We don't run any code on them other than
> shovels and and federation. Each internal customer has its own vhost.
>

Yeah, this part is pretty key to me as well. Having a buffer for core
RabbitMQ clusters is essential to things like seamless upgrade, cluster
migration, scaling, configuration changes, etc. I want to be able to bring
up an entirely new cluster with all of the new changes, begin shoveling
data from the old cluster to the new cluster, and then flip the proxy over
to the new cluster as the shovel empties the old cluster's queues.

We already have the use pattern where every internal customer has its own
vhost. If two services want to communicate, they are given access to the
appropriate vhost and go from there -- as well as having their own.
Basically, multiple pub-sub channels that any two services can communicate
on. This has worked out well, but right now they all reside on the same
clusters. This is not great, because it means that one user can cause an
outage for all services utilizing our RabbitMQ offering. Makes for a pretty
bad user experience.



> Our customers don't actually pay attention to the fact that they go
> through a proxy - it is all 'fabrik' to them.
>

That's exactly where I want to head.


Our proxies are 2-way.
>
> The publish-to exchange in the proxy has a queue bound to it which is
> shoveled to the core cluster. The queue will buffer the messages until they
> are shoveled. The core does whatever. A proxy consume-from exchange is
> federated to the core as its upstream. The core publishes whatever to that
> exchange. Consumers create queues and bind to the proxy consume-from
> exchange, implicitly signaling the upstream to send matching messages. This
> is one way of configuring the plumbing.
>

Fabrik is responsible for the creation of this plumbing? I.e. users ineract
with Fabrik like a standard AMQP library, but when they, for example,
create the exchange, Fabrik takes over, creates the publish-to exchange,
proxy queue, and shovel configuration... then when they bind a queue to the
exchange, Fabrik creates the consume-from exchange and federation
configuration on the proxy and core?

Ahhh... and you don't have to maintain state, because all of the state is
kept in RabbitMQ. Each new client that comes up is going to attempt to
create the appropriate queues/exchanges, but these become noops because
they already exist.


Event-driven, no MxN, fast, reliable, flexible, cheap. We have 2 forms of
> persistence: S3 for big messages, and Cassandra for memory. So most of the
> fabrik focuses on the routing of small messages. Cassandra lets us 'replay'
> messages selectively: show me the messages I missed, give me the messages
> sent yesterday during a 5 minute period, give me the latest 10 messages on
> this topic, etc. And it lets us gather event messages for near real-time
> and longitudinal analysis.
>

So do you persist every messages sent via Fabrik? I think we could do this
for some things, but we would have to have TTLs for others. We could even
have our persistence store honor TTLs that are assigned during queue
creation, I think. I wonder if Cassandra has something built in that would
make this easy for us.

That's what we do. Actually we store the json-like stuff in the headers
> property as a 'metadata' item. The body is opaque to the fabrik - we treat
> it as binary.
>

I like this. So you have a consistent message format which, when
simplified, resmebles:

{ metadata: {}, body: "" }

I like it.

Thanks again.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/bd6a6585/attachment.html>

From michael.laing at nytimes.com  Mon May 19 22:32:36 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 19 May 2014 17:32:36 -0400
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
 <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
Message-ID: <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>

snip:

>
> So do you persist every messages sent via Fabrik? I think we could do this
> for some things, but we would have to have TTLs for others. We could even
> have our persistence store honor TTLs that are assigned during queue
> creation, I think. I wonder if Cassandra has something built in that would
> make this easy for us.
>
>
Yes. We allow internal clients to assign a 'cache_ttl' for each message.
When we persist the message in Cassandra we set that ttl. By default the
cache_ttl is 3 days, max is 30 days.

The above applies to persistence by 'path' - each message may have multiple
paths - think of a path as a folder for the message that is formatted like
a routing key, e.g. 'feeds-item.breaking-news.1224'. Within each
path/folder messages are stored latest-first by a timeuuid (uuid version
1). Searches for the 'latest' n messages in a path subtree are very
efficient.

Cassandra takes care of deleting them for us and compacting storage - we
never delete manually. Similarly, S3 items are automatically deleted.

We also 'journal' all messages with ttl of 30 days. It has worked well for
us and we can easily scale up and down. The fast generalized cache makes it
possible to support quite interesting apps.

ml
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/cd5b432b/attachment.html>

From srinatsr at cisco.com  Mon May 19 22:47:24 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Mon, 19 May 2014 21:47:24 +0000
Subject: [rabbitmq-discuss] RetryTemplate I need 3 retries
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB109C5@xmb-aln-x10.cisco.com>

Hello All,

How to set retry for 3 times alone with this configuration??


<bean id="retryTemplate" class="org.springframework.retry.support.RetryTemplate">
        <property name="backOffPolicy">
               <bean class="org.springframework.retry.backoff.ExponentialBackOffPolicy">
                       <property name="initialInterval" value="500" />
                       <property name="multiplier" value="10.0" />
                       <property name="maxInterval" value="10000" />
               </bean>
        </property>
</bean>

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/38f8b8db/attachment.html>

From sven_weber at excite.com  Tue May 20 00:01:01 2014
From: sven_weber at excite.com (Full Name)
Date: Mon, 19 May 2014 19:01:01 -0400
Subject: [rabbitmq-discuss] rabbitmq and cpp
Message-ID: <20140519190101.31201@web002.roc2.bluetie.com>

Hi Matthias,

thx for the answer! 


-----Original Message-----
From: "Matthias Radestock" [matthias at rabbitmq.com]
Date: 05/16/2014 09:49 AM
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
CC: sven_weber at excite.com
Subject: Re: [rabbitmq-discuss] rabbitmq and cpp

On 12/05/14 02:05, Full Name wrote:
>> I am new to RabbitMQ and to AMQP in general. I didn't find a
>> forum/mailing list for general AMQP questions. Just a forum at
>> amqp.org, but that is kind of dead. I want to exchange messages
>> between Java and c++ applications. The Java tutorials for rabbitmq
>> were easy, but the c++ client is really hard to build.

>By "c++ client" are you referring to 
>https://github.com/alanxz/SimpleAmqpClient ? What specifically did you 
>find hard about the build process? Alan, the author, is on this mailing 
>list and I am sure he'd welcome "constructive criticism" :)

Yes, I mean SimpleAmqpClient. But let me make it very clear that I do not wanna rant about that build process.
It is just hard as a "getting started experience" compared to the Java examples, which were ready to run after a few minutes.


>> I watched a couple of amqp videos and it is always mentioned that
>> amqp is a wire protocol just like http, and that that is a big plus
>> (I agree). So why is there a need for a rabbitmq cpp client and a
>> Apache qpid client etc. in the first place? Why isn't there only one
>> generic amqp cpp client?

>Two reasons:

>- there are several versions of the protocol; different clients support 
>different versions

>- there are many ways of exposing AMQP functionality to applications; 
>different clients provide different API

My thinking goes as follows:

AMQP is a wire protocoll like http. 
There are several http clients for sure. But there is not one http client for Apache web server, a different http client for nginx and a third one for Microsoft Internet Information Services (IIS).
So why there are clients for RabbitMQ and Apache qpid and so forth, and not a generic C++ client for AMQP 1.0? 

regards
Sven

From greg.poirier at opower.com  Tue May 20 01:02:28 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Mon, 19 May 2014 17:02:28 -0700
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
 <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
 <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>
Message-ID: <CANpjuCvmydt=UJxj0MfeCJB9pDnr-JzG8FaY1AOw0guqLkYDkA@mail.gmail.com>

On Mon, May 19, 2014 at 2:32 PM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> snip:
>
>>
>> So do you persist every messages sent via Fabrik? I think we could do
>> this for some things, but we would have to have TTLs for others. We could
>> even have our persistence store honor TTLs that are assigned during queue
>> creation, I think. I wonder if Cassandra has something built in that would
>> make this easy for us.
>>
>>
> Yes. We allow internal clients to assign a 'cache_ttl' for each message.
> When we persist the message in Cassandra we set that ttl. By default the
> cache_ttl is 3 days, max is 30 days.
>
> The above applies to persistence by 'path' - each message may have
> multiple paths - think of a path as a folder for the message that is
> formatted like a routing key, e.g. 'feeds-item.breaking-news.1224'. Within
> each path/folder messages are stored latest-first by a timeuuid (uuid
> version 1). Searches for the 'latest' n messages in a path subtree are very
> efficient.
>

Aha! This is really cool!

I like the idea of being able to keep a large "buffer" so to speak of
recently sent messages available for analysis. So, a failed batch job could
very easily inspect the actual messages that were persisted/sent in an
effort to debug. That is pretty sweet. Cassandra is very nice for this as
well, since persistence to C* is can be delegated to a consumer in the
buffer layer or core. Do you simply shovel everything to a particular path
queue for something to persist to Cassandra? Or is that done inline
somewhere before publishing to RabbitMQ? I assume that that kind of thing
is done out-of-band of the client.


> We also 'journal' all messages with ttl of 30 days. It has worked well for
> us and we can easily scale up and down. The fast generalized cache makes it
> possible to support quite interesting apps.
>

Hmm. I'm not sure I follow. What do you mean by journal?

I am also curious about some of the things you do with Fabrik... For
example, is persistence handled by the client (indirectly via the Fabrik
library) or some other component service that listens to RabbitMQ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140519/7aa78a32/attachment.html>

From bobtfish at bobtfish.net  Tue May 20 01:32:54 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Tue, 20 May 2014 01:32:54 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.5376e598.643c9869.5891@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
Message-ID: <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>


On May 17, 2014, at 5:28 AM, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 17 May 2014 at 02:55:13, Tomas Doran (bobtfish at bobtfish.net) wrote:
>>> However I?m guessing not, as no re queues - it?s all mcollective,  
>> so there is a persistent server process that listens to client  
>> messages:
>> 
>> all messages to a ?broadcast? queue
>> messages with a specific routing key to a ?direct? queue
>> 
>> and replies to a specific ?replies? queue that the client uses  
>> it?s name as a routing key on.
> 
> Tomas,
> 
> We are not mcollective experts.

Ack - thanks for taking the time to look at this given my non-specific problem description!

> Can you please post a code snippet
> (in any language) that demonstrates what exactly mcollective does for request/reply
> over STOMP?
> 
> This would be a great way for us to actually reproduce the problem.


This is not completely trivial to do (a snippet), as I?m not sure if it?s the server to client or client to server messaging which is causing the leak (or something else, like reconnections).

However, the source for the connector I?m using is:

https://github.com/puppetlabs/marionette-collective/blob/master/plugins/mcollective/connector/rabbitmq.rb

Every one of the messaging patterns in there gets used in our setup, except that notably, we are setting the ?rabbitmq.use_reply_exchange? setting (https://github.com/puppetlabs/marionette-collective/blob/master/plugins/mcollective/connector/rabbitmq.rb#L335) to true.

I think that the default pattern  is to use temporary queues for server => client responses, which would cause the effect you?re describing - however with rabbitmq.use_reply_exchange = true, my reply paths are /exchange/mcollective_reply/?, which wouldn?t suffer from the problem mentioned in this thread?

I?m trying to work up a Vagrant box which reproduces my setup faithfully enough to replicate the leak I?m seeing - I?ll share my results as soon as I can get there, but whilst I have a very similar setup running, I haven?t (yet) successfully been able to reproduce the leak.

Cheers
Tom







From arinto at gmail.com  Tue May 20 03:36:10 2014
From: arinto at gmail.com (Arinto Murdopo)
Date: Tue, 20 May 2014 10:36:10 +0800
Subject: [rabbitmq-discuss] Java client with different version compared
 to RabbitMQ server
In-Reply-To: <etPan.5379e3b0.74b0dc51.784c@mercurio.local>
References: <015d688b-16e8-47b4-a7c5-bded0fe81826@googlegroups.com>
 <etPan.5379e3b0.74b0dc51.784c@mercurio.local>
Message-ID: <CAHg+FCLqaSWqFSv5Kx2kPVuWL4m-oG6H3jQ9vL1qxvQZP7+nJw@mail.gmail.com>

Okay noted, thanks MK!

Best regards,

Arinto

Arinto
www.otnira.com


On Mon, May 19, 2014 at 6:57 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 19 May 2014 at 14:56:02, Arinto Murdopo (arinto at gmail.com) wrote:
> > > Our group is currently using RabbitMQ server 3.2.3 with Erlang
> > R24B04.
> > Is it safe to use Java AMQP client library version 3.3.1?
>
> Yes. RabbitMQ Java client currently  requires RabbitMQ server 2.0+.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/8f304cdb/attachment.html>

From ranjitiyer at gmail.com  Tue May 20 06:01:52 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Mon, 19 May 2014 22:01:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Starting RabbitMQ using Fully qualified machine
	name - parse errors
Message-ID: <1400562112484-35676.post@n5.nabble.com>

I modified rabbitmq-server.bat to pass in "-name" to erl so I can run my
nodes using fully qualified names. Rabbit seems to start fine but I see
these parse errors. Can someone shed light?

<http://rabbitmq.1065348.n5.nabble.com/file/n35676/rabbit-error.jpg> 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Starting-RabbitMQ-using-Fully-qualified-machine-name-parse-errors-tp35676.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue May 20 06:19:55 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 06:19:55 +0100
Subject: [rabbitmq-discuss] rabbitmq and cpp
In-Reply-To: <20140519190101.31201@web002.roc2.bluetie.com>
References: <20140519190101.31201@web002.roc2.bluetie.com>
Message-ID: <537AE5FB.1010402@rabbitmq.com>

On 20/05/14 00:01, Full Name wrote:
> My thinking goes as follows:
>
> AMQP is a wire protocoll like http. There are several http clients
> for sure. But there is not one http client for Apache web server, a
> different http client for nginx and a third one for Microsoft
> Internet Information Services (IIS). So why there are clients for
> RabbitMQ and Apache qpid and so forth, and not a generic C++ client
> for AMQP 1.0?

Most AMQP clients are not specific to a broker but to a version of the 
protocol.

Matthias.

From npetrace at gmail.com  Tue May 20 07:10:17 2014
From: npetrace at gmail.com (scguy)
Date: Mon, 19 May 2014 23:10:17 -0700 (PDT)
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <1400517463441-35662.post@n5.nabble.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
 <1400517463441-35662.post@n5.nabble.com>
Message-ID: <1400566217649-35678.post@n5.nabble.com>

Looks like this might be version related?  I "downgraded" to rabbitmq-server
3.1.5 and rabbitmq-jms-1.0.5 and everything worked.  Further suggestions or
comments on this are appreciated.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35678.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue May 20 08:04:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 May 2014 11:04:10 +0400
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single
 machine" explained in https://www.rabbitmq.com/clustering.html
In-Reply-To: <CA+eK+XPtRMS3N-KFSvgVyQq5nu90MGwBGwikxDVbURh8Sc_rAw@mail.gmail.com>
References: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
 <etPan.537a5981.41b71efb.784c@mercurio.local>
 <CA+eK+XPtRMS3N-KFSvgVyQq5nu90MGwBGwikxDVbURh8Sc_rAw@mail.gmail.com>
Message-ID: <etPan.537afe86.4db127f8.784c@mercurio.local>

?On 20 May 2014 at 09:16:13, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > How a single configuration file work for multiple nodes. Do  
> we need to use any command line parameter to specify config file?  

The config needs to be installed on all nodes. When running N nodes
on a single machine, override config file location and use N separate
config files with different ports.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sunny.dyal at gmail.com  Tue May 20 06:15:32 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Tue, 20 May 2014 10:45:32 +0530
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single
 machine" explained in https://www.rabbitmq.com/clustering.html
In-Reply-To: <etPan.537a5981.41b71efb.784c@mercurio.local>
References: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
 <etPan.537a5981.41b71efb.784c@mercurio.local>
Message-ID: <CA+eK+XPtRMS3N-KFSvgVyQq5nu90MGwBGwikxDVbURh8Sc_rAw@mail.gmail.com>

Hi Michael,

How a single configuration file work for multiple nodes. Do we need to use
any command line parameter to specify config file?

Kind Regards

Sunny Dyal


On Tue, May 20, 2014 at 12:50 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

>  On 19 May 2014 at 20:06:57, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > > Above error indicates that 61613 address already in use. Stomp
> > is listening on 61613 port. I am exploring how to change/define
> > stomp listener port while creating a new node.
>
> See Configuring the adapter on
> http://www.rabbitmq.com/stomp.html
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/c041baee/attachment.html>

From vin.degroote at gmail.com  Tue May 20 09:17:54 2014
From: vin.degroote at gmail.com (Vincent Degroote)
Date: Tue, 20 May 2014 01:17:54 -0700 (PDT)
Subject: [rabbitmq-discuss] parameter no-local
Message-ID: <bd585f2c-0d25-4396-af07-87318c9bff47@googlegroups.com>

Hi,

I read here https://www.rabbitmq.com/interoperability.html that RabbitMq 
did not support in version 2.0.0 the parameter no-local in basic-consume 
function. Is it still true with rabbitMQ 3?

Thanks for your answer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/bc2bba55/attachment.html>

From simon at rabbitmq.com  Tue May 20 09:22:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 May 2014 09:22:35 +0100
Subject: [rabbitmq-discuss] parameter no-local
In-Reply-To: <bd585f2c-0d25-4396-af07-87318c9bff47@googlegroups.com>
References: <bd585f2c-0d25-4396-af07-87318c9bff47@googlegroups.com>
Message-ID: <537B10CB.7020203@rabbitmq.com>

On 20/05/2014 09:17, Vincent Degroote wrote:
> I read here https://www.rabbitmq.com/interoperability.html that RabbitMq
> did not support in version 2.0.0 the parameter no-local in basic-consume
> function. Is it still true with rabbitMQ 3?

Yes, it is.

You can see our claimed support for the latest version of RabbitMQ at 
https://www.rabbitmq.com/specification.html

Cheers, Simon

From matthias at rabbitmq.com  Tue May 20 09:25:26 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 09:25:26 +0100
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single
 machine" explained in https://www.rabbitmq.com/clustering.html
In-Reply-To: <etPan.537afe86.4db127f8.784c@mercurio.local>
References: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
 <etPan.537a5981.41b71efb.784c@mercurio.local>
 <CA+eK+XPtRMS3N-KFSvgVyQq5nu90MGwBGwikxDVbURh8Sc_rAw@mail.gmail.com>
 <etPan.537afe86.4db127f8.784c@mercurio.local>
Message-ID: <537B1176.8010803@rabbitmq.com>

On 20/05/14 08:04, Michael Klishin wrote:
>   On 20 May 2014 at 09:16:13, Sunny Dyal (sunny.dyal at gmail.com) wrote:
>>> How a single configuration file work for multiple nodes. Do
>> we need to use any command line parameter to specify config file?
>
> The config needs to be installed on all nodes. When running N nodes
> on a single machine, override config file location and use N separate
> config files with different ports.

or you could just specify the stomp config on the command line...

$ rabbitmq-server -detached
$ RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=hare 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_stomp tcp_listeners [61614]" 
rabbitmq-server -detached
$ RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=flopsy 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_stomp tcp_listeners [61615]" 
rabbitmq-server -detached

etc.

Matthias.

From gsim at redhat.com  Tue May 20 09:28:25 2014
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 20 May 2014 09:28:25 +0100
Subject: [rabbitmq-discuss] rabbitmq and cpp
In-Reply-To: <20140519190101.31201@web002.roc2.bluetie.com>
References: <20140519190101.31201@web002.roc2.bluetie.com>
Message-ID: <537B1229.6040504@redhat.com>

On 05/20/2014 12:01 AM, Full Name wrote:
> why there are clients for RabbitMQ and Apache qpid and so forth, and not a generic C++ client for AMQP 1.0?

As Matthias pointed out in his earlier response, different APIs often 
reflect different stylistic choices. However a given AMQP 1.0 client 
should work against any broker supporting that protocol version.

So for example the Qpid project has a qpid::messaging c++ client and a 
Qpid Proton Messenger client (in c but easily usable from c++), offering 
two different styles of API. However both support AMQP 1.0 and therefore 
work against RabbitMQ (with the AMQP 1.0 plugin enabled) or indeed any 
other 1.0 compliant server.

There are however older versions of the AMQP protocol still in use 
(there was a fair bit of 'churn' in the evolution, to put it mildly) and 
some clients will be tied to one of these and would not work against a 
broker that didn't support the same version.

What would be nice, though it may be hard to achieve, would be an API 
for which multiple implementations existed, e.g. for different 
protocols. Java has JMS, but there isn't really anything equivalent in 
other programming languages.

From lettier.kevin at gmail.com  Tue May 20 09:30:11 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Tue, 20 May 2014 10:30:11 +0200
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
Message-ID: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>

Hi,

I'm using Rabbitmq 3.3.1 that I upgraded from version 3.2.4
I installed rabbitmq-priority-queue plugin, enable it, and finally restart
Rabbitmq server.
When I list rabbitmq plugins I see => [E] rabbitmq_priority_queue
3.3.x-27a9492d

When I'm running Java example from GitHub (with 'x-max-priority' arg set on
queue) the messages are received in the same order as I sent them.

See output:
Sent message with priority 3
Sent message with priority 0
Sent message with priority 5
Sent message with priority 10
Received message with priority 3
Received message with priority 0
Received message with priority 5
Received message with priority 10

Any idea what I'm doing wrong ?

Thanks,

K?vin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/d7daa041/attachment.html>

From simon at rabbitmq.com  Tue May 20 09:35:50 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 May 2014 09:35:50 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
Message-ID: <537B13E6.7040408@rabbitmq.com>

On 20/05/2014 9:30AM, kevin lettier wrote:
> When I'm running Java example from GitHub (with 'x-max-priority' arg set
> on queue) the messages are received in the same order as I sent them.

First guess: could you have declared the queue beforehand with the 
'x-max-priority' argument not set, or with it set but the plugin not 
installed?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Tue May 20 09:40:14 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 09:40:14 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <537B13E6.7040408@rabbitmq.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com>
Message-ID: <537B14EE.6080709@rabbitmq.com>

On 20/05/14 09:35, Simon MacMullen wrote:
> On 20/05/2014 9:30AM, kevin lettier wrote:
>> When I'm running Java example from GitHub (with 'x-max-priority' arg set
>> on queue) the messages are received in the same order as I sent them.
>
> First guess: could you have declared the queue beforehand with the
> 'x-max-priority' argument not set, or with it set but the plugin not
> installed?

...or perhaps the consumer was created before the publisher, so the 
messages just went straight through.

Matthias.

From sunny.dyal at gmail.com  Tue May 20 09:41:24 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Tue, 20 May 2014 14:11:24 +0530
Subject: [rabbitmq-discuss] I am stuck with "A cluster on a single
 machine" explained in https://www.rabbitmq.com/clustering.html
In-Reply-To: <537B1176.8010803@rabbitmq.com>
References: <7790f4a7-cdfd-4ad4-adbf-f9b2e41968e6@googlegroups.com>
 <etPan.537a5981.41b71efb.784c@mercurio.local>
 <CA+eK+XPtRMS3N-KFSvgVyQq5nu90MGwBGwikxDVbURh8Sc_rAw@mail.gmail.com>
 <etPan.537afe86.4db127f8.784c@mercurio.local> <537B1176.8010803@rabbitmq.com>
Message-ID: <CA+eK+XOqm=yGwe4i3Kx5EWsODTQqxtGVFG=Pft8M3MFA1ZYzfw@mail.gmail.com>

Thanks Matthlas. It works like a dream. Thanks RabbitMQ Team.


On Tue, May 20, 2014 at 1:55 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 20/05/14 08:04, Michael Klishin wrote:
>
>>   On 20 May 2014 at 09:16:13, Sunny Dyal (sunny.dyal at gmail.com) wrote:
>>
>>> How a single configuration file work for multiple nodes. Do
>>>>
>>> we need to use any command line parameter to specify config file?
>>>
>>
>> The config needs to be installed on all nodes. When running N nodes
>> on a single machine, override config file location and use N separate
>> config files with different ports.
>>
>
> or you could just specify the stomp config on the command line...
>
> $ rabbitmq-server -detached
> $ RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=hare
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_stomp tcp_listeners [61614]"
> rabbitmq-server -detached
> $ RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=flopsy
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_stomp tcp_listeners [61615]"
> rabbitmq-server -detached
>
> etc.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/e240814a/attachment.html>

From lettier.kevin at gmail.com  Tue May 20 10:01:48 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Tue, 20 May 2014 11:01:48 +0200
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <537B14EE.6080709@rabbitmq.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com> <537B14EE.6080709@rabbitmq.com>
Message-ID: <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>

I use the Java example so the queue was created once with 'x-max-priority'
arg set to 10
I deleted the queue and re-launch the code but unfortunately it does not
work :(


2014-05-20 10:40 GMT+02:00 Matthias Radestock <matthias at rabbitmq.com>:

> On 20/05/14 09:35, Simon MacMullen wrote:
>
>> On 20/05/2014 9:30AM, kevin lettier wrote:
>>
>>> When I'm running Java example from GitHub (with 'x-max-priority' arg set
>>> on queue) the messages are received in the same order as I sent them.
>>>
>>
>> First guess: could you have declared the queue beforehand with the
>> 'x-max-priority' argument not set, or with it set but the plugin not
>> installed?
>>
>
> ...or perhaps the consumer was created before the publisher, so the
> messages just went straight through.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/48863465/attachment.html>

From matthias at rabbitmq.com  Tue May 20 10:06:37 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:06:37 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>	<537B13E6.7040408@rabbitmq.com>	<537B14EE.6080709@rabbitmq.com>
 <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
Message-ID: <537B1B1D.5030309@rabbitmq.com>

On 20/05/14 10:01, kevin lettier wrote:
> I use the Java example so the queue was created once with
> 'x-max-priority' arg set to 10
> I deleted the queue and re-launch the code but unfortunately it does not
> work :(

You didn't respond to my question/suggestion, namely that perhaps a 
consumer exists when the messages are published, in which case the 
published messages are passed straight to that consumer, with no 
opportunity for the priority queue to re-order the messages since no 
messages actually ever get enqueued.

Matthias.

From matthias at rabbitmq.com  Tue May 20 10:31:40 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:31:40 +0100
Subject: [rabbitmq-discuss] Recover crashing node
In-Reply-To: <1400098806384-35551.post@n5.nabble.com>
References: <1400088674666-35540.post@n5.nabble.com>
 <etPan.5373ac65.625558ec.b629@mercurio.local>
 <1400090769247-35543.post@n5.nabble.com>
 <1400092049293-35544.post@n5.nabble.com>
 <etPan.5373b81c.46e87ccd.b629@mercurio.local>
 <1400094206608-35546.post@n5.nabble.com>
 <etPan.5373c0b5.507ed7ab.b629@mercurio.local>
 <1400098806384-35551.post@n5.nabble.com>
Message-ID: <537B20FC.30805@rabbitmq.com>

On 14/05/14 21:20, ranjitiyer wrote:
> MK, I'd configure the RABBITMQ_MNESIA_BASE to be a network share so B has
> access to A's DB.
>
> If A went down last but never came up (say the machine was permanently taken
> down), I don't want to lose those messages. So when B comes up (by resetting
> itself because I can't reach A) I am looking for a way by which B can import
> A's messages into it's own database.

Do you want to *add* A's data to B or *replace* B's data with A's? There 
is no (easy) way to do the former. For the latter, change B's hostname 
to A and then just use A's data instead of (what used to be) B's.

Matthias.

From lettier.kevin at gmail.com  Tue May 20 10:34:28 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Tue, 20 May 2014 11:34:28 +0200
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <537B1B1D.5030309@rabbitmq.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com> <537B14EE.6080709@rabbitmq.com>
 <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
 <537B1B1D.5030309@rabbitmq.com>
Message-ID: <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>

No consumer exists when I sent the messages, I put a break point in the
code and see that messages are correctly enqueue (I see them in Management
plugin) and dequeue when I continue the execution of the program.
I tried Reset Rabbitmq on my server and re-configure it but nothing change.


2014-05-20 11:06 GMT+02:00 Matthias Radestock <matthias at rabbitmq.com>:

> On 20/05/14 10:01, kevin lettier wrote:
>
>> I use the Java example so the queue was created once with
>> 'x-max-priority' arg set to 10
>> I deleted the queue and re-launch the code but unfortunately it does not
>> work :(
>>
>
> You didn't respond to my question/suggestion, namely that perhaps a
> consumer exists when the messages are published, in which case the
> published messages are passed straight to that consumer, with no
> opportunity for the priority queue to re-order the messages since no
> messages actually ever get enqueued.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/865a14fa/attachment.html>

From matthias at rabbitmq.com  Tue May 20 10:40:04 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:40:04 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>	<537B13E6.7040408@rabbitmq.com>	<537B14EE.6080709@rabbitmq.com>	<CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>	<537B1B1D.5030309@rabbitmq.com>
 <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>
Message-ID: <537B22F4.1020007@rabbitmq.com>

On 20/05/14 10:34, kevin lettier wrote:
> No consumer exists when I sent the messages, I put a break point in the
> code and see that messages are correctly enqueue (I see them in
> Management plugin) and dequeue when I continue the execution of the program.

What happens when you use the management UI to create the queue, publish 
and fetch messages? Do priorities work fine then?

Matthias.

From matthias at rabbitmq.com  Tue May 20 10:44:45 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:44:45 +0100
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <CABm-WmdUDm2TH59AxKA0eU+LC9AZ7WjQnYDbvbafSmnJFKWR6Q@mail.gmail.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
 <537323B3.1020002@rabbitmq.com>
 <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>
 <5374989A.6020002@rabbitmq.com>
 <CABm-WmdUDm2TH59AxKA0eU+LC9AZ7WjQnYDbvbafSmnJFKWR6Q@mail.gmail.com>
Message-ID: <537B240D.1040606@rabbitmq.com>

On 15/05/14 16:05, Sean Allen wrote:
> would it make sense to see the same issue on mirrored versions of the
> queue but see if take much longer for that node to return to a
> "normal" level of memory usage?

Yes, since queue slaves can "churn" more binary data than masters.

Matthias.

From matthias at rabbitmq.com  Tue May 20 10:49:46 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:49:46 +0100
Subject: [rabbitmq-discuss] Convert sync to async by time
In-Reply-To: <1400177682486-35586.post@n5.nabble.com>
References: <1400177682486-35586.post@n5.nabble.com>
Message-ID: <537B253A.7050704@rabbitmq.com>

On 15/05/14 19:14, RabbitLove wrote:
> Is there a way to convert sync message to asynchronous by the timeout? For
> example, if a sync request is running longer than 10 second, I would like to
> change it to the async request.

Assuming by "message" you mean "AMQP command" (since publishing of 
actual messages is always async in AMQP) then no, that is not possible.

Some client libraries might provide timeouts for synchronous commands 
but the spec forbids clients from pipelining synchronous commands on the 
same channel, so clients would not be able to send a subsequent 
synchronous command until a response to the prior command has been received.

Matthias.

From matthias at rabbitmq.com  Tue May 20 10:54:43 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 May 2014 10:54:43 +0100
Subject: [rabbitmq-discuss] Starting RabbitMQ using Fully qualified
 machine name - parse errors
In-Reply-To: <1400562112484-35676.post@n5.nabble.com>
References: <1400562112484-35676.post@n5.nabble.com>
Message-ID: <537B2663.3070800@rabbitmq.com>

On 20/05/14 06:01, ranjitiyer wrote:
> I modified rabbitmq-server.bat to pass in "-name" to erl so I can run my
> nodes using fully qualified names.  Rabbit seems to start fine but I see
> these parse errors. Can someone shed light?
>
> <http://rabbitmq.1065348.n5.nabble.com/file/n35676/rabbit-error.jpg>

Looks like your /etc/hosts file contains invalid (as far as Erlang is 
concerned) entries on lines 5, 6 and 8.

Matthias.

From lettier.kevin at gmail.com  Tue May 20 11:01:53 2014
From: lettier.kevin at gmail.com (kevin lettier)
Date: Tue, 20 May 2014 12:01:53 +0200
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <537B22F4.1020007@rabbitmq.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com> <537B14EE.6080709@rabbitmq.com>
 <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
 <537B1B1D.5030309@rabbitmq.com>
 <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>
 <537B22F4.1020007@rabbitmq.com>
Message-ID: <CAFLu_aYEiJ7d_7-nAWR18S__Q4gWvtaT_RKfsD-6fVYYkTF12Q@mail.gmail.com>

No, same results, no priority is applied


2014-05-20 11:40 GMT+02:00 Matthias Radestock <matthias at rabbitmq.com>:

> On 20/05/14 10:34, kevin lettier wrote:
>
>> No consumer exists when I sent the messages, I put a break point in the
>> code and see that messages are correctly enqueue (I see them in
>> Management plugin) and dequeue when I continue the execution of the
>> program.
>>
>
> What happens when you use the management UI to create the queue, publish
> and fetch messages? Do priorities work fine then?
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/fc108fb4/attachment.html>

From simon at rabbitmq.com  Tue May 20 11:11:09 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 May 2014 11:11:09 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <CAFLu_aYEiJ7d_7-nAWR18S__Q4gWvtaT_RKfsD-6fVYYkTF12Q@mail.gmail.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com> <537B14EE.6080709@rabbitmq.com>
 <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
 <537B1B1D.5030309@rabbitmq.com>
 <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>
 <537B22F4.1020007@rabbitmq.com>
 <CAFLu_aYEiJ7d_7-nAWR18S__Q4gWvtaT_RKfsD-6fVYYkTF12Q@mail.gmail.com>
Message-ID: <537B2A3D.4040504@rabbitmq.com>

On 20/05/2014 11:01AM, kevin lettier wrote:
> No, same results, no priority is applied

OK, we'll have to debug this then. Can you send me the output of 
"rabbitmqctl report" with the plugin enabled and a supposed priority 
queue declared?

I will also look at adding better diagnostics to the plugin, currently 
it doesn't tell you much.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Tue May 20 11:21:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 May 2014 14:21:34 +0400
Subject: [rabbitmq-discuss] loop_forever() from paho-mqtt python client
 prevents rabbitmq from stopping
In-Reply-To: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
References: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
Message-ID: <etPan.537b2cca.66ef438d.784c@mercurio.local>

On 16 May 2014 at 11:35:01, Sok Ann Yap (sokann at gmail.com) wrote:
> > Steps to reproduce (on debian/ubuntu):
>  
> 1. Install rabbitmq-server version 3.3.1 following
> http://www.rabbitmq.com/install-debian.html
> 2. As root, run `rabbitmq-plugins enable rabbitmq_mqtt;
> /etc/init.d/rabbitmq-server restart` to enable the mqtt plugin  
> 3. As root, run `easy_install paho-mqtt` to install paho-mqtt  
> version 0.9
> 4. Copy the sample code from the "Getting Started" section of  
> https://pypi.python.org/pypi/paho-mqtt/0.9 as mqtt_test.py,  
> replace
> iot.eclipse.org(http://iot.eclipse.org) with localhost  
> 5. Run `python mqtt_test.py`, which will print "Connected with  
> result
> code 0" and then loop forever
> 6. As root, run `/etc/init.d/rabbitmq-server stop`
>  
> Attached is a sample log file. Step 5 happened on 09:33:28(http://airmail.calendar/2014-05-20%2009:33:28%20GMT+4).  
> Step 6
> happened on 09:33:39(http://airmail.calendar/2014-05-20%2009:33:39%20GMT+4).  
> On 09:39:42(http://airmail.calendar/2014-05-20%2009:39:42%20GMT+4),  
> I went to the console running the
> python script, and pressed Ctrl+C. The rabbitmq process was  
> able to
> stop following that.

I'm able to reproduce this. Investigating.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue May 20 12:08:22 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 May 2014 12:08:22 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work
In-Reply-To: <537B2A3D.4040504@rabbitmq.com>
References: <CAFLu_aYuayKR5p1ETUwurVinrG-wkAXasbuhuHCbU6G1TgVSNw@mail.gmail.com>
 <537B13E6.7040408@rabbitmq.com> <537B14EE.6080709@rabbitmq.com>
 <CAFLu_aaTQaM2-EjZUf8T7tZA=9J7_tJtvCniFUT6ZURYmdPjew@mail.gmail.com>
 <537B1B1D.5030309@rabbitmq.com>
 <CAFLu_aYk3Bv0oajXn2quY4jJ4LZvfs_ucWc_=GF7xH-JjVTmdw@mail.gmail.com>
 <537B22F4.1020007@rabbitmq.com>
 <CAFLu_aYEiJ7d_7-nAWR18S__Q4gWvtaT_RKfsD-6fVYYkTF12Q@mail.gmail.com>
 <537B2A3D.4040504@rabbitmq.com>
Message-ID: <537B37A6.8070707@rabbitmq.com>

On 20/05/2014 11:11AM, Simon MacMullen wrote:
> OK, we'll have to debug this then. Can you send me the output of
> "rabbitmqctl report" with the plugin enabled and a supposed priority
> queue declared?

(And for everyone else following this thread, it turned out to be a 
permission problem.)

> I will also look at adding better diagnostics to the plugin, currently
> it doesn't tell you much.

I will still do this though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Tue May 20 13:09:05 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 20 May 2014 08:09:05 -0400
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCvmydt=UJxj0MfeCJB9pDnr-JzG8FaY1AOw0guqLkYDkA@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
 <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
 <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>
 <CANpjuCvmydt=UJxj0MfeCJB9pDnr-JzG8FaY1AOw0guqLkYDkA@mail.gmail.com>
Message-ID: <CAKgmDnHxmxz2+sy9FcCdNnYj=L-+CB8mXYhw40qq_X6jjh0zSA@mail.gmail.com>

> I like the idea of being able to keep a large "buffer" so to speak of
> recently sent messages available for analysis. So, a failed batch job could
> very easily inspect the actual messages that were persisted/sent in an
> effort to debug. That is pretty sweet. Cassandra is very nice for this as
> well, since persistence to C* is can be delegated to a consumer in the
> buffer layer or core. Do you simply shovel everything to a particular path
> queue for something to persist to Cassandra? Or is that done inline
> somewhere before publishing to RabbitMQ? I assume that that kind of thing
> is done out-of-band of the client.
>

'cache_push' and 'cache_pull' are currently done in the central (switching)
core in parallel with other operations. They will be run on our autoscaling
edge nodes also as soon as demand warrants. The clients never work directly
with the cache and, in fact, we have used DynamoDB, Riak, etc. in the past
as implementations. We are happiest w Cassandra because it is very fast,
free to use, easy to manage, and scales.


>
>
>> We also 'journal' all messages with ttl of 30 days. It has worked well
>> for us and we can easily scale up and down. The fast generalized cache
>> makes it possible to support quite interesting apps.
>>
>
> Hmm. I'm not sure I follow. What do you mean by journal?
>

Each message is stored by timestamp like a log. It's slightly more
complicated than that in practice, to avoid hotspots, but the idea is to
have a complete sequential record of all activity for analysis and replay.


>
> I am also curious about some of the things you do with Fabrik... For
> example, is persistence handled by the client (indirectly via the Fabrik
> library) or some other component service that listens to RabbitMQ?
>

The fabrik handles persistence on behalf of the client. We have
parallelized event-driven python services that do this using the pika and
cassandra-driver modules. Examples and benchmarks, including a version of
our 'rabbit_helpers' framework, will be open-sourced for my Cassandra Day
presentation on 21 June in NYC at our office.

To be clear, each of our python services is quite small and focused: they
subscribe to one or a few queues and publish to an exchange or 2. So
'cache_pull' and 'cache_push', and our other services, are not libraries
others use, they are services that respond only via AMQP. Hence they are
'black boxes', with internals hidden, and are easy to test.


>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/e6fb9944/attachment.html>

From dwang7630 at gmail.com  Tue May 20 11:45:48 2014
From: dwang7630 at gmail.com (dwang7630 at gmail.com)
Date: Tue, 20 May 2014 03:45:48 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 Can not login with Open Ldap
Message-ID: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>

*Dear All*
*I'm config plugin LDAP for RabbitMQ 3.3.0. And this is the contents of 
config file*


>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *[  {rabbit, [     {tcp_listeners, [{"172.16.1.10",5672}]},    
>  {ssl_listeners, [{"172.16.1.10",5671}]},     {ssl_options, 
> [{cacertfile,"/etc/rabbitmq/ssl/nvca/cacert.pem"},                    
> {certfile,"/etc/rabbitmq/ssl/server/cert.pem"},                    
> {keyfile,"/etc/rabbitmq/ssl/server/key.pem"},                    
> {verify,verify_none},                    {fail_if_no_peer_cert,false}]},    
>  {heartbeat, 15},     {vm_memory_high_watermark_paging_ratio, 0.75},    
>  {vm_memory_high_watermark, 0.4},     {auth_backends, 
> [{rabbit_auth_backend_ldap, rabbit_auth_backend_internal},                  
>         rabbit_auth_backend_internal]},     {disk_free_limit, 40000000000}  
> ]},  {rabbitmq_auth_backend_ldap,   [ {servers,               
> ["10.0.10.10"]},     {user_dn_pattern,       
> "cn=${username},dc=scholar,dc=com"},     {dn_lookup_base,       
>  "dc=scholar,dc=com"},     {other_bind,           
> {"cn=manager,cn=internal,dc=scholar,dc=com","eRwFTGDFTooNI5ca"}},    
>  {use_ssl,               false},     {port,                  389},    
>  {log,                   network},     {tag_queries,           
> [{administrator, {constant, true}},                                    
> {management,    {constant, true}}]}   ]  }].*


*After that, i'm try login, but fail. And this is a log file *


>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *=INFO REPORT==== 20-May-2014::02:39:58 ===Server startup complete; 10 
> plugins started. * amqp_client * eldap * mochiweb * 
> rabbitmq_auth_backend_ldap * rabbitmq_auth_mechanism_ssl * 
> rabbitmq_federation_management * rabbitmq_management * 
> rabbitmq_management_agent * rabbitmq_web_dispatch * webmachine=INFO 
> REPORT==== 20-May-2014::02:40:04 ===LDAP CHECK: login for david.wang=INFO 
> REPORT==== 20-May-2014::02:40:04 ===        LDAP filling template 
> "cn=${username},dc=scholar,dc=com" with            
> [{username,<<"david.wang">>}]=INFO REPORT==== 20-May-2014::02:40:04 ===    
>     LDAP template result: "cn=david.wang,dc=scholar,dc=com"=INFO REPORT==== 
> 20-May-2014::02:40:04 ===    LDAP connecting to servers: 
> ["10.0.10.10"]=INFO REPORT==== 20-May-2014::02:40:04 ===    LDAP network 
> traffic: bind request = {'BindRequest',3,                                  
>         "cn=david.wang,dc=scholar,dc=com",                                  
>         {simple,<<"abc123a@">>}}=INFO REPORT==== 20-May-2014::02:40:04 ===  
>   LDAP network traffic: bind reply = {ok,                                  
>       {'LDAPMessage',1,                                        
>  {bindResponse,                                          
> {'BindResponse',invalidCredentials,                                        
>    [],[],asn1_NOVALUE,asn1_NOVALUE}},                                      
>    asn1_NOVALUE}}=INFO REPORT==== 20-May-2014::02:40:04 ===    LDAP bind 
> returned "invalid credentials": cn=david.wang,dc=scholar,dc=com=INFO 
> REPORT==== 20-May-2014::02:40:04 ===LDAP DECISION: login for david.wang: 
> denied=ERROR REPORT==== 20-May-2014::02:40:04 ===webmachine error: 
> path="/api/whoami""Unauthorized"*



*I'm read "Common errors encountered when using OpenLDAP Software" on 
website openldap.org. *
*And know The error usually occurs when the credentials (password) provided 
does not match the userPassword held in entry you are binding to, or the 
error can also occur when the bind DN specified is not known to the server.*
*After that i'm check both, but it's correct.*

*This is the LDAP information*
>
>
> *LDAP Base DN dc=scholar,dc=comLDAP Bind DN 
> cn=manager,cn=internal,dc=scholar,dc=comLDAP Bind Password eRwFTGDFTooNI5ca*


Anybody help me please.
Thanks & Regards...!!! 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/2fafced5/attachment.html>

From steve at rabbitmq.com  Tue May 20 15:43:51 2014
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 20 May 2014 15:43:51 +0100
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <1400566217649-35678.post@n5.nabble.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
 <1400517463441-35662.post@n5.nabble.com>
 <1400566217649-35678.post@n5.nabble.com>
Message-ID: <8293EC1B-2DB1-4473-92C3-29E76EF6D867@rabbitmq.com>

Hi, sorry I didn?t see this before today.

It looks to me as though the JNDI server is populated with an older com.rabbitmq.jms.admin.RMQConnectionFactory version.  In RJMS 1.1.0 some extensions were made to the JNDI for connection factories to allow for ssl connections and the AMQP interoperability feature.  This meant that previously serialised RMQConnectionFactory objects (for example in a JNDI server store) are not de-serializable under later versions of RJMS.

The solution to your problem would be to re-populate the JNDI server with RMQConnectionFactory objects created with the same level of RJMS as the application is expecting.

Please come back to me, if this doesn?t? fix it.

Steve Powell  [Cell: +44-7815-838-558]
    Good design [?] is as little design as possible.    Dieter Rams

On 20 May 2014, at 07:10, scguy <npetrace at gmail.com> wrote:

> Looks like this might be version related?  I "downgraded" to rabbitmq-server
> 3.1.5 and rabbitmq-jms-1.0.5 and everything worked.  Further suggestions or
> comments on this are appreciated.
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35678.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/5e98f64f/attachment.html>

From npetrace at gmail.com  Tue May 20 15:54:36 2014
From: npetrace at gmail.com (scguy)
Date: Tue, 20 May 2014 07:54:36 -0700 (PDT)
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <8293EC1B-2DB1-4473-92C3-29E76EF6D867@rabbitmq.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
 <1400517463441-35662.post@n5.nabble.com>
 <1400566217649-35678.post@n5.nabble.com>
 <8293EC1B-2DB1-4473-92C3-29E76EF6D867@rabbitmq.com>
Message-ID: <1400597676012-35704.post@n5.nabble.com>

No problem...thanks for the response!  In this case, I am not using a
separate JNDI server; the application simply uses a .bindings file and the
com.sun.jndi.fscontext.RefFSContextFactory context factory.  Would the
entries in my .bindings file need to change for the later version of
RabbitMQ/RJMS?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35704.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jeffrey.a.becker at gmail.com  Tue May 20 17:16:42 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Tue, 20 May 2014 09:16:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Error with SSL
Message-ID: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>

I'm attempting to configure RabbitMQ with SSL using client certificates for 
authentication on a windows server 2012 x64 box.  The Erlang version 
installed is OTP 17.0 for Windows x64, 
Configuration is as such:
 {rabbit,  [ 
    {ssl_listeners, [5671]},
    {auth_mechanisms, ['EXTERNAL']},
    {auth_backends, [rabbit_auth_backend_ldap, 
rabbit_auth_backend_internal]},
    {ssl_options, [{cacertfile,"D:\\RabbitMQ\\certs\\cacert.pem"},
                  {certfile,"D:\\RabbitMQ\certs\\rabbit.pem"},
                  {keyfile,"D:\\RabbitMQ\\certs\\rabbit.key"},
                  {verify,verify_peer},
  {ssl_cert_login_from, common_name},
                  {fail_if_no_peer_cert,true}]} 

  ]},

Whenever I connect, the client throws an error and the log file gets an 
entry like:

error on AMQP connection <0.310.0>: 
{ssl_upgrade_error,{options,{certfile,[68,58,92...

I've gone through the SSL Trouble shooting guide and confirmed that:

   - The certs are in the PEM format
   - The Broker is listening on the correct ports
   

The last bit of the trouble shooting guide indicates that "This is a 
generic error that could have many causes. Make sure you are using the 
recommended version of Erlang." Is there a version of Erlang I should be 
using other than OTP 17.0?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/e2840c17/attachment.html>

From simon at rabbitmq.com  Tue May 20 17:27:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 May 2014 17:27:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 Can not login with Open Ldap
In-Reply-To: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
References: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
Message-ID: <537B8264.3010107@rabbitmq.com>

On 20/05/2014 11:45AM, dwang7630 at gmail.com wrote:
> *I'm read "Common errors encountered when using OpenLDAP Software" on
> website openldap.org.
> *
> *And know The error usually occurs when the credentials (password)
> provided does not match the userPassword held in entry you are binding
> to, or the error can also occur when the bind DN specified is not known
> to the server.*
> *After that i'm check both, but it's correct.*

Hmm. The thing is, you *are* getting this:

> =INFO REPORT==== 20-May-2014::02:40:04 ===
>     LDAP network traffic: bind request = {'BindRequest',3,
>                                           "cn=david.wang,dc=scholar,dc=com",
>                                           {simple,<<"abc123a@">>}}
> =INFO REPORT==== 20-May-2014::02:40:04 ===
>     LDAP network traffic: bind reply = {ok,
>                                         {'LDAPMessage',1,
>                                          {bindResponse,
>                                           {'BindResponse',invalidCredentials,
>                                            [],[],asn1_NOVALUE,asn1_NOVALUE}},
>                                          asn1_NOVALUE}}

That really is the LDAP server saying your credentials are invalid. Can 
you connect using these credentials using any other LDAP client? (e.g. 
Apache Directory Studio, ldapsearch, whatever)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From greg.poirier at opower.com  Tue May 20 17:49:41 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Tue, 20 May 2014 09:49:41 -0700
Subject: [rabbitmq-discuss] 3.3.1 Management Console: "Not Found"
Message-ID: <CANpjuCst4VMUOAnV6316DPu9xkZPy6Cqe2NYpdFVFWAz6qyHPA@mail.gmail.com>

I have a 3-node cluster running 3.3.1 with 2 disk and 1 ram node. The RAM
node (may be a red herring, not sure) is currently displaying only: "Not
Found" when I attempt to connect to the management console.

rabbitmqctl status says that the management plugin is up and running:

Status of node 'rabbit at dev-rabbitmq-1005' ...
[{pid,27060},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.3.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.3.1"},
      {rabbit,"RabbitMQ","3.3.1"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.3.1"},
      {webmachine,"webmachine","1.10.3-rmq3.3.1-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.3.1-git680dba8"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.3.1"},
      {ssl,"Erlang/OTP SSL application","4.1.6"},
      {public_key,"Public key infrastructure","0.13"},
      {crypto,"CRYPTO version 2","2.0.4"},
      {asn1,"The Erlang ASN1 compiler version 1.6.18","1.6.18"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,89013360},
      {connection_procs,812000},
      {queue_procs,611688},
      {plugins,300776},
      {other_proc,9746376},
      {mnesia,219952},
      {mgmt_db,11840},
      {msg_index,1086432},
      {other_ets,6219592},
      {binary,8045192},
      {code,19622549},
      {atom,2313537},
      {other_system,40023426}]},
 {alarms,[]},
 {listeners,
     [{clustering,9100,"::"},
      {amqp,5672,"0.0.0.0"},
      {'amqp/ssl',5671,"0.0.0.0"}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,4995638886},
 {disk_free_limit,50000000},
 {disk_free,27163828224},
 {file_descriptors,
     [{total_limit,65436},
      {total_used,28},
      {sockets_limit,58890},
      {sockets_used,15}]},
 {processes,[{limit,1048576},{used,349}]},
 {run_queue,0},
 {uptime,437829}]
...done.

The following is what's output to the browser:

Not found.

There are no errors in any of the RabbitMQ logs.

If it happens again, I will increase the log level in our configuration in
our dev environment and see if that produces any useful logs.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/fee81679/attachment.html>

From greg.poirier at opower.com  Tue May 20 18:49:52 2014
From: greg.poirier at opower.com (Greg Poirier)
Date: Tue, 20 May 2014 10:49:52 -0700
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CAKgmDnHxmxz2+sy9FcCdNnYj=L-+CB8mXYhw40qq_X6jjh0zSA@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
 <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
 <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>
 <CANpjuCvmydt=UJxj0MfeCJB9pDnr-JzG8FaY1AOw0guqLkYDkA@mail.gmail.com>
 <CAKgmDnHxmxz2+sy9FcCdNnYj=L-+CB8mXYhw40qq_X6jjh0zSA@mail.gmail.com>
Message-ID: <CANpjuCuvzjs7NpgHu73E-=xC-EryhoN2V13d5yfJEsN5Skj5rA@mail.gmail.com>

On Tue, May 20, 2014 at 5:09 AM, Laing, Michael
<michael.laing at nytimes.com>wrote:

>
> 'cache_push' and 'cache_pull' are currently done in the central
> (switching) core in parallel with other operations. They will be run on our
> autoscaling edge nodes also as soon as demand warrants. The clients never
> work directly with the cache and, in fact, we have used DynamoDB, Riak,
> etc. in the past as implementations. We are happiest w Cassandra because it
> is very fast, free to use, easy to manage, and scales.
>

Ah. So if I'm understanding correctly, cache_push and cache_pull are
effectively microservices?

>
>
To be clear, each of our python services is quite small and focused: they
> subscribe to one or a few queues and publish to an exchange or 2. So
> 'cache_pull' and 'cache_push', and our other services, are not libraries
> others use, they are services that respond only via AMQP. Hence they are
> 'black boxes', with internals hidden, and are easy to test.
>

 Thanks again for all of the clarification. It has been immensely helpful.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/8b8d26e3/attachment.html>

From michael.laing at nytimes.com  Tue May 20 19:55:45 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 20 May 2014 14:55:45 -0400
Subject: [rabbitmq-discuss] RabbitMQ and batch processing
In-Reply-To: <CANpjuCuvzjs7NpgHu73E-=xC-EryhoN2V13d5yfJEsN5Skj5rA@mail.gmail.com>
References: <CANpjuCvRcHwA_b7PPm41_fhsPheOCZtars48nJWsOt1y34JxTw@mail.gmail.com>
 <CAKgmDnG-sKm-eVb7msFp5ZnAjTDp7WC+Asq3JjQXstcyhERHTg@mail.gmail.com>
 <CANpjuCvex7U+FP=9DuAtrZ_gQ2PjLcKDzY70Vz3WU5t5_UobpQ@mail.gmail.com>
 <CAKgmDnFvg=EtBE5N-+U7GdUYv2Ju-TZ90o89=ia8_Dq6uNzjtA@mail.gmail.com>
 <CANpjuCs-zSanUvqw7Gn5Bb0XWWwFJcdPT9vPdnSGBeme91zcfQ@mail.gmail.com>
 <CAKgmDnHc49iiwP7EgNR9oizW6ULUXJDJnvYLq6qT+HHQ3D-93g@mail.gmail.com>
 <CANpjuCvmydt=UJxj0MfeCJB9pDnr-JzG8FaY1AOw0guqLkYDkA@mail.gmail.com>
 <CAKgmDnHxmxz2+sy9FcCdNnYj=L-+CB8mXYhw40qq_X6jjh0zSA@mail.gmail.com>
 <CANpjuCuvzjs7NpgHu73E-=xC-EryhoN2V13d5yfJEsN5Skj5rA@mail.gmail.com>
Message-ID: <CAKgmDnGWPt2HKXzj0FTjJPRrrL=KzdO2JVc6mSEfLWvu=44ayg@mail.gmail.com>

>
>
> Ah. So if I'm understanding correctly, cache_push and cache_pull are
> effectively microservices?
>

The fabrik is a cooperating collection of 'microservices'. Reducing
complexity is the goal, which is very much facilitated by RabbitMQ.

_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/bc3e4b52/attachment.html>

From srinatsr at cisco.com  Tue May 20 20:09:21 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 20 May 2014 19:09:21 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>


Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ...*
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/f8caa816/attachment.html>

From srinatsr at cisco.com  Tue May 20 20:17:15 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 20 May 2014 19:17:15 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <CAD6m6fGYHDMsmgkhZAKM46TyLyDyoWDUno=eDWVeSiBvKLCWYQ@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1074F@xmb-aln-x10.cisco.com>
 <CAD6m6fGYHDMsmgkhZAKM46TyLyDyoWDUno=eDWVeSiBvKLCWYQ@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB10E7F@xmb-aln-x10.cisco.com>

I need to handle in consumer side.  How to achieve the same ?



Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jason McIntosh
Sent: Monday, May 19, 2014 11:04 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

Take a look sometime at the newest AMQP libraries on this.  The latest release adds a retry handler.  Before that, you can look at spring-amqp-extras:
https://github.com/CARFAX/spring-amqp-extras/tree/e50d353a6fa83d85e5d1039ad504c917d812b062

For spring amqp 1.3:
http://docs.spring.io/spring-amqp/docs/1.3.3.RELEASE/reference/html/whats-new.html#d4e152

Jason


On Mon, May 19, 2014 at 12:47 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:


Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/8bf44bf9/attachment.html>

From srinatsr at cisco.com  Tue May 20 20:20:42 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 20 May 2014 19:20:42 +0000
Subject: [rabbitmq-discuss] Requeue message to queue back after
	exception(unack)
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB10EA2@xmb-aln-x10.cisco.com>

Hello,

How to requeue the message to queue for only 3 times.  Right it keeps on reqeueing infinite times if I throw any exception in my consumer.


Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/33d51781/attachment.html>

From grussell at gopivotal.com  Tue May 20 20:24:05 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Tue, 20 May 2014 15:24:05 -0400
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
Message-ID: <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>

@Bean
public MethodInterceptor retryAdvice() {
FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
backOffPolicy.setBackOffPeriod(10000);;
return RetryInterceptorBuilder.stateful()
.backOffPolicy(backOffPolicy)
.maxAttempts(3)
.recoverer(new RejectAndDontRequeueRecoverer())
.build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a
stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped
or sent to a Dead Letter Exchange of so configured).



On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>
>
> Hello,
>
>
>
> I am consuming the messages using the listener as follows,  I need to
> retry processing three times if any exceptions occurred.
>
>
>
> <bean
>
>         class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>         <property name=*"connectionFactory"* ref=*"connectionFactory"* />
>
>         <property name=*"queueNames"*>
>
>             <array>
>
>                 <value>validateRequestQueue</value>
>
>             </array>
>
>         </property>
>
>         <property name=*"messageListener"*>
>
>             <bean
>
>                 class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                 <property name=*"delegate"* ref=*"retryConsumer"* />
>
>             </bean>
>
>         </property>
>
>         <!-- <property name="acknowledgeMode" value="NONE" /> -->
>
>     </bean>
>
>
>
>
>
> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
>
>
>
>        /**
>
>        * Callback for processing a received Rabbit message.
>
>        * *@param* message the received AMQP message
>
>        * *@param* channel the underlying Rabbit Channel
>
>        * *@throws* Exception
>
>         */
>
>        @Override
>
>        *public* *void* onMessage(Message message, Channel channel)
> *throws* Exception {
>
>
>
>              System.*out*.println("Received Message :: "+*new*String(message.getBody()));
>
>              *if*(*true*){
>
>              *throw* *new* RuntimeException("Error");
>
>              }
>
>
>
>        }
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
> Cisco)
> *Sent:* Monday, May 19, 2014 10:47 AM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Retry Message for 3 times with 10 seconds interval - in
> Consumer
>
>
>
>
>
> Retry unacknowledged RabbitMQ message in 10 second interval
>
> And Retry 3 times using Spring framework in java .
>
>
>
> Please need help on this
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/51f2f6c4/attachment.html>

From srinatsr at cisco.com  Tue May 20 20:29:57 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Tue, 20 May 2014 19:29:57 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>

Thanks  do you have xml version of the following?

I need to set message id before publishing the message?  How to do this?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:24 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

@Bean
public MethodInterceptor retryAdvice() {
     FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
     backOffPolicy.setBackOffPeriod(10000);;
     return RetryInterceptorBuilder.stateful()
          .backOffPolicy(backOffPolicy)
          .maxAttempts(3)
          .recoverer(new RejectAndDontRequeueRecoverer())
          .build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped or sent to a Dead Letter Exchange of so configured).


On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ??
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/8504395b/attachment.html>

From mklishin at gopivotal.com  Tue May 20 20:34:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 May 2014 23:34:33 +0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
Message-ID: <etPan.537bae65.74b0dc51.8fb9@mercurio.local>

On 20 May 2014 at 20:19:12, Jeffrey Becker (jeffrey.a.becker at gmail.com) wrote:
> > Whenever I connect, the client throws an error and the log file  
> gets an entry like:
>  
> error on AMQP connection <0.310.0>: {ssl_upgrade_error,{options,{certfile,[68,58,92...  

Is the cert file readable by RabbitMQ process??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 20 20:39:59 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 20 May 2014 23:39:59 +0400
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
Message-ID: <etPan.537bafab.2ae8944a.8fb9@mercurio.local>

?On 20 May 2014 at 23:31:21, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > I need to set message id before publishing the message? How to  
> do this?

Section 3.4.1 in
http://docs.spring.io/spring-amqp/docs/1.3.1.RELEASE/reference/html/amqp.html

answers your question.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From grussell at gopivotal.com  Tue May 20 20:48:07 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Tue, 20 May 2014 15:48:07 -0400
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
Message-ID: <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>

To configure the retry advice in XML, you need to wire up
a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy
and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can
set it directly, or if you are using message conversion, set
the createMessageIds to true on the outbound template's
SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in
using stateful retry.


On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>  Thanks  do you have xml version of the following?
>
>
>
> I need to set message id before publishing the message?  How to do this?
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Tuesday, May 20, 2014 12:24 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> @Bean
>
> public MethodInterceptor retryAdvice() {
>
>      FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
>
>      backOffPolicy.setBackOffPeriod(10000);;
>
>      return RetryInterceptorBuilder.stateful()
>
>           .backOffPolicy(backOffPolicy)
>
>           .maxAttempts(3)
>
>           .recoverer(new RejectAndDontRequeueRecoverer())
>
>           .build();
>
> }
>
>
>
> Add it to the adviceChain property of the SimpleMessageListenerContainer.
>
>
>
> Note: stateful retry requires the message to have a message id; use a
> stateless advice otherwise.
>
>
>
> After the retries are exhausted, the message will be rejected (and dropped
> or sent to a Dead Letter Exchange of so configured).
>
>
>
>
>
> On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
>
>
> Hello,
>
>
>
> I am consuming the messages using the listener as follows,  I need to
> retry processing three times if any exceptions occurred.
>
>
>
> <bean
>
>         class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>         <property name=*"connectionFactory"* ref=*"connectionFactory"* />
>
>         <property name=*"queueNames"*>
>
>             <array>
>
>                 <value>validateRequestQueue</value>
>
>             </array>
>
>         </property>
>
>         <property name=*"messageListener"*>
>
>             <bean
>
>                 class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                 <property name=*"delegate"* ref=*"retryConsumer"* />
>
>             </bean>
>
>         </property>
>
>         <!-- <property name="acknowledgeMode" value="NONE" /> -->
>
>     </bean>
>
>
>
>
>
> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
>
>
>
>        /**
>
>        * Callback for processing a received Rabbit message.
>
>        * *@param* message the received AMQP message
>
>        * *@param* channel the underlying Rabbit Channel
>
>        * *@throws* Exception
>
>         */
>
>        @Override
>
>        *public* *void* onMessage(Message message, Channel channel)
> *throws* Exception {
>
>
>
>              System.*out*.println("Received Message :: "+*new*String(message.getBody()));
>
>              *if*(*true*){
>
>              *throw* *new* RuntimeException("Error");
>
>              }
>
>
>
>        }
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
> Cisco)
> *Sent:* Monday, May 19, 2014 10:47 AM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Retry Message for 3 times with 10 seconds interval - in
> Consumer
>
>
>
>
>
> Retry unacknowledged RabbitMQ message in 10 second interval
>
> And Retry 3 times using Spring framework in java .
>
>
>
> Please need help on this
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/c107df17/attachment.html>

From bobtfish at bobtfish.net  Tue May 20 21:08:48 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Tue, 20 May 2014 21:08:48 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
Message-ID: <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>


On May 20, 2014, at 1:32 AM, Tomas Doran <bobtfish at bobtfish.net> wrote:
> 
> I?m trying to work up a Vagrant box which reproduces my setup faithfully enough to replicate the leak I?m seeing - I?ll share my results as soon as I can get there, but whilst I have a very similar setup running, I haven?t (yet) successfully been able to reproduce the leak.

https://github.com/bobtfish/rabbitmq-leak

This box can be spun up easily and (slowly) demonstrates the leak.

I?m working on optimizing it to be smaller/more specific to try and identify exactly which part of the messaging is causing the issues.

Cheers
Tom


From mcintoshj at gmail.com  Tue May 20 21:29:53 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 20 May 2014 15:29:53 -0500
Subject: [rabbitmq-discuss] 3.3.1 Management Console: "Not Found"
In-Reply-To: <CANpjuCst4VMUOAnV6316DPu9xkZPy6Cqe2NYpdFVFWAz6qyHPA@mail.gmail.com>
References: <CANpjuCst4VMUOAnV6316DPu9xkZPy6Cqe2NYpdFVFWAz6qyHPA@mail.gmail.com>
Message-ID: <CAD6m6fFNAiJSP-rKpknyvJbUK67_EmAYrDp5sXrzYmH5yc557w@mail.gmail.com>

Try clearing your browser cache and removing the URL parameters.  I've had
odd issues with caching occasionally causing problems.  On chrome or
firefox you can also hold down the "shift" button and hit the fresh icon at
the same time.  We have this occasionally when users log out then log in as
a different user with the same URL, e..g /#/queues/

Jason


On Tue, May 20, 2014 at 11:49 AM, Greg Poirier <greg.poirier at opower.com>wrote:

> I have a 3-node cluster running 3.3.1 with 2 disk and 1 ram node. The RAM
> node (may be a red herring, not sure) is currently displaying only: "Not
> Found" when I attempt to connect to the management console.
>
> rabbitmqctl status says that the management plugin is up and running:
>
> Status of node 'rabbit at dev-rabbitmq-1005' ...
> [{pid,27060},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.3.1"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.3.1"},
>       {rabbit,"RabbitMQ","3.3.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.3.1"},
>       {webmachine,"webmachine","1.10.3-rmq3.3.1-gite9359c7"},
>       {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.3.1-git680dba8"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.3.1"},
>       {ssl,"Erlang/OTP SSL application","4.1.6"},
>       {public_key,"Public key infrastructure","0.13"},
>       {crypto,"CRYPTO version 2","2.0.4"},
>       {asn1,"The Erlang ASN1 compiler version 1.6.18","1.6.18"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,89013360},
>       {connection_procs,812000},
>       {queue_procs,611688},
>       {plugins,300776},
>       {other_proc,9746376},
>       {mnesia,219952},
>       {mgmt_db,11840},
>       {msg_index,1086432},
>       {other_ets,6219592},
>       {binary,8045192},
>       {code,19622549},
>       {atom,2313537},
>       {other_system,40023426}]},
>  {alarms,[]},
>  {listeners,
>      [{clustering,9100,"::"},
>       {amqp,5672,"0.0.0.0"},
>       {'amqp/ssl',5671,"0.0.0.0"}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,4995638886},
>  {disk_free_limit,50000000},
>  {disk_free,27163828224},
>  {file_descriptors,
>      [{total_limit,65436},
>       {total_used,28},
>       {sockets_limit,58890},
>       {sockets_used,15}]},
>  {processes,[{limit,1048576},{used,349}]},
>  {run_queue,0},
>  {uptime,437829}]
> ...done.
>
> The following is what's output to the browser:
>
> Not found.
>
> There are no errors in any of the RabbitMQ logs.
>
> If it happens again, I will increase the log level in our configuration in
> our dev environment and see if that produces any useful logs.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/d1ab4747/attachment.html>

From mcintoshj at gmail.com  Tue May 20 22:00:09 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 20 May 2014 16:00:09 -0500
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <1400597676012-35704.post@n5.nabble.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
 <1400517463441-35662.post@n5.nabble.com>
 <1400566217649-35678.post@n5.nabble.com>
 <8293EC1B-2DB1-4473-92C3-29E76EF6D867@rabbitmq.com>
 <1400597676012-35704.post@n5.nabble.com>
Message-ID: <CAD6m6fHOnJ5juyUv6TizYoGN0efhzm_asxejnKdoY0wELP31JQ@mail.gmail.com>

 Based upon the class path system you listed, it appears that you're
running from with-in Eclipse?  If so, be very careful that eclipse doesn't
somehow add onto your classpath.  Just a suggestion.  First, run your app
outside of Eclipse.  Then run jconsole, connect to your local process
that's running, and go to the VM Summary tab.  Take a look at the Library
Path/Boot classpath.  Since you're using a FsContext to load JNDI through a
file provider, I'd guess an issue with different versions of the java
library due to a different version of the jar somehow making it onto your
class path.
Jason






On Tue, May 20, 2014 at 9:54 AM, scguy <npetrace at gmail.com> wrote:

> No problem...thanks for the response!  In this case, I am not using a
> separate JNDI server; the application simply uses a .bindings file and the
> com.sun.jndi.fscontext.RefFSContextFactory context factory.  Would the
> entries in my .bindings file need to change for the later version of
> RabbitMQ/RJMS?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35704.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/707058e6/attachment.html>

From sean at monkeysnatchbanana.com  Tue May 20 23:23:37 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Tue, 20 May 2014 18:23:37 -0400
Subject: [rabbitmq-discuss] queue_procs question
In-Reply-To: <537B240D.1040606@rabbitmq.com>
References: <CABm-WmdV8DZsknnqpdJAt_9hTJXgwt98FP0DMXuVPk1+3z+dXQ@mail.gmail.com>
 <537323B3.1020002@rabbitmq.com>
 <CABm-WmeOB8zEpHjCrquThFwiXaVZBbOEbA=aqgnAM1H9FYeuiA@mail.gmail.com>
 <5374989A.6020002@rabbitmq.com>
 <CABm-WmdUDm2TH59AxKA0eU+LC9AZ7WjQnYDbvbafSmnJFKWR6Q@mail.gmail.com>
 <537B240D.1040606@rabbitmq.com>
Message-ID: <CABm-WmeKRXBu0cRcPHuKEs2XX2WrOnR0amk2BNYXsLVy5NRFOA@mail.gmail.com>

On Tue, May 20, 2014 at 5:44 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/05/14 16:05, Sean Allen wrote:
>
>> would it make sense to see the same issue on mirrored versions of the
>> queue but see if take much longer for that node to return to a
>> "normal" level of memory usage?
>>
>
> Yes, since queue slaves can "churn" more binary data than masters.
>
> Matthias.
>


Thanks Mathias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/c71a9db5/attachment.html>

From mklishin at gopivotal.com  Wed May 21 04:23:41 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 07:23:41 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
Message-ID: <etPan.537c1c5b.238e1f29.8fb9@mercurio.local>


On 21 May 2014 at 00:09:48, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > https://github.com/bobtfish/rabbitmq-leak
>  
> This box can be spun up easily and (slowly) demonstrates the leak.  
>  
> I?m working on optimizing it to be smaller/more specific to try  
> and identify exactly which part of the messaging is causing the  
> issues.

Thank you, this is very helpful!
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed May 21 04:25:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 07:25:24 +0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <CACjM4Qj3Xqk_+meXCpCToBi87r9X=PKd8m0EB9tEafkc0CQO6g@mail.gmail.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <etPan.537bae65.74b0dc51.8fb9@mercurio.local>
 <CACjM4Qj3Xqk_+meXCpCToBi87r9X=PKd8m0EB9tEafkc0CQO6g@mail.gmail.com>
Message-ID: <etPan.537c1cc1.3d1b58ba.8fb9@mercurio.local>

On 20 May 2014 at 23:41:17, Jeffrey Becker (jeffrey.a.becker at gmail.com) wrote:
> > Yes.

Please try openssl s_client and openssl s_server and see if they work with your certificates/keys.
I understand that this is not convenient to do on Windows but they are the easiest way to
see more informative error messages when debugging SSL issues.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed May 21 08:54:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 11:54:53 +0400
Subject: [rabbitmq-discuss] loop_forever() from paho-mqtt python client
 prevents rabbitmq from stopping
In-Reply-To: <etPan.537b2cca.66ef438d.784c@mercurio.local>
References: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
 <etPan.537b2cca.66ef438d.784c@mercurio.local>
Message-ID: <etPan.537c5beb.7545e146.8fb9@mercurio.local>

On 20 May 2014 at 14:22:00, Michael Klishin (mklishin at gopivotal.com) wrote:
> > I'm able to reproduce this. Investigating.

FTR, the issue was fixed and the fix should be in the next 3.3.x release.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From steve at rabbitmq.com  Wed May 21 10:15:02 2014
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 21 May 2014 10:15:02 +0100
Subject: [rabbitmq-discuss] JNDI / .bindings with RabbitMQ JMS Client?
In-Reply-To: <1400597676012-35704.post@n5.nabble.com>
References: <1400370019523-35631.post@n5.nabble.com>
 <CAD6m6fFd2Ps6k95XOMu68ULSr78Xg+mkLrXhLVT8Vvbvy6woDw@mail.gmail.com>
 <1400517463441-35662.post@n5.nabble.com>
 <1400566217649-35678.post@n5.nabble.com>
 <8293EC1B-2DB1-4473-92C3-29E76EF6D867@rabbitmq.com>
 <1400597676012-35704.post@n5.nabble.com>
Message-ID: <A10BBF4B-EC14-4803-90D7-43C64075B1EB@rabbitmq.com>

Hmm, I?m not too familiar with this path, but what Jason recommends would  help you to check that the RefFSContextFactory is using the same classes as we are. The attributes are additive, so old bindings should still work.

It is possible that the Resource interface parts of the RMQConnectionFactory class aren?t working correctly, but again it was merely an extension to the previous version.

What would we need to reproduce your JNDI setup?
Steve Powell  [Cell: +44-7815-838-558]
    Good design [?] is as little design as possible.    Dieter Rams

On 20 May 2014, at 15:54, scguy <npetrace at gmail.com> wrote:

> No problem...thanks for the response!  In this case, I am not using a
> separate JNDI server; the application simply uses a .bindings file and the
> com.sun.jndi.fscontext.RefFSContextFactory context factory.  Would the
> entries in my .bindings file need to change for the later version of
> RabbitMQ/RJMS?
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/JNDI-bindings-with-RabbitMQ-JMS-Client-tp35631p35704.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/c9dae4f3/attachment.html>

From jtuley at pivotallabs.com  Tue May 20 17:51:18 2014
From: jtuley at pivotallabs.com (John Tuley)
Date: Tue, 20 May 2014 09:51:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Meaning of message_stats contents
Message-ID: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>

Hello,

We're polling the rabbitmq management REST API for stats and would like 
some help interpreting the response. (If the responses are documented 
somewhere, a pointer to that will suffice, but we weren't able to find said 
documentation.)

The response looks like

{ "node": "rabbit at node2", "arguments": {}, "auto_delete": false, "durable": 
true, "vhost": "/", "name": "NAME", "consumer_details": [ { "arguments": 
{}, "ack_required": false, "exclusive": false, "consumer_tag": "scooper", 
"queue": { "vhost": "/", "name": "dropsonde" }, "channel_details": { 
"peer_host": "IP ADDRESS", "peer_port": 33421, "connection_name": "NAME", 
"number": 1, "name": "NAME" } } ], "deliveries": [ { "channel_details": { 
"peer_host": "IP", "peer_port": 33421, "connection_name": "NAME", "number": 
1, "name": "NAME" }, "stats": { "deliver_get_details": { "rate": 1.2 }, 
"deliver_get": 39945, "deliver_no_ack_details": { "rate": 1.2 }, 
"deliver_no_ack": 39945 } } ], "policy": "test-queue", "messages_unacknowledged_details": 
{ "rate": 0 }, "messages_unacknowledged": 0, "messages_ready_details": { 
"rate": 0 }, "messages_ready": 0, "messages_details": { "rate": 0 }, 
"messages": 0, "message_stats": { "publish_details": { "rate": 1 }, 
"publish": 39946, "deliver_no_ack_details": { "rate": 1.2 }, 
"deliver_no_ack": 39945, "deliver_get_details": { "rate": 1.2 }, 
"deliver_get": 39945 }, "exclusive_consumer_tag": "", "consumers": 1, 
"memory": 109928, "slave_nodes": [ "rabbit at node0", "rabbit at node1" ], 
"synchronised_slave_nodes": [ "rabbit at node0", "rabbit at node1" ], 
"backing_queue_status": { "mirror_senders": 0, "mirror_seen": 0, 
"target_ram_count": "infinity", "pending_acks": 0, "len": 0, "q4": 0, "q3": 
0, "delta": [ "delta", "undefined", 0, "undefined" ], "q2": 0, "q1": 0, 
"ram_msg_count": 0, "ram_ack_count": 0, "next_seq_id": 0, 
"persistent_count": 0, "avg_ingress_rate": 0, "avg_egress_rate": 0, 
"avg_ack_ingress_rate": 0, "avg_ack_egress_rate": 0 }, "status": "running", 
"incoming": [ { "exchange": { "vhost": "/", "name": "" }, "stats": { 
"publish_details": { "rate": 1 }, "publish": 39946 } } ] }

Specifically, we're wondering about message_stats and the difference 
between deliver_get and deliver_no_ack. Our use case is a tool that 
periodically reports the number of messages published to our queue as well 
as the number of messages delivered (i.e. reporting flow through the 
queue). (Or maybe message_stats is the wrong place to look for that 
information?)

Thanks for the help!
? John Tuley and John Foley
Cloud Foundry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/7661748e/attachment.html>

From jeffrey.a.becker at gmail.com  Tue May 20 20:41:16 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Tue, 20 May 2014 15:41:16 -0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <etPan.537bae65.74b0dc51.8fb9@mercurio.local>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <etPan.537bae65.74b0dc51.8fb9@mercurio.local>
Message-ID: <CACjM4Qj3Xqk_+meXCpCToBi87r9X=PKd8m0EB9tEafkc0CQO6g@mail.gmail.com>

Yes.
On May 20, 2014 3:34 PM, "Michael Klishin" <mklishin at gopivotal.com> wrote:

> On 20 May 2014 at 20:19:12, Jeffrey Becker (jeffrey.a.becker at gmail.com)
> wrote:
> > > Whenever I connect, the client throws an error and the log file
> > gets an entry like:
> >
> > error on AMQP connection <0.310.0>:
> {ssl_upgrade_error,{options,{certfile,[68,58,92...
>
> Is the cert file readable by RabbitMQ process?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/777d55d6/attachment.html>

From sokann at gmail.com  Wed May 21 09:40:47 2014
From: sokann at gmail.com (Sok Ann Yap)
Date: Wed, 21 May 2014 16:40:47 +0800
Subject: [rabbitmq-discuss] loop_forever() from paho-mqtt python client
 prevents rabbitmq from stopping
In-Reply-To: <etPan.537c5beb.7545e146.8fb9@mercurio.local>
References: <CAL4H9MU6LjQwW2zp+6js1-0=mwAcWqrhvai7KQCrCGtf=fFXkg@mail.gmail.com>
 <etPan.537b2cca.66ef438d.784c@mercurio.local>
 <etPan.537c5beb.7545e146.8fb9@mercurio.local>
Message-ID: <CAL4H9MX1ZJ+yH2D=BYwEU3Z-BKNBzAPnzQoiCwMz4r-6aWESRg@mail.gmail.com>

On Wed, May 21, 2014 at 3:54 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
> On 20 May 2014 at 14:22:00, Michael Klishin (mklishin at gopivotal.com) wrote:
>> > I'm able to reproduce this. Investigating.
>
> FTR, the issue was fixed and the fix should be in the next 3.3.x release.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ

Thanks a lot Michael. Just tested the latest MQTT plugin from hg, works great!

From mklishin at gopivotal.com  Wed May 21 10:24:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 13:24:35 +0400
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
Message-ID: <etPan.537c70f1.12200854.8fb9@mercurio.local>

On 21 May 2014 at 13:20:21, John Tuley (jtuley at pivotallabs.com) wrote:
> > Specifically, we're wondering about message_stats and the 
> difference between deliver_get and deliver_no_ack. Our use 
> case is a tool that periodically reports the number of messages 
> published to our queue as well as the number of messages delivered 
> (i.e. reporting flow through the queue). (Or maybe message_stats 
> is the wrong place to look for that information?)

The difference is how messages are retrieved: using basic.get (on demand)
or basic.consume (a long-running subscription). message_stats is the right
place to look to collect queue rate samples.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Wed May 21 10:30:11 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 May 2014 10:30:11 +0100
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <etPan.537c70f1.12200854.8fb9@mercurio.local>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
 <etPan.537c70f1.12200854.8fb9@mercurio.local>
Message-ID: <537C7223.30702@rabbitmq.com>

On 21/05/14 10:24, Michael Klishin wrote:
> On 21 May 2014 at 13:20:21, John Tuley (jtuley at pivotallabs.com) wrote:
>>> Specifically, we're wondering about message_stats and the
>> difference between deliver_get and deliver_no_ack. Our use
>> case is a tool that periodically reports the number of messages
>> published to our queue as well as the number of messages delivered
>> (i.e. reporting flow through the queue). (Or maybe message_stats
>> is the wrong place to look for that information?)
>
> The difference is how messages are retrieved: using basic.get (on demand)
> or basic.consume (a long-running subscription). message_stats is the right
> place to look to collect queue rate samples.

btw, the management UI, in particular its help texts, is a good source 
of information for what these values mean, e.g.

"
Deliver (noack)
     Rate at which messages not requiring acknowledgement are being 
delivered in response to basic.consume.

Get
     Rate at which messages requiring acknowledgement are being 
delivered in response to basic.get.
"

Matthias.


From simon at rabbitmq.com  Wed May 21 10:38:09 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 May 2014 10:38:09 +0100
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <537C7223.30702@rabbitmq.com>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
 <etPan.537c70f1.12200854.8fb9@mercurio.local> <537C7223.30702@rabbitmq.com>
Message-ID: <537C7401.3060308@rabbitmq.com>

On 21/05/2014 10:30, Matthias Radestock wrote:
> btw, the management UI, in particular its help texts, is a good source
> of information for what these values mean, e.g.

Although deliver_get is not completely obvious; it's the sum of deliver, 
deliver_noack, get and get_noack. Therefore in your case deliver_noack 
and deliver_get have the same value since you are not using acked 
delivery or gets of either flavour.

I really need to document this :-/

Cheers, Simon


From mklishin at gopivotal.com  Wed May 21 11:41:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 14:41:02 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
Message-ID: <etPan.537c82dc.216231b.8fb9@mercurio.local>

On 21 May 2014 at 00:09:48, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > https://github.com/bobtfish/rabbitmq-leak
>  
> This box can be spun up easily and (slowly) demonstrates the leak.  

Started looking into reproducing this issue. What box (OS, arch) do you use??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed May 21 12:31:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 15:31:26 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537c82dc.216231b.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
Message-ID: <etPan.537c8eac.1190cde7.8fb9@mercurio.local>

On 21 May 2014 at 14:42:31, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Started looking into reproducing this issue. What box (OS,  
> arch) do you use?

Ubuntu Precise 64 bit worked like a charm.

So far I've been running the VM for 1 hour, with RAM use floating between 54
and 70 or so MB. GC kicks in from time to time as expected, mgmt_db RAM usage
(historically the most common source of leaks) also floats around 4-5 MB
without growing monotonically. All of this at message rates between 200 and 250
msg/s, published over 20-30 temporary STOMP connections.

Will leave the VM running for 6-8 hours and report what I find. ?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Wed May 21 13:19:27 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Wed, 21 May 2014 13:19:27 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
Message-ID: <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>


On May 21, 2014, at 12:31 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 21 May 2014 at 14:42:31, Michael Klishin (mklishin at gopivotal.com) wrote:
>>> Started looking into reproducing this issue. What box (OS,  
>> arch) do you use?
> 
> Ubuntu Precise 64 bit worked like a charm.

That?s whatI?m running - just the standard vagrant ubuntu precise :)

(My production is lucid, but)

> 
> So far I've been running the VM for 1 hour, with RAM use floating between 54
> and 70 or so MB. GC kicks in from time to time as expected, mgmt_db RAM usage
> (historically the most common source of leaks) also floats around 4-5 MB
> without growing monotonically. All of this at message rates between 200 and 250
> msg/s, published over 20-30 temporary STOMP connections.
> 
> Will leave the VM running for 6-8 hours and report what I find.  

I?d expect it to be at ~ 100Mb after 6-8 hours. It?s sloooow. :(

I?m seeing _much faster_ leak rates in production (probably due to the fact I have 400+ clients, not 10).

Cheers
Tom



From mklishin at gopivotal.com  Wed May 21 13:24:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 16:24:10 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
Message-ID: <etPan.537c9b05.140e0f76.8fb9@mercurio.local>

On 21 May 2014 at 16:20:29, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > I?d expect it to be at ~ 100Mb after 6-8 hours. It?s sloooow. :(  
>  
> I?m seeing _much faster_ leak rates in production (probably  
> due to the fact I have 400+ clients, not 10).

OK, can you tell me how I can increase the # of mcollectives in the VM
to 100 (or however many is realistic to run in a 2-4 GB VM)?
I'm a Chef guy, so unfortunately I know next to nothing about Puppet. Is there
an attribute I can set via Vagrantfile?

Have you tried inspecting memory breakdown via sudo rabbitmqctl status
to see what section grows fastest/largest??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Wed May 21 14:02:13 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Wed, 21 May 2014 14:02:13 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
Message-ID: <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>


On May 21, 2014, at 1:24 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 21 May 2014 at 16:20:29, Tomas Doran (bobtfish at bobtfish.net) wrote:
>>> I?d expect it to be at ~ 100Mb after 6-8 hours. It?s sloooow. :(  
>> 
>> I?m seeing _much faster_ leak rates in production (probably  
>> due to the fact I have 400+ clients, not 10).
> 
> OK, can you tell me how I can increase the # of mcollectives in the VM
> to 100 (or however many is realistic to run in a 2-4 GB VM)?

https://github.com/bobtfish/rabbitmq-leak/blob/master/manifests/site.pp#L1

That?s the number of servers (listening for requests, and replying)

https://github.com/bobtfish/rabbitmq-leak/blob/master/manifests/site.pp#L2

That?s the number of clients doing a message to all servers (and getting a reply from each) in a while (true) type loop.

> I'm a Chef guy, so unfortunately I know next to nothing about Puppet. Is there
> an attribute I can set via Vagrantfile?

No sweat, sorry for not making that more clear in the README

> Have you tried inspecting memory breakdown via sudo rabbitmqctl status
> to see what section grows fastest/largest? 
> ?  

Yes - the ?binary? section is what appears to be growing (I think I initially attached a server_report.txt from a prod server at the start of this thread where it had grown _massive_?)

Another (from a VM as above, with a more modest leak) is attached:

Initial Memory: 35 MB 
Memory after 17 Hours running: 90 MB

Cheers
Tom 


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: server_report.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/10461239/attachment.txt>
-------------- next part --------------


From mklishin at gopivotal.com  Wed May 21 14:19:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 17:19:23 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
Message-ID: <etPan.537ca7f8.ded7263.8fb9@mercurio.local>

?On 21 May 2014 at 17:03:37, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > Yes - the ?binary? section is what appears to be growing (I think  
> I initially attached a server_report.txt from a prod server  
> at the start of this thread where it had grown _massive_?)
>  
> Another (from a VM as above, with a more modest leak) is attached:  
>  
> Initial Memory: 35 MB
> Memory after 17 Hours running: 90 MB

but only ~ 4 MB is used by binaries. Management DB uses ~ 23 MB, message
index: 31 MB.

(message index size depend on how many messages there are enqueued)

I'm collecting memory breakdown by the hour, will plot once I have at least
5-6 data points.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Wed May 21 15:03:46 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Wed, 21 May 2014 15:03:46 +0100
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
Message-ID: <68EBD109-748A-472A-B236-E428206A918D@bobtfish.net>


On May 21, 2014, at 2:19 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 21 May 2014 at 17:03:37, Tomas Doran (bobtfish at bobtfish.net) wrote:
>>> Yes - the ?binary? section is what appears to be growing (I think  
>> I initially attached a server_report.txt from a prod server  
>> at the start of this thread where it had grown _massive_?)
>> 
>> Another (from a VM as above, with a more modest leak) is attached:  
>> 
>> Initial Memory: 35 MB
>> Memory after 17 Hours running: 90 MB
> 
> but only ~ 4 MB is used by binaries. Management DB uses ~ 23 MB, message
> index: 31 MB.
> 
> (message index size depend on how many messages there are enqueued)
> 
> I'm collecting memory breakdown by the hour, will plot once I have at least
> 5-6 data points.

Well dammit, I should have looked more closely before certifying this was my production leak.

I?m pretty sure that we?re _also_ leaking memory in this case somehow, but the symptom of the initial issue I was seeing was massive ?binary? memory use, but no (or very few) queued messages.

I?ll continue to dig into this further, thanks for all the help :)

Cheers
Tom


From mklishin at gopivotal.com  Wed May 21 16:03:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 19:03:08 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
Message-ID: <etPan.537cc04a.1befd79f.8fb9@mercurio.local>

On 21 May 2014 at 17:20:56, Michael Klishin (mklishin at gopivotal.com) wrote:
> > I'm collecting memory breakdown by the hour, will plot once 
> I have at least
> 5-6 data points.

With 350-400 messages per second
and almost 2 hours running, I took 7 samples at roughly equal intervals.
Attached as a CSV file.

There is no memory area that's monotonically growing (besides atoms,
which are not GC'ed but also should not be created on the fly).
-- 
MK 

Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_leak_samples1.csv
Type: application/octet-stream
Size: 909 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/1a2c93e7/attachment.obj>

From mklishin at gopivotal.com  Wed May 21 16:08:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 19:08:32 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
 <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
Message-ID: <etPan.537cc18e.25e45d32.8fb9@mercurio.local>

On 21 May 2014 at 19:04:51, Michael Klishin (mklishin at gopivotal.com) wrote:
> > There is no memory area that's monotonically growing (besides 
> atoms

Actually, message index is. Which is curious because there are no messages
enqueued (all publishes go straight through to consumers).
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed May 21 16:11:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 21 May 2014 19:11:13 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537cc18e.25e45d32.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
 <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
 <etPan.537cc18e.25e45d32.8fb9@mercurio.local>
Message-ID: <etPan.537cc22f.431bd7b7.8fb9@mercurio.local>

On 21 May 2014 at 19:10:07, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Actually, message index is. Which is curious because there  
> are no messages
> enqueued (all publishes go straight through to consumers).  

Right after I sent this I took another sample and msg_index is at?5108808.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed May 21 16:53:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 May 2014 16:53:31 +0100
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <537C7401.3060308@rabbitmq.com>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
 <etPan.537c70f1.12200854.8fb9@mercurio.local> <537C7223.30702@rabbitmq.com>
 <537C7401.3060308@rabbitmq.com>
Message-ID: <537CCBFB.8080406@rabbitmq.com>

On 21/05/14 10:38, Simon MacMullen wrote:
> I really need to document this :-/

And I have finally started:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/9b44a7aca551/priv/www/doc/stats.html

Apologies to everyone who's waited a long time for this...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From nickjbenton at gmail.com  Wed May 21 12:20:06 2014
From: nickjbenton at gmail.com (Nick Benton)
Date: Wed, 21 May 2014 04:20:06 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Windows Failover Clustering
Message-ID: <4c8ab48b-6029-4192-aa23-831d84acf7e2@googlegroups.com>

Hi,

I am looking at setting up RabbitMQ on an existing Windows Active/Passive 
failover cluster, using shared storage.

I have seen the discussion surrounding this in the group (here<https://groups.google.com/forum/#!searchin/rabbitmq-discuss/windows/rabbitmq-discuss/LnleyojNXjY/nOohEvgauCAJ>) 
detailing the requirement for the service name to be identical, and how to 
remedy this on installation (manual) of the RabbitMQ service.

Also, looking at the reliance on the erlang cookie, I should be able to set 
the homepath for this cookie to shared storage, is this correct?

Are there any other components of RabbitMQ that can be located on the 
shared storage?

Any help with this would be much appreciated.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/90f5cf8b/attachment.html>

From jeffrey.a.becker at gmail.com  Wed May 21 13:58:33 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Wed, 21 May 2014 08:58:33 -0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <etPan.537c1cc1.3d1b58ba.8fb9@mercurio.local>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <etPan.537bae65.74b0dc51.8fb9@mercurio.local>
 <CACjM4Qj3Xqk_+meXCpCToBi87r9X=PKd8m0EB9tEafkc0CQO6g@mail.gmail.com>
 <etPan.537c1cc1.3d1b58ba.8fb9@mercurio.local>
Message-ID: <CACjM4QjUZ-VkZPSQVGpon4pYTuTrtD+3awrry4C9kgUvBH4HWg@mail.gmail.com>

I've tried this and don't see any obvious error message in the output of
the commands. Can we resume this discussion on the google group or my work
email? Writing on a phone kinda sucks.
On May 20, 2014 11:25 PM, "Michael Klishin" <mklishin at gopivotal.com> wrote:

> On 20 May 2014 at 23:41:17, Jeffrey Becker (jeffrey.a.becker at gmail.com)
> wrote:
> > > Yes.
>
> Please try openssl s_client and openssl s_server and see if they work with
> your certificates/keys.
> I understand that this is not convenient to do on Windows but they are the
> easiest way to
> see more informative error messages when debugging SSL issues.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/fe3cec34/attachment.html>

From simon at rabbitmq.com  Wed May 21 18:10:51 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 May 2014 18:10:51 +0100
Subject: [rabbitmq-discuss] 3.3.1 Management Console: "Not Found"
In-Reply-To: <CANpjuCst4VMUOAnV6316DPu9xkZPy6Cqe2NYpdFVFWAz6qyHPA@mail.gmail.com>
References: <CANpjuCst4VMUOAnV6316DPu9xkZPy6Cqe2NYpdFVFWAz6qyHPA@mail.gmail.com>
Message-ID: <537CDE1B.5050105@rabbitmq.com>

On 20/05/14 17:49, Greg Poirier wrote:
> The RAM node (may be a red herring, not sure) is currently displaying
> only: "Not Found" when I attempt to connect to the management console.

Hmm. I know this may sound a bit... obvious, but that is what you'd see 
if browsing to a URL with something unwanted on the end, e.g. 
http://server-name:15672/typo - so are you sure that's not happening?

> rabbitmqctl status says that the management plugin is up and running:

Hmm, what does

$ rabbitmqctl eval 'rabbit_web_dispatch_registry:list_all().'

say?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From navdeep.bhogal at gmail.com  Wed May 21 18:12:08 2014
From: navdeep.bhogal at gmail.com (Navdeep Singh)
Date: Wed, 21 May 2014 22:42:08 +0530
Subject: [rabbitmq-discuss] Limit number of concurrent connections
Message-ID: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>

Hi,

Kindly let me know how can I limit the number of simultaneous connections
in RabbitMQ. Is there a way to do it and if yes how it can be achived.
Kindly look at cloudamqp.com who are able to do it by limiting 3
connections for free plan.

This is urgent and need your help.

Regards,
Navdeep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/d204a3d3/attachment.html>

From larss at motiga.com  Wed May 21 18:23:23 2014
From: larss at motiga.com (Lars Sommer)
Date: Wed, 21 May 2014 17:23:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ server fails to start on clustered
	erlang node
Message-ID: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>

Environment:

*         Ubuntu Server 12.04

*         Erlang R16B03-1

*         Ejabberd 13.12

*         Cluster:

o   Server that is failing to start RabbitMQ is primary

o   3 additional "secondary" erlang nodes

Additional notes:

*         RabbitMQ is pulling default package from apt

o   "sudo apt-get install rabbitmq-server"

o   At the service start phase it chokes: (copy-paste below)

?  Setting up rabbitmq-server (2.7.1-0ubuntu4) ...

?  Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}

?  rabbitmq-server.

?  invoke-rc.d: initscript rabbitmq-server, action "start" failed.

?  dpkg: error processing rabbitmq-server (--configure):

?   subprocess installed post-installation script returned error exit status 1

?  Errors were encountered while processing:

?   rabbitmq-server

?  E: Sub-process /usr/bin/dpkg returned an error code (1)

*         Erlang cookie file was copied from the existing erlang nodes over to /var/lib/rabbitmq/.erlang.cookie

o   cp /var/lib/ejabberd/.erlang.cookie /var/lib/rabbitmq/

o   chown rabbitmq /var/lib/rabbitmq/.erlang.cookie

o   service rabbitmq-server start

?  Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}

o   ls /var/log/rabbitmq

?  startup_err

o   cat /var/log/rabbitmq/startup_err

?  Wed May 21 10:16:31 PDT 2014 - rabbitmq failed to start

?  Wed May 21 10:20:31 PDT 2014 - rabbitmq failed to start

Can anyone help me identify where my conflict might be? Clearly it has some sort of problem with the existing erlang cluster but I am not sure what it is.

[cid:image002.png at 01CF74DE.B0235120]

Lars Sommer | DevOps
425.530.6792 | larss at motiga.com
www.motiga.com<http://www.motiga.com>
[cid:image003.png at 01CF74DD.2582FE90]<https://www.facebook.com/pages/Motiga/100962400010155> [cid:image004.png at 01CF74DD.2582FE90] <https://twitter.com/motigagames>  [cid:image005.png at 01CF74DD.2582FE90] <http://www.youtube.com/user/motigagames>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/9ad84e4f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 1318 bytes
Desc: image003.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/9ad84e4f/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 1517 bytes
Desc: image004.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/9ad84e4f/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 1402 bytes
Desc: image005.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/9ad84e4f/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 13078 bytes
Desc: image002.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/9ad84e4f/attachment-0003.png>

From srinatsr at cisco.com  Wed May 21 18:59:50 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 21 May 2014 17:59:50 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>

It works perfect thank you so much ?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

To configure the retry advice in XML, you need to wire up a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can set it directly, or if you are using message conversion, set the createMessageIds to true on the outbound template's SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in using stateful retry.

On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Thanks  do you have xml version of the following?

I need to set message id before publishing the message?  How to do this?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:24 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

@Bean
public MethodInterceptor retryAdvice() {
     FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
     backOffPolicy.setBackOffPeriod(10000);;
     return RetryInterceptorBuilder.stateful()
          .backOffPolicy(backOffPolicy)
          .maxAttempts(3)
          .recoverer(new RejectAndDontRequeueRecoverer())
          .build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped or sent to a Dead Letter Exchange of so configured).


On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ??
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/ee489317/attachment.html>

From srinatsr at cisco.com  Wed May 21 19:14:04 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 21 May 2014 18:14:04 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>

After 3 times, I am getting the following exception.  But I don?t want this exception, directly the message should go to dead letter exchange.

I  have configured dlx as follows.

rabbitmqctl set_policy DLX ".*" '{"dead-letter-exchange":"my-dlx"}'


2014-05-21 11:10:37:870 -0700, [WARN] StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped on recovery: (Body:'[B at 3ed60d48(byte[163])'MessageProperties [headers={}, timestamp=null, messageId=1, userId=null, appId=null, clusterId=null, type=null, correlationId=null, replyTo=null, contentType=application/octet-stream, contentEncoding=null, contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0, redelivered=true, receivedExchange=, receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException: Listener threw exception
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(AbstractMessageListenerContainer.java:758)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:653)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:576)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(SimpleMessageListenerContainer.java:154)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
       at java.lang.reflect.Method.invoke(Method.java:606)
       at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(StatefulRetryOperationsInterceptor.java:162)
       at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:263)
       at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:193)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(StatefulRetryOperationsInterceptor.java:137)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
       at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
       at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(SimpleMessageListenerContainer.java:1113)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:559)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:904)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:888)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:989)
       at java.lang.Thread.run(Thread.java:724)

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Wednesday, May 21, 2014 11:00 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

It works perfect thank you so much ?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

To configure the retry advice in XML, you need to wire up a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can set it directly, or if you are using message conversion, set the createMessageIds to true on the outbound template's SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in using stateful retry.

On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Thanks  do you have xml version of the following?

I need to set message id before publishing the message?  How to do this?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:24 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

@Bean
public MethodInterceptor retryAdvice() {
     FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
     backOffPolicy.setBackOffPeriod(10000);;
     return RetryInterceptorBuilder.stateful()
          .backOffPolicy(backOffPolicy)
          .maxAttempts(3)
          .recoverer(new RejectAndDontRequeueRecoverer())
          .build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped or sent to a Dead Letter Exchange of so configured).


On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ??
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/eaab88fa/attachment.html>

From srinatsr at cisco.com  Wed May 21 20:25:43 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 21 May 2014 19:25:43 +0000
Subject: [rabbitmq-discuss] What messages went to DLX
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1151E@xmb-aln-x10.cisco.com>

Hello,

I need to capture the messages moving to DLX.  How can I achieve this?



Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/6655f976/attachment.html>

From mcintoshj at gmail.com  Wed May 21 20:42:12 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 21 May 2014 14:42:12 -0500
Subject: [rabbitmq-discuss] What messages went to DLX
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1151E@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1151E@xmb-aln-x10.cisco.com>
Message-ID: <CAD6m6fGxyCZdGc4gJMwLNvw7DeTC0n3QZU2MPZvbK-qwpi3Y9w@mail.gmail.com>

Why not write a consumer on your DLX queue - that sounds like the simplest
thing?  But maybe I'm missing something - can you define "capture the
messages moving to DLX"?  I'd suggest adding more details on what you're
trying to accomplish, steps you've already taken, etc.  Also try reading
the information on dead letter queues:
http://www.rabbitmq.com/dlx.html

Jason


On Wed, May 21, 2014 at 2:25 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>  Hello,
>
>
>
> I need to capture the messages moving to DLX.  How can I achieve this?
>
>
>
>
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/8329b441/attachment.html>

From grussell at gopivotal.com  Wed May 21 21:13:31 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Wed, 21 May 2014 16:13:31 -0400
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>
Message-ID: <CADtU9_ty=2_D7Uz3QnvucTPxaS9o-XQNJwUw0uvaWNfePg87bw@mail.gmail.com>

You did not configure a MessageRecoverer as I suggested; the default
recoverer logs a WARN message and acks the message.

Add a RejectAndDontRequeueRecoverer and the rejected message will go to the
DLE.


On Wed, May 21, 2014 at 2:14 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>  After 3 times, I am getting the following exception.  But I don?t want
> this exception, directly the message should go to dead letter exchange.
>
>
>
> I  have configured dlx as follows.
>
>
>
> rabbitmqctl set_policy DLX ".*" '{"dead-letter-exchange":"my-dlx"}'
>
>
>
>
>
> 2014-05-21 11:10:37:870 -0700, [WARN]
> StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped
> on recovery: (Body:'[B at 3ed60d48(byte[163])'MessageProperties [headers={},
> timestamp=null, messageId=1, userId=null, appId=null, clusterId=null,
> type=null, correlationId=null, replyTo=null,
> contentType=application/octet-stream, contentEncoding=null,
> contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0,
> redelivered=true, receivedExchange=,
> receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
>
> *org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException*:
> Listener threw exception
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(
> *AbstractMessageListenerContainer.java:758*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(
> *AbstractMessageListenerContainer.java:653*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(
> *AbstractMessageListenerContainer.java:576*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(
> *SimpleMessageListenerContainer.java:75*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(
> *SimpleMessageListenerContainer.java:154*)
>
>        at sun.reflect.NativeMethodAccessorImpl.invoke0(*Native Method*)
>
>        at sun.reflect.NativeMethodAccessorImpl.invoke(
> *NativeMethodAccessorImpl.java:57*)
>
>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(
> *DelegatingMethodAccessorImpl.java:43*)
>
>        at java.lang.reflect.Method.invoke(*Method.java:606*)
>
>        at
> org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(
> *AopUtils.java:317*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(
> *ReflectiveMethodInvocation.java:183*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
> *ReflectiveMethodInvocation.java:150*)
>
>        at
> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(
> *StatefulRetryOperationsInterceptor.java:162*)
>
>        at org.springframework.retry.support.RetryTemplate.doExecute(
> *RetryTemplate.java:263*)
>
>        at org.springframework.retry.support.RetryTemplate.execute(
> *RetryTemplate.java:193*)
>
>        at
> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(
> *StatefulRetryOperationsInterceptor.java:137*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
> *ReflectiveMethodInvocation.java:172*)
>
>        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(
> *JdkDynamicAopProxy.java:204*)
>
>        at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(
> *SimpleMessageListenerContainer.java:1113*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(
> *AbstractMessageListenerContainer.java:559*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(
> *SimpleMessageListenerContainer.java:904*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(
> *SimpleMessageListenerContainer.java:888*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(
> *SimpleMessageListenerContainer.java:75*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(
> *SimpleMessageListenerContainer.java:989*)
>
>        at java.lang.Thread.run(*Thread.java:724*)
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Srinath
> Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
> *Sent:* Wednesday, May 21, 2014 11:00 AM
>
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> It works perfect thank you so much J
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [
> mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<rabbitmq-discuss-bounces at lists.rabbitmq.com>]
> *On Behalf Of *Gary Russell
> *Sent:* Tuesday, May 20, 2014 12:48 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> To configure the retry advice in XML, you need to wire up
> a StatefulRetryOperationsInterceptorFactoryBean.
>
>
>
> It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy
> and BackOffPolicy beans.
>
>
>
> Then wire the factory bean into the advice chain.
>
>
>
> To set the message id, it depends on how you are sending messages; you can
> set it directly, or if you are using message conversion, set
> the createMessageIds to true on the outbound template's
> SimpleMessageConverter.
>
>
>
> However, when using long backoffs like that, there's not much benefit in
> using stateful retry.
>
>
>
> On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
> Thanks  do you have xml version of the following?
>
>
>
> I need to set message id before publishing the message?  How to do this?
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Tuesday, May 20, 2014 12:24 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> @Bean
>
> public MethodInterceptor retryAdvice() {
>
>      FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
>
>      backOffPolicy.setBackOffPeriod(10000);;
>
>      return RetryInterceptorBuilder.stateful()
>
>           .backOffPolicy(backOffPolicy)
>
>           .maxAttempts(3)
>
>           .recoverer(new RejectAndDontRequeueRecoverer())
>
>           .build();
>
> }
>
>
>
> Add it to the adviceChain property of the SimpleMessageListenerContainer.
>
>
>
> Note: stateful retry requires the message to have a message id; use a
> stateless advice otherwise.
>
>
>
> After the retries are exhausted, the message will be rejected (and dropped
> or sent to a Dead Letter Exchange of so configured).
>
>
>
>
>
> On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
>
>
> Hello,
>
>
>
> I am consuming the messages using the listener as follows,  I need to
> retry processing three times if any exceptions occurred.
>
>
>
> <bean
>
>         class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>         <property name=*"connectionFactory"* ref=*"connectionFactory"* />
>
>         <property name=*"queueNames"*>
>
>             <array>
>
>                 <value>validateRequestQueue</value>
>
>             </array>
>
>         </property>
>
>         <property name=*"messageListener"*>
>
>             <bean
>
>                 class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                 <property name=*"delegate"* ref=*"retryConsumer"* />
>
>             </bean>
>
>         </property>
>
>         <!-- <property name="acknowledgeMode" value="NONE" /> -->
>
>     </bean>
>
>
>
>
>
> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
>
>
>
>        /**
>
>        * Callback for processing a received Rabbit message.
>
>        * *@param* message the received AMQP message
>
>        * *@param* channel the underlying Rabbit Channel
>
>        * *@throws* Exception
>
>         */
>
>        @Override
>
>        *public* *void* onMessage(Message message, Channel channel)
> *throws* Exception {
>
>
>
>              System.*out*.println("Received Message :: "+*new*String(message.getBody()));
>
>              *if*(*true*){
>
>              *throw* *new* RuntimeException("Error");
>
>              }
>
>
>
>        }
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
> Cisco)
> *Sent:* Monday, May 19, 2014 10:47 AM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Retry Message for 3 times with 10 seconds interval - in
> Consumer
>
>
>
>
>
> Retry unacknowledged RabbitMQ message in 10 second interval
>
> And Retry 3 times using Spring framework in java .
>
>
>
> Please need help on this
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/eb47b78a/attachment.html>

From srinatsr at cisco.com  Wed May 21 21:45:26 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 21 May 2014 20:45:26 +0000
Subject: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds
 interval - in Consumer
In-Reply-To: <CADtU9_ty=2_D7Uz3QnvucTPxaS9o-XQNJwUw0uvaWNfePg87bw@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>
 <CADtU9_ty=2_D7Uz3QnvucTPxaS9o-XQNJwUw0uvaWNfePg87bw@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1161C@xmb-aln-x10.cisco.com>

I totally agree Gary.

But how to configure in xml ?  Here is my xml and designed as you described.

   <bean id="simpleRetryPolicy" class="org.springframework.retry.policy.SimpleRetryPolicy">
        <property name="maxAttempts" value="3" />
    </bean>
    <!-- <bean id="retryTemplate" class="org.springframework.retry.support.RetryTemplate">
        <property name="retryPolicy" ref="simpleRetryPolicy" />
    </bean> -->
    <bean id="statefulRetryOperationsInterceptorFactoryBean"
        class="org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean">
        <property name="retryOperations" ref="retryTemplate" />
        <property name="messageRecoverer"
    </bean>


       <bean id="retryTemplate" class="org.springframework.retry.support.RetryTemplate">
              <property name="retryPolicy" ref="simpleRetryPolicy" />
             <property name="backOffPolicy">
                    <bean class="org.springframework.retry.backoff.ExponentialBackOffPolicy">
                           <property name="initialInterval" value="10000" />
             <!--         <property name="multiplier" value="10.0" />
                           <property name="maxInterval" value="10000" /> -->
                    </bean>
             </property>
       </bean>
       <rabbit:template id="rabbitTemplate"
             connection-factory="connectionFactory" />
       <bean
              class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
             <property name="connectionFactory" ref="connectionFactory" />
             <property name="queueNames">
                    <array>
                           <value>validateRequestQueue</value>
                    </array>
             </property>
             <property name="messageListener">
                    <bean
                           class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                           <property name="delegate" ref="retryConsumer" />
                    </bean>
             </property>
             <property name="adviceChain" ref="statefulRetryOperationsInterceptorFactoryBean"></property>
             <!-- <property name="acknowledgeMode" value="NONE" /> -->
       </bean>

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Wednesday, May 21, 2014 1:14 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

You did not configure a MessageRecoverer as I suggested; the default recoverer logs a WARN message and acks the message.

Add a RejectAndDontRequeueRecoverer and the rejected message will go to the DLE.

On Wed, May 21, 2014 at 2:14 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
After 3 times, I am getting the following exception.  But I don?t want this exception, directly the message should go to dead letter exchange.

I  have configured dlx as follows.

rabbitmqctl set_policy DLX ".*" '{"dead-letter-exchange":"my-dlx"}'


2014-05-21 11:10:37:870 -0700, [WARN] StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped on recovery: (Body:'[B at 3ed60d48(byte[163])'MessageProperties [headers={}, timestamp=null, messageId=1, userId=null, appId=null, clusterId=null, type=null, correlationId=null, replyTo=null, contentType=application/octet-stream, contentEncoding=null, contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0, redelivered=true, receivedExchange=, receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException: Listener threw exception
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(AbstractMessageListenerContainer.java:758)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:653)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:576)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(SimpleMessageListenerContainer.java:154)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
       at java.lang.reflect.Method.invoke(Method.java:606)
       at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(StatefulRetryOperationsInterceptor.java:162)
       at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:263)
       at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:193)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(StatefulRetryOperationsInterceptor.java:137)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
       at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
       at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(SimpleMessageListenerContainer.java:1113)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:559)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:904)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:888)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:989)
       at java.lang.Thread.run(Thread.java:724)

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Wednesday, May 21, 2014 11:00 AM

To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

It works perfect thank you so much ?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

To configure the retry advice in XML, you need to wire up a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can set it directly, or if you are using message conversion, set the createMessageIds to true on the outbound template's SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in using stateful retry.

On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Thanks  do you have xml version of the following?

I need to set message id before publishing the message?  How to do this?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:24 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

@Bean
public MethodInterceptor retryAdvice() {
     FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
     backOffPolicy.setBackOffPeriod(10000);;
     return RetryInterceptorBuilder.stateful()
          .backOffPolicy(backOffPolicy)
          .maxAttempts(3)
          .recoverer(new RejectAndDontRequeueRecoverer())
          .build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped or sent to a Dead Letter Exchange of so configured).


On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ??
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/34f7ab28/attachment.html>

From srinatsr at cisco.com  Wed May 21 21:51:35 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 21 May 2014 20:51:35 +0000
Subject: [rabbitmq-discuss] What messages went to DLX
In-Reply-To: <CAD6m6fGxyCZdGc4gJMwLNvw7DeTC0n3QZU2MPZvbK-qwpi3Y9w@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1151E@xmb-aln-x10.cisco.com>
 <CAD6m6fGxyCZdGc4gJMwLNvw7DeTC0n3QZU2MPZvbK-qwpi3Y9w@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1164D@xmb-aln-x10.cisco.com>

Suppose if few messages are rejected and others are processed.  I want to log the rejected messages if any ?

How to do this?  I have my monitor queue which bind to trace exchange as well.  I want to get the message which is rejected and moving to dead letter exchange.

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jason McIntosh
Sent: Wednesday, May 21, 2014 12:42 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] What messages went to DLX

Why not write a consumer on your DLX queue - that sounds like the simplest thing?  But maybe I'm missing something - can you define "capture the messages moving to DLX"?  I'd suggest adding more details on what you're trying to accomplish, steps you've already taken, etc.  Also try reading the information on dead letter queues:
http://www.rabbitmq.com/dlx.html

Jason

On Wed, May 21, 2014 at 2:25 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Hello,

I need to capture the messages moving to DLX.  How can I achieve this?



Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/69811e90/attachment.html>

From mklishin at gopivotal.com  Thu May 22 04:15:03 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 07:15:03 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
 <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
Message-ID: <etPan.537d6bd5.6b8b4567.5f0b@mercurio.local>

On 21 May 2014 at 19:04:51, Michael Klishin (mklishin at gopivotal.com) wrote:
> > With 350-400 messages per second
> and almost 2 hours running, I took 7 samples at roughly equal intervals.  
> Attached as a CSV file.

Attaching more with 25 samples (ran over night, host machine hibernated for a few
hours, too) and charts in Excel and PDF.

Some observations: total RAM use is growing slowly. Binary data goes up and down
but msg_index and mgmt_db now grow steadily. # of queues, connections, consumers,
channels is not included but they are all stable and around the same number.
The same goes for message rates.

Restarting management plugin with

sudo rabbitmqctl eval \?
'application:stop(rabbitmq_management),application:start(rabbitmq_management).'?

drives total RAM use to about 146 MB (min sample: ~ 87 MB, max sample: ~ 206 MB).
--  
MK  

Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_leak_samples1.csv
Type: application/octet-stream
Size: 2968 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/0d97f897/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_leak_samples1.xlsx
Type: application/octet-stream
Size: 77460 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/0d97f897/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_leak_samples1.pdf
Type: application/octet-stream
Size: 61257 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/0d97f897/attachment-0002.obj>

From mklishin at gopivotal.com  Thu May 22 04:26:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 07:26:10 +0400
Subject: [rabbitmq-discuss] What messages went to DLX
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1164D@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1151E@xmb-aln-x10.cisco.com>
 <CAD6m6fGxyCZdGc4gJMwLNvw7DeTC0n3QZU2MPZvbK-qwpi3Y9w@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB1164D@xmb-aln-x10.cisco.com>
Message-ID: <etPan.537d6e70.2ae8944a.5f0b@mercurio.local>

On 22 May 2014 at 00:52:55, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > How to do this? I have my monitor queue which bind to trace exchange  
> as well. I want to get the message which is rejected and moving  
> to dead letter exchange.

Trace what is published to the dead letter exchange. Then inspect the "x-death"
header documented on?http://www.rabbitmq.com/dlx.html.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 22 04:22:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 07:22:13 +0400
Subject: [rabbitmq-discuss] RabbitMQ server fails to start on clustered
 erlang node
In-Reply-To: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>
References: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>
Message-ID: <etPan.537d6d82.74b0dc51.5f0b@mercurio.local>

On 21 May 2014 at 21:24:47, Lars Sommer (larss at motiga.com) wrote:
> >
> Additional notes:
> ? RabbitMQ is pulling default package from apt
> o ?sudo apt-get install rabbitmq-server?

From what apt repo? Standard Ubuntu or rabbitmq.com??

> cat /var/log/rabbitmq/startup_err
> ? Wed May 21 10:16:31 PDT(http://airmail.calendar/2014-05-21%2021:16:31%20GMT+4)  
> 2014 - rabbitmq failed to start
> ? Wed May 21 10:20:31 PDT(http://airmail.calendar/2014-05-21%2021:20:31%20GMT+4)  
> 2014 - rabbitmq failed to start

What is in RabbitMQ log and dpkg/apt logs?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From larss at motiga.com  Thu May 22 04:54:20 2014
From: larss at motiga.com (Lars Sommer)
Date: Thu, 22 May 2014 03:54:20 +0000
Subject: [rabbitmq-discuss] RabbitMQ server fails to start on clustered
 erlang node
In-Reply-To: <etPan.537d6d82.74b0dc51.5f0b@mercurio.local>
References: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>,
 <etPan.537d6d82.74b0dc51.5f0b@mercurio.local>
Message-ID: <65BA9782-B080-4899-9CCD-48CBD0E8DBC6@motiga.com>

Standard Ubuntu repo

Sent from my iPhone


> On May 21, 2014, at 8:29 PM, "Michael Klishin" <mklishin at gopivotal.com> wrote:
> 
> On 21 May 2014 at 21:24:47, Lars Sommer (larss at motiga.com) wrote:
>> Additional notes:
>> ? RabbitMQ is pulling default package from apt
>> o ?sudo apt-get install rabbitmq-server?
> 
> From what apt repo? Standard Ubuntu or rabbitmq.com? 
> 
>> cat /var/log/rabbitmq/startup_err
>> ? Wed May 21 10:16:31 PDT(http://airmail.calendar/2014-05-21%2021:16:31%20GMT+4)  
>> 2014 - rabbitmq failed to start
>> ? Wed May 21 10:20:31 PDT(http://airmail.calendar/2014-05-21%2021:20:31%20GMT+4)  
>> 2014 - rabbitmq failed to start
> 
> What is in RabbitMQ log and dpkg/apt logs?
> --  
> MK  
> 
> Software Engineer, Pivotal/RabbitMQ

From haster2004 at yandex.ru  Thu May 22 07:17:04 2014
From: haster2004 at yandex.ru (Haster)
Date: Wed, 21 May 2014 23:17:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Library rabbitmq_c  and TCP_NODELAY
Message-ID: <1400739424585-35761.post@n5.nabble.com>

Hi Alan,

In my program I use TCP_NODELAY option of socket.
And now my code look like:

      connection = amqp_new_connection();
      if (!connection) {
        throw RabbitMQException(-1, "Create connection error");
      }
      int sockfd = amqp_open_socket(hostName.c_str(), portNumber);  //5672
      if (sockfd < 0) {
        std::string err_msg = "Opening socket: ";
        err_msg += amqp_error_string2(sockfd);
        throw RabbitMQException(-sockfd, err_msg.c_str());
      }
      int nodelay = 1;
      setsockopt(sockfd, IPPROTO_TCP, TCP_NODELAY, (char*)&nodelay,
sizeof(nodelay));
      amqp_set_sockfd(connection, sockfd);

But amqp_set_sockfd function is deprecated now and I'm afraid that it can be
dropped in future versions.
So can you add supporting TCP_NODELAY option in your future version of
rabbitmq_c?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Library-rabbitmq-c-and-TCP-NODELAY-tp35761.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Mark.deVilliers at Aeriandi.com  Thu May 22 09:14:48 2014
From: Mark.deVilliers at Aeriandi.com (Mark DeVilliers)
Date: Thu, 22 May 2014 08:14:48 +0000
Subject: [rabbitmq-discuss] Plugin example using Rebar to manage dependancies
Message-ID: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>

Does anyone have or know of a plugin that uses rebar to manage its dependencies? I am sure I have seen one previously but for the life of me I can't remember where.

Failing that is there any guidance for managing dependencies rather than copying them into the plugin? A link to a working example would be awesome.

Thanks,

Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/35840163/attachment.html>

From mklishin at gopivotal.com  Thu May 22 09:23:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 12:23:47 +0400
Subject: [rabbitmq-discuss] Plugin example using Rebar to manage
 dependancies
In-Reply-To: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>
References: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>
Message-ID: <etPan.537db42f.507ed7ab.5f0b@mercurio.local>

On 22 May 2014 at 12:16:00, Mark DeVilliers (mark.devilliers at aeriandi.com) wrote:
> > Does anyone have or know of a plugin that uses rebar to manage  
> its dependencies? I am sure I have seen one previously but for  
> the life of me I can't remember where.

?*?https://github.com/jbrisbin/riak-exchange
?*?https://github.com/jbrisbin/rabbitmq-webhooks
?*?https://github.com/jbrisbin/riak-rabbitmq-commit-hooks

Note that these plugins depend on a modified (Rebar-friendly) versions
of the Erlang RabbitMQ client ?that isn't currently ported to 3.3:

https://github.com/jbrisbin/amqp_client
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu May 22 09:26:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 09:26:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ server fails to start on clustered
 erlang node
In-Reply-To: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>
References: <9d157f60eb394c2f815e112d07d9106f@BY2PR01MB265.prod.exchangelabs.com>
Message-ID: <537DB4D3.6050107@rabbitmq.com>

On 21/05/2014 18:23, Lars Sommer wrote:
> Starting rabbitmq-server: FAILED - check
> /var/log/rabbitmq/startup_{log, _err}
>
> ls /var/log/rabbitmq
>
> startup_err
>
> cat /var/log/rabbitmq/startup_err
>
> Wed May 21 10:16:31 PDT 2014 - rabbitmq failed to start
> Wed May 21 10:20:31 PDT 2014 - rabbitmq failed to start
>
> Can anyone help me identify where my conflict might be? Clearly it has
> some sort of problem with the existing erlang cluster but I am not sure
> what it is.

Sadly the packaging of RabbitMQ in 12.04 had a bug introduced into it by 
Canonical which causes /var/log/rabbitmq/startup_{log,err} to be 
overwritten with these unhelpful error messages. So I don't think we are 
going to be able to help you.

You can download much more up to date .debs from:
   http://www.rabbitmq.com/install-debian.html

Cheers, Simon


From jeffrey.a.becker at gmail.com  Wed May 21 18:14:43 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Wed, 21 May 2014 10:14:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
Message-ID: <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>

The error being thrown by the C# client code is:

None of the specified endpoints were reachable
connection.start was never received, likely due to a network timeout


On Tuesday, May 20, 2014 12:16:42 PM UTC-4, Jeffrey Becker wrote:
>
> I'm attempting to configure RabbitMQ with SSL using client certificates 
> for authentication on a windows server 2012 x64 box.  The Erlang version 
> installed is OTP 17.0 for Windows x64, 
> Configuration is as such:
>  {rabbit,  [ 
>     {ssl_listeners, [5671]},
>     {auth_mechanisms, ['EXTERNAL']},
>     {auth_backends, [rabbit_auth_backend_ldap, 
> rabbit_auth_backend_internal]},
>     {ssl_options, [{cacertfile,"D:\\RabbitMQ\\certs\\cacert.pem"},
>                   {certfile,"D:\\RabbitMQ\certs\\rabbit.pem"},
>                   {keyfile,"D:\\RabbitMQ\\certs\\rabbit.key"},
>                   {verify,verify_peer},
>   {ssl_cert_login_from, common_name},
>                   {fail_if_no_peer_cert,true}]} 
>
>   ]},
>
> Whenever I connect, the client throws an error and the log file gets an 
> entry like:
>
> error on AMQP connection <0.310.0>: 
> {ssl_upgrade_error,{options,{certfile,[68,58,92...
>
> I've gone through the SSL Trouble shooting guide and confirmed that:
>
>    - The certs are in the PEM format
>    - The Broker is listening on the correct ports
>    
>
> The last bit of the trouble shooting guide indicates that "This is a 
> generic error that could have many causes. Make sure you are using the 
> recommended version of Erlang." Is there a version of Erlang I should be 
> using other than OTP 17.0?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/76991038/attachment.html>

From jeffrey.a.becker at gmail.com  Wed May 21 19:15:23 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Wed, 21 May 2014 11:15:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
Message-ID: <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>

After some further debugging with openssl s_client I've produced the error 

write:errno=104


On Wednesday, May 21, 2014 1:14:43 PM UTC-4, Jeffrey Becker wrote:
>
> The error being thrown by the C# client code is:
>
> None of the specified endpoints were reachable
> connection.start was never received, likely due to a network timeout
>
>
> On Tuesday, May 20, 2014 12:16:42 PM UTC-4, Jeffrey Becker wrote:
>>
>> I'm attempting to configure RabbitMQ with SSL using client certificates 
>> for authentication on a windows server 2012 x64 box.  The Erlang version 
>> installed is OTP 17.0 for Windows x64, 
>> Configuration is as such:
>>  {rabbit,  [ 
>>     {ssl_listeners, [5671]},
>>     {auth_mechanisms, ['EXTERNAL']},
>>     {auth_backends, [rabbit_auth_backend_ldap, 
>> rabbit_auth_backend_internal]},
>>     {ssl_options, [{cacertfile,"D:\\RabbitMQ\\certs\\cacert.pem"},
>>                   {certfile,"D:\\RabbitMQ\certs\\rabbit.pem"},
>>                   {keyfile,"D:\\RabbitMQ\\certs\\rabbit.key"},
>>                   {verify,verify_peer},
>>   {ssl_cert_login_from, common_name},
>>                   {fail_if_no_peer_cert,true}]} 
>>
>>   ]},
>>
>> Whenever I connect, the client throws an error and the log file gets an 
>> entry like:
>>
>> error on AMQP connection <0.310.0>: 
>> {ssl_upgrade_error,{options,{certfile,[68,58,92...
>>
>> I've gone through the SSL Trouble shooting guide and confirmed that:
>>
>>    - The certs are in the PEM format
>>    - The Broker is listening on the correct ports
>>    
>>
>> The last bit of the trouble shooting guide indicates that "This is a 
>> generic error that could have many causes. Make sure you are using the 
>> recommended version of Erlang." Is there a version of Erlang I should be 
>> using other than OTP 17.0?
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/a6765961/attachment.html>

From charles.sartori at azion.com  Wed May 21 21:24:58 2014
From: charles.sartori at azion.com (charles.sartori at azion.com)
Date: Wed, 21 May 2014 13:24:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue TTL
Message-ID: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>

Hello,

I am trying to set my queue to expire in 3 months, looking at docs[1], I 
should set x-expires to 3 months(in milliseconds), Of course, 3months in 
miliseconds is to big and I can't do that, I can set expires to max 7 
days(in miliseconds).

Is there other way to set queue ttl?

[1] http://www.rabbitmq.com/ttl.html#queue-ttl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/d4031301/attachment.html>

From jeffrey.a.becker at gmail.com  Wed May 21 21:41:24 2014
From: jeffrey.a.becker at gmail.com (Jeffrey Becker)
Date: Wed, 21 May 2014 13:41:24 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl not being presented
 as an auth_mechanism to clients
Message-ID: <e1bad162-7e9a-4661-b088-0413c094af6c@googlegroups.com>

I'm attempting to configure RabbitMQ to use ssl authentication.  The C# 
client is failing with the error 

No compatible authentication mechanism found - server offered []


When rabbitmq.config has the settings

{auth_mechanisms, ['EXTERNAL']},


I've validated that the plugin is both installed and enabled. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/61e7e90a/attachment.html>

From dmitry.naumov78 at gmail.com  Wed May 21 22:07:00 2014
From: dmitry.naumov78 at gmail.com (Dmitry Naumov)
Date: Wed, 21 May 2014 14:07:00 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq client and AppDomain unload
Message-ID: <7ea22dec-73c8-4e90-90ca-f81fab5c00f0@googlegroups.com>

I have separate AppDomains (not primary) where I use RabbitMq.Client 
(RMQC). When I try to unload domain it seems like RMQC prevents to do it 
gracefully.
ConnectionBase creates 2 _foreground_ threads which in case of absence of 
messages are blocked inside Socket.Receive and do not check external flags 
like m_running/m_closed.
Yes, ConnectionBase has subscription to DomainUnload:

AppDomain <http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.AppDomain>.CurrentDomain <http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/property:CurrentDomain:System.AppDomain>.DomainUnload <http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/event:DomainUnload:System.EventHandler> += new EventHandler <http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventHandler>(this.HandleDomainUnload <http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://RabbitMQ.Client:3.2.1.0:89e7d7c5feba84ce/RabbitMQ.Client.Impl.ConnectionBase/HandleDomainUnload(Object,System.EventArgs)>);


but it won't be called if any foreground threads prevent domain from unloading.

It would be nice if all threads created inside ConnectionBase would have IsBackground set to true.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/5ade041e/attachment.html>

From james.rivettcarnac at neo.com  Thu May 22 03:06:11 2014
From: james.rivettcarnac at neo.com (james.rivettcarnac at neo.com)
Date: Wed, 21 May 2014 19:06:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering behind a firewall
Message-ID: <82f45fd9-8f61-446e-9d67-1110062c95fd@googlegroups.com>



I'm having some issues with clustering and a firewall.  During setup of the 
cluster over tcp, epmd opens a bunch of ephemeral ports > 30000 that vanish 
after the clustering is set up.  If my iptable rules DROP by default, these 
hang up on the tcp handshake.

I can't find any reference for ports like this being used. My 
inet_dist_listen_min/max work (when i turn off the firewall, the correct 
port is being used) but they have no effect on these random ports.


Some output:

[vagrant at queue1 ~]$ sudo iptables --list --verbose -n

Chain INPUT (policy DROP 61566 packets, 3702K bytes)

 pkts bytes target     prot opt in     out     source               
destination

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           state NEW tcp dpts:9100:9105

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           state NEW tcp dpts:25672:25682

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:25672

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:4369

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:443

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:80

   85  4616 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:22

95330   16M ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:15672

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:5673

    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0           
 0.0.0.0/0           tcp dpt:5672

    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0           
 0.0.0.0/0

    0     0 ACCEPT     all  --  *      *       192.168.50.3         
0.0.0.0/0



And for my netstat:


[vagrant at queue1 ~]$ sudo netstat

Active Internet connections (w/o servers)

Proto Recv-Q Send-Q Local Address               Foreign Address             
State

tcp        0      0 192.168.50.3:15672          192.168.50.1:56986         
 ESTABLISHED

tcp        0      0 192.168.50.3:15672          192.168.50.1:56983         
 ESTABLISHED

tcp        0      0 192.168.50.3:15672          192.168.50.1:56982         
 ESTABLISHED

tcp        0      1 192.168.50.3:48424          queue0.zombiehorde.loc:epmd 
SYN_SENT

tcp        0      0 192.168.50.3:15672          192.168.50.1:56342         
 ESTABLISHED

tcp        0      0 queue1.zombiehorde.loc:epmd queue1.zombiehorde.lo:42469 
ESTABLISHED

tcp        0      0 10.0.2.15:ssh               10.0.2.2:53317             
 ESTABLISHED

tcp        0      0 192.168.50.3:15672          192.168.50.1:56985         
 ESTABLISHED

tcp        0      0 queue1.zombiehorde.lo:42469 queue1.zombiehorde.loc:epmd 
ESTABLISHED

tcp        0      1 192.168.50.3:53772          queue0.zombiehorde.loc:epmd 
SYN_SENT



Note - the SYN_SENT (right when I restart the service, there are a bunch 
more of these.  I assume epmd throttles down the connection attempts after 
number of failed attempts)


Best regards,


James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140521/addd7ca1/attachment.html>

From simon at rabbitmq.com  Thu May 22 09:37:39 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 09:37:39 +0100
Subject: [rabbitmq-discuss] Plugin example using Rebar to manage
	dependancies
In-Reply-To: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>
References: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>
Message-ID: <537DB753.9030201@rabbitmq.com>

On 22/05/2014 09:14, Mark DeVilliers wrote:
> Failing that is there any guidance for managing dependencies rather than
> copying them into the plugin? A link to a working example would be awesome.

If using the RabbitMQ build system, you need a -wrapper repository for 
each external dependency. This will clone the original project, patch it 
as needed and build a .ez from it. The one for webmachine is probably 
the simplest: http://hg.rabbitmq.com/webmachine-wrapper/. See the 
package.mk file for where most things happen.

Then the plugin using it just needs to add the -wrapper project to its 
DEPS line:

http://hg.rabbitmq.com/rabbitmq-management/file/6c5a6856eca4/package.mk#l2

Cheers, Simon

From simon at rabbitmq.com  Thu May 22 09:38:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 09:38:38 +0100
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
Message-ID: <537DB78E.8010409@rabbitmq.com>

On 21/05/2014 21:24, charles.sartori at azion.com wrote:
> I am trying to set my queue to expire in 3 months, looking at docs[1], I
> should set x-expires to 3 months(in milliseconds), Of course, 3months in
> miliseconds is to big and I can't do that, I can set expires to max 7
> days(in miliseconds).

I'm afraid not, it's a known limitation.

Cheers, Simon


From mklishin at gopivotal.com  Thu May 22 09:41:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 12:41:14 +0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
 <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
Message-ID: <etPan.537db846.41b71efb.5f0b@mercurio.local>

?On 22 May 2014 at 12:33:14, Jeffrey Becker (jeffrey.a.becker at gmail.com) wrote:
> > write:errno=104

Can you please post full openssl s_client output? If there's an error, there should
be some extra info in the output.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 22 09:43:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 12:43:49 +0400
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
 <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
 <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
Message-ID: <etPan.537db8e0.7545e146.5f0b@mercurio.local>

On 22 May 2014 at 12:33:14, Jeffrey Becker (jeffrey.a.becker at gmail.com) wrote:
> > Configuration is as such:

Also, in this tutorial that configures Rabbit with SSL on Windows, slashes are
used in paths instead of double backslashes:
http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbitmq.html

I'm not a ?Windows user, so maybe this sounds silly but can you try using slashes
as in the post above?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 22 09:46:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 12:46:47 +0400
Subject: [rabbitmq-discuss] RabbitMq client and AppDomain unload
In-Reply-To: <7ea22dec-73c8-4e90-90ca-f81fab5c00f0@googlegroups.com>
References: <7ea22dec-73c8-4e90-90ca-f81fab5c00f0@googlegroups.com>
Message-ID: <etPan.537db995.5bd062c2.5f0b@mercurio.local>

On 22 May 2014 at 12:38:03, Dmitry Naumov (dmitry.naumov78 at gmail.com) wrote:
> > I have separate AppDomains (not primary) where I use RabbitMq.Client 
> (RMQC). When I try to unload domain it seems like RMQC prevents 
> to do it gracefully.
> ConnectionBase creates 2 _foreground_ threads which in case 
> of absence of messages are blocked inside Socket.Receive and 
> do not check external flags like m_running/m_closed.
> Yes, ConnectionBase has subscription to DomainUnload:
> 
> AppDomain(http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.AppDomain).CurrentDomain(http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/property:CurrentDomain:System.AppDomain).DomainUnload(http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/event:DomainUnload:System.EventHandler) 
> += new EventHandler(http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventHandler)(this.HandleDomainUnload(http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://RabbitMQ.Client:3.2.1.0:89e7d7c5feba84ce/RabbitMQ.Client.Impl.ConnectionBase/HandleDomainUnload(Object,System.EventArgs))); 
> 
> but it won't be called if any foreground threads prevent domain 
> from unloading.
> It would be nice if all threads created inside ConnectionBase 
> would have IsBackground set to true.

Dmitry,

Thanks for reminding, we have a bug filed for that.
I will try to look into it sooner .
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu May 22 09:48:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 09:48:01 +0100
Subject: [rabbitmq-discuss] Limit number of concurrent connections
In-Reply-To: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
References: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
Message-ID: <537DB9C1.9030103@rabbitmq.com>

On 21/05/2014 18:12, Navdeep Singh wrote:
> Kindly let me know how can I limit the number of simultaneous
> connections in RabbitMQ. Is there a way to do it and if yes how it can
> be achived. Kindly look at cloudamqp.com <http://cloudamqp.com> who are
> able to do it by limiting 3 connections for free plan.

You'd need to do it with an external agent polling the management API or 
listening to the events exchange and then closing connections which are 
over the limit. There's no other way I'm afraid.

Cheers, Simon


From Mark.deVilliers at Aeriandi.com  Thu May 22 09:51:37 2014
From: Mark.deVilliers at Aeriandi.com (Mark DeVilliers)
Date: Thu, 22 May 2014 08:51:37 +0000
Subject: [rabbitmq-discuss] Plugin example using Rebar to manage
 dependancies
In-Reply-To: <537DB753.9030201@rabbitmq.com>
References: <F8529FD7D0704748807B0F0A1B7B4AAB6A9712CB@1AERDCEXCHMBX1.AER.AERCO.local>,
 <537DB753.9030201@rabbitmq.com>
Message-ID: <F8529FD7D0704748807B0F0A1B7B4AAB6A972358@1AERDCEXCHMBX1.AER.AERCO.local>

Thanks Simon, Michael,

The explanation about the wrapper project and how to include it is exactly what I'm looking for. 

Thanks again,

Mark
________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Thursday, May 22, 2014 9:37 AM
To: Discussions about RabbitMQ; Mark DeVilliers
Subject: Re: [rabbitmq-discuss] Plugin example using Rebar to manage dependancies

On 22/05/2014 09:14, Mark DeVilliers wrote:
> Failing that is there any guidance for managing dependencies rather than
> copying them into the plugin? A link to a working example would be awesome.

If using the RabbitMQ build system, you need a -wrapper repository for
each external dependency. This will clone the original project, patch it
as needed and build a .ez from it. The one for webmachine is probably
the simplest: http://hg.rabbitmq.com/webmachine-wrapper/. See the
package.mk file for where most things happen.

Then the plugin using it just needs to add the -wrapper project to its
DEPS line:

http://hg.rabbitmq.com/rabbitmq-management/file/6c5a6856eca4/package.mk#l2

Cheers, Simon


From matthias at rabbitmq.com  Thu May 22 09:53:09 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 May 2014 09:53:09 +0100
Subject: [rabbitmq-discuss] Limit number of concurrent connections
In-Reply-To: <537DB9C1.9030103@rabbitmq.com>
References: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
 <537DB9C1.9030103@rabbitmq.com>
Message-ID: <537DBAF5.6060105@rabbitmq.com>

On 22/05/14 09:48, Simon MacMullen wrote:
> On 21/05/2014 18:12, Navdeep Singh wrote:
>> Kindly let me know how can I limit the number of simultaneous
>> connections in RabbitMQ. Is there a way to do it and if yes how it can
>> be achived. Kindly look at cloudamqp.com <http://cloudamqp.com> who are
>> able to do it by limiting 3 connections for free plan.
>
> You'd need to do it with an external agent polling the management API or
> listening to the events exchange and then closing connections which are
> over the limit. There's no other way I'm afraid.

Or connect via a sufficiently smart proxy.

Matthias.

From simon at rabbitmq.com  Thu May 22 09:54:11 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 09:54:11 +0100
Subject: [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl not being
 presented as an auth_mechanism to clients
In-Reply-To: <e1bad162-7e9a-4661-b088-0413c094af6c@googlegroups.com>
References: <e1bad162-7e9a-4661-b088-0413c094af6c@googlegroups.com>
Message-ID: <537DBB33.8040700@rabbitmq.com>

On 21/05/2014 21:41, Jeffrey Becker wrote:
> I'm attempting to configure RabbitMQ to use ssl authentication.  The C#
> client is failing with the error
>
>     No compatible authentication mechanism found - server offered []
>
>
> When rabbitmq.config has the settings
>
>     {auth_mechanisms, ['EXTERNAL']},

Hmm. The response from the C# client is a literal representation of what 
the server sent on the wire. So the server is refusing to use EXTERNAL 
for some reason. Things to check:

* Is the auth_mechanisms part of config in the right place / being read? 
(Check with "rabbitmqctl environment".)

* Does it show up in the registry? (Check management node details page 
under "registry").

* EXTERNAL will refuse to work on non-SSL connections or if there is no 
client certificate presented - this is probably the most likely issue.

Cheers, Simon

From mklishin at gopivotal.com  Thu May 22 09:57:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 12:57:34 +0400
Subject: [rabbitmq-discuss] Limit number of concurrent connections
In-Reply-To: <537DBAF5.6060105@rabbitmq.com>
References: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
 <537DB9C1.9030103@rabbitmq.com> <537DBAF5.6060105@rabbitmq.com>
Message-ID: <etPan.537dbc1c.4db127f8.5f0b@mercurio.local>

?On 22 May 2014 at 12:53:59, Matthias Radestock (matthias at rabbitmq.com) wrote:
> > Or connect via a sufficiently smart proxy.

e.g. haproxy which has maxconn:
http://haproxy.1wt.eu/download/1.3/doc/haproxy-en.txt
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Thu May 22 10:02:08 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 May 2014 10:02:08 +0100
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <537DB78E.8010409@rabbitmq.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
Message-ID: <537DBD10.9060105@rabbitmq.com>

On 22/05/14 09:38, Simon MacMullen wrote:
> On 21/05/2014 21:24, charles.sartori at azion.com wrote:
>> I am trying to set my queue to expire in 3 months, looking at docs[1], I
>> should set x-expires to 3 months(in milliseconds), Of course, 3months in
>> miliseconds is to big and I can't do that, I can set expires to max 7
>> days(in miliseconds).
>
> I'm afraid not, it's a known limitation.

...in the broker, which can only cope with timers of 2^32-1 milliseconds 
max duration. That's 49.7 days though, not 7.

Matthias.

From 366345963 at qq.com  Thu May 22 10:15:51 2014
From: 366345963 at qq.com (=?gb18030?B?tva57dK7uPY=?=)
Date: Thu, 22 May 2014 17:15:51 +0800
Subject: [rabbitmq-discuss] REMOVE ME
In-Reply-To: <537DBD10.9060105@rabbitmq.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com> <537DBD10.9060105@rabbitmq.com>
Message-ID: <tencent_529DDD857AB3E3510184E7ED@qq.com>

------------------ Original ------------------
From:  "Matthias Radestock";<matthias at rabbitmq.com>;
Date:  Thu, May 22, 2014 05:02 PM
To:  "rabbitmq-discuss at lists.rabbitmq.com"<rabbitmq-discuss at lists.rabbitmq.com>; 

Subject:  Re: [rabbitmq-discuss] Queue TTL



On 22/05/14 09:38, Simon MacMullen wrote:
> On 21/05/2014 21:24, charles.sartori at azion.com wrote:
>> I am trying to set my queue to expire in 3 months, looking at docs[1], I
>> should set x-expires to 3 months(in milliseconds), Of course, 3months in
>> miliseconds is to big and I can't do that, I can set expires to max 7
>> days(in miliseconds).
>
> I'm afraid not, it's a known limitation.

...in the broker, which can only cope with timers of 2^32-1 milliseconds 
max duration. That's 49.7 days though, not 7.

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/3fa5634b/attachment.html>

From mklishin at gopivotal.com  Thu May 22 11:04:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 14:04:54 +0400
Subject: [rabbitmq-discuss] Limit number of concurrent connections
In-Reply-To: <CAE26jO7ZbaiXzxHaPD1=gjYWhZkLzvQdO6u2=qJTmTYcj3JDjg@mail.gmail.com>
References: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
 <537DB9C1.9030103@rabbitmq.com> <537DBAF5.6060105@rabbitmq.com>
 <etPan.537dbc1c.4db127f8.5f0b@mercurio.local>
 <CAE26jO7ZbaiXzxHaPD1=gjYWhZkLzvQdO6u2=qJTmTYcj3JDjg@mail.gmail.com>
Message-ID: <etPan.537dcbe0.1f16e9e8.5f0b@mercurio.local>

On 22 May 2014 at 13:55:11, Navdeep Singh (navdeep.bhogal at gmail.com) wrote:
> > But Michael, I have a question here that if I have to limit connections  
> at the vhost level how I will be able to do it. As haproxy maxconn  
> parameter is at the member pool level but I am sure it will not be  
> able to understand vhost.

TCP proxies are unaware of vhosts. For that, you need to monitor connections over HTTP API
as Simon suggested.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Thu May 22 11:09:26 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 May 2014 11:09:26 +0100
Subject: [rabbitmq-discuss] Limit number of concurrent connections
In-Reply-To: <etPan.537dcbe0.1f16e9e8.5f0b@mercurio.local>
References: <CAE26jO7zCedQxH20w+_MnbnKjUhS-gmBntYC0be-p6iA=OWU2A@mail.gmail.com>
 <537DB9C1.9030103@rabbitmq.com> <537DBAF5.6060105@rabbitmq.com>
 <etPan.537dbc1c.4db127f8.5f0b@mercurio.local>
 <CAE26jO7ZbaiXzxHaPD1=gjYWhZkLzvQdO6u2=qJTmTYcj3JDjg@mail.gmail.com>
 <etPan.537dcbe0.1f16e9e8.5f0b@mercurio.local>
Message-ID: <537DCCD6.1030706@rabbitmq.com>

On 22/05/14 11:04, Michael Klishin wrote:
> On 22 May 2014 at 13:55:11, Navdeep Singh (navdeep.bhogal at gmail.com)
> wrote:
>>> But Michael, I have a question here that if I have to limit
>>> connections
>> at the vhost level how I will be able to do it. As haproxy maxconn
>> parameter is at the member pool level but I am sure it will not be
>> able to understand vhost.
>
> TCP proxies are unaware of vhosts. For that, you need to monitor
> connections over HTTP API as Simon suggested.

Or use a proxy that is AMQP-aware and can thus track connections by 
vhost. No idea whether such a thing exists, but it wouldn't be hard to 
write.

Matthias.

From rohitmukherjee26 at gmail.com  Thu May 22 11:40:53 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Thu, 22 May 2014 18:40:53 +0800
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting down
	frequently..
Message-ID: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>

HI Team,



RabbitMQ nodes are getting shutdown automatically , Can you please suggest
how should I fix the issue ..Please find the Log Strace Below





=INFO REPORT==== 22-May-2014::09:43:12 ===

Mirrored queue 'win_es' in vhost '/': Promoting slave
<rabbit at vpc-prod-rabbitmq02.1.10232.0> to master



=INFO REPORT==== 22-May-2014::09:58:07 ===

Stopping RabbitMQ



=INFO REPORT==== 22-May-2014::09:58:07 ===

stopped TCP Listener on [::]:5672



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10638.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10358.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10524.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10355.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10387.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10352.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10384.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10463.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10349.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10381.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10493.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=ERROR REPORT==== 22-May-2014::09:58:07 ===

AMQP connection <0.10346.0> (running), channel 0 - error:

{amqp_error,connection_forced,

            "broker forced connection closure with reason 'shutdown'",none}



=INFO REPORT==== 22-May-2014::09:58:08 ===

Halting Erlang VM



=====
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/10ba17d3/attachment.html>

From simon at rabbitmq.com  Thu May 22 11:47:21 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 11:47:21 +0100
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting
 down frequently..
In-Reply-To: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
References: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
Message-ID: <537DD5B9.1090801@rabbitmq.com>

On 22/05/14 11:40, Rohit Mukherjee wrote:
> RabbitMQ nodes are getting shutdown automatically , Can you please
> suggest how should I fix the issue ..Please find the Log Strace Below

The log message:

> =INFO REPORT==== 22-May-2014::09:58:08 ===
> Halting Erlang VM

will only ever be logged if something outside the server specifically 
instructs it to shut down. That's not something that the server will 
ever decide to do for itself.

So you need to find what external thing is stopping the server.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu May 22 12:21:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 22 May 2014 15:21:52 +0400
Subject: [rabbitmq-discuss] RabbitMq client and AppDomain unload
In-Reply-To: <etPan.537db995.5bd062c2.5f0b@mercurio.local>
References: <7ea22dec-73c8-4e90-90ca-f81fab5c00f0@googlegroups.com>
 <etPan.537db995.5bd062c2.5f0b@mercurio.local>
Message-ID: <etPan.537dddeb.7fdcc233.5f0b@mercurio.local>

On 22 May 2014 at 12:47:17, Michael Klishin (mklishin at gopivotal.com) wrote:
> > > but it won't be called if any foreground threads prevent domain  
> > from unloading.
> > It would be nice if all threads created inside ConnectionBase  
> > would have IsBackground set to true.
>  
> Dmitry,
>  
> Thanks for reminding, we have a bug filed for that.
> I will try to look into it sooner .

Right, so after some research, it appears that the conclusion for
both the .NET and Java client was that foreground threads make more sense.

For domain unloading, consider using?AppDomain.DomainUnload:
?

and close RabbitMQ connection cleanly, which will terminate all internal threads.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From jeffreyabecker at janney.com  Thu May 22 14:00:05 2014
From: jeffreyabecker at janney.com (Becker, Jeffrey)
Date: Thu, 22 May 2014 13:00:05 +0000
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <CACjM4Qg29B=einNFAu47BQSSiqpaEK6QO8JXSM9wQuKTrBS++A@mail.gmail.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
 <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
 <etPan.537db8e0.7545e146.5f0b@mercurio.local>
 <CACjM4Qg29B=einNFAu47BQSSiqpaEK6QO8JXSM9wQuKTrBS++A@mail.gmail.com>
Message-ID: <ADE38E95806BA84AB03AC5674E976FE012E3DA2D@phmailp02.JMSOnline.com>

It seems as if I missed escaping a backslash on one of my paths.  I?ve changed them all over to forward slashes per your recommendation.  This doesn?t fix the issue but at least my error messages are different.
When I run the C# client I see the following exceptions:

None of the specified endpoints were reachable
    Inner Exception:
    A call to SSPI failed, see inner exception.
        Inner Exception:
        The message received was unexpected or badly formatted

When I run openssl s_client I see:

    CONNECTED(00000003)
    depth=1 /CN=JanneyDevCA
    verify return:1
    depth=0 /CN=svcbus-app03-dv.dev.jmsonline.com/ST=PA/C=US/O=Janney, Montgomery, Scott LLC
    verify return:1
    3020:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure:s3_pkt.c:1053:SSL alert number 40
    3020:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:188:

Either way the server log gets a message:
    =INFO REPORT==== 22-May-2014::08:42:20 ===
    accepting AMQP connection <0.327.0> (172.23.68.48:50220 -> 172.31.2.46:5671)

    =ERROR REPORT==== 22-May-2014::08:42:20 ===
    SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake failure

    =ERROR REPORT==== 22-May-2014::08:42:25 ===
    error on AMQP connection <0.327.0>: {ssl_upgrade_error,{tls_alert,[104,97,110,100,115,104,97,107,101,32,102,97,105,108,117,114,101]}}...


From: Jeffrey Becker [mailto:jeffrey.a.becker at gmail.com]
Sent: Thursday, May 22, 2014 8:47 AM
To: Becker, Jeffrey
Subject: Fwd: Re: [rabbitmq-discuss] Error with SSL

---------- Forwarded message ----------
From: "Michael Klishin" <mklishin at gopivotal.com<mailto:mklishin at gopivotal.com>>
Date: May 22, 2014 4:44 AM
Subject: Re: [rabbitmq-discuss] Error with SSL
To: "Jeffrey Becker" <jeffrey.a.becker at gmail.com<mailto:jeffrey.a.becker at gmail.com>>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>

On 22 May 2014 at 12:33:14, Jeffrey Becker (jeffrey.a.becker at gmail.com<mailto:jeffrey.a.becker at gmail.com>) wrote:
> > Configuration is as such:

Also, in this tutorial that configures Rabbit with SSL on Windows, slashes are
used in paths instead of double backslashes:
http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbitmq.html

I'm not a  Windows user, so maybe this sounds silly but can you try using slashes
as in the post above?
--
MK

Software Engineer, Pivotal/RabbitMQ


Janney: The Highest Standard of Success in Financial Relationships.


Janney Montgomery Scott LLC (Janney) will not accept orders and/or instructions for the purchase or sale of a security or other product via an e-mail transmission. This electronic communication is intended only for the person or entity to which it is addressed and may contain confidential, proprietary or privileged material. Any review, re-transmission, dissemination or other use of this information by persons or entities other than the intended recipient is prohibited. No confidentiality or privilege is waived by any accidental or unintentional transmission. If you received this electronic communication in error, please contact the sender immediately and delete the material from your computer. Janney cannot guarantee the confidentiality of the material transmitted and reserves the right to monitor all e-mail communications through its networks. Please go to http://www.janney.com for additional terms and disclosures relating to this electronic communication.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/0a8f0f47/attachment.html>

From simon at rabbitmq.com  Thu May 22 14:31:39 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 14:31:39 +0100
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <CALBvAyvdZqNNrOytXeXqVUmah+i8EWkJa3eM0pAqC=8HcckDrg@mail.gmail.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
 <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>
 <CALBvAyvdZqNNrOytXeXqVUmah+i8EWkJa3eM0pAqC=8HcckDrg@mail.gmail.com>
Message-ID: <537DFC3B.4070100@rabbitmq.com>

On 22/05/14 14:14, Charles Sartori wrote:
> Do you know if is it a bug and will be fixed in the future versions?

I would say "limitation" rather than "bug" but it might get fixed. It 
depends how much demand there is.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From charles.sartori at azion.com  Thu May 22 13:41:32 2014
From: charles.sartori at azion.com (Charles Sartori)
Date: Thu, 22 May 2014 09:41:32 -0300
Subject: [rabbitmq-discuss] |Spam| Re:  Queue TTL
In-Reply-To: <537DB78E.8010409@rabbitmq.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
Message-ID: <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>

Thank you Simon.


Charles Sartori

Porto Alegre, Brasil + 55 51 3012 3005
Miami, USA + 1 305 704 8816

Quaisquer informa??es contidas neste e-mail e anexos podem ser
confidenciais e privilegiadas, protegidas por sigilo legal. Qualquer forma
de utiliza??o deste documento depende de autoriza??o do emissor, sujeito as
penalidades cab?veis.

Any information in this e-mail and attachments may be confidential and
privileged, protected by legal confidentiality. The use of this document
require authorization by the issuer, subject to penalties.


2014-05-22 5:38 GMT-03:00 Simon MacMullen <simon at rabbitmq.com>:

> On 21/05/2014 21:24, charles.sartori at azion.com wrote:
>
>> I am trying to set my queue to expire in 3 months, looking at docs[1], I
>> should set x-expires to 3 months(in milliseconds), Of course, 3months in
>> miliseconds is to big and I can't do that, I can set expires to max 7
>> days(in miliseconds).
>>
>
> I'm afraid not, it's a known limitation.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/8ef6dbb3/attachment.html>

From steffen.daniel.jensen at gmail.com  Thu May 22 14:04:12 2014
From: steffen.daniel.jensen at gmail.com (Steffen Daniel Jensen)
Date: Thu, 22 May 2014 06:04:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
Message-ID: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>

We have two data centers connected closely by LAN. 
 
We are interested in a *reliable cluster* setup. It must be a cluster 
because we want clients to be able to connect to each node transparently. 
Federation is not an option.
1. It happens that the firewall/switch is restarted, and maybe a few ping 
messages are lost.
2. The setup should survive data center crash
3. All queues are durable and mirrored, all messages are persisted, all 
publishes are confirmed
 
There are 3 cluster-recovery settings
a) ignore: A cross data center network break-down would cause message loss 
on the node that is restarted In order to rejoin.
b) pause_minority: If we choose the same number of nodes in each data 
center, the whole cluster will pause. If we don't, only the data center 
with the most nodes can survive. 
c) auto_heal: If the cluster decides network partitioning, there is a 
potential of message loss, when joining.
[I would really like a resync-setting similar to the one described below]
 
Question 1: Is it even possible to have a fully reliable setup in such a 
setting?
 
In reality we probably won't have actual network partitions, and it will 
most probably only be a very short network downtime.
 
Question 2: Is it possible to adjust how long it takes rabbitmq to decide 
"node down"?
 
It is much better to have a halted rabbitmq for some seconds than to have 
message loss.
 
 
Question 3: Assume that we are using the ignore setting, and that we have 
only two nodes in the cluster. Would the following be a full recovery with 
zero message loss? 
 
0. Decide which node survives, Ns, and which should be restarted, Nr.
1. Refuse all connections to Nr except from a special recovery application. 
(One could change the ip, so all running services can't connect or similar)
2. Consume and republish all message from Nr to Ns.
3. Restart Nr
Then the cluster should be up-and-running again.
 
Since all queues are mirrored, all messages published in the partition time 
is preserved. If a certain service lives only in the one data center, 
messages will pile up in the other (if there are any publishes).
 
If you have any other suggestions, I would be very interested to hear them.
 
I would be really sad to find it necessary to choose Tibco ESB over 
RabbitMQ, for this reason.
 
Thank you,
-- Steffen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/7c6d6d40/attachment.html>

From charles.sartori at azion.com  Thu May 22 14:14:34 2014
From: charles.sartori at azion.com (Charles Sartori)
Date: Thu, 22 May 2014 10:14:34 -0300
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
 <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>
Message-ID: <CALBvAyvdZqNNrOytXeXqVUmah+i8EWkJa3eM0pAqC=8HcckDrg@mail.gmail.com>

Do you know if is it a bug and will be fixed in the future versions?


Charles Sartori

Porto Alegre, Brasil + 55 51 3012 3005
Miami, USA + 1 305 704 8816

Quaisquer informa??es contidas neste e-mail e anexos podem ser
confidenciais e privilegiadas, protegidas por sigilo legal. Qualquer forma
de utiliza??o deste documento depende de autoriza??o do emissor, sujeito as
penalidades cab?veis.

Any information in this e-mail and attachments may be confidential and
privileged, protected by legal confidentiality. The use of this document
require authorization by the issuer, subject to penalties.


2014-05-22 9:41 GMT-03:00 Charles Sartori <charles.sartori at azion.com>:

> Thank you Simon.
>
>
> Charles Sartori
>
> Porto Alegre, Brasil + 55 51 3012 3005
> Miami, USA + 1 305 704 8816
>
> Quaisquer informa??es contidas neste e-mail e anexos podem ser
> confidenciais e privilegiadas, protegidas por sigilo legal. Qualquer forma
> de utiliza??o deste documento depende de autoriza??o do emissor, sujeito as
> penalidades cab?veis.
>
> Any information in this e-mail and attachments may be confidential and
> privileged, protected by legal confidentiality. The use of this document
> require authorization by the issuer, subject to penalties.
>
>
> 2014-05-22 5:38 GMT-03:00 Simon MacMullen <simon at rabbitmq.com>:
>
> On 21/05/2014 21:24, charles.sartori at azion.com wrote:
>>
>>> I am trying to set my queue to expire in 3 months, looking at docs[1], I
>>> should set x-expires to 3 months(in milliseconds), Of course, 3months in
>>> miliseconds is to big and I can't do that, I can set expires to max 7
>>> days(in miliseconds).
>>>
>>
>> I'm afraid not, it's a known limitation.
>>
>> Cheers, Simon
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/df537091/attachment.html>

From mcintoshj at gmail.com  Thu May 22 17:16:58 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 22 May 2014 11:16:58 -0500
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
Message-ID: <CAD6m6fFbmmJ+PFcyk0szWpFv3DfbahJAmeYXWZyhLvk7uiSv6g@mail.gmail.com>

On your clustering and clients connecting transparently - I highly
recommend a load balancer in front of your Rabbit servers.  With tcp-half
open monitoring on the rabbit port, you can tell pretty quickly when a
node/site goes down, and then get failover to one of the other
nodes/clusters.  With clustering and mirrored queues and by using publisher
confirms you'll avoid data loss this way.  You CAN get data duplication
though.  But I'd only recommend clustering over a really reliable link.  If
you're going across a WAN - use shovel/federations to replicate messages to
rabbit clusters on the other side, vs. trying to do cross-wan clusters.
 You could for run a cluster in each site and use federation to send
messages to the other cluster as needed.  If any given site goes down, your
load balancer could switch traffic to the other cluster.  There's still a
chance for downtime, but it's pretty minimal.  We use this to redirect
traffic to any given node in the cluster right now so if a single node
fails, the load balancers pull that node out of service automatically.

Regarding question 2 - if you design it right, using confirms (the default
in most clients as i understand it), and use persistent messages, you'll
never get message loss with a mirrored queue, unless ALL servers completely
crash and hard drives die.  At least this is my understanding :)

Last point - you may want to do manual handling of this situation if it's
that much of concern.  e.g. let the nodes remain partitioned, let all
messages empty (again, remember there would be duplicates possible), then
restrict access to the bad nodes to anything but your consumer processes,
shut down the "bad" nodes and bring them back up.  They'd not have any
messages, and they'd get their queues/exchanges from  your "master" node
that was good when they come back up.  In the case of a load balancer in
front, you could use your load balancer to control this very effectively.

Definitely read through partitioning and reliability documentation and
actually try these scenarios:
https://www.rabbitmq.com/partitions.html
https://www.rabbitmq.com/reliability.html


Jason




On Thu, May 22, 2014 at 8:04 AM, Steffen Daniel Jensen <
steffen.daniel.jensen at gmail.com> wrote:

> We have two data centers connected closely by LAN.
>
> We are interested in a *reliable cluster* setup. It must be a cluster
> because we want clients to be able to connect to each node transparently.
> Federation is not an option.
> 1. It happens that the firewall/switch is restarted, and maybe a few ping
> messages are lost.
> 2. The setup should survive data center crash
> 3. All queues are durable and mirrored, all messages are persisted, all
> publishes are confirmed
>
> There are 3 cluster-recovery settings
> a) ignore: A cross data center network break-down would cause message
> loss on the node that is restarted In order to rejoin.
> b) pause_minority: If we choose the same number of nodes in each data
> center, the whole cluster will pause. If we don't, only the data center
> with the most nodes can survive.
> c) auto_heal: If the cluster decides network partitioning, there is a
> potential of message loss, when joining.
> [I would really like a resync-setting similar to the one described below]
>
> Question 1: Is it even possible to have a fully reliable setup in such a
> setting?
>
> In reality we probably won't have actual network partitions, and it will
> most probably only be a very short network downtime.
>
> Question 2: Is it possible to adjust how long it takes rabbitmq to decide
> "node down"?
>
> It is much better to have a halted rabbitmq for some seconds than to have
> message loss.
>
>
> Question 3: Assume that we are using the ignore setting, and that we have
> only two nodes in the cluster. Would the following be a full recovery with
> zero message loss?
>
> 0. Decide which node survives, Ns, and which should be restarted, Nr.
> 1. Refuse all connections to Nr except from a special recovery
> application. (One could change the ip, so all running services can't
> connect or similar)
> 2. Consume and republish all message from Nr to Ns.
> 3. Restart Nr
> Then the cluster should be up-and-running again.
>
> Since all queues are mirrored, all messages published in the partition
> time is preserved. If a certain service lives only in the one data center,
> messages will pile up in the other (if there are any publishes).
>
> If you have any other suggestions, I would be very interested to hear them.
>
> I would be really sad to find it necessary to choose Tibco ESB over
> RabbitMQ, for this reason.
>
> Thank you,
> -- Steffen
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/1da85994/attachment.html>

From simon at rabbitmq.com  Thu May 22 17:33:20 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 May 2014 17:33:20 +0100
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
Message-ID: <537E26D0.3070703@rabbitmq.com>

On 22/05/14 14:04, Steffen Daniel Jensen wrote:
> We have two data centers connected closely by LAN.
> We are interested in a *reliable cluster* setup. It must be a cluster
> because we want clients to be able to connect to each node
> transparently. Federation is not an option.

I hope you realise that you are asking for a lot here! You should read 
up on the CAP theorem if you have not already done so.

> 1. It happens that the firewall/switch is restarted, and maybe a few
> ping messages are lost.
> 2. The setup should survive data center crash
> 3. All queues are durable and mirrored, all messages are persisted, all
> publishes are confirmed
> There are 3 cluster-recovery settings
> a) ignore: A cross data center network break-down would cause message
> loss on the node that is restarted In order to rejoin.
> b) pause_minority: If we choose the same number of nodes in each data
> center, the whole cluster will pause. If we don't, only the data center
> with the most nodes can survive.
> c) auto_heal: If the cluster decides network partitioning, there is a
> potential of message loss, when joining.
> [I would really like a resync-setting similar to the one described below]
> Question 1: Is it even possible to have a fully reliable setup in such a
> setting?

Depends how you define "fully reliable". If you want Consistency (i.e. 
mirrored queues), Availability (i.e. neither data centre pauses) and 
Partition tolerance (no loss of data from either side if the network 
goes down between them) then I'm afraid you can't.

> In reality we probably won't have actual network partitions, and it will
> most probably only be a very short network downtime.
> Question 2: Is it possible to adjust how long it takes rabbitmq to
> decide "node down"?

Yes, see http://www.rabbitmq.com/nettick.html

> It is much better to have a halted rabbitmq for some seconds than to
> have message loss.
> Question 3: Assume that we are using the ignore setting, and that we
> have only two nodes in the cluster. Would the following be a full
> recovery with zero message loss?
> 0. Decide which node survives, Ns, and which should be restarted, Nr.
> 1. Refuse all connections to Nr except from a special recovery
> application. (One could change the ip, so all running services can't
> connect or similar)
> 2. Consume and republish all message from Nr to Ns.
> 3. Restart Nr
> Then the cluster should be up-and-running again.

That sounds like it would work. You're losing some availability and 
consistency, and your message ordering will change. You have a pretty 
good chance of duplicating lots of messages too (any that were in the 
queues when the partition happened). Assuming you're happy with that it 
sounds reasonable.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ssinghal at caasco.ca  Thu May 22 18:34:06 2014
From: ssinghal at caasco.ca (Shweta Singhal)
Date: Thu, 22 May 2014 13:34:06 -0400
Subject: [rabbitmq-discuss] Queue disappeared from production server
Message-ID: <537DFCCE.0A2B.00D4.1@caasco.ca>

I need to know possible reasons of how a queue can suddenly disappear?
Please consider the environment before printing this e-mail.

WARNING - CONFIDENTIALITY NOTICE

This e-mail and any attachments may contain confidential and privileged information.  Any use, disclosure, copying or dissemination of this information by a person other than an intended recipient is not authorized and may be illegal. If you are not an intended recipient, please notify the sender immediately by return e-mail, delete this e-mail and destroy any copies. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/61704424/attachment.html>

From steffen.daniel.jensen at gmail.com  Thu May 22 20:04:47 2014
From: steffen.daniel.jensen at gmail.com (Steffen Daniel Jensen)
Date: Thu, 22 May 2014 21:04:47 +0200
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <537E26D0.3070703@rabbitmq.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
Message-ID: <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>

Hi Simon,

Thank you for your reply.

>
>  We have two data centers connected closely by LAN.
>> We are interested in a *reliable cluster* setup. It must be a cluster
>> because we want clients to be able to connect to each node
>> transparently. Federation is not an option.
>>
>
> I hope you realise that you are asking for a lot here! You should read up
> on the CAP theorem if you have not already done so.
>

Yes, I know. But I am not asking an unreasonably lot, IMO :-)
I am aware of the CAP theorem, but I don't see how it is in violation. I am
willing to live with eventual consistency.

1. It happens that the firewall/switch is restarted, and maybe a few
>> ping messages are lost.
>> 2. The setup should survive data center crash
>> 3. All queues are durable and mirrored, all messages are persisted, all
>> publishes are confirmed
>> There are 3 cluster-recovery settings
>> a) ignore: A cross data center network break-down would cause message
>> loss on the node that is restarted In order to rejoin.
>> b) pause_minority: If we choose the same number of nodes in each data
>> center, the whole cluster will pause. If we don't, only the data center
>> with the most nodes can survive.
>> c) auto_heal: If the cluster decides network partitioning, there is a
>> potential of message loss, when joining.
>> [I would really like a resync-setting similar to the one described below]
>> Question 1: Is it even possible to have a fully reliable setup in such a
>> setting?
>>
>
> Depends how you define "fully reliable". If you want Consistency (i.e.
> mirrored queues), Availability (i.e. neither data centre pauses) and
> Partition tolerance (no loss of data from either side if the network goes
> down between them) then I'm afraid you can't.
>

What I mean when I say "reliable" is: All subscribers at the time of
publish will eventually get the message.

That should be possible, assuming that all live inconsistent nodes will
eventually rejoin (without dumping messages). I know this is not the case
in rabbitmq, but it is definitely theoretically possible. I guess this is
what is usually referred to as eventual consistency.


> In reality we probably won't have actual network partitions, and it will
>> most probably only be a very short network downtime.
>> Question 2: Is it possible to adjust how long it takes rabbitmq to
>> decide "node down"?
>>
>
> Yes, see http://www.rabbitmq.com/nettick.html


Thank you! (!)
I have been looking for that one. But I am surprised to see that it is
actually 60sec. Then I really don't understand how I could have seen so
many clusters ending up partitioned.

Do you know what the consequence of doubling it might be?

RabbitMq writes:
Increasing the net_ticktime across all nodes in a cluster will make the
cluster more resilient to short network outtages, but it will take longer
for remaing nodes to detect crashed nodes.

More specifically I wonder what happens in the time a node is actually in
its own network, but before it finds out. In our setup all publishes have
all-HA subscriber queues, with publisher confirm. So I will expect a
distributed agreement that the msg has been persisted. Will a publisher
confirm then block until the node decides that other nodes are down, and
then succeed?

It is much better to have a halted rabbitmq for some seconds than to
>> have message loss.
>> Question 3: Assume that we are using the ignore setting, and that we
>> have only two nodes in the cluster. Would the following be a full
>> recovery with zero message loss?
>> 0. Decide which node survives, Ns, and which should be restarted, Nr.
>> 1. Refuse all connections to Nr except from a special recovery
>> application. (One could change the ip, so all running services can't
>> connect or similar)
>> 2. Consume and republish all message from Nr to Ns.
>> 3. Restart Nr
>> Then the cluster should be up-and-running again.
>>
>
> That sounds like it would work. You're losing some availability and
> consistency, and your message ordering will change. You have a pretty good
> chance of duplicating lots of messages too (any that were in the queues
> when the partition happened). Assuming you're happy with that it sounds
> reasonable.
>

The duplication is ok -- but assuming that rabbit is usually empty, it
won't really happen, I think.
But -- I am sure that rabbit does not guarantee exactly once delivery
anyway.
For that reason, we will build in idempotency for critical messages.

Ordering can always get scrambled when nacking consuming messages, so we
are not assuming ordering either.


About the CAP theorem in relation to rabbit.
Reliable messaging (zero message loss), is often preferred in SOA-settings.
I wonder why vmware/pivotal/... chose not to prioritize this guarantee. It
is aimed by the federation setup, but it is a little to weak in its
synchronization. It would be preferred if it had a possibility of
communicating consumption of messages. Then one could mirror queues between
up/down-stream exchanges, and have even more "availability". One would
definitely give up consistency a little further, but it would be possible
to have the setup above, I think. I know it definitely doesn't come
out-of-the-box, and it is not a part of AMQP, AFAIK, but it seems possible.

Thank you, Simon!

-- S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/fdf9cfd4/attachment.html>

From mcintoshj at gmail.com  Thu May 22 20:45:57 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 22 May 2014 14:45:57 -0500
Subject: [rabbitmq-discuss] Queue disappeared from production server
In-Reply-To: <537DFCCE.0A2B.00D4.1@caasco.ca>
References: <537DFCCE.0A2B.00D4.1@caasco.ca>
Message-ID: <CAD6m6fGTLDWQe1NtXihnwMjMoaY3-fCPeDAKJ11V7PTAzaaFJg@mail.gmail.com>

Did some delete the queue?  Was it tied to a consumer process and the
consumer process restarted?  I believe there were a couple of bugs related
to queue crashes, but that's not quite the same thing as a queue
disappearing.  Anything in the log files?

Jason


On Thu, May 22, 2014 at 12:34 PM, Shweta Singhal <ssinghal at caasco.ca> wrote:

> I need to know possible reasons of how a queue can suddenly disappear?
>
> Please consider the environment before printing this e-mail.
>
> WARNING - CONFIDENTIALITY NOTICE
>
> This e-mail and any attachments may contain confidential and privileged
> information. Any use, disclosure, copying or dissemination of this
> information by a person other than an intended recipient is not authorized
> and may be illegal. If you are not an intended recipient, please notify the
> sender immediately by return e-mail, delete this e-mail and destroy any
> copies.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/e44a3857/attachment.html>

From ron.cordell at gmail.com  Thu May 22 21:04:20 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Thu, 22 May 2014 13:04:20 -0700
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
 <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
Message-ID: <CAFtA53xteWeGA8Lgca_iY-V=nz3eGuFQjDAY_MjhwGk_XeJc9Q@mail.gmail.com>

It seems that one of your assumptions is that a cluster would operate
across data centers. This is not recommended for RabbitMQ and we don't use
it that way - we use shovels between clusters since we, like you, can deal
with eventual consistency.

Our clusters are similar to what you describe. For us, (almost) all queues
are persistent and mirrored because we can't tolerate message loss. We have
seen significant sensitivity to partitioning in Windows OS-based clusters
under very heavy load; we do not see this on Linux and can run at least
twice the load as well.

There is an F5 in front of the cluster, but it doesn't do load balancing
but just acts as a persistent router. We've found that by directing all
traffic to one node and letting it replicate to other nodes we don't have
to deal with issues if a network partition occurs, and they *do* occur
(earlier this week one of the virtual NICs stopped on one of the Rabbit
nodes, for example). The F5 will detect this very quickly and divert
traffic to another node if necessary. (Note to others - we've found that
this arrangement scales significantly better than round robin load
balancing for mirrored persistent queues).

We have clusters in each data center; for clusters that need to replicate
to a different data center there is the shovel. However, there is a chance
of message loss if the application sends the message to the cluster in one
DC and that entire DC is hit by a meteor before the message can be
delivered to the other data center. For most scenarios, however, the
messages will be eventually delivered when the DC comes back up.

Hope that helps a little...

Cheers,

-ronc


On Thu, May 22, 2014 at 12:04 PM, Steffen Daniel Jensen <
steffen.daniel.jensen at gmail.com> wrote:

> Hi Simon,
>
> Thank you for your reply.
>
>>
>>  We have two data centers connected closely by LAN.
>>> We are interested in a *reliable cluster* setup. It must be a cluster
>>> because we want clients to be able to connect to each node
>>> transparently. Federation is not an option.
>>>
>>
>> I hope you realise that you are asking for a lot here! You should read up
>> on the CAP theorem if you have not already done so.
>>
>
> Yes, I know. But I am not asking an unreasonably lot, IMO :-)
> I am aware of the CAP theorem, but I don't see how it is in violation. I
> am willing to live with eventual consistency.
>
> 1. It happens that the firewall/switch is restarted, and maybe a few
>>> ping messages are lost.
>>> 2. The setup should survive data center crash
>>> 3. All queues are durable and mirrored, all messages are persisted, all
>>> publishes are confirmed
>>> There are 3 cluster-recovery settings
>>> a) ignore: A cross data center network break-down would cause message
>>> loss on the node that is restarted In order to rejoin.
>>> b) pause_minority: If we choose the same number of nodes in each data
>>> center, the whole cluster will pause. If we don't, only the data center
>>> with the most nodes can survive.
>>> c) auto_heal: If the cluster decides network partitioning, there is a
>>> potential of message loss, when joining.
>>> [I would really like a resync-setting similar to the one described below]
>>> Question 1: Is it even possible to have a fully reliable setup in such a
>>> setting?
>>>
>>
>> Depends how you define "fully reliable". If you want Consistency (i.e.
>> mirrored queues), Availability (i.e. neither data centre pauses) and
>> Partition tolerance (no loss of data from either side if the network goes
>> down between them) then I'm afraid you can't.
>>
>
> What I mean when I say "reliable" is: All subscribers at the time of
> publish will eventually get the message.
>
> That should be possible, assuming that all live inconsistent nodes will
> eventually rejoin (without dumping messages). I know this is not the case
> in rabbitmq, but it is definitely theoretically possible. I guess this is
> what is usually referred to as eventual consistency.
>
>
>> In reality we probably won't have actual network partitions, and it will
>>> most probably only be a very short network downtime.
>>> Question 2: Is it possible to adjust how long it takes rabbitmq to
>>> decide "node down"?
>>>
>>
>> Yes, see http://www.rabbitmq.com/nettick.html
>
>
> Thank you! (!)
> I have been looking for that one. But I am surprised to see that it is
> actually 60sec. Then I really don't understand how I could have seen so
> many clusters ending up partitioned.
>
> Do you know what the consequence of doubling it might be?
>
> RabbitMq writes:
> Increasing the net_ticktime across all nodes in a cluster will make the
> cluster more resilient to short network outtages, but it will take longer
> for remaing nodes to detect crashed nodes.
>
> More specifically I wonder what happens in the time a node is actually in
> its own network, but before it finds out. In our setup all publishes have
> all-HA subscriber queues, with publisher confirm. So I will expect a
> distributed agreement that the msg has been persisted. Will a publisher
> confirm then block until the node decides that other nodes are down, and
> then succeed?
>
> It is much better to have a halted rabbitmq for some seconds than to
>>> have message loss.
>>> Question 3: Assume that we are using the ignore setting, and that we
>>> have only two nodes in the cluster. Would the following be a full
>>> recovery with zero message loss?
>>> 0. Decide which node survives, Ns, and which should be restarted, Nr.
>>> 1. Refuse all connections to Nr except from a special recovery
>>> application. (One could change the ip, so all running services can't
>>> connect or similar)
>>> 2. Consume and republish all message from Nr to Ns.
>>> 3. Restart Nr
>>> Then the cluster should be up-and-running again.
>>>
>>
>> That sounds like it would work. You're losing some availability and
>> consistency, and your message ordering will change. You have a pretty good
>> chance of duplicating lots of messages too (any that were in the queues
>> when the partition happened). Assuming you're happy with that it sounds
>> reasonable.
>>
>
> The duplication is ok -- but assuming that rabbit is usually empty, it
> won't really happen, I think.
> But -- I am sure that rabbit does not guarantee exactly once delivery
> anyway.
> For that reason, we will build in idempotency for critical messages.
>
> Ordering can always get scrambled when nacking consuming messages, so we
> are not assuming ordering either.
>
>
> About the CAP theorem in relation to rabbit.
> Reliable messaging (zero message loss), is often preferred in
> SOA-settings. I wonder why vmware/pivotal/... chose not to prioritize this
> guarantee. It is aimed by the federation setup, but it is a little to weak
> in its synchronization. It would be preferred if it had a possibility of
> communicating consumption of messages. Then one could mirror queues between
> up/down-stream exchanges, and have even more "availability". One would
> definitely give up consistency a little further, but it would be possible
> to have the setup above, I think. I know it definitely doesn't come
> out-of-the-box, and it is not a part of AMQP, AFAIK, but it seems possible.
>
> Thank you, Simon!
>
> -- S
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/6972a4b1/attachment.html>

From michael.laing at nytimes.com  Thu May 22 21:19:30 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 22 May 2014 16:19:30 -0400
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <CAFtA53xteWeGA8Lgca_iY-V=nz3eGuFQjDAY_MjhwGk_XeJc9Q@mail.gmail.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
 <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
 <CAFtA53xteWeGA8Lgca_iY-V=nz3eGuFQjDAY_MjhwGk_XeJc9Q@mail.gmail.com>
Message-ID: <CAKgmDnGaVwPo1p8j2Cn3=T+d1y+XdLJfq8q9v4f54ic-X7kW7A@mail.gmail.com>

In addition, to protect against meteors, we replicate messages and process
the replicas independently in multiple data centers (actually AWS regions).
Our processing is idempotent, so this works. We resolve replicas in the
output stages.

ml


On Thu, May 22, 2014 at 4:04 PM, Ron Cordell <ron.cordell at gmail.com> wrote:

> It seems that one of your assumptions is that a cluster would operate
> across data centers. This is not recommended for RabbitMQ and we don't use
> it that way - we use shovels between clusters since we, like you, can deal
> with eventual consistency.
>
> Our clusters are similar to what you describe. For us, (almost) all queues
> are persistent and mirrored because we can't tolerate message loss. We have
> seen significant sensitivity to partitioning in Windows OS-based clusters
> under very heavy load; we do not see this on Linux and can run at least
> twice the load as well.
>
> There is an F5 in front of the cluster, but it doesn't do load balancing
> but just acts as a persistent router. We've found that by directing all
> traffic to one node and letting it replicate to other nodes we don't have
> to deal with issues if a network partition occurs, and they *do* occur
> (earlier this week one of the virtual NICs stopped on one of the Rabbit
> nodes, for example). The F5 will detect this very quickly and divert
> traffic to another node if necessary. (Note to others - we've found that
> this arrangement scales significantly better than round robin load
> balancing for mirrored persistent queues).
>
> We have clusters in each data center; for clusters that need to replicate
> to a different data center there is the shovel. However, there is a chance
> of message loss if the application sends the message to the cluster in one
> DC and that entire DC is hit by a meteor before the message can be
> delivered to the other data center. For most scenarios, however, the
> messages will be eventually delivered when the DC comes back up.
>
> Hope that helps a little...
>
> Cheers,
>
> -ronc
>
>
> On Thu, May 22, 2014 at 12:04 PM, Steffen Daniel Jensen <
> steffen.daniel.jensen at gmail.com> wrote:
>
>> Hi Simon,
>>
>> Thank you for your reply.
>>
>>>
>>>  We have two data centers connected closely by LAN.
>>>> We are interested in a *reliable cluster* setup. It must be a cluster
>>>> because we want clients to be able to connect to each node
>>>> transparently. Federation is not an option.
>>>>
>>>
>>> I hope you realise that you are asking for a lot here! You should read
>>> up on the CAP theorem if you have not already done so.
>>>
>>
>> Yes, I know. But I am not asking an unreasonably lot, IMO :-)
>> I am aware of the CAP theorem, but I don't see how it is in violation. I
>> am willing to live with eventual consistency.
>>
>> 1. It happens that the firewall/switch is restarted, and maybe a few
>>>> ping messages are lost.
>>>> 2. The setup should survive data center crash
>>>> 3. All queues are durable and mirrored, all messages are persisted, all
>>>> publishes are confirmed
>>>> There are 3 cluster-recovery settings
>>>> a) ignore: A cross data center network break-down would cause message
>>>> loss on the node that is restarted In order to rejoin.
>>>> b) pause_minority: If we choose the same number of nodes in each data
>>>> center, the whole cluster will pause. If we don't, only the data center
>>>> with the most nodes can survive.
>>>> c) auto_heal: If the cluster decides network partitioning, there is a
>>>> potential of message loss, when joining.
>>>> [I would really like a resync-setting similar to the one described
>>>> below]
>>>> Question 1: Is it even possible to have a fully reliable setup in such a
>>>> setting?
>>>>
>>>
>>> Depends how you define "fully reliable". If you want Consistency (i.e.
>>> mirrored queues), Availability (i.e. neither data centre pauses) and
>>> Partition tolerance (no loss of data from either side if the network goes
>>> down between them) then I'm afraid you can't.
>>>
>>
>> What I mean when I say "reliable" is: All subscribers at the time of
>> publish will eventually get the message.
>>
>> That should be possible, assuming that all live inconsistent nodes will
>> eventually rejoin (without dumping messages). I know this is not the case
>> in rabbitmq, but it is definitely theoretically possible. I guess this is
>> what is usually referred to as eventual consistency.
>>
>>
>>> In reality we probably won't have actual network partitions, and it will
>>>> most probably only be a very short network downtime.
>>>> Question 2: Is it possible to adjust how long it takes rabbitmq to
>>>> decide "node down"?
>>>>
>>>
>>> Yes, see http://www.rabbitmq.com/nettick.html
>>
>>
>> Thank you! (!)
>> I have been looking for that one. But I am surprised to see that it is
>> actually 60sec. Then I really don't understand how I could have seen so
>> many clusters ending up partitioned.
>>
>> Do you know what the consequence of doubling it might be?
>>
>> RabbitMq writes:
>> Increasing the net_ticktime across all nodes in a cluster will make the
>> cluster more resilient to short network outtages, but it will take longer
>> for remaing nodes to detect crashed nodes.
>>
>> More specifically I wonder what happens in the time a node is actually in
>> its own network, but before it finds out. In our setup all publishes have
>> all-HA subscriber queues, with publisher confirm. So I will expect a
>> distributed agreement that the msg has been persisted. Will a publisher
>> confirm then block until the node decides that other nodes are down, and
>> then succeed?
>>
>> It is much better to have a halted rabbitmq for some seconds than to
>>>> have message loss.
>>>> Question 3: Assume that we are using the ignore setting, and that we
>>>> have only two nodes in the cluster. Would the following be a full
>>>> recovery with zero message loss?
>>>> 0. Decide which node survives, Ns, and which should be restarted, Nr.
>>>> 1. Refuse all connections to Nr except from a special recovery
>>>> application. (One could change the ip, so all running services can't
>>>> connect or similar)
>>>> 2. Consume and republish all message from Nr to Ns.
>>>> 3. Restart Nr
>>>> Then the cluster should be up-and-running again.
>>>>
>>>
>>> That sounds like it would work. You're losing some availability and
>>> consistency, and your message ordering will change. You have a pretty good
>>> chance of duplicating lots of messages too (any that were in the queues
>>> when the partition happened). Assuming you're happy with that it sounds
>>> reasonable.
>>>
>>
>> The duplication is ok -- but assuming that rabbit is usually empty, it
>> won't really happen, I think.
>> But -- I am sure that rabbit does not guarantee exactly once delivery
>> anyway.
>> For that reason, we will build in idempotency for critical messages.
>>
>> Ordering can always get scrambled when nacking consuming messages, so we
>> are not assuming ordering either.
>>
>>
>> About the CAP theorem in relation to rabbit.
>> Reliable messaging (zero message loss), is often preferred in
>> SOA-settings. I wonder why vmware/pivotal/... chose not to prioritize this
>> guarantee. It is aimed by the federation setup, but it is a little to weak
>> in its synchronization. It would be preferred if it had a possibility of
>> communicating consumption of messages. Then one could mirror queues between
>> up/down-stream exchanges, and have even more "availability". One would
>> definitely give up consistency a little further, but it would be possible
>> to have the setup above, I think. I know it definitely doesn't come
>> out-of-the-box, and it is not a part of AMQP, AFAIK, but it seems possible.
>>
>> Thank you, Simon!
>>
>> -- S
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/738c4a06/attachment.html>

From alan.antonuk at gmail.com  Thu May 22 21:23:04 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 22 May 2014 20:23:04 +0000
Subject: [rabbitmq-discuss]  Library rabbitmq_c and TCP_NODELAY
References: <1400739424585-35761.post@n5.nabble.com>
Message-ID: <CAAt2po+e5XrsCuVGSv22Vce+k3CjfqP3YQSoCbjwiRVpFDOLOA@mail.gmail.com>

By default rabbitmq-c sets TCP_NODELAY on:

https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_socket.c#L328

There should be no reason for you to be changing this socket parameter.

-Alan

On Wed May 21 2014 at 11:17:40 PM, Haster <haster2004 at yandex.ru> wrote:

> Hi Alan,
>
> In my program I use TCP_NODELAY option of socket.
> And now my code look like:
>
>       connection = amqp_new_connection();
>       if (!connection) {
>         throw RabbitMQException(-1, "Create connection error");
>       }
>       int sockfd = amqp_open_socket(hostName.c_str(), portNumber);  //5672
>       if (sockfd < 0) {
>         std::string err_msg = "Opening socket: ";
>         err_msg += amqp_error_string2(sockfd);
>         throw RabbitMQException(-sockfd, err_msg.c_str());
>       }
>       int nodelay = 1;
>       setsockopt(sockfd, IPPROTO_TCP, TCP_NODELAY, (char*)&nodelay,
> sizeof(nodelay));
>       amqp_set_sockfd(connection, sockfd);
>
> But amqp_set_sockfd function is deprecated now and I'm afraid that it can
> be
> dropped in future versions.
> So can you add supporting TCP_NODELAY option in your future version of
> rabbitmq_c?
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.
> nabble.com/Library-rabbitmq-c-and-TCP-NODELAY-tp35761.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/d56501c0/attachment.html>

From mcintoshj at gmail.com  Thu May 22 21:32:17 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 22 May 2014 15:32:17 -0500
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <CAFtA53xteWeGA8Lgca_iY-V=nz3eGuFQjDAY_MjhwGk_XeJc9Q@mail.gmail.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
 <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
 <CAFtA53xteWeGA8Lgca_iY-V=nz3eGuFQjDAY_MjhwGk_XeJc9Q@mail.gmail.com>
Message-ID: <CAD6m6fGxP+2zWVQsUVrTpyj4Nhf5gyz2gQkLLFjCqMdW_5uZyg@mail.gmail.com>

Interesting piece of info on that F5 and the round robin and performance.
 We've got an F5 as well, with round-robin handling and mirrored persistent
queues.  Our biggest challenge was the number of persistent connections.
 We have over 4k connections to our main production environment right now,
so we try and even out the connections among our servers.  I may want to go
back and look and see if this was really a good idea....  But, we're pure
physical hardware and I don't think I've seen a network partition in the
last 6 months.  We maintain clusters in each center (well, most of our
stuff is actually local nodes that act as a temporary cache and shovel to
another data center for processing).

Jason


On Thu, May 22, 2014 at 3:04 PM, Ron Cordell <ron.cordell at gmail.com> wrote:

> It seems that one of your assumptions is that a cluster would operate
> across data centers. This is not recommended for RabbitMQ and we don't use
> it that way - we use shovels between clusters since we, like you, can deal
> with eventual consistency.
>
> Our clusters are similar to what you describe. For us, (almost) all queues
> are persistent and mirrored because we can't tolerate message loss. We have
> seen significant sensitivity to partitioning in Windows OS-based clusters
> under very heavy load; we do not see this on Linux and can run at least
> twice the load as well.
>
> There is an F5 in front of the cluster, but it doesn't do load balancing
> but just acts as a persistent router. We've found that by directing all
> traffic to one node and letting it replicate to other nodes we don't have
> to deal with issues if a network partition occurs, and they *do* occur
> (earlier this week one of the virtual NICs stopped on one of the Rabbit
> nodes, for example). The F5 will detect this very quickly and divert
> traffic to another node if necessary. (Note to others - we've found that
> this arrangement scales significantly better than round robin load
> balancing for mirrored persistent queues).
>
> We have clusters in each data center; for clusters that need to replicate
> to a different data center there is the shovel. However, there is a chance
> of message loss if the application sends the message to the cluster in one
> DC and that entire DC is hit by a meteor before the message can be
> delivered to the other data center. For most scenarios, however, the
> messages will be eventually delivered when the DC comes back up.
>
> Hope that helps a little...
>
> Cheers,
>
> -ronc
>
>
> On Thu, May 22, 2014 at 12:04 PM, Steffen Daniel Jensen <
> steffen.daniel.jensen at gmail.com> wrote:
>
>> Hi Simon,
>>
>> Thank you for your reply.
>>
>>>
>>>  We have two data centers connected closely by LAN.
>>>> We are interested in a *reliable cluster* setup. It must be a cluster
>>>> because we want clients to be able to connect to each node
>>>> transparently. Federation is not an option.
>>>>
>>>
>>> I hope you realise that you are asking for a lot here! You should read
>>> up on the CAP theorem if you have not already done so.
>>>
>>
>> Yes, I know. But I am not asking an unreasonably lot, IMO :-)
>> I am aware of the CAP theorem, but I don't see how it is in violation. I
>> am willing to live with eventual consistency.
>>
>> 1. It happens that the firewall/switch is restarted, and maybe a few
>>>> ping messages are lost.
>>>> 2. The setup should survive data center crash
>>>> 3. All queues are durable and mirrored, all messages are persisted, all
>>>> publishes are confirmed
>>>> There are 3 cluster-recovery settings
>>>> a) ignore: A cross data center network break-down would cause message
>>>> loss on the node that is restarted In order to rejoin.
>>>> b) pause_minority: If we choose the same number of nodes in each data
>>>> center, the whole cluster will pause. If we don't, only the data center
>>>> with the most nodes can survive.
>>>> c) auto_heal: If the cluster decides network partitioning, there is a
>>>> potential of message loss, when joining.
>>>> [I would really like a resync-setting similar to the one described
>>>> below]
>>>> Question 1: Is it even possible to have a fully reliable setup in such a
>>>> setting?
>>>>
>>>
>>> Depends how you define "fully reliable". If you want Consistency (i.e.
>>> mirrored queues), Availability (i.e. neither data centre pauses) and
>>> Partition tolerance (no loss of data from either side if the network goes
>>> down between them) then I'm afraid you can't.
>>>
>>
>> What I mean when I say "reliable" is: All subscribers at the time of
>> publish will eventually get the message.
>>
>> That should be possible, assuming that all live inconsistent nodes will
>> eventually rejoin (without dumping messages). I know this is not the case
>> in rabbitmq, but it is definitely theoretically possible. I guess this is
>> what is usually referred to as eventual consistency.
>>
>>
>>> In reality we probably won't have actual network partitions, and it will
>>>> most probably only be a very short network downtime.
>>>> Question 2: Is it possible to adjust how long it takes rabbitmq to
>>>> decide "node down"?
>>>>
>>>
>>> Yes, see http://www.rabbitmq.com/nettick.html
>>
>>
>> Thank you! (!)
>> I have been looking for that one. But I am surprised to see that it is
>> actually 60sec. Then I really don't understand how I could have seen so
>> many clusters ending up partitioned.
>>
>> Do you know what the consequence of doubling it might be?
>>
>> RabbitMq writes:
>> Increasing the net_ticktime across all nodes in a cluster will make the
>> cluster more resilient to short network outtages, but it will take longer
>> for remaing nodes to detect crashed nodes.
>>
>> More specifically I wonder what happens in the time a node is actually in
>> its own network, but before it finds out. In our setup all publishes have
>> all-HA subscriber queues, with publisher confirm. So I will expect a
>> distributed agreement that the msg has been persisted. Will a publisher
>> confirm then block until the node decides that other nodes are down, and
>> then succeed?
>>
>> It is much better to have a halted rabbitmq for some seconds than to
>>>> have message loss.
>>>> Question 3: Assume that we are using the ignore setting, and that we
>>>> have only two nodes in the cluster. Would the following be a full
>>>> recovery with zero message loss?
>>>> 0. Decide which node survives, Ns, and which should be restarted, Nr.
>>>> 1. Refuse all connections to Nr except from a special recovery
>>>> application. (One could change the ip, so all running services can't
>>>> connect or similar)
>>>> 2. Consume and republish all message from Nr to Ns.
>>>> 3. Restart Nr
>>>> Then the cluster should be up-and-running again.
>>>>
>>>
>>> That sounds like it would work. You're losing some availability and
>>> consistency, and your message ordering will change. You have a pretty good
>>> chance of duplicating lots of messages too (any that were in the queues
>>> when the partition happened). Assuming you're happy with that it sounds
>>> reasonable.
>>>
>>
>> The duplication is ok -- but assuming that rabbit is usually empty, it
>> won't really happen, I think.
>> But -- I am sure that rabbit does not guarantee exactly once delivery
>> anyway.
>> For that reason, we will build in idempotency for critical messages.
>>
>> Ordering can always get scrambled when nacking consuming messages, so we
>> are not assuming ordering either.
>>
>>
>> About the CAP theorem in relation to rabbit.
>> Reliable messaging (zero message loss), is often preferred in
>> SOA-settings. I wonder why vmware/pivotal/... chose not to prioritize this
>> guarantee. It is aimed by the federation setup, but it is a little to weak
>> in its synchronization. It would be preferred if it had a possibility of
>> communicating consumption of messages. Then one could mirror queues between
>> up/down-stream exchanges, and have even more "availability". One would
>> definitely give up consistency a little further, but it would be possible
>> to have the setup above, I think. I know it definitely doesn't come
>> out-of-the-box, and it is not a part of AMQP, AFAIK, but it seems possible.
>>
>> Thank you, Simon!
>>
>> -- S
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140522/9a8f41f1/attachment.html>

From mklishin at gopivotal.com  Fri May 23 03:42:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 May 2014 06:42:11 +0400
Subject: [rabbitmq-discuss] Queue disappeared from production server
In-Reply-To: <CAD6m6fGTLDWQe1NtXihnwMjMoaY3-fCPeDAKJ11V7PTAzaaFJg@mail.gmail.com>
References: <537DFCCE.0A2B.00D4.1@caasco.ca>
 <CAD6m6fGTLDWQe1NtXihnwMjMoaY3-fCPeDAKJ11V7PTAzaaFJg@mail.gmail.com>
Message-ID: <etPan.537eb59c.6b8b4567.10816@mercurio.local>

On 22 May 2014 at 23:48:09, Jason McIntosh (mcintoshj at gmail.com) wrote:
> > Did some delete the queue? Was it tied to a consumer process and  
> the consumer process restarted?

+ it could be auto-deleted and unbound, or have TTL that ?expired
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sunny.dyal at gmail.com  Fri May 23 08:26:26 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Fri, 23 May 2014 00:26:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
Message-ID: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>

We have have tested 1:1 and 1:M chat with amq.topic (used for 
Publish/Subscribe messaging) on multiple nodes multiple sessions and it 
works. We are thinking to use direct exchange for 1:1. I have doubt "how 
this will work on multiple nodes multiple sessions" What do you suggest for 
followings? 

1. is it ok to use topic exchange for 1:1 and 1:M chat considering multiple 
nodes and multiple session of each user?
2. What do you say about efficiency of topic because we have 10000+ 
increasing users day by day?


Kind Regards

Sunny Dyal
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/1430c2a7/attachment.html>

From mklishin at gopivotal.com  Fri May 23 09:42:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 May 2014 12:42:18 +0400
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
Message-ID: <etPan.537f0a06.643c9869.10816@mercurio.local>

?On 23 May 2014 at 12:37:41, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > 1. is it ok to use topic exchange for 1:1 and 1:M chat considering  
> multiple nodes and multiple session of each user?
> 2. What do you say about efficiency of topic because we have 10000+  
> increasing users day by day?

Topic exchanges is a good choice for 1:n message distribution. For 1:1, you often
can get away with just default exchange and publishing "directly to the queue"
(routing key = target queue name).

Topic exchanges use a trie for matching, this scales well w/ respect to the number
of bindings. Details:

?*?http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/
?*?http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri May 23 09:45:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 May 2014 09:45:57 +0100
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <etPan.537f0a06.643c9869.10816@mercurio.local>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local>
Message-ID: <537F0AC5.5070108@rabbitmq.com>

On 23/05/2014 09:42, Michael Klishin wrote:
> Topic exchanges use a trie for matching, this scales well w/ respect to the number
> of bindings.

Having said that, direct exchanges are still (a bit) faster. But you 
will only see any difference if your application is routing-bound, i.e. 
sending small transient messages at high frequency.

Cheers, Simon

From michael.justin at gmx.net  Fri May 23 10:19:49 2014
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 23 May 2014 11:19:49 +0200
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 .NET producer/STOMP consumer: bad
	content-length possible?
Message-ID: <lln3rn$kj6$1@ger.gmane.org>

Hello,

a user of my (Delphi/Free Pascal) STOMP client for RabbitMQ reported 
random errors where the client library did find a valid STOMP frame in 
the incoming socket data.

The STOMP library reads the number of bytes found in the content-length 
header from the socket. A wrong content-length header value would cause 
the client to read only a partial body, or past the end of the frame and 
- if there are more frames in the socket - into the next frame. (As 
STOMP frames must have a terminating NUL byte, this can be detected by 
the client).

I tried to exchange messages with bad content-length values between 
STOMP clients. But the broker (3.3.0) successfully detects protocol 
errors, so the consumer will not receive the 'bad' message.

Could it be that the reason is not a STOMP client sending invalid 
frames, but a special case inside the broker, caused by data sent from a 
different (non-STOMP) client?

I asked the user which client library is used on the message producer 
side. The environment is:
* RabbitMQ Broker version 3.1.5 running on Windows Server 2008 R2 
Standard, Service Pack 1
* The messages are sent from a C# .NET application using the RabbitMQ 
.NET Client Library version 3.3.0

Suggestions for test cases or other potential causes are very welcome.

Regards
-- 
Michael Justin


From s.ehlas at albumprinter.com  Fri May 23 10:22:10 2014
From: s.ehlas at albumprinter.com (Stephen Ehlas)
Date: Fri, 23 May 2014 09:22:10 +0000
Subject: [rabbitmq-discuss] frame size eror: source F5 Loadbalancer
Message-ID: <6789221D917755409AD829E5EF0EAF5B7F7AD8B5@venmail01.vistaprint.net>

Hi

We have a curious situation with RabbitMQ. When the clients try to connect directly to a rabbitMQ node, all is ok. When we pass them through our F5 load balancer, the 3rd connection attempt is aborted. The load balancer is set to round robin. In the RabbitMQ logs we see this:

=ERROR REPORT==== 22-May-2014::15:25:36 ===
AMQP connection <0.13650.16> (closed), channel 19793 - error:
{amqp_error,frame_error,
            "type 65, all octets = <<>>: {frame_too_large,1342177289,131064}",
            none}

=ERROR REPORT==== 22-May-2014::15:25:39 ===
closing AMQP connection <0.13650.16> (192.168.x.x:50614 -> 192.168.x.x:5672):
fatal_frame_error

=ERROR REPORT==== 22-May-2014::15:25:39 ===
AMQP connection <0.13665.16> (closed), channel 19793 - error:
{amqp_error,frame_error,
            "type 65, all octets = <<>>: {frame_too_large,1342177289,131064}",
            none}

=ERROR REPORT==== 22-May-2014::15:25:42 ===
closing AMQP connection <0.13665.16> (192.168.x.x:50615 -> 192.168.x.x:5672):
fatal_frame_error

On the client side we see this error:

15867 ERROR MassTransit.Context.ServiceBusReceiveContext - Consumer Exception Exposed
None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://<HOSTNAME>:5672, attempts=1
RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protocol negotiation failure: server version unknown-unknown, client version 0-9

Has anyone seen this before?

Regards

Stephen Ehlas
Senior IT Systems Engineer
T:             +31 (0)20 521 89 50
M:           +31 (0)6 239 084 15
E:             stephen.ehlas at albumprinter.com
W:           www.albumprinter.org<http://www.albumprinter.org/> / www.werkenbijalbelli.nl<http://www.werkenbijalbelli.nl/>
[cid:image001.png at 01CE607F.9C048CA0]
Create your own photo book & make moments last a lifetime!
Silver Tower
Stationsplein 53-57, 1012 AB Amsterdam, The Netherlands
P.O. box 14606, 1001 LC Amsterdam, The Netherlands
Albumprinter operates with its consumer brand Albelli in The Netherlands<http://www.albelli.nl/>, Belgium<http://www.albelli.be/>, Germany<http://www.albelli.de/>, France<http://www.albelli.fr/>, Norway<http://www.allfoto.no/>, Sweden<http://www.onskefoto.se/> and the United Kingdom<http://www.albelli.co.uk/>
[cid:image002.png at 01CE607F.9C048CA0]<http://nl-nl.facebook.com/AlbelliNL>   [cid:image003.png at 01CE607F.9C048CA0] <http://twitter.com/#!/albelli_nl>    [cid:image004.png at 01CE607F.9C048CA0] <http://blog.albelli.nl/>     [cid:image005.png at 01CE607F.9C048CA0] <http://albellinl.hyves.nl/>     [cid:image006.png at 01CE607F.9C048CA0] <http://www.youtube.com/watch?v=dhSmjKmmKn0>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 9640 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 1846 bytes
Desc: image002.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 1803 bytes
Desc: image003.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 2038 bytes
Desc: image004.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 1577 bytes
Desc: image005.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 1896 bytes
Desc: image006.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/f742673e/attachment-0005.png>

From mklishin at gopivotal.com  Fri May 23 10:30:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 May 2014 13:30:33 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 .NET producer/STOMP consumer:
 bad content-length possible?
In-Reply-To: <lln3rn$kj6$1@ger.gmane.org>
References: <lln3rn$kj6$1@ger.gmane.org>
Message-ID: <etPan.537f1555.19495cff.10816@mercurio.local>

?On 23 May 2014 at 13:21:31, Michael Justin (michael.justin at gmx.net) wrote:
> > Could it be that the reason is not a STOMP client sending invalid  
> frames, but a special case inside the broker, caused by data sent  
> from a
> different (non-STOMP) client?

Internally inside RabbitMQ various plugins use AMQP 0-9-1 machinery to
publish and consume messages.

STOMP plugin should set content-length for every delivery it propagates
to STOMP clients, no matter what client or plugin has published it.

If you think that content-length is set to an incorrect value, please
post a way for us to reproduce it.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From haster2004 at yandex.ru  Fri May 23 11:27:49 2014
From: haster2004 at yandex.ru (Haster)
Date: Fri, 23 May 2014 03:27:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Library rabbitmq_c and TCP_NODELAY
In-Reply-To: <CAAt2po+e5XrsCuVGSv22Vce+k3CjfqP3YQSoCbjwiRVpFDOLOA@mail.gmail.com>
References: <1400739424585-35761.post@n5.nabble.com>
 <CAAt2po+e5XrsCuVGSv22Vce+k3CjfqP3YQSoCbjwiRVpFDOLOA@mail.gmail.com>
Message-ID: <1400840869018-35809.post@n5.nabble.com>

Oh, It's my fault =)
Alan, thanks for reply!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Library-rabbitmq-c-and-TCP-NODELAY-tp35761p35809.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri May 23 11:46:51 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 May 2014 11:46:51 +0100
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local>
 <537F0AC5.5070108@rabbitmq.com>
 <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
Message-ID: <537F271B.9080903@rabbitmq.com>

On 23/05/14 09:50, Sunny Dyal wrote:
> Does direct exchange works as it is in multiple nodes multiple user
> sessions?

I'm not quite sure what this question really means. But both the direct 
and topic exchanges can be thought of as stateless routing logic; they 
will parallelise across many nodes and connections without contention.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sunny.dyal at gmail.com  Fri May 23 09:50:46 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Fri, 23 May 2014 14:20:46 +0530
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <537F0AC5.5070108@rabbitmq.com>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local> <537F0AC5.5070108@rabbitmq.com>
Message-ID: <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>

Simon,

Does direct exchange works as it is in multiple nodes multiple user
sessions?

Kind Regards

Sunny Dyal


On Fri, May 23, 2014 at 2:15 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/05/2014 09:42, Michael Klishin wrote:
>
>> Topic exchanges use a trie for matching, this scales well w/ respect to
>> the number
>> of bindings.
>>
>
> Having said that, direct exchanges are still (a bit) faster. But you will
> only see any difference if your application is routing-bound, i.e. sending
> small transient messages at high frequency.
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/213fa822/attachment.html>

From dwang7630 at gmail.com  Fri May 23 11:11:10 2014
From: dwang7630 at gmail.com (dwang7630 at gmail.com)
Date: Fri, 23 May 2014 03:11:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 Can not login with Open Ldap
In-Reply-To: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
References: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
Message-ID: <2a976625-29fc-488f-8366-a9861b0991de@googlegroups.com>

*Dear All*
*I'm try login to RabbitMQ, LDAP bind have return success. But I can not 
login, and  this is the log file*


> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
>
>
> *LDAP CHECK: login for David Wang*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *        LDAP filling template 
> "cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com" with*
> *            [{username,<<"David Wang">>}]*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *        LDAP template result: "cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com"*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP connecting to servers: ["quantedge.vn"]*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP network traffic: bind request = {'BindRequest',3,*
> *                                          "cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com",*
> *                                          {simple,<<"321`Rewq">>}}*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP network traffic: bind reply = {ok,*
> *                                        {'LDAPMessage',1,*
> *                                         {bindResponse,*
> *                                          {'BindResponse',success,[],[],*
> *                                           asn1_NOVALUE,asn1_NOVALUE}},*
> *                                         asn1_NOVALUE}}*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP bind succeeded: cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *        LDAP filling template 
> "cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com" with*
> *            [{username,<<"David Wang">>}]*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *        LDAP template result: "cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com"*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP CHECK: does David Wang have tag administrator?*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP evaluating query: {constant,true}*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP evaluated constant: true*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP DECISION: does David Wang have tag administrator? true*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP CHECK: does David Wang have tag management?*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP evaluating query: {constant,true}*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP evaluated constant: true*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *    LDAP DECISION: does David Wang have tag management? true*
> *=INFO REPORT==== 23-May-2014::16:49:53 ===*
> *LDAP DECISION: login for David Wang: ok*
> *=ERROR REPORT==== 23-May-2014::16:49:53 ===*
> *webmachine error: path="/api/whoami"**"Unauthorized"*
>
> *I'm using command ldapsearch to find uid=david.wang*


> *dn: cn=David Wang,ou=Users,ou=Accounts,dc=scholar,dc=com*
> *uidNumber: 1311*
> *gidNumber: 63000*
> *homeDirectory: /home/david.wang*
> *pcnSHAPassword: {sha}***********************
> *pcnMicrosoftNTPassword: **********************
> *pcnMicrosoftLanmanPassword: ********************
> *pcnWebconfigFlag: TRUE*
> *givenName: David*
> *sn: Wang*
> *.*
> *.*
> *.*
> *pcnProxyFlag: TRUE*
> *pcnOpenVPNFlag: TRUE*
> *pcnPPTPFlag: TRUE*
> *pcnWebFlag: TRUE*
> *loginShell: /bin/bash*
> *pcnFTPFlag: FALSE*
> *pcnMailFlag: FALSE*
> *pcnGoogleAppsFlag: FALSE*
> *uid: david.wang**cn: David Wang*


And this is the contents of LDAP config

  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["10.0.10.10"]},
     {user_dn_pattern,       
"cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com"},
     {dn_lookup_base,        "dc=scholar,dc=com"},
     {other_bind,           
{"cn=manager,cn=internal,dc=scholar,dc=com","eRwFTGDFTooNI5ca"}},
     {use_ssl,               false},
     {port,                  389},
     {log,                   network},
     {vhost_access_query,    {in_group,
                              "ou=Users,ou=Accounts,dc=scholar,dc=com"}},
     {resource_access_query,
      {for, [{permission, configure, {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
             {permission, write,
              {for, [{resource, queue,    {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
                     {resource, exchange, {constant, true}}]}},
             {permission, read,
              {for, [{resource, exchange, {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
                     {resource, queue,    {constant, true}}]}}
            ]
      }},
     {tag_queries,           [{administrator, {constant, true}},
                              {management,    {constant, true}}]}
   ]
  }

*Anybody Help me please ...!!!*
Thanks so much
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/101835f4/attachment.html>

From dwang7630 at gmail.com  Fri May 23 11:13:47 2014
From: dwang7630 at gmail.com (dwang7630 at gmail.com)
Date: Fri, 23 May 2014 03:13:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 Can not login with Open Ldap
In-Reply-To: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
References: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
Message-ID: <11f1b524-6a93-462a-a648-94b260ef22ff@googlegroups.com>

*Dear All*
*I'm try login to RabbitMQ, LDAP bind have return success. But I can not 
login, and  this is the log file*


>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *=INFO REPORT==== 23-May-2014::16:49:53 ===LDAP CHECK: login for David 
> Wang=INFO REPORT==== 23-May-2014::16:49:53 ===        LDAP filling template 
> "cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com" with            
> [{username,<<"David Wang">>}]=INFO REPORT==== 23-May-2014::16:49:53 ===    
>     LDAP template result: "cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com"=INFO REPORT==== 
> 23-May-2014::16:49:53 ===    LDAP connecting to servers: 
> ["10.0.10.10"]=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP network 
> traffic: bind request = {'BindRequest',3,                                  
>         "cn=David Wang,ou=Users,ou=Accounts,dc=scholar,dc=com",            
>                               {simple,<<"321`Rewq">>}}=INFO REPORT==== 
> 23-May-2014::16:49:53 ===    LDAP network traffic: bind reply = {ok,        
>                                 {'LDAPMessage',1,                          
>                {bindResponse,                                          
> {'BindResponse',success,[],[],                                          
>  asn1_NOVALUE,asn1_NOVALUE}},                                        
>  asn1_NOVALUE}}=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP bind 
> succeeded: cn=David Wang,ou=Users,ou=Accounts,dc=scholar,dc=com=INFO 
> REPORT==== 23-May-2014::16:49:53 ===        LDAP filling template 
> "cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com" with            
> [{username,<<"David Wang">>}]=INFO REPORT==== 23-May-2014::16:49:53 ===    
>     LDAP template result: "cn=David 
> Wang,ou=Users,ou=Accounts,dc=scholar,dc=com"=INFO REPORT==== 
> 23-May-2014::16:49:53 ===    LDAP CHECK: does David Wang have tag 
> administrator?=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP evaluating 
> query: {constant,true}=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP 
> evaluated constant: true=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP 
> DECISION: does David Wang have tag administrator? true=INFO REPORT==== 
> 23-May-2014::16:49:53 ===    LDAP CHECK: does David Wang have tag 
> management?=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP evaluating 
> query: {constant,true}=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP 
> evaluated constant: true=INFO REPORT==== 23-May-2014::16:49:53 ===    LDAP 
> DECISION: does David Wang have tag management? true=INFO REPORT==== 
> 23-May-2014::16:49:53 ===LDAP DECISION: login for David Wang: ok=ERROR 
> REPORT==== 23-May-2014::16:49:53 ===webmachine error: 
> path="/api/whoami""Unauthorized"*


*I'm using command ldapsearch to find uid=david.wang*


> *dn: cn=David Wang,ou=Users,ou=Accounts,dc=scholar,dc=com*
> *uidNumber: 1311*
> *gidNumber: 63000*
> *homeDirectory: /home/david.wang*
> *pcnSHAPassword: {sha}***********************
> *pcnMicrosoftNTPassword: **********************
> *pcnMicrosoftLanmanPassword: ********************
> *pcnWebconfigFlag: TRUE*
> *givenName: David*
> *sn: Wang*
> *.*
> *.*
> *.*
> *pcnProxyFlag: TRUE*
> *pcnOpenVPNFlag: TRUE*
> *pcnPPTPFlag: TRUE*
> *pcnWebFlag: TRUE*
> *loginShell: /bin/bash*
> *pcnFTPFlag: FALSE*
> *pcnMailFlag: FALSE*
> *pcnGoogleAppsFlag: FALSE*
> *uid: david.wang**cn: David Wang*


*And this is the contents of LDAP config*

  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["10.0.10.10"]},
     {user_dn_pattern,       
"cn=${username},ou=Users,ou=Accounts,dc=scholar,dc=com"},
     {dn_lookup_base,        "dc=scholar,dc=com"},
     {other_bind,           
{"cn=manager,cn=internal,dc=scholar,dc=com","eRwFTGDFTooNI5ca"}},
     {use_ssl,               false},
     {port,                  389},
     {log,                   network},
     {vhost_access_query,    {in_group,
                              "ou=Users,ou=Accounts,dc=scholar,dc=com"}},
     {resource_access_query,
      {for, [{permission, configure, {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
             {permission, write,
              {for, [{resource, queue,    {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
                     {resource, exchange, {constant, true}}]}},
             {permission, read,
              {for, [{resource, exchange, {in_group, 
"ou=Users,ou=Accounts,dc=scholar,dc=com"}},
                     {resource, queue,    {constant, true}}]}}
            ]
      }},
     {tag_queries,           [{administrator, {constant, true}},
                              {management,    {constant, true}}]}
   ]
  }

*Anybody Help me please ...!!!*
*Thanks so much*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/a03fe71a/attachment.html>

From mklishin at gopivotal.com  Fri May 23 12:01:59 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 May 2014 15:01:59 +0400
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local>
 <537F0AC5.5070108@rabbitmq.com>
 <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
Message-ID: <etPan.537f2ac1.6b8b4567.13062@mercurio.local>

?On 23 May 2014 at 14:50:33, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > Does direct exchange works as it is in multiple nodes multiple  
> user sessions?

What do you mean by "sessions"?
Can you re-state your problem in protocol terms (exchanges, bindings, queues, routing keys)?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri May 23 12:16:39 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 May 2014 12:16:39 +0100
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
 <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
Message-ID: <537F2E17.2050905@rabbitmq.com>

On 22/05/14 20:04, Steffen Daniel Jensen wrote:
> Yes, I know. But I am not asking an unreasonably lot, IMO :-)
> I am aware of the CAP theorem, but I don't see how it is in violation. I
> am willing to live with eventual consistency.

Ah, right.

> What I mean when I say "reliable" is: All subscribers at the time of
> publish will eventually get the message.
>
> That should be possible, assuming that all live inconsistent nodes will
> eventually rejoin (without dumping messages). I know this is not the
> case in rabbitmq, but it is definitely theoretically possible. I guess
> this is what is usually referred to as eventual consistency.

So why did you originally say:

> It must be a cluster because we want clients to be able to connect to
> each node transparently. Federation is not an option.

...because it really sounds like federation is what you want :-)

>     Yes, see http://www.rabbitmq.com/__nettick.html
>     <http://www.rabbitmq.com/nettick.html>
>
>
> Thank you! (!)
> I have been looking for that one. But I am surprised to see that it is
> actually 60sec. Then I really don't understand how I could have seen so
> many clusters ending up partitioned.
>
> Do you know what the consequence of doubling it might be?

It will take twice as long to conclude that a remote node that is no 
longer connected has actually gone away. Until then, things can block.

> RabbitMq writes:
> Increasing the net_ticktime across all nodes in a cluster will make the
> cluster more resilient to short network outtages, but it will take
> longer for remaing nodes to detect crashed nodes.
>
> More specifically I wonder what happens in the time a node is actually
> in its own network, but before it finds out. In our setup all publishes
> have all-HA subscriber queues, with publisher confirm. So I will expect
> a distributed agreement that the msg has been persisted.

Yes.

> Will a
> publisher confirm then block until the node decides that other nodes are
> down, and then succeed?

Yes.

> The duplication is ok -- but assuming that rabbit is usually empty, it
> won't really happen, I think.
> But -- I am sure that rabbit does not guarantee exactly once delivery
> anyway.
> For that reason, we will build in idempotency for critical messages.
>
> Ordering can always get scrambled when nacking consuming messages, so we
> are not assuming ordering either.

OK.

> About the CAP theorem in relation to rabbit.
> Reliable messaging (zero message loss), is often preferred in
> SOA-settings. I wonder why vmware/pivotal/... chose not to prioritize
> this guarantee. It is aimed by the federation setup, but it is a little
> to weak in its synchronization. It would be preferred if it had a
> possibility of communicating consumption of messages. Then one could
> mirror queues between up/down-stream exchanges, and have even more
> "availability".

I'm not sure what you're talking about here. Federation certainly should 
be able to ensure zero message loss! (Assuming you leave it in 
"on-confirm" ack-mode).

So when you say "if it had a possibility of communicating consumption of 
messages" you're talking about a sort of eventually consistent federated 
mirrored queue? I have wondered about producing such a thing. But as 
usual the list of things we could do is large, and the resources small. 
And I suspect the cost of producing it would be quite large, mostly due 
to the need to somehow reunify the queues after a partition.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Fri May 23 13:18:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 23 May 2014 16:18:29 +0400
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <CA+eK+XPXp4wgOhgJTx0GAD-963_tX8v3m6ui3A2MrpdYcDT6dg@mail.gmail.com>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local>
 <537F0AC5.5070108@rabbitmq.com>
 <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
 <etPan.537f2ac1.6b8b4567.13062@mercurio.local>
 <CA+eK+XPXp4wgOhgJTx0GAD-963_tX8v3m6ui3A2MrpdYcDT6dg@mail.gmail.com>
Message-ID: <etPan.537f3cb2.2ae8944a.13062@mercurio.local>

?On 23 May 2014 at 15:20:36, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > There are two users A and B and two nodes N1 and N2. There are two  
> chat apps 1) chat1 connected with N1 2) chat2 connected with N2  
>  
> User A login in chat1, User B login in chat1 and user A login in chat2  
> again
>  
> If I use amq.topic and start communication I can see messages  
> on all the places but the same scenario does not work with amq.direct.  
>  
> @Question: can we use direct exchange for this scenario?

Every location would use its own queue and bind
it to a direct exchange using username as routing key.
Then a message published with routing key = "joe" will be routed
to 1 or more queues, one for every location.

It does not matter what RabbitMQ node clients connect to, besides
data locality (a queue has a master node and all operations go through it).

I'd recommend using topic exchanges if you feel they make more sense to you.
It's very likely that if you need to optimise things, routing won't be the
main cause.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sunny.dyal at gmail.com  Fri May 23 12:19:55 2014
From: sunny.dyal at gmail.com (Sunny Dyal)
Date: Fri, 23 May 2014 16:49:55 +0530
Subject: [rabbitmq-discuss] Direct vs Topic Exchange (1:1 and 1:M Chat)
In-Reply-To: <etPan.537f2ac1.6b8b4567.13062@mercurio.local>
References: <9dd9f5f8-2f25-41a0-8bbe-153af51ff60a@googlegroups.com>
 <etPan.537f0a06.643c9869.10816@mercurio.local> <537F0AC5.5070108@rabbitmq.com>
 <CA+eK+XOsnY+6NROMh19u3hMKsB=MqujQjMJ+Cvi-wHujDVmMyQ@mail.gmail.com>
 <etPan.537f2ac1.6b8b4567.13062@mercurio.local>
Message-ID: <CA+eK+XPXp4wgOhgJTx0GAD-963_tX8v3m6ui3A2MrpdYcDT6dg@mail.gmail.com>

@Sessions: Same user logged in multiple places (laptop, mobile, etc)

@Problem Use case:

There are two users A and B and two nodes N1 and N2. There are two chat
apps 1) chat1 connected with N1 2) chat2 connected with N2

User A login in chat1, User B login in chat1 and user A login in chat2 again

If I use amq.topic and start communication I can see messages on all the
places but the same scenario does not work with amq.direct.

@Question: can we use direct exchange for this scenario?










On Fri, May 23, 2014 at 4:31 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>  On 23 May 2014 at 14:50:33, Sunny Dyal (sunny.dyal at gmail.com) wrote:
> > > Does direct exchange works as it is in multiple nodes multiple
> > user sessions?
>
> What do you mean by "sessions"?
> Can you re-state your problem in protocol terms (exchanges, bindings,
> queues, routing keys)?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/b9b6bab9/attachment.html>

From steffen.daniel.jensen at gmail.com  Fri May 23 13:03:25 2014
From: steffen.daniel.jensen at gmail.com (Steffen Daniel Jensen)
Date: Fri, 23 May 2014 14:03:25 +0200
Subject: [rabbitmq-discuss] Fully reliable setup impossible?
In-Reply-To: <537F2E17.2050905@rabbitmq.com>
References: <48714dc8-342f-41b0-968a-21d8520fc086@googlegroups.com>
 <537E26D0.3070703@rabbitmq.com>
 <CAGRy8k7EB7r6GLc3SM1hyzMhULEk7Xpm4GY3BHhXjg5w-iNL_A@mail.gmail.com>
 <537F2E17.2050905@rabbitmq.com>
Message-ID: <CAGRy8k6P7J3nDjhKPZHo5Y0cQbRGHHgabB4YkAujH5NLqVDtmA@mail.gmail.com>

>
>  What I mean when I say "reliable" is: All subscribers at the time of
>> publish will eventually get the message.
>>
>> That should be possible, assuming that all live inconsistent nodes will
>> eventually rejoin (without dumping messages). I know this is not the
>> case in rabbitmq, but it is definitely theoretically possible. I guess
>> this is what is usually referred to as eventual consistency.
>>
>  So why did you originally say:
>
>> It must be a cluster because we want clients to be able to connect to
>> each node transparently. Federation is not an option.
>>
>  ...because it really sounds like federation is what you want :-)
>

Services in our setup must be ignorant to which of the two data centers
they are connected to. Since queues are not mirrored, this is not possible
with a federation.


>  Do you know what the consequence of doubling it might be?
>>
>
> It will take twice as long to conclude that a remote node that is no
> longer connected has actually gone away. Until then, things can block.


Thanks. Perfect.


>  About the CAP theorem in relation to rabbit.
>> Reliable messaging (zero message loss), is often preferred in
>> SOA-settings. I wonder why vmware/pivotal/... chose not to prioritize
>> this guarantee. It is aimed by the federation setup, but it is a little
>> to weak in its synchronization. It would be preferred if it had a
>> possibility of communicating consumption of messages. Then one could
>> mirror queues between up/down-stream exchanges, and have even more
>> "availability".
>>
>
> I'm not sure what you're talking about here.


Sorry for being unclear.


> Federation certainly should be able to ensure zero message loss! (Assuming
> you leave it in "on-confirm" ack-mode).


Yes, assuming that there actually is a queue (with a binding) on the right
node.


> So when you say "if it had a possibility of communicating consumption of
> messages" you're talking about a sort of eventually consistent federated
> mirrored queue? I have wondered about producing such a thing. But as usual
> the list of things we could do is large, and the resources small. And I
> suspect the cost of producing it would be quite large, mostly due to the
> need to somehow reunify the queues after a partition.


This is really exactly what is needed IMO. It sounds very much like this is
the setup TIBCO uses, when guaranteeing zero-message-loss.
I definitely appreciate that the reunification procedure is not simple.
However, mirrored queues are usually somewhat static (in that they are
created once and lives forever). Maybe a simple queue union, with some sort
of message consumption union as well, so node 1 can delete messages
consumed on node 2. I suppose it could be implemented efficiently by adding
a sequence number to the messages in each queue, and then having a list of
intervals of consumed message sequence numbers, or similar.

It would be a great (!) addition to rabbitmq, and I am very interested in
hearing of any progress.

Thank you big time,
-- S :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/22035ea1/attachment.html>

From benmmurphy at gmail.com  Fri May 23 13:21:47 2014
From: benmmurphy at gmail.com (Ben Murphy)
Date: Fri, 23 May 2014 13:21:47 +0100
Subject: [rabbitmq-discuss] Mirrored Queues Down Behaviour
Message-ID: <CAGPPH4CUOKf6xCgXbRve1+VuThRhyM_NCOcQNsrR_D+YM=wR7Q@mail.gmail.com>

I've noticed that when rabbitmq nodes becomes unreachable the gm
module can behave very strangely.

It looks like the server is trying to fetch its own record in the view
but this record no longer exists so it crashes. It's view according to
the state at the start of the function is:

'{{0,<2908.114.8>}, {0,<0.19014.9>}, {1,<23021.2099.0>}' and its
process is ' {0,<0.19014.9>}' however it ends up trying to look itself
up in a view that only contains these members: '{1,<23021.2099.0>}'
(https://github.com/rabbitmq/rabbitmq-server/blob/rabbitmq_v3_2_3/src/gm.erl#L1245).
I notice that the state of the view is also stored in mnesia. I think
this state is shared across the cluster but I'm not sure.

If this is true then it might be possible for a node A to consider a
gm process on node B down and then push this state to node A via
mnesia. Then when node A gets the down message for node B and tries to
update its state it will try and fetch itself from the view and will
crash.

** Reason for termination ==
** {function_clause,
       [{orddict,fetch,
            [{0,<0.19014.9>},
             [{{1,<23021.2099.0>},
               {view_member,
                   {1,<23021.2099.0>},
                   [{0,<2908.114.8>}],
                   {1,<23021.2099.0>},
                   {1,<23021.2099.0>}}}]],
            [{file,"orddict.erl"},{line,72}]},
        {gm,check_neighbours,1,[]},
        {gm,handle_info,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

=ERROR REPORT==== 22-May-2014::15:12:18 ===
** Generic server <0.19014.9> terminating
** Last message in was {'DOWN',#Ref<0.0.195.189462>,process,<2908.114.8>,
                               noconnection}
** When Server state == {state,
                            {0,<0.19014.9>},
                            {{0,<2908.114.8>},#Ref<0.0.195.189462>},
                            {{1,<23021.2099.0>},#Ref<0.0.1718.177207>},
                            {resource,<<"/">>,queue,
                                <<"retry_queue_600_mo_service_12">>},
                            rabbit_mirror_queue_coordinator,
                            {2,
                             [{{0,<2908.114.8>},
                               {view_member,
                                   {0,<2908.114.8>},
                                   [],
                                   {1,<23021.2099.0>},
                                   {0,<0.19014.9>}}},
                              {{0,<0.19014.9>},
                               {view_member,
                                   {0,<0.19014.9>},
                                   [],
                                   {0,<2908.114.8>},
                                   {1,<23021.2099.0>}}},
                              {{1,<23021.2099.0>},
                               {view_member,
                                   {1,<23021.2099.0>},
                                   [],
                                   {0,<0.19014.9>},
                                   {0,<2908.114.8>}}}]},
                            2,
                            [{{0,<2908.114.8>},{member,{[],[]},0,0}},
                             {{0,<0.19014.9>},{member,{[],[]},2,2}},
                             {{1,<23021.2099.0>},{member,{[],[]},0,0}}],
                            [<0.19013.9>],
                            {[],[]},
                            [],0,undefined,
                            #Fun<rabbit_misc.execute_mnesia_transaction.1>}

From charles.sartori at azion.com  Fri May 23 14:36:58 2014
From: charles.sartori at azion.com (Charles Sartori)
Date: Fri, 23 May 2014 10:36:58 -0300
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <CALBvAytSSV-1-OkAeMmxJrRe6AiReoDDzQCmo3RjeHn1PAb5Ow@mail.gmail.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
 <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>
 <CALBvAyvdZqNNrOytXeXqVUmah+i8EWkJa3eM0pAqC=8HcckDrg@mail.gmail.com>
 <537DFC3B.4070100@rabbitmq.com>
 <CALBvAytSSV-1-OkAeMmxJrRe6AiReoDDzQCmo3RjeHn1PAb5Ow@mail.gmail.com>
Message-ID: <CALBvAyt3Agk6BSXCL_2YGaKWF+mRwMjqqF-WhxphZn6dVEO7mg@mail.gmail.com>

Hello,

We were about to move from an ActiveMQ cluster to a RabbitMQ one. RabbitMQ
is really great, and right now this limitation is the only thing preventing
us to migrate.

Is this a hard thing to solve? We can definitely try to help or even work
in a patch. Can you point us to a bug ticket or something like that?

Thanks again!



Charles Sartori

Porto Alegre, Brasil + 55 51 3012 3005
Miami, USA + 1 305 704 8816

Quaisquer informa??es contidas neste e-mail e anexos podem ser
confidenciais e privilegiadas, protegidas por sigilo legal. Qualquer forma
de utiliza??o deste documento depende de autoriza??o do emissor, sujeito as
penalidades cab?veis.

Any information in this e-mail and attachments may be confidential and
privileged, protected by legal confidentiality. The use of this document
require authorization by the issuer, subject to penalties.


2014-05-22 10:36 GMT-03:00 Charles Sartori <charles.sartori at azion.com>:

> Thank you again Simon.
>
>
> Charles Sartori
>
> Porto Alegre, Brasil + 55 51 3012 3005
> Miami, USA + 1 305 704 8816
>
> Quaisquer informa??es contidas neste e-mail e anexos podem ser
> confidenciais e privilegiadas, protegidas por sigilo legal. Qualquer forma
> de utiliza??o deste documento depende de autoriza??o do emissor, sujeito as
> penalidades cab?veis.
>
> Any information in this e-mail and attachments may be confidential and
> privileged, protected by legal confidentiality. The use of this document
> require authorization by the issuer, subject to penalties.
>
>
> 2014-05-22 10:31 GMT-03:00 Simon MacMullen <simon at rabbitmq.com>:
>
> On 22/05/14 14:14, Charles Sartori wrote:
>>
>>> Do you know if is it a bug and will be fixed in the future versions?
>>>
>>
>> I would say "limitation" rather than "bug" but it might get fixed. It
>> depends how much demand there is.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/2b3d6dc7/attachment.html>

From simon at rabbitmq.com  Fri May 23 17:33:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 May 2014 17:33:45 +0100
Subject: [rabbitmq-discuss] Queue TTL
In-Reply-To: <CALBvAyt3Agk6BSXCL_2YGaKWF+mRwMjqqF-WhxphZn6dVEO7mg@mail.gmail.com>
References: <3c3e5ce6-238a-4e7c-8a53-e9610d5d93ca@googlegroups.com>
 <537DB78E.8010409@rabbitmq.com>
 <CALBvAys6+wdwNdUsC25NXPkSDLKBbf4LRBF4zzYEpYsLcgr9Xw@mail.gmail.com>
 <CALBvAyvdZqNNrOytXeXqVUmah+i8EWkJa3eM0pAqC=8HcckDrg@mail.gmail.com>
 <537DFC3B.4070100@rabbitmq.com>
 <CALBvAytSSV-1-OkAeMmxJrRe6AiReoDDzQCmo3RjeHn1PAb5Ow@mail.gmail.com>
 <CALBvAyt3Agk6BSXCL_2YGaKWF+mRwMjqqF-WhxphZn6dVEO7mg@mail.gmail.com>
Message-ID: <537F7869.70009@rabbitmq.com>

On 23/05/2014 14:36, Charles Sartori wrote:
> Is this a hard thing to solve? We can definitely try to help or even
> work in a patch. Can you point us to a bug ticket or something like that?

I started looking at how hard it would be and that lead naturally onto 
working on it...

Our bug tracker is not public but the branch in hg is bug26204.

Cheers, Simon

From dor.b at softweave.co  Sun May 25 14:32:48 2014
From: dor.b at softweave.co (Dor Ben Dov)
Date: Sun, 25 May 2014 16:32:48 +0300
Subject: [rabbitmq-discuss] rabbitmq 3.3.1 unable to login with guest user
Message-ID: <5381F100.7020009@softweave.co>

Hi,

After downloading the rabbitmq 3.3.1, when i am running it localhost 
(with the management gui plugin)

i can log in with the guest user, but when i am running it on one of our 
servers

and then ssh to it -> and run it -> i am unable to log in with the guest 
user ,



why ?

what should i do ?


Dor

From mklishin at gopivotal.com  Sun May 25 14:35:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 25 May 2014 17:35:50 +0400
Subject: [rabbitmq-discuss] rabbitmq 3.3.1 unable to login with guest
 user
In-Reply-To: <5381F100.7020009@softweave.co>
References: <5381F100.7020009@softweave.co>
Message-ID: <etPan.5381f1d1.643c9869.176a3@mercurio.local>

?On 25 May 2014 at 17:34:02, Dor Ben Dov (dor.b at softweave.co) wrote:
> > why ?
>  
> what should i do ?

http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From rohitmukherjee26 at gmail.com  Sun May 25 14:36:14 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Sun, 25 May 2014 21:36:14 +0800
Subject: [rabbitmq-discuss] rabbitmq 3.3.1 unable to login with guest
	user
In-Reply-To: <5381F100.7020009@softweave.co>
References: <5381F100.7020009@softweave.co>
Message-ID: <CAKYxN6naToO-PGRVbojudabDFL-hW0UquH6jdOj+yDkG=V7CKA@mail.gmail.com>

I have also faced the same issue and created a new user using rabbitmqctl
and given adminstrative provileges and that worked


On Sun, May 25, 2014 at 9:32 PM, Dor Ben Dov <dor.b at softweave.co> wrote:

> Hi,
>
> After downloading the rabbitmq 3.3.1, when i am running it localhost (with
> the management gui plugin)
>
> i can log in with the guest user, but when i am running it on one of our
> servers
>
> and then ssh to it -> and run it -> i am unable to log in with the guest
> user ,
>
>
>
> why ?
>
> what should i do ?
>
>
> Dor
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140525/89f45cfe/attachment.html>

From mklishin at gopivotal.com  Mon May 26 08:10:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 May 2014 11:10:16 +0400
Subject: [rabbitmq-discuss] rabbitmq 3.3.1 unable to login with guest
 user
In-Reply-To: <CAKYxN6naToO-PGRVbojudabDFL-hW0UquH6jdOj+yDkG=V7CKA@mail.gmail.com>
References: <5381F100.7020009@softweave.co>
 <CAKYxN6naToO-PGRVbojudabDFL-hW0UquH6jdOj+yDkG=V7CKA@mail.gmail.com>
Message-ID: <etPan.5382e8f6.6b8b4567.24c6@mercurio.local>

On 25 May 2014 at 17:39:34, Rohit Mukherjee (rohitmukherjee26 at gmail.com) wrote:
> > I have also faced the same issue and created a new user using rabbitmqctl 
> and given adminstrative provileges and that worked

While this is the recommended approach, it is possible to re-enable "guest"
permissions from pre-3.3 releases:

http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/
http://www.rabbitmq.com/access-control.html
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon May 26 08:47:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 26 May 2014 11:47:15 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.2.2 is released
Message-ID: <etPan.5382f1a1.643c9869.24c6@mercurio.local>

Bunny [1] is a Ruby RabbitMQ client focusing on ease of use.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/05/26/bunny-1-dot-2-2-is-released/

1. http://rubybunny.info?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From michael.s.klishin at gmail.com  Mon May 26 08:53:01 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 26 May 2014 11:53:01 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.11.0 is released
Message-ID: <CAE3HoVRoOvZ85ZseBDqgYxnqysgaRnv=9oe4Jg+0O7aVgbzZPw@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure RabbitMQ client.

Release notes:
http://blog.clojurewerkz.org/blog/2014/05/24/langohr-2-dot-11-dot-0-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/9bc26af9/attachment.html>

From aditza8 at gmail.com  Fri May 23 20:47:35 2014
From: aditza8 at gmail.com (BeaT Adrian)
Date: Fri, 23 May 2014 12:47:35 -0700 (PDT)
Subject: [rabbitmq-discuss] php pecl and max channel reached with php-fpm
Message-ID: <f3e6b6b8-0853-41a0-86f4-c58f47b0fa79@googlegroups.com>

Hello all,

I`m just learning rabbitMQ and I ran into a problem.
 
Using http://pecl.php.net/package/amqp version 1.4 (latest now) and 
RabbitMQ 3.3.1.
We must use php5-fpm and persistent connections with amqp->pconnect(). 

After a while (I guess 65500 requests) a problem occurs halting all writes 
"Could not create channel. Connection has no open channel slots remaining"

>From what I have read in the sources is because every tcp connection have 
an autoincrement channel ID that reaches its max. This happens because 
every request must use the channel, and is no way to use the same channel ( 
I could not find a way into the php-amqp channel classs to make it 
persistent) and scripts cannot communicate ( to use the same instance of 
the channel as php object).

To lower the php-fpm lifetime is not an option, and either decoupling the 
application-rabbitmq communication trough another technology/library etc.

Is there any easy way to fix this ? 

Theoretically it should be one channel per thread (php5-fpm worker in this 
case) but how can be achieved using this library ? 

The code I`m using now (similar)

$this->con = new AMQPConnection(array(
> 'host'   => $this->con_params['host'],
> 'port'   => $this->con_params['port'],
> 'vhost' => $this->con_params['vhost'],
> 'login' => $this->con_params['user'],
> 'password' => $this->con_params['pass'],
> 'read_timeout'  => 1,//seconds
> 'write_timeout' => 1,//seconds
> 'connect_timeout' => 1,//seconds
> ));
> $this->con->pconnect();
> $channel = new AMQPChannel($this->con);
> $queue = new AMQPQueue($channel);
> $queue->setName($queueName);
> $queue->setFlags(AMQP_DURABLE);
> //$queue->declareQueue();//make sure it exists
> $exchange = new AMQPExchange($channel);
> $exchange->setName($exchangeName);
> $exchange->setFlags(AMQP_DURABLE);
> $exchange->setType(AMQP_EX_TYPE_DIRECT);
> //$exchange->declareExchange();
> $this->queues[$queueName]->bind($exchangeName);



Thanks !!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/83c5786b/attachment.html>

From mathewjoy.in at gmail.com  Fri May 23 21:30:00 2014
From: mathewjoy.in at gmail.com (Mathew Joy)
Date: Fri, 23 May 2014 13:30:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Clients with multiple protocol
Message-ID: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>

Hi,

RabitMQ supports multiple protocols. Does mean clients implemented in 
different protocols can talk to each other? For Ex. one client in AMQP and 
another in Stomp.

I think the answer is No or not recommended but just to confirm.

Regards,
Mathew Joy

PS: Answers here seems to be sparse.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140523/2bf1ca13/attachment.html>

From chenwen09073318 at gmail.com  Sun May 25 13:24:25 2014
From: chenwen09073318 at gmail.com (dev chen)
Date: Sun, 25 May 2014 05:24:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Dynamic create queue ?
Message-ID: <435e823d-8051-4640-8875-7cea4f5c09c2@googlegroups.com>

i am working on a project,which creates queue by parse a xml task config 
file,how can i do that ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140525/8032eadc/attachment.html>

From gsrinivas10 at gmail.com  Mon May 26 08:31:49 2014
From: gsrinivas10 at gmail.com (srinivas)
Date: Mon, 26 May 2014 00:31:49 -0700 (PDT)
Subject: [rabbitmq-discuss] I am getting an Error while trying to send
 messages to a queue. "ACCESS_REFUSED - Login was refused using
 authentication mechanism PLAIN. For details see the broker logfile."
In-Reply-To: <152f9b10-e3d4-4cb8-bef2-68dce4a56833@googlegroups.com>
References: <152f9b10-e3d4-4cb8-bef2-68dce4a56833@googlegroups.com>
Message-ID: <7e657e5c-4c3b-41bd-87a0-8d1f3075423c@googlegroups.com>

Hi,
      Can u please tell me how to solve this problem. What files do we need 
to change, If we want to use an ip address instead of localhost. 

Thanks in Advance

On Thursday, April 24, 2014 4:40:45 PM UTC+5:30, AMAL G JOSE wrote:
>
> I have configured rabbitMQ in my laptop and wrote a sender and receiver 
> program.
> It works fine, if I set the *factory.setHost(prop.getProperty("hostname")); 
> *property with* localhost.*
> But when I am giving the ipadress, I am getting an error * "ACCESS_REFUSED 
> - Login was refused using authentication mechanism PLAIN. For details see 
> the broker logfile."*
> I think this is due to some user permissions. Can anyone help me in 
> solving this issue.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/c1075d22/attachment.html>

From bdamian at gmail.com  Mon May 26 15:37:00 2014
From: bdamian at gmail.com (=?UTF-8?Q?Dami=C3=A1n_Bacalov?=)
Date: Mon, 26 May 2014 07:37:00 -0700 (PDT)
Subject: [rabbitmq-discuss] C# client and Ubuntu RabbitMQ Server
	access_denied
Message-ID: <c7402d18-d575-4155-adfb-d01e96d982f1@googlegroups.com>

Hi all,

I'm having problems trying to send messages from a C# client to a RabbitMQ 
server on a Ubuntu Machine (default settings).

*This is my C# code:*
            var factory = new ConnectionFactory();
            factory.UserName = "admin";
            factory.Password = "password"; 
            factory.VirtualHost = "/";
            factory.Protocol = Protocols.FromEnvironment();
            factory.HostName = "192.168.20.6";
            factory.Port = AmqpTcpEndpoint.UseDefaultPort;
            IConnection connection = factory.CreateConnection();

*The server log (on the Ubuntu server) shows:*
=ERROR REPORT==== 26-May-2014::11:10:47 ===
closing AMQP connection <0.10933.9> (192.168.20.4:22780 -> 
192.168.20.6:5672):
{handshake_error,starting,0,
                 {amqp_error,access_refused,
                             "PLAIN login refused: user 'guest' - invalid 
credentials",
                             'connection.start_ok'}}


The odd thing is that form the same windows machine, *if I use the Java 
client, all works great with the following code (using STS)*:

ConnectionFactory factory = new ConnectionFactory();
factory.setHost("192.168.20.6");
factory.setUsername("admin");
factory.setPassword("password");
                factory.setVirtualHost("/");
Connection connection = factory.newConnection();
Channel channel = connection.createChannel();
channel.queueDeclare(QUEUE_NAME, false, false, false, null);
String message = "Hello World!";
channel.basicPublish("", QUEUE_NAME, null, message.getBytes());
System.out.println(" [x] Sent '" + message + "'");
channel.close();
connection.close();

So, is not a credentials nor networking problem. Is the C# client. I've 
tried with 2.0 and 3.0 client with the exactly same result.

Could you help me to connect from a C# client to a Linux RabbitMQ server?
Thanks a lot.
D.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/85fa4469/attachment.html>

From bdamian at gmail.com  Mon May 26 15:52:48 2014
From: bdamian at gmail.com (=?UTF-8?Q?Dami=C3=A1n_Bacalov?=)
Date: Mon, 26 May 2014 07:52:48 -0700 (PDT)
Subject: [rabbitmq-discuss] C# client and Ubuntu RabbitMQ Server
	access_denied
In-Reply-To: <c7402d18-d575-4155-adfb-d01e96d982f1@googlegroups.com>
References: <c7402d18-d575-4155-adfb-d01e96d982f1@googlegroups.com>
Message-ID: <a91bb085-ba92-4c8e-95d1-024ad4f7f671@googlegroups.com>

Hi guys,

Thanks in advance. I've solved the problem. It was a Framework issue in my 
PC. Don't know why but I restart the windows machine and all started to 
work.

Thanks anyway.
D.

El lunes, 26 de mayo de 2014 11:37:00 UTC-3, Dami?n Bacalov escribi?:
>
> Hi all,
>
> I'm having problems trying to send messages from a C# client to a RabbitMQ 
> server on a Ubuntu Machine (default settings).
>
> *This is my C# code:*
>             var factory = new ConnectionFactory();
>             factory.UserName = "admin";
>             factory.Password = "password"; 
>             factory.VirtualHost = "/";
>             factory.Protocol = Protocols.FromEnvironment();
>             factory.HostName = "192.168.20.6";
>             factory.Port = AmqpTcpEndpoint.UseDefaultPort;
>             IConnection connection = factory.CreateConnection();
>
> *The server log (on the Ubuntu server) shows:*
> =ERROR REPORT==== 26-May-2014::11:10:47 ===
> closing AMQP connection <0.10933.9> (192.168.20.4:22780 -> 
> 192.168.20.6:5672):
> {handshake_error,starting,0,
>                  {amqp_error,access_refused,
>                              "PLAIN login refused: user 'guest' - invalid 
> credentials",
>                              'connection.start_ok'}}
>
>
> The odd thing is that form the same windows machine, *if I use the Java 
> client, all works great with the following code (using STS)*:
>
> ConnectionFactory factory = new ConnectionFactory();
> factory.setHost("192.168.20.6");
> factory.setUsername("admin");
> factory.setPassword("password");
>                 factory.setVirtualHost("/");
> Connection connection = factory.newConnection();
> Channel channel = connection.createChannel();
> channel.queueDeclare(QUEUE_NAME, false, false, false, null);
> String message = "Hello World!";
> channel.basicPublish("", QUEUE_NAME, null, message.getBytes());
> System.out.println(" [x] Sent '" + message + "'");
> channel.close();
> connection.close();
>
> So, is not a credentials nor networking problem. Is the C# client. I've 
> tried with 2.0 and 3.0 client with the exactly same result.
>
> Could you help me to connect from a C# client to a Linux RabbitMQ server?
> Thanks a lot.
> D.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/98e7a8e0/attachment.html>

From pepa.hak at gmail.com  Mon May 26 16:24:51 2014
From: pepa.hak at gmail.com (=?UTF-8?Q?Josef_H=C3=A1k?=)
Date: Mon, 26 May 2014 08:24:51 -0700 (PDT)
Subject: [rabbitmq-discuss] consume-reply-listener in c
Message-ID: <dced592e-8cd2-432b-8b12-29a39c6eeff8@googlegroups.com>

Hello,
 I would like to make simple consume-reply-listener (.c) and client (.py). 
But I can not find any similar example on web. 

Firstly, I run listener: 
>> ./amqp_rpc_listen localhost 5672 amq.direct test
Secondly, I run client (for one request):
>> python rcp_client.py

Listener shows this output and thats ok:
>> Delivery 1, exchange amq.direct routingkey test
>> Content-type: 
>> Msg len: 16
>> Msg: asdf asdf a sd f
>> Reply to: amq.gen-UTSmWMXQt8gmLZdNaqZDqg
>> sent

Client shows this, but no response is received:
>> [x] Requesting fib(30)
>>amq.gen-UTSmWMXQt8gmLZdNaqZDqg

Please help me. Thanks


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/47f699e1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_rpc_listen.c
Type: text/x-csrc
Size: 5695 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/47f699e1/attachment.c>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rcp_client.py
Type: text/x-python
Size: 1344 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/47f699e1/attachment.py>

From gavinmroy at gmail.com  Tue May 27 00:08:13 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Mon, 26 May 2014 19:08:13 -0400
Subject: [rabbitmq-discuss] Clients with multiple protocol
In-Reply-To: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
References: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
Message-ID: <etPan.5383c95d.6b8b4567.c30@gmr-home.local>



From:?Mathew Joy mathewjoy.in at gmail.com
Reply:?Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
Date:?May 26, 2014 at 7:02:21 PM
To:?rabbitmq-discuss at googlegroups.com rabbitmq-discuss at googlegroups.com
Subject:? [rabbitmq-discuss] Clients with multiple protocol  

Hi,

RabitMQ supports multiple protocols. Does mean clients implemented in different protocols can talk to each other? For Ex. one client in AMQP and another in Stomp.
Yes, they can. ?STOMP and MQTT messages are translated to AMQP when published via STOMP and MQTT. AMQP messages are translated to STOMP and MQTT when they are delivered via either protocol.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/a976f750/attachment.html>

From matthias at rabbitmq.com  Tue May 27 00:08:51 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 27 May 2014 00:08:51 +0100
Subject: [rabbitmq-discuss] Clients with multiple protocol
In-Reply-To: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
References: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
Message-ID: <5383C983.503@rabbitmq.com>

On 23/05/14 21:30, Mathew Joy wrote:
> RabitMQ supports multiple protocols. Does mean clients implemented in
> different protocols can talk to each other?

Yes. See, for example, http://www.rabbitmq.com/stomp.html, which goes to 
some length explaining the interoperability between AMQP and STOMP.

> PS: Answers here seems to be sparse.

What were you searching for that failed to bring up the above documentation?

Matthias.

From brett.r.cameron at gmail.com  Tue May 27 00:09:16 2014
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Tue, 27 May 2014 11:09:16 +1200
Subject: [rabbitmq-discuss] Clients with multiple protocol
In-Reply-To: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
References: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
Message-ID: <CALPqkip03FkkNeznsGMgE-v8LRpBnriaWkEaggKsV3-w_ELJyg@mail.gmail.com>

The simple answer is yes, but not all protocols are created equal so there
are limitations.
http://assortedrambles.blogspot.co.nz/2012/11/the-polygot-rabbit.html might
be (vaguely) useful.

Brett



On Sat, May 24, 2014 at 8:30 AM, Mathew Joy <mathewjoy.in at gmail.com> wrote:

> Hi,
>
> RabitMQ supports multiple protocols. Does mean clients implemented in
> different protocols can talk to each other? For Ex. one client in AMQP and
> another in Stomp.
>
> I think the answer is No or not recommended but just to confirm.
>
> Regards,
> Mathew Joy
>
> PS: Answers here seems to be sparse.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/11b5614d/attachment.html>

From matthias at rabbitmq.com  Tue May 27 00:10:58 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 27 May 2014 00:10:58 +0100
Subject: [rabbitmq-discuss] Dynamic create queue ?
In-Reply-To: <435e823d-8051-4640-8875-7cea4f5c09c2@googlegroups.com>
References: <435e823d-8051-4640-8875-7cea4f5c09c2@googlegroups.com>
Message-ID: <5383CA02.7020800@rabbitmq.com>

On 25/05/14 13:24, dev chen wrote:
> i am working on a project,which creates queue by parse a xml task config
> file,how can i do that ?

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#queue.declare



From mklishin at gopivotal.com  Tue May 27 06:15:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 09:15:32 +0400
Subject: [rabbitmq-discuss] Clients with multiple protocol
In-Reply-To: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
References: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
Message-ID: <etPan.53841f92.6b8b4567.de72@mercurio.local>

On 27 May 2014 at 03:02:48, Mathew Joy (mathewjoy.in at gmail.com) wrote:
> > Does mean clients implemented in different protocols can talk 
> to each other? For Ex. one client in AMQP and another in Stomp. 

That's the point of supporting multiple protocols ;)
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 27 06:16:42 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 09:16:42 +0400
Subject: [rabbitmq-discuss] consume-reply-listener in c
In-Reply-To: <dced592e-8cd2-432b-8b12-29a39c6eeff8@googlegroups.com>
References: <dced592e-8cd2-432b-8b12-29a39c6eeff8@googlegroups.com>
Message-ID: <etPan.53841fd8.643c9869.de72@mercurio.local>

On 27 May 2014 at 03:12:55, Josef H?k (pepa.hak at gmail.com) wrote:
> > I would like to make simple consume-reply-listener (.c) and  
> client (.py). But I can not find any similar example on web.

See Tutorial 6:
http://www.rabbitmq.com/getstarted.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 27 06:25:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 09:25:47 +0400
Subject: [rabbitmq-discuss] php pecl and max channel reached with php-fpm
In-Reply-To: <f3e6b6b8-0853-41a0-86f4-c58f47b0fa79@googlegroups.com>
References: <f3e6b6b8-0853-41a0-86f4-c58f47b0fa79@googlegroups.com>
Message-ID: <etPan.538421f8.74b0dc51.de72@mercurio.local>

?On 27 May 2014 at 03:00:50, BeaT Adrian (aditza8 at gmail.com) wrote:
> > After a while (I guess 65500 requests) a problem occurs halting  
> all writes
> "Could not create channel. Connection has no open channel slots  
> remaining"
>  
> From what I have read in the sources is because every tcp connection  
> have an autoincrement channel ID that reaches its max. This happens  
> because every request must use the channel, and is no way to use  
> the same channel ( I could not find a way into the php-amqp channel  
> classs to make it persistent) and scripts cannot communicate  
> ( to use the same instance of the channel as php object).

Every AMQP 0-9-1 connection has 1 or more channels (the max is negotiated
between client and server, so this can be limited by the broker). If you
open a lot of channels, you need to close them, or use more than 1 connection
(which in turn will use more than 1 TCP connection).

Both channels and especially connections in practice take up some resources.
It is very rare that an app actually needs 1000s or 10s of 1000s of channels.

See?http://www.rabbitmq.com/tutorials/amqp-concepts.html if you need a more
detailed explanation.

By the way, it is highly recommended that you use?https://github.com/videlalvaro/php-amqplib
and not the PECL extension (which is not actively maintained AFAIK).
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Tue May 27 07:38:43 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 27 May 2014 08:38:43 +0200
Subject: [rabbitmq-discuss] php pecl and max channel reached with php-fpm
In-Reply-To: <etPan.538421f8.74b0dc51.de72@mercurio.local>
References: <f3e6b6b8-0853-41a0-86f4-c58f47b0fa79@googlegroups.com>
 <etPan.538421f8.74b0dc51.de72@mercurio.local>
Message-ID: <CAMcAHLVsSFqqC4nY_F7XoOSb4OfeC0_gfdDPQqWhjVKYDJXWpA@mail.gmail.com>

As MK said, be sure to either close the channels after you don't need them,
or reuse them. For me it seems that you are keeping persistent connections
and then you open one channel per request, but you don't close the channel
at the end, therefore the channels are "leaking", and thus your problem.

Regards,

Alvaro


On Tue, May 27, 2014 at 7:25 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

>  On 27 May 2014 at 03:00:50, BeaT Adrian (aditza8 at gmail.com) wrote:
> > > After a while (I guess 65500 requests) a problem occurs halting
> > all writes
> > "Could not create channel. Connection has no open channel slots
> > remaining"
> >
> > From what I have read in the sources is because every tcp connection
> > have an autoincrement channel ID that reaches its max. This happens
> > because every request must use the channel, and is no way to use
> > the same channel ( I could not find a way into the php-amqp channel
> > classs to make it persistent) and scripts cannot communicate
> > ( to use the same instance of the channel as php object).
>
> Every AMQP 0-9-1 connection has 1 or more channels (the max is negotiated
> between client and server, so this can be limited by the broker). If you
> open a lot of channels, you need to close them, or use more than 1
> connection
> (which in turn will use more than 1 TCP connection).
>
> Both channels and especially connections in practice take up some
> resources.
> It is very rare that an app actually needs 1000s or 10s of 1000s of
> channels.
>
> See http://www.rabbitmq.com/tutorials/amqp-concepts.html if you need a
> more
> detailed explanation.
>
> By the way, it is highly recommended that you use
> https://github.com/videlalvaro/php-amqplib
> and not the PECL extension (which is not actively maintained AFAIK).
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/7d667ffa/attachment.html>

From videlalvaro at gmail.com  Tue May 27 07:41:52 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 27 May 2014 08:41:52 +0200
Subject: [rabbitmq-discuss] I am getting an Error while trying to send
 messages to a queue. "ACCESS_REFUSED - Login was refused using
 authentication mechanism PLAIN. For details see the broker logfile."
In-Reply-To: <7e657e5c-4c3b-41bd-87a0-8d1f3075423c@googlegroups.com>
References: <152f9b10-e3d4-4cb8-bef2-68dce4a56833@googlegroups.com>
 <7e657e5c-4c3b-41bd-87a0-8d1f3075423c@googlegroups.com>
Message-ID: <CAMcAHLV4heWq5wBueEF1feC9G7qxii1V7oxqncWL_izgAnpQ+w@mail.gmail.com>

Have you seen the link suggested by MK?
http://www.rabbitmq.com/access-control.html#loopback-users

It is also advised that you create a new user account, instead of using
guest, since everyone using RabbitMQ knows about the guest:guest account.


On Mon, May 26, 2014 at 9:31 AM, srinivas <gsrinivas10 at gmail.com> wrote:

> Hi,
>       Can u please tell me how to solve this problem. What files do we
> need to change, If we want to use an ip address instead of localhost.
>
> Thanks in Advance
>
>
> On Thursday, April 24, 2014 4:40:45 PM UTC+5:30, AMAL G JOSE wrote:
>>
>> I have configured rabbitMQ in my laptop and wrote a sender and receiver
>> program.
>> It works fine, if I set the *factory.setHost(prop.getProperty("hostname"));
>> *property with* localhost.*
>> But when I am giving the ipadress, I am getting an error * "ACCESS_REFUSED
>> - Login was refused using authentication mechanism PLAIN. For details see
>> the broker logfile."*
>> I think this is due to some user permissions. Can anyone help me in
>> solving this issue.
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/2a007ffe/attachment.html>

From aditza8 at gmail.com  Tue May 27 08:34:26 2014
From: aditza8 at gmail.com (B3aT(at)gmail)
Date: Tue, 27 May 2014 10:34:26 +0300
Subject: [rabbitmq-discuss] php pecl and max channel reached with php-fpm
In-Reply-To: <CAMcAHLVsSFqqC4nY_F7XoOSb4OfeC0_gfdDPQqWhjVKYDJXWpA@mail.gmail.com>
References: <f3e6b6b8-0853-41a0-86f4-c58f47b0fa79@googlegroups.com>
 <etPan.538421f8.74b0dc51.de72@mercurio.local>
 <CAMcAHLVsSFqqC4nY_F7XoOSb4OfeC0_gfdDPQqWhjVKYDJXWpA@mail.gmail.com>
Message-ID: <CAL+ek04=qKJZqSSpa-fqCcV6TyEDpT9q8WUT=0Cf40Qag1BPOQ@mail.gmail.com>

Hello and thanks for the answers.

I cannot reuse the channels, requests processed trough fpm do not share
resources at app level.
PHP-amqplib cannot be used, is way too slow because it doesn't support
persistent connections (is minimum 6x times slower then the pecl one, and
slows down the entire apps to a factor of 4-5, we tested it in production),
and s all because this line of code (new AMQPConnection...).

I think php-amqplib reuse the channels, I can mark them as DURABLE, and
have a specific name, but the PECL one it doesn't, you must create a new
channel every time.

I will try to close them at the end of the request, but I thought it
automatically does that when the script ends.

With PECL we have multiple persistent connections per server, and each
connection process hundreds of requests, so far the problem didn't appeared
in production tests, maybe because the fpm workers are limited to a small
number of requests.


/********************************
@author *B.G. Adrian*
@as *Game developer*
@from www.*btools*.eu
@games www.*bcardgames.com*
@work www.*mavenhut*.com
*********************************/


On Tue, May 27, 2014 at 9:38 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> As MK said, be sure to either close the channels after you don't need
> them, or reuse them. For me it seems that you are keeping persistent
> connections and then you open one channel per request, but you don't close
> the channel at the end, therefore the channels are "leaking", and thus your
> problem.
>
> Regards,
>
> Alvaro
>
>
> On Tue, May 27, 2014 at 7:25 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>>  On 27 May 2014 at 03:00:50, BeaT Adrian (aditza8 at gmail.com) wrote:
>> > > After a while (I guess 65500 requests) a problem occurs halting
>> > all writes
>> > "Could not create channel. Connection has no open channel slots
>> > remaining"
>> >
>> > From what I have read in the sources is because every tcp connection
>> > have an autoincrement channel ID that reaches its max. This happens
>> > because every request must use the channel, and is no way to use
>> > the same channel ( I could not find a way into the php-amqp channel
>> > classs to make it persistent) and scripts cannot communicate
>> > ( to use the same instance of the channel as php object).
>>
>> Every AMQP 0-9-1 connection has 1 or more channels (the max is negotiated
>> between client and server, so this can be limited by the broker). If you
>> open a lot of channels, you need to close them, or use more than 1
>> connection
>> (which in turn will use more than 1 TCP connection).
>>
>> Both channels and especially connections in practice take up some
>> resources.
>> It is very rare that an app actually needs 1000s or 10s of 1000s of
>> channels.
>>
>> See http://www.rabbitmq.com/tutorials/amqp-concepts.html if you need a
>> more
>> detailed explanation.
>>
>> By the way, it is highly recommended that you use
>> https://github.com/videlalvaro/php-amqplib
>> and not the PECL extension (which is not actively maintained AFAIK).
>> --
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/134d0eb8/attachment.html>

From shilpa.karkera at finoux.com  Tue May 27 12:35:44 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Tue, 27 May 2014 17:05:44 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send frame
	when closed
Message-ID: <53847890.1060005@finoux.com>

The RabbitMQ producer and consumer for a particular queue stops 
producing and consuming completely when such a warning occurs. It is 
understood that the  message bytes running over the buffer is 
overwhelmed, and thus it might cause this issue.

However, the question is, Why doesn't the consumer release the message 
in the buffer once it consumes this message initially, instead it 
accumulates in the buffer. This is what I have researched and understood 
regarding the above issue.  Kindly help troubleshoot!

Specifications:

Using Tornado Websockets as the consumer and the Tornado  Producer sends 
via the Pika client to pass through the queues.
Code Reference similar to: 
|https://github.com/haridas/RabbitChat/blob/master/tornado_webapp/rabbit_chat.py

Please help!
|
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/3d12946e/attachment.html>

From mklishin at gopivotal.com  Tue May 27 13:11:28 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 16:11:28 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <53847890.1060005@finoux.com>
References: <53847890.1060005@finoux.com>
Message-ID: <etPan.5384810c.6b8b4567.27f@mercurio.local>

?On 27 May 2014 at 15:37:01, shilpa karkera (shilpa.karkera at finoux.com) wrote:
> > The RabbitMQ producer and consumer for a particular queue stops  
> producing and consuming completely when such a warning occurs.  
> It is understood that the message bytes running over the buffer  
> is overwhelmed, and thus it might cause this issue.
>  
> However, the question is, Why doesn't the consumer release the  
> message in the buffer once it consumes this message initially,  
> instead it accumulates in the buffer. This is what I have researched  
> and understood regarding the above issue. Kindly help troubleshoot!  

I'm pretty sure the issue has little to do with buffers. More likely you're trying to
use an AMQP 0-9-1 connection that's already closed, either because of a network problem or
something else.

Please post RabbitMQ log and full stack trace from Pika.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shilpa.karkera at finoux.com  Tue May 27 13:24:16 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Tue, 27 May 2014 17:54:16 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <etPan.5384810c.6b8b4567.27f@mercurio.local>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local>
Message-ID: <538483F0.2070401@finoux.com>

The network is checked and is perfectly fine.
And the other queues also run well till some amount of time while the 
first queue gets this error and stops producing consuming. Consequently 
others follow to the same warning in some time.
This is the only thing that comes up when a queue has gone dead: No 
other stack trace:

When i use PIka version: 0.9.13 This is the error:

CRITICAL:pika.connection:Attempted to send frame when closed

When I tried with 0.9.14 (latest 1 from the git): This is the error:

Pika: Write buffer exceeded warning threshold at 555752 bytes and an 
estimated 6861 frames behind

That's why I believe its something to do with buffer/ memory. I've also 
tried increasing it. It just runs a bit longer and eventually gets this 
error.





On Tuesday 27 May 2014 05:41 PM, Michael Klishin wrote:
>   On 27 May 2014 at 15:37:01, shilpa karkera (shilpa.karkera at finoux.com) wrote:
>>> The RabbitMQ producer and consumer for a particular queue stops
>> producing and consuming completely when such a warning occurs.
>> It is understood that the message bytes running over the buffer
>> is overwhelmed, and thus it might cause this issue.
>>   
>> However, the question is, Why doesn't the consumer release the
>> message in the buffer once it consumes this message initially,
>> instead it accumulates in the buffer. This is what I have researched
>> and understood regarding the above issue. Kindly help troubleshoot!
> I'm pretty sure the issue has little to do with buffers. More likely you're trying to
> use an AMQP 0-9-1 connection that's already closed, either because of a network problem or
> something else.
>
> Please post RabbitMQ log and full stack trace from Pika.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mklishin at gopivotal.com  Tue May 27 13:29:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 16:29:26 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <538483F0.2070401@finoux.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local>
 <538483F0.2070401@finoux.com>
Message-ID: <etPan.53848542.643c9869.27f@mercurio.local>

?On 27 May 2014 at 16:24:19, shilpa karkera (shilpa.karkera at finoux.com) wrote:
> > And the other queues also run well till some amount of time while  
> the
> first queue gets this error and stops producing consuming. Consequently  
> others follow to the same warning in some time.
> This is the only thing that comes up when a queue has gone dead:  

These lines suggest your program opens multiple connections to RabbitMQ:
https://github.com/haridas/RabbitChat/blob/master/tornado_webapp/rabbit_chat.py#L54-56

is this the case? If so, then it's no surprise that some consumers continue to function
(if that's what "first queue gets this error and stops producing consuming" means): their
connections are open and fine.

> When i use PIka version: 0.9.13 This is the error:
>  
> CRITICAL:pika.connection:Attempted to send frame when closed  
>  
> When I tried with 0.9.14 (latest 1 from the git): This is the error:  
>  
> Pika: Write buffer exceeded warning threshold at 555752 bytes  
> and an
> estimated 6861 frames behind

The message says that it is *write* buffer that is behind
(presumably because connection is down). Or it may be a red herring,
I'd investigate other possible reasons first.

What's in RabbitMQ log?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shilpa.karkera at finoux.com  Tue May 27 13:49:14 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Tue, 27 May 2014 18:19:14 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <etPan.53848542.643c9869.27f@mercurio.local>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local>
Message-ID: <538489CA.90608@finoux.com>

Thank you for the detailed understanding of the issue and the speedy 
reply. :)

Yes, there are multiple queues, thus multiple consumers.
However yeah, I understand that the read is happening faster than write. 
I tried using delays to level it up. didnt work!
I can assure the network's fine here.

The Rabbit log has the following:

=ERROR REPORT==== 27-May-2014::17:19:41 ===
AMQP connection <0.6238.0> (running), channel 1 - error:
{amqp_error,unexpected_frame,
             "expected content header for class 60, got non content 
header frame instead",
             'basic.publish'}

=INFO REPORT==== 27-May-2014::17:19:41 ===
closing AMQP connection <0.6238.0> (127.0.0.1:35918 -> 127.0.0.1:5672)


Thus it closes the connection after the unexpected frame error.



On Tuesday 27 May 2014 05:59 PM, Michael Klishin wrote:
>   On 27 May 2014 at 16:24:19, shilpa karkera (shilpa.karkera at finoux.com) wrote:
>>> And the other queues also run well till some amount of time while
>> the
>> first queue gets this error and stops producing consuming. Consequently
>> others follow to the same warning in some time.
>> This is the only thing that comes up when a queue has gone dead:
> These lines suggest your program opens multiple connections to RabbitMQ:
> https://github.com/haridas/RabbitChat/blob/master/tornado_webapp/rabbit_chat.py#L54-56
>
> is this the case? If so, then it's no surprise that some consumers continue to function
> (if that's what "first queue gets this error and stops producing consuming" means): their
> connections are open and fine.
>
>> When i use PIka version: 0.9.13 This is the error:
>>   
>> CRITICAL:pika.connection:Attempted to send frame when closed
>>   
>> When I tried with 0.9.14 (latest 1 from the git): This is the error:
>>   
>> Pika: Write buffer exceeded warning threshold at 555752 bytes
>> and an
>> estimated 6861 frames behind
> The message says that it is *write* buffer that is behind
> (presumably because connection is down). Or it may be a red herring,
> I'd investigate other possible reasons first.
>
> What's in RabbitMQ log?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>


From mklishin at gopivotal.com  Tue May 27 13:55:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 16:55:10 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <538489CA.90608@finoux.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local>
 <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
Message-ID: <etPan.53848b4a.66334873.27f@mercurio.local>

?On 27 May 2014 at 16:49:17, shilpa karkera (shilpa.karkera at finoux.com) wrote:
> > =ERROR REPORT==== 27-May-2014(http://airmail.calendar/2014-05-27%2012:00:00%20GMT+4)::17:19:41  
> ===
> AMQP connection <0.6238.0> (running), channel 1 - error:
> {amqp_error,unexpected_frame,
> "expected content header for class 60, got non content
> header frame instead",
> 'basic.publish'}

Right, so this means RabbitMQ has encountered a connection-level error
and notified Pika about it. So the connection is indeed closed.

Now, why you may get this exception. You most likely share a channel between
threads. It's OK to publish from multiple threads on the same connection
but only when every channel uses its own thread.

Every published message on the wire is 2 or more frames:

[basic.publish method]+[content header]+[content body frame]*

Concurrent publishes on the same channel w/o synchronization mean you will
get frames interleaved incorrectly.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shilpa.karkera at finoux.com  Tue May 27 14:03:52 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Tue, 27 May 2014 18:33:52 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <etPan.53848b4a.66334873.27f@mercurio.local>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local>
Message-ID: <53848D38.7020409@finoux.com>

So you mean to say 'unmanaged multiple threads' on a single channel has 
caused this?
Yeah I've created these on a single channel which I was planning to 
change later.

Thus, yeah I'll try with multiple channels and with each having its own 
thread in it.

Thanks,
Will try that and check!
Shilpa Karkera


On Tuesday 27 May 2014 06:25 PM, Michael Klishin wrote:
>   On 27 May 2014 at 16:49:17, shilpa karkera (shilpa.karkera at finoux.com) wrote:
>>> =ERROR REPORT==== 27-May-2014(http://airmail.calendar/2014-05-27%2012:00:00%20GMT+4)::17:19:41
>> ===
>> AMQP connection <0.6238.0> (running), channel 1 - error:
>> {amqp_error,unexpected_frame,
>> "expected content header for class 60, got non content
>> header frame instead",
>> 'basic.publish'}
> Right, so this means RabbitMQ has encountered a connection-level error
> and notified Pika about it. So the connection is indeed closed.
>
> Now, why you may get this exception. You most likely share a channel between
> threads. It's OK to publish from multiple threads on the same connection
> but only when every channel uses its own thread.
>
> Every published message on the wire is 2 or more frames:
>
> [basic.publish method]+[content header]+[content body frame]*
>
> Concurrent publishes on the same channel w/o synchronization mean you will
> get frames interleaved incorrectly.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>


From mklishin at gopivotal.com  Tue May 27 14:05:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 17:05:34 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <53848D38.7020409@finoux.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local>
 <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local>
 <53848D38.7020409@finoux.com>
Message-ID: <etPan.53848db8.74b0dc51.27f@mercurio.local>



On 27 May 2014 at 17:04:01, shilpa karkera (shilpa.karkera at finoux.com) wrote:
> > So you mean to say 'unmanaged multiple threads' on a single channel  
> has
> caused this?
> Yeah I've created these on a single channel which I was planning  
> to
> change later.

No. Multiple threads publish on a shared channel.

> Thus, yeah I'll try with multiple channels and with each having  
> its own
> thread in it.

Channels do not "have threads". You use channel(s) from threads. Each thread
should have its own thread (e.g. open one right after it is started), then
you won't have this connection error.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From pat at munkiisoft.com  Tue May 27 14:17:29 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Tue, 27 May 2014 14:17:29 +0100
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
Message-ID: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>

RabbitMQ 3.2.4
ErLang R16B02

Using BasicPublish and BasicGet

I made some changes to how we use RabbitMQ recently that included only
checking that queues and exchanges existed when we Publish. I did this for
performance reasons.

On the whole the 5 queues we use will exist in production due to having had
messages published.

However in test environments that is not always there. The Windows Service
we have that reads messages (BasicGet) is configured to Read from all 5
queues.

If the queue is not there i get a soft error.
=ERROR REPORT==== 23-May-2014::16:21:32 ===
connection <0.12152.0>, channel 12 - *soft error*:
*{amqp_error,not_found,*
            "no queue 'Work_3.0.0185.01_Normal' in vhost 's2_stackatf'",
            'basic.get'}


1. Is there a way to tell RabbitMQ to chill out about queues not being
found?

2. Is my performance tweak worth it? Should I just be checking and creating
a queue before trying to read from it?

Thanks

Pat


-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/d3e83525/attachment.html>

From mklishin at gopivotal.com  Tue May 27 14:21:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 17:21:32 +0400
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
In-Reply-To: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
References: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
Message-ID: <etPan.53849179.19495cff.27f@mercurio.local>

?On 27 May 2014 at 17:18:51, Patrick Long (pat at munkiisoft.com) wrote:
> > 1. Is there a way to tell RabbitMQ to chill out about queues not  
> being found?

You can do that queue.declare with passive = true on a separate channel or via HTTP API

> 2. Is my performance tweak worth it? Should I just be checking  
> and creating a queue before trying to read from it?

It depends on how you read. If you use basic.consume, which is often used
just once in the entire consumer lifecycle, then simply declare the queue you need,
bind it, etc.

If you use basic.get, you need to perform declaration and so on once. Every time you
declare a queue, it's a network roundtrip, so it will affect throughput.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue May 27 14:28:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 May 2014 14:28:14 +0100
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
In-Reply-To: <etPan.53849179.19495cff.27f@mercurio.local>
References: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
 <etPan.53849179.19495cff.27f@mercurio.local>
Message-ID: <538492EE.1030000@rabbitmq.com>

On 27/05/14 14:21, Michael Klishin wrote:
>   On 27 May 2014 at 17:18:51, Patrick Long (pat at munkiisoft.com) wrote:
>>> 1. Is there a way to tell RabbitMQ to chill out about queues not
>> being found?
>
> You can do that queue.declare with passive = true on a separate channel or via HTTP API

Well, both passive=true and passive=false will assert that the queue 
exists, but passive=true will fail rather than create the queue if it is 
missing. Since the OP is mostly concerned with making sure the basic.get 
works, then it makes more sense to declare the queue passive=false.

Ultimately the AMQPish way to do things is declare what you need

> If you use basic.get, you need to perform declaration and so on once. Every time you
> declare a queue, it's a network roundtrip, so it will affect throughput.

Unless you issue the declare with nowait=true, in which case the client 
will just send the declare request and not wait for a response. If the 
queue already exists, this is almost free. Obviously if it doesn't you 
incur the cost of creating it, but you probably wanted that anyway :-)

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From gavincardoza87 at gmail.com  Mon May 26 10:27:25 2014
From: gavincardoza87 at gmail.com (gavin cardoza)
Date: Mon, 26 May 2014 02:27:25 -0700 (PDT)
Subject: [rabbitmq-discuss] |Spam| Exclusive Review Offer: "RabbitMQ
	Essentials" by David Dossot
Message-ID: <d8454100-73b7-4e8e-82a3-16ca26fd25d4@googlegroups.com>

bit.ly/1mASQR1  Free Review Copies available. If interested, get in touch 
with me: gavinc at packtpub.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140526/780b4707/attachment.html>

From bvnr.mail at gmail.com  Tue May 27 12:30:23 2014
From: bvnr.mail at gmail.com (Narayan)
Date: Tue, 27 May 2014 04:30:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Trouble with SSL on my newly installed
	RabbitMQ instance
In-Reply-To: <ee905b6c-de6b-4586-ad89-513349763251@googlegroups.com>
References: <ee905b6c-de6b-4586-ad89-513349763251@googlegroups.com>
Message-ID: <3de50593-2e8b-417b-95d3-b0bbbb5aa774@googlegroups.com>

Hi Joe,  
 I am also facing the same problem for last 3 days, Did you get any 
solution for this issue, please let me know, thanks in advance ..

On Saturday, April 5, 2014 9:31:14 PM UTC+5:30, Joe Abrams wrote:
>
> Hello,
>
> I'm trying to get SSL working on my Rabbit server, following the 
> instructions at https://www.rabbitmq.com/ssl.html verbatim, but am 
> getting this error when making connections:
>
> =INFO REPORT==== 5-Apr-2014::15:28:48 ===
> accepting AMQP connection <0.678.0> (.....)
>
> =ERROR REPORT==== 5-Apr-2014::15:28:53 ===
> error on AMQP connection <0.678.0>: 
> {ssl_upgrade_error,{options,{cacertfile,[47,11...
>
> I'm following the SSL troubleshooting guide and get the above error when 
> trying to 'Attempt SSL connection to Broker' from the same machine.
>
> It looks like my config *is* being read as I see this in my logs:
>
> =INFO REPORT==== 5-Apr-2014::14:38:13 ===
> started SSL Listener on [::]:5671
>
> +++ My system details +++
> Ubuntu 13.10 (I'm on ec2)
> SSL version: [{ssl_app,"5.3"},
>  {supported,['tlsv1.2','tlsv1.1',tlsv1,sslv3]},
>  {available,['tlsv1.2','tlsv1.1',tlsv1,sslv3]}]
> RabbitMQ 3.3.0, Erlang R16B01
>
> I've banged my head on this for a day now and am not making progress.  Any 
> help would be greatly appreciate.  Thanks -Joe
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/c2a7b94d/attachment.html>

From pat at munkiisoft.com  Tue May 27 15:09:53 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Tue, 27 May 2014 15:09:53 +0100
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
In-Reply-To: <538492EE.1030000@rabbitmq.com>
References: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
 <etPan.53849179.19495cff.27f@mercurio.local>
 <538492EE.1030000@rabbitmq.com>
Message-ID: <CALDntb_pq_yeMWjGOPqvhOzn6NkNzvx0=ydQw-PvctHe4Gro6A@mail.gmail.com>

>>Since the OP is mostly concerned with making sure the basic.get works,
then it makes more sense to declare the queue passive=false.<<
 I am mostly concerned with BasicGet not causing a log entry.If the queue
is not there I don't care just don't error.

Are you guys saying I should always check the queue exist, Read and Write
and that it is how I check that is worth changing. The change should be
passing true for NoWait?

It does not look like the RabbitMQ .NET Client Library supports passing
nowait to QueueDeclare.

Pat


On 27 May 2014 14:28, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 27/05/14 14:21, Michael Klishin wrote:
>
>>   On 27 May 2014 at 17:18:51, Patrick Long (pat at munkiisoft.com) wrote:
>>
>>> 1. Is there a way to tell RabbitMQ to chill out about queues not
>>>>
>>> being found?
>>>
>>
>> You can do that queue.declare with passive = true on a separate channel
>> or via HTTP API
>>
>
> Well, both passive=true and passive=false will assert that the queue
> exists, but passive=true will fail rather than create the queue if it is
> missing. Since the OP is mostly concerned with making sure the basic.get
> works, then it makes more sense to declare the queue passive=false.
>
> Ultimately the AMQPish way to do things is declare what you need
>
>  If you use basic.get, you need to perform declaration and so on once.
>> Every time you
>> declare a queue, it's a network roundtrip, so it will affect throughput.
>>
>
> Unless you issue the declare with nowait=true, in which case the client
> will just send the declare request and not wait for a response. If the
> queue already exists, this is almost free. Obviously if it doesn't you
> incur the cost of creating it, but you probably wanted that anyway :-)
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/3dd14f3e/attachment.html>

From mathewjoy.in at gmail.com  Tue May 27 15:58:30 2014
From: mathewjoy.in at gmail.com (Mathew Joy)
Date: Tue, 27 May 2014 09:58:30 -0500
Subject: [rabbitmq-discuss] Clients with multiple protocol
In-Reply-To: <5383C983.503@rabbitmq.com>
References: <bd9cedc6-7ea1-4ba3-8566-1775b3fbd8d8@googlegroups.com>
 <5383C983.503@rabbitmq.com>
Message-ID: <CADYH=85JQinZ2a__BW4rzb2m1yKFdds58LcP9DFsbjpMXa6eWA@mail.gmail.com>

Thanks for the answers.

I was using the GoogleGroups and I don't find many replies. Switching to
MarkMail shows all the replies. So, yes, there are a ton of answers :)

Regards,
Mathew Joy


On Mon, May 26, 2014 at 6:08 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 23/05/14 21:30, Mathew Joy wrote:
>
>> RabitMQ supports multiple protocols. Does mean clients implemented in
>> different protocols can talk to each other?
>>
>
> Yes. See, for example, http://www.rabbitmq.com/stomp.html, which goes to
> some length explaining the interoperability between AMQP and STOMP.
>
>  PS: Answers here seems to be sparse.
>>
>
> What were you searching for that failed to bring up the above
> documentation?
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/051345f3/attachment.html>

From steve at rabbitmq.com  Tue May 27 16:03:02 2014
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 27 May 2014 16:03:02 +0100
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
	frame when closed
In-Reply-To: <etPan.53848db8.74b0dc51.27f@mercurio.local>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local> <53848D38.7020409@finoux.com>
 <etPan.53848db8.74b0dc51.27f@mercurio.local>
Message-ID: <7E66A9BC-2D6E-4ECC-90E8-667719D3C163@rabbitmq.com>

What Michael meant to type is:

On 27 May 2014, at 14:05, Michael Klishin <mklishin at gopivotal.com> wrote:

> Each thread
> should have its own channel (e.g. open one right after it is started), then
> you won't have this connection error. 

Steve Powell  [Cell: +44-7815-838-558]
    Good design [?] is as little design as possible.    Dieter Rams

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/f967fa6f/attachment.html>

From ponmuthu at omnesysindia.com  Tue May 27 16:33:00 2014
From: ponmuthu at omnesysindia.com (PONMUTHU M)
Date: Tue, 27 May 2014 08:33:00 -0700 (PDT)
Subject: [rabbitmq-discuss] how to get queue bindings data ??
Message-ID: <1401204780905-35865.post@n5.nabble.com>

Hi,
    I want to receive queue.bind message.how can we dine inside receive
clause.  

PLEASE HELP ME !!

Regards,
PONMUTHU M



-----
-- PONMUTHU M --
--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-to-get-queue-bindings-data-tp35865.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From sp345s at att.com  Tue May 27 19:29:07 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 27 May 2014 18:29:07 +0000
Subject: [rabbitmq-discuss] exception starting consumer and adding a binding
Message-ID: <59BF56992750434F89F8EBE141E64B1D022237F6@GAALPA1MSGUSRAA.ITServices.sbc.com>

Not sure why I keep getting the below exception ..
>From the logs it looks like it has exchange reference ..but still get this ... any help

   27 May 2014 14:24:52,765 SimpleAsyncTaskExecutor-1 - Starting consumer Consumer: tag=[null], channel=null, acknowledgeMode=AUTO local queue size=0
   27 May 2014 14:24:52,835 SimpleAsyncTaskExecutor-1 - Initializing declarations
   27 May 2014 14:24:52,835 SimpleAsyncTaskExecutor-1 - Returning cached instance of singleton bean 'exchange1'
   27 May 2014 14:24:52,836 SimpleAsyncTaskExecutor-1 - Returning cached instance of singleton bean 'queue1'
   27 May 2014 14:24:52,836 SimpleAsyncTaskExecutor-1 - Returning cached instance of singleton bean 'org.springframework.amqp.rabbit.config.DLCoreBindingFactoryBean#0'
   27 May 2014 14:24:52,847 SimpleAsyncTaskExecutor-1 - Creating cached Rabbit Channel from AMQChannel(amqp://mongo at 192.168.128.102:5672/,1)
   27 May 2014 14:24:52,858 SimpleAsyncTaskExecutor-1 - Executing callback on RabbitMQ Channel: Cached Rabbit Channel: AMQChannel(amqp://mongo at 192.168.128.102:5672/,1)
   27 May 2014 14:24:52,858 SimpleAsyncTaskExecutor-1 - declaring Exchange 'mongo.device.entity.exchange'
   27 May 2014 14:24:52,863 SimpleAsyncTaskExecutor-1 - declaring Queue 'mongo.device.entity.exchange.QUEUE'
   27 May 2014 14:24:52,870 SimpleAsyncTaskExecutor-1 - Binding destination [mongo.device.entity.exchange.QUEUE (QUEUE)] to exchange [null] with routing key [*]
   27 May 2014 14:24:52,872 main - Successfully started bean 'dlListenerContainer'
   27 May 2014 14:24:52,873 main - Returning cached instance of singleton bean 'org.springframework.context.annotation.internalScheduledAnnotationProcessor'
   27 May 2014 14:24:52,874 main - Returning cached instance of singleton bean 'org.springframework.amqp.rabbit.config.DLCoreBindingFactoryBean#0'
   27 May 2014 14:24:52,879 main - ***********************************************
   27 May 2014 14:24:52,879 main - ************DLCORE MBUS - START****************
   27 May 2014 14:24:52,879 main - ***********************************************
   27 May 2014 14:24:57,873 SimpleAsyncTaskExecutor-1 - Consumer raised exception, processing can restart if the connection factory supports it
   org.springframework.amqp.UncategorizedAmqpException: java.lang.IllegalStateException: Invalid configuration: 'exchange' must be non-null.
       at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(RabbitExceptionTranslator.java:60)
       at org.springframework.amqp.rabbit.connection.RabbitAccessor.convertRabbitAccessException(RabbitAccessor.java:108)
       at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:632)
       at org.springframework.amqp.rabbit.core.RabbitAdmin.initialize(RabbitAdmin.java:352)
       at org.springframework.amqp.rabbit.core.RabbitAdmin$11.onCreate(RabbitAdmin.java:286)
       at org.springframework.amqp.rabbit.connection.CompositeConnectionListener.onCreate(CompositeConnectionListener.java:31)
       at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:230)
       at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils$1.createConnection(ConnectionFactoryUtils.java:77)
       at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.doGetTransactionalResourceHolder(ConnectionFactoryUtils.java:125)
       at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.getTransactionalResourceHolder(ConnectionFactoryUtils.java:67)
       at org.springframework.amqp.rabbit.listener.BlockingQueueConsumer.start(BlockingQueueConsumer.java:200)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:527)
       at java.lang.Thread.run(Thread.java:662)
Caused by: java.lang.IllegalStateException: Invalid configuration: 'exchange' must be non-null.
       at com.rabbitmq.client.impl.AMQImpl$Queue$Bind.<init>(AMQImpl.java:1506)
       at com.rabbitmq.client.AMQP$Queue$Bind$Builder.build(AMQP.java:840)
       at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:790)
       at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:61)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
       at java.lang.reflect.Method.invoke(Method.java:597)
       at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:348)
       at $Proxy7.queueBind(Unknown Source)
       at org.springframework.amqp.rabbit.core.RabbitAdmin.declareBindings(RabbitAdmin.java:446)
       at org.springframework.amqp.rabbit.core.RabbitAdmin.access$300(RabbitAdmin.java:51)
       at org.springframework.amqp.rabbit.core.RabbitAdmin$12.doInRabbit(RabbitAdmin.java:356)
       at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:627)
       ... 10 more
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/540bd98a/attachment.html>

From mklishin at gopivotal.com  Tue May 27 19:34:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 27 May 2014 22:34:15 +0400
Subject: [rabbitmq-discuss] exception starting consumer and adding a
 binding
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D022237F6@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D022237F6@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <etPan.5384dac2.625558ec.27f@mercurio.local>

On 27 May 2014 at 22:31:10, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> org.springframework.amqp.UncategorizedAmqpException:  
> java.lang.IllegalStateException: Invalid configuration:  
> 'exchange' must be non-null.
> at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(RabbitExceptionTranslator.java:60)  
> at org.springframework.amqp.rabbit.connection.RabbitAccessor.convertRabbitAccessException(RabbitAccessor.java:108)  

?

>  
> at java.lang.Thread.run(Thread.java:662)
>  
>  
> Caused by: java.lang.IllegalStateException: Invalid configuration:  
> 'exchange' must be non-null.
>  
>  
> at com.rabbitmq.client.impl.AMQImpl$Queue$Bind.(AMQImpl.java:1506)  
> at com.rabbitmq.client.AMQP$Queue$Bind$Builder.build(AMQP.java:840)  

Exchange in queue.bind ends up being null. Unfortunately, it's not possible to tell why unless you are
willing to post relevant parts of your Spring configuration.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue May 27 21:50:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 00:50:00 +0400
Subject: [rabbitmq-discuss] how to get queue bindings data ??
In-Reply-To: <1401204780905-35865.post@n5.nabble.com>
References: <1401204780905-35865.post@n5.nabble.com>
Message-ID: <etPan.5384fa96.643c9869.21a8@mercurio.local>

On 27 May 2014 at 19:34:12, PONMUTHU M (ponmuthu at omnesysindia.com) wrote:
> > I want to receive queue.bind message.how can we dine inside  
> receive
> clause.

queue.bind are never received by clients. If you want to inspect queue bindings,
you need to use HTTP API:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_1/priv/www/api/index.html?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shilpa.karkera at finoux.com  Wed May 28 04:41:52 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Wed, 28 May 2014 09:11:52 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <7E66A9BC-2D6E-4ECC-90E8-667719D3C163@rabbitmq.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local> <53848D38.7020409@finoux.com>
 <etPan.53848db8.74b0dc51.27f@mercurio.local>
 <7E66A9BC-2D6E-4ECC-90E8-667719D3C163@rabbitmq.com>
Message-ID: <53855B00.3000304@finoux.com>

Yep, got it! Thank you for the explanation. checking it out right away!


On Tuesday 27 May 2014 08:33 PM, Steve Powell wrote:
> What Michael meant to type is:
>
> On 27 May 2014, at 14:05, Michael Klishin <mklishin at gopivotal.com 
> <mailto:mklishin at gopivotal.com>> wrote:
>
>> Each thread
>> should have its own /*_channel_*/(e.g. open one right after it is 
>> started), then
>> you won't have this connection error. 
>
> Steve Powell [/Cell/: +44-7815-838-558]
> /    Good design/ [?]/is as little design as possible. /Dieter Rams
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/92f8ed88/attachment.html>

From mklishin at gopivotal.com  Wed May 28 07:12:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 10:12:04 +0400
Subject: [rabbitmq-discuss] how to get queue bindings data ??
In-Reply-To: <D1E60DF145F4ED46B56113D1DDAEB228111C325C@BIAP-ERFMMBS20.ERF.thomson.com>
References: <1401204780905-35865.post@n5.nabble.com>
 <etPan.5384fa96.643c9869.21a8@mercurio.local>
 <D1E60DF145F4ED46B56113D1DDAEB228111C325C@BIAP-ERFMMBS20.ERF.thomson.com>
Message-ID: <etPan.53857e52.6b8b4567.277c@mercurio.local>

On 28 May 2014 at 08:28:37, ponmuthu.m at thomsonreuters.com (ponmuthu.m at thomsonreuters.com) wrote:
> > If I want to transfer bindings to one node to another node like  
> federation , how can I do ?

In a cluster, all bindings are available to all nodes. Across clusters,
export and import definitions:?http://rabbitmq.com/management.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From shilpa.karkera at finoux.com  Wed May 28 07:34:30 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Wed, 28 May 2014 12:04:30 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <53855B00.3000304@finoux.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local> <53848D38.7020409@finoux.com>
 <etPan.53848db8.74b0dc51.27f@mercurio.local>
 <7E66A9BC-2D6E-4ECC-90E8-667719D3C163@rabbitmq.com>
 <53855B00.3000304@finoux.com>
Message-ID: <53858376.8050307@finoux.com>

Okay, now I have reconfigured my entire code:

Now each queue has its own channel. Thus when I open 3 browser tabs for 
my application. It starts 3 threads each having its own channel.
However, it still gives the same error.


On Wednesday 28 May 2014 09:11 AM, shilpa karkera wrote:
> Yep, got it! Thank you for the explanation. checking it out right away!
>
>
> On Tuesday 27 May 2014 08:33 PM, Steve Powell wrote:
>> What Michael meant to type is:
>>
>> On 27 May 2014, at 14:05, Michael Klishin <mklishin at gopivotal.com 
>> <mailto:mklishin at gopivotal.com>> wrote:
>>
>>> Each thread
>>> should have its own /*_channel_*/(e.g. open one right after it is 
>>> started), then
>>> you won't have this connection error. 
>>
>> Steve Powell [/Cell/: +44-7815-838-558]
>> /    Good design/ [...]/is as little design as possible. /Dieter Rams
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/65a221d0/attachment.html>

From bvnr.mail at gmail.com  Wed May 28 08:41:25 2014
From: bvnr.mail at gmail.com (Narayan)
Date: Wed, 28 May 2014 07:41:25 +0000 (UTC)
Subject: [rabbitmq-discuss] Trouble with SSL on my newly installed
	RabbitMQ instance
References: <ee905b6c-de6b-4586-ad89-513349763251@googlegroups.com>
 <etPan.534278bb.41b71efb.e7e3@mercurio.local>
Message-ID: <loom.20140528T093631-648@post.gmane.org>

Michael Klishin <mklishin at ...> writes:

> 
> On 7 April 2014 at 13:58:47, Joe Abrams (jbabrams <at> gmail.com) wrote:
> > > I've banged my head on this for a day now and am not making progress.  
> > Any help would be greatly appreciate.
> 
> Have you tried connecting with openssl s_client and using openssl s_server
> to verify your certificates and server key?
> 
> There can be many reasons to?ssl_upgrade_error and openssl 
s_client/s_server
> will output more detailed messages when there?s an error.?


Hi Michael,

I am also facing the same error , I tried to check my certificates with 
openssl s_server  running on specific port, and openssl s-client is able to 
connect to that port and able to communicate .. see this client output 
below..

openssl s_client -connect localhost:8443 -cert client/cert.pem -key 
client/key.pem -CAfile testca/cacert.pem
CONNECTED(00000003)
depth=1 CN = MyTestCA
verify return:1
depth=0 CN = primedev, O = server
verify return:1
---
Certificate chain
 0 s:/CN=primedev/O=server
   i:/CN=MyTestCA
 1 s:/CN=MyTestCA
   i:/CN=MyTestCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhNeVRl
c3RDQTAeFw0xNDA1MjgwNjU2NDNaFw0xNTA1MjgwNjU2NDNaMCQxETAPBgNVBAMM
CHByaW1lZGV2MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQC9IW8zoWmE8tUr46rc+QWrPYBlpHefUZ7HP1smlrN9rujrZM7l
ja7w+M7rHJSt0bTQ+dFfu1RTmWHkdgI4YIdgGvmhU3Bcij5Cyxn+vtZUaIAeYGfQ
QfPj6WsNiHOem/ieAkbhX+AvPDD7DBjlrqbo9ZtzeJxkhe/ENWHRlpdPNNpHpvbw
2azTPO55Nb2sDbeUOP0Bv1OieXM3r7CNruFF+KTAzxdC18kUM0Ty4jmwG3L1DFlF
zpm77ByB5DjFdNs+tBZ+1Fi1WrHp2NsSJe0IsCdCF9BG3RacpQv5tt/5/qL/af4G
xDyqebE/G9RwbM6Mnti3wGY34EGMtGFao/vDAgMBAAGjLzAtMAkGA1UdEwQCMAAw
CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
A4IBAQAL4TTARGRyGq/EMtbfkrQbInMoIPaV+VT8X6EKCvBrhjQZZ1bGHBYEBhry
EHQAJ1eiRPPLpVe4zpIP6xU8tiN/sIm4XOyj7hstSTThnixjNgZRmwUt/blMKA0p
PsFEKnAf2brwryO4KJcKbfjLCJfyWje8nXLR9dz/qrJ8+Vwve76lMnAoRqjDw1OF
z08evHevN3Mdb3Hyvd9WFRNMpQkjrmfx+v5dcXcbSOlpwtHIHMmX3Pq7QgXQdyo/
vNmGBYqyLofBwtKMOYbfhoksyJbCOeDCG5fYMUnSI1EqivjLPQX/0Dt2s0UzWOip
G2FWCQGgOKfLHWIawGNQcSpM83x4
-----END CERTIFICATE-----
subject=/CN=primedev/O=server
issuer=/CN=MyTestCA
---
No client certificate CA names sent
---
SSL handshake has read 2176 bytes and written 247 bytes
---
New, TLSv1/SSLv3, Cipher is DHE-RSA-AES256-SHA
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: zlib compression
Expansion: zlib compression
SSL-Session:
    Protocol  : TLSv1
    Cipher    : DHE-RSA-AES256-SHA
    Session-ID: 
81472A55C8EC471863BFC884C40322AC1A5C5FA00C8D845E71A98E122D60185E
    Session-ID-ctx:
    Master-Key: 
BB3BBA13077D4152455620760258906F1CF576966656D4417C3F80B1F7C1B357DCEBA4434363
879177A7AF55332FBC7A
    Key-Arg   : None
    Krb5 Principal: None
    PSK identity: None
    PSK identity hint: None
    TLS session ticket:
    0000 - 96 aa 8f 94 70 9c 42 0c-1b 44 62 f9 8c a8 42 5d   
....p.B..Db...B]
    0010 - fb 24 c2 7a 38 4e 69 e5-89 3d 71 ba 8f 59 2a 1a   
.$.z8Ni..=q..Y*.
    0020 - a0 9d e2 cc a8 fb 3d 71-b5 b3 d6 01 17 d9 22 b9   
......=q......".
    0030 - 6a 6b 73 59 1b 07 b7 84-23 b2 c7 08 4d 7f 88 2a   
jksY....#...M..*
    0040 - 6b 75 e5 3c 25 ca 26 da-77 b8 64 ce 72 15 30 da   ku.
<%.&.w.d.r.0.
    0050 - 5b 11 98 0a 25 dc 96 a3-77 bf b8 a0 e1 38 4e 22   
[...%...w....8N"
    0060 - 19 78 bc 5b 89 5b 3c f1-d5 17 e8 4f 57 0f 15 dc   .x.[.
[<....OW...
    0070 - 97 09 d8 7c 64 ce 68 e1-3f 18 95 23 3f 80 6a c7   
...|d.h.?..#?.j.
    0080 - 63 72 53 20 96 34 51 09-d3 28 8d 8c 73 03 31 a0   crS .4Q..
(..s.1.
    0090 - d0 73 3f 6a 19 25 11 10-5f d3 02 d5 92 75 ec f0   .s?
j.%.._....u..

    Compression: 1 (zlib compression)
    Start Time: 1401261748
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---







Where as when i run openssl s_client to rabbitmq port(5671) getting the 
below error, Any help is appreciated ..

openssl s_client -connect localhost:5671 -cert client/cert.pem -key 
client/key.pem -CAfile testca/cacert.pem
CONNECTED(00000003)
write:errno=104
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 113 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---




From matthias at rabbitmq.com  Wed May 28 08:58:18 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 08:58:18 +0100
Subject: [rabbitmq-discuss] Clustering behind a firewall
In-Reply-To: <82f45fd9-8f61-446e-9d67-1110062c95fd@googlegroups.com>
References: <82f45fd9-8f61-446e-9d67-1110062c95fd@googlegroups.com>
Message-ID: <5385971A.80509@rabbitmq.com>

On 22/05/14 03:06, james.rivettcarnac at neo.com wrote:
> I'm having some issues with clustering and a firewall.  During setup of
> the cluster over tcp, epmd opens a bunch of ephemeral ports > 30000 that
> vanish after the clustering is set up.

These are *outbound* ports, i.e. the local end of a connection to a 
remote epmd.

I don't think there's any way to control the allocation of these ports.

Matthias.

From matthias at rabbitmq.com  Wed May 28 09:02:39 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 09:02:39 +0100
Subject: [rabbitmq-discuss] Error with SSL
In-Reply-To: <ADE38E95806BA84AB03AC5674E976FE012E3DA2D@phmailp02.JMSOnline.com>
References: <5879dcbd-91a8-4567-8753-585ef0413902@googlegroups.com>
 <edff7f0f-62f2-4a58-be9a-8cff04c72888@googlegroups.com>
 <1969fef1-4c26-4020-a4cb-1c9d3183e1d7@googlegroups.com>
 <etPan.537db8e0.7545e146.5f0b@mercurio.local>
 <CACjM4Qg29B=einNFAu47BQSSiqpaEK6QO8JXSM9wQuKTrBS++A@mail.gmail.com>
 <ADE38E95806BA84AB03AC5674E976FE012E3DA2D@phmailp02.JMSOnline.com>
Message-ID: <5385981F.4070804@rabbitmq.com>

On 22/05/14 14:00, Becker, Jeffrey wrote:
> It seems as if I missed escaping a backslash on one of my paths.  I?ve
> changed them all over to forward slashes per your recommendation.  This
> doesn?t fix the issue but at least my error messages are different.
> [...]
> When I run openssl s_client I see:
>      CONNECTED(00000003)
>      depth=1 /CN=JanneyDevCA
>      verify return:1
>      depth=0 /CN=svcbus-app03-dv.dev.jmsonline.com/ST=PA/C=US/O=Janney,
> Montgomery, Scott LLC
>      verify return:1
>      3020:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert
> handshake failure:s3_pkt.c:1053:SSL alert number 40
>      3020:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
> failure:s23_lib.c:188:
>
> Either way the server log gets a message:
> [...]
>      =ERROR REPORT==== 22-May-2014::08:42:20 ===
>      SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake failure
>      =ERROR REPORT==== 22-May-2014::08:42:25 ===
>      error on AMQP connection <0.327.0>:
> {ssl_upgrade_error,{tls_alert,[104,97,110,100,115,104,97,107,101,32,102,97,105,108,117,114,101]}}...

It is failing in the certificate validation.

Matthias.

From matthias at rabbitmq.com  Wed May 28 09:20:27 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 09:20:27 +0100
Subject: [rabbitmq-discuss] frame size eror: source F5 Loadbalancer
In-Reply-To: <6789221D917755409AD829E5EF0EAF5B7F7AD8B5@venmail01.vistaprint.net>
References: <6789221D917755409AD829E5EF0EAF5B7F7AD8B5@venmail01.vistaprint.net>
Message-ID: <53859C4B.6030307@rabbitmq.com>

On 23/05/14 10:22, Stephen Ehlas wrote:
> We have a curious situation with RabbitMQ. When the clients try to
> connect directly to a rabbitMQ node, all is ok. When we pass them
> through our F5 load balancer, the 3^rd connection attempt is aborted.
> The load balancer is set to round robin. In the RabbitMQ logs we see this:
>
> /=ERROR REPORT==== 22-May-2014::15:25:36 ===/
> /AMQP connection <0.13650.16> (closed), channel 19793 - error:/
> /{amqp_error,frame_error,/
> /            "type 65, all octets = <<>>:
> {frame_too_large,1342177289,131064}",/
> /            none}/

This indicates that an AMQP protocol header - i.e. 
'A','M','Q','P',0,0,9,1 - was sent on a connection that has already gone 
through that handshake.

My guess is that the load balancer is routing a new client connection to 
an existing server connection.

Matthias.

From matthias at rabbitmq.com  Wed May 28 09:33:22 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 09:33:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Windows Failover Clustering
In-Reply-To: <4c8ab48b-6029-4192-aa23-831d84acf7e2@googlegroups.com>
References: <4c8ab48b-6029-4192-aa23-831d84acf7e2@googlegroups.com>
Message-ID: <53859F52.5080904@rabbitmq.com>

Nick,

On 21/05/14 12:20, Nick Benton wrote:
> I am looking at setting up RabbitMQ on an existing Windows
> Active/Passive failover cluster, using shared storage.
>
> I have seen the discussion surrounding this in the group (here
> <https://groups.google.com/forum/#!searchin/rabbitmq-discuss/windows/rabbitmq-discuss/LnleyojNXjY/nOohEvgauCAJ>)
> detailing the requirement for the service name to be identical, and how
> to remedy this on installation (manual) of the RabbitMQ service.

That was fixed in 2.7.1, more than two years ago.

> Also, looking at the reliance on the erlang cookie, I should be able to
> set the homepath for this cookie to shared storage, is this correct?

yes.

> Are there any other components of RabbitMQ that can be located on the
> shared storage?

You'll want to make sure that RABBITMQ_BASE points to shared storage. It 
defaults to !APPDATA!\!RABBITMQ_SERVICENAME!.

More generally, see https://www.rabbitmq.com/relocate.html#windows

Matthias.

From matthias at rabbitmq.com  Wed May 28 09:52:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 09:52:31 +0100
Subject: [rabbitmq-discuss] Mirrored Queues Down Behaviour
In-Reply-To: <CAGPPH4CUOKf6xCgXbRve1+VuThRhyM_NCOcQNsrR_D+YM=wR7Q@mail.gmail.com>
References: <CAGPPH4CUOKf6xCgXbRve1+VuThRhyM_NCOcQNsrR_D+YM=wR7Q@mail.gmail.com>
Message-ID: <5385A3CF.5020904@rabbitmq.com>

On 23/05/14 13:21, Ben Murphy wrote:
> I've noticed that when rabbitmq nodes becomes unreachable the gm
> module can behave very strangely.

Please try the latest rabbit version. There are a number of bugs we have 
fixed in that area.

Matthias.

From matthias at rabbitmq.com  Wed May 28 10:10:33 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 10:10:33 +0100
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
In-Reply-To: <CALDntb_pq_yeMWjGOPqvhOzn6NkNzvx0=ydQw-PvctHe4Gro6A@mail.gmail.com>
References: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
 <etPan.53849179.19495cff.27f@mercurio.local> <538492EE.1030000@rabbitmq.com>
 <CALDntb_pq_yeMWjGOPqvhOzn6NkNzvx0=ydQw-PvctHe4Gro6A@mail.gmail.com>
Message-ID: <5385A809.8060807@rabbitmq.com>

Patrick,

On 27/05/14 15:09, Patrick Long wrote:
>   I am mostly concerned with BasicGet not causing a log entry.If the
> queue is not there I don't care just don't error.

There is no way to do that in AMQP.

> Are you guys saying I should always check the queue exist

That won't help since a passive queue.declare will *still* result in an 
error and log entry when the queue doesn't exist.

> The change should be passing true for NoWait?

What Simon suggested is that you make sure that the queue *does* exist 
prior to the basic.get by (actively) declaring it with queue.declare. 
The nowait flag is only there to make that more efficient, by turning 
the command into an asynchronous request.

> It does not look like the RabbitMQ .NET Client Library supports passing
> nowait to QueueDeclare.

Correct. You'd have to drop to the internal API by casting to 
RabbitMQ.Client.Impl.IFullModel and invoking _Private_QueueDeclare(...).

Matthias.

From pat at munkiisoft.com  Wed May 28 10:13:49 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Wed, 28 May 2014 10:13:49 +0100
Subject: [rabbitmq-discuss] Check Queues Exist on Publish (and Read?)
In-Reply-To: <5385A809.8060807@rabbitmq.com>
References: <CALDntb9Lz-Tvqc+Mt_rTCQZE9e6vBd_vkwiVjj6OjZrov2dAig@mail.gmail.com>
 <etPan.53849179.19495cff.27f@mercurio.local>
 <538492EE.1030000@rabbitmq.com>
 <CALDntb_pq_yeMWjGOPqvhOzn6NkNzvx0=ydQw-PvctHe4Gro6A@mail.gmail.com>
 <5385A809.8060807@rabbitmq.com>
Message-ID: <CALDntb-jgMMqNeJfyEL_OiDGQ4epPg_6e_+7wu3at31SQQ+O0A@mail.gmail.com>

Thanks Matthias


On 28 May 2014 10:10, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Patrick,
>
> On 27/05/14 15:09, Patrick Long wrote:
>
>>   I am mostly concerned with BasicGet not causing a log entry.If the
>> queue is not there I don't care just don't error.
>>
>
> There is no way to do that in AMQP.
>
>  Are you guys saying I should always check the queue exist
>>
>
> That won't help since a passive queue.declare will *still* result in an
> error and log entry when the queue doesn't exist.
>
>  The change should be passing true for NoWait?
>>
>
> What Simon suggested is that you make sure that the queue *does* exist
> prior to the basic.get by (actively) declaring it with queue.declare. The
> nowait flag is only there to make that more efficient, by turning the
> command into an asynchronous request.
>
>  It does not look like the RabbitMQ .NET Client Library supports passing
>> nowait to QueueDeclare.
>>
>
> Correct. You'd have to drop to the internal API by casting to
> RabbitMQ.Client.Impl.IFullModel and invoking _Private_QueueDeclare(...).
>
> Matthias.
>



-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/32bef529/attachment.html>

From matthias at rabbitmq.com  Wed May 28 10:29:49 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 10:29:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ 3.3.0 Can not login with Open Ldap
In-Reply-To: <11f1b524-6a93-462a-a648-94b260ef22ff@googlegroups.com>
References: <ce891346-fe48-4529-81ec-fc475322aed2@googlegroups.com>
 <11f1b524-6a93-462a-a648-94b260ef22ff@googlegroups.com>
Message-ID: <5385AC8D.1040004@rabbitmq.com>

On 23/05/14 11:13, dwang7630 at gmail.com wrote:
> *I'm try login to RabbitMQ, LDAP bind have return success. But I can not
> login, and  this is the log file*

What error does the HTTP response contain?

Matthias.

From noreply+1572807377 at badoo.com  Wed May 28 10:31:57 2014
From: noreply+1572807377 at badoo.com (Roman Gaufman)
Date: Wed, 28 May 2014 09:31:57 +0000
Subject: [rabbitmq-discuss] =?utf-8?q?=E2=98=85_Discussions_about_RabbitMQ?=
	=?utf-8?q?=2C_Roman_Gaufman_left_a_message_for_you?=
Message-ID: <20140528093157.1A28E8513041@cluster1091.monopost.com>

Roman Gaufman left a message for you

Its sender and content will be shown only to you and you can delete it at any time. You can instantly reply to it, using the message exchange system. To find out what was written to you, just follow this link:
http://eu1.badoo.com/roman.gaufman/in/xBN8.PRbl9M/?lang_id=3&g=57-0-4&m=21&mid=5385ad0b000000000003004d03961a0b00536e5f015a


If clicking the links in this message does not work,
copy and paste them into the address bar of your browser.


This email is a part of delivering a message sent by Roman Gaufman on the system. If you received this email by mistake, please just ignore it. After a short time the message will be removed from the system.


Have fun!
The Badoo Team

You have received this email from Badoo Trading Limited (postal address below).
If you do not wish to receive further email communications from Badoo click here to opt out: https://eu1.badoo.com/impersonation.phtml?lang_id=3&email=rabbitmq-discuss%40lists.rabbitmq.com&block_code=a51d0c&m=21&mid=5385ad0b000000000003004d03961a0b00536e5f015a&g=0-0-4.

Badoo Trading Limited is a limited company registered in England and Wales
under CRN 7540255 with its registered office at Media Village, 131 - 151 Great Titchfield Street, London, W1W 5BB.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/9295a6c7/attachment.html>

From jtuley at pivotallabs.com  Tue May 27 15:33:51 2014
From: jtuley at pivotallabs.com (John Tuley)
Date: Tue, 27 May 2014 08:33:51 -0600
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <537CCBFB.8080406@rabbitmq.com>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
 <etPan.537c70f1.12200854.8fb9@mercurio.local>
 <537C7223.30702@rabbitmq.com> <537C7401.3060308@rabbitmq.com>
 <537CCBFB.8080406@rabbitmq.com>
Message-ID: <CAOwmSWSY3nCKB2Ht5Cq7moCLfX8iEpq-seYv1UpXw2+RkbgWpQ@mail.gmail.com>

Simon,

Thanks for getting that documentation going! It's been very helpful to our
project.

? John Tuley


On Wed, May 21, 2014 at 9:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/05/14 10:38, Simon MacMullen wrote:
>
>> I really need to document this :-/
>>
>
> And I have finally started:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/
> 9b44a7aca551/priv/www/doc/stats.html
>
> Apologies to everyone who's waited a long time for this...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/4a172dbc/attachment.html>

From thedufer at gmail.com  Tue May 27 22:17:52 2014
From: thedufer at gmail.com (Aaron Dufour)
Date: Tue, 27 May 2014 14:17:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Scaling to large number of bindings
Message-ID: <0031f377-5875-45fb-b722-36f83a394a9a@googlegroups.com>

I'm having some trouble coming up with a scalable RabbitMQ setup for our 
application (we're currently using Redis pub/sub but that's going to become 
a problem in the near future).  At our current level, we would have ~200 
queues with ~500,000 bindings between them, but we're seeing consistent 
growth and expect the number of bindings to increase quite a bit beyond 
that.  There's no logical partitioning among these queues - any queue can 
expect a message from any producer.

My plan so far consists of having 3 layers of RabbitMQ servers - an 
incoming layer, where each server accepts messages from a portion of our 
producers; a routing layer, where each server routes a portion of the 
messages based on routing key (potentially each routing server accepting 
from each incoming server); and an outgoing layer, where each server will 
contain a portion of the outgoing queues.  The routing layer would contain 
two exchanges per server, linked with an exchange-to-exchange binding where 
the binding key defines which messages that that routing server is dealing 
with, and the incoming exchange is federated to the exchange on each 
incoming server.  It appears that this will operate as I would like and 
deal with increased load well.

On the other end, I would have an exchange on each outgoing server that the 
queues would bind to (a direct exchange - they are binding to exact routing 
keys).  However, when I federate this to the outgoing exchanges on the 
routing servers, every binding is stored on every routing server, which 
puts a hard ceiling on the number of bindings I can make.  Ideally the 
outgoing servers would only tell each routing server about the bindings it 
cares about (since each routing server is only dealing with a known subset 
of messages, based on routing keys), but I can't see a way to make this 
happen.

Do I need something other than federation?  Am I thinking about the whole 
problem wrong?  I could use some help figuring out the right topology to 
allow the system to scale for the foreseeable future.

Thanks,
Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/f21ab006/attachment.html>

From ponmuthu.m at thomsonreuters.com  Wed May 28 05:28:32 2014
From: ponmuthu.m at thomsonreuters.com (ponmuthu.m at thomsonreuters.com)
Date: Wed, 28 May 2014 04:28:32 +0000
Subject: [rabbitmq-discuss] how to get queue bindings data ??
In-Reply-To: <etPan.5384fa96.643c9869.21a8@mercurio.local>
References: <1401204780905-35865.post@n5.nabble.com>
 <etPan.5384fa96.643c9869.21a8@mercurio.local>
Message-ID: <D1E60DF145F4ED46B56113D1DDAEB228111C325C@BIAP-ERFMMBS20.ERF.thomson.com>

If I want to transfer bindings to one node to another node like federation , how can I do ?


Regards,

Ponmuthu M
Engineer ? Development
Bangalore

Omnesys Technologies
A Thomson Reuters Company

Phone: +91 080-666 578 23
Mobile: +91 95 350 456 45

ponmuthu.m at thomsonreuters.com
http://thomsonreuters.com

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Wednesday, May 28, 2014 2:20 AM
To: Discussions about RabbitMQ; PONMUTHU M
Subject: Re: [rabbitmq-discuss] how to get queue bindings data ??

On 27 May 2014 at 19:34:12, PONMUTHU M (ponmuthu at omnesysindia.com) wrote:
> > I want to receive queue.bind message.how can we dine inside
> receive
> clause.

queue.bind are never received by clients. If you want to inspect queue bindings, you need to use HTTP API:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_1/priv/www/api/index.html
--
MK  

Software Engineer, Pivotal/RabbitMQ

From aiguo.gu at tekcomms.com  Wed May 28 07:05:09 2014
From: aiguo.gu at tekcomms.com (Gu, Aiguo)
Date: Wed, 28 May 2014 06:05:09 +0000
Subject: [rabbitmq-discuss] Run RabbitMQ Service
Message-ID: <91F9C6FA5F7F5343B0F41D638C4EBD364063C596@US-BV-EXM01-P.global.tektronix.net>

Hi,

I follow the guide http://geneabase.com/docs/RabbitMQ_setup, and succeed to run RabbitMQ service under a local user(I created a user named "rabbituser" in my computer). But when I use a domain user(named "global\rabbituser"), failed to start the service, if I reboot my computer, RabbitMQ could be started, but when I restarted it, it failed to restart. Our IT changed ours some environment variables like %HOMEDRIVE%. I don't know how to investigate the issue, could you please give me a hand?
Here are logs from system event viewer when starting service, there are no logs in rabbitmq log files:

The RabbitMQ service terminated with the following error:
The process terminated unexpectedly.

RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). The service is not restarted as OnFail is set to ignore.

Best Regards
Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/6a9ddcee/attachment.html>

From mklishin at gopivotal.com  Wed May 28 10:48:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 13:48:11 +0400
Subject: [rabbitmq-discuss] Run RabbitMQ Service
In-Reply-To: <91F9C6FA5F7F5343B0F41D638C4EBD364063C596@US-BV-EXM01-P.global.tektronix.net>
References: <91F9C6FA5F7F5343B0F41D638C4EBD364063C596@US-BV-EXM01-P.global.tektronix.net>
Message-ID: <etPan.5385b0f8.6b8b4567.360d@mercurio.local>

?On 28 May 2014 at 13:38:59, Gu, Aiguo (aiguo.gu at tekcomms.com) wrote:
> > Our IT changed ours some environment variables like %HOMEDRIVE%.  
> I don?t know how to investigate the issue, could you please give  
> me a hand?

You can control where RabbitMQ stores its data. Take a look at
http://www.rabbitmq.com/relocate.html. The problem may be the backslash in
the username.

If you are trying to set up a cluster, take a look at the Erlang cookie section on
http://www.rabbitmq.com/clustering.html.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Wed May 28 10:48:50 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 May 2014 10:48:50 +0100
Subject: [rabbitmq-discuss] Meaning of message_stats contents
In-Reply-To: <CAOwmSWSY3nCKB2Ht5Cq7moCLfX8iEpq-seYv1UpXw2+RkbgWpQ@mail.gmail.com>
References: <7e3bb756-f346-4882-9b7a-7394b860fa2e@googlegroups.com>
 <etPan.537c70f1.12200854.8fb9@mercurio.local> <537C7223.30702@rabbitmq.com>
 <537C7401.3060308@rabbitmq.com> <537CCBFB.8080406@rabbitmq.com>
 <CAOwmSWSY3nCKB2Ht5Cq7moCLfX8iEpq-seYv1UpXw2+RkbgWpQ@mail.gmail.com>
Message-ID: <5385B102.3080000@rabbitmq.com>

On 27/05/14 15:33, John Tuley wrote:
> Thanks for getting that documentation going! It's been very helpful to
> our project.

Glad you find it useful. Btw, the most up-to-date version of the docs is 
at 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/doc/stats.html

Matthias.

From martijn.vandevyvere at gmail.com  Wed May 28 11:35:41 2014
From: martijn.vandevyvere at gmail.com (Martijn Vandevyvere)
Date: Wed, 28 May 2014 03:35:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on Azure VM
In-Reply-To: <1dac0b0a-d7d9-4c5c-a928-0dcc15c536c2@googlegroups.com>
References: <1dac0b0a-d7d9-4c5c-a928-0dcc15c536c2@googlegroups.com>
Message-ID: <0d0574b3-42dc-48d5-a533-e50560eff289@googlegroups.com>

Did you have any luck with opening het port and establishing a connection? 
I'm experiencing the same issue and tried about everything I could think 
of. Current situation: installed a CentOS VM image and installed RabbitMQ. 
Got the management console enabled and can connect locally. Even tried 
disabling iptables (although I saw no conflict) but I'm still unable to 
connect.

On Monday, April 28, 2014 10:36:05 PM UTC+2, William Wallace wrote:
>
> We're trying to set up RabbitMQ on an Azure VM and are not having success. 
> We have installed Erlang and RabbitMQ, can see the service is running, and 
> get status from rabitmqctl on the command line. What we can't do, is get 
> the management console to come up when we connect to port 15672 either 
> locally or remotely. Anybody know what the trick is to make it work?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/1dc608e3/attachment.html>

From mklishin at gopivotal.com  Wed May 28 12:21:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 15:21:39 +0400
Subject: [rabbitmq-discuss] RabbitMQ on Azure VM
In-Reply-To: <0d0574b3-42dc-48d5-a533-e50560eff289@googlegroups.com>
References: <1dac0b0a-d7d9-4c5c-a928-0dcc15c536c2@googlegroups.com>
 <0d0574b3-42dc-48d5-a533-e50560eff289@googlegroups.com>
Message-ID: <etPan.5385c6e0.6b8b4567.4f03@mercurio.local>

?On 28 May 2014 at 15:17:07, Martijn Vandevyvere (martijn.vandevyvere at gmail.com) wrote:
> > Current situation: installed a CentOS VM image and installed  
> RabbitMQ. Got the management console enabled and can connect  
> locally. Even tried disabling iptables (although I saw no conflict)  
> but I'm still unable to connect.

Are you using the default user (guest)? If so, see
http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From dor.b at softweave.co  Wed May 28 12:42:34 2014
From: dor.b at softweave.co (Dor Ben Dov)
Date: Wed, 28 May 2014 14:42:34 +0300
Subject: [rabbitmq-discuss] shovel and ssl question
Message-ID: <5385CBAA.7050903@softweave.co>

Hi,

I have one rabbit with shovel plugin (lets call it X) that works with 
another rabbit on a different server (lets call it Y).

i need that the communication between the shovel and the other rabbit 
would be encrypted , ssl i assume.

Does it means i need to read and follow this 
http://www.rabbitmq.com/ssl.html or maybe something simpler ?

+

let's say that i have a python file with pika that sends messages to the 
rabbit on X server.
Will i have a problem continue using it after i will set the ssl for the 
rabbits ?

Thanks in advance,
Dor

From mklishin at gopivotal.com  Wed May 28 12:48:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 15:48:53 +0400
Subject: [rabbitmq-discuss] shovel and ssl question
In-Reply-To: <5385CBAA.7050903@softweave.co>
References: <5385CBAA.7050903@softweave.co>
Message-ID: <etPan.5385cd43.643c9869.4f03@mercurio.local>

?On 28 May 2014 at 15:43:54, Dor Ben Dov (dor.b at softweave.co) wrote:
> > I have one rabbit with shovel plugin (lets call it X) that works  
> with
> another rabbit on a different server (lets call it Y).
>  
> i need that the communication between the shovel and the other  
> rabbit
> would be encrypted , ssl i assume.
>  
> Does it means i need to read and follow this
> http://www.rabbitmq.com/ssl.html or maybe something simpler  
> ?

Yes, you need to enable SSL in the server:
http://www.rabbitmq.com/ssl.html

and configure Shovel (RabbitMQ Erlang client, to be precise) to use SSL
via URI query parameters:
http://www.rabbitmq.com/uri-query-parameters.html

> let's say that i have a python file with pika that sends messages  
> to the
> rabbit on X server.
> Will i have a problem continue using it after i will set the ssl  
> for the
> rabbits ?

You need to connect to a different port (5671 by default)
and instruct Pika to connect using SSL. Search for "SSL"
on?http://pika.readthedocs.org/en/0.9.6/examples/using_urlparameters.html.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed May 28 12:52:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 28 May 2014 15:52:05 +0400
Subject: [rabbitmq-discuss] shovel and ssl question
In-Reply-To: <etPan.5385cd43.643c9869.4f03@mercurio.local>
References: <5385CBAA.7050903@softweave.co>
 <etPan.5385cd43.643c9869.4f03@mercurio.local>
Message-ID: <etPan.5385ce03.74b0dc51.4f03@mercurio.local>

On 28 May 2014 at 15:50:40, Michael Klishin (mklishin at gopivotal.com) wrote:
> > > let's say that i have a python file with pika that sends messages 
> > to the
> > rabbit on X server.
> > Will i have a problem continue using it after i will set the ssl 
> > for the
> > rabbits ?
> 
> You need to connect to a different port (5671 by default)
> and instruct Pika to connect using SSL. Search for "SSL"
> on http://pika.readthedocs.org/en/0.9.6/examples/using_urlparameters.html. 

Note that if you don't want Pika connections to be encrypted, you can
simply continue connecting to the non-SSL port (5672) and not change anything
in your client code.

This will happily work side by side with Shovel connections being encrypted.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From rohitmukherjee26 at gmail.com  Wed May 28 15:42:40 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Wed, 28 May 2014 22:42:40 +0800
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting
	down frequently..
In-Reply-To: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
References: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
Message-ID: <CAKYxN6kCuYFPvUZbVJWoq8dax=e2DVwDhToPwmoFutpBqUCY-g@mail.gmail.com>

Hi ALL,

We are seeing node getting down and seeing 3 Similar Error Always..

1)
 =ERROR REPORT==== 28-May-2014::14:31:49 ===
AMQP connection <0.6576.0> (running), channel 0 - error:
{amqp_error,connection_forced,
            "broker forced connection closure with reason 'shutdown'",none}

2)

[10:39:58 PM] rohit mukherjee: Mirrored queue 'req_resp_es' in vhost '/':
Slave <rabbit at vpc-prod-rabbitmq02.1.256.0> saw deaths of mirrors
<rabbit at vpc-prod-rabbitmq01.2.29560.57>


 3)
 =ERROR REPORT==== 28-May-2014::14:31:51 ===
Mnesia('rabbit at vpc-prod-rabbitmq02'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network,
'rabbit at vpc-prod-rabbitmq01'}

Please Suggest Solution for the same

Regards,
Rohit

On Thu, May 22, 2014 at 6:40 PM, Rohit Mukherjee <rohitmukherjee26 at gmail.com
> wrote:

> HI Team,
>
>
>
> RabbitMQ nodes are getting shutdown automatically , Can you please suggest
> how should I fix the issue ..Please find the Log Strace Below
>
>
>
>
>
> =INFO REPORT==== 22-May-2014::09:43:12 ===
>
> Mirrored queue 'win_es' in vhost '/': Promoting slave
> <rabbit at vpc-prod-rabbitmq02.1.10232.0> to master
>
>
>
> =INFO REPORT==== 22-May-2014::09:58:07 ===
>
> Stopping RabbitMQ
>
>
>
> =INFO REPORT==== 22-May-2014::09:58:07 ===
>
> stopped TCP Listener on [::]:5672
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10638.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10358.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10524.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10355.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10387.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10352.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10384.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10463.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10349.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10381.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10493.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>
> AMQP connection <0.10346.0> (running), channel 0 - error:
>
> {amqp_error,connection_forced,
>
>             "broker forced connection closure with reason 'shutdown'",none}
>
>
>
> =INFO REPORT==== 22-May-2014::09:58:08 ===
>
> Halting Erlang VM
>
>
>
> =====
> Regards,
> Rohit Mukherjee
>
>


-- 
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/16d40771/attachment.html>

From dberger at fiveringscapital.com  Wed May 28 15:40:38 2014
From: dberger at fiveringscapital.com (Dan Berger)
Date: Wed, 28 May 2014 07:40:38 -0700
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification failed"
Message-ID: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>

I'm just starting development on a c++ client app to connect to a vendor's server.

I'm trying the SimpleAmqpClient library which is built on top of rabbitmq-c.

The provided a self-signed client certificate in .p12 format that I've converted to .pem. This contains a public and private key and also a CA public key.

I'm now trying to connect while providing the .pem file as the CA cert, client cert and client private key.

While connecting, I get:
'AmqpClient::AmqpLibraryException'
  what():  Error setting client certificate for socket: SSL peer cert verification failed

Digging into rabbitmq-c, I see this is due to the call to amqp_ssl_socket_set_key failing.

Running openssl s_client seems to work fine, so I'm not sure what I'm doing wrong. Any ideas?

-Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/f7aa8d71/attachment.html>

From rohitmukherjee26 at gmail.com  Wed May 28 15:45:21 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Wed, 28 May 2014 22:45:21 +0800
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting
	down frequently..
In-Reply-To: <CAKYxN6kCuYFPvUZbVJWoq8dax=e2DVwDhToPwmoFutpBqUCY-g@mail.gmail.com>
References: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
 <CAKYxN6kCuYFPvUZbVJWoq8dax=e2DVwDhToPwmoFutpBqUCY-g@mail.gmail.com>
Message-ID: <CAKYxN6k7ukCn0GHnNpVkVHg-RM3daEvNJT=tLgN6RVV9G2hEHA@mail.gmail.com>

Full Error Report :

=ERROR REPORT==== 28-May-2014::14:41:36 ===
** Generic server <0.191.0> terminating
** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}
** When Server state == undefined
** Reason for termination ==
** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}

=ERROR REPORT==== 28-May-2014::14:41:36 ===
** Generic server <0.194.0> terminating
** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}
** When Server state == undefined
** Reason for termination ==
** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}

=ERROR REPORT==== 28-May-2014::14:41:36 ===
** Generic server <0.192.0> terminating
** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
                        {not_granted,
                         {cyclic,'rabbit at vpc-prod-rabbitmq01',
                          {gm_group,

 {resource,<<"/">>,queue,<<"impression_click_es">>}},
                          write,write,
                          {tid,1215,<7209.30767.61>}}}}
** When Server state == undefined
** Reason for termination ==
** {unexpected_info,
       {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
           {not_granted,
               {cyclic,'rabbit at vpc-prod-rabbitmq01',
                   {gm_group,
                       {resource,<<"/">>,queue,<<"impression_click_es">>}},
                   write,write,
                   {tid,1215,<7209.30767.61>}}}}}

=ERROR REPORT==== 28-May-2014::14:41:36 ===
** Generic server <0.193.0> terminating
** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}
** When Server state == undefined
** Reason for termination ==
** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}



On Wed, May 28, 2014 at 10:42 PM, Rohit Mukherjee <
rohitmukherjee26 at gmail.com> wrote:

> Hi ALL,
>
> We are seeing node getting down and seeing 3 Similar Error Always..
>
> 1)
>  =ERROR REPORT==== 28-May-2014::14:31:49 ===
> AMQP connection <0.6576.0> (running), channel 0 - error:
> {amqp_error,connection_forced,
>             "broker forced connection closure with reason 'shutdown'",none}
>
> 2)
>
> [10:39:58 PM] rohit mukherjee: Mirrored queue 'req_resp_es' in vhost '/':
> Slave <rabbit at vpc-prod-rabbitmq02.1.256.0> saw deaths of mirrors
> <rabbit at vpc-prod-rabbitmq01.2.29560.57>
>
>
>  3)
>  =ERROR REPORT==== 28-May-2014::14:31:51 ===
> Mnesia('rabbit at vpc-prod-rabbitmq02'): ** ERROR ** mnesia_event got
> {inconsistent_database, starting_partitioned_network,
> 'rabbit at vpc-prod-rabbitmq01'}
>
> Please Suggest Solution for the same
>
> Regards,
> Rohit
>
>
> On Thu, May 22, 2014 at 6:40 PM, Rohit Mukherjee <
> rohitmukherjee26 at gmail.com> wrote:
>
>> HI Team,
>>
>>
>>
>> RabbitMQ nodes are getting shutdown automatically , Can you please
>> suggest how should I fix the issue ..Please find the Log Strace Below
>>
>>
>>
>>
>>
>> =INFO REPORT==== 22-May-2014::09:43:12 ===
>>
>> Mirrored queue 'win_es' in vhost '/': Promoting slave
>> <rabbit at vpc-prod-rabbitmq02.1.10232.0> to master
>>
>>
>>
>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>
>> Stopping RabbitMQ
>>
>>
>>
>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>
>> stopped TCP Listener on [::]:5672
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10638.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10358.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10524.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10355.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10387.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10352.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10384.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10463.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10349.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10381.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10493.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>
>> AMQP connection <0.10346.0> (running), channel 0 - error:
>>
>> {amqp_error,connection_forced,
>>
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>>
>>
>> =INFO REPORT==== 22-May-2014::09:58:08 ===
>>
>> Halting Erlang VM
>>
>>
>>
>> =====
>> Regards,
>> Rohit Mukherjee
>>
>>
>
>
> --
> Regards,
> Rohit Mukherjee
>
>


-- 
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/d3087e2a/attachment.html>

From rohitmukherjee26 at gmail.com  Wed May 28 15:46:39 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Wed, 28 May 2014 22:46:39 +0800
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting
	down frequently..
In-Reply-To: <CAKYxN6k7ukCn0GHnNpVkVHg-RM3daEvNJT=tLgN6RVV9G2hEHA@mail.gmail.com>
References: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
 <CAKYxN6kCuYFPvUZbVJWoq8dax=e2DVwDhToPwmoFutpBqUCY-g@mail.gmail.com>
 <CAKYxN6k7ukCn0GHnNpVkVHg-RM3daEvNJT=tLgN6RVV9G2hEHA@mail.gmail.com>
Message-ID: <CAKYxN6kEHhzweVKo0hAhC0YMLtB_8xmK6758_SSicucWjqOieQ@mail.gmail.com>

Please Note , We have Both Node Running in Same AZ in EC2, and observed
Network Partition...


On Wed, May 28, 2014 at 10:45 PM, Rohit Mukherjee <
rohitmukherjee26 at gmail.com> wrote:

> Full Error Report :
>
> =ERROR REPORT==== 28-May-2014::14:41:36 ===
> ** Generic server <0.191.0> terminating
> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
> ',granted}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>
> =ERROR REPORT==== 28-May-2014::14:41:36 ===
> ** Generic server <0.194.0> terminating
> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
> ',granted}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>
> =ERROR REPORT==== 28-May-2014::14:41:36 ===
> ** Generic server <0.192.0> terminating
> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
>                         {not_granted,
>                          {cyclic,'rabbit at vpc-prod-rabbitmq01',
>                           {gm_group,
>
>  {resource,<<"/">>,queue,<<"impression_click_es">>}},
>                           write,write,
>                           {tid,1215,<7209.30767.61>}}}}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {unexpected_info,
>        {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
>            {not_granted,
>                {cyclic,'rabbit at vpc-prod-rabbitmq01',
>                    {gm_group,
>                        {resource,<<"/">>,queue,<<"impression_click_es">>}},
>                    write,write,
>                    {tid,1215,<7209.30767.61>}}}}}
>
> =ERROR REPORT==== 28-May-2014::14:41:36 ===
> ** Generic server <0.193.0> terminating
> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
> ',granted}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>
>
>
> On Wed, May 28, 2014 at 10:42 PM, Rohit Mukherjee <
> rohitmukherjee26 at gmail.com> wrote:
>
>> Hi ALL,
>>
>> We are seeing node getting down and seeing 3 Similar Error Always..
>>
>> 1)
>>  =ERROR REPORT==== 28-May-2014::14:31:49 ===
>> AMQP connection <0.6576.0> (running), channel 0 - error:
>> {amqp_error,connection_forced,
>>             "broker forced connection closure with reason
>> 'shutdown'",none}
>>
>> 2)
>>
>> [10:39:58 PM] rohit mukherjee: Mirrored queue 'req_resp_es' in vhost '/':
>> Slave <rabbit at vpc-prod-rabbitmq02.1.256.0> saw deaths of mirrors
>> <rabbit at vpc-prod-rabbitmq01.2.29560.57>
>>
>>
>>  3)
>>  =ERROR REPORT==== 28-May-2014::14:31:51 ===
>> Mnesia('rabbit at vpc-prod-rabbitmq02'): ** ERROR ** mnesia_event got
>> {inconsistent_database, starting_partitioned_network,
>> 'rabbit at vpc-prod-rabbitmq01'}
>>
>> Please Suggest Solution for the same
>>
>> Regards,
>> Rohit
>>
>>
>> On Thu, May 22, 2014 at 6:40 PM, Rohit Mukherjee <
>> rohitmukherjee26 at gmail.com> wrote:
>>
>>> HI Team,
>>>
>>>
>>>
>>> RabbitMQ nodes are getting shutdown automatically , Can you please
>>> suggest how should I fix the issue ..Please find the Log Strace Below
>>>
>>>
>>>
>>>
>>>
>>> =INFO REPORT==== 22-May-2014::09:43:12 ===
>>>
>>> Mirrored queue 'win_es' in vhost '/': Promoting slave
>>> <rabbit at vpc-prod-rabbitmq02.1.10232.0> to master
>>>
>>>
>>>
>>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> Stopping RabbitMQ
>>>
>>>
>>>
>>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> stopped TCP Listener on [::]:5672
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10638.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10358.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10524.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10355.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10387.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10352.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10384.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10463.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10349.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10381.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10493.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>
>>> AMQP connection <0.10346.0> (running), channel 0 - error:
>>>
>>> {amqp_error,connection_forced,
>>>
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>>
>>>
>>> =INFO REPORT==== 22-May-2014::09:58:08 ===
>>>
>>> Halting Erlang VM
>>>
>>>
>>>
>>> =====
>>> Regards,
>>> Rohit Mukherjee
>>>
>>>
>>
>>
>> --
>> Regards,
>> Rohit Mukherjee
>>
>>
>
>
> --
> Regards,
> Rohit Mukherjee
>
>


-- 
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/ee4a1b81/attachment.html>

From martijn.vandevyvere at gmail.com  Wed May 28 13:26:33 2014
From: martijn.vandevyvere at gmail.com (Martijn Vandevyvere)
Date: Wed, 28 May 2014 14:26:33 +0200
Subject: [rabbitmq-discuss] RabbitMQ on Azure VM
In-Reply-To: <etPan.5385c6e0.6b8b4567.4f03@mercurio.local>
References: <1dac0b0a-d7d9-4c5c-a928-0dcc15c536c2@googlegroups.com>
 <0d0574b3-42dc-48d5-a533-e50560eff289@googlegroups.com>
 <etPan.5385c6e0.6b8b4567.4f03@mercurio.local>
Message-ID: <CAE_DWEse9upZZvwR8_tRrud-0E2sUixQL_ZpBw_YPwLYN+pR9w@mail.gmail.com>

Nope, actually discovered the issue. Seems the port 15672 was and is still
being blocked by the company firewall. Thanks for the 'breaking things'
post though as I didn't know about the guest account only accessible via
localhost.


On Wed, May 28, 2014 at 1:21 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>  On 28 May 2014 at 15:17:07, Martijn Vandevyvere (
> martijn.vandevyvere at gmail.com) wrote:
> > > Current situation: installed a CentOS VM image and installed
> > RabbitMQ. Got the management console enabled and can connect
> > locally. Even tried disabling iptables (although I saw no conflict)
> > but I'm still unable to connect.
>
> Are you using the default user (guest)? If so, see
> http://www.rabbitmq.com/blog/2014/04/02/breaking-things-with-rabbitmq-3-3/
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/2d7930ce/attachment.html>

From daniel.bason at telogis.com  Thu May 29 00:14:27 2014
From: daniel.bason at telogis.com (Daniel Bason)
Date: Thu, 29 May 2014 11:14:27 +1200
Subject: [rabbitmq-discuss] |Spam| Question about management plugin and
	clustering
Message-ID: <CAHdxdCcYzwGm9UkjdWSNMuKuGcioY=gHMBDQ8b3eqQ7T=PvnXw@mail.gmail.com>

Hi,

I have a question about the management plugin and clustering that is not
made clear in the documentation.  If we have a cluster already running and
we enable the management plugin on one node, do we have to restart the
entire cluster to gain access to the statistics or can we just restart the
node that we have enabled the plugin on?

Regards

-- 
*Dan Bason *
Infrastructure Engineer ? Telogis
www.telogis.com  www.telogis.co.nz
+1 201 477-1448 (USA)  +64 3 281-8065 (NZ)

<http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&sa=D&sntz=1&usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ>

*One Platform for Location Intelligence*

-- 


This email, and any attachments, is intended only for use by the 
addressee(s) named herein and may contain legally privileged and/or 
confidential information. It is the property of Telogis, Inc. If you are 
not the intended recipient of this email, you are hereby notified that any 
dissemination, distribution or copying of this email, any attachments 
thereto, and use of the information contained, is strictly prohibited. If 
you have received this email in error, please notify the sender and 
permanently delete the original and any copy thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9d40ee94/attachment.html>

From srinatsr at cisco.com  Thu May 29 00:29:34 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Wed, 28 May 2014 23:29:34 +0000
Subject: [rabbitmq-discuss] Consumer/Listerner disconnect once message
	published to queue
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>

Hello,

After publishing a message to queue, the consumer getting disconnected.

Following is the listerner configuration.

<bean
              class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
             <property name="connectionFactory" ref="connectionFactory" />
             <property name="queueNames">
                    <array>
                           <value>validateRequestQueue</value>
                    </array>
             </property>
             <property name="messageListener">
                    <bean
                           class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                           <property name="delegate" ref="validationListener" />
                    </bean>
             </property>
             <property name="adviceChain"
                    ref="statefulRetryOperationsInterceptorFactoryBean"></property>
             <property name="acknowledgeMode" value="NONE" />
       </bean>

Regards ...*
Srinath

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/cc548e23/attachment.html>

From srinatsr at cisco.com  Thu May 29 01:03:09 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 29 May 2014 00:03:09 +0000
Subject: [rabbitmq-discuss] FW: Retry Message for 3 times with 10
 seconds interval - in Consumer
In-Reply-To: <CADtU9_uSswJhGiejawdYf=dnhpte+9MM9aTMwOGKub0fvOnFfw@mail.gmail.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>
 <CADtU9_ty=2_D7Uz3QnvucTPxaS9o-XQNJwUw0uvaWNfePg87bw@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB1162F@xmb-aln-x10.cisco.com>
 <CADtU9_uSswJhGiejawdYf=dnhpte+9MM9aTMwOGKub0fvOnFfw@mail.gmail.com>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1CDB1@xmb-aln-x10.cisco.com>

Hi Gary,

My listener getting disconnected if any messages published to queue (which it is listening).

Following is the listerner configuration.

<bean
              class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
             <property name="connectionFactory" ref="connectionFactory" />
             <property name="queueNames">
                    <array>
                           <value>validateRequestQueue</value>
                    </array>
             </property>
             <property name="messageListener">
                    <bean
                           class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                           <property name="delegate" ref="validationListener" />
                    </bean>
             </property>
             <property name="adviceChain"
                    ref="statefulRetryOperationsInterceptorFactoryBean"></property>
             <property name="acknowledgeMode" value="NONE" />
       </bean>


Regards ??
Srinath

From: Gary Russell [mailto:grussell at gopivotal.com]
Sent: Wednesday, May 21, 2014 2:34 PM
To: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Subject: Re: FW: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

    <bean id="statefulRetryOperationsInterceptorFactoryBean"
        class="org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean">
        <property name="retryOperations" ref="retryTemplate" />
        <property name="messageRecoverer">
            <bean class="org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer">
        </property>
    </bean>

On Wed, May 21, 2014 at 4:46 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

I totally agree Gary.

But how to configure in xml ?  Here is my xml and designed as you described.

   <bean id="simpleRetryPolicy" class="org.springframework.retry.policy.SimpleRetryPolicy">
        <property name="maxAttempts" value="3" />
    </bean>
    <!-- <bean id="retryTemplate" class="org.springframework.retry.support.RetryTemplate">
        <property name="retryPolicy" ref="simpleRetryPolicy" />
    </bean> -->
    <bean id="statefulRetryOperationsInterceptorFactoryBean"
        class="org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean">
        <property name="retryOperations" ref="retryTemplate" />
        <property name="messageRecoverer"
    </bean>


       <bean id="retryTemplate" class="org.springframework.retry.support.RetryTemplate">
              <property name="retryPolicy" ref="simpleRetryPolicy" />
             <property name="backOffPolicy">
                    <bean class="org.springframework.retry.backoff.ExponentialBackOffPolicy">
                           <property name="initialInterval" value="10000" />
             <!--         <property name="multiplier" value="10.0" />
                           <property name="maxInterval" value="10000" /> -->
                    </bean>
             </property>
       </bean>
       <rabbit:template id="rabbitTemplate"
             connection-factory="connectionFactory" />
       <bean
              class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
             <property name="connectionFactory" ref="connectionFactory" />
             <property name="queueNames">
                    <array>
                           <value>validateRequestQueue</value>
                    </array>
             </property>
             <property name="messageListener">
                    <bean
                           class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                           <property name="delegate" ref="retryConsumer" />
                    </bean>
             </property>
             <property name="adviceChain" ref="statefulRetryOperationsInterceptorFactoryBean"></property>
             <!-- <property name="acknowledgeMode" value="NONE" /> -->
       </bean>

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Gary Russell
Sent: Wednesday, May 21, 2014 1:14 PM

To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

You did not configure a MessageRecoverer as I suggested; the default recoverer logs a WARN message and acks the message.

Add a RejectAndDontRequeueRecoverer and the rejected message will go to the DLE.

On Wed, May 21, 2014 at 2:14 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
After 3 times, I am getting the following exception.  But I don?t want this exception, directly the message should go to dead letter exchange.

I  have configured dlx as follows.

rabbitmqctl set_policy DLX ".*" '{"dead-letter-exchange":"my-dlx"}'


2014-05-21 11:10:37:870 -0700, [WARN] StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped on recovery: (Body:'[B at 3ed60d48(byte[163])'MessageProperties [headers={}, timestamp=null, messageId=1, userId=null, appId=null, clusterId=null, type=null, correlationId=null, replyTo=null, contentType=application/octet-stream, contentEncoding=null, contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0, redelivered=true, receivedExchange=, receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException: Listener threw exception
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(AbstractMessageListenerContainer.java:758)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:653)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:576)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(SimpleMessageListenerContainer.java:154)
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
       at java.lang.reflect.Method.invoke(Method.java:606)
       at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(StatefulRetryOperationsInterceptor.java:162)
       at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:263)
       at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:193)
       at org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(StatefulRetryOperationsInterceptor.java:137)
       at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
       at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
       at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(SimpleMessageListenerContainer.java:1113)
       at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:559)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:904)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:888)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(SimpleMessageListenerContainer.java:75)
       at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:989)
       at java.lang.Thread.run(Thread.java:724)

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Wednesday, May 21, 2014 11:00 AM

To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

It works perfect thank you so much ?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

To configure the retry advice in XML, you need to wire up a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can set it directly, or if you are using message conversion, set the createMessageIds to true on the outbound template's SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in using stateful retry.

On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:
Thanks  do you have xml version of the following?

I need to set message id before publishing the message?  How to do this?

Regards ??
Srinath

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Gary Russell
Sent: Tuesday, May 20, 2014 12:24 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer

@Bean
public MethodInterceptor retryAdvice() {
     FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
     backOffPolicy.setBackOffPeriod(10000);;
     return RetryInterceptorBuilder.stateful()
          .backOffPolicy(backOffPolicy)
          .maxAttempts(3)
          .recoverer(new RejectAndDontRequeueRecoverer())
          .build();
}

Add it to the adviceChain property of the SimpleMessageListenerContainer.

Note: stateful retry requires the message to have a message id; use a stateless advice otherwise.

After the retries are exhausted, the message will be rejected (and dropped or sent to a Dead Letter Exchange of so configured).


On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com<mailto:srinatsr at cisco.com>> wrote:

Hello,

I am consuming the messages using the listener as follows,  I need to retry processing three times if any exceptions occurred.

<bean
        class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer">
        <property name="connectionFactory" ref="connectionFactory" />
        <property name="queueNames">
            <array>
                <value>validateRequestQueue</value>
            </array>
        </property>
        <property name="messageListener">
            <bean
                class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
                <property name="delegate" ref="retryConsumer" />
            </bean>
        </property>
        <!-- <property name="acknowledgeMode" value="NONE" /> -->
    </bean>


public class RetryConsumer implements ChannelAwareMessageListener {

       /**
       * Callback for processing a received Rabbit message.
       * @param message the received AMQP message
       * @param channel the underlying Rabbit Channel
       * @throws Exception
        */
       @Override
       public void onMessage(Message message, Channel channel) throws Exception {

             System.out.println("Received Message :: "+new String(message.getBody()));
             if(true){
             throw new RuntimeException("Error");
             }

       }

Regards ??
Srinath

From: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
Sent: Monday, May 19, 2014 10:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Retry Message for 3 times with 10 seconds interval - in Consumer



Retry unacknowledged RabbitMQ message in 10 second interval

And Retry 3 times using Spring framework in java .



Please need help on this

Regards ??
Srinath


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/a560ed24/attachment.html>

From shilpa.karkera at finoux.com  Thu May 29 04:33:03 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Thu, 29 May 2014 09:03:03 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <53858376.8050307@finoux.com>
References: <53847890.1060005@finoux.com>
 <etPan.5384810c.6b8b4567.27f@mercurio.local> <538483F0.2070401@finoux.com>
 <etPan.53848542.643c9869.27f@mercurio.local> <538489CA.90608@finoux.com>
 <etPan.53848b4a.66334873.27f@mercurio.local> <53848D38.7020409@finoux.com>
 <etPan.53848db8.74b0dc51.27f@mercurio.local>
 <7E66A9BC-2D6E-4ECC-90E8-667719D3C163@rabbitmq.com>
 <53855B00.3000304@finoux.com> <53858376.8050307@finoux.com>
Message-ID: <5386AA6F.6040704@finoux.com>

Kindly look into the following issue. The threads are properly managed.

On Wednesday 28 May 2014 12:04 PM, shilpa karkera wrote:
> Okay, now I have reconfigured my entire code:
>
> Now each queue has its own channel. Thus when I open 3 browser tabs 
> for my application. It starts 3 threads each having its own channel.
> However, it still gives the same error.
>
>
> On Wednesday 28 May 2014 09:11 AM, shilpa karkera wrote:
>> Yep, got it! Thank you for the explanation. checking it out right away!
>>
>>
>> On Tuesday 27 May 2014 08:33 PM, Steve Powell wrote:
>>> What Michael meant to type is:
>>>
>>> On 27 May 2014, at 14:05, Michael Klishin <mklishin at gopivotal.com 
>>> <mailto:mklishin at gopivotal.com>> wrote:
>>>
>>>> Each thread
>>>> should have its own /*_channel_*/(e.g. open one right after it is 
>>>> started), then
>>>> you won't have this connection error. 
>>>
>>> Steve Powell [/Cell/: +44-7815-838-558]
>>> /    Good design/ [...]/is as little design as possible. /Dieter Rams
>>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/c62f661e/attachment.html>

From gavinmroy at gmail.com  Thu May 29 04:54:43 2014
From: gavinmroy at gmail.com (Gavin Roy)
Date: Wed, 28 May 2014 20:54:43 -0700 (PDT)
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <5386AA6F.6040704@finoux.com>
References: <5386AA6F.6040704@finoux.com>
Message-ID: <1401335682776.5a9cec81@Nodemailer>

Each thread needs its own connection, not channel.

On Wed, May 28, 2014 at 11:34 PM, shilpa karkera
<shilpa.karkera at finoux.com> wrote:

> Kindly look into the following issue. The threads are properly managed.
> On Wednesday 28 May 2014 12:04 PM, shilpa karkera wrote:
>> Okay, now I have reconfigured my entire code:
>>
>> Now each queue has its own channel. Thus when I open 3 browser tabs 
>> for my application. It starts 3 threads each having its own channel.
>> However, it still gives the same error.
>>
>>
>> On Wednesday 28 May 2014 09:11 AM, shilpa karkera wrote:
>>> Yep, got it! Thank you for the explanation. checking it out right away!
>>>
>>>
>>> On Tuesday 27 May 2014 08:33 PM, Steve Powell wrote:
>>>> What Michael meant to type is:
>>>>
>>>> On 27 May 2014, at 14:05, Michael Klishin <mklishin at gopivotal.com 
>>>> <mailto:mklishin at gopivotal.com>> wrote:
>>>>
>>>>> Each thread
>>>>> should have its own /*_channel_*/(e.g. open one right after it is 
>>>>> started), then
>>>>> you won't have this connection error. 
>>>>
>>>> Steve Powell [/Cell/: +44-7815-838-558]
>>>> /    Good design/ [...]/is as little design as possible. /Dieter Rams
>>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140528/476c76d2/attachment.html>

From rohitmukherjee26 at gmail.com  Thu May 29 04:58:22 2014
From: rohitmukherjee26 at gmail.com (Rohit Mukherjee)
Date: Thu, 29 May 2014 11:58:22 +0800
Subject: [rabbitmq-discuss] Error in Rabbitmq 3.3.1 and Node getting
	down frequently..
In-Reply-To: <CAKYxN6kEHhzweVKo0hAhC0YMLtB_8xmK6758_SSicucWjqOieQ@mail.gmail.com>
References: <CAKYxN6=P5p4_wV7aTxxv40FMbxq=T8YUTNMoWd4KF2+gfdAx6g@mail.gmail.com>
 <CAKYxN6kCuYFPvUZbVJWoq8dax=e2DVwDhToPwmoFutpBqUCY-g@mail.gmail.com>
 <CAKYxN6k7ukCn0GHnNpVkVHg-RM3daEvNJT=tLgN6RVV9G2hEHA@mail.gmail.com>
 <CAKYxN6kEHhzweVKo0hAhC0YMLtB_8xmK6758_SSicucWjqOieQ@mail.gmail.com>
Message-ID: <CAKYxN6kWFhXGKT5MwR3ViKwyGQfiGDNTCb1q3ebzVw+3mnkfYw@mail.gmail.com>

Someone Please help me to get rid of this occassionally a node getting
down, although rabbitmq service is running fine

-Rohit


On Wed, May 28, 2014 at 10:46 PM, Rohit Mukherjee <
rohitmukherjee26 at gmail.com> wrote:

> Please Note , We have Both Node Running in Same AZ in EC2, and observed
> Network Partition...
>
>
> On Wed, May 28, 2014 at 10:45 PM, Rohit Mukherjee <
> rohitmukherjee26 at gmail.com> wrote:
>
>> Full Error Report :
>>
>> =ERROR REPORT==== 28-May-2014::14:41:36 ===
>> ** Generic server <0.191.0> terminating
>> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
>> ',granted}
>> ** When Server state == undefined
>> ** Reason for termination ==
>> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>>
>> =ERROR REPORT==== 28-May-2014::14:41:36 ===
>> ** Generic server <0.194.0> terminating
>> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
>> ',granted}
>> ** When Server state == undefined
>> ** Reason for termination ==
>> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>>
>> =ERROR REPORT==== 28-May-2014::14:41:36 ===
>> ** Generic server <0.192.0> terminating
>> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
>>                         {not_granted,
>>                          {cyclic,'rabbit at vpc-prod-rabbitmq01',
>>                           {gm_group,
>>
>>  {resource,<<"/">>,queue,<<"impression_click_es">>}},
>>                           write,write,
>>                           {tid,1215,<7209.30767.61>}}}}
>> ** When Server state == undefined
>> ** Reason for termination ==
>> ** {unexpected_info,
>>        {mnesia_locker,'rabbit at vpc-prod-rabbitmq01',
>>            {not_granted,
>>                {cyclic,'rabbit at vpc-prod-rabbitmq01',
>>                    {gm_group,
>>
>>  {resource,<<"/">>,queue,<<"impression_click_es">>}},
>>                    write,write,
>>                    {tid,1215,<7209.30767.61>}}}}}
>>
>> =ERROR REPORT==== 28-May-2014::14:41:36 ===
>> ** Generic server <0.193.0> terminating
>> ** Last message in was {mnesia_locker,'rabbit at vpc-prod-rabbitmq01
>> ',granted}
>> ** When Server state == undefined
>> ** Reason for termination ==
>> ** {unexpected_info,{mnesia_locker,'rabbit at vpc-prod-rabbitmq01',granted}}
>>
>>
>>
>> On Wed, May 28, 2014 at 10:42 PM, Rohit Mukherjee <
>> rohitmukherjee26 at gmail.com> wrote:
>>
>>> Hi ALL,
>>>
>>> We are seeing node getting down and seeing 3 Similar Error Always..
>>>
>>> 1)
>>>  =ERROR REPORT==== 28-May-2014::14:31:49 ===
>>> AMQP connection <0.6576.0> (running), channel 0 - error:
>>> {amqp_error,connection_forced,
>>>             "broker forced connection closure with reason
>>> 'shutdown'",none}
>>>
>>> 2)
>>>
>>> [10:39:58 PM] rohit mukherjee: Mirrored queue 'req_resp_es' in vhost
>>> '/': Slave <rabbit at vpc-prod-rabbitmq02.1.256.0> saw deaths of mirrors
>>> <rabbit at vpc-prod-rabbitmq01.2.29560.57>
>>>
>>>
>>>  3)
>>>  =ERROR REPORT==== 28-May-2014::14:31:51 ===
>>> Mnesia('rabbit at vpc-prod-rabbitmq02'): ** ERROR ** mnesia_event got
>>> {inconsistent_database, starting_partitioned_network,
>>> 'rabbit at vpc-prod-rabbitmq01'}
>>>
>>> Please Suggest Solution for the same
>>>
>>> Regards,
>>> Rohit
>>>
>>>
>>> On Thu, May 22, 2014 at 6:40 PM, Rohit Mukherjee <
>>> rohitmukherjee26 at gmail.com> wrote:
>>>
>>>> HI Team,
>>>>
>>>>
>>>>
>>>> RabbitMQ nodes are getting shutdown automatically , Can you please
>>>> suggest how should I fix the issue ..Please find the Log Strace Below
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> =INFO REPORT==== 22-May-2014::09:43:12 ===
>>>>
>>>> Mirrored queue 'win_es' in vhost '/': Promoting slave
>>>> <rabbit at vpc-prod-rabbitmq02.1.10232.0> to master
>>>>
>>>>
>>>>
>>>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> Stopping RabbitMQ
>>>>
>>>>
>>>>
>>>> =INFO REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> stopped TCP Listener on [::]:5672
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10638.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10358.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10524.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10355.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10387.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10352.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10384.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10463.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10349.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10381.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10493.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =ERROR REPORT==== 22-May-2014::09:58:07 ===
>>>>
>>>> AMQP connection <0.10346.0> (running), channel 0 - error:
>>>>
>>>> {amqp_error,connection_forced,
>>>>
>>>>             "broker forced connection closure with reason
>>>> 'shutdown'",none}
>>>>
>>>>
>>>>
>>>> =INFO REPORT==== 22-May-2014::09:58:08 ===
>>>>
>>>> Halting Erlang VM
>>>>
>>>>
>>>>
>>>> =====
>>>> Regards,
>>>> Rohit Mukherjee
>>>>
>>>>
>>>
>>>
>>> --
>>> Regards,
>>> Rohit Mukherjee
>>>
>>>
>>
>>
>> --
>> Regards,
>> Rohit Mukherjee
>>
>>
>
>
> --
> Regards,
> Rohit Mukherjee
>
>


-- 
Regards,
Rohit Mukherjee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/ae1d5bf1/attachment.html>

From shilpa.karkera at finoux.com  Thu May 29 05:06:11 2014
From: shilpa.karkera at finoux.com (shilpa karkera)
Date: Thu, 29 May 2014 09:36:11 +0530
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <1401335682776.5a9cec81@Nodemailer>
References: <5386AA6F.6040704@finoux.com> <1401335682776.5a9cec81@Nodemailer>
Message-ID: <5386B233.1050408@finoux.com>

Yeh, But each runs in with its own channel. What I mean to say is, every 
thing is now independent of the elements in the other thread. So it 
should not  intertwine anything.


On Thursday 29 May 2014 09:24 AM, Gavin Roy wrote:
> Each thread needs its own connection, not channel.
>
> On Wed, May 28, 2014 at 11:34 PM, shilpa karkera 
> <shilpa.karkera at finoux.com <mailto:shilpa.karkera at finoux.com>> wrote:
>
>     Kindly look into the following issue. The threads are properly
>     managed.
>
>     On Wednesday 28 May 2014 12:04 PM, shilpa karkera wrote:
>>     Okay, now I have reconfigured my entire code:
>>
>>     Now each queue has its own channel. Thus when I open 3 browser
>>     tabs for my application. It starts 3 threads each having its own
>>     channel.
>>     However, it still gives the same error.
>>
>>
>>     On Wednesday 28 May 2014 09:11 AM, shilpa karkera wrote:
>>>     Yep, got it! Thank you for the explanation. checking it out
>>>     right away!
>>>
>>>
>>>     On Tuesday 27 May 2014 08:33 PM, Steve Powell wrote:
>>>>     What Michael meant to type is:
>>>>
>>>>     On 27 May 2014, at 14:05, Michael Klishin
>>>>     <mklishin at gopivotal.com <mailto:mklishin at gopivotal.com>> wrote:
>>>>
>>>>>     Each thread
>>>>>     should have its own /*_channel_*/(e.g. open one right after it
>>>>>     is started), then
>>>>>     you won't have this connection error. 
>>>>
>>>>     Steve Powell [/Cell/: +44-7815-838-558]
>>>>     /    Good design/ [...]/is as little design as possible.
>>>>     /Dieter Rams
>>>>
>>>
>>>
>>>
>>>     _______________________________________________
>>>     rabbitmq-discuss mailing list
>>>     rabbitmq-discuss at lists.rabbitmq.com
>>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/faf885c6/attachment.html>

From alan.antonuk at gmail.com  Thu May 29 05:10:17 2014
From: alan.antonuk at gmail.com (alan.antonuk at gmail.com)
Date: Thu, 29 May 2014 04:10:17 +0000
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification failed"
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
Message-ID: <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>

You need to provide both the certificate chain file and the private key
file (they're not the same file).

To debug this with the openssl s_client command, you'll need to pass in the
-verify, -key and -cert flags with appropriate values.

HTH
-Alan

On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com>
wrote:

> I?m just starting development on a c++ client app to connect to a vendor?s
> server.
>
>
>
> I?m trying the SimpleAmqpClient library which is built on top of
> rabbitmq-c.
>
>
>
> The provided a self-signed client certificate in .p12 format that I?ve
> converted to .pem. This contains a public and private key and also a CA
> public key.
>
>
>
> I?m now trying to connect while providing the .pem file as the CA cert,
> client cert and client private key.
>
>
>
> While connecting, I get:
>
> 'AmqpClient::AmqpLibraryException'
>
>   what():  Error setting client certificate for socket: SSL peer cert
> verification failed
>
>
>
> Digging into rabbitmq-c, I see this is due to the call to
> amqp_ssl_socket_set_key failing.
>
>
>
> Running openssl s_client seems to work fine, so I?m not sure what I?m
> doing wrong. Any ideas?
>
>
>
> -Dan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9ae301d8/attachment.html>

From mklishin at gopivotal.com  Thu May 29 07:06:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 10:06:16 +0400
Subject: [rabbitmq-discuss] |Spam| Question about management plugin and
 clustering
In-Reply-To: <CAHdxdCcYzwGm9UkjdWSNMuKuGcioY=gHMBDQ8b3eqQ7T=PvnXw@mail.gmail.com>
References: <CAHdxdCcYzwGm9UkjdWSNMuKuGcioY=gHMBDQ8b3eqQ7T=PvnXw@mail.gmail.com>
Message-ID: <etPan.5386ce72.6b8b4567.b19a@mercurio.local>

?On 29 May 2014 at 03:15:40, Daniel Bason (daniel.bason at telogis.com) wrote:
> > If we have a cluster already running and we enable the management  
> plugin on one node, do we have to restart the entire cluster to  
> gain access to the statistics or can we just restart the node that  
> we have enabled the plugin on?

Just 1 node, then connect to that node on port 15672 (by default).
--
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 29 07:06:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 10:06:50 +0400
Subject: [rabbitmq-discuss] Consumer/Listerner disconnect once message
 published to queue
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
Message-ID: <etPan.5386ce95.643c9869.b19a@mercurio.local>

?On 29 May 2014 at 03:30:54, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > After publishing a message to queue, the consumer getting disconnected.  

What is in RabbitMQ log?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 29 07:07:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 10:07:56 +0400
Subject: [rabbitmq-discuss] Consumer/Listerner disconnect once message
 published to queue
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
Message-ID: <etPan.5386ced6.74b0dc51.b19a@mercurio.local>

?On 29 May 2014 at 03:30:54, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > the consumer getting disconnected

To clarify: do you mean that AMQP 0-9-1 connection is closed? Or there are no more deliveries?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 29 07:09:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 10:09:37 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <1401335682776.5a9cec81@Nodemailer>
References: <5386AA6F.6040704@finoux.com> <1401335682776.5a9cec81@Nodemailer>
Message-ID: <etPan.5386cf3d.2ae8944a.b19a@mercurio.local>

On 29 May 2014 at 07:54:44, Gavin Roy (gavinmroy at gmail.com) wrote:
> > Each thread needs its own connection, not channel.

Just as a side note: with Pika, some clients lets you share connections
(but not channels).?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 29 07:11:32 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 10:11:32 +0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <5386B233.1050408@finoux.com>
References: <5386AA6F.6040704@finoux.com>
 <1401335682776.5a9cec81@Nodemailer> <5386B233.1050408@finoux.com>
Message-ID: <etPan.5386cfb2.625558ec.b19a@mercurio.local>

On 29 May 2014 at 08:07:26, shilpa karkera (shilpa.karkera at finoux.com) wrote:
> > Yeh, But each runs in with its own channel. What I mean to say is, 
> every thing is now independent of the elements in the other thread. 
> So it should not intertwine anything.

Gavin maintains Pika. He says that with Pika, you should not share connections
(unlike some other clients).
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Thu May 29 07:28:52 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 29 May 2014 07:28:52 +0100
Subject: [rabbitmq-discuss] |Spam| Question about management plugin and
 clustering
In-Reply-To: <etPan.5386ce72.6b8b4567.b19a@mercurio.local>
References: <CAHdxdCcYzwGm9UkjdWSNMuKuGcioY=gHMBDQ8b3eqQ7T=PvnXw@mail.gmail.com>
 <etPan.5386ce72.6b8b4567.b19a@mercurio.local>
Message-ID: <5386D3A4.6010604@rabbitmq.com>

On 29/05/14 07:06, Michael Klishin wrote:
>   On 29 May 2014 at 03:15:40, Daniel Bason (daniel.bason at telogis.com) wrote:
>>> If we have a cluster already running and we enable the management
>> plugin on one node, do we have to restart the entire cluster to
>> gain access to the statistics or can we just restart the node that
>> we have enabled the plugin on?
>
> Just 1 node, then connect to that node on port 15672 (by default).

But you also need the management-agent plugin enabled on all other nodes.

Matthias.

From simon at rabbitmq.com  Thu May 29 11:39:05 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 May 2014 11:39:05 +0100
Subject: [rabbitmq-discuss] Scaling to large number of bindings
In-Reply-To: <0031f377-5875-45fb-b722-36f83a394a9a@googlegroups.com>
References: <0031f377-5875-45fb-b722-36f83a394a9a@googlegroups.com>
Message-ID: <53870E49.4070309@rabbitmq.com>

On 27/05/14 22:17, Aaron Dufour wrote:
> On the other end, I would have an exchange on each outgoing server that
> the queues would bind to (a direct exchange - they are binding to exact
> routing keys).  However, when I federate this to the outgoing exchanges
> on the routing servers, every binding is stored on every routing server,
> which puts a hard ceiling on the number of bindings I can make.  Ideally
> the outgoing servers would only tell each routing server about the
> bindings it cares about (since each routing server is only dealing with
> a known subset of messages, based on routing keys), but I can't see a
> way to make this happen.

I am not sure I fully understand your explanation here, but: exchange 
federation will reproduce a binding on the upstream for every 
{exchange,routing key,arguments} combination on the downstream - i.e. it 
will only collapse bindings together if they are identical in everything 
but the destination.

The rationale for this is that it considers it more important that only 
messages which are known to be needed downstream get transmitted over 
the federation link than that the number of bindings in use be limited.

> Do I need something other than federation?

If you're trying not to transmit bindings upstream, then yes. You should 
be able to set up a very similar link (except without the automatic 
binding propagation) using the shovel.

> Am I thinking about the
> whole problem wrong?  I could use some help figuring out the right
> topology to allow the system to scale for the foreseeable future.

Your plan sounds reasonable assuming that you really do need to have 
hundreds of thousands of bindings around.

But since that number of bindings is awkward to deal with, it's really 
worth investigating whether that is true. Obviously I don't know why you 
need so many, but I can think of a couple of antipatterns that would 
lead to use of many bindings:

* Binding all possible routing keys with a fixed prefix / suffix 
instead of using wildcards (i.e. bind "a.b", "a.c", "a.d" etc instead of 
"a.*").

* Binding nearly all possible routing keys in order to exclude one and 
match everything else (investigate the alternate-exchange feature instead).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From real.recipient at hotmail.com  Thu May 29 12:24:44 2014
From: real.recipient at hotmail.com (Mailinglist Recipient)
Date: Thu, 29 May 2014 13:24:44 +0200
Subject: [rabbitmq-discuss] Mnesia for RMQ plugin
Message-ID: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>

Hello everybody,
I have a RabbitMQ plugin which does need to store data in Mnesia DB. The problem is all the data do not survive Rabbit's restart, tables are empty when Rabbit starts. I looked in mnesia tables with table viewer (tv) when Rabbit was up and running and the data were there but once Rabbit got down all tables got emptied including those which belong to RabbitMQ.
Is my observation correct? Is it an intentional behaviour? How can I let my data survive the restart? Thanks.

have a nice day
Marek

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/78f10b96/attachment.html>

From krasilnikov_ae at live.com  Thu May 29 13:38:52 2014
From: krasilnikov_ae at live.com (=?utf-8?B?0JDQu9C10LrRgdCw0L3QtNGAINCa0YDQsNGB0LjQu9GM0L3QuNC60L7Qsg==?=)
Date: Thu, 29 May 2014 16:38:52 +0400
Subject: [rabbitmq-discuss] nodedown during rotatelogs
Message-ID: <SNT404-EAS350D2321F8122C4FDF9920783240@phx.gbl>


Hello, I had rabbinq (v 3.2.1) running for quite some time without cleaning logs, once I noticed log file size I decided to run rotatelogs, during operation rabbit got stuck and now then I'm trying to run any command I'm getting following error : "unable to connect to node 'node name' : nodedown. What can I do in this situation? Any suggestions appreciated.
Thanks.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/e28a2797/attachment.html>

From mklishin at gopivotal.com  Thu May 29 13:56:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 16:56:09 +0400
Subject: [rabbitmq-discuss] nodedown during rotatelogs
In-Reply-To: <SNT404-EAS350D2321F8122C4FDF9920783240@phx.gbl>
References: <SNT404-EAS350D2321F8122C4FDF9920783240@phx.gbl>
Message-ID: <etPan.53872e83.6b8b4567.3998@mercurio.local>

On 29 May 2014 at 16:41:15, ????????? ???????????? (krasilnikov_ae at live.com) wrote:
> > What can I do in this situation? Any suggestions appreciated.  

Alexander,

Was there anything in RabbitMQ log files (regular and SASL) after you manually started the rotation?

You could kill the node process and restart it but it depends on whether
your apps use durable exchanges/queues/etc and publish messages as persistent.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From gavinmroy at gmail.com  Thu May 29 14:04:50 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Thu, 29 May 2014 09:04:50 -0400
Subject: [rabbitmq-discuss] CRITICAL:pika.connection:Attempted to send
 frame when closed
In-Reply-To: <etPan.5386cfb2.625558ec.b19a@mercurio.local>
References: <5386AA6F.6040704@finoux.com>
 <1401335682776.5a9cec81@Nodemailer> <5386B233.1050408@finoux.com>
 <etPan.5386cfb2.625558ec.b19a@mercurio.local>
Message-ID: <etPan.53873072.6b8b4567.a3cf@s826.ofc.lair>

To be clear, there are *no* threading constructs in pika. If you use threads, you must fully isolate everything pika related to each thread.

On May 29, 2014 at 2:12:51 AM, Michael Klishin (mklishin at gopivotal.com) wrote:

On 29 May 2014 at 08:07:26, shilpa karkera (shilpa.karkera at finoux.com) wrote: 
> > Yeh, But each runs in with its own channel. What I mean to say is, 
> every thing is now independent of the elements in the other thread. 
> So it should not intertwine anything. 

Gavin maintains Pika. He says that with Pika, you should not share connections 
(unlike some other clients). 
-- 
MK 

Software Engineer, Pivotal/RabbitMQ 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/0599af70/attachment.html>

From grussell at gopivotal.com  Thu May 29 15:48:03 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 29 May 2014 10:48:03 -0400
Subject: [rabbitmq-discuss] FW: Retry Message for 3 times with 10
 seconds interval - in Consumer
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1CDB1@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB10E23@xmb-aln-x10.cisco.com>
 <CADtU9_uQsrDSpWg8S_93SDfxoO+A5RH_x-c_MrQFgZsaOLEXKg@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB10ED5@xmb-aln-x10.cisco.com>
 <CADtU9_tAuBsv1YOyCsMHB8Q+8gPkaEtrNOnBKYp0A6gCbsRryA@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113A8@xmb-aln-x10.cisco.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB113ED@xmb-aln-x10.cisco.com>
 <CADtU9_ty=2_D7Uz3QnvucTPxaS9o-XQNJwUw0uvaWNfePg87bw@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB1162F@xmb-aln-x10.cisco.com>
 <CADtU9_uSswJhGiejawdYf=dnhpte+9MM9aTMwOGKub0fvOnFfw@mail.gmail.com>
 <1DB4F5481AB296448E8A5B5BC9D336541CB1CDB1@xmb-aln-x10.cisco.com>
Message-ID: <CADtU9_vfb6=X6S7DaOa3XfA0ePngPwoz45mFBOeB7APrje2M6Q@mail.gmail.com>

You need to provide much more information (logs, all configuration).

Please move this question to Stack Overflow (http://stackoverflow.com/)
using the 'spring-amqp' tag since your concerns are all about Spring AMQP
and not RabbitMQ itself.


On Wed, May 28, 2014 at 8:03 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:

>  Hi Gary,
>
>
>
> My listener getting disconnected if any messages published to queue (which
> it is listening).
>
>
>
> Following is the listerner configuration.
>
>
>
> <bean
>
>               class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>              <property name=*"connectionFactory"* ref=
> *"connectionFactory"* />
>
>              <property name=*"queueNames"*>
>
>                     <array>
>
>                            <value>validateRequestQueue</value>
>
>                     </array>
>
>              </property>
>
>              <property name=*"messageListener"*>
>
>                     <bean
>
>                            class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                            <property name=*"delegate"* ref=
> *"validationListener"* />
>
>                     </bean>
>
>              </property>
>
>              <property name=*"adviceChain"*
>
>                     ref=*"statefulRetryOperationsInterceptorFactoryBean"*
> ></property>
>
>              <property name=*"acknowledgeMode"* value=*"NONE"* />
>
>        </bean>
>
>
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* Gary Russell [mailto:grussell at gopivotal.com]
> *Sent:* Wednesday, May 21, 2014 2:34 PM
> *To:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
> *Subject:* Re: FW: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
>     <bean id=*"statefulRetryOperationsInterceptorFactoryBean"*
>
>         class=
> *"org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean"*
> >
>
>         <property name=*"retryOperations"* ref=*"retryTemplate"* />
>
>         <property name=*"messageRecoverer">*
>
>             <bean class=
> *"org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer">*
>
>         </property*>    *
>
>     </bean>
>
>
>
> On Wed, May 21, 2014 at 4:46 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
>
>
> I totally agree Gary.
>
>
>
> But how to configure in xml ?  Here is my xml and designed as you
> described.
>
>
>
>    <bean id=*"simpleRetryPolicy"* class=
> *"org.springframework.retry.policy.SimpleRetryPolicy"*>
>
>         <property name=*"maxAttempts"* value=*"3"* />
>
>     </bean>
>
>     <!-- <bean id="retryTemplate"
> class="org.springframework.retry.support.RetryTemplate">
>
>         <property name="retryPolicy" *ref*="simpleRetryPolicy" />
>
>     </bean> -->
>
>     <bean id=*"statefulRetryOperationsInterceptorFactoryBean"*
>
>         class=
> *"org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean"*
> >
>
>         <property name=*"retryOperations"* ref=*"retryTemplate"* />
>
>         <property name=*"messageRecoverer"*
>
>     </bean>
>
>
>
>
>
>        <bean id=*"retryTemplate"* class=
> *"org.springframework.retry.support.RetryTemplate"*>
>
>               <property name=*"retryPolicy"* ref=*"simpleRetryPolicy"* />
>
>              <property name=*"backOffPolicy"*>
>
>                     <bean class=
> *"org.springframework.retry.backoff.ExponentialBackOffPolicy"*>
>
>                            <property name=*"initialInterval"* value=
> *"10000"* />
>
>              <!--         <property name="multiplier" value="10.0" />
>
>                            <property name="maxInterval" value="10000" />
> -->
>
>                     </bean>
>
>              </property>
>
>        </bean>
>
>        <rabbit:template id=*"rabbitTemplate"*
>
>              connection-factory=*"connectionFactory"* />
>
>        <bean
>
>               class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>              <property name=*"connectionFactory"* ref=
> *"connectionFactory"* />
>
>              <property name=*"queueNames"*>
>
>                     <array>
>
>                            <value>validateRequestQueue</value>
>
>                     </array>
>
>              </property>
>
>              <property name=*"messageListener"*>
>
>                     <bean
>
>                            class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                            <property name=*"delegate"* ref=
> *"retryConsumer"* />
>
>                     </bean>
>
>              </property>
>
>              <property name=*"adviceChain"* ref=
> *"statefulRetryOperationsInterceptorFactoryBean"*></property>
>
>              <!-- <property name="acknowledgeMode" value="NONE" /> -->
>
>        </bean>
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Wednesday, May 21, 2014 1:14 PM
>
>
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> You did not configure a MessageRecoverer as I suggested; the default
> recoverer logs a WARN message and acks the message.
>
>
>
> Add a RejectAndDontRequeueRecoverer and the rejected message will go to
> the DLE.
>
>
>
> On Wed, May 21, 2014 at 2:14 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
> After 3 times, I am getting the following exception.  But I don?t want
> this exception, directly the message should go to dead letter exchange.
>
>
>
> I  have configured dlx as follows.
>
>
>
> rabbitmqctl set_policy DLX ".*" '{"dead-letter-exchange":"my-dlx"}'
>
>
>
>
>
> 2014-05-21 11:10:37:870 -0700, [WARN]
> StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped
> on recovery: (Body:'[B at 3ed60d48(byte[163])'MessageProperties [headers={},
> timestamp=null, messageId=1, userId=null, appId=null, clusterId=null,
> type=null, correlationId=null, replyTo=null,
> contentType=application/octet-stream, contentEncoding=null,
> contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0,
> redelivered=true, receivedExchange=,
> receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
>
> *org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException*:
> Listener threw exception
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(
> *AbstractMessageListenerContainer.java:758*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(
> *AbstractMessageListenerContainer.java:653*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(
> *AbstractMessageListenerContainer.java:576*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(
> *SimpleMessageListenerContainer.java:75*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(
> *SimpleMessageListenerContainer.java:154*)
>
>        at sun.reflect.NativeMethodAccessorImpl.invoke0(*Native Method*)
>
>        at sun.reflect.NativeMethodAccessorImpl.invoke(
> *NativeMethodAccessorImpl.java:57*)
>
>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(
> *DelegatingMethodAccessorImpl.java:43*)
>
>        at java.lang.reflect.Method.invoke(*Method.java:606*)
>
>        at
> org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(
> *AopUtils.java:317*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(
> *ReflectiveMethodInvocation.java:183*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
> *ReflectiveMethodInvocation.java:150*)
>
>        at
> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(
> *StatefulRetryOperationsInterceptor.java:162*)
>
>        at org.springframework.retry.support.RetryTemplate.doExecute(
> *RetryTemplate.java:263*)
>
>        at org.springframework.retry.support.RetryTemplate.execute(
> *RetryTemplate.java:193*)
>
>        at
> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(
> *StatefulRetryOperationsInterceptor.java:137*)
>
>        at
> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
> *ReflectiveMethodInvocation.java:172*)
>
>        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(
> *JdkDynamicAopProxy.java:204*)
>
>        at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(
> *SimpleMessageListenerContainer.java:1113*)
>
>        at
> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(
> *AbstractMessageListenerContainer.java:559*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(
> *SimpleMessageListenerContainer.java:904*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(
> *SimpleMessageListenerContainer.java:888*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(
> *SimpleMessageListenerContainer.java:75*)
>
>        at
> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(
> *SimpleMessageListenerContainer.java:989*)
>
>        at java.lang.Thread.run(*Thread.java:724*)
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Srinath
> Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
> *Sent:* Wednesday, May 21, 2014 11:00 AM
>
>
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> It works perfect thank you so much J
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [
> mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
> <rabbitmq-discuss-bounces at lists.rabbitmq.com>] *On Behalf Of *Gary Russell
> *Sent:* Tuesday, May 20, 2014 12:48 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> To configure the retry advice in XML, you need to wire up
> a StatefulRetryOperationsInterceptorFactoryBean.
>
>
>
> It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy
> and BackOffPolicy beans.
>
>
>
> Then wire the factory bean into the advice chain.
>
>
>
> To set the message id, it depends on how you are sending messages; you can
> set it directly, or if you are using message conversion, set
> the createMessageIds to true on the outbound template's
> SimpleMessageConverter.
>
>
>
> However, when using long backoffs like that, there's not much benefit in
> using stateful retry.
>
>
>
> On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
> Thanks  do you have xml version of the following?
>
>
>
> I need to set message id before publishing the message?  How to do this?
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Tuesday, May 20, 2014 12:24 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
> seconds interval - in Consumer
>
>
>
> @Bean
>
> public MethodInterceptor retryAdvice() {
>
>      FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
>
>      backOffPolicy.setBackOffPeriod(10000);;
>
>      return RetryInterceptorBuilder.stateful()
>
>           .backOffPolicy(backOffPolicy)
>
>           .maxAttempts(3)
>
>           .recoverer(new RejectAndDontRequeueRecoverer())
>
>           .build();
>
> }
>
>
>
> Add it to the adviceChain property of the SimpleMessageListenerContainer.
>
>
>
> Note: stateful retry requires the message to have a message id; use a
> stateless advice otherwise.
>
>
>
> After the retries are exhausted, the message will be rejected (and dropped
> or sent to a Dead Letter Exchange of so configured).
>
>
>
>
>
> On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
> TECHNOLOGIES INC at Cisco) <srinatsr at cisco.com> wrote:
>
>
>
> Hello,
>
>
>
> I am consuming the messages using the listener as follows,  I need to
> retry processing three times if any exceptions occurred.
>
>
>
> <bean
>
>         class=
> *"org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"*
> >
>
>         <property name=*"connectionFactory"* ref=*"connectionFactory"* />
>
>         <property name=*"queueNames"*>
>
>             <array>
>
>                 <value>validateRequestQueue</value>
>
>             </array>
>
>         </property>
>
>         <property name=*"messageListener"*>
>
>             <bean
>
>                 class=
> *"org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter"*
> >
>
>                 <property name=*"delegate"* ref=*"retryConsumer"* />
>
>             </bean>
>
>         </property>
>
>         <!-- <property name="acknowledgeMode" value="NONE" /> -->
>
>     </bean>
>
>
>
>
>
> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
>
>
>
>        /**
>
>        * Callback for processing a received Rabbit message.
>
>        * *@param* message the received AMQP message
>
>        * *@param* channel the underlying Rabbit Channel
>
>        * *@throws* Exception
>
>         */
>
>        @Override
>
>        *public* *void* onMessage(Message message, Channel channel)
> *throws* Exception {
>
>
>
>              System.*out*.println("Received Message :: "+*new*
> String(message.getBody()));
>
>              *if*(*true*){
>
>              *throw* *new* RuntimeException("Error");
>
>              }
>
>
>
>        }
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
> Cisco)
> *Sent:* Monday, May 19, 2014 10:47 AM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Retry Message for 3 times with 10 seconds interval - in
> Consumer
>
>
>
>
>
> Retry unacknowledged RabbitMQ message in 10 second interval
>
> And Retry 3 times using Spring framework in java .
>
>
>
> Please need help on this
>
>
>
> Regards ?*?*
>
> Srinath
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9a9b6a12/attachment.html>

From rtrlists at googlemail.com  Thu May 29 15:48:57 2014
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 29 May 2014 15:48:57 +0100
Subject: [rabbitmq-discuss] Mnesia for RMQ plugin
In-Reply-To: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>
References: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>
Message-ID: <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>

Hi Marek,

are you declaring your exchanges and queues as durable? Because only those
will survive a server restart.

Hope this helps,
Robby
 On May 29, 2014 12:25 PM, "Mailinglist Recipient" <
real.recipient at hotmail.com> wrote:

> Hello everybody,
> I have a RabbitMQ plugin which does need to store data in Mnesia DB. The
> problem is all the data do not survive Rabbit's restart, tables are empty
> when Rabbit starts. I looked in mnesia tables with table viewer (tv) when
> Rabbit was up and running and the data were there but once Rabbit got down
> all tables got emptied including those which belong to RabbitMQ.
> Is my observation correct? Is it an intentional behaviour? How can I let
> my data survive the restart? Thanks.
>
> have a nice day
> Marek
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/92a801e5/attachment.html>

From mklishin at gopivotal.com  Thu May 29 15:57:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 18:57:25 +0400
Subject: [rabbitmq-discuss] Mnesia for RMQ plugin
In-Reply-To: <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>
References: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>
 <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>
Message-ID: <etPan.53874aef.643c9869.5cc9@mercurio.local>

On 29 May 2014 at 18:51:20, Robert Raschke (rtrlists at googlemail.com) wrote:
> >
> are you declaring your exchanges and queues as durable? Because  
> only those will survive a server restart.

If all Mnesia content disappears it suggests the node is a RAM node.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From real.recipient at hotmail.com  Thu May 29 16:03:16 2014
From: real.recipient at hotmail.com (Mailinglist Recipient)
Date: Thu, 29 May 2014 17:03:16 +0200
Subject: [rabbitmq-discuss] Mnesia for RMQ plugin
In-Reply-To: <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>
References: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>,
 <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>
Message-ID: <DUB127-W73D1DFFBB399ACD769B34780240@phx.gbl>

Hi Robby,
thankyou for your answer. The thing is that the plugin creates its own tables which do not belong to rabbit's tables.

Anyway I did look into those RMQ tables and for example rabbit_vhost got emptied as well although virtual hosts don't need to be declared as durable to be persisted between restarts. The problem is probably somewhere else.

Marek

Date: Thu, 29 May 2014 15:48:57 +0100
From: rtrlists at googlemail.com
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mnesia for RMQ plugin

Hi Marek,

are you declaring your exchanges and queues as durable? Because only those will survive a server restart.

Hope this helps,

Robby



On May 29, 2014 12:25 PM, "Mailinglist Recipient" <real.recipient at hotmail.com> wrote:




Hello everybody,
I have a RabbitMQ plugin which does need to store data in Mnesia DB. The problem is all the data do not survive Rabbit's restart, tables are empty when Rabbit starts. I looked in mnesia tables with table viewer (tv) when Rabbit was up and running and the data were there but once Rabbit got down all tables got emptied including those which belong to RabbitMQ.

Is my observation correct? Is it an intentional behaviour? How can I let my data survive the restart? Thanks.

have a nice day
Marek

 		 	   		  

_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/099c1d51/attachment.html>

From simon at rabbitmq.com  Thu May 29 16:12:33 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 May 2014 16:12:33 +0100
Subject: [rabbitmq-discuss] Mnesia for RMQ plugin
In-Reply-To: <DUB127-W73D1DFFBB399ACD769B34780240@phx.gbl>
References: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>,
 <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>
 <DUB127-W73D1DFFBB399ACD769B34780240@phx.gbl>
Message-ID: <53874E61.9070800@rabbitmq.com>

On 29/05/14 16:03, Mailinglist Recipient wrote:
> Anyway I did look into those RMQ tables and for example rabbit_vhost got
> emptied as well although virtual hosts don't need to be declared as
> durable to be persisted between restarts. The problem is probably
> somewhere else.

Yeah, rabbit_vhost is definitely a disc table. Note that not all tables 
are on disc even on a cluster disc node - rabbit_durable_queue for 
example is a disc table, but rabbit_queue is always in RAM.

For your own tables, check that the disc_copies property gets set when 
adding the table. The default is for the table to be in RAM.

mnesia:table_info(TableName, disc_copies) will let you check.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dberger at fiveringscapital.com  Thu May 29 16:36:39 2014
From: dberger at fiveringscapital.com (Dan Berger)
Date: Thu, 29 May 2014 08:36:39 -0700
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification
 failed"
In-Reply-To: <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
Message-ID: <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>

I used openssl to extract the CA cert, the certificate chain and the private key into 3 separate file and now I?m running:

   openssl s_client -connect myhost.com:50010 -key test.key -cert test.crt -CAfile test.cac -verify 10

and I get ?Verify return code: 0 (ok)? which I think means success. I still get the same error when running my app with those 3 files.

Any other thoughts?


On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com wrote:

You need to provide both the certificate chain file and the private key file (they're not the same file).

To debug this with the openssl s_client command, you'll need to pass in the -verify, -key and -cert flags with appropriate values.

HTH
-Alan

On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
I?m just starting development on a c++ client app to connect to a vendor?s server.

I?m trying the SimpleAmqpClient library which is built on top of rabbitmq-c.

The provided a self-signed client certificate in .p12 format that I?ve converted to .pem. This contains a public and private key and also a CA public key.

I?m now trying to connect while providing the .pem file as the CA cert, client cert and client private key.

While connecting, I get:
'AmqpClient::AmqpLibraryException'
  what():  Error setting client certificate for socket: SSL peer cert verification failed

Digging into rabbitmq-c, I see this is due to the call to amqp_ssl_socket_set_key failing.

Running openssl s_client seems to work fine, so I?m not sure what I?m doing wrong. Any ideas?

-Dan
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/96408ef3/attachment.html>

From srinatsr at cisco.com  Thu May 29 18:18:58 2014
From: srinatsr at cisco.com (Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco))
Date: Thu, 29 May 2014 17:18:58 +0000
Subject: [rabbitmq-discuss] Consumer/Listerner disconnect once message
 published to queue
In-Reply-To: <etPan.5386ced6.74b0dc51.b19a@mercurio.local>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
 <etPan.5386ced6.74b0dc51.b19a@mercurio.local>
Message-ID: <1DB4F5481AB296448E8A5B5BC9D336541CB1D26F@xmb-aln-x10.cisco.com>


Hello Michael,

I am getting the following exception.

org.springframework.amqp.AmqpIOException: java.io.IOException
	at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(RabbitExceptionTranslator.java:63)
	at org.springframework.amqp.rabbit.connection.RabbitAccessor.convertRabbitAccessException(RabbitAccessor.java:112)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.doExecute(RabbitTemplate.java:841)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:820)
	at org.springframework.amqp.rabbit.core.RabbitAdmin.initialize(RabbitAdmin.java:391)
	at org.springframework.amqp.rabbit.core.RabbitAdmin$11.onCreate(RabbitAdmin.java:323)
	at org.springframework.amqp.rabbit.connection.CompositeConnectionListener.onCreate(CompositeConnectionListener.java:32)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:361)
	at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils$1.createConnection(ConnectionFactoryUtils.java:80)
	at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.doGetTransactionalResourceHolder(ConnectionFactoryUtils.java:130)
	at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.getTransactionalResourceHolder(ConnectionFactoryUtils.java:67)
	at org.springframework.amqp.rabbit.listener.BlockingQueueConsumer.start(BlockingQueueConsumer.java:363)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:963)
	at java.lang.Thread.run(Thread.java:724)
Caused by: java.io.IOException
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:124)
	at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:779)
	at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:61)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:536)
	at com.sun.proxy.$Proxy63.queueDeclare(Unknown Source)
	at org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:458)
	at org.springframework.amqp.rabbit.core.RabbitAdmin.access$200(RabbitAdmin.java:54)
	at org.springframework.amqp.rabbit.core.RabbitAdmin$12.doInRabbit(RabbitAdmin.java:395)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.doExecute(RabbitTemplate.java:835)
	... 11 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue 'validateRequestQueue.dev' in vhost '/': received none but current is the value '5000' of type 'long', class-id=50, method-id=10)
	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
	... 23 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue 'validateRequestQueue.dev' in vhost '/': received none but current is the value '5000' of type 'long', class-id=50, method-id=10)
	at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:478)
	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:315)
	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:550)
	... 1 more

Regards ??
Srinath


-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Wednesday, May 28, 2014 11:08 PM
To: Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco); Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Consumer/Listerner disconnect once message published to queue

?On 29 May 2014 at 03:30:54, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > the consumer getting disconnected

To clarify: do you mean that AMQP 0-9-1 connection is closed? Or there are no more deliveries?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu May 29 18:22:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 29 May 2014 21:22:20 +0400
Subject: [rabbitmq-discuss] Consumer/Listerner disconnect once message
 published to queue
In-Reply-To: <1DB4F5481AB296448E8A5B5BC9D336541CB1D26F@xmb-aln-x10.cisco.com>
References: <1DB4F5481AB296448E8A5B5BC9D336541CB1CD35@xmb-aln-x10.cisco.com>
 <etPan.5386ced6.74b0dc51.b19a@mercurio.local>
 <1DB4F5481AB296448E8A5B5BC9D336541CB1D26F@xmb-aln-x10.cisco.com>
Message-ID: <etPan.53876ce5.3d1b58ba.5cc9@mercurio.local>

On 29 May 2014 at 21:19:01, Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco) (srinatsr at cisco.com) wrote:
> > Caused by: com.rabbitmq.client.ShutdownSignalException:  
> channel error; protocol method: #method(reply-code=406,  
> reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for  
> queue 'validateRequestQueue.dev' in vhost '/': received none  
> but current is the value '5000' of type 'long', class-id=50,  
> method-id=10)

Srinath,

Above is the root cause. Please put some effort into investigating
issues on your own.?We've explained it to your several times before but I'll say it again: that the Rabbit team is tiny and physically cannot help you with every single exception you encounter.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From alan.antonuk at gmail.com  Thu May 29 19:44:04 2014
From: alan.antonuk at gmail.com (alan.antonuk at gmail.com)
Date: Thu, 29 May 2014 18:44:04 +0000
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification
	failed"
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>
Message-ID: <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>

Does your private key require a password to decrypt it? (rabbitmq-c doesn't
provide any hooks to unlock private keys).

-Alan
On Thu May 29 2014 at 8:42:12 AM, Dan Berger <dberger at fiveringscapital.com>
wrote:

> I used openssl to extract the CA cert, the certificate chain and the
> private key into 3 separate file and now I?m running:
>
>
>
>    openssl s_client -connect myhost.com:50010 -key test.key -cert
> test.crt -CAfile test.cac -verify 10
>
>
>
> and I get ?Verify return code: 0 (ok)? which I think means success. I
> still get the same error when running my app with those 3 files.
>
>
>
> Any other thoughts?
>
>
>
>
>
> On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com wrote:
>
>
>
> You need to provide both the certificate chain file and the private key
> file (they're not the same file).
>
>
>
> To debug this with the openssl s_client command, you'll need to pass in
> the -verify, -key and -cert flags with appropriate values.
>
>
>
> HTH
>
> -Alan
>
>
>
> On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> I?m just starting development on a c++ client app to connect to a vendor?s
> server.
>
>
>
> I?m trying the SimpleAmqpClient library which is built on top of
> rabbitmq-c.
>
>
>
> The provided a self-signed client certificate in .p12 format that I?ve
> converted to .pem. This contains a public and private key and also a CA
> public key.
>
>
>
> I?m now trying to connect while providing the .pem file as the CA cert,
> client cert and client private key.
>
>
>
> While connecting, I get:
>
> 'AmqpClient::AmqpLibraryException'
>
>   what():  Error setting client certificate for socket: SSL peer cert
> verification failed
>
>
>
> Digging into rabbitmq-c, I see this is due to the call to
> amqp_ssl_socket_set_key failing.
>
>
>
> Running openssl s_client seems to work fine, so I?m not sure what I?m
> doing wrong. Any ideas?
>
>
>
> -Dan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/58676969/attachment.html>

From dberger at fiveringscapital.com  Thu May 29 21:40:34 2014
From: dberger at fiveringscapital.com (Dan Berger)
Date: Thu, 29 May 2014 13:40:34 -0700
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert
	verification	failed"
In-Reply-To: <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>
Message-ID: <57A505A533615F418F154E57E6FE7B4DB5C5FBADC1@EXVMBX018-3.exch018.msoutlookonline.net>

The .p12 file I started with does require a password (which I provide to the java and c# clients). For rabbitmq-c I?ve converted the p12 to pem while removing the password and then broken the file down into the 3 components.

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of alan.antonuk at gmail.com
Sent: Thursday, May 29, 2014 2:44 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification failed"

Does your private key require a password to decrypt it? (rabbitmq-c doesn't provide any hooks to unlock private keys).

-Alan
On Thu May 29 2014 at 8:42:12 AM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
I used openssl to extract the CA cert, the certificate chain and the private key into 3 separate file and now I?m running:

   openssl s_client -connect myhost.com:50010<http://myhost.com:50010> -key test.key -cert test.crt -CAfile test.cac -verify 10

and I get ?Verify return code: 0 (ok)? which I think means success. I still get the same error when running my app with those 3 files.

Any other thoughts?


On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com> wrote:

You need to provide both the certificate chain file and the private key file (they're not the same file).

To debug this with the openssl s_client command, you'll need to pass in the -verify, -key and -cert flags with appropriate values.

HTH
-Alan

On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
I?m just starting development on a c++ client app to connect to a vendor?s server.

I?m trying the SimpleAmqpClient library which is built on top of rabbitmq-c.

The provided a self-signed client certificate in .p12 format that I?ve converted to .pem. This contains a public and private key and also a CA public key.

I?m now trying to connect while providing the .pem file as the CA cert, client cert and client private key.

While connecting, I get:
'AmqpClient::AmqpLibraryException'
  what():  Error setting client certificate for socket: SSL peer cert verification failed

Digging into rabbitmq-c, I see this is due to the call to amqp_ssl_socket_set_key failing.

Running openssl s_client seems to work fine, so I?m not sure what I?m doing wrong. Any ideas?

-Dan
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/a18326d6/attachment.html>

From bglenk at we-do-it.com  Thu May 29 23:26:11 2014
From: bglenk at we-do-it.com (Brendon Glenk)
Date: Thu, 29 May 2014 22:26:11 +0000
Subject: [rabbitmq-discuss] Elang and rabbit MQ upgrade - how do I now get
 my rabbit to eat the correct Erlang cookie?
Message-ID: <1401402369312.80146@we-do-it.com>

Hi Guys,


I installed Erlang R16B01 (otp_win32_R16B01.exe) last year on Windows Server 2008. Then installed rabbitmq-server-3.1.5.exe on top. Added the rabbitMQ management plugin and tweaked it a little bit by adding handle.exe. I made no other changes I can remember and it just all worked brilliantly. Thanks for a great package.


That was a good 3 months ago and it's been working flawlessly. I recently needed to upgrade and I've broken something.


Here's what's happened:


I installed using rabbitmq-server-3.3.1.exe? which correctly forced the removal of v3.1.5 first. Then I tried to add the management plugin and it said it was already there. Now the fun starts... no web management accessible.


Next I removed both Erlang and Rabbit and reinstalled otp_win64_17.0.exe (erl6.0) and then installed rabbit 3.3.1 on top. Still no joy with the web management so time for diagnostics.


Well, I first found out that for some reason HOMEDRIVE setting of z: crashed the service. That's fix by just setting home drive to c: reinstall rabbitMQ service and off we go... I thought. Well, not that easy. It's now changed the default port to 25672 (from 15672) and I can live with that, but I get a friendly page in chrome saying "no data received". Well, time to get a bit more hardcore...


So I went ot the shell and thought I'd reset the rabbitMQ and I get:


C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\sbin>rabbitmqctl reset
Resetting node 'rabbit at SW-PROCESS' ...
Error: unable to connect to node 'rabbit at SW-PROCESS': nodedown

DIAGNOSTICS
===========

attempted to contact: ['rabbit at SW-PROCESS']

rabbit at SW-PROCESS:
  * connected to epmd (port 4369) on SW-PROCESS
  * epmd reports node 'rabbit' running on port 25672
  * TCP connection succeeded but Erlang distribution failed
  * suggestion: hostname mismatch?
  * suggestion: is the cookie set correctly?

current node details:
- node name: 'rabbitmqctl3108369 at SW-PROCESS'
- home dir: Z:\
- cookie hash: BgIviugom+F/F3cai8uQ0Q==


C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\sbin>

I  believe the hostname is fine, so how do I now get my rabbit to eat the correct Erlang cookie?


Kind regards,

Brendon Glenk

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/cf4ae0a9/attachment.html>

From meghna.a.sapre at intel.com  Fri May 30 02:02:24 2014
From: meghna.a.sapre at intel.com (Sapre, Meghna A)
Date: Fri, 30 May 2014 01:02:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ with Python 3.3
Message-ID: <A344CE58FAE9CD4A9015D1BD5A3F4B3741CC021D@FMSMSX105.amr.corp.intel.com>

Hi,
  Does anyone have a suggestion for a library to use with Python3? I am using pika-python3, but it disconnects and reconnects with every message published.
Is there a workaround, or a more robust alternative?

Thanks,
Meghna
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/2cfa96b7/attachment.html>

From gavinmroy at gmail.com  Fri May 30 04:14:17 2014
From: gavinmroy at gmail.com (Gavin Roy)
Date: Thu, 29 May 2014 20:14:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ with Python 3.3
In-Reply-To: <A344CE58FAE9CD4A9015D1BD5A3F4B3741CC021D@FMSMSX105.amr.corp.intel.com>
References: <A344CE58FAE9CD4A9015D1BD5A3F4B3741CC021D@FMSMSX105.amr.corp.intel.com>
Message-ID: <1401419657090.bbc7fa93@Nodemailer>

Check out rabbitpy :)

On Thu, May 29, 2014 at 9:03 PM, Sapre, Meghna A <meghna.a.sapre at intel.com>
wrote:

> Hi,
>   Does anyone have a suggestion for a library to use with Python3? I am using pika-python3, but it disconnects and reconnects with every message published.
> Is there a workaround, or a more robust alternative?
> Thanks,
> Meghna
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/e69f1f0f/attachment.html>

From alan.antonuk at gmail.com  Fri May 30 06:00:30 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 30 May 2014 05:00:30 +0000
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification
	failed"
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBADC1@EXVMBX018-3.exch018.msoutlookonline.net>
Message-ID: <CAAt2po+m=TncPj=SgaixfCFckZuqSP0Wp1mJUry0V=_h=uaDhA@mail.gmail.com>

Hmm.  Do you get any other information when you try running one of the
amqps_* example programs that can be built with rabbitmq-c?

-Alan

On Thu May 29 2014 at 1:41:06 PM, Dan Berger <dberger at fiveringscapital.com>
wrote:

> The .p12 file I started with does require a password (which I provide to
> the java and c# clients). For rabbitmq-c I?ve converted the p12 to pem
> while removing the password and then broken the file down into the 3
> components.
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *
> alan.antonuk at gmail.com
> *Sent:* Thursday, May 29, 2014 2:44 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert
> verification failed"
>
>
>
> Does your private key require a password to decrypt it? (rabbitmq-c
> doesn't provide any hooks to unlock private keys).
>
> -Alan
>
> On Thu May 29 2014 at 8:42:12 AM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> I used openssl to extract the CA cert, the certificate chain and the
> private key into 3 separate file and now I?m running:
>
>
>
>    openssl s_client -connect myhost.com:50010 -key test.key -cert
> test.crt -CAfile test.cac -verify 10
>
>
>
> and I get ?Verify return code: 0 (ok)? which I think means success. I
> still get the same error when running my app with those 3 files.
>
>
>
> Any other thoughts?
>
>
>
>
>
> On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com wrote:
>
>
>
> You need to provide both the certificate chain file and the private key
> file (they're not the same file).
>
>
>
> To debug this with the openssl s_client command, you'll need to pass in
> the -verify, -key and -cert flags with appropriate values.
>
>
>
> HTH
>
> -Alan
>
>
>
> On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> I?m just starting development on a c++ client app to connect to a vendor?s
> server.
>
>
>
> I?m trying the SimpleAmqpClient library which is built on top of
> rabbitmq-c.
>
>
>
> The provided a self-signed client certificate in .p12 format that I?ve
> converted to .pem. This contains a public and private key and also a CA
> public key.
>
>
>
> I?m now trying to connect while providing the .pem file as the CA cert,
> client cert and client private key.
>
>
>
> While connecting, I get:
>
> 'AmqpClient::AmqpLibraryException'
>
>   what():  Error setting client certificate for socket: SSL peer cert
> verification failed
>
>
>
> Digging into rabbitmq-c, I see this is due to the call to
> amqp_ssl_socket_set_key failing.
>
>
>
> Running openssl s_client seems to work fine, so I?m not sure what I?m
> doing wrong. Any ideas?
>
>
>
> -Dan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/1d8effb7/attachment.html>

From real.recipient at hotmail.com  Fri May 30 07:45:52 2014
From: real.recipient at hotmail.com (Mailinglist Recipient)
Date: Fri, 30 May 2014 08:45:52 +0200
Subject: [rabbitmq-discuss] FW:  Mnesia for RMQ plugin
In-Reply-To: <DUB127-W603A6BCD8CE092F831DF3480270@phx.gbl>
References: <DUB127-W3650EDF2B8E047EEAD8BD380240@phx.gbl>, ,
 <CAH+xwdBdcT6z+ipC28drY8=GQ__NcN8nMveE5ftvKhtUr-1r1A@mail.gmail.com>,
 <DUB127-W73D1DFFBB399ACD769B34780240@phx.gbl>, <53874E61.9070800@rabbitmq.com>,
 <DUB127-W603A6BCD8CE092F831DF3480270@phx.gbl>
Message-ID: <DUB127-W9455FBC8D2EAF3C2C6938880270@phx.gbl>


Hi,
the problem was as you wrote with he default behaviour of create_table/2. As I created them long time ago they were ram only. I added disc_copies property later but it had no meaning since all of them were already created ram only. Thanks a lot.

Regards
Marek

> Date: Thu, 29 May 2014 16:12:33 +0100
> From: simon at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com; real.recipient at hotmail.com
> Subject: Re: [rabbitmq-discuss] Mnesia for RMQ plugin
> 
> On 29/05/14 16:03, Mailinglist Recipient wrote:
> > Anyway I did look into those RMQ tables and for example rabbit_vhost got
> > emptied as well although virtual hosts don't need to be declared as
> > durable to be persisted between restarts. The problem is probably
> > somewhere else.
> 
> Yeah, rabbit_vhost is definitely a disc table. Note that not all tables 
> are on disc even on a cluster disc node - rabbit_durable_queue for 
> example is a disc table, but rabbit_queue is always in RAM.
> 
> For your own tables, check that the disc_copies property gets set when 
> adding the table. The default is for the table to be in RAM.
> 
> mnesia:table_info(TableName, disc_copies) will let you check.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
 		 	   		   		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/4abfc609/attachment.html>

From mklishin at gopivotal.com  Fri May 30 08:20:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 30 May 2014 11:20:50 +0400
Subject: [rabbitmq-discuss] Elang and rabbit MQ upgrade - how do I now
 get my rabbit to eat the correct Erlang cookie?
In-Reply-To: <1401402369312.80146@we-do-it.com>
References: <1401402369312.80146@we-do-it.com>
Message-ID: <etPan.53883170.327b23c6.105d8@mercurio.local>

?On 30 May 2014 at 02:27:35, Brendon Glenk (bglenk at we-do-it.com) wrote:
> >
> Well, I first found out that for some reason HOMEDRIVE setting  
> of z: crashed the service. That's fix by just setting home drive  
> to c: reinstall rabbitMQ service and off we go... I thought. Well,  
> not that easy. It's now changed the default port to 25672 (from  
> 15672) and I can live with that, but I get a friendly page in chrome  
> saying "no data received". Well, time to get a bit more hardcore...  
>  
> So I went ot the shell and thought I'd reset the rabbitMQ and I get:  
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.3.1\sbin>rabbitmqctl  
> reset
> Resetting node 'rabbit at SW-PROCESS' ...
> Error: unable to connect to node 'rabbit at SW-PROCESS': nodedown  

We recently updated the Erlang Cookie section on
http://www.rabbitmq.com/clustering.html for Windows.

Please take a look.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From muhmud.ahmad at googlemail.com  Thu May 29 13:14:13 2014
From: muhmud.ahmad at googlemail.com (Muhmud Ahmad)
Date: Thu, 29 May 2014 05:14:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Acking a message on a different channel from
	which it was received
Message-ID: <f04e3901-35c1-4298-ac0e-ca6e8a9726dd@googlegroups.com>

Hi,

I tried this out in the past, with version 3.2 (Java) client & server, and 
got random exceptions from the client when I did this.

Is there a plan to allow for this to be possible? Would be really used in 
pipeline processing environments.


Thanks,


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/f4eeca0a/attachment.html>

From mail2fei at gmail.com  Fri May 30 03:19:32 2014
From: mail2fei at gmail.com (Fei Yao)
Date: Thu, 29 May 2014 19:19:32 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq on EC2 using user-data
Message-ID: <77a9b857-85e8-4c6c-a9d4-cb635758bf8a@googlegroups.com>

Hi,
I'm using the following link for the provisioning on EC2: 
http://www.rabbitmq.com/ec2.html . I've made some modification to allow 
rabbitmq_management plugin as below. Everything works fine, but the 
"/usr/sbin/rabbitmq-plugins enable rabbitmq_management". I don't see any 
error either. I've checked log file under /var/log/rabbitmq/. That line 
seems to be never run. Please help.

#!/bin/sh
cat <<EOF > /etc/apt/sources.list.d/rabbitmq.list
deb http://www.rabbitmq.com/debian/ testing main
EOF

curl http://www.rabbitmq.com/rabbitmq-signing-key-public.asc -o 
/tmp/rabbitmq-signing-key-public.asc
apt-key add /tmp/rabbitmq-signing-key-public.asc
rm /tmp/rabbitmq-signing-key-public.asc

apt-get -qy update
apt-get -qy install rabbitmq-server

cat <<EOF > /etc/default/rabbitmq-server
ulimit -n 1024
EOF

cat <<EOF > /etc/rabbitmq/rabbitmq.config
[
  {rabbit, [
    {cluster_partition_handling, "pause_minority"}
  ]}
].
EOF

/usr/sbin/rabbitmq-plugins enable rabbitmq_management
/usr/sbin/rabbitmqctl add_user rabbit bunny
/usr/sbin/rabbitmqctl set_user_tags rabbit administrator
service rabbitmq-server restart
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9d182d66/attachment.html>

From mail2fei at gmail.com  Fri May 30 03:24:01 2014
From: mail2fei at gmail.com (Fei Yao)
Date: Thu, 29 May 2014 19:24:01 -0700 (PDT)
Subject: [rabbitmq-discuss] clustering on google app engine
In-Reply-To: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
References: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
Message-ID: <0ca8b9f3-d8de-447d-b441-d30d49cc21c1@googlegroups.com>

Richard,
I'm not an expert on GCE. But if there are in the same zone it will not be 
considered WAN. We had some experience in AWS, if it's Multi-AZ it will be 
considered WAN, and we've experience 3 network partitions last year.

Best Regards

On Tuesday, May 6, 2014 9:46:39 AM UTC-4, Richard Tier wrote:
>
> The docs <https://www.rabbitmq.com/clustering.html> on clustering state 
> that "clustering does not tolerate network partitions well", and states to 
> avoid clustering on WAN.
>
> I'm using Google Cloud Engine instances - all of which are in the same 
> zone.
>
> Should this setup be considered a WAN?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/b67848bd/attachment.html>

From mail2fei at gmail.com  Fri May 30 03:31:05 2014
From: mail2fei at gmail.com (Fei Yao)
Date: Thu, 29 May 2014 19:31:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>
References: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>
Message-ID: <bc35cc82-3d25-4b6e-81e6-878f3b17462b@googlegroups.com>

Or, you can enable "pause_minority" feature.

Best Regards 

On Thursday, March 20, 2014 5:41:22 AM UTC-4, Geoffrey Samper wrote:
>
> Hi, 
>
>
> We have a cluster with 3 nodes (Rabbit 1, Rabbit 3, rabbit 4). Sometimes 
> we have problems of network partitioning. Over the day everything runs fine 
> but at night 3AM and 4AM arround we expierence network partitioning. Most 
> of the time between 3 and 1. What strange is the log of rabbit 1 is 
> contains  "Generic server <0.263.0> terminating in the log". 
>
> Can anyone help me with this issue. The logs are below
>
>
> RABBIT 04
>
> ===========
>
> INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.PageDeletedConsumer' in vhost 'A105'): Master 
> <rabbit at P04.1.264.0> saw deaths of mirrors <rabbit at P01.3.264.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p14' in vhost 'A105'): Master 
> <rabbit at P04.1.262.0> saw deaths of mirrors <rabbit at P01.3.262.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.MNT_grbhstmntp01' in vhost 'A105'): Master 
> <rabbit at P04.1.292.0> saw deaths of mirrors <rabbit at P01.3.292.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p05' in vhost 'A105'): Slave 
> <rabbit at P04.1.24486.0> saw deaths of mirrors <rabbit at P01.3.30101.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p09' in vhost 'A105'): Master 
> <rabbit at P04.1.24669.0> saw deaths of mirrors <rabbit at P01.3.30387.0>
>
> Rabbit 03
> =====================
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> rabbit on node rabbit at P01 down
>
> =ERROR REPORT==== 20-Mar-2014::03:41:27 ===
> Mnesia(rabbit at P03): ** ERROR ** mnesia_event got {inconsistent_database, 
> running_partitioned_network, rabbit at P01}
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p21' in vhost 'A105'): Slave 
> <rabbit at P03.2.278.0> saw deaths of mirrors <rabbit at P01.3.275.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p22' in vhost 'A105'): Slave 
> <rabbit at P03.2.270.0> saw deaths of mirrors <rabbit at P01.3.268.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
>
> Mirrored-queue (queue 'ha.PageDeletedConsumer' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.276.0> saw deaths of mirrors <rabbit at P01.3.274.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p04' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.274.0> saw deaths of mirrors <rabbit at P01.3.271.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.MNT_grbhstmntp02' in vhost 'A105'): Slave 
> <rabbit at P03.2.282.0> saw deaths of mirrors <rabbit at P01.3.280.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p03' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.280.0> saw deaths of mirrors <rabbit at P01.3.278.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.MNT_grbhstmntp01' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.286.0> saw deaths of mirrors <rabbit at P01.3.284.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.services_p20' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.272.0> saw deaths of mirrors <rabbit at P01.3.270.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:27 ===
> Mirrored-queue (queue 'ha.PageDeleteConsumer' in vhost 'A105.001'): Slave 
> <rabbit at P03.2.284.0> saw deaths of mirrors <rabbit at P01.3.282.0>
>
> Rabbit 01
> ===================================
>
> =INFO REPORT==== 20-Mar-2014::03:41:14 ===
> rabbit on node rabbit at P03 down
>
> =ERROR REPORT==== 20-Mar-2014::03:41:15 ===
> Mnesia(rabbit at P01): ** ERROR ** mnesia_event got {inconsistent_database, 
> running_partitioned_network, rabbit at P03}
>
>
> =ERROR REPORT==== 20-Mar-2014::03:41:15 ===
>
> ** Generic server <0.263.0> terminating
>
> ** Last message in was {'DOWN',#Ref<0.0.0.1692>,process,<4625.265.0>,
>
>                                noconnection}
>
> ** When Server state == {state,
>
>                             {31,<0.263.0>},
>
>                             {{28,<4625.265.0>},#Ref<0.0.0.1692>},
>
>                             {{25,<5158.263.0>},#Ref<0.0.0.1693>},
>
>                             {resource,<<"A105">>,queue,
>
>                                 <<"ha.services_p14">>},
>
>                             rabbit_mirror_queue_slave,
>
>                             {32,
>
>                              [{{25,<5158.263.0>},
>
>                                {view_member,
>
>                                    {25,<5158.263.0>},
>
>                                    [],
>
>                                    {31,<0.263.0>},
>
>                                    {28,<4625.265.0>}}},
>
>                               {{28,<4625.265.0>},
>
>                                {view_member,
>
>                                    {28,<4625.265.0>},
>
>                                    [],
>
>                                    {25,<5158.263.0>},
>
>                                    {31,<0.263.0>}}},
>
>                               {{31,<0.263.0>},
>
>                                {view_member,
>
>                                    {31,<0.263.0>},
>
>                                    [],
>
>                                    {28,<4625.265.0>},
>
>                                    {25,<5158.263.0>}}}]},
>
>                             0,
>
>                             [{{25,<5158.263.0>},{member,{[],[]},6,6}},
>
>                              {{28,<4625.265.0>},{member,{[],[]},1,1}},
>
>                              {{31,<0.263.0>},{member,{[],[]},0,0}}],
>
>                             [<0.262.0>],
>
>                             {[],[]},
>
>                             [],0,undefined,
>
>                             #Fun<rabbit_misc.execute_mnesia_transaction.1>}
>
> ** Reason for termination == 
>
> ** {function_clause,[{orddict,fetch,
>
>                               [{31,<0.263.0>},[]],
>
>                               [{file,"orddict.erl"},{line,72}]},
>
>                      {gm,check_neighbours,1,[]},
>
>                      {gm,handle_info,2,[]},
>
>                      {gen_server2,handle_msg,2,[]},
>
>                     
>  {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
> =INFO REPORT==== 20-Mar-2014::03:41:15 ===
>
> Mirrored-queue (queue 'ha.MNT_Pages_grbhstmntp01' in vhost 'A105'): Slave 
> <rabbit at P01.3.289.0> saw deaths of mirrors <rabbit at P01.3.289.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:15 ===
> Mirrored-queue (queue 'ha.services_p17' in vhost 'A105'): Slave 
> <rabbit at P01.3.266.0> saw deaths of mirrors <rabbit at P03.2.268.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:15 ===
> Mirrored-queue (queue 'ha.services_p06' in vhost 'A105'): Slave 
> <rabbit at P01.3.30366.0> saw deaths of mirrors <rabbit at P03.2.21958.0>
>
> =INFO REPORT==== 20-Mar-2014::03:41:15 ===
> Mirrored-queue (queue 'ha.services_p06' in vhost 'A105'): Promoting slave 
> <rabbit at P01.3.30366.0> to master
>
> =INFO REPORT==== 20-Mar-2014::03:41:16 ===
> Mirrored-queue (queue 'ha.ElasticSearchConsumer' in vhost 'A105.001'): 
> Slave <rabbit at P01.3.286.0> saw deaths of mirrors <rabbit at P03.2.288.0> 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/736a9ed5/attachment.html>

From alexelement01 at gmail.com  Fri May 30 05:34:08 2014
From: alexelement01 at gmail.com (ale)
Date: Thu, 29 May 2014 21:34:08 -0700
Subject: [rabbitmq-discuss] rabbitmq erlang amqp_client question.
Message-ID: <DF4A5C62-2512-4BFE-ACA2-3489A52787D4@gmail.com>

Hi,

I?m implementing a basic consumer in erlang using the amqp_gen_consumer behavior from the official amqp_client.

connection code:

    {ok, Connection} = amqp_connection:start(Params),
    {ok, Channel} = amqp_connection:open_channel(Connection),
    {ok, {Connection, Channel}};

subscription code:

#?basic.consume_ok'{consumer_tag=Tag} = amqp_channel:call(ChannelPid, Sub),

All that is working fine but hen I publish messages to the queue I would expect to receive messages via the [handle_deliver] callback but instead I?m receiving messages trough [handle_info].

amqp_gen_consumer  trace : https://gist.github.com/alex-ethier/79861a846148a421f419

Any ideas why I?m not receiving anything at handle_deliver

Would anyone have code example of a working amqp_gen_consumer that I can look at?

Thank you so much!!!

Alex



From mklishin at gopivotal.com  Fri May 30 09:47:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 30 May 2014 12:47:14 +0400
Subject: [rabbitmq-discuss] Acking a message on a different channel from
 which it was received
In-Reply-To: <f04e3901-35c1-4298-ac0e-ca6e8a9726dd@googlegroups.com>
References: <f04e3901-35c1-4298-ac0e-ca6e8a9726dd@googlegroups.com>
Message-ID: <etPan.538845b0.66334873.105d8@mercurio.local>

On 30 May 2014 at 12:45:47, Muhmud Ahmad (muhmud.ahmad at googlemail.com) wrote:
> > I tried this out in the past, with version 3.2 (Java) client & 
> server, and got random exceptions from the client when I did this. 
> 
> Is there a plan to allow for this to be possible? Would be really 
> used in pipeline processing environments.

No. Delivery tags are scoped per channel.
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri May 30 09:51:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 30 May 2014 12:51:24 +0400
Subject: [rabbitmq-discuss] rabbitmq on EC2 using user-data
In-Reply-To: <77a9b857-85e8-4c6c-a9d4-cb635758bf8a@googlegroups.com>
References: <77a9b857-85e8-4c6c-a9d4-cb635758bf8a@googlegroups.com>
Message-ID: <etPan.538846a9.19495cff.105d8@mercurio.local>

?On 30 May 2014 at 12:47:50, Fei Yao (mail2fei at gmail.com) wrote:
> > apt-get -qy update
> apt-get -qy install rabbitmq-server
>  
> cat < /etc/default/rabbitmq-server
> ulimit -n 1024
> EOF
>  
> cat < /etc/rabbitmq/rabbitmq.config
> [
> {rabbit, [
> {cluster_partition_handling, "pause_minority"}
> ]}
> ].
> EOF

You install the package and modify config files.
Do you restart rabbitmq-server after that?

Also, it may be worth using the Chef cookbook or Puppet module,
both of which support provisioning Rabbit with plugins.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri May 30 09:59:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 30 May 2014 12:59:00 +0400
Subject: [rabbitmq-discuss] rabbitmq on EC2 using user-data
In-Reply-To: <etPan.538846a9.19495cff.105d8@mercurio.local>
References: <77a9b857-85e8-4c6c-a9d4-cb635758bf8a@googlegroups.com>
 <etPan.538846a9.19495cff.105d8@mercurio.local>
Message-ID: <etPan.53884872.625558ec.105d8@mercurio.local>



On 30 May 2014 at 12:56:30, Michael Klishin (mklishin at gopivotal.com) wrote:
> > You install the package and modify config files.
> Do you restart rabbitmq-server after that?

Nevermind, I've missed?service rabbitmq-server restart at the very end.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri May 30 10:51:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 May 2014 10:51:01 +0100
Subject: [rabbitmq-discuss] rabbitmq_web_stomp plugin
In-Reply-To: <CABJf-EstUbVVhg86WEyASACeq7i-U40pf6bfjefP-huUEy9Kbw@mail.gmail.com>
References: <86cdf13e-24d4-436d-ae24-4310da76e196@googlegroups.com>	<5375E408.2060305@rabbitmq.com>	<5375E4A6.40101@rabbitmq.com>	<CABJf-EsxjnWOXmPA4zP5AopT4xSEmBC23sqVaOis6==B6vie6A@mail.gmail.com>
 <CABJf-EstUbVVhg86WEyASACeq7i-U40pf6bfjefP-huUEy9Kbw@mail.gmail.com>
Message-ID: <53885485.2000906@rabbitmq.com>

The only fix that I'm aware of that lets you keep using the web_stomp 
plugin is to uninstall the erlang-cowboy package. If you need Cowboy for 
non-RabbitMQ reasons, install it from source. Sorry, but that package 
really is at fault here.

Cheers, Simon

On 29/05/2014 8:23PM, Ben Watson wrote:
> Do you have a recommendation for how I can "fix" this so I can keep the
> latest greatest versions of Ubuntu and RabbitMQ server?
>
>
> On Fri, May 16, 2014 at 5:04 PM, Ben Watson <bwatson1979 at gmail.com
> <mailto:bwatson1979 at gmail.com>> wrote:
>
>     Yeah I didn't do anything crazy.  I used the *.deb from RabbitMQ.com
>     and let apt-handle all of the dependencies.  Is there a better
>     source for Cowboy?
>
>     Ben
>
>
>     On Fri, May 16, 2014 at 5:12 AM, Simon MacMullen <simon at rabbitmq.com
>     <mailto:simon at rabbitmq.com>> wrote:
>
>         On 16/05/14 11:10, Simon MacMullen wrote:
>
>             Assuming you have not patched and built RabbitMQ yourself
>             (which I hope
>             you would have mentioned) then the most likely reason is
>             that something
>             else has installed a different version of cowboy in a
>             system-wide
>             location (probably /usr/lib/erlang/lib on Ubuntu). Is that
>             what's happened?
>
>
>         And indeed I now see that Ubuntu ships a packaging of Cowboy
>         which does exactly that:
>
>         http://packages.ubuntu.com/__trusty/amd64/erlang-cowboy/__filelist
>         <http://packages.ubuntu.com/trusty/amd64/erlang-cowboy/filelist>
>
>         I wish they wouldn't do that, especially for a fast-moving API
>         like Cowboy...
>
>
>         Cheers, Simon
>
>         --
>         Simon MacMullen
>         RabbitMQ, Pivotal
>
>
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Fri May 30 11:24:56 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Fri, 30 May 2014 06:24:56 -0400
Subject: [rabbitmq-discuss] clustering on google app engine
In-Reply-To: <0ca8b9f3-d8de-447d-b441-d30d49cc21c1@googlegroups.com>
References: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
 <0ca8b9f3-d8de-447d-b441-d30d49cc21c1@googlegroups.com>
Message-ID: <CAKgmDnE2LgA=jzOVfPcDYtgY9tWayzd2-QtQ+OzimeRnUE6JGQ@mail.gmail.com>

Experiences vary - we cluster across AWS zones in multiple regions and have
not had a partition in production in over a year.

I have experimented with this and the basic rules are: always be sure you
have available compute capacity by over-provisioning your clustered
instances relative to their load; never go into IO wait state (avoid
intense disk usage brought on by swapping or needless message persistence).

Also, avoid the us-east-1 region as it has the most usage, oldest hardware,
highest latencies, and highest incidence of failures.

ml


On Thu, May 29, 2014 at 10:24 PM, Fei Yao <mail2fei at gmail.com> wrote:

> Richard,
> I'm not an expert on GCE. But if there are in the same zone it will not be
> considered WAN. We had some experience in AWS, if it's Multi-AZ it will be
> considered WAN, and we've experience 3 network partitions last year.
>
> Best Regards
>
>
> On Tuesday, May 6, 2014 9:46:39 AM UTC-4, Richard Tier wrote:
>>
>> The docs <https://www.rabbitmq.com/clustering.html> on clustering state
>> that "clustering does not tolerate network partitions well", and states to
>> avoid clustering on WAN.
>>
>> I'm using Google Cloud Engine instances - all of which are in the same
>> zone.
>>
>> Should this setup be considered a WAN?
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/e6f9918c/attachment.html>

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 14:08:27 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 14:08:27 +0100 (BST)
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
Message-ID: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>

Well, it seems my newly installed rabbit is misbehaving.? 


Both RabbitMQ and Erlang are current versions off their relative APT feeds (http://packages.erlang-solutions.com/debian, http://www.rabbitmq.com/debian/). ? One node is running Ubuntu 12.04LTS, the other 14.04LTS but I can't see that making a difference as long as Rabbit and Erlang match ? 


For the purposes of this email, we'll call the Ubuntu 12 node U12 and the Ubuntu 14 node U14.


I have synched the Rabbit cookie file.

I can ping between both nodes, they are on the same subnet, no firewalls.


If I try clustering from U12 to U14, I get :

Error: {'EXIT',
?????????? {function_clause,
?????????????? [{rabbit_control,action,
??????????????????? [join_cluster,'rabbit at U12',
???????????????????? ["rabbit at U14"],
???????????????????? [{"-p","/"},{"-n","rabbit at U14"},{"-q",false}],
???????????????????? #Fun<rabbit_control.1.115240681>],
??????????????????? []},
??????????????? {rabbit_control,start,0,[]},
??????????????? {init,start_it,1,[]},
??????????????? {init,start_em,1,[]}]}}


If I try from U14 to U12, I get :

Clustering node 'rabbit at U14' with 'rabbit at U12' ...
Error: unable to connect to nodes ['rabbit at U12]: {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}

DIAGNOSTICS
===========

attempted to contact: ['rabbit at U12']

rabbit at U12:
? * connected to epmd (port 4369) on U12
? * node rabbit at U12 up, 'rabbit' application running

current node details:
- node name: 'rabbitmqctl9529 at U14'
- home dir: /var/lib/rabbitmq
- cookie hash: YhcBiH/OYzC0Gqx1id7VZg==
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/b335d7f7/attachment.html>

From simon at rabbitmq.com  Fri May 30 14:35:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 May 2014 14:35:46 +0100
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
In-Reply-To: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
References: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
Message-ID: <53888932.30006@rabbitmq.com>

On 30/05/2014 2:08PM, John Smith wrote:
> If I try clustering from U12 to U14, I get :
>
> Error: {'EXIT',
>             {function_clause,
>                 [{rabbit_control,action,
>                      [join_cluster,'rabbit at U12',
>                       ["rabbit at U14"],
>                       [{"-p","/"},{"-n","rabbit at U14"},{"-q",false}],
>                       #Fun<rabbit_control.1.115240681>],
>                      []},
>                  {rabbit_control,start,0,[]},
>                  {init,start_it,1,[]},
>                  {init,start_em,1,[]}]}}

That is a very odd looking error. The rabbit_control module was renamed 
to rabbit_control_main in 3.0.0, the same release in which cluster was 
changed to join_cluster.

So that looks like somehow you have a modern rabbitmqctl mixed in with 
an old (2.x) RabbitMQ server.

> If I try from U14 to U12, I get :
>
> Clustering node 'rabbit at U14' with 'rabbit at U12' ...
> Error: unable to connect to nodes ['rabbit at U12]:
> {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}

That's also consistent with U12 running an old rabbit.

So I don't know how your installation on U12 has progressed but it has 
definitely become mixed up somehow. That should be impossible if just 
using .debs, so have you installed via some other mechanism as well?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dberger at fiveringscapital.com  Fri May 30 16:23:12 2014
From: dberger at fiveringscapital.com (Dan Berger)
Date: Fri, 30 May 2014 08:23:12 -0700
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert
	verification	failed"
In-Reply-To: <CAAt2po+m=TncPj=SgaixfCFckZuqSP0Wp1mJUry0V=_h=uaDhA@mail.gmail.com>
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBADC1@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2po+m=TncPj=SgaixfCFckZuqSP0Wp1mJUry0V=_h=uaDhA@mail.gmail.com>
Message-ID: <57A505A533615F418F154E57E6FE7B4DB5C5FBAE47@EXVMBX018-3.exch018.msoutlookonline.net>

When I run amqps_listenq it fails at the amqp_socket_open step, which returns AMQP_STATUS_SSL_PEER_VERIFY_FAILED = -0x0202.

Further digging shows that the call to SSL_get_verify_result is returning X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN (https://www.openssl.org/docs/apps/verify.html#item_19).


From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alan Antonuk
Sent: Friday, May 30, 2014 1:00 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification failed"

Hmm.  Do you get any other information when you try running one of the amqps_* example programs that can be built with rabbitmq-c?

-Alan

On Thu May 29 2014 at 1:41:06 PM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
The .p12 file I started with does require a password (which I provide to the java and c# clients). For rabbitmq-c I?ve converted the p12 to pem while removing the password and then broken the file down into the 3 components.

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>
Sent: Thursday, May 29, 2014 2:44 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification failed"

Does your private key require a password to decrypt it? (rabbitmq-c doesn't provide any hooks to unlock private keys).

-Alan
On Thu May 29 2014 at 8:42:12 AM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
I used openssl to extract the CA cert, the certificate chain and the private key into 3 separate file and now I?m running:

   openssl s_client -connect myhost.com:50010<http://myhost.com:50010> -key test.key -cert test.crt -CAfile test.cac -verify 10

and I get ?Verify return code: 0 (ok)? which I think means success. I still get the same error when running my app with those 3 files.

Any other thoughts?


On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com> wrote:

You need to provide both the certificate chain file and the private key file (they're not the same file).

To debug this with the openssl s_client command, you'll need to pass in the -verify, -key and -cert flags with appropriate values.

HTH
-Alan

On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com<mailto:dberger at fiveringscapital.com>> wrote:
I?m just starting development on a c++ client app to connect to a vendor?s server.

I?m trying the SimpleAmqpClient library which is built on top of rabbitmq-c.

The provided a self-signed client certificate in .p12 format that I?ve converted to .pem. This contains a public and private key and also a CA public key.

I?m now trying to connect while providing the .pem file as the CA cert, client cert and client private key.

While connecting, I get:
'AmqpClient::AmqpLibraryException'
  what():  Error setting client certificate for socket: SSL peer cert verification failed

Digging into rabbitmq-c, I see this is due to the call to amqp_ssl_socket_set_key failing.

Running openssl s_client seems to work fine, so I?m not sure what I?m doing wrong. Any ideas?

-Dan
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/64449afd/attachment.html>

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 16:22:01 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 16:22:01 +0100 (BST)
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
In-Reply-To: <53888932.30006@rabbitmq.com>
References: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
 <53888932.30006@rabbitmq.com>
Message-ID: <1401463321.76402.YahooMailNeo@web172804.mail.ir2.yahoo.com>

Afraid you have to point the finger straight at what's on the apt repository... neither RabbitMQ or Erlang were on either server prior to today.? So whatever got on there came straight from the repositories. 



On Friday, 30 May 2014, 14:35, Simon MacMullen <simon at rabbitmq.com> wrote:
 


On 30/05/2014 2:08PM, John Smith wrote:
> If I try clustering from U12 to U14, I get :
>
> Error: {'EXIT',
>? ? ? ? ? ?  {function_clause,
>? ? ? ? ? ? ? ?  [{rabbit_control,action,
>? ? ? ? ? ? ? ? ? ? ? [join_cluster,'rabbit at U12',
>? ? ? ? ? ? ? ? ? ? ?  ["rabbit at U14"],
>? ? ? ? ? ? ? ? ? ? ?  [{"-p","/"},{"-n","rabbit at U14"},{"-q",false}],
>? ? ? ? ? ? ? ? ? ? ?  #Fun<rabbit_control.1.115240681>],
>? ? ? ? ? ? ? ? ? ? ? []},
>? ? ? ? ? ? ? ? ? {rabbit_control,start,0,[]},
>? ? ? ? ? ? ? ? ? {init,start_it,1,[]},
>? ? ? ? ? ? ? ? ? {init,start_em,1,[]}]}}

That is a very odd looking error. The rabbit_control module was renamed 
to rabbit_control_main in 3.0.0, the same release in which cluster was 
changed to join_cluster.

So that looks like somehow you have a modern rabbitmqctl mixed in with 
an old (2.x) RabbitMQ server.


> If I try from U14 to U12, I get :
>
> Clustering node 'rabbit at U14' with 'rabbit at U12' ...
> Error: unable to connect to nodes ['rabbit at U12]:
> {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}

That's also consistent with U12 running an old rabbit.

So I don't know how your installation on U12 has progressed but it has 
definitely become mixed up somehow. That should be impossible if just 
using .debs, so have you installed via some other mechanism as well?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/2e80e4b8/attachment.html>

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 16:59:27 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 16:59:27 +0100 (BST)
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
In-Reply-To: <53888932.30006@rabbitmq.com>
References: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
 <53888932.30006@rabbitmq.com>
Message-ID: <1401465567.49598.YahooMailNeo@web172803.mail.ir2.yahoo.com>

Just to follow up, definitley reckon something is messed up with your apt repository.?? Uninstalled the repo version, installed the deb file from the MQ site and it works fine !



On Friday, 30 May 2014, 14:35, Simon MacMullen <simon at rabbitmq.com> wrote:
 


On 30/05/2014 2:08PM, John Smith wrote:
> If I try clustering from U12 to U14, I get :
>
> Error: {'EXIT',
>? ? ? ? ? ?  {function_clause,
>? ? ? ? ? ? ? ?  [{rabbit_control,action,
>? ? ? ? ? ? ? ? ? ? ? [join_cluster,'rabbit at U12',
>? ? ? ? ? ? ? ? ? ? ?  ["rabbit at U14"],
>? ? ? ? ? ? ? ? ? ? ?  [{"-p","/"},{"-n","rabbit at U14"},{"-q",false}],
>? ? ? ? ? ? ? ? ? ? ?  #Fun<rabbit_control.1.115240681>],
>? ? ? ? ? ? ? ? ? ? ? []},
>? ? ? ? ? ? ? ? ? {rabbit_control,start,0,[]},
>? ? ? ? ? ? ? ? ? {init,start_it,1,[]},
>? ? ? ? ? ? ? ? ? {init,start_em,1,[]}]}}

That is a very odd looking error. The rabbit_control module was renamed 
to rabbit_control_main in 3.0.0, the same release in which cluster was 
changed to join_cluster.

So that looks like somehow you have a modern rabbitmqctl mixed in with 
an old (2.x) RabbitMQ server.


> If I try from U14 to U12, I get :
>
> Clustering node 'rabbit at U14' with 'rabbit at U12' ...
> Error: unable to connect to nodes ['rabbit at U12]:
> {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}

That's also consistent with U12 running an old rabbit.

So I don't know how your installation on U12 has progressed but it has 
definitely become mixed up somehow. That should be impossible if just 
using .debs, so have you installed via some other mechanism as well?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/398f8eb9/attachment.html>

From ceri at lshift.net  Fri May 30 17:09:48 2014
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 30 May 2014 17:09:48 +0100
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
In-Reply-To: <1401465567.49598.YahooMailNeo@web172803.mail.ir2.yahoo.com>
References: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
 <53888932.30006@rabbitmq.com>
 <1401465567.49598.YahooMailNeo@web172803.mail.ir2.yahoo.com>
Message-ID: <5388AD4C.6030504@lshift.net>

(30/05/14 16:59), John Smith wrote:
> Just to follow up, definitley reckon something is messed up with your
> apt repository.   Uninstalled the repo version, installed the deb file
> from the MQ site and it works fine !

When I've done things like this myself, I've usually forgotten to
install the sources.list entry, or forgotten to run `apt-get update`;
and subsequently been very confused for a short period of time. Next
time, it might be worth double-checking with `dpkg -l` on both boxes as
a sanity check.

>
>
> On Friday, 30 May 2014, 14:35, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>
> On 30/05/2014 2:08PM, John Smith wrote:
> > If I try clustering from U12 to U14, I get :
> >
> > Error: {'EXIT',
> >            {function_clause,
> >                [{rabbit_control,action,
> >                      [join_cluster,'rabbit at U12 <mailto:rabbit at U12>',
> >                      ["rabbit at U14 <mailto:rabbit at U14>"],
> >                      [{"-p","/"},{"-n","rabbit at U14
> <mailto:rabbit at U14>"},{"-q",false}],
> >                      #Fun<rabbit_control.1.115240681>],
> >                      []},
> >                  {rabbit_control,start,0,[]},
> >                  {init,start_it,1,[]},
> >                  {init,start_em,1,[]}]}}
>
> That is a very odd looking error. The rabbit_control module was renamed
> to rabbit_control_main in 3.0.0, the same release in which cluster was
> changed to join_cluster.
>
> So that looks like somehow you have a modern rabbitmqctl mixed in with
> an old (2.x) RabbitMQ server.
>
>
> > If I try from U14 to U12, I get :
> >
> > Clustering node 'rabbit at U14 <mailto:rabbit at U14>' with 'rabbit at U12
> <mailto:rabbit at U12>' ...
> > Error: unable to connect to nodes ['rabbit at U12 <mailto:rabbit at U12>]:
> >
> {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}
>
>
> That's also consistent with U12 running an old rabbit.
>
> So I don't know how your installation on U12 has progressed but it has
> definitely become mixed up somehow. That should be impossible if just
> using .debs, so have you installed via some other mechanism as well?
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/5342f0e0/attachment.html>

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 17:15:53 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 17:15:53 +0100 (BST)
Subject: [rabbitmq-discuss] Why is it so difficult to setup clustering ?
In-Reply-To: <53888932.30006@rabbitmq.com>
References: <1401455307.9665.YahooMailNeo@web172801.mail.ir2.yahoo.com>
 <53888932.30006@rabbitmq.com>
Message-ID: <1401466553.8270.YahooMailNeo@web172802.mail.ir2.yahoo.com>

>When I've done things like this myself, I've usually forgotten to
install the sources.list entry, or forgotten to run `apt-get update`;

Definitley not the case here (have checked my bash history, and have also just gone in and deleted the config file from sources.list.d/ ).




On Friday, 30 May 2014, 14:35, Simon MacMullen <simon at rabbitmq.com> wrote:
 


On 30/05/2014 2:08PM, John Smith wrote:
> If I try clustering from U12 to U14, I get :
>
> Error: {'EXIT',
>? ? ? ? ? ?  {function_clause,
>? ? ? ? ? ? ? ?  [{rabbit_control,action,
>? ? ? ? ? ? ? ? ? ? ? [join_cluster,'rabbit at U12',
>? ? ? ? ? ? ? ? ? ? ?  ["rabbit at U14"],
>? ? ? ? ? ? ? ? ? ? ?  [{"-p","/"},{"-n","rabbit at U14"},{"-q",false}],
>? ? ? ? ? ? ? ? ? ? ?  #Fun<rabbit_control.1.115240681>],
>? ? ? ? ? ? ? ? ? ? ? []},
>? ? ? ? ? ? ? ? ? {rabbit_control,start,0,[]},
>? ? ? ? ? ? ? ? ? {init,start_it,1,[]},
>? ? ? ? ? ? ? ? ? {init,start_em,1,[]}]}}

That is a very odd looking error. The rabbit_control module was renamed 
to rabbit_control_main in 3.0.0, the same release in which cluster was 
changed to join_cluster.

So that looks like somehow you have a modern rabbitmqctl mixed in with 
an old (2.x) RabbitMQ server.


> If I try from U14 to U12, I get :
>
> Clustering node 'rabbit at U14' with 'rabbit at U12' ...
> Error: unable to connect to nodes ['rabbit at U12]:
> {'EXIT',{undef,[{rabbit_mnesia,cluster_status_from_mnesia,[],[]},{rpc,'-handle_call_call/6-fun-0-',5,[{file,[114,112,99,46,101,114,108]},{line,205}]}]}}

That's also consistent with U12 running an old rabbit.

So I don't know how your installation on U12 has progressed but it has 
definitely become mixed up somehow. That should be impossible if just 
using .debs, so have you installed via some other mechanism as well?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/423e37fc/attachment.html>

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 17:22:06 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 17:22:06 +0100 (BST)
Subject: [rabbitmq-discuss] Question about configs
Message-ID: <1401466926.23741.YahooMailNeo@web172803.mail.ir2.yahoo.com>

Hello list,

On a slightly more promising note now I've got a working version of rabbit (I think !!)....

I'm trying to get my head around configs and more specifically their volatility (yes, TFM still needs to be R'd but there's a lot of text there to go through !)

So, if I go :

"rabbitmqctl join_cluster rabbit at rabbit2"

This appears to be a persistent change because I rebooted the rabbit service and it came back up fully clustered.

For good measure I tried creating a basic config file containing :

"[{rabbit,
? [{cluster_nodes, {['rabbit at ww3-ukc','rabbit at ww3-ukc-sby'], disc}}]}]."

But all that does is cause rabbit to complain :


/usr/lib/rabbitmq/bin/rabbitmqctl: 1: /etc/rabbitmq/rabbitmq-env.conf: [{rabbit,: not found
/usr/lib/rabbitmq/bin/rabbitmqctl: 2: /etc/rabbitmq/rabbitmq-env.conf: [{cluster_nodes,: not found

I'm guessing that's to do with the syntax of my config file ?? But I'm only following the simple example in the manual that says that one line is all that's needed "if this were the only field we needed to set".


From simon at rabbitmq.com  Fri May 30 17:28:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 May 2014 17:28:45 +0100
Subject: [rabbitmq-discuss] Question about configs
In-Reply-To: <1401466926.23741.YahooMailNeo@web172803.mail.ir2.yahoo.com>
References: <1401466926.23741.YahooMailNeo@web172803.mail.ir2.yahoo.com>
Message-ID: <5388B1BD.50703@rabbitmq.com>

On 30/05/2014 5:22PM, John Smith wrote:
> For good measure I tried creating a basic config file containing :
>
> "[{rabbit,
>    [{cluster_nodes, {['rabbit at ww3-ukc','rabbit at ww3-ukc-sby'], disc}}]}]."
>
> But all that does is cause rabbit to complain :
>
>
> /usr/lib/rabbitmq/bin/rabbitmqctl: 1: /etc/rabbitmq/rabbitmq-env.conf: [{rabbit,: not found
> /usr/lib/rabbitmq/bin/rabbitmqctl: 2: /etc/rabbitmq/rabbitmq-env.conf: [{cluster_nodes,: not found
>
> I'm guessing that's to do with the syntax of my config file ?  But I'm only following the simple example in the manual that says that one line is all that's needed "if this were the only field we needed to set".

Note that there are two config files - the main one 
/etc/rabbitmq/rabbitmq.config which is an Erlang term file which 
contains things like the config you have above, and 
/etc/rabbitmq/rabbitmq-env.conf which is a shell script which can set 
environment variables.

So you have the right contents but the wrong name.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From gb10hkzo-rabbitmq at yahoo.co.uk  Fri May 30 17:35:42 2014
From: gb10hkzo-rabbitmq at yahoo.co.uk (John Smith)
Date: Fri, 30 May 2014 17:35:42 +0100 (BST)
Subject: [rabbitmq-discuss] Question about configs
In-Reply-To: <5388B1BD.50703@rabbitmq.com>
References: <1401466926.23741.YahooMailNeo@web172803.mail.ir2.yahoo.com>
 <5388B1BD.50703@rabbitmq.com>
Message-ID: <1401467742.45733.YahooMailNeo@web172802.mail.ir2.yahoo.com>



> So you have the right contents but the wrong name.

Long live Morcambe & Wise !? (all the right notes but not necessarily in the right order)

Will give that a go.? Thanks Simon !


From alan.antonuk at gmail.com  Fri May 30 18:48:34 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 30 May 2014 17:48:34 +0000
Subject: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert verification
	failed"
References: <57A505A533615F418F154E57E6FE7B4DB5C4F36C2C@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poLkbV-61E3nPdbP=NF112vcV3O9xw4j1Q7_cqVKZ59iaA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBACFD@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2poJfisVWzPvteuS4wDWRycUAeTDkPCNSJCDf4hbCWyrTPg@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBADC1@EXVMBX018-3.exch018.msoutlookonline.net>
 <CAAt2po+m=TncPj=SgaixfCFckZuqSP0Wp1mJUry0V=_h=uaDhA@mail.gmail.com>
 <57A505A533615F418F154E57E6FE7B4DB5C5FBAE47@EXVMBX018-3.exch018.msoutlookonline.net>
Message-ID: <CAAt2poKn1UVcGyr-itrst5TiBrf+6MUN_3AGBFC8si9=N8jKxg@mail.gmail.com>

Looks like you've found the issue. I suspect you need to make sure that the
cert you pass in is signed by the same CA that signs the CAcert.

-Alan
On Fri May 30 2014 at 8:23:46 AM, Dan Berger <dberger at fiveringscapital.com>
wrote:

> When I run amqps_listenq it fails at the amqp_socket_open step, which
> returns AMQP_STATUS_SSL_PEER_VERIFY_FAILED = -0x0202.
>
>
>
> Further digging shows that the call to SSL_get_verify_result is returning
> X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN (
> https://www.openssl.org/docs/apps/verify.html#item_19).
>
>
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Alan Antonuk
> *Sent:* Friday, May 30, 2014 1:00 AM
>
>
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert
> verification failed"
>
>
>
> Hmm.  Do you get any other information when you try running one of the
> amqps_* example programs that can be built with rabbitmq-c?
>
>
>
> -Alan
>
>
>
> On Thu May 29 2014 at 1:41:06 PM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> The .p12 file I started with does require a password (which I provide to
> the java and c# clients). For rabbitmq-c I?ve converted the p12 to pem
> while removing the password and then broken the file down into the 3
> components.
>
>
>
> *From:* rabbitmq-discuss [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *
> alan.antonuk at gmail.com
> *Sent:* Thursday, May 29, 2014 2:44 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] rabbitmq-c - "SSL peer cert
> verification failed"
>
>
>
> Does your private key require a password to decrypt it? (rabbitmq-c
> doesn't provide any hooks to unlock private keys).
>
> -Alan
>
> On Thu May 29 2014 at 8:42:12 AM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> I used openssl to extract the CA cert, the certificate chain and the
> private key into 3 separate file and now I?m running:
>
>
>
>    openssl s_client -connect myhost.com:50010 -key test.key -cert
> test.crt -CAfile test.cac -verify 10
>
>
>
> and I get ?Verify return code: 0 (ok)? which I think means success. I
> still get the same error when running my app with those 3 files.
>
>
>
> Any other thoughts?
>
>
>
>
>
> On Thursday, May 29, 2014 12:10 AM, Dan alan.antonuk at gmail.com wrote:
>
>
>
> You need to provide both the certificate chain file and the private key
> file (they're not the same file).
>
>
>
> To debug this with the openssl s_client command, you'll need to pass in
> the -verify, -key and -cert flags with appropriate values.
>
>
>
> HTH
>
> -Alan
>
>
>
> On Wed May 28 2014 at 7:45:52 AM, Dan Berger <dberger at fiveringscapital.com>
> wrote:
>
> I?m just starting development on a c++ client app to connect to a vendor?s
> server.
>
>
>
> I?m trying the SimpleAmqpClient library which is built on top of
> rabbitmq-c.
>
>
>
> The provided a self-signed client certificate in .p12 format that I?ve
> converted to .pem. This contains a public and private key and also a CA
> public key.
>
>
>
> I?m now trying to connect while providing the .pem file as the CA cert,
> client cert and client private key.
>
>
>
> While connecting, I get:
>
> 'AmqpClient::AmqpLibraryException'
>
>   what():  Error setting client certificate for socket: SSL peer cert
> verification failed
>
>
>
> Digging into rabbitmq-c, I see this is due to the call to
> amqp_ssl_socket_set_key failing.
>
>
>
> Running openssl s_client seems to work fine, so I?m not sure what I?m
> doing wrong. Any ideas?
>
>
>
> -Dan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140530/cf71972f/attachment.html>

From mcintoshj at gmail.com  Sat May 31 06:48:24 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Sat, 31 May 2014 00:48:24 -0500
Subject: [rabbitmq-discuss] clustering on google app engine
In-Reply-To: <CAKgmDnE2LgA=jzOVfPcDYtgY9tWayzd2-QtQ+OzimeRnUE6JGQ@mail.gmail.com>
References: <256f0d3a-e49b-4eec-bea1-b80f4b8624dd@googlegroups.com>
 <0ca8b9f3-d8de-447d-b441-d30d49cc21c1@googlegroups.com>
 <CAKgmDnE2LgA=jzOVfPcDYtgY9tWayzd2-QtQ+OzimeRnUE6JGQ@mail.gmail.com>
Message-ID: <CAD6m6fFCuK_m2vaZ+SCywv1GHESnq35A9RTQZTiY_LGVW4r3DQ@mail.gmail.com>

Ditto on what Michael said on disk IO.  Rabbit has been rock solid for us
in prod with no partitioning for at least a year and a half+ (We DID have
some operating system issues due to a kernel bug around 208 days of up
time).  Whenever I've seen problems with rabbit, it's because the disk gets
overloaded and rabbit doesn't seem to handle that very well.  I remember at
the 2.8 days running load tests with HIPE and out-right crashing rabbit
after about 5 minutes at a constant 90% disk utilization.  Which reminds me
I need to try some load tests again, see how 3.3 handles things.

Jason


On Fri, May 30, 2014 at 5:24 AM, Laing, Michael <michael.laing at nytimes.com>
wrote:

> Experiences vary - we cluster across AWS zones in multiple regions and
> have not had a partition in production in over a year.
>
> I have experimented with this and the basic rules are: always be sure you
> have available compute capacity by over-provisioning your clustered
> instances relative to their load; never go into IO wait state (avoid
> intense disk usage brought on by swapping or needless message persistence).
>
> Also, avoid the us-east-1 region as it has the most usage, oldest
> hardware, highest latencies, and highest incidence of failures.
>
> ml
>
>
> On Thu, May 29, 2014 at 10:24 PM, Fei Yao <mail2fei at gmail.com> wrote:
>
>> Richard,
>> I'm not an expert on GCE. But if there are in the same zone it will not
>> be considered WAN. We had some experience in AWS, if it's Multi-AZ it will
>> be considered WAN, and we've experience 3 network partitions last year.
>>
>> Best Regards
>>
>>
>> On Tuesday, May 6, 2014 9:46:39 AM UTC-4, Richard Tier wrote:
>>>
>>> The docs <https://www.rabbitmq.com/clustering.html> on clustering state
>>> that "clustering does not tolerate network partitions well", and states to
>>> avoid clustering on WAN.
>>>
>>> I'm using Google Cloud Engine instances - all of which are in the same
>>> zone.
>>>
>>> Should this setup be considered a WAN?
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140531/d3cd27de/attachment.html>

