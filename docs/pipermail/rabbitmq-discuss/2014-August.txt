From mklishin at pivotal.io  Mon Aug  4 01:09:52 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Mon, 4 Aug 2014 04:09:52 +0400
Subject: [rabbitmq-discuss] [rabbitmq-users] AMQP 0-9-1 data types
In-Reply-To: <CAMsD-yA-cpWEOOzj50eTvKYf=nmCVjuCYV1EoOySus5GdXMRqQ@mail.gmail.com>
References: <5f415553-1a86-4a86-b08e-b60bc35ff6ca@googlegroups.com>
 <etPan.53debe11.74b0dc51.3aed@mercurio.local>
 <CAMsD-yA-cpWEOOzj50eTvKYf=nmCVjuCYV1EoOySus5GdXMRqQ@mail.gmail.com>
Message-ID: <etPan.53decf6b.46e87ccd.3aed@mercurio.local>

?On 4 August 2014 at 03:24:08, Matt Broadstone (mbroadst at gmail.com) wrote:
> > I guess my question is: does RabbitMQ follow the AMQP 0-9-1 spec  
> completely, but change these types ONLY in the case of Table Fields?  

I believe everything on
[1] is still relevant. See 4.2.4 and 4.2.5 in [1]. The data type prefixes are only used
in tables (maps, dictionaries).

When in doubt, take a look at Rabbit's binary codec, which is fairly declarative.

Some particularly relevant parts:

Lines 707-1232 in the [generated, so not in the repo] AMQP 0-9-1 framing code:
https://gist.github.com/michaelklishin/89bd9ba027bd5b4c31c1

Table parser and generator:
http://hg.rabbitmq.com/rabbitmq-server/file/dba10965c62e/src/rabbit_binary_generator.erl#l116
http://hg.rabbitmq.com/rabbitmq-server/file/dba10965c62e/src/rabbit_binary_parser.erl#l52

1.?https://www.rabbitmq.com/amqp-0-9-1-errata.html
2.?http://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Aug  5 10:36:55 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Aug 2014 10:36:55 +0100
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
 confirms losing messages
In-Reply-To: <1406822575623-36946.post@n5.nabble.com>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
 <etPan.538efbc7.7fdcc233.e723@mercurio.local>
 <CA+b0Eje2Vx+9Tqv95GPSLncGcjuvZ-Frk8XfCtQ0mTSa9VnL7A@mail.gmail.com>
 <1406822575623-36946.post@n5.nabble.com>
Message-ID: <53E0A5B7.80002@rabbitmq.com>

On 31/07/14 17:02, victorbr wrote:
> I seem to be observing exactly the same behavior you describe - when the
> network partition happens, at first the sender is blocked waiting for
> acknowledgement, then it finally gets it but then there are 6-7 seconds
> before the partitioned node shuts itself down when the sender can happily
> send messages to it and get immediate acknowledgements. Naturally, nothing
> of these messages enter the queue.
> Have you been able to understand why it happens and how one could work
> around it?

This is a known bug - it is fixed in nightly builds and will go into 
3.3.5. Look for 26225 / 26293 in the release notes.

Cheers, Simon

From viraj.gupte at credorax.com  Wed Aug  6 16:08:49 2014
From: viraj.gupte at credorax.com (Viraj Gupte)
Date: Wed, 6 Aug 2014 08:08:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
 <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
Message-ID: <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>

Hi Emile Joubert,
How much time did it take to process messages with size in 2 GB. Did you 
try working in a clustered environment?

On Tuesday, March 13, 2012 2:09:22 AM UTC-4, Zabrane Mickael wrote:
>
> Crystal clear. Thanks Jerry.
>
> Regards,
> Zabrane
>
> On Mar 13, 2012, at 7:03 AM, Jerry Kuch wrote:
>
> > Hi, Zabrane:
> > 
> > Ultimately you'll be limited by disk space.  If a queue gets large with 
> messages
> > that are either unconsumed, or delivered but not ACKed, and the broker 
> determines
> > that it's under memory pressure, it will page messages to files on disk, 
> blocking
> > producers in the meantime using TCP back pressure.  The mechanism is 
> discussed here:
> > 
> > http://www.rabbitmq.com/memory.html
> > 
> > In practice you don't want to routinely be flirting with the memory 
> watermark, and
> > as a rule, its value is probably best left at the default 0.40 level. 
>  In production
> > you should make sure your monitoring/alerting system is watching broker 
> memory usage,
> > and probably the lengths and memory consumption of queues of importance 
> to your app.
> > If queues are getting uncharacteristically backed up, it's often because 
> something
> > has changed or gone wrong (unexpected producer load, crashed or buggy 
> consumers,
> > etc.).
> > 
> > Best regards,
> > Jerry
> > 
> > ----- Original Message -----
> > From: "Zabrane Mickael" <zabr... at gmail.com <javascript:>>
> > To: "Tony Garnock-Jones" <tonygarnockj... at gmail.com <javascript:>>
> > Cc: rabbitmq... at lists.rabbitmq.com <javascript:>
> > Sent: Monday, March 12, 2012 10:41:25 PM
> > Subject: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?
> > 
> > 
> > 
> > This leads me to this question: 
> > 
> > 
> > Let assume I'm able to ensure that all my messages are less than 100Kb. 
> > 
> > 
> > How many messages one RabbitMQ mode can handle at any given time? Is 
> there any limitation? 
> > 
> > 
> > 
> > Regards, 
> > Zabrane 
> > 
> > 
> > 
> > 
> > 
> > On Mar 12, 2012, at 5:39 PM, Tony Garnock-Jones wrote: 
> > 
> > 
> > On 12 March 2012 12:23, Zabrane Mickael < zabr... at gmail.com 
> <javascript:> > wrote: 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote: 
> > 
> > 
> > For those of us struggling to follow this, if you're currently in the 
> > act of receiving data from node X, why can't you assume node X is still 
> > alive? I.e. what is wrong with treating arbitrary data from node X as 
> > evidence it's still alive, in lieu of a heartbeat from node X? 
> > 
> > 
> > 
> > http://learnyousomeerlang.com/distribunomicon 
> > 
> > Yes, that repeats the information that Irmo started this subthread with. 
> It doesn't address Matthew's question at all, though. 
> > 
> > Perhaps the erlang list is a better place for us to be asking about 
> this, Matthew, since it's not directly about Rabbit - are you on that list? 
> I'm not currently subscribed. 
> > 
> > Tony 
> > -- 
> > Tony Garnock-Jones 
> > tonygarn... at gmail.com <javascript:> 
> > http://homepages.kcbbs.gen.nz/tonyg/ 
> > 
> > 
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq... at lists.rabbitmq.com <javascript:>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140806/ae80bba3/attachment.html>

From viraj.gupte at credorax.com  Wed Aug  6 16:08:49 2014
From: viraj.gupte at credorax.com (Viraj Gupte)
Date: Wed, 6 Aug 2014 08:08:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
 <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
Message-ID: <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>

Hi Emile Joubert,
How much time did it take to process messages with size in 2 GB. Did you 
try working in a clustered environment?

On Tuesday, March 13, 2012 2:09:22 AM UTC-4, Zabrane Mickael wrote:
>
> Crystal clear. Thanks Jerry.
>
> Regards,
> Zabrane
>
> On Mar 13, 2012, at 7:03 AM, Jerry Kuch wrote:
>
> > Hi, Zabrane:
> > 
> > Ultimately you'll be limited by disk space.  If a queue gets large with 
> messages
> > that are either unconsumed, or delivered but not ACKed, and the broker 
> determines
> > that it's under memory pressure, it will page messages to files on disk, 
> blocking
> > producers in the meantime using TCP back pressure.  The mechanism is 
> discussed here:
> > 
> > http://www.rabbitmq.com/memory.html
> > 
> > In practice you don't want to routinely be flirting with the memory 
> watermark, and
> > as a rule, its value is probably best left at the default 0.40 level. 
>  In production
> > you should make sure your monitoring/alerting system is watching broker 
> memory usage,
> > and probably the lengths and memory consumption of queues of importance 
> to your app.
> > If queues are getting uncharacteristically backed up, it's often because 
> something
> > has changed or gone wrong (unexpected producer load, crashed or buggy 
> consumers,
> > etc.).
> > 
> > Best regards,
> > Jerry
> > 
> > ----- Original Message -----
> > From: "Zabrane Mickael" <zabr... at gmail.com <javascript:>>
> > To: "Tony Garnock-Jones" <tonygarnockj... at gmail.com <javascript:>>
> > Cc: rabbitmq... at lists.rabbitmq.com <javascript:>
> > Sent: Monday, March 12, 2012 10:41:25 PM
> > Subject: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?
> > 
> > 
> > 
> > This leads me to this question: 
> > 
> > 
> > Let assume I'm able to ensure that all my messages are less than 100Kb. 
> > 
> > 
> > How many messages one RabbitMQ mode can handle at any given time? Is 
> there any limitation? 
> > 
> > 
> > 
> > Regards, 
> > Zabrane 
> > 
> > 
> > 
> > 
> > 
> > On Mar 12, 2012, at 5:39 PM, Tony Garnock-Jones wrote: 
> > 
> > 
> > On 12 March 2012 12:23, Zabrane Mickael < zabr... at gmail.com 
> <javascript:> > wrote: 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote: 
> > 
> > 
> > For those of us struggling to follow this, if you're currently in the 
> > act of receiving data from node X, why can't you assume node X is still 
> > alive? I.e. what is wrong with treating arbitrary data from node X as 
> > evidence it's still alive, in lieu of a heartbeat from node X? 
> > 
> > 
> > 
> > http://learnyousomeerlang.com/distribunomicon 
> > 
> > Yes, that repeats the information that Irmo started this subthread with. 
> It doesn't address Matthew's question at all, though. 
> > 
> > Perhaps the erlang list is a better place for us to be asking about 
> this, Matthew, since it's not directly about Rabbit - are you on that list? 
> I'm not currently subscribed. 
> > 
> > Tony 
> > -- 
> > Tony Garnock-Jones 
> > tonygarn... at gmail.com <javascript:> 
> > http://homepages.kcbbs.gen.nz/tonyg/ 
> > 
> > 
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq... at lists.rabbitmq.com <javascript:>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140806/ae80bba3/attachment-0001.html>

From mklishin at pivotal.io  Wed Aug  6 16:12:45 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 6 Aug 2014 19:12:45 +0400
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
 <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
 <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>
Message-ID: <etPan.53e2460b.3d1b58ba.235a@mercurio.local>

On 6 August 2014 at 19:10:06, Viraj Gupte (viraj.gupte at credorax.com) wrote:
> > How much time did it take to process messages with size in 2 GB. 
> Did you try working in a clustered environment?

With messages of size in gigabytes I highly recommend doing benchmarks
in your specific environment with a workload similar to what you are
going to deploy.

Other people's results will be misleading at best.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From michael.laing at nytimes.com  Wed Aug  6 16:52:53 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 6 Aug 2014 11:52:53 -0400
Subject: [rabbitmq-discuss] [rabbitmq-users] Re: Can RabbitMQ handle big
	messages?
In-Reply-To: <etPan.53e2460b.3d1b58ba.235a@mercurio.local>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
 <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
 <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>
 <etPan.53e2460b.3d1b58ba.235a@mercurio.local>
Message-ID: <CAKgmDnHeek=Cq50WfFxSPhpj=9OEU9R3mn5kcrZhq7dzEM057A@mail.gmail.com>

Based upon our own benchmarks, and common sense, we store large message
bodies externally (we use s3 but there are lots of solutions) and pass a
reference in a header.

It's pretty easy to generate a signed URL with a one-off key that can be
particularized to a specific user or audience and given a ttl from a few
seconds to a few days.

ml


On Wed, Aug 6, 2014 at 11:12 AM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 6 August 2014 at 19:10:06, Viraj Gupte (viraj.gupte at credorax.com)
> wrote:
> > > How much time did it take to process messages with size in 2 GB.
> > Did you try working in a clustered environment?
>
> With messages of size in gigabytes I highly recommend doing benchmarks
> in your specific environment with a workload similar to what you are
> going to deploy.
>
> Other people's results will be misleading at best.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
> --
> You received this message because you are subscribed to the Google Groups
> "rabbitmq-users" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to rabbitmq-users+unsubscribe at googlegroups.com.
> To post to this group, send an email to rabbitmq-users at googlegroups.com.
> For more options, visit https://groups.google.com/d/optout.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140806/e5db5855/attachment.html>

From mklishin at pivotal.io  Wed Aug  6 16:57:10 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 6 Aug 2014 19:57:10 +0400
Subject: [rabbitmq-discuss] [rabbitmq-users] Re: Can RabbitMQ handle big
 messages?
In-Reply-To: <CAKgmDnHeek=Cq50WfFxSPhpj=9OEU9R3mn5kcrZhq7dzEM057A@mail.gmail.com>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
 <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>
 <8b58b3fe-f0e1-415f-a38c-d6dac1ae5a03@googlegroups.com>
 <etPan.53e2460b.3d1b58ba.235a@mercurio.local>
 <CAKgmDnHeek=Cq50WfFxSPhpj=9OEU9R3mn5kcrZhq7dzEM057A@mail.gmail.com>
Message-ID: <etPan.53e25074.41b71efb.235a@mercurio.local>

On 6 August 2014 at 19:52:53, Laing, Michael (michael.laing at nytimes.com) wrote:
> > Based upon our own benchmarks, and common sense, we store large 
> message bodies externally (we use s3 but there are lots of solutions) 
> and pass a reference in a header.

Yup, this is a strategy that is known to work well.

> It's pretty easy to generate a signed URL with a one-off key that 
> can be particularized to a specific user or audience and given 
> a ttl from a few seconds to a few days.

Several K/V or blob stores (Cassandra, Riak, Riak CS, Atmos, LeoFS) could
be quite effective at this, too.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From bloodbaronofvizkopa at gmail.com  Thu Aug  7 16:02:33 2014
From: bloodbaronofvizkopa at gmail.com (bloodBaron)
Date: Thu, 7 Aug 2014 08:02:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Count message without Ack on a queue
Message-ID: <1407423753870-36959.post@n5.nabble.com>

Under AMQImpl.Queue.DeclareOk class, getMessageCount() will return the number
of messages on a queue.
In java, getMessageCount() doesn't count the messages which haven't receive
an Ack yet, but if I use [rabbitmqctl list_queues name messages] in tht
terminal, I can see those messages who are consumed by a QueueingConsumer
without receiving a ack back.

E.G.,
Assume I've already put 1 message on the queue.

DeclareOk queue= channel.queueDeclare("queue" false, false, true, null);
QueueingConsumer consumer = new QueueingConsumer(channel);
// The server should expect explicit acknowledgements.
channel.basicConsume(queue.getQueue(), false, consumer);

while(true) {
    QueueingConsumer.Delivery delivery = consumer.nextDelivery();
    System.out.println("Received '[" + routingKey + "':'" + message + "]");

    // Do not send an Ack back.
    //channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
   
    queue= channel.queueDeclare("queue" false, false, true, null);
    // System will print 0 here, which means it can't see this message on
the queue.
    System.out.println(queue.getMessageCount());
}

If I use "rabbitmqctl list_queues name messages" after I run the above code
in terminal, I get the following result:
queue 1
This means rabbitmqctl can count the message which hasn't received an Ack
yet.

Is there a way we can use to count the messages without Ack  in Java except
by calling rabbitmqctl in Java?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Count-message-without-Ack-on-a-queue-tp36959.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at pivotal.io  Thu Aug  7 16:04:57 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 7 Aug 2014 19:04:57 +0400
Subject: [rabbitmq-discuss] Count message without Ack on a queue
In-Reply-To: <1407423753870-36959.post@n5.nabble.com>
References: <1407423753870-36959.post@n5.nabble.com>
Message-ID: <etPan.53e395b3.515f007c.dc4a@mercurio.local>

?On 7 August 2014 at 19:03:45, bloodBaron (bloodbaronofvizkopa at gmail.com) wrote:
> > Is there a way we can use to count the messages without Ack in Java  
> except
> by calling rabbitmqctl in Java?

HTTP API:
http://www.rabbitmq.com/management.html
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_4/priv/www/api/index.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bloodbaronofvizkopa at gmail.com  Thu Aug  7 16:22:00 2014
From: bloodbaronofvizkopa at gmail.com (bloodBaron)
Date: Thu, 7 Aug 2014 08:22:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Count message without Ack on a queue
In-Reply-To: <etPan.53e395b3.515f007c.dc4a@mercurio.local>
References: <1407423753870-36959.post@n5.nabble.com>
 <etPan.53e395b3.515f007c.dc4a@mercurio.local>
Message-ID: <1407424920343-36961.post@n5.nabble.com>

The problem about using an HTTP API is the HTTP call is like
http://someIP:15672/api/vhosts.
This will leads to a single point failure in a distributed system if someIP
goes down.
Even if I use a domain instead of an IP, the system will rely on the domain
server, it is NOT a closed system anymore.
Is there a way to communicate with a cluster of RabbitMQ? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Count-message-without-Ack-on-a-queue-tp36959p36961.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at pivotal.io  Thu Aug  7 16:29:06 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 7 Aug 2014 19:29:06 +0400
Subject: [rabbitmq-discuss] Count message without Ack on a queue
In-Reply-To: <1407424920343-36961.post@n5.nabble.com>
References: <1407423753870-36959.post@n5.nabble.com>
 <etPan.53e395b3.515f007c.dc4a@mercurio.local>
 <1407424920343-36961.post@n5.nabble.com>
Message-ID: <etPan.53e39b5c.4db127f8.dc4a@mercurio.local>

?On 7 August 2014 at 19:23:10, bloodBaron (bloodbaronofvizkopa at gmail.com) wrote:
> > The problem about using an HTTP API is the HTTP call is like
> http://someIP:15672/api/vhosts.
> This will leads to a single point failure in a distributed system  
> if someIP
> goes down.

People run HTTP servers behind load balancers (or even multiple layers of)
at a massive scale at places like Google or Amazon. You could do
the same ;)

> Even if I use a domain instead of an IP, the system will rely on the  
> domain
> server, it is NOT a closed system anymore.

How do you define "closed"? As in security? Then it's up to how you configure
your network. You can use HTTPS with the management plugin, too.

Finally, rabbitmqctl uses distributed Erlang facilities directly, which
means if you can access it and it can connect to the cluster, you can
do *anything*. I'd rather use the HTTP API than try to use rabbitmqctl
directly and then try to make the resulting solution more secure.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Thu Aug  7 16:32:57 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 7 Aug 2014 19:32:57 +0400
Subject: [rabbitmq-discuss] Count message without Ack on a queue
In-Reply-To: <etPan.53e395b3.515f007c.dc4a@mercurio.local>
References: <1407423753870-36959.post@n5.nabble.com>
 <etPan.53e395b3.515f007c.dc4a@mercurio.local>
Message-ID: <etPan.53e39c46.1f16e9e8.dc4a@mercurio.local>

On 7 August 2014 at 19:05:27, Michael Klishin (michael at rabbitmq.com) wrote:
> > HTTP API:
> http://www.rabbitmq.com/management.html
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_4/priv/www/api/index.html  

? or?https://github.com/simonmacmullen/rabbitmq-management-exchange,
which works over AMQP 0-9-1 (so, "regular" RabbitMQ clients).
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bloodbaronofvizkopa at gmail.com  Thu Aug  7 16:40:28 2014
From: bloodbaronofvizkopa at gmail.com (bloodBaron)
Date: Thu, 7 Aug 2014 08:40:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Count message without Ack on a queue
In-Reply-To: <etPan.53e39c46.1f16e9e8.dc4a@mercurio.local>
References: <1407423753870-36959.post@n5.nabble.com>
 <etPan.53e395b3.515f007c.dc4a@mercurio.local>
 <etPan.53e39c46.1f16e9e8.dc4a@mercurio.local>
Message-ID: <1407426028642-36964.post@n5.nabble.com>

https://github.com/simonmacmullen/rabbitmq-management-exchange
That's exactly what I'm looking for. Thanks a lot!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Count-message-without-Ack-on-a-queue-tp36959p36964.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From akmartin at gmail.com  Fri Aug  8 15:51:14 2014
From: akmartin at gmail.com (Andy Martin)
Date: Fri, 8 Aug 2014 07:51:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Missing log entries
Message-ID: <957d916a-e001-40ad-a138-b4479db976a5@googlegroups.com>

I am trying to diagnose heartbeat timeouts I'm seeing from certain clients. 
My problem is the logs are not updating as expected. My environment is 
configured as default:

{log_levels,[{connection,info}]},


And I see connection messages from some clients:

=INFO REPORT==== 8-Aug-2014::10:06:25 ===
accepting AMQP connection <0.306.0> (#.#.#.#:57465 -> #.#.#.#:5672)


But I'm running a client locally that never gets logged on this server. 
Never. I've recycled the server to ensure all logs are flushed with no 
change.

I am running the following versions:

RabbitMQ 3.3.2, Erlang R16B03-1

Is this a known issue or wrong expectations on my part?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140808/2baa3c6d/attachment.html>

From 0x6e6562 at gmail.com  Fri Aug  8 18:04:06 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 8 Aug 2014 13:04:06 -0400
Subject: [rabbitmq-discuss] Location of journals in a mirrored deployment
Message-ID: <CAB-G1jihxHmaSMsnVnrGV3tz=4t-82w5s9rT6tCOO0FHk8qx1w@mail.gmail.com>

Hi all,

I was wondering to what extent the message journal is replicated on
separate nodes when publishing persistent messages to a mirrored
queue. Can Rabbit be configured (in addition to queue replication) to
journal messages on all nodes or just a subset of nodes? What happens
in a failover scenario - does a slave take over the job of journaling
persistent messages if it wasn't doing it previously?

Thanks,

Ben

From akmartin at gmail.com  Fri Aug  8 19:16:21 2014
From: akmartin at gmail.com (Andy Martin)
Date: Fri, 8 Aug 2014 11:16:21 -0700 (PDT)
Subject: [rabbitmq-discuss] getting RabbitMQ out of user folder
Message-ID: <9e473751-acba-40d5-bd06-892ff37280ab@googlegroups.com>

I am trying to get RabbitMQ out of my personal directory. This seems to be 
an impossible task. This is in my environment:

{enabled_plugins_file,"C:/Users/admin-amartin/AppData/Roaming/RabbitMQ/enabled_plugins"}


Even though I have this in my config file.

{enabled_plugins_file, "D:/RabbitMQ/enabled_plugins"}


Does RabbitMQ not respect that setting in the config file?

Also, is there any way to move the erlang cookie out of the user folder as 
well? It's just kind of strange having those in a user folder given that 
any of a number of users might need to perform maintenance or upgrades.

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140808/c208c3f6/attachment.html>

From mklishin at pivotal.io  Fri Aug  8 19:25:34 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Fri, 8 Aug 2014 22:25:34 +0400
Subject: [rabbitmq-discuss] getting RabbitMQ out of user folder
In-Reply-To: <9e473751-acba-40d5-bd06-892ff37280ab@googlegroups.com>
References: <9e473751-acba-40d5-bd06-892ff37280ab@googlegroups.com>
Message-ID: <etPan.53e51637.19495cff.7fc4@mercurio.local>

On 8 August 2014 at 22:18:32, Andy Martin (akmartin at gmail.com) wrote:
> > I am trying to get RabbitMQ out of my personal directory.

You likely will find it a lot more convenient to override RABBITMQ_BASE:
http://www.rabbitmq.com/relocate.html

Note that for Windows server to notice the environment variable changes,
it has to be *re-installed* (not just restarted). This is mentioned on
http://www.rabbitmq.com/configure.html

Moving the Erlang cookie is possible but fiddly and fragile on Windows. Unless you have
dozens of users all of which need to have the cookie, I'd perhaps leave it
as is.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From akmartin at gmail.com  Fri Aug  8 19:30:15 2014
From: akmartin at gmail.com (Andy Martin)
Date: Fri, 8 Aug 2014 14:30:15 -0400
Subject: [rabbitmq-discuss] getting RabbitMQ out of user folder
In-Reply-To: <etPan.53e51637.19495cff.7fc4@mercurio.local>
References: <9e473751-acba-40d5-bd06-892ff37280ab@googlegroups.com>
 <etPan.53e51637.19495cff.7fc4@mercurio.local>
Message-ID: <CAKRHTkdQvwAnC2o9tA-E9cm-Lf=v6yAnqmbtr8R_oBo5kEgN4A@mail.gmail.com>

Awesome! It was the service reinstall I was missing. Problem solved.


On Fri, Aug 8, 2014 at 2:25 PM, Michael Klishin <mklishin at pivotal.io> wrote:

> On 8 August 2014 at 22:18:32, Andy Martin (akmartin at gmail.com) wrote:
> > > I am trying to get RabbitMQ out of my personal directory.
>
> You likely will find it a lot more convenient to override RABBITMQ_BASE:
> http://www.rabbitmq.com/relocate.html
>
> Note that for Windows server to notice the environment variable changes,
> it has to be *re-installed* (not just restarted). This is mentioned on
> http://www.rabbitmq.com/configure.html
>
> Moving the Erlang cookie is possible but fiddly and fragile on Windows.
> Unless you have
> dozens of users all of which need to have the cookie, I'd perhaps leave it
> as is.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140808/2d38e993/attachment.html>

From loganathan.ms at gmail.com  Tue Aug 12 15:07:26 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Tue, 12 Aug 2014 19:37:26 +0530
Subject: [rabbitmq-discuss] BUNNY: How can we connect to RMQ cluster
Message-ID: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>

Hi All,

I have two RMQ servers such as R1 & R1 and both are running in cluster
setup.  I want to connect to R2 if R1 is down and vice versa , what is the
way to achieve it in bunny gem?


regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140812/b24fcd51/attachment.html>

From pmaisenovich at blizzard.com  Tue Aug 12 19:20:19 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Tue, 12 Aug 2014 11:20:19 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.3.4 vs 3.3.4.50711
In-Reply-To: <1407844697612-36970.post@n5.nabble.com>
References: <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
 <53C4E010.80209@rabbitmq.com> <1405456189054-36809.post@n5.nabble.com>
 <53C64D03.3080106@rabbitmq.com> <1405530861739-36817.post@n5.nabble.com>
 <1405797327212-36851.post@n5.nabble.com> <53CCD46E.1070309@rabbitmq.com>
 <1407844697612-36970.post@n5.nabble.com>
Message-ID: <1407867619952-36973.post@n5.nabble.com>

Hi Pavan,

In my tests turning fine stats off has completely solved the problem -
mgmt_db size will remain constant and very low. I'd suggest to try that
again (we set it in /etc/rabbitmq/rabbitmq.config), restart RabbitMQ and
verify that 1) you have the setting take effect (by running erlang queries
and checking admin UI) 2) it is mgmt_db that is still growing and consuming
the memory.

Good luck!

FYI - rabbitmq official forums have moved here:
https://groups.google.com/forum/#!forum/rabbitmq-users



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36973.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From phillpafford at gmail.com  Tue Aug 12 20:46:53 2014
From: phillpafford at gmail.com (ppafford)
Date: Tue, 12 Aug 2014 12:46:53 -0700 (PDT)
Subject: [rabbitmq-discuss] pgsql-listen-exchange setup issues
Message-ID: <1407872812973-36974.post@n5.nabble.com>

Using the 0.2.0 version of https://github.com/aweber/pgsql-listen-exchange

Running: RabbitMQ 3.3.5, Erlang R14B04

I've tried each way to configure the plugin with no luck, what am I doing
wrong?

1 - rabbitmq config :: /etc/rabbitmq/rabbitmq.config

[
  {pgsql_listen_exchange,
    [
      {host: "**********"},
      {port: 5432},
      {dbname: "postgres"},
      {user: "**********"},
      {password: "**********"}
    ]
  }
].

error log :: /var/log/rabbitmq/startup_err

Crash dump was written to: erl_crash.dump
could not start kernel pid (application_controller) (error in config file
"/etc/rabbitmq/rabbitmq.config" (1): bad term)

2 - rabbitmq exchange :: no connection shown but the exchange looks to be
configured
<http://rabbitmq.1065348.n5.nabble.com/file/n36974/exchange.png> 
3 - rabbitmq policy :: 
<http://rabbitmq.1065348.n5.nabble.com/file/n36974/policy.png> 
<http://rabbitmq.1065348.n5.nabble.com/file/n36974/policy.png> 
Validation failed [{<<"pgsql-listen-host">>,<<"**********">>},
{<<"pgsql-listen-port">>,5432}, {<<"pgsql-listen-dbname">>,<<"postgres">>},
{<<"pgsql-listen-user">>,<<"**********">>},
{<<"pgsql-listen-password">>,<<"**********">>}] are not recognised policy
settings

Validation failed [{<<"x-host">>,<<"**********">>}, {<<"x-port">>,5432},
{<<"x-dbname">>,<<"postgres">>}, {<<"x-user">>,<<"**********">>},
{<<"x-password">>,<<"**********">>}] are not recognised policy settings

Validation failed [{<<"host">>,<<"**********">>}, {<<"port">>,5432},
{<<"dbname">>,<<"postgres">>}, {<<"user">>,<<"**********">>},
{<<"password">>,<<"**********">>}] are not recognised policy settings








--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/pgsql-listen-exchange-setup-issues-tp36974.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at pivotal.io  Wed Aug 13 05:27:42 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 13 Aug 2014 08:27:42 +0400
Subject: [rabbitmq-discuss] BUNNY: How can we connect to RMQ cluster
In-Reply-To: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
Message-ID: <etPan.53eae95b.327b23c6.e493@mercurio.local>

?On 12 August 2014 at 18:10:20, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > I have two RMQ servers such as R1 & R1 and both are running in cluster  
> setup. I want to connect to R2 if R1 is down and vice versa , what  
> is the way to achieve it in bunny gem?

Most people stick an HAproxy in front of the nodes and point clients to it.

That said, it should be fairly trivial to pick a host from a list in Bunny like
you already can do in the Java client, I'll look into adding it.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From niks at osic.rs  Mon Aug 18 15:03:37 2014
From: niks at osic.rs (Nikola)
Date: Mon, 18 Aug 2014 07:03:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Delayed messages to specific queue
Message-ID: <cdfa1efd-f46f-425e-9028-e3926ddcc556@googlegroups.com>

Hello all,

I have read this page from docs http://www.rabbitmq.com/dlx.html and found 
examples in PHP which work fine. 

However, it looks to me that there is no way to do what we need :( 

Our web app is publishing messages to specific queues, using both exchange 
and queue name. Exchange is "direct" type and behind every queue there are 
several consumers working in load-balancing mode.

For dead-letter messages, it looks to me only new exchange (x-dead-letter-exchange) 
and routing-key (x-dead-letter-routing-key), but not new queue name. New 
queue name is important so that delayed message is sent to appropriate 
consumer. 

We're not using routing-keys, because queues were enough to route messages 
to different types of consumers.

Am I missing anything or is this limitation of dead-letter exchanges?

Thanks,
Nikola
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140818/9b4e6369/attachment.html>

From goyalk at vmware.com  Tue Aug 19 00:54:51 2014
From: goyalk at vmware.com (Kapil Goyal)
Date: Mon, 18 Aug 2014 23:54:51 +0000
Subject: [rabbitmq-discuss] List all bindings for an exchange
Message-ID: <D017E058.E72D%goyalk@vmware.com>

Hi,

How do I list all bindings for an exchange using AMQP or the management API?

Thanks
Kapil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140818/0fbd2538/attachment.html>

From brett.r.cameron at gmail.com  Tue Aug 19 00:59:41 2014
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Tue, 19 Aug 2014 11:59:41 +1200
Subject: [rabbitmq-discuss] List all bindings for an exchange
In-Reply-To: <D017E058.E72D%goyalk@vmware.com>
References: <D017E058.E72D%goyalk@vmware.com>
Message-ID: <CALPqkirdsYAz7r1jqRnS_6gN2JJZ+9hhhP=uCTuaMWkhOHA9RQ@mail.gmail.com>

You can't do that via AMQP; see
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_5/priv/www/api/index.html
for the relevant Management API info

Brett


On Tue, Aug 19, 2014 at 11:54 AM, Kapil Goyal <goyalk at vmware.com> wrote:

>  Hi,
>
>  How do I list all bindings for an exchange using AMQP or the management
> API?
>
>  Thanks
> Kapil
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140819/c6816cdb/attachment.html>

From loganathan.ms at gmail.com  Tue Aug 19 11:38:30 2014
From: loganathan.ms at gmail.com (Loganathan Sellappa)
Date: Tue, 19 Aug 2014 03:38:30 -0700 (PDT)
Subject: [rabbitmq-discuss] BUNNY: How can we connect to RMQ cluster
In-Reply-To: <etPan.53eae95b.327b23c6.e493@mercurio.local>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
Message-ID: <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>

Hi Michael,

Thanks is their any patch available for this feature, or is it a good way 
to make connection with one node and switch to other  one if we get an 
connection error?

Regards,
Loganathan

On Wednesday, 13 August 2014 09:58:15 UTC+5:30, Michael Klishin wrote:
>
>  On 12 August 2014 at 18:10:20, Loganathan Sellapa (logana... at gmail.com 
> <javascript:>) wrote: 
> > > I have two RMQ servers such as R1 & R1 and both are running in cluster 
>   
> > setup. I want to connect to R2 if R1 is down and vice versa , what   
> > is the way to achieve it in bunny gem? 
>
> Most people stick an HAproxy in front of the nodes and point clients to 
> it. 
>
> That said, it should be fairly trivial to pick a host from a list in Bunny 
> like 
> you already can do in the Java client, I'll look into adding it. 
> --   
> MK   
>
> Staff Software Engineer, Pivotal/RabbitMQ 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140819/340d8526/attachment.html>

From mklishin at pivotal.io  Tue Aug 19 11:45:56 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 19 Aug 2014 14:45:56 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
Message-ID: <etPan.53f32b02.643c9869.180db@mercurio.local>



On 19 August 2014 at 14:38:37, Loganathan Sellappa (loganathan.ms at gmail.com) wrote:
> > Thanks is their any patch available for this feature, or is it 
> a good way to make connection with one node and switch to other 
> one if we get an connection error?

Like I said before, it is common to use a proxy in front of your cluster
but you can try master:

https://github.com/ruby-amqp/bunny/pull/234/files
https://github.com/ruby-amqp/bunny/commit/091696492de801505943a70320c338ebb63dba30
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From loganathan.ms at gmail.com  Tue Aug 19 11:49:28 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Tue, 19 Aug 2014 16:19:28 +0530
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <etPan.53f32b02.643c9869.180db@mercurio.local>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
Message-ID: <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>

HI Michael,

Thanks I will try this out.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Tue, Aug 19, 2014 at 4:15 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

>
>
> On 19 August 2014 at 14:38:37, Loganathan Sellappa (
> loganathan.ms at gmail.com) wrote:
> > > Thanks is their any patch available for this feature, or is it
> > a good way to make connection with one node and switch to other
> > one if we get an connection error?
>
> Like I said before, it is common to use a proxy in front of your cluster
> but you can try master:
>
> https://github.com/ruby-amqp/bunny/pull/234/files
>
> https://github.com/ruby-amqp/bunny/commit/091696492de801505943a70320c338ebb63dba30
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140819/dbde3c49/attachment.html>

From goyalk at vmware.com  Tue Aug 19 18:08:59 2014
From: goyalk at vmware.com (Kapil Goyal)
Date: Tue, 19 Aug 2014 17:08:59 +0000
Subject: [rabbitmq-discuss] List all bindings for an exchange
In-Reply-To: <CALPqkirdsYAz7r1jqRnS_6gN2JJZ+9hhhP=uCTuaMWkhOHA9RQ@mail.gmail.com>
References: <D017E058.E72D%goyalk@vmware.com>
 <CALPqkirdsYAz7r1jqRnS_6gN2JJZ+9hhhP=uCTuaMWkhOHA9RQ@mail.gmail.com>
Message-ID: <D018D073.E8E0%goyalk@vmware.com>

Thanks Brett. I did already go through the available management plugin API and didn't find a way to do what I want, which is to get all bindings for an exchange. I can see this information on the management plugin UI, when I click on an exchange and go into its details, so there must be a way to do it. Here are all the REST APIs that provide bindings:

/api/exchanges/vhost/name/bindings/source - provides bindings between two exchanges
/api/exchanges/vhost/name/bindings/destination - provides bindings between two exchanges
/api/queues/vhost/name/bindings - provides all bindings for a queue. I am looking for a similar API for exchanges.
/api/bindings - provides all bindings in RMQ
/api/bindings/vhost - provides all bindings in a virtual host
/api/bindings/vhost/e/exchange/q/queue - provides all bindings between an exchange and a queue
/api/bindings/vhost/e/source/e/destination - provides all bindings between two exchanges

So, as you can see, there is no API that provides all bindings for a given exchange. Am I missing something or is it not possible? How does management UI display this information in the exchange details page?

Thanks
Kapil



From: Brett Cameron <brett.r.cameron at gmail.com<mailto:brett.r.cameron at gmail.com>>
Reply-To: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Monday, August 18, 2014 at 4:59 PM
To: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] List all bindings for an exchange

You can't do that via AMQP; see http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_5/priv/www/api/index.html<https://urldefense.proofpoint.com/v1/url?u=http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_5/priv/www/api/index.html&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=Z4eqT8PoSI3FmEO1d3nLuZpnp5f5N8ANJw2XBn5pQF8%3D%0A&s=73ebfff06bfe0ef6cf70362846892523c4a4ca054b425abbaa35414dbe269257> for the relevant Management API info

Brett


On Tue, Aug 19, 2014 at 11:54 AM, Kapil Goyal <goyalk at vmware.com<mailto:goyalk at vmware.com>> wrote:
Hi,

How do I list all bindings for an exchange using AMQP or the management API?

Thanks
Kapil


_______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users<https://urldefense.proofpoint.com/v1/url?u=https://groups.google.com/forum/%23%21forum/rabbitmq-users&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=Z4eqT8PoSI3FmEO1d3nLuZpnp5f5N8ANJw2XBn5pQF8%3D%0A&s=b71cb0a19d0113562c4be5488c10f9c849020cef5ece328bd5e6fc4802cc923a>,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiITniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=Z4eqT8PoSI3FmEO1d3nLuZpnp5f5N8ANJw2XBn5pQF8%3D%0A&s=1d52397983bde6c0c7008ec2640684e2cc74e94449514535a41fa05c08e42d82>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140819/b3ef48d1/attachment.html>

From simon at rabbitmq.com  Tue Aug 19 19:12:04 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Aug 2014 19:12:04 +0100
Subject: [rabbitmq-discuss] Delayed messages to specific queue
In-Reply-To: <cdfa1efd-f46f-425e-9028-e3926ddcc556@googlegroups.com>
References: <cdfa1efd-f46f-425e-9028-e3926ddcc556@googlegroups.com>
Message-ID: <53F39374.7030005@rabbitmq.com>

On 18/08/14 15:03, Nikola wrote:
> Hello all,

Hi. This list is being closed down soon, I suggest you start using 
https://groups.google.com/forum/#!forum/rabbitmq-users.

> I have read this page from docs http://www.rabbitmq.com/dlx.html and
> found examples in PHP which work fine.
>
> However, it looks to me that there is no way to do what we need :(
>
> Our web app is publishing messages to specific queues, using both
> exchange and queue name. Exchange is "direct" type and behind every
> queue there are several consumers working in load-balancing mode.
>
> For dead-letter messages, it looks to me only new exchange
> (x-dead-letter-exchange) and routing-key (x-dead-letter-routing-key),
> but not new queue name. New queue name is important so that delayed
> message is sent to appropriate consumer.

If you want to dead-letter to a specific queue, set the 
x-dead-letter-exchange to "" and the x-dead-letter-routing-key to the 
queue name - it works just like publishing a message through the default 
exchange.

Cheers, Simon

> We're not using routing-keys, because queues were enough to route
> messages to different types of consumers.
>
> Am I missing anything or is this limitation of dead-letter exchanges?
>
> Thanks,
> Nikola
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From mklishin at pivotal.io  Tue Aug 19 19:38:03 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 19 Aug 2014 22:38:03 +0400
Subject: [rabbitmq-discuss] List all bindings for an exchange
In-Reply-To: <D018D073.E8E0%goyalk@vmware.com>
References: <D017E058.E72D%goyalk@vmware.com>
 <CALPqkirdsYAz7r1jqRnS_6gN2JJZ+9hhhP=uCTuaMWkhOHA9RQ@mail.gmail.com>
 <D018D073.E8E0%goyalk@vmware.com>
Message-ID: <etPan.53f399a6.6b8b4567.5dec@mercurio.local>

On 19 August 2014 at 21:10:42, Kapil Goyal (goyalk at vmware.com) wrote:
> > I did already go through the available management plugin API  
> and didn?t find a way to do what I want, which is to get all bindings  
> for an exchange. I can see this information on the management  
> plugin UI, when I click on an exchange and go into its details,  
> so there must be a way to do it.?

We first need to define what "bindings on an exchange" means. Is the exchange
supposed to be the source in the binding (as in, when queues or exchanges are bound to it),
or a destination (when it is bound to other exchanges)

> Here are all the REST APIs that provide  
> bindings:
>  
> /api/exchanges/vhost/name/bindings/source ? provides bindings  
> between two exchanges
> /api/exchanges/vhost/name/bindings/destination ? provides  
> bindings between two exchanges

/api/exchanges/{vhost}/{name}/bindings/source lists all bindings
where exchange {name} in vhost {vhost} is the source (things are bound to it).

Likewise,?/api/exchanges/{vhost}/{name}/bindings/destination lists bindings
when exchange {exchange} in vhost {vhost} is the destination.

Pick which one of the above you want (or maybe both).

By the way, the list has moved to rabbitmq-users, please start new discussions
there:

https://groups.google.com/forum/#!forum/rabbitmq-users?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From goyalk at vmware.com  Tue Aug 19 22:38:51 2014
From: goyalk at vmware.com (Kapil Goyal)
Date: Tue, 19 Aug 2014 21:38:51 +0000
Subject: [rabbitmq-discuss] List all bindings for an exchange
In-Reply-To: <etPan.53f399a6.6b8b4567.5dec@mercurio.local>
References: <D017E058.E72D%goyalk@vmware.com>
 <CALPqkirdsYAz7r1jqRnS_6gN2JJZ+9hhhP=uCTuaMWkhOHA9RQ@mail.gmail.com>
 <D018D073.E8E0%goyalk@vmware.com>
 <etPan.53f399a6.6b8b4567.5dec@mercurio.local>
Message-ID: <D0191165.E93A%goyalk@vmware.com>

Thanks Michael.

>> /api/exchanges/{vhost}/{name}/bindings/source lists all bindings
>> where exchange {name} in vhost {vhost} is the source (things are bound
>>to it).

This is exactly what I was looking for, but I mistook ?source? to be a
variable and that I was supposed to provide the name of another exchange
here.

>> By the way, the list has moved to rabbitmq-users, please start new
>>discussions there:

I will.

Regards
Kapil


On 8/19/14, 11:38 AM, "Michael Klishin" <mklishin at pivotal.io> wrote:

>On 19 August 2014 at 21:10:42, Kapil Goyal (goyalk at vmware.com) wrote:
>> > I did already go through the available management plugin API
>> and didn?t find a way to do what I want, which is to get all bindings
>> for an exchange. I can see this information on the management
>> plugin UI, when I click on an exchange and go into its details,
>> so there must be a way to do it.
>
>We first need to define what "bindings on an exchange" means. Is the
>exchange
>supposed to be the source in the binding (as in, when queues or exchanges
>are bound to it),
>or a destination (when it is bound to other exchanges)
>
>> Here are all the REST APIs that provide
>> bindings:
>>  
>> /api/exchanges/vhost/name/bindings/source ? provides bindings
>> between two exchanges
>> /api/exchanges/vhost/name/bindings/destination ? provides
>> bindings between two exchanges
>
>/api/exchanges/{vhost}/{name}/bindings/source lists all bindings
>where exchange {name} in vhost {vhost} is the source (things are bound to
>it).
>
>Likewise, /api/exchanges/{vhost}/{name}/bindings/destination lists
>bindings
>when exchange {exchange} in vhost {vhost} is the destination.
>
>Pick which one of the above you want (or maybe both).
>
>By the way, the list has moved to rabbitmq-users, please start new
>discussions
>there:
>
>https://urldefense.proofpoint.com/v1/url?u=https://groups.google.com/forum
>/%23%21forum/rabbitmq-users&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=JF6BIRiI
>TniYYZhbhzlgNvj%2FeB0%2BYbRBSr0f8NG91qs%3D%0A&m=ghbRfGOJ6Qepdqn3ygv%2Bj3PL
>uXPpx59A4K%2BJvV%2Bvr%2Bw%3D%0A&s=9304967be4698113d4f0b6adc0eed0bb98dfa135
>49560350e01afe2f97944e89
>--  
>MK  
>
>Staff Software Engineer, Pivotal/RabbitMQ


From loganathan.ms at gmail.com  Wed Aug 20 08:37:12 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Wed, 20 Aug 2014 13:07:12 +0530
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
Message-ID: <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>

Hi Michael,

I have updated the bunny gem to 1.4.0(also with master branch) and then
updated the RMQ settings with two hosts h1 & h2 provided with SSL
certificates which is valid for h2 only, latter I tried to make the
connection , but getting the below error. Ideally it should work for the
second host(d1p500tlm-prxs-podrmq-a-cert.vmware.com), can you let me know
what I am doing wrong here, for your reference listed the rmq settings

*SETTING1:*

*RMQ SETTING:*

production:
  <<: *defaults
  rmq_settings:
    host: ["D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM", "
d1p500tlm-prxs-podrmq-a-cert.vmware.com"]
    port: 5671
    vhost: vchs
    auth_mechanism: EXTERNAL
    tls: true
    tls_cert: /home/logan/git/presto/ssl/server/cert.pem
    tls_key: /home/logan/git/presto/ssl/server/key.pem
    tls_ca_certificates: ["/home/logan/git/presto/ssl/ca/ca-chain.pem"]
    verify_peer: true

*GEMFILE*:
 gem 'bunny', "1.4.0"

ERROR:

Bunny::TCPConnectionFailed: Could not establish TCP connection to ["
D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM", "
d1p500tlm-prxs-podrmq-a-cert.vmware.com"]:5671:


*SETTING2:*

*RMQ SETTING:*
production:
  <<: *defaults
  rmq_settings:
    host: ["D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM", "
d1p500tlm-prxs-podrmq-a-cert.vmware.com"]
    port: 5671
    vhost: vchs
    auth_mechanism: EXTERNAL
    tls: true
    tls_cert: /home/logan/git/presto/ssl/server/cert.pem
    tls_key: /home/logan/git/presto/ssl/server/key.pem
    tls_ca_certificates: ["/home/logan/git/presto/ssl/ca/ca-chain.pem"]
    verify_peer: true

*GEMFILE:*
 gem 'bunny', :git => 'https://github.com/ruby-amqp/bunny.git', branch:
"master"

ERROR:

Bunny::TCPConnectionFailed: Could not establish TCP connection to ["
D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM", "
d1p500tlm-prxs-podrmq-a-cert.vmware.com"]:5671:


*SETTING3: (Working perfectly)*

production:
  <<: *defaults
  rmq_settings:
    host: "d1p500tlm-prxs-podrmq-a-cert.vchslabs.vmware.com"
    port: 5671
    vhost: vchs
    auth_mechanism: EXTERNAL
    tls: true
    tls_cert: /home/logan/git/presto/ssl/server/cert.pem
    tls_key: /home/logan/git/presto/ssl/server/key.pem
    tls_ca_certificates: ["/home/logan/git/presto/ssl/ca/ca-chain.pem"]
    verify_peer: true


regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Tue, Aug 19, 2014 at 4:19 PM, Loganathan Sellapa <loganathan.ms at gmail.com
> wrote:

> HI Michael,
>
> Thanks I will try this out.
>
> regards,
> Loganathan
> Mob: +91 7760780741 | +91 9944414388
> Skype: loganathan.sellappa
> ViewMe <http://vizualize.me/loganathan>
>
>
>
> On Tue, Aug 19, 2014 at 4:15 PM, Michael Klishin <mklishin at pivotal.io>
> wrote:
>
>>
>>
>> On 19 August 2014 at 14:38:37, Loganathan Sellappa (
>> loganathan.ms at gmail.com) wrote:
>> > > Thanks is their any patch available for this feature, or is it
>> > a good way to make connection with one node and switch to other
>> > one if we get an connection error?
>>
>> Like I said before, it is common to use a proxy in front of your cluster
>> but you can try master:
>>
>> https://github.com/ruby-amqp/bunny/pull/234/files
>>
>> https://github.com/ruby-amqp/bunny/commit/091696492de801505943a70320c338ebb63dba30
>> --
>> MK
>>
>> Staff Software Engineer, Pivotal/RabbitMQ
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/2842502c/attachment.html>

From mklishin at pivotal.io  Wed Aug 20 09:03:45 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 20 Aug 2014 12:03:45 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
 <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
Message-ID: <etPan.53f4567a.643c9869.79c4@mercurio.local>

On 20 August 2014 at 11:40:07, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > host: [?]  

It should be :hosts, not :host. :host works just like before.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From loganathan.ms at gmail.com  Wed Aug 20 09:21:13 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Wed, 20 Aug 2014 13:51:13 +0530
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <etPan.53f4567a.643c9869.79c4@mercurio.local>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
 <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
 <etPan.53f4567a.643c9869.79c4@mercurio.local>
Message-ID: <CAD_i5MHAdESGU=x=DtMfCbEANUORTe8T=EdQt1UZS8w-fCYYpA@mail.gmail.com>

Hi Michael,

Thanks, but still I am not able to connect to the RMQ whenever I provide
some invalid hosts like below, the reason for this kind of testing is my
RMQ VM itself may gets down sometime in that case I want to pick the valid
one.

production:
  <<: *defaults
  rmq_settings:
    hosts:* ["*d1p500tlm-prxs-podrmq-a-cert.vchslabs.*cqom**","invalid.vchslabs.cowwwm","invalid.coswaqqwm",
"d1p500tlm-prxs-podrmq-a-cert.vchslabs.com
<http://d1p500tlm-prxs-podrmq-a-cert.vchslabs.com>","D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM
<http://D1P310TLM-PRXS-PODRMQ-A-CERT.VCHSLABS.COM>"]*
    port: 5671
    vhost: vchs
    auth_mechanism: EXTERNAL
    automatic_recovery: true
    tls: true
    tls_cert: /home/logan/git/presto/ssl/server/cert.pem
    tls_key: /home/logan/git/presto/ssl/server/key.pem
    tls_ca_certificates: ["/home/logan/git/presto/ssl/ca/ca-chain.pem"]
    verify_peer: true



Bunny::TCPConnectionFailed: Could not establish TCP connection to
d1p500tlm-prxs-podrmq-a-cert.vchslabs.cqom:5671:




regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Wed, Aug 20, 2014 at 1:33 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 20 August 2014 at 11:40:07, Loganathan Sellapa (loganathan.ms at gmail.com)
> wrote:
> > > host: [?]
>
> It should be :hosts, not :host. :host works just like before.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/03d78c54/attachment.html>

From mklishin at pivotal.io  Wed Aug 20 09:28:59 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 20 Aug 2014 12:28:59 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <CAD_i5MHAdESGU=x=DtMfCbEANUORTe8T=EdQt1UZS8w-fCYYpA@mail.gmail.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
 <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
 <etPan.53f4567a.643c9869.79c4@mercurio.local>
 <CAD_i5MHAdESGU=x=DtMfCbEANUORTe8T=EdQt1UZS8w-fCYYpA@mail.gmail.com>
Message-ID: <etPan.53f45c66.625558ec.79c4@mercurio.local>

?On 20 August 2014 at 12:21:58, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > Bunny::TCPConnectionFailed: Could not establish TCP connection  
> to ?:  

Bunny does not recover from initial failures, however, this is trivial to
do yourself:

begin
? connect
rescue?Bunny::TCPConnectionFailed => _
? sleep 5
? retry
end

or something like that. Can you try that? This feature is certainly pretty
simplistic at the moment but I expect things to work for recovery (which
handles failed connection attempts).
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From loganathan.ms at gmail.com  Wed Aug 20 09:51:18 2014
From: loganathan.ms at gmail.com (Loganathan Sellapa)
Date: Wed, 20 Aug 2014 14:21:18 +0530
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <etPan.53f45c66.625558ec.79c4@mercurio.local>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
 <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
 <etPan.53f4567a.643c9869.79c4@mercurio.local>
 <CAD_i5MHAdESGU=x=DtMfCbEANUORTe8T=EdQt1UZS8w-fCYYpA@mail.gmail.com>
 <etPan.53f45c66.625558ec.79c4@mercurio.local>
Message-ID: <CAD_i5ME1pN6-FixeNXygT4xGCprLeSK4DB3bLv=HfhME-B0k=g@mail.gmail.com>

HI Michael,

Thanks, it works.

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe <http://vizualize.me/loganathan>



On Wed, Aug 20, 2014 at 1:58 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

>  On 20 August 2014 at 12:21:58, Loganathan Sellapa (
> loganathan.ms at gmail.com) wrote:
> > > Bunny::TCPConnectionFailed: Could not establish TCP connection
> > to ?:
>
> Bunny does not recover from initial failures, however, this is trivial to
> do yourself:
>
> begin
>   connect
> rescue Bunny::TCPConnectionFailed => _
>   sleep 5
>   retry
> end
>
> or something like that. Can you try that? This feature is certainly pretty
> simplistic at the moment but I expect things to work for recovery (which
> handles failed connection attempts).
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/51a45d58/attachment.html>

From mklishin at pivotal.io  Wed Aug 20 09:53:06 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 20 Aug 2014 12:53:06 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] Re: BUNNY: How can we connect to
 RMQ cluster
In-Reply-To: <CAD_i5ME1pN6-FixeNXygT4xGCprLeSK4DB3bLv=HfhME-B0k=g@mail.gmail.com>
References: <CAD_i5MGNv3i+0SpiBwLSFbdiksL5PLFJG0J-trkiVhP=NRa+JQ@mail.gmail.com>
 <etPan.53eae95b.327b23c6.e493@mercurio.local>
 <bde1c591-4c34-421b-97cd-6f4d1b13083c@googlegroups.com>
 <etPan.53f32b02.643c9869.180db@mercurio.local>
 <CAD_i5MGdnZ5ykWU4JYowpjnC8DXsq+egbOg_-h+dMP0M17HRNQ@mail.gmail.com>
 <CAD_i5MH8N35ntS9deaCPA0m1bfTYyq=N4xOAyXUu5tvGxmBTnA@mail.gmail.com>
 <etPan.53f4567a.643c9869.79c4@mercurio.local>
 <CAD_i5MHAdESGU=x=DtMfCbEANUORTe8T=EdQt1UZS8w-fCYYpA@mail.gmail.com>
 <etPan.53f45c66.625558ec.79c4@mercurio.local>
 <CAD_i5ME1pN6-FixeNXygT4xGCprLeSK4DB3bLv=HfhME-B0k=g@mail.gmail.com>
Message-ID: <etPan.53f46211.2eb141f2.79c4@mercurio.local>



On 20 August 2014 at 12:52:04, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > Thanks, it works.

Excellent. I'll consider adding an option for reconnecting on initial
connect, unfortunately, this feature makes detecting misconfigurations
harder.

But worth considering for sure.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Wed Aug 20 10:43:58 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Wed, 20 Aug 2014 17:43:58 +0800
Subject: [rabbitmq-discuss] rabbitmq message delay
Message-ID: <tencent_3E19C3B921ECFB7209A86D67@qq.com>

1. Every 5 seconds to do a statistics.
 2. One publisher publish mssage to a direct type exchange,  One consumer subscribe all message in one queue.
 3. Use rabbitmq-c client lib.
 4. count: message count every 5 second
     avg: average delay in millisecond
     min: min delay in millisecond
     max: max delay in millisecond
  
 1.csv: publish message 10000/s, every 100 microsecond to publish 1 message.
  2.csv: publish message no rate limit, use a for loop to do it.
  
 The 1.csv delay is only 1 millisecond, but the 2.csv is need 50 millisecond!!
 Is any possible to reduce message delay?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/da815fda/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2.csv
Type: application/octet-stream
Size: 1133 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/da815fda/attachment.obj>

From w_pg at qq.com  Wed Aug 20 10:45:30 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Wed, 20 Aug 2014 17:45:30 +0800
Subject: [rabbitmq-discuss] rabbitmq message delay
In-Reply-To: <tencent_3E19C3B921ECFB7209A86D67@qq.com>
References: <tencent_3E19C3B921ECFB7209A86D67@qq.com>
Message-ID: <tencent_2ED57FD005E6ADD347A9DDAA@qq.com>

miss 1.csv.
   
 ------------------ Original ------------------
  From:  "Lost";<w_pg at qq.com>;
 Date:  Aug 20, 2014
 To:  "rabbitmq-discuss"<rabbitmq-discuss at lists.rabbitmq.com>; 
 
 Subject:  rabbitmq message delay

 

 1. Every 5 seconds to do a statistics.
 2. One publisher publish mssage to a direct type exchange,  One consumer subscribe all message in one queue.
 3. Use rabbitmq-c client lib.
 4. count: message count every 5 second
     avg: average delay in millisecond
     min: min delay in millisecond
     max: max delay in millisecond
  
 1.csv: publish message 10000/s, every 100 microsecond to publish 1 message.
  2.csv: publish message no rate limit, use a for loop to do it.
  
 The 1.csv delay is only 1 millisecond, but the 2.csv is need 50 millisecond!!
 Is any possible to reduce message delay?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/f0960a55/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 1.csv
Type: application/octet-stream
Size: 663 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/f0960a55/attachment.obj>

From mklishin at pivotal.io  Wed Aug 20 10:50:37 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 20 Aug 2014 13:50:37 +0400
Subject: [rabbitmq-discuss] rabbitmq message delay
In-Reply-To: <tencent_2ED57FD005E6ADD347A9DDAA@qq.com>
References: <tencent_3E19C3B921ECFB7209A86D67@qq.com>
 <tencent_2ED57FD005E6ADD347A9DDAA@qq.com>
Message-ID: <etPan.53f46f8b.41b71efb.79c4@mercurio.local>

On 20 August 2014 at 13:46:29, Lost (w_pg at qq.com) wrote:
> > 1.csv: publish message 10000/s, every 100 microsecond to publish  
> 1 message.
> 2.csv: publish message no rate limit, use a for loop to do it.
>  
> The 1.csv delay is only 1 millisecond, but the 2.csv is need 50  
> millisecond!!
> Is any possible to reduce message delay?

Flood publishing the broker means that you eventually will run into
flow control, which affects publishing latency. So this is largely expected.

If both your client and RabbitMQ run on the same machine, you'll also
see them competing for CPU and I/O resources. A program that publishes
in an endless loop will likely put a moderate stress on the machine,
however beefy it may be.

See?http://www.rabbitmq.com/memory.html for more information on flow
control and see RabbitMQ logs, the resource-based alarms are logged.

You can also inspect connection state in the management UI, it will show
both kinds of flow control.

Also, RabbitMQ list has moved to?
https://groups.google.com/group/rabbitmq-users?

please start new discussions there.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Aug 20 10:53:00 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Aug 2014 10:53:00 +0100
Subject: [rabbitmq-discuss] rabbitmq message delay
In-Reply-To: <tencent_3E19C3B921ECFB7209A86D67@qq.com>
References: <tencent_3E19C3B921ECFB7209A86D67@qq.com>
Message-ID: <53F46FFC.8010300@rabbitmq.com>

In future please post / subscribe to 
https://groups.google.com/forum/#!forum/rabbitmq-users, this mailing 
list is going to go away.

On 20/08/14 10:43, Lost wrote:
> The 1.csv delay is only 1 millisecond, but the 2.csv is need 50
> millisecond!!
> Is any possible to reduce message delay?

I'm not completely sure what you're measuring, but it sounds like you're 
talking about the end-to-end latency from producer to consumer.

To a large extent message rate and latency are in conflict, see the last 
chart (and discussion) at

http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

but in brief, if you send messages as fast as you can, all the internal 
buffers in RabbitMQ fill up, and it takes longer for a message to work 
its way through them. The good news is that even at 90% of the maximum 
rate, the buffers tend to stay mostly empty and latency is much lower.

You should also be aware that RabbitMQ really doesn't make any 
*guarantees* about latency; we try to keep it low but you may see 
spikes. Low-latency messaging systems generally have designs that are 
very different from RabbitMQ (summary: if the message is late, throw it 
away!).

Cheers, Simon

From brian.locke at datascan.com  Wed Aug 20 18:57:59 2014
From: brian.locke at datascan.com (Brian Locke)
Date: Wed, 20 Aug 2014 12:57:59 -0500
Subject: [rabbitmq-discuss] RabbitMQCtl status shows nodedown after
	logout/login Windows
Message-ID: <CAGepFFik9=AzfkVKOxtO9qR54-xA8pqKCCFuHVv0NKu2_d4ryw@mail.gmail.com>

I have 3 RabbitMQ servers running on 3 windows servers as a service (local
system acct) . They are clustered and are up and running. The management
console shows all up, etc.
I have the same .erlang.cookie in my c:\windows and c:\users\username
folder.

This morning I was using rabbitmqctl normally and all was good. I logged
out of the machine instead of my usual disconnect (via RDP).
When I logged back in (as same user) and run rabbitmqctl status I get the
nodedown error like it's not running. To verify I did this on a second
server and the same results occurred. The third server I have left as-is
(meaning I didn't log out) and rabbitmqctl status works just fine. It does
,however, fail when I run rabbitmqctl report.

What else am I missing in troubleshooting this?

-- 
Brian Locke | Application Architect
*Datascan* |   P: 469 208-3345  |  C: 972 672 0088 | 24/7 Support:  866 420
6949
www.datascan.com | brian.locke at datascan.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/335e54e5/attachment.html>

From aaron at agoragames.com  Wed Aug 20 19:35:03 2014
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 20 Aug 2014 14:35:03 -0400
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <CAHiEoM5aCMB7KckR3dB+De78TKN2mZ-vs2w6Vo=x23+Rwm5u1g@mail.gmail.com>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>
 <53A46A19.4090108@rabbitmq.com>
 <etPan.53a4b803.643c9869.7a81@gmr-home.local>
 <CAHiEoM5qk8u1O45a0PY5KW2J46qLqBUJiaiT5eR-4-yUQ+L1FQ@mail.gmail.com>
 <CAHiEoM5aCMB7KckR3dB+De78TKN2mZ-vs2w6Vo=x23+Rwm5u1g@mail.gmail.com>
Message-ID: <CAHiEoM6vfWH7SkHbQL4MOK_HifhyrFCrmTHv5kORS8VrZjSb-Q@mail.gmail.com>

Any update on the PPA hosting archived versions?  It's becoming very
painful to use Salt or any other CMS when we want to freeze to a specific
version. Fixing that problem would allow us to get past the issue of the
deb restarting the service.


On Wed, Jun 25, 2014 at 2:23 PM, Aaron Westendorf <aaron at agoragames.com>
wrote:

> We just discovered today that this is further complicated because the PPA
> is only hosting the current version, so Salt fails when trying to apply the
> ruleset and ensure the version we froze is installed.
>
>
> On Tue, Jun 24, 2014 at 11:28 AM, Aaron Westendorf <aaron at agoragames.com>
> wrote:
>
>> Yeah, that's what I'm getting at. Even "start on first install" has
>> problems in that there may be other preconditions yet to be set, though it
>> is less problematic than automatically restarting.
>>
>> For now, I've changed our Salt states to freeze to a specific version so
>> that we won't be surprised by a process restart.
>>
>>
>> On Fri, Jun 20, 2014 at 6:38 PM, Gavin M. Roy <gavinmroy at gmail.com>
>> wrote:
>>
>>> I believe he's saying that when you install the deb (or upgrade it) it
>>> automatically starts or restarts rabbitmq-server, causing less than
>>> desirable behavior.
>>>
>>> From: Simon MacMullen simon at rabbitmq.com
>>> Reply: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com
>>> Date: June 20, 2014 at 1:07:33 PM
>>> To: Discussions about RabbitMQ rabbitmq-discuss at lists.rabbitmq.com, Aaron
>>> Westendorf aaron at agoragames.com
>>> Subject:  Re: [rabbitmq-discuss] PPA debs restart rabbit
>>>
>>> On 17/06/14 15:54, Aaron Westendorf wrote:
>>> > We're using the PPA for rabbit but the current debian files are not
>>> > suitable for production deployments because they stop and restart the
>>> > process. I understand the desire to start the process if it was not
>>> > already running, but embedding the restart logic in the deb means that
>>> > users have no control over the process. As it is very common to use
>>> the
>>> > PPA within the context of a configuration management system (Salt,
>>> Chef,
>>> > etc), it would be best to leave that decision up to the user.
>>>
>>> What do you mean by "restart logic"?
>>>
>>> I could see the point in adding some START_THE_SERVER variable to
>>> /etc/default/rabbitmq-server, would that help?
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, Pivotal
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>> --
>> Aaron Westendorf
>> Lead Engineer | Agora Games
>> aaron at agoragames.com
>>
>
>
>
> --
> Aaron Westendorf
> Lead Engineer | Agora Games
> aaron at agoragames.com
>



-- 
Aaron Westendorf
Lead Engineer | Agora Games
aaron at agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140820/27a9584f/attachment.html>

From simon at rabbitmq.com  Thu Aug 21 10:23:48 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Aug 2014 10:23:48 +0100
Subject: [rabbitmq-discuss] RabbitMQCtl status shows nodedown after
 logout/login Windows
In-Reply-To: <CAGepFFik9=AzfkVKOxtO9qR54-xA8pqKCCFuHVv0NKu2_d4ryw@mail.gmail.com>
References: <CAGepFFik9=AzfkVKOxtO9qR54-xA8pqKCCFuHVv0NKu2_d4ryw@mail.gmail.com>
Message-ID: <53F5BAA4.4060907@rabbitmq.com>

(This mailing list is going away: you might want to post to the 
rabbitmq-users Google group in future.)

On 20/08/14 18:57, Brian Locke wrote:
> What else am I missing in troubleshooting this?

Which version of RabbitMQ are you running? What error messages are you 
seeing? 3.3.x should give reasonably sensible diagnostics in this situation.

> I have the same .erlang.cookie in my c:\windows and c:\users\username folder.

You might check that it's getting picked up - check the log file for a 
hash of the cookie used by the server, check the output of a rabbitmqctl 
failure for a hash of the cookie used by rabbitmqctl.

Cheers, Simon


From simon at rabbitmq.com  Thu Aug 21 10:26:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Aug 2014 10:26:46 +0100
Subject: [rabbitmq-discuss] PPA debs restart rabbit
In-Reply-To: <CAHiEoM6vfWH7SkHbQL4MOK_HifhyrFCrmTHv5kORS8VrZjSb-Q@mail.gmail.com>
References: <CAHiEoM5aurp4QxuDQ-+XbJ8W8HgMCDprNqQCzH8Cu_sv+3-SkA@mail.gmail.com>	<53A46A19.4090108@rabbitmq.com>	<etPan.53a4b803.643c9869.7a81@gmr-home.local>	<CAHiEoM5qk8u1O45a0PY5KW2J46qLqBUJiaiT5eR-4-yUQ+L1FQ@mail.gmail.com>	<CAHiEoM5aCMB7KckR3dB+De78TKN2mZ-vs2w6Vo=x23+Rwm5u1g@mail.gmail.com>
 <CAHiEoM6vfWH7SkHbQL4MOK_HifhyrFCrmTHv5kORS8VrZjSb-Q@mail.gmail.com>
Message-ID: <53F5BB56.4080609@rabbitmq.com>

I'm afraid we haven't had time to work on this.

Cheers, Simon

On 20/08/14 19:35, Aaron Westendorf wrote:
> Any update on the PPA hosting archived versions?  It's becoming very
> painful to use Salt or any other CMS when we want to freeze to a
> specific version. Fixing that problem would allow us to get past the
> issue of the deb restarting the service.
>
>
> On Wed, Jun 25, 2014 at 2:23 PM, Aaron Westendorf <aaron at agoragames.com
> <mailto:aaron at agoragames.com>> wrote:
>
>     We just discovered today that this is further complicated because
>     the PPA is only hosting the current version, so Salt fails when
>     trying to apply the ruleset and ensure the version we froze is
>     installed.
>
>
>     On Tue, Jun 24, 2014 at 11:28 AM, Aaron Westendorf
>     <aaron at agoragames.com <mailto:aaron at agoragames.com>> wrote:
>
>         Yeah, that's what I'm getting at. Even "start on first install"
>         has problems in that there may be other preconditions yet to be
>         set, though it is less problematic than automatically restarting.
>
>         For now, I've changed our Salt states to freeze to a specific
>         version so that we won't be surprised by a process restart.
>
>
>         On Fri, Jun 20, 2014 at 6:38 PM, Gavin M. Roy
>         <gavinmroy at gmail.com <mailto:gavinmroy at gmail.com>> wrote:
>
>             I believe he?s saying that when you install the deb (or
>             upgrade it) it automatically starts or restarts
>             rabbitmq-server, causing less than desirable behavior.
>
>             From: Simon MacMullen simon at rabbitmq.com
>             <mailto:simon at rabbitmq.com>
>             Reply: Discussions about RabbitMQ
>             rabbitmq-discuss at lists.rabbitmq.com
>             <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>             Date: June 20, 2014 at 1:07:33 PM
>             To: Discussions about RabbitMQ
>             rabbitmq-discuss at lists.rabbitmq.com
>             <mailto:rabbitmq-discuss at lists.rabbitmq.com>, Aaron
>             Westendorf aaron at agoragames.com <mailto:aaron at agoragames.com>
>             Subject: Re: [rabbitmq-discuss] PPA debs restart rabbit
>
>>             On 17/06/14 15:54, Aaron Westendorf wrote:
>>             > We're using the PPA for rabbit but the current debian files are not
>>             > suitable for production deployments because they stop and restart the
>>             > process. I understand the desire to start the process if it was not
>>             > already running, but embedding the restart logic in the deb means that
>>             > users have no control over the process. As it is very common to use the
>>             > PPA within the context of a configuration management system (Salt, Chef,
>>             > etc), it would be best to leave that decision up to the user.
>>
>>             What do you mean by "restart logic"?
>>
>>             I could see the point in adding some START_THE_SERVER
>>             variable to
>>             /etc/default/rabbitmq-server, would that help?
>>
>>             Cheers, Simon
>>
>>             --
>>             Simon MacMullen
>>             RabbitMQ, Pivotal
>>             _______________________________________________
>>             rabbitmq-discuss mailing list
>>             rabbitmq-discuss at lists.rabbitmq.com
>>             <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>             https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
>
>         --
>         Aaron Westendorf
>         Lead Engineer | Agora Games
>         aaron at agoragames.com <mailto:aaron at agoragames.com>
>
>
>
>
>     --
>     Aaron Westendorf
>     Lead Engineer | Agora Games
>     aaron at agoragames.com <mailto:aaron at agoragames.com>
>
>
>
>
> --
> Aaron Westendorf
> Lead Engineer | Agora Games
> aaron at agoragames.com <mailto:aaron at agoragames.com>


From Ashish.Ojha at gs.com  Mon Aug 25 08:43:24 2014
From: Ashish.Ojha at gs.com (Ojha, Ashish)
Date: Mon, 25 Aug 2014 03:43:24 -0400
Subject: [rabbitmq-discuss] SSL connection
Message-ID: <980BAC4805366740ABBFA255D60D36A1342B519FAF@GSCMAMP16EX.firmwide.corp.gs.com>

Hi Team ,

I have a question regarding SSL connection implementation in RabbitMQ , currently there are three important parameters a RabbitMQ broker needs to enabled SSL connection :


-          Root Certificate Chain

-          Server Certificate .

-          Server private Key .

{rabbit, [
        {tcp_listeners, [2000]},
        {loopback_users, []},
        {ssl_listeners, [2001]},
        {ssl_options, [{cacertfile, "/var/opt/rabbitmq-3.3.0/broker-1/CA.pem"},
                  {certfile, "/var/opt/rabbitmq-3.3.0/broker-1/cert.pem"},
                  {keyfile, "/var/opt/rabbitmq-3.3.0/broker-1/serverKey.pem"},
                  {verify, verify_peer},
                  {fail_if_no_peer_cert, true}]}

Question :


n  Is it mandatory to have the server certificates and private key configured in RabbitMQ broker ?

n  Can I just have the Root Certificate chain in the RabbitMQ broker  ?

n  My requirement is to only have the Client Certificates been verified by the RabbitMQ broker....NOT server certificates verified by the clients ...

n  I don't want to manage the server certificates and private keys ....just manage the Root Certificates ...is it possible ?

The Goldman Sachs Group, Inc. All rights reserved.
See http://www.gs.com/disclaimer/global_email for important risk disclosures, conflicts of interest and other terms and conditions relating to this e-mail and your reliance on information contained in it.  This message may contain confidential or privileged information.  If you are not the intended recipient, please advise us immediately and delete this message.  See http://www.gs.com/disclaimer/email for further information on confidentiality and the risks of non-secure electronic communication.  If you cannot access these links, please notify us by reply message and we will send the contents to you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140825/c5b3b21f/attachment.html>

From mklishin at pivotal.io  Mon Aug 25 09:41:31 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Mon, 25 Aug 2014 12:41:31 +0400
Subject: [rabbitmq-discuss] SSL connection
In-Reply-To: <980BAC4805366740ABBFA255D60D36A1342B519FAF@GSCMAMP16EX.firmwide.corp.gs.com>
References: <980BAC4805366740ABBFA255D60D36A1342B519FAF@GSCMAMP16EX.firmwide.corp.gs.com>
Message-ID: <etPan.53faf6d9.6b8b4567.95e8@mercurio.local>

This list has moved to rabbitmq-users:
https://groups.google.com/forum/#!forum/rabbitmq-users

Please start new discussions there.

On 25 August 2014 at 11:44:36, Ojha, Ashish (ashish.ojha at gs.com) wrote:
> >
> n Is it mandatory to have the server certificates and private 
> key configured in RabbitMQ broker ?

Yes.

> n Can I just have the Root Certificate chain in the RabbitMQ broker 
> ?

No.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From purushottam.tiwary at gmail.com  Mon Aug 25 12:54:05 2014
From: purushottam.tiwary at gmail.com (Purushottam tiwary)
Date: Mon, 25 Aug 2014 17:24:05 +0530
Subject: [rabbitmq-discuss] AMQP version to be used for rabbitmq-3.2.4
Message-ID: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>

Hi Team,

Which AMQP verison library is supported for rabbitmq-3.2.4. Please guide.

Thanks
Purushottam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140825/9c36edd4/attachment.html>

From videlalvaro at gmail.com  Mon Aug 25 12:57:07 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 25 Aug 2014 13:57:07 +0200
Subject: [rabbitmq-discuss] AMQP version to be used for rabbitmq-3.2.4
In-Reply-To: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
References: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
Message-ID: <CAMcAHLXN-2mXZNxxXL=rPF4ppxV+qY2zYemP21iLydsnb6aYTw@mail.gmail.com>

Hi,

What programming language are you using?

Regards,

Alvaro


On Mon, Aug 25, 2014 at 1:54 PM, Purushottam tiwary <
purushottam.tiwary at gmail.com> wrote:

> Hi Team,
>
> Which AMQP verison library is supported for rabbitmq-3.2.4. Please guide.
>
> Thanks
> Purushottam
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140825/64ab2178/attachment.html>

From mklishin at pivotal.io  Mon Aug 25 13:02:13 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Mon, 25 Aug 2014 16:02:13 +0400
Subject: [rabbitmq-discuss] AMQP version to be used for rabbitmq-3.2.4
In-Reply-To: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
References: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
Message-ID: <etPan.53fb25e2.46e87ccd.95e8@mercurio.local>

This list has moved to rabbitmq-users, please start all new discussions
there:

https://groups.google.com/forum/#!forum/rabbitmq-users?

On 25 August 2014 at 15:56:18, Purushottam tiwary (purushottam.tiwary at gmail.com) wrote:
> > Which AMQP verison library is supported for rabbitmq-3.2.4.  

Any AMQP 0-9-1 client, which most maintained libraries these days are,
will work with RabbitMQ 2.0+:

?* Java client and all clients that are based on it
?* .NET client
?* All Ruby clients
?* Pika (Python)
?* amqp.node (JS)

I'm not quite sure if librabbitmq-c uses 0-9-1 but it is certainly compatible.

If you are looking for commercial support from Pivotal, only Java and .NET
clients have commercial support.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From purushottam.tiwary at gmail.com  Mon Aug 25 13:05:22 2014
From: purushottam.tiwary at gmail.com (Purushottam tiwary)
Date: Mon, 25 Aug 2014 17:35:22 +0530
Subject: [rabbitmq-discuss] AMQP version to be used for rabbitmq-3.2.4
In-Reply-To: <CAMcAHLXN-2mXZNxxXL=rPF4ppxV+qY2zYemP21iLydsnb6aYTw@mail.gmail.com>
References: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
 <CAMcAHLXN-2mXZNxxXL=rPF4ppxV+qY2zYemP21iLydsnb6aYTw@mail.gmail.com>
Message-ID: <CAGSUH9-mKgvhQim2UwVqmiJd=y6nY7PrxDHTfk4ciGzw=VKqJw@mail.gmail.com>

Perl and Python apps on openshift


On Mon, Aug 25, 2014 at 5:27 PM, Alvaro Videla <videlalvaro at gmail.com>
wrote:

> Hi,
>
> What programming language are you using?
>
> Regards,
>
> Alvaro
>
>
> On Mon, Aug 25, 2014 at 1:54 PM, Purushottam tiwary <
> purushottam.tiwary at gmail.com> wrote:
>
>> Hi Team,
>>
>> Which AMQP verison library is supported for rabbitmq-3.2.4. Please guide.
>>
>> Thanks
>> Purushottam
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list has moved to
>> https://groups.google.com/forum/#!forum/rabbitmq-users,
>> please subscribe to the new list!
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140825/b6e335a5/attachment.html>

From mklishin at pivotal.io  Mon Aug 25 13:14:48 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Mon, 25 Aug 2014 16:14:48 +0400
Subject: [rabbitmq-discuss] AMQP version to be used for rabbitmq-3.2.4
In-Reply-To: <CAGSUH9-mKgvhQim2UwVqmiJd=y6nY7PrxDHTfk4ciGzw=VKqJw@mail.gmail.com>
References: <CAGSUH99mzzELUxRuDqaZB-ftiWOXYG85BT6Bqq7DgN-Jaep0ig@mail.gmail.com>
 <CAMcAHLXN-2mXZNxxXL=rPF4ppxV+qY2zYemP21iLydsnb6aYTw@mail.gmail.com>
 <CAGSUH9-mKgvhQim2UwVqmiJd=y6nY7PrxDHTfk4ciGzw=VKqJw@mail.gmail.com>
Message-ID: <etPan.53fb28d5.3d1b58ba.95e8@mercurio.local>

On 25 August 2014 at 16:07:34, Purushottam tiwary (purushottam.tiwary at gmail.com) wrote:
> > Perl and Python apps on openshift

Our tutorials use Pika and RabbitFoot. They are the clients ?we'd recommend.

See?http://www.rabbitmq.com/devtools.html for future references.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Tue Aug 26 16:59:53 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 08:59:53 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
Message-ID: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>

Hi

Can someone please let us know wht we need to do ?

we are getting out of memory errors in the rabbitmq 3.2.4 when we are
trying to access rabbitmq on port 15672 using connections api . The script
calls curl via shell console.

curl -i -s --connect-timeout 5 -u admin:changeme http://
$hostname1:15672/api/connections?columns=node,name

This curl call is made from many hosts at same to get the number of
connections running on rabbitmq and we see the connections are blocked on
this port.

netstat -tan | grep ':15672' | awk '{print $6 }' | sort | uniq -c
      3 CLOSE_WAIT
   1882 ESTABLISHED
      1 LISTEN
     10 TIME_WAIT

Thanks
Srikanth

Logs show this:

vm_memory_high_watermark set. Memory used:14888001288  allowed:11753753804

=WARNING REPORT==== 26-Aug-2014::05:58:18  ===
memory resource limit alarm set on node  rabbit at adsmv0019.

**********************************************************
***  Publishers will be blocked until this alarm clears  ***
**********************************************************


=INFO REPORT====  26-Aug-2014::05:58:20 ===
vm_memory_high_watermark clear. Memory  used:8686452200 allowed:11753753804
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/e6ac2fb4/attachment.html>

From mklishin at pivotal.io  Tue Aug 26 19:07:00 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 22:07:00 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
Message-ID: <etPan.53fccce2.74b0dc51.b58a@mercurio.local>

On 26 August 2014 at 20:02:09, srikanth tns (srikanthtns at gmail.com) wrote:
> > Logs show this:
>  
> vm_memory_high_watermark set. Memory used:14888001288
> allowed:11753753804
>  
> =WARNING REPORT==== 26-Aug-2014::05:58:18  
> ===
> memory resource limit alarm set on node rabbit at adsmv0019.
>  
> **********************************************************  
> *** Publishers will be blocked until this alarm clears ***
> **********************************************************  
>  
>  
> =INFO REPORT==== 26-Aug-2014::05:58:20  
> ===
> vm_memory_high_watermark clear. Memory used:8686452200
> allowed:11753753804

Use rabbitmqctl report or management UI (node info page) ?to find out what takes memory.

Then either eliminate that thing (likely it is messages in the queue,
there is a fixed RAM cost per message: the queue index entry(-ies))
or bump the watermark.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 19:42:27 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 22:42:27 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
Message-ID: <etPan.53fcd531.625558ec.b58a@mercurio.local>

On 26 August 2014 at 20:02:09, srikanth tns (srikanthtns at gmail.com) wrote:
> > netstat -tan | grep ':15672' | awk '{print $6 }' | sort | uniq -c  
> 3 CLOSE_WAIT
> 1882 ESTABLISHED
> 1 LISTEN
> 10 TIME_WAIT

That's about 1900 concurrent connections to a single node. Without knowing
how many channels can be open on the open ones, that's still a fairly
large number for a single node.

Consider clustering this node with a couple more and spread the connections
between them, e.g. using an HAproxy instance in front of the cluster.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 19:43:08 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 22:43:08 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
Message-ID: <etPan.53fcd559.238e1f29.b58a@mercurio.local>

On 26 August 2014 at 20:02:09, srikanth tns (srikanthtns at gmail.com) wrote:
> > Thanks
> Srikanth

Also: this list has moved to rabbitmq-users:
https://groups.google.com/forum/#!forum/rabbitmq-users?

Please start all new discussions there.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Tue Aug 26 19:47:28 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 11:47:28 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fcd531.625558ec.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
Message-ID: <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>

The UI is not accessible , The 3-nodes are clustered with HA two policy

rabbitmqctl reports shows

Reporting server status on {{2014,8,26},{18,39,31}}

 ...
Status of node rabbit at adsmv0020 ...
[{pid,22153},
 {running_applications,
     [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
      {rabbit,"RabbitMQ","3.2.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
      {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,2285543720},
      {connection_procs,207275088},
      {queue_procs,599282104},
      {plugins,234739776},
      {other_proc,309911344},
      {mnesia,289075584},
      {mgmt_db,9096},
      {msg_index,14688048},
      {other_ets,28236624},
      {binary,290512400},
      {code,17776116},
      {atom,1621321},
      {other_system,292416219}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,11753753804},
 {disk_free_limit,1000000000},
 {disk_free,19386892288},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,3137},
      {sockets_limit,294819},
      {sockets_used,3135}]},
 {processes,[{limit,1048576},{used,144321}]},
 {run_queue,0},
 {uptime,6267}]


Cluster status of node rabbit at adsmv0020 ...
[{nodes,[{disc,[rabbit at adsmv0019,rabbit at adsmv0018]},{ram,[rabbit at adsmv0020
]}]},
 {running_nodes,[rabbit at adsmv0018,rabbit at adsmv0019,rabbit at adsmv0020]},
 {partitions,[]}]

Application environment of node rabbit at adsmv0020 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {cluster_partition_handling,autoheal},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020.log"}},
 {frame_max,131072},
 {halt_on_upgrade_failure,true},
 {heartbeat,580},
 {hipe_compile,false},
 {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,

rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,

rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0020-plugins-expand
"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,true},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020-sasl.log"}},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020-sasl.log"}},
 {server_properties,[]},
 {ssl_apps,[asn1,crypto,public_key,ssl]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_high_watermark_paging_ratio,0.7}]

Status of node rabbit at adsmv0019 ...
[{pid,27139},
 {running_applications,
     [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
      {rabbit,"RabbitMQ","3.2.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
      {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,2375638736},
      {connection_procs,228104952},
      {queue_procs,643238504},
      {plugins,259036872},
      {other_proc,276878920},
      {mnesia,288547136},
      {mgmt_db,9096},
      {msg_index,14503600},
      {other_ets,30000664},
      {binary,321298960},
      {binary,321298960},
      {code,17776116},
      {atom,1621321},
      {other_system,294622595}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,11753753804},
 {disk_free_limit,1000000000},
 {disk_free,19439706112},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,3466},
      {sockets_limit,294819},
      {sockets_used,3464}]},
 {processes,[{limit,1048576},{used,159459}]},
 {run_queue,0},
 {uptime,6302}]

Cluster status of node rabbit at adsmv0019 ...
[{nodes,[{disc,[rabbit at adsmv0018,rabbit at adsmv0019]},{ram,[rabbit at adsmv0020
]}]},
 {running_nodes,[rabbit at adsmv0020,rabbit at adsmv0018,rabbit at adsmv0019]},
 {partitions,[]}]

Application environment of node rabbit at adsmv0019 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {cluster_partition_handling,autoheal},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0019.log"}},
 {frame_max,131072},
 {halt_on_upgrade_failure,true},
 {heartbeat,580},
 {hipe_compile,false},
 {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,

rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,

rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0019-plugins-expand
"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,true},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0019-sasl.log"}},
 {server_properties,[]},
 {ssl_apps,[asn1,crypto,public_key,ssl]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_high_watermark_paging_ratio,0.7}]

Status of node rabbit at adsmv0018 ...
[{pid,20727},
 {running_applications,
     [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
      {rabbit,"RabbitMQ","3.2.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
      {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,6095435856},
      {connection_procs,185360136},
      {queue_procs,526782896},
      {plugins,-1872186488},
      {other_proc,2447546120},
      {mnesia,289695904},
      {mgmt_db,3870226464},
      {msg_index,23253920},
      {other_ets,51366128},
      {binary,249989160},
      {code,17776116},
      {atom,1622129},
      {other_system,304003371}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,11753753804},
 {disk_free_limit,1000000000},
 {disk_free,19338166272},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,2748},
      {sockets_limit,294819},
      {sockets_used,2746}]},
 {processes,[{limit,1048576},{used,126430}]},
 {run_queue,0},
 {uptime,6789}]

Cluster status of node rabbit at adsmv0018 ...
[{nodes,[{disc,[rabbit at adsmv0018,rabbit at adsmv0019]},{ram,[rabbit at adsmv0020
]}]},
 {running_nodes,[rabbit at adsmv0020,rabbit at adsmv0019,rabbit at adsmv0018]},
 {partitions,[]}]

Application environment of node rabbit at adsmv0018 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {cluster_partition_handling,autoheal},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0018.log"}},
 {frame_max,131072},
 {halt_on_upgrade_failure,true},
 {heartbeat,580},
 {hipe_compile,false},
 {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
                rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
                rabbit_basic,rabbit_event,lists,queue,priority_queue,
                rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
                rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
                rabbit_amqqueue_process,rabbit_variable_queue,

rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
                sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,

rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
                file_handle_cache,rabbit_msg_store,array,
                rabbit_msg_store_ets_index,rabbit_msg_file,

rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,

mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
                ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
                ssl]},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0018-plugins-expand
"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,true},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0018-sasl.log"}},
 {server_properties,[]},
 {ssl_apps,[asn1,crypto,public_key,ssl]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_high_watermark_paging_ratio,0.7}]




On Tue, Aug 26, 2014 at 11:42 AM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 26 August 2014 at 20:02:09, srikanth tns (srikanthtns at gmail.com) wrote:
> > > netstat -tan | grep ':15672' | awk '{print $6 }' | sort | uniq -c
> > 3 CLOSE_WAIT
> > 1882 ESTABLISHED
> > 1 LISTEN
> > 10 TIME_WAIT
>
> That's about 1900 concurrent connections to a single node. Without knowing
> how many channels can be open on the open ones, that's still a fairly
> large number for a single node.
>
> Consider clustering this node with a couple more and spread the connections
> between them, e.g. using an HAproxy instance in front of the cluster.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/43a33528/attachment.html>

From mcintoshj at gmail.com  Tue Aug 26 19:59:08 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 26 Aug 2014 13:59:08 -0500
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
Message-ID: <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>

Looking at your memory:
 {memory,
     [{total,6095435856},
      {connection_procs,185360136}, 185MB
      {queue_procs,526782896}, 526MB
      {plugins,-1872186488},
      {other_proc,2447546120}, 2447MB
      {mnesia,289695904}, 290MB
      {mgmt_db,3870226464},3870MB
      {msg_index,23253920},23MB
      {other_ets,51366128},51MB
      {binary,249989160},250MB
      {code,   17776116},17MB
      {atom,1622129}, 1MB
      {other_system,304003371}304MB

It appears your available memory is about 12GB available, .07 * of that
would mean about 8GB available, and you're using right at that from all I'm
seeing.  I could be mis-understanding a parameter.  But it looks like you
have a LOT of queues, and then a LOT of statistics on those queues -
perhaps reducing the statistics gathering rate or some other tuning might
help?
Jason


On Tue, Aug 26, 2014 at 1:47 PM, srikanth tns <srikanthtns at gmail.com> wrote:

> The UI is not accessible , The 3-nodes are clustered with HA two policy
>
> rabbitmqctl reports shows
>
> Reporting server status on {{2014,8,26},{18,39,31}}
>
>  ...
> Status of node rabbit at adsmv0020 ...
> [{pid,22153},
>  {running_applications,
>      [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
>       {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
>       {rabbit,"RabbitMQ","3.2.4"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
>       {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
>       {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,2285543720},
>       {connection_procs,207275088},
>       {queue_procs,599282104},
>       {plugins,234739776},
>       {other_proc,309911344},
>       {mnesia,289075584},
>       {mgmt_db,9096},
>       {msg_index,14688048},
>       {other_ets,28236624},
>       {binary,290512400},
>       {code,17776116},
>       {atom,1621321},
>       {other_system,292416219}]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_limit,11753753804},
>  {disk_free_limit,1000000000},
>  {disk_free,19386892288},
>  {file_descriptors,
>      [{total_limit,327579},
>       {total_used,3137},
>       {sockets_limit,294819},
>       {sockets_used,3135}]},
>  {processes,[{limit,1048576},{used,144321}]},
>  {run_queue,0},
>  {uptime,6267}]
>
>
> Cluster status of node rabbit at adsmv0020 ...
> [{nodes,[{disc,[rabbit at adsmv0019,rabbit at adsmv0018]},{ram,[rabbit at adsmv0020
> ]}]},
>  {running_nodes,[rabbit at adsmv0018,rabbit at adsmv0019,rabbit at adsmv0020]},
>  {partitions,[]}]
>
> Application environment of node rabbit at adsmv0020 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,{[],disc}},
>  {cluster_partition_handling,autoheal},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020.log"}},
>  {frame_max,131072},
>  {halt_on_upgrade_failure,true},
>  {heartbeat,580},
>  {hipe_compile,false},
>  {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
>                 rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                 rabbit_basic,rabbit_event,lists,queue,priority_queue,
>
> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>                 rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>                 rabbit_amqqueue_process,rabbit_variable_queue,
>
> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>                 sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>
> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>                 file_handle_cache,rabbit_msg_store,array,
>                 rabbit_msg_store_ets_index,rabbit_msg_file,
>
> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>
> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>
> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>                 ssl]},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0020-plugins-expand
> "},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,true},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020-sasl.log"}},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0020-sasl.log"}},
>  {server_properties,[]},
>  {ssl_apps,[asn1,crypto,public_key,ssl]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_high_watermark_paging_ratio,0.7}]
>
> Status of node rabbit at adsmv0019 ...
> [{pid,27139},
>  {running_applications,
>      [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
>       {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
>       {rabbit,"RabbitMQ","3.2.4"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
>       {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
>       {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,2375638736},
>       {connection_procs,228104952},
>       {queue_procs,643238504},
>       {plugins,259036872},
>       {other_proc,276878920},
>       {mnesia,288547136},
>       {mgmt_db,9096},
>       {msg_index,14503600},
>       {other_ets,30000664},
>       {binary,321298960},
>       {binary,321298960},
>       {code,17776116},
>       {atom,1621321},
>       {other_system,294622595}]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_limit,11753753804},
>  {disk_free_limit,1000000000},
>  {disk_free,19439706112},
>  {file_descriptors,
>      [{total_limit,327579},
>       {total_used,3466},
>       {sockets_limit,294819},
>       {sockets_used,3464}]},
>  {processes,[{limit,1048576},{used,159459}]},
>  {run_queue,0},
>  {uptime,6302}]
>
> Cluster status of node rabbit at adsmv0019 ...
> [{nodes,[{disc,[rabbit at adsmv0018,rabbit at adsmv0019]},{ram,[rabbit at adsmv0020
> ]}]},
>  {running_nodes,[rabbit at adsmv0020,rabbit at adsmv0018,rabbit at adsmv0019]},
>  {partitions,[]}]
>
> Application environment of node rabbit at adsmv0019 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,{[],disc}},
>  {cluster_partition_handling,autoheal},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0019.log"}},
>  {frame_max,131072},
>  {halt_on_upgrade_failure,true},
>  {heartbeat,580},
>  {hipe_compile,false},
>  {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
>                 rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                 rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                 rabbit_basic,rabbit_event,lists,queue,priority_queue,
>
> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>                 rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>                 rabbit_amqqueue_process,rabbit_variable_queue,
>
> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>                 sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>
> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>                 file_handle_cache,rabbit_msg_store,array,
>                 rabbit_msg_store_ets_index,rabbit_msg_file,
>
> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>
> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>
> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>                 ssl]},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0019-plugins-expand
> "},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,true},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0019-sasl.log"}},
>  {server_properties,[]},
>  {ssl_apps,[asn1,crypto,public_key,ssl]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_high_watermark_paging_ratio,0.7}]
>
> Status of node rabbit at adsmv0018 ...
> [{pid,20727},
>  {running_applications,
>      [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
>       {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
>       {rabbit,"RabbitMQ","3.2.4"},
>       {os_mon,"CPO  CXC 138 46","2.2.7"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
>       {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
>       {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
>       {xmerl,"XML parser","1.2.10"},
>       {inets,"INETS  CXC 138 49","5.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.5"},
>       {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.10"},
>       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,6095435856},
>       {connection_procs,185360136},
>       {queue_procs,526782896},
>       {plugins,-1872186488},
>       {other_proc,2447546120},
>       {mnesia,289695904},
>       {mgmt_db,3870226464},
>       {msg_index,23253920},
>       {other_ets,51366128},
>       {binary,249989160},
>       {code,17776116},
>       {atom,1622129},
>       {other_system,304003371}]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_limit,11753753804},
>  {disk_free_limit,1000000000},
>  {disk_free,19338166272},
>  {file_descriptors,
>      [{total_limit,327579},
>       {total_used,2748},
>       {sockets_limit,294819},
>       {sockets_used,2746}]},
>  {processes,[{limit,1048576},{used,126430}]},
>  {run_queue,0},
>  {uptime,6789}]
>
> Cluster status of node rabbit at adsmv0018 ...
> [{nodes,[{disc,[rabbit at adsmv0018,rabbit at adsmv0019]},{ram,[rabbit at adsmv0020
> ]}]},
>  {running_nodes,[rabbit at adsmv0020,rabbit at adsmv0019,rabbit at adsmv0018]},
>  {partitions,[]}]
>
> Application environment of node rabbit at adsmv0018 ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,{[],disc}},
>  {cluster_partition_handling,autoheal},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {disk_free_limit,1000000000},
>  {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0018.log"}},
>  {frame_max,131072},
>  {halt_on_upgrade_failure,true},
>  {heartbeat,580},
>  {hipe_compile,false},
>  {hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
>                 rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
>                 rabbit_basic,rabbit_event,lists,queue,priority_queue,
>
> rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
>                 rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
>                 rabbit_amqqueue_process,rabbit_variable_queue,
>
> rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
>                 sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
>
> rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
>                 file_handle_cache,rabbit_msg_store,array,
>                 rabbit_msg_store_ets_index,rabbit_msg_file,
>
> rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
>
> mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
>
> ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
>                 ssl]},
>  {included_applications,[]},
>  {log_levels,[{connection,info}]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>
>  {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"},
>
>  {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at adsmv0018-plugins-expand
> "},
>  {queue_index_max_journal_entries,65536},
>  {reverse_dns_lookups,true},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at adsmv0018-sasl.log"}},
>  {server_properties,[]},
>  {ssl_apps,[asn1,crypto,public_key,ssl]},
>  {ssl_cert_login_from,distinguished_name},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {linger,{true,0}},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.7},
>  {vm_memory_high_watermark_paging_ratio,0.7}]
>
>
>
>
> On Tue, Aug 26, 2014 at 11:42 AM, Michael Klishin <mklishin at pivotal.io>
> wrote:
>
>> On 26 August 2014 at 20:02:09, srikanth tns (srikanthtns at gmail.com)
>> wrote:
>> > > netstat -tan | grep ':15672' | awk '{print $6 }' | sort | uniq -c
>> > 3 CLOSE_WAIT
>> > 1882 ESTABLISHED
>> > 1 LISTEN
>> > 10 TIME_WAIT
>>
>> That's about 1900 concurrent connections to a single node. Without knowing
>> how many channels can be open on the open ones, that's still a fairly
>> large number for a single node.
>>
>> Consider clustering this node with a couple more and spread the
>> connections
>> between them, e.g. using an HAproxy instance in front of the cluster.
>> --
>> MK
>>
>> Staff Software Engineer, Pivotal/RabbitMQ
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/7bb1ce56/attachment.html>

From mklishin at pivotal.io  Tue Aug 26 20:01:16 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 23:01:16 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
Message-ID: <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>

On 26 August 2014 at 22:59:09, Jason McIntosh (mcintoshj at gmail.com) wrote:
> {mgmt_db,3870226464},3870MB

Thanks, Jason. ?So here's our key offender.

Besides memory leaks that are fixed in the statistics DB from time to time,
you can turn off fine grained stats. This should drastically reduce the
amount of RAM used by the stats database.

See?http://rabbitmq.com/management.html.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 20:18:13 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 19:18:13 +0000
Subject: [rabbitmq-discuss] Queue will not delete
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>

Hi all,

I have a queue that won't delete in RabbitMQ 3.2.4.  When I try to access it via the management plug-in, I get:


TypeError: Cannot read property 'ram_msg_count' of undefined

TypeError: Cannot read property 'ram_msg_count' of undefined
And nothing displays.  When I try to delete it via the API, it hangs and I get a timeout.  I can list the queue via the API, but policies don't apply to the queue, and message counts show as "?" in the management plug-in.  I tried having the cluster forget the node that owned the queue, but it remained despite this.  I bypassed the VIP and connected directly to the API on the node itself, and it gave the same results.  Additionally, nothing was noted in the normal or SASL logs to denote the attempt - the only way you can even tell I was there was the access log from the management plug-in.  I ran rabbitmqctl report, and am attaching what I got, but it keeps freezing partway through, which I'm guessing is it trying to access whatever is stuck.

As always, any help you can provide is appreciated.

Thanks,
Kale
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/f1cbecfb/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: report.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/f1cbecfb/attachment.txt>

From mklishin at pivotal.io  Tue Aug 26 20:23:42 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 23:23:42 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
Message-ID: <etPan.53fcded9.2eb141f2.b58a@mercurio.local>

This list has moved to rabbitmq-users. Please start all new discussions there:
https://groups.google.com/forum/#!forum/rabbitmq-users?

On 26 August 2014 at 23:21:49, Ganann, Kale (kganann at kroll.com) wrote:
> > I have a queue that won?t delete in RabbitMQ 3.2.4.

Sounds like bug?26180 which was fixed in 3.3.2:
http://www.rabbitmq.com/release-notes/README-3.3.2.txt
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Tue Aug 26 20:45:36 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 12:45:36 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
Message-ID: <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>

what are the changes we see on the UI statistics ? I have applied it on our
test instances and see one of the main charts for message rates is gone.
Currently we are servicing 10800 nodes on rabbitmq clustered and load
balanced on 3 nodes with 3600 nodes on each , having HA-TWO Queues policy.
Also we are bumping up from the RAM from 16G to 32G
here is the new config , we are using

[
 {rabbitmq_stomp, [{tcp_listeners, [{"hosgtip", 6163}]}]},
 {rabbit, [{reverse_dns_lookups,
true},{vm_memory_high_watermark_paging_ratio,
0.7},{vm_memory_high_watermark, 0.7},{disk_free_limit,
1000000000},{cluster_partition_handling, autoheal},
  {collect_statistics_interval, 30000}]},
 {rabbitmq_management_agent, [{force_fine_statistics, false}]}
].



On Tue, Aug 26, 2014 at 12:01 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 26 August 2014 at 22:59:09, Jason McIntosh (mcintoshj at gmail.com) wrote:
> > {mgmt_db,3870226464},3870MB
>
> Thanks, Jason.  So here's our key offender.
>
> Besides memory leaks that are fixed in the statistics DB from time to time,
> you can turn off fine grained stats. This should drastically reduce the
> amount of RAM used by the stats database.
>
> See http://rabbitmq.com/management.html.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/2aea26f7/attachment.html>

From mklishin at pivotal.io  Tue Aug 26 20:50:44 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 23:50:44 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
Message-ID: <etPan.53fce52e.7545e146.b58a@mercurio.local>

?On 26 August 2014 at 23:47:50, srikanth tns (srikanthtns at gmail.com) wrote:
> > what are the changes we see on the UI statistics ? I have applied  
> it on our test instances and see one of the main charts for message  
> rates is gone.

Yes, message rate stats depend on fine grained statistics. This is mentioned
in the docs.

> Also we are bumping up from the RAM from 16G to 32G

You can also bump the watermark ratio depending on what other software
may be running on the same machine/VM.
(but remember that OS and system services
also need RAM, as do file system caches, so going above 0.85 is probably
not a good idea)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 20:55:15 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 19:55:15 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <etPan.53fcded9.2eb141f2.b58a@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fcded9.2eb141f2.b58a@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DA47@usbpx2pmxmbx12>

Does that only apply when the socket limit is reached?  Because we're nowhere near our socket connection limits.  The highest is at 332, and we have 943626 available per node.  That said, is there any way to identify the bad connection?  Our last attempt to upgrade to 3.3.x was disastrous; we had to roll back everything.  If we can fix this at our current rev it would be much appreciated.

Thanks for the information,
Kale



-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io] 
Sent: Tuesday, August 26, 2014 2:24 PM
To: Ganann, Kale; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue will not delete

This list has moved to rabbitmq-users. Please start all new discussions there:
https://groups.google.com/forum/#!forum/rabbitmq-users?

On 26 August 2014 at 23:21:49, Ganann, Kale (kganann at kroll.com) wrote:
> > I have a queue that won?t delete in RabbitMQ 3.2.4.

Sounds like bug?26180 which was fixed in 3.3.2:
http://www.rabbitmq.com/release-notes/README-3.3.2.txt
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 20:59:05 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 26 Aug 2014 23:59:05 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DA47@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fcded9.2eb141f2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DA47@usbpx2pmxmbx12>
Message-ID: <etPan.53fce726.515f007c.b58a@mercurio.local>

?On 26 August 2014 at 23:56:34, Ganann, Kale (kganann at kroll.com) wrote:
> If we can fix this at our current rev it would be much appreciated.  

I'm afraid investigating how to do that would take a while, and may yield
no results.

Have you reported any 3.3.x upgrade issues to us? What was the problem?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 21:01:27 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 00:01:27 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
Message-ID: <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>

?On 26 August 2014 at 23:21:49, Ganann, Kale (kganann at kroll.com) wrote:
> >
> I have a queue that won?t delete in RabbitMQ 3.2.4. When I try to  
> access it via the management plug-in, I get:
> TypeError: Cannot read property 'ram_msg_count' of undefined  
>  
>  
> TypeError: Cannot read property 'ram_msg_count' of undefined  
>  

What is in the log files? How do you delete the queue, using a Rabbit client
or HTTP API?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 21:05:37 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 20:05:37 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>

As I said, nothing is in the log files.  The only reason you can tell I even attempted it is I show up in the access logs for the management plug in.

I have tried to delete via the management plug in and via the HTTP API.

I reported some of the issues we were having moving to 3.3 at the time, largely around (but not limited to) federation completely and totally failing for us once we moved up, but we weren't yielding great results and had to roll back for time constraints to get our environments up and running.

-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io] 
Sent: Tuesday, August 26, 2014 3:01 PM
To: Ganann, Kale; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue will not delete

?On 26 August 2014 at 23:21:49, Ganann, Kale (kganann at kroll.com) wrote:
> >
> I have a queue that won?t delete in RabbitMQ 3.2.4. When I try to 
> access it via the management plug-in, I get:
> TypeError: Cannot read property 'ram_msg_count' of undefined
>  
>  
> TypeError: Cannot read property 'ram_msg_count' of undefined
>  

What is in the log files? How do you delete the queue, using a Rabbit client or HTTP API?
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 21:12:47 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 00:12:47 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
Message-ID: <etPan.53fcea58.12200854.b58a@mercurio.local>

?On 27 August 2014 at 00:05:39, Ganann, Kale (kganann at kroll.com) wrote:
> > I reported some of the issues we were having moving to 3.3 at the  
> time, largely around (but not limited to) federation completely  
> and totally failing for us once we moved up, but we weren't yielding  
> great results and had to roll back for time constraints to get  
> our environments up and running.

Understood.

What version exactly was that with?

There were Federation fixes in the 3.3.x series:

http://www.rabbitmq.com/changelog.html
http://www.rabbitmq.com/release-notes/README-3.3.2.txt
http://www.rabbitmq.com/release-notes/README-3.3.5.txt
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 21:13:42 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 20:13:42 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>

Hmm.  Here's something interesting - I tried to overwrite it, and got this back from the api:

PS C:\Users\kganann.CCP> Write-RMQQueue -RabbitMQServer $RMQDev -Credential $Cred -vHost "master" -Name "q.d2.ha.gemini.internalIndexing"
Invoke-WebRequest : {"error":"bad_request","reason":"406 PRECONDITION_FAILED - parameters for queue
'q.d2.ha.gemini.internalIndexing' in vhost 'master' not equivalent"}
At C:\Windows\system32\WindowsPowerShell\v1.0\Modules\rabbitmq\RabbitMQ.psm1:1074 char:17
+         $RawResults = Invoke-WebRequest -Uri "http://$RabbitMQServer`:$Port/api/queues ...
+    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebExc
   eption
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
ConvertFrom-Json : Cannot bind argument to parameter 'InputObject' because it is null.
At C:\Windows\system32\WindowsPowerShell\v1.0\Modules\rabbitmq\RabbitMQ.psm1:1077 char:30
+     $Results = ConvertFrom-Json $RawResults
+                                 ~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [ConvertFrom-Json], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorNullNotAllowed,Microsoft.PowerShell.Commands.ConvertFrom
   JsonCommand

-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ganann, Kale
Sent: Tuesday, August 26, 2014 3:06 PM
To: Michael Klishin; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue will not delete

As I said, nothing is in the log files.  The only reason you can tell I even attempted it is I show up in the access logs for the management plug in.

I have tried to delete via the management plug in and via the HTTP API.

I reported some of the issues we were having moving to 3.3 at the time, largely around (but not limited to) federation completely and totally failing for us once we moved up, but we weren't yielding great results and had to roll back for time constraints to get our environments up and running.

-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io]
Sent: Tuesday, August 26, 2014 3:01 PM
To: Ganann, Kale; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue will not delete

?On 26 August 2014 at 23:21:49, Ganann, Kale (kganann at kroll.com) wrote:
> >
> I have a queue that won?t delete in RabbitMQ 3.2.4. When I try to 
> access it via the management plug-in, I get:
> TypeError: Cannot read property 'ram_msg_count' of undefined
>  
>  
> TypeError: Cannot read property 'ram_msg_count' of undefined
>  

What is in the log files? How do you delete the queue, using a Rabbit client or HTTP API?
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ _______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From KGanann at kroll.com  Tue Aug 26 21:15:27 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 20:15:27 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <etPan.53fcea58.12200854.b58a@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <etPan.53fcea58.12200854.b58a@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DACE@usbpx2pmxmbx12>

We went to 3.3.4.  We're making a move to get off federation - we've had too many issues with it, so upgrading might be in the cards again, but I'll have to pitch to the managers.

-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io] 
Sent: Tuesday, August 26, 2014 3:13 PM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: RE: [rabbitmq-discuss] Queue will not delete

?On 27 August 2014 at 00:05:39, Ganann, Kale (kganann at kroll.com) wrote:
> > I reported some of the issues we were having moving to 3.3 at the
> time, largely around (but not limited to) federation completely and 
> totally failing for us once we moved up, but we weren't yielding great 
> results and had to roll back for time constraints to get our 
> environments up and running.

Understood.

What version exactly was that with?

There were Federation fixes in the 3.3.x series:

http://www.rabbitmq.com/changelog.html
http://www.rabbitmq.com/release-notes/README-3.3.2.txt
http://www.rabbitmq.com/release-notes/README-3.3.5.txt
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 21:16:45 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 00:16:45 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
Message-ID: <etPan.53fceb49.4db127f8.b58a@mercurio.local>

On 27 August 2014 at 00:15:19, Ganann, Kale (kganann at kroll.com) wrote:
> > Write-RMQQueue -RabbitMQServer $RMQDev -Credential $Cred  
> -vHost "master" -Name "q.d2.ha.gemini.internalIndexing"  
> Invoke-WebRequest : {"error":"bad_request","reason":"406  
> PRECONDITION_FAILED - parameters for queue
> 'q.d2.ha.gemini.internalIndexing' in vhost 'master' not  
> equivalent"}

If by "overwrite" you mean "redeclare", then it is nothing unexpected:
you simply provided different parameters (e.g. durability). When you provide the correct ones, the operation will be a no-op.

So I'm afraid this is a red herring.
-- ?
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 21:23:45 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 20:23:45 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <etPan.53fceb49.4db127f8.b58a@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
 <etPan.53fceb49.4db127f8.b58a@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DAF1@usbpx2pmxmbx12>

Shoot.

Since the bug is listed as being related to a connection, would restarting the whole cluster clear the broken connection?

-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io] 
Sent: Tuesday, August 26, 2014 3:17 PM
To: Ganann, Kale; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Queue will not delete

On 27 August 2014 at 00:15:19, Ganann, Kale (kganann at kroll.com) wrote:
> > Write-RMQQueue -RabbitMQServer $RMQDev -Credential $Cred
> -vHost "master" -Name "q.d2.ha.gemini.internalIndexing"  
> Invoke-WebRequest : {"error":"bad_request","reason":"406
> PRECONDITION_FAILED - parameters for queue 
> 'q.d2.ha.gemini.internalIndexing' in vhost 'master' not equivalent"}

If by "overwrite" you mean "redeclare", then it is nothing unexpected:
you simply provided different parameters (e.g. durability). When you provide the correct ones, the operation will be a no-op.

So I'm afraid this is a red herring.
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Aug 26 21:24:42 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 00:24:42 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DAF1@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
 <etPan.53fceb49.4db127f8.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAF1@usbpx2pmxmbx12>
Message-ID: <etPan.53fced24.216231b.b58a@mercurio.local>

On 27 August 2014 at 00:23:46, Ganann, Kale (kganann at kroll.com) wrote:
> > Since the bug is listed as being related to a connection, would  
> restarting the whole cluster clear the broken connection?  

Connections are node-local. You definitely don't need to restart the entire
cluster.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Aug 26 21:32:15 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 26 Aug 2014 20:32:15 +0000
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <etPan.53fced24.216231b.b58a@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
 <etPan.53fceb49.4db127f8.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAF1@usbpx2pmxmbx12>
 <etPan.53fced24.216231b.b58a@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D3DB1A@usbpx2pmxmbx12>

But I would have to know which node the connection was linked to.  I'm not saying all at once, but I would need to cycle through the nodes until it got wiped, correct?

-----Original Message-----
From: Michael Klishin [mailto:mklishin at pivotal.io] 
Sent: Tuesday, August 26, 2014 3:25 PM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: RE: [rabbitmq-discuss] Queue will not delete

On 27 August 2014 at 00:23:46, Ganann, Kale (kganann at kroll.com) wrote:
> > Since the bug is listed as being related to a connection, would
> restarting the whole cluster clear the broken connection?  

Connections are node-local. You definitely don't need to restart the entire cluster.
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 01:13:32 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 17:13:32 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fce52e.7545e146.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
Message-ID: <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>

Hi ,

Thanks for suggesting the changes.
we have applied the relevant changes to config file for statistics and RAM
upgrade. Things seem to be stable now but we will monitor the usage to see
if it jumps off again.
here is a screenshot of how its looking now. Please let me know if this is
promising , also is there any possibility of memory leaks and how we can
avoid them?


[image: Inline image 1]


Memory stats

 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,4337647904},
      {connection_procs,338878104},
      {queue_procs,1193259768},
      {plugins,328401480},
      {other_proc,566879328},
      {mnesia,331579864},
      {mgmt_db,755366192},
      {msg_index,22422152},
      {other_ets,58232552},
      {binary,402509464},
      {code,17776116},
      {atom,1621321},
      {other_system,320721563}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,23567893708},
 {disk_free_limit,1000000000},
 {disk_free,19428507648},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,4289},
      {sockets_limit,294819},
      {sockets_used,4287}]},
 {processes,[{limit,1048576},{used,197320}]},
 {run_queue,0},
 {uptime,4970}]

 {memory,
     [{total,2662846904},
      {connection_procs,188698640},
      {queue_procs,929974408},
      {plugins,265628672},
      {other_proc,285984288},
      {mnesia,333067736},
      {mgmt_db,9096},
      {msg_index,14039664},
      {other_ets,34617944},
      {binary,298184672},
      {code,17779316},
      {atom,1620513},
      {other_system,293241955}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,23567893708},
 {disk_free_limit,1000000000},
 {disk_free,19331850240},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,3360},
      {sockets_limit,294819},
      {sockets_used,3358}]},
 {processes,[{limit,1048576},{used,154555}]},
 {run_queue,0},
 {uptime,3812}]

 {memory,
     [{total,2548103256},
      {connection_procs,216784920},
      {queue_procs,846726064},
      {plugins,247802288},
      {other_proc,260433432},
      {mnesia,333461048},
      {mgmt_db,9096},
      {msg_index,8830272},
      {other_ets,33553920},
      {binary,291250680},
      {code,17776116},
      {atom,1620513},
      {other_system,289854907}]},
 {vm_memory_high_watermark,0.7},
 {vm_memory_limit,23567893708},
 {disk_free_limit,1000000000},
 {disk_free,19382099968},
 {file_descriptors,
     [{total_limit,327579},
      {total_used,3112},
      {sockets_limit,294819},
      {sockets_used,3110}]},
 {processes,[{limit,1048576},{used,143173}]},
 {run_queue,0},
 {uptime,3777}]


On Tue, Aug 26, 2014 at 12:50 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

>  On 26 August 2014 at 23:47:50, srikanth tns (srikanthtns at gmail.com)
> wrote:
> > > what are the changes we see on the UI statistics ? I have applied
> > it on our test instances and see one of the main charts for message
> > rates is gone.
>
> Yes, message rate stats depend on fine grained statistics. This is
> mentioned
> in the docs.
>
> > Also we are bumping up from the RAM from 16G to 32G
>
> You can also bump the watermark ratio depending on what other software
> may be running on the same machine/VM.
> (but remember that OS and system services
> also need RAM, as do file system caches, so going above 0.85 is probably
> not a good idea)
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/5de2b51d/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 73551 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/5de2b51d/attachment.png>

From mklishin at pivotal.io  Wed Aug 27 01:18:12 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:18:12 +0400
Subject: [rabbitmq-discuss] Queue will not delete
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D3DB1A@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA2D3D8E7@usbpx2pmxmbx12>
 <etPan.53fce7b2.5bd062c2.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAA0@usbpx2pmxmbx12>
 <6DB033025329784B9280ABD9516177FCA2D3DAB5@usbpx2pmxmbx12>
 <etPan.53fceb49.4db127f8.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DAF1@usbpx2pmxmbx12>
 <etPan.53fced24.216231b.b58a@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D3DB1A@usbpx2pmxmbx12>
Message-ID: <etPan.53fd23e2.66ef438d.b58a@mercurio.local>

On 27 August 2014 at 00:32:16, Ganann, Kale (kganann at kroll.com) wrote:
> > But I would have to know which node the connection was linked 
> to. I'm not saying all at once, but I would need to cycle through 
> the nodes until it got wiped, correct?

If your apps can recover from server-sent connection.close, you can
close all connections via HTTP API in a loop.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Wed Aug 27 01:19:53 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:19:53 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
Message-ID: <etPan.53fd2444.140e0f76.b58a@mercurio.local>

On 27 August 2014 at 04:13:33, srikanth tns (srikanthtns at gmail.com) wrote:
> > here is a screenshot of how its looking now. Please let me know  
> if this is promising , also is there any possibility of memory  
> leaks and how we can avoid them?

Note that this is not necessarily a leak.

You have over 100K queues,
100K consumers and you (used to) collect fine grained
stats to display message rate, with a retention period in hours it's kind of
expected that all those stats will consume quite a bit of RAM.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 01:30:50 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 17:30:50 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd2444.140e0f76.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
Message-ID: <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>

So which retention policy is suggested ? global / basic / detailed ?
setting it to coarse grained , make it global / basic ?




On Tue, Aug 26, 2014 at 5:19 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 27 August 2014 at 04:13:33, srikanth tns (srikanthtns at gmail.com) wrote:
> > > here is a screenshot of how its looking now. Please let me know
> > if this is promising , also is there any possibility of memory
> > leaks and how we can avoid them?
>
> Note that this is not necessarily a leak.
>
> You have over 100K queues,
> 100K consumers and you (used to) collect fine grained
> stats to display message rate, with a retention period in hours it's kind
> of
> expected that all those stats will consume quite a bit of RAM.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/7e1add73/attachment.html>

From mklishin at pivotal.io  Wed Aug 27 01:34:59 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:34:59 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
Message-ID: <etPan.53fd27d1.3352255a.b58a@mercurio.local>

On 27 August 2014 at 04:30:50, srikanth tns (srikanthtns at gmail.com) wrote:
> > So which retention policy is suggested ? global / basic / detailed 
> ?
> setting it to coarse grained , make it global / basic ?

There is no hard-and-fast rule but generally we can say that the more detailed
you go (e.g. detailed), the shorter the period should be (I'd say 15 minutes
is plenty for many cases). Global stats can be collected for longer periods,
so that your overview page can be more helpful at detecting anomalies.

Again, all of this depends on your team's needs but collecting detailed stats
over the course of hours leads to RAM consumption that is hard to justify
if you ask me.

Experiment and see what works for you.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Wed Aug 27 01:37:43 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:37:43 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd27d1.3352255a.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
Message-ID: <etPan.53fd2872.109cf92e.b58a@mercurio.local>

On 27 August 2014 at 04:36:52, Michael Klishin (mklishin at pivotal.io) wrote:
> > (I'd say 15 minutes
> is plenty for many cases)

This should read "15 seconds".?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 01:44:04 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 17:44:04 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd2872.109cf92e.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
Message-ID: <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>

Cool, since we removed the fine grained statistics , we are off the
detailed retention policy and running global / basic ?
Is there any optimal value for global / basic policy ? Our needs are to
just monitor the number of connections and use that data to load balance
our connections.


On Tue, Aug 26, 2014 at 5:37 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 27 August 2014 at 04:36:52, Michael Klishin (mklishin at pivotal.io)
> wrote:
> > > (I'd say 15 minutes
> > is plenty for many cases)
>
> This should read "15 seconds".
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/2fd03b63/attachment.html>

From mklishin at pivotal.io  Wed Aug 27 01:46:21 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:46:21 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
Message-ID: <etPan.53fd2a7b.ded7263.b58a@mercurio.local>

?On 27 August 2014 at 04:44:04, srikanth tns (srikanthtns at gmail.com) wrote:
> Is there any optimal value for global / basic policy ?

If you're happy with the current RAM use levels for stats DB, I'd recommend
leaving things as they are for a while.

> Our needs  
> are to just monitor the number of connections and use that data  
> to load balance our connections.

If you don't use message rates info, you probably don't need fine grained stats.
Again, if things work for you as they are after the change, I'd leave it
this way until the need to re-enable fine grained stats arises.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 01:53:52 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 17:53:52 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
Message-ID: <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>

Great one of the things I saw when the rabbitmq was running high memory ,
the plugin value is -ve

{erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,9513029096},
      {connection_procs,190083816},
      {queue_procs,563064488},
      {plugins,-4964607832},
      {other_proc,5354348816},
      {mnesia,289348840},
      {mgmt_db,7437862072},
      {msg_index,16722336},
      {other_ets,50810936},
      {binary,253822816},
      {code,17776116},
      {atom,1622937},


here is the list of plugin enabled

[root at adsmv4218 ~]# rabbitmq-plugins list
[E] amqp_client                       3.2.4
[ ] cowboy                            0.5.0-rmq3.2.4-git4b93c2d
[ ] eldap                             3.2.4-gite309de4
[e] mochiweb                          2.7.0-rmq3.2.4-git680dba8
[ ] rabbitmq_amqp1_0                  3.2.4
[ ] rabbitmq_auth_backend_ldap        3.2.4
[ ] rabbitmq_auth_mechanism_ssl       3.2.4
[ ] rabbitmq_consistent_hash_exchange 3.2.4
[ ] rabbitmq_federation               3.2.4
[ ] rabbitmq_federation_management    3.2.4
[ ] rabbitmq_jsonrpc                  3.2.4
[ ] rabbitmq_jsonrpc_channel          3.2.4
[ ] rabbitmq_jsonrpc_channel_examples 3.2.4
[E] rabbitmq_management               3.2.4
[e] rabbitmq_management_agent         3.2.4
[ ] rabbitmq_management_visualiser    3.2.4
[ ] rabbitmq_mqtt                     3.2.4
[ ] rabbitmq_shovel                   3.2.4
[ ] rabbitmq_shovel_management        3.2.4
[E] rabbitmq_stomp                    3.2.4
[ ] rabbitmq_tracing                  3.2.4
[e] rabbitmq_web_dispatch             3.2.4
[ ] rabbitmq_web_stomp                3.2.4
[ ] rabbitmq_web_stomp_examples       3.2.4
[ ] rfc4627_jsonrpc                   3.2.4-git5e67120
[ ] sockjs                            0.3.4-rmq3.2.4-git3132eb9
[e] webmachine                        1.10.3-rmq3.2.4-gite9359c7


On Tue, Aug 26, 2014 at 5:46 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

>  On 27 August 2014 at 04:44:04, srikanth tns (srikanthtns at gmail.com)
> wrote:
> > Is there any optimal value for global / basic policy ?
>
> If you're happy with the current RAM use levels for stats DB, I'd recommend
> leaving things as they are for a while.
>
> > Our needs
> > are to just monitor the number of connections and use that data
> > to load balance our connections.
>
> If you don't use message rates info, you probably don't need fine grained
> stats.
> Again, if things work for you as they are after the change, I'd leave it
> this way until the need to re-enable fine grained stats arises.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/2c5c0ea8/attachment.html>

From mklishin at pivotal.io  Wed Aug 27 01:58:33 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 04:58:33 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
Message-ID: <etPan.53fd2d57.7fdcc233.b58a@mercurio.local>

On 27 August 2014 at 04:56:04, srikanth tns (srikanthtns at gmail.com) wrote:
> > Great one of the things I saw when the rabbitmq was running high 
> memory , the plugin value is -ve

Do you use STOMP actively?

We've improved some things in STOMP and MQTT plugins in the upcoming
3.4.0 release that would lead to high RAM usage reported by the plugins
(and lower by binaries). This is not a leak but something that skews
the picture quite a bit and results in higher RAM use from "non-core" protocol
connections for no good reason.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Wed Aug 27 02:01:23 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 05:01:23 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
Message-ID: <etPan.53fd2e00.1befd79f.b58a@mercurio.local>

?On 27 August 2014 at 04:56:04, srikanth tns (srikanthtns at gmail.com) wrote:
> > Great one of the things I saw when the rabbitmq was running high  
> memory , the plugin value is -ve

And the negative value is indeed a bug,?26058, which was fixed in 3.3.0:
http://www.rabbitmq.com/release-notes/README-3.3.0.txt
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 02:05:52 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 18:05:52 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd2e00.1befd79f.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
 <etPan.53fd2e00.1befd79f.b58a@mercurio.local>
Message-ID: <CAOU_jKDfj6fdt6cDau3swyzexzrbwRuyFXtBap_bNsd8CTM4oQ@mail.gmail.com>

Yes we use STOMP actively to send message to the targets hosts via
mcollective rpc. The messages are sent to the targets every 10 secs.
Does it cause any issue ?


On Tue, Aug 26, 2014 at 6:01 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

>  On 27 August 2014 at 04:56:04, srikanth tns (srikanthtns at gmail.com)
> wrote:
> > > Great one of the things I saw when the rabbitmq was running high
> > memory , the plugin value is -ve
>
> And the negative value is indeed a bug, 26058, which was fixed in 3.3.0:
> http://www.rabbitmq.com/release-notes/README-3.3.0.txt
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/b38463e5/attachment.html>

From mklishin at pivotal.io  Wed Aug 27 02:13:29 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Wed, 27 Aug 2014 05:13:29 +0400
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <CAOU_jKDfj6fdt6cDau3swyzexzrbwRuyFXtBap_bNsd8CTM4oQ@mail.gmail.com>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
 <etPan.53fd2e00.1befd79f.b58a@mercurio.local>
 <CAOU_jKDfj6fdt6cDau3swyzexzrbwRuyFXtBap_bNsd8CTM4oQ@mail.gmail.com>
Message-ID: <etPan.53fd30d2.41a7c4c9.b58a@mercurio.local>

On 27 August 2014 at 05:08:02, srikanth tns (srikanthtns at gmail.com) wrote:
> > Yes we use STOMP actively to send message to the targets hosts  
> via mcollective rpc. The messages are sent to the targets every  
> 10 secs.
> Does it cause any issue ?

It doesn't cause any issues, just higher than should be memory consumption
by the STOMP plugin (the same issue actually exists in MQTT).

The issue was reported by an mcollective user. If you have a chance and feel very
enthusiastic, you can try nightly builds:

https://www.rabbitmq.com/nightly-builds.html

But if this is not really an issue, again, leave things as they are for now,
move to 3.3.x soon, and 3.4.0 a month or so after it is out.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From srikanthtns at gmail.com  Wed Aug 27 02:28:39 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 26 Aug 2014 18:28:39 -0700
Subject: [rabbitmq-discuss] Rabbitmq 3.2.4 running out of memory
In-Reply-To: <etPan.53fd30d2.41a7c4c9.b58a@mercurio.local>
References: <CAOU_jKCbnmpZ8zfUmjxcCTZwb6TtzEnCBvzQPeiyKHYs4NSkcA@mail.gmail.com>
 <etPan.53fcd531.625558ec.b58a@mercurio.local>
 <CAOU_jKA+p08diEnSVdN=TCWQ7R7yV8N9qRGCTziodnsw8KYAqA@mail.gmail.com>
 <CAD6m6fE7MDt2bx5E8_AcEixxNTto0s4x3ei6qwN43f4TY_U8Ng@mail.gmail.com>
 <etPan.53fcd996.3d1b58ba.b58a@mercurio.local>
 <CAOU_jKAhMWXFo584sYGkJsSuR-2ze0Sy+4iA02zEa8a_kFk2Vg@mail.gmail.com>
 <etPan.53fce52e.7545e146.b58a@mercurio.local>
 <CAOU_jKADLMZAaah5cbVsrKeyyw6WOU2DECwcU3Jd5+0Qu8h6ng@mail.gmail.com>
 <etPan.53fd2444.140e0f76.b58a@mercurio.local>
 <CAOU_jKCT-c5fpWZvY8Z=79nhuXqcfVo6wGpCuMrUU8GQyAftrA@mail.gmail.com>
 <etPan.53fd27d1.3352255a.b58a@mercurio.local>
 <etPan.53fd2872.109cf92e.b58a@mercurio.local>
 <CAOU_jKAHDkOKO0pH-0DmsN6ASWP7Jfqx5TNk_reKOvDYN7+Tng@mail.gmail.com>
 <etPan.53fd2a7b.ded7263.b58a@mercurio.local>
 <CAOU_jKAXZZvBm41hO3BRuMbR00+864Np4M3pG=wDQ8Gvi3NSpg@mail.gmail.com>
 <etPan.53fd2e00.1befd79f.b58a@mercurio.local>
 <CAOU_jKDfj6fdt6cDau3swyzexzrbwRuyFXtBap_bNsd8CTM4oQ@mail.gmail.com>
 <etPan.53fd30d2.41a7c4c9.b58a@mercurio.local>
Message-ID: <CAOU_jKBCd7XkUic+++0zUdy6CV_cE9en6qCt0-r-m6N=DuNOMQ@mail.gmail.com>

Sure , we will leave it as how it is now and monitor it tonight. Thanks
alot!!


On Tue, Aug 26, 2014 at 6:13 PM, Michael Klishin <mklishin at pivotal.io>
wrote:

> On 27 August 2014 at 05:08:02, srikanth tns (srikanthtns at gmail.com) wrote:
> > > Yes we use STOMP actively to send message to the targets hosts
> > via mcollective rpc. The messages are sent to the targets every
> > 10 secs.
> > Does it cause any issue ?
>
> It doesn't cause any issues, just higher than should be memory consumption
> by the STOMP plugin (the same issue actually exists in MQTT).
>
> The issue was reported by an mcollective user. If you have a chance and
> feel very
> enthusiastic, you can try nightly builds:
>
> https://www.rabbitmq.com/nightly-builds.html
>
> But if this is not really an issue, again, leave things as they are for
> now,
> move to 3.3.x soon, and 3.4.0 a month or so after it is out.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140826/d9739ed0/attachment.html>

