From achen at vmware.com  Thu Mar  1 03:24:29 2012
From: achen at vmware.com (Annie Chen)
Date: Wed, 29 Feb 2012 19:24:29 -0800 (PST)
Subject: [rabbitmq-discuss] Question about disabling RabbitMQ SSL hostname
	check
In-Reply-To: <1255741570.641587.1330569717292.JavaMail.root@zimbra-prod-mbox-5.vmware.com>
Message-ID: <707457773.642286.1330572269518.JavaMail.root@zimbra-prod-mbox-5.vmware.com>

Hi,

I have question about how to disable hostname check in RabbitMQ SSL communication. I followed the SSL setup steps here: http://www.rabbitmq.com/ssl.html#keys-and-certs. I can run the Example2.java (ssl communication) without any issue. 

However, I have a special requirement. RabbitMQ does check if the CN in the client's certificate matches its hostname. I'm wondering if there's config in rabbitMQ that can disable the check. I imagine it would be similar to the "System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch flags" mentioned in the instruction. Any idea or reference will be very helpful since I'm new to RabbitMQ. (My environment is MAC OSX 10.6.8, and use Macports to install rabbitMQ.)

Thank you for your time and patience.
Annie

From amathur.q at gmail.com  Thu Mar  1 04:32:34 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Thu, 1 Mar 2012 10:02:34 +0530
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+u4LE4EADdEGvp3vdU-4W9uHzbLpJaf3t_YsF5wYw1-qwe+WQ@mail.gmail.com>

Hi,

I would like to know which version of RabbitMQ is currently being used by
Openstack(Nova) for their messaging purposes?
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/931e5812/attachment.htm>

From ask at rabbitmq.com  Thu Mar  1 10:27:27 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 1 Mar 2012 10:27:27 +0000
Subject: [rabbitmq-discuss] Rabbit for Openstack (Was: (no subject))
In-Reply-To: <CA+u4LE4EADdEGvp3vdU-4W9uHzbLpJaf3t_YsF5wYw1-qwe+WQ@mail.gmail.com>
References: <CA+u4LE4EADdEGvp3vdU-4W9uHzbLpJaf3t_YsF5wYw1-qwe+WQ@mail.gmail.com>
Message-ID: <DEF1FBAF-C2C0-48A4-AE74-38988E69E052@rabbitmq.com>


On 1 Mar 2012, at 04:32, Ashutosh Mathur wrote:

> Hi,
> 
> I would like to know which version of RabbitMQ is currently being used by Openstack(Nova) for their messaging purposes?
> Thanks in advance.

Openstack doesn't define any specific version requirement AFAIK, but you would
have to ask the Openstack mailing-list about that.

The best is using the most recent RabbitMQ version, if possible.
This installation guide is using the version available in Ubuntu:
http://docs.openstack.org/bexar/openstack-compute/admin/content/ch03s02.html



From simon at rabbitmq.com  Thu Mar  1 11:11:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 11:11:13 +0000
Subject: [rabbitmq-discuss] Question about disabling RabbitMQ SSL
 hostname check
In-Reply-To: <707457773.642286.1330572269518.JavaMail.root@zimbra-prod-mbox-5.vmware.com>
References: <707457773.642286.1330572269518.JavaMail.root@zimbra-prod-mbox-5.vmware.com>
Message-ID: <4F4F5951.8000607@rabbitmq.com>

On 01/03/12 03:24, Annie Chen wrote:
> I have question about how to disable hostname check in RabbitMQ SSL
> communication. I followed the SSL setup steps here:
> http://www.rabbitmq.com/ssl.html#keys-and-certs. I can run the
> Example2.java (ssl communication) without any issue.
>
> However, I have a special requirement. RabbitMQ does check if the CN
> in the client's certificate matches its hostname. I'm wondering if
> there's config in rabbitMQ that can disable the check. I imagine it
> would be similar to the
> "System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch
> flags" mentioned in the instruction. Any idea or reference will be
> very helpful since I'm new to RabbitMQ. (My environment is MAC OSX
> 10.6.8, and use Macports to install rabbitMQ.)

Hi Annie.

I don't believe that the server does that check. It's not completely 
obvious how it even could (the client does not present its hostname).

Could you let me know what you're seeing that is not what you expect?

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  1 11:13:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 11:13:11 +0000
Subject: [rabbitmq-discuss] Management Plugin URL Encoding Bug
In-Reply-To: <5010B638917648B6ACAD5503B2186E64@myyearbook.com>
References: <5010B638917648B6ACAD5503B2186E64@myyearbook.com>
Message-ID: <4F4F59C7.6070200@rabbitmq.com>

On 29/02/12 19:56, Gavin M. Roy wrote:
> It appears that the Javascript code that encodes values does not
> properly encode more than one underscore (_) when creating a URL.

Hi Gavin.

There was an identical-sounding bug fixed in 2.7.1 (albeit in the HTTP 
API rather than the JavaScript UI) - are you using the latest version?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Thu Mar  1 11:39:32 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 1 Mar 2012 11:39:32 +0000
Subject: [rabbitmq-discuss] Problem connecting from Android client
In-Reply-To: <BAY154-W539870CC6FC7A6D83362DC99680@phx.gbl>
References: <BAY154-W539870CC6FC7A6D83362DC99680@phx.gbl>
Message-ID: <E86952DE-1A6B-4F9D-99A8-36020FE25202@rabbitmq.com>

Hi Jay (or should I say KingKong?),

Sorry this is a late response. Please can you put a meaningful subject line on
your posts, in future?

Thank you for referencing Simon Dixon's blog.
 
Perhaps you could supply us with a little more information.

What is the version of RabbitMQ server you are running and on what
platform are you running it?

Have you looked in the server logs to see if there are any messages confirming
that you do indeed connect to it? There might be some errors there if the
connection has failed for some reason (that would show up as a connection being
closed in the client -- so I would expect some exceptions to be thrown, but
you aren't catching unchecked exceptions).

Have you modified the code samples given on that website at all? Of course, you
have modified the server address, but have you changed anything else, like the
exchange type and queue? I see that connectToRabbitMQ() is overridden in the
example and the overriding method does more than just connect, it declares
queues and so on. It would be a good idea to see if those queues are actually
created on the server (rabbitmqctl will help you here).

If you cannot find the problem yourself, then I think some more of your actual
code would be interesting, and we could then try to replicate this on our
IDE Android setup.

Let us know how you get on. Although we don't officially support the Java client
on Android, it would be nice to know that it is capable of working there.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 26 Feb 2012, at 18:45, jay nanavati wrote:

> Hi everyone,
> 
> I have followed this guide to setup rabbitMQ for android.
> 
> http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/
> 
> 
> 
> The problem I am facing is On the line mConsumer.connectToRabbitMQ() in the ActivityHome, I have changed it to:
> 
> 
> 
> mOutput.append(?\n?+mConsumer.connectToRabbitMQ());
> 
> 
> 
> now when I have the wrong server, it prints false as expected however when I have the write server it does not print anything. In fact it does not even print the @string/hello which it should anyways..
> 
> 
> 
> The app does not consume messages and I think this could be the reason.. Also I have used loger and found out that the error must be on this method because I can logg before the call however I cannot logg anything after the call.
> 
> 
> 
> Any help would be greatly appreciated.. Thanks!
> 
> 
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From amathur.q at gmail.com  Thu Mar  1 11:55:17 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Thu, 1 Mar 2012 17:25:17 +0530
Subject: [rabbitmq-discuss] Persistence in RabbitMQ and AMQP.
Message-ID: <CA+u4LE6E1ZYzTUzzkE2sppPPe3Z8z3TLNkT55Xd87xfxr0LOGw@mail.gmail.com>

Hi,

I would like to know how does or in what ways does RabbitMQ/AMQP support
Persistence(of messages,queues,etc). Please do provide a detailed answer or
links which may provide further information on this.
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/772057bd/attachment.htm>

From Simone.Busoli at ferrari.com  Thu Mar  1 13:27:56 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 1 Mar 2012 13:27:56 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
Message-ID: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>

Hello,

I've set up a symmetric federation between two brokers A and B, that is, an exchange on one broker acts as the upstream for one on the other broker with the same name and vice versa.
To prevent messages from going into an infinite loop I've set max_hops to 1, but I am under the impression that messages published to broker A and then proxied to broker B are somehow proxied back once again to broker A and just then ignored because of the max_hops setting.
Is this behavior expected? Our rationale for using this kind of symmetrically configured federation is twofold: first to prevent messages to go into loops and secondly to conserve bandwidth by preventing messages to roundtrip from A to B and back, and this second aspect doesn't seem to work correctly right now.

Thanks


_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/9abde33f/attachment.htm>

From simon at rabbitmq.com  Thu Mar  1 13:55:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 13:55:10 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>
Message-ID: <4F4F7FBE.5020202@rabbitmq.com>

Yeah, I'm afraid that's the case. The existing design puts all the 
smarts in the downstream; therefore the message can only be thrown away 
once it's already gone over the gap.

We will revisit this at some point.

Cheers, Simon

On 01/03/12 13:27, Busoli, Simone wrote:
> Hello,
>
> I?ve set up a symmetric federation between two brokers A and B, that is,
> an exchange on one broker acts as the upstream for one on the other
> broker with the same name and vice versa.
>
> To prevent messages from going into an infinite loop I?ve set max_hops
> to 1, but I am under the impression that messages published to broker A
> and then proxied to broker B are somehow proxied back once again to
> broker A and just then ignored because of the max_hops setting.
>
> Is this behavior expected? Our rationale for using this kind of
> symmetrically configured federation is twofold: first to prevent
> messages to go into loops and secondly to conserve bandwidth by
> preventing messages to roundtrip from A to B and back, and this second
> aspect doesn?t seem to work correctly right now.
>
> Thanks
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario
> e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non e il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
> _________________________________________________________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Thu Mar  1 14:10:36 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 1 Mar 2012 14:10:36 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F4F7FBE.5020202@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>
	<4F4F7FBE.5020202@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>

Too bad that I didn't realize this was the case earlier, as this is a real showstopper because of bandwidth consumption.
Any chance, by any means, we can have a fix for this or a feasible workaround?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: gioved? 1 marzo 2012 14:55
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

Yeah, I'm afraid that's the case. The existing design puts all the smarts in the downstream; therefore the message can only be thrown away once it's already gone over the gap.

We will revisit this at some point.

Cheers, Simon

On 01/03/12 13:27, Busoli, Simone wrote:
> Hello,
>
> I've set up a symmetric federation between two brokers A and B, that 
> is, an exchange on one broker acts as the upstream for one on the 
> other broker with the same name and vice versa.
>
> To prevent messages from going into an infinite loop I've set max_hops 
> to 1, but I am under the impression that messages published to broker 
> A and then proxied to broker B are somehow proxied back once again to 
> broker A and just then ignored because of the max_hops setting.
>
> Is this behavior expected? Our rationale for using this kind of 
> symmetrically configured federation is twofold: first to prevent 
> messages to go into loops and secondly to conserve bandwidth by 
> preventing messages to roundtrip from A to B and back, and this second 
> aspect doesn't seem to work correctly right now.
>
> Thanks
>
> ______________________________________________________________________
> ___________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del 
> destinatario e puo contenere informazioni che sono di natura 
> privilegiata, confidenziale o non divulgabile secondo le leggi 
> vigenti. Se il lettore del presente messaggio non e il destinatario 
> designato, o il dipendente/agente responsabile per la consegna del 
> messaggio al destinatario designato, si informa che ogni 
> disseminazione, distribuzione o copiatura di questa comunicazione e 
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . 
> Se avete ricevuto questo messaggio per errore, vi preghiamo di 
> notificarcelo immediatamente a mezzo e-mail di risposta e 
> successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> ______________________________________________________________________
> ___________________________________________
> This message is intended only for the use of the addressee and may 
> contain information that is privileged, confidential and exempt from 
> disclosure under applicable law. If the reader of this message is not 
> the intended recipient, or the employee or agent responsible for 
> delivering the message to the intended recipient, you are hereby 
> notified that any dissemination, distribution or copying of this 
> communication is strictly prohibited. If you have received this e-mail 
> in error, please notify us immediately by return e-mail and delete 
> this e-mail and all attachments from your system.
> ______________________________________________________________________
> ___________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From simon at rabbitmq.com  Thu Mar  1 14:16:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 14:16:39 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>
	<4F4F7FBE.5020202@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
Message-ID: <4F4F84C7.80804@rabbitmq.com>

The best workaround I can offer is to only use asymmetric federation - 
i.e. have separate upstream and downstream exchanges and consume from 
both in any given broker.

Cheers, Simon

On 01/03/12 14:10, Busoli, Simone wrote:
> Too bad that I didn't realize this was the case earlier, as this is a real showstopper because of bandwidth consumption.
> Any chance, by any means, we can have a fix for this or a feasible workaround?
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: gioved? 1 marzo 2012 14:55
> To: Busoli, Simone
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Symmetric federation behavior
>
> Yeah, I'm afraid that's the case. The existing design puts all the smarts in the downstream; therefore the message can only be thrown away once it's already gone over the gap.
>
> We will revisit this at some point.
>
> Cheers, Simon
>
> On 01/03/12 13:27, Busoli, Simone wrote:
>> Hello,
>>
>> I've set up a symmetric federation between two brokers A and B, that
>> is, an exchange on one broker acts as the upstream for one on the
>> other broker with the same name and vice versa.
>>
>> To prevent messages from going into an infinite loop I've set max_hops
>> to 1, but I am under the impression that messages published to broker
>> A and then proxied to broker B are somehow proxied back once again to
>> broker A and just then ignored because of the max_hops setting.
>>
>> Is this behavior expected? Our rationale for using this kind of
>> symmetrically configured federation is twofold: first to prevent
>> messages to go into loops and secondly to conserve bandwidth by
>> preventing messages to roundtrip from A to B and back, and this second
>> aspect doesn't seem to work correctly right now.
>>
>> Thanks
>>
>> ______________________________________________________________________
>> ___________________________________________
>> Questo messaggio e da intendersi esclusivamente ad uso del
>> destinatario e puo contenere informazioni che sono di natura
>> privilegiata, confidenziale o non divulgabile secondo le leggi
>> vigenti. Se il lettore del presente messaggio non e il destinatario
>> designato, o il dipendente/agente responsabile per la consegna del
>> messaggio al destinatario designato, si informa che ogni
>> disseminazione, distribuzione o copiatura di questa comunicazione e
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>> Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> notificarcelo immediatamente a mezzo e-mail di risposta e
>> successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>> ______________________________________________________________________
>> ___________________________________________
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not
>> the intended recipient, or the employee or agent responsible for
>> delivering the message to the intended recipient, you are hereby
>> notified that any dissemination, distribution or copying of this
>> communication is strictly prohibited. If you have received this e-mail
>> in error, please notify us immediately by return e-mail and delete
>> this e-mail and all attachments from your system.
>> ______________________________________________________________________
>> ___________________________________________
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
> your system.
> _________________________________________________________________________________________________________________
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  1 14:31:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 14:31:12 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F4F84C7.80804@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>	<4F4F7FBE.5020202@rabbitmq.com>	<88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
	<4F4F84C7.80804@rabbitmq.com>
Message-ID: <4F4F8830.1030803@rabbitmq.com>

Slightly better: stick a local fanout exchange in front of both, then 
all your clients only need to consume from the downstream and publish to 
the fanout.

Cheers, Simon

On 01/03/12 14:16, Simon MacMullen wrote:
> The best workaround I can offer is to only use asymmetric federation -
> i.e. have separate upstream and downstream exchanges and consume from
> both in any given broker.
>
> Cheers, Simon
>
> On 01/03/12 14:10, Busoli, Simone wrote:
>> Too bad that I didn't realize this was the case earlier, as this is a
>> real showstopper because of bandwidth consumption.
>> Any chance, by any means, we can have a fix for this or a feasible
>> workaround?
>>
>> -----Original Message-----
>> From: Simon MacMullen [mailto:simon at rabbitmq.com]
>> Sent: gioved? 1 marzo 2012 14:55
>> To: Busoli, Simone
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Symmetric federation behavior
>>
>> Yeah, I'm afraid that's the case. The existing design puts all the
>> smarts in the downstream; therefore the message can only be thrown
>> away once it's already gone over the gap.
>>
>> We will revisit this at some point.
>>
>> Cheers, Simon
>>
>> On 01/03/12 13:27, Busoli, Simone wrote:
>>> Hello,
>>>
>>> I've set up a symmetric federation between two brokers A and B, that
>>> is, an exchange on one broker acts as the upstream for one on the
>>> other broker with the same name and vice versa.
>>>
>>> To prevent messages from going into an infinite loop I've set max_hops
>>> to 1, but I am under the impression that messages published to broker
>>> A and then proxied to broker B are somehow proxied back once again to
>>> broker A and just then ignored because of the max_hops setting.
>>>
>>> Is this behavior expected? Our rationale for using this kind of
>>> symmetrically configured federation is twofold: first to prevent
>>> messages to go into loops and secondly to conserve bandwidth by
>>> preventing messages to roundtrip from A to B and back, and this second
>>> aspect doesn't seem to work correctly right now.
>>>
>>> Thanks
>>>
>>> ______________________________________________________________________
>>> ___________________________________________
>>> Questo messaggio e da intendersi esclusivamente ad uso del
>>> destinatario e puo contenere informazioni che sono di natura
>>> privilegiata, confidenziale o non divulgabile secondo le leggi
>>> vigenti. Se il lettore del presente messaggio non e il destinatario
>>> designato, o il dipendente/agente responsabile per la consegna del
>>> messaggio al destinatario designato, si informa che ogni
>>> disseminazione, distribuzione o copiatura di questa comunicazione e
>>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>>> Se avete ricevuto questo messaggio per errore, vi preghiamo di
>>> notificarcelo immediatamente a mezzo e-mail di risposta e
>>> successivamente di procedere alla cancellazione di questa e-mail e
>>> relativi allegati dal vostro sistema.
>>> ______________________________________________________________________
>>> ___________________________________________
>>> This message is intended only for the use of the addressee and may
>>> contain information that is privileged, confidential and exempt from
>>> disclosure under applicable law. If the reader of this message is not
>>> the intended recipient, or the employee or agent responsible for
>>> delivering the message to the intended recipient, you are hereby
>>> notified that any dissemination, distribution or copying of this
>>> communication is strictly prohibited. If you have received this e-mail
>>> in error, please notify us immediately by return e-mail and delete
>>> this e-mail and all attachments from your system.
>>> ______________________________________________________________________
>>> ___________________________________________
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>> _________________________________________________________________________________________________________________
>>
>> Questo messaggio ? da intendersi esclusivamente ad uso del
>> destinatario e pu? contenere informazioni che sono di natura
>> privilegiata, confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
>> messaggio non ? il destinatario designato, o il dipendente/agente
>> responsabile
>> per la consegna del messaggio al destinatario designato, si informa
>> che ogni disseminazione, distribuzione o copiatura di questa
>> comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>> Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di
>> procedere alla cancellazione di questa e-mail e relativi allegati dal
>> vostro sistema.
>> _________________________________________________________________________________________________________________
>>
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not
>> the intended recipient, or the employee or agent responsible for
>> delivering the
>> message to the intended recipient, you are hereby notified that any
>> dissemination, distribution or copying of this communication is strictly
>> prohibited. If you have received this e-mail in error, please notify
>> us immediately by return e-mail and delete this e-mail and all
>> attachments from
>> your system.
>> _________________________________________________________________________________________________________________
>>
>>
>>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Thu Mar  1 15:05:12 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 1 Mar 2012 15:05:12 +0000
Subject: [rabbitmq-discuss] Persistence in RabbitMQ and AMQP.
In-Reply-To: <CA+u4LE6E1ZYzTUzzkE2sppPPe3Z8z3TLNkT55Xd87xfxr0LOGw@mail.gmail.com>
References: <CA+u4LE6E1ZYzTUzzkE2sppPPe3Z8z3TLNkT55Xd87xfxr0LOGw@mail.gmail.com>
Message-ID: <AFD6ED4A-2FA1-4EDA-B42B-FA3287725B45@rabbitmq.com>

Hello Ashutosh,

The simple answer to your question is that queues can be 'durable' and
individual messages can be 'persistent'.

Durable queues (and persistent messages written to durable queues) survive
server crashes (or shutdowns).

There are many subtleties here, and these notions interact with other messaging
mechanisms. For example, unless something like 'Publisher Confirms' is used, it
is not clear when a (persistent) message has been correctly received by the
broker, and therefore should survive a server crash. So I recommend you read
about Publisher Confirms, and immediate and mandatory flags on messages.

For the AMQP details (including RabbitMQ extensions) see the protocol
documentation, on <http://www.rabbitmq.com/protocol.html>.

For the RabbitMQ client details, and some idea of how this works, I recommend
working through the RabbitMQ Tutorials (in either Java or Python) in particular
Tutorial 2 on Work Queues.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 1 Mar 2012, at 11:55, Ashutosh Mathur wrote:

> Hi,
> 
> I would like to know how does or in what ways does RabbitMQ/AMQP support Persistence(of messages,queues,etc). Please do provide a detailed answer or links which may provide further information on this.
> Thanks in advance.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Simone.Busoli at ferrari.com  Thu Mar  1 15:09:50 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 1 Mar 2012 15:09:50 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F4F8830.1030803@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>
	<4F4F7FBE.5020202@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
	<4F4F84C7.80804@rabbitmq.com> <4F4F8830.1030803@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>

Thanks Simon, I'll look into the options you described. Out of curiosity, to someone who knows how the federation behavior is implemented in code, how feasible is it to change it to suite the scenario I've been describing if I started looking into it?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: gioved? 1 marzo 2012 15:31
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

Slightly better: stick a local fanout exchange in front of both, then all your clients only need to consume from the downstream and publish to the fanout.

Cheers, Simon

On 01/03/12 14:16, Simon MacMullen wrote:
> The best workaround I can offer is to only use asymmetric federation - 
> i.e. have separate upstream and downstream exchanges and consume from 
> both in any given broker.
>
> Cheers, Simon
>
> On 01/03/12 14:10, Busoli, Simone wrote:
>> Too bad that I didn't realize this was the case earlier, as this is a 
>> real showstopper because of bandwidth consumption.
>> Any chance, by any means, we can have a fix for this or a feasible 
>> workaround?
>>
>> -----Original Message-----
>> From: Simon MacMullen [mailto:simon at rabbitmq.com]
>> Sent: gioved? 1 marzo 2012 14:55
>> To: Busoli, Simone
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Symmetric federation behavior
>>
>> Yeah, I'm afraid that's the case. The existing design puts all the 
>> smarts in the downstream; therefore the message can only be thrown 
>> away once it's already gone over the gap.
>>
>> We will revisit this at some point.
>>
>> Cheers, Simon
>>
>> On 01/03/12 13:27, Busoli, Simone wrote:
>>> Hello,
>>>
>>> I've set up a symmetric federation between two brokers A and B, that 
>>> is, an exchange on one broker acts as the upstream for one on the 
>>> other broker with the same name and vice versa.
>>>
>>> To prevent messages from going into an infinite loop I've set 
>>> max_hops to 1, but I am under the impression that messages published 
>>> to broker A and then proxied to broker B are somehow proxied back 
>>> once again to broker A and just then ignored because of the max_hops setting.
>>>
>>> Is this behavior expected? Our rationale for using this kind of 
>>> symmetrically configured federation is twofold: first to prevent 
>>> messages to go into loops and secondly to conserve bandwidth by 
>>> preventing messages to roundtrip from A to B and back, and this 
>>> second aspect doesn't seem to work correctly right now.
>>>
>>> Thanks
>>>
>>> ____________________________________________________________________
>>> __ ___________________________________________
>>> Questo messaggio e da intendersi esclusivamente ad uso del 
>>> destinatario e puo contenere informazioni che sono di natura 
>>> privilegiata, confidenziale o non divulgabile secondo le leggi 
>>> vigenti. Se il lettore del presente messaggio non e il destinatario 
>>> designato, o il dipendente/agente responsabile per la consegna del 
>>> messaggio al destinatario designato, si informa che ogni 
>>> disseminazione, distribuzione o copiatura di questa comunicazione e 
>>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>>> Se avete ricevuto questo messaggio per errore, vi preghiamo di 
>>> notificarcelo immediatamente a mezzo e-mail di risposta e 
>>> successivamente di procedere alla cancellazione di questa e-mail e 
>>> relativi allegati dal vostro sistema.
>>> ____________________________________________________________________
>>> __ ___________________________________________
>>> This message is intended only for the use of the addressee and may 
>>> contain information that is privileged, confidential and exempt from 
>>> disclosure under applicable law. If the reader of this message is 
>>> not the intended recipient, or the employee or agent responsible for 
>>> delivering the message to the intended recipient, you are hereby 
>>> notified that any dissemination, distribution or copying of this 
>>> communication is strictly prohibited. If you have received this 
>>> e-mail in error, please notify us immediately by return e-mail and 
>>> delete this e-mail and all attachments from your system.
>>> ____________________________________________________________________
>>> __ ___________________________________________
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>> _____________________________________________________________________
>> ____________________________________________
>>
>> Questo messaggio ? da intendersi esclusivamente ad uso del 
>> destinatario e pu? contenere informazioni che sono di natura 
>> privilegiata, confidenziale o non divulgabile secondo le leggi 
>> vigenti. Se il lettore del presente messaggio non ? il destinatario 
>> designato, o il dipendente/agente responsabile per la consegna del 
>> messaggio al destinatario designato, si informa che ogni 
>> disseminazione, distribuzione o copiatura di questa comunicazione ? 
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>> Se avete ricevuto questo messaggio per errore, vi preghiamo di 
>> notificarcelo immediatamente a mezzo e-mail di risposta e 
>> successivamente di procedere alla cancellazione di questa e-mail e 
>> relativi allegati dal vostro sistema.
>> _____________________________________________________________________
>> ____________________________________________
>>
>> This message is intended only for the use of the addressee and may 
>> contain information that is privileged, confidential and exempt from 
>> disclosure under applicable law. If the reader of this message is not 
>> the intended recipient, or the employee or agent responsible for 
>> delivering the message to the intended recipient, you are hereby 
>> notified that any dissemination, distribution or copying of this 
>> communication is strictly prohibited. If you have received this 
>> e-mail in error, please notify us immediately by return e-mail and 
>> delete this e-mail and all attachments from your system.
>> _____________________________________________________________________
>> ____________________________________________
>>
>>
>>
>
>


--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  1 15:15:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Mar 2012 15:15:35 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it>	<4F4F7FBE.5020202@rabbitmq.com>	<88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
	<4F4F84C7.80804@rabbitmq.com> <4F4F8830.1030803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>
Message-ID: <4F4F9297.8050805@rabbitmq.com>

On 01/03/12 15:09, Busoli, Simone wrote:
> Thanks Simon, I'll look into the options you described. Out of
> curiosity, to someone who knows how the federation behavior is
> implemented in code, how feasible is it to change it to suite the
> scenario I've been describing if I started looking into it?

The main issue is that the decision needs to be handled upstream - 
therefore the intermediate upstream exchange (currently a fanout) needs 
to be something a bit smarter, so we need a new 
x-federation-upstream-helper type or something. This then has knock on 
effects in that it would be nice to still support the case where 
federation is not installed upstream, so we need to detect this and fall 
back.

The next release is likely within a week or so, so this will probably 
not happen before then. But the release after that could easily include 
this enhancement.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Thu Mar  1 15:21:21 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 1 Mar 2012 15:21:21 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F4F9297.8050805@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
	<4F4F84C7.80804@rabbitmq.com> <4F4F8830.1030803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>
	<4F4F9297.8050805@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>

If we were sure this is going to be out in the release after the next one we could think of living with the bandwidth consumption for a while until there is a solution for it. 
I'm guessing you're going to have some planning sessions before then so I would be glad if you could get back to me as soon as you agree on whether it is going to be included in that release.
Thanks for your help so far.

Cheers, Simone

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: gioved? 1 marzo 2012 16:16
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

On 01/03/12 15:09, Busoli, Simone wrote:
> Thanks Simon, I'll look into the options you described. Out of 
> curiosity, to someone who knows how the federation behavior is 
> implemented in code, how feasible is it to change it to suite the 
> scenario I've been describing if I started looking into it?

The main issue is that the decision needs to be handled upstream - therefore the intermediate upstream exchange (currently a fanout) needs to be something a bit smarter, so we need a new x-federation-upstream-helper type or something. This then has knock on effects in that it would be nice to still support the case where federation is not installed upstream, so we need to detect this and fall back.

The next release is likely within a week or so, so this will probably not happen before then. But the release after that could easily include this enhancement.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From gmr at myyearbook.com  Thu Mar  1 15:21:50 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 1 Mar 2012 10:21:50 -0500
Subject: [rabbitmq-discuss] Management Plugin URL Encoding Bug
In-Reply-To: <4F4F59C7.6070200@rabbitmq.com>
References: <5010B638917648B6ACAD5503B2186E64@myyearbook.com>
	<4F4F59C7.6070200@rabbitmq.com>
Message-ID: <905E198A4977455DB902E5B575B3568E@myyearbook.com>

I had not tested against 2.7.1, I see it in 2.7.0 and earlier.  I just tested in 2.7.1 and see the routing key comes back from the server fully encoded and thus is passed back down fully encoded. 

Thanks,

Gavin 


On Thursday, March 1, 2012 at 6:13 AM, Simon MacMullen wrote:

> On 29/02/12 19:56, Gavin M. Roy wrote:
> > It appears that the Javascript code that encodes values does not
> > properly encode more than one underscore (_) when creating a URL.
> > 
> 
> 
> Hi Gavin.
> 
> There was an identical-sounding bug fixed in 2.7.1 (albeit in the HTTP 
> API rather than the JavaScript UI) - are you using the latest version?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/b4f6e71d/attachment.htm>

From eric at holtmans.com  Thu Mar  1 16:59:38 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 01 Mar 2012 10:59:38 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
Message-ID: <4F4FAAFA.3090707@holtmans.com>

On 2/16/2012 7:27 PM, Alan Antonuk wrote:

> 
> As a self-less plug, if you're looking for a C++ wrapper - I'd encourage
> you to checkout SimpleAmqpClient https://github.com/alanxz/SimpleAmqpClient,
> which is Yet Another rabbitmq-c wrapper.  It won't necessarily solve your
> threading question though.
> 


I cannot get this to build.   I'm trying to run it under
windows.

cmake fails with:

  Unable to find the requested Boost libraries.

  Boost version: 1.42.0

  Boost include path: C:/Program Files/boost/boost_1_42

I have 1.47 installed on my system.  I have set BOOST_ROOT and
BOOST_LIBRARYDIR

1.42 is on my system, but is not in the path anywhere, and is not
in the Options/Directories under Visual Studio anywhere.


Any clues?

From CKing at BroadViewNet.com  Thu Mar  1 18:10:00 2012
From: CKing at BroadViewNet.com (King, Christopher)
Date: Thu, 1 Mar 2012 13:10:00 -0500
Subject: [rabbitmq-discuss] Basic High Availability questions
Message-ID: <4BA41EF62C92F048A9AD2271C63A2BD2270848EC@BVNYMAIL.bvn.com>

Hi,

 

We are using RabbitMQ in a Pacemaker/corosync HA cluster.  Our current
implementation is very basic: Pacemaker manages the rabbitmq server as a
resource, and we have a floating IPAddr2 resource that is grouped with
it.  The single floating IP address is a requirement of our system.

 

I've been reading the mirrored queue article, and have a few questions.

1)      Are the master/slave broker nodes managed by Pacemaker (or some
similar HA system) to bring the nodes into service and/or restart in the
case of failure?  Does the master/salve term refer to the broker nodes
(i.e. A Pacemaker Stateful resource) or only the mirrored queues?

2)      It appears that the consumer client can connect to any broker,
and if it is consuming from a mirrored queue, it effectively is
consuming from the master node.  I.e., A client can have a connection
open to any broker node in the rabbitmq cluster, but effectively is
still consuming from the master node of a mirrored queue.  Is that
understanding correct?

3)      Does the server have support for floating IP addresses in 2.7.1?
(The 2.4.0 behaviour seems to be that the server will only bind to an IP
address at startup.  If the IP address becomes valid later, as in the
floating IP case, the server can't see it.)

Thanks,

 

Chris King

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/c2e8c000/attachment.htm>

From allen.fowler at yahoo.com  Thu Mar  1 18:13:56 2012
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Thu, 1 Mar 2012 10:13:56 -0800 (PST)
Subject: [rabbitmq-discuss] clott9
Message-ID: <1330625636.76461.yint-ygo-j2me@web114013.mail.gq1.yahoo.com>


Let your computer do the work and EARN money!
http://yawayonline.com/pjob4jou/httpjob4journal0129.php?hetpageID=73



            Thu, 1 Mar 2012 19:13:55
_____________________
" Philip called upon Richard from time to time to complete the marriage, but Richard found various pretexts for postponing it, and thus the matter stood when the expedition for the Holy Land set sail from Marseilles" (c) mariele worcester

From eric at holtmans.com  Thu Mar  1 18:31:25 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 01 Mar 2012 12:31:25 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <4F4FAAFA.3090707@holtmans.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
	<4F4FAAFA.3090707@holtmans.com>
Message-ID: <4F4FC07D.7050604@holtmans.com>

On 3/1/2012 10:59 AM, Eric J. Holtman wrote:

> 
> I cannot get this to build.   I'm trying to run it under
> windows.
> 
> cmake fails with:
> 


OK, fixed that (not finding right boost) by clearing
out the build directory and re-running cmake.

Now I can't figure out the right incantation for
finding the rabbitqmc libraries.

What am I supposed to set Rabbitmqc_INCLUDE_DIR and
Rabbitmqc_LIBRARY to?

I've tried all sorts of different things, I can't get
cmake to find my compiled/installed version.

From pdezwart at rubiconproject.com  Thu Mar  1 18:48:38 2012
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 1 Mar 2012 12:48:38 -0600
Subject: [rabbitmq-discuss] RabbitMQ distaste for symlinks?
Message-ID: <CB750486.38CFD%pdezwart@rubiconproject.com>

Hey everyone,

We had something weird happen overnight. Our setup dictates that rabbit
run under /var/lib/rabbitmq, a partition that only has 9G of disk space.
We opted to symlink
/var/lib/rabbitmq/mnesia/rabbit at frpp-urb0000/msg_store_transient to
/rabbitmq/msg_store_transient, which is hosted on a separate partition
with 600G of space instead. Somehow, overnight, the symlink went missing,
and rabbit started writing back to /var, filled up the disk space, and
took our primary broker down (thank god for HA and redundancy).

We looked through the access logs and we cant find any indication of any
user logging in and/or touching the symlink, which brought up the
question: does rabbit do any file manipulation of the transient message
store? Maybe delete it when its empty and then recreate it, or something?
I know, I am grasping for straws...

Thanks!
Pieter


From jerryk at vmware.com  Thu Mar  1 18:50:35 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 1 Mar 2012 10:50:35 -0800 (PST)
Subject: [rabbitmq-discuss] Basic High Availability questions
In-Reply-To: <4BA41EF62C92F048A9AD2271C63A2BD2270848EC@BVNYMAIL.bvn.com>
Message-ID: <3c2eadd7-0c7c-432a-a9c4-794fcdbfd103@strongmad.batnest.org>

Hi, Christopher:

Mirrored queues are actually a new active-active form of RabbitMQ HA,
disjoint from the classic active-passive using Pacemaker model in
versions prior to 2.6.0.

1) In mirrored queues there's no need for any Pacemaker.  You specify
that you want a queue mirrored, and replicas are made on the cluster
nodes you specify.  At any moment there's a designated master and
slaves, the management thereof all happening within the Rabbit cluster
without involvement of any external forces.

2) You can indeed continue connecting to any node in the cluster when
you consume from queues, mirrored or otherwise.  The only real case
where an application needs to know something about cluster topology
and where mirrored copies of queues live is when doing queue.declares.
The contents a consumer sees when consuming are those of the master.

3) You don't need to worry about floating IP trickery if you're using
the new mirrored queue HA/HA.  Operationally it's much less complex
than the old way.

Best regards,
Jerry

----- Original Message -----
From: "Christopher King" <CKing at BroadViewNet.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, March 1, 2012 10:10:00 AM
Subject: [rabbitmq-discuss] Basic High Availability questions





Hi,



We are using RabbitMQ in a Pacemaker/corosync HA cluster. Our current implementation is very basic: Pacemaker manages the rabbitmq server as a resource, and we have a floating IPAddr2 resource that is grouped with it. The single floating IP address is a requirement of our system.



I?ve been reading the mirrored queue article, and have a few questions.

1) Are the master/slave broker nodes managed by Pacemaker (or some similar HA system) to bring the nodes into service and/or restart in the case of failure? Does the master/salve term refer to the broker nodes (i.e. A Pacemaker Stateful resource) or only the mirrored queues?

2) It appears that the consumer client can connect to any broker, and if it is consuming from a mirrored queue, it effectively is consuming from the master node. I.e., A client can have a connection open to any broker node in the rabbitmq cluster, but effectively is still consuming from the master node of a mirrored queue. Is that understanding correct?

3) Does the server have support for floating IP addresses in 2.7.1? (The 2.4.0 behaviour seems to be that the server will only bind to an IP address at startup. If the IP address becomes valid later, as in the floating IP case, the server can?t see it.)

Thanks,



Chris King


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From smetj.net at gmail.com  Fri Mar  2 00:08:58 2012
From: smetj.net at gmail.com (Jelle Smet)
Date: Thu, 1 Mar 2012 16:08:58 -0800 (PST)
Subject: [rabbitmq-discuss] Pika,
	Detect publish failure when broker becomes unavailable
Message-ID: <32887938.46.1330646938201.JavaMail.geo-discussion-forums@ynel5>

Hi all,

I'm using pika 0.9.5 and trying to figure out how to detect whether 
RabbitMQ is still available/unavailable after creating a connection to it.
When I stop Rabbit between the channel creation and publishing the message, 
there appears to be no way of detecting whether rabbit is still 
alive/available.
Publishing the message doesn't generate any error, connection.is_open 
always returns True...

Anyone an idea how to deal with this?

Cheers,

J


#!/usr/bin/python

import pika
from pika.adapters import SelectConnection
from pika.adapters import BlockingConnection
import time

parameters = pika.ConnectionParameters(host='sandbox')
connection = BlockingConnection(parameters)

channel = connection.channel()

channel.queue_declare(queue="test", durable=True, exclusive=False, 
auto_delete=False)


time.sleep(10)
#I stop rabbitmq here

print connection.is_open #Returns True so this doesn't work


#this doesn't generate any error
channel.basic_publish(exchange='', routing_key="test", body="Hello World!",
                      
properties=pika.BasicProperties(content_type="text/plain", delivery_mode=1))

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/314b3ae1/attachment.htm>

From santiagomonttco at gmail.com  Fri Mar  2 03:17:09 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Fri, 2 Mar 2012 00:17:09 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?=7CSpam=7C_ACCIDENTES_DEL_TRA?=
	=?windows-1252?q?BAJO_=22RESPONSABILIDAD_CIVIL_Y_PENAL=22?=
Message-ID: <553ca75b7ff19bdee54883cb001ffba8@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120302/55cd7b1a/attachment.htm>

From alan.antonuk at gmail.com  Fri Mar  2 04:59:00 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 1 Mar 2012 23:59:00 -0500
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <4F4FC07D.7050604@holtmans.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
	<4F4FAAFA.3090707@holtmans.com> <4F4FC07D.7050604@holtmans.com>
Message-ID: <CAAt2poLBiHiR1Hs+FwD+-B7uBT9pqtTym+cM49FdE1+011tXZg@mail.gmail.com>

I use CMake's FindBoost.cmake module to find the boost libraries on the
system.  You can get a detailed description of all of the relavent
variables you can set using the following command:

$ cmake --help-module FindBoost

Variables that you'll want to consider setting:
Boost_ADDITIONAL_VERSIONS - to whatever version of boost you have installed.
Boost_USE_STATIC_LIBS - if you built boost statically (it defaults to
dynamic libraries)
BOOST_DIR - the path to wherever you put your built boost library, if it
isn't some place the compiler will find itself (LIB and LIBDIR variables
using MSVC)

You can also set Boost_DEBUG and Boost_DETAILED_FAILURE_MSG variables to
see how cmake is failing to find boost.

*For finding Rabbitmq-c* I wrote a FindRabbitmqc.cmake (in the Modules
directory).

It searches for the amqp.h file in:
${Rabbitmqc_DIR}/include
Then your system paths

If it doesn't pick it up automatically you set Rabbitmqc_INCLUDE_DIR to the
directory containing the amqp.h file by hand.

It searches for the rabbitmq library (librabbitmq.a/librabbitmq.so on *nix
rabbitmq.lib/.dll on windows) in:
${Rabbitmq_DIR}/lib
Then your system include paths

If it doesn't pick it up automatically, you can set Rabbitmqc_LIBRARY to
the filename of the library by hand.

Hope that helps.

-Alan

On Thu, Mar 1, 2012 at 1:31 PM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 3/1/2012 10:59 AM, Eric J. Holtman wrote:
>
> >
> > I cannot get this to build.   I'm trying to run it under
> > windows.
> >
> > cmake fails with:
> >
>
>
> OK, fixed that (not finding right boost) by clearing
> out the build directory and re-running cmake.
>
> Now I can't figure out the right incantation for
> finding the rabbitqmc libraries.
>
> What am I supposed to set Rabbitmqc_INCLUDE_DIR and
> Rabbitmqc_LIBRARY to?
>
> I've tried all sorts of different things, I can't get
> cmake to find my compiled/installed version.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120301/b01c1cf5/attachment.htm>

From amathur.q at gmail.com  Fri Mar  2 05:00:36 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Fri, 2 Mar 2012 10:30:36 +0530
Subject: [rabbitmq-discuss] Serialized Java Objects in Message bodies not
	supported by RabbitMQ??
Message-ID: <CA+u4LE7kZtJAQ5mTFm+aXDk4Q+1yRF1=OrVgD07_erOt=dWuTw@mail.gmail.com>

Hi,

RabbitMQ doesn't support Serialized Java Objects in Message bodies.Is that
true? In JMS,it is done by "CreateObjectMessage()" method. Is there any
function in AMQP which has same/similar functionality.?
One possible solution for above may be to convert data into JSON strings
and send within the message.will that work?
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120302/e60eb23d/attachment.htm>

From jerryk at vmware.com  Fri Mar  2 05:11:42 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 1 Mar 2012 21:11:42 -0800 (PST)
Subject: [rabbitmq-discuss] Serialized Java Objects in Message bodies
	not	supported by RabbitMQ??
In-Reply-To: <CA+u4LE7kZtJAQ5mTFm+aXDk4Q+1yRF1=OrVgD07_erOt=dWuTw@mail.gmail.com>
Message-ID: <8ccec3ad-e6c3-42d4-a788-098e483097e3@strongmad.batnest.org>

Hi, Ashutosh:

You can put any bytes you want into an AMQP message payload,
you'll just have to handle the encoding yourself in the usual
Java serialization ways.  Be warned though, that serializing POJOs
is going to put restrictions on the the recipients of your message 
can be, i.e. they're also going to need to be in Java, with the 
appropriate stuff versions of the appropriate stuff on their 
classpaths, to be able to make sense out of what you're sending 
them if you plan to deserialize them into Java objects.

You might find the JSON solution you suggest gives you something 
that's a bit more friendly in polyglot systems, and leave your 
application with more future flexibility...

Jerry

----- Original Message -----
From: "Ashutosh Mathur" <amathur.q at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, March 1, 2012 9:00:36 PM
Subject: [rabbitmq-discuss] Serialized Java Objects in Message bodies not	supported by RabbitMQ??


Hi, 

RabbitMQ doesn't support Serialized Java Objects in Message bodies.Is that true? In JMS,it is done by "CreateObjectMessage()" method. Is there any function in AMQP which has same/similar functionality.? 
One possible solution for above may be to convert data into JSON strings and send within the message.will that work? 
Thanks in advance. 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Fri Mar  2 11:14:50 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 2 Mar 2012 11:14:50 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>
	<4F4F84C7.80804@rabbitmq.com> <4F4F8830.1030803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>
	<4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
Message-ID: <88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>

We are considering to temporary disable one of the two sides of the symmetric federation and constrain publishers to publish to the upstream only to avoid the unneeded roundtrip. 
Our options would be to:

- disable one side of the federation and leave the other as-is
- disable both sides of the federation and replace it with a unidirectional shovel

What I'm concerned with is how to do this on a live system. We can shutdown the brokers of course as all clients have a reconnection logic built into them and will be able to catch up once the broker comes back online, but I'm wondering if it's feasible to just change the configuration file to carry out one of the two options above without needing to recreate the exchanges. Considering the first option, for instance, I would shutdown the broker on which I want to remove the federation, change the configuration file and start it up again, but the exchange on that broker (as it is durable) would still be of type x-federation, and I'm not sure the broker will like it.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Busoli, Simone
Sent: gioved? 1 marzo 2012 16:21
To: Simon MacMullen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

If we were sure this is going to be out in the release after the next one we could think of living with the bandwidth consumption for a while until there is a solution for it. 
I'm guessing you're going to have some planning sessions before then so I would be glad if you could get back to me as soon as you agree on whether it is going to be included in that release.
Thanks for your help so far.

Cheers, Simone

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: gioved? 1 marzo 2012 16:16
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

On 01/03/12 15:09, Busoli, Simone wrote:
> Thanks Simon, I'll look into the options you described. Out of 
> curiosity, to someone who knows how the federation behavior is 
> implemented in code, how feasible is it to change it to suite the 
> scenario I've been describing if I started looking into it?

The main issue is that the decision needs to be handled upstream - therefore the intermediate upstream exchange (currently a fanout) needs to be something a bit smarter, so we need a new x-federation-upstream-helper type or something. This then has knock on effects in that it would be nice to still support the case where federation is not installed upstream, so we need to detect this and fall back.

The next release is likely within a week or so, so this will probably not happen before then. But the release after that could easily include this enhancement.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from your system.
_________________________________________________________________________________________________________________

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Mar  2 11:14:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Mar 2012 11:14:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ distaste for symlinks?
In-Reply-To: <CB750486.38CFD%pdezwart@rubiconproject.com>
References: <CB750486.38CFD%pdezwart@rubiconproject.com>
Message-ID: <4F50ABB1.8090601@rabbitmq.com>

Hi Pieter.

On 01/03/12 18:48, Pieter de Zwart wrote:
> We had something weird happen overnight. Our setup dictates that rabbit
> run under /var/lib/rabbitmq, a partition that only has 9G of disk space.
> We opted to symlink
> /var/lib/rabbitmq/mnesia/rabbit at frpp-urb0000/msg_store_transient to
> /rabbitmq/msg_store_transient, which is hosted on a separate partition
> with 600G of space instead. Somehow, overnight, the symlink went missing,
> and rabbit started writing back to /var, filled up the disk space, and
> took our primary broker down (thank god for HA and redundancy).
>
> We looked through the access logs and we cant find any indication of any
> user logging in and/or touching the symlink, which brought up the
> question: does rabbit do any file manipulation of the transient message
> store? Maybe delete it when its empty and then recreate it, or something?
> I know, I am grasping for straws...

Yes, RabbitMQ will delete and recreate the transient message store on 
startup, so if someone restarted it, that's what you'd see.

In general, I would suggest you symlink /var/lib/rabbitmq/mnesia into 
the bug partition - Rabbit will tend to view anything under that as 
being its domain.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  2 11:27:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Mar 2012 11:27:48 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it>	<4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com>	<88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it>	<4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
Message-ID: <4F50AEB4.5050803@rabbitmq.com>

On 02/03/12 11:14, Busoli, Simone wrote:
> the exchange on that broker (as it is durable) would still be of type
> x-federation, and I'm not sure the broker will like it.

It's fine to have a federated exchange with no upstreams. It will act 
like a normal exchange.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From eric at holtmans.com  Fri Mar  2 12:55:34 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Fri, 02 Mar 2012 06:55:34 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <CAAt2poLBiHiR1Hs+FwD+-B7uBT9pqtTym+cM49FdE1+011tXZg@mail.gmail.com>
References: <4F3CF301.40700@holtmans.com>	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>	<4F4FAAFA.3090707@holtmans.com>	<4F4FC07D.7050604@holtmans.com>
	<CAAt2poLBiHiR1Hs+FwD+-B7uBT9pqtTym+cM49FdE1+011tXZg@mail.gmail.com>
Message-ID: <4F50C346.1090507@holtmans.com>

On 3/1/2012 10:59 PM, Alan Antonuk wrote:

> 
> *For finding Rabbitmq-c* I wrote a FindRabbitmqc.cmake (in the Modules
> directory).
> 
> It searches for the amqp.h file in:
> ${Rabbitmqc_DIR}/include
> Then your system paths
> 
> If it doesn't pick it up automatically you set Rabbitmqc_INCLUDE_DIR to the
> directory containing the amqp.h file by hand.
> 
> It searches for the rabbitmq library (librabbitmq.a/librabbitmq.so on *nix
> rabbitmq.lib/.dll on windows) in:
> ${Rabbitmq_DIR}/lib
> Then your system include paths
> 
> If it doesn't pick it up automatically, you can set Rabbitmqc_LIBRARY to
> the filename of the library by hand.
> 
> Hope that helps.
> 


I tried that:

C:\rabbit-c\simpleamqpclient-build>dir %Rabbitmqc_INCLUDE_DIR%\amqp.h
 Volume in drive C has no label.
 Volume Serial Number is 60C2-C1FC

 Directory of c:\rabbit-c\rabbitmq-c\librabbitmq

02/15/2012  03:00 PM            14,097 amqp.h
               1 File(s)         14,097 bytes
               0 Dir(s)  36,886,913,024 bytes free

so, amqp.h is in the right place.

C:\rabbit-c\simpleamqpclient-build>dir %Rabbitmqc_LIBRARY%\rabbitmq.*
 Volume in drive C has no label.
 Volume Serial Number is 60C2-C1FC

 Directory of c:\rabbit-c\rabbitmq-c-build\librabbitmq\Debug

02/22/2012  01:15 PM           108,544 rabbitmq.dll
02/15/2012  05:03 PM             9,383 rabbitmq.exp
02/22/2012  01:15 PM           265,216 rabbitmq.idb
02/22/2012  01:15 PM           386,320 rabbitmq.ilk
02/15/2012  05:03 PM            16,132 rabbitmq.lib
02/22/2012  01:15 PM           815,104 rabbitmq.pdb
               6 File(s)      1,600,699 bytes
               0 Dir(s)  36,886,913,024 bytes free

.dll/.lib in the right place:


C:\rabbit-c\simpleamqpclient-build>cmake ..\SimpleAmqpClient
-- Building for: Visual Studio 9 2008
-- Check for working C compiler using: Visual Studio 9 2008
-- Check for working C compiler using: Visual Studio 9 2008 -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working CXX compiler using: Visual Studio 9 2008
-- Check for working CXX compiler using: Visual Studio 9 2008 -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Boost version: 1.47.0
-- Found the following Boost libraries:
--   chrono
--   system
Rabbitmqc_INCLUDE_DIR=Rabbitmqc_INCLUDE_DIR-NOTFOUND
Rabbitmqc_LIBRARY=Rabbitmqc_LIBRARY-NOTFOUND
CMake Error at Modules/LibFindMacros.cmake:74 (message):
  Required library Rabbitmqc NOT FOUND.

  Install the library (dev version) and try again.  If the library is
already
  installed, use ccmake to set the missing variables manually.
Call Stack (most recent call first):
  Modules/FindRabbitmqc.cmake:19 (LIBFIND_PROCESS)
  CMakeLists.txt:12 (FIND_PACKAGE)


-- Configuring incomplete, errors occurred!






Still fails.

I'm wondering if this is even worth the effort.  (Not your wrapper,
just the cmake process).

Once I've gotten the C library itself to build (using python et al
to build the framing files), I'm tempted to just extract the .c and
.h files I need into a new Visual Studio project, and go from there.

I understand the concept of cmake (trying to get a platform independent
delivery base), but at this point, for a library with only really
10 .c and .h files, I've got at least 4 directories, the .vcproj files
have tons of -I directives, and......


Anyway, after seeing the trace above, if you have any clues, I'd
appreciate it.


From Simone.Busoli at ferrari.com  Fri Mar  2 14:21:09 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 2 Mar 2012 14:21:09 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F50AEB4.5050803@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>

Hi Simon, I have tried some local spikes before applying the solution in the production environment, but it appears that I cannot get to unfederate the exchange. Even if I change the configuration and restart the broker, it appears that the exchange is still there with federation set-up.
Is that something I should expect?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: venerd? 2 marzo 2012 12:28
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

On 02/03/12 11:14, Busoli, Simone wrote:
> the exchange on that broker (as it is durable) would still be of type 
> x-federation, and I'm not sure the broker will like it.

It's fine to have a federated exchange with no upstreams. It will act like a normal exchange.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From simon at rabbitmq.com  Fri Mar  2 14:36:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Mar 2012 14:36:13 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
Message-ID: <4F50DADD.5060304@rabbitmq.com>

Well, it will still claim to be a federated exchange, but if you don't
define any upstreams for it then it won't actually federate. Is that 
what you mean by "the exchange is still there with federation set-up"?

Sadly the code to let you monitor running federation links hasn't made
it into any releases yet so the only way to see if federation is
actually happening is to look for messages in the logs along the lines
of "Federation exchange foo connected to blah" at startup. There
shouldn't be any.

Cheers, Simon

On 02/03/12 14:21, Busoli, Simone wrote:
> Hi Simon, I have tried some local spikes before applying the solution
> in the production environment, but it appears that I cannot get to
> unfederate the exchange. Even if I change the configuration and
> restart the broker, it appears that the exchange is still there with
> federation set-up. Is that something I should expect?
>
> -----Original Message----- From: Simon MacMullen
> [mailto:simon at rabbitmq.com] Sent: venerd? 2 marzo 2012 12:28 To:
> Busoli, Simone Cc: rabbitmq-discuss at lists.rabbitmq.com Subject: Re:
> [rabbitmq-discuss] Symmetric federation behavior
>
> On 02/03/12 11:14, Busoli, Simone wrote:
>> the exchange on that broker (as it is durable) would still be of
>> type x-federation, and I'm not sure the broker will like it.
>
> It's fine to have a federated exchange with no upstreams. It will act
> like a normal exchange.
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
>
> _________________________________________________________________________________________________________________
>
>
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario 
e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non ? il destinatario designato, o il
> dipendente/agente responsabile per la consegna del messaggio al
> destinatario designato, si informa che ogni disseminazione,
> distribuzione o copiatura di questa comunicazione ? strettamente
> proibita anche ai sensi del decreto legislativo 196/03 . Se avete
> ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati dal
> vostro sistema.
> _________________________________________________________________________________________________________________
>
>
This message is intended only for the use of the addressee and may 
contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the message to the intended recipient, you are hereby
> notified that any dissemination, distribution or copying of this
> communication is strictly prohibited. If you have received this
> e-mail in error, please notify us immediately by return e-mail and
> delete this e-mail and all attachments from your system.
> _________________________________________________________________________________________________________________
>
>
-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Fri Mar  2 14:41:17 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 2 Mar 2012 14:41:17 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F50DADD.5060304@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
	<4F50DADD.5060304@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>

Well, what leads me to think that it's still behaving as before is that I see messages being published on the "federation: ..." queues on both brokers.
I am assuming it is behaving as before because this is what happens when I just the remove the exchange federation configuration, but if I remove the upstream-sets entry as well the broker will crash at startup. I am under the impression that there's no way to unfederate an exchange actually, perhaps because it is a durable exchange maybe?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: venerd? 2 marzo 2012 15:36
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

Well, it will still claim to be a federated exchange, but if you don't define any upstreams for it then it won't actually federate. Is that what you mean by "the exchange is still there with federation set-up"?

Sadly the code to let you monitor running federation links hasn't made it into any releases yet so the only way to see if federation is actually happening is to look for messages in the logs along the lines of "Federation exchange foo connected to blah" at startup. There shouldn't be any.

Cheers, Simon

On 02/03/12 14:21, Busoli, Simone wrote:
> Hi Simon, I have tried some local spikes before applying the solution 
> in the production environment, but it appears that I cannot get to 
> unfederate the exchange. Even if I change the configuration and 
> restart the broker, it appears that the exchange is still there with 
> federation set-up. Is that something I should expect?
>
> -----Original Message----- From: Simon MacMullen 
> [mailto:simon at rabbitmq.com] Sent: venerd? 2 marzo 2012 12:28 To:
> Busoli, Simone Cc: rabbitmq-discuss at lists.rabbitmq.com Subject: Re:
> [rabbitmq-discuss] Symmetric federation behavior
>
> On 02/03/12 11:14, Busoli, Simone wrote:
>> the exchange on that broker (as it is durable) would still be of type 
>> x-federation, and I'm not sure the broker will like it.
>
> It's fine to have a federated exchange with no upstreams. It will act 
> like a normal exchange.
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
>
> ______________________________________________________________________
> ___________________________________________
>
>
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente 
> messaggio non ? il destinatario designato, o il dipendente/agente 
> responsabile per la consegna del messaggio al destinatario designato, 
> si informa che ogni disseminazione, distribuzione o copiatura di 
> questa comunicazione ? strettamente proibita anche ai sensi del 
> decreto legislativo 196/03 . Se avete ricevuto questo messaggio per 
> errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di 
> risposta e successivamente di procedere alla cancellazione di questa 
> e-mail e relativi allegati dal vostro sistema.
> ______________________________________________________________________
> ___________________________________________
>
>
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not 
> the intended recipient, or the employee or agent responsible for 
> delivering the message to the intended recipient, you are hereby 
> notified that any dissemination, distribution or copying of this 
> communication is strictly prohibited. If you have received this e-mail 
> in error, please notify us immediately by return e-mail and delete 
> this e-mail and all attachments from your system.
> ______________________________________________________________________
> ___________________________________________
>
>
--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  2 14:53:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Mar 2012 14:53:11 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
	<4F50DADD.5060304@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>
Message-ID: <4F50DED7.5040606@rabbitmq.com>

On 02/03/12 14:41, Busoli, Simone wrote:
> if I remove the upstream-sets entry as well the
> broker will crash at startup.

Sorry, you do need to have the upstream_sets config item defined with 
all the sets that you reference in declared exchanges, but they can all 
be empty, e.g.:

  {rabbitmq_federation,
         [{upstream_sets, [{"my-upstream-set",      []},
                           {"another-upstream-set", []}]}]}

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Fri Mar  2 14:58:12 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 2 Mar 2012 14:58:12 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F50DED7.5040606@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
	<4F50DADD.5060304@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>
	<4F50DED7.5040606@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210A0B7@GSVCLU03.ges.ferlan.it>

Ah, now I get it, thanks for clarifying. Seems to be working now, except that the "federation: ..." queue which is no longer being drained is still there and messages are piling up. Should I delete it manually perhaps?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: venerd? 2 marzo 2012 15:53
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

On 02/03/12 14:41, Busoli, Simone wrote:
> if I remove the upstream-sets entry as well the broker will crash at 
> startup.

Sorry, you do need to have the upstream_sets config item defined with all the sets that you reference in declared exchanges, but they can all be empty, e.g.:

  {rabbitmq_federation,
         [{upstream_sets, [{"my-upstream-set",      []},
                           {"another-upstream-set", []}]}]}

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From simon at rabbitmq.com  Fri Mar  2 14:59:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Mar 2012 14:59:46 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210A0B7@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
	<4F50DADD.5060304@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>
	<4F50DED7.5040606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A0B7@GSVCLU03.ges.ferlan.it>
Message-ID: <4F50E062.2000607@rabbitmq.com>

Yes, you can delete the queue on the upstream broker.

Cheers, Simon

On 02/03/12 14:58, Busoli, Simone wrote:
> Ah, now I get it, thanks for clarifying. Seems to be working now,
> except that the "federation: ..." queue which is no longer being
> drained is still there and messages are piling up. Should I delete it
> manually perhaps?
>
> -----Original Message----- From: Simon MacMullen
> [mailto:simon at rabbitmq.com] Sent: venerd? 2 marzo 2012 15:53 To:
> Busoli, Simone Cc: rabbitmq-discuss at lists.rabbitmq.com Subject: Re:
> [rabbitmq-discuss] Symmetric federation behavior
>
> On 02/03/12 14:41, Busoli, Simone wrote:
>> if I remove the upstream-sets entry as well the broker will crash
>> at startup.
>
> Sorry, you do need to have the upstream_sets config item defined with
> all the sets that you reference in declared exchanges, but they can
> all be empty, e.g.:
>
> {rabbitmq_federation, [{upstream_sets, [{"my-upstream-set",
> []}, {"another-upstream-set", []}]}]}
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
>
> _________________________________________________________________________________________________________________
>
>
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario 
e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non ? il destinatario designato, o il
> dipendente/agente responsabile per la consegna del messaggio al
> destinatario designato, si informa che ogni disseminazione,
> distribuzione o copiatura di questa comunicazione ? strettamente
> proibita anche ai sensi del decreto legislativo 196/03 . Se avete
> ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati dal
> vostro sistema.
> _________________________________________________________________________________________________________________
>
>
This message is intended only for the use of the addressee and may 
contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the message to the intended recipient, you are hereby
> notified that any dissemination, distribution or copying of this
> communication is strictly prohibited. If you have received this
> e-mail in error, please notify us immediately by return e-mail and
> delete this e-mail and all attachments from your system.
> _________________________________________________________________________________________________________________
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Fri Mar  2 15:02:05 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 2 Mar 2012 15:02:05 +0000
Subject: [rabbitmq-discuss] Symmetric federation behavior
In-Reply-To: <4F50E062.2000607@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E52109AB3@GSVCLU03.ges.ferlan.it><4F4F7FBE.5020202@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109ADA@GSVCLU03.ges.ferlan.it><4F4F84C7.80804@rabbitmq.com>
	<4F4F8830.1030803@rabbitmq.com><88E590DC4586974D825FC82AE798294E52109B52@GSVCLU03.ges.ferlan.it><4F4F9297.8050805@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52109B78@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E52109F55@GSVCLU03.ges.ferlan.it>
	<4F50AEB4.5050803@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A04D@GSVCLU03.ges.ferlan.it>
	<4F50DADD.5060304@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A066@GSVCLU03.ges.ferlan.it>
	<4F50DED7.5040606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210A0B7@GSVCLU03.ges.ferlan.it>
	<4F50E062.2000607@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210A0DA@GSVCLU03.ges.ferlan.it>

Ok great, thanks a lot for your _live_ support.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: venerd? 2 marzo 2012 16:00
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Symmetric federation behavior

Yes, you can delete the queue on the upstream broker.

Cheers, Simon

On 02/03/12 14:58, Busoli, Simone wrote:
> Ah, now I get it, thanks for clarifying. Seems to be working now, 
> except that the "federation: ..." queue which is no longer being 
> drained is still there and messages are piling up. Should I delete it 
> manually perhaps?
>
> -----Original Message----- From: Simon MacMullen 
> [mailto:simon at rabbitmq.com] Sent: venerd? 2 marzo 2012 15:53 To:
> Busoli, Simone Cc: rabbitmq-discuss at lists.rabbitmq.com Subject: Re:
> [rabbitmq-discuss] Symmetric federation behavior
>
> On 02/03/12 14:41, Busoli, Simone wrote:
>> if I remove the upstream-sets entry as well the broker will crash at 
>> startup.
>
> Sorry, you do need to have the upstream_sets config item defined with 
> all the sets that you reference in declared exchanges, but they can 
> all be empty, e.g.:
>
> {rabbitmq_federation, [{upstream_sets, [{"my-upstream-set", []}, 
> {"another-upstream-set", []}]}]}
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
>
> ______________________________________________________________________
> ___________________________________________
>
>
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente 
> messaggio non ? il destinatario designato, o il dipendente/agente 
> responsabile per la consegna del messaggio al destinatario designato, 
> si informa che ogni disseminazione, distribuzione o copiatura di 
> questa comunicazione ? strettamente proibita anche ai sensi del 
> decreto legislativo 196/03 . Se avete ricevuto questo messaggio per 
> errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di 
> risposta e successivamente di procedere alla cancellazione di questa 
> e-mail e relativi allegati dal vostro sistema.
> ______________________________________________________________________
> ___________________________________________
>
>
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not 
> the intended recipient, or the employee or agent responsible for 
> delivering the message to the intended recipient, you are hereby 
> notified that any dissemination, distribution or copying of this 
> communication is strictly prohibited. If you have received this e-mail 
> in error, please notify us immediately by return e-mail and delete 
> this e-mail and all attachments from your system.
> ______________________________________________________________________
> ___________________________________________
>
>
>


--
Simon MacMullen
RabbitMQ, VMware

From alvinzmho at gmail.com  Fri Mar  2 17:35:21 2012
From: alvinzmho at gmail.com (AlvinRMQ)
Date: Fri, 2 Mar 2012 09:35:21 -0800 (PST)
Subject: [rabbitmq-discuss]  Failure starting rabbitMQ broker
Message-ID: <33397550.post@talk.nabble.com>


I have a 2 node rabbitMQ cluster that has been running for a few months. The
nodes restart every morning but today the master node failed to start
properly with the following error message in the erl_crash.dump:

=erl_crash_dump:0.1
Mon Feb 27 06:51:13 2012
Slogan: Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
System version: Erlang R14B04 (erts-5.8.5) [smp:8:8] [rq:8]
[async-threads:30]
Compiled: Mon Oct  3 19:19:39 2011

http://old.nabble.com/file/p33397550/erl_crash.dump erl_crash.dump 

However, I was able to make it start after rebooting the machine again. I am
running RabbitMQ 2.7.0 server on windows 7. I do not have experience with
erlang. Can someone please explain to me what the error message means?

Thanks.
-- 
View this message in context: http://old.nabble.com/Failure-starting-rabbitMQ-broker-tp33397550p33397550.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alan.antonuk at gmail.com  Sat Mar  3 05:49:18 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 3 Mar 2012 00:49:18 -0500
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <4F50C346.1090507@holtmans.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
	<4F4FAAFA.3090707@holtmans.com> <4F4FC07D.7050604@holtmans.com>
	<CAAt2poLBiHiR1Hs+FwD+-B7uBT9pqtTym+cM49FdE1+011tXZg@mail.gmail.com>
	<4F50C346.1090507@holtmans.com>
Message-ID: <CAAt2poJFQ_Ww5212uJPWkyb=Outxy8jxD_acCpo2tTE2Zy46mA@mail.gmail.com>

I think you're misunderstanding how to use cmake: when I said set a
variable I meant a cmake variable and not a shell variable.

You set a cmake variable by adding a -DVARIABLE_NAME=VALUE to the command
line.

To be more concrete, lets say you have your rabbitmq-c source tree in:
c:\dev\rabbitmq-c
And have built the project in-source using MSVC

You have boost v1.47.0 in, and its built with shared libraries
c:\dev\boost-1.47.0

The appropriate cmake command might look something like:
$ cmake -DBOOST_ROOT=c:\dev\boost-1.47.0
-DBoost_ADDITIONAL_VERSIONS="1.47.0"
-DRabbitmqc_INCLUDE_DIR=c:\dev\rabbitmq-c\librabbitmq
-DRabbitmqc_LIBRARY=c:\dev\rabbitmq-c\librabbitmq\Debug\rabbitmq.lib

You can also use the cmake-gui program to set these variables.

That said: the FindRabbitmq.cmake module does not expect to find the
headers and the libraries in a source, or build tree.  It expects to find
these in an 'install tree', which basically copies the correct files to a
known location and structure: headers in ${PREFIX}/include libraries in
${PREFIX}/lib and executables in ${PREFIX}/bin. On linux/unix ${PREFIX} is
usually /usr/local, on windows its in C:\Program Files\${ProjectName} -
which I personally don't like.

My recommendation would be to run cmake-gui in your rabbitmq-c build and
set the CMAKE_INSTALL_PREFIX to something like c:\dev\install, then build
the 'INSTALL' project which will copy the appropriate files to an install
tree in c:\dev\install

You can then either add c:\dev\install\include and c:\dev\install\lib paths
to the INCLUDE and LIB environment variables or you can set the cmake
variable Rabbitmqc_DIR to c:\dev\install when running cmake against
SimpleAmqpClient, and save having to specify the Rabbitmqc_INCLUDE_DIR and
Rabbitmqc_LIBRARY individually.

Note that since rabbitmq is built as a shared library (DLL on windows) by
default, you'll need to have the rabbitmq.dll in a place that windows can
find it (putting these in the same directory as the executable or adding
the path containing the DLL to the PATH environment variable.

HTH
-Alan

On Fri, Mar 2, 2012 at 7:55 AM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 3/1/2012 10:59 PM, Alan Antonuk wrote:
>
> >
> > *For finding Rabbitmq-c* I wrote a FindRabbitmqc.cmake (in the Modules
> > directory).
> >
> > It searches for the amqp.h file in:
> > ${Rabbitmqc_DIR}/include
> > Then your system paths
> >
> > If it doesn't pick it up automatically you set Rabbitmqc_INCLUDE_DIR to
> the
> > directory containing the amqp.h file by hand.
> >
> > It searches for the rabbitmq library (librabbitmq.a/librabbitmq.so on
> *nix
> > rabbitmq.lib/.dll on windows) in:
> > ${Rabbitmq_DIR}/lib
> > Then your system include paths
> >
> > If it doesn't pick it up automatically, you can set Rabbitmqc_LIBRARY to
> > the filename of the library by hand.
> >
> > Hope that helps.
> >
>
>
> I tried that:
>
> C:\rabbit-c\simpleamqpclient-build>dir %Rabbitmqc_INCLUDE_DIR%\amqp.h
>  Volume in drive C has no label.
>  Volume Serial Number is 60C2-C1FC
>
>  Directory of c:\rabbit-c\rabbitmq-c\librabbitmq
>
> 02/15/2012  03:00 PM            14,097 amqp.h
>               1 File(s)         14,097 bytes
>               0 Dir(s)  36,886,913,024 bytes free
>
> so, amqp.h is in the right place.
>
> C:\rabbit-c\simpleamqpclient-build>dir %Rabbitmqc_LIBRARY%\rabbitmq.*
>  Volume in drive C has no label.
>  Volume Serial Number is 60C2-C1FC
>
>  Directory of c:\rabbit-c\rabbitmq-c-build\librabbitmq\Debug
>
> 02/22/2012  01:15 PM           108,544 rabbitmq.dll
> 02/15/2012  05:03 PM             9,383 rabbitmq.exp
> 02/22/2012  01:15 PM           265,216 rabbitmq.idb
> 02/22/2012  01:15 PM           386,320 rabbitmq.ilk
> 02/15/2012  05:03 PM            16,132 rabbitmq.lib
> 02/22/2012  01:15 PM           815,104 rabbitmq.pdb
>               6 File(s)      1,600,699 bytes
>               0 Dir(s)  36,886,913,024 bytes free
>
> .dll/.lib in the right place:
>
>
> C:\rabbit-c\simpleamqpclient-build>cmake ..\SimpleAmqpClient
> -- Building for: Visual Studio 9 2008
> -- Check for working C compiler using: Visual Studio 9 2008
> -- Check for working C compiler using: Visual Studio 9 2008 -- works
> -- Detecting C compiler ABI info
> -- Detecting C compiler ABI info - done
> -- Check for working CXX compiler using: Visual Studio 9 2008
> -- Check for working CXX compiler using: Visual Studio 9 2008 -- works
> -- Detecting CXX compiler ABI info
> -- Detecting CXX compiler ABI info - done
> -- Boost version: 1.47.0
> -- Found the following Boost libraries:
> --   chrono
> --   system
> Rabbitmqc_INCLUDE_DIR=Rabbitmqc_INCLUDE_DIR-NOTFOUND
> Rabbitmqc_LIBRARY=Rabbitmqc_LIBRARY-NOTFOUND
> CMake Error at Modules/LibFindMacros.cmake:74 (message):
>  Required library Rabbitmqc NOT FOUND.
>
>  Install the library (dev version) and try again.  If the library is
> already
>  installed, use ccmake to set the missing variables manually.
> Call Stack (most recent call first):
>  Modules/FindRabbitmqc.cmake:19 (LIBFIND_PROCESS)
>  CMakeLists.txt:12 (FIND_PACKAGE)
>
>
> -- Configuring incomplete, errors occurred!
>
>
>
>
>
>
> Still fails.
>
> I'm wondering if this is even worth the effort.  (Not your wrapper,
> just the cmake process).
>
> Once I've gotten the C library itself to build (using python et al
> to build the framing files), I'm tempted to just extract the .c and
> .h files I need into a new Visual Studio project, and go from there.
>
> I understand the concept of cmake (trying to get a platform independent
> delivery base), but at this point, for a library with only really
> 10 .c and .h files, I've got at least 4 directories, the .vcproj files
> have tons of -I directives, and......
>
>
> Anyway, after seeing the trace above, if you have any clues, I'd
> appreciate it.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120303/92384dfc/attachment.htm>

From eric at holtmans.com  Sat Mar  3 23:01:08 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Sat, 03 Mar 2012 17:01:08 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient
In-Reply-To: <CAAt2poJFQ_Ww5212uJPWkyb=Outxy8jxD_acCpo2tTE2Zy46mA@mail.gmail.com>
References: <4F3CF301.40700@holtmans.com>	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>	<4F4FAAFA.3090707@holtmans.com>	<4F4FC07D.7050604@holtmans.com>	<CAAt2poLBiHiR1Hs+FwD+-B7uBT9pqtTym+cM49FdE1+011tXZg@mail.gmail.com>	<4F50C346.1090507@holtmans.com>
	<CAAt2poJFQ_Ww5212uJPWkyb=Outxy8jxD_acCpo2tTE2Zy46mA@mail.gmail.com>
Message-ID: <4F52A2B4.8030901@holtmans.com>

On 3/2/2012 11:49 PM, Alan Antonuk wrote:
> I think you're misunderstanding how to use cmake: when I said set a
> variable I meant a cmake variable and not a shell variable.
> 
> You set a cmake variable by adding a -DVARIABLE_NAME=VALUE to the command
> line.
> 

Thanks, Alan . . . that cleared everything up.

I think I was the victim of cargo-cult programming.  While
I was wandering around in the weeds trying to get cmake to
recognize my boost 1.47 install instead of my boost 1.42 install,
I think I set some env variables.  That wasn't my problem, but
since it seemed to fix it, I figured it would fix the SimpleAmqpClient
issue as well.


From pdezwart at rubiconproject.com  Sun Mar  4 03:49:47 2012
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Sat, 3 Mar 2012 21:49:47 -0600
Subject: [rabbitmq-discuss] FW: [PECL-DEV] [ANNOUNCEMENT] amqp-1.0.1
	(stable) Released.
In-Reply-To: <20120302214044.48799.qmail@pb12.pair.com>
Message-ID: <CB782467.3974F%pdezwart@rubiconproject.com>

We released version 1.0.1 on Friday. There were just a few little things
that slipped by. There is another pending release to handle routing keys
during publishing and binding correctly.

Any and all feedback is appreciated!



On 3/2/12 1:40 PM, "PECL Announce" <pecl-dev at lists.php.net> wrote:

>The new PECL package amqp-1.0.1 (stable) has been released at
>http://pecl.php.net/.
>
>Release notes
>-------------
>1.0.1 Release:
>Fixed bug:
>    * 61247: Allow queue creation with empty queue name, and return auto
>generated name
>    * 61127: Segmentation fault when cleaning up an AMQPChannel without
>calling AMQPConnection::connect first
>
>1.0.0 Release:
>Changed/finalized API signature:
>    * Exposing AMQPChannel
>    * Exposing AMQPEnvelope
>    * Exposing more queue and exchange arguments and flags
>    * Exposing basic.qos
>Added persistent connections
>Cleaned up codebase
>Fixed memory leaks and segmentation faults
>     
>0.3.1 Release:
>Fixed bug:
>    * 24323: Cannot get the name for auto-named reply-to queues
>     
>0.3.0 Release:
>Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>Andy Wick)
>Fixed consume method to return proper values
>Cleaned up variable usage
>Fixed bugs:
>    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>    * 22698: AMQPQueue::consume
>
>0.2.2 Release:
>Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>Fixed wrong typing of message properties (courtesy John Skopis)
>
>0.2.1 Release:
>Fixed refcount decrementing bug causing segfaults.
>
>0.2.0 Release:
>Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
>instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
>Improved consume method to block for MIN messages, and try to get MAX
>messages if available
>Fixed zval descoping bugs
>Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
>Package Info
>-------------
>This extension can communicate with any AMQP spec 0-9-1 compatible
>server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>create and delete exchanges and queues, as well as publish to any
>exchange and consume from any queue.
>
>Related Links
>-------------
>Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-1.0.1.tgz
>
>Authors
>-------------
>Pieter de Zwart (lead)
>
>
>-- 
>PECL development discussion Mailing List (http://pecl.php.net/)
>To unsubscribe, visit: http://www.php.net/unsub.php
>


From lukemanner at gmail.com  Sun Mar  4 20:17:06 2012
From: lukemanner at gmail.com (luke manner)
Date: Sun, 4 Mar 2012 21:17:06 +0100
Subject: [rabbitmq-discuss] Multiple consumers on a queue
Message-ID: <CAJBmP-W_XQiGiL+hHg=gX8nbU651iCx8a+dWY+cHXmRDWw2zTQ@mail.gmail.com>

Hi,
I'm defining a Camel RabbitMQ component.
In route definition it is possible to define the number of concurrent
consumers on a specific endpoint.
If we suppose that user want to use a queue (in JMS style),
I have to declare just only the queue (default exchange is used).


On this queue multiple consumers can asynchronously obtain a message and
this message is delivered through camel to receivers.
Do you have any hint on how manage multiple consumers? All of them have to
use the basicConsume and the broker ensures that different messages are
provided to consumers in a round robin way?

Any help will be appreciate.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120304/60f3a1ad/attachment.htm>

From simone.busoli at gmail.com  Sun Mar  4 20:26:10 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 4 Mar 2012 21:26:10 +0100
Subject: [rabbitmq-discuss] Multiple consumers on a queue
In-Reply-To: <CAJBmP-W_XQiGiL+hHg=gX8nbU651iCx8a+dWY+cHXmRDWw2zTQ@mail.gmail.com>
References: <CAJBmP-W_XQiGiL+hHg=gX8nbU651iCx8a+dWY+cHXmRDWw2zTQ@mail.gmail.com>
Message-ID: <CAOn7oW_rm5cgdzPpMm584DN98E+GO1sBPZFFnr-StB2vUW3wpg@mail.gmail.com>

Hi Luke, more or less. This behavior is influenced by the prefetch-count
setting, which dictates how many messages are delivered to a consumer in
advance before they are acked. If you set it to 1, then you will achieve
what you describe.
On Mar 4, 2012 9:17 PM, "luke manner" <lukemanner at gmail.com> wrote:

> Hi,
> I'm defining a Camel RabbitMQ component.
> In route definition it is possible to define the number of concurrent
> consumers on a specific endpoint.
> If we suppose that user want to use a queue (in JMS style),
> I have to declare just only the queue (default exchange is used).
>
>
> On this queue multiple consumers can asynchronously obtain a message and
> this message is delivered through camel to receivers.
> Do you have any hint on how manage multiple consumers? All of them have to
> use the basicConsume and the broker ensures that different messages are
> provided to consumers in a round robin way?
>
> Any help will be appreciate.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120304/e73b887c/attachment.htm>

From brian.newsgroup at gmail.com  Mon Mar  5 05:33:43 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Mon, 5 Mar 2012 16:33:43 +1100
Subject: [rabbitmq-discuss] SSL connection errors once or twice every week
Message-ID: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>

Hello,

We have been using RabbitMQ together with federation plugin in our
production environment. Every few days we have some downstream servers
and/or upstream servers hanging, which cannot recover on their own and have
to be killed and restarted manually. Normal restart (service
rabbitmq-server restart) on these hanging servers would just stay there
forever trying to restart, so they have to be force killed before being
restarted.

We have got multiple upstream and downstream servers. Each downstream
server talks to all upstream servers, and vice versa. We use federation in
a "symmetric" way in that federation exchanges on the servers are used for
both downstream and upstream purposes. max_hops is set to 1 so it doesn't
form a loop. However, there has been a lot of traffic generated by RabbitMQ
on the network. I've read a recent discussion on symmetric federation on
this mailing list and it seems that there are some problems with it. Not
sure if the error we've been having has anything to do with it.

It seems to me that the error message suggests a connection problem, but
not sure whether it has to do with the federation plugin. Since the error
will take a while to happen again (but will definitely happen) and it'll
probably take at least a couple of weeks for us to determine the cause of
it, I was just wondering if anyone can easily see what this error is about
and if there is any fix for this.

Let me know if more information is needed. Any help would be greatly
appreciated!

Here is the error message:

=INFO REPORT==== 17-Feb-2012::11:58:39 ===
starting TCP connection <0.19666.4> from 10.19.100.10:51445

=INFO REPORT==== 17-Feb-2012::11:58:40 ===
upgraded TCP connection <0.19666.4> to SSL

=ERROR REPORT==== 17-Feb-2012::11:58:41 ===
connection <0.19666.4>, channel 2 - error:
{amqp_error,not_found,
            "no exchange 'federation: ts -> chewbacca:rs B' in vhost '/'",
            'exchange.delete'}

=INFO REPORT==== 17-Feb-2012::11:59:55 ===
Federation exchange 'ts' in vhost '/' connected to 10.19.100.10:5671:/:rs

=INFO REPORT==== 19-Feb-2012::00:17:56 ===
SSL: Socket error: ehostunreach


=ERROR REPORT==== 19-Feb-2012::00:17:56 ===
** State machine <0.19667.4> terminating
** Last message in was {tcp_error,#Port<0.7174>,ehostunreach}
** When State == connection
**      Data  == {state,server,
                     {#Ref<0.0.2.41472>,<0.19666.4>},
                     gen_tcp,tcp,tcp_closed,tcp_error,"localhost",5671,
                     #Port<0.7174>,
                     {ssl_options,[],verify_peer,
                         {#Fun<ssl.3.66992289>,
                          #Fun<rabbit_networking.0.80337212>},
                         false,false,undefined,1,
                         "/etc/rabbitmq/certs/server/cert.pem",undefined,
                         "/etc/rabbitmq/certs/server/key.pem",undefined,
                         undefined,undefined,
                         "/etc/rabbitmq/certs/testca/cacert.pem",undefined,
                         undefined,
                         [<<0,57>>,
                          <<0,56>>,
                          <<0,53>>,
                          <<0,22>>,
                          <<0,19>>,
                          <<0,10>>,
                          <<0,51>>,
                          <<0,50>>,
                          <<0,47>>,
                          <<0,5>>,
                          <<0,4>>,
                          <<0,21>>,
                          <<0,9>>],
                         #Fun<ssl.0.123982462>,true,18446744073709551900,
                         false,[],undefined},
                     {socket_options,binary,0,0,0,once},
                     {connection_states,
                         {connection_state,
                             {security_parameters,
                                 <<0,53>>,
                                 0,7,1,16,256,32,unknown,2,20,0,

<<213,226,167,243,36,225,117,174,26,113,107,

68,197,183,4,70,236,126,250,31,203,52,69,43,

105,252,205,75,169,13,117,64,134,62,230,13,

229,241,170,181,103,116,249,98,34,110,81,120>>,

<<79,61,166,54,4,241,68,223,169,240,194,203,

212,204,88,120,161,154,112,195,214,164,224,
                                   199,236,47,165,172,151,235,119,66>>,

<<79,61,166,63,26,160,125,193,150,16,70,58,16,

153,134,49,222,19,30,138,216,70,224,16,212,
                                   31,66,80,249,190,233,232>>,
                                 undefined},
                             undefined,
                             {cipher_state,

<<166,237,209,135,65,44,54,254,116,232,232,21,
                                   71,65,156,243>>,

<<222,58,54,75,192,174,82,129,229,82,125,31,

199,227,93,36,190,91,163,225,12,12,107,218,
                                   46,37,147,165,242,251,96,61>>,
                                 undefined},

<<155,100,115,240,203,42,54,112,212,4,250,136,248,
                               33,61,146,46,52,250,92>>,
                             4726,true,
                             <<68,159,4,227,232,222,225,139,24,69,55,147>>,

<<53,139,69,42,122,101,224,100,144,98,247,136>>},
                         {connection_state,
                             {security_parameters,undefined,0,undefined,
                                 undefined,undefined,undefined,undefined,
                                 undefined,undefined,undefined,undefined,
                                 undefined,undefined,

<<79,61,166,64,135,104,6,75,30,243,86,193,245,

128,225,5,92,4,97,194,111,172,21,242,129,27,
                                   88,20,111,83,220,189>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,53>>,
                                 0,7,1,16,256,32,unknown,2,20,0,

<<213,226,167,243,36,225,117,174,26,113,107,

68,197,183,4,70,236,126,250,31,203,52,69,43,

105,252,205,75,169,13,117,64,134,62,230,13,

229,241,170,181,103,116,249,98,34,110,81,120>>,

<<79,61,166,54,4,241,68,223,169,240,194,203,

212,204,88,120,161,154,112,195,214,164,224,
                                   199,236,47,165,172,151,235,119,66>>,

<<79,61,166,63,26,160,125,193,150,16,70,58,16,

153,134,49,222,19,30,138,216,70,224,16,212,
                                   31,66,80,249,190,233,232>>,
                                 undefined},
                             undefined,
                             {cipher_state,
                                 <<22,11,209,109,83,84,156,48,32,78,217,242,
                                   122,245,245,181>>,

<<6,203,146,213,209,163,106,164,13,97,19,252,
                                   140,9,96,227,103,97,128,19,70,78,185,136,
                                   113,204,139,66,127,138,64,34>>,
                                 undefined},

<<5,194,148,88,152,255,80,36,119,74,250,112,76,87,
                               214,237,242,76,135,6>>,
                             7060,true,
                             <<68,159,4,227,232,222,225,139,24,69,55,147>>,

<<53,139,69,42,122,101,224,100,144,98,247,136>>},
                         {connection_state,
                             {security_parameters,undefined,0,undefined,
                                 undefined,undefined,undefined,undefined,
                                 undefined,undefined,undefined,undefined,
                                 undefined,undefined,

<<79,61,166,64,96,136,174,122,110,176,1,184,

198,114,174,129,32,102,231,33,11,242,30,88,
                                   113,226,126,206,155,112,239,90>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined}},
                     [],<<>>,<<>>,
                     {<<>>,<<>>},
                     [],2994260,
                     {session,

<<138,157,166,139,130,58,93,77,177,4,153,202,214,175,

148,97,39,47,47,26,51,187,222,253,146,247,213,191,
                           204,176,112,194>>,

<<48,130,2,225,48,130,1,201,160,3,2,1,2,2,1,2,48,13,6,

9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,

6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,

23,13,49,49,49,50,48,49,48,54,49,48,51,54,90,23,13,

50,49,49,49,50,56,48,54,49,48,51,54,90,48,36,49,17,

48,15,6,3,85,4,3,19,8,103,114,111,112,101,108,108,

111,49,15,48,13,6,3,85,4,10,19,6,99,108,105,101,110,

116,48,130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,

1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,187,221,

90,147,108,212,164,227,233,68,216,216,245,254,200,2,
                           41,241,207,145,28,253,107,144,64,25,91,82,249,63,

162,128,86,104,9,161,128,48,63,213,237,57,96,170,74,

150,160,235,155,128,136,187,91,17,243,88,199,163,39,

146,182,6,75,3,206,25,59,91,121,71,161,27,44,132,99,

226,218,92,244,179,186,225,169,216,212,111,193,106,

96,102,224,158,142,64,25,57,42,111,162,148,203,189,

122,113,75,191,250,49,224,230,76,32,19,208,73,252,
                           37,216,63,79,227,15,205,53,156,63,248,27,174,193,

194,17,25,103,228,227,136,37,67,51,140,149,220,54,
                           176,223,163,138,228,181,18,48,41,199,206,179,155,

153,202,22,38,220,212,136,198,25,21,85,182,135,121,

140,45,118,254,171,132,43,24,244,55,243,19,171,180,

48,4,217,195,178,225,224,35,17,13,123,251,90,89,13,

185,10,166,52,58,219,181,27,43,13,107,136,125,101,

252,4,144,17,236,91,75,1,211,167,171,234,32,144,18,

13,236,231,64,112,196,185,114,155,223,217,64,95,103,

100,82,177,156,51,192,78,190,185,247,90,142,111,2,3,

1,0,1,163,47,48,45,48,9,6,3,85,29,19,4,2,48,0,48,11,

6,3,85,29,15,4,4,3,2,7,128,48,19,6,3,85,29,37,4,12,

48,10,6,8,43,6,1,5,5,7,3,2,48,13,6,9,42,134,72,134,

247,13,1,1,5,5,0,3,130,1,1,0,70,235,45,39,71,230,62,

77,167,49,17,222,181,4,192,226,130,231,24,217,253,

138,40,88,134,118,159,17,197,141,12,244,197,11,57,

71,161,42,190,181,77,162,212,204,46,207,197,224,14,

182,125,37,50,28,201,156,79,128,190,195,124,96,107,

243,16,2,224,88,247,147,219,13,58,107,159,143,234,

243,201,107,56,167,19,22,166,184,43,150,77,97,190,

183,210,96,230,39,64,33,77,37,249,200,244,145,196,

77,58,215,201,167,210,180,82,74,231,129,26,165,82,

67,230,198,253,185,224,98,234,75,139,169,209,223,80,

93,179,198,235,16,189,177,172,43,80,85,151,39,143,

85,84,57,217,167,99,140,170,59,191,153,149,3,66,15,

126,63,112,142,182,0,170,84,15,13,251,189,171,132,

149,185,67,172,53,101,244,100,143,47,56,159,112,250,

36,22,183,21,205,192,183,243,87,0,13,180,42,110,64,

108,224,208,160,47,32,96,204,2,99,34,124,50,23,159,
                           61,173,153,40,121,13,53,161,0,153,83,210,128,118,

210,43,47,186,115,165,218,0,60,125,238,54,166,161,
                           59,132,139,111,212,1,162,16>>,

<<48,130,2,225,48,130,1,201,160,3,2,1,2,2,1,1,48,13,6,

9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,

6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,

23,13,49,49,49,50,48,49,48,54,48,56,52,55,90,23,13,

50,49,49,49,50,56,48,54,48,56,52,55,90,48,36,49,17,

48,15,6,3,85,4,3,19,8,103,114,111,112,101,108,108,
                           111,49,15,48,13,6,3,85,4,10,19,6,115,101,114,118,

101,114,48,130,1,34,48,13,6,9,42,134,72,134,247,13,

1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,211,

197,239,159,234,44,225,233,71,198,112,181,20,65,254,

38,226,54,237,75,111,195,171,229,251,172,239,71,237,

207,182,77,39,117,121,116,54,178,177,70,22,78,187,

91,190,144,174,90,147,253,217,24,153,88,86,240,12,

43,192,0,173,226,154,1,40,156,143,116,62,195,6,212,

21,183,62,164,103,209,144,165,14,228,36,214,90,71,

201,119,70,80,98,77,202,255,89,98,130,133,51,2,201,

84,175,115,29,17,87,173,127,119,120,163,168,213,218,

239,59,165,125,226,189,233,156,190,16,69,122,38,36,

45,170,150,164,190,51,14,57,123,156,61,47,125,189,

45,221,226,242,11,36,205,81,219,144,53,42,16,39,39,
                           126,84,159,148,103,193,40,135,227,33,143,125,164,

143,177,194,192,26,171,244,97,230,210,98,111,120,56,

105,67,197,126,115,247,227,91,42,229,14,103,107,249,

108,221,169,209,60,187,142,164,149,95,94,4,168,233,

236,111,140,76,53,127,189,41,245,59,232,208,252,139,

62,63,176,222,57,111,75,23,91,65,121,132,178,235,30,

130,115,169,0,57,82,139,177,132,110,2,208,14,37,2,3,

1,0,1,163,47,48,45,48,9,6,3,85,29,19,4,2,48,0,48,11,

6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,29,37,4,12,

48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,72,134,

247,13,1,1,5,5,0,3,130,1,1,0,107,62,132,105,170,9,
                           212,46,223,127,176,167,81,78,149,136,133,186,145,

118,183,245,45,117,104,68,174,83,238,180,145,125,10,

134,100,175,62,192,13,151,174,243,154,118,233,204,

240,45,57,146,157,38,210,154,147,18,248,248,76,105,

71,56,156,145,129,96,236,241,156,93,60,198,120,109,

199,15,2,66,93,229,126,51,228,22,152,253,1,245,58,

23,107,222,158,252,17,174,96,214,174,62,171,184,72,
                           16,246,225,214,2,246,220,11,211,209,14,187,46,74,
                           229,235,242,73,39,218,19,214,198,161,119,141,207,

163,126,109,186,193,57,102,167,206,153,100,146,123,

126,172,120,219,60,31,129,222,176,178,138,162,192,

234,5,124,136,68,141,100,66,74,21,252,121,102,241,

25,95,236,100,4,14,226,92,169,34,115,218,185,195,47,

79,30,156,81,160,132,119,51,22,82,66,109,55,193,43,
                           49,162,245,175,70,229,50,80,178,53,186,14,147,41,

214,80,136,212,85,142,180,149,3,77,240,150,207,150,

32,50,0,170,79,141,97,41,2,150,7,110,28,228,138,89,
                           252,86,203,221,77,55,185,38,127,57,155,132>>,
                         0,
                         <<0,53>>,
                         <<213,226,167,243,36,225,117,174,26,113,107,68,197,

183,4,70,236,126,250,31,203,52,69,43,105,252,205,75,

169,13,117,64,134,62,230,13,229,241,170,181,103,116,
                           249,98,34,110,81,120>>,
                         true,undefined},
                     3006545,ssl_session_cache,
                     {3,1},
                     undefined,false,rsa,undefined,
                     {'RSAPrivateKey','two-prime',

26733888243954032639493945355378651641939366228481256857536474393698815990033421919494691489863707532678433266055379180921670441122471606114607517646228859067337981366652832175793337203970265712841766561330994102352268924716159787538639704745920435882299144174112558557010046099015297165656332137749120327001691289263898507721876568514798182129906643473214153540916185542584190269258525271080383264965658901863970305368253883803888475734975817922342926472990395164199248748259739148561733932569200222557037932550632037883875163976459062154731623262601492909960284943535117190965093684222976486329405290326506754543141,
                         65537,

19638926341103848931073996447645601792110240744983774511333079378217431329236447577584454996231111211274096940063936025242121270692895204308736505020981158596486256235655186417922615108228092107955109469898215970576126998665407278503139752281727779195224224439911424373540010366525664384139622723649139402523057646332031746318146069882155546775041878344935580784164293428918078878647526946291756476712430695689632084526183710423269560979597244472951214040124632189711837793336370653813366701595674106850012255679776174650307416978789128301595245252412894223959611800760267511646456073285111733061886471761081646015681,

177468221471267592959462072764121466940196903068066410572043602454082240715081242042509786132231542521680132746426975245619690593583885962543716788317814592781430786138246575995345414171447935333333738375794904031190813035393698344746110335546405731252630779784661964873323575380259166711051864760760459167039,

150640424647982932748549989167076843675993323800890265692777316272428245602205796254497685083373967363821039945013560477307144689417342997024955062130871951088291677187010112883632338552378119297706080173393731599917709479223740731270666048786064065637674964132109182747349377809019088277441708637239984414619,

11338014301847771666711440845070366084480590096372950563271839777152483968964785700169194112267169210343389471737945669673766643504214879002251280844205406106105721982404419086813727346931542567414870417923512873317300672584851533781710544805725022456852847627422366707731599098480936433147293250428064185611,

99417117763622958134188078969962122811145814441248543139661633633139546802365154029014661568672518370080834028132604754024270596864045032688761407255206579923871883389422179874618397349092244317933127541077951068246040715861043900528233638129527487784926340061980047487501034362202932788743897065442479910601,

57680421567639822270628306189496861089385670094641916193476111860126145371827374999675381364998416489580079100178978901092831951245342360541564455113199735957614397864732338137863696612804836795154913219598727549346153287983388725107880942227515400079146331721681590144968544898949263973602287315085851221482,
                         asn1_NOVALUE},
                     {'DHParameter',

179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                         2,asn1_NOVALUE},
                     undefined,undefined,#Ref<0.0.0.3248>,undefined,0,<<>>,
                     true,undefined,false,
                     {[],[]},
                     false}
** Reason for termination =
** {badarg,[{ssl_connection,send_user,2},
            {ssl_connection,handle_info,3},
            {gen_fsm,handle_msg,7},
            {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 19-Feb-2012::00:17:56 ===
exception on TCP connection <0.19666.4> from 10.19.100.10:51445
{writer,send_failed,closed}

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/65c307ff/attachment.htm>

From ponmuthu1988 at live.com  Mon Mar  5 08:15:15 2012
From: ponmuthu1988 at live.com (ponmuthu muniyasamy)
Date: Mon, 5 Mar 2012 13:45:15 +0530
Subject: [rabbitmq-discuss] After enabled rabbitmq_management plugin ,
 RabbitMQ getting crashed .
Message-ID: <COL103-W5482C03B5123C107803CA5AB500@phx.gbl>


Hi ,


   kindly help me to fix this issue 

Versions:

RabbitMQ  v2.7.1 
erlang-R12B-5.10.el5
Red Hat Enterprise Linux Server release 5.2 (Tikanga)
                    


---------------------------------------------------------------------------------------------------------------------

Before Enable rabbitmq_management plugin , no issue in my RabbitMQ getting proper log as below :

---------------------------------------------------------------------------------------------------------------------
=INFO REPORT==== 2-Mar-2012::02:27:00 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
Memory limit set to 401MB of 1002MB total.

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 2-Mar-2012::02:28:06 ===
Management agent started.


-----------------------------------------------------------------------------------------------------------------

After Enabled rabbitmq_management plugin , my RabbitMQ getting crashed logs as below :

-----------------------------------------------------------------------------------------------------------------

Erlang has closed
{"Kernel
 pid 
terminated",application_controller,"{application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{{case_clause,{error,{{'EXIT',{undef,[{lists,keyfind,[name,1,[{loop,#Fun<mochiweb_http.0.65037361>},{name,rabbit_mochiweb_web_mgmt},{port,55672}]]},{mochilists,is_defined,2},{mochilists,set_default,2},{lists,foldl,3},{mochiweb_http,start,1},{supervisor,do_start_child,2},{supervisor,handle_start_child,2},{supervisor,handle_call,3}]}},{child,undefined,{rabbit_mochiweb_web,mgmt},{rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},transient,5000,worker,dynamic}}}},[{rabbit_mochiweb_sup,ensure_listener,1},{rabbit_mochiweb_registry,handle_call,3},{gen_server,handle_msg,5},{proc_lib,init_p_do_apply,3}]},{gen_server,call,[rabbit_mochiweb_registry,{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,#Fun<rabbit_mochiweb.0.51174676>,{[],[82,97,98,98,105,116,77,81,32,77,97,110,97,103,101,109,101,110,116]}},infinity]}}}}}}"}

Crash dump was written to: erl_crash.dump
Kernel
 pid terminated (application_controller) 
({application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{{case_clause,{error,{{'EXIT',{undef,[{lists,




=INFO REPORT==== 2-Mar-2012::02:26:40 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
Memory limit set to 401MB of 1002MB total.

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
Management agent started.

=ERROR REPORT==== 2-Mar-2012::02:26:40 ===
** Generic server rabbit_mochiweb_registry terminating
** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
                            #Fun<rabbit_mochiweb.0.51174676>,
                            {[],"RabbitMQ Management"}}
** When Server state == undefined
** Reason for termination ==
** {{case_clause,
        {error,
            {{'EXIT',
                 {undef,
                     [{lists,keyfind,
                          [name,1,
                           [{loop,#Fun<mochiweb_http.0.65037361>},
                            {name,rabbit_mochiweb_web_mgmt},
                            {port,55672}]]},
                      {mochilists,is_defined,2},
                      {mochilists,set_default,2},
                      {lists,foldl,3},
                      {mochiweb_http,start,1},
                      {supervisor,do_start_child,2},
                      {supervisor,handle_start_child,2},
                      {supervisor,handle_call,3}]}},
             {child,undefined,
                 {rabbit_mochiweb_web,mgmt},
                 {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                 transient,5000,worker,dynamic}}}},
    [{rabbit_mochiweb_sup,ensure_listener,1},
     {rabbit_mochiweb_registry,handle_call,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 2-Mar-2012::02:26:40 ===
    application: rabbitmq_management
    exited: {bad_return,
             {{rabbit_mgmt_app,start,[normal,[]]},
              {'EXIT',
               {{{case_clause,
                  {error,
                   {{'EXIT',
                     {undef,
                      [{lists,keyfind,
                        [name,1,
                         [{loop,#Fun<mochiweb_http.0.65037361>},
                          {name,rabbit_mochiweb_web_mgmt},
                          {port,55672}]]},
                       {mochilists,is_defined,2},
                       {mochilists,set_default,2},
                       {lists,foldl,3},
                       {mochiweb_http,start,1},
                       {supervisor,do_start_child,2},
                       {supervisor,handle_start_child,2},
                       {supervisor,handle_call,3}]}},
                    {child,undefined,
                     {rabbit_mochiweb_web,mgmt},
                     {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                     transient,5000,worker,dynamic}}}},
                 [{rabbit_mochiweb_sup,ensure_listener,1},
                  {rabbit_mochiweb_registry,handle_call,3},
                  {gen_server,handle_msg,5},
                  {proc_lib,init_p_do_apply,3}]},
                {gen_server,call,
                 [rabbit_mochiweb_registry,
                  {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
                   #Fun<rabbit_mochiweb.0.51174676>,
                   {[],"RabbitMQ Management"}},
                  infinity]}}}}}
    type: permanent


Please help me to fix this issue , waiting for solution 
                     		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/505f7aad/attachment.htm>

From Simone.Busoli at ferrari.com  Mon Mar  5 08:01:16 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 5 Mar 2012 08:01:16 +0000
Subject: [rabbitmq-discuss] Entity creation order guarantees with
	shovel/federation
Message-ID: <88E590DC4586974D825FC82AE798294E5210A77B@GSVCLU03.ges.ferlan.it>

Hello, I would like to know if there are any guarantees about the order in which entities like exchanges and queues are created when they are declared in shovel or federation addins with respect to when the broker becomes available for clients to connect.
I had assumed that when the broker would start accepting connections then the plugins were already initialized and the entities they declare available.
What I experienced instead is that after a broker shutdown some clients where a reconnection logic was put in place randomly found the exchanges they were trying to bound their queues to to not exist yet, as if it depended on when exactly the client tried reconnecting.

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/a587b279/attachment.htm>

From ivan.dyachkoff at gmail.com  Mon Mar  5 08:56:38 2012
From: ivan.dyachkoff at gmail.com (Ivan Dyachkov)
Date: Mon, 5 Mar 2012 09:56:38 +0100
Subject: [rabbitmq-discuss] supervisor2
Message-ID: <FBDB0934-6D7F-42D0-BAA3-725EF581F312@gmail.com>

Hi.
I've found recently that it's impossible to stop a child of simple-one-for-one supervisor2 with reason "normal" or "shutdown" when one uses {transient, Delay} restart type. Not sure whether it affects behavior of rabbitmq-server or not, but it looks just not correct.
Here is my patch: https://gist.github.com/1977229.
Can I hope to get it fixed in 'default' branch?

Regards,
Ivan.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/33e4ad0d/attachment.htm>

From amathur.q at gmail.com  Mon Mar  5 09:29:04 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Mon, 5 Mar 2012 14:59:04 +0530
Subject: [rabbitmq-discuss] configure a RabbitMQ broker using XML.
Message-ID: <CA+u4LE5U52t5SitUtZQGGLRkKKkKxhJUQdwnGL8ivWxKXFbsVg@mail.gmail.com>

 Hi,
Can anyone please help me how to configure a RabbitMQ broker using XML?I
have an ActiveMQ broker and it is Configured as follows:

<!-- ActiveMQ Broker -->
    <amq:broker brokerName="ABC" persistent="true" useJmx="true">

        <amq:destinations>
            <amq:queue physicalName="queue1" />
            <amq:topic physicalName="topic1" />
        </amq:destinations>

        <amq:managementContext>
            <amq:managementContext createConnector="false" />
        </amq:managementContext>

        <amq:networkConnectors>
        </amq:networkConnectors>

        <amq:persistenceAdapter>
             <amq:jdbcPersistenceAdapter dataSource="#dataSource"
useDatabaseLock="false" />
        </amq:persistenceAdapter>

        <amq:transportConnectors>
            <amq:transportConnector uri="tcp://0.0.0.0:12121" />
        </amq:transportConnectors>
    </amq:broker>
I tried doing it for RabbitMQ but didn't work(changed some fields,jms to
amqp,topic to queue) :(
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/a00b0d52/attachment.htm>

From simon at rabbitmq.com  Mon Mar  5 09:59:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 09:59:22 +0000
Subject: [rabbitmq-discuss] configure a RabbitMQ broker using XML.
In-Reply-To: <CA+u4LE5U52t5SitUtZQGGLRkKKkKxhJUQdwnGL8ivWxKXFbsVg@mail.gmail.com>
References: <CA+u4LE5U52t5SitUtZQGGLRkKKkKxhJUQdwnGL8ivWxKXFbsVg@mail.gmail.com>
Message-ID: <4F548E7A.8090303@rabbitmq.com>

Hi. RabbitMQ configuration is not related to ActiveMQ configuration. I 
suggest you look at http://www.rabbitmq.com/configure.html for 
information on RabbitMQ configuration.

Cheers, Simon

On 05/03/2012 9:29AM, Ashutosh Mathur wrote:
>   Hi,
> Can anyone please help me how to configure a RabbitMQ broker using XML?I
> have an ActiveMQ broker and it is Configured as follows:
>
> <!-- ActiveMQ Broker -->
> <amq:broker brokerName="ABC" persistent="true" useJmx="true">
>
> <amq:destinations>
> <amq:queue physicalName="queue1" />
> <amq:topic physicalName="topic1" />
> </amq:destinations>
>
> <amq:managementContext>
> <amq:managementContext createConnector="false" />
> </amq:managementContext>
>
> <amq:networkConnectors>
> </amq:networkConnectors>
>
> <amq:persistenceAdapter>
> <amq:jdbcPersistenceAdapter dataSource="#dataSource"
> useDatabaseLock="false" />
> </amq:persistenceAdapter>
>
> <amq:transportConnectors>
> <amq:transportConnector uri="tcp://0.0.0.0:12121 <http://0.0.0.0:12121>" />
> </amq:transportConnectors>
> </amq:broker>
> I tried doing it for RabbitMQ but didn't work(changed some fields,jms to
> amqp,topic to queue) :(
> Thanks.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Mar  5 10:01:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 10:01:28 +0000
Subject: [rabbitmq-discuss] After enabled rabbitmq_management plugin ,
 RabbitMQ getting crashed .
In-Reply-To: <COL103-W5482C03B5123C107803CA5AB500@phx.gbl>
References: <COL103-W5482C03B5123C107803CA5AB500@phx.gbl>
Message-ID: <4F548EF8.50701@rabbitmq.com>

Hi Ponmuthu. The management plugin requires at least Erlang R13B01 - see 
http://www.rabbitmq.com/which-erlang.html. Also, see 
http://www.rabbitmq.com/install-rpm.html for information on installing a 
more up-to-date Erlang on RHEL.

Cheers, Simon

On 05/03/2012 8:15AM, ponmuthu muniyasamy wrote:
> Hi ,
>
>
> kindly help me to fix this issue
>
> Versions:
>
> RabbitMQ v2.7.1
> erlang-R12B-5.10.el5
> Red Hat Enterprise Linux Server release 5.2 (Tikanga)
>
>
> ---------------------------------------------------------------------------------------------------------------------
>
> Before Enable rabbitmq_management plugin , no issue in my RabbitMQ
> getting proper log as below :
>
> ---------------------------------------------------------------------------------------------------------------------
> =INFO REPORT==== 2-Mar-2012::02:27:00 ===
> stopped TCP Listener on [::]:5672
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> Memory limit set to 401MB of 1002MB total.
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 2-Mar-2012::02:28:06 ===
> Management agent started.
>
>
> -----------------------------------------------------------------------------------------------------------------
>
> After Enabled rabbitmq_management plugin , my RabbitMQ getting crashed
> logs as below :
>
> -----------------------------------------------------------------------------------------------------------------
>
> Erlang has closed
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{{case_clause,{error,{{'EXIT',{undef,[{lists,keyfind,[name,1,[{loop,#Fun<mochiweb_http.0.65037361>},{name,rabbit_mochiweb_web_mgmt},{port,55672}]]},{mochilists,is_defined,2},{mochilists,set_default,2},{lists,foldl,3},{mochiweb_http,start,1},{supervisor,do_start_child,2},{supervisor,handle_start_child,2},{supervisor,handle_call,3}]}},{child,undefined,{rabbit_mochiweb_web,mgmt},{rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},transient,5000,worker,dynamic}}}},[{rabbit_mochiweb_sup,ensure_listener,1},{rabbit_mochiweb_registry,handle_call,3},{gen_server,handle_msg,5},{proc_lib,init_p_do_apply,3}]},{gen_server,call,[rabbit_mochiweb_registry,{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,#Fun<rabbit_mochiweb.0.51174676>,{[],[82,97,98,98,105,116,77,81,32,77,97,110,97,103,101,109,101,110,116]}},infinity]}}}}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{{case_clause,{error,{{'EXIT',{undef,[{lists,
>
>
>
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> Memory limit set to 401MB of 1002MB total.
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> Management agent started.
>
> =ERROR REPORT==== 2-Mar-2012::02:26:40 ===
> ** Generic server rabbit_mochiweb_registry terminating
> ** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
> #Fun<rabbit_mochiweb.0.51174676>,
> {[],"RabbitMQ Management"}}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {{case_clause,
> {error,
> {{'EXIT',
> {undef,
> [{lists,keyfind,
> [name,1,
> [{loop,#Fun<mochiweb_http.0.65037361>},
> {name,rabbit_mochiweb_web_mgmt},
> {port,55672}]]},
> {mochilists,is_defined,2},
> {mochilists,set_default,2},
> {lists,foldl,3},
> {mochiweb_http,start,1},
> {supervisor,do_start_child,2},
> {supervisor,handle_start_child,2},
> {supervisor,handle_call,3}]}},
> {child,undefined,
> {rabbit_mochiweb_web,mgmt},
> {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
> transient,5000,worker,dynamic}}}},
> [{rabbit_mochiweb_sup,ensure_listener,1},
> {rabbit_mochiweb_registry,handle_call,3},
> {gen_server,handle_msg,5},
> {proc_lib,init_p_do_apply,3}]}
>
> =INFO REPORT==== 2-Mar-2012::02:26:40 ===
> application: rabbitmq_management
> exited: {bad_return,
> {{rabbit_mgmt_app,start,[normal,[]]},
> {'EXIT',
> {{{case_clause,
> {error,
> {{'EXIT',
> {undef,
> [{lists,keyfind,
> [name,1,
> [{loop,#Fun<mochiweb_http.0.65037361>},
> {name,rabbit_mochiweb_web_mgmt},
> {port,55672}]]},
> {mochilists,is_defined,2},
> {mochilists,set_default,2},
> {lists,foldl,3},
> {mochiweb_http,start,1},
> {supervisor,do_start_child,2},
> {supervisor,handle_start_child,2},
> {supervisor,handle_call,3}]}},
> {child,undefined,
> {rabbit_mochiweb_web,mgmt},
> {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
> transient,5000,worker,dynamic}}}},
> [{rabbit_mochiweb_sup,ensure_listener,1},
> {rabbit_mochiweb_registry,handle_call,3},
> {gen_server,handle_msg,5},
> {proc_lib,init_p_do_apply,3}]},
> {gen_server,call,
> [rabbit_mochiweb_registry,
> {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
> #Fun<rabbit_mochiweb.0.51174676>,
> {[],"RabbitMQ Management"}},
> infinity]}}}}}
> type: permanent
>
>
> Please help me to fix this issue , waiting for solution :)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Mar  5 10:05:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 10:05:58 +0000
Subject: [rabbitmq-discuss] Entity creation order guarantees with
	shovel/federation
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210A77B@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5210A77B@GSVCLU03.ges.ferlan.it>
Message-ID: <4F549006.2030800@rabbitmq.com>

Hi Simone.

Both shovel and federation create their entities when the rabbit_shovel 
or rabbit_federation applications start up - which is after the rabbit 
application. So yes, there is a race here. Hmm. This could probably be 
fixed fairly easily, I'll file bugs.

Cheers, Simon

On 05/03/2012 8:01AM, Busoli, Simone wrote:
> Hello, I would like to know if there are any guarantees about the order
> in which entities like exchanges and queues are created when they are
> declared in shovel or federation addins with respect to when the broker
> becomes available for clients to connect.
>
> I had assumed that when the broker would start accepting connections
> then the plugins were already initialized and the entities they declare
> available.
>
> What I experienced instead is that after a broker shutdown some clients
> where a reconnection logic was put in place randomly found the exchanges
> they were trying to bound their queues to to not exist yet, as if it
> depended on when exactly the client tried reconnecting.
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario
> e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non e il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
> _________________________________________________________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Mon Mar  5 10:07:31 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 5 Mar 2012 10:07:31 +0000
Subject: [rabbitmq-discuss] Entity creation order guarantees with
	shovel/federation
In-Reply-To: <4F549006.2030800@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5210A77B@GSVCLU03.ges.ferlan.it>
	<4F549006.2030800@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210A89D@GSVCLU03.ges.ferlan.it>

Thanks Simon, having that fixed would be great.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: luned? 5 marzo 2012 11:06
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Entity creation order guarantees with shovel/federation

Hi Simone.

Both shovel and federation create their entities when the rabbit_shovel or rabbit_federation applications start up - which is after the rabbit application. So yes, there is a race here. Hmm. This could probably be fixed fairly easily, I'll file bugs.

Cheers, Simon

On 05/03/2012 8:01AM, Busoli, Simone wrote:
> Hello, I would like to know if there are any guarantees about the 
> order in which entities like exchanges and queues are created when 
> they are declared in shovel or federation addins with respect to when 
> the broker becomes available for clients to connect.
>
> I had assumed that when the broker would start accepting connections 
> then the plugins were already initialized and the entities they 
> declare available.
>
> What I experienced instead is that after a broker shutdown some 
> clients where a reconnection logic was put in place randomly found the 
> exchanges they were trying to bound their queues to to not exist yet, 
> as if it depended on when exactly the client tried reconnecting.
>
> ______________________________________________________________________
> ___________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del 
> destinatario e puo contenere informazioni che sono di natura 
> privilegiata, confidenziale o non divulgabile secondo le leggi 
> vigenti. Se il lettore del presente messaggio non e il destinatario 
> designato, o il dipendente/agente responsabile per la consegna del 
> messaggio al destinatario designato, si informa che ogni 
> disseminazione, distribuzione o copiatura di questa comunicazione e 
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . 
> Se avete ricevuto questo messaggio per errore, vi preghiamo di 
> notificarcelo immediatamente a mezzo e-mail di risposta e 
> successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> ______________________________________________________________________
> ___________________________________________
> This message is intended only for the use of the addressee and may 
> contain information that is privileged, confidential and exempt from 
> disclosure under applicable law. If the reader of this message is not 
> the intended recipient, or the employee or agent responsible for 
> delivering the message to the intended recipient, you are hereby 
> notified that any dissemination, distribution or copying of this 
> communication is strictly prohibited. If you have received this e-mail 
> in error, please notify us immediately by return e-mail and delete 
> this e-mail and all attachments from your system.
> ______________________________________________________________________
> ___________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From amathur.q at gmail.com  Mon Mar  5 10:12:37 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Mon, 5 Mar 2012 15:42:37 +0530
Subject: [rabbitmq-discuss] RabbitMQ to use Postgres.
Message-ID: <CA+u4LE6QjjwyxLmjn_LuHAwg81MXz0q0CWgCv=ZL64H+8_ESbw@mail.gmail.com>

Hi,
Is there a way to store the messages sent from/to broker in a PostgreSQL
database instead of the default database which RabbitMQ uses(i guess
mnesia)? can it be done using "pg_amqp" tool?
The tool's README says:

"The pg_amqp package provides the ability for postgres statements to directly
publish messages to an [AMQP](http://www.amqp.org/) broker."

Does it provide the functionality of storing the messages on the Postgres DB?
Thanks,
Ashutosh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/5280455f/attachment.htm>

From simon at rabbitmq.com  Mon Mar  5 10:14:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 10:14:12 +0000
Subject: [rabbitmq-discuss] Failure starting rabbitMQ broker
In-Reply-To: <33397550.post@talk.nabble.com>
References: <33397550.post@talk.nabble.com>
Message-ID: <4F5491F4.7050202@rabbitmq.com>

Hi Alvin. Unfortunately the erl_crash.dump file is rarely particularly 
useful in these circumstances. If you still have the log file around 
from when the failure occurred that would be much more useful.

Cheers, Simon

On 02/03/2012 5:35PM, AlvinRMQ wrote:
>
> I have a 2 node rabbitMQ cluster that has been running for a few months. The
> nodes restart every morning but today the master node failed to start
> properly with the following error message in the erl_crash.dump:
>
> =erl_crash_dump:0.1
> Mon Feb 27 06:51:13 2012
> Slogan: Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> System version: Erlang R14B04 (erts-5.8.5) [smp:8:8] [rq:8]
> [async-threads:30]
> Compiled: Mon Oct  3 19:19:39 2011
>
> http://old.nabble.com/file/p33397550/erl_crash.dump erl_crash.dump
>
> However, I was able to make it start after rebooting the machine again. I am
> running RabbitMQ 2.7.0 server on windows 7. I do not have experience with
> erlang. Can someone please explain to me what the error message means?
>
> Thanks.

From simon at rabbitmq.com  Mon Mar  5 10:15:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 10:15:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ to use Postgres.
In-Reply-To: <CA+u4LE6QjjwyxLmjn_LuHAwg81MXz0q0CWgCv=ZL64H+8_ESbw@mail.gmail.com>
References: <CA+u4LE6QjjwyxLmjn_LuHAwg81MXz0q0CWgCv=ZL64H+8_ESbw@mail.gmail.com>
Message-ID: <4F549248.2020000@rabbitmq.com>

On 05/03/2012 10:12AM, Ashutosh Mathur wrote:
> Hi,
> Is there a way to store the messages sent from/to broker in a PostgreSQL
> database instead of the default database which RabbitMQ uses(i guess
> mnesia)?

No.

> can it be done using "pg_amqp" tool?
> The tool's README says:
>
> "The pg_amqp package provides the ability for postgres statements to directly
> publish messages to an [AMQP](http://www.amqp.org/) broker."
>
> Does it provide the functionality of storing the messages on the Postgres DB?

No, that's the other way round; sending messages to RabbitMQ from within 
Postgres.

Cheers, Simon

From amathur.q at gmail.com  Mon Mar  5 10:41:16 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Mon, 5 Mar 2012 16:11:16 +0530
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+u4LE6uFROkYcGxUM4QiWs7J-u23HZ8h=jW5YJ8OEn-_pSVPw@mail.gmail.com>

Hi,
Does RabbitMQ 2.7.1 support Spring-amqp 1.0.0? as far as i know RabbitMQ
2.7.1 supports AMQP 0-9-1.
Spring-amqp is a wrapper around amqp..right??
Thanks,
Ashutosh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/b79274ba/attachment.htm>

From simon at rabbitmq.com  Mon Mar  5 11:02:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 11:02:19 +0000
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
 week
In-Reply-To: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>
Message-ID: <4F549D3B.4050306@rabbitmq.com>

Hi Brian.

On 05/03/2012 5:33AM, Brian Jing wrote:
> We have got multiple upstream and downstream servers. Each downstream
> server talks to all upstream servers, and vice versa. We use federation
> in a "symmetric" way in that federation exchanges on the servers are
> used for both downstream and upstream purposes. max_hops is set to 1 so
> it doesn't form a loop. However, there has been a lot of traffic
> generated by RabbitMQ on the network. I've read a recent discussion on
> symmetric federation on this mailing list and it seems that there are
> some problems with it. Not sure if the error we've been having has
> anything to do with it.

I don't think so. Note that the only problem with symmetric federation 
is that messages get transferred over the network only to get dropped. 
This wastes bandwidth but it's nothing to do with what you're seeing.

> It seems to me that the error message suggests a connection problem, but
> not sure whether it has to do with the federation plugin. Since the
> error will take a while to happen again (but will definitely happen) and
> it'll probably take at least a couple of weeks for us to determine the
> cause of it, I was just wondering if anyone can easily see what this
> error is about and if there is any fix for this.

Thanks for the pointer. So it looks like we may not be recovering well 
from an SSL connection dying post-establishment. I'll try to replicate this.

> Here is the error message:
<snip>
>                       {'RSAPrivateKey','two-prime',
<snip>

Huh. That doesn't look like a good thing to log. I think you should 
probably treat the private key from that machine as compromised, sorry :-(

The log message is being created by Erlang but I'll see if we can 
intercept it and strip that out...

Cheers, Simon

From simon at rabbitmq.com  Mon Mar  5 11:07:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 11:07:01 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CA+u4LE6uFROkYcGxUM4QiWs7J-u23HZ8h=jW5YJ8OEn-_pSVPw@mail.gmail.com>
References: <CA+u4LE6uFROkYcGxUM4QiWs7J-u23HZ8h=jW5YJ8OEn-_pSVPw@mail.gmail.com>
Message-ID: <4F549E55.3030607@rabbitmq.com>

On 05/03/2012 10:41AM, Ashutosh Mathur wrote:
> Hi,
> Does RabbitMQ 2.7.1 support Spring-amqp 1.0.0?

Yes.

> as far as i know RabbitMQ
> 2.7.1 supports AMQP 0-9-1.

Yes.

> Spring-amqp is a wrapper around amqp..right??

It's a wrapper around AMQP libraries. The 1.0.0 in its name is its 
version number, nothing to do with any AMQP version.

Cheers, Simon

From amathur.q at gmail.com  Mon Mar  5 11:47:39 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Mon, 5 Mar 2012 17:17:39 +0530
Subject: [rabbitmq-discuss] java serialized objects
Message-ID: <CA+u4LE5M=PC24gLn01Rbt4RtdQgomvO5OaPgYOeLkt_8RxTRvA@mail.gmail.com>

Hi,
Is there a way to send java serialized object within the message body of a
message? Read somewhere that it ain't possible in RabbitMQ.
Thanks,
Ashutosh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/a4e4d300/attachment.htm>

From mikeb at rabbitmq.com  Mon Mar  5 12:05:04 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 05 Mar 2012 12:05:04 +0000
Subject: [rabbitmq-discuss] java serialized objects
In-Reply-To: <CA+u4LE5M=PC24gLn01Rbt4RtdQgomvO5OaPgYOeLkt_8RxTRvA@mail.gmail.com>
References: <CA+u4LE5M=PC24gLn01Rbt4RtdQgomvO5OaPgYOeLkt_8RxTRvA@mail.gmail.com>
Message-ID: <4F54ABF0.4070804@rabbitmq.com>

> Is there a way to send java serialized object within the message body of
> a message? Read somewhere that it ain't possible in RabbitMQ.
> Thanks,

RabbitMQ will happily convey whatever bytes you give it. That can be a 
serialised Java object (you'll have to do the serialisation yourself), 
ProtoBuf, a UTF8 string, or whatever. If you need to distinguish at the 
other end, you can set the "content-type" header to indicate what is 
being sent.

-Michael

From ye.laputa at gmail.com  Thu Mar  1 02:19:06 2012
From: ye.laputa at gmail.com (laputa)
Date: Wed, 29 Feb 2012 18:19:06 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers may hang after network instability
In-Reply-To: <88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
References: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>
	<88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
Message-ID: <29330339.464.1330568346753.JavaMail.geo-discussion-forums@pbcwi5>

We use python client amqplib, and have the same question.
I set the heartbeat, but it didn't work.


? 2012?2?18????UTC+8??12?08?16??Busoli, Simone???
>
> Alexey, you need to enable heartbeats to make sure that you detect network 
> issues. It's an option on the ConnectionFactory class.
>
> -
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/6b436558/attachment.htm>

From ye.laputa at gmail.com  Thu Mar  1 02:20:51 2012
From: ye.laputa at gmail.com (laputa)
Date: Wed, 29 Feb 2012 18:20:51 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers may hang after network instability
In-Reply-To: <88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
References: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>
	<88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
Message-ID: <20167307.503.1330568451288.JavaMail.geo-discussion-forums@pbcpw9>


>
> We use python client amqplib, and have the same question.
> I enable the heartbeats, but it doesn't work.
>
>
> ? 2012?2?18????UTC+8??12?08?16??Busoli, Simone???
>>
>> Alexey, you need to enable heartbeats to make sure that you detect 
>> network issues. It's an option on the ConnectionFactory class.
>>
>> -
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/62b22842/attachment.htm>

From chandij.piotr at gmail.com  Fri Mar  2 12:07:10 2012
From: chandij.piotr at gmail.com (wzasqn)
Date: Fri, 2 Mar 2012 04:07:10 -0800 (PST)
Subject: [rabbitmq-discuss] Pika,
	Detect publish failure when broker becomes unavailable
In-Reply-To: <32887938.46.1330646938201.JavaMail.geo-discussion-forums@ynel5>
References: <32887938.46.1330646938201.JavaMail.geo-discussion-forums@ynel5>
Message-ID: <a0ad7d5e-ddbe-474e-9871-98ce7167580e@f2g2000yqh.googlegroups.com>

Hi,

I have the same problem ? I fought that if we set channel into confirm
mode:
channel.confirm_delivery(callback = confirm_handler)
should call function when we received acknowledge from RabbitMQ but
unfortunately not, that function is called when we closing channel
(BlockingChannel) ? channel.close() ? that function is freezing.

We can check is connection is open (connection.open) but this one not
guarantees that message was received.

So I will ask one more time ;-) Anyone have an idea how to deal with
that?

Thanks,
p


On Mar 2, 12:08?am, Jelle Smet <smetj.... at gmail.com> wrote:
> Hi all,
>
> I'm using pika 0.9.5 and trying to figure out how to detect whether
> RabbitMQ is still available/unavailable after creating a connection to it.
> When I stop Rabbit between the channel creation and publishing the message,
> there appears to be no way of detecting whether rabbit is still
> alive/available.
> Publishing the message doesn't generate any error, connection.is_open
> always returns True...
>
> Anyone an idea how to deal with this?
>
> Cheers,
>
> J
>
> #!/usr/bin/python
>
> import pika
> from pika.adapters import SelectConnection
> from pika.adapters import BlockingConnection
> import time
>
> parameters = pika.ConnectionParameters(host='sandbox')
> connection = BlockingConnection(parameters)
>
> channel = connection.channel()
>
> channel.queue_declare(queue="test", durable=True, exclusive=False,
> auto_delete=False)
>
> time.sleep(10)
> #I stop rabbitmq here
>
> print connection.is_open #Returns True so this doesn't work
>
> #this doesn't generate any error
> channel.basic_publish(exchange='', routing_key="test", body="Hello World!",
>
> properties=pika.BasicProperties(content_type="text/plain", delivery_mode=1))
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From reubengarrett at gmail.com  Fri Mar  2 18:47:38 2012
From: reubengarrett at gmail.com (RubyTuesdayDONO)
Date: Fri, 2 Mar 2012 10:47:38 -0800 (PST)
Subject: [rabbitmq-discuss] upgrade to MPL 2.0 ?
Message-ID: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>

are there any plans to upgrade RabbitMQ's license to version 2.0 of the 
Mozilla Public License <http://www.mozilla.org/MPL/2.0/>?  i've read that MPL 
2 is compatible with the Apache Public License<http://www.zdnet.com/blog/open-source/mozilla-license-becoming-apache-compatible/6039>, 
which would open some doors for folks implementing RabbitMQ components for 
Apache projects, such as this prospective Apache Camel component<http://camel.465427.n5.nabble.com/Camel-features-depending-on-Camel-Component-td5528357.html#a5528713>.  


~ RNPG 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120302/d4662d12/attachment.htm>

From lowlifi at gmail.com  Fri Mar  2 21:48:04 2012
From: lowlifi at gmail.com (E Raymond)
Date: Fri, 2 Mar 2012 13:48:04 -0800 (PST)
Subject: [rabbitmq-discuss] MCollective + RabbitMQ + LDAP authentication
	issues
Message-ID: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>

Hello!

We have been testing MCollective with RabbitMQ 2.7.1 with great
success, but we are moving it into production, with a working LDAP
setup in place.  I have created a test user,"mco-user', in LDAP, and
added to a group "ops".  The user is able to authenticate through out
all our systems, but when trying to utilize with mcollective, I get
the following messages in the rabbitmq logs:

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
accepted TCP connection on [::]:6163 from 10.0.0.92:25038

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
starting STOMP connection <0.275.0> from ::FFFF:10.0.0.92:25038

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: connecting to ["ds.example.net"]

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: bind request = {'BindRequest',3,
                                 "uid=mco-
user,ou=employees,ou=people,dc=example,dc=net",
                                 {simple,<<"CrazYPWd!">>}}

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: bind reply = {ok,
                            {'LDAPMessage',1,
                             {bindResponse,
                              {'BindResponse',success,[],
[],asn1_NOVALUE,
                               asn1_NOVALUE}},
                             asn1_NOVALUE}}

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: connecting to ["ds.example.net"]

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: connecting to ["ds.example.net"]

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: search request = {'SearchRequest',
 
"ou=/,ou=employees,ou=people,dc=example,dc=net",
                                   baseObject,neverDerefAliases,
0,0,false,
                                   {present,"objectClass"},
                                   []}

=INFO REPORT==== 2-Mar-2012::21:29:37 ===
LDAP backend: search reply = {ok,
                              {'LDAPMessage',1,
                               {searchResDone,
                                {'LDAPResult',noSuchObject,
 
"ou=employees,ou=people,dc=example,dc=net",
                                 [],asn1_NOVALUE}},
                               asn1_NOVALUE}}

=ERROR REPORT==== 2-Mar-2012::21:29:37 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Authentication failure\n"
Server private detail: none

=INFO REPORT==== 2-Mar-2012::21:29:38 ===
Socket #Port<0.2954> closed by client

=INFO REPORT==== 2-Mar-2012::21:29:38 ===
ending STOMP connection <0.275.0> from ::FFFF:10.0.0.92:25038

=INFO REPORT==== 2-Mar-2012::21:31:43 ===
accepted TCP connection on [::]:5672 from 10.0.0.109:24056

=INFO REPORT==== 2-Mar-2012::21:31:43 ===
starting TCP connection <0.287.0> from 10.0.0.109:24056

=WARNING REPORT==== 2-Mar-2012::21:31:43 ===
exception on TCP connection <0.287.0> from 10.0.0.109:24056
connection_closed_abruptly

=INFO REPORT==== 2-Mar-2012::21:31:43 ===
closing TCP connection <0.287.0> from 10.0.0.109:24056

The rabbitmq.config file looks like this:

[ {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
  {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["ds.example.net"]},
     {user_dn_pattern,       "uid=$
{username},ou=employees,ou=people,dc=example,dc=net"},
     {vhost_access_query,    {exists,
                              "ou=$
{vhost},ou=employees,ou=people,dc=example,dc=net"}},
     {resource_access_query,
      {for, [{resource, exchange,
              {for, [{permission, configure,
                      { in_group,
"cn=ops,ou=groups,dc=example,dc=net" }
                     },
                     {permission, write, {constant, true}},
                     {permission, read,  {constant, true}}
                    ]}},
             {resource, queue, {constant, true}} ]}},
     {tag_queries,           [{administrator, {constant, false}}]},
     {use_ssl,               false},
     {port,                  389},
     {log,                   true} ] }
].



From patfla at gmail.com  Fri Mar  2 22:04:55 2012
From: patfla at gmail.com (patfla)
Date: Fri, 2 Mar 2012 14:04:55 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbit crashes upon startup.
Message-ID: <14051430.48.1330725895320.JavaMail.geo-discussion-forums@pbcvy9>


Rabbitmq 2.7.1-1 and erlang R14B-04.1

We normally use CentOS 5.7 which has its shortcomings.  In order to try 
CentOS 6.2 I installed it into an Oracle(Sun) VirtualBox VM.  That all 
works fine.

Among the infrastructure that we need are postgres and memcached - they 
install and run fine.

For rabbit, stated by making an EPEL repo then installed both erlang and 
rabbitmq.

Try to start rabbitmq - service rabbitmq-server - and I get:


[blah at localhost init.d]# pwd
> /etc/init.d
> [blah at localhost init.d]# service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
> _err}
> rabbitmq-server.
> [blah at localhost init.d]# cat /var/log/rabbitmq/startup_err
> Erlang has closed
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
> [blah at localhost init.d]# ps aux | grep rabbit
> rabbitmq  4069  0.0  0.0  10880   468 ?        S    13:15   0:00 
> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> blah      4460  0.0  0.0 103300   844 pts/3    S+   13:59   0:00 grep 
> rabbit
> [blah at localhost init.d]# 
>
>  
Epmd started up.  I think the next thing to start is beam.smp (looking at 
my CentOS 5.7 machine where this all works).

I've used rabbitmq for some time, but have never had to dig into it...

Tried rebooting - no.  Then uninstall and reinstall - no.

Any suggestions appreciated.

Pat


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120302/27258865/attachment.htm>

From patfla at gmail.com  Fri Mar  2 22:26:10 2012
From: patfla at gmail.com (patfla)
Date: Fri, 2 Mar 2012 14:26:10 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbit crashes upon startup.
In-Reply-To: <14051430.48.1330725895320.JavaMail.geo-discussion-forums@pbcvy9>
References: <14051430.48.1330725895320.JavaMail.geo-discussion-forums@pbcvy9>
Message-ID: <24573478.82.1330727170664.JavaMail.geo-discussion-forums@pbcpw9>


amqp runs on 5762.  Did a netstat -anp | grep 5762 and found a process 
called qpidd (I said I didn't have much past experience digging inside 
rabbitmq).  Figured out this is AMQP.  Killed the process.

Now Rabbitmq starts successfully.  Go figure.

Pat


On Friday, March 2, 2012 2:04:55 PM UTC-8, patfla wrote:
>
>
> Rabbitmq 2.7.1-1 and erlang R14B-04.1
>
> We normally use CentOS 5.7 which has its shortcomings.  In order to try 
> CentOS 6.2 I installed it into an Oracle(Sun) VirtualBox VM.  That all 
> works fine.
>
> Among the infrastructure that we need are postgres and memcached - they 
> install and run fine.
>
> For rabbit, stated by making an EPEL repo then installed both erlang and 
> rabbitmq.
>
> Try to start rabbitmq - service rabbitmq-server - and I get:
>
>
> [blah at localhost init.d]# pwd
>> /etc/init.d
>> [blah at localhost init.d]# service rabbitmq-server start
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
>> _err}
>> rabbitmq-server.
>> [blah at localhost init.d]# cat /var/log/rabbitmq/startup_err
>> Erlang has closed
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller) 
>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>> [blah at localhost init.d]# ps aux | grep rabbit
>> rabbitmq  4069  0.0  0.0  10880   468 ?        S    13:15   0:00 
>> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
>> blah      4460  0.0  0.0 103300   844 pts/3    S+   13:59   0:00 grep 
>> rabbit
>> [blah at localhost init.d]# 
>>
>>  
> Epmd started up.  I think the next thing to start is beam.smp (looking at 
> my CentOS 5.7 machine where this all works).
>
> I've used rabbitmq for some time, but have never had to dig into it...
>
> Tried rebooting - no.  Then uninstall and reinstall - no.
>
> Any suggestions appreciated.
>
> Pat
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120302/323ee243/attachment.htm>

From marc.peter.johnson at gmail.com  Sat Mar  3 18:28:44 2012
From: marc.peter.johnson at gmail.com (Marc Johnson)
Date: Sat, 3 Mar 2012 10:28:44 -0800 (PST)
Subject: [rabbitmq-discuss] .Net Client: Why is a channel called a model?
Message-ID: <10570039.324.1330799324115.JavaMail.geo-discussion-forums@vbne13>

Hi all,

I'm new to RabbitMQ and have been using the .Net client. In the tutorials, 
AMQP documentation and the Java examples all refer to channels, is there a 
reason why channels appear to be called models in the .Net driver? 

Is there some history or context I'm missing?

Thanks for your help,

Marc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120303/05b834b8/attachment.htm>

From markfisher at vmware.com  Mon Mar  5 13:41:21 2012
From: markfisher at vmware.com (Mark Fisher)
Date: Mon, 5 Mar 2012 05:41:21 -0800 (PST)
Subject: [rabbitmq-discuss] configure a RabbitMQ broker using XML.
In-Reply-To: <4F548E7A.8090303@rabbitmq.com>
Message-ID: <710177679.1931505.1330954881032.JavaMail.root@zimbra-prod-mbox-2.vmware.com>

Ashutosh,

I believe in an earlier mail you had implied that you are using Spring AMQP. If so, there are configuration options (either XML or @Configuration classes) that might be more similar to what you are familiar with in ActiveMQ config. See this section of the reference manual for more detail: http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/#broker-configuration

Regards,
Mark

----- Original Message -----
| From: "Simon MacMullen" <simon at rabbitmq.com>
| To: "Ashutosh Mathur" <amathur.q at gmail.com>
| Cc: rabbitmq-discuss at lists.rabbitmq.com
| Sent: Monday, March 5, 2012 4:59:22 AM
| Subject: Re: [rabbitmq-discuss] configure a RabbitMQ broker using XML.
| 
| Hi. RabbitMQ configuration is not related to ActiveMQ configuration.
| I
| suggest you look at http://www.rabbitmq.com/configure.html for
| information on RabbitMQ configuration.
| 
| Cheers, Simon
| 
| On 05/03/2012 9:29AM, Ashutosh Mathur wrote:
| >   Hi,
| > Can anyone please help me how to configure a RabbitMQ broker using
| > XML?I
| > have an ActiveMQ broker and it is Configured as follows:
| >
| > <!-- ActiveMQ Broker -->
| > <amq:broker brokerName="ABC" persistent="true" useJmx="true">
| >
| > <amq:destinations>
| > <amq:queue physicalName="queue1" />
| > <amq:topic physicalName="topic1" />
| > </amq:destinations>
| >
| > <amq:managementContext>
| > <amq:managementContext createConnector="false" />
| > </amq:managementContext>
| >
| > <amq:networkConnectors>
| > </amq:networkConnectors>
| >
| > <amq:persistenceAdapter>
| > <amq:jdbcPersistenceAdapter dataSource="#dataSource"
| > useDatabaseLock="false" />
| > </amq:persistenceAdapter>
| >
| > <amq:transportConnectors>
| > <amq:transportConnector uri="tcp://0.0.0.0:12121
| > <http://0.0.0.0:12121>" />
| > </amq:transportConnectors>
| > </amq:broker>
| > I tried doing it for RabbitMQ but didn't work(changed some
| > fields,jms to
| > amqp,topic to queue) :(
| > Thanks.
| >
| >
| > _______________________________________________
| > rabbitmq-discuss mailing list
| > rabbitmq-discuss at lists.rabbitmq.com
| > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
| _______________________________________________
| rabbitmq-discuss mailing list
| rabbitmq-discuss at lists.rabbitmq.com
| https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
| 

From a.pollock at encoded.co.uk  Mon Mar  5 13:54:26 2012
From: a.pollock at encoded.co.uk (Adam Pollock)
Date: Mon, 05 Mar 2012 13:54:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ release roadmap
Message-ID: <4F54C592.5020002@encoded.co.uk>

Hi all,

Just wondering if there was a formal release roadmap? Failing that, when is the next release going 
to be available? My reason for asking is that I have converted our current JMS messaging system with 
OpenMQ over to an AMQP messaging system using RabbitMQ, and I've had some problems with a bug in the 
current release's (2.7.1) Java client (bug #24723 - memory leak). The bug has apparently been fixed 
and is scheduled to be included in the next release.

We're looking to make this system live within the next few weeks and this is the last issue to 
address before that.

So, yes, if anyone could give me some idea of when the next release could be available, or point me 
in the right direction of a release roadmap of some kind, that would be very much appreciated.

Thanks,
Adam Pollock.

From alexis at rabbitmq.com  Mon Mar  5 14:23:01 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 5 Mar 2012 14:23:01 +0000
Subject: [rabbitmq-discuss] Using Rabbit with Excel
Message-ID: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>

Hi

One of our colleagues at VMware has created this, which may be of
interest to the community:

https://git.springsource.com/hikyaku

alexis

From eric at holtmans.com  Mon Mar  5 14:24:29 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Mon, 05 Mar 2012 08:24:29 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient redux (Visual Studio
	2008)
Message-ID: <4F54CC9D.8080101@holtmans.com>

sigh.

I can get cmake to run.   It generates the solution files
and project files for VS 2008 just fine.

They won't compile.

errors are all like this:

1>MessageReturnedException.cpp
1>c:\dev\simpleamqpclient\src\SimpleAmqpClient/BasicMessage.h(195) :
error C2146: syntax error : missing ';' before identifier 'Priority'

the problem is that none of the typedefs for uint8_t, uint16_t etc
seem to have been included.


I've also tried just taking the .cpp and .h files from
SimpleAmqpClient and making a project myself, and I
run into the same problem.

I'm really baffled, confused and frustrated.  I've
never ever had to fight this hard with a library just
to get a handful of .cpp and .h files to compile.

I'd really like to write some code, instead of fighting
the compiler.

Anyone have any clues?    Anyone willing to ship me
a working .vcproj file?


From eric at holtmans.com  Mon Mar  5 14:52:56 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Mon, 05 Mar 2012 08:52:56 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient redux (Visual
	Studio 2008)
In-Reply-To: <4F54CC9D.8080101@holtmans.com>
References: <4F54CC9D.8080101@holtmans.com>
Message-ID: <4F54D348.1040907@holtmans.com>

On 3/5/2012 8:24 AM, Eric J. Holtman wrote:
> sigh.
> 
> I can get cmake to run.   It generates the solution files
> and project files for VS 2008 just fine.
> 
> They won't compile.
> 
> errors are all like this:
> 
> 1>MessageReturnedException.cpp
> 1>c:\dev\simpleamqpclient\src\SimpleAmqpClient/BasicMessage.h(195) :
> error C2146: syntax error : missing ';' before identifier 'Priority'
> 
> the problem is that none of the typedefs for uint8_t, uint16_t etc
> seem to have been included.
> 


The error seems to ne (taking AmqpException.h for example)
that the headers are including

#include <boost/cstdint.hpp>

but then the code has declarations like:

  explicit AmqpException(const std::string& reply_text, uint16_t
class_id, uint16_t method_id) throw();

the boost/cstdint.hpp puts uint16_t in the boost:: namesspace,
NOT in std::

if I change the above line to

  explicit AmqpException(const std::string& reply_text, boost::uint16_t
class_id, boost::uint16_t method_id) throw();

it compiles.

I'm not really willing to put a "using namespace boost" at the top
of the headers.

Am I missing something obvious here?



From gmr at myyearbook.com  Mon Mar  5 15:21:14 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 5 Mar 2012 10:21:14 -0500
Subject: [rabbitmq-discuss] RabbitMQ to use Postgres.
In-Reply-To: <CA+u4LE6QjjwyxLmjn_LuHAwg81MXz0q0CWgCv=ZL64H+8_ESbw@mail.gmail.com>
References: <CA+u4LE6QjjwyxLmjn_LuHAwg81MXz0q0CWgCv=ZL64H+8_ESbw@mail.gmail.com>
Message-ID: <72B85B3F5D884805A4BC20130A59B321@myyearbook.com>

Hi Ashutosh, 

I have a presentation on RabbitMQ and PostgreSQL from PgConf.eu from 2011:

http://www.scribd.com/gavinmroy/d/72196103-On-Rabbits-and-Elephants

This is slanted towards Postgres people with no RabbitMQ background and probably doesn't make a lot of sense without the video, however.  It looks like content about using RabbitMQ and PostgreSQL together starts at about slide 25.

In addition, source for the talk is available at:

https://github.com/gmr/On-Rabbits-and-Elephants

I hope this helps,

Gavin 


On Monday, March 5, 2012 at 5:12 AM, Ashutosh Mathur wrote:

> Hi,
> Is there a way to store the messages sent from/to broker in a PostgreSQL database instead of the default database which RabbitMQ uses(i guess mnesia)? can it be done using "pg_amqp" tool?
> The tool's README says:
> "The pg_amqp package provides the ability for postgres statements to directly publish messages to an [AMQP](http://www.amqp.org/) broker."
> 
> Does it provide the functionality of storing the messages on the Postgres DB?
> Thanks,
> Ashutosh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/4f3e3e9a/attachment.htm>

From gmr at myyearbook.com  Mon Mar  5 15:26:48 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 5 Mar 2012 10:26:48 -0500
Subject: [rabbitmq-discuss] Using Rabbit with Excel
In-Reply-To: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>
References: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>
Message-ID: <427D08915E484DC1A947D6225746DBEE@myyearbook.com>

Not seeing DNS resolution for that host, is it internal only? 

gmr-0x04:~ gmr$ dig -t A git.springsource.com

; <<>> DiG 9.7.3-P3 <<>> -t A git.springsource.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 55216
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;git.springsource.com. IN A

;; AUTHORITY SECTION:
springsource.com. 3577 IN SOA sc9-ext-dns-1.vmware.com. hostmaster.vmware.com. 2012030101 10800 1800 3600000 3600


On Monday, March 5, 2012 at 9:23 AM, Alexis Richardson wrote:

> Hi
> 
> One of our colleagues at VMware has created this, which may be of
> interest to the community:
> 
> https://git.springsource.com/hikyaku
> 
> alexis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/a16656d9/attachment.htm>

From simon at rabbitmq.com  Mon Mar  5 15:47:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 15:47:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ release roadmap
In-Reply-To: <4F54C592.5020002@encoded.co.uk>
References: <4F54C592.5020002@encoded.co.uk>
Message-ID: <4F54E01C.2030903@rabbitmq.com>

On 05/03/12 13:54, Adam Pollock wrote:
> Just wondering if there was a formal release roadmap? Failing that, when
> is the next release going to be available?

Not really, it's "when all the release blockers are finished". At a 
guess, probably fairly soon.

> My reason for asking is that
> I have converted our current JMS messaging system with OpenMQ over to an
> AMQP messaging system using RabbitMQ, and I've had some problems with a
> bug in the current release's (2.7.1) Java client (bug #24723 - memory
> leak). The bug has apparently been fixed and is scheduled to be included
> in the next release.

It's unlikely the Java client will change much between now and release, 
and it's not too difficult to build, so you could just check it out from 
hg right now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Mon Mar  5 15:49:32 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 5 Mar 2012 15:49:32 +0000
Subject: [rabbitmq-discuss] Using Rabbit with Excel
In-Reply-To: <427D08915E484DC1A947D6225746DBEE@myyearbook.com>
References: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>
	<427D08915E484DC1A947D6225746DBEE@myyearbook.com>
Message-ID: <CACOPnvfDSc7yaZX-knCiJ0vZnDS7jeF5FFHhtJrE0akVD3NhRQ@mail.gmail.com>

Yes, it may have been published on a site that only some of us can access.

Let me try to find out....


On Mon, Mar 5, 2012 at 3:26 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> Not seeing DNS resolution for that host, is it internal only?
>
> gmr-0x04:~ gmr$ dig -t A git.springsource.com
>
> ; <<>> DiG 9.7.3-P3 <<>> -t A git.springsource.com
> ;; global options: +cmd
> ;; Got answer:
> ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 55216
> ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0
>
> ;; QUESTION SECTION:
> ;git.springsource.com. IN A
>
> ;; AUTHORITY SECTION:
> springsource.com. 3577 IN SOA sc9-ext-dns-1.vmware.com.
> hostmaster.vmware.com. 2012030101 10800 1800 3600000 3600
>
> On Monday, March 5, 2012 at 9:23 AM, Alexis Richardson wrote:
>
> Hi
>
> One of our colleagues at VMware has created this, which may be of
> interest to the community:
>
> https://git.springsource.com/hikyaku
>
> alexis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Mon Mar  5 15:53:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 15:53:16 +0000
Subject: [rabbitmq-discuss] upgrade to MPL 2.0 ?
In-Reply-To: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>
References: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>
Message-ID: <4F54E16C.9090302@rabbitmq.com>

On 02/03/12 18:47, RubyTuesdayDONO wrote:
> are there any plans to upgrade RabbitMQ's license to version 2.0 of the
> Mozilla Public License <http://www.mozilla.org/MPL/2.0/>?

This is under some debate internally at the moment. It is fairly
plausible, but I make no guarantees I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar  5 15:57:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 15:57:19 +0000
Subject: [rabbitmq-discuss] Is there ever a need for a federation and
 a	cluster?
In-Reply-To: <23615420.432.1330526250708.JavaMail.geo-discussion-forums@ynlw24>
References: <CB2A0293.C52C%jim.langston@compuware.com>	<a9f171b8-d22d-4f82-a2de-dc0a4b32b40f@StrongMad.local>
	<23615420.432.1330526250708.JavaMail.geo-discussion-forums@ynlw24>
Message-ID: <4F54E25F.4090305@rabbitmq.com>

On 29/02/12 14:37, Allan Feid wrote:
> I'm in the process of setting up multiple datacenters and would like
> separate clusters in each location, with some mechanism of reaching
> messages from other clusters. Looks like I'm not the only one interested
> in this, but is there currently any way of achieving this?

Umm, yes, federated clusters are the recommended approach here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar  5 16:07:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 16:07:07 +0000
Subject: [rabbitmq-discuss] Does clustering increase throughput?
In-Reply-To: <e8d172a4-8921-4c22-869b-9638c37970f8@w4g2000vbc.googlegroups.com>
References: <e8d172a4-8921-4c22-869b-9638c37970f8@w4g2000vbc.googlegroups.com>
Message-ID: <4F54E4AB.2020306@rabbitmq.com>

I'm not sure I fully understand your test, however it's important to 
understand that non-HA queues only live on one node in a cluster (and HA 
queues need to do enough extra work that they're slower anyway).

Therefore connecting to one queue from multiple nodes in the cluster 
will not in general go any faster.

Clustering increases throughput in the case where you have a bunch of 
queues. They will tend to end up distributed across nodes so each 
individual node has fewer queues on it.

Cheers, Simon

On 26/02/12 17:29, matan zinger wrote:
> Hi All,
>
> I've read and experienced with rabbit mq clustering feature over 2
> machines.
> Below are the results I found, which I found quite strange:
>
> 0. Direct exchange named "myexchange" was defined.
> 1. rabbit1&  rabbit2 were configured to work in a cluster. both are
> using disc.
> 2. queue named "in.queue" was configured, and binded to routing key
> "in"
> 3. 100k messages were enqueued with routing key "in". connection was
> to rabbit1.
> 4. Running a single message handler on rabbit1 machine, connected to
> rabbit1 mq.
> Handling throuput: 2k messages / second
> 5. Running handlers on both rabbit1&  rabbit2 - each reached the
> throuput of ~400 messages / second.
> After stopping the message handler on rabbit2, handler on rabbit1
> returned to 2k messages / second.
> 6. Running a single message handler on rabbit1 machine, connected to
> rabbit2 mq.
> Handling throuput: 400 messages / second
>
> I still can't figure out this behavior:
> I understood form the documentation that adding nodes to a cluster is
> done in order to INCREASE throughput.
> However, adding an additional handler leads to a degredation in
> performance!
>
> The second thing I can't figure out is the difference is throughput
> between the cases of a single handler on rabbit1, and a single handler
> on rabbit2.
> If both nodes are active, and are using discs, than they should be
> exactly the same.
> There is no notion of master/slave.
> If so - how come a different throughput received when running a single
> handler on each of them?
>
> Please help me understand these conflicts.
>
> Thanks,
> Matan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From matt.wolf74 at gmail.com  Mon Mar  5 15:33:51 2012
From: matt.wolf74 at gmail.com (Matt)
Date: Mon, 5 Mar 2012 07:33:51 -0800 (PST)
Subject: [rabbitmq-discuss] Transfer rate improvement above 45mb/second?
Message-ID: <aa29c113-a9f5-47a7-9792-280a51f79902@v2g2000pbo.googlegroups.com>

Hello, I setup a rabbitmq server on my local machine under Windows 7,
64 bit, and set up a test instance in C#. I look for the fastest way
to deliver messages in the same order than they were published onto
the bus through a direct connection (no fan out needed). I do not need
guaranteed delivery, all I am after is max speed to deliver the
messages to one single consumer. Currently I seem to max out at about
40,000 messages per second which is impressive but does not solve my
problem. I need to push around 115,000,000 messages and thus I started
to chunk the messages into larger byte arrays. Still I dont seem to
improve much as the max transfer rates maxes out at around 45mb/
second. Is there any way to improve those numbers? Pushing the
115,000,000 messages to the consumer currently takes around 50 seconds
no matter how I set the chunk size.

Thanks a lot for your input and advice.

Matt

From steve at rabbitmq.com  Mon Mar  5 16:22:05 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Mar 2012 16:22:05 +0000
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
	than amq.topic?
In-Reply-To: <c28ec65f-c0c8-4a72-adfa-01ce481d783c@s13g2000yqe.googlegroups.com>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
	<5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
	<c28ec65f-c0c8-4a72-adfa-01ce481d783c@s13g2000yqe.googlegroups.com>
Message-ID: <EB55BA1E-2831-44C3-8AA7-31A386E42F24@rabbitmq.com>

Cliff,

Did you see my previous answer:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018456.html
?

Please get back to me if this isn't what you want.

Steve Powell  (a hopeful bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 24 Feb 2012, at 12:43, Cliff Redmond wrote:

> Hi Steve,
> 
> thanks for your answer.
> 
> I was facing the exact same problem as Ken: I think your solution only
> partially addresses the issue - requiring a subscription to a pre-
> existing queue significantly reduces the flexibility of Stomp/
> RabbitMQ.
> 
> One of the most useful features of the Stomp plugin is that when a
> Stomp consumer subscribes to a topic, it automatically creates a new
> queue (with a lifecycle dictated by the subscription) and binds it to
> the default topic exchange on that broker.
> 
> e.g. invoking the following in a consumer:
> 
> $frame = Net::Stomp::Frame->new( {
>      command => "SUBSCRIBE",
>      headers => {
>          destination => "/topic/durable-topic-prefetch",
>          id => $subscriberId,
>          persistent => "true",
>          ack => "client",
>          prefetch_count => 1,
>      },
> });
> 
> $stomp->send_frame($frame);
> 
> will create a queue on the relevant broker:
> 
> sh-3.2# rabbitmqctl list_queues
> Listing queues ...
> [...]
> stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?U	0
> [...]
> ...done.
> 
> and bind it to the default topic exchange:
> 
> Listing bindings ...
> [...]
> amq.topic	exchange	stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?
> U	queue	durable-topic-prefetch	[]
> [...]
> ...done.
> 
> Pre-configuring AMQ queues is considerably less flexible, and the
> alternative, creating a queue (and binding it to an alternatively
> named federated topic exchange) using AMQP before each Stomp
> subscription, militates against using Stomp at all.
> 
> Would it be possible to make a change to either of the Stomp or
> Federation plugins:
> 
> - be able to specify a topic exchange in the Stomp plugin config (i.e.
> rather than have it always use amq.topic),
> - be able to federate internal/predefined exchanges in the Federation
> plugin.
> 
> (I used the Shovel plugin to workaround this issue).
> 
> Many thanks,
> 
> Cliff.
> 
> On Feb 21, 6:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Hi Ken,
>> 
>> It is possible for you to SEND to the exchange of your choice from aSTOMP
>> application, using a destination of the form: /exchange/<name>/<pattern> (seehttp://www.rabbitmq.com/stomp.html#d.ed) and there is no reason why this
>> shouldn't be a topic exchange of your own making.
>> 
>> If you need to SUBSCRIBE to AMQP destinations you can use the destination
>> /amq/queue/<name> (but the queue must exist).
>> 
>> Between them, these should allow you to useSTOMPwith federated exchanges
>> without plugin modifications.
>> 
>> Let us know how you get on.
>> 
>> Steve Powell  (a federated bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 20 Feb 2012, at 16:19, Ken Simon wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Greetings,
>> 
>>> I'm trying to getfederationworking (via the rabbitmq_federation
>>> plugin) in our environment ofSTOMPhosts, and to do so I have to
>>> enablefederationin theSTOMPplugin's exchange: amq.topic.  This
>>> unfortunately doesn't seem to work because amq.* exchanges are
>>> reserved and cannot be re-declared.
>> 
>>> My solution at this point has been to edit the source of theSTOMP
>>> plugin and point it at an exchange called "stomp_topic" (which I made
>>> up, but could be anything) instead of the default amq.topic.  Then I
>>> just configure thefederationplugin to work with that exchange and it
>>> works fine.
>> 
>>> My question is, is there a better way of doing this?  I hate
>>> maintaining my own downstream changes to plugins if I don't have to.
>>> The docs say that theSTOMPplugin routes all messages through
>>> amq.topic, so it appears that's not configurable.  But wouldn't it
>>> make sense to allow use of an exchange that's not reserved?  Or am I
>>> missing something, and this is actually way easier?  I'm having
>>> trouble finding any documented cases of people using bothSTOMPand
>>> federation.
>> 
>>> Thanks,
>> 
>>> --
>>> Ken
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar  5 16:30:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 16:30:12 +0000
Subject: [rabbitmq-discuss] MCollective + RabbitMQ + LDAP authentication
 issues
In-Reply-To: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>
References: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>
Message-ID: <4F54EA14.2090409@rabbitmq.com>

On 02/03/12 21:48, E Raymond wrote:
> =INFO REPORT==== 2-Mar-2012::21:29:37 ===
> LDAP backend: search request = {'SearchRequest',
>
> "ou=/,ou=employees,ou=people,dc=example,dc=net",
>                                     baseObject,neverDerefAliases,
> 0,0,false,
>                                     {present,"objectClass"},
>                                     []}
>
> =INFO REPORT==== 2-Mar-2012::21:29:37 ===
> LDAP backend: search reply = {ok,
>                                {'LDAPMessage',1,
>                                 {searchResDone,
>                                  {'LDAPResult',noSuchObject,
>
> "ou=employees,ou=people,dc=example,dc=net",
>                                   [],asn1_NOVALUE}},
>                                 asn1_NOVALUE}}
>
> =ERROR REPORT==== 2-Mar-2012::21:29:37 ===
> STOMP error frame sent:
> Message: "Bad CONNECT"
> Detail: "Authentication failure\n"
> Server private detail: none

The request / response immediately before the authentication failure 
shows the LDAP plugin looking up the object

"ou=/,ou=employees,ou=people,dc=example,dc=net"

and getting

noSuchObject

in response.

Does that object actually exist?

Do you actually want to have:
   {vhost_access_query,
     {exists, "ou=${vhost},ou=employees,ou=people,dc=example,dc=net"}},

in your config?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar  5 16:36:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 16:36:53 +0000
Subject: [rabbitmq-discuss] Transfer rate improvement above 45mb/second?
In-Reply-To: <aa29c113-a9f5-47a7-9792-280a51f79902@v2g2000pbo.googlegroups.com>
References: <aa29c113-a9f5-47a7-9792-280a51f79902@v2g2000pbo.googlegroups.com>
Message-ID: <4F54EBA5.8000105@rabbitmq.com>

On 05/03/12 15:33, Matt wrote:
> Hello, I setup a rabbitmq server on my local machine under Windows 7,
> 64 bit, and set up a test instance in C#. I look for the fastest way
> to deliver messages in the same order than they were published onto
> the bus through a direct connection (no fan out needed). I do not need
> guaranteed delivery, all I am after is max speed to deliver the
> messages to one single consumer. Currently I seem to max out at about
> 40,000 messages per second which is impressive but does not solve my
> problem. I need to push around 115,000,000 messages and thus I started
> to chunk the messages into larger byte arrays. Still I dont seem to
> improve much as the max transfer rates maxes out at around 45mb/
> second. Is there any way to improve those numbers? Pushing the
> 115,000,000 messages to the consumer currently takes around 50 seconds
> no matter how I set the chunk size.

I suspect you're probably limited by the speed of the AMQP parser in 
this case. Unfortunately the only thing you can really do to make it run 
faster is turn on HiPE compilation or buy a a faster machine. And HiPE 
compilation only works on Unix I'm afraid.

If you can afford to lose ordering guarantees you could push the 
messages through more than one connection / queue, and thus take 
advantage of more cores.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jasonjwwilliams at gmail.com  Mon Mar  5 16:41:38 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 5 Mar 2012 09:41:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ in Action, Final call for errata
Message-ID: <CAHZAEpfCO8nf+BHo=s5wjr55d8JwBURRUTo-uPegvEdgPjbH2w@mail.gmail.com>

Hello All,

As RabbitMQ in Action is going into final proofing, we'd like to
request that all of you who we are lucky enough to have as readers
might send in any errata you may have noticed in the final MEAP copy.
The proofers and reviewers have caught a lot, but we'd like to make
sure we don't overlook anything. Thank you in advance, and please send
any errata directly to Alvaro or myself:

jasonjwwilliams at gmail.com
videlalvaro at gmail.com

Thank you again!

-J

From simon at rabbitmq.com  Mon Mar  5 16:45:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 16:45:57 +0000
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>
References: <4F454C42.4080400@gmail.com>
	<7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>
Message-ID: <4F54EDC5.5010802@rabbitmq.com>

Hi Max, thanks for writing. Are you the "local Erlang expert" Chip 
referred to?

On 24/02/12 15:19, Max Kalika wrote:
> 3) There was one process with over 2 million pages.  It was constantly
> running lists:zipwith/3.  Info on it showed lots and lots of messages
> in the mailbox that just wasn't decreasing.

I don't suppose you have any record of what these messages were? Or any 
logs from around this time?

> I mentioned earlier that the system is *mostly* recovered.  The
> remaining problem is disk utilization.  I suspect that since our
> messages are marked durable, disk cleanup didn't occur.  I'm not sure
> how to sync this up with runtime reality without restarting.

So the only code in the rabbit codebase which invokes lists:zipwith/3 is 
the file_handle_cache. Hmm. Unfortunately it uses it in a rather generic 
location so this is still not exactly clear.

This would help explain why disk cleanup didn't occur, since you killed 
something that was in the middle of doing some file handling.

Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Mon Mar  5 16:54:38 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 5 Mar 2012 11:54:38 -0500
Subject: [rabbitmq-discuss] building SimpleAmqpClient redux (Visual
	Studio 2008)
In-Reply-To: <4F54D348.1040907@holtmans.com>
References: <4F54CC9D.8080101@holtmans.com>
	<4F54D348.1040907@holtmans.com>
Message-ID: <CAAt2po+XZv=wgM933+gydbp3CpDpq3gMbbFvuU2ELDdg9+YFfg@mail.gmail.com>

Looks like you found a bug!

I suspect its because most other platforms (including VS2010 - which I
tested it under) have the stdint.h header, which is implicitly included by
#include <boost/cstdint.h>, which I'm apparently using incorrectly.

An (untested) workaround I would try for the moment if you don't want to
change the SimpleAmqpClient code itself would be to download the msinttypes
http://code.google.com/p/msinttypes/ and include it before you include any
other SimpleAmqpClient headers

-Alan

P.S. I've filed a bug here:
https://github.com/alanxz/SimpleAmqpClient/issues/1


On Mon, Mar 5, 2012 at 9:52 AM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 3/5/2012 8:24 AM, Eric J. Holtman wrote:
> > sigh.
> >
> > I can get cmake to run.   It generates the solution files
> > and project files for VS 2008 just fine.
> >
> > They won't compile.
> >
> > errors are all like this:
> >
> > 1>MessageReturnedException.cpp
> > 1>c:\dev\simpleamqpclient\src\SimpleAmqpClient/BasicMessage.h(195) :
> > error C2146: syntax error : missing ';' before identifier 'Priority'
> >
> > the problem is that none of the typedefs for uint8_t, uint16_t etc
> > seem to have been included.
> >
>
>
> The error seems to ne (taking AmqpException.h for example)
> that the headers are including
>
> #include <boost/cstdint.hpp>
>
> but then the code has declarations like:
>
>  explicit AmqpException(const std::string& reply_text, uint16_t
> class_id, uint16_t method_id) throw();
>
> the boost/cstdint.hpp puts uint16_t in the boost:: namesspace,
> NOT in std::
>
> if I change the above line to
>
>  explicit AmqpException(const std::string& reply_text, boost::uint16_t
> class_id, boost::uint16_t method_id) throw();
>
> it compiles.
>
> I'm not really willing to put a "using namespace boost" at the top
> of the headers.
>
> Am I missing something obvious here?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/284d5186/attachment.htm>

From eric at holtmans.com  Mon Mar  5 16:56:55 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Mon, 05 Mar 2012 10:56:55 -0600
Subject: [rabbitmq-discuss] building SimpleAmqpClient redux (Visual
 Studio 2008)
In-Reply-To: <CAAt2po+XZv=wgM933+gydbp3CpDpq3gMbbFvuU2ELDdg9+YFfg@mail.gmail.com>
References: <4F54CC9D.8080101@holtmans.com>	<4F54D348.1040907@holtmans.com>
	<CAAt2po+XZv=wgM933+gydbp3CpDpq3gMbbFvuU2ELDdg9+YFfg@mail.gmail.com>
Message-ID: <4F54F057.6010509@holtmans.com>

On 3/5/2012 10:54 AM, Alan Antonuk wrote:

> 
> An (untested) workaround I would try for the moment if you don't want to
> change the SimpleAmqpClient code itself would be to download the msinttypes
> http://code.google.com/p/msinttypes/ and include it before you include any
> other SimpleAmqpClient headers
> 


Right.... I also got the same result including stdint.h
from the rabbitmq_c library.

I put it in Util.h and that seemed to cover up the bug for now.


From jasonjwwilliams at gmail.com  Mon Mar  5 17:00:03 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 5 Mar 2012 10:00:03 -0700
Subject: [rabbitmq-discuss] RabbitMQ in Action, Final call for errata
In-Reply-To: <CAHZAEpfCO8nf+BHo=s5wjr55d8JwBURRUTo-uPegvEdgPjbH2w@mail.gmail.com>
References: <CAHZAEpfCO8nf+BHo=s5wjr55d8JwBURRUTo-uPegvEdgPjbH2w@mail.gmail.com>
Message-ID: <CAHZAEpfZEYDN6WYYs+QriVjfc4tt+M-Mq5tw-dcxwgo4iNz8gg@mail.gmail.com>

BTW, you can tell if your MEAP is the latest version by checking the
page after the cover. If it says "RabbitMQ in Action version 8" you
have the latest released version.

-J

On Mon, Mar 5, 2012 at 9:41 AM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hello All,
>
> As RabbitMQ in Action is going into final proofing, we'd like to
> request that all of you who we are lucky enough to have as readers
> might send in any errata you may have noticed in the final MEAP copy.
> The proofers and reviewers have caught a lot, but we'd like to make
> sure we don't overlook anything. Thank you in advance, and please send
> any errata directly to Alvaro or myself:
>
> jasonjwwilliams at gmail.com
> videlalvaro at gmail.com
>
> Thank you again!
>
> -J

From ezequiel.golub at gmail.com  Mon Mar  5 17:25:07 2012
From: ezequiel.golub at gmail.com (Ezequiel Golub)
Date: Mon, 5 Mar 2012 14:25:07 -0300
Subject: [rabbitmq-discuss] Using pika - PRECONDITION_FAILED - unknown
	delivery tag 1
Message-ID: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>

Hey guys, i was wondering if any of you could lend me a hand with
getting my rabbitmq project off the ground.

I need to have multiple queues, with strong but not absolute
guarantees that message will be delivered only once and redelivered if
not ack is sent.
I took the code examples in
http://www.rabbitmq.com/tutorials/tutorial-two-python.html and
modified just a little, and i'm getting the following failure after a
number of messages are received (emphasis added):

[root at localhost rabbit_tests]# python test_consumer.py
suscribing
 [x] Received 'hello world 0'
Sleeping for 5 seconds
Sending delivery tag = 1
 [x] Received 'hello world 1'
Sleeping for 5 seconds
Sending delivery tag = 2
 [x] Received 'hello world 2'
Sleeping for 5 seconds
Sending delivery tag = 3
 [x] Received 'hello world 3'
Sleeping for 5 seconds
Sending delivery tag = 4
 [x] Received 'hello world 4'
Sleeping for 5 seconds
!!!!!!!!**** Sending delivery tag = 5 *****!!!!!!!!!
Traceback (most recent call last):
  File "test_consumer.py", line 28, in <module>
    main()
  File "test_consumer.py", line 25, in main
    channel.start_consuming()
  File "/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 293, in start_consuming
    self.transport.connection.process_data_events()
  File "/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 94, in process_data_events
    self._handle_read()
  File "/usr/lib/python2.6/site-packages/pika/adapters/base_connection.py",
line 162, in _handle_read
    self._on_data_available(data)
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line
589, in _on_data_available
    frame)                 # Args
  File "/usr/lib/python2.6/site-packages/pika/callback.py", line 124, in process
    callback(*args, **keywords)
  File "/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 269, in _on_remote_close
    frame.method.reply_text)
pika.exceptions.AMQPChannelError: (406, 'PRECONDITION_FAILED - unknown
delivery tag 1')


here's the code i use to create this test.

---- test_producer.py ----
#!/usr/bin/env python
import pika, sys, json, time

date = '2012030505'

connection = pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
connection.set_backpressure_multiplier(100)
channel = connection.channel()
channel.exchange_declare(exchange="main", type="direct",
durable=True,auto_delete=False,)
channel.queue_declare(queue='queue_%s' % date, durable=True,
exclusive=False, auto_delete=False)
channel.queue_bind(queue='queue_%s' % date, exchange="main", routing_key=date)
channel.tx_select()

for i in range(0,10):
    message = 'hello world %s' % i
    channel.basic_publish(exchange='main',
                          routing_key= date,
                          properties=pika.BasicProperties(
                              delivery_mode = 2, # make message persistent
                          ),
                          body=message)

    print " [x] Sent %s:'%s'" % (date,message)
    channel.tx_commit()
    time.sleep(1)

---- test_consumer.py ----
import pika, time


def consume(ch, method, properties, body):
    print " [x] Received %r" % (body,)
#    print method
#    print properties
#    print ch
    # simulate we're doing something
    print "Sleeping for 5 seconds"
    time.sleep(5)
    print "Sending delivery tag = %s " % method.delivery_tag
    ch.basic_ack(delivery_tag = method.delivery_tag)

def main():
    connection =
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
    channel = connection.channel()
    channel.exchange_declare(exchange="main", type="direct",
durable=True,auto_delete=False,)
    print "suscribing"
    channel.basic_qos(prefetch_count=0)
    channel.basic_consume(consume,
                      queue='queue_2012030505',
                      no_ack=True,
    )
    channel.start_consuming()

if __name__ == "__main__":
    main()

--- Here's what rabbitmqctl reports ----

[root at localhost brandsafe]# /usr/lib/rabbitmq/bin/rabbitmqctl status
Status of node rabbit at localhost ...
[{pid,18510},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
[64-bit] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,29090512},
          {processes,14184944},
          {processes_used,10892640},
          {system,14905568},
          {atom,1064009},
          {atom_used,1046693},
          {binary,90552},
          {code,11672579},
          {ets,877768}]},
 {vm_memory_high_watermark,0.3999999999458532},
 {vm_memory_limit,1477464883}]
...done.

[root at localhost brandsafe]# /usr/lib/rabbitmq/bin/rabbitmqctl environment
Application environment of node rabbit at localhost ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,none},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at localhost.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at localhost-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[<<"/">>]},
 {vm_memory_high_watermark,0.4}]
...done.


[root at localhost brandsafe]# /usr/lib/rabbitmq/bin/rabbitmqctl report
Reporting server status on {{2012,3,5},{17,22,44}}

Status of node rabbit at localhost ...
[{pid,18510},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
[64-bit] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,28940936},
          {processes,14026016},
          {processes_used,10733712},
          {system,14914920},
          {atom,1064817},
          {atom_used,1046833},
          {binary,90552},
          {code,11672579},
          {ets,877768}]},
 {vm_memory_high_watermark,0.3999999999458532},
 {vm_memory_limit,1477464883}]

Cluster status of node rabbit at localhost ...
[{nodes,[{disc,[rabbit at localhost]}]},{running_nodes,[rabbit at localhost]}]

Application environment of node rabbit at localhost ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,none},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at localhost.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at localhost-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[<<"/">>]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid	address	port	peer_address	peer_port	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	channels
<rabbit at localhost.1.6488.0>	127.0.0.1	5672	127.0.0.1	49132	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","Pika
Python AMQP Client Library"}]	237	8	426	7	0	running	1

Channels:
pid	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	messages_uncommitted	acks_uncommitted	prefetch_count	client_flow_blocked
<rabbit at localhost.1.6492.0>	<rabbit at localhost.1.6488.0>	1	guest	/	false	false	1	0	0	0	0	0	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	slave_pids	synchronised_slave_pids	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<rabbit at localhost.1.383.0>	amq.gen-OmspSdOAO9n0MBZ4Zx6DlA==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.384.0>	amq.gen-0loSvlps1uXisVryOaGgnw==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.385.0>	amq.gen-RZxh+lukh03mUutFuCm/Aw==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.387.0>	po_box	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.386.0>	amq.gen-/o9D5DstK79QnRkLYqtrbw==	true	false	[]						2	0	2	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,2}, {q4,0},
{len,2}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,2}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.388.0>	amq.gen-jewfcXKPDUc6Sqg5jgs0tQ==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.389.0>	task_queue	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.390.0>	amq.gen-76kfx4BIaFdeX+sLtvDGMQ==	true	false	[]						1	0	1	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,1}, {q4,0},
{len,1}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,1}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.391.0>	amq.gen-lr+7aeYKj4gjFw5VFeKajQ==	true	false	[]						5	0	5	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,5}, {q4,0},
{len,5}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,5}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.392.0>	queue_2012030209	true	false	[]						20	0	20	0	55200	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,20}, {q4,0},
{len,20}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,20}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.393.0>	amq.gen-Jvf89t5Zr2B6NoJbh22vjw==	true	false	[]						3	0	3	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,3}, {q4,0},
{len,3}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,3}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.394.0>	amq.gen-JCxGTsOTUVU0eccre4BLqg==	true	false	[]						7	0	7	0	55200	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,7}, {q4,0},
{len,7}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,7}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.395.0>	amq.gen-DbMT7q0fyWDMdaNhqNh+FA==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.396.0>	queue_2012030115	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.397.0>	amq.gen-d4bX+YjWwIBvwkEYUpfEKQ==	true	false	[]						2	0	2	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,2}, {q4,0},
{len,2}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,2}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.398.0>	queue_2012030210	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.399.0>	amq.gen-95KpPW7AC/nOUSYzEfAnsQ==	true	false	[]						2	0	2	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,2}, {q4,0},
{len,2}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,2}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.400.0>	amq.gen-4NVkRy5k5dzhygSohpnRSw==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.401.0>	amq.gen-Tuie11PiAM4wHTwxNyK0Hw==	true	false	[]						8	0	8	0	55200	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,8}, {q4,0},
{len,8}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,16384},
{persistent_count,8}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.403.0>	algo	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.402.0>	amq.gen-R/qSTZLK8Z8Ovm97MDwquw==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.404.0>	queue_2012030505	true	false	[]						0	0	0	1	34600	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,91},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at localhost.1.405.0>	amq.gen-BPFYbLliOy3wWIwlMEYgGw==	true	false	[]						0	0	0	0	34528	[{q1,0},
{q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0},
{len,0}, {pending_acks,0}, {target_ram_count,infinity},
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0},
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0},
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.match	headers	true	false	false	[]
main	direct	true	false	false	[]
amq.headers	headers	true	false	false	[]
sorting_room	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.direct	direct	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
	direct	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	algo	queue	algo	[]
	exchange	amq.gen-/o9D5DstK79QnRkLYqtrbw==	queue	amq.gen-/o9D5DstK79QnRkLYqtrbw==	[]
	exchange	amq.gen-0loSvlps1uXisVryOaGgnw==	queue	amq.gen-0loSvlps1uXisVryOaGgnw==	[]
	exchange	amq.gen-4NVkRy5k5dzhygSohpnRSw==	queue	amq.gen-4NVkRy5k5dzhygSohpnRSw==	[]
	exchange	amq.gen-76kfx4BIaFdeX+sLtvDGMQ==	queue	amq.gen-76kfx4BIaFdeX+sLtvDGMQ==	[]
	exchange	amq.gen-95KpPW7AC/nOUSYzEfAnsQ==	queue	amq.gen-95KpPW7AC/nOUSYzEfAnsQ==	[]
	exchange	amq.gen-BPFYbLliOy3wWIwlMEYgGw==	queue	amq.gen-BPFYbLliOy3wWIwlMEYgGw==	[]
	exchange	amq.gen-DbMT7q0fyWDMdaNhqNh+FA==	queue	amq.gen-DbMT7q0fyWDMdaNhqNh+FA==	[]
	exchange	amq.gen-JCxGTsOTUVU0eccre4BLqg==	queue	amq.gen-JCxGTsOTUVU0eccre4BLqg==	[]
	exchange	amq.gen-Jvf89t5Zr2B6NoJbh22vjw==	queue	amq.gen-Jvf89t5Zr2B6NoJbh22vjw==	[]
	exchange	amq.gen-OmspSdOAO9n0MBZ4Zx6DlA==	queue	amq.gen-OmspSdOAO9n0MBZ4Zx6DlA==	[]
	exchange	amq.gen-R/qSTZLK8Z8Ovm97MDwquw==	queue	amq.gen-R/qSTZLK8Z8Ovm97MDwquw==	[]
	exchange	amq.gen-RZxh+lukh03mUutFuCm/Aw==	queue	amq.gen-RZxh+lukh03mUutFuCm/Aw==	[]
	exchange	amq.gen-Tuie11PiAM4wHTwxNyK0Hw==	queue	amq.gen-Tuie11PiAM4wHTwxNyK0Hw==	[]
	exchange	amq.gen-d4bX+YjWwIBvwkEYUpfEKQ==	queue	amq.gen-d4bX+YjWwIBvwkEYUpfEKQ==	[]
	exchange	amq.gen-jewfcXKPDUc6Sqg5jgs0tQ==	queue	amq.gen-jewfcXKPDUc6Sqg5jgs0tQ==	[]
	exchange	amq.gen-lr+7aeYKj4gjFw5VFeKajQ==	queue	amq.gen-lr+7aeYKj4gjFw5VFeKajQ==	[]
	exchange	po_box	queue	po_box	[]
	exchange	queue_2012030115	queue	queue_2012030115	[]
	exchange	queue_2012030209	queue	queue_2012030209	[]
	exchange	queue_2012030210	queue	queue_2012030210	[]
	exchange	queue_2012030505	queue	queue_2012030505	[]
	exchange	task_queue	queue	task_queue	[]
main	exchange	queue_2012030209	queue	2012030209	[]
main	exchange	queue_2012030505	queue	2012030505	[]
sorting_room	exchange	po_box	queue	mailme	[]

Consumers on /:
queue_name	channel_pid	consumer_tag	ack_required
queue_2012030505	<rabbit at localhost.1.6492.0>	ctag0	false

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.




Thanks a million!

--
Ezequiel Golub

From majek04 at gmail.com  Mon Mar  5 17:30:30 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 5 Mar 2012 17:30:30 +0000
Subject: [rabbitmq-discuss] Using pika - PRECONDITION_FAILED - unknown
 delivery tag 1
In-Reply-To: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>
References: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>
Message-ID: <CABzX+qxZet4yJ_jRKiZ-tV7F-qxhu7=CDHSCsXFL3fNSh621Ww@mail.gmail.com>

On Mon, Mar 5, 2012 at 17:25, Ezequiel Golub <ezequiel.golub at gmail.com> wrote:
> Hey guys, i was wondering if any of you could lend me a hand with
> getting my rabbitmq project off the ground.
>
> I need to have multiple queues, with strong but not absolute
> guarantees that message will be delivered only once and redelivered if
> not ack is sent.
> I took the code examples in
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html and
> modified just a little, and i'm getting the following failure after a
> number of messages are received (emphasis added):

> ---- test_consumer.py ----
> import pika, time
>
>
> def consume(ch, method, properties, body):
> ? ?print " [x] Received %r" % (body,)
> ? ?print "Sleeping for 5 seconds"
> ? ?time.sleep(5)
> ? ?print "Sending delivery tag = %s " % method.delivery_tag
> ? ?ch.basic_ack(delivery_tag = method.delivery_tag)

Here you send an ack.

> def main():
> ? ?connection =
> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
> ? ?channel = connection.channel()
> ? ?channel.exchange_declare(exchange="main", type="direct",
> durable=True,auto_delete=False,)
> ? ?print "suscribing"
> ? ?channel.basic_qos(prefetch_count=0)
> ? ?channel.basic_consume(consume,
> ? ? ? ? ? ? ? ? ? ? ?queue='queue_2012030505',
> ? ? ? ? ? ? ? ? ? ? ?no_ack=True,

no_ack = True means that you don't want to send acks.

That's one possibility of your problem.

Cheers,
  Marek

From simon at rabbitmq.com  Mon Mar  5 17:31:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Mar 2012 17:31:01 +0000
Subject: [rabbitmq-discuss] Using pika - PRECONDITION_FAILED - unknown
 delivery tag 1
In-Reply-To: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>
References: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>
Message-ID: <4F54F855.2090200@rabbitmq.com>

On 05/03/12 17:25, Ezequiel Golub wrote:
> i'm getting the following failure after a
> number of messages are received (emphasis added):

<snip>
>      ch.basic_ack(delivery_tag = method.delivery_tag)
<snip>
>      channel.basic_consume(consume,
>                        queue='queue_2012030505',
>                        no_ack=True,
>      )
<snip>

So you have told RabbitMQ that you will not be acking messages, but then 
you are sending acks anyway. The channel is blowing up when the first 
ack gets through.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ezequiel.golub at gmail.com  Mon Mar  5 17:34:20 2012
From: ezequiel.golub at gmail.com (Ezequiel Golub)
Date: Mon, 5 Mar 2012 14:34:20 -0300
Subject: [rabbitmq-discuss] Using pika - PRECONDITION_FAILED - unknown
 delivery tag 1
In-Reply-To: <4F54F855.2090200@rabbitmq.com>
References: <CAHTZd_gQ6+P37a8EFC=ewzV-0QJ-gHrY=tcvhviVf3h41h3DmA@mail.gmail.com>
	<4F54F855.2090200@rabbitmq.com>
Message-ID: <CAHTZd_gnLR5kajTqYjQX+0XzLi1+Cho2X4LpVFhn7kBA6a4SnQ@mail.gmail.com>

I works as a charm now, thanks a million!!!

On Mon, Mar 5, 2012 at 2:31 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 05/03/12 17:25, Ezequiel Golub wrote:
>>
>> i'm getting the following failure after a
>> number of messages are received (emphasis added):
>
>
> <snip>
>>
>> ? ? ch.basic_ack(delivery_tag = method.delivery_tag)
>
> <snip>
>
>> ? ? channel.basic_consume(consume,
>> ? ? ? ? ? ? ? ? ? ? ? queue='queue_2012030505',
>> ? ? ? ? ? ? ? ? ? ? ? no_ack=True,
>> ? ? )
>
> <snip>
>
> So you have told RabbitMQ that you will not be acking messages, but then you
> are sending acks anyway. The channel is blowing up when the first ack gets
> through.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
Ezequiel Golub

From steve at rabbitmq.com  Mon Mar  5 17:39:05 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Mar 2012 17:39:05 +0000
Subject: [rabbitmq-discuss] Rabbit crashes upon startup.
In-Reply-To: <D8F52C1E-5BCF-47B4-9696-B839CC35CF54@rabbitmq.com>
References: <14051430.48.1330725895320.JavaMail.geo-discussion-forums@pbcvy9>
	<24573478.82.1330727170664.JavaMail.geo-discussion-forums@pbcpw9>
	<D8F52C1E-5BCF-47B4-9696-B839CC35CF54@rabbitmq.com>
Message-ID: <08631612-65A6-4189-B374-47620862A5E1@rabbitmq.com>

Sorry, went to the wrong place...

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 5 Mar 2012, at 17:14, Steve Powell wrote:

> Pat,
> 
> The information is a little thin, I'm afraid.
> 
> Just a couple of notes though: 
> 
> 1) you should look in startup_err AND startup_log when 
> you get a failure like this; and, 
> 
> 2) are you starting the rabbit service as root (sudo...)?
> 
> I'm seeing something like this when the files that rabbitmq uses/needs aren't
> accessible by the user that the service is running as. In some cases they are
> created with the wrong permissions (from some previous failed attempt)
> and persist for subsequent attempts -- and of course they are now wrong.
> 
> Simplest solution is to reinstall the package and start the service properly.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 2 Mar 2012, at 22:26, patfla wrote:
> 
>> 
>> amqp runs on 5762.  Did a netstat -anp | grep 5762 and found a process called qpidd (I said I didn't have much past experience digging inside rabbitmq).  Figured out this is AMQP.  Killed the process.
>> 
>> Now Rabbitmq starts successfully.  Go figure.
>> 
>> Pat
>> 
>> 
>> On Friday, March 2, 2012 2:04:55 PM UTC-8, patfla wrote:
>> 
>> Rabbitmq 2.7.1-1 and erlang R14B-04.1
>> 
>> We normally use CentOS 5.7 which has its shortcomings.  In order to try CentOS 6.2 I installed it into an Oracle(Sun) VirtualBox VM.  That all works fine.
>> 
>> Among the infrastructure that we need are postgres and memcached - they install and run fine.
>> 
>> For rabbit, stated by making an EPEL repo then installed both erlang and rabbitmq.
>> 
>> Try to start rabbitmq - service rabbitmq-server - and I get:
>> 
>> 
>> [blah at localhost init.d]# pwd
>> /etc/init.d
>> [blah at localhost init.d]# service rabbitmq-server start
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
>> rabbitmq-server.
>> [blah at localhost init.d]# cat /var/log/rabbitmq/startup_err
>> Erlang has closed
>> 
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller) ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>> [blah at localhost init.d]# ps aux | grep rabbit
>> rabbitmq  4069  0.0  0.0  10880   468 ?        S    13:15   0:00 /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
>> blah      4460  0.0  0.0 103300   844 pts/3    S+   13:59   0:00 grep rabbit
>> [blah at localhost init.d]# 
>> 
>> 
>> Epmd started up.  I think the next thing to start is beam.smp (looking at my CentOS 5.7 machine where this all works).
>> 
>> I've used rabbitmq for some time, but have never had to dig into it...
>> 
>> Tried rebooting - no.  Then uninstall and reinstall - no.
>> 
>> Any suggestions appreciated.
>> 
>> Pat
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/5fd89d59/attachment.htm>

From reubengarrett at gmail.com  Mon Mar  5 17:34:52 2012
From: reubengarrett at gmail.com (Reuben Garrett)
Date: Mon, 5 Mar 2012 11:34:52 -0600
Subject: [rabbitmq-discuss] upgrade to MPL 2.0 ?
In-Reply-To: <4F54E16C.9090302@rabbitmq.com>
References: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>
	<4F54E16C.9090302@rabbitmq.com>
Message-ID: <CAA-SZJGvKFzS=fDX97hFrOyuyLpJFr0oFeTgrMAw8Q+BK_vO+w@mail.gmail.com>

thanks, Alexis and Simon, for responding.

there's no pressure from my end, and i appreciate your being open to
the consideration regardless of whether it can be implemented soon or
at all.  i just wanted to raise awareness between the Apache Camel and
RabbitMQ communities in case the licensing issue was not a foregone
conclusion after all.

best regards,
Reuben Garrett

From cliff.redmond at gmail.com  Mon Mar  5 17:45:21 2012
From: cliff.redmond at gmail.com (Cliff Redmond)
Date: Mon, 5 Mar 2012 09:45:21 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
 than amq.topic?
In-Reply-To: <EB55BA1E-2831-44C3-8AA7-31A386E42F24@rabbitmq.com>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
	<5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
	<c28ec65f-c0c8-4a72-adfa-01ce481d783c@s13g2000yqe.googlegroups.com>
	<EB55BA1E-2831-44C3-8AA7-31A386E42F24@rabbitmq.com>
Message-ID: <20268292.993.1330969521998.JavaMail.geo-discussion-forums@ynll40>

Hi Steve,

sorry for the delay in my reply: my posts were blocked.

We were attempting to replace an installation of ActiveMQ with RabbitMQ, 
with minimal (read: no) producer and consumer code changes.

Producers and consumers used Stomp, and subscribed to topics using 
destinations beginning with 'topic':

/topic/<topicname>

Your suggestion, to use an explicit exchange name in these destinations, 
would seem like introducing a RabbitMQ dependency.

The Stomp plugin interprets subscriptions to topic destinations quite 
sensibly as far as it goes, but choosing to route via the default topic 
exchange (amq.topic) prevented us from replicating queues between data 
centers using the Federation plugin (which doesn't seem to be able to 
federate inbuilt exchanges). We eventually got it working using Shovel, 
though.

As I suggested before, there are two possible solutions here:
- be able to specify a topic exchange in the Stomp plugin config (i.e. 
rather than have it always use amq.topic),
- be able to federate internal/predefined exchanges in the Federation 
plugin.

I'd say the former would be easier to implement - perhaps you could talk to 
your colleagues working on the Stomp plugin?

Regards and thanks,

Cliff.

On Monday, 5 March 2012 16:22:05 UTC, Steve Powell wrote:
>
> Cliff,
>
> Did you see my previous answer:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018456.html
> ?
>
> Please get back to me if this isn't what you want.
>
> Steve Powell  (a hopeful bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 24 Feb 2012, at 12:43, Cliff Redmond wrote:
>
> > Hi Steve,
> > 
> > thanks for your answer.
> > 
> > I was facing the exact same problem as Ken: I think your solution only
> > partially addresses the issue - requiring a subscription to a pre-
> > existing queue significantly reduces the flexibility of Stomp/
> > RabbitMQ.
> > 
> > One of the most useful features of the Stomp plugin is that when a
> > Stomp consumer subscribes to a topic, it automatically creates a new
> > queue (with a lifecycle dictated by the subscription) and binds it to
> > the default topic exchange on that broker.
> > 
> > e.g. invoking the following in a consumer:
> > 
> > $frame = Net::Stomp::Frame->new( {
> >      command => "SUBSCRIBE",
> >      headers => {
> >          destination => "/topic/durable-topic-prefetch",
> >          id => $subscriberId,
> >          persistent => "true",
> >          ack => "client",
> >          prefetch_count => 1,
> >      },
> > });
> > 
> > $stomp->send_frame($frame);
> > 
> > will create a queue on the relevant broker:
> > 
> > sh-3.2# rabbitmqctl list_queues
> > Listing queues ...
> > [...]
> > stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?U        0
> > [...]
> > ...done.
> > 
> > and bind it to the default topic exchange:
> > 
> > Listing bindings ...
> > [...]
> > 
> amq.topic        exchange        stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?
> > U        queue        durable-topic-prefetch        []
> > [...]
> > ...done.
> > 
> > Pre-configuring AMQ queues is considerably less flexible, and the
> > alternative, creating a queue (and binding it to an alternatively
> > named federated topic exchange) using AMQP before each Stomp
> > subscription, militates against using Stomp at all.
> > 
> > Would it be possible to make a change to either of the Stomp or
> > Federation plugins:
> > 
> > - be able to specify a topic exchange in the Stomp plugin config (i.e.
> > rather than have it always use amq.topic),
> > - be able to federate internal/predefined exchanges in the Federation
> > plugin.
> > 
> > (I used the Shovel plugin to workaround this issue).
> > 
> > Many thanks,
> > 
> > Cliff.
> > 
> > On Feb 21, 6:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
> >> Hi Ken,
> >> 
> >> It is possible for you to SEND to the exchange of your choice from 
> aSTOMP
> >> application, using a destination of the form: 
> /exchange/<name>/<pattern> (seehttp://www.rabbitmq.com/stomp.html#d.ed) 
> and there is no reason why this
> >> shouldn't be a topic exchange of your own making.
> >> 
> >> If you need to SUBSCRIBE to AMQP destinations you can use the 
> destination
> >> /amq/queue/<name> (but the queue must exist).
> >> 
> >> Between them, these should allow you to useSTOMPwith federated exchanges
> >> without plugin modifications.
> >> 
> >> Let us know how you get on.
> >> 
> >> Steve Powell  (a federated bunny)
> >> ----------some more definitions from the SPD----------
> >> vermin (v.) Treating the dachshund for roundworm.
> >> chinchilla (n.) Cooling device for the lower jaw.
> >> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> >> 
> >> On 20 Feb 2012, at 16:19, Ken Simon wrote:
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >>> Greetings,
> >> 
> >>> I'm trying to getfederationworking (via the rabbitmq_federation
> >>> plugin) in our environment ofSTOMPhosts, and to do so I have to
> >>> enablefederationin theSTOMPplugin's exchange: amq.topic.  This
> >>> unfortunately doesn't seem to work because amq.* exchanges are
> >>> reserved and cannot be re-declared.
> >> 
> >>> My solution at this point has been to edit the source of theSTOMP
> >>> plugin and point it at an exchange called "stomp_topic" (which I made
> >>> up, but could be anything) instead of the default amq.topic.  Then I
> >>> just configure thefederationplugin to work with that exchange and it
> >>> works fine.
> >> 
> >>> My question is, is there a better way of doing this?  I hate
> >>> maintaining my own downstream changes to plugins if I don't have to.
> >>> The docs say that theSTOMPplugin routes all messages through
> >>> amq.topic, so it appears that's not configurable.  But wouldn't it
> >>> make sense to allow use of an exchange that's not reserved?  Or am I
> >>> missing something, and this is actually way easier?  I'm having
> >>> trouble finding any documented cases of people using bothSTOMPand
> >>> federation.
> >> 
> >>> Thanks,
> >> 
> >>> --
> >>> Ken
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> 
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/19f1c44b/attachment.htm>

From trancos at gmail.com  Mon Mar  5 20:11:53 2012
From: trancos at gmail.com (Jose Comboni)
Date: Mon, 5 Mar 2012 12:11:53 -0800
Subject: [rabbitmq-discuss] Best OS and configuration needs
Message-ID: <CAEzUxW97Nsd_P+sj9xtoD7=pqNg8A3nKEf8aMXWvf=KZevYv-g@mail.gmail.com>

Hi All,

I'm new to the list, so please bear with me in case I ask something that
may be too obvious.
I'm trying to integrate RabbitMQ as a way to safely decouple components on
a client/server configuration; the system will be receiving Billions of
requests per month.

We're thinking of setting up a clustered queue with RabbitMQ, and I was
wondering what is the best platform to deploy something like this. Our main
development environment is in Windows (.NET), however, we are hosting at
least two other components in several Linux servers.

One more thing, in your experience, what is the recommended RAM needed for
clustered environments, and in the case of durable queues, is SSD
recommended? or RAID5 (with 8+ mechanical disks) and a small stripe size do
the job. The payload per message has an average of 400bytes (yes, that is
bytes).

Thanks,

-- 
- JMJC
"The significant problems we face cannot be solved at the same level of
thinking with which we created them." - Albert Einstein
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/a2780c77/attachment.htm>

From simone.busoli at gmail.com  Mon Mar  5 20:53:07 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 5 Mar 2012 21:53:07 +0100
Subject: [rabbitmq-discuss] Best OS and configuration needs
In-Reply-To: <CAEzUxW97Nsd_P+sj9xtoD7=pqNg8A3nKEf8aMXWvf=KZevYv-g@mail.gmail.com>
References: <CAEzUxW97Nsd_P+sj9xtoD7=pqNg8A3nKEf8aMXWvf=KZevYv-g@mail.gmail.com>
Message-ID: <CAOn7oW_WOSW8N3g0y+6V-LwotB2wznD9Jp+0MZZTggzo2LYOCA@mail.gmail.com>

Hi Jose,

I can tell you about my experience, but please take into account that the
deployments I did bear nowhere near the load you've described.

That said, I'm pretty sure the broker counts way more Linux deployments
than Windows ones, although I've been running on Windows for months without
any major issues. This directly implies that you're less likely to
experience issues unheard of if run on Linux.
On the client side I've been using .NET as well, with some minor glitches,
of which some are resolved in the version control trunk. (I.e. heartbeats)

I'll leave the ram and disk aspect to someone else as it's never really
concerned me given the relatively low load.
On Mar 5, 2012 9:12 PM, "Jose Comboni" <trancos at gmail.com> wrote:

>
> Hi All,
>
> I'm new to the list, so please bear with me in case I ask something that
> may be too obvious.
> I'm trying to integrate RabbitMQ as a way to safely decouple components on
> a client/server configuration; the system will be receiving Billions of
> requests per month.
>
> We're thinking of setting up a clustered queue with RabbitMQ, and I was
> wondering what is the best platform to deploy something like this. Our main
> development environment is in Windows (.NET), however, we are hosting at
> least two other components in several Linux servers.
>
> One more thing, in your experience, what is the recommended RAM needed for
> clustered environments, and in the case of durable queues, is SSD
> recommended? or RAID5 (with 8+ mechanical disks) and a small stripe size do
> the job. The payload per message has an average of 400bytes (yes, that is
> bytes).
>
> Thanks,
>
> --
> - JMJC
> "The significant problems we face cannot be solved at the same level of
> thinking with which we created them." - Albert Einstein
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/8ddbb301/attachment.htm>

From jerryk at vmware.com  Mon Mar  5 21:21:57 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 5 Mar 2012 13:21:57 -0800 (PST)
Subject: [rabbitmq-discuss] Serialized Java Objects in Message bodies
	not supported by RabbitMQ??
In-Reply-To: <CA+u4LE5=iA2QUjEAx388acpajGTiCiJSzoxCVTXraOQhEWThgw@mail.gmail.com>
Message-ID: <425a3811-cc63-45ad-9422-43f9baff8192@csb-2-eng-dhcp113.eng.vmware.com>

Hi, Ashutosh:

(Copying back on the list in case others or future Google-searchers
are interested...)

If you *really* want to serialize your Java object to a bytestream
you can send in an AMQP message body you could do something like this:

ByteArrayOutputStream os = new ByteArrayOutputStream();
ObjectOutput objOut = new ObjectOutputStream(os);

objOut.writeObject(whateverYourObjectIs);
byte byteForm[] = os.toByteArray();
objOut.close();
os.close();

That said, you might still want to think carefully about whether you want 
to do this and have your application cope with the restrictions it imposes,
and the pitfalls (potential bugs, security holes, maintenance and testing
costs, etc.) it creates.  The sections on Serialization in chapter
11 of Josh Bloch's "Effective Java" are something you may want to keep
close at hand.

Best regards,
Jerry

----- Original Message -----
From: "Ashutosh Mathur" <amathur.q at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Sent: Sunday, March 4, 2012 8:07:07 PM
Subject: Re: [rabbitmq-discuss] Serialized Java Objects in Message bodies not supported by RabbitMQ??

Hi Jerry, 

Thanks for the reply.Now its almost clear to me that we can send Java Serialized objects in message bodies.But I had read on some discussion groups elsewhere that this is not possible.If it is possible,as you say, can you please specify a method which will do so?Can we use the normal "MessageConverters" for this? 
Sorry for the mail in your personal mailbox.Wasn't sure whether you'll see this post in the discussion lists. 

Ashutosh 


On Fri, Mar 2, 2012 at 10:41 AM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Ashutosh: 

You can put any bytes you want into an AMQP message payload, 
you'll just have to handle the encoding yourself in the usual 
Java serialization ways. Be warned though, that serializing POJOs 
is going to put restrictions on the the recipients of your message 
can be, i.e. they're also going to need to be in Java, with the 
appropriate stuff versions of the appropriate stuff on their 
classpaths, to be able to make sense out of what you're sending 
them if you plan to deserialize them into Java objects. 

You might find the JSON solution you suggest gives you something 
that's a bit more friendly in polyglot systems, and leave your 
application with more future flexibility... 

Jerry 



----- Original Message ----- 
From: "Ashutosh Mathur" < amathur.q at gmail.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, March 1, 2012 9:00:36 PM 
Subject: [rabbitmq-discuss] Serialized Java Objects in Message bodies not supported by RabbitMQ?? 


Hi, 

RabbitMQ doesn't support Serialized Java Objects in Message bodies.Is that true? In JMS,it is done by "CreateObjectMessage()" method. Is there any function in AMQP which has same/similar functionality.? 
One possible solution for above may be to convert data into JSON strings and send within the message.will that work? 
Thanks in advance. 

_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From abdullahsaima at yahoo.com  Mon Mar  5 21:37:54 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Mon, 5 Mar 2012 21:37:54 +0000 (GMT)
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done
In-Reply-To: <CAOn7oW_WOSW8N3g0y+6V-LwotB2wznD9Jp+0MZZTggzo2LYOCA@mail.gmail.com>
References: <CAEzUxW97Nsd_P+sj9xtoD7=pqNg8A3nKEf8aMXWvf=KZevYv-g@mail.gmail.com>
	<CAOn7oW_WOSW8N3g0y+6V-LwotB2wznD9Jp+0MZZTggzo2LYOCA@mail.gmail.com>
Message-ID: <1330983474.73914.YahooMailNeo@web29703.mail.ird.yahoo.com>

Hi,

I want to understand how exchange is bounded to other exchange and why. The only reference I found for this.
http://www.rabbitmq.com/extensions.html?


Can anyone help me to understand it in more detail.
?
Saima Asif
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/5275bcad/attachment.htm>

From jerryk at vmware.com  Mon Mar  5 22:21:02 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 5 Mar 2012 14:21:02 -0800 (PST)
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its
	done
In-Reply-To: <1330983474.73914.YahooMailNeo@web29703.mail.ird.yahoo.com>
Message-ID: <da81d917-3fe4-4e20-af1c-797f0b21166f@csb-2-eng-dhcp113.eng.vmware.com>

Hi, Saima:

The following post describes some concrete example scenarios
in which you might want to use exchange-to-exchange bindings
in your messaging fabric:

http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

Best regards,
Jerry


----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 5, 2012 1:37:54 PM
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done




Hi, 


I want to understand how exchange is bounded to other exchange and why. The only reference I found for this. 
http://www.rabbitmq.com/extensions.html 



Can anyone help me to understand it in more detail. 

Saima Asif 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From santiagomonttco at gmail.com  Mon Mar  5 22:43:59 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Mon, 5 Mar 2012 19:43:59 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?=7CSpam=7C_=22COMO_ENFRENTAR_?=
	=?windows-1252?q?CON_=C9XITO_UN_JUICIO_LABORAL=22__EFECTOS=2C_CONT?=
	=?windows-1252?q?INGENCIAS_Y_RESGUARDOS_DE_LA_EMPRESA?=
Message-ID: <2bfabec4c2a593b5eb84601a001d527b@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/2936c5a0/attachment.htm>

From alistair at abayley.org  Mon Mar  5 22:36:22 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Tue, 6 Mar 2012 11:36:22 +1300
Subject: [rabbitmq-discuss] [help] [beginner] what are the semantics of
 channels? (was testing with pika)
Message-ID: <CAKYODbjnwtuCumC3i5pZASGOzUu8JmwACzwDU6ZyENYHM56gSg@mail.gmail.com>

On 29 February 2012 23:28, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> Pika (is this better posted to the pika mailing list?):
> Maybe?

Well, the pika mailing list looks a bit dead, so I was hoping I'd get
better mileage here. The pika FAQ recommends posting here.


>> 4. ?why doesn't basic_ack do what I expect?
> That sounds like somehow the ack is malformed somehow (wrong ack tag?) and

Turns out it was because I had enabled transactions on the channel,
and was not commiting the ack. My mistake.


> The server is not swallowing the message without responding; it's stopped
> accepting messages altogether, and will (eventually) send confirms for
> everything it's accepted. However, in this scenario you're presumably
> hammering the server with messages, and in that case there can be lots of
> messages waiting in the OS TCP buffers - RabbitMQ hasn't seen them at all.
>
> It's not clear what else RabbitMQ could do in this situation - for
> guaranteed delivery you need to treat the message as the producer's
> responsibility until you see the confirm or tx.commit-ok.

A nack or reject would be nice; then the client can decide to retry
later or discard. I can see that I should implement a timeout on the
client.

I've done some more testing with the server in this situation as best
I can; I've simulated it by setting the high-water-mark to 0. The test
creates two channels, and two queues:
 - in channel 1 we publish a message to queue 2, and then get from
queue 1 (queue 1 is always empty)
 - in channel 2 we get from queue 2

When the server has breached the high-water-mark, both gets wait
indefinitely for a response from the server. Is this what I should
expect? I was hoping that consumer channels would still be responsive,
but it looks like the entire connection is blocked.

Some other variations:
 - no publish i.e. all we do is get from empty queues: the server is responsive.
 - publish on channel 1 to queue 2, get in channel 2 from queue 2
(i.e. no get in channel 1, so channel 1 is pure producer, channel 2 is
pure consumer): hangs/waits after Basic.Get.
 - 3rd channel that gets from empty queue 3: hangs/waits after Basic.Get.
 - a separate connection that gets from queue 2 is ok; it receives a
Basic.GetEmpty.


Also, when the client shuts down, the channels are closed on the
client (channel close callback is invoked with code 200), but they
remain on the server, causing a resource leak. From tcpdump I can see
the client sending Channel.Close frames, but it does not get back
Channel.Close-Ok from the server, which is what happens in the normal
case (where the server is not throttling clients).

Alistair

From gmr at myyearbook.com  Mon Mar  5 22:41:44 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 5 Mar 2012 17:41:44 -0500
Subject: [rabbitmq-discuss] [help] [beginner] what are the semantics of
 channels? (was testing with pika)
In-Reply-To: <CAKYODbjnwtuCumC3i5pZASGOzUu8JmwACzwDU6ZyENYHM56gSg@mail.gmail.com>
References: <CAKYODbjnwtuCumC3i5pZASGOzUu8JmwACzwDU6ZyENYHM56gSg@mail.gmail.com>
Message-ID: <C05C91414829445B890BB0C21D907ACB@myyearbook.com>



On Monday, March 5, 2012 at 5:36 PM, Alistair Bayley wrote:

> On 29 February 2012 23:28, Simon MacMullen <simon at rabbitmq.com (mailto:simon at rabbitmq.com)> wrote:
> > > 
> > > Pika (is this better posted to the pika mailing list?):
> > Maybe?
> > 
> 
> 
> Well, the pika mailing list looks a bit dead, so I was hoping I'd get
> better mileage here. The pika FAQ recommends posting here.
> 
> 

No so much dead as just never gained any traction (as of yet). 

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/3c750c0f/attachment.htm>

From brian.newsgroup at gmail.com  Mon Mar  5 23:39:46 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Tue, 6 Mar 2012 10:39:46 +1100
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
	week
In-Reply-To: <4F549D3B.4050306@rabbitmq.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>
	<4F549D3B.4050306@rabbitmq.com>
Message-ID: <CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>

Hi Simon,


> Here is the error message:
>>
> <snip>
>
>>                      {'RSAPrivateKey','two-prime',
>>
> <snip>
>
> Huh. That doesn't look like a good thing to log. I think you should
> probably treat the private key from that machine as compromised, sorry :-(
>

Oops! Didn't notice this one. Thanks for pointing it out!



> Thanks for the pointer. So it looks like we may not be recovering well
> from an SSL connection dying post-establishment. I'll try to replicate this.


>
>
> The log message is being created by Erlang but I'll see if we can
> intercept it and strip that out...
>
> Cheers, Simon
>

Much appreciated, Simon! Hopefully you guys can get something out of it. In
the mean time, we are going to see if we still encounter the problem
without SSL encryption.

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/ab8ac213/attachment.htm>

From minaev at gmail.com  Tue Mar  6 06:51:22 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Tue, 6 Mar 2012 09:51:22 +0300
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
	<4EFDDC6E.8060200@rabbitmq.com>
	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
Message-ID: <CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>

Dear friends,

Finally, I can say that the attempt to solve the problem with the
modified tcp_acceptor has failed. For a couple of months Rabbit worked
well, even under moderate load (up to 8-9 million messages), but today
it has failed again with the same symptoms. Let me remind you of the
situation.

RabbitMQ v.2.7.1 working under Erlang R15B on Ubuntu Linux 10.04,
suddenly stops accepting AMQP connections. TCP connections are being
accepted, but no response follows. rabbitmqctl works.

The nonoperating RabbitMQ server is now at my disposable for autopsy.

-- 
With best regards,
Dmitri Minaev

From amathur.q at gmail.com  Tue Mar  6 07:03:31 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Tue, 6 Mar 2012 12:33:31 +0530
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+u4LE4moAzjnKR0aOzWzVd4v=PsUQp9bzq+McXGdqY8wjQZfQ@mail.gmail.com>

Hi,

Can anyone please tell me the steps to install RabbitMQ on Centos 6.2
machine.The steps given on the RabbitMQ webpage for installing on Centos6
machine aren't working for me.
Thanks,
Ashutosh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/f01620d1/attachment.htm>

From simon at rabbitmq.com  Tue Mar  6 10:42:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 10:42:48 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CA+u4LE4moAzjnKR0aOzWzVd4v=PsUQp9bzq+McXGdqY8wjQZfQ@mail.gmail.com>
References: <CA+u4LE4moAzjnKR0aOzWzVd4v=PsUQp9bzq+McXGdqY8wjQZfQ@mail.gmail.com>
Message-ID: <4F55EA28.6050409@rabbitmq.com>

On 06/03/12 07:03, Ashutosh Mathur wrote:
> Can anyone please tell me the steps to install RabbitMQ on Centos 6.2
> machine.The steps given on the RabbitMQ webpage for installing on
> Centos6 machine aren't working for me.

You'll have to tell us how it's not working...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar  6 11:01:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 11:01:10 +0000
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
 week
In-Reply-To: <CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>	<4F549D3B.4050306@rabbitmq.com>
	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>
Message-ID: <4F55EE76.2000206@rabbitmq.com>

On 05/03/12 23:39, Brian Jing wrote:
> In the mean time, we are going to see if we still encounter the problem
> without SSL encryption.

It's possible.

What's odd is that you are seeing ehostunreach after a connection has 
been up and running for some time, so I'd be curious to know if 
something is up with your network.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From schramm.ingo at googlemail.com  Tue Mar  6 11:22:01 2012
From: schramm.ingo at googlemail.com (ingo schramm)
Date: Tue, 6 Mar 2012 03:22:01 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up memory
Message-ID: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>

Hi,

I'm running a RabbitMQ cluster with 4 nodes - 2 disc, 2 ram - on two
machines with some thousands of clients connected. I use the system as
a job queue, having 1 queue on 1 of the ram nodes for delivering jobs
to workers (mirrored queue unfortunately doesn't perform that well)
and a number of queues distributed over all nodes for responses. Only
the ram nodes have clients connected.

All worked well for months now.

This night I encountered a very strange condition. Since I send a
number of metrics to Ganglia I have a reasonable good insight into
what happened when. I could see that *first* of all Rabbit started to
consume more and more RAM. A huge amount - until the limit was reached
- on the node with the delivering queue, some time later a smaller but
still visible amount on the other ram node. The traffic at that time
was not unusual and not higher than before. When the RAM limit was
reached, the whole system began to break down like in domino theory. I
really have no idea what could have triggered this condition. Some
little Erlang process not consuming its message queue correctly?? But
why does it work most of the time? All I can see in the logs is that,
finally:

=INFO REPORT==== 5-Mar-2012::19:00:08 ===
starting TCP connection <0.11787.218> from 46.231.180.114:40846

=INFO REPORT==== 5-Mar-2012::23:55:12 ===
vm_memory_high_watermark set. Memory used:15678711560 allowed:
13517966540

A usual RAM usage under load on that node is < 1GB. Average message
size is 1-2K.

All I can say is that at the time in question most clients were
consuming slowly, but this is a condition happening from time to time
without any problems. I cannot see something queueing up before Rabbit
started to eat memory, only afterwards, when all began to break down.
One thing I can see is a larger number of unacked messages (up to 2K)
rising in conjunction with the memory consumption. But this also
happened before without having a memory problem.

Do you have any hint what I can do to debug the problem?

Regards,
Ingo

From simon at rabbitmq.com  Tue Mar  6 11:25:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 11:25:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
	memory
In-Reply-To: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>
Message-ID: <4F55F42E.7080908@rabbitmq.com>

On 06/03/12 11:22, ingo schramm wrote:
> Do you have any hint what I can do to debug the problem?

There were known memory leaks in mirrored queues that were fixed in 
2.7.1, so the first thing I would suggest is to upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From schramm.ingo at googlemail.com  Tue Mar  6 11:38:54 2012
From: schramm.ingo at googlemail.com (ingo schramm)
Date: Tue, 6 Mar 2012 03:38:54 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
 memory
In-Reply-To: <4F55F42E.7080908@rabbitmq.com>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>
	<4F55F42E.7080908@rabbitmq.com>
Message-ID: <12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>

I do *not* use a mirrored queue :)

Am Dienstag, 6. M?rz 2012 12:25:34 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:22, ingo schramm wrote:
> > Do you have any hint what I can do to debug the problem?
>
> There were known memory leaks in mirrored queues that were fixed in 
> 2.7.1, so the first thing I would suggest is to upgrade.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/779bc601/attachment.htm>

From simon at rabbitmq.com  Tue Mar  6 11:44:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 11:44:58 +0000
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
 week
In-Reply-To: <4F55EE76.2000206@rabbitmq.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>	<4F549D3B.4050306@rabbitmq.com>	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>
	<4F55EE76.2000206@rabbitmq.com>
Message-ID: <4F55F8BA.2050303@rabbitmq.com>

On 06/03/12 11:01, Simon MacMullen wrote:
> What's odd is that you are seeing ehostunreach after a connection has
> been up and running for some time, so I'd be curious to know if
> something is up with your network.

So I couldn't replicate the ehostunreach problem in the obvious way 
(taking down networking with an active SSL connection). However, I could 
get rabbit to hang on shutdown after killing a running SSL process - but 
only when running on older Erlang (R13B0x) - which version are you using?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar  6 12:15:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 12:15:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
	memory
In-Reply-To: <12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>	<4F55F42E.7080908@rabbitmq.com>
	<12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>
Message-ID: <4F55FFED.7020605@rabbitmq.com>

On 06/03/12 11:38, ingo schramm wrote:
> I do *not* use a mirrored queue :)

Ah, right, that's how I read "queues distributed over all nodes".

Hmm. It's still easier to figure out the memory use of RabbitMQ on 
2.7.1, but for 2.6.1 you could check per-queue memory use with 
"rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
bring anything useful up then:

* Become the user the broker is running as
* Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
the running broker
* Invoke "erlang:memory()." for an overview of memory use in the VM.
* Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
lit of the top 10 memory using processes, and some information on each one.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From schramm.ingo at googlemail.com  Tue Mar  6 13:00:21 2012
From: schramm.ingo at googlemail.com (ingo schramm)
Date: Tue, 6 Mar 2012 05:00:21 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
 memory
In-Reply-To: <4F55FFED.7020605@rabbitmq.com>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>	<4F55F42E.7080908@rabbitmq.com>
	<12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>
	<4F55FFED.7020605@rabbitmq.com>
Message-ID: <100159.5226.1331038821917.JavaMail.geo-discussion-forums@ynjc20>

Thanks a lot, now I can figure out what consumes the memory when it happens 
the next time. Hopefully, I will never get the chance again. At that time, 
the management plugin was unreachable BTW. I recovered from the bad 
condition by restarting everything. It's a production system.

I will give 2.7.1 a chance as soon as possible. But if you have any idea 
what could have triggered this bad behavior I would appreciate a hint.

Regards, Ingo

Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/dbca9767/attachment.htm>

From abdullahsaima at yahoo.com  Tue Mar  6 13:14:26 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Tue, 6 Mar 2012 13:14:26 +0000 (GMT)
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its
	done
In-Reply-To: <da81d917-3fe4-4e20-af1c-797f0b21166f@csb-2-eng-dhcp113.eng.vmware.com>
References: <1330983474.73914.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<da81d917-3fe4-4e20-af1c-797f0b21166f@csb-2-eng-dhcp113.eng.vmware.com>
Message-ID: <1331039666.68834.YahooMailNeo@web29702.mail.ird.yahoo.com>

Thank you very much. Can I ask anothe question how a publisher in Rabbit MQ knows that this is the exchange I should send message to.
?
Best Regards,?
Saima Asif
 

________________________________
 From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, 5 March 2012, 22:21
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done
  
Hi, Saima:

The following post describes some concrete example scenarios
in which you might want to use exchange-to-exchange bindings
in your messaging fabric:

http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

Best regards,
Jerry


----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 5, 2012 1:37:54 PM
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done




Hi, 


I want to understand how exchange is bounded to other exchange and why. The only reference I found for this. 
http://www.rabbitmq.com/extensions.html 



Can anyone help me to understand it in more detail. 

Saima Asif 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/57b81817/attachment.htm>

From l.rossi.cons at vitrociset.it  Tue Mar  6 14:30:06 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Tue, 6 Mar 2012 14:30:06 +0000
Subject: [rabbitmq-discuss] Experimental RabbitMQ-C client - consumer
Message-ID: <5A0675B6BF3DB54EAF607B755455A0841734722F@XCH10MBX.vitrociset.int>

Dear Experts,
I would use RabbitMQ-C in my project, but I can't figure out how the consumer works. I built and installed the C library RabbitMQ-C, and took a look at the examples to see how the producer and consumer work. Even if the producer implementation is straightforward, I see that the consumer works in a really low-level fashion, I mean, in amqp_consumer.c, there are many passages using amqp_simple_wait_frame(), aimed at receveing the message fragments (I suppose). Do the library have some high-level consumer function, similar to the java nextDelivery() method in the Consumer class?  Moreover, do the library have some documentation?

Thanks in advance,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/d8f4d1ea/attachment.htm>

From l.rossi.cons at vitrociset.it  Tue Mar  6 14:43:50 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Tue, 6 Mar 2012 14:43:50 +0000
Subject: [rabbitmq-discuss] how to build SimpleAmqpClient?
Message-ID: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>

Dear Experts,
I'm trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008), but when I execute CMake, there are errors regarding boost:


CMake Error at C:/Program Files (x86)/CMake 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):

Unable to find the requested Boost libraries.

Boost version: 1.48.0

Boost include path: C:/Applicazioni/boost

The following Boost libraries could not be found:

boost_chrono

boost_system

No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the

directory containing Boost libraries or BOOST_ROOT to the location of

Boost.

Call Stack (most recent call first):

CMakeLists.txt:8 (FIND_PACKAGE)

I add manually the filepath for chrono and system to Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release, Boost_System_Library_Debug, Boost_ System_Library_Release, but still it doesn't find anything. I also create the BOOST_ROOT but still it doesn't work.
Any suggestion?

Best,

Lorenzo


Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/9e8b59a2/attachment.htm>

From jerryk at vmware.com  Tue Mar  6 16:14:01 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 6 Mar 2012 08:14:01 -0800 (PST)
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its
	done
In-Reply-To: <1331039666.68834.YahooMailNeo@web29702.mail.ird.yahoo.com>
Message-ID: <c9cb21e3-87c6-48eb-aad7-3e00122ea45f@csb-2-eng-dhcp113.eng.vmware.com>

Hi, Saima:

It really just depends on what your application is doing and how it's
structured.  A nice tutorial on messaging with some example scenarios
that will guide your thinking can be found in the book:

http://manning.com/videla/

Which is currently available in preview edition as an eBook, with the
print edition to follow shortly.

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 6, 2012 5:14:26 AM
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done



Thank you very much. Can I ask anothe question how a publisher in Rabbit MQ knows that this is the exchange I should send message to. 

Best Regards, 
Saima Asif 




From: Jerry Kuch <jerryk at vmware.com> 
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, 5 March 2012, 22:21 
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done 

Hi, Saima: 

The following post describes some concrete example scenarios 
in which you might want to use exchange-to-exchange bindings 
in your messaging fabric: 

http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/ 

Best regards, 
Jerry 


----- Original Message ----- 
From: "Saima Asif" < abdullahsaima at yahoo.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, March 5, 2012 1:37:54 PM 
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done 




Hi, 


I want to understand how exchange is bounded to other exchange and why. The only reference I found for this. 
http://www.rabbitmq.com/extensions.html 



Can anyone help me to understand it in more detail. 

Saima Asif 





_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 



From alan.antonuk at gmail.com  Tue Mar  6 16:23:11 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 6 Mar 2012 11:23:11 -0500
Subject: [rabbitmq-discuss] how to build SimpleAmqpClient?
In-Reply-To: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
Message-ID: <CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>

Did you build boost as a set of static libraries?  If so you'll need to set
the Boost_USE_STATIC_LIBS=ON CMake variable.

Another note: given you're building with VS2008 you're going to run into a
different problem once you get past the boost library issue you're having:
see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what the
issue is and a workaround.

-Alan

On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>wrote:

>  Dear Experts,****
>
> I?m trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008),
> but when I execute CMake, there are errors regarding boost:****
>
> ** **
>
> CMake Error at C:/Program Files (x86)/CMake
> 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):****
>
> Unable to find the requested Boost libraries.****
>
> Boost version: 1.48.0****
>
> Boost include path: C:/Applicazioni/boost****
>
> The following Boost libraries could not be found:****
>
> boost_chrono****
>
> boost_system****
>
> No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the
> ****
>
> directory containing Boost libraries or BOOST_ROOT to the location of****
>
> Boost.****
>
> Call Stack (most recent call first):****
>
> CMakeLists.txt:8 (FIND_PACKAGE)****
>
> ** **
>
> I add manually the filepath for chrono and system to
> Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release,
> Boost_System_Library_Debug, Boost_ System_Library_Release, but still it
> doesn?t find anything. I also create the BOOST_ROOT but still it doesn?t
> work.****
>
> Any suggestion?****
>
>
> Best,****
>
>
> Lorenzo****
>
> ** **
>
> ** **
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
> ** **
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/09800fff/attachment.htm>

From abdullahsaima at yahoo.com  Tue Mar  6 16:24:41 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Tue, 6 Mar 2012 16:24:41 +0000 (GMT)
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its
	done
In-Reply-To: <c9cb21e3-87c6-48eb-aad7-3e00122ea45f@csb-2-eng-dhcp113.eng.vmware.com>
References: <1331039666.68834.YahooMailNeo@web29702.mail.ird.yahoo.com>
	<c9cb21e3-87c6-48eb-aad7-3e00122ea45f@csb-2-eng-dhcp113.eng.vmware.com>
Message-ID: <1331051081.62152.YahooMailNeo@web29701.mail.ird.yahoo.com>

Thanks Jerry,
?
That's so nice of you. you always been helpful.

Saima Asif
 

________________________________
 From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, 6 March 2012, 16:14
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done
  
Hi, Saima:

It really just depends on what your application is doing and how it's
structured.? A nice tutorial on messaging with some example scenarios
that will guide your thinking can be found in the book:

http://manning.com/videla/

Which is currently available in preview edition as an eBook, with the
print edition to follow shortly.

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 6, 2012 5:14:26 AM
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done



Thank you very much. Can I ask anothe question how a publisher in Rabbit MQ knows that this is the exchange I should send message to. 

Best Regards, 
Saima Asif 




From: Jerry Kuch <jerryk at vmware.com> 
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, 5 March 2012, 22:21 
Subject: Re: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done 

Hi, Saima: 

The following post describes some concrete example scenarios 
in which you might want to use exchange-to-exchange bindings 
in your messaging fabric: 

http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/ 

Best regards, 
Jerry 


----- Original Message ----- 
From: "Saima Asif" < abdullahsaima at yahoo.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, March 5, 2012 1:37:54 PM 
Subject: [rabbitmq-discuss] Why Exchange to Exchange binding? How its done 




Hi, 


I want to understand how exchange is bounded to other exchange and why. The only reference I found for this. 
http://www.rabbitmq.com/extensions.html 



Can anyone help me to understand it in more detail. 

Saima Asif 





_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/c0e99f3e/attachment.htm>

From mspetrovic at gmail.com  Tue Mar  6 16:34:45 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 6 Mar 2012 08:34:45 -0800
Subject: [rabbitmq-discuss] What does Rabbit do with messages that have been
	delivered and ack'd
Message-ID: <CABMnSbH0VMZfyTLZQNsfsRj1_zUXwSjTPBnm_XV4_er2u4HKwg@mail.gmail.com>

I have an application that uses a topic exchange.  If I have N
consumers and each of those ack's the message when it is delivered to
them, Rabbit does not keep a  copy of that message beyond the last
consumer ack'ing it does it?

I ask because I want to know if there are exchange or queue
configurations that I may be inadvertently foisting on Rabbit brokers
that induce them to hold onto messages in its backing db that I
actually no longer care about.

Thanks much.

-- 
Mark

From alan.antonuk at gmail.com  Tue Mar  6 16:44:22 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 6 Mar 2012 11:44:22 -0500
Subject: [rabbitmq-discuss] Experimental RabbitMQ-C client - consumer
In-Reply-To: <5A0675B6BF3DB54EAF607B755455A0841734722F@XCH10MBX.vitrociset.int>
References: <5A0675B6BF3DB54EAF607B755455A0841734722F@XCH10MBX.vitrociset.int>
Message-ID: <CAAt2poKu0seK2Jn_tK3rxAjt-UUSmxO_Mp8R9KX3TVG1i7_yBQ@mail.gmail.com>

Currently we don't have a high-level consumer implementation as a part of
the API for the rabbitmq-c library.  This is something I hope to remedy in
the future.  For now I would recommend taking a look at one of the c++
wrappers out there (it looks like you've already found SimpleAmqpClient ).

Documentation is also (a high priority) thing on the todo list, that
doesn't already exist yet.  The best you can do right now is look at the
examples, and email the list if you have any specific questions.

-Alan

On Tue, Mar 6, 2012 at 9:30 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>wrote:

>  Dear Experts,****
>
> I would use RabbitMQ-C in my project, but I can?t figure out how the
> consumer works. I built and installed the C library RabbitMQ-C, and took a
> look at the examples to see how the producer and consumer work. Even if the
> producer implementation is straightforward, I see that the consumer works
> in a really low-level fashion, I mean, in amqp_consumer.c, there are many
> passages using amqp_simple_wait_frame(), aimed at receveing the message
> fragments (I suppose). Do the library have some high-level consumer
> function, similar to the java nextDelivery() method in the Consumer class?
>  Moreover, do the library have some documentation?****
>
> ** **
>
> Thanks in advance,****
>
> ** **
>
> Lorenzo ****
>
> ** **
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
> ** **
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/4a10d299/attachment.htm>

From jerryk at vmware.com  Tue Mar  6 16:44:42 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 6 Mar 2012 08:44:42 -0800 (PST)
Subject: [rabbitmq-discuss] What does Rabbit do with messages that have
	been	delivered and ack'd
In-Reply-To: <CABMnSbH0VMZfyTLZQNsfsRj1_zUXwSjTPBnm_XV4_er2u4HKwg@mail.gmail.com>
Message-ID: <220b1662-b9cc-4821-b81f-ec327c85db31@csb-2-eng-dhcp113.eng.vmware.com>

Hi, Mark:

The maintaining of messages is done at the queue end of the messaging pipeline,
not the exchange end.  Thus, if the message properties and bindings have
resulted in your message passing through the topic exchange into multiple
queues, then each of those queues will try to maintain the integrity of that
message, up to whatever guarantees you've asked for (e.g. persistence) until
it's been delivered to, and ACKed by (or delivered to a consumer who is in noAck
mode) somebody.

On any single given queue, the first consumer to consume and ACK a message 
from that queue tells Rabbit that it's free to forget about the message.  That 
same consumer, or another consumer on the same queue would only see the same
message again if the consumer either crashed before ACK-ing, or rejected the 
message, both of which would result in a re-queueing.

This is a good thing to ask about and be mindful of; a happy Rabbit is an empty
Rabbit, and application mis-designs (or failures of components at runtime) can
result in the broker hanging on to many messages that are either undelivered or
delivered but not properly ACKed, which over the long run leads to more work
for the broker, more consumption of RAM, eventually paging of messages to disk,
etc.  In production you'd always want to monitor to make sure there's not some
queue growing surprisingly long, since that's a sign that, at the very least
something has changed in your assumptions about the world, or that perhaps
you have a problem like slow or crashed consumers, a sudden upswing in producer
activity, etc.

Best regards,
Jerry

----- Original Message -----
From: "Mark Petrovic" <mspetrovic at gmail.com>
To: "Rabbit-Mq Discuss-Mailing List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, March 6, 2012 8:34:45 AM
Subject: [rabbitmq-discuss] What does Rabbit do with messages that have been	delivered and ack'd

I have an application that uses a topic exchange.  If I have N
consumers and each of those ack's the message when it is delivered to
them, Rabbit does not keep a  copy of that message beyond the last
consumer ack'ing it does it?

I ask because I want to know if there are exchange or queue
configurations that I may be inadvertently foisting on Rabbit brokers
that induce them to hold onto messages in its backing db that I
actually no longer care about.

Thanks much.

-- 
Mark
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From john at ibiblio.org  Tue Mar  6 16:48:48 2012
From: john at ibiblio.org (John Reuning)
Date: Tue, 6 Mar 2012 11:48:48 -0500
Subject: [rabbitmq-discuss] Lost message in 50k size range
Message-ID: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>

I'm using pika to send and receive bson-encoded binary data through
rabbitmq.  Pika 0.9.5, rabbitmq 2.7.1.  Everything works until the
message body goes over 49144 characters.  The message disappears into
the void at 49145 characters.  The content of the message doesn't seem
to matter, but I've not tested that extensively.  The encoding is set
to application/octet-stream.

Pika debug logging shows the message split into multiple frames and
sent to rabbitmq.  Trace logs don't show any activity.  Increasing
frame_max didn't help.  Does anyone have suggestions on how to debug
this or what might be going wrong?  I'd rather not resort to tcpdump.

Thanks,

-John

From simon at rabbitmq.com  Tue Mar  6 16:54:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Mar 2012 16:54:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>	<4EFDAA72.9090605@rabbitmq.com>	<4EFDC47D.7060204@rabbitmq.com>	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>	<4EFDDC6E.8060200@rabbitmq.com>	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>
Message-ID: <4F564161.5040601@rabbitmq.com>

On 06/03/12 06:51, Dmitri Minaev wrote:
> Dear friends,

Hi.

> Finally, I can say that the attempt to solve the problem with the
> modified tcp_acceptor has failed. For a couple of months Rabbit worked
> well, even under moderate load (up to 8-9 million messages), but today
> it has failed again with the same symptoms.

Damn.

Did any error along the lines of "failed to accept TCP connection..." 
appear in the logs?

> The nonoperating RabbitMQ server is now at my disposable for autopsy.

If I were able to look at this tomorrow that would be great.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From l.rossi.cons at vitrociset.it  Tue Mar  6 16:57:19 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Tue, 6 Mar 2012 16:57:19 +0000
Subject: [rabbitmq-discuss] R:  Experimental RabbitMQ-C client - consumer
In-Reply-To: <CAAt2poKu0seK2Jn_tK3rxAjt-UUSmxO_Mp8R9KX3TVG1i7_yBQ@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A0841734722F@XCH10MBX.vitrociset.int>
	<CAAt2poKu0seK2Jn_tK3rxAjt-UUSmxO_Mp8R9KX3TVG1i7_yBQ@mail.gmail.com>
Message-ID: <5A0675B6BF3DB54EAF607B755455A0841734756F@XCH10MBX.vitrociset.int>

Many thanks for the replies. I was also able to successfully compile SimpleAmgpClient!

Best,
Lorenzo

Lorenzo Rossi

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com]
Inviato: marted? 6 marzo 2012 17:44
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Oggetto: Re: [rabbitmq-discuss] Experimental RabbitMQ-C client - consumer

Currently we don't have a high-level consumer implementation as a part of the API for the rabbitmq-c library.  This is something I hope to remedy in the future.  For now I would recommend taking a look at one of the c++ wrappers out there (it looks like you've already found SimpleAmqpClient ).

Documentation is also (a high priority) thing on the todo list, that doesn't already exist yet.  The best you can do right now is look at the examples, and email the list if you have any specific questions.

-Alan
On Tue, Mar 6, 2012 at 9:30 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear Experts,
I would use RabbitMQ-C in my project, but I can't figure out how the consumer works. I built and installed the C library RabbitMQ-C, and took a look at the examples to see how the producer and consumer work. Even if the producer implementation is straightforward, I see that the consumer works in a really low-level fashion, I mean, in amqp_consumer.c, there are many passages using amqp_simple_wait_frame(), aimed at receveing the message fragments (I suppose). Do the library have some high-level consumer function, similar to the java nextDelivery() method in the Consumer class?  Moreover, do the library have some documentation?

Thanks in advance,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/05b560cc/attachment.htm>

From alexis at rabbitmq.com  Tue Mar  6 16:57:27 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 6 Mar 2012 16:57:27 +0000
Subject: [rabbitmq-discuss] Using Rabbit with Excel
In-Reply-To: <CACOPnvfDSc7yaZX-knCiJ0vZnDS7jeF5FFHhtJrE0akVD3NhRQ@mail.gmail.com>
References: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>
	<427D08915E484DC1A947D6225746DBEE@myyearbook.com>
	<CACOPnvfDSc7yaZX-knCiJ0vZnDS7jeF5FFHhtJrE0akVD3NhRQ@mail.gmail.com>
Message-ID: <CACOPnvdiSNdVt6ggJ-CJnm1crq+E8JM1DMB3Jg_Z+DQiYn-i_g@mail.gmail.com>

I believe this is now being resolved.  Bear with us.


On Mon, Mar 5, 2012 at 3:49 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Yes, it may have been published on a site that only some of us can access.
>
> Let me try to find out....
>
>
> On Mon, Mar 5, 2012 at 3:26 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>> Not seeing DNS resolution for that host, is it internal only?
>>
>> gmr-0x04:~ gmr$ dig -t A git.springsource.com
>>
>> ; <<>> DiG 9.7.3-P3 <<>> -t A git.springsource.com
>> ;; global options: +cmd
>> ;; Got answer:
>> ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 55216
>> ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0
>>
>> ;; QUESTION SECTION:
>> ;git.springsource.com. IN A
>>
>> ;; AUTHORITY SECTION:
>> springsource.com. 3577 IN SOA sc9-ext-dns-1.vmware.com.
>> hostmaster.vmware.com. 2012030101 10800 1800 3600000 3600
>>
>> On Monday, March 5, 2012 at 9:23 AM, Alexis Richardson wrote:
>>
>> Hi
>>
>> One of our colleagues at VMware has created this, which may be of
>> interest to the community:
>>
>> https://git.springsource.com/hikyaku
>>
>> alexis
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>

From steve at rabbitmq.com  Tue Mar  6 17:22:07 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 6 Mar 2012 17:22:07 +0000
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
	than amq.topic?
In-Reply-To: <20268292.993.1330969521998.JavaMail.geo-discussion-forums@ynll40>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
	<5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
	<c28ec65f-c0c8-4a72-adfa-01ce481d783c@s13g2000yqe.googlegroups.com>
	<EB55BA1E-2831-44C3-8AA7-31A386E42F24@rabbitmq.com>
	<20268292.993.1330969521998.JavaMail.geo-discussion-forums@ynll40>
Message-ID: <B8F4BED9-FE5F-4FB5-88B3-D89CD92AF83E@rabbitmq.com>

Cliff,

Thanks for clarifying your requirements.

Use of an explicit exchange/routing-key on your Producers and Consumers would
seem to solve the problem except for the fact that you want them to be Server
agnostic; i.e. to work on ActiveMQ as well; without modification. (There should
be no need to pre-allocate queues.)

Your configuration setting suggestion sounds reasonable; though it is rather a
coarse control and open to abuse -- if the 'redefined' exchange has different
properties the STOMP protocol might not work as expected.

The federation of existing exchanges looks a better bet to me. I'll talk to
others about this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 5 Mar 2012, at 17:45, Cliff Redmond wrote:

> Hi Steve,
> 
> sorry for the delay in my reply: my posts were blocked.
> 
> We were attempting to replace an installation of ActiveMQ with RabbitMQ, with minimal (read: no) producer and consumer code changes.
> 
> Producers and consumers used Stomp, and subscribed to topics using destinations beginning with 'topic':
> 
> /topic/<topicname>
> 
> Your suggestion, to use an explicit exchange name in these destinations, would seem like introducing a RabbitMQ dependency.
> 
> The Stomp plugin interprets subscriptions to topic destinations quite sensibly as far as it goes, but choosing to route via the default topic exchange (amq.topic) prevented us from replicating queues between data centers using the Federation plugin (which doesn't seem to be able to federate inbuilt exchanges). We eventually got it working using Shovel, though.
> 
> As I suggested before, there are two possible solutions here:
> - be able to specify a topic exchange in the Stomp plugin config (i.e. rather than have it always use amq.topic),
> - be able to federate internal/predefined exchanges in the Federation plugin.
> 
> I'd say the former would be easier to implement - perhaps you could talk to your colleagues working on the Stomp plugin?
> 
> Regards and thanks,
> 
> Cliff.
> 
> On Monday, 5 March 2012 16:22:05 UTC, Steve Powell wrote:
> Cliff,
> Did you see my previous answer:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018456.html
> ?
> 
> Please get back to me if this isn't what you want.
> 
> Steve Powell  (a hopeful bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 24 Feb 2012, at 12:43, Cliff Redmond wrote:
> 
> > Hi Steve,
> > 
> > thanks for your answer.
> > 
> > I was facing the exact same problem as Ken: I think your solution only
> > partially addresses the issue - requiring a subscription to a pre-
> > existing queue significantly reduces the flexibility of Stomp/
> > RabbitMQ.
> > 
> > One of the most useful features of the Stomp plugin is that when a
> > Stomp consumer subscribes to a topic, it automatically creates a new
> > queue (with a lifecycle dictated by the subscription) and binds it to
> > the default topic exchange on that broker.
> > 
> > e.g. invoking the following in a consumer:
> > 
> > $frame = Net::Stomp::Frame->new( {
> >      command => "SUBSCRIBE",
> >      headers => {
> >          destination => "/topic/durable-topic-prefetch",
> >          id => $subscriberId,
> >          persistent => "true",
> >          ack => "client",
> >          prefetch_count => 1,
> >      },
> > });
> > 
> > $stomp->send_frame($frame);
> > 
> > will create a queue on the relevant broker:
> > 
> > sh-3.2# rabbitmqctl list_queues
> > Listing queues ...
> > [...]
> > stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?U        0
> > [...]
> > ...done.
> > 
> > and bind it to the default topic exchange:
> > 
> > Listing bindings ...
> > [...]
> > amq.topic        exchange        stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?
> > U        queue        durable-topic-prefetch        []
> > [...]
> > ...done.
> > 
> > Pre-configuring AMQ queues is considerably less flexible, and the
> > alternative, creating a queue (and binding it to an alternatively
> > named federated topic exchange) using AMQP before each Stomp
> > subscription, militates against using Stomp at all.
> > 
> > Would it be possible to make a change to either of the Stomp or
> > Federation plugins:
> > 
> > - be able to specify a topic exchange in the Stomp plugin config (i.e.
> > rather than have it always use amq.topic),
> > - be able to federate internal/predefined exchanges in the Federation
> > plugin.
> > 
> > (I used the Shovel plugin to workaround this issue).
> > 
> > Many thanks,
> > 
> > Cliff.
> > 
> > On Feb 21, 6:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
> >> Hi Ken,
> >> 
> >> It is possible for you to SEND to the exchange of your choice from aSTOMP
> >> application, using a destination of the form: /exchange/<name>/<pattern> (seehttp://www.rabbitmq.com/stomp.html#d.ed) and there is no reason why this
> >> shouldn't be a topic exchange of your own making.
> >> 
> >> If you need to SUBSCRIBE to AMQP destinations you can use the destination
> >> /amq/queue/<name> (but the queue must exist).
> >> 
> >> Between them, these should allow you to useSTOMPwith federated exchanges
> >> without plugin modifications.
> >> 
> >> Let us know how you get on.
> >> 
> >> Steve Powell  (a federated bunny)
> >> ----------some more definitions from the SPD----------
> >> vermin (v.) Treating the dachshund for roundworm.
> >> chinchilla (n.) Cooling device for the lower jaw.
> >> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> >> 
> >> On 20 Feb 2012, at 16:19, Ken Simon wrote:
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >>> Greetings,
> >> 
> >>> I'm trying to getfederationworking (via the rabbitmq_federation
> >>> plugin) in our environment ofSTOMPhosts, and to do so I have to
> >>> enablefederationin theSTOMPplugin's exchange: amq.topic.  This
> >>> unfortunately doesn't seem to work because amq.* exchanges are
> >>> reserved and cannot be re-declared.
> >> 
> >>> My solution at this point has been to edit the source of theSTOMP
> >>> plugin and point it at an exchange called "stomp_topic" (which I made
> >>> up, but could be anything) instead of the default amq.topic.  Then I
> >>> just configure thefederationplugin to work with that exchange and it
> >>> works fine.
> >> 
> >>> My question is, is there a better way of doing this?  I hate
> >>> maintaining my own downstream changes to plugins if I don't have to.
> >>> The docs say that theSTOMPplugin routes all messages through
> >>> amq.topic, so it appears that's not configurable.  But wouldn't it
> >>> make sense to allow use of an exchange that's not reserved?  Or am I
> >>> missing something, and this is actually way easier?  I'm having
> >>> trouble finding any documented cases of people using bothSTOMPand
> >>> federation.
> >> 
> >>> Thanks,
> >> 
> >>> --
> >>> Ken
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> 
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gmr at myyearbook.com  Tue Mar  6 17:24:19 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 6 Mar 2012 12:24:19 -0500
Subject: [rabbitmq-discuss] Lost message in 50k size range
In-Reply-To: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>
References: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>
Message-ID: <3CFC0A3F6AC54565AC2438C4D67B28CC@myyearbook.com>

I regularly send much larger messages.  How are you determining the message is lost? 

Have you tried setting up a stand-alone queue with no consumers and publishing the messages to it?  And are you using the management plugin? The UI is a good way to inspect that kind of stuff. 


On Tuesday, March 6, 2012 at 11:48 AM, John Reuning wrote:

> I'm using pika to send and receive bson-encoded binary data through
> rabbitmq. Pika 0.9.5, rabbitmq 2.7.1. Everything works until the
> message body goes over 49144 characters. The message disappears into
> the void at 49145 characters. The content of the message doesn't seem
> to matter, but I've not tested that extensively. The encoding is set
> to application/octet-stream.
> 
> Pika debug logging shows the message split into multiple frames and
> sent to rabbitmq. Trace logs don't show any activity. Increasing
> frame_max didn't help. Does anyone have suggestions on how to debug
> this or what might be going wrong? I'd rather not resort to tcpdump.
> 
> Thanks,
> 
> -John
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120306/a0150e26/attachment.htm>

From john at ibiblio.org  Tue Mar  6 18:13:42 2012
From: john at ibiblio.org (John Reuning)
Date: Tue, 6 Mar 2012 13:13:42 -0500
Subject: [rabbitmq-discuss] Lost message in 50k size range
In-Reply-To: <3CFC0A3F6AC54565AC2438C4D67B28CC@myyearbook.com>
References: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>
	<3CFC0A3F6AC54565AC2438C4D67B28CC@myyearbook.com>
Message-ID: <CACDr4ic9P2Up-Jw3Wrm6Yyynj0hxoRg=_LFPQhVkELn=dX6z_Q@mail.gmail.com>

In this case, lost means the consumer never gets it.  I have a test
setup for debugging.  Both publisher and consumer are python/pika.
The publisher sends 2 messages -- one is a bson encoded python string
of length 49144, the other is 49145.  The consumer gets the first
message but not the second.  It's the same behavior for messages down
to 1 byte and up to a few 100 KB.  The failure point seems to be at
this 49145 length.

Other useful information may be that queue durability and message
delivery mode settings don't affect the behavior.  Also, your
suggestion of publishing to a consumerless queue didn't result in a
queued message, as far as I can tell.

I'm using the management and tracing plugins, turned on tracing, and
turned on pika debug logging.  I can't find any errors or indication
of why the message disappears or where it's going.  I'm not sure I
know the right places to look, though.

Thanks,

-John

On Tue, Mar 6, 2012 at 12:24 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> I regularly send much larger messages. ?How are you determining the message
> is lost?
>
> Have you tried setting up a stand-alone queue with no consumers and
> publishing the messages to it? ?And are you using the management plugin? The
> UI is a good way to inspect that kind of stuff.
>
> On Tuesday, March 6, 2012 at 11:48 AM, John Reuning wrote:
>
> I'm using pika to send and receive bson-encoded binary data through
> rabbitmq. Pika 0.9.5, rabbitmq 2.7.1. Everything works until the
> message body goes over 49144 characters. The message disappears into
> the void at 49145 characters. The content of the message doesn't seem
> to matter, but I've not tested that extensively. The encoding is set
> to application/octet-stream.
>
> Pika debug logging shows the message split into multiple frames and
> sent to rabbitmq. Trace logs don't show any activity. Increasing
> frame_max didn't help. Does anyone have suggestions on how to debug
> this or what might be going wrong? I'd rather not resort to tcpdump.
>
> Thanks,
>
> -John
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From brian.newsgroup at gmail.com  Tue Mar  6 22:57:01 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 7 Mar 2012 09:57:01 +1100
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
	week
In-Reply-To: <4F55F8BA.2050303@rabbitmq.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>
	<4F549D3B.4050306@rabbitmq.com>
	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>
	<4F55EE76.2000206@rabbitmq.com> <4F55F8BA.2050303@rabbitmq.com>
Message-ID: <CALD4NQb0GPhT7DOnOUgPAoU3eVdgHPiSDnanm5K2xcoPR6G_=w@mail.gmail.com>

Hi Simon,

We are using Erlang R14B04 on these servers.

Our network is usually saturated by RabbitMQ traffic, probably partly
because we don't have enough bandwidth, and partly because we've been using
federation the wrong way (using same exchange for both up and downstream
transfer). Not sure whether this could contribute to the issue. However,
even if something bad happens with the network, isn't rabbit supposed to
recover itself no matter what?

Thanks,

Brian

On Tue, Mar 6, 2012 at 10:44 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/03/12 11:01, Simon MacMullen wrote:
>
>> What's odd is that you are seeing ehostunreach after a connection has
>> been up and running for some time, so I'd be curious to know if
>> something is up with your network.
>>
>
> So I couldn't replicate the ehostunreach problem in the obvious way
> (taking down networking with an active SSL connection). However, I could
> get rabbit to hang on shutdown after killing a running SSL process - but
> only when running on older Erlang (R13B0x) - which version are you using?
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/60a1df4c/attachment.htm>

From minaev at gmail.com  Wed Mar  7 08:57:19 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Wed, 7 Mar 2012 11:57:19 +0300
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4F564161.5040601@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
	<4EFDDC6E.8060200@rabbitmq.com>
	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>
	<4F564161.5040601@rabbitmq.com>
Message-ID: <CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>

Yes, there's quite a lot of those 'failed to accept' messages.
Actually, this is the second time when Rabbit stops since installation
of that tcp_acceptor patch, and every time those messages appear in
large number.


On 6 March 2012 20:54, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 06/03/12 06:51, Dmitri Minaev wrote:
>>
>> Dear friends,
>
>
> Hi.
>
>
>> Finally, I can say that the attempt to solve the problem with the
>> modified tcp_acceptor has failed. For a couple of months Rabbit worked
>> well, even under moderate load (up to 8-9 million messages), but today
>> it has failed again with the same symptoms.
>
>
> Damn.
>
> Did any error along the lines of "failed to accept TCP connection..." appear
> in the logs?
>
>
>> The nonoperating RabbitMQ server is now at my disposable for autopsy.
>
>
> If I were able to look at this tomorrow that would be great.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
With best regards,
Dmitri Minaev

From lowlifi at gmail.com  Mon Mar  5 20:07:56 2012
From: lowlifi at gmail.com (E Raymond)
Date: Mon, 5 Mar 2012 12:07:56 -0800 (PST)
Subject: [rabbitmq-discuss] MCollective + RabbitMQ + LDAP authentication
	issues
In-Reply-To: <4F54EA14.2090409@rabbitmq.com>
References: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>
	<4F54EA14.2090409@rabbitmq.com>
Message-ID: <6bd29fb5-5eaa-4971-95e5-6fd0a2591a25@sv8g2000pbc.googlegroups.com>

Hi Simon,

Thanks for the help! I realize the problem now, and wonder if there is
an in between solution to this?

I only want to authenticate the user through LDAP. I feel adding
vhosts to OU's seems like a bulky solution, and would prefer to allow
specific authenticated users to have to access to a specified vhost,
and allow the resources to dictate what privileges they have.

Is this possible?


On Mar 5, 8:30?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 02/03/12 21:48, E Raymond wrote:
>
>
>
>
>
>
>
>
>
> > =INFO REPORT==== 2-Mar-2012::21:29:37 ===
> > LDAP backend: search request = {'SearchRequest',
>
> > "ou=/,ou=employees,ou=people,dc=example,dc=net",
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? baseObject,neverDerefAliases,
> > 0,0,false,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {present,"objectClass"},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? []}
>
> > =INFO REPORT==== 2-Mar-2012::21:29:37 ===
> > LDAP backend: search reply = {ok,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{'LDAPMessage',1,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {searchResDone,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{'LDAPResult',noSuchObject,
>
> > "ou=employees,ou=people,dc=example,dc=net",
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],asn1_NOVALUE}},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? asn1_NOVALUE}}
>
> > =ERROR REPORT==== 2-Mar-2012::21:29:37 ===
> > STOMP error frame sent:
> > Message: "Bad CONNECT"
> > Detail: "Authentication failure\n"
> > Server private detail: none
>
> The request / response immediately before the authentication failure
> shows the LDAP plugin looking up the object
>
> "ou=/,ou=employees,ou=people,dc=example,dc=net"
>
> and getting
>
> noSuchObject
>
> in response.
>
> Does that object actually exist?
>
> Do you actually want to have:
> ? ?{vhost_access_query,
> ? ? ?{exists, "ou=${vhost},ou=employees,ou=people,dc=example,dc=net"}},
>
> in your config?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matt.wolf74 at gmail.com  Tue Mar  6 05:11:09 2012
From: matt.wolf74 at gmail.com (Matt)
Date: Mon, 5 Mar 2012 21:11:09 -0800 (PST)
Subject: [rabbitmq-discuss] Transfer rate improvement above 45mb/second?
In-Reply-To: <4F54EBA5.8000105@rabbitmq.com>
References: <aa29c113-a9f5-47a7-9792-280a51f79902@v2g2000pbo.googlegroups.com>
	<4F54EBA5.8000105@rabbitmq.com>
Message-ID: <29550384.2856.1331010669378.JavaMail.geo-discussion-forums@pbctp6>

Thats sounds very unsatisfactory simply because I am not sure it addresses 
the real problem and makes me wonder  how efficient/inefficient the AMQP 
parser really is. If I send large byte arrays what needs to be parsed? My 
understanding is that each message gets parsed to AMQP but not the content 
of the message body. So, I fail to understand how parsing makes a 
difference whether I send a byte array of size 10 bytes versus a message 
that contains a body that holds a 10 megabyte byte array. I do not see why 
the bus limits me to 45mb/second. My binary reader moves about 
200mb/second, reading from a physical storage into memory, including the 
parsing of the byte arrays to C# objects, thus the raw speed should be even 
a lot higher. There must be something else going on that limits RabbitMQ to 
go beyond the 45mb/second. The order of messages is important thus I cannot 
run more channels in parallel. Can anyone please chime in so I understand 
what I am overlooking here? Thanks a lot.


On Tuesday, March 6, 2012 1:36:53 AM UTC+9, Simon MacMullen wrote:
>
> I suspect you're probably limited by the speed of the AMQP parser in 
> this case. Unfortunately the only thing you can really do to make it run 
> faster is turn on HiPE compilation or buy a a faster machine. And HiPE 
> compilation only works on Unix I'm afraid.
>
> If you can afford to lose ordering guarantees you could push the 
> messages through more than one connection / queue, and thus take 
> advantage of more cores.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/85d1909c/attachment.htm>

From happy.ap at gmail.com  Wed Mar  7 13:50:44 2012
From: happy.ap at gmail.com (Anand Patel)
Date: Wed, 7 Mar 2012 19:20:44 +0530
Subject: [rabbitmq-discuss] Does RabbitMQ has the Message Grouping feature?
Message-ID: <002a01ccfc69$4db98030$e92c8090$@gmail.com>

Hi,

 

                Does RabbitMQ supports the Message Grouping feature similar
to the one that is available in HornetQ or ActiveMQ? 

 

Message groups are sets of messages that have the following characteristics:

.         Messages in a message group share the same group id, i.e. they
have same group identifier property (JMSXGroupID for JMS, _HQ_GROUP_ID for
HornetQ Core API).

.         Messages in a message group are always consumed by the same
consumer, even if there are many consumers on a queue. They pin all messages
with the same group id to the same consumer. If that consumer closes another
consumer is chosen and will receive all messages with the same group id.

 

Message groups are useful when you want all messages for a certain value of
the property to be processed serially by the same consumer. An example might
be orders for a certain stock. You may want orders for any particular stock
to be processed serially by the same consumer. To do this you can create a
pool of consumers (perhaps one for each stock, but less will work too), then
set the stock name as the value of the _HQ_GROUP_ID property.

 

With best regards,

Anand

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/5dbadd7c/attachment.htm>

From gregory.sainson at gmail.com  Wed Mar  7 13:52:20 2012
From: gregory.sainson at gmail.com (Greg)
Date: Wed, 7 Mar 2012 05:52:20 -0800 (PST)
Subject: [rabbitmq-discuss] basic.Get and basic.Consume on the same queue
Message-ID: <17240268.3836.1331128340437.JavaMail.geo-discussion-forums@vbtv42>

Hi,

I can't find any info on the web about it.

I currently have different programs that consumes the same queue.
One program is registered to the queue with a basic.Consume.
The other one is receiving messages with basic.Get. Unfortunately, It 
doesn't get any messages, basic.Get always returns null, like the queue is 
empty.
If I change it with a basic.Consume, it works fine. I'm using the Java 
client of RabbitMQ.

Anyone has any idea with this happens?

Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/8a972dce/attachment.htm>

From majek04 at gmail.com  Wed Mar  7 14:03:48 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 7 Mar 2012 14:03:48 +0000
Subject: [rabbitmq-discuss]  basic.Get and basic.Consume on the same queue
In-Reply-To: <CABzX+qyXUBDanaRmH75KCOZvj5+M5XKtwDe1ZoxefcAr5GWO4g@mail.gmail.com>
References: <17240268.3836.1331128340437.JavaMail.geo-discussion-forums@vbtv42>
	<CABzX+qyXUBDanaRmH75KCOZvj5+M5XKtwDe1ZoxefcAr5GWO4g@mail.gmail.com>
Message-ID: <CABzX+qwx8CXrs_+RbapZrCQys1Uo4mtLXaay9EVrs5WRy2g=pw@mail.gmail.com>

On Wed, Mar 7, 2012 at 13:52, Greg <gregory.sainson at gmail.com> wrote:
> Hi,
>
> I can't find any info on the web about it.
>
> I currently have different programs that consumes the same queue.
> One program is registered to the queue with a basic.Consume.
> The other one is receiving messages with basic.Get. Unfortunately, It
> doesn't get any messages, basic.Get always returns null, like the queue is
> empty.
> If I change it with a basic.Consume, it works fine. I'm using the Java
> client of RabbitMQ.
>
> Anyone has any idea with this happens?

If you're using Basic.Consume without setting Basic.QOS, Rabbit
sends a bulk of messages to the consumer. (in hundreds of messages).

Assuming the consumer uses Acks, the messages are then slowly
marked as Acknowledged and deleted.

But in the meantime all the messages were already sent to the
BasicConsume client - thus Basic.Get will find that there
aren't any messages ready!

The solution is to configure prefetch count using Basic.Qos
and also you must use Acknowledgments. (Basic.Qos without
acks makes no sense).

When you change second consumer to use BasicConsume,
it will hang and wait for mesages. Rabbit than sees:
okay, there are two consumes waiting on that queue.
When a new message arrives Rabbit will make a decision
where to send the message. It will try to do something
like round-robin. Thus - your second consumer will
receive some messages (every second one in a perfect
world).

Hope that helps,
?Marek

From schramm.ingo at googlemail.com  Wed Mar  7 14:26:58 2012
From: schramm.ingo at googlemail.com (ingo schramm)
Date: Wed, 7 Mar 2012 06:26:58 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
 memory
In-Reply-To: <4F55FFED.7020605@rabbitmq.com>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>	<4F55F42E.7080908@rabbitmq.com>
	<12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>
	<4F55FFED.7020605@rabbitmq.com>
Message-ID: <17283313.77.1331130418405.JavaMail.geo-discussion-forums@ynhs12>

Today it happened again. When Rabbit had about 13G RAM usage on one node 
(<1G is the usual number), I connected to the node and got some infos. I 
post these below. Unfortunately, I cannot see that much in the data since I 
do not know what the processes are doing exactly inside Rabbit.

After a while the system seemed to recover but irritated clients started to 
connect in an unusual pattern and then - almost immediately - the RAM usage 
executed a Big Bang, up to 55G allocated, the machine began to swap ...

Here is the dump of the 10 most memory consuming processes.

(ram2 at tarazed)4> erlang:memory().
[{total,14709955672},
 {processes,9701451024},
 {processes_used,9685449080},
 {system,5008504648},
 {atom,1318801},
 {atom_used,1286285},
 {binary,4901053992},
 {code,15227889},
 {ets,23180616}]

[{{memory,1868315056},
  <0.21462.60>,
  [{current_function,{erl_eval,do_apply,5}},
   {initial_call,{erlang,apply,2}},
   {status,running},
   {message_queue_len,0},
   {messages,[]},
   {links,[<0.21461.60>]},
   {dictionary,[]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<18922.32.0>},
   {total_heap_size,233539280},
   {heap_size,116769640},
   {stack_size,88},
   {reductions,8019756},
   {garbage_collection,[{fullsweep_after,65535},{minor_gcs,1}]},
   {suspending,[]}]},
 {{memory,1826853040},
  <0.252.0>,
  [{current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,3},
   {messages,[{'$gen_cast',{notify_sent,<0.26233.60>}},
              {'$gen_cast',{ack,[128755027],<0.22877.60>}},
              {'$gen_cast',{unblock,<0.22877.60>}}]},
   {links,[#Port<0.162932>,<0.250.0>,#Port<0.4466>]},
   {dictionary,[{{ch,<0.30314.59>},
                 {cr,1,<0.30314.59>,
                     {token,<0.30313.59>,true},
                     #Ref<0.0.913.261747>,
                     {set,1,16,16,8,80,...},
                     true,1}},
                {{ch,<0.11679.60>},
                 {cr,1,<0.11679.60>,
                     {token,<0.11678.60>,true},
                     #Ref<0.0.916.161564>,
                     {set,1,16,16,8,...},
                     true,0}},
                {{ch,<0.29890.59>},
                 {cr,1,<0.29890.59>,
                     {token,<0.29889.59>,true},
                     #Ref<0.0.913.256520>,
                     {set,1,16,16,...},
                     true,1}},
                {{ch,<0.24130.59>},
                 {cr,1,<0.24130.59>,
                     {token,<0.24129.59>,true},
                     #Ref<0.0.912.149255>,
                     {set,1,16,...},
                     true,1}},
                {{ch,<0.21656.59>},
                 {cr,1,<0.21656.59>,
                     {token,<0.21655.59>,true},
                     #Ref<0.0.911.188523>,
                     {set,1,...},
                     true,1}},
                {{ch,<0.15601.60>},
                 {cr,1,<0.15601.60>,
                     {token,<0.15600.60>,true},
                     #Ref<0.0.917.100808>,
                     {set,...},
                     true,...}},
                {{ch,<15215.21015.63>},
                 {cr,1,<15215.21015.63>,
                     {token,<15215.21014.63>,...},
                     #Ref<0.0.815.242631>,{...},...}},
                {{ch,<0.21015.12>},
                 {cr,1,<0.21015.12>,{token,...},#Ref<0.0.295.125075>,...}},
                {{ch,<0.17432.59>},{cr,1,<0.17432.59>,{...},...}},
                {{ch,<0.9598.46>},{cr,1,<0.9598.46>,...}},
                {{ch,<15215.20479.63>},{cr,1,...}},
                {{ch,<0.24362.59>},{cr,...}},
                {{ch,...},{...}},
                {{...},...},
                {...}|...]},
   {trap_exit,true},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,228065700},
   {heap_size,228065700},
   {stack_size,48},
   {reductions,86360443586},
   {garbage_collection,[{fullsweep_after,65535},{minor_gcs,0}]},
   {suspending,[]}]},
 {{memory,544009512},
  <0.218.0>,
  [{registered_name,delegate_11},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,45210},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,67810415},
   {heap_size,8024355},
   {stack_size,32},
   {reductions,536435169},
   {garbage_collection,[{fullsweep_after,65535},{minor_gcs,1}]},
   {suspending,[]}]},
 {{memory,544003272},
  <0.213.0>,
  [{registered_name,delegate_6},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,45000},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_call',{<15215.4753.67>,
                            {#Ref<15215.0.573.141891>,ram2 at tarazed}},
                           
{invoke,#Fun<rabbit_amqqueue.22.114209891>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,67810415},
   {heap_size,8024355},
   {stack_size,32},
   {reductions,492300563},
   {garbage_collection,[{fullsweep_after,65535},
                        {minor_gcs,...}]},
   {suspending,[]}]},
 {{memory,543937016},
  <0.220.0>,
  [{registered_name,delegate_13},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,43117},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,67810415},
   {heap_size,8024355},
   {stack_size,32},
   {reductions,516829717},
   {garbage_collection,[{fullsweep_after,...},{...}]},
   {suspending,[]}]},
 {{memory,509272344},
  <0.208.0>,
  [{registered_name,delegate_1},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,36921},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_amqqueue.23.2473037>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,63501410},
   {heap_size,15672560},
   {stack_size,32},
   {reductions,481258527},
   {garbage_collection,[{...}|...]},
   {suspending,[]}]},
 {{memory,484092056},
  <0.209.0>,
  [{registered_name,delegate_2},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,33987},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,60366900},
   {heap_size,12538050},
   {stack_size,32},
   {reductions,439896730},
   {garbage_collection,[...]},
   {suspending,...}]},
 {{memory,383857832},
  <0.207.0>,
  [{registered_name,delegate_0},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,36015},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[<0.252.0>]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,47828850},
   {heap_size,47828850},
   {stack_size,32},
   {reductions,464166560},
   {garbage_collection,...},
   {...}]},
 {{memory,322186712},
  <0.214.0>,
  [{registered_name,delegate_7},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,25955},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,[...]}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,7}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,40160935},
   {heap_size,15672560},
   {stack_size,32},
   {reductions,...},
   {...}|...]},
 {{memory,245833600},
  <0.212.0>,
  [{registered_name,delegate_5},
   {current_function,{gen,wait_resp_mon,3}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,27354},
   {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{ram2 at tarazed,...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
                                   [{...}]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
              {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
              {'$gen_cast',{invoke,...}},
              {'$gen_cast',{...}},
              {'$gen_cast',...},
              {...}|...]},
   {links,[<0.206.0>]},
   {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
                               <0.109.0>]},
                {'$initial_call',{gen,init_it,...}}]},
   {trap_exit,false},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<0.108.0>},
   {total_heap_size,30610465},
   {heap_size,30610465},
   {stack_size,...},
   {...}|...]}]


Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
> On 06/03/12 11:38, ingo schramm wrote:
> > I do *not* use a mirrored queue :)
>
> Ah, right, that's how I read "queues distributed over all nodes".
>
> Hmm. It's still easier to figure out the memory use of RabbitMQ on 
> 2.7.1, but for 2.6.1 you could check per-queue memory use with 
> "rabbitmqctl list_queues name memory" (or look in mgmt). If this doesn't 
> bring anything useful up then:
>
> * Become the user the broker is running as
> * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into 
> the running broker
> * Invoke "erlang:memory()." for an overview of memory use in the VM.
> * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
> memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a 
> lit of the top 10 memory using processes, and some information on each one.
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/3d4ef029/attachment.htm>

From benbennett at gmail.com  Wed Mar  7 14:41:51 2012
From: benbennett at gmail.com (Benjamin Bennett)
Date: Wed, 7 Mar 2012 08:41:51 -0600
Subject: [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of
	connection
In-Reply-To: <CAGnU7uiTks2iiJ=-EhGUgbMzd5LPoRGmYP9ATa1KHkUPp9Xd3A@mail.gmail.com>
References: <CAGnU7ug+99pP+POgULhXhc4LhAgVdtvjjM5Ge3a7dx_n5gtgZQ@mail.gmail.com>
	<D585A544-3AFF-402B-ABA6-0EDE650DC505@rabbitmq.com>
	<CAGnU7uianGGj9_L5MMa43u1+CHnvgGjbySqfCO695H=3jJnE+w@mail.gmail.com>
	<1AA56A76-6AB5-45B2-ABD1-5FFBE5F3DB39@rabbitmq.com>
	<CAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q@mail.gmail.com>
	<4EC030E3.1090807@rabbitmq.com>
	<CAGnU7uj8PhXp+7JMcJ-XsDrcYNDKno-t5HnGnrwup+F41vCyHw@mail.gmail.com>
	<4EC0CCDE.3030505@rabbitmq.com>
	<CAGnU7uj3U-CHE-Bo_TcxuPxsGdRLyUcngnx-F9xrP=Q3jR-uuA@mail.gmail.com>
	<4EC15EA2.4010507@rabbitmq.com>
	<CAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK+S7=Nki6yjw@mail.gmail.com>
	<CAGnU7uiEduM3C3cvd=f3VeBGUEhudSDU9KDRMmUtxcHv-TzMQA@mail.gmail.com>
	<4ECA4CFE.5000406@rabbitmq.com>
	<CAGnU7uhPjyUWkhWf82Vj-LmxwSijM6kUx9==MEEDx6ykGWw0vA@mail.gmail.com>
	<4ED3B167.20307@rabbitmq.com>
	<CAGnU7uiTks2iiJ=-EhGUgbMzd5LPoRGmYP9ATa1KHkUPp9Xd3A@mail.gmail.com>
Message-ID: <CAGnU7uhcW5qfx2UuQxB+2V_7B6a-OADnt4vPAhjWy97M0byVOg@mail.gmail.com>

Just wondering if this has been fixed in the latest releases?

On Mon, Nov 28, 2011 at 10:18 AM, Benjamin Bennett <benbennett at gmail.com> wrote:
> " But for the purpose of your tests maybe you could work around this by not
> ?closing the channels at all?"
> Our code never actually closes any channels the spring-amqp lib closes
> the channels when the spring context is destroyed.
>
> I have a hack for now and just added a timeout to the spring-amqp lib
> when it closes the connection.
>
> Thanks for all your help. I will be looking for the release that fixes
> this issue.
>
>
>
> On Mon, Nov 28, 2011 at 10:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 21/11/11 16:10, Benjamin Bennett wrote:
>>>
>>> Our application is using the CachingConnectionFactory, Spring
>>> Integration AMQP .
>>> The way this is happening is just by applying the @DirtiesContext in
>>> our unit test , that we need to reload the context, at that time the
>>> channel close and connection close are closed in different threads.
>>> The BlockingQueueConsumer is the one that end ups doing the channel
>>> closes but the CachingConnectionFactory actually ?does the closes .
>>>
>>>
>>> The stacktraces have no other threads running except spring-amqp
>>> threads BlockingQueueConsumer and CachingConnectionFactory.
>>
>> I'm afraid I can't really comment on spring-amqp - I don't know if Dave can?
>>
>> But for the purpose of your tests maybe you could work around this by not
>> closing the channels at all?
>>
>>> My only comment about attracting attention it is a race condition ,
>>> and race conditions are the most painful bugs to have to deal with.
>>
>> Oh, absolutely.
>>
>>> On my dev box I have only seen the issue one time in 200 runs that ran
>>> over night.
>>> On our test windows 7 vms it happens 50% of the time, sample size was 40
>>> runs.
>>> On our windows xp test vms it has never happened.
>>>
>>> In our production we get a "The service failed to close in timely
>>> manner" and doesn't shut down.
>>>
>>> Finally if you are fixing it in the server , what about the previous
>>> versions? I don't even think spring-amqp has migrated to 2.7 series
>>> java client because it is backwards incompatible.
>>
>> You don't need to use the same versions of client and server - just
>> upgrading the server should be fine.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>



-- 
Sincerely,

Benjamin Bennett
314.246.0645
benbennett at gmail.com

"For a successful technology, reality must take precedence over public
relations, for Nature cannot be fooled."
Richard Feynman

From benbennett at gmail.com  Wed Mar  7 14:46:46 2012
From: benbennett at gmail.com (Benjamin Bennett)
Date: Wed, 7 Mar 2012 08:46:46 -0600
Subject: [rabbitmq-discuss] WCF client persistent gueue/ setting routing key
Message-ID: <CAGnU7uiTmaY7LMyPPeMu=43VEZ_S-ccoNsnNGYWTqQM6XCCLOw@mail.gmail.com>

Just wondering if persistent queues for a WCF binding has been
implemented. I found this old thread
http://old.nabble.com/WCF-and-queue-creation-tt28842204.html#a28842204
.

Also I read through the documentation and didn't find a way to just
have setting a routing key to send a message .


-- 
Sincerely,

Benjamin Bennett


"For a successful technology, reality must take precedence over public
relations, for Nature cannot be fooled."
Richard Feynman

From simon at rabbitmq.com  Wed Mar  7 15:11:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Mar 2012 15:11:45 +0000
Subject: [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of
 connection
In-Reply-To: <CAGnU7uhcW5qfx2UuQxB+2V_7B6a-OADnt4vPAhjWy97M0byVOg@mail.gmail.com>
References: <CAGnU7ug+99pP+POgULhXhc4LhAgVdtvjjM5Ge3a7dx_n5gtgZQ@mail.gmail.com>	<D585A544-3AFF-402B-ABA6-0EDE650DC505@rabbitmq.com>	<CAGnU7uianGGj9_L5MMa43u1+CHnvgGjbySqfCO695H=3jJnE+w@mail.gmail.com>	<1AA56A76-6AB5-45B2-ABD1-5FFBE5F3DB39@rabbitmq.com>	<CAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q@mail.gmail.com>	<4EC030E3.1090807@rabbitmq.com>	<CAGnU7uj8PhXp+7JMcJ-XsDrcYNDKno-t5HnGnrwup+F41vCyHw@mail.gmail.com>	<4EC0CCDE.3030505@rabbitmq.com>	<CAGnU7uj3U-CHE-Bo_TcxuPxsGdRLyUcngnx-F9xrP=Q3jR-uuA@mail.gmail.com>	<4EC15EA2.4010507@rabbitmq.com>	<CAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK+S7=Nki6yjw@mail.gmail.com>	<CAGnU7uiEduM3C3cvd=f3VeBGUEhudSDU9KDRMmUtxcHv-TzMQA@mail.gmail.com>	<4ECA4CFE.5000406@rabbitmq.com>	<CAGnU7uhPjyUWkhWf82Vj-LmxwSijM6kUx9==MEEDx6ykGWw0vA@mail.gmail.com>	<4ED3B167.20307@rabbitmq.com>	<CAGnU7uiTks2iiJ=-EhGUgbMzd5LPoRGmYP9ATa1KHkUPp9Xd3A@mail.gmail.com>
	<CAGnU7uhcW5qfx2UuQxB+2V_7B6a-OADnt4vPAhjWy97M0byVOg@mail.gmail.com>
Message-ID: <4F577AB1.5090006@rabbitmq.com>

On 07/03/12 14:41, Benjamin Bennett wrote:
> Just wondering if this has been fixed in the latest releases?

Yes, it was fixed in 2.7.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gregory.sainson at gmail.com  Wed Mar  7 14:17:34 2012
From: gregory.sainson at gmail.com (Greg)
Date: Wed, 7 Mar 2012 06:17:34 -0800 (PST)
Subject: [rabbitmq-discuss] basic.Get and basic.Consume on the same queue
In-Reply-To: <CABzX+qwx8CXrs_+RbapZrCQys1Uo4mtLXaay9EVrs5WRy2g=pw@mail.gmail.com>
References: <17240268.3836.1331128340437.JavaMail.geo-discussion-forums@vbtv42>
	<CABzX+qyXUBDanaRmH75KCOZvj5+M5XKtwDe1ZoxefcAr5GWO4g@mail.gmail.com>
	<CABzX+qwx8CXrs_+RbapZrCQys1Uo4mtLXaay9EVrs5WRy2g=pw@mail.gmail.com>
Message-ID: <756201.454.1331129854410.JavaMail.geo-discussion-forums@ynt13>

Makes perfect sens.

Thx

On Wednesday, March 7, 2012 3:03:48 PM UTC+1, Marek Majkowski wrote:
>
> On Wed, Mar 7, 2012 at 13:52, Greg <gregory.sainson at gmail.com> wrote:
> > Hi,
> >
> > I can't find any info on the web about it.
> >
> > I currently have different programs that consumes the same queue.
> > One program is registered to the queue with a basic.Consume.
> > The other one is receiving messages with basic.Get. Unfortunately, It
> > doesn't get any messages, basic.Get always returns null, like the queue 
> is
> > empty.
> > If I change it with a basic.Consume, it works fine. I'm using the Java
> > client of RabbitMQ.
> >
> > Anyone has any idea with this happens?
>
> If you're using Basic.Consume without setting Basic.QOS, Rabbit
> sends a bulk of messages to the consumer. (in hundreds of messages).
>
> Assuming the consumer uses Acks, the messages are then slowly
> marked as Acknowledged and deleted.
>
> But in the meantime all the messages were already sent to the
> BasicConsume client - thus Basic.Get will find that there
> aren't any messages ready!
>
> The solution is to configure prefetch count using Basic.Qos
> and also you must use Acknowledgments. (Basic.Qos without
> acks makes no sense).
>
> When you change second consumer to use BasicConsume,
> it will hang and wait for mesages. Rabbit than sees:
> okay, there are two consumes waiting on that queue.
> When a new message arrives Rabbit will make a decision
> where to send the message. It will try to do something
> like round-robin. Thus - your second consumer will
> receive some messages (every second one in a perfect
> world).
>
> Hope that helps,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/6ba7f797/attachment.htm>

From simon at rabbitmq.com  Wed Mar  7 15:22:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Mar 2012 15:22:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>	<4EFDAA72.9090605@rabbitmq.com>	<4EFDC47D.7060204@rabbitmq.com>	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>	<4EFDDC6E.8060200@rabbitmq.com>	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>	<4F564161.5040601@rabbitmq.com>
	<CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>
Message-ID: <4F577D3D.2020003@rabbitmq.com>

On 07/03/12 08:57, Dmitri Minaev wrote:
> Yes, there's quite a lot of those 'failed to accept' messages.
> Actually, this is the second time when Rabbit stops since installation
> of that tcp_acceptor patch, and every time those messages appear in
> large number.

So there's few things going on here. The primary issue is that RabbitMQ 
is running out of file descriptors due to too many connections being 
opened, and for various reasons the internal accounting that is supposed 
to prevent this from causing harm is getting out of sync with reality. 
There are already improvements that will be coming in the next release 
that will improve this situation and we have some ideas for how to fix 
it altogether.

But in the meantime you should look at increasing the number of file 
descriptors that are available to RabbitMQ.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From aaron at agoragames.com  Wed Mar  7 16:58:21 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 7 Mar 2012 11:58:21 -0500
Subject: [rabbitmq-discuss] Transfer rate improvement above 45mb/second?
In-Reply-To: <29550384.2856.1331010669378.JavaMail.geo-discussion-forums@pbctp6>
References: <aa29c113-a9f5-47a7-9792-280a51f79902@v2g2000pbo.googlegroups.com>
	<4F54EBA5.8000105@rabbitmq.com>
	<29550384.2856.1331010669378.JavaMail.geo-discussion-forums@pbctp6>
Message-ID: <CAHiEoM58G4sN3o+UC_qrqisB8FgxKFs7CE_7Y18iFUzANAGNcA@mail.gmail.com>

The AMQP protocol is not very friendly to fast (de)serializing as many
of its types are encoded as "type | byte_length | bytes", which means
that one has to encode full data structures and frames before knowing
what `byte_length` is, at which point you have to go back to that
point and write the size. That is, you can't stream directly to/from a
socket, you have to maintain at least one buffer for your entire
frame, and possibly several if you aren't set up to use a single
buffer per frame.  You can see the problem here:

https://github.com/agoragames/haigha/blob/68ed0408dd9e88327b202259a9d4d12da571241d/haigha/writer.py#L169
https://github.com/agoragames/haigha/blob/9034e3608a98a3d724be7ce1503a70091293435d/haigha/frames/header_frame.py#L113

I consider this a major oversight in the protocol and a fundamental design flaw.

You may also be encountering limits of the hardware configuration,
which I described in this post:

http://blog.agoragames.com/blog/2011/06/24/of-penguins-rabbits-and-buses/

I think I saw that Rabbit 2.7.1 and Erlang R15B both have improvements
when it comes to shared read and write locks between threads, so if
you're not running the absolute latest, look into that. I haven't
repeated my tests in that blog post using the latest software so the
results may be different now.

I am not a Windows user and so I have little of value to offer in
diagnosing the problem beyond the application level.

-Aaron




On Tue, Mar 6, 2012 at 12:11 AM, Matt <matt.wolf74 at gmail.com> wrote:
> Thats sounds very unsatisfactory simply because I am not sure it addresses
> the real problem and makes me wonder??how efficient/inefficient the AMQP
> parser really is. If I send large byte arrays what needs to be parsed? My
> understanding is that each message gets parsed to AMQP but not the content
> of the message body. So, I fail to understand how parsing makes a difference
> whether I send a byte array of size 10 bytes versus a message that contains
> a body that holds a 10 megabyte byte array. I do not see why the bus limits
> me to 45mb/second. My binary reader moves about 200mb/second, reading from a
> physical storage into memory, including the parsing of the byte arrays to C#
> objects, thus the raw speed should be even a lot higher. There must be
> something else going on that limits RabbitMQ to go beyond the 45mb/second.
> The order of messages is important thus I cannot run more channels in
> parallel. Can anyone please chime in so I understand what I am overlooking
> here? Thanks a lot.
>
>
> On Tuesday, March 6, 2012 1:36:53 AM UTC+9, Simon MacMullen wrote:
>>
>> I suspect you're probably limited by the speed of the AMQP parser in
>> this case. Unfortunately the only thing you can really do to make it run
>> faster is turn on HiPE compilation or buy a a faster machine. And HiPE
>> compilation only works on Unix I'm afraid.
>>
>> If you can afford to lose ordering guarantees you could push the
>> messages through more than one connection / queue, and thus take
>> advantage of more cores.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From mpietrek at skytap.com  Wed Mar  7 20:00:35 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 07 Mar 2012 12:00:35 -0800
Subject: [rabbitmq-discuss] Looking for clarification on acknowledgements,
 channels, and connections
Message-ID: <CB7CFE63.30FDE%mpietrek@skytap.com>

I thought I understood this topic clearly, but some recent experiences have
me seeking more info, as I can't find this exact topic explicitly described.

When a message is delivered on a particular connection/channel combination,
can it ever be successfully acknowledged on a different connection?

My current understanding is "no".

Some background: In our messaging layer, we want to hide the connection
drops from the upper application layer. That is, if we try to use a
previously working connection/channel, and it fails, we'll simply catch the
exception and try to reconnect.

So the question is, after the reconnect, should we even attempt to
acknowledge messages read from the original connection?




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/0d90cc5b/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Wed Mar  7 20:18:25 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 7 Mar 2012 15:18:25 -0500
Subject: [rabbitmq-discuss] Looking for clarification on
 acknowledgements, channels, and connections
In-Reply-To: <CB7CFE63.30FDE%mpietrek@skytap.com>
References: <CB7CFE63.30FDE%mpietrek@skytap.com>
Message-ID: <CAM8fPiQ3KzXnKYyF9a-_+X1M0gmAZjYA4QqnHSXsD7OigYRmwg@mail.gmail.com>

On 7 March 2012 15:00, Matt Pietrek <mpietrek at skytap.com> wrote:

> My current understanding is "no".
>

Correct. The scope of the delivery-tag field in Basic.Deliver and Basic.Ack
is the channel that the Basic.Deliver appeared on. Once that channel's
closed (either directly, or indirectly through a connection close or TCP
abort), the delivery-tag will no longer be understood by the remote peer:
its scope has ended.

So the question is, after the reconnect, should we even attempt to
> acknowledge messages read from the original connection?
>

No.

(Questions like this highlight some of the reasons why "exactly-once"
delivery isn't really a meaningful feature for messaging middleware to
provide :-) )

Regards,
  Tony

-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/e130d61e/attachment.htm>

From simone.busoli at gmail.com  Wed Mar  7 20:20:55 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 7 Mar 2012 21:20:55 +0100
Subject: [rabbitmq-discuss] Looking for clarification on
 acknowledgements, channels, and connections
In-Reply-To: <CB7CFE63.30FDE%mpietrek@skytap.com>
References: <CB7CFE63.30FDE%mpietrek@skytap.com>
Message-ID: <CAOn7oW8jba5V_vezvosO9mCrEugss3Cf3nAfe=TGTMqwCvv03w@mail.gmail.com>

Hi Matt, your understanding is correct, acknowledgements are meaningful
only within the context of the same channel, therefore the answer to your
last question is no.
If the connection bounces or the channel closes for any other reasons you
should not acknowledge the messages your consumer was delivered already and
just assume they will be redelivered to the next consumer which will start
consuming to the same queue.

On Wed, Mar 7, 2012 at 21:00, Matt Pietrek <mpietrek at skytap.com> wrote:

> I thought I understood this topic clearly, but some recent experiences
> have me seeking more info, as I can't find this exact topic explicitly
> described.
>
> When a message is delivered on a particular connection/channel
> combination, can it ever be successfully acknowledged on a different
> connection?
>
> My current understanding is "no".
>
> Some background: In our messaging layer, we want to hide the connection
> drops from the upper application layer. That is, if we try to use a
> previously working connection/channel, and it fails, we'll simply catch the
> exception and try to reconnect.
>
> So the question is, after the reconnect, should we even attempt to
> acknowledge messages read from the original connection?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/0814d5d5/attachment.htm>

From alexis at rabbitmq.com  Wed Mar  7 20:25:10 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 7 Mar 2012 20:25:10 +0000
Subject: [rabbitmq-discuss] Looking for clarification on
 acknowledgements, channels, and connections
In-Reply-To: <CAOn7oW8jba5V_vezvosO9mCrEugss3Cf3nAfe=TGTMqwCvv03w@mail.gmail.com>
References: <CB7CFE63.30FDE%mpietrek@skytap.com>
	<CAOn7oW8jba5V_vezvosO9mCrEugss3Cf3nAfe=TGTMqwCvv03w@mail.gmail.com>
Message-ID: <CACOPnvfnFp822W0cOw4JmU-Do4CG2-YhnDDJp7uLbh3qnnkSwQ@mail.gmail.com>

Matt

Could you achieve what you want by lifting 'ack' to the application layer?

alexis


On Wed, Mar 7, 2012 at 8:20 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
> Hi Matt, your understanding is correct, acknowledgements are meaningful only
> within the context of the same channel, therefore the answer to your last
> question is no.
> If the connection bounces or the channel closes for any other reasons you
> should not acknowledge the messages your consumer was delivered already and
> just assume they will be redelivered to the next consumer which will start
> consuming to the same queue.
>
> On Wed, Mar 7, 2012 at 21:00, Matt Pietrek <mpietrek at skytap.com> wrote:
>>
>> I thought I understood this topic clearly, but some recent experiences
>> have me seeking more info, as I can't find this exact topic explicitly
>> described.
>>
>> When a message is delivered on a particular connection/channel
>> combination, can it ever be successfully acknowledged on a different
>> connection?
>>
>> My current understanding is "no".
>>
>> Some background: In our messaging layer, we want to hide the connection
>> drops from the upper application layer. That is, if we try to use a
>> previously working connection/channel, and it fails, we'll simply catch the
>> exception and try to reconnect.
>>
>> So the question is, after the reconnect, should we even attempt to
>> acknowledge messages read from the original connection?
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simone.busoli at gmail.com  Wed Mar  7 20:52:00 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 7 Mar 2012 21:52:00 +0100
Subject: [rabbitmq-discuss] Looking for clarification on
 acknowledgements, channels, and connections
In-Reply-To: <CACOPnvfnFp822W0cOw4JmU-Do4CG2-YhnDDJp7uLbh3qnnkSwQ@mail.gmail.com>
References: <CB7CFE63.30FDE%mpietrek@skytap.com>
	<CAOn7oW8jba5V_vezvosO9mCrEugss3Cf3nAfe=TGTMqwCvv03w@mail.gmail.com>
	<CACOPnvfnFp822W0cOw4JmU-Do4CG2-YhnDDJp7uLbh3qnnkSwQ@mail.gmail.com>
Message-ID: <CAOn7oW-xUTYs4NPA+kewKbagntvbvH9SB3B=DrcM0fByQWxsqA@mail.gmail.com>

Hi Alexis, I've had to deal with the same situation as Matt describes in
the past and in the end the scenarios in case of channel closure were:

   - discard messages delivered to the consumer but not yet dispatched to
   the application, assuming they will be redelivered
   - dispatch them to the application and not bother acking them as acking
   wouldn't obviously succeed
   - dispatch them to the application and try acking them anyway, catching
   errors that inevitably will be raised due to the channel being closed

Although it's not the cleanest solution I've chosen the third one (assuming
a sensible prefect-count value, as swallowing lots of ack errors would
likely affect the application performance) for a couple of reasons - quite
dependent on the context btw:

   - I wanted my application to see the messages the consumer had received
   as soon as possible, without waiting for them to be eventually redelivered
   - Not treating the scenario in which messages are acked on a closed
   channel as a special case helped keep simplicity
   - You have to deal with deduplication anyway compared to option 1 above
   (which may create the false assumption that you wouldn't have to do so in
   that case)

Simone

On Wed, Mar 7, 2012 at 21:25, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Matt
>
> Could you achieve what you want by lifting 'ack' to the application layer?
>
> alexis
>
>
> On Wed, Mar 7, 2012 at 8:20 PM, Simone Busoli <simone.busoli at gmail.com>
> wrote:
> > Hi Matt, your understanding is correct, acknowledgements are meaningful
> only
> > within the context of the same channel, therefore the answer to your last
> > question is no.
> > If the connection bounces or the channel closes for any other reasons you
> > should not acknowledge the messages your consumer was delivered already
> and
> > just assume they will be redelivered to the next consumer which will
> start
> > consuming to the same queue.
> >
> > On Wed, Mar 7, 2012 at 21:00, Matt Pietrek <mpietrek at skytap.com> wrote:
> >>
> >> I thought I understood this topic clearly, but some recent experiences
> >> have me seeking more info, as I can't find this exact topic explicitly
> >> described.
> >>
> >> When a message is delivered on a particular connection/channel
> >> combination, can it ever be successfully acknowledged on a different
> >> connection?
> >>
> >> My current understanding is "no".
> >>
> >> Some background: In our messaging layer, we want to hide the connection
> >> drops from the upper application layer. That is, if we try to use a
> >> previously working connection/channel, and it fails, we'll simply catch
> the
> >> exception and try to reconnect.
> >>
> >> So the question is, after the reconnect, should we even attempt to
> >> acknowledge messages read from the original connection?
> >>
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/dc05f826/attachment.htm>

From jpcustin at gmail.com  Thu Mar  8 02:17:31 2012
From: jpcustin at gmail.com (Jay Custin)
Date: Wed, 7 Mar 2012 21:17:31 -0500
Subject: [rabbitmq-discuss] Management Plugin
Message-ID: <CAG6yfxUxuk4szkAAWNnTiCyaS=VxTT+UGtfpUDQj3+wM7rtmyg@mail.gmail.com>

I figure I must have missed *something*, but I sure can't figure out what.
I have tried the RabbitMQ Management Plugin from both Firefox and IE on my
Windows 7 x64 system and the adding a user does not behave as I expect it
would/should.

First I took my IE, turned off every sort of "safety feature" I could find,
but when I click on any of the links below the "Tags" field, it changes to
a blank screen except for the text *[object Object]* at the top.  If I
watch VERY carefully when I click I see that it populates the field with
the string *administrator*, but then the blank screen except for the
text *[object
Object]* appears.

If I do the same thing with Firefox (though not necessarily as "wide
open"), it does not switch to a blank screen, but near as I can tell,
nothing happens at all.  I double-checked to make sure that I permitted
pop-ups, and then it behaves like I described for IE.



Next it seems somewhat confusing (at least to me) that the label below the
Tags field shows [Admin]..., but the *actual* valid tag values list the
string *administrator.  *Note:  full word... and all lower case.



Next it seems somewhat strange that no mechanism exists to CHANGE a user's
tags after the user gets created.  You can clear permissions, change
permissions, or delete the user, but nothing else.  To change the tags it
looks like you have to delete the user and create it again.



Finally I find it somewhat surprising that the form provides no way to
reset/remove a user password.  It appears that you can only accomplish this
by deleting the user and then creating a new user.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/c18d861f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: admin_v_administrator.jpg
Type: image/jpeg
Size: 54824 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/c18d861f/attachment.jpg>

From vpdwivedi71 at gmail.com  Thu Mar  8 08:26:43 2012
From: vpdwivedi71 at gmail.com (Vinay Prakash Dwivedi)
Date: Thu, 8 Mar 2012 13:56:43 +0530
Subject: [rabbitmq-discuss] rabbit MQ Consumer.nextdelivery method consumes
 all messages and returns only single message
Message-ID: <CAJOsJgwvHaxhipKy0eY=yM-_ssvkvwCXv_bUTspBcS9BaKHqxg@mail.gmail.com>

Hi

I am using RabbitMq
when i read messages from consumer.nextdelivery() method , it consumes all
messages and give me a single message

all my other messages got lost

is there any method to get the message one by one

Sun-> openMQ : provides readmessage method which gives message one by one

if anyone have the solution let me know

Reagrds

Vinay prakash dwivedi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/9744c735/attachment.htm>

From qingyan at gmail.com  Thu Mar  8 09:25:58 2012
From: qingyan at gmail.com (Qing Yan)
Date: Thu, 8 Mar 2012 17:25:58 +0800
Subject: [rabbitmq-discuss] Possible to keep consumed messages for certain
	period time (to replay..etc)
Message-ID: <CAGfOmyPKChg3LMmmuAxOYB=kDopUV=9=jAKqFGXLDrnF4vpHow@mail.gmail.com>

Hi,

   I am wondering in Rabbit MQ, can consumed messages be kept for certain
period of time, so that it can be replayed later?

According to the doc:

:when should the AMQP broker remove messages from queues? The AMQP 0-9-1
specification proposes two choices:

   - After broker sends a message to an application (using either
   basic.deliver or basic.get-ok AMQP methods).
   - After the application sends back an acknowledgement (using basic.ack AMQP
   method).


(http://www.rabbitmq.com/tutorials/amqp-concepts.html)

It seems not possible to do so. Basically what we need is :

1)  User to decide when to remove message from queue

2)  Replay message that has been consumed.

Is Rabbit MQ suitable tool for such requirements?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/8728a558/attachment.htm>

From alexis at rabbitmq.com  Thu Mar  8 10:12:26 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 8 Mar 2012 10:12:26 +0000
Subject: [rabbitmq-discuss] Using Rabbit with Excel
In-Reply-To: <CACOPnvdiSNdVt6ggJ-CJnm1crq+E8JM1DMB3Jg_Z+DQiYn-i_g@mail.gmail.com>
References: <CACOPnvcFPGiy1_9rJaS1K3cEDo7-Kp-oCYXT7GeDqC316UZwow@mail.gmail.com>
	<427D08915E484DC1A947D6225746DBEE@myyearbook.com>
	<CACOPnvfDSc7yaZX-knCiJ0vZnDS7jeF5FFHhtJrE0akVD3NhRQ@mail.gmail.com>
	<CACOPnvdiSNdVt6ggJ-CJnm1crq+E8JM1DMB3Jg_Z+DQiYn-i_g@mail.gmail.com>
Message-ID: <CACOPnvfusCOR-eQvOfSeZp2SOKm_rCu5PA+BBaUL7R7-Cm2vwg@mail.gmail.com>

The author has moved this to:

https://github.com/tyagihas/hikyaku

He has compiled it under a specific platform so do let him know if
anyone needs binaries for other platforms.



On Tue, Mar 6, 2012 at 4:57 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> I believe this is now being resolved. ?Bear with us.
>
>
> On Mon, Mar 5, 2012 at 3:49 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Yes, it may have been published on a site that only some of us can access.
>>
>> Let me try to find out....
>>
>>
>> On Mon, Mar 5, 2012 at 3:26 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>> Not seeing DNS resolution for that host, is it internal only?
>>>
>>> gmr-0x04:~ gmr$ dig -t A git.springsource.com
>>>
>>> ; <<>> DiG 9.7.3-P3 <<>> -t A git.springsource.com
>>> ;; global options: +cmd
>>> ;; Got answer:
>>> ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 55216
>>> ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0
>>>
>>> ;; QUESTION SECTION:
>>> ;git.springsource.com. IN A
>>>
>>> ;; AUTHORITY SECTION:
>>> springsource.com. 3577 IN SOA sc9-ext-dns-1.vmware.com.
>>> hostmaster.vmware.com. 2012030101 10800 1800 3600000 3600
>>>
>>> On Monday, March 5, 2012 at 9:23 AM, Alexis Richardson wrote:
>>>
>>> Hi
>>>
>>> One of our colleagues at VMware has created this, which may be of
>>> interest to the community:
>>>
>>> https://git.springsource.com/hikyaku
>>>
>>> alexis
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>

From taylste at gmail.com  Thu Mar  8 10:19:34 2012
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 8 Mar 2012 10:19:34 +0000
Subject: [rabbitmq-discuss] Riak <-> RabbitMQ integration
In-Reply-To: <93064895-0B02-474A-B5B1-110FAB43CD93@jbrisbin.com>
References: <93064895-0B02-474A-B5B1-110FAB43CD93@jbrisbin.com>
Message-ID: <CA+zYriRTfvCCb9KwXgwuDKf8--C0_7P_F50A+FKn_qzZoRpMQA@mail.gmail.com>

I was sold on redis, and now I find that Rabbit has a riak exchange
plugin.   That's good, but this complicates things a little.  I don't know
much about Riak.

If you are pushing around binary, what's the method of providing an
identity to Riak via a message?

I'd love to know the relative advantages of the different NOSQL solutions.
Last time I explored this BerkeleyDB was the solution... now I don't know
the space well enough to form a solid opinion.
thanks,
-Steven
On 16 April 2011 00:20, Jon Brisbin <jon at jbrisbin.com> wrote:

> I've been carrying this evented datastore torch for a while now and been
> making pretty good progress in that direction. This evening I pushed a Riak
> postcommit hook to my github that sends updated entries to RabbitMQ using
> the Erlang AMQP client.
>
> https://github.com/jbrisbin/riak-rabbitmq-commit-hooks
>
> This is the other half of the equation for the custom exchange type I
> wrote to push RabbitMQ messages into Riak.
>
> https://github.com/jbrisbin/riak-exchange
>
> This gets me one step closer to that evented datastore Nirvana I doubt is
> actually possible--but you gotta have a dream, right? :)
>
> Thanks!
>
> Jon Brisbin
>
> http://jbrisbin.com
> Twitter: @j_brisbin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/675a9968/attachment.htm>

From jonas.colmsjo at gizur.com  Wed Mar  7 19:30:35 2012
From: jonas.colmsjo at gizur.com (Jonas Colmsjo)
Date: Wed, 7 Mar 2012 11:30:35 -0800 (PST)
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
Message-ID: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>

I've copied the send.py and receive.py in the Hellow World tutorial and 
keep getting time out errors. I've tried running the python code on both 
the local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up 
and running and I can login to the management console.

Any help is greatly appreciated!

root at rabbit-1:~/tmp# rabbitmq-server status
Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************

6 plugins activated:
* amqp_client-2.7.1
* mochiweb-1.3-rmq2.7.1-git
* rabbitmq_management-2.7.1
* rabbitmq_management_agent-2.7.1
* rabbitmq_mochiweb-2.7.1
* webmachine-1.7.0-rmq2.7.1-hg

node with name "rabbit" already running on "rabbit-1"
diagnostics:
- nodes and their ports on rabbit-1: [{rabbit,39652},
                                      {rabbitmqprelaunch17299,33245}]
- current node: 'rabbitmqprelaunch17299 at rabbit-1'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==

--- ERROR ---

root at rabbit-1:~/tmp# sudo python send.py
Traceback (most recent call last):
  File "send.py", line 5, in <module>
    host='localhost'))
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
line 32, in __init__
    BaseConnection.__init__(self, parameters, None, reconnection_strategy)
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 50, in __init__
    reconnection_strategy)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
170, in __init__
    self._connect()
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
228, in _connect
    self.parameters.port or  spec.PORT)
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
line 44, in _adapter_connect
    self._handle_read()
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 151, in _handle_read
    data = self.socket.recv(self._suggested_buffer_size)
socket.timeout: timed out
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/1a1d43d1/attachment.htm>

From arpitasati22 at gmail.com  Wed Mar  7 22:20:19 2012
From: arpitasati22 at gmail.com (Arpita Sati)
Date: Wed, 7 Mar 2012 15:20:19 -0700
Subject: [rabbitmq-discuss] Rabbitmq, LDAP and SSL
Message-ID: <CAG9S_iRBwFZvzMr1TRS8J6A0rYoXHVXwMsfWHBLy_6-BGfPy5A@mail.gmail.com>

Hi,

is "rabbitmq-auth-backend-ldap cannot use SSL " resolved in release 2.7.1?

Thanks
-- 
*"To grow each day, is a wish not asked by all.*
*To love each day, is a privilege not taken by all."*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120307/228dfaed/attachment.htm>

From chen-hongqin at 163.com  Thu Mar  8 04:01:45 2012
From: chen-hongqin at 163.com (chen-hongqin)
Date: Thu, 8 Mar 2012 12:01:45 +0800
Subject: [rabbitmq-discuss] one exchange and different nodes
Message-ID: <2c73ab05.ecdb5.135f0778b7d.Coremail.chen-hongqin@163.com>

hi, may be it is a simple question, but it puzzled me a lot. I am setting up a RabbitMQ Cluster. My question is can i declare a exchange which mapping to different nodes? In my case, there are several nodes, like a at rabbit, b at rabbit, c at rabbit, and now i declare two queues which bind with an exchange(just in the same Channel), so can these two queues be in different nodes?

i also see some explanations at http://www.rabbitmq.com/ha.html, say that "The queue's initial master will be on the node to which the client issuing the queue declare is connected." does it mean i can't declare two queues(just in the same Channel) in different nodes?

2012-03-08



chen-hongqin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/29f0da6b/attachment.htm>

From chen-hongqin at 163.com  Thu Mar  8 04:07:00 2012
From: chen-hongqin at 163.com (Techq)
Date: Wed, 7 Mar 2012 20:07:00 -0800 (PST)
Subject: [rabbitmq-discuss] one exchange and different nodes
Message-ID: <fe46cf6e-7deb-457a-abd6-975732f5e941@wb9g2000pbc.googlegroups.com>

hi, may be it is a simple question, but it puzzled me a lot. I am
setting up a RabbitMQ Cluster. My question is can i declare a exchange
which mapping to different nodes? In my case, there are several nodes,
like a at rabbit, b at rabbit, c at rabbit, and now i declare two queues which
bind with an exchange(just in the same Channel), so can these two
queues be in different nodes?

i also see some explanations at http://www.rabbitmq.com/ha.html, say
that "The queue's initial master will be on the node to which the
client issuing the queue declare is connected." does it mean i can't
declare two queues(just in the same Channel) in different nodes?

From simon at rabbitmq.com  Thu Mar  8 11:07:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 11:07:22 +0000
Subject: [rabbitmq-discuss] Rabbitmq, LDAP and SSL
In-Reply-To: <CAG9S_iRBwFZvzMr1TRS8J6A0rYoXHVXwMsfWHBLy_6-BGfPy5A@mail.gmail.com>
References: <CAG9S_iRBwFZvzMr1TRS8J6A0rYoXHVXwMsfWHBLy_6-BGfPy5A@mail.gmail.com>
Message-ID: <4F5892EA.8080006@rabbitmq.com>

On 07/03/12 22:20, Arpita Sati wrote:
> is "rabbitmq-auth-backend-ldap cannot use SSL " resolved in release 2.7.1?

Um, when was this broken? How is it not working for you?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 11:11:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 11:11:15 +0000
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAG6yfxUxuk4szkAAWNnTiCyaS=VxTT+UGtfpUDQj3+wM7rtmyg@mail.gmail.com>
References: <CAG6yfxUxuk4szkAAWNnTiCyaS=VxTT+UGtfpUDQj3+wM7rtmyg@mail.gmail.com>
Message-ID: <4F5893D3.1010005@rabbitmq.com>

On 08/03/12 02:17, Jay Custin wrote:
> I figure I must have missed */something/*, but I sure can't figure out
> what.  I have tried the RabbitMQ Management Plugin from both Firefox and
> IE on my Windows 7 x64 system and the adding a user does not behave as I
> expect it would/should.
>
> First I took my IE, turned off every sort of "safety feature" I could
> find, but when I click on any of the links below the "Tags" field, it
> changes to a blank screen except for the text *[object Object]* at the
> top.  If I watch VERY carefully when I click I see that it populates the
> field with the string *administrator*, but then the blank screen except
> for the text *[object Object]* appears.
>
> If I do the same thing with Firefox (though not necessarily as "wide
> open"), it does not switch to a blank screen, but near as I can tell,
> nothing happens at all.  I double-checked to make sure that I permitted
> pop-ups, and then it behaves like I described for IE.

Yeah, this is a bug on that page on recent IE/FF. It's fixed in the 
upcoming release. You can work around it by typing in the tags.

> Next it seems somewhat confusing (at least to me) that the label below
> the Tags field shows [Admin]..., but the */actual/* valid tag values
> list the string *administrator. *Note:  full word... and all lower case.

Yeah, the shortening was done to control the amount of space the links 
take up.

> Next it seems somewhat strange that no mechanism exists to CHANGE a
> user's tags after the user gets created.  You can clear permissions,
> change permissions, or delete the user, but nothing else.  To change the
> tags it looks like you have to delete the user and create it again.

No, you can, although it's not very clear. You need to enter the new 
details with the same username into the "add / update a user" form. Some 
better UI for this is on the TODO list.

> Finally I find it somewhat surprising that the form provides no way to
> reset/remove a user password.  It appears that you can only accomplish
> this by deleting the user and then creating a new user.

Again, new details, same username.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 11:14:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 11:14:34 +0000
Subject: [rabbitmq-discuss] rabbit MQ Consumer.nextdelivery method
 consumes all messages and returns only single message
In-Reply-To: <CAJOsJgwvHaxhipKy0eY=yM-_ssvkvwCXv_bUTspBcS9BaKHqxg@mail.gmail.com>
References: <CAJOsJgwvHaxhipKy0eY=yM-_ssvkvwCXv_bUTspBcS9BaKHqxg@mail.gmail.com>
Message-ID: <4F58949A.9080109@rabbitmq.com>

Use basic.get to pull messages down one at a time, or use basic.qos with 
acks to limit the number of messages RabbitMQ will send to your consumer.

Cheers, Simon

On 08/03/12 08:26, Vinay Prakash Dwivedi wrote:
> Hi
>
> I am using RabbitMq
> when i read messages from consumer.nextdelivery() method , it consumes
> all messages and give me a single message
>
> all my other messages got lost
>
> is there any method to get the message one by one
>
> Sun-> openMQ : provides readmessage method which gives message one by one
>
> if anyone have the solution let me know
>
> Reagrds
>
> Vinay prakash dwivedi
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 11:48:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 11:48:21 +0000
Subject: [rabbitmq-discuss] one exchange and different nodes
In-Reply-To: <fe46cf6e-7deb-457a-abd6-975732f5e941@wb9g2000pbc.googlegroups.com>
References: <fe46cf6e-7deb-457a-abd6-975732f5e941@wb9g2000pbc.googlegroups.com>
Message-ID: <4F589C85.8020202@rabbitmq.com>

On 08/03/12 04:07, Techq wrote:
> hi, may be it is a simple question, but it puzzled me a lot. I am
> setting up a RabbitMQ Cluster. My question is can i declare a exchange
> which mapping to different nodes? In my case, there are several nodes,
> like a at rabbit, b at rabbit, c at rabbit, and now i declare two queues which
> bind with an exchange(just in the same Channel), so can these two
> queues be in different nodes?

I'm not sure I understand your question, but:

* Exchanges live on all nodes by definition
* Non-mirrored queues live on the node on which they were first declared
* Mirrored queues live on whichever nodes their mirroring policy implies
* Therefore declaring two non-mirrored queues on the same channel will 
put them on the same node

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 12:06:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 12:06:44 +0000
Subject: [rabbitmq-discuss] MCollective + RabbitMQ + LDAP authentication
 issues
In-Reply-To: <6bd29fb5-5eaa-4971-95e5-6fd0a2591a25@sv8g2000pbc.googlegroups.com>
References: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>	<4F54EA14.2090409@rabbitmq.com>
	<6bd29fb5-5eaa-4971-95e5-6fd0a2591a25@sv8g2000pbc.googlegroups.com>
Message-ID: <4F58A0D4.2090807@rabbitmq.com>

On 05/03/12 20:07, E Raymond wrote:
> Hi Simon,
>
> Thanks for the help! I realize the problem now, and wonder if there is
> an in between solution to this?
>
> I only want to authenticate the user through LDAP. I feel adding
> vhosts to OU's seems like a bulky solution, and would prefer to allow
> specific authenticated users to have to access to a specified vhost,
> and allow the resources to dictate what privileges they have.
>
> Is this possible?

What do you mean by "specified vhost"? Specified by static config or by 
the LDAP server or something else? In the first case, something like

{vhost_access_query, {match, {string, "${vhost}"}, {string, "/"}}}

should work. In the second, an exists query as above is probably what 
you want.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 12:07:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 12:07:18 +0000
Subject: [rabbitmq-discuss] Does RabbitMQ has the Message Grouping
	feature?
In-Reply-To: <002a01ccfc69$4db98030$e92c8090$@gmail.com>
References: <002a01ccfc69$4db98030$e92c8090$@gmail.com>
Message-ID: <4F58A0F6.2070707@rabbitmq.com>

On 07/03/12 13:50, Anand Patel wrote:
> Does RabbitMQ supports the Message Grouping feature similar to the one
> that is available in HornetQ or ActiveMQ?

No, afraid not.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar  8 12:14:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 12:14:34 +0000
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
 week
In-Reply-To: <CALD4NQb0GPhT7DOnOUgPAoU3eVdgHPiSDnanm5K2xcoPR6G_=w@mail.gmail.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>	<4F549D3B.4050306@rabbitmq.com>	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>	<4F55EE76.2000206@rabbitmq.com>	<4F55F8BA.2050303@rabbitmq.com>
	<CALD4NQb0GPhT7DOnOUgPAoU3eVdgHPiSDnanm5K2xcoPR6G_=w@mail.gmail.com>
Message-ID: <4F58A2AA.30007@rabbitmq.com>

On 06/03/12 22:57, Brian Jing wrote:
> Hi Simon,
>
> We are using Erlang R14B04 on these servers.
>
> Our network is usually saturated by RabbitMQ traffic, probably partly
> because we don't have enough bandwidth, and partly because we've been
> using federation the wrong way (using same exchange for both up and
> downstream transfer). Not sure whether this could contribute to the
> issue. However, even if something bad happens with the network, isn't
> rabbit supposed to recover itself no matter what?

Yes, absolutely. And in my tests it does. But I'm not absolutely sure 
what is happening in your case; it seems to be something slightly less 
obvious than just dropping the network connection.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From eric at holtmans.com  Thu Mar  8 13:15:32 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 08 Mar 2012 07:15:32 -0600
Subject: [rabbitmq-discuss] SimpleAmqpClient speed?
Message-ID: <4F58B0F4.3080702@holtmans.com>

I've finally gotten everything working inside my
project (Thanks, Alan!).

I'm trying a small test now where I have one producer
and one consumer on a queue.  Running in Release mode
C++ (no debugging), I seem to top out around 3,700
messages/second.

Is that about what I should expect, or am I doing
something wrong?  I thought it should be higher.

I can believe (but have not yet profiled it) that I'm
losing throughput because of all the std::strings and
shared_ptrs.  If that's the case, I think that's just
the price I will have to pay for C++, unless I want
to drop down to using the underlying rabbitmq_c library.



Here's the guts of the producer:

	using namespace AmqpClient;
	Channel::ptr_t channel;
	channel = Channel::Create();

	channel->DeclareQueue("BasicReturnTestQueue", false, false, false, true);

	const std::string constant ("foo");
	try	{
		for (int i = 0; i < nmsgs; ++i) {
			BasicMessage::ptr_t the_message = BasicMessage::Create(constant);
			channel->BasicPublish("", "BasicReturnTestQueue", the_message, true,
false);
		}
		BasicMessage::ptr_t the_message = BasicMessage::Create("quit");
		channel->BasicPublish("", "BasicReturnTestQueue", the_message, true,
false);
	}
	catch (MessageReturnedException& e) {
		std::cout << "Message got returned: " << e.what();
		std::cout << "\nMessage body: " << e.message()->Body();
	}


And here's the consumer:

	using namespace AmqpClient;
	Channel::ptr_t channel;
	channel = Channel::Create();

	channel->DeclareQueue("BasicReturnTestQueue", false, false, false, true);
	channel->BasicConsume("BasicReturnTestQueue", "consumer_tag1", true,
true, true, 10);


	try {
		while (1) {
			Envelope::ptr_t env;
			if (channel->BasicConsumeMessage("consumer_tag1", env, 0)) {
				std::string msg = env->Message ()->Body ();
				if (msg == "quit") {
					return;
				}
			}
		}
	}
	catch (MessageReturnedException& e)
	{
		std::cout << "Message got returned: " << e.what();
		std::cout << "\nMessage body: " << e.message()->Body();
	}


From john at ibiblio.org  Thu Mar  8 14:30:34 2012
From: john at ibiblio.org (John Reuning)
Date: Thu, 8 Mar 2012 09:30:34 -0500
Subject: [rabbitmq-discuss] Lost message in 50k size range
In-Reply-To: <CACDr4ic9P2Up-Jw3Wrm6Yyynj0hxoRg=_LFPQhVkELn=dX6z_Q@mail.gmail.com>
References: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>
	<3CFC0A3F6AC54565AC2438C4D67B28CC@myyearbook.com>
	<CACDr4ic9P2Up-Jw3Wrm6Yyynj0hxoRg=_LFPQhVkELn=dX6z_Q@mail.gmail.com>
Message-ID: <CACDr4idTgnTE-2Txhy-dY5FWv+RMaa=9yk7vHtEjV+QE3haHvw@mail.gmail.com>

So, it looks like this was a flushing problem.  I either wasn't
closing the connection properly or was terminating the ioloop too
soon.  I fixed the message send problem but am now getting a warning
message from the callback manager.

/mnt/hgfs/devel/seedbank/seedbank/src/pika/callback.py:72:
UserWarning: CallbackManager.add: Duplicate callback found for
"0:Connection.CloseOk"
  (self.__class__.__name__, prefix, key))

It gives the warning regardless of whether or not I use
add_on_close_callback to specify my own callback function.  Any ideas
why this happens?

Here's the backtrace to the CallbackManager.add call that generates the message.

  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
line 124, in start
    self.poller.start()
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
line 374, in start
    self.poll()
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
line 388, in poll
    self._handler(events[0][0], events[0][1])
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/base_connection.py",
line 134, in _handle_events
    self._handle_read()
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/base_connection.py",
line 162, in _handle_read
    self._on_data_available(data)
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
line 589, in _on_data_available
    frame)                 # Args
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/callback.py", line
130, in process
    callback(*args, **keywords)
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
line 553, in _on_channel_close
    self._on_close_ready()
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
line 402, in _on_close_ready
    [spec.Connection.CloseOk])
  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
line 620, in _rpc
    self.callbacks.add(channel_number, reply, callback)


On Tue, Mar 6, 2012 at 1:13 PM, John Reuning <john at ibiblio.org> wrote:
> In this case, lost means the consumer never gets it. ?I have a test
> setup for debugging. ?Both publisher and consumer are python/pika.
> The publisher sends 2 messages -- one is a bson encoded python string
> of length 49144, the other is 49145. ?The consumer gets the first
> message but not the second. ?It's the same behavior for messages down
> to 1 byte and up to a few 100 KB. ?The failure point seems to be at
> this 49145 length.
>
> Other useful information may be that queue durability and message
> delivery mode settings don't affect the behavior. ?Also, your
> suggestion of publishing to a consumerless queue didn't result in a
> queued message, as far as I can tell.
>
> I'm using the management and tracing plugins, turned on tracing, and
> turned on pika debug logging. ?I can't find any errors or indication
> of why the message disappears or where it's going. ?I'm not sure I
> know the right places to look, though.

From l.rossi.cons at vitrociset.it  Thu Mar  8 16:37:31 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Thu, 8 Mar 2012 16:37:31 +0000
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
Message-ID: <5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>

Dear expert,
As I told you yesterday I'm working on a C++ application who uses RabbitMQ. I have a simple question for you: related to Channel.h, function BasicConsume() I read in the function comments
"Note: due to a limitation to how things are done, it is only possible to reliably have a single consumer per channel, calling this more than once per channel may result in undefined results from BasicConsumeMessage"
Is it something related only on the C++ implementation?

Last but not least, I think there are some mistakes in the example simple_connect.cpp


1.      #include <SimpleAmqpClient.h> should be #include < SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure copies that file in the SimpleAmqpClient folder;

2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage(); doesn't work for two reasons:

a.      A function BasicConsumeMessage() which takes no argument doesn't exist in Channel.h;

b.      The function BasicConsumeMessage(...) currently defined in Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t.

3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX header. I had to comment that row in order to make things work in Visual Studio 2008.


Best wishes,

Lorenzo




Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com]
Inviato: marted? 6 marzo 2012 17:23
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Oggetto: Re: [rabbitmq-discuss] how to build SimpleAmqpClient?

Did you build boost as a set of static libraries?  If so you'll need to set the Boost_USE_STATIC_LIBS=ON CMake variable.

Another note: given you're building with VS2008 you're going to run into a different problem once you get past the boost library issue you're having: see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what the issue is and a workaround.

-Alan
On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear Experts,
I'm trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008), but when I execute CMake, there are errors regarding boost:


CMake Error at C:/Program Files (x86)/CMake 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):

Unable to find the requested Boost libraries.

Boost version: 1.48.0

Boost include path: C:/Applicazioni/boost

The following Boost libraries could not be found:

boost_chrono

boost_system

No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the

directory containing Boost libraries or BOOST_ROOT to the location of

Boost.

Call Stack (most recent call first):

CMakeLists.txt:8 (FIND_PACKAGE)

I add manually the filepath for chrono and system to Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release, Boost_System_Library_Debug, Boost_ System_Library_Release, but still it doesn't find anything. I also create the BOOST_ROOT but still it doesn't work.
Any suggestion?

Best,

Lorenzo


Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/9183e937/attachment.htm>

From simon at rabbitmq.com  Thu Mar  8 16:44:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 16:44:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is unexpectedly eating up
	memory
In-Reply-To: <17283313.77.1331130418405.JavaMail.geo-discussion-forums@ynhs12>
References: <2d26cbf8-b2db-48ef-b896-f335b72403f2@q12g2000yqg.googlegroups.com>	<4F55F42E.7080908@rabbitmq.com>	<12833239.277.1331033934557.JavaMail.geo-discussion-forums@ynbo9>	<4F55FFED.7020605@rabbitmq.com>
	<17283313.77.1331130418405.JavaMail.geo-discussion-forums@ynhs12>
Message-ID: <4F58E1D8.7010601@rabbitmq.com>

Hi Ingo, thanks for this.

It looks like your Rabbit is somewhat overloaded. When some parts of the 
broker (e.g. channels or queues) can't keep up, messages can build up 
waiting to get into them - potentially in an unbounded way, sending 
memory use very high.

The good news is the next release (2.8.0, available very soon I hope) 
will contain an internal flow control mechanism to bound the amount of 
memory that can be used when this happens.

Cheers, Simon

On 07/03/12 14:26, ingo schramm wrote:
> Today it happened again. When Rabbit had about 13G RAM usage on one node
> (<1G is the usual number), I connected to the node and got some infos. I
> post these below. Unfortunately, I cannot see that much in the data
> since I do not know what the processes are doing exactly inside Rabbit.
>
> After a while the system seemed to recover but irritated clients started
> to connect in an unusual pattern and then - almost immediately - the RAM
> usage executed a Big Bang, up to 55G allocated, the machine began to
> swap ...
>
> Here is the dump of the 10 most memory consuming processes.
>
> (ram2 at tarazed)4> erlang:memory().
> [{total,14709955672},
> {processes,9701451024},
> {processes_used,9685449080},
> {system,5008504648},
> {atom,1318801},
> {atom_used,1286285},
> {binary,4901053992},
> {code,15227889},
> {ets,23180616}]
>
> [{{memory,1868315056},
> <0.21462.60>,
> [{current_function,{erl_eval,do_apply,5}},
> {initial_call,{erlang,apply,2}},
> {status,running},
> {message_queue_len,0},
> {messages,[]},
> {links,[<0.21461.60>]},
> {dictionary,[]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<18922.32.0>},
> {total_heap_size,233539280},
> {heap_size,116769640},
> {stack_size,88},
> {reductions,8019756},
> {garbage_collection,[{fullsweep_after,65535},{minor_gcs,1}]},
> {suspending,[]}]},
> {{memory,1826853040},
> <0.252.0>,
> [{current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,3},
> {messages,[{'$gen_cast',{notify_sent,<0.26233.60>}},
> {'$gen_cast',{ack,[128755027],<0.22877.60>}},
> {'$gen_cast',{unblock,<0.22877.60>}}]},
> {links,[#Port<0.162932>,<0.250.0>,#Port<0.4466>]},
> {dictionary,[{{ch,<0.30314.59>},
> {cr,1,<0.30314.59>,
> {token,<0.30313.59>,true},
> #Ref<0.0.913.261747>,
> {set,1,16,16,8,80,...},
> true,1}},
> {{ch,<0.11679.60>},
> {cr,1,<0.11679.60>,
> {token,<0.11678.60>,true},
> #Ref<0.0.916.161564>,
> {set,1,16,16,8,...},
> true,0}},
> {{ch,<0.29890.59>},
> {cr,1,<0.29890.59>,
> {token,<0.29889.59>,true},
> #Ref<0.0.913.256520>,
> {set,1,16,16,...},
> true,1}},
> {{ch,<0.24130.59>},
> {cr,1,<0.24130.59>,
> {token,<0.24129.59>,true},
> #Ref<0.0.912.149255>,
> {set,1,16,...},
> true,1}},
> {{ch,<0.21656.59>},
> {cr,1,<0.21656.59>,
> {token,<0.21655.59>,true},
> #Ref<0.0.911.188523>,
> {set,1,...},
> true,1}},
> {{ch,<0.15601.60>},
> {cr,1,<0.15601.60>,
> {token,<0.15600.60>,true},
> #Ref<0.0.917.100808>,
> {set,...},
> true,...}},
> {{ch,<15215.21015.63>},
> {cr,1,<15215.21015.63>,
> {token,<15215.21014.63>,...},
> #Ref<0.0.815.242631>,{...},...}},
> {{ch,<0.21015.12>},
> {cr,1,<0.21015.12>,{token,...},#Ref<0.0.295.125075>,...}},
> {{ch,<0.17432.59>},{cr,1,<0.17432.59>,{...},...}},
> {{ch,<0.9598.46>},{cr,1,<0.9598.46>,...}},
> {{ch,<15215.20479.63>},{cr,1,...}},
> {{ch,<0.24362.59>},{cr,...}},
> {{ch,...},{...}},
> {{...},...},
> {...}|...]},
> {trap_exit,true},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,228065700},
> {heap_size,228065700},
> {stack_size,48},
> {reductions,86360443586},
> {garbage_collection,[{fullsweep_after,65535},{minor_gcs,0}]},
> {suspending,[]}]},
> {{memory,544009512},
> <0.218.0>,
> [{registered_name,delegate_11},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,45210},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,67810415},
> {heap_size,8024355},
> {stack_size,32},
> {reductions,536435169},
> {garbage_collection,[{fullsweep_after,65535},{minor_gcs,1}]},
> {suspending,[]}]},
> {{memory,544003272},
> <0.213.0>,
> [{registered_name,delegate_6},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,45000},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_call',{<15215.4753.67>,
> {#Ref<15215.0.573.141891>,ram2 at tarazed}},
> {invoke,#Fun<rabbit_amqqueue.22.114209891>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,67810415},
> {heap_size,8024355},
> {stack_size,32},
> {reductions,492300563},
> {garbage_collection,[{fullsweep_after,65535},
> {minor_gcs,...}]},
> {suspending,[]}]},
> {{memory,543937016},
> <0.220.0>,
> [{registered_name,delegate_13},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,43117},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,67810415},
> {heap_size,8024355},
> {stack_size,32},
> {reductions,516829717},
> {garbage_collection,[{fullsweep_after,...},{...}]},
> {suspending,[]}]},
> {{memory,509272344},
> <0.208.0>,
> [{registered_name,delegate_1},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,36921},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_amqqueue.23.2473037>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,63501410},
> {heap_size,15672560},
> {stack_size,32},
> {reductions,481258527},
> {garbage_collection,[{...}|...]},
> {suspending,[]}]},
> {{memory,484092056},
> <0.209.0>,
> [{registered_name,delegate_2},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,33987},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,60366900},
> {heap_size,12538050},
> {stack_size,32},
> {reductions,439896730},
> {garbage_collection,[...]},
> {suspending,...}]},
> {{memory,383857832},
> <0.207.0>,
> [{registered_name,delegate_0},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,36015},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[<0.252.0>]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,47828850},
> {heap_size,47828850},
> {stack_size,32},
> {reductions,464166560},
> {garbage_collection,...},
> {...}]},
> {{memory,322186712},
> <0.214.0>,
> [{registered_name,delegate_7},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,25955},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,[...]}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,7}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,40160935},
> {heap_size,15672560},
> {stack_size,32},
> {reductions,...},
> {...}|...]},
> {{memory,245833600},
> <0.212.0>,
> [{registered_name,delegate_5},
> {current_function,{gen,wait_resp_mon,3}},
> {initial_call,{proc_lib,init_p,5}},
> {status,waiting},
> {message_queue_len,27354},
> {messages,[{'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{ram2 at tarazed,...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,
> [{...}]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,[...]}},
> {'$gen_cast',{invoke,#Fun<rabbit_router.0.66097277>,...}},
> {'$gen_cast',{invoke,...}},
> {'$gen_cast',{...}},
> {'$gen_cast',...},
> {...}|...]},
> {links,[<0.206.0>]},
> {dictionary,[{'$ancestors',[delegate_sup,rabbit_sup,
> <0.109.0>]},
> {'$initial_call',{gen,init_it,...}}]},
> {trap_exit,false},
> {error_handler,error_handler},
> {priority,normal},
> {group_leader,<0.108.0>},
> {total_heap_size,30610465},
> {heap_size,30610465},
> {stack_size,...},
> {...}|...]}]
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Am Dienstag, 6. M?rz 2012 13:15:41 UTC+1 schrieb Simon MacMullen:
>
>     On 06/03/12 11:38, ingo schramm wrote:
>      > I do *not* use a mirrored queue :)
>
>     Ah, right, that's how I read "queues distributed over all nodes".
>
>     Hmm. It's still easier to figure out the memory use of RabbitMQ on
>     2.7.1, but for 2.6.1 you could check per-queue memory use with
>     "rabbitmqctl list_queues name memory" (or look in mgmt). If this
>     doesn't
>     bring anything useful up then:
>
>     * Become the user the broker is running as
>     * Run "erl -sname foo -remsh rabbit@$(hostname -s)" to get a shell into
>     the running broker
>     * Invoke "erlang:memory()." for an overview of memory use in the VM.
>     * Invoke "lists:sublist(lists:reverse(lists:sort([{process_info(Pid,
>     memory), Pid, process_info(Pid)} || Pid <- processes()])), 10)." for a
>     lit of the top 10 memory using processes, and some information on
>     each one.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Thu Mar  8 17:00:15 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Mar 2012 12:00:15 -0500
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
Message-ID: <CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>

I recently reworked the internals of the library (thus the v2.0-beta tag)
and have not updated the code in the examples/ directory yet.

So you are correct simple_connect.cpp is broken currently.

To clarify: It is safe and reliable to have more than one consumer per
AmqpClient::Channel object.

-Alan

On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi
<l.rossi.cons at vitrociset.it>wrote:

>  Dear expert, ****
>
> As I told you yesterday I?m working on a C++ application who uses
> RabbitMQ. I have a simple question for you: related to Channel.h, function
> BasicConsume() I read in the function comments****
>
> ?Note: due to a limitation to how things are done, it is only possible to
> reliably have a single consumer per channel, calling this more than once
> per channel may result in undefined results from BasicConsumeMessage?****
>
> Is it something related only on the C++ implementation? ****
>
> ** **
>
> Last but not least, I think there are some mistakes in the example
> simple_connect.cpp****
>
> ** **
>
> **1.      **#include <SimpleAmqpClient.h> should be #include <
> SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure
> copies that file in the SimpleAmqpClient folder;****
>
> **2.      **BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage();
> doesn?t work for two reasons:****
>
> **a.      **A function BasicConsumeMessage() which takes no argument
> doesn?t exist in Channel.h;****
>
> **b.      **The function BasicConsumeMessage(?) currently defined in
> Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t. ****
>
> **3.      **Header file SimpleAmqpClient.h includes unistd.h which is a
> POSIX header. I had to comment that row in order to make things work in
> Visual Studio 2008. ****
>
> ** **
>
> ** **
>
> Best wishes,****
>
> ** **
>
> Lorenzo****
>
> ** **
>
> ** **
>
> ** **
>
> ** **
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
> ** **
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*
>
> ** **
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* marted? 6 marzo 2012 17:23
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Oggetto:* Re: [rabbitmq-discuss] how to build SimpleAmqpClient?****
>
> ** **
>
> Did you build boost as a set of static libraries?  If so you'll need to
> set the Boost_USE_STATIC_LIBS=ON CMake variable.****
>
> ** **
>
> Another note: given you're building with VS2008 you're going to run into a
> different problem once you get past the boost library issue you're having:
> see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what
> the issue is and a workaround.****
>
> ** **
>
> -Alan****
>
> On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Dear Experts,****
>
> I?m trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008),
> but when I execute CMake, there are errors regarding boost:****
>
>  ****
>
> CMake Error at C:/Program Files (x86)/CMake
> 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):****
>
> Unable to find the requested Boost libraries.****
>
> Boost version: 1.48.0****
>
> Boost include path: C:/Applicazioni/boost****
>
> The following Boost libraries could not be found:****
>
> boost_chrono****
>
> boost_system****
>
> No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the
> ****
>
> directory containing Boost libraries or BOOST_ROOT to the location of****
>
> Boost.****
>
> Call Stack (most recent call first):****
>
> CMakeLists.txt:8 (FIND_PACKAGE)****
>
>  ****
>
> I add manually the filepath for chrono and system to
> Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release,
> Boost_System_Library_Debug, Boost_ System_Library_Release, but still it
> doesn?t find anything. I also create the BOOST_ROOT but still it doesn?t
> work.****
>
> Any suggestion?****
>
>
> Best,****
>
>
> Lorenzo****
>
>  ****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/23a5d735/attachment.htm>

From eric at holtmans.com  Thu Mar  8 17:05:06 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 08 Mar 2012 11:05:06 -0600
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
Message-ID: <4F58E6C2.10602@holtmans.com>

On 3/8/2012 11:00 AM, Alan Antonuk wrote:
> 
> To clarify: It is safe and reliable to have more than one consumer per
> AmqpClient::Channel object.
> 

I thought this was not the case, since the underlying
C library didn't support it.  Quite willing to be wrong
there.

From jon at jbrisbin.com  Thu Mar  8 17:07:57 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 08 Mar 2012 11:07:57 -0600 (CST)
Subject: [rabbitmq-discuss] Riak <-> RabbitMQ integration
In-Reply-To: <CA+zYriRTfvCCb9KwXgwuDKf8--C0_7P_F50A+FKn_qzZoRpMQA@mail.gmail.com>
Message-ID: <533ae8b8-d99e-4a85-a6d5-9219ab2aa140@jbrisbin.local>



----- Original Message -----
> 
> I was sold on redis, and now I find that Rabbit has a riak exchange
> plugin. That's good, but this complicates things a little. I don't
> know much about Riak.
> 
> If you are pushing around binary, what's the method of providing an
> identity to Riak via a message?


You can either let it use the exchange name as the bucket and the routing key as the Riak key, or you can specify them in a message header (X-Riak-Bucket and X-Riak-Key respectively).


> I'd love to know the relative advantages of the different NOSQL
> solutions.


That is a very subjective topic that elicits passionate opinion on all sides. Good luck with that. ;)


> Last time I explored this BerkeleyDB was the solution...
> now I don't know the space well enough to form a solid opinion.


It has been a while, then! Things are much different in some ways and not so much in others. How's that for an informative answer? ;)


Thanks! 

Jon Brisbin 
http://about.me/jonbrisbin 

> 
> thanks,
> -Steven
> 
> On 16 April 2011 00:20, Jon Brisbin < jon at jbrisbin.com > wrote:
> 
> 
> 
> 
> 
> I've been carrying this evented datastore torch for a while now and
> been making pretty good progress in that direction. This evening I
> pushed a Riak postcommit hook to my github that sends updated
> entries to RabbitMQ using the Erlang AMQP client.
> 
> 
> 
> https://github.com/jbrisbin/riak-rabbitmq-commit-hooks
> 
> 
> This is the other half of the equation for the custom exchange type I
> wrote to push RabbitMQ messages into Riak.
> 
> 
> https://github.com/jbrisbin/riak-exchange
> 
> 
> This gets me one step closer to that evented datastore Nirvana I
> doubt is actually possible--but you gotta have a dream, right? :)
> 
> Thanks!
> 
> Jon Brisbin
> 
> http://jbrisbin.com
> Twitter: @j_brisbin
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 

From alan.antonuk at gmail.com  Thu Mar  8 17:16:02 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Mar 2012 12:16:02 -0500
Subject: [rabbitmq-discuss] SimpleAmqpClient speed?
In-Reply-To: <4F58B0F4.3080702@holtmans.com>
References: <4F58B0F4.3080702@holtmans.com>
Message-ID: <CAAt2poLQ_wA6n4QD_c=jB9iEQjAdBfJ94D0iDPv2udC0tA+5uw@mail.gmail.com>

I get approximately that performance (4000 messages/s) on 64-bit Windows 7,
with v2.7.1 of the RabbitMQ broker running R15B of Erlang, using the
loopback network interface, running on a 2.80GHz Xeon with memory bus
running at

Having done some minimal performance testing what is slow is the way I do
the BasicPublish.

What makes this slow is that I've enabled the publisher confirms part of
the AMQP protocol - so when I basic.publish a message to the broker, I wait
for the broker to 'deal' with the message and send a basic.ack back.  This
is slow.  I did this to take something that is inherently asynchronous
(basic.publish at its default is asynchonous, especially the way it handles
errors like publishing to a non-existent exchange) and wrap it in a
synchronous API.

If you break apart the publishing and consuming I can get ~4000 msg/s
publish, and ~65000 msg/s consume without worrying about acking messages:

#define BOOST_ALL_NO_LIB

#include <SimpleAmqpClient/SimpleAmqpClient.h>

#include <iostream>
#include <boost/timer/timer.hpp>
#include <stdlib.h>

using namespace AmqpClient;
int main()
{
    char* szBroker = getenv("AMQP_BROKER");
    Channel::ptr_t channel;
    if (szBroker != NULL)
        channel = Channel::Create(szBroker);
    else
        channel = Channel::Create();

channel->DeclareQueue("alanqueue");
channel->BindQueue("alanqueue", "amq.direct", "alankey");

BasicMessage::ptr_t msg_in = BasicMessage::Create();

msg_in->Body("This is a small message.");

  std::cerr << "Sending messages....";
  {
    boost::timer::auto_cpu_timer t;
    for (int i = 0; i < 100000; ++i)
    {
      channel->BasicPublish("amq.direct", "alankey", msg_in);
    }
  }
  std::cerr << "done.\n";

  std::cerr << "Receiving messages....";
std::string consumer = channel->BasicConsume("alanqueue", "consumertag");
  {
    boost::timer::auto_cpu_timer t;
    for (int i = 0; i < 100000; ++i)
    {
      channel->BasicConsumeMessage(consumer);
    }
  }
  std::cerr << "done.\n";
}


Output from this program:

Sending messages.... 24.938781s wall, 0.546003s user + 5.272834s system =
5.818837s CPU (23.3%)
done.
Receiving messages.... 0.165081s wall, 0.078001s user + 0.078001s system =
0.156001s CPU (94.5%)
done.

-Alan


On Thu, Mar 8, 2012 at 8:15 AM, Eric J. Holtman <eric at holtmans.com> wrote:

> I've finally gotten everything working inside my
> project (Thanks, Alan!).
>
> I'm trying a small test now where I have one producer
> and one consumer on a queue.  Running in Release mode
> C++ (no debugging), I seem to top out around 3,700
> messages/second.
>
> Is that about what I should expect, or am I doing
> something wrong?  I thought it should be higher.
>
> I can believe (but have not yet profiled it) that I'm
> losing throughput because of all the std::strings and
> shared_ptrs.  If that's the case, I think that's just
> the price I will have to pay for C++, unless I want
> to drop down to using the underlying rabbitmq_c library.
>
>
>
> Here's the guts of the producer:
>
>        using namespace AmqpClient;
>        Channel::ptr_t channel;
>        channel = Channel::Create();
>
>        channel->DeclareQueue("BasicReturnTestQueue", false, false, false,
> true);
>
>        const std::string constant ("foo");
>        try     {
>                for (int i = 0; i < nmsgs; ++i) {
>                        BasicMessage::ptr_t the_message =
> BasicMessage::Create(constant);
>                        channel->BasicPublish("", "BasicReturnTestQueue",
> the_message, true,
> false);
>                }
>                BasicMessage::ptr_t the_message =
> BasicMessage::Create("quit");
>                channel->BasicPublish("", "BasicReturnTestQueue",
> the_message, true,
> false);
>        }
>        catch (MessageReturnedException& e) {
>                std::cout << "Message got returned: " << e.what();
>                std::cout << "\nMessage body: " << e.message()->Body();
>        }
>
>
> And here's the consumer:
>
>        using namespace AmqpClient;
>        Channel::ptr_t channel;
>        channel = Channel::Create();
>
>        channel->DeclareQueue("BasicReturnTestQueue", false, false, false,
> true);
>        channel->BasicConsume("BasicReturnTestQueue", "consumer_tag1", true,
> true, true, 10);
>
>
>        try {
>                while (1) {
>                        Envelope::ptr_t env;
>                        if (channel->BasicConsumeMessage("consumer_tag1",
> env, 0)) {
>                                std::string msg = env->Message ()->Body ();
>                                if (msg == "quit") {
>                                        return;
>                                }
>                        }
>                }
>        }
>        catch (MessageReturnedException& e)
>        {
>                std::cout << "Message got returned: " << e.what();
>                std::cout << "\nMessage body: " << e.message()->Body();
>        }
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/21484776/attachment.htm>

From alan.antonuk at gmail.com  Thu Mar  8 17:24:05 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Mar 2012 12:24:05 -0500
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <4F58E6C2.10602@holtmans.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<4F58E6C2.10602@holtmans.com>
Message-ID: <CAAt2po+H78sY3yyGxg41Cw5byVekvw3tpq6iwLn6oQ3=s_r5AA@mail.gmail.com>

The rabbitmq-c doesn't provide much of an API for dealing with multiple
consumers (or heck the API for dealing with consuming from one consumer is
tedious at best).  That said if you're willing as a programmer to deal with
the library at a low level (mostly keeping track of frames that
are received from different amqp channels) there is nothing in the
rabbitmq-c library that prevents multiple consumers to be used.

-Alan

On Thu, Mar 8, 2012 at 12:05 PM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 3/8/2012 11:00 AM, Alan Antonuk wrote:
> >
> > To clarify: It is safe and reliable to have more than one consumer per
> > AmqpClient::Channel object.
> >
>
> I thought this was not the case, since the underlying
> C library didn't support it.  Quite willing to be wrong
> there.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/3e12a401/attachment.htm>

From eric at holtmans.com  Thu Mar  8 17:31:33 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 08 Mar 2012 11:31:33 -0600
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <CAAt2po+H78sY3yyGxg41Cw5byVekvw3tpq6iwLn6oQ3=s_r5AA@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>	<4F58E6C2.10602@holtmans.com>
	<CAAt2po+H78sY3yyGxg41Cw5byVekvw3tpq6iwLn6oQ3=s_r5AA@mail.gmail.com>
Message-ID: <4F58ECF5.90405@holtmans.com>

On 3/8/2012 11:24 AM, Alan Antonuk wrote:
> tedious at best).  That said if you're willing as a programmer to deal with
> the library at a low level (mostly keeping track of frames that
> are received from different amqp channels) there is nothing in the
> rabbitmq-c library that prevents multiple consumers to be used.
> 

Is SimpleAmqpClient doing that (keeping track of the frames)?

Or maybe I'm not understanding the different levels... you're
saying I can have two consumers on a channel, and that works,
but what you cannot have is two channels using the same TCP
connection?


From simon at rabbitmq.com  Thu Mar  8 17:55:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Mar 2012 17:55:07 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates: RabbitMQ
	2.7.9
Message-ID: <4F58F27B.5030209@rabbitmq.com>

Hi all.

We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next 
week), but I'd like to experiment with making preview or RC releases. So 
here's one.

The version is marked as 2.7.9 just because there are all sorts of 
restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever 
I think would stop the Windows installer from working). But think of it 
as a release candidate.

The intent is that this will be really quite close to the final release 
- this isn't so much a beta as a search for last minute showstoppers. If 
there aren't any such showstoppers then this may be identical to the 
2.8.0 release. But I wouldn't put it into production myself. You might 
be braver ;-)

You can download artefacts at:

http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/
http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/

I've attached release notes in the usual format.

Please, have a play with this and let us know if anything goes wrong for 
you...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.7.9.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/fc4e991c/attachment.txt>

From alan.antonuk at gmail.com  Thu Mar  8 18:02:53 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 8 Mar 2012 13:02:53 -0500
Subject: [rabbitmq-discuss] regarding SimpleAmqpClient
In-Reply-To: <4F58ECF5.90405@holtmans.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<4F58E6C2.10602@holtmans.com>
	<CAAt2po+H78sY3yyGxg41Cw5byVekvw3tpq6iwLn6oQ3=s_r5AA@mail.gmail.com>
	<4F58ECF5.90405@holtmans.com>
Message-ID: <CAAt2poK8659rjZ-=tUL8t4tjV1+t8uGfVt+7RYD1KX4FJf-eQA@mail.gmail.com>

Inlined:

On Thu, Mar 8, 2012 at 12:31 PM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 3/8/2012 11:24 AM, Alan Antonuk wrote:
> > tedious at best).  That said if you're willing as a programmer to deal
> with
> > the library at a low level (mostly keeping track of frames that
> > are received from different amqp channels) there is nothing in the
> > rabbitmq-c library that prevents multiple consumers to be used.
> >
>
> Is SimpleAmqpClient doing that (keeping track of the frames)?
>
> Yes.


> Or maybe I'm not understanding the different levels... you're
> saying I can have two consumers on a channel, and that works,
> but what you cannot have is two channels using the same TCP
> connection?
>

Each SimpleAmqpClient AmqpClient::Channel object has exactly 1 TCP
connection.

Depending on what you're doing with the AmqpClient::Channel object it will
have 1 or more AMQP Channels open (this is not visible to you as a user of
the library).

Each AmqpClient::Channel object may have 1 or more consumers.

The limitation you're probably thinking about is that neither rabbitmq-c
nor SimpleAmqpClient is thread-safe.  If you want to use a
AmqpClient::Channel from different threads you need to synchronize its
usage, or just use a different AmqpClient::Channel instance from each
thread.

_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/353678f2/attachment.htm>

From brendan at soundcloud.com  Thu Mar  8 18:23:36 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 8 Mar 2012 19:23:36 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <CAHZsVQbmH82Tpg8Xx2DO1C=qxXa7CWZjNvb57PsqYdfPouor-A@mail.gmail.com>

Totally game.

Thanks!

On Thu, Mar 8, 2012 at 6:55 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi all.
>
> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
> week), but I'd like to experiment with making preview or RC releases. So
> here's one.
>
> The version is marked as 2.7.9 just because there are all sorts of
> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever I
> think would stop the Windows installer from working). But think of it as a
> release candidate.
>
> The intent is that this will be really quite close to the final release -
> this isn't so much a beta as a search for last minute showstoppers. If
> there aren't any such showstoppers then this may be identical to the 2.8.0
> release. But I wouldn't put it into production myself. You might be braver
> ;-)
>
> You can download artefacts at:
>
> http://www.rabbitmq.com/**releases/rabbitmq-server/v2.7.**9/<http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-java-client/**v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-dotnet-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-erlang-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/>
>
> I've attached release notes in the usual format.
>
> Please, have a play with this and let us know if anything goes wrong for
> you...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/d9a1c407/attachment.htm>

From brett.r.cameron at gmail.com  Thu Mar  8 19:03:43 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 9 Mar 2012 08:03:43 +1300
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <CALPqkiqwAc7ZNqq0Cuc4pN3CWAtDk51No2HQ_NQ2s-3dvqK4_g@mail.gmail.com>

Will give it a spin.

Brett

On Fri, Mar 9, 2012 at 6:55 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi all.
>
> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
> week), but I'd like to experiment with making preview or RC releases. So
> here's one.
>
> The version is marked as 2.7.9 just because there are all sorts of
> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever I
> think would stop the Windows installer from working). But think of it as a
> release candidate.
>
> The intent is that this will be really quite close to the final release -
> this isn't so much a beta as a search for last minute showstoppers. If
> there aren't any such showstoppers then this may be identical to the 2.8.0
> release. But I wouldn't put it into production myself. You might be braver
> ;-)
>
> You can download artefacts at:
>
> http://www.rabbitmq.com/**releases/rabbitmq-server/v2.7.**9/<http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-java-client/**v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-dotnet-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-erlang-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/>
>
> I've attached release notes in the usual format.
>
> Please, have a play with this and let us know if anything goes wrong for
> you...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/819db8ec/attachment.htm>

From irmo.manie at gmail.com  Thu Mar  8 19:42:44 2012
From: irmo.manie at gmail.com (Irmo Manie)
Date: Thu, 8 Mar 2012 20:42:44 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <CAAcXTOaKMhmmrGZ8Hiw2rCuhGhw+G83+or5BEw5ToK=d2L6KTg@mail.gmail.com>

Thanks, there goes my Friday! :-)

On Thu, Mar 8, 2012 at 6:55 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Hi all.
>
> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
> week), but I'd like to experiment with making preview or RC releases. So
> here's one.
>
> The version is marked as 2.7.9 just because there are all sorts of
> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever I
> think would stop the Windows installer from working). But think of it as a
> release candidate.
>
> The intent is that this will be really quite close to the final release -
> this isn't so much a beta as a search for last minute showstoppers. If there
> aren't any such showstoppers then this may be identical to the 2.8.0
> release. But I wouldn't put it into production myself. You might be braver
> ;-)
>
> You can download artefacts at:
>
> http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/
> http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/
>
> I've attached release notes in the usual format.
>
> Please, have a play with this and let us know if anything goes wrong for
> you...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simone.busoli at gmail.com  Thu Mar  8 23:04:26 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 9 Mar 2012 00:04:26 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <CAOn7oW9NWGsE=__kq5hFhcy+dVDORhbsCmTKNB8s6sWJ5Y+xQw@mail.gmail.com>

Hi Simon, I wouldn't say it's really relevant but I've tried it out on a
branch of this project
here<https://github.com/simoneb/Roger/tree/rabbitmq_2.7.9> and
it passes the suite of automated tests.

On Thu, Mar 8, 2012 at 18:55, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi all.
>
> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
> week), but I'd like to experiment with making preview or RC releases. So
> here's one.
>
> The version is marked as 2.7.9 just because there are all sorts of
> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever I
> think would stop the Windows installer from working). But think of it as a
> release candidate.
>
> The intent is that this will be really quite close to the final release -
> this isn't so much a beta as a search for last minute showstoppers. If
> there aren't any such showstoppers then this may be identical to the 2.8.0
> release. But I wouldn't put it into production myself. You might be braver
> ;-)
>
> You can download artefacts at:
>
> http://www.rabbitmq.com/**releases/rabbitmq-server/v2.7.**9/<http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-java-client/**v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-dotnet-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/>
> http://www.rabbitmq.com/**releases/rabbitmq-erlang-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/>
>
> I've attached release notes in the usual format.
>
> Please, have a play with this and let us know if anything goes wrong for
> you...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/01c1ad68/attachment.htm>

From glen.wagley at gmail.com  Thu Mar  8 23:51:36 2012
From: glen.wagley at gmail.com (Glen Wagley)
Date: Thu, 8 Mar 2012 16:51:36 -0700
Subject: [rabbitmq-discuss] Connection and Channel Management
Message-ID: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>

I'm experimenting with rabbitmq to replace our current message queuing
implementation. Currently our test system is comprised of a REST web
service, a 3-node rabbitmq cluster, and a windows service. The REST service
acts as a front-end for our clients to send data to which then gets
published from the REST service to our rabbitmq cluster. The windows
service has multiple subscriber threads that consume the messages from the
cluster and do things like insert data from the message into a relational
database, send an email containing the message contents, etc.

Right now I am trying to figure out if I am limiting throughput to the
cluster because each instance of the REST service and each instance of the
windows service only has one connection to the cluster BUT multiple
channels. We support about two dozen message types right now and I've
created a channel for each one. Some channels have a lot of messages
flowing through while some have little to none depending on the day. Is
there a recommended approach to number of connections vs channels? We are
starting to load test the system and I am trying to understand what could
be tweaked to improve performance/throughput. Thanks.

-- 
Glen Wagley <glen.wagley at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/4c3b4639/attachment.htm>

From taylste at gmail.com  Fri Mar  9 06:36:35 2012
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 9 Mar 2012 06:36:35 +0000
Subject: [rabbitmq-discuss] Riak <-> RabbitMQ integration
In-Reply-To: <533ae8b8-d99e-4a85-a6d5-9219ab2aa140@jbrisbin.local>
References: <CA+zYriRTfvCCb9KwXgwuDKf8--C0_7P_F50A+FKn_qzZoRpMQA@mail.gmail.com>
	<533ae8b8-d99e-4a85-a6d5-9219ab2aa140@jbrisbin.local>
Message-ID: <CA+zYriQLg9j1zT6pBkkD3SLYNnWY9_pp_EhCtL6v4uxr5V8ybw@mail.gmail.com>

On 8 March 2012 17:07, Jon Brisbin <jon at jbrisbin.com> wrote:

>
>
> ----- Original Message -----
> >>
> >> I was sold on redis, and now I find that Rabbit has a riak exchange
> >> plugin. That's good, but this complicates things a little. I don't
> >> know much about Riak.
> >>
> >> If you are pushing around binary, what's the method of providing an
> >> identity to Riak via a message?
> > You can either let it use the exchange name as the bucket and the
> routing key as

the Riak key, or you can specify them in a message header (X-Riak-Bucket
> and X-Riak-Key respectively).
>

which rabbit tag do "X-Riak-Bucket" and "X-Riak-Key" these fit inside?

> I'd love to know the relative advantages of the different NOSQL
> solutions.

> That is a very subjective topic that elicits passionate opinion on all
> sides. Good luck with that. ;)
>

well thanks for not kicking that can.  There are so many passionate, and
not very objective opinions out there, I got tired from just seperating
noise from signal.

Probably not a big impact either way.  Just make a reasonable choice, and
plug and play later if needs dictate.  The Rabbit integration that you've
done makes Riak a strong contender.  Thanks for making this available.

>
>
> > Last time I explored this BerkeleyDB was the solution...
> > now I don't know the space well enough to form a solid opinion.
>
>
> It has been a while, then! Things are much different in some ways and not
> so much in others. How's that for an informative answer? ;)
>
really really helpful.  Once there was "internet time", are you measuring
in NOSQL-time?  In normal time, not that long.  ;-)

cheers,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/e93ea73e/attachment.htm>

From minaev at gmail.com  Fri Mar  9 07:57:54 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 9 Mar 2012 11:57:54 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4F577D3D.2020003@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
	<4EFDDC6E.8060200@rabbitmq.com>
	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>
	<4F564161.5040601@rabbitmq.com>
	<CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>
	<4F577D3D.2020003@rabbitmq.com>
Message-ID: <CANTUpDCYWUD_YxUaZGUz7VZzbWoGAUj72amAWYxVZdG=bhKEow@mail.gmail.com>

On 7 March 2012 19:22, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 07/03/12 08:57, Dmitri Minaev wrote:
>>
>> Yes, there's quite a lot of those 'failed to accept' messages.
>> Actually, this is the second time when Rabbit stops since installation
>> of that tcp_acceptor patch, and every time those messages appear in
>> large number.
>
>
> So there's few things going on here. The primary issue is that RabbitMQ is
> running out of file descriptors due to too many connections being opened,
> and for various reasons the internal accounting that is supposed to prevent
> this from causing harm is getting out of sync with reality. There are
> already improvements that will be coming in the next release that will
> improve this situation and we have some ideas for how to fix it altogether.
>
> But in the meantime you should look at increasing the number of file
> descriptors that are available to RabbitMQ.

Oh... Thanks. I thought, that if TCP connection is accepted, number of
file descriptors should have no effect on the further events, since
the socket already exists. Even now I can connect to port 5672 on that
server, but AMQP does not respond.

If I understand correctly, the number of file descriptors used by
RabbitMQ in normal situation is roughly equal to the number of
`rabbitmqctl list_connections` + some constant (~30)? In case of that
hanging server, the number of AMQP connections never was close to the
FD limit (ulimit -n is 1024, fs.file-max = 1605698). The graph
reflecting  the number of open AMQP connections is attached to this
message.

-- 
With best regards,
Dmitri Minaev
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_connections-month.png
Type: image/png
Size: 21291 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/9b2b9016/attachment.png>

From chen-hongqin at 163.com  Thu Mar  8 12:30:28 2012
From: chen-hongqin at 163.com (chen-hongqin)
Date: Thu, 8 Mar 2012 20:30:28 +0800
Subject: [rabbitmq-discuss] one exchange and different nodes
In-Reply-To: <4F589C85.8020202@rabbitmq.com>
References: <fe46cf6e-7deb-457a-abd6-975732f5e941@wb9g2000pbc.googlegroups.com><4F589C85.8020202@rabbitmq.com>
Message-ID: <5f682fb9.f0ffb.135f249f20f.Coremail.chen-hongqin@163.com>

Thanks, Simon.
If I want two non-mirrored queues and each of them is in different nodes, I can create two connections and declare them separately, is that right? Or does have any other convenient way to do this work in the cluster?


2012-03-08



chen-hongqin



On 08/03/12 04:07, Techq wrote: 
> hi, may be it is a simple question, but it puzzled me a lot. I am 
> setting up a RabbitMQ Cluster. My question is can i declare a exchange 
> which mapping to different nodes? In my case, there are several nodes, 
> like a at rabbit, b at rabbit, c at rabbit, and now i declare two queues which 
> bind with an exchange(just in the same Channel), so can these two 
> queues be in different nodes? 

I'm not sure I understand your question, but: 

* Exchanges live on all nodes by definition 
* Non-mirrored queues live on the node on which they were first declared 
* Mirrored queues live on whichever nodes their mirroring policy implies 
* Therefore declaring two non-mirrored queues on the same channel will  
put them on the same node 

Cheers, Simon 

--  
Simon MacMullen 
RabbitMQ, VMware 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/cc53dd68/attachment.htm>

From arpitasati22 at gmail.com  Thu Mar  8 21:59:24 2012
From: arpitasati22 at gmail.com (Arpita Sati)
Date: Thu, 8 Mar 2012 14:59:24 -0700
Subject: [rabbitmq-discuss] Rabbitmq, LDAP and SSL
In-Reply-To: <4F5892EA.8080006@rabbitmq.com>
References: <CAG9S_iRBwFZvzMr1TRS8J6A0rYoXHVXwMsfWHBLy_6-BGfPy5A@mail.gmail.com>
	<4F5892EA.8080006@rabbitmq.com>
Message-ID: <CAG9S_iREJZ4Su_QQXUSWbuU5hOxgJ3X7EYM5xytWVm5r4uicTQ@mail.gmail.com>

I am using SSL with no certificates,
rabbitmq.config file looks like -

[{rabbit, [
           {ssl_listeners, [5671]},
           {ssl_options, [{fail_if_no_peer_cert, false},
                          { verify, verify_none}
                         ]},
           {default_vhost, <<"/">>}
          ]}
].

Client code :
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
factory.setUsername("username");
 factory.setPassword("pswd");
factory.setPort(5671);
factory.useSslProtocol("TLS");
 connection = factory.newConnection();
channel = connection.createChannel();

on running client, I get following in log file -

=INFO REPORT==== 8-Mar-2012::14:55:00 ===
starting TCP connection <0.221.0> from <<XXXXXXXX>>

=ERROR REPORT==== 8-Mar-2012::14:55:00 ===
SSL: hello: ssl_handshake.erl:249:Fatal error: internal error

=ERROR REPORT==== 8-Mar-2012::14:55:00 ===
error on TCP connection <0.221.0>:{ssl_upgrade_error,"internal error"}

=INFO REPORT==== 8-Mar-2012::14:55:00 ===
closing TCP connection <0.221.0>

Thanks


On Thu, Mar 8, 2012 at 4:07 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/03/12 22:20, Arpita Sati wrote:
>
>> is "rabbitmq-auth-backend-ldap cannot use SSL " resolved in release 2.7.1?
>>
>
> Um, when was this broken? How is it not working for you?
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
*"To grow each day, is a wish not asked by all.*
*To love each day, is a privilege not taken by all."*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/459d4165/attachment.htm>

From arpitasati22 at gmail.com  Thu Mar  8 23:27:08 2012
From: arpitasati22 at gmail.com (Arpita Sati)
Date: Thu, 8 Mar 2012 16:27:08 -0700
Subject: [rabbitmq-discuss] Rabbitmq, LDAP and SSL
In-Reply-To: <CAG9S_iREJZ4Su_QQXUSWbuU5hOxgJ3X7EYM5xytWVm5r4uicTQ@mail.gmail.com>
References: <CAG9S_iRBwFZvzMr1TRS8J6A0rYoXHVXwMsfWHBLy_6-BGfPy5A@mail.gmail.com>
	<4F5892EA.8080006@rabbitmq.com>
	<CAG9S_iREJZ4Su_QQXUSWbuU5hOxgJ3X7EYM5xytWVm5r4uicTQ@mail.gmail.com>
Message-ID: <CAG9S_iSLz57AVwLBKAuER6_cm+saNXKeiBsVMTsGz=iDwZ61MA@mail.gmail.com>

its working now ...thanks

On Thu, Mar 8, 2012 at 2:59 PM, Arpita Sati <arpitasati22 at gmail.com> wrote:

> I am using SSL with no certificates,
> rabbitmq.config file looks like -
>
> [{rabbit, [
>            {ssl_listeners, [5671]},
>            {ssl_options, [{fail_if_no_peer_cert, false},
>                           { verify, verify_none}
>                          ]},
>            {default_vhost, <<"/">>}
>           ]}
> ].
>
> Client code :
> ConnectionFactory factory = new ConnectionFactory();
> factory.setHost("localhost");
> factory.setUsername("username");
>  factory.setPassword("pswd");
> factory.setPort(5671);
> factory.useSslProtocol("TLS");
>  connection = factory.newConnection();
> channel = connection.createChannel();
>
> on running client, I get following in log file -
>
> =INFO REPORT==== 8-Mar-2012::14:55:00 ===
> starting TCP connection <0.221.0> from <<XXXXXXXX>>
>
> =ERROR REPORT==== 8-Mar-2012::14:55:00 ===
> SSL: hello: ssl_handshake.erl:249:Fatal error: internal error
>
> =ERROR REPORT==== 8-Mar-2012::14:55:00 ===
> error on TCP connection <0.221.0>:{ssl_upgrade_error,"internal error"}
>
> =INFO REPORT==== 8-Mar-2012::14:55:00 ===
> closing TCP connection <0.221.0>
>
> Thanks
>
>
> On Thu, Mar 8, 2012 at 4:07 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 07/03/12 22:20, Arpita Sati wrote:
>>
>>> is "rabbitmq-auth-backend-ldap cannot use SSL " resolved in release
>>> 2.7.1?
>>>
>>
>> Um, when was this broken? How is it not working for you?
>>
>> Cheers, Simon
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
>
> --
> *"To grow each day, is a wish not asked by all.*
> *To love each day, is a privilege not taken by all."*
>
>


-- 
*"To grow each day, is a wish not asked by all.*
*To love each day, is a privilege not taken by all."*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120308/6bd32eb9/attachment.htm>

From ansh2201 at gmail.com  Fri Mar  9 08:03:44 2012
From: ansh2201 at gmail.com (Ankit Srivastava)
Date: Fri, 9 Mar 2012 00:03:44 -0800
Subject: [rabbitmq-discuss] Installation issues - RabbitMQ on Fedora (amazon
	ec2)
Message-ID: <CA+psgrMyjoiCrAL=qpqYGNbnptVgi5_nLFwvGotAjagGbY_iZg@mail.gmail.com>

Hi,

I am trying to install RabbitMQ on an amazon ec2 server. I installed erlang
(R15B) by compiling the source.

Version check of erl gives me -

[ec2-user at ip-XX-XXX-XXX-XX ec2-user]# erl
Erlang R15B (erts-5.9) [source] [async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.9  (abort with ^G)
1> erlang:system_info(otp_release).
"R15B"


While installing RabbitMQ through the RPM available on RabbitMQ site I am
getting the following error -

[ec2-user at ip-XX-XXX-XXX-XX ec2-user]# rpm -ivh
rabbitmq-server-2.7.1-1.noarch.rpm
error: Failed dependencies:
 erlang >= R12B-3 is needed by rabbitmq-server-2.7.1-1.noarch




Isnt R15B > R12B-3? Can someone help with me what step am I missing?


Regards,
Ankit



 ----------------------------------------------------------------
  Ankit Srivastava
  Graduate Student
  Department of Computer Science
  University of California Santa Barbara
  CA - 93106 USA
  Cell - +1-412-576-9775
  Email - ansh2201 at gmail.com, ankit at cs.ucsb.edu
 ----------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/1abcb8c6/attachment.htm>

From simon at rabbitmq.com  Fri Mar  9 11:36:30 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Mar 2012 11:36:30 +0000
Subject: [rabbitmq-discuss] Installation issues - RabbitMQ on Fedora
 (amazon ec2)
In-Reply-To: <CA+psgrMyjoiCrAL=qpqYGNbnptVgi5_nLFwvGotAjagGbY_iZg@mail.gmail.com>
References: <CA+psgrMyjoiCrAL=qpqYGNbnptVgi5_nLFwvGotAjagGbY_iZg@mail.gmail.com>
Message-ID: <4F59EB3E.1050808@rabbitmq.com>

On 09/03/12 08:03, Ankit Srivastava wrote:
> Isnt R15B > R12B-3? Can someone help with me what step am I missing?

RPM only knows about the dependencies it has itself installed. You 
should either install Erlang and RabbitMQ RPMs, following the 
instructions at http://www.rabbitmq.com/install-rpm.html (probably the 
preferred option), or install self compiled Erlang with the generic Unix 
tarball (http://www.rabbitmq.com/install-generic-unix.html).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Fri Mar  9 11:48:59 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Mar 2012 11:48:59 +0000
Subject: [rabbitmq-discuss] Connection and Channel Management
In-Reply-To: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
References: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
Message-ID: <CABzX+qyBepugavGO_6sCHPFsRN779Brp4_qyDW+5kkOrd6io-A@mail.gmail.com>

On Thu, Mar 8, 2012 at 23:51, Glen Wagley <glen.wagley at gmail.com> wrote:
> I'm experimenting with rabbitmq to replace our current message queuing
> implementation. Currently our test system is comprised of a REST web
> service, a 3-node rabbitmq cluster, and a windows service. The REST service
> acts as a front-end for our clients to send data to which then gets
> published from the REST service to our rabbitmq cluster. The windows service
> has multiple subscriber threads that consume the messages from the cluster
> and do things like insert data from the message into a relational database,
> send an email containing the message contents, etc.
>
> Right now I am trying to figure out if I am limiting throughput to the
> cluster because each instance of the REST service and each instance of the
> windows service only has one connection to the cluster BUT multiple
> channels. We support about two dozen message types right now and I've
> created a channel for each one. Some channels have a lot of messages flowing
> through while some have little to none depending on the day. Is there a
> recommended approach to number of connections vs channels? We are starting
> to load test the system and I am trying to understand what could be tweaked
> to improve performance/throughput. Thanks.

Glen,

There aren't any specific guidelines about connections vs channels.
Depending on the application, it may be more convenient to use
multiple connections or channels. Use what is more convenient.

Of course, if possible you should reduce number of
connections - connections consume constrained resources
(file descriptors).


Having said that there is one particular case when you could
benefit from having multiple connections.

In a situation when RabbitMQ runs of memory (high memory
watermark), it will stop accepting new messages. But due to the
limitations of AMQP protocol, it can't  be done on per-channel
basis - a full connection will be stopped in such case.

To rephrase - when rabbit runs out of memory the connections
on which messages are being published will be temporarily
throttled. You won't be able to do anything on that connection
until rabbit recovers - that includes consuming messages.

So, if you wish to be shielded against this situation, you
may want to keep publishers on a separate connection
than consumers. That will ensure that even in the
out-of-memory case the consumers will be able to do their
job (and thus help rabbitmq free memory faster)

Hope that helps,
  Marek

From simon at rabbitmq.com  Fri Mar  9 11:57:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Mar 2012 11:57:58 +0000
Subject: [rabbitmq-discuss] Connection and Channel Management
In-Reply-To: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
References: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
Message-ID: <4F59F046.3060401@rabbitmq.com>

On 08/03/12 23:51, Glen Wagley wrote:
> Right now I am trying to figure out if I am limiting throughput to the
> cluster because each instance of the REST service and each instance of
> the windows service only has one connection to the cluster BUT multiple
> channels. We support about two dozen message types right now and I've
> created a channel for each one. Some channels have a lot of messages
> flowing through while some have little to none depending on the day. Is
> there a recommended approach to number of connections vs channels? We
> are starting to load test the system and I am trying to understand what
> could be tweaked to improve performance/throughput. Thanks.

To some extent the answer is "do your own tests", but to get you 
thinking in the right direction, here are some pertinent facts:

* Starting a new channel on an existing connection involves one network 
round trip - starting a new connection takes several.

* Each connection uses a file descriptor on the server. Channels don't.

* Publishing a large message on one channel will block a connection 
while it goes out. Other than that, the multiplexing is fairly transparent.

* Connections which are publishing can get blocked if the server is 
overloaded - it's a good idea to separate publishing and consuming 
connections.

* There is only one AMQP parser process per connection. Therefore if you 
have less connections than CPU cores, and are CPU bound in AMQP parsing, 
you might not make full use of your server. This is generally pretty 
rare but sounds like it may apply to you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  9 12:01:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Mar 2012 12:01:45 +0000
Subject: [rabbitmq-discuss] Possible to keep consumed messages for
 certain period time (to replay..etc)
In-Reply-To: <CAGfOmyPKChg3LMmmuAxOYB=kDopUV=9=jAKqFGXLDrnF4vpHow@mail.gmail.com>
References: <CAGfOmyPKChg3LMmmuAxOYB=kDopUV=9=jAKqFGXLDrnF4vpHow@mail.gmail.com>
Message-ID: <4F59F129.5020306@rabbitmq.com>

There's no exact feature like that.

The closest thing would be to route messages to two queues, one for 
normal consuming and one for replay. The replay queue could have a 
message ttl so that it doesn't expand indefinitely.

You may also find Mike's Last Value Cache exchange interesting:

https://github.com/squaremo/rabbitmq-lvc-plugin

Cheers, Simon

On 08/03/12 09:25, Qing Yan wrote:
> Hi,
>
>     I am wondering in Rabbit MQ, can consumed messages be kept for
> certain period of time, so that it can be replayed later?
>
> According to the doc:
>
> :when should the AMQP broker remove messages from queues? The AMQP 0-9-1
> specification proposes two choices:
>
>     * After broker sends a message to an application (using either
>       basic.deliver or basic.get-ok AMQP methods).
>     * After the application sends back an acknowledgement (using
>       basic.ack AMQP method).
>
>
> (http://www.rabbitmq.com/tutorials/amqp-concepts.html)
>
> It seems not possible to do so. Basically what we need is :
>
> 1)  User to decide when to remove message from queue
>
> 2)  Replay message that has been consumed.
>
> Is Rabbit MQ suitable tool for such requirements?
>
> Thanks
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  9 12:37:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Mar 2012 12:37:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDCYWUD_YxUaZGUz7VZzbWoGAUj72amAWYxVZdG=bhKEow@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>	<4EFDAA72.9090605@rabbitmq.com>	<4EFDC47D.7060204@rabbitmq.com>	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>	<4EFDDC6E.8060200@rabbitmq.com>	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>	<4F564161.5040601@rabbitmq.com>	<CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>	<4F577D3D.2020003@rabbitmq.com>
	<CANTUpDCYWUD_YxUaZGUz7VZzbWoGAUj72amAWYxVZdG=bhKEow@mail.gmail.com>
Message-ID: <4F59F976.4060807@rabbitmq.com>

On 09/03/12 07:57, Dmitri Minaev wrote:
> Oh... Thanks. I thought, that if TCP connection is accepted, number of
> file descriptors should have no effect on the further events, since
> the socket already exists. Even now I can connect to port 5672 on that
> server, but AMQP does not respond.

I think at this point it hasn't actually allocated the FD, so it can't 
communicate.

> If I understand correctly, the number of file descriptors used by
> RabbitMQ in normal situation is roughly equal to the number of
> `rabbitmqctl list_connections` + some constant (~30)? In case of that
> hanging server, the number of AMQP connections never was close to the
> FD limit (ulimit -n is 1024, fs.file-max = 1605698). The graph
> reflecting  the number of open AMQP connections is attached to this
> message.

It's not really a constant, but to a first approximation, yes.

Ultimately, the error I saw being passed up from the OS was ENFILE - 
that's pretty unambiguous :)

It's possible that if you're churning connections then "closed" 
connections in FIN_WAIT2 could account for the majority of the used FDs. 
In 2.8.0 we'll set SO_LINGER to 0 to prevent this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From glen.wagley at gmail.com  Fri Mar  9 16:02:52 2012
From: glen.wagley at gmail.com (Glen Wagley)
Date: Fri, 9 Mar 2012 09:02:52 -0700
Subject: [rabbitmq-discuss] Connection and Channel Management
In-Reply-To: <CABzX+qyBepugavGO_6sCHPFsRN779Brp4_qyDW+5kkOrd6io-A@mail.gmail.com>
References: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
	<CABzX+qyBepugavGO_6sCHPFsRN779Brp4_qyDW+5kkOrd6io-A@mail.gmail.com>
Message-ID: <CAM=xcbMnBbqikMa2ccxkFcsBKqHn1YGTExuH7gFky+4j+VGZXQ@mail.gmail.com>

Thanks for the input. This is exactly the type of info I'm looking for!

On Fri, Mar 9, 2012 at 4:48 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Thu, Mar 8, 2012 at 23:51, Glen Wagley <glen.wagley at gmail.com> wrote:
> > I'm experimenting with rabbitmq to replace our current message queuing
> > implementation. Currently our test system is comprised of a REST web
> > service, a 3-node rabbitmq cluster, and a windows service. The REST
> service
> > acts as a front-end for our clients to send data to which then gets
> > published from the REST service to our rabbitmq cluster. The windows
> service
> > has multiple subscriber threads that consume the messages from the
> cluster
> > and do things like insert data from the message into a relational
> database,
> > send an email containing the message contents, etc.
> >
> > Right now I am trying to figure out if I am limiting throughput to the
> > cluster because each instance of the REST service and each instance of
> the
> > windows service only has one connection to the cluster BUT multiple
> > channels. We support about two dozen message types right now and I've
> > created a channel for each one. Some channels have a lot of messages
> flowing
> > through while some have little to none depending on the day. Is there a
> > recommended approach to number of connections vs channels? We are
> starting
> > to load test the system and I am trying to understand what could be
> tweaked
> > to improve performance/throughput. Thanks.
>
> Glen,
>
> There aren't any specific guidelines about connections vs channels.
> Depending on the application, it may be more convenient to use
> multiple connections or channels. Use what is more convenient.
>
> Of course, if possible you should reduce number of
> connections - connections consume constrained resources
> (file descriptors).
>
>
> Having said that there is one particular case when you could
> benefit from having multiple connections.
>
> In a situation when RabbitMQ runs of memory (high memory
> watermark), it will stop accepting new messages. But due to the
> limitations of AMQP protocol, it can't  be done on per-channel
> basis - a full connection will be stopped in such case.
>
> To rephrase - when rabbit runs out of memory the connections
> on which messages are being published will be temporarily
> throttled. You won't be able to do anything on that connection
> until rabbit recovers - that includes consuming messages.
>
> So, if you wish to be shielded against this situation, you
> may want to keep publishers on a separate connection
> than consumers. That will ensure that even in the
> out-of-memory case the consumers will be able to do their
> job (and thus help rabbitmq free memory faster)
>
> Hope that helps,
>  Marek
>



-- 
Glen Wagley <glen.wagley at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/7c3be482/attachment.htm>

From glen.wagley at gmail.com  Fri Mar  9 16:13:06 2012
From: glen.wagley at gmail.com (Glen Wagley)
Date: Fri, 9 Mar 2012 09:13:06 -0700
Subject: [rabbitmq-discuss] Connection and Channel Management
In-Reply-To: <4F59F046.3060401@rabbitmq.com>
References: <CAM=xcbNgHbpFrZniBLJ3NPW2Z3xVPT73aYxsrkGpk4BjGGWd+w@mail.gmail.com>
	<4F59F046.3060401@rabbitmq.com>
Message-ID: <CAM=xcbNw3WG_M3epsVggJkqnEX27KTribKd4qPBB-O2BgPE94g@mail.gmail.com>

Simon,
Thanks for the information. I expected that a lot of this would depend on
my particular implementation and that some of these things would become
apparent as we apply load to the system. The facts you have provided me are
excellent and will help shape the system moving forward. Thanks! Off to do
more testing...

On Fri, Mar 9, 2012 at 4:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/03/12 23:51, Glen Wagley wrote:
>
>> Right now I am trying to figure out if I am limiting throughput to the
>> cluster because each instance of the REST service and each instance of
>> the windows service only has one connection to the cluster BUT multiple
>> channels. We support about two dozen message types right now and I've
>> created a channel for each one. Some channels have a lot of messages
>> flowing through while some have little to none depending on the day. Is
>> there a recommended approach to number of connections vs channels? We
>> are starting to load test the system and I am trying to understand what
>> could be tweaked to improve performance/throughput. Thanks.
>>
>
> To some extent the answer is "do your own tests", but to get you thinking
> in the right direction, here are some pertinent facts:
>
> * Starting a new channel on an existing connection involves one network
> round trip - starting a new connection takes several.
>
> * Each connection uses a file descriptor on the server. Channels don't.
>
> * Publishing a large message on one channel will block a connection while
> it goes out. Other than that, the multiplexing is fairly transparent.
>
> * Connections which are publishing can get blocked if the server is
> overloaded - it's a good idea to separate publishing and consuming
> connections.
>
> * There is only one AMQP parser process per connection. Therefore if you
> have less connections than CPU cores, and are CPU bound in AMQP parsing,
> you might not make full use of your server. This is generally pretty rare
> but sounds like it may apply to you.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Glen Wagley <glen.wagley at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/91a1fab9/attachment.htm>

From timya15 at gmail.com  Fri Mar  9 17:10:46 2012
From: timya15 at gmail.com (Timya Timya)
Date: Fri, 9 Mar 2012 22:40:46 +0530
Subject: [rabbitmq-discuss] Federation binding to a queue
Message-ID: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>

As the federation plugin is used to consume the downstream messages. Is
there a way to create and bind the queues on both rabbitmq servers.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/dff2cdb2/attachment.htm>

From rev.chip at gmail.com  Fri Mar  9 18:42:06 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 9 Mar 2012 10:42:06 -0800 (PST)
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
	on slave nodes
In-Reply-To: <4F54EDC5.5010802@rabbitmq.com>
References: <4F454C42.4080400@gmail.com>
	<7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>
	<4F54EDC5.5010802@rabbitmq.com>
Message-ID: <e8eba840-8ff3-4375-b3dd-749c64617146@to5g2000pbc.googlegroups.com>

Indeed he is.  We're cycling through the sick cluster now, wiping
nodes in turn, to recover from this problem (and also increase disk
sizes).

On Mar 5, 8:45?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> Hi Max, thanks for writing. Are you the "local Erlang expert" Chip
> referred to?
>
> On 24/02/12 15:19, Max Kalika wrote:
>
> > 3) There was one process with over 2 million pages. ?It was constantly
> > running lists:zipwith/3. ?Info on it showed lots and lots of messages
> > in the mailbox that just wasn't decreasing.
>
> I don't suppose you have any record of what these messages were? Or any
> logs from around this time?
>
> > I mentioned earlier that the system is *mostly* recovered. ?The
> > remaining problem is disk utilization. ?I suspect that since our
> > messages are marked durable, disk cleanup didn't occur. ?I'm not sure
> > how to sync this up with runtime reality without restarting.
>
> So the only code in the rabbit codebase which invokes lists:zipwith/3 is
> the file_handle_cache. Hmm. Unfortunately it uses it in a rather generic
> location so this is still not exactly clear.
>
> This would help explain why disk cleanup didn't occur, since you killed
> something that was in the middle of doing some file handling.
>
> Hmm.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From virolord at gmail.com  Fri Mar  9 18:58:41 2012
From: virolord at gmail.com (Abhinav Jha)
Date: Sat, 10 Mar 2012 00:28:41 +0530
Subject: [rabbitmq-discuss] [rabbitmq-erlang-client] Missing 1 queue message
 after nodedown message from another node.
Message-ID: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>

Hi,

I have a small OTP App ( say node A), that subscribes to a RabbitMQ queue,
and also talks to another erlang node in another process ( node B ).

Now, sometimes the process hosting node B crashes for some reason, and my
node A gets a 'nodedown' message. Up till this point, consumption from
RabbitMQ works perfectly.

However, after my handle_info has finished processing the nodedown, if I
publish a message to the RabbitMQ queue, my app doesn't consume it.
However, all messages published after this one are consumed properly and
processed. However that 1 message remains in a message_unacknowledged state
in the queue, even though my handle_info refuses to have ever consumed it !

Is this a known issue in the client ? Can someone please help me ?

Rabbitmq server version : 2.7.1
Rabbitmq client version : 0.9.1 version of the AMQP protocol
Erlang: R15B

Thanks !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120310/76f35d37/attachment.htm>

From pbell at syncsort.com  Fri Mar  9 20:17:21 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 9 Mar 2012 15:17:21 -0500
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>
References: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FCF@MAILCCR.us.syncsort.com>

Hi All,

I have RabbitMQ running on a Windows Server 2008 R2 box.

I for the first time tried to add a new user. Seems to have worked, I can login to that user, etc.

I though, perhaps wrongly, that in response to adding a user I would see a rabbit.config file created (or updated) somewhere on my C:\ drive. I have noticed some RabbitMQ config info kept in C:\...\AppData\Roaming\RabbitMQ. But I can find no evidence of a rabbitmq.config file anywhere on the C:\ drive.

Can someone tell me where RabbitMQ keeps user and password info?

Thanks.

-Paul



________________________________


ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/45a45591/attachment.htm>

From jon at jbrisbin.com  Fri Mar  9 20:29:47 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 09 Mar 2012 14:29:47 -0600 (CST)
Subject: [rabbitmq-discuss] Riak <-> RabbitMQ integration
In-Reply-To: <CA+zYriQLg9j1zT6pBkkD3SLYNnWY9_pp_EhCtL6v4uxr5V8ybw@mail.gmail.com>
Message-ID: <039447f6-3513-4ea6-88c8-4f36e30ccf27@jbrisbin.local>



> >> If you are pushing around binary, what's the method of providing
> >> an
> >> identity to Riak via a message?
> > You can either let it use the exchange name as the bucket and the
> > routing key as
> 
> the Riak key, or you can specify them in a message header
> (X-Riak-Bucket and X-Riak-Key respectively).
> 
> 
> which rabbit tag do "X-Riak-Bucket" and "X-Riak-Key" these fit
> inside?


If using the Java client, you'd pass in arbitrary headers using the "AMQP.BasicProperties.Builder.headers(Map)" method: http://bit.ly/A4CWu3

In Ruby, you'd pass them on the publish: "exchange.publish(msg, :headers => { "X-Riak-Bucket" => "foo", "X-Riak-Key" => "fookey" })"


> > Last time I explored this BerkeleyDB was the solution...
> > now I don't know the space well enough to form a solid opinion.
> 
> 
> It has been a while, then! Things are much different in some ways and
> not so much in others. How's that for an informative answer? ;)
> 
> really really helpful. Once there was "internet time", are you
> measuring in NOSQL-time? In normal time, not that long. ;-)


Yes, NoSQL time is like dog years, only in months. So 7 months in NoSQL time is like 7 years anywhere else! :)

That said, there's lots and lots of things that haven't changed in 30 years. When you get down to it, it's still a key/value lookup and some things are very similar to what we were doing many years ago writing COBOL programs on CICS/mainframes. A few years ago, I worked pretty closely with some RPG programmers (AS/400) and they were pretty frustrated with our boss, who was trying to get them to learn to embed SQL into their programs (which they really hated...can't say as I blamed them...it was much uglier and didn't work as well as using a "set lower limit" and CHAIN) and just about the time they're starting to get the hang of that, I started talking about using NoSQL in our apps and they rightly recognized that that's exactly what they'd been doing for decades!

The new kids think this stuff is all flashy and fancy and uber-modern and us old fogeys (that is, those of us just barely over 35 ;) see this as somewhat of a cyclic return to a simpler and more effective way to handle data that isn't altogether different from what it was like when we first started writing PC apps using FoxPro and dBase. :)

Thanks! 

Jon Brisbin 
http://about.me/jonbrisbin 

From jerryk at vmware.com  Fri Mar  9 21:05:58 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 9 Mar 2012 13:05:58 -0800 (PST)
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FCF@MAILCCR.us.syncsort.com>
Message-ID: <82348a6f-30d0-42c3-aea7-e9622cc8c465@strongmad.batnest.org>

Hi, Paul:

User names and passwords are actually stored in the Erlang/OTP
Mnesia database that Rabbit uses.  Its location in the filesystem
varies depending on what platform you're running on, and whether
you've told it to go somewhere other than its platform specific
default.

The details by platform are summarized here:

http://www.rabbitmq.com/configure.html

On Windows you'll find the rabbitmq.config file, which you'd use
if you wanted to move Mnesia elsewhere in %RABBITMQ_BASE%.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 9, 2012 12:17:21 PM
Subject: [rabbitmq-discuss] Configuring Users






Hi All, 



I have RabbitMQ running on a Windows Server 2008 R2 box. 



I for the first time tried to add a new user. Seems to have worked, I can login to that user, etc. 



I though, perhaps wrongly, that in response to adding a user I would see a rabbit.config file created (or updated) somewhere on my C:\ drive. I have noticed some RabbitMQ config info kept in C:\...\AppData\Roaming\RabbitMQ. But I can find no evidence of a rabbitmq.config file anywhere on the C:\ drive. 



Can someone tell me where RabbitMQ keeps user and password info? 



Thanks. 



-Paul 







ATTENTION: ----- 

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control. 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Fri Mar  9 21:29:04 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 9 Mar 2012 16:29:04 -0500
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <82348a6f-30d0-42c3-aea7-e9622cc8c465@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FCF@MAILCCR.us.syncsort.com>
	<82348a6f-30d0-42c3-aea7-e9622cc8c465@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FE6@MAILCCR.us.syncsort.com>

Jerry, thank you.

But let me make sure I understand: user names and passwords are NOT in rabbitmq.config; for Windows, rabbitmq.config will be in %APPDATA%\RabbitMQ\.

I see no rabbitmq.config in %APPDATA%\RabbitMQ\. I can only conclude from this that its presence is not required if all default configuration values are in effect (my case, I think).

Here's what's behind my question: I am thinking about the use of site-specific passwords, i.e., I don't want to ship a product to multiple customers and have these multiple instances of Rabbit share a common password for a fixed username. 

Let's suppose that I have a means of generating, encrypting, and saving to disk a site-specific password for this fixed Rabbit user (maybe the username, common to all installations, is "syncsortRabbit" - whatever). Rabbit login code would then have to read the password from disk, decrypt it, and then convey it via connectionFactory.setPassword().

From another perspective, I cannot distribute a product whose Rabbit component has a pre-configured user all of whose passwords are identical. That is, each copy can have user "syncsortRabbit" and each can have an initial fixed password, but I would need a way to change that password to make it site-specific.

Perhaps, after generating a site-specific password, I could accomplish this via rabbitmqctl add_user.....?

Grateful for any ideas - thanks.

-Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Friday, March 09, 2012 4:06 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuring Users

Hi, Paul:

User names and passwords are actually stored in the Erlang/OTP
Mnesia database that Rabbit uses.  Its location in the filesystem
varies depending on what platform you're running on, and whether
you've told it to go somewhere other than its platform specific
default.

The details by platform are summarized here:

http://www.rabbitmq.com/configure.html

On Windows you'll find the rabbitmq.config file, which you'd use
if you wanted to move Mnesia elsewhere in %RABBITMQ_BASE%.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 9, 2012 12:17:21 PM
Subject: [rabbitmq-discuss] Configuring Users






Hi All, 



I have RabbitMQ running on a Windows Server 2008 R2 box. 



I for the first time tried to add a new user. Seems to have worked, I can login to that user, etc. 



I though, perhaps wrongly, that in response to adding a user I would see a rabbit.config file created (or updated) somewhere on my C:\ drive. I have noticed some RabbitMQ config info kept in C:\...\AppData\Roaming\RabbitMQ. But I can find no evidence of a rabbitmq.config file anywhere on the C:\ drive. 



Can someone tell me where RabbitMQ keeps user and password info? 



Thanks. 



-Paul 







ATTENTION: ----- 

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control. 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Fri Mar  9 21:40:29 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 9 Mar 2012 13:40:29 -0800 (PST)
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FE6@MAILCCR.us.syncsort.com>
Message-ID: <9876841a-3dff-4e93-8934-c8eacd193c19@strongmad.batnest.org>

Hi, Paul... answers inline:

> But let me make sure I understand: user names and passwords are NOT in 
> rabbitmq.config; for Windows, rabbitmq.config will be in %APPDATA%\RabbitMQ\.

By default, that shoudl be the case, yes.

> I see no rabbitmq.config in %APPDATA%\RabbitMQ\. I can only conclude from this that > its presence is not required if all default configuration values are in effect (my case, I > think).

Rabbit can live without a file there.  If you enable RABBITMQ_CONSOLE_LOG as per this page:

http://www.rabbitmq.com/configure.html

you can look at the RabbitMQ startup blurb.  It will print a line prefaced with "config file(s):" that will tell you what, if any config files it used when starting up.  See the "Verify Configuration" of the above page for details.

> Here's what's behind my question: I am thinking about the use of site-specific
> passwords, i.e., I don't want to ship a product to multiple customers and have these
> multiple instances of Rabbit share a common password for a fixed username.

Sounds very reasonable.

> Let's suppose that I have a means of generating, encrypting, and saving to disk a
> site-specific password for this fixed Rabbit user (maybe the username, common to all > installations, is "syncsortRabbit" - whatever). Rabbit login code would then have 
> to read
> the password from disk, decrypt it, and then convey it via
> connectionFactory.setPassword().

And also of course get an appropriate user created in the broker with known name and matching password, but yes indeed.

> From another perspective, I cannot distribute a product whose Rabbit component has a > pre-configured user all of whose passwords are identical. That is, each copy can have > user "syncsortRabbit" and each can have an initial fixed password, but I would need a > way to change that password to make it site-specific.
>
> Perhaps, after generating a site-specific password, I could accomplish this via
> rabbitmqctl add_user.....?

You absolutely could do that.   Details depend on how you're distributing Rabbit and how you're doing the per-user customization.  You could imagine giving your customers a run-once, initial provisioning scripts that creates users/passwords that your system needs for example.

Best regards,
Jerry

From pbell at syncsort.com  Fri Mar  9 21:41:59 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 9 Mar 2012 16:41:59 -0500
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <9876841a-3dff-4e93-8934-c8eacd193c19@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FE6@MAILCCR.us.syncsort.com>
	<9876841a-3dff-4e93-8934-c8eacd193c19@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FEB@MAILCCR.us.syncsort.com>

Thank you, Sir.

Most helpful.

Cordially,

Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Friday, March 09, 2012 4:40 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuring Users

Hi, Paul... answers inline:

> But let me make sure I understand: user names and passwords are NOT in
> rabbitmq.config; for Windows, rabbitmq.config will be in %APPDATA%\RabbitMQ\.

By default, that shoudl be the case, yes.

> I see no rabbitmq.config in %APPDATA%\RabbitMQ\. I can only conclude from this that > its presence is not required if all default configuration values are in effect (my case, I > think).

Rabbit can live without a file there.  If you enable RABBITMQ_CONSOLE_LOG as per this page:

http://www.rabbitmq.com/configure.html

you can look at the RabbitMQ startup blurb.  It will print a line prefaced with "config file(s):" that will tell you what, if any config files it used when starting up.  See the "Verify Configuration" of the above page for details.

> Here's what's behind my question: I am thinking about the use of site-specific
> passwords, i.e., I don't want to ship a product to multiple customers and have these
> multiple instances of Rabbit share a common password for a fixed username.

Sounds very reasonable.

> Let's suppose that I have a means of generating, encrypting, and saving to disk a
> site-specific password for this fixed Rabbit user (maybe the username, common to all > installations, is "syncsortRabbit" - whatever). Rabbit login code would then have
> to read
> the password from disk, decrypt it, and then convey it via
> connectionFactory.setPassword().

And also of course get an appropriate user created in the broker with known name and matching password, but yes indeed.

> From another perspective, I cannot distribute a product whose Rabbit component has a > pre-configured user all of whose passwords are identical. That is, each copy can have > user "syncsortRabbit" and each can have an initial fixed password, but I would need a > way to change that password to make it site-specific.
>
> Perhaps, after generating a site-specific password, I could accomplish this via
> rabbitmqctl add_user.....?

You absolutely could do that.   Details depend on how you're distributing Rabbit and how you're doing the per-user customization.  You could imagine giving your customers a run-once, initial provisioning scripts that creates users/passwords that your system needs for example.

Best regards,
Jerry



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From virolord at gmail.com  Fri Mar  9 22:56:34 2012
From: virolord at gmail.com (avnv)
Date: Fri, 9 Mar 2012 14:56:34 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-erlang-client - missing 1 message from
 queue ( consuming but not delivering to the subscribed process )
Message-ID: <12711412.877.1331333794925.JavaMail.geo-discussion-forums@pbcgf10>

Hi All,


I have a small OTP App ( say node A), that subscribes to a RabbitMQ queue, 
and also talks to another erlang node in another process ( node B ).

Now, sometimes the process hosting node B crashes for some reason, and my 
node A gets a 'nodedown' message. Up till this point, consumption from 
RabbitMQ works perfectly. 

However, after my handle_info has finished processing the nodedown, if I 
publish a message to the RabbitMQ queue, my app doesn't consume it. 
However, all messages published after this one are consumed properly and 
processed. However that 1 message remains in a message_unacknowledged state 
in the queue, even though my handle_info refuses to have ever consumed it !

i.e: it looks like the message is being consumed from the queue, but not 
delivered to the subscribed erlang process ( in case of my app, the 
handle_info function ). 

Is this a known issue in the client ? Can someone please help me with this ?

Rabbitmq server version : 2.7.1
Rabbitmq client version : 0.9.1 version of the AMQP protocol
Erlang: R15B 


----------------
Since the other thread where I asked this was sorta hijacked, I'm creating 
a new thread for this in case someone ends up seeing this.
-----------

Thanks !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120309/8f60c469/attachment.htm>

From taylste at gmail.com  Sat Mar 10 07:00:51 2012
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 10 Mar 2012 07:00:51 +0000
Subject: [rabbitmq-discuss] Riak <-> RabbitMQ integration
In-Reply-To: <039447f6-3513-4ea6-88c8-4f36e30ccf27@jbrisbin.local>
References: <CA+zYriQLg9j1zT6pBkkD3SLYNnWY9_pp_EhCtL6v4uxr5V8ybw@mail.gmail.com>
	<039447f6-3513-4ea6-88c8-4f36e30ccf27@jbrisbin.local>
Message-ID: <CA+zYriQX=yPMHDkPu1u5CAr9R2GwCLdPQcQatkCBwQGa7WK56Q@mail.gmail.com>

I agree... but it's not a politically correct thing to say.  ;-)  There
were people around in the 50s and 60s doing smart stuff in memory
constrained environments.  I have heard of research papers from that time
frame being referenced for work now.  It's very retro.  Though under the
radar, thankfully it isn't completely unappreciated.
On 9 March 2012 20:29, Jon Brisbin <jon at jbrisbin.com> wrote:

>
>
> > >> If you are pushing around binary, what's the method of providing
> > >> an
> > >> identity to Riak via a message?
> > > You can either let it use the exchange name as the bucket and the
> > > routing key as
> >
> > the Riak key, or you can specify them in a message header
> > (X-Riak-Bucket and X-Riak-Key respectively).
> >
> >
> > which rabbit tag do "X-Riak-Bucket" and "X-Riak-Key" these fit
> > inside?
>
>
> If using the Java client, you'd pass in arbitrary headers using the
> "AMQP.BasicProperties.Builder.headers(Map)" method: http://bit.ly/A4CWu3
>
> In Ruby, you'd pass them on the publish: "exchange.publish(msg, :headers
> => { "X-Riak-Bucket" => "foo", "X-Riak-Key" => "fookey" })"
>
>
> > > Last time I explored this BerkeleyDB was the solution...
> > > now I don't know the space well enough to form a solid opinion.
> >
> >
> > It has been a while, then! Things are much different in some ways and
> > not so much in others. How's that for an informative answer? ;)
> >
> > really really helpful. Once there was "internet time", are you
> > measuring in NOSQL-time? In normal time, not that long. ;-)
>
>
> Yes, NoSQL time is like dog years, only in months. So 7 months in NoSQL
> time is like 7 years anywhere else! :)
>
> That said, there's lots and lots of things that haven't changed in 30
> years. When you get down to it, it's still a key/value lookup and some
> things are very similar to what we were doing many years ago writing COBOL
> programs on CICS/mainframes. A few years ago, I worked pretty closely with
> some RPG programmers (AS/400) and they were pretty frustrated with our
> boss, who was trying to get them to learn to embed SQL into their programs
> (which they really hated...can't say as I blamed them...it was much uglier
> and didn't work as well as using a "set lower limit" and CHAIN) and just
> about the time they're starting to get the hang of that, I started talking
> about using NoSQL in our apps and they rightly recognized that that's
> exactly what they'd been doing for decades!
>
> The new kids think this stuff is all flashy and fancy and uber-modern and
> us old fogeys (that is, those of us just barely over 35 ;) see this as
> somewhat of a cyclic return to a simpler and more effective way to handle
> data that isn't altogether different from what it was like when we first
> started writing PC apps using FoxPro and dBase. :)
>
> Thanks!
>
> Jon Brisbin
> http://about.me/jonbrisbin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120310/55f8d1b8/attachment.htm>

From zabrane3 at gmail.com  Sat Mar 10 18:26:55 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Sat, 10 Mar 2012 19:26:55 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>

Hi there,

I've a set (~1 million) of high resolution PNG files  each one between 100MB and 1GB size.
I'd like to know if RabbitMQ is capable of handling such files as messages?

What's the max allowed message size?

Thx ...

Regards,
Zabrane

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120310/7afa995d/attachment.htm>

From jerryk at vmware.com  Sat Mar 10 18:34:43 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Sat, 10 Mar 2012 10:34:43 -0800 (PST)
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
Message-ID: <D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>

Hi, Zabrane:  In theory the AMQP protocol IIRC allows crazy large message payloads (2^64 bytes I believe).  In practice though, that's madness since you end up with potential copying and buffering along the way that could make a broker very unhealthy.

For moving bulk binary data as in your app, you'd be wise to fragment at the producer and reassemble at the destination/consumer. Keeping your chunks in the 100KB range might be a decent place to start experimenting.  

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Mar 10, 2012, at 10:28 AM, Zabrane Mickael <zabrane3 at gmail.com> wrote:

> Hi there,
> 
> I've a set (~1 million) of high resolution PNG files  each one between 100MB and 1GB size.
> I'd like to know if RabbitMQ is capable of handling such files as messages?
> 
> What's the max allowed message size?
> 
> Thx ...
> 
> Regards,
> Zabrane
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120310/ae93aea4/attachment.htm>

From zabrane3 at gmail.com  Sat Mar 10 19:46:31 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Sat, 10 Mar 2012 20:46:31 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
Message-ID: <70117899-BD8D-4A70-B6F7-9EB2B7CEF54B@gmail.com>

Thanks Jerry.

I'll experiment with that advice and come back soon.

Regards,
Zabrane

On Mar 10, 2012, at 7:34 PM, Jerry Kuch wrote:

> Hi, Zabrane:  In theory the AMQP protocol IIRC allows crazy large message payloads (2^64 bytes I believe).  In practice though, that's madness since you end up with potential copying and buffering along the way that could make a broker very unhealthy.
> 
> For moving bulk binary data as in your app, you'd be wise to fragment at the producer and reassemble at the destination/consumer. Keeping your chunks in the 100KB range might be a decent place to start experimenting.  
> 
> Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
> 
> 
> On Mar 10, 2012, at 10:28 AM, Zabrane Mickael <zabrane3 at gmail.com> wrote:
> 
>> Hi there,
>> 
>> I've a set (~1 million) of high resolution PNG files  each one between 100MB and 1GB size.
>> I'd like to know if RabbitMQ is capable of handling such files as messages?
>> 
>> What's the max allowed message size?
>> 
>> Thx ...
>> 
>> Regards,
>> Zabrane
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120310/364dfd36/attachment.htm>

From carl.hoerberg at gmail.com  Sun Mar 11 18:05:43 2012
From: carl.hoerberg at gmail.com (=?UTF-8?Q?Carl_H=C3=B6rberg?=)
Date: Sun, 11 Mar 2012 11:05:43 -0700 (PDT)
Subject: [rabbitmq-discuss] SSL w/ intermediate certificate
Message-ID: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>

Can I somehow include an intermediate certificate in the certfile?

when i try i get the following error in the rabbitmq log when i access the 
management interface: 


=ERROR REPORT==== 11-Mar-2012::14:44:02 ===
SSL: 1084: error:[...skipping...] /etc/rabbitmq/ssl.pem
  [{ssl_connection,init_certificates,5},
   {ssl_connection,ssl_init,2},
   {ssl_connection,init,1},
   {gen_fsm,init_it,6},
   {proc_lib,init_p_do_apply,3}]


=ERROR REPORT==== 11-Mar-2012::17:29:15 ===
    application: mochiweb
    "Accept failed error"
    "{error,ecertfile}"



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120311/94ea6192/attachment.htm>

From zabrane3 at gmail.com  Mon Mar 12 06:33:25 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Mon, 12 Mar 2012 07:33:25 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
Message-ID: <01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>

Hi guys,

Before trying to rewrite the wheel, anyone faced this problem before and would like to
share some code (ie. splitting a big file are constructing it when reading from RabbitMQ queue)?

Thanks ...

Regards,
Zabrane


On Mar 10, 2012, at 7:34 PM, Jerry Kuch wrote:

> Hi, Zabrane:  In theory the AMQP protocol IIRC allows crazy large message payloads (2^64 bytes I believe).  In practice though, that's madness since you end up with potential copying and buffering along the way that could make a broker very unhealthy.
> 
> For moving bulk binary data as in your app, you'd be wise to fragment at the producer and reassemble at the destination/consumer. Keeping your chunks in the 100KB range might be a decent place to start experimenting.  
> 
> Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
> 
> 
> On Mar 10, 2012, at 10:28 AM, Zabrane Mickael <zabrane3 at gmail.com> wrote:
> 
>> Hi there,
>> 
>> I've a set (~1 million) of high resolution PNG files  each one between 100MB and 1GB size.
>> I'd like to know if RabbitMQ is capable of handling such files as messages?
>> 
>> What's the max allowed message size?
>> 
>> Thx ...
>> 
>> Regards,
>> Zabrane
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/c278c47d/attachment.htm>

From josh at gebaschtel.ch  Mon Mar 12 08:24:40 2012
From: josh at gebaschtel.ch (Josh Geisser)
Date: Mon, 12 Mar 2012 08:24:40 +0000
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>
Message-ID: <B8B68C3D41791846910BA4C7AF61D25B02CDA6@ganymede.gebaschtel.bnet>

No code avilable anymore but I used to test >=512MB messages, no problems at all.
(Except of coarse it takes ages to upload/download, and getting any %-complete is almost impossible)

Used py-AMQP then.

FYI & cheers
Josh

________________________________
Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von Zabrane Mickael
Gesendet: Montag, 12. M?rz 2012 07:33
An: Jerry Kuch
Cc: rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?

Hi guys,

Before trying to rewrite the wheel, anyone faced this problem before and would like to
share some code (ie. splitting a big file are constructing it when reading from RabbitMQ queue)?

Thanks ...

Regards,
Zabrane


On Mar 10, 2012, at 7:34 PM, Jerry Kuch wrote:


Hi, Zabrane:  In theory the AMQP protocol IIRC allows crazy large message payloads (2^64 bytes I believe).  In practice though, that's madness since you end up with potential copying and buffering along the way that could make a broker very unhealthy.

For moving bulk binary data as in your app, you'd be wise to fragment at the producer and reassemble at the destination/consumer. Keeping your chunks in the 100KB range might be a decent place to start experimenting.

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Mar 10, 2012, at 10:28 AM, Zabrane Mickael <zabrane3 at gmail.com<mailto:zabrane3 at gmail.com>> wrote:
Hi there,

I've a set (~1 million) of high resolution PNG files  each one between 100MB and 1GB size.
I'd like to know if RabbitMQ is capable of handling such files as messages?

What's the max allowed message size?

Thx ...

Regards,
Zabrane

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




--
----
ASG at hnet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/bf7dcf85/attachment.htm>

From michael.s.klishin at gmail.com  Mon Mar 12 08:28:26 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 12 Mar 2012 12:28:26 +0400
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>
Message-ID: <F98AA533-AC4E-42C1-B115-F255035E6128@gmail.com>

Zabrane Mickael:

> Before trying to rewrite the wheel, anyone faced this problem before and would like to
> share some code (ie. splitting a big file are constructing it when reading from RabbitMQ queue)?

You can use Nanite's file streaming implementation as example:
https://github.com/ruby-amqp/nanite/blob/master/lib/nanite/streaming.rb

Keep in mind that the project is old but the chunking part is just as relevant
today.

MK


From rtrlists at googlemail.com  Mon Mar 12 08:37:09 2012
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 12 Mar 2012 08:37:09 +0000
Subject: [rabbitmq-discuss] [rabbitmq-erlang-client] Missing 1 queue
 message after nodedown message from another node.
In-Reply-To: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>
References: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>
Message-ID: <CAH+xwdD7Soe0HZC4kjq3ivp75anoweP0KwYz4Jy1uaQGLb8erQ@mail.gmail.com>

On Fri, Mar 9, 2012 at 6:58 PM, Abhinav Jha <virolord at gmail.com> wrote:

> Hi,
>
> I have a small OTP App ( say node A), that subscribes to a RabbitMQ queue,
> and also talks to another erlang node in another process ( node B ).
>
> Now, sometimes the process hosting node B crashes for some reason, and my
> node A gets a 'nodedown' message. Up till this point, consumption from
> RabbitMQ works perfectly.
>
> However, after my handle_info has finished processing the nodedown, if I
> publish a message to the RabbitMQ queue, my app doesn't consume it.
> However, all messages published after this one are consumed properly and
> processed. However that 1 message remains in a message_unacknowledged state
> in the queue, even though my handle_info refuses to have ever consumed it !
>
> Is this a known issue in the client ? Can someone please help me ?
>
> Rabbitmq server version : 2.7.1
> Rabbitmq client version : 0.9.1 version of the AMQP protocol
> Erlang: R15B
>
> Thanks !
>
>
I would say a lot depends on what your "node A" code is doing in the
handling of the nodedown info message. Are you using any State in your
gen_server? If yes, could that be impacting your RabbitMQ message handling
in any way? For example, leading to not ack'ing a msg?

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/6ece175e/attachment.htm>

From johnstoner2 at gmail.com  Fri Mar  9 20:24:19 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Fri, 9 Mar 2012 12:24:19 -0800 (PST)
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
Message-ID: <6ae8a3d1-f332-4b3a-a224-c29bb004e541@i5g2000yqo.googlegroups.com>

OK, I realize this is probably a very basic thing, but I've been
googling and screwing around with this for hours and getting nowhere.

I'm trying to set up my first rabbitmq cluster. I have it installed
fine on two ec2 hosts, and I'm trying to get one to cluster with the
other. I've tried the instructions at

http://www.rabbitmq.com/clustering.html

and I keep getting

Error: unable to connect to node 'rabbit at rabbitmq-small02-dev':
nodedown
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},
 
{rabbitmqctl12928,46801}]
- current node: 'rabbitmqctl12928 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 4IHR1JMCSCh55g/tisBydg==

So I found more detailed instructions on skaag.net, which seems to be
down, but I can get the google-cached instructions at

<http://webcache.googleusercontent.com/search?
q=cache:pl1EhJadjJoJ:www.skaag.net/2010/03/12/rabbitmq-for-beginners/
+howto+set+up+a+rabbitmq+cluster&hl=en&gl=us&strip=1>

So, I install (actually re-install) a fresh, up to date rabbitmq on
the second machine, according to the instructions for ec2.

Then I go through the instructions.

I stop the server:
[jstoner at rabbitmq-small02-dev]> service rabbitmq-server stop
Stopping rabbitmq-server: RabbitMQ is not running
rabbitmq-server.

I change the cookie to the same as the other one:
[jstoner at rabbitmq-small02-dev]> sudo su
root at rabbitmq-small02-dev:/home/jstoner/rclient# echo -n [cookie-text]
> /var/lib/rabbitmq/.erlang.cookie
root at rabbitmq-small02-dev:/home/jstoner/rclient# exit
exit

I try to restart:
[jstoner at rabbitmq-small02-dev]> sudo service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
startup_{log, _err}
rabbitmq-server.

I look at the logs they mention:
[jstoner at rabbitmq-small02-dev]> more /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************

0 plugins activated:

node with name "rabbit" already running on "rabbitmq-small02-dev"
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},
 
{rabbitmqctl12869,39028},
 
{rabbitmqprelaunch12879,
                                                   37230}]
- current node: 'rabbitmqprelaunch12879 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 4IHR1JMCSCh55g/tisBydg==
[jstoner at rabbitmq-small02-dev]> more /var/log/rabbitmq/startup_err
[empty file]

That tells me nothing I can make sense of. So I see what happens if I
try the next step:
[jstoner at rabbitmq-small02-dev]> sudo rabbitmqctl stop_app
Stopping node 'rabbit at rabbitmq-small02-dev' ...
Error: unable to connect to node 'rabbit at rabbitmq-small02-dev':
nodedown
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},
 
{rabbitmqctl12928,46801}]
- current node: 'rabbitmqctl12928 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: [hashtext]

And I get the same kind of problem I got on the first set of
instructions. Any ideas would be much appreciated.

From zmstone at gmail.com  Mon Mar 12 10:26:59 2012
From: zmstone at gmail.com (stone)
Date: Mon, 12 Mar 2012 11:26:59 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
Message-ID: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>

Hi there!

Is there any good practice regarding how to write self-managed AMQP client
(Erlang based)
Here is what I need to accomplish:
1. I don't what to hard-code hostname/ip address of rabbit-server,
using a configuration file would be a simple solution, but, is there a
better way?

2. Client should be able to get the rabbit server "running cluster"
information.
so if the current connection is broken, it could try another one in the
cluster,
then perhaps update the "running cluster" list from the new node;

Brs
/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/df686d15/attachment.htm>

From emile at rabbitmq.com  Mon Mar 12 10:29:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Mar 2012 10:29:01 +0000
Subject: [rabbitmq-discuss] SSL w/ intermediate certificate
In-Reply-To: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>
References: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>
Message-ID: <4F5DCFED.4070705@rabbitmq.com>

Hi Carl,

On 11/03/12 18:05, Carl H?rberg wrote:
> =ERROR REPORT==== 11-Mar-2012::17:29:15 ===
>     application: mochiweb
>     "Accept failed error"
>     "{error,ecertfile}"

This error normally means there is something wrong with the certificate,
but it's not possible to provide a more precise diagnosis without more
details.

You can test it by using the certificate to create an SSL connection
with the OpenSSL s_server option.

How did you create the certificate? You should double-check the commands
used.



-Emile

From son.dastan at googlemail.com  Mon Mar 12 10:38:31 2012
From: son.dastan at googlemail.com (Soner)
Date: Mon, 12 Mar 2012 03:38:31 -0700 (PDT)
Subject: [rabbitmq-discuss] 404, "NOT_FOUND - no queue 'foo' in vhost '/'"
Message-ID: <605378f3-e702-445b-b3ef-5b4eb011aaaf@i5g2000yqo.googlegroups.com>

Hi,

I am running a rabbit-mq (version 2.7.1) cluster with three nodes. On
this cluster I have created a mirrored and durable queue called 'foo'
by using the browser based management console. I also have created the
related exchange and binding. When I tried to connect with my consumer
and publisher I was getting following error:
404, "NOT_FOUND - no queue 'foo' in vhost '/'"

I couldn't find any solution so I have deleted the queue and created
it again with the same setup as before. Then started the consumers
again and it worked. Somehow strange for me that recreating the queue
has helped.
It would be problematic in an production environment to recerate the
queue everytime so my question is if anybody has experienced the same
and what could be the reason?


Thanks in advance.
Soner

From steve at rabbitmq.com  Mon Mar 12 10:43:20 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 12 Mar 2012 10:43:20 +0000
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
Message-ID: <DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>

Hi Jonas,

Instead of issuing 'rabbitmq-server status', please can you try issuing
'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
running rabbit node.

You say 'I've tried running the python code on both the local host (ubuntu
10.04) and on osx.' but it would be quite useful to know a little more about
your setup. Are you trying to access the same server in both cases?

Steve Powell  (a loppy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:

> I've copied the send.py and receive.py in the Hellow World tutorial and keep getting time out errors.I've tried running the python code on both the local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and running and I can login to the management console.
> 
> Any help is greatly appreciated!
> 
> root at rabbit-1:~/tmp# rabbitmq-server status
> Activating RabbitMQ plugins ...
> 
> ********************************************************************************
> ********************************************************************************
> 
> 6 plugins activated:
> * amqp_client-2.7.1
> * mochiweb-1.3-rmq2.7.1-git
> * rabbitmq_management-2.7.1
> * rabbitmq_management_agent-2.7.1
> * rabbitmq_mochiweb-2.7.1
> * webmachine-1.7.0-rmq2.7.1-hg
> 
> node with name "rabbit" already running on "rabbit-1"
> diagnostics:
> - nodes and their ports on rabbit-1: [{rabbit,39652},
>                                       {rabbitmqprelaunch17299,33245}]
> - current node: 'rabbitmqprelaunch17299 at rabbit-1'
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
> 
> --- ERROR ---
> 
> root at rabbit-1:~/tmp# sudo python send.py
> Traceback (most recent call last):
>   File "send.py", line 5, in <module>
>     host='localhost'))
>   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", line 32, in __init__
>     BaseConnection.__init__(self, parameters, None, reconnection_strategy)
>   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", line 50, in __init__
>     reconnection_strategy)
>   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 170, in __init__
>     self._connect()
>   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 228, in _connect
>     self.parameters.port or  spec.PORT)
>   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", line 44, in _adapter_connect
>     self._handle_read()
>   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", line 151, in _handle_read
>     data = self.socket.recv(self._suggested_buffer_size)
> socket.timeout: timed out
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar 12 10:47:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Mar 2012 10:47:06 +0000
Subject: [rabbitmq-discuss] 404,
 "NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <605378f3-e702-445b-b3ef-5b4eb011aaaf@i5g2000yqo.googlegroups.com>
References: <605378f3-e702-445b-b3ef-5b4eb011aaaf@i5g2000yqo.googlegroups.com>
Message-ID: <4F5DD42A.8010202@rabbitmq.com>

On 12/03/12 10:38, Soner wrote:
> I am running a rabbit-mq (version 2.7.1) cluster with three nodes. On
> this cluster I have created a mirrored and durable queue called 'foo'
> by using the browser based management console. I also have created the
> related exchange and binding. When I tried to connect with my consumer
> and publisher I was getting following error:
> 404, "NOT_FOUND - no queue 'foo' in vhost '/'"

If you are a seeing a 404 then either:

a) if you are getting that in response to a basic.consume you have not 
created it with the name you think you have *or*
b) if you are getting that in response to a queue.declare then you 
created a non-mirrored queue on a host which is down.

> I couldn't find any solution so I have deleted the queue and created
> it again with the same setup as before. Then started the consumers
> again and it worked. Somehow strange for me that recreating the queue
> has helped.

This suggests problem a).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 12 10:50:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Mar 2012 10:50:49 +0000
Subject: [rabbitmq-discuss] Federation binding to a queue
In-Reply-To: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
References: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
Message-ID: <4F5DD509.40600@rabbitmq.com>

On 09/03/12 17:10, Timya Timya wrote:
> As the federation plugin is used to consume the downstream messages. Is
> there a way to create and bind the queues on both rabbitmq servers.

Sorry, it's not very clear what you're asking. But the idea of the 
federation plugin is to federate exchanges; queues are local.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From zabrane3 at gmail.com  Mon Mar 12 10:57:33 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Mon, 12 Mar 2012 11:57:33 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <F98AA533-AC4E-42C1-B115-F255035E6128@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<01348E40-F4DC-45EA-9A0B-5F039B5ABFBE@gmail.com>
	<F98AA533-AC4E-42C1-B115-F255035E6128@gmail.com>
Message-ID: <48E58425-20D9-4291-A442-372355DEF45E@gmail.com>

Thanks for the Nanite pointer Michael.

Regards,
Zabrane

On Mar 12, 2012, at 9:28 AM, Michael Klishin wrote:

> Zabrane Mickael:
> 
>> Before trying to rewrite the wheel, anyone faced this problem before and would like to
>> share some code (ie. splitting a big file are constructing it when reading from RabbitMQ queue)?
> 
> You can use Nanite's file streaming implementation as example:
> https://github.com/ruby-amqp/nanite/blob/master/lib/nanite/streaming.rb
> 
> Keep in mind that the project is old but the chunking part is just as relevant
> today.
> 
> MK
> 


From steve at rabbitmq.com  Mon Mar 12 11:17:12 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 12 Mar 2012 11:17:12 +0000
Subject: [rabbitmq-discuss] Lost message in 50k size range
In-Reply-To: <CACDr4idTgnTE-2Txhy-dY5FWv+RMaa=9yk7vHtEjV+QE3haHvw@mail.gmail.com>
References: <CACDr4ieYjC0A0ctS3kG-m_Sa=iKZ7gAQ+7JpKFqj0EFYsrQj5w@mail.gmail.com>
	<3CFC0A3F6AC54565AC2438C4D67B28CC@myyearbook.com>
	<CACDr4ic9P2Up-Jw3Wrm6Yyynj0hxoRg=_LFPQhVkELn=dX6z_Q@mail.gmail.com>
	<CACDr4idTgnTE-2Txhy-dY5FWv+RMaa=9yk7vHtEjV+QE3haHvw@mail.gmail.com>
Message-ID: <9D6B4FB7-2A5B-453A-A205-BD7F829EEA73@rabbitmq.com>

Hi John,

I'm not familiar with the pika code, but scanning it (version 0.9.5 for python
2.6) it looks like the callback it is complaining about is one it adds itself
on close. Are you calling (or causing to be called) close twice, do you think?

--------8<----------------------------------------------
_on_close_ready (which is a callback) calls _rpc thus:

        self._rpc(0, spec.Connection.Close(self.closing[0],
                                          self.closing[1], 0, 0),
                  self._on_connection_closed,
                  [spec.Connection.CloseOk])

and the third param is another callback (_on_connection_closed)
and _rpc adds it:

        # If we were passed a callback, add it to our stack
        if callback:
            for reply in acceptable_replies:
                self.callbacks.add(channel_number, reply, callback)

It is this callback which appears to be triggering the message.
--------------------------------------------------------

Steve Powell  (a lippy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 8 Mar 2012, at 14:30, John Reuning wrote:

> So, it looks like this was a flushing problem.  I either wasn't
> closing the connection properly or was terminating the ioloop too
> soon.  I fixed the message send problem but am now getting a warning
> message from the callback manager.
> 
> /mnt/hgfs/devel/seedbank/seedbank/src/pika/callback.py:72:
> UserWarning: CallbackManager.add: Duplicate callback found for
> "0:Connection.CloseOk"
>  (self.__class__.__name__, prefix, key))
> 
> It gives the warning regardless of whether or not I use
> add_on_close_callback to specify my own callback function.  Any ideas
> why this happens?
> 
> Here's the backtrace to the CallbackManager.add call that generates the message.
> 
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
> line 124, in start
>    self.poller.start()
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
> line 374, in start
>    self.poll()
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/select_connection.py",
> line 388, in poll
>    self._handler(events[0][0], events[0][1])
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/base_connection.py",
> line 134, in _handle_events
>    self._handle_read()
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/adapters/base_connection.py",
> line 162, in _handle_read
>    self._on_data_available(data)
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
> line 589, in _on_data_available
>    frame)                 # Args
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/callback.py", line
> 130, in process
>    callback(*args, **keywords)
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
> line 553, in _on_channel_close
>    self._on_close_ready()
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
> line 402, in _on_close_ready
>    [spec.Connection.CloseOk])
>  File "/mnt/hgfs/devel/seedbank/seedbank/src/pika/connection.py",
> line 620, in _rpc
>    self.callbacks.add(channel_number, reply, callback)
> 
> 
> On Tue, Mar 6, 2012 at 1:13 PM, John Reuning <john at ibiblio.org> wrote:
>> In this case, lost means the consumer never gets it.  I have a test
>> setup for debugging.  Both publisher and consumer are python/pika.
>> The publisher sends 2 messages -- one is a bson encoded python string
>> of length 49144, the other is 49145.  The consumer gets the first
>> message but not the second.  It's the same behavior for messages down
>> to 1 byte and up to a few 100 KB.  The failure point seems to be at
>> this 49145 length.
>> 
>> Other useful information may be that queue durability and message
>> delivery mode settings don't affect the behavior.  Also, your
>> suggestion of publishing to a consumerless queue didn't result in a
>> queued message, as far as I can tell.
>> 
>> I'm using the management and tracing plugins, turned on tracing, and
>> turned on pika debug logging.  I can't find any errors or indication
>> of why the message disappears or where it's going.  I'm not sure I
>> know the right places to look, though.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From carl.hoerberg at gmail.com  Mon Mar 12 12:20:32 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Mon, 12 Mar 2012 13:20:32 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>
References: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>
Message-ID: <CAFPidkPVpDuxkyif0SMNDh6=JjchV=VnP4kQmnAjvM18vu30Mg@mail.gmail.com>

what about a multi A DNS record (with low ttl), which you update when
a server is down/up?

On Mon, Mar 12, 2012 at 11:26, stone <zmstone at gmail.com> wrote:
> Hi there!
>
> Is there any good practice regarding how to write self-managed AMQP client
> (Erlang based)
> Here is what I need to accomplish:
> 1. I don't what to hard-code hostname/ip address of rabbit-server,
> using a configuration file would be a simple solution, but, is there a
> better way?
>
> 2. Client should be able to get the rabbit server "running cluster"
> information.
> so if the current connection is broken, it could try another one in the
> cluster,
> then perhaps update the "running cluster" list from the new node;
>
> Brs
> /stone
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From carl.hoerberg at gmail.com  Mon Mar 12 12:24:50 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Mon, 12 Mar 2012 13:24:50 +0100
Subject: [rabbitmq-discuss] SSL w/ intermediate certificate
In-Reply-To: <4F5DCFED.4070705@rabbitmq.com>
References: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>
	<4F5DCFED.4070705@rabbitmq.com>
Message-ID: <CAFPidkOmcq4fY7F82f5TiTMXsH9kxqjvmAJJ+fAv4ci=xeS2UA@mail.gmail.com>

cat ssl.crt ssl.key intermediate.crt > ssl.pem

anyway.. it seems to work fine with just:

cat ssl.crt ssl.key > ssl.pem

On Mon, Mar 12, 2012 at 11:29, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Carl,
>
> On 11/03/12 18:05, Carl H?rberg wrote:
>> =ERROR REPORT==== 11-Mar-2012::17:29:15 ===
>> ? ? application: mochiweb
>> ? ? "Accept failed error"
>> ? ? "{error,ecertfile}"
>
> This error normally means there is something wrong with the certificate,
> but it's not possible to provide a more precise diagnosis without more
> details.
>
> You can test it by using the certificate to create an SSL connection
> with the OpenSSL s_server option.
>
> How did you create the certificate? You should double-check the commands
> used.
>
>
>
> -Emile

From emile at rabbitmq.com  Mon Mar 12 12:26:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Mar 2012 12:26:34 +0000
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
Message-ID: <4F5DEB7A.20102@rabbitmq.com>

Hi Zabrane,

On 10/03/12 18:34, Jerry Kuch wrote:
> Hi, Zabrane:  In theory the AMQP protocol IIRC allows crazy large
> message payloads (2^64 bytes I believe).  In practice though, that's
> madness since you end up with potential copying and buffering along the
> way that could make a broker very unhealthy.

I have successfully processed messages as large as 2Gb using RabbitMQ,
where 2Gb was about 5% of the total RAM. If the ratio between message
size and total RAM stays low then you can send even larger messages, up
to the limit Jerry mentioned.


-Emile

From zmstone at gmail.com  Mon Mar 12 12:28:30 2012
From: zmstone at gmail.com (stone)
Date: Mon, 12 Mar 2012 13:28:30 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAFPidkPVpDuxkyif0SMNDh6=JjchV=VnP4kQmnAjvM18vu30Mg@mail.gmail.com>
References: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>
	<CAFPidkPVpDuxkyif0SMNDh6=JjchV=VnP4kQmnAjvM18vu30Mg@mail.gmail.com>
Message-ID: <CAPNZrFV7dzGbia5kK+y18AjJ_FrObQ46qPvD5qw0RXNPL7J5OA@mail.gmail.com>

I'm not sure how DNS server works, is it possible for the DNS server to
detect the failure of a specific port? i.e. to find out if rabbit is down,
when the OS is still up and running.

2012/3/12 Carl H?rberg <carl.hoerberg at gmail.com>

> what about a multi A DNS record (with low ttl), which you update when
> a server is down/up?
>
> On Mon, Mar 12, 2012 at 11:26, stone <zmstone at gmail.com> wrote:
> > Hi there!
> >
> > Is there any good practice regarding how to write self-managed AMQP
> client
> > (Erlang based)
> > Here is what I need to accomplish:
> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
> > using a configuration file would be a simple solution, but, is there a
> > better way?
> >
> > 2. Client should be able to get the rabbit server "running cluster"
> > information.
> > so if the current connection is broken, it could try another one in the
> > cluster,
> > then perhaps update the "running cluster" list from the new node;
> >
> > Brs
> > /stone
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/16040ff8/attachment.htm>

From l.rossi.cons at vitrociset.it  Mon Mar 12 12:33:44 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Mon, 12 Mar 2012 12:33:44 +0000
Subject: [rabbitmq-discuss] R:  regarding SimpleAmqpClient
In-Reply-To: <CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
Message-ID: <5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>

Another question:
I need to transmit raw data (an array of char) through Rabbit. The following function:

-   static ptr_t Create(amqp_bytes_t_& body, amqp_basic_properties_t_* properties)
inserts a byte array struct, but an amqp_basic_properties_t_ is also needed, and I don't know how to fill that structure. Any clues?

Best,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com]
Inviato: gioved? 8 marzo 2012 18:00
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Oggetto: Re: [rabbitmq-discuss] regarding SimpleAmqpClient

I recently reworked the internals of the library (thus the v2.0-beta tag) and have not updated the code in the examples/ directory yet.

So you are correct simple_connect.cpp is broken currently.

To clarify: It is safe and reliable to have more than one consumer per AmqpClient::Channel object.

-Alan
On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear expert,
As I told you yesterday I'm working on a C++ application who uses RabbitMQ. I have a simple question for you: related to Channel.h, function BasicConsume() I read in the function comments
"Note: due to a limitation to how things are done, it is only possible to reliably have a single consumer per channel, calling this more than once per channel may result in undefined results from BasicConsumeMessage"
Is it something related only on the C++ implementation?

Last but not least, I think there are some mistakes in the example simple_connect.cpp


1.      #include <SimpleAmqpClient.h> should be #include < SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure copies that file in the SimpleAmqpClient folder;

2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage(); doesn't work for two reasons:

a.      A function BasicConsumeMessage() which takes no argument doesn't exist in Channel.h;

b.      The function BasicConsumeMessage(...) currently defined in Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t.

3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX header. I had to comment that row in order to make things work in Visual Studio 2008.


Best wishes,

Lorenzo




Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: marted? 6 marzo 2012 17:23
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] how to build SimpleAmqpClient?

Did you build boost as a set of static libraries?  If so you'll need to set the Boost_USE_STATIC_LIBS=ON CMake variable.

Another note: given you're building with VS2008 you're going to run into a different problem once you get past the boost library issue you're having: see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what the issue is and a workaround.

-Alan
On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear Experts,
I'm trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008), but when I execute CMake, there are errors regarding boost:


CMake Error at C:/Program Files (x86)/CMake 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):

Unable to find the requested Boost libraries.

Boost version: 1.48.0

Boost include path: C:/Applicazioni/boost

The following Boost libraries could not be found:

boost_chrono

boost_system

No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the

directory containing Boost libraries or BOOST_ROOT to the location of

Boost.

Call Stack (most recent call first):

CMakeLists.txt:8 (FIND_PACKAGE)

I add manually the filepath for chrono and system to Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release, Boost_System_Library_Debug, Boost_ System_Library_Release, but still it doesn't find anything. I also create the BOOST_ROOT but still it doesn't work.
Any suggestion?

Best,

Lorenzo


Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/1d85f192/attachment.htm>

From carl.hoerberg at gmail.com  Mon Mar 12 12:35:11 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Mon, 12 Mar 2012 13:35:11 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAPNZrFV7dzGbia5kK+y18AjJ_FrObQ46qPvD5qw0RXNPL7J5OA@mail.gmail.com>
References: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>
	<CAFPidkPVpDuxkyif0SMNDh6=JjchV=VnP4kQmnAjvM18vu30Mg@mail.gmail.com>
	<CAPNZrFV7dzGbia5kK+y18AjJ_FrObQ46qPvD5qw0RXNPL7J5OA@mail.gmail.com>
Message-ID: <CAFPidkPboek4baVADQuccRH_kvebAzKDJ0_X9_XPd+DehjCQaQ@mail.gmail.com>

no, you have to manually administer the dns (or automatically through
some heartbeat stuff interacting with your dns provider api.. )

i don't know how the client implementations are, but they could try to
connect to the first A record, if that fails try the next one and so
forth..  (like the way many web browsers does)

On Mon, Mar 12, 2012 at 13:28, stone <zmstone at gmail.com> wrote:
> I'm not sure how DNS server works, is it possible for the DNS server to
> detect the failure of a specific port? i.e. to find out if rabbit is down,
> when the OS is still up and running.
>
>
> 2012/3/12 Carl H?rberg <carl.hoerberg at gmail.com>
>>
>> what about a multi A DNS record (with low ttl), which you update when
>> a server is down/up?
>>
>> On Mon, Mar 12, 2012 at 11:26, stone <zmstone at gmail.com> wrote:
>> > Hi there!
>> >
>> > Is there any good practice regarding how to write self-managed AMQP
>> > client
>> > (Erlang based)
>> > Here is what I need to accomplish:
>> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
>> > using a configuration file would be a simple solution, but, is there a
>> > better way?
>> >
>> > 2. Client should be able to get the rabbit server "running cluster"
>> > information.
>> > so if the current connection is broken, it could try another one in the
>> > cluster,
>> > then perhaps update the "running cluster" list from the new node;
>> >
>> > Brs
>> > /stone
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>

From lionel.cons at cern.ch  Mon Mar 12 12:36:55 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 12 Mar 2012 13:36:55 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com> (Simon MacMullen's message of
	"Thu, 8 Mar 2012 17:55:07 +0000")
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <bw7zkbmdmhk.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> Please, have a play with this and let us know if anything goes wrong
> for you...

In my tests, I got a weird error when clicking on the "Connections" tab
of the web console:

  TypeError: txt is undefined

At that time, there were connections being made.

After some time (when all connections are gone), the error disappears...

Cheers,

Lionel

From zmstone at gmail.com  Mon Mar 12 12:46:34 2012
From: zmstone at gmail.com (stone)
Date: Mon, 12 Mar 2012 13:46:34 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAFPidkPboek4baVADQuccRH_kvebAzKDJ0_X9_XPd+DehjCQaQ@mail.gmail.com>
References: <CAPNZrFVQm_rTVshYQa-iyb-SxiMZ2MPRh9HBrN3c4kTBafPVXw@mail.gmail.com>
	<CAFPidkPVpDuxkyif0SMNDh6=JjchV=VnP4kQmnAjvM18vu30Mg@mail.gmail.com>
	<CAPNZrFV7dzGbia5kK+y18AjJ_FrObQ46qPvD5qw0RXNPL7J5OA@mail.gmail.com>
	<CAFPidkPboek4baVADQuccRH_kvebAzKDJ0_X9_XPd+DehjCQaQ@mail.gmail.com>
Message-ID: <CAPNZrFVr7hz94_kaf3wHPzim9CGY-bvQa1-Ck6tdfcHYwrHD2g@mail.gmail.com>

seems better than config file. thanks Carl.

2012/3/12 Carl H?rberg <carl.hoerberg at gmail.com>

> no, you have to manually administer the dns (or automatically through
> some heartbeat stuff interacting with your dns provider api.. )
>
> i don't know how the client implementations are, but they could try to
> connect to the first A record, if that fails try the next one and so
> forth..  (like the way many web browsers does)
>
> On Mon, Mar 12, 2012 at 13:28, stone <zmstone at gmail.com> wrote:
> > I'm not sure how DNS server works, is it possible for the DNS server to
> > detect the failure of a specific port? i.e. to find out if rabbit is
> down,
> > when the OS is still up and running.
> >
> >
> > 2012/3/12 Carl H?rberg <carl.hoerberg at gmail.com>
> >>
> >> what about a multi A DNS record (with low ttl), which you update when
> >> a server is down/up?
> >>
> >> On Mon, Mar 12, 2012 at 11:26, stone <zmstone at gmail.com> wrote:
> >> > Hi there!
> >> >
> >> > Is there any good practice regarding how to write self-managed AMQP
> >> > client
> >> > (Erlang based)
> >> > Here is what I need to accomplish:
> >> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
> >> > using a configuration file would be a simple solution, but, is there a
> >> > better way?
> >> >
> >> > 2. Client should be able to get the rabbit server "running cluster"
> >> > information.
> >> > so if the current connection is broken, it could try another one in
> the
> >> > cluster,
> >> > then perhaps update the "running cluster" list from the new node;
> >> >
> >> > Brs
> >> > /stone
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/d45e5b38/attachment.htm>

From irmo.manie at gmail.com  Mon Mar 12 12:51:17 2012
From: irmo.manie at gmail.com (Irmo Manie)
Date: Mon, 12 Mar 2012 13:51:17 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <4F5DEB7A.20102@rabbitmq.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
Message-ID: <CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>

RabbitMQ should actually not be used for big file transfers or only
with great care and fragmenting the files into smaller separate
messages.
When running a single broker instance, you'd still be safe, but in a
clustered setup, very big messages will break the cluster.

Clustered nodes are connected via 1 tcp connection, which must also
transport a (erlang) heartbeat. If your big message takes more time to
transfer between nodes than the heartbeat timeout (anywhere between
~20-45 seconds if I'm correct), the cluster will break and your
message is lost.

The preferred architecture for file transfer over amqp is to just send
a message with a link to a downloadable resource and let the file
transfer be handle by specialized protocol like ftp :-)


- Irmo

On Mon, Mar 12, 2012 at 1:26 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Zabrane,
>
> On 10/03/12 18:34, Jerry Kuch wrote:
>> Hi, Zabrane: ?In theory the AMQP protocol IIRC allows crazy large
>> message payloads (2^64 bytes I believe). ?In practice though, that's
>> madness since you end up with potential copying and buffering along the
>> way that could make a broker very unhealthy.
>
> I have successfully processed messages as large as 2Gb using RabbitMQ,
> where 2Gb was about 5% of the total RAM. If the ratio between message
> size and total RAM stays low then you can send even larger messages, up
> to the limit Jerry mentioned.
>
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From zabrane3 at gmail.com  Mon Mar 12 13:00:09 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Mon, 12 Mar 2012 14:00:09 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
Message-ID: <59EA52AA-41EF-4A9B-AB56-CA7D361185D3@gmail.com>

> Clustered nodes are connected via 1 tcp connection, which must also
> transport a (erlang) heartbeat. If your big message takes more time to
> transfer between nodes than the heartbeat timeout (anywhere between
> ~20-45 seconds if I'm correct), the cluster will break and your
> message is lost.

I see.

> The preferred architecture for file transfer over amqp is to just send
> a message with a link to a downloadable resource and let the file
> transfer be handle by specialized protocol like ftp :-)


Nice idea. I'll try to implement that.

Regards,
Zabrane


From carl.hoerberg at gmail.com  Mon Mar 12 13:23:00 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Mon, 12 Mar 2012 14:23:00 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <59EA52AA-41EF-4A9B-AB56-CA7D361185D3@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<59EA52AA-41EF-4A9B-AB56-CA7D361185D3@gmail.com>
Message-ID: <CAFPidkPAn8OZFCHn-uZxdzscDi7t2JeP3X_1BismE870EU9zEw@mail.gmail.com>

is it possible to configure a max message size limit?

On Mon, Mar 12, 2012 at 14:00, Zabrane Mickael <zabrane3 at gmail.com> wrote:
>> Clustered nodes are connected via 1 tcp connection, which must also
>> transport a (erlang) heartbeat. If your big message takes more time to
>> transfer between nodes than the heartbeat timeout (anywhere between
>> ~20-45 seconds if I'm correct), the cluster will break and your
>> message is lost.
>
> I see.
>
>> The preferred architecture for file transfer over amqp is to just send
>> a message with a link to a downloadable resource and let the file
>> transfer be handle by specialized protocol like ftp :-)
>
>
> Nice idea. I'll try to implement that.
>
> Regards,
> Zabrane
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michaelveloz at gmail.com  Mon Mar 12 13:38:58 2012
From: michaelveloz at gmail.com (Veloz)
Date: Mon, 12 Mar 2012 06:38:58 -0700 (PDT)
Subject: [rabbitmq-discuss] DotNet method IModel:QueueDeclare missing
Message-ID: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>

Hi there
We're trying to use RabbitMQ in C# and the method call to
IModel.QueueDeclare results in a MethodNotFound error.

I checked the API docs, it shows QueueDeclare as a valid method that
should be supported by the library.

WTH?

I tried downloading the binary (.exe) as well as compiling it, and
both give the same error.

Thanks
Michael

From lionel.cons at cern.ch  Mon Mar 12 13:45:03 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 12 Mar 2012 14:45:03 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com> (Simon MacMullen's message of
	"Thu, 8 Mar 2012 17:55:07 +0000")
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <bw7vcmadjc0.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> Please, have a play with this and let us know if anything goes wrong
> for you...

One more problem: I get random failures with a test using STOMP and one topic.

Here is the test scenario:
 - two consumers (independent processes) are started on one topic
 - after a bit of time (to get the SUBSCRIBE+RECEIPT frames): two
   producers (independent processes) are started and send 5 messages
   each to the same topic
 - consumers end when they stop receiving new messages for several
   seconds
 - each consumer should have received 15 messages

Sometimes both consumers do get 15 messages but sometimes they get
less. The number of messages received varies: 15, 13, 12, 9...
The same test seems to work fine against RabbitMQ 2.7.1.

FWIW, I included a trace of what happens (including STOMP frames) for
one failure.

Cheers,

Lionel

# 2012/03/12-14:04:34 msak[10628]: incoming = broker (stomp://mybroker:6163)
# 2012/03/12-14:04:34 msak[10628]: Net::STOMP::Client->connect()
# 2012/03/12-14:04:34 msak[10628]:  encoded CONNECT frame
# 2012/03/12-14:04:34 msak[10628]:   H passcode:guest
# 2012/03/12-14:04:34 msak[10628]:   H accept-version:1.0,1.1
# 2012/03/12-14:04:34 msak[10628]:   H login:guest
# 2012/03/12-14:04:34 msak[10628]:   H host:rabbitmq
# 2012/03/12-14:04:34 msak[10628]:   sent 74 bytes
# 2012/03/12-14:04:34 msak[10629]: incoming = broker (stomp://mybroker:6163)
# 2012/03/12-14:04:34 msak[10628]:   received 100 bytes
# 2012/03/12-14:04:34 msak[10628]:  decoding CONNECTED frame
# 2012/03/12-14:04:34 msak[10628]:   H session:session-glmUUf49by_vwgLIsfaaQ6
# 2012/03/12-14:04:34 msak[10628]:   H heart-beat:0,0
# 2012/03/12-14:04:34 msak[10628]:   H server:RabbitMQ/2.7.9
# 2012/03/12-14:04:34 msak[10628]:   H version:1.1
# 2012/03/12-14:04:34 msak[10629]: Net::STOMP::Client->connect()
# 2012/03/12-14:04:34 msak[10629]:  encoded CONNECT frame
# 2012/03/12-14:04:34 msak[10629]:   H passcode:guest
# 2012/03/12-14:04:34 msak[10629]:   H accept-version:1.0,1.1
# 2012/03/12-14:04:34 msak[10629]:   H login:guest
# 2012/03/12-14:04:34 msak[10629]:   H host:rabbitmq
# 2012/03/12-14:04:34 msak[10629]:   sent 74 bytes
# 2012/03/12-14:04:34 msak[10629]:   received 100 bytes
# 2012/03/12-14:04:34 msak[10629]:  decoding CONNECTED frame
# 2012/03/12-14:04:34 msak[10629]:   H session:session-A8juhJ2SqmlAJcIkjrdiS2
# 2012/03/12-14:04:34 msak[10629]:   H heart-beat:0,0
# 2012/03/12-14:04:34 msak[10629]:   H server:RabbitMQ/2.7.9
# 2012/03/12-14:04:34 msak[10629]:   H version:1.1
# 2012/03/12-14:04:34 msak[10628]: Net::STOMP::Client->subscribe()
# 2012/03/12-14:04:34 msak[10628]:  encoded SUBSCRIBE frame
# 2012/03/12-14:04:34 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:34 msak[10628]:   H id:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:34 msak[10628]:   H receipt:94e6630-4f5df462-2984-6902-1
# 2012/03/12-14:04:34 msak[10628]:   sent 122 bytes
# 2012/03/12-14:04:34 msak[10628]: now waiting for the missing receipts
# 2012/03/12-14:04:34 msak[10629]: Net::STOMP::Client->subscribe()
# 2012/03/12-14:04:34 msak[10629]:  encoded SUBSCRIBE frame
# 2012/03/12-14:04:34 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:34 msak[10629]:   H id:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:34 msak[10629]:   H receipt:8978630-4f5df462-2985-ab87-1
# 2012/03/12-14:04:34 msak[10629]:   sent 122 bytes
# 2012/03/12-14:04:34 msak[10629]: now waiting for the missing receipts
# 2012/03/12-14:04:34 msak[10628]:   received 50 bytes
# 2012/03/12-14:04:34 msak[10628]:  decoding RECEIPT frame
# 2012/03/12-14:04:34 msak[10628]:   H receipt-id:94e6630-4f5df462-2984-6902-1
# 2012/03/12-14:04:34 msak[10628]: start
# 2012/03/12-14:04:34 msak[10629]:   received 50 bytes
# 2012/03/12-14:04:34 msak[10629]:  decoding RECEIPT frame
# 2012/03/12-14:04:34 msak[10629]:   H receipt-id:8978630-4f5df462-2985-ab87-1
# 2012/03/12-14:04:34 msak[10629]: start
# 2012/03/12-14:04:35 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:35 msak[10628]: got no message (no frames received)
# 2012/03/12-14:04:35 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:35 msak[10629]: got no message (no frames received)
# 2012/03/12-14:04:36 msak[10632]: incoming = generator
# 2012/03/12-14:04:36 msak[10632]: outgoing = broker (stomp://mybroker:6163)
# 2012/03/12-14:04:36 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:36 msak[10628]: got no message (no frames received)
# 2012/03/12-14:04:36 msak[10632]: Net::STOMP::Client->connect()
# 2012/03/12-14:04:36 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:36 msak[10629]: got no message (no frames received)
# 2012/03/12-14:04:36 msak[10632]:  encoded CONNECT frame
# 2012/03/12-14:04:36 msak[10632]:   H passcode:guest
# 2012/03/12-14:04:36 msak[10632]:   H accept-version:1.0,1.1
# 2012/03/12-14:04:36 msak[10632]:   H login:guest
# 2012/03/12-14:04:36 msak[10632]:   H host:rabbitmq
# 2012/03/12-14:04:36 msak[10632]:   sent 74 bytes
# 2012/03/12-14:04:36 msak[10632]:   received 100 bytes
# 2012/03/12-14:04:36 msak[10632]:  decoding CONNECTED frame
# 2012/03/12-14:04:36 msak[10632]:   H session:session-wUavc52XJm4ReMchKZVtor
# 2012/03/12-14:04:36 msak[10632]:   H heart-beat:0,0
# 2012/03/12-14:04:36 msak[10632]:   H server:RabbitMQ/2.7.9
# 2012/03/12-14:04:36 msak[10632]:   H version:1.1
# 2012/03/12-14:04:36 msak[10632]: start
# 2012/03/12-14:04:36 msak[10632]: got message 1
# 2012/03/12-14:04:36 msak[10632]: outgoing message <no-message-id>
# 2012/03/12-14:04:36 msak[10632]:  encoded SEND frame
# 2012/03/12-14:04:36 msak[10632]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10632]:   H content-length:1
# 2012/03/12-14:04:36 msak[10632]:   B 0000 31                                   1
# 2012/03/12-14:04:36 msak[10632]:   sent 66 bytes
# 2012/03/12-14:04:36 msak[10632]: got message 2
# 2012/03/12-14:04:36 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:36 msak[10629]:   received 188 bytes
# 2012/03/12-14:04:36 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:36 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:36 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:36 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:36 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@1
# 2012/03/12-14:04:36 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@1
# 2012/03/12-14:04:36 msak[10628]:   H content-length:1
# 2012/03/12-14:04:36 msak[10629]:   H content-length:1
# 2012/03/12-14:04:36 msak[10628]:   B 0000 31                                   1
# 2012/03/12-14:04:36 msak[10629]:   B 0000 31                                   1
# 2012/03/12-14:04:36 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@1
# 2012/03/12-14:04:36 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@1
# 2012/03/12-14:04:36 msak[10628]: got message 1
# 2012/03/12-14:04:36 msak[10629]: got message 1
# 2012/03/12-14:04:36 msak[10632]: outgoing message <no-message-id>
# 2012/03/12-14:04:36 msak[10632]:  encoded SEND frame
# 2012/03/12-14:04:36 msak[10632]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10632]:   H content-length:1
# 2012/03/12-14:04:36 msak[10632]:   B 0000 32                                   2
# 2012/03/12-14:04:36 msak[10632]:   sent 66 bytes
# 2012/03/12-14:04:36 msak[10632]: got message 3
# 2012/03/12-14:04:36 msak[10632]: outgoing message <no-message-id>
# 2012/03/12-14:04:36 msak[10632]:  encoded SEND frame
# 2012/03/12-14:04:36 msak[10632]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10632]:   H content-length:1
# 2012/03/12-14:04:36 msak[10632]:   B 0000 33                                   3
# 2012/03/12-14:04:36 msak[10632]:   sent 66 bytes
# 2012/03/12-14:04:36 msak[10632]: got message 4
# 2012/03/12-14:04:36 msak[10632]: outgoing message <no-message-id>
# 2012/03/12-14:04:36 msak[10632]:  encoded SEND frame
# 2012/03/12-14:04:36 msak[10632]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:36 msak[10632]:   H content-length:1
# 2012/03/12-14:04:36 msak[10632]:   B 0000 34                                   4
# 2012/03/12-14:04:36 msak[10632]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10632]: got message 5
# 2012/03/12-14:04:37 msak[10632]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10632]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10632]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10632]:   H content-length:1
# 2012/03/12-14:04:37 msak[10632]:   B 0000 35                                   5
# 2012/03/12-14:04:37 msak[10632]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10632]: stop
# 2012/03/12-14:04:37 msak[10632]:   received 0 bytes
# 2012/03/12-14:04:37 msak[10632]: Net::STOMP::Client->disconnect()
# 2012/03/12-14:04:37 msak[10632]:  encoded DISCONNECT frame
# 2012/03/12-14:04:37 msak[10632]:   sent 13 bytes
# 2012/03/12-14:04:37 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:   received 376 bytes
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@2
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@2
# 2012/03/12-14:04:37 msak[10628]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@2
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@2
# 2012/03/12-14:04:37 msak[10628]: got message 2
# 2012/03/12-14:04:37 msak[10629]: got message 2
# 2012/03/12-14:04:37 msak[10628]:   received 564 bytes
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@3
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@3
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10628]:   B 0000 33                                   3
# 2012/03/12-14:04:37 msak[10629]:   B 0000 33                                   3
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@3
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@3
# 2012/03/12-14:04:37 msak[10629]: got message 3
# 2012/03/12-14:04:37 msak[10628]: got message 3
# 2012/03/12-14:04:37 msak[10629]:   received 376 bytes
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@4
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@4
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10628]:   B 0000 34                                   4
# 2012/03/12-14:04:37 msak[10629]:   B 0000 34                                   4
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@4
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@4
# 2012/03/12-14:04:37 msak[10629]: got message 4
# 2012/03/12-14:04:37 msak[10628]: got message 4
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@5
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10628]:   B 0000 35                                   5
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@5
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   B 0000 35                                   5
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@5
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@5
# 2012/03/12-14:04:37 msak[10628]: got message 5
# 2012/03/12-14:04:37 msak[10629]: got message 5
# 2012/03/12-14:04:37 msak[10630]: incoming = generator
# 2012/03/12-14:04:37 msak[10630]: outgoing = broker (stomp://mybroker:6163)
# 2012/03/12-14:04:37 msak[10630]: Net::STOMP::Client->connect()
# 2012/03/12-14:04:37 msak[10630]:  encoded CONNECT frame
# 2012/03/12-14:04:37 msak[10630]:   H passcode:guest
# 2012/03/12-14:04:37 msak[10630]:   H accept-version:1.0,1.1
# 2012/03/12-14:04:37 msak[10630]:   H login:guest
# 2012/03/12-14:04:37 msak[10630]:   H host:rabbitmq
# 2012/03/12-14:04:37 msak[10630]:   sent 74 bytes
# 2012/03/12-14:04:37 msak[10630]:   received 100 bytes
# 2012/03/12-14:04:37 msak[10630]:  decoding CONNECTED frame
# 2012/03/12-14:04:37 msak[10630]:   H session:session-gqfAux5SEWpJpzU646S9E1
# 2012/03/12-14:04:37 msak[10630]:   H heart-beat:0,0
# 2012/03/12-14:04:37 msak[10630]:   H server:RabbitMQ/2.7.9
# 2012/03/12-14:04:37 msak[10630]:   H version:1.1
# 2012/03/12-14:04:37 msak[10631]: incoming = generator
# 2012/03/12-14:04:37 msak[10631]: outgoing = broker (stomp://mybroker:6163)
# 2012/03/12-14:04:37 msak[10631]: Net::STOMP::Client->connect()
# 2012/03/12-14:04:37 msak[10631]:  encoded CONNECT frame
# 2012/03/12-14:04:37 msak[10631]:   H passcode:guest
# 2012/03/12-14:04:37 msak[10631]:   H accept-version:1.0,1.1
# 2012/03/12-14:04:37 msak[10631]:   H login:guest
# 2012/03/12-14:04:37 msak[10631]:   H host:rabbitmq
# 2012/03/12-14:04:37 msak[10631]:   sent 74 bytes
# 2012/03/12-14:04:37 msak[10631]:   received 100 bytes
# 2012/03/12-14:04:37 msak[10631]:  decoding CONNECTED frame
# 2012/03/12-14:04:37 msak[10631]:   H session:session-Qa7zCIwbfrU6mYAMB0hWhO
# 2012/03/12-14:04:37 msak[10631]:   H heart-beat:0,0
# 2012/03/12-14:04:37 msak[10631]:   H server:RabbitMQ/2.7.9
# 2012/03/12-14:04:37 msak[10631]:   H version:1.1
# 2012/03/12-14:04:37 msak[10630]: start
# 2012/03/12-14:04:37 msak[10630]: got message 1
# 2012/03/12-14:04:37 msak[10630]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10630]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10630]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10630]:   H content-length:1
# 2012/03/12-14:04:37 msak[10630]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10630]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10630]: got message 2
# 2012/03/12-14:04:37 msak[10630]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10629]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@6
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@6
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10628]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10629]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@6
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@6
# 2012/03/12-14:04:37 msak[10628]: got message 6
# 2012/03/12-14:04:37 msak[10629]: got message 6
# 2012/03/12-14:04:37 msak[10630]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10630]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10630]:   H content-length:1
# 2012/03/12-14:04:37 msak[10630]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10630]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10630]: got message 3
# 2012/03/12-14:04:37 msak[10630]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10630]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10630]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10630]:   H content-length:1
# 2012/03/12-14:04:37 msak[10630]:   B 0000 33                                   3
# 2012/03/12-14:04:37 msak[10630]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10630]: got message 4
# 2012/03/12-14:04:37 msak[10630]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10630]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10630]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10630]:   H content-length:1
# 2012/03/12-14:04:37 msak[10630]:   B 0000 34                                   4
# 2012/03/12-14:04:37 msak[10630]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10630]: got message 5
# 2012/03/12-14:04:37 msak[10630]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10630]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10630]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10630]:   H content-length:1
# 2012/03/12-14:04:37 msak[10630]:   B 0000 35                                   5
# 2012/03/12-14:04:37 msak[10630]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10630]: stop
# 2012/03/12-14:04:37 msak[10630]:   received 0 bytes
# 2012/03/12-14:04:37 msak[10630]: Net::STOMP::Client->disconnect()
# 2012/03/12-14:04:37 msak[10630]:  encoded DISCONNECT frame
# 2012/03/12-14:04:37 msak[10630]:   sent 13 bytes
# 2012/03/12-14:04:37 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10629]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@7
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@7
# 2012/03/12-14:04:37 msak[10628]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@7
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@7
# 2012/03/12-14:04:37 msak[10628]: got message 7
# 2012/03/12-14:04:37 msak[10629]: got message 7
# 2012/03/12-14:04:37 msak[10631]: start
# 2012/03/12-14:04:37 msak[10631]: got message 1
# 2012/03/12-14:04:37 msak[10631]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10631]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10631]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10631]:   H content-length:1
# 2012/03/12-14:04:37 msak[10631]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10631]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10631]: got message 2
# 2012/03/12-14:04:37 msak[10631]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10629]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@8
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@8
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@8
# 2012/03/12-14:04:37 msak[10628]:   B 0000 31                                   1
# 2012/03/12-14:04:37 msak[10629]: got message 8
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@8
# 2012/03/12-14:04:37 msak[10631]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10631]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]: got message 8
# 2012/03/12-14:04:37 msak[10631]:   H content-length:1
# 2012/03/12-14:04:37 msak[10631]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10631]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10631]: got message 3
# 2012/03/12-14:04:37 msak[10631]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10631]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10631]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10631]:   H content-length:1
# 2012/03/12-14:04:37 msak[10631]:   B 0000 33                                   3
# 2012/03/12-14:04:37 msak[10631]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10631]: got message 4
# 2012/03/12-14:04:37 msak[10631]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10631]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10631]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10631]:   H content-length:1
# 2012/03/12-14:04:37 msak[10631]:   B 0000 34                                   4
# 2012/03/12-14:04:37 msak[10631]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10631]: got message 5
# 2012/03/12-14:04:37 msak[10631]: outgoing message <no-message-id>
# 2012/03/12-14:04:37 msak[10631]:  encoded SEND frame
# 2012/03/12-14:04:37 msak[10631]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10631]:   H content-length:1
# 2012/03/12-14:04:37 msak[10631]:   B 0000 35                                   5
# 2012/03/12-14:04:37 msak[10631]:   sent 66 bytes
# 2012/03/12-14:04:37 msak[10631]: stop
# 2012/03/12-14:04:37 msak[10631]:   received 0 bytes
# 2012/03/12-14:04:37 msak[10631]: Net::STOMP::Client->disconnect()
# 2012/03/12-14:04:37 msak[10631]:  encoded DISCONNECT frame
# 2012/03/12-14:04:37 msak[10631]:   sent 13 bytes
# 2012/03/12-14:04:37 msak[10629]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10628]:   received 188 bytes
# 2012/03/12-14:04:37 msak[10629]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10628]:  decoding MESSAGE frame
# 2012/03/12-14:04:37 msak[10629]:   H subscription:8978630-4f5df462-2985-ab87-2
# 2012/03/12-14:04:37 msak[10629]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10628]:   H subscription:94e6630-4f5df462-2984-6902-2
# 2012/03/12-14:04:37 msak[10629]:   H message-id:T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@9
# 2012/03/12-14:04:37 msak[10628]:   H destination:/topic/test.mbtf.bb.d9d20365
# 2012/03/12-14:04:37 msak[10629]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10628]:   H message-id:T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@9
# 2012/03/12-14:04:37 msak[10628]:   H content-length:1
# 2012/03/12-14:04:37 msak[10629]: incoming message T_8978630-4f5df462-2985-ab87-2@@session-A8juhJ2SqmlAJcIkjrdiS2@@9
# 2012/03/12-14:04:37 msak[10628]:   B 0000 32                                   2
# 2012/03/12-14:04:37 msak[10629]: got message 9
# 2012/03/12-14:04:37 msak[10628]: incoming message T_94e6630-4f5df462-2984-6902-2@@session-glmUUf49by_vwgLIsfaaQ6@@9
# 2012/03/12-14:04:37 msak[10628]: got message 9
# 2012/03/12-14:04:38 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:38 msak[10629]: got no message (no frames received)
# 2012/03/12-14:04:38 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:38 msak[10628]: got no message (no frames received)
# 2012/03/12-14:04:39 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:39 msak[10629]: got no message (no frames received)
# 2012/03/12-14:04:39 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:39 msak[10628]: got no message (no frames received)
# 2012/03/12-14:04:40 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:40 msak[10629]: got no message (no frames received)
# 2012/03/12-14:04:40 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:40 msak[10628]: got no message (no frames received)
# 2012/03/12-14:04:41 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:41 msak[10629]: stop
# 2012/03/12-14:04:41 msak[10629]:   received 0 bytes
# 2012/03/12-14:04:41 msak[10629]: Net::STOMP::Client->disconnect()
# 2012/03/12-14:04:41 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:41 msak[10629]:  encoded DISCONNECT frame
# 2012/03/12-14:04:41 msak[10628]: stop
# 2012/03/12-14:04:41 msak[10629]:   sent 13 bytes
# 2012/03/12-14:04:41 msak[10628]:   received 0 bytes
# 2012/03/12-14:04:41 msak[10628]: Net::STOMP::Client->disconnect()
# 2012/03/12-14:04:41 msak[10628]:  encoded DISCONNECT frame
# 2012/03/12-14:04:41 msak[10628]:   sent 13 bytes
count: FAIL: unexpected number of messages received by consumer1: 9 instead of 15

From ekirpichov at gmail.com  Mon Mar 12 13:58:14 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 12 Mar 2012 17:58:14 +0400
Subject: [rabbitmq-discuss] DotNet method IModel:QueueDeclare missing
In-Reply-To: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>
References: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>
Message-ID: <CANVKUrUXdUK0p1WyVO9BVYM1-e=x8c724Ss-BtbWYbxnHw2WKg@mail.gmail.com>

Hi,

Which particular version of RabbitMq.Client.dll are you using?

On Mon, Mar 12, 2012 at 5:38 PM, Veloz <michaelveloz at gmail.com> wrote:

> Hi there
> We're trying to use RabbitMQ in C# and the method call to
> IModel.QueueDeclare results in a MethodNotFound error.
>
> I checked the API docs, it shows QueueDeclare as a valid method that
> should be supported by the library.
>
> WTH?
>
> I tried downloading the binary (.exe) as well as compiling it, and
> both give the same error.
>
> Thanks
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/f06c3f33/attachment.htm>

From emile at rabbitmq.com  Mon Mar 12 14:09:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Mar 2012 14:09:09 +0000
Subject: [rabbitmq-discuss] DotNet method IModel:QueueDeclare missing
In-Reply-To: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>
References: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>
Message-ID: <4F5E0385.3060404@rabbitmq.com>

Hi,

On 12/03/12 13:38, Veloz wrote:
> Hi there
> We're trying to use RabbitMQ in C# and the method call to
> IModel.QueueDeclare results in a MethodNotFound error.
> 
> I checked the API docs, it shows QueueDeclare as a valid method that
> should be supported by the library.

It is definitely present. See here:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/73b264cffa70/projects/client/RabbitMQ.Client/src/client/api/IModel.cs#l245


-Emile

From simon at rabbitmq.com  Mon Mar 12 14:12:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Mar 2012 14:12:55 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <bw7zkbmdmhk.fsf@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com> <bw7zkbmdmhk.fsf@mail.cern.ch>
Message-ID: <4F5E0467.2090800@rabbitmq.com>

On 12/03/12 12:36, Lionel Cons wrote:
> In my tests, I got a weird error when clicking on the "Connections" tab
> of the web console:

Ah, thank you very much for this!  Fixed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Mar 12 14:13:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Mar 2012 14:13:45 +0000
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <CAFPidkPAn8OZFCHn-uZxdzscDi7t2JeP3X_1BismE870EU9zEw@mail.gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<59EA52AA-41EF-4A9B-AB56-CA7D361185D3@gmail.com>
	<CAFPidkPAn8OZFCHn-uZxdzscDi7t2JeP3X_1BismE870EU9zEw@mail.gmail.com>
Message-ID: <4F5E0499.8060007@rabbitmq.com>

Hi Carl,

On 12/03/12 13:23, Carl H?rberg wrote:
> is it possible to configure a max message size limit?

No, but you can limit the maximum fragment size during connection tuning.

-Emile

From steve at rabbitmq.com  Mon Mar 12 14:17:19 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 12 Mar 2012 14:17:19 +0000
Subject: [rabbitmq-discuss] DotNet method IModel:QueueDeclare missing
In-Reply-To: <4F5E0385.3060404@rabbitmq.com>
References: <f0a95781-4c33-4ef4-9c45-2631559aca97@j5g2000yqm.googlegroups.com>
	<4F5E0385.3060404@rabbitmq.com>
Message-ID: <D652198D-C806-4393-A187-B4E913C898DA@rabbitmq.com>

Could you provide us with the full parameter list of the call?

Maybe you have the wrong types of arguments, causing it to look
for another QueueDeclare that isn't defined?

Steve Powell  (a guessy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 12 Mar 2012, at 14:09, Emile Joubert wrote:

> Hi,
> 
> On 12/03/12 13:38, Veloz wrote:
>> Hi there
>> We're trying to use RabbitMQ in C# and the method call to
>> IModel.QueueDeclare results in a MethodNotFound error.
>> 
>> I checked the API docs, it shows QueueDeclare as a valid method that
>> should be supported by the library.
> 
> It is definitely present. See here:
> 
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/73b264cffa70/projects/client/RabbitMQ.Client/src/client/api/IModel.cs#l245
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From virolord at gmail.com  Mon Mar 12 14:17:47 2012
From: virolord at gmail.com (Abhinav Jha)
Date: Mon, 12 Mar 2012 19:47:47 +0530
Subject: [rabbitmq-discuss] [rabbitmq-erlang-client] Missing 1 queue
 message after nodedown message from another node.
In-Reply-To: <CAH+xwdD7Soe0HZC4kjq3ivp75anoweP0KwYz4Jy1uaQGLb8erQ@mail.gmail.com>
References: <CAL5u-71bwDAftR8LZWsTvayHe9YQ8Sr_u2YE0MnbFYMjZ-07HA@mail.gmail.com>
	<CAH+xwdD7Soe0HZC4kjq3ivp75anoweP0KwYz4Jy1uaQGLb8erQ@mail.gmail.com>
Message-ID: <CAL5u-72X8ApXu_NC7qsRZa9XhPtP2LFJWnaZ6MVZpeJ50Spa5A@mail.gmail.com>

Hi Robert !

Thanks for your reply. However I'm currently doing nothing in the nodedown
code, simply printing a diagnostic message. I do most of the reconnection
in the nodeup message. However that reconnection code is with node B which
doesn't have anything to do with the RabbitMQ connection at all, but a
third process.

Also, I found that recompiling everything ( my app, rebar and
 rabbitmq-server, rabbitmq-erlang-client ) with erlang v 14b04 ( as opposed
to erlang 15b ) fixed this problem for me. I dont know why though. I'll
perform some more tests on another machine and update here in about a week
or so..

Thanks,
Abhinav

On Mon, Mar 12, 2012 at 2:07 PM, Robert Raschke <rtrlists at googlemail.com>wrote:

>
> On Fri, Mar 9, 2012 at 6:58 PM, Abhinav Jha <virolord at gmail.com> wrote:
>
>> Hi,
>>
>> I have a small OTP App ( say node A), that subscribes to a RabbitMQ
>> queue, and also talks to another erlang node in another process ( node B ).
>>
>> Now, sometimes the process hosting node B crashes for some reason, and my
>> node A gets a 'nodedown' message. Up till this point, consumption from
>> RabbitMQ works perfectly.
>>
>> However, after my handle_info has finished processing the nodedown, if I
>> publish a message to the RabbitMQ queue, my app doesn't consume it.
>> However, all messages published after this one are consumed properly and
>> processed. However that 1 message remains in a message_unacknowledged state
>> in the queue, even though my handle_info refuses to have ever consumed it !
>>
>> Is this a known issue in the client ? Can someone please help me ?
>>
>> Rabbitmq server version : 2.7.1
>> Rabbitmq client version : 0.9.1 version of the AMQP protocol
>> Erlang: R15B
>>
>> Thanks !
>>
>>
> I would say a lot depends on what your "node A" code is doing in the
> handling of the nodedown info message. Are you using any State in your
> gen_server? If yes, could that be impacting your RabbitMQ message handling
> in any way? For example, leading to not ack'ing a msg?
>
> Robby
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/6ca68312/attachment.htm>

From son.dastan at googlemail.com  Mon Mar 12 14:23:44 2012
From: son.dastan at googlemail.com (Soner)
Date: Mon, 12 Mar 2012 07:23:44 -0700 (PDT)
Subject: [rabbitmq-discuss] 404,
 "NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <4F5DD42A.8010202@rabbitmq.com>
References: <605378f3-e702-445b-b3ef-5b4eb011aaaf@i5g2000yqo.googlegroups.com>
	<4F5DD42A.8010202@rabbitmq.com>
Message-ID: <16839100.584.1331562224912.JavaMail.geo-discussion-forums@ynbq18>


Hi Simon,

thanks for your quick answer. 

Before recreating the queue I checked the management tool and saw that 
my queue was synchronised to all nodes (the number of synchronised mirrors 
was 2). 
So all hosts were up and running.

And I also copied the name from the management tool before deleting and 
recreating the queue.

I will keep an eye on this and see if a similar situation occures again.

Cheers,
Soner


Am Montag, 12. M?rz 2012 11:47:06 UTC+1 schrieb Simon MacMullen:
>
> On 12/03/12 10:38, Soner wrote:
> > I am running a rabbit-mq (version 2.7.1) cluster with three nodes. On
> > this cluster I have created a mirrored and durable queue called 'foo'
> > by using the browser based management console. I also have created the
> > related exchange and binding. When I tried to connect with my consumer
> > and publisher I was getting following error:
> > 404, "NOT_FOUND - no queue 'foo' in vhost '/'"
>
> If you are a seeing a 404 then either:
>
> a) if you are getting that in response to a basic.consume you have not 
> created it with the name you think you have *or*
> b) if you are getting that in response to a queue.declare then you 
> created a non-mirrored queue on a host which is down.
>
> > I couldn't find any solution so I have deleted the queue and created
> > it again with the same setup as before. Then started the consumers
> > again and it worked. Somehow strange for me that recreating the queue
> > has helped.
>
> This suggests problem a).
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/9c698c35/attachment.htm>

From alan.antonuk at gmail.com  Mon Mar 12 14:39:52 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 12 Mar 2012 10:39:52 -0400
Subject: [rabbitmq-discuss] R: regarding SimpleAmqpClient
In-Reply-To: <5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>
Message-ID: <CAAt2poJS9n2=1VpnxFhKzUpEyAed7XO+ZHtkzqJB46ky06ZUxQ@mail.gmail.com>

If all you want to do is put an array of characters into a BasicMessage you
can do so using the string constructor:

char *myData;
size_t myDataLength;
BasicMessage::Create(std::string(myData, myDataLength));

And yes it will deal with embedded null's correctly.

If you're dead-set on using the other function (it really is meant as an
internal function) you can #include <amqp_framing.h> (from rabbitmq-c) and
use a amqp_basic_properties_t struct.  If you zero it out (using memset),
that is sufficient to make it work correctly (you'll get a BasicMessage
with no properties set).

-Alan

On Mon, Mar 12, 2012 at 8:33 AM, Lorenzo Rossi
<l.rossi.cons at vitrociset.it>wrote:

>  Another question:****
>
> I need to transmit raw data (an array of char) through Rabbit. The
> following function:****
>
> **-   **static ptr_t Create(amqp_bytes_t_& body,
> amqp_basic_properties_t_* properties) ****
>
> inserts a byte array struct, but an amqp_basic_properties_t_ is also
> needed, and I don?t know how to fill that structure. Any clues?****
>
> ** **
>
> Best,****
>
> ** **
>
> Lorenzo****
>
> ** **
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
> ** **
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*
>
> ** **
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* gioved? 8 marzo 2012 18:00
>
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Oggetto:* Re: [rabbitmq-discuss] regarding SimpleAmqpClient****
>
>  ** **
>
> I recently reworked the internals of the library (thus the v2.0-beta tag)
> and have not updated the code in the examples/ directory yet.****
>
> ** **
>
> So you are correct simple_connect.cpp is broken currently.****
>
> ** **
>
> To clarify: It is safe and reliable to have more than one consumer per
> AmqpClient::Channel object.****
>
> ** **
>
> -Alan****
>
> On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Dear expert, ****
>
> As I told you yesterday I?m working on a C++ application who uses
> RabbitMQ. I have a simple question for you: related to Channel.h, function
> BasicConsume() I read in the function comments****
>
> ?Note: due to a limitation to how things are done, it is only possible to
> reliably have a single consumer per channel, calling this more than once
> per channel may result in undefined results from BasicConsumeMessage?****
>
> Is it something related only on the C++ implementation? ****
>
>  ****
>
> Last but not least, I think there are some mistakes in the example
> simple_connect.cpp****
>
>  ****
>
> 1.      #include <SimpleAmqpClient.h> should be #include <
> SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure
> copies that file in the SimpleAmqpClient folder;****
>
> 2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage();
> doesn?t work for two reasons:****
>
> a.      A function BasicConsumeMessage() which takes no argument doesn?t
> exist in Channel.h;****
>
> b.      The function BasicConsumeMessage(?) currently defined in
> Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t. ****
>
> 3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX
> header. I had to comment that row in order to make things work in Visual
> Studio 2008. ****
>
>  ****
>
>  ****
>
> Best wishes,****
>
>  ****
>
> Lorenzo****
>
>  ****
>
>  ****
>
>  ****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* marted? 6 marzo 2012 17:23
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Oggetto:* Re: [rabbitmq-discuss] how to build SimpleAmqpClient?****
>
>  ****
>
> Did you build boost as a set of static libraries?  If so you'll need to
> set the Boost_USE_STATIC_LIBS=ON CMake variable.****
>
>  ****
>
> Another note: given you're building with VS2008 you're going to run into a
> different problem once you get past the boost library issue you're having:
> see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what
> the issue is and a workaround.****
>
>  ****
>
> -Alan****
>
> On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Dear Experts,****
>
> I?m trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008),
> but when I execute CMake, there are errors regarding boost:****
>
>  ****
>
> CMake Error at C:/Program Files (x86)/CMake
> 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):****
>
> Unable to find the requested Boost libraries.****
>
> Boost version: 1.48.0****
>
> Boost include path: C:/Applicazioni/boost****
>
> The following Boost libraries could not be found:****
>
> boost_chrono****
>
> boost_system****
>
> No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the
> ****
>
> directory containing Boost libraries or BOOST_ROOT to the location of****
>
> Boost.****
>
> Call Stack (most recent call first):****
>
> CMakeLists.txt:8 (FIND_PACKAGE)****
>
>  ****
>
> I add manually the filepath for chrono and system to
> Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release,
> Boost_System_Library_Debug, Boost_ System_Library_Release, but still it
> doesn?t find anything. I also create the BOOST_ROOT but still it doesn?t
> work.****
>
> Any suggestion?****
>
>
> Best,****
>
>
> Lorenzo****
>
>  ****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/95f4a60c/attachment.htm>

From carl.hoerberg at gmail.com  Mon Mar 12 14:39:45 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Mon, 12 Mar 2012 15:39:45 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <4F5E0499.8060007@rabbitmq.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<59EA52AA-41EF-4A9B-AB56-CA7D361185D3@gmail.com>
	<CAFPidkPAn8OZFCHn-uZxdzscDi7t2JeP3X_1BismE870EU9zEw@mail.gmail.com>
	<4F5E0499.8060007@rabbitmq.com>
Message-ID: <CAFPidkP+JdbJ433NDVFG4p1NQuiLKbBLRunbdK8iOf4GjKRyGA@mail.gmail.com>

if Irmo is correct, wouldn't that be considered a bug?

or can fragment size tuning prevent that? if so, what might be a decent value?

On Mon, Mar 12, 2012 at 15:13, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Carl,
>
> On 12/03/12 13:23, Carl H?rberg wrote:
>> is it possible to configure a max message size limit?
>
> No, but you can limit the maximum fragment size during connection tuning.
>
> -Emile

From l.rossi.cons at vitrociset.it  Mon Mar 12 14:48:37 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Mon, 12 Mar 2012 14:48:37 +0000
Subject: [rabbitmq-discuss] R:  R: regarding SimpleAmqpClient
In-Reply-To: <CAAt2poJS9n2=1VpnxFhKzUpEyAed7XO+ZHtkzqJB46ky06ZUxQ@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>
	<CAAt2poJS9n2=1VpnxFhKzUpEyAed7XO+ZHtkzqJB46ky06ZUxQ@mail.gmail.com>
Message-ID: <5A0675B6BF3DB54EAF607B755455A08417347E8E@XCH10MBX.vitrociset.int>

Sorry, I did a mistake!
What I want to send is an array of raw bytes , which I usually manage as (unsigned) char[]. In other words, the null character ('\0') may be present several times within the array, it's not a c string.
 However, the internal function with amqp_basic_properties_t set to  zero should work in my case.

Best,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com]
Inviato: luned? 12 marzo 2012 15:40
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Oggetto: Re: [rabbitmq-discuss] R: regarding SimpleAmqpClient

If all you want to do is put an array of characters into a BasicMessage you can do so using the string constructor:

char *myData;
size_t myDataLength;
BasicMessage::Create(std::string(myData, myDataLength));

And yes it will deal with embedded null's correctly.

If you're dead-set on using the other function (it really is meant as an internal function) you can #include <amqp_framing.h> (from rabbitmq-c) and use a amqp_basic_properties_t struct.  If you zero it out (using memset), that is sufficient to make it work correctly (you'll get a BasicMessage with no properties set).

-Alan
On Mon, Mar 12, 2012 at 8:33 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Another question:
I need to transmit raw data (an array of char) through Rabbit. The following function:

-   static ptr_t Create(amqp_bytes_t_& body, amqp_basic_properties_t_* properties)
inserts a byte array struct, but an amqp_basic_properties_t_ is also needed, and I don't know how to fill that structure. Any clues?

Best,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: gioved? 8 marzo 2012 18:00

A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] regarding SimpleAmqpClient

I recently reworked the internals of the library (thus the v2.0-beta tag) and have not updated the code in the examples/ directory yet.

So you are correct simple_connect.cpp is broken currently.

To clarify: It is safe and reliable to have more than one consumer per AmqpClient::Channel object.

-Alan
On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear expert,
As I told you yesterday I'm working on a C++ application who uses RabbitMQ. I have a simple question for you: related to Channel.h, function BasicConsume() I read in the function comments
"Note: due to a limitation to how things are done, it is only possible to reliably have a single consumer per channel, calling this more than once per channel may result in undefined results from BasicConsumeMessage"
Is it something related only on the C++ implementation?

Last but not least, I think there are some mistakes in the example simple_connect.cpp


1.      #include <SimpleAmqpClient.h> should be #include < SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure copies that file in the SimpleAmqpClient folder;

2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage(); doesn't work for two reasons:

a.      A function BasicConsumeMessage() which takes no argument doesn't exist in Channel.h;

b.      The function BasicConsumeMessage(...) currently defined in Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t.

3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX header. I had to comment that row in order to make things work in Visual Studio 2008.


Best wishes,

Lorenzo




Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: marted? 6 marzo 2012 17:23
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] how to build SimpleAmqpClient?

Did you build boost as a set of static libraries?  If so you'll need to set the Boost_USE_STATIC_LIBS=ON CMake variable.

Another note: given you're building with VS2008 you're going to run into a different problem once you get past the boost library issue you're having: see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what the issue is and a workaround.

-Alan
On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear Experts,
I'm trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008), but when I execute CMake, there are errors regarding boost:


CMake Error at C:/Program Files (x86)/CMake 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):

Unable to find the requested Boost libraries.

Boost version: 1.48.0

Boost include path: C:/Applicazioni/boost

The following Boost libraries could not be found:

boost_chrono

boost_system

No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the

directory containing Boost libraries or BOOST_ROOT to the location of

Boost.

Call Stack (most recent call first):

CMakeLists.txt:8 (FIND_PACKAGE)

I add manually the filepath for chrono and system to Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release, Boost_System_Library_Debug, Boost_ System_Library_Release, but still it doesn't find anything. I also create the BOOST_ROOT but still it doesn't work.
Any suggestion?

Best,

Lorenzo


Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/bfe125b3/attachment.htm>

From jerryk at vmware.com  Mon Mar 12 14:50:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 07:50:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAPNZrFVr7hz94_kaf3wHPzim9CGY-bvQa1-Ck6tdfcHYwrHD2g@mail.gmail.com>
Message-ID: <aea96739-5d70-40dc-b05f-21dfbe3d77bb@strongmad.batnest.org>

This is also a pretty natural thing to do with a system like Zookeeper
from the Hadoop project, although it would require Rabbit to grow something
like a plugin that either had an Erlang Zookeeper client, or used a port
or jinterface to the native C or Java Zookeeper clients, to do the necessary
work...

Best regards,
Jerry

----- Original Message -----
From: "stone" <zmstone at gmail.com>
To: "Carl H?rberg" <carl.hoerberg at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 12, 2012 5:46:34 AM
Subject: Re: [rabbitmq-discuss] Good practice to work with rabbit cluster?


seems better than config file. thanks Carl.


2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >


no, you have to manually administer the dns (or automatically through
some heartbeat stuff interacting with your dns provider api.. )

i don't know how the client implementations are, but they could try to
connect to the first A record, if that fails try the next one and so
forth.. (like the way many web browsers does)



On Mon, Mar 12, 2012 at 13:28, stone < zmstone at gmail.com > wrote:
> I'm not sure how DNS server works, is it possible for the DNS server to
> detect the failure of a specific port? i.e. to find out if rabbit is down,
> when the OS is still up and running.
>
>
> 2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >
>>
>> what about a multi A DNS record (with low ttl), which you update when
>> a server is down/up?
>>
>> On Mon, Mar 12, 2012 at 11:26, stone < zmstone at gmail.com > wrote:
>> > Hi there!
>> >
>> > Is there any good practice regarding how to write self-managed AMQP
>> > client
>> > (Erlang based)
>> > Here is what I need to accomplish:
>> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
>> > using a configuration file would be a simple solution, but, is there a
>> > better way?
>> >
>> > 2. Client should be able to get the rabbit server "running cluster"
>> > information.
>> > so if the current connection is broken, it could try another one in the
>> > cluster,
>> > then perhaps update the "running cluster" list from the new node;
>> >
>> > Brs
>> > /stone
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Mon Mar 12 14:54:52 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 07:54:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FEB@MAILCCR.us.syncsort.com>
Message-ID: <83bd0bac-ef3f-4605-8e89-d13a32626c65@strongmad.batnest.org>

Hi, Paul:

Emile on the Rabbit team has kindly reminded me of another feature
that might help you (and one whose existence I chronically forget
about)...

The management plugin config has an upload feature that lets you
preserve all broker configuration details, including user accounts 
and (hashed) passwords.

If you look at the very bottom of the page associated with the
'Overview' tab in the management plugin you'll find UI controls
for Upload/Download broker definitions...

Best regards,
Jerry


----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 9, 2012 1:41:59 PM
Subject: RE: [rabbitmq-discuss] Configuring Users

Thank you, Sir.

Most helpful.

Cordially,

Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Friday, March 09, 2012 4:40 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuring Users

Hi, Paul... answers inline:

> But let me make sure I understand: user names and passwords are NOT in
> rabbitmq.config; for Windows, rabbitmq.config will be in %APPDATA%\RabbitMQ\.

By default, that shoudl be the case, yes.

> I see no rabbitmq.config in %APPDATA%\RabbitMQ\. I can only conclude from this that > its presence is not required if all default configuration values are in effect (my case, I > think).

Rabbit can live without a file there.  If you enable RABBITMQ_CONSOLE_LOG as per this page:

http://www.rabbitmq.com/configure.html

you can look at the RabbitMQ startup blurb.  It will print a line prefaced with "config file(s):" that will tell you what, if any config files it used when starting up.  See the "Verify Configuration" of the above page for details.

> Here's what's behind my question: I am thinking about the use of site-specific
> passwords, i.e., I don't want to ship a product to multiple customers and have these
> multiple instances of Rabbit share a common password for a fixed username.

Sounds very reasonable.

> Let's suppose that I have a means of generating, encrypting, and saving to disk a
> site-specific password for this fixed Rabbit user (maybe the username, common to all > installations, is "syncsortRabbit" - whatever). Rabbit login code would then have
> to read
> the password from disk, decrypt it, and then convey it via
> connectionFactory.setPassword().

And also of course get an appropriate user created in the broker with known name and matching password, but yes indeed.

> From another perspective, I cannot distribute a product whose Rabbit component has a > pre-configured user all of whose passwords are identical. That is, each copy can have > user "syncsortRabbit" and each can have an initial fixed password, but I would need a > way to change that password to make it site-specific.
>
> Perhaps, after generating a site-specific password, I could accomplish this via
> rabbitmqctl add_user.....?

You absolutely could do that.   Details depend on how you're distributing Rabbit and how you're doing the per-user customization.  You could imagine giving your customers a run-once, initial provisioning scripts that creates users/passwords that your system needs for example.

Best regards,
Jerry



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From alan.antonuk at gmail.com  Mon Mar 12 14:57:21 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 12 Mar 2012 10:57:21 -0400
Subject: [rabbitmq-discuss] R: R: regarding SimpleAmqpClient
In-Reply-To: <5A0675B6BF3DB54EAF607B755455A08417347E8E@XCH10MBX.vitrociset.int>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>
	<CAAt2poJS9n2=1VpnxFhKzUpEyAed7XO+ZHtkzqJB46ky06ZUxQ@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347E8E@XCH10MBX.vitrociset.int>
Message-ID: <CAAt2poJsi=28sMwV=V8+-e3sEA5U-cfMuzDqtVg7uZQ5wC_q=w@mail.gmail.com>

std::string can handle '\0' in the middle of an array, you just need to use
the correct constructor.

-Alan

On Mon, Mar 12, 2012 at 10:48 AM, Lorenzo Rossi
<l.rossi.cons at vitrociset.it>wrote:

>  Sorry, I did a mistake!****
>
> What I want to send is an array of raw bytes , which I usually manage as
> (unsigned) char[]. In other words, the null character (?\0?) may be present
> several times within the array, it?s not a c string. ****
>
>  However, the internal function with amqp_basic_properties_t set to  zero
> should work in my case.****
>
> ** **
>
> Best,****
>
> ** **
>
> Lorenzo****
>
> ** **
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
> ** **
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*
>
> ** **
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* luned? 12 marzo 2012 15:40
>
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Oggetto:* Re: [rabbitmq-discuss] R: regarding SimpleAmqpClient****
>
>  ** **
>
> If all you want to do is put an array of characters into a BasicMessage
> you can do so using the string constructor:****
>
> ** **
>
> char *myData;****
>
> size_t myDataLength;****
>
> BasicMessage::Create(std::string(myData, myDataLength));****
>
> ** **
>
> And yes it will deal with embedded null's correctly.****
>
> ** **
>
> If you're dead-set on using the other function (it really is meant as an
> internal function) you can #include <amqp_framing.h> (from rabbitmq-c) and
> use a amqp_basic_properties_t struct.  If you zero it out (using memset),
> that is sufficient to make it work correctly (you'll get a BasicMessage
> with no properties set).****
>
> ** **
>
> -Alan****
>
> On Mon, Mar 12, 2012 at 8:33 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Another question:****
>
> I need to transmit raw data (an array of char) through Rabbit. The
> following function:****
>
> -   static ptr_t Create(amqp_bytes_t_& body, amqp_basic_properties_t_*
> properties) ****
>
> inserts a byte array struct, but an amqp_basic_properties_t_ is also
> needed, and I don?t know how to fill that structure. Any clues?****
>
>  ****
>
> Best,****
>
>  ****
>
> Lorenzo****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* gioved? 8 marzo 2012 18:00****
>
>
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com****
>
> *Oggetto:* Re: [rabbitmq-discuss] regarding SimpleAmqpClient****
>
>  ****
>
> I recently reworked the internals of the library (thus the v2.0-beta tag)
> and have not updated the code in the examples/ directory yet.****
>
>  ****
>
> So you are correct simple_connect.cpp is broken currently.****
>
>  ****
>
> To clarify: It is safe and reliable to have more than one consumer per
> AmqpClient::Channel object.****
>
>  ****
>
> -Alan****
>
> On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Dear expert, ****
>
> As I told you yesterday I?m working on a C++ application who uses
> RabbitMQ. I have a simple question for you: related to Channel.h, function
> BasicConsume() I read in the function comments****
>
> ?Note: due to a limitation to how things are done, it is only possible to
> reliably have a single consumer per channel, calling this more than once
> per channel may result in undefined results from BasicConsumeMessage?****
>
> Is it something related only on the C++ implementation? ****
>
>  ****
>
> Last but not least, I think there are some mistakes in the example
> simple_connect.cpp****
>
>  ****
>
> 1.      #include <SimpleAmqpClient.h> should be #include <
> SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure
> copies that file in the SimpleAmqpClient folder;****
>
> 2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage();
> doesn?t work for two reasons:****
>
> a.      A function BasicConsumeMessage() which takes no argument doesn?t
> exist in Channel.h;****
>
> b.      The function BasicConsumeMessage(?) currently defined in
> Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t. ****
>
> 3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX
> header. I had to comment that row in order to make things work in Visual
> Studio 2008. ****
>
>  ****
>
>  ****
>
> Best wishes,****
>
>  ****
>
> Lorenzo****
>
>  ****
>
>  ****
>
>  ****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
> *Da:* Alan Antonuk [mailto:alan.antonuk at gmail.com]
> *Inviato:* marted? 6 marzo 2012 17:23
> *A:* Lorenzo Rossi
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Oggetto:* Re: [rabbitmq-discuss] how to build SimpleAmqpClient?****
>
>  ****
>
> Did you build boost as a set of static libraries?  If so you'll need to
> set the Boost_USE_STATIC_LIBS=ON CMake variable.****
>
>  ****
>
> Another note: given you're building with VS2008 you're going to run into a
> different problem once you get past the boost library issue you're having:
> see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what
> the issue is and a workaround.****
>
>  ****
>
> -Alan****
>
> On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it>
> wrote:****
>
> Dear Experts,****
>
> I?m trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008),
> but when I execute CMake, there are errors regarding boost:****
>
>  ****
>
> CMake Error at C:/Program Files (x86)/CMake
> 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):****
>
> Unable to find the requested Boost libraries.****
>
> Boost version: 1.48.0****
>
> Boost include path: C:/Applicazioni/boost****
>
> The following Boost libraries could not be found:****
>
> boost_chrono****
>
> boost_system****
>
> No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the
> ****
>
> directory containing Boost libraries or BOOST_ROOT to the location of****
>
> Boost.****
>
> Call Stack (most recent call first):****
>
> CMakeLists.txt:8 (FIND_PACKAGE)****
>
>  ****
>
> I add manually the filepath for chrono and system to
> Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release,
> Boost_System_Library_Debug, Boost_ System_Library_Release, but still it
> doesn?t find anything. I also create the BOOST_ROOT but still it doesn?t
> work.****
>
> Any suggestion?****
>
>
> Best,****
>
>
> Lorenzo****
>
>  ****
>
>  ****
>
> Lorenzo Rossi****
>
> _________________________________________****
>
> Vitrociset S.p.A.****
>
> Via Tiburtina, 1020 - 00156 Roma - Italia****
>
> +39 06 8820 3047****
>
>  ****
>
> Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste
> ricevuti per errore, vogliate cortesemente darcene comunicazione subito e
> distruggere il messaggio ricevuto erroneamente dal Vostro sistema
> informatizzato. Per piacere non li utilizzate per nessun fine, o
> diffondete  il loro contenuto a nessun altra persona: fare ci? comporta
> violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie
> per la cooperazione.****
>
> *This e-mail and any attachment are confidential. If you have received
> them in error, you are on notice of their status.  Please notify us
> immediately by replying e-mail and then delete this message from your
> system.  Please do not copy or use them for any purposes, or disclose their
> contents to any other person:  to do so could be a breach of the Italian
> Privacy D. L.vo 196/2003. **Thank you for your co-operation*****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
>  ****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/2528e6a0/attachment.htm>

From pbell at syncsort.com  Mon Mar 12 14:59:12 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Mon, 12 Mar 2012 10:59:12 -0400
Subject: [rabbitmq-discuss] Configuring Users
In-Reply-To: <83bd0bac-ef3f-4605-8e89-d13a32626c65@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41694FEB@MAILCCR.us.syncsort.com>
	<83bd0bac-ef3f-4605-8e89-d13a32626c65@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695078@MAILCCR.us.syncsort.com>

Jerry (and Emile),

Thank you.

I am looking now at the Overview tab, but see no controls for "Upload/Download broker definitions."

The last line on the page (aside from a "Last update" timestamp on the right side) says "HTTP API|Command Line |".

Am I using wrong version of the plug-in?

-Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Monday, March 12, 2012 10:55 AM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuring Users

Hi, Paul:

Emile on the Rabbit team has kindly reminded me of another feature
that might help you (and one whose existence I chronically forget
about)...

The management plugin config has an upload feature that lets you
preserve all broker configuration details, including user accounts 
and (hashed) passwords.

If you look at the very bottom of the page associated with the
'Overview' tab in the management plugin you'll find UI controls
for Upload/Download broker definitions...

Best regards,
Jerry


----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 9, 2012 1:41:59 PM
Subject: RE: [rabbitmq-discuss] Configuring Users

Thank you, Sir.

Most helpful.

Cordially,

Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Friday, March 09, 2012 4:40 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuring Users

Hi, Paul... answers inline:

> But let me make sure I understand: user names and passwords are NOT in
> rabbitmq.config; for Windows, rabbitmq.config will be in %APPDATA%\RabbitMQ\.

By default, that shoudl be the case, yes.

> I see no rabbitmq.config in %APPDATA%\RabbitMQ\. I can only conclude from this that > its presence is not required if all default configuration values are in effect (my case, I > think).

Rabbit can live without a file there.  If you enable RABBITMQ_CONSOLE_LOG as per this page:

http://www.rabbitmq.com/configure.html

you can look at the RabbitMQ startup blurb.  It will print a line prefaced with "config file(s):" that will tell you what, if any config files it used when starting up.  See the "Verify Configuration" of the above page for details.

> Here's what's behind my question: I am thinking about the use of site-specific
> passwords, i.e., I don't want to ship a product to multiple customers and have these
> multiple instances of Rabbit share a common password for a fixed username.

Sounds very reasonable.

> Let's suppose that I have a means of generating, encrypting, and saving to disk a
> site-specific password for this fixed Rabbit user (maybe the username, common to all > installations, is "syncsortRabbit" - whatever). Rabbit login code would then have
> to read
> the password from disk, decrypt it, and then convey it via
> connectionFactory.setPassword().

And also of course get an appropriate user created in the broker with known name and matching password, but yes indeed.

> From another perspective, I cannot distribute a product whose Rabbit component has a > pre-configured user all of whose passwords are identical. That is, each copy can have > user "syncsortRabbit" and each can have an initial fixed password, but I would need a > way to change that password to make it site-specific.
>
> Perhaps, after generating a site-specific password, I could accomplish this via
> rabbitmqctl add_user.....?

You absolutely could do that.   Details depend on how you're distributing Rabbit and how you're doing the per-user customization.  You could imagine giving your customers a run-once, initial provisioning scripts that creates users/passwords that your system needs for example.

Best regards,
Jerry



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From andrea.rosa at hp.com  Mon Mar 12 15:14:02 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 12 Mar 2012 15:14:02 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in the
	log file
Message-ID: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>

Hi

I've got some questions about the limit alarms report in the log file, some entries are not clear to me.

1 this line is reported in the log files when we are close to the file handles or memory limit?: 
=INFO REPORT==== 
Limiting to approx 3996 file handles (3594 sockets)

=INFO REPORT====
Memory limit set to 38749MB.

2 why there is this difference between the file handles and the number of sockets?

3 the following entries mean that we hit the limit for file_descriptor? Why we have a set and a clear?
=INFO REPORT==== 
    alarm_handler: {set,{file_descriptor_limit,[]}}

=INFO REPORT==== 
    alarm_handler: {clear,file_descriptor_limit} 

Regards
--
Andrea


From simon at rabbitmq.com  Mon Mar 12 15:16:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Mar 2012 15:16:58 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <bw7vcmadjc0.fsf@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com> <bw7vcmadjc0.fsf@mail.cern.ch>
Message-ID: <4F5E136A.4060806@rabbitmq.com>

On 12/03/12 13:45, Lionel Cons wrote:
> The number of messages received varies: 15, 13, 12, 9...

Thank you. Replicated. That noise you can hear in the distance is me 
screaming at our automated tests.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 12 15:31:12 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 12 Mar 2012 11:31:12 -0400
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
Message-ID: <CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>

On 12 March 2012 08:51, Irmo Manie <irmo.manie at gmail.com> wrote:

> Clustered nodes are connected via 1 tcp connection, which must also
> transport a (erlang) heartbeat. If your big message takes more time to
> transfer between nodes than the heartbeat timeout (anywhere between
> ~20-45 seconds if I'm correct), the cluster will break and your
> message is lost.
>

Wow! Is that really the case? Erlang's distribution breaks if no heartbeats
have been received *even if there's traffic coming in on the wire*? Sounds
like an Erlang bug. Or perhaps there's some subtlety in the design I'm not
seeing!

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/481557eb/attachment.htm>

From zabrane3 at gmail.com  Mon Mar 12 15:42:52 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Mon, 12 Mar 2012 16:42:52 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
Message-ID: <BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>

It's not a bug. You have to be aware of it to build reliable systems in case of multiple connected Erlang nodes.

Regards,
Zabrane

On Mar 12, 2012, at 4:31 PM, Tony Garnock-Jones wrote:

> On 12 March 2012 08:51, Irmo Manie <irmo.manie at gmail.com> wrote:
> Clustered nodes are connected via 1 tcp connection, which must also
> transport a (erlang) heartbeat. If your big message takes more time to
> transfer between nodes than the heartbeat timeout (anywhere between
> ~20-45 seconds if I'm correct), the cluster will break and your
> message is lost.
> 
> Wow! Is that really the case? Erlang's distribution breaks if no heartbeats have been received *even if there's traffic coming in on the wire*? Sounds like an Erlang bug. Or perhaps there's some subtlety in the design I'm not seeing!
> 
> Regards,
>   Tony
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/7ecfbc8b/attachment.htm>

From jerryk at vmware.com  Mon Mar 12 15:48:09 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 08:48:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
	the	log file
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
Message-ID: <62393095-55b0-4dc8-a044-c3f60a96e3ba@strongmad.batnest.org>

Hi, Andrea:

When you see the former, it might not be a bad idea to take a peek with
lsof, or similar, and see just what the file descriptors for Rabbit
correspond to.  Remember, they're not all going to correspond to sockets,
as Rabbit has various files it deals with during operation.  Using ulimit
or editing limits.conf to change what your OS is making available to Rabbit 
is also something to keep in mind if you're finding yourself regularly
running low on fd's.

If things are working normally you'll see the alarm set when you hit a limit,
and clear when that warning condition remits, say after something is closed.

How many connections is your broker maintaining when you see these?  Rabbit
will use a file descriptor for each connection, but also tries to leave them
open until it finds a reason to close them, for example, it starts approaching
a limit as you see here.

Best regards,
Jerry

----- Original Message -----
From: "Andrea Rosa (HP Cloud Services)" <andrea.rosa at hp.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 12, 2012 8:14:02 AM
Subject: [rabbitmq-discuss] Questions about limit alarm and report in the	log file

Hi

I've got some questions about the limit alarms report in the log file, some entries are not clear to me.

1 this line is reported in the log files when we are close to the file handles or memory limit?: 
=INFO REPORT==== 
Limiting to approx 3996 file handles (3594 sockets)

=INFO REPORT====
Memory limit set to 38749MB.

2 why there is this difference between the file handles and the number of sockets?

3 the following entries mean that we hit the limit for file_descriptor? Why we have a set and a clear?
=INFO REPORT==== 
    alarm_handler: {set,{file_descriptor_limit,[]}}

=INFO REPORT==== 
    alarm_handler: {clear,file_descriptor_limit} 

Regards
--
Andrea

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Mon Mar 12 15:50:19 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 08:50:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
Message-ID: <3f2f8377-bd19-481d-a776-f7fddc479c4f@strongmad.batnest.org>

It still seems slightly strange though, since if an Erlang node is
actively reading bytes off a connection, it seems like that could serve
as proxy for the heartbeat, which would only really be essential when
nothing else is going on...   But there could easily be some subtlety of
the design or implementation that's eluding me...

Jerry

----- Original Message -----
From: "Zabrane Mickael" <zabrane3 at gmail.com>
To: "Tony Garnock-Jones" <tonygarnockjones+rabbitmq at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 12, 2012 8:42:52 AM
Subject: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?





It's not a bug. You have to be aware of it to build reliable systems in case of multiple connected Erlang nodes. 



Regards, 
Zabrane 

On Mar 12, 2012, at 4:31 PM, Tony Garnock-Jones wrote: 



On 12 March 2012 08:51, Irmo Manie < irmo.manie at gmail.com > wrote: 


Clustered nodes are connected via 1 tcp connection, which must also 
transport a (erlang) heartbeat. If your big message takes more time to 
transfer between nodes than the heartbeat timeout (anywhere between 
~20-45 seconds if I'm correct), the cluster will break and your 
message is lost. 


Wow! Is that really the case? Erlang's distribution breaks if no heartbeats have been received *even if there's traffic coming in on the wire*? Sounds like an Erlang bug. Or perhaps there's some subtlety in the design I'm not seeing! 

Regards, 
Tony 
-- 
Tony Garnock-Jones 
tonygarnockjones at gmail.com 
http://homepages.kcbbs.gen.nz/tonyg/ 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From zmstone at gmail.com  Mon Mar 12 15:58:17 2012
From: zmstone at gmail.com (stone)
Date: Mon, 12 Mar 2012 16:58:17 +0100
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <aea96739-5d70-40dc-b05f-21dfbe3d77bb@strongmad.batnest.org>
References: <CAPNZrFVr7hz94_kaf3wHPzim9CGY-bvQa1-Ck6tdfcHYwrHD2g@mail.gmail.com>
	<aea96739-5d70-40dc-b05f-21dfbe3d77bb@strongmad.batnest.org>
Message-ID: <CAPNZrFV=KWiK5JdJQQgncGw3r69OtNtr-vLevybsTMC31QLrhg@mail.gmail.com>

Yeah, that's probably a decent solution too.
Another similar tool is doozer https://github.com/ha/doozer
I've never used either of them though.

How about a deamon constantly pull the information from
command line "rabbitmqctl status" ?
I mean comparing to a plugin, will it cause any performance impact to
rabbit-server?

Brs
/stone

2012/3/12 Jerry Kuch <jerryk at vmware.com>

> This is also a pretty natural thing to do with a system like Zookeeper
> from the Hadoop project, although it would require Rabbit to grow something
> like a plugin that either had an Erlang Zookeeper client, or used a port
> or jinterface to the native C or Java Zookeeper clients, to do the
> necessary
> work...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "stone" <zmstone at gmail.com>
> To: "Carl H?rberg" <carl.hoerberg at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, March 12, 2012 5:46:34 AM
> Subject: Re: [rabbitmq-discuss] Good practice to work with rabbit cluster?
>
>
> seems better than config file. thanks Carl.
>
>
> 2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >
>
>
> no, you have to manually administer the dns (or automatically through
> some heartbeat stuff interacting with your dns provider api.. )
>
> i don't know how the client implementations are, but they could try to
> connect to the first A record, if that fails try the next one and so
> forth.. (like the way many web browsers does)
>
>
>
> On Mon, Mar 12, 2012 at 13:28, stone < zmstone at gmail.com > wrote:
> > I'm not sure how DNS server works, is it possible for the DNS server to
> > detect the failure of a specific port? i.e. to find out if rabbit is
> down,
> > when the OS is still up and running.
> >
> >
> > 2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >
> >>
> >> what about a multi A DNS record (with low ttl), which you update when
> >> a server is down/up?
> >>
> >> On Mon, Mar 12, 2012 at 11:26, stone < zmstone at gmail.com > wrote:
> >> > Hi there!
> >> >
> >> > Is there any good practice regarding how to write self-managed AMQP
> >> > client
> >> > (Erlang based)
> >> > Here is what I need to accomplish:
> >> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
> >> > using a configuration file would be a simple solution, but, is there a
> >> > better way?
> >> >
> >> > 2. Client should be able to get the rabbit server "running cluster"
> >> > information.
> >> > so if the current connection is broken, it could try another one in
> the
> >> > cluster,
> >> > then perhaps update the "running cluster" list from the new node;
> >> >
> >> > Brs
> >> > /stone
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >
> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/4c01ec28/attachment.htm>

From matthew at rabbitmq.com  Mon Mar 12 16:00:33 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 12 Mar 2012 16:00:33 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
 the log file
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
Message-ID: <20120312160032.GA28972@wellquite.org>

Hi,

On Mon, Mar 12, 2012 at 03:14:02PM +0000, Rosa, Andrea (HP Cloud Services) wrote:
> 1 this line is reported in the log files when we are close to the file handles or memory limit?: 
> =INFO REPORT==== 
> Limiting to approx 3996 file handles (3594 sockets)
> 
> =INFO REPORT====
> Memory limit set to 38749MB.

These are added to the log on startup so that you can be sure that any
configuration changes you've made have taken affect.

> 2 why there is this difference between the file handles and the number of sockets?

Rabbit will always need some file handles. It's quite smart about
sharing file handles internally between the various different processes
that need to work with files, but it will always need some. Thus we
ensure that not all file descriptors can be used for sockets - we
reserve some just for files.

> 3 the following entries mean that we hit the limit for file_descriptor? Why we have a set and a clear?
> =INFO REPORT==== 
>     alarm_handler: {set,{file_descriptor_limit,[]}}
> 
> =INFO REPORT==== 
>     alarm_handler: {clear,file_descriptor_limit} 

"Set" means you've hit the limit. "Clear" means you're no longer at the
limit - either some connections have closed or Rabbit's internally
managed to free up some descriptors so that it's no longer at the limit.

It is, however, a slightly imprecise measure. We can't control the use
of FDs by the Erlang VM itself, and some plugins don't make use of the
correct API to ensure we account correctly for FD usage.


Matthew

From jerryk at vmware.com  Mon Mar 12 16:00:54 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 09:00:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Good practice to work with rabbit cluster?
In-Reply-To: <CAPNZrFV=KWiK5JdJQQgncGw3r69OtNtr-vLevybsTMC31QLrhg@mail.gmail.com>
Message-ID: <40d0d73e-c04a-4c7a-9297-526f8082cdae@strongmad.batnest.org>

Using rabbitmqctl status is one thing you could do.  The management HTTP also has
an "aliveness check" method on it that you could poke at some reasonably non
obnoxious frequency.  See here:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_2_0/priv/www-api/help.html

It declares a test queue, then publishes and consumes a message, and is
expressly intended to allow monitoring tools a not too high impact way
to make sure a broker is not only up, but also not addled in some way
that is totally preventing it from doing useful messaging work.

Best regards,
Jerry

----- Original Message -----
From: "stone" <zmstone at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com, "Carl H?rberg" <carl.hoerberg at gmail.com>
Sent: Monday, March 12, 2012 8:58:17 AM
Subject: Re: [rabbitmq-discuss] Good practice to work with rabbit cluster?

Yeah, that's probably a decent solution too.
Another similar tool is doozer https://github.com/ha/doozer
I've never used either of them though.


How about a deamon constantly pull the information from

command line "rabbitmqctl status" ?
I mean comparing to a plugin, will it cause any performance impact to rabbit-server?


Brs
/stone


2012/3/12 Jerry Kuch < jerryk at vmware.com >


This is also a pretty natural thing to do with a system like Zookeeper
from the Hadoop project, although it would require Rabbit to grow something
like a plugin that either had an Erlang Zookeeper client, or used a port
or jinterface to the native C or Java Zookeeper clients, to do the necessary
work...

Best regards,
Jerry



----- Original Message -----
From: "stone" < zmstone at gmail.com >
To: "Carl H?rberg" < carl.hoerberg at gmail.com >
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 12, 2012 5:46:34 AM
Subject: Re: [rabbitmq-discuss] Good practice to work with rabbit cluster? 


seems better than config file. thanks Carl.


2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >


no, you have to manually administer the dns (or automatically through
some heartbeat stuff interacting with your dns provider api.. )

i don't know how the client implementations are, but they could try to
connect to the first A record, if that fails try the next one and so
forth.. (like the way many web browsers does)



On Mon, Mar 12, 2012 at 13:28, stone < zmstone at gmail.com > wrote:
> I'm not sure how DNS server works, is it possible for the DNS server to
> detect the failure of a specific port? i.e. to find out if rabbit is down,
> when the OS is still up and running.
>
>
> 2012/3/12 Carl H?rberg < carl.hoerberg at gmail.com >
>>
>> what about a multi A DNS record (with low ttl), which you update when
>> a server is down/up?
>>
>> On Mon, Mar 12, 2012 at 11:26, stone < zmstone at gmail.com > wrote:
>> > Hi there!
>> >
>> > Is there any good practice regarding how to write self-managed AMQP
>> > client
>> > (Erlang based)
>> > Here is what I need to accomplish:
>> > 1. I don't what to hard-code hostname/ip address of rabbit-server,
>> > using a configuration file would be a simple solution, but, is there a
>> > better way?
>> >
>> > 2. Client should be able to get the rabbit server "running cluster"
>> > information.
>> > so if the current connection is broken, it could try another one in the
>> > cluster,
>> > then perhaps update the "running cluster" list from the new node;
>> >
>> > Brs
>> > /stone
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Mon Mar 12 16:02:14 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 12 Mar 2012 16:02:14 +0000
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
	<BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
Message-ID: <20120312160214.GB28972@wellquite.org>

On Mon, Mar 12, 2012 at 04:42:52PM +0100, Zabrane Mickael wrote:
> It's not a bug. You have to be aware of it to build reliable systems in case of multiple connected Erlang nodes.

For those of us struggling to follow this, if you're currently in the
act of receiving data from node X, why can't you assume node X is still
alive? I.e. what is wrong with treating arbitrary data from node X as
evidence it's still alive, in lieu of a heartbeat from node X?

Matthew

From zabrane3 at gmail.com  Mon Mar 12 16:23:59 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Mon, 12 Mar 2012 17:23:59 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <20120312160214.GB28972@wellquite.org>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
	<BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
	<20120312160214.GB28972@wellquite.org>
Message-ID: <AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>


On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote:

> On Mon, Mar 12, 2012 at 04:42:52PM +0100, Zabrane Mickael wrote:
>> It's not a bug. You have to be aware of it to build reliable systems in case of multiple connected Erlang nodes.
> 
> For those of us struggling to follow this, if you're currently in the
> act of receiving data from node X, why can't you assume node X is still
> alive? I.e. what is wrong with treating arbitrary data from node X as
> evidence it's still alive, in lieu of a heartbeat from node X?

http://learnyousomeerlang.com/distribunomicon

Regards,
Zabrane

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/ad5e3cce/attachment.htm>

From l.rossi.cons at vitrociset.it  Mon Mar 12 16:30:59 2012
From: l.rossi.cons at vitrociset.it (Lorenzo Rossi)
Date: Mon, 12 Mar 2012 16:30:59 +0000
Subject: [rabbitmq-discuss] R:  R: R: regarding SimpleAmqpClient
In-Reply-To: <CAAt2poJsi=28sMwV=V8+-e3sEA5U-cfMuzDqtVg7uZQ5wC_q=w@mail.gmail.com>
References: <5A0675B6BF3DB54EAF607B755455A084173472CF@XCH10MBX.vitrociset.int>
	<CAAt2poLEL+h32hzBqKL3yTzwbwvDHt+Voe31WBg_fHaf2fL6hw@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347710@XCH10MBX.vitrociset.int>
	<CAAt2po+eHj-UjHvkUZNnCfr9YDetBUdXQ1sPYuh1EuPpYJD9Kg@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347AD0@XCH10MBX.vitrociset.int>
	<CAAt2poJS9n2=1VpnxFhKzUpEyAed7XO+ZHtkzqJB46ky06ZUxQ@mail.gmail.com>
	<5A0675B6BF3DB54EAF607B755455A08417347E8E@XCH10MBX.vitrociset.int>
	<CAAt2poJsi=28sMwV=V8+-e3sEA5U-cfMuzDqtVg7uZQ5wC_q=w@mail.gmail.com>
Message-ID: <5A0675B6BF3DB54EAF607B755455A08417348796@XCH10MBX.vitrociset.int>

Ok, thank you so much!

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com]
Inviato: luned? 12 marzo 2012 15:57
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Oggetto: Re: [rabbitmq-discuss] R: R: regarding SimpleAmqpClient

std::string can handle '\0' in the middle of an array, you just need to use the correct constructor.

-Alan
On Mon, Mar 12, 2012 at 10:48 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Sorry, I did a mistake!
What I want to send is an array of raw bytes , which I usually manage as (unsigned) char[]. In other words, the null character ('\0') may be present several times within the array, it's not a c string.
 However, the internal function with amqp_basic_properties_t set to  zero should work in my case.

Best,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: luned? 12 marzo 2012 15:40

A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] R: regarding SimpleAmqpClient

If all you want to do is put an array of characters into a BasicMessage you can do so using the string constructor:

char *myData;
size_t myDataLength;
BasicMessage::Create(std::string(myData, myDataLength));

And yes it will deal with embedded null's correctly.

If you're dead-set on using the other function (it really is meant as an internal function) you can #include <amqp_framing.h> (from rabbitmq-c) and use a amqp_basic_properties_t struct.  If you zero it out (using memset), that is sufficient to make it work correctly (you'll get a BasicMessage with no properties set).

-Alan
On Mon, Mar 12, 2012 at 8:33 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Another question:
I need to transmit raw data (an array of char) through Rabbit. The following function:

-   static ptr_t Create(amqp_bytes_t_& body, amqp_basic_properties_t_* properties)
inserts a byte array struct, but an amqp_basic_properties_t_ is also needed, and I don't know how to fill that structure. Any clues?

Best,

Lorenzo

Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: gioved? 8 marzo 2012 18:00

A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] regarding SimpleAmqpClient

I recently reworked the internals of the library (thus the v2.0-beta tag) and have not updated the code in the examples/ directory yet.

So you are correct simple_connect.cpp is broken currently.

To clarify: It is safe and reliable to have more than one consumer per AmqpClient::Channel object.

-Alan
On Thu, Mar 8, 2012 at 11:37 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear expert,
As I told you yesterday I'm working on a C++ application who uses RabbitMQ. I have a simple question for you: related to Channel.h, function BasicConsume() I read in the function comments
"Note: due to a limitation to how things are done, it is only possible to reliably have a single consumer per channel, calling this more than once per channel may result in undefined results from BasicConsumeMessage"
Is it something related only on the C++ implementation?

Last but not least, I think there are some mistakes in the example simple_connect.cpp


1.      #include <SimpleAmqpClient.h> should be #include < SimpleAmqpClient/SimpleAmqpClient.h> since the installation procedure copies that file in the SimpleAmqpClient folder;

2.      BasicMessage::ptr_t msg_out = channel->BasicConsumeMessage(); doesn't work for two reasons:

a.      A function BasicConsumeMessage() which takes no argument doesn't exist in Channel.h;

b.      The function BasicConsumeMessage(...) currently defined in Channel.h returns a Envelope::ptr_t, not a BasicMessage::ptr_t.

3.      Header file SimpleAmqpClient.h includes unistd.h which is a POSIX header. I had to comment that row in order to make things work in Visual Studio 2008.


Best wishes,

Lorenzo




Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation

Da: Alan Antonuk [mailto:alan.antonuk at gmail.com<mailto:alan.antonuk at gmail.com>]
Inviato: marted? 6 marzo 2012 17:23
A: Lorenzo Rossi
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Oggetto: Re: [rabbitmq-discuss] how to build SimpleAmqpClient?

Did you build boost as a set of static libraries?  If so you'll need to set the Boost_USE_STATIC_LIBS=ON CMake variable.

Another note: given you're building with VS2008 you're going to run into a different problem once you get past the boost library issue you're having: see this  https://github.com/alanxz/SimpleAmqpClient/issues/1 for what the issue is and a workaround.

-Alan
On Tue, Mar 6, 2012 at 9:43 AM, Lorenzo Rossi <l.rossi.cons at vitrociset.it<mailto:l.rossi.cons at vitrociset.it>> wrote:
Dear Experts,
I'm trying to build SimpleAmqpClient (v2.0-beta-2) in Windows (VS 2008), but when I execute CMake, there are errors regarding boost:


CMake Error at C:/Program Files (x86)/CMake 2.8/share/cmake-2.8/Modules/FindBoost.cmake:1128 (message):

Unable to find the requested Boost libraries.

Boost version: 1.48.0

Boost include path: C:/Applicazioni/boost

The following Boost libraries could not be found:

boost_chrono

boost_system

No Boost libraries were found. You may need to set BOOST_LIBRARYDIR to the

directory containing Boost libraries or BOOST_ROOT to the location of

Boost.

Call Stack (most recent call first):

CMakeLists.txt:8 (FIND_PACKAGE)

I add manually the filepath for chrono and system to Boost_Chrono_Library_Debug, Boost_Chrono_Library_Release, Boost_System_Library_Debug, Boost_ System_Library_Release, but still it doesn't find anything. I also create the BOOST_ROOT but still it doesn't work.
Any suggestion?

Best,

Lorenzo


Lorenzo Rossi
_________________________________________
Vitrociset S.p.A.
Via Tiburtina, 1020 - 00156 Roma - Italia
+39 06 8820 3047<tel:%2B39%2006%208820%203047>

Questa e-mail ed ogni suo allegato sono confidenziali. Se li aveste ricevuti per errore, vogliate cortesemente darcene comunicazione subito e distruggere il messaggio ricevuto erroneamente dal Vostro sistema informatizzato. Per piacere non li utilizzate per nessun fine, o diffondete  il loro contenuto a nessun altra persona: fare ci? comporta violare le regole sulla privacy si cui al D. L.vo n. 196 /2003. Grazie per la cooperazione.
This e-mail and any attachment are confidential. If you have received them in error, you are on notice of their status.  Please notify us immediately by replying e-mail and then delete this message from your system.  Please do not copy or use them for any purposes, or disclose their contents to any other person:  to do so could be a breach of the Italian Privacy D. L.vo 196/2003. Thank you for your co-operation


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/6921d13c/attachment.htm>

From andrea.rosa at hp.com  Mon Mar 12 16:31:12 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 12 Mar 2012 16:31:12 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
 the	log file
In-Reply-To: <62393095-55b0-4dc8-a044-c3f60a96e3ba@strongmad.batnest.org>
References: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
	<62393095-55b0-4dc8-a044-c3f60a96e3ba@strongmad.batnest.org>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3693D0AF@G9W0721.americas.hpqcorp.net>

Hi Jerry,


>Subject: Re: [rabbitmq-discuss] Questions about limit alarm and report
>in the log file
>
>Hi, Andrea:
>
>When you see the former, it might not be a bad idea to take a peek with
>lsof, or similar, and see just what the file descriptors for Rabbit
>correspond to.  Remember, they're not all going to correspond to
>sockets,
>as Rabbit has various files it deals with during operation.  Using
>ulimit
>or editing limits.conf to change what your OS is making available to
>Rabbit
>is also something to keep in mind if you're finding yourself regularly
>running low on fd's.

Ok, We have already increased this limit but evidently it's not enough.

>
>If things are working normally you'll see the alarm set when you hit a
>limit,
>and clear when that warning condition remits, say after something is
>closed.
>
>How many connections is your broker maintaining when you see these?
>Rabbit
>will use a file descriptor for each connection, but also tries to leave
>them
>open until it finds a reason to close them, for example, it starts
>approaching
>a limit as you see here.
>

Ok now it's clear.

Thanks
--
Andrea

From andrea.rosa at hp.com  Mon Mar 12 16:33:50 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 12 Mar 2012 16:33:50 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
 the log file
In-Reply-To: <20120312160032.GA28972@wellquite.org>
References: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
	<20120312160032.GA28972@wellquite.org>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3693D0C0@G9W0721.americas.hpqcorp.net>

Hi Matthew,

>It is, however, a slightly imprecise measure. We can't control the use
>of FDs by the Erlang VM itself, and some plugins don't make use of the
>correct API to ensure we account correctly for FD usage.

When you said "imprecise measure", we are talking about a +-2% or +-20%?
Thanks
--
Andrea

From matthew at rabbitmq.com  Mon Mar 12 16:37:15 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 12 Mar 2012 16:37:15 +0000
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
	<BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
	<20120312160214.GB28972@wellquite.org>
	<AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>
Message-ID: <20120312163715.GC28972@wellquite.org>

On Mon, Mar 12, 2012 at 05:23:59PM +0100, Zabrane Mickael wrote:
> http://learnyousomeerlang.com/distribunomicon

Mmm, the "Bandwidth is infinite" section mentions this bug in Erlang,
but says nothing about the justification for it:

"Worse than that, Erlang knows whether nodes are alive or not by sending
a thing called heartbeats. Heartbeats are small messages sent at a
regular interval between two nodes basically saying "I'm still alive,
keep on keepin' on!". They're like our Zombie survivors routinely
pinging each other with messages; "Bill, are you there?" And if Bill
never replies, then you might assume he's dead (our out of batteries)
and he won't get your future communications. Anyway, heartbeats are sent
over the same channel as regular messages.

"The problem is that a large message can thus hold heartbeats back. Too
many large messages keeping heartbeats at bay for too long and either of
the nodes will eventually assume the other is unresponsive and
disconnect from each other. That's bad. In any case, the good Erlang
design lesson to keep this from happenning is to keep your messages
small. Everything will be better that way."

Somewhat ironic that AMQP itself does understand that receiving any data
from a peer indicates the peer is alive, and furthermore has the
ability to multiplex messages so that a single large message doesn't
block other messages.

Matthew

From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 12 16:39:03 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 12 Mar 2012 12:39:03 -0400
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
	<BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
	<20120312160214.GB28972@wellquite.org>
	<AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>
Message-ID: <CAM8fPiRf9+tWvs8ujVY_jd3vFvfO1L8CM4wPXo9TW3x5JD_akQ@mail.gmail.com>

On 12 March 2012 12:23, Zabrane Mickael <zabrane3 at gmail.com> wrote:

> On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote:
>
> For those of us struggling to follow this, if you're currently in the
> act of receiving data from node X, why can't you assume node X is still
> alive? I.e. what is wrong with treating arbitrary data from node X as
> evidence it's still alive, in lieu of a heartbeat from node X?
>
>
> http://learnyousomeerlang.com/distribunomicon
>

Yes, that repeats the information that Irmo started this subthread with. It
doesn't address Matthew's question at all, though.

Perhaps the erlang list is a better place for us to be asking about this,
Matthew, since it's not directly about Rabbit - are you on that list? I'm
not currently subscribed.

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/7844739d/attachment.htm>

From timya15 at gmail.com  Mon Mar 12 16:39:47 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Mon, 12 Mar 2012 22:09:47 +0530
Subject: [rabbitmq-discuss] Federation binding to a queue
In-Reply-To: <4F5DD509.40600@rabbitmq.com>
References: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
	<4F5DD509.40600@rabbitmq.com>
Message-ID: <CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>

Sorry, Simon for the very small problem description.
Considering ClientRabbit and ServerRabbit as two rabbitmq servers.
On ClientRabbit rabbitmq.config file the federation plugin is configured.
eg.
{rabbit_federation,
  [{exchanges, [[{exchange, "my-exchange"},
     {virtual_host, "/"},
     {type, "topic"},
     {durable, true},
     {auto_delete, false},
     {internal, false},
    {upstream_set, "my-upstreams"}]
  ]},
  {upstream_sets, [{"my-upstreams",
    [[{connection, "upstream-server"},
     {exchange, "my-upstream-x"},
     {max_hops, 2}]
    ]}
   ]},
   {connections, [{"upstream-server",
     [{host, "ServerRabbit"},
      {protocol, "amqps"},
      {port, 5671},
      {virtual_host, "/"},
      {username, "guest"},
      {password, "secret"},
      {mechanism, default},
      {prefetch_count, 1000},
      {reconnect_delay, 5},
      {heartbeat, 1},
      {queue_expires, 30000},
      {message_ttl, 10000},
    ]}
  ]},
  {local_username, "guest"},
  {local_nodename, "ClientRabbit"}
 ]
}

On both servers the exchanges get created.
Is there a way to create the queues and bind them to these exchanges.

Also in the 2.7.9 release note it is stated as;
federation plugin:
enhancements
- allow the queue declared upstream to be mirrored

? How to declare the queue on ServerRabbit and ClientRabbit, using the
rabbitmq.config present on the ClientRabbit.

Regards,
Timya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/3a79d997/attachment.htm>

From matthew at rabbitmq.com  Mon Mar 12 16:42:05 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 12 Mar 2012 16:42:05 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
 the log file
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3693D0C0@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>
	<20120312160032.GA28972@wellquite.org>
	<5F389C517756284F80239F55BCA5DDDD3693D0C0@G9W0721.americas.hpqcorp.net>
Message-ID: <20120312164204.GD28972@wellquite.org>

On Mon, Mar 12, 2012 at 04:33:50PM +0000, Rosa, Andrea (HP Cloud Services) wrote:
> >It is, however, a slightly imprecise measure. We can't control the use
> >of FDs by the Erlang VM itself, and some plugins don't make use of the
> >correct API to ensure we account correctly for FD usage.
> 
> When you said "imprecise measure", we are talking about a +-2% or +-20%?

Unknown. The Erlang kernal may use some descriptors itself. We have no
way of telling when it does or doesn't, so we arbitrarily reserve 100
for it and hope. Other plugins may or may not correctly register the use
of descriptors with Rabbit - for example, off hand, I've no idea whether
the management plugin registers its use of sockets with Rabbit
internally, likewise the STOMP plugin etc. It's probably safest to
assume they don't. Thus the internal accounting may be accurate or at
least conservatively accurate enough using plain vanilla Rabbit, but
might start to get a bit dodgy as you enable more plugins. Really those
plugins either need rewriting to use the necessary APIs (if they've not
already), or some other more robust mechanism needs to be invented.

Matthew

From simon at rabbitmq.com  Mon Mar 12 16:51:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Mar 2012 16:51:44 +0000
Subject: [rabbitmq-discuss] Questions about limit alarm and report in
 the log file
In-Reply-To: <20120312164204.GD28972@wellquite.org>
References: <5F389C517756284F80239F55BCA5DDDD3693CFB8@G9W0721.americas.hpqcorp.net>	<20120312160032.GA28972@wellquite.org>	<5F389C517756284F80239F55BCA5DDDD3693D0C0@G9W0721.americas.hpqcorp.net>
	<20120312164204.GD28972@wellquite.org>
Message-ID: <4F5E29A0.1040808@rabbitmq.com>

On 12/03/12 16:42, Matthew Sackman wrote:
> I've no idea whether
> the management plugin registers its use of sockets with Rabbit
> internally, likewise the STOMP plugin etc

Management uses Mochiweb underneath, which doesn't know about rabbit - 
so it can't. Mochiweb registers a pool of 16 socket acceptors at 
startup, and in normal use that pool is unlikely to grow.

The STOMP plugin shares quite a bit of code, including tcp_acceptor, 
with the AMQP network code - so STOMP sockets *do* get counted.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Mar 12 17:08:41 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Mar 2012 17:08:41 +0000
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>
References: <4F454C42.4080400@gmail.com>
	<7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>
Message-ID: <4F5E2D99.2020002@rabbitmq.com>

On 24/02/12 15:19, Max Kalika wrote:
> This turned out to be worse than we first realized.  When two of the
> servers exhibited high memory usage, clients became blocked and
> stopped receiving data.  I was able to unwedge the running process
> with some erlang surgery.  Obviously, this was a high-risk operation

My attempt to to reproduce this issue was unsuccessful. It would be
great if you could provide some more information about the process
consuming the most memory, e.g. output from process_info/1. Does it
respond to sys:get_status() ?


-Emile

From johnstoner2 at gmail.com  Mon Mar 12 19:21:36 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Mon, 12 Mar 2012 14:21:36 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
Message-ID: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>

OK, I realize this is probably a very basic thing, but I've been
googling and screwing around with this for hours and getting nowhere.

I'm trying to set up my first rabbitmq cluster. I have it installed
fine on two ec2 hosts, and I'm trying to get one to cluster with the
other. I've tried the instructions at

http://www.rabbitmq.com/clustering.html

and I keep getting

Error: unable to connect to node 'rabbit at rabbitmq-small02-dev':
nodedown
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},

{rabbitmqctl12928,46801}]
- current node: 'rabbitmqctl12928 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 4IHR1JMCSCh55g/tisBydg==

So I found more detailed instructions on skaag.net, at

<*http://www.skaag.net/2010/03/12/rabbitmq-for-beginners/*>

So, I install (actually re-install) a fresh, up to date rabbitmq on
the second machine, according to the instructions for ec2.

Then I go through the instructions.

I stop the server:
[jstoner at rabbitmq-small02-dev]> service rabbitmq-server stop
Stopping rabbitmq-server: RabbitMQ is not running
rabbitmq-server.

I change the cookie to the same as the other one:
[jstoner at rabbitmq-small02-dev]> sudo su
root at rabbitmq-small02-dev:/home/jstoner/rclient# echo -n [cookie-text]
> /var/lib/rabbitmq/.erlang.cookie
root at rabbitmq-small02-dev:/home/jstoner/rclient# exit
exit

I try to restart:
[jstoner at rabbitmq-small02-dev]> sudo service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
startup_{log, _err}
rabbitmq-server.

I look at the logs they mention:
[jstoner at rabbitmq-small02-dev]> more /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...

************************************************************
********************
************************************************************
********************

0 plugins activated:

node with name "rabbit" already running on "rabbitmq-small02-dev"
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},

{rabbitmqctl12869,39028},

{rabbitmqprelaunch12879,
                                                  37230}]
- current node: 'rabbitmqprelaunch12879 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 4IHR1JMCSCh55g/tisBydg==
[jstoner at rabbitmq-small02-dev]> more /var/log/rabbitmq/startup_err
[empty file]

That tells me nothing I can make sense of. So I see what happens if I
try the next step:
[jstoner at rabbitmq-small02-dev]> sudo rabbitmqctl stop_app
Stopping node 'rabbit at rabbitmq-small02-dev' ...
Error: unable to connect to node 'rabbit at rabbitmq-small02-dev':
nodedown
diagnostics:
- nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},

{rabbitmqctl12928,46801}]
- current node: 'rabbitmqctl12928 at rabbitmq-small02-dev'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: [hashtext]

Which is the same kind of problem I got on the first set of
instructions, even though the cookies match.

Any ideas would be much appreciated.

-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/d8307c45/attachment.htm>

From jack.palf at gmail.com  Mon Mar 12 20:39:41 2012
From: jack.palf at gmail.com (Jack Palfrey)
Date: Mon, 12 Mar 2012 20:39:41 +0000
Subject: [rabbitmq-discuss] JSONP support
Message-ID: <CAPpWrV=3o9-ZLuv4Tvjbxr5Nbb1XHvxr_cuRGJXRKqqEvavuwg@mail.gmail.com>

Hi all,

I'm trying to add JSONP support to the JSON RPC plugins, but I'm having
some difficulties. I'm hoping that someone from the community can help
point me in the right direction.

Currently I have RabbitMQ running fine, can pass messages around different
machines using the AMQP gem, but can't get a browser application hosted
elsewhere to join in; cross-domain policy stuff kicks in. Unfortunately I
can't move the application or the queues to the same host.

Are there other projects that have solved this one already? If not, can I
get some guidance on where to start? Should I be modifying the
jsonrpc-channel file or is this a Mochiweb thing?

I'm in the process of learning Erlang, so I appreciate this may be a
trivial question, but if there is a more experienced developer out there
who can direct me, I'd be quite grateful.

Jack
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/a7dc13a5/attachment.htm>

From andrius.norkaitis at oryo.lt  Mon Mar 12 21:41:36 2012
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 12 Mar 2012 23:41:36 +0200
Subject: [rabbitmq-discuss] Possible bug when disposing connections
	in	.NET client 2.7.0/1
In-Reply-To: <3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>	<8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
	<3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>
Message-ID: <001201cd0098$e6b0d530$b4127f90$@oryo.lt>

Hello,

Any news about this bug? I get random exceptions (when client disconnects)
when using heartbeat in .NET client 2.7.0/1 which was never a problem with
earlier versions.

Cannot access a disposed object.
Object name: 'System.Net.Sockets.Socket'.

   at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
optionLevel, SocketOptionName optionName, Object optionValue)
   at System.Net.Sockets.TcpClient.set_LingerState(LingerOption value)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop()
   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
   at System.Threading.ExecutionContext.runTryCode(Object userData)
   at
System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedClea
nup(TryCode code, CleanupCode backoutCode, Object userData)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext
executionContext, ContextCallback callback, Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext
executionContext, ContextCallback callback, Object state)
   at System.Threading.ThreadHelper.ThreadStart()


Best regards,
Andrius

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Steve
Powell
Sent: Friday, December 30, 2011 5:30 PM
To: Dave Stevens
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Possible bug when disposing connections in
.NET client 2.7.0/1

This really does look like a bug.  Thanks for spotting this.
I'm raising a bugzilla (bug24650) to track it, and will report back.

Steve Powell  (a yule bunny)
----------some more definitions from the SPD---------- avoirdupois (phr.)
'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 29 Dec 2011, at 22:16, Dave Stevens wrote:

> Yes, heartbeat is what is causing this. Version 2.7.1 of the .NET 
> client is itself calling System.Net.Sockets.TcpClient.Close() 3 times 
> per connection shutdown (4 if shutdown times out).
> ConnectionBase.FinishClose() is called 3 different times when shutting 
> down.See MainLoop(), HeartbeatReadLoop(), and HeartbeatWriteLoop() of 
> ConnectionBase.cs lines 629, 566 and 538 respectively.
> I am required to set the Heartbeat due to another issue where 
> exclusive queues are not being removed at the broker when connections 
> died. This prevents components from being able to restart with the 
> same queue name.
> See 
> http://stackoverflow.com/questions/8296201/when-does-an-amqp-rabbitmq-
> channel-with-no-connections-die/8299475
> 
> I believe that even with this, ConnectionBase.FinishClose() will be 
> called once successfully which would allow the models to shutdown 
> properly. I believe this is a bug though as FinishClose() should not 
> be called more than once or it is possible that certain event handlers 
> will be called more than once, Session.OnSessionShutdown specifically.
> This may impact certain reconnect implementations.
> 
> On Dec 29, 4:38 pm, Simone Busoli <simone.bus... at gmail.com> wrote:
>> What happens if you remove the heartbeat setting?
>> On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> I get the same exception with this:
>> 
>>>         [Test(Description = "ObjectDispositionException")]
>>>         public void TestFail()
>>>         {
>>>             var cf = new ConnectionFactory
>>>                          {
>>>                              HostName = "10.10.8.96",
>>>                              Port = 5672,
>>>                              RequestedHeartbeat = 2
>>>                          };
>>>             using (var connection = cf.CreateConnection())
>>>             using (var model = connection.CreateModel())
>>>             {
>>>                 Thread.Sleep(TimeSpan.FromSeconds(1));
>>>             }
>>>         }
>> 
>>> On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli 
>>> <simone.bus... at gmail.com>
>>> wrote:
>> 
>>>> Hi Dave, although counterintuitive the documentation of the .NET 
>>>> client
>>> states that explicitly. The connection closure/disposal is not 
>>> idempotent, i.e. you shall not call it twice.
>> 
>>>> On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>> 
>>>>> I am getting the following exception when disposing a connection. 
>>>>> I had previously noticed this when going from RabbitMQ Client 
>>>>> 2.5.1 to
>>>>> 2.7.0 which caused me to back out the update. I ended up going to
>>>>> 2.7.1 because I thought I found a shutdown issue in my own code. 
>>>>> The exception did not present itself again until I started testing 
>>>>> some reconnect logic. I first noticed it again after simply 
>>>>> pulling the plug on my network.
>> 
>>>>> System.ObjectDisposedException: Cannot access a disposed object.
>>>>> Object name: 'System.Net.Sockets.Socket'.
>>>>> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
>>>>> optionLevel, SocketOptionName optionName, Object optionValue) at 
>>>>> RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>>>>> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>>>>> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
>>>>> at System.Threading.ThreadHelper.ThreadStart_Context(Object state) 
>>>>> at System.Threading.ExecutionContext.runTryCode(Object userData) 
>>>>> at
>> 
>>> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaran
>>> teedCle anup(TryCode
>>>>> code, CleanupCode backoutCode, Object userData) at 
>>>>> System.Threading.ExecutionContext.RunInternal(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state) at 
>>>>> System.Threading.ExecutionContext.Run(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state, Boolean
>>>>> ignoreSyncCtx)
>>>>> at System.Threading.ExecutionContext.Run(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state) at 
>>>>> System.Threading.ThreadHelper.ThreadStart()
>> 
>>>>> This code is reproducible consistently with the following:
>> 
>>>>> using System;
>>>>> using System.Threading;
>>>>> using NUnit.Framework;
>>>>> using RabbitMQ.Client;
>>>>> using RabbitMQ.Client.Framing.v0_9;
>> 
>>>>> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
>>>>> {
>>>>>    [TestFixture]
>>>>>    public class TestingObjectDispositionException
>>>>>    {
>>>>>        [Test(Description = "ObjectDispositionException")]
>>>>>        public void TestFail()
>>>>>        {
>>>>>            var cf = new ConnectionFactory
>>>>>                         {
>>>>>                             HostName = INSERT_IP_HERE,
>>>>>                             Port = 5672,
>>>>>                             RequestedHeartbeat = 2
>>>>>                         };
>>>>>            using (var connection = cf.CreateConnection())
>>>>>            using (var model = connection.CreateModel())
>>>>>            {
>>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>                model.Close(Constants.ReplySuccess, "Goodbye");
>>>>>                connection.Close(Constants.ReplySuccess, "Goodbye");
>>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>            }
>>>>>        }
>>>>>    }
>>>>> }
>> 
>>>>> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows 
>>>>> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>> 
>>>>> Status of node rabbit at xxx ...
>>>>> [{pid,1344},
>>>>>  {running_applications,
>>>>>     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
>>>>>      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
>>>>>      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
>>>>>      {rabbit,"RabbitMQ","2.7.0"},
>>>>>      {os_mon,"CPO  CXC 138 46","2.2.5"},
>>>>>      {sasl,"SASL  CXC 138 11","2.1.9.3"},
>>>>>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
>>>>>      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
>>>>>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
>>>>>      {inets,"INETS  CXC 138 49","5.5.2"},
>>>>>      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>>>>>      {stdlib,"ERTS  CXC 138 10","1.17.3"},
>>>>>      {kernel,"ERTS  CXC 138 10","2.14.3"}]},  {os,{unix,linux}},  
>>>>> {erlang_version,
>>>>>     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8] 
>>>>> [async-threads:30] [kernel-poll:true]\n"},  {memory,
>>>>>     [{total,31177024},
>>>>>      {processes,11828776},
>>>>>      {processes_used,11772888},
>>>>>      {system,19348248},
>>>>>      {atom,1355273},
>>>>>      {atom_used,1339382},
>>>>>      {binary,84928},
>>>>>      {code,14547474},
>>>>>      {ets,1099944}]},
>>>>>  {vm_memory_high_watermark,0.39999999995232727},
>>>>>  {vm_memory_limit,5034326425}]
>>>>> ...done.
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discu
>>>>> ss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin
>> /mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 12 22:26:45 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 12 Mar 2012 18:26:45 -0400
Subject: [rabbitmq-discuss] JSONP support
In-Reply-To: <CAPpWrV=3o9-ZLuv4Tvjbxr5Nbb1XHvxr_cuRGJXRKqqEvavuwg@mail.gmail.com>
References: <CAPpWrV=3o9-ZLuv4Tvjbxr5Nbb1XHvxr_cuRGJXRKqqEvavuwg@mail.gmail.com>
Message-ID: <CAM8fPiQbWY+-fqVGWuWVSbV=KXUDYVknue_tU9PnSUSQ6HqFMA@mail.gmail.com>

On 12 March 2012 16:39, Jack Palfrey <jack.palf at gmail.com> wrote:

> Currently I have RabbitMQ running fine, can pass messages around different
> machines using the AMQP gem, but can't get a browser application hosted
> elsewhere to join in; cross-domain policy stuff kicks in. Unfortunately I
> can't move the application or the queues to the same host.


It sounds like you want to set up a reverse-proxy type thing to graft the
JSON-RPC plugin's portion of HTTP space into the HTTP space of your main
webapp. Perhaps something like Apache's "ProxyPass" directive.

Here's a lightly-edited stanza from one of my Apache configs:

    ProxyPass /rpc http://localhost:55672/rpc
    ProxyPassReverse /rpc http://localhost:55672/rpc

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/fe9ae422/attachment.htm>

From simone.busoli at gmail.com  Mon Mar 12 22:28:51 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 12 Mar 2012 23:28:51 +0100
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <001201cd0098$e6b0d530$b4127f90$@oryo.lt>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>
	<8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
	<3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>
	<001201cd0098$e6b0d530$b4127f90$@oryo.lt>
Message-ID: <CAOn7oW_Xqo83LYAM=P=hvms0rBKOmi6Wb8s2wtHa+d3iSgy24Q@mail.gmail.com>

I've been using the compiled sources for some time now without any issues,
but you can also find the unofficial 2.7.9 release which I guess includes
the fixes.
On Mar 12, 2012 10:43 PM, "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
wrote:

> Hello,
>
> Any news about this bug? I get random exceptions (when client disconnects)
> when using heartbeat in .NET client 2.7.0/1 which was never a problem with
> earlier versions.
>
> Cannot access a disposed object.
> Object name: 'System.Net.Sockets.Socket'.
>
>   at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> optionLevel, SocketOptionName optionName, Object optionValue)
>   at System.Net.Sockets.TcpClient.set_LingerState(LingerOption value)
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop()
>   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
>   at System.Threading.ExecutionContext.runTryCode(Object userData)
>   at
>
> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedClea
> nup(TryCode code, CleanupCode backoutCode, Object userData)
>   at System.Threading.ExecutionContext.RunInternal(ExecutionContext
> executionContext, ContextCallback callback, Object state)
>   at System.Threading.ExecutionContext.Run(ExecutionContext
> executionContext, ContextCallback callback, Object state)
>   at System.Threading.ThreadHelper.ThreadStart()
>
>
> Best regards,
> Andrius
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Steve
> Powell
> Sent: Friday, December 30, 2011 5:30 PM
> To: Dave Stevens
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Possible bug when disposing connections in
> .NET client 2.7.0/1
>
> This really does look like a bug.  Thanks for spotting this.
> I'm raising a bugzilla (bug24650) to track it, and will report back.
>
> Steve Powell  (a yule bunny)
> ----------some more definitions from the SPD---------- avoirdupois (phr.)
> 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 29 Dec 2011, at 22:16, Dave Stevens wrote:
>
> > Yes, heartbeat is what is causing this. Version 2.7.1 of the .NET
> > client is itself calling System.Net.Sockets.TcpClient.Close() 3 times
> > per connection shutdown (4 if shutdown times out).
> > ConnectionBase.FinishClose() is called 3 different times when shutting
> > down.See MainLoop(), HeartbeatReadLoop(), and HeartbeatWriteLoop() of
> > ConnectionBase.cs lines 629, 566 and 538 respectively.
> > I am required to set the Heartbeat due to another issue where
> > exclusive queues are not being removed at the broker when connections
> > died. This prevents components from being able to restart with the
> > same queue name.
> > See
> > http://stackoverflow.com/questions/8296201/when-does-an-amqp-rabbitmq-
> > channel-with-no-connections-die/8299475
> >
> > I believe that even with this, ConnectionBase.FinishClose() will be
> > called once successfully which would allow the models to shutdown
> > properly. I believe this is a bug though as FinishClose() should not
> > be called more than once or it is possible that certain event handlers
> > will be called more than once, Session.OnSessionShutdown specifically.
> > This may impact certain reconnect implementations.
> >
> > On Dec 29, 4:38 pm, Simone Busoli <simone.bus... at gmail.com> wrote:
> >> What happens if you remove the heartbeat setting?
> >> On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstev... at gmail.com> wrote:
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>> I get the same exception with this:
> >>
> >>>         [Test(Description = "ObjectDispositionException")]
> >>>         public void TestFail()
> >>>         {
> >>>             var cf = new ConnectionFactory
> >>>                          {
> >>>                              HostName = "10.10.8.96",
> >>>                              Port = 5672,
> >>>                              RequestedHeartbeat = 2
> >>>                          };
> >>>             using (var connection = cf.CreateConnection())
> >>>             using (var model = connection.CreateModel())
> >>>             {
> >>>                 Thread.Sleep(TimeSpan.FromSeconds(1));
> >>>             }
> >>>         }
> >>
> >>> On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli
> >>> <simone.bus... at gmail.com>
> >>> wrote:
> >>
> >>>> Hi Dave, although counterintuitive the documentation of the .NET
> >>>> client
> >>> states that explicitly. The connection closure/disposal is not
> >>> idempotent, i.e. you shall not call it twice.
> >>
> >>>> On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstev... at gmail.com>
> wrote:
> >>
> >>>>> I am getting the following exception when disposing a connection.
> >>>>> I had previously noticed this when going from RabbitMQ Client
> >>>>> 2.5.1 to
> >>>>> 2.7.0 which caused me to back out the update. I ended up going to
> >>>>> 2.7.1 because I thought I found a shutdown issue in my own code.
> >>>>> The exception did not present itself again until I started testing
> >>>>> some reconnect logic. I first noticed it again after simply
> >>>>> pulling the plug on my network.
> >>
> >>>>> System.ObjectDisposedException: Cannot access a disposed object.
> >>>>> Object name: 'System.Net.Sockets.Socket'.
> >>>>> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> >>>>> optionLevel, SocketOptionName optionName, Object optionValue) at
> >>>>> RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
> >>>>> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
> >>>>> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
> >>>>> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
> >>>>> at System.Threading.ExecutionContext.runTryCode(Object userData)
> >>>>> at
> >>
> >>> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaran
> >>> teedCle anup(TryCode
> >>>>> code, CleanupCode backoutCode, Object userData) at
> >>>>> System.Threading.ExecutionContext.RunInternal(ExecutionContext
> >>>>> executionContext, ContextCallback callback, Object state) at
> >>>>> System.Threading.ExecutionContext.Run(ExecutionContext
> >>>>> executionContext, ContextCallback callback, Object state, Boolean
> >>>>> ignoreSyncCtx)
> >>>>> at System.Threading.ExecutionContext.Run(ExecutionContext
> >>>>> executionContext, ContextCallback callback, Object state) at
> >>>>> System.Threading.ThreadHelper.ThreadStart()
> >>
> >>>>> This code is reproducible consistently with the following:
> >>
> >>>>> using System;
> >>>>> using System.Threading;
> >>>>> using NUnit.Framework;
> >>>>> using RabbitMQ.Client;
> >>>>> using RabbitMQ.Client.Framing.v0_9;
> >>
> >>>>> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
> >>>>> {
> >>>>>    [TestFixture]
> >>>>>    public class TestingObjectDispositionException
> >>>>>    {
> >>>>>        [Test(Description = "ObjectDispositionException")]
> >>>>>        public void TestFail()
> >>>>>        {
> >>>>>            var cf = new ConnectionFactory
> >>>>>                         {
> >>>>>                             HostName = INSERT_IP_HERE,
> >>>>>                             Port = 5672,
> >>>>>                             RequestedHeartbeat = 2
> >>>>>                         };
> >>>>>            using (var connection = cf.CreateConnection())
> >>>>>            using (var model = connection.CreateModel())
> >>>>>            {
> >>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
> >>>>>                model.Close(Constants.ReplySuccess, "Goodbye");
> >>>>>                connection.Close(Constants.ReplySuccess, "Goodbye");
> >>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
> >>>>>            }
> >>>>>        }
> >>>>>    }
> >>>>> }
> >>
> >>>>> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
> >>>>> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
> >>
> >>>>> Status of node rabbit at xxx ...
> >>>>> [{pid,1344},
> >>>>>  {running_applications,
> >>>>>     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
> >>>>>      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
> >>>>>      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
> >>>>>      {rabbit,"RabbitMQ","2.7.0"},
> >>>>>      {os_mon,"CPO  CXC 138 46","2.2.5"},
> >>>>>      {sasl,"SASL  CXC 138 11","2.1.9.3"},
> >>>>>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
> >>>>>      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
> >>>>>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
> >>>>>      {inets,"INETS  CXC 138 49","5.5.2"},
> >>>>>      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
> >>>>>      {stdlib,"ERTS  CXC 138 10","1.17.3"},
> >>>>>      {kernel,"ERTS  CXC 138 10","2.14.3"}]},  {os,{unix,linux}},
> >>>>> {erlang_version,
> >>>>>     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
> >>>>> [async-threads:30] [kernel-poll:true]\n"},  {memory,
> >>>>>     [{total,31177024},
> >>>>>      {processes,11828776},
> >>>>>      {processes_used,11772888},
> >>>>>      {system,19348248},
> >>>>>      {atom,1355273},
> >>>>>      {atom_used,1339382},
> >>>>>      {binary,84928},
> >>>>>      {code,14547474},
> >>>>>      {ets,1099944}]},
> >>>>>  {vm_memory_high_watermark,0.39999999995232727},
> >>>>>  {vm_memory_limit,5034326425}]
> >>>>> ...done.
> >>>>> _______________________________________________
> >>>>> rabbitmq-discuss mailing list
> >>>>> rabbitmq-disc... at lists.rabbitmq.com
> >>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discu
> >>>>> ss
> >>
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin
> >> /mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120312/b3e4c752/attachment.htm>

From brian.newsgroup at gmail.com  Tue Mar 13 03:21:23 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Tue, 13 Mar 2012 14:21:23 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on one
	machine
Message-ID: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>

Hi there,

We need to upgrade our messaging server from 1.8.0 to 2.7.1. To ensure a
smooth transition, we are trying to make the two rabbit server versions
coexist on the same machine, so we can have our existing messaging system
running while having our new messaging system being tested in the same
environment, This also ensures minimal interruption for the transition in
the production environment as well.

I grabbed the rabbit 2.7.1 source and changed the location of
rabbitmq_env.conf, so that I can specify a different environment for the
new rabbit server.
These are the env variables I specified in rabbitmq_env.conf:
SERVICENAME=
NODENAME=
NODE_PORT=
CONFIG_FILE=

Now I've got 2.7.1 running alongside 1.8.0. The problem is that although I
have SSL configured for 2.7.1, only non-SSl connections currently work. For
any SSL connections, I get a "connection refused" on the client side. I
triple checked the SSL certificates and saw no problems. However, when I
list the status of the 2.7.1 server , it says the following:

Status of node 'rabbit-new at ServerA' ...
[{pid,23440},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4]
[rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,..
 ...
 ...
...done.

On another machine that only has 2.7.1 on, it produces the following:

Status of node rabbit at ServerB ...
[{pid,30862},
 {running_applications,
     [{rabbitmq_federation,"RabbitMQ Federation","2.7.1"},
      {rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {ssl,"Erlang/OTP SSL application","4.1.6"},
      {public_key,"Public key infrastructure","0.13"},
      {crypto,"CRYPTO version 2","2.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
  ...
  ...
...done.

I noticed that ServerA doesn't have ssl in the "running_application" list.
Is this why SSL doesn't work? I'm pretty sure erlang R13B03 thats currently
running on ServerA supports SSL because rabbit 1.8.0 is using it.

What are my options here? Would updating Erlang on ServerA to the latest
version solve the problem? Would the latest Erlang be incompatible with
rabbitmq 1.8.0? If I were to still use Erlang R13B03, what shall I do to
make 2.7.1 work with SSL?

Thanks,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/d9a2779c/attachment.htm>

From zabrane3 at gmail.com  Tue Mar 13 05:41:25 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Tue, 13 Mar 2012 06:41:25 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <CAM8fPiRf9+tWvs8ujVY_jd3vFvfO1L8CM4wPXo9TW3x5JD_akQ@mail.gmail.com>
References: <mailman.0.1331402953.5162.rabbitmq-discuss@lists.rabbitmq.com>
	<A939D4D2-C60B-4C2B-9FA2-581F6A67C1A7@gmail.com>
	<D0F7A57E-006B-4D9E-9860-0C27CAC05260@vmware.com>
	<4F5DEB7A.20102@rabbitmq.com>
	<CAAcXTOYHm1Pj1SuK4yNhD=O=L+Ezo+6XG4MsauMJhUKWE4id=A@mail.gmail.com>
	<CAM8fPiTW9v5MYoNC6qx1hxMj-m4LnGisZ7sV962vkaKKHE+-OQ@mail.gmail.com>
	<BD2895C6-737A-4B09-8458-D9E71F62C8FC@gmail.com>
	<20120312160214.GB28972@wellquite.org>
	<AED91FE3-498B-4AFD-8E95-5A05451B8D07@gmail.com>
	<CAM8fPiRf9+tWvs8ujVY_jd3vFvfO1L8CM4wPXo9TW3x5JD_akQ@mail.gmail.com>
Message-ID: <B92373E0-DA29-44D9-84BF-D84358FCA842@gmail.com>

This leads me to this question:

Let assume I'm able to ensure that all my messages are less than 100Kb.

How many messages one RabbitMQ mode can handle at any given time? Is there any limitation?

Regards,
Zabrane


On Mar 12, 2012, at 5:39 PM, Tony Garnock-Jones wrote:

> On 12 March 2012 12:23, Zabrane Mickael <zabrane3 at gmail.com> wrote:
> On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote:
>> For those of us struggling to follow this, if you're currently in the
>> act of receiving data from node X, why can't you assume node X is still
>> alive? I.e. what is wrong with treating arbitrary data from node X as
>> evidence it's still alive, in lieu of a heartbeat from node X?
> 
> http://learnyousomeerlang.com/distribunomicon
> 
> Yes, that repeats the information that Irmo started this subthread with. It doesn't address Matthew's question at all, though.
> 
> Perhaps the erlang list is a better place for us to be asking about this, Matthew, since it's not directly about Rabbit - are you on that list? I'm not currently subscribed.
> 
> Tony
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/1d22b550/attachment.htm>

From jerryk at vmware.com  Tue Mar 13 06:03:05 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 12 Mar 2012 23:03:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <B92373E0-DA29-44D9-84BF-D84358FCA842@gmail.com>
Message-ID: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>

Hi, Zabrane:

Ultimately you'll be limited by disk space.  If a queue gets large with messages
that are either unconsumed, or delivered but not ACKed, and the broker determines
that it's under memory pressure, it will page messages to files on disk, blocking
producers in the meantime using TCP back pressure.  The mechanism is discussed here:

http://www.rabbitmq.com/memory.html

In practice you don't want to routinely be flirting with the memory watermark, and
as a rule, its value is probably best left at the default 0.40 level.  In production
you should make sure your monitoring/alerting system is watching broker memory usage,
and probably the lengths and memory consumption of queues of importance to your app.
If queues are getting uncharacteristically backed up, it's often because something
has changed or gone wrong (unexpected producer load, crashed or buggy consumers,
etc.).

Best regards,
Jerry

----- Original Message -----
From: "Zabrane Mickael" <zabrane3 at gmail.com>
To: "Tony Garnock-Jones" <tonygarnockjones+rabbitmq at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 12, 2012 10:41:25 PM
Subject: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?



This leads me to this question: 


Let assume I'm able to ensure that all my messages are less than 100Kb. 


How many messages one RabbitMQ mode can handle at any given time? Is there any limitation? 



Regards, 
Zabrane 





On Mar 12, 2012, at 5:39 PM, Tony Garnock-Jones wrote: 


On 12 March 2012 12:23, Zabrane Mickael < zabrane3 at gmail.com > wrote: 







On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote: 


For those of us struggling to follow this, if you're currently in the 
act of receiving data from node X, why can't you assume node X is still 
alive? I.e. what is wrong with treating arbitrary data from node X as 
evidence it's still alive, in lieu of a heartbeat from node X? 



http://learnyousomeerlang.com/distribunomicon 

Yes, that repeats the information that Irmo started this subthread with. It doesn't address Matthew's question at all, though. 

Perhaps the erlang list is a better place for us to be asking about this, Matthew, since it's not directly about Rabbit - are you on that list? I'm not currently subscribed. 

Tony 
-- 
Tony Garnock-Jones 
tonygarnockjones at gmail.com 
http://homepages.kcbbs.gen.nz/tonyg/ 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From zabrane3 at gmail.com  Tue Mar 13 06:09:22 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Tue, 13 Mar 2012 07:09:22 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ handle big messages?
In-Reply-To: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
References: <a4578a7d-a26c-4e66-a503-7cffb38d9f8f@StrongMad.local>
Message-ID: <7539013D-C531-4584-B48E-DB83F871732D@gmail.com>

Crystal clear. Thanks Jerry.

Regards,
Zabrane

On Mar 13, 2012, at 7:03 AM, Jerry Kuch wrote:

> Hi, Zabrane:
> 
> Ultimately you'll be limited by disk space.  If a queue gets large with messages
> that are either unconsumed, or delivered but not ACKed, and the broker determines
> that it's under memory pressure, it will page messages to files on disk, blocking
> producers in the meantime using TCP back pressure.  The mechanism is discussed here:
> 
> http://www.rabbitmq.com/memory.html
> 
> In practice you don't want to routinely be flirting with the memory watermark, and
> as a rule, its value is probably best left at the default 0.40 level.  In production
> you should make sure your monitoring/alerting system is watching broker memory usage,
> and probably the lengths and memory consumption of queues of importance to your app.
> If queues are getting uncharacteristically backed up, it's often because something
> has changed or gone wrong (unexpected producer load, crashed or buggy consumers,
> etc.).
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Zabrane Mickael" <zabrane3 at gmail.com>
> To: "Tony Garnock-Jones" <tonygarnockjones+rabbitmq at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, March 12, 2012 10:41:25 PM
> Subject: Re: [rabbitmq-discuss] Can RabbitMQ handle big messages?
> 
> 
> 
> This leads me to this question: 
> 
> 
> Let assume I'm able to ensure that all my messages are less than 100Kb. 
> 
> 
> How many messages one RabbitMQ mode can handle at any given time? Is there any limitation? 
> 
> 
> 
> Regards, 
> Zabrane 
> 
> 
> 
> 
> 
> On Mar 12, 2012, at 5:39 PM, Tony Garnock-Jones wrote: 
> 
> 
> On 12 March 2012 12:23, Zabrane Mickael < zabrane3 at gmail.com > wrote: 
> 
> 
> 
> 
> 
> 
> 
> On Mar 12, 2012, at 5:02 PM, Matthew Sackman wrote: 
> 
> 
> For those of us struggling to follow this, if you're currently in the 
> act of receiving data from node X, why can't you assume node X is still 
> alive? I.e. what is wrong with treating arbitrary data from node X as 
> evidence it's still alive, in lieu of a heartbeat from node X? 
> 
> 
> 
> http://learnyousomeerlang.com/distribunomicon 
> 
> Yes, that repeats the information that Irmo started this subthread with. It doesn't address Matthew's question at all, though. 
> 
> Perhaps the erlang list is a better place for us to be asking about this, Matthew, since it's not directly about Rabbit - are you on that list? I'm not currently subscribed. 
> 
> Tony 
> -- 
> Tony Garnock-Jones 
> tonygarnockjones at gmail.com 
> http://homepages.kcbbs.gen.nz/tonyg/ 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From jonas.colmsjo at gizur.com  Tue Mar 13 10:34:49 2012
From: jonas.colmsjo at gizur.com (Jonas Colmsjo)
Date: Tue, 13 Mar 2012 03:34:49 -0700 (PDT)
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
	<DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
Message-ID: <24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>

Thank's for answering!

The MQ server is running on a Amazon EC2 server. This is the server I try 
to access both locally and remotely.

How is authentication performed? I was hoping authentication wasn't needed 
when running from localhost. Maybe this isn't true?
I see in the administration console that I can add users...

The result of the commands is listed here:

Status of node 'rabbit at rabbit-1' ...
[{pid,1450},
 {running_applications,
     [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
[kernel-poll:true]\n"},
 {memory,
     [{total,12970072},
      {processes,4968776},
      {processes_used,4959720},
      {system,8001296},
      {atom,737045},
      {atom_used,727811},
      {binary,62256},
      {code,6077475},
      {ets,377668}]},
 {vm_memory_high_watermark,0.3999999997777084},
 {vm_memory_limit,719775334}]
...done.

root at rabbit-1:~# rabbitmqctl report
Reporting server status on {{2012,3,13},{10,28,54}}

Status of node 'rabbit at rabbit-1' ...
[{pid,1450},
 {running_applications,
     [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
[kernel-poll:true]\n"},
 {memory,
     [{total,12970840},
      {processes,4969696},
      {processes_used,4960640},
      {system,8001144},
      {atom,737045},
      {atom_used,727860},
      {binary,62256},
      {code,6077475},
      {ets,377668}]},
 {vm_memory_high_watermark,0.3999999997777084},
 {vm_memory_limit,719775334}]

Cluster status of node 'rabbit at rabbit-1' ...
[{nodes,[{disc,['rabbit at rabbit-1']}]},{running_nodes,['rabbit at rabbit-1']}]

Application environment of node 'rabbit at rabbit-1' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name type durable auto_delete internal arguments
amq.rabbitmq.trace topic true false false []
amq.rabbitmq.log topic true false false []
amq.match headers true false false []
amq.headers headers true false false []
amq.topic topic true false false []
amq.direct direct true false false []
amq.fanout fanout true false false []
direct true false false []

Bindings on /:

Consumers on /:

Permissions on /:
user configure write read
scalr .* .* .*

End of server status report
...done.


Den m?ndagen den 12:e mars 2012 kl. 11:43:20 UTC+1 skrev Steve Powell:
>
> Hi Jonas,
>
> Instead of issuing 'rabbitmq-server status', please can you try issuing
> 'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
> running rabbit node.
>
> You say 'I've tried running the python code on both the local host (ubuntu
> 10.04) and on osx.' but it would be quite useful to know a little more 
> about
> your setup. Are you trying to access the same server in both cases?
>
> Steve Powell  (a loppy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:
>
> > I've copied the send.py and receive.py in the Hellow World tutorial and 
> keep getting time out errors.I've tried running the python code on both the 
> local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and 
> running and I can login to the management console.
> > 
> > Any help is greatly appreciated!
> > 
> > root at rabbit-1:~/tmp# rabbitmq-server status
> > Activating RabbitMQ plugins ...
> > 
> > 
> ********************************************************************************
> > 
> ********************************************************************************
> > 
> > 6 plugins activated:
> > * amqp_client-2.7.1
> > * mochiweb-1.3-rmq2.7.1-git
> > * rabbitmq_management-2.7.1
> > * rabbitmq_management_agent-2.7.1
> > * rabbitmq_mochiweb-2.7.1
> > * webmachine-1.7.0-rmq2.7.1-hg
> > 
> > node with name "rabbit" already running on "rabbit-1"
> > diagnostics:
> > - nodes and their ports on rabbit-1: [{rabbit,39652},
> >                                       {rabbitmqprelaunch17299,33245}]
> > - current node: 'rabbitmqprelaunch17299 at rabbit-1'
> > - current node home dir: /var/lib/rabbitmq
> > - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
> > 
> > --- ERROR ---
> > 
> > root at rabbit-1:~/tmp# sudo python send.py
> > Traceback (most recent call last):
> >   File "send.py", line 5, in <module>
> >     host='localhost'))
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
> line 32, in __init__
> >     BaseConnection.__init__(self, parameters, None, 
> reconnection_strategy)
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
> line 50, in __init__
> >     reconnection_strategy)
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
> 170, in __init__
> >     self._connect()
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
> 228, in _connect
> >     self.parameters.port or  spec.PORT)
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
> line 44, in _adapter_connect
> >     self._handle_read()
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
> line 151, in _handle_read
> >     data = self.socket.recv(self._suggested_buffer_size)
> > socket.timeout: timed out
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/9bd9da48/attachment.htm>

From jonas.colmsjo at gizur.com  Tue Mar 13 10:34:49 2012
From: jonas.colmsjo at gizur.com (Jonas Colmsjo)
Date: Tue, 13 Mar 2012 03:34:49 -0700 (PDT)
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
	<DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
Message-ID: <24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>

Thank's for answering!

The MQ server is running on a Amazon EC2 server. This is the server I try 
to access both locally and remotely.

How is authentication performed? I was hoping authentication wasn't needed 
when running from localhost. Maybe this isn't true?
I see in the administration console that I can add users...

The result of the commands is listed here:

Status of node 'rabbit at rabbit-1' ...
[{pid,1450},
 {running_applications,
     [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
[kernel-poll:true]\n"},
 {memory,
     [{total,12970072},
      {processes,4968776},
      {processes_used,4959720},
      {system,8001296},
      {atom,737045},
      {atom_used,727811},
      {binary,62256},
      {code,6077475},
      {ets,377668}]},
 {vm_memory_high_watermark,0.3999999997777084},
 {vm_memory_limit,719775334}]
...done.

root at rabbit-1:~# rabbitmqctl report
Reporting server status on {{2012,3,13},{10,28,54}}

Status of node 'rabbit at rabbit-1' ...
[{pid,1450},
 {running_applications,
     [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
[kernel-poll:true]\n"},
 {memory,
     [{total,12970840},
      {processes,4969696},
      {processes_used,4960640},
      {system,8001144},
      {atom,737045},
      {atom_used,727860},
      {binary,62256},
      {code,6077475},
      {ets,377668}]},
 {vm_memory_high_watermark,0.3999999997777084},
 {vm_memory_limit,719775334}]

Cluster status of node 'rabbit at rabbit-1' ...
[{nodes,[{disc,['rabbit at rabbit-1']}]},{running_nodes,['rabbit at rabbit-1']}]

Application environment of node 'rabbit at rabbit-1' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name type durable auto_delete internal arguments
amq.rabbitmq.trace topic true false false []
amq.rabbitmq.log topic true false false []
amq.match headers true false false []
amq.headers headers true false false []
amq.topic topic true false false []
amq.direct direct true false false []
amq.fanout fanout true false false []
direct true false false []

Bindings on /:

Consumers on /:

Permissions on /:
user configure write read
scalr .* .* .*

End of server status report
...done.


Den m?ndagen den 12:e mars 2012 kl. 11:43:20 UTC+1 skrev Steve Powell:
>
> Hi Jonas,
>
> Instead of issuing 'rabbitmq-server status', please can you try issuing
> 'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
> running rabbit node.
>
> You say 'I've tried running the python code on both the local host (ubuntu
> 10.04) and on osx.' but it would be quite useful to know a little more 
> about
> your setup. Are you trying to access the same server in both cases?
>
> Steve Powell  (a loppy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:
>
> > I've copied the send.py and receive.py in the Hellow World tutorial and 
> keep getting time out errors.I've tried running the python code on both the 
> local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and 
> running and I can login to the management console.
> > 
> > Any help is greatly appreciated!
> > 
> > root at rabbit-1:~/tmp# rabbitmq-server status
> > Activating RabbitMQ plugins ...
> > 
> > 
> ********************************************************************************
> > 
> ********************************************************************************
> > 
> > 6 plugins activated:
> > * amqp_client-2.7.1
> > * mochiweb-1.3-rmq2.7.1-git
> > * rabbitmq_management-2.7.1
> > * rabbitmq_management_agent-2.7.1
> > * rabbitmq_mochiweb-2.7.1
> > * webmachine-1.7.0-rmq2.7.1-hg
> > 
> > node with name "rabbit" already running on "rabbit-1"
> > diagnostics:
> > - nodes and their ports on rabbit-1: [{rabbit,39652},
> >                                       {rabbitmqprelaunch17299,33245}]
> > - current node: 'rabbitmqprelaunch17299 at rabbit-1'
> > - current node home dir: /var/lib/rabbitmq
> > - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
> > 
> > --- ERROR ---
> > 
> > root at rabbit-1:~/tmp# sudo python send.py
> > Traceback (most recent call last):
> >   File "send.py", line 5, in <module>
> >     host='localhost'))
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
> line 32, in __init__
> >     BaseConnection.__init__(self, parameters, None, 
> reconnection_strategy)
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
> line 50, in __init__
> >     reconnection_strategy)
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
> 170, in __init__
> >     self._connect()
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
> 228, in _connect
> >     self.parameters.port or  spec.PORT)
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
> line 44, in _adapter_connect
> >     self._handle_read()
> >   File 
> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
> line 151, in _handle_read
> >     data = self.socket.recv(self._suggested_buffer_size)
> > socket.timeout: timed out
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/9bd9da48/attachment-0001.htm>

From simon at rabbitmq.com  Tue Mar 13 11:53:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Mar 2012 11:53:08 +0000
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
 one	machine
In-Reply-To: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
Message-ID: <4F5F3524.5030405@rabbitmq.com>

On 13/03/12 03:21, Brian Jing wrote:
> The problem is that although I have SSL configured for 2.7.1, only
> non-SSl connections currently work. For any SSL connections, I get a
> "connection refused" on the client side. I triple checked the SSL
> certificates and saw no problems. However, when I list the status of the
> 2.7.1 server , it says the following:

That looks like Rabbit is not even trying to listen for SSL. Do you see 
something like

=INFO REPORT==== 13-Mar-2012::11:49:04 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 13-Mar-2012::11:49:04 ===
started SSL Listener on [::]:5671

in the logs? Or is there an error? What does your config file look like?

> I noticed that ServerA doesn't have ssl in the "running_application"
> list. Is this why SSL doesn't work? I'm pretty sure erlang R13B03 thats
> currently running on ServerA supports SSL because rabbit 1.8.0 is using it.
>
> What are my options here? Would updating Erlang on ServerA to the latest
> version solve the problem? Would the latest Erlang be incompatible with
> rabbitmq 1.8.0? If I were to still use Erlang R13B03, what shall I do to
> make 2.7.1 work with SSL?

The SSL dependencies haven't changed much since 1.8.0. SSL support in 
newer Erlang is more robust, but if it was working for you with R13B03 
and 1.8.0 then it should work with R13B03 and 2.7.1.

I'm not sure, but I suspect Erlang R15B will not work with 1.8.0. 
Various bits of deprecated API have been removed, and I imagine 1.8.0 
used them.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From santiagomonttco at gmail.com  Tue Mar 13 13:05:12 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Tue, 13 Mar 2012 10:05:12 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?=7CSpam=7C_=22PERU=3A_CIERRE_?=
	=?windows-1252?q?DEL_EJERCICIO_2011=22_Principales_contingencias_e?=
	=?windows-1252?q?n_el_c=E1lculo_del_Impuesto_a_la_Renta_de_Persona?=
	=?windows-1252?q?s_Jur=EDdicas_en_el_Per=FA?=
Message-ID: <2b5826ee80c82374a180a29200167f06@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/848bf0f0/attachment.htm>

From sameek at arosys.com  Tue Mar 13 13:01:13 2012
From: sameek at arosys.com (sameekmishra)
Date: Tue, 13 Mar 2012 06:01:13 -0700 (PDT)
Subject: [rabbitmq-discuss]  problem on queue depth checking?
Message-ID: <33494003.post@talk.nabble.com>


Hi All,

I am running a thread for checking the depth of queue(i.e. no of messages in
queue), and one thread to consume the message.
Both the threads are running infinitely.
in both the thread the common object is mq connection object. In both thread
i am creating seperate channel and binding them with same queue.
Consumer thread consumes message if available and then sleep for 1
minutes(This scenario is for testing only).
Queue Depth checking thread checks the queuedepth and then sleep for 10
seconds.
Now if i publish 2 messages then one message will be consumed(and thread
will sleep for one minute) and one will be in the queue;
And queue depth checking thread must show the queuedepth = 1. But I am
getting the queuedepth 0.
But if we dont consume the message from queue then queuedepth is shown
correctly. 

I observed that the below code creating separte channel and both are reading
same queue. may that is the reason it show queuedeptha wrong.

used consumer code:

		channel = connection.createChannel();
                channel.exchangeDeclare(requestExchangeName, exchangeType,
durable);
                channel.queueDeclare(requestQueueName, durable, false,
false, null);
                channel.queueBind(requestQueueName, requestExchangeName,
requestRoutingKey);
                consumer = new QueueingConsumer(channel);
                channel.basicConsume(requestQueueName, noAck, consumer);

used queueDepth code:

                channel = connection.createChannel();
		DeclareOk queueDeclarePassive = channel.queueDeclarePassive(queueName);
                queueDepth=  queueDeclarePassive.getMessageCount();
                

please help me to figure out the problem and solution as well.
-- 
View this message in context: http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494003.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Tue Mar 13 13:07:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Mar 2012 13:07:15 +0000
Subject: [rabbitmq-discuss] problem on queue depth checking?
In-Reply-To: <33494003.post@talk.nabble.com>
References: <33494003.post@talk.nabble.com>
Message-ID: <4F5F4683.5050904@rabbitmq.com>

On 13/03/12 13:01, sameekmishra wrote:
> Now if i publish 2 messages then one message will be consumed(and thread
> will sleep for one minute) and one will be in the queue;
> And queue depth checking thread must show the queuedepth = 1. But I am
> getting the queuedepth 0.
> But if we dont consume the message from queue then queuedepth is shown
> correctly.

RabbitMQ will by default push as many messages to the consumer as it 
can. On the consumer side they end up buffered in the QueueingConsumer.

To change this behaviour, invoke channel.basicQos() and use acks. This 
will bound the number of unacknowledged messages RabbitMQ will push to 
your consumer.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sameek at arosys.com  Tue Mar 13 13:47:48 2012
From: sameek at arosys.com (sameekmishra)
Date: Tue, 13 Mar 2012 06:47:48 -0700 (PDT)
Subject: [rabbitmq-discuss] problem on queue depth checking?
In-Reply-To: <4F5F4683.5050904@rabbitmq.com>
References: <33494003.post@talk.nabble.com> <4F5F4683.5050904@rabbitmq.com>
Message-ID: <33494378.post@talk.nabble.com>


Defining the channel.basicQos(1) consumer will pick one message and do not
pick any message from queue until it not got acknowledgement,if u think that
consumer will consume all message from queue that's because I got queue
depth zero but This may not be the case as.

What i am thinking is that we need to define channel.basicQos(1) only in the
consumer code not in queueDepth because it only give the total count of
message.

Even after defining the channel.basicQos(1) on consumer end, I am getting
queuedepth value 0,which should be one. may other reason behind that i am
getting wrong result.

Thanks
Sameek


Simon MacMullen-2 wrote:
> 
> On 13/03/12 13:01, sameekmishra wrote:
>> Now if i publish 2 messages then one message will be consumed(and thread
>> will sleep for one minute) and one will be in the queue;
>> And queue depth checking thread must show the queuedepth = 1. But I am
>> getting the queuedepth 0.
>> But if we dont consume the message from queue then queuedepth is shown
>> correctly.
> 
> RabbitMQ will by default push as many messages to the consumer as it 
> can. On the consumer side they end up buffered in the QueueingConsumer.
> 
> To change this behaviour, invoke channel.basicQos() and use acks. This 
> will bound the number of unacknowledged messages RabbitMQ will push to 
> your consumer.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-- 
View this message in context: http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494378.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From lam at fixmo.com  Tue Mar 13 13:58:09 2012
From: lam at fixmo.com (Michael Lam)
Date: Tue, 13 Mar 2012 09:58:09 -0400
Subject: [rabbitmq-discuss] bug report?
Message-ID: <CAAXXezaYkoqdA-09Q81Cp4VPA3ursNrtAC3a2eveDOvB_h3AXQ@mail.gmail.com>

Hello,

I've looked everywhere and cannot locate a bug tracker for RabbitMQ.  Is
there anywhere I can submit bug reports and patches?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/f023f8f2/attachment.htm>

From shammi at arosys.com  Tue Mar 13 14:09:03 2012
From: shammi at arosys.com (cheepu)
Date: Tue, 13 Mar 2012 07:09:03 -0700 (PDT)
Subject: [rabbitmq-discuss]  From where I can download JavaDoc for client
Message-ID: <33494463.post@talk.nabble.com>


Hi,
I could not find link where I can download Java Doc for the client. Please
any one guide this.

Thanks

-- 
View this message in context: http://old.nabble.com/From-where-I-can-download-JavaDoc-for-client-tp33494463p33494463.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Tue Mar 13 14:12:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Mar 2012 14:12:08 +0000
Subject: [rabbitmq-discuss] From where I can download JavaDoc for client
In-Reply-To: <33494463.post@talk.nabble.com>
References: <33494463.post@talk.nabble.com>
Message-ID: <4F5F55B8.6080403@rabbitmq.com>

On 13/03/12 14:09, cheepu wrote:
> I could not find link where I can download Java Doc for the client. Please
> any one guide this.

The Java client download page?

http://www.rabbitmq.com/java-client.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lam at fixmo.com  Tue Mar 13 14:25:07 2012
From: lam at fixmo.com (Michael Lam)
Date: Tue, 13 Mar 2012 10:25:07 -0400
Subject: [rabbitmq-discuss] bug report?
In-Reply-To: <CAAXXezaYkoqdA-09Q81Cp4VPA3ursNrtAC3a2eveDOvB_h3AXQ@mail.gmail.com>
References: <CAAXXezaYkoqdA-09Q81Cp4VPA3ursNrtAC3a2eveDOvB_h3AXQ@mail.gmail.com>
Message-ID: <CAAXXezYaDWKNEA-+zEiXFvNwhgmO4kC25uC09y23wPkYnbJyng@mail.gmail.com>

If in case this mailing list is the bug report (I saw a 2008 thread to this
effect), here's the bug:

In the 2.7.1 Java client library, RpcClient.java

RpcClient.stringCall does not encode the message in UTF-8 as it's expected
by StringRpcServer.handleCall, resulting in corrupted message received by
the server if the message contains non-ASCII characters.

Fix is quite easy:

 public String stringCall(String message)
        throws IOException, ShutdownSignalException, TimeoutException
    {
-        return new String(primitiveCall(message.getBytes()));
+        byte[] request;
+        try {
+            request = message.getBytes("UTF-8");
+        } catch (UnsupportedEncodingException uee) {
+            request = message.getBytes();
+        }
+        byte[] reply = primitiveCall(request);
+        try {
+            return new String(reply, "UTF-8");
+        } catch (UnsupportedEncodingException uee) {
+           return new String(reply);
+        }
    }

Thanks!


On 13 March 2012 09:58, Michael Lam <lam at fixmo.com> wrote:

> Hello,
>
> I've looked everywhere and cannot locate a bug tracker for RabbitMQ.  Is
> there anywhere I can submit bug reports and patches?
>
> Thanks!
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/7c0f5b9f/attachment.htm>

From trancos at gmail.com  Tue Mar 13 16:13:55 2012
From: trancos at gmail.com (Jose Comboni)
Date: Tue, 13 Mar 2012 09:13:55 -0700
Subject: [rabbitmq-discuss] problem on queue depth checking?
In-Reply-To: <33494378.post@talk.nabble.com>
References: <33494003.post@talk.nabble.com> <4F5F4683.5050904@rabbitmq.com>
	<33494378.post@talk.nabble.com>
Message-ID: <4C93928F-0D4A-45E0-A52A-87389D573054@gmail.com>


Make sure autoack is set to false.

From Jose's iPhone

On Mar 13, 2012, at 6:47 AM, sameekmishra <sameek at arosys.com> wrote:

> 
> Defining the channel.basicQos(1) consumer will pick one message and do not
> pick any message from queue until it not got acknowledgement,if u think that
> consumer will consume all message from queue that's because I got queue
> depth zero but This may not be the case as.
> 
> What i am thinking is that we need to define channel.basicQos(1) only in the
> consumer code not in queueDepth because it only give the total count of
> message.
> 
> Even after defining the channel.basicQos(1) on consumer end, I am getting
> queuedepth value 0,which should be one. may other reason behind that i am
> getting wrong result.
> 
> Thanks
> Sameek
> 
> 
> Simon MacMullen-2 wrote:
>> 
>> On 13/03/12 13:01, sameekmishra wrote:
>>> Now if i publish 2 messages then one message will be consumed(and thread
>>> will sleep for one minute) and one will be in the queue;
>>> And queue depth checking thread must show the queuedepth = 1. But I am
>>> getting the queuedepth 0.
>>> But if we dont consume the message from queue then queuedepth is shown
>>> correctly.
>> 
>> RabbitMQ will by default push as many messages to the consumer as it 
>> can. On the consumer side they end up buffered in the QueueingConsumer.
>> 
>> To change this behaviour, invoke channel.basicQos() and use acks. This 
>> will bound the number of unacknowledged messages RabbitMQ will push to 
>> your consumer.
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> -- 
> View this message in context: http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494378.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jacquesdr at gmail.com  Tue Mar 13 16:40:03 2012
From: jacquesdr at gmail.com (Jacques du Rand)
Date: Tue, 13 Mar 2012 18:40:03 +0200
Subject: [rabbitmq-discuss] Difference between get and consume.
Message-ID: <CA+-VnXCftEngnSqEtx3FPj18n-B00q0C_SHkwWWgqvS4=bn+fw@mail.gmail.com>

Hi guys.
I recently  learnd that the c library when using basic get is also
blocking. In php its non blocking. What then is the difference  between
basicget and consume?  At a c lib level?
Regards
Jacques
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/e2a48ac4/attachment.htm>

From alan.antonuk at gmail.com  Tue Mar 13 17:44:38 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 13 Mar 2012 13:44:38 -0400
Subject: [rabbitmq-discuss] Difference between get and consume.
In-Reply-To: <CA+-VnXCftEngnSqEtx3FPj18n-B00q0C_SHkwWWgqvS4=bn+fw@mail.gmail.com>
References: <CA+-VnXCftEngnSqEtx3FPj18n-B00q0C_SHkwWWgqvS4=bn+fw@mail.gmail.com>
Message-ID: <CAAt2po+uxvdj_9m7D_0fcAVTWmzuL8kNEKbk9bpfMnn1dBV3rQ@mail.gmail.com>

basic.get is synchronous call which the client asks the broker: "are there
any messages in this queue, if so please give me one".

basic.consume is a synchronous call that starts an asynchronous behavior:
it tells the broker, "please deliver to me the messages in this queue until
I say stop".  The messages can then arrive from the broker at any point in
the future.

The rabbitmq-c library does have a function to do basic.get
(amqp_basic_get).  The rabbitmq-c also has a function to start and stop a
consumer (amqp_basic_consume and amqp_basic_cancel).  However it does not
have an API to deal with consuming messages. You will need to loop
examining amqp frames as they come in and decide how to piece them together
as their delivered (check the amqp_consumer.c example for details).

-Alan

On Tue, Mar 13, 2012 at 12:40 PM, Jacques du Rand <jacquesdr at gmail.com>wrote:

> Hi guys.
> I recently  learnd that the c library when using basic get is also
> blocking. In php its non blocking. What then is the difference  between
> basicget and consume?  At a c lib level?
> Regards
> Jacques
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/f0f09631/attachment.htm>

From pablomolnar at gmail.com  Tue Mar 13 20:39:27 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Tue, 13 Mar 2012 17:39:27 -0300
Subject: [rabbitmq-discuss] HAProxy configuration
Message-ID: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>

Hi,
Anyone has a typical configuration for HAProxy? I want to loadbalance queue
creation across the whole cluster (5 nodes).

Thanks,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/a595135d/attachment.htm>

From jerryk at vmware.com  Tue Mar 13 20:54:59 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 13 Mar 2012 13:54:59 -0700 (PDT)
Subject: [rabbitmq-discuss] HAProxy configuration
In-Reply-To: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>
References: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>
Message-ID: <88523D96-FD95-45CD-86B7-C8C6C7999F96@vmware.com>

The Manning book "RabbitMQ in Action" has a good discussion of this sort of use of HAproxy and is currently available from the publisher as an e-book with the print edition to follow soon....

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Mar 13, 2012, at 1:40 PM, Pablo Molnar <pablomolnar at gmail.com> wrote:

> Hi,
> Anyone has a typical configuration for HAProxy? I want to loadbalance queue creation across the whole cluster (5 nodes).
> 
> Thanks,
> Pablo
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Tue Mar 13 21:42:05 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 13 Mar 2012 14:42:05 -0700
Subject: [rabbitmq-discuss] Inconsistent queue synchronization behavior
Message-ID: <CB850D3D.3295D%mpietrek@skytap.com>

I'm experiencing a problem with mirrored queue synchronization, and I'm
trying to determine if there's a bug or I'm just not understanding
something.

Our setup:
* RabbitMQ 2.71 on 64-bit Ubuntu 10.04.
* Three brokers with all queues mirrored
* Web Management plugin installed

We typically have five queues defined, all mirrored. If I observe them in
the "Queues tab" of the Management UI, they all have a green "+2" after the
Node name. They're all mastered on the same Node.

None of these queues have any messages, and there are no clients connected,
sending or receiving messages.

If I stop one of the brokers, all the "+2"s become "+1", as expected.
However, when I restart the broker a couple of seconds later, some subset of
the queues (varies from run to run) go back to "+2", while the remaining
queues switch to "+1  +1", meaning 1 synched, and 1 unsynched.

Given that there are no messages in the queue, I don't understand why some
queues don't synch back up properly.

Also, I've looked at the sync status of the queues in rabbitmqctl, and the
results seem consistent with what the HTTP API reports.

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/b7eef667/attachment.htm>

From mpietrek at skytap.com  Tue Mar 13 22:00:30 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 13 Mar 2012 15:00:30 -0700
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7iwzkasgaJ96RhRQ4jp1QL2kKF2ab8-PJHj=O3YPw9JWnA@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
	<4F462871.4070602@rabbitmq.com>
	<CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>
	<4F4780FE.1060609@rabbitmq.com>
	<CACLE7iwzkasgaJ96RhRQ4jp1QL2kKF2ab8-PJHj=O3YPw9JWnA@mail.gmail.com>
Message-ID: <CACLE7iz_KL2UYjWxXZbH6vsJqg6Ex9fO42JaLw6+0jgRoB8Chw@mail.gmail.com>

Some other work came up so I needed to drop this thread for a few weeks.
However, coming back to it, I can easily reproduce this issue within one or
two tries.

In a nutshell, in a clustered environment, simply stop one node, wait a few
seconds, then restart it. The last output seen is:

starting database
                               ...

I've let it wait for much longer than 30 seconds and it has never come back.

Any chance this may have been stamped out in RabbitMQ 2.8?



On Fri, Feb 24, 2012 at 1:43 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> | So how long are you waiting when determining it's hanging? Less than 30
> seconds?
>
> Just to be double sure, I let it sit for an hour yesterday. I would have
> expected a timeout, but it never came.
>
> It's a pretty easy scenario to script and try out. I'd send you my code,
> but it relies on other internal commands.
>
> There may also be a timing issue. If I put a 10 second delay after
> restarting one broker, and before stopping the next, it seems to help.
>
> That is:
>
> for x in broker_list:
>     stop x
>     start x
>     sleep(10)
>
> Matt
>
>
> On Fri, Feb 24, 2012 at 4:22 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 23/02/12 21:00, Matt Pietrek wrote:
>>
>>> The nohup.out on the failing node ends with:
>>>
>>
>> <snip>
>>
>>  starting database                                                     ...
>>>
>>
>> So how long are you waiting when determining it's hanging? Less than 30
>> seconds?
>>
>> Because that looks like Rabbit is waiting for another cluster node (if it
>> was not the last to shut down, but is the first to start up, it will wait
>> for the one that was the last to shut down. But it will only wait for 30
>> seconds before spitting out an error. I'm not sure how else you could get
>> it to stop there *without* any further output though.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/6a23bf37/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 13 22:19:15 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Tue, 13 Mar 2012 23:19:15 +0100
Subject: [rabbitmq-discuss] SSL w/ intermediate certificate
In-Reply-To: <CAFPidkOmcq4fY7F82f5TiTMXsH9kxqjvmAJJ+fAv4ci=xeS2UA@mail.gmail.com>
References: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>
	<4F5DCFED.4070705@rabbitmq.com>
	<CAFPidkOmcq4fY7F82f5TiTMXsH9kxqjvmAJJ+fAv4ci=xeS2UA@mail.gmail.com>
Message-ID: <CAFPidkNGNAN2dqLbWfFxJRt8UEK3jGv3+JNrUKBMx=gxXacLfg@mail.gmail.com>

it works fine for most web browsers, but not with eg. openssl s_client etc.

but the fix is to put the intermediate certificate(s) in the "cacertfile"

On Mon, Mar 12, 2012 at 13:24, Carl H?rberg <carl.hoerberg at gmail.com> wrote:
> cat ssl.crt ssl.key intermediate.crt > ssl.pem
>
> anyway.. it seems to work fine with just:
>
> cat ssl.crt ssl.key > ssl.pem
>
> On Mon, Mar 12, 2012 at 11:29, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi Carl,
>>
>> On 11/03/12 18:05, Carl H?rberg wrote:
>>> =ERROR REPORT==== 11-Mar-2012::17:29:15 ===
>>> ? ? application: mochiweb
>>> ? ? "Accept failed error"
>>> ? ? "{error,ecertfile}"
>>
>> This error normally means there is something wrong with the certificate,
>> but it's not possible to provide a more precise diagnosis without more
>> details.
>>
>> You can test it by using the certificate to create an SSL connection
>> with the OpenSSL s_server option.
>>
>> How did you create the certificate? You should double-check the commands
>> used.
>>
>>
>>
>> -Emile

From dbgreer at gmail.com  Tue Mar 13 22:22:30 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Tue, 13 Mar 2012 17:22:30 -0500
Subject: [rabbitmq-discuss] Connection attempt from disallowed node question
Message-ID: <CAAzMEC=RNZWD_i4w2Uau9mPE0ddCnZVG8ev6Hoh=McUYNct6RA@mail.gmail.com>

I've installed RabbitMQ successfully on several Windows servers and
documented the process for the admins at our company.  Upon following my
instructions for adding a new user, they received an error along the lines
of:

 Error: unable to connect to node rabbit@[machinename]: nodedown.

The logs also have the following:

 =ERROR REPORT==== 13-Mar-2012::15:00:15 ===
110 ** Connection attempt from disallowed node rabbitmqctl32476@[machine
name] **


Everything I've read about this says this is due to the erlang cookie of
the user executing the rabbitmqctl.bat command not matching the global
erlang cookie in C:\Windows, so I've had the admin check these values and
he claims they are the exact same.  The RabbitMQ service is running as the
default system account which doesn't have a home directory, so I assume the
service runs the process with the cookie from C:\Windows.

Can anyone provide some guidance for where to go next?

Thanks,
Derek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/41c815ac/attachment.htm>

From pbell at syncsort.com  Tue Mar 13 22:26:15 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Tue, 13 Mar 2012 18:26:15 -0400
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <88523D96-FD95-45CD-86B7-C8C6C7999F96@vmware.com>
References: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>
	<88523D96-FD95-45CD-86B7-C8C6C7999F96@vmware.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>

Hi All,

What are the Rabbit "best practices" ways of handling a situation where the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am trying to understand the best ways to throttle the producer in such a case. Assume that neither queue nor its topic exchange are durable.

Can producer obtain information about the state of the queue, e.g., the number of unACKed messages, its size in bytes or number of messages, etc? Or is another approach indicated?

Thanks very much.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From simone.busoli at gmail.com  Tue Mar 13 22:54:54 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 13 Mar 2012 23:54:54 +0100
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
References: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>
	<88523D96-FD95-45CD-86B7-C8C6C7999F96@vmware.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
Message-ID: <CAOn7oW9nEfxz0L2CcdF_DqBobC42Ln1pd=z1uQtAGYA1gQSTCQ@mail.gmail.com>

Hi Paul, I haven't dealt with this problem myself as I've never had the
need to do so but as far as I know there's no flow control you can put in
place between a producer and a consumer. There are similar mechanisms
between a producer and the broker (tcp flow control), and between the
broker and a consumer (prefetch settings), but nothing built-in for the
scenario you describe.
What you describe is indeed TCP flow control, but differently from what
happens with AMQP, TCP entails a point-to-point connection, so this
mechanism makes sense, while it's unlikely that you want a single slow
consumer to slow down the entire AMQP broker.

On Tue, Mar 13, 2012 at 23:26, Bell, Paul M. <pbell at syncsort.com> wrote:

> Hi All,
>
> What are the Rabbit "best practices" ways of handling a situation where
> the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am
> trying to understand the best ways to throttle the producer in such a case.
> Assume that neither queue nor its topic exchange are durable.
>
> Can producer obtain information about the state of the queue, e.g., the
> number of unACKed messages, its size in bytes or number of messages, etc?
> Or is another approach indicated?
>
> Thanks very much.
>
> -Paul
>
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
>  confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with this
> message is always confidential and cannot be shared with any third parties
> without prior written approval from Syncsort. This message is intended to
> be read only by the individual or entity to whom it is addressed or by
> their designee. If the reader of this message is not the intended
> recipient, you are on notice that any use, disclosure, copying or
> distribution of this message, in any form, is strictly prohibited. If you
> have received this message in error, please immediately notify the sender
> and/or Syncsort and destroy all copies of this message in your possession,
> custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/71bcbb9d/attachment.htm>

From jerryk at vmware.com  Tue Mar 13 23:00:31 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 13 Mar 2012 16:00:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
Message-ID: <48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>

Hi, Paul:  You could use the management HTTP API to keep a track on
queue depths and then have your producer dynamically adjust its 
behavior if it notices that consumption isn't keeping up, but you
should really think about whether this is something you want to do.

It ends up building a lot of of hand holding awareness of the messaging
mechanics into your endpoint applications, which in some ways goes against
the spirit of using a messaging service in between your producers and
consumers in the first place.  You might be better off monitoring the
system, and spinning up additional consumers to drain especially busy 
queues than building the sort of logic you describe...

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 13, 2012 3:26:15 PM
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi All,

What are the Rabbit "best practices" ways of handling a situation where the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am trying to understand the best ways to throttle the producer in such a case. Assume that neither queue nor its topic exchange are durable.

Can producer obtain information about the state of the queue, e.g., the number of unACKed messages, its size in bytes or number of messages, etc? Or is another approach indicated?

Thanks very much.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brian.newsgroup at gmail.com  Wed Mar 14 00:26:48 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 14 Mar 2012 11:26:48 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
	one machine
In-Reply-To: <4F5F3524.5030405@rabbitmq.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
Message-ID: <CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>

Hi Simon,

Thanks for your reply! So I guess we'll have to stick with Erlang R13B03
until we've completely made the transition to Rabbit 2.7.1.

I just had a look at the logs, you are right, the ssl port is not being
listened. What could be wrong here. Is there anything I need to do to
enable SSL when building it?

Here is the config file for rabbit 2.7.1. The 1.8.0 config file sits in the
same directory with the same content(except the port) but with a different
name.

[
    {rabbit, [
        {ssl_listeners, [{"0.0.0.0",4445}]},
        {ssl_options, [
            {cacertfile,"/etc/rabbitmq/certs/testca/cacert.pem"},
            {certfile,"/etc/rabbitmq/certs/server/cert.pem"},
            {keyfile,"/etc/rabbitmq/certs/server/key.pem"},
            {verify, verify_peer},
            {fail_if_no_peer_cert, false}
        ]}

    ]}
].

When I start rabbit 2.7.1, I only see it starts to listen to the non-ssl
port as follows:

=INFO REPORT==== 14-Mar-2012::11:05:06 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 14-Mar-2012::11:05:06 ===
Memory limit set to 1304MB of 3260MB total.

=INFO REPORT==== 14-Mar-2012::11:05:06 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 14-Mar-2012::11:05:07 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 14-Mar-2012::11:05:07 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 14-Mar-2012::11:05:07 ===
started TCP Listener on [::]:4446

Cheers,

Brian

On Tue, Mar 13, 2012 at 10:53 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 13/03/12 03:21, Brian Jing wrote:
>
>> The problem is that although I have SSL configured for 2.7.1, only
>> non-SSl connections currently work. For any SSL connections, I get a
>> "connection refused" on the client side. I triple checked the SSL
>> certificates and saw no problems. However, when I list the status of the
>> 2.7.1 server , it says the following:
>>
>
> That looks like Rabbit is not even trying to listen for SSL. Do you see
> something like
>
> =INFO REPORT==== 13-Mar-2012::11:49:04 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 13-Mar-2012::11:49:04 ===
> started SSL Listener on [::]:5671
>
> in the logs? Or is there an error? What does your config file look like?
>
>
>  I noticed that ServerA doesn't have ssl in the "running_application"
>> list. Is this why SSL doesn't work? I'm pretty sure erlang R13B03 thats
>> currently running on ServerA supports SSL because rabbit 1.8.0 is using
>> it.
>>
>> What are my options here? Would updating Erlang on ServerA to the latest
>> version solve the problem? Would the latest Erlang be incompatible with
>> rabbitmq 1.8.0? If I were to still use Erlang R13B03, what shall I do to
>> make 2.7.1 work with SSL?
>>
>
> The SSL dependencies haven't changed much since 1.8.0. SSL support in
> newer Erlang is more robust, but if it was working for you with R13B03 and
> 1.8.0 then it should work with R13B03 and 2.7.1.
>
> I'm not sure, but I suspect Erlang R15B will not work with 1.8.0. Various
> bits of deprecated API have been removed, and I imagine 1.8.0 used them.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/39886277/attachment.htm>

From brian.newsgroup at gmail.com  Wed Mar 14 00:31:05 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 14 Mar 2012 11:31:05 +1100
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
	week
In-Reply-To: <4F58A2AA.30007@rabbitmq.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>
	<4F549D3B.4050306@rabbitmq.com>
	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>
	<4F55EE76.2000206@rabbitmq.com> <4F55F8BA.2050303@rabbitmq.com>
	<CALD4NQb0GPhT7DOnOUgPAoU3eVdgHPiSDnanm5K2xcoPR6G_=w@mail.gmail.com>
	<4F58A2AA.30007@rabbitmq.com>
Message-ID: <CALD4NQYmTvK+96DLxBrkjMek4TbYF4=mLNY86FaEqwt16XxsOg@mail.gmail.com>

Hi Simon,

We are currently using non-ssl ports, and only one-way federation in our
system. It seems that the whole thing is more stable now. However, the
hanging still happened last weekend. Is there anything from our end that
could help you pinpoint what the problem is? Logs or coredumps?

Cheers,

Brian

On Thu, Mar 8, 2012 at 11:14 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/03/12 22:57, Brian Jing wrote:
>
>> Hi Simon,
>>
>> We are using Erlang R14B04 on these servers.
>>
>> Our network is usually saturated by RabbitMQ traffic, probably partly
>> because we don't have enough bandwidth, and partly because we've been
>> using federation the wrong way (using same exchange for both up and
>> downstream transfer). Not sure whether this could contribute to the
>> issue. However, even if something bad happens with the network, isn't
>> rabbit supposed to recover itself no matter what?
>>
>
> Yes, absolutely. And in my tests it does. But I'm not absolutely sure what
> is happening in your case; it seems to be something slightly less obvious
> than just dropping the network connection.
>
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/b5b4a707/attachment.htm>

From brian.newsgroup at gmail.com  Wed Mar 14 00:38:53 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Wed, 14 Mar 2012 11:38:53 +1100
Subject: [rabbitmq-discuss] Federation binding to a queue
In-Reply-To: <CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>
References: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
	<4F5DD509.40600@rabbitmq.com>
	<CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>
Message-ID: <CALD4NQZtaL1-7iGzR9va7nEpmb5A=60Xn6m7r50DH4okeuqayw@mail.gmail.com>

Hi Timya,


From sameek at arosys.com  Wed Mar 14 06:00:22 2012
From: sameek at arosys.com (sameekmishra)
Date: Tue, 13 Mar 2012 23:00:22 -0700 (PDT)
Subject: [rabbitmq-discuss] problem on queue depth checking?
In-Reply-To: <4C93928F-0D4A-45E0-A52A-87389D573054@gmail.com>
References: <33494003.post@talk.nabble.com> <4F5F4683.5050904@rabbitmq.com>
	<33494378.post@talk.nabble.com>
	<4C93928F-0D4A-45E0-A52A-87389D573054@gmail.com>
Message-ID: <33499621.post@talk.nabble.com>


I have check that autoack is set false.


Jose Comboni wrote:
> 
> 
> Make sure autoack is set to false.
> 
> From Jose's iPhone
> 
> On Mar 13, 2012, at 6:47 AM, sameekmishra <sameek at arosys.com> wrote:
> 
>> 
>> Defining the channel.basicQos(1) consumer will pick one message and do
>> not
>> pick any message from queue until it not got acknowledgement,if u think
>> that
>> consumer will consume all message from queue that's because I got queue
>> depth zero but This may not be the case as.
>> 
>> What i am thinking is that we need to define channel.basicQos(1) only in
>> the
>> consumer code not in queueDepth because it only give the total count of
>> message.
>> 
>> Even after defining the channel.basicQos(1) on consumer end, I am getting
>> queuedepth value 0,which should be one. may other reason behind that i am
>> getting wrong result.
>> 
>> Thanks
>> Sameek
>> 
>> 
>> Simon MacMullen-2 wrote:
>>> 
>>> On 13/03/12 13:01, sameekmishra wrote:
>>>> Now if i publish 2 messages then one message will be consumed(and
>>>> thread
>>>> will sleep for one minute) and one will be in the queue;
>>>> And queue depth checking thread must show the queuedepth = 1. But I am
>>>> getting the queuedepth 0.
>>>> But if we dont consume the message from queue then queuedepth is shown
>>>> correctly.
>>> 
>>> RabbitMQ will by default push as many messages to the consumer as it 
>>> can. On the consumer side they end up buffered in the QueueingConsumer.
>>> 
>>> To change this behaviour, invoke channel.basicQos() and use acks. This 
>>> will bound the number of unacknowledged messages RabbitMQ will push to 
>>> your consumer.
>>> 
>>> Cheers, Simon
>>> 
>>> -- 
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> -- 
>> View this message in context:
>> http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494378.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-- 
View this message in context: http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33499621.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From johnstoner2 at gmail.com  Wed Mar 14 06:44:21 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Wed, 14 Mar 2012 01:44:21 -0500
Subject: [rabbitmq-discuss] does pika support exchange-to-exchange binding?
Message-ID: <CAMXtMFAx9qimG1Rt-aw-s090ujBUUVz5m7MgyNdp8iAHy0+U3Q@mail.gmail.com>

The subject says it all. I see comments in code here that seems to say it
does:

https://gist.github.com/970675

But the docs I find don't seem to say much about it.

-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/a45299d2/attachment.htm>

From zmstone at gmail.com  Wed Mar 14 09:03:52 2012
From: zmstone at gmail.com (stone)
Date: Wed, 14 Mar 2012 10:03:52 +0100
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
Message-ID: <CAPNZrFXVDkpq_YyhOm25SxXp-q+Njm3rXfFBAGFdOJkoFMF3oQ@mail.gmail.com>

Hi

You can retrieve the information of an existing queue by declaring it with
passive option set to true.
I had the same problem as you do, and found this link the other day,
haven't tried out though.

http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client

BRs
/stone

2012/3/14 Jerry Kuch <jerryk at vmware.com>

> Hi, Paul:  You could use the management HTTP API to keep a track on
> queue depths and then have your producer dynamically adjust its
> behavior if it notices that consumption isn't keeping up, but you
> should really think about whether this is something you want to do.
>
> It ends up building a lot of of hand holding awareness of the messaging
> mechanics into your endpoint applications, which in some ways goes against
> the spirit of using a messaging service in between your producers and
> consumers in the first place.  You might be better off monitoring the
> system, and spinning up additional consumers to drain especially busy
> queues than building the sort of logic you describe...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Paul M. Bell" <pbell at syncsort.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, March 13, 2012 3:26:15 PM
> Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
>
> Hi All,
>
> What are the Rabbit "best practices" ways of handling a situation where
> the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am
> trying to understand the best ways to throttle the producer in such a case.
> Assume that neither queue nor its topic exchange are durable.
>
> Can producer obtain information about the state of the queue, e.g., the
> number of unACKed messages, its size in bytes or number of messages, etc?
> Or is another approach indicated?
>
> Thanks very much.
>
> -Paul
>
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
>  confidential and/or legally privileged information. Any pricing
> information contained in this message or in any files transmitted with this
> message is always confidential and cannot be shared with any third parties
> without prior written approval from Syncsort. This message is intended to
> be read only by the individual or entity to whom it is addressed or by
> their designee. If the reader of this message is not the intended
> recipient, you are on notice that any use, disclosure, copying or
> distribution of this message, in any form, is strictly prohibited. If you
> have received this message in error, please immediately notify the sender
> and/or Syncsort and destroy all copies of this message in your possession,
> custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/f6182458/attachment.htm>

From ekirpichov at gmail.com  Wed Mar 14 09:15:04 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 14 Mar 2012 13:15:04 +0400
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <CAPNZrFXVDkpq_YyhOm25SxXp-q+Njm3rXfFBAGFdOJkoFMF3oQ@mail.gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
	<CAPNZrFXVDkpq_YyhOm25SxXp-q+Njm3rXfFBAGFdOJkoFMF3oQ@mail.gmail.com>
Message-ID: <CANVKUrUp=h68EtPGZ8mHgz71vbcmKyqr-3ntctbTPpEksC_hZw@mail.gmail.com>

You can also monitor the number of unconfirmed messages (do not confuse
with "unacked") to prevent broker overload. See "publisher confirms".

On Wed, Mar 14, 2012 at 1:03 PM, stone <zmstone at gmail.com> wrote:

> Hi
>
> You can retrieve the information of an existing queue by declaring it with
> passive option set to true.
> I had the same problem as you do, and found this link the other day,
> haven't tried out though.
>
>
> http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client
>
> BRs
> /stone
>
> 2012/3/14 Jerry Kuch <jerryk at vmware.com>
>
>> Hi, Paul:  You could use the management HTTP API to keep a track on
>> queue depths and then have your producer dynamically adjust its
>> behavior if it notices that consumption isn't keeping up, but you
>> should really think about whether this is something you want to do.
>>
>> It ends up building a lot of of hand holding awareness of the messaging
>> mechanics into your endpoint applications, which in some ways goes against
>> the spirit of using a messaging service in between your producers and
>> consumers in the first place.  You might be better off monitoring the
>> system, and spinning up additional consumers to drain especially busy
>> queues than building the sort of logic you describe...
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "Paul M. Bell" <pbell at syncsort.com>
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Tuesday, March 13, 2012 3:26:15 PM
>> Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
>>
>> Hi All,
>>
>> What are the Rabbit "best practices" ways of handling a situation where
>> the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am
>> trying to understand the best ways to throttle the producer in such a case.
>> Assume that neither queue nor its topic exchange are durable.
>>
>> Can producer obtain information about the state of the queue, e.g., the
>> number of unACKed messages, its size in bytes or number of messages, etc?
>> Or is another approach indicated?
>>
>> Thanks very much.
>>
>> -Paul
>>
>>
>>
>>
>> ATTENTION: -----
>>
>> The information contained in this message (including any files
>> transmitted with this message) may contain proprietary, trade secret or
>> other  confidential and/or legally privileged information. Any pricing
>> information contained in this message or in any files transmitted with this
>> message is always confidential and cannot be shared with any third parties
>> without prior written approval from Syncsort. This message is intended to
>> be read only by the individual or entity to whom it is addressed or by
>> their designee. If the reader of this message is not the intended
>> recipient, you are on notice that any use, disclosure, copying or
>> distribution of this message, in any form, is strictly prohibited. If you
>> have received this message in error, please immediately notify the sender
>> and/or Syncsort and destroy all copies of this message in your possession,
>> custody or control.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/a183c2d5/attachment.htm>

From emile at rabbitmq.com  Wed Mar 14 10:26:08 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 10:26:08 +0000
Subject: [rabbitmq-discuss] SSL w/ intermediate certificate
In-Reply-To: <CAFPidkNGNAN2dqLbWfFxJRt8UEK3jGv3+JNrUKBMx=gxXacLfg@mail.gmail.com>
References: <10740012.3858.1331489143203.JavaMail.geo-discussion-forums@vbux23>
	<4F5DCFED.4070705@rabbitmq.com>
	<CAFPidkOmcq4fY7F82f5TiTMXsH9kxqjvmAJJ+fAv4ci=xeS2UA@mail.gmail.com>
	<CAFPidkNGNAN2dqLbWfFxJRt8UEK3jGv3+JNrUKBMx=gxXacLfg@mail.gmail.com>
Message-ID: <4F607240.4080408@rabbitmq.com>

Hi Carl,

On 13/03/12 22:19, Carl H?rberg wrote:
> but the fix is to put the intermediate certificate(s) in the "cacertfile"

Thanks for reporting back. This is a useful tip for anyone wanting to
make use of intermediate certificates.


-Emile

From emile at rabbitmq.com  Wed Mar 14 10:46:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 10:46:17 +0000
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
References: <CANVSfpK5u-P4nZ+5kz597ujCT-EARhpy4CcNYZR=DLd4fY_ubQ@mail.gmail.com>
	<88523D96-FD95-45CD-86B7-C8C6C7999F96@vmware.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
Message-ID: <4F6076F9.6030506@rabbitmq.com>

Hi Paul,

On 13/03/12 22:26, Bell, Paul M. wrote:
> What are the Rabbit "best practices" ways of handling a situation
> where the consumer is v-e-r-y slow and the producer is super-fast.
> IOW: I am trying to understand the best ways to throttle the producer
> in such a case. Assume that neither queue nor its topic exchange are
> durable.
> 
> Can producer obtain information about the state of the queue, e.g.,
> the number of unACKed messages, its size in bytes or number of
> messages, etc? Or is another approach indicated?

There's no single best way to deal with mismatched rates of production
and consumption of messages. The simplest option is to ignore it,
assuming the mismatch is temporary. Queues may get very long and need to
spill over to disk, but they will shorten once producers slow down or
consumers speed up.

If the rate mismatch is a permanent feature then you ought to reconsider
the design. If producers know which queues their messages are destined
for then they could monitor the lengths of those queues. Another option
is to limit the lifetime of messages in destination queues with the
"x-message-ttl" parameter.


-Emile

From emile at rabbitmq.com  Wed Mar 14 10:57:59 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 10:57:59 +0000
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
 one machine
In-Reply-To: <CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
Message-ID: <4F6079B7.4050002@rabbitmq.com>

Hi Brian,

On 14/03/12 00:26, Brian Jing wrote:
> =INFO REPORT==== 14-Mar-2012::11:05:07 ===
> started TCP Listener on [::]:4446

Where does the config for this port number (4446) come from? Are you
sure the correct config file is being read during broker startup?  What
does the broker startup banner say?


-Emile

From jonas.colmsjo at gizur.com  Tue Mar 13 10:51:48 2012
From: jonas.colmsjo at gizur.com (Jonas Colmsjo)
Date: Tue, 13 Mar 2012 03:51:48 -0700 (PDT)
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
	<DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
	<24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>
Message-ID: <4151165.7256.1331635908896.JavaMail.geo-discussion-forums@vbbed8>

I figured out howto supply login credentials in python. This is the code to 
put in both send.py and receive.py (change user and password)

credentials = pika.PlainCredentials('test', 'test')
parameters = pika.ConnectionParameters(credentials=credentials)
connection = pika.BlockingConnection(parameters)

/BR
Jonas

Den tisdagen den 13:e mars 2012 kl. 11:34:49 UTC+1 skrev Jonas Colmsjo:
>
> Thank's for answering!
>
> The MQ server is running on a Amazon EC2 server. This is the server I try 
> to access both locally and remotely.
>
> How is authentication performed? I was hoping authentication wasn't needed 
> when running from localhost. Maybe this isn't true?
> I see in the administration console that I can add users...
>
> The result of the commands is listed here:
>
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
> [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970072},
>       {processes,4968776},
>       {processes_used,4959720},
>       {system,8001296},
>       {atom,737045},
>       {atom_used,727811},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
> ...done.
>
> root at rabbit-1:~# rabbitmqctl report
> Reporting server status on {{2012,3,13},{10,28,54}}
>
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
> [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970840},
>       {processes,4969696},
>       {processes_used,4960640},
>       {system,8001144},
>       {atom,737045},
>       {atom_used,727860},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
>
> Cluster status of node 'rabbit at rabbit-1' ...
> [{nodes,[{disc,['rabbit at rabbit-1']}]},{running_nodes,['rabbit at rabbit-1']}]
>
> Application environment of node 'rabbit at rabbit-1' ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,[]},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1.log"}},
>  {frame_max,131072},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>  {queue_index_max_journal_entries,262144},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1-sasl.log"}},
>  {server_properties,[]},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
>
> Connections:
>
> Channels:
>
> Queues on /:
>
> Exchanges on /:
> name type durable auto_delete internal arguments
> amq.rabbitmq.trace topic true false false []
> amq.rabbitmq.log topic true false false []
> amq.match headers true false false []
> amq.headers headers true false false []
> amq.topic topic true false false []
> amq.direct direct true false false []
> amq.fanout fanout true false false []
> direct true false false []
>
> Bindings on /:
>
> Consumers on /:
>
> Permissions on /:
> user configure write read
> scalr .* .* .*
>
> End of server status report
> ...done.
>
>
> Den m?ndagen den 12:e mars 2012 kl. 11:43:20 UTC+1 skrev Steve Powell:
>>
>> Hi Jonas,
>>
>> Instead of issuing 'rabbitmq-server status', please can you try issuing
>> 'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
>> running rabbit node.
>>
>> You say 'I've tried running the python code on both the local host (ubuntu
>> 10.04) and on osx.' but it would be quite useful to know a little more 
>> about
>> your setup. Are you trying to access the same server in both cases?
>>
>> Steve Powell  (a loppy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>>
>> On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:
>>
>> > I've copied the send.py and receive.py in the Hellow World tutorial and 
>> keep getting time out errors.I've tried running the python code on both the 
>> local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and 
>> running and I can login to the management console.
>> > 
>> > Any help is greatly appreciated!
>> > 
>> > root at rabbit-1:~/tmp# rabbitmq-server status
>> > Activating RabbitMQ plugins ...
>> > 
>> > 
>> ********************************************************************************
>> > 
>> ********************************************************************************
>> > 
>> > 6 plugins activated:
>> > * amqp_client-2.7.1
>> > * mochiweb-1.3-rmq2.7.1-git
>> > * rabbitmq_management-2.7.1
>> > * rabbitmq_management_agent-2.7.1
>> > * rabbitmq_mochiweb-2.7.1
>> > * webmachine-1.7.0-rmq2.7.1-hg
>> > 
>> > node with name "rabbit" already running on "rabbit-1"
>> > diagnostics:
>> > - nodes and their ports on rabbit-1: [{rabbit,39652},
>> >                                       {rabbitmqprelaunch17299,33245}]
>> > - current node: 'rabbitmqprelaunch17299 at rabbit-1'
>> > - current node home dir: /var/lib/rabbitmq
>> > - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
>> > 
>> > --- ERROR ---
>> > 
>> > root at rabbit-1:~/tmp# sudo python send.py
>> > Traceback (most recent call last):
>> >   File "send.py", line 5, in <module>
>> >     host='localhost'))
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
>> line 32, in __init__
>> >     BaseConnection.__init__(self, parameters, None, 
>> reconnection_strategy)
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
>> line 50, in __init__
>> >     reconnection_strategy)
>> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
>> line 170, in __init__
>> >     self._connect()
>> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
>> line 228, in _connect
>> >     self.parameters.port or  spec.PORT)
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
>> line 44, in _adapter_connect
>> >     self._handle_read()
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
>> line 151, in _handle_read
>> >     data = self.socket.recv(self._suggested_buffer_size)
>> > socket.timeout: timed out
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/7e27346e/attachment.htm>

From jonas.colmsjo at gizur.com  Tue Mar 13 10:51:48 2012
From: jonas.colmsjo at gizur.com (Jonas Colmsjo)
Date: Tue, 13 Mar 2012 03:51:48 -0700 (PDT)
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
	<DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
	<24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>
Message-ID: <4151165.7256.1331635908896.JavaMail.geo-discussion-forums@vbbed8>

I figured out howto supply login credentials in python. This is the code to 
put in both send.py and receive.py (change user and password)

credentials = pika.PlainCredentials('test', 'test')
parameters = pika.ConnectionParameters(credentials=credentials)
connection = pika.BlockingConnection(parameters)

/BR
Jonas

Den tisdagen den 13:e mars 2012 kl. 11:34:49 UTC+1 skrev Jonas Colmsjo:
>
> Thank's for answering!
>
> The MQ server is running on a Amazon EC2 server. This is the server I try 
> to access both locally and remotely.
>
> How is authentication performed? I was hoping authentication wasn't needed 
> when running from localhost. Maybe this isn't true?
> I see in the administration console that I can add users...
>
> The result of the commands is listed here:
>
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
> [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970072},
>       {processes,4968776},
>       {processes_used,4959720},
>       {system,8001296},
>       {atom,737045},
>       {atom_used,727811},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
> ...done.
>
> root at rabbit-1:~# rabbitmqctl report
> Reporting server status on {{2012,3,13},{10,28,54}}
>
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] 
> [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970840},
>       {processes,4969696},
>       {processes_used,4960640},
>       {system,8001144},
>       {atom,737045},
>       {atom_used,727860},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
>
> Cluster status of node 'rabbit at rabbit-1' ...
> [{nodes,[{disc,['rabbit at rabbit-1']}]},{running_nodes,['rabbit at rabbit-1']}]
>
> Application environment of node 'rabbit at rabbit-1' ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,[]},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1.log"}},
>  {frame_max,131072},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>  {queue_index_max_journal_entries,262144},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1-sasl.log"}},
>  {server_properties,[]},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
>
> Connections:
>
> Channels:
>
> Queues on /:
>
> Exchanges on /:
> name type durable auto_delete internal arguments
> amq.rabbitmq.trace topic true false false []
> amq.rabbitmq.log topic true false false []
> amq.match headers true false false []
> amq.headers headers true false false []
> amq.topic topic true false false []
> amq.direct direct true false false []
> amq.fanout fanout true false false []
> direct true false false []
>
> Bindings on /:
>
> Consumers on /:
>
> Permissions on /:
> user configure write read
> scalr .* .* .*
>
> End of server status report
> ...done.
>
>
> Den m?ndagen den 12:e mars 2012 kl. 11:43:20 UTC+1 skrev Steve Powell:
>>
>> Hi Jonas,
>>
>> Instead of issuing 'rabbitmq-server status', please can you try issuing
>> 'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
>> running rabbit node.
>>
>> You say 'I've tried running the python code on both the local host (ubuntu
>> 10.04) and on osx.' but it would be quite useful to know a little more 
>> about
>> your setup. Are you trying to access the same server in both cases?
>>
>> Steve Powell  (a loppy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>>
>> On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:
>>
>> > I've copied the send.py and receive.py in the Hellow World tutorial and 
>> keep getting time out errors.I've tried running the python code on both the 
>> local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and 
>> running and I can login to the management console.
>> > 
>> > Any help is greatly appreciated!
>> > 
>> > root at rabbit-1:~/tmp# rabbitmq-server status
>> > Activating RabbitMQ plugins ...
>> > 
>> > 
>> ********************************************************************************
>> > 
>> ********************************************************************************
>> > 
>> > 6 plugins activated:
>> > * amqp_client-2.7.1
>> > * mochiweb-1.3-rmq2.7.1-git
>> > * rabbitmq_management-2.7.1
>> > * rabbitmq_management_agent-2.7.1
>> > * rabbitmq_mochiweb-2.7.1
>> > * webmachine-1.7.0-rmq2.7.1-hg
>> > 
>> > node with name "rabbit" already running on "rabbit-1"
>> > diagnostics:
>> > - nodes and their ports on rabbit-1: [{rabbit,39652},
>> >                                       {rabbitmqprelaunch17299,33245}]
>> > - current node: 'rabbitmqprelaunch17299 at rabbit-1'
>> > - current node home dir: /var/lib/rabbitmq
>> > - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
>> > 
>> > --- ERROR ---
>> > 
>> > root at rabbit-1:~/tmp# sudo python send.py
>> > Traceback (most recent call last):
>> >   File "send.py", line 5, in <module>
>> >     host='localhost'))
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
>> line 32, in __init__
>> >     BaseConnection.__init__(self, parameters, None, 
>> reconnection_strategy)
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
>> line 50, in __init__
>> >     reconnection_strategy)
>> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
>> line 170, in __init__
>> >     self._connect()
>> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
>> line 228, in _connect
>> >     self.parameters.port or  spec.PORT)
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
>> line 44, in _adapter_connect
>> >     self._handle_read()
>> >   File 
>> "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
>> line 151, in _handle_read
>> >     data = self.socket.recv(self._suggested_buffer_size)
>> > socket.timeout: timed out
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/7e27346e/attachment-0001.htm>

From lowlifi at gmail.com  Tue Mar 13 23:03:13 2012
From: lowlifi at gmail.com (E Raymond)
Date: Tue, 13 Mar 2012 16:03:13 -0700 (PDT)
Subject: [rabbitmq-discuss] MCollective + RabbitMQ + LDAP authentication
	issues
In-Reply-To: <4F58A0D4.2090807@rabbitmq.com>
References: <08978fa6-9a11-4829-9a31-9c4630a1741c@qb4g2000pbb.googlegroups.com>
	<4F54EA14.2090409@rabbitmq.com>
	<6bd29fb5-5eaa-4971-95e5-6fd0a2591a25@sv8g2000pbc.googlegroups.com>
	<4F58A0D4.2090807@rabbitmq.com>
Message-ID: <cf3f7b39-6ff9-43b2-9848-afeaefca7b17@z5g2000pbu.googlegroups.com>

This was exactly what I was looking for. Thanks for your help!

On Mar 8, 5:06?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 05/03/12 20:07, E Raymond wrote:
>
> > Hi Simon,
>
> > Thanks for the help! I realize the problem now, and wonder if there is
> > an in between solution to this?
>
> > I only want to authenticate the user through LDAP. I feel adding
> > vhosts to OU's seems like a bulky solution, and would prefer to allow
> > specific authenticated users to have to access to a specified vhost,
> > and allow the resources to dictate what privileges they have.
>
> > Is this possible?
>
> What do you mean by "specified vhost"? Specified by static config or by
> the LDAP server or something else? In the first case, something like
>
> {vhost_access_query, {match, {string, "${vhost}"}, {string, "/"}}}
>
> should work. In the second, an exists query as above is probably what
> you want.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Mar 14 11:32:08 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 11:32:08 +0000
Subject: [rabbitmq-discuss] Connection attempt from disallowed node
	question
In-Reply-To: <CAAzMEC=RNZWD_i4w2Uau9mPE0ddCnZVG8ev6Hoh=McUYNct6RA@mail.gmail.com>
References: <CAAzMEC=RNZWD_i4w2Uau9mPE0ddCnZVG8ev6Hoh=McUYNct6RA@mail.gmail.com>
Message-ID: <4F6081B8.3040405@rabbitmq.com>

Hi Derek,

On 13/03/12 22:22, Derek Greer wrote:
>  =ERROR REPORT==== 13-Mar-2012::15:00:15 ===
> 110 ** Connection attempt from disallowed node rabbitmqctl32476@[machine
> name] **
> 
> Everything I've read about this says this is due to the erlang cookie of
> the user executing the rabbitmqctl.bat command not matching the global
> erlang cookie in C:\Windows, so I've had the admin check these values
> and he claims they are the exact same.  The RabbitMQ service is running
> as the default system account which doesn't have a home directory, so I
> assume the service runs the process with the cookie from C:\Windows.

Yes, this error is due to mismatched cookie files between the running
service and the user running the rabbitmqctl.bat command.

If the service runs in an environment with a HOMEDRIVE and HOMEPATH
variable then the GetWindowsDirectory Windows API function is used to
locate the Erlang cookie file. The cookie file in the Windows directory
must match the cookie file in the home directory of the user running the
rabbitmqctl command, as explained here:

http://www.rabbitmq.com/install-windows-manual.html#find-rabbitmq-on-windows

You can obtain the hash of the cookie by turning on console logging (set
RABBITMQ_CONSOLE_LOG to new or reuse) and checking the line starting
with "cookie hash    :".

There are some Erlang configuration parameters that are able override
the cookie value. Ensure that the startup scripts and rabbitmq.config
files have not been customised in this way.

If the Erlang VM does not find a cookie file then one will be created
with random contents. Make sure that the contents of the cookie files
were not auto-filled when starting up.



-Emile

From simon at rabbitmq.com  Wed Mar 14 11:40:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 11:40:06 +0000
Subject: [rabbitmq-discuss] SSL connection errors once or twice every
 week
In-Reply-To: <CALD4NQYmTvK+96DLxBrkjMek4TbYF4=mLNY86FaEqwt16XxsOg@mail.gmail.com>
References: <CALD4NQYmAzEm=aMam0DF+TRMOkoWa1JGcJRpwunqZ39QvvscSQ@mail.gmail.com>	<4F549D3B.4050306@rabbitmq.com>	<CALD4NQZc+9D7N=dWmpgfvdpkT-8=+WngZBCRu3QQttpWJSEn-Q@mail.gmail.com>	<4F55EE76.2000206@rabbitmq.com>	<4F55F8BA.2050303@rabbitmq.com>	<CALD4NQb0GPhT7DOnOUgPAoU3eVdgHPiSDnanm5K2xcoPR6G_=w@mail.gmail.com>	<4F58A2AA.30007@rabbitmq.com>
	<CALD4NQYmTvK+96DLxBrkjMek4TbYF4=mLNY86FaEqwt16XxsOg@mail.gmail.com>
Message-ID: <4F608396.9090601@rabbitmq.com>

On 14/03/12 00:31, Brian Jing wrote:
> We are currently using non-ssl ports, and only one-way federation in our
> system. It seems that the whole thing is more stable now. However, the
> hanging still happened last weekend. Is there anything from our end that
> could help you pinpoint what the problem is? Logs or coredumps?

For the record, symmetric federation should work fine, it's just 
inefficient with bandwidth (this will change).

Does anything interesting appear in the logs when you try to restart and 
it hangs? Or at any other time?

Earlier in the thread we saw ehostunreach errors on running connections 
- i.e. a host we had a working TCP connection to stopped being routable. 
I'm not even sure how that would happen - is there anything unusual in 
your network that would explain it?

Also, do you have heartbeats turned on?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 14 11:51:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 11:51:16 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
Message-ID: <4F608634.1080104@rabbitmq.com>

Hi John,

On 12/03/12 19:21, John Stoner wrote:
> Error: unable to connect to node 'rabbit at rabbitmq-small02-dev':
> nodedown
> diagnostics:
> - nodes and their ports on rabbitmq-small02-dev: [{rabbit,57641},

Does the RabbitMQ logfile on rabbitmq-small02-dev contain an entry about
a connection attempt from a disallowed node at this time?

> I stop the server:
> [jstoner at rabbitmq-small02-dev]> service rabbitmq-server stop
> Stopping rabbitmq-server: RabbitMQ is not running
> rabbitmq-server.

Subsequent commands indicate that RabbitMQ was still running after this
command was issued. Check if you have any processes running starting
with "beam". Subsequent steps won't make any difference until you
succeed in restarting the broker. Kill the process if necessary.

> {rabbitmqctl12928,46801}]
> - current node: 'rabbitmqctl12928 at rabbitmq-small02-dev'
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: [hashtext]

What is [hashtext] ? Does it match the other node?


Also check the EC2-specific instructions at
http://www.rabbitmq.com/ec2.html
paying close attention to the section on hostnames.


-Emile

From emile at rabbitmq.com  Wed Mar 14 11:58:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 11:58:01 +0000
Subject: [rabbitmq-discuss] Connection attempt from disallowed node
	question
In-Reply-To: <4F6081B8.3040405@rabbitmq.com>
References: <CAAzMEC=RNZWD_i4w2Uau9mPE0ddCnZVG8ev6Hoh=McUYNct6RA@mail.gmail.com>
	<4F6081B8.3040405@rabbitmq.com>
Message-ID: <4F6087C9.5070402@rabbitmq.com>

Hi Derek,

On 14/03/12 11:32, Emile Joubert wrote:
> You can obtain the hash of the cookie by turning on console logging (set
> RABBITMQ_CONSOLE_LOG to new or reuse) and checking the line starting
> with "cookie hash    :".

On 14/03/12 11:51, Derek Greer wrote:
> The cookie files are the same between the user and the Windows
> directory cookie. I'm assuming this means the service process somehow
> couldn't locate the windows cookie file?  How do I see the logs for
> the installed service?

See the instructions at these links

http://www.rabbitmq.com/install-windows-manual.html
http://www.rabbitmq.com/man/rabbitmq-service.man.html

for how to set RABBITMQ_CONSOLE_LOG and obtain the startup banner. This
will provide the cookie hash of the running broker. You can compare this
value with the error messages from rabbitmqctl.bat to confirm whether
the cookie values are indeed the same.


-Emile

From emile at rabbitmq.com  Wed Mar 14 12:19:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 12:19:15 +0000
Subject: [rabbitmq-discuss] bug report?
In-Reply-To: <CAAXXezYaDWKNEA-+zEiXFvNwhgmO4kC25uC09y23wPkYnbJyng@mail.gmail.com>
References: <CAAXXezaYkoqdA-09Q81Cp4VPA3ursNrtAC3a2eveDOvB_h3AXQ@mail.gmail.com>
	<CAAXXezYaDWKNEA-+zEiXFvNwhgmO4kC25uC09y23wPkYnbJyng@mail.gmail.com>
Message-ID: <4F608CC3.7010006@rabbitmq.com>

Hi Michael,

On 13/03/12 14:25, Michael Lam wrote:
> If in case this mailing list is the bug report (I saw a 2008 thread to
> this effect), here's the bug:

Yes please, we invite bug reports on this mailing list.

> In the 2.7.1 Java client library, RpcClient.java
> 
> RpcClient.stringCall does not encode the message in UTF-8 as it's
> expected by StringRpcServer.handleCall, resulting in corrupted message
> received by the server if the message contains non-ASCII characters.
> 
> Fix is quite easy:

I see what you meant. There is a lack of symmetry between the getBytes()
methods used in RpcClient and StringRpcServer.

Thanks for reporting this and for your suggested solution. I will make
sure this receives attention.


-Emile

From amathur.q at gmail.com  Wed Mar 14 12:20:40 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Wed, 14 Mar 2012 17:50:40 +0530
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+u4LE7zUcqd+RaxbQDEeqQo_0H+tj9S_Mq57kQCTEi7hs1ZMA@mail.gmail.com>

Hi,

-> Is it possible to use both ActiveMQ broker and RabbitMQ broker in the
same application/project? I want to send some messages using ActiveMQ/JMS
and some using RabbitMQ/AMQP(please don't ask why!!).
I tried using both ..but my application keeps giving a JMS exception .Is it
possible for ActiveMQ broker to interact/listen to a RabbitMQ broker and
vice-versa(i guess using  a bridge of some sort)? if yes,then how do we
build the bridge between the two?

->how can we define JAVA beans for
connection,template,connection-factory,message-senders,message-listener
using XML,so that we need not define connection,connection-factory in every
listener/sender we create.? is the following correct way of defining  a
Rabbit Template:

code-
<bean id="rabbitTemplate"
class="org.springframework.amqp.rabbit.core.RabbitTemplate"/>
    <property>name="connectionFactory"
ref="rabbitConnectionFactory"</property>
     </bean>

Thanks in advance.
Ashutosh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/77517104/attachment.htm>

From stavr.chris at gmail.com  Wed Mar 14 12:31:42 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Wed, 14 Mar 2012 14:31:42 +0200
Subject: [rabbitmq-discuss] Puka client and publisher confirms performance
Message-ID: <4F608FAE.9060608@gmail.com>

Hi,

I am using Puka client [1] in order to send messages with guaranteed 
delivery using publisher confirms.

Trying to send 200.000 messages I see that waiting for the confirms, 
takes a lot of time.

To be more specific:

     promises = []
     t0 = time.time()
     for i in range(0,200000):
         promise = client.basic_publish(exchange='test_exchange', 
routing_key='test',
                                                               
body="Hello world!")
         promises.append(promise)

     t1 = time.time()
client.wait(promises)
     t2 = time.time()
     promise = client.close()
     client.wait(promise)

In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
Increasing the number of messages results in even worse performance.

Can anyone explain this behavior ? Is there a more effective way to use 
publisher confirms ?

Chris


[1]: https://github.com/majek/puka
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/dea2baf9/attachment.htm>

From lars.ellebo at schneider-electric.com  Wed Mar 14 12:37:23 2012
From: lars.ellebo at schneider-electric.com (Lars Ellebo)
Date: Wed, 14 Mar 2012 05:37:23 -0700 (PDT)
Subject: [rabbitmq-discuss]  Why is SSL working without any Certificate?
Message-ID: <33501602.post@talk.nabble.com>


Hi

I have enabled SSL on port 5671 on my RabbiMQ Server,
and I have enabled SSL on my Client using the "factory.useSslProtocol()"
statement,
and it seems to be working fine!

This actually surprises me because I have not installed any certificate on
my RabbitMQ Server yet.

Why does SSL work without any installed certificate?
Is my AMQP traffic really encrypted in this situation?

/Lars

-- 
View this message in context: http://old.nabble.com/Why-is-SSL-working-without-any-Certificate--tp33501602p33501602.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From pbell at syncsort.com  Wed Mar 14 12:59:26 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 14 Mar 2012 08:59:26 -0400
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>

Guys,

I fell asleep last night thinking about my reply to Jerry and Simone, only to find several others had weighed in on this issue.

In re flow control in general: Simone, yeah "flow control" is exactly the right way to characterize the problem. I am a bit familiar with the prefetch value when dealing with messages inbound to a consumer, but found no analog in the other direction.

In re use of the HTTP API: Jerry, I completely agree that such an approach, while tempting, really does violate the "information hiding" aspect of decoupled producers and consumers. That said, can you say more about how you understand the difference between "monitoring the system" and using the HTTP API to "keep a track on the queue depths?"

In re use of queue_declare: zmstone, thank you for this. Do you happen to know if this is available via Spring AMQP or is it only available via the Java or .NET AMQP clients?

In re use of credits: Davorin, can you say more about this? This is the first time I've heard of "credits" in the context of AMQP. (Hmm...now that I think of it, I'm not even sure which version of AMQP RabbitMQ is an implementation of).

In re mismatched rates of production/consumption: Emile, no this is not a permanent feature. I consider it a pathological and anomalous state. But it may happen. What is your recommended way for a producer who is writing to an exchange to monitor the length of a queue on "the other side" of the exchange? Also, is "x-message-ttl" accessible by means of Spring AMQP?

On a related matter, please consider the case where the consumers simply aren't there (i.e., it's not that they're slow, they're simply NOT). Yet the long-running producers continue to publish to the exchange. Assume that we're dealing with a non-durable topic exchange. Am I right in thinking that, absent any bindings, the broker will simply discard incoming messages?

Thank you all.

-Paul






-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Tuesday, March 13, 2012 7:01 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi, Paul:  You could use the management HTTP API to keep a track on
queue depths and then have your producer dynamically adjust its 
behavior if it notices that consumption isn't keeping up, but you
should really think about whether this is something you want to do.

It ends up building a lot of of hand holding awareness of the messaging
mechanics into your endpoint applications, which in some ways goes against
the spirit of using a messaging service in between your producers and
consumers in the first place.  You might be better off monitoring the
system, and spinning up additional consumers to drain especially busy 
queues than building the sort of logic you describe...

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 13, 2012 3:26:15 PM
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi All,

What are the Rabbit "best practices" ways of handling a situation where the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am trying to understand the best ways to throttle the producer in such a case. Assume that neither queue nor its topic exchange are durable.

Can producer obtain information about the state of the queue, e.g., the number of unACKed messages, its size in bytes or number of messages, etc? Or is another approach indicated?

Thanks very much.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Wed Mar 14 13:04:54 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 14 Mar 2012 13:04:54 +0000
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com><48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210D2F2@GSVCLU03.ges.ferlan.it>

In re to your last question, regardless of the exchange type and whether the exchange is durable or not messages with no destination are always discarded (although I think a dead letter mechanism is appearing soon)

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bell, Paul M.
Sent: mercoled? 14 marzo 2012 13:59
To: Jerry Kuch; Simone Busoli; zmstone at gmail.com; davorin.rusevljan at gmail.com; Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Guys,

I fell asleep last night thinking about my reply to Jerry and Simone, only to find several others had weighed in on this issue.

In re flow control in general: Simone, yeah "flow control" is exactly the right way to characterize the problem. I am a bit familiar with the prefetch value when dealing with messages inbound to a consumer, but found no analog in the other direction.

In re use of the HTTP API: Jerry, I completely agree that such an approach, while tempting, really does violate the "information hiding" aspect of decoupled producers and consumers. That said, can you say more about how you understand the difference between "monitoring the system" and using the HTTP API to "keep a track on the queue depths?"

In re use of queue_declare: zmstone, thank you for this. Do you happen to know if this is available via Spring AMQP or is it only available via the Java or .NET AMQP clients?

In re use of credits: Davorin, can you say more about this? This is the first time I've heard of "credits" in the context of AMQP. (Hmm...now that I think of it, I'm not even sure which version of AMQP RabbitMQ is an implementation of).

In re mismatched rates of production/consumption: Emile, no this is not a permanent feature. I consider it a pathological and anomalous state. But it may happen. What is your recommended way for a producer who is writing to an exchange to monitor the length of a queue on "the other side" of the exchange? Also, is "x-message-ttl" accessible by means of Spring AMQP?

On a related matter, please consider the case where the consumers simply aren't there (i.e., it's not that they're slow, they're simply NOT). Yet the long-running producers continue to publish to the exchange. Assume that we're dealing with a non-durable topic exchange. Am I right in thinking that, absent any bindings, the broker will simply discard incoming messages?

Thank you all.

-Paul






-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com]
Sent: Tuesday, March 13, 2012 7:01 PM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi, Paul:  You could use the management HTTP API to keep a track on queue depths and then have your producer dynamically adjust its behavior if it notices that consumption isn't keeping up, but you should really think about whether this is something you want to do.

It ends up building a lot of of hand holding awareness of the messaging mechanics into your endpoint applications, which in some ways goes against the spirit of using a messaging service in between your producers and consumers in the first place.  You might be better off monitoring the system, and spinning up additional consumers to drain especially busy queues than building the sort of logic you describe...

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 13, 2012 3:26:15 PM
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi All,

What are the Rabbit "best practices" ways of handling a situation where the consumer is v-e-r-y slow and the producer is super-fast. IOW: I am trying to understand the best ways to throttle the producer in such a case. Assume that neither queue nor its topic exchange are durable.

Can producer obtain information about the state of the queue, e.g., the number of unACKed messages, its size in bytes or number of messages, etc? Or is another approach indicated?

Thanks very much.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From simon at rabbitmq.com  Wed Mar 14 13:09:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 13:09:58 +0000
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210D2F2@GSVCLU03.ges.ferlan.it>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com><48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
	<88E590DC4586974D825FC82AE798294E5210D2F2@GSVCLU03.ges.ferlan.it>
Message-ID: <4F6098A6.3010400@rabbitmq.com>

On 14/03/12 13:04, Busoli, Simone wrote:
> In re to your last question, regardless of the exchange type and
> whether the exchange is durable or not messages with no destination
> are always discarded (although I think a dead letter mechanism is
> appearing soon)

Yes. Although the new dead letter mechanism has nothing to do with it; 
that will allow you to reroute messages which get rejected, or expired 
from a *queue*.

If you want to save "unrouted" messages that are sent to an exchange, 
you can do that today (or indeed two years ago) - use the "alternate 
exchange" feature to route messages to another exchange that always has 
a queue bound to it.

http://www.rabbitmq.com/extensions.html#alternate-exchange

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Mar 14 13:14:12 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Mar 2012 13:14:12 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <4F608FAE.9060608@gmail.com>
References: <4F608FAE.9060608@gmail.com>
Message-ID: <CABzX+qySDN0foiff86v_PYm_H4D5dfqQK7y7seydQV23G94BYg@mail.gmail.com>

On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
<stavr.chris at gmail.com> wrote:
> I am using Puka client [1] in order to send messages with guaranteed
> delivery using publisher confirms.
>
> Trying to send 200.000 messages I see that waiting for the confirms, takes a
> lot of time.
>
> To be more specific:
>
> ??? promises = []
> ??? t0 = time.time()
> ??? for i in range(0,200000):
> ??? ??? promise = client.basic_publish(exchange='test_exchange',
> routing_key='test',
> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
> world!")
> ??? ??? promises.append(promise)
>
> ??? t1 = time.time()
> ??? client.wait(promises)
> ??? t2 = time.time()
> ??? promise = client.close()
> ??? client.wait(promise)
>
> In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
> Increasing the number of messages results in even worse performance.
>
> Can anyone explain this behavior ? Is there a more effective way to use
> publisher confirms ?

Chris,

It's very cool that you found Puka useful!

Puka does some magic under the hood to track publisher confirms.

First, do make sure you're using publiser confirms, please
add pubacks=True parameter to the Client:

   https://github.com/majek/puka/blob/master/puka/connection.py#L24

(or make sure otherwise that you are using pubacks, there
 should be a property on the client object somewhere....)

Second, here's what I'm doing for performance in the stress_amqp.py example:
https://github.com/majek/puka/blob/master/examples/stress_amqp.py#L54-57

Basically, I'm just making sure the last message went through. This
should give you a reasonable confidence that previous messages
also were delivered.

Finally, it would be nice to identify what is the performance bottleneck
for the code snippet you supplied. It is possible that there's a stupid
performance issue within Puka.

Cheers,
  Marek

From majek04 at gmail.com  Wed Mar 14 13:16:11 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Mar 2012 13:16:11 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CABzX+qySDN0foiff86v_PYm_H4D5dfqQK7y7seydQV23G94BYg@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qySDN0foiff86v_PYm_H4D5dfqQK7y7seydQV23G94BYg@mail.gmail.com>
Message-ID: <CABzX+qxkCNeuw1qCOrGe6ontcLWkOST3nXvkhcrkLK8a1eorQA@mail.gmail.com>

On Wed, Mar 14, 2012 at 13:14, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
> <stavr.chris at gmail.com> wrote:
>> I am using Puka client [1] in order to send messages with guaranteed
>> delivery using publisher confirms.
>>
>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>> lot of time.
>>
>> To be more specific:
>>
>> ??? promises = []
>> ??? t0 = time.time()
>> ??? for i in range(0,200000):
>> ??? ??? promise = client.basic_publish(exchange='test_exchange',
>> routing_key='test',
>> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
>> world!")
>> ??? ??? promises.append(promise)
>>
>> ??? t1 = time.time()
>> ??? client.wait(promises)
>> ??? t2 = time.time()
>> ??? promise = client.close()
>> ??? client.wait(promise)
>>
>> In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
>> Increasing the number of messages results in even worse performance.
>>
>> Can anyone explain this behavior ? Is there a more effective way to use
>> publisher confirms ?

Right, to the point:
 - first part of code adds messages to the write buffer - no network activity
 - second part of the code - wait for replies from rabbit
   (there may be some cpu cost for managing a big number of promises,
    within Puka library, this is TBD)

Marek

From emile at rabbitmq.com  Wed Mar 14 13:18:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 13:18:49 +0000
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
Message-ID: <4F609AB9.6020203@rabbitmq.com>

Hi Paul,

On 14/03/12 12:59, Bell, Paul M. wrote:
> Also, is "x-message-ttl" accessible
> by means of Spring AMQP?

Yes, these are simply queue arguments. Spring AMQP allows you to declare
queues with arguments.

> On a related matter, please consider the case where the consumers
> simply aren't there (i.e., it's not that they're slow, they're simply
> NOT). Yet the long-running producers continue to publish to the
> exchange. Assume that we're dealing with a non-durable topic
> exchange. Am I right in thinking that, absent any bindings, the
> broker will simply discard incoming messages?

Yes, by default such messages will be discarded.

You can have such messages sent to an alternative exchange by using the
"alternative exchange" extension:
http://www.rabbitmq.com/extensions.html#alternate-exchange

Also see the "mandatory" publish argument:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory
Publishers can have messages returned if they could not be routed.



-Emile


From emile at rabbitmq.com  Wed Mar 14 13:24:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 13:24:51 +0000
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <CAOn7oW_Xqo83LYAM=P=hvms0rBKOmi6Wb8s2wtHa+d3iSgy24Q@mail.gmail.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>
	<8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
	<3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>
	<001201cd0098$e6b0d530$b4127f90$@oryo.lt>
	<CAOn7oW_Xqo83LYAM=P=hvms0rBKOmi6Wb8s2wtHa+d3iSgy24Q@mail.gmail.com>
Message-ID: <4F609C23.5010100@rabbitmq.com>

Hi,

On 12/03/12 22:28, Simone Busoli wrote:
> I've been using the compiled sources for some time now without any
> issues, but you can also find the unofficial 2.7.9 release which I guess
> includes the fixes.

Yes I can confirm the fix for this bug will be included in release
2.8.0. Until then you can build from source:
http://www.rabbitmq.com/build-dotnet-client.html
or access the pre-release.


-Emile

From simon at rabbitmq.com  Wed Mar 14 13:29:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 13:29:50 +0000
Subject: [rabbitmq-discuss] Inconsistent queue synchronization behavior
In-Reply-To: <CB850D3D.3295D%mpietrek@skytap.com>
References: <CB850D3D.3295D%mpietrek@skytap.com>
Message-ID: <4F609D4E.7000009@rabbitmq.com>

On 13/03/12 21:42, Matt Pietrek wrote:
> some
> subset of the queues (varies from run to run) go back to "+2", while the
> remaining queues switch to "+1 +1", meaning 1 synched, and 1 unsynched.
>
> Given that there are no messages in the queue, I don't understand why
> some queues don't synch back up properly.

OK, given a bit of fiddling I have managed to recreate this. 
Congratulations, you just delayed the 2.8.0 release ;-)

> Also, I've looked at the sync status of the queues in rabbitmqctl, and
> the results seem consistent with what the HTTP API reports.

Hmm. In my recreation I don't see that - the data returned by 
rabbitmqctl reports is correct. Are you sure?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pbell at syncsort.com  Wed Mar 14 13:38:41 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 14 Mar 2012 09:38:41 -0400
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <4F609AB9.6020203@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
	<4F609AB9.6020203@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695252@MAILCCR.us.syncsort.com>

Emile,

Thanks for the x-message-ttl info.

A couple of questions about your prior e-mail where you said "queues may get very long and need to spill over to disk..."

1. Am I right to think that this "spill over" happens for non-durable exchanges and queues?
2. Is there a way to govern when that spill over occurs, e.g., when queue gets to a certain size, or is this auto-magically handled by Rabbit?

-Paul


-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Wednesday, March 14, 2012 9:19 AM
To: Bell, Paul M.
Cc: Jerry Kuch; Simone Busoli; zmstone at gmail.com; davorin.rusevljan at gmail.com; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi Paul,

On 14/03/12 12:59, Bell, Paul M. wrote:
> Also, is "x-message-ttl" accessible
> by means of Spring AMQP?

Yes, these are simply queue arguments. Spring AMQP allows you to declare
queues with arguments.

> On a related matter, please consider the case where the consumers
> simply aren't there (i.e., it's not that they're slow, they're simply
> NOT). Yet the long-running producers continue to publish to the
> exchange. Assume that we're dealing with a non-durable topic
> exchange. Am I right in thinking that, absent any bindings, the
> broker will simply discard incoming messages?

Yes, by default such messages will be discarded.

You can have such messages sent to an alternative exchange by using the
"alternative exchange" extension:
http://www.rabbitmq.com/extensions.html#alternate-exchange

Also see the "mandatory" publish argument:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory
Publishers can have messages returned if they could not be routed.



-Emile




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From lionel.cons at cern.ch  Wed Mar 14 13:42:42 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 14 Mar 2012 14:42:42 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F58F27B.5030209@rabbitmq.com> (Simon MacMullen's message of
	"Thu, 8 Mar 2012 17:55:07 +0000")
References: <4F58F27B.5030209@rabbitmq.com>
Message-ID: <bw7mx7j1ep9.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> Please, have a play with this and let us know if anything goes wrong
> for you...

I've tried to use X.509 authentication with STOMP but failed to get it
working.

When I try to connect, I get:

=ERROR REPORT==== 14-Mar-2012::14:40:16 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {badarg,
                           [{erlang,list_to_binary,[undefined]},
                            {rabbit_stomp_processor,login_header,3},
                            {rabbit_stomp_processor,creds,3},
                            {rabbit_stomp_processor,
                                '-process_connect/3-fun-0-',6},
                            {rabbit_stomp_processor,process_request,3},
                            {gen_server2,handle_msg,2},
                            {proc_lib,init_p_do_apply,3}]}

Do I miss something in the configuration file? I currently have what is
described there http://www.rabbitmq.com/stomp.html:

    {rabbitmq_stomp, [
        {default_user, []},
        {tcp_listeners, [61223]},
        {ssl_listeners, [61233]}
    ]}

If the certificate is not known, could the DN be logged so that I can
understand what exactly is incorrect?

Cheers,

Lionel

From stavr.chris at gmail.com  Wed Mar 14 13:45:51 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Wed, 14 Mar 2012 15:45:51 +0200
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
Message-ID: <4F60A10F.1080009@gmail.com>

On 03/14/2012 03:14 PM, Marek Majkowski wrote:

>  On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
>  <stavr.chris at gmail.com>   wrote:
>
>>  I am using Puka client [1] in order to send messages with guaranteed
>>  delivery using publisher confirms.
>>
>>  Trying to send 200.000 messages I see that waiting for the confirms, takes a
>>  lot of time.
>>
>>  To be more specific:
>>
>>       promises = []
>>       t0 = time.time()
>>       for i in range(0,200000):
>>           promise = client.basic_publish(exchange='test_exchange',
>>  routing_key='test',
>>                                                                 body="Hello
>>  world!")
>>           promises.append(promise)
>>
>>       t1 = time.time()
>>       client.wait(promises)
>>       t2 = time.time()
>>       promise = client.close()
>>       client.wait(promise)
>>
>>  In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
>>  Increasing the number of messages results in even worse performance.
>>
>>  Can anyone explain this behavior ? Is there a more effective way to use
>>  publisher confirms ?
>>
>  Chris,
>
>  It's very cool that you found Puka useful!
>
>
Puka is indeed a very practical and beautiful library. It also makes working
with publisher confirms very straightforward. I would recommend to
anyone who
wants a python client for RabbitMQ to give it a try!
>  Puka does some magic under the hood to track publisher confirms.
>
>  First, do make sure you're using publiser confirms, please
>  add pubacks=True parameter to the Client:
>
>      https://github.com/majek/puka/blob/master/puka/connection.py#L24
>
>  (or make sure otherwise that you are using pubacks, there
>    should be a property on the client object somewhere....)
>
>
Yes I am passing pubacks=True parameter to the client.
>  Second, here's what I'm doing for performance in the stress_amqp.py example:
>  https://github.com/majek/puka/blob/master/examples/stress_amqp.py#L54-57
>
>  Basically, I'm just making sure the last message went through. This
>  should give you a reasonable confidence that previous messages
>  also were delivered.
>
It is reasonable, but I believe that it is not guaranteed. Am i right? I
want to make sure that my messages are delivered, but without the penalty
of waiting an acknowledge for each message.

Does puka takes advantage of the multiple field in basic.acks ? If not,
maybe this could speed up the process!
>  Finally, it would be nice to identify what is the performance bottleneck
>  for the code snippet you supplied. It is possible that there's a stupid
>  performance issue within Puka.
>
>  Cheers,
>     Marek
>

Chris



From stavr.chris at gmail.com  Wed Mar 14 13:47:43 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Wed, 14 Mar 2012 15:47:43 +0200
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CABzX+qxkCNeuw1qCOrGe6ontcLWkOST3nXvkhcrkLK8a1eorQA@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>	<CABzX+qySDN0foiff86v_PYm_H4D5dfqQK7y7seydQV23G94BYg@mail.gmail.com>
	<CABzX+qxkCNeuw1qCOrGe6ontcLWkOST3nXvkhcrkLK8a1eorQA@mail.gmail.com>
Message-ID: <4F60A17F.50105@gmail.com>

On 03/14/2012 03:16 PM, Marek Majkowski wrote:
> On Wed, Mar 14, 2012 at 13:14, Marek Majkowski<majek04 at gmail.com>  wrote:
>    
>> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
>> <stavr.chris at gmail.com>  wrote:
>>      
>>> I am using Puka client [1] in order to send messages with guaranteed
>>> delivery using publisher confirms.
>>>
>>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>>> lot of time.
>>>
>>> To be more specific:
>>>
>>>      promises = []
>>>      t0 = time.time()
>>>      for i in range(0,200000):
>>>          promise = client.basic_publish(exchange='test_exchange',
>>> routing_key='test',
>>>                                                                body="Hello
>>> world!")
>>>          promises.append(promise)
>>>
>>>      t1 = time.time()
>>>      client.wait(promises)
>>>      t2 = time.time()
>>>      promise = client.close()
>>>      client.wait(promise)
>>>
>>> In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
>>> Increasing the number of messages results in even worse performance.
>>>
>>> Can anyone explain this behavior ? Is there a more effective way to use
>>> publisher confirms ?
>>>        
> Right, to the point:
>   - first part of code adds messages to the write buffer - no network activity
>   - second part of the code - wait for replies from rabbit
>     (there may be some cpu cost for managing a big number of promises,
>      within Puka library, this is TBD)
>
> Marek
>    

What is the limit for this buffer ? If understand correct he messages 
are actually sent only when you wait for the promises
or you close the connection. This means that if my connection to a 
server closes before start waiting for promises, I must resent all 
messages ?

Maybe periodically flushing the buffer could speed up things ?

Chris


From simon at rabbitmq.com  Wed Mar 14 13:57:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 13:57:28 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <bw7mx7j1ep9.fsf@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
Message-ID: <4F60A3C8.1080504@rabbitmq.com>

On 14/03/12 13:42, Lionel Cons wrote:
> Simon MacMullen<simon at rabbitmq.com>  writes:
>> Please, have a play with this and let us know if anything goes wrong
>> for you...
>
> I've tried to use X.509 authentication with STOMP but failed to get it
> working.

Unfortunately you can't see the 2.8.0 website :-(

You will need to set {ssl_cert_login, true} in your rabbitmq_stomp 
configuration and make sure the client does not send login and passcode 
headers.

> When I try to connect, I get:
>
> =ERROR REPORT==== 14-Mar-2012::14:40:16 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {badarg,
>                             [{erlang,list_to_binary,[undefined]},
>                              {rabbit_stomp_processor,login_header,3},
>                              {rabbit_stomp_processor,creds,3},
>                              {rabbit_stomp_processor,
>                                  '-process_connect/3-fun-0-',6},
>                              {rabbit_stomp_processor,process_request,3},
>                              {gen_server2,handle_msg,2},
>                              {proc_lib,init_p_do_apply,3}]}

But that's a rather nasty error message. I'll see what I can do about 
that...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 14 13:58:25 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 13:58:25 +0000
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695252@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695228@MAILCCR.us.syncsort.com>
	<48592fa1-27ac-4138-927e-837fdf121a4b@StrongMad.local>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
	<4F609AB9.6020203@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695252@MAILCCR.us.syncsort.com>
Message-ID: <4F60A401.8080708@rabbitmq.com>

Hi Paul,

On 14/03/12 13:38, Bell, Paul M. wrote:
> A couple of questions about your prior e-mail where you said "queues
> may get very long and need to spill over to disk..."
> 
> 1. Am I right to think that this "spill over" happens for non-durable
> exchanges and queues?

Exchanges store no message state.
The broker may decide to move message from RAM to disk even if the queue
was declared non-durable.

> 2. Is there a way to govern when that spill over occurs, e.g., when
> queue gets to a certain size, or is this auto-magically handled by
> Rabbit?

This happens automatically and depends on how fast the queue is moving
and the amount of free RAM, among others. You have some indirect control
in the shape of the vm_memory_high_watermark configuration parameter:

http://www.rabbitmq.com/configure.html



-Emile

From lionel.cons at cern.ch  Wed Mar 14 14:09:26 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 14 Mar 2012 15:09:26 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F60A3C8.1080504@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
Message-ID: <20320.42646.772214.890151@mail.cern.ch>

Simon MacMullen writes:
 > Unfortunately you can't see the 2.8.0 website :-(

Maybe it should be exposed to help people testing your pre-releases?

 > You will need to set {ssl_cert_login, true} in your rabbitmq_stomp 
 > configuration and make sure the client does not send login and passcode 
 > headers.

Done. I still get the same error :-(

My config:

    {rabbitmq_stomp, [
        {default_user, []},
        {ssl_cert_login, true},
        {tcp_listeners, [61223]},
        {ssl_listeners, [61233]}
    ]}

On startup I see:

=INFO REPORT==== 14-Mar-2012::15:02:44 ===
rabbit_stomp: ssl_cert_login enabled

=INFO REPORT==== 14-Mar-2012::15:02:44 ===
started STOMP SSL Listener on 0.0.0.0:61233

But then:

=INFO REPORT==== 14-Mar-2012::15:02:51 ===
accepting STOMP connection <0.359.0> (x.x.x.x:49267 -> x.x.x.:61233)

=ERROR REPORT==== 14-Mar-2012::15:02:51 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {badarg,
                           [{erlang,list_to_binary,[undefined]},
                            {rabbit_stomp_processor,login_header,3},
                            {rabbit_stomp_processor,creds,3},
                            {rabbit_stomp_processor,
                                '-process_connect/3-fun-0-',6},
                            {rabbit_stomp_processor,process_request,3},
                            {gen_server2,handle_msg,2},
                            {proc_lib,init_p_do_apply,3}]}

Any hint?

Cheers,

Lionel

From simon at rabbitmq.com  Wed Mar 14 14:25:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 14:25:33 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <20320.42646.772214.890151@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com>	<bw7mx7j1ep9.fsf@mail.cern.ch>	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
Message-ID: <4F60AA5D.1030907@rabbitmq.com>

On 14/03/12 14:09, Lionel Cons wrote:
> Maybe it should be exposed to help people testing your pre-releases?

Yes, just another thing for the TODO...

>   >  You will need to set {ssl_cert_login, true} in your rabbitmq_stomp
>   >  configuration and make sure the client does not send login and passcode
>   >  headers.
>
> Done. I still get the same error :-(
<snip>
> Any hint?

Damn, it looks like you need some default_user details defined for this 
to work. (They can be invalid credentials: they will not be used, they 
just need to exist.)

/me goes and kicks the stomp tests, again...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lars.ellebo at schneider-electric.com  Wed Mar 14 14:31:45 2012
From: lars.ellebo at schneider-electric.com (Lars Ellebo)
Date: Wed, 14 Mar 2012 07:31:45 -0700 (PDT)
Subject: [rabbitmq-discuss]  Cannot bind to SSL port below 1024
Message-ID: <33502421.post@talk.nabble.com>


Hi

Using the {ssl_listeners, [5671]} statement in the rabbitmq.config file I
would like to change the default SSL port 5671 to a port number below 1024.

But when doing so RabbitMQ refuses to start up.
Only when the SSL port number is higher than 1024 RabbitMQ will start up.

Is it somehow possible to bind the RabbitMQ SSL-listener to a port below
1204?

/Lars

-- 
View this message in context: http://old.nabble.com/Cannot-bind-to-SSL-port-below-1024-tp33502421p33502421.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Wed Mar 14 14:35:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 14:35:21 +0000
Subject: [rabbitmq-discuss] Cannot bind to SSL port below 1024
In-Reply-To: <33502421.post@talk.nabble.com>
References: <33502421.post@talk.nabble.com>
Message-ID: <4F60ACA9.7050301@rabbitmq.com>

On 14/03/12 14:31, Lars Ellebo wrote:
> Is it somehow possible to bind the RabbitMQ SSL-listener to a port below
> 1204?

Only by running it as root - this is a limitation imposed by the 
operating system (a faintly ridiculous historical accident IMHO but I 
don't have my own kernel yet).

So either run RabbitMQ as root (not a great idea) or use iptables to 
remap the port.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Mar 14 14:41:52 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Mar 2012 14:41:52 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <4F60A17F.50105@gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qySDN0foiff86v_PYm_H4D5dfqQK7y7seydQV23G94BYg@mail.gmail.com>
	<CABzX+qxkCNeuw1qCOrGe6ontcLWkOST3nXvkhcrkLK8a1eorQA@mail.gmail.com>
	<4F60A17F.50105@gmail.com>
Message-ID: <CABzX+qx+dFfOpyTqqfGYvr=ygDN5kuq2EGQfR3zpkUaAhkmrmw@mail.gmail.com>

>> Right, to the point:
>> ?- first part of code adds messages to the write buffer - no network
>> activity
>> ?- second part of the code - wait for replies from rabbit
>> ? ?(there may be some cpu cost for managing a big number of promises,
>> ? ? within Puka library, this is TBD)
>>
>> Marek
>>
>
>
> What is the limit for this buffer ? If understand correct he messages are
> actually sent only when you wait for the promises
> or you close the connection. This means that if my connection to a server
> closes before start waiting for promises, I must resent all messages ?

No, all things in puka are initially written to the write buffer.
(this is true for almost any networking library)

But, as opposed to other libs, Puka does flush (write to the socket)
the buffer only when you ask it to. This usually happens when
you call puka.wait() or you can do it when you're having an async
loop implemented by yourself.

You can force the buffer flush by calling puka.on_write()
https://github.com/majek/puka/blob/master/puka/connection.py#L148

But this is not usually necessary to call it outside of the event loop.

> Maybe periodically flushing the buffer could speed up things ?

You can call on_write every 100 messages or so and see if your
code gets faster (I doubt it, but maybe).


I don't know if the bottleneck in the code you posted is Puka,
networking layer in python or Rabbit.

Marek

From lionel.cons at cern.ch  Wed Mar 14 14:42:51 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 14 Mar 2012 15:42:51 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F60AA5D.1030907@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
Message-ID: <20320.44651.11407.44766@mail.cern.ch>

Simon MacMullen writes:
 > Damn, it looks like you need some default_user details defined for this 
 > to work. (They can be invalid credentials: they will not be used, they 
 > just need to exist.)

Indeed, adding a default_user seems to work. It would be nice if this
"hack" could be removed.

However, I've only progressed a tiny bit. I now get:

=ERROR REPORT==== 14-Mar-2012::15:37:22 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Authentication failure\n"
Server private detail: none

Which is normal since the certificate I've used is not known. However,
could the DN be logged in the "Server private detail" section please?

I remember some discussions about DN formats, quotes, escaping... and
I would like to know from RabbitMQ itself what it expects.

There was also the question of CN versus DN, is this configurable now?

Cheers,

Lionel

From simon at rabbitmq.com  Wed Mar 14 14:43:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 14:43:34 +0000
Subject: [rabbitmq-discuss] Why is SSL working without any Certificate?
In-Reply-To: <33501602.post@talk.nabble.com>
References: <33501602.post@talk.nabble.com>
Message-ID: <4F60AE96.6010108@rabbitmq.com>

On 14/03/12 12:37, Lars Ellebo wrote:
> I have enabled SSL on port 5671 on my RabbiMQ Server,
> and I have enabled SSL on my Client using the "factory.useSslProtocol()"
> statement,
> and it seems to be working fine!
>
> This actually surprises me because I have not installed any certificate on
> my RabbitMQ Server yet.
>
> Why does SSL work without any installed certificate?
> Is my AMQP traffic really encrypted in this situation?

Well I can't get this configuration to work.

RabbitMQ will start up with a broken SSL configuration, but as soon as 
you try to make an SSL connection it will fail.

So: are you sure you are *really* connecting to port 5671? What does 
mgmt / rabbitmqctl say? What if you put "{tcp_listeners, []}" in your 
configuration, to stop the non-ssl port from being opened?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jerryk at vmware.com  Wed Mar 14 14:59:17 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 14 Mar 2012 07:59:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695252@MAILCCR.us.syncsort.com>
Message-ID: <903c5407-33e4-4d28-9e36-718427683b91@StrongMad.local>

Hi Paul:

1. Yes, the spill-over happens regardless of your durability specifications.
Think of it as analogous to an OS with virtual memory and swapping, writing
pages to disk when physical RAM becomes precious:  You didn't ask for that
data to end up on disk, but it's being moved there temporarily due to need.
Note that this spilling of memory to disk is a RabbitMQ broker mechanism, not
an operating system one.

2. It's automatically handled by Rabbit, in response to the broker's memory
usage going above a configured fraction of the total memory available to the
Erlang VM.  That fraction, the "memory high watermark," can be adjusted in
your RabbitMQ configuration but generally one should trust the default.  If
it's set too low, messages may swap out to disk prematurely, and if it's set
too high, the mechanism may not engage until the broker is in significant
memory jeopardy.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Emile Joubert" <emile at rabbitmq.com>
Cc: "Jerry Kuch" <jerryk at vmware.com>, "Simone Busoli" <simone.busoli at gmail.com>, zmstone at gmail.com, "davorin rusevljan" <davorin.rusevljan at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, March 14, 2012 6:38:41 AM
Subject: RE: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Emile,

Thanks for the x-message-ttl info.

A couple of questions about your prior e-mail where you said "queues may get very long and need to spill over to disk..."

1. Am I right to think that this "spill over" happens for non-durable exchanges and queues?
2. Is there a way to govern when that spill over occurs, e.g., when queue gets to a certain size, or is this auto-magically handled by Rabbit?

-Paul


-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Wednesday, March 14, 2012 9:19 AM
To: Bell, Paul M.
Cc: Jerry Kuch; Simone Busoli; zmstone at gmail.com; davorin.rusevljan at gmail.com; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi Paul,

On 14/03/12 12:59, Bell, Paul M. wrote:
> Also, is "x-message-ttl" accessible
> by means of Spring AMQP?

Yes, these are simply queue arguments. Spring AMQP allows you to declare
queues with arguments.

> On a related matter, please consider the case where the consumers
> simply aren't there (i.e., it's not that they're slow, they're simply
> NOT). Yet the long-running producers continue to publish to the
> exchange. Assume that we're dealing with a non-durable topic
> exchange. Am I right in thinking that, absent any bindings, the
> broker will simply discard incoming messages?

Yes, by default such messages will be discarded.

You can have such messages sent to an alternative exchange by using the
"alternative exchange" extension:
http://www.rabbitmq.com/extensions.html#alternate-exchange

Also see the "mandatory" publish argument:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory
Publishers can have messages returned if they could not be routed.



-Emile




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From jerryk at vmware.com  Wed Mar 14 15:05:03 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 14 Mar 2012 08:05:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695243@MAILCCR.us.syncsort.com>
Message-ID: <38353450-96df-4ced-8f88-bd1f2093486c@StrongMad.local>

> In re use of the HTTP API: Jerry, I completely agree that such an
> approach, while tempting, really does violate the "information hiding"
> aspect of decoupled producers and consumers. That said, can you say
> more about how you understand the difference between "monitoring the
> system" and using the HTTP API to "keep a track on the queue depths?"

Sure.  In production, one presumably wants to have some kind of
monitoring or alerting system to provide health checks on important
parts of the infrastructure.  Using the RabbitMQ management HTTP API,
it's easy to write scripts that will integrate into Hyperic, or
Splunk, or the like, and keep track of things like broker resource
usage.  One is also wise to make the monitoring system aware of the
queues in your application so that unexpected situations like slow or
failed consumers can be caught and remedied in a timely fashion.

> In re mismatched rates of production/consumption: Emile, no this is
> not a permanent feature. I consider it a pathological and anomalous
> state. But it may happen. What is your recommended way for a producer
> who is writing to an exchange to monitor the length of a queue on "the
> other side" of the exchange?

There are some nice examples using the HTTP API in the book "RabbitMQ
in Action," currently available in pre-release from Manning, with the
print release to follow very soon.  This page provides a quick
summary, although the book elaborates on this quite a bit and includes
some nice example monitoring scripts and notes on integrating with Nagios:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html

Best regards,
Jerry

From pbell at syncsort.com  Wed Mar 14 15:05:21 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 14 Mar 2012 11:05:21 -0400
Subject: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer
In-Reply-To: <903c5407-33e4-4d28-9e36-718427683b91@StrongMad.local>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695252@MAILCCR.us.syncsort.com>
	<903c5407-33e4-4d28-9e36-718427683b91@StrongMad.local>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4169526C@MAILCCR.us.syncsort.com>

Understood; thanks.

-Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Wednesday, March 14, 2012 10:59 AM
To: Bell, Paul M.
Cc: Simone Busoli; zmstone at gmail.com; davorin rusevljan; rabbitmq-discuss at lists.rabbitmq.com; Emile Joubert
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi Paul:

1. Yes, the spill-over happens regardless of your durability specifications.
Think of it as analogous to an OS with virtual memory and swapping, writing
pages to disk when physical RAM becomes precious:  You didn't ask for that
data to end up on disk, but it's being moved there temporarily due to need.
Note that this spilling of memory to disk is a RabbitMQ broker mechanism, not
an operating system one.

2. It's automatically handled by Rabbit, in response to the broker's memory
usage going above a configured fraction of the total memory available to the
Erlang VM.  That fraction, the "memory high watermark," can be adjusted in
your RabbitMQ configuration but generally one should trust the default.  If
it's set too low, messages may swap out to disk prematurely, and if it's set
too high, the mechanism may not engage until the broker is in significant
memory jeopardy.

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Emile Joubert" <emile at rabbitmq.com>
Cc: "Jerry Kuch" <jerryk at vmware.com>, "Simone Busoli" <simone.busoli at gmail.com>, zmstone at gmail.com, "davorin rusevljan" <davorin.rusevljan at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, March 14, 2012 6:38:41 AM
Subject: RE: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Emile,

Thanks for the x-message-ttl info.

A couple of questions about your prior e-mail where you said "queues may get very long and need to spill over to disk..."

1. Am I right to think that this "spill over" happens for non-durable exchanges and queues?
2. Is there a way to govern when that spill over occurs, e.g., when queue gets to a certain size, or is this auto-magically handled by Rabbit?

-Paul


-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Wednesday, March 14, 2012 9:19 AM
To: Bell, Paul M.
Cc: Jerry Kuch; Simone Busoli; zmstone at gmail.com; davorin.rusevljan at gmail.com; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Throttling when Fast Producer, Slow Consumer

Hi Paul,

On 14/03/12 12:59, Bell, Paul M. wrote:
> Also, is "x-message-ttl" accessible
> by means of Spring AMQP?

Yes, these are simply queue arguments. Spring AMQP allows you to declare
queues with arguments.

> On a related matter, please consider the case where the consumers
> simply aren't there (i.e., it's not that they're slow, they're simply
> NOT). Yet the long-running producers continue to publish to the
> exchange. Assume that we're dealing with a non-durable topic
> exchange. Am I right in thinking that, absent any bindings, the
> broker will simply discard incoming messages?

Yes, by default such messages will be discarded.

You can have such messages sent to an alternative exchange by using the
"alternative exchange" extension:
http://www.rabbitmq.com/extensions.html#alternate-exchange

Also see the "mandatory" publish argument:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory
Publishers can have messages returned if they could not be routed.



-Emile




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From steve at rabbitmq.com  Wed Mar 14 15:10:10 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 14 Mar 2012 15:10:10 +0000
Subject: [rabbitmq-discuss] Possible bug when disposing connections
	in	.NET client 2.7.0/1
In-Reply-To: <001201cd0098$e6b0d530$b4127f90$@oryo.lt>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>	<8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
	<3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>
	<001201cd0098$e6b0d530$b4127f90$@oryo.lt>
Message-ID: <319CEB06-0045-4498-8AA8-C50FFA102D61@rabbitmq.com>

Yes, this bug is fixed (and is on the default branch) and will be in the next release.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 12 Mar 2012, at 21:41, Andrius Norkaitis wrote:

> Hello,
> 
> Any news about this bug? I get random exceptions (when client disconnects)
> when using heartbeat in .NET client 2.7.0/1 which was never a problem with
> earlier versions.
> 
> Cannot access a disposed object.
> Object name: 'System.Net.Sockets.Socket'.
> 
>   at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> optionLevel, SocketOptionName optionName, Object optionValue)
>   at System.Net.Sockets.TcpClient.set_LingerState(LingerOption value)
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>   at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>   at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatReadLoop()
>   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
>   at System.Threading.ExecutionContext.runTryCode(Object userData)
>   at
> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedClea
> nup(TryCode code, CleanupCode backoutCode, Object userData)
>   at System.Threading.ExecutionContext.RunInternal(ExecutionContext
> executionContext, ContextCallback callback, Object state)
>   at System.Threading.ExecutionContext.Run(ExecutionContext
> executionContext, ContextCallback callback, Object state)
>   at System.Threading.ThreadHelper.ThreadStart()
> 
> 
> Best regards,
> Andrius
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Steve
> Powell
> Sent: Friday, December 30, 2011 5:30 PM
> To: Dave Stevens
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Possible bug when disposing connections in
> .NET client 2.7.0/1
> 
> This really does look like a bug.  Thanks for spotting this.
> I'm raising a bugzilla (bug24650) to track it, and will report back.
> 
> Steve Powell  (a yule bunny)
> ----------some more definitions from the SPD---------- avoirdupois (phr.)
> 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
> 
> On 29 Dec 2011, at 22:16, Dave Stevens wrote:
> 
>> Yes, heartbeat is what is causing this. Version 2.7.1 of the .NET 
>> client is itself calling System.Net.Sockets.TcpClient.Close() 3 times 
>> per connection shutdown (4 if shutdown times out).
>> ConnectionBase.FinishClose() is called 3 different times when shutting 
>> down.See MainLoop(), HeartbeatReadLoop(), and HeartbeatWriteLoop() of 
>> ConnectionBase.cs lines 629, 566 and 538 respectively.
>> I am required to set the Heartbeat due to another issue where 
>> exclusive queues are not being removed at the broker when connections 
>> died. This prevents components from being able to restart with the 
>> same queue name.
>> See 
>> http://stackoverflow.com/questions/8296201/when-does-an-amqp-rabbitmq-
>> channel-with-no-connections-die/8299475
>> 
>> I believe that even with this, ConnectionBase.FinishClose() will be 
>> called once successfully which would allow the models to shutdown 
>> properly. I believe this is a bug though as FinishClose() should not 
>> be called more than once or it is possible that certain event handlers 
>> will be called more than once, Session.OnSessionShutdown specifically.
>> This may impact certain reconnect implementations.
>> 
>> On Dec 29, 4:38 pm, Simone Busoli <simone.bus... at gmail.com> wrote:
>>> What happens if you remove the heartbeat setting?
>>> On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>>> I get the same exception with this:
>>> 
>>>>        [Test(Description = "ObjectDispositionException")]
>>>>        public void TestFail()
>>>>        {
>>>>            var cf = new ConnectionFactory
>>>>                         {
>>>>                             HostName = "10.10.8.96",
>>>>                             Port = 5672,
>>>>                             RequestedHeartbeat = 2
>>>>                         };
>>>>            using (var connection = cf.CreateConnection())
>>>>            using (var model = connection.CreateModel())
>>>>            {
>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>            }
>>>>        }
>>> 
>>>> On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli 
>>>> <simone.bus... at gmail.com>
>>>> wrote:
>>> 
>>>>> Hi Dave, although counterintuitive the documentation of the .NET 
>>>>> client
>>>> states that explicitly. The connection closure/disposal is not 
>>>> idempotent, i.e. you shall not call it twice.
>>> 
>>>>> On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>>> 
>>>>>> I am getting the following exception when disposing a connection. 
>>>>>> I had previously noticed this when going from RabbitMQ Client 
>>>>>> 2.5.1 to
>>>>>> 2.7.0 which caused me to back out the update. I ended up going to
>>>>>> 2.7.1 because I thought I found a shutdown issue in my own code. 
>>>>>> The exception did not present itself again until I started testing 
>>>>>> some reconnect logic. I first noticed it again after simply 
>>>>>> pulling the plug on my network.
>>> 
>>>>>> System.ObjectDisposedException: Cannot access a disposed object.
>>>>>> Object name: 'System.Net.Sockets.Socket'.
>>>>>> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
>>>>>> optionLevel, SocketOptionName optionName, Object optionValue) at 
>>>>>> RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>>>>>> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>>>>>> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
>>>>>> at System.Threading.ThreadHelper.ThreadStart_Context(Object state) 
>>>>>> at System.Threading.ExecutionContext.runTryCode(Object userData) 
>>>>>> at
>>> 
>>>> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaran
>>>> teedCle anup(TryCode
>>>>>> code, CleanupCode backoutCode, Object userData) at 
>>>>>> System.Threading.ExecutionContext.RunInternal(ExecutionContext
>>>>>> executionContext, ContextCallback callback, Object state) at 
>>>>>> System.Threading.ExecutionContext.Run(ExecutionContext
>>>>>> executionContext, ContextCallback callback, Object state, Boolean
>>>>>> ignoreSyncCtx)
>>>>>> at System.Threading.ExecutionContext.Run(ExecutionContext
>>>>>> executionContext, ContextCallback callback, Object state) at 
>>>>>> System.Threading.ThreadHelper.ThreadStart()
>>> 
>>>>>> This code is reproducible consistently with the following:
>>> 
>>>>>> using System;
>>>>>> using System.Threading;
>>>>>> using NUnit.Framework;
>>>>>> using RabbitMQ.Client;
>>>>>> using RabbitMQ.Client.Framing.v0_9;
>>> 
>>>>>> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
>>>>>> {
>>>>>>   [TestFixture]
>>>>>>   public class TestingObjectDispositionException
>>>>>>   {
>>>>>>       [Test(Description = "ObjectDispositionException")]
>>>>>>       public void TestFail()
>>>>>>       {
>>>>>>           var cf = new ConnectionFactory
>>>>>>                        {
>>>>>>                            HostName = INSERT_IP_HERE,
>>>>>>                            Port = 5672,
>>>>>>                            RequestedHeartbeat = 2
>>>>>>                        };
>>>>>>           using (var connection = cf.CreateConnection())
>>>>>>           using (var model = connection.CreateModel())
>>>>>>           {
>>>>>>               Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>>               model.Close(Constants.ReplySuccess, "Goodbye");
>>>>>>               connection.Close(Constants.ReplySuccess, "Goodbye");
>>>>>>               Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>>           }
>>>>>>       }
>>>>>>   }
>>>>>> }
>>> 
>>>>>> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows 
>>>>>> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>>> 
>>>>>> Status of node rabbit at xxx ...
>>>>>> [{pid,1344},
>>>>>> {running_applications,
>>>>>>    [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
>>>>>>     {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
>>>>>>     {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
>>>>>>     {rabbit,"RabbitMQ","2.7.0"},
>>>>>>     {os_mon,"CPO  CXC 138 46","2.2.5"},
>>>>>>     {sasl,"SASL  CXC 138 11","2.1.9.3"},
>>>>>>     {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
>>>>>>     {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
>>>>>>     {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
>>>>>>     {inets,"INETS  CXC 138 49","5.5.2"},
>>>>>>     {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>>>>>>     {stdlib,"ERTS  CXC 138 10","1.17.3"},
>>>>>>     {kernel,"ERTS  CXC 138 10","2.14.3"}]},  {os,{unix,linux}},  
>>>>>> {erlang_version,
>>>>>>    "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8] 
>>>>>> [async-threads:30] [kernel-poll:true]\n"},  {memory,
>>>>>>    [{total,31177024},
>>>>>>     {processes,11828776},
>>>>>>     {processes_used,11772888},
>>>>>>     {system,19348248},
>>>>>>     {atom,1355273},
>>>>>>     {atom_used,1339382},
>>>>>>     {binary,84928},
>>>>>>     {code,14547474},
>>>>>>     {ets,1099944}]},
>>>>>> {vm_memory_high_watermark,0.39999999995232727},
>>>>>> {vm_memory_limit,5034326425}]
>>>>>> ...done.
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discu
>>>>>> ss
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin
>>> /mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/3e3bece6/attachment.htm>

From dbgreer at gmail.com  Wed Mar 14 15:17:37 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Wed, 14 Mar 2012 10:17:37 -0500
Subject: [rabbitmq-discuss] Connection attempt from disallowed node
	question
In-Reply-To: <4F6087C9.5070402@rabbitmq.com>
References: <CAAzMEC=RNZWD_i4w2Uau9mPE0ddCnZVG8ev6Hoh=McUYNct6RA@mail.gmail.com>
	<4F6081B8.3040405@rabbitmq.com> <4F6087C9.5070402@rabbitmq.com>
Message-ID: <CAAzMECmppCx_n4pEruS7PBXwsMNBxYp-uQKdPgYByi8X7b3+_Q@mail.gmail.com>

Thanks for the help.  I believe I have the problem resolved now.  What
seems to be the issue is that our network logins don't point to the local
user home directory.  This does raise another question, however.  On my
local machine, opening up the cmd.exe shell drops me in
C:\Users\[MyUserId]\ folder.  Within this folder, I have an .erlang.cookie
file that matches the C:\Windows\.erlang.cookie file.  The values for my
HOMEDIR and HOMEPATH variables are H: and \ respectively, and I found that
there was also a .erlang.cookie file in that folder as well that didn't
match.  At what point did each of these files get created?  I'm assuming
that the Erlang installer created a cookie in one of the folders while
running an erlang process for the first time user my user created the
other.  Could this be an issue with the installer perhaps?

Derek


On Wed, Mar 14, 2012 at 6:58 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Derek,
>
> On 14/03/12 11:32, Emile Joubert wrote:
> > You can obtain the hash of the cookie by turning on console logging (set
> > RABBITMQ_CONSOLE_LOG to new or reuse) and checking the line starting
> > with "cookie hash    :".
>
> On 14/03/12 11:51, Derek Greer wrote:
> > The cookie files are the same between the user and the Windows
> > directory cookie. I'm assuming this means the service process somehow
> > couldn't locate the windows cookie file?  How do I see the logs for
> > the installed service?
>
> See the instructions at these links
>
> http://www.rabbitmq.com/install-windows-manual.html
> http://www.rabbitmq.com/man/rabbitmq-service.man.html
>
> for how to set RABBITMQ_CONSOLE_LOG and obtain the startup banner. This
> will provide the cookie hash of the running broker. You can compare this
> value with the error messages from rabbitmqctl.bat to confirm whether
> the cookie values are indeed the same.
>
>
> -Emile
>



-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
freshbrewedcode.com <http://derekgreer.freshbrewedcode.com> |
lostechies.com<http://derekgreer.lostechies.com> |
aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/04331949/attachment.htm>

From emile at rabbitmq.com  Wed Mar 14 15:24:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Mar 2012 15:24:23 +0000
Subject: [rabbitmq-discuss] Cannot bind to SSL port below 1024
In-Reply-To: <33502421.post@talk.nabble.com>
References: <33502421.post@talk.nabble.com>
Message-ID: <4F60B827.5060505@rabbitmq.com>

Hi Lars,

On 14/03/12 14:31, Lars Ellebo wrote:
> Is it somehow possible to bind the RabbitMQ SSL-listener to a port below
> 1204?

Yes, you can freely use ports between 1024 and 1204  :-)

Your OS may offer a way of granting this privilege to non-root users for
lower port numbers too. The CAP_NET_BIND_SERVICE controls this on Linux.


-Emile

From steve at rabbitmq.com  Wed Mar 14 15:48:12 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 14 Mar 2012 15:48:12 +0000
Subject: [rabbitmq-discuss] Federation binding to a queue
In-Reply-To: <CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>
References: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
	<4F5DD509.40600@rabbitmq.com>
	<CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>
Message-ID: <FECFD82F-2ED2-4D22-AD76-56BD07AED56C@rabbitmq.com>

Timya,
On 12 Mar 2012, at 16:39, Timya Tortus wrote:
> Also in the 2.7.9 release note it is stated as;
> federation plugin:
> enhancements
> - allow the queue declared upstream to be mirrored
> 
> ? How to declare the queue on ServerRabbit and ClientRabbit, using the rabbitmq.config present on the ClientRabbit. 

This note in the 2.7.9 pre-release notes refers to the 'upstream queue'
which the federation plugin creates in order to copy messages from the
upstream exchange to the federated exchange. In the next release there
is a property in the connection configuration (in {rabbitmq_federation,
...}) to define the ha_policy for the upstream queue.

Any application queues you may declare can be configured in any way your
application desires, of course. They is no way to configure the creation
of application queues AFAIK.

Incidentally, I notice your pasted configuration says
{rabbit_federation, ...} instead of {rabbitmq_federation, ...}. I assume
this is a typo.

Hope this helps.

Steve Powell  (a hopey bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.



From steve at rabbitmq.com  Wed Mar 14 16:07:49 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 14 Mar 2012 16:07:49 +0000
Subject: [rabbitmq-discuss] timeout error in Hello world tutorial send.py
In-Reply-To: <4151165.7256.1331635908896.JavaMail.geo-discussion-forums@vbbed8>
References: <15369061.590.1331148635993.JavaMail.geo-discussion-forums@vbfl9>
	<DA136436-88D0-4938-B13B-CC52A13DCB02@rabbitmq.com>
	<24567683.1699.1331634889664.JavaMail.geo-discussion-forums@vbue17>
	<4151165.7256.1331635908896.JavaMail.geo-discussion-forums@vbbed8>
Message-ID: <C8BE7567-2A15-4EDF-93B5-9FA6D5B50B54@rabbitmq.com>

Jonas,

I'm glad you've moved forward. From the output you showed us I don't
think the plugins you originally reported are running (of course, you
attempted to run rabbitmq-server again then).

If you are still having problems, can you let us know what your rabbit
configuration file contains and what the startup.log shows?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 13 Mar 2012, at 10:51, Jonas Colmsjo wrote:

> I figured out howto supply login credentials in python. This is the code to put in both send.py and receive.py (change user and password)
> 
> credentials = pika.PlainCredentials('test', 'test')
> parameters = pika.ConnectionParameters(credentials=credentials)
> connection = pika.BlockingConnection(parameters)
> 
> /BR
> Jonas
> 
> Den tisdagen den 13:e mars 2012 kl. 11:34:49 UTC+1 skrev Jonas Colmsjo:
> Thank's for answering!
> 
> The MQ server is running on a Amazon EC2 server. This is the server I try to access both locally and remotely.
> 
> How is authentication performed? I was hoping authentication wasn't needed when running from localhost. Maybe this isn't true?
> I see in the administration console that I can add users...
> 
> The result of the commands is listed here:
> 
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970072},
>       {processes,4968776},
>       {processes_used,4959720},
>       {system,8001296},
>       {atom,737045},
>       {atom_used,727811},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
> ...done.
> 
> root at rabbit-1:~# rabbitmqctl report
> Reporting server status on {{2012,3,13},{10,28,54}}
> 
> Status of node 'rabbit at rabbit-1' ...
> [{pid,1450},
>  {running_applications,
>      [{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R13B03 (erts-5.7.4) [source] [rq:1] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>  {memory,
>      [{total,12970840},
>       {processes,4969696},
>       {processes_used,4960640},
>       {system,8001144},
>       {atom,737045},
>       {atom_used,727860},
>       {binary,62256},
>       {code,6077475},
>       {ets,377668}]},
>  {vm_memory_high_watermark,0.3999999997777084},
>  {vm_memory_limit,719775334}]
> 
> Cluster status of node 'rabbit at rabbit-1' ...
> [{nodes,[{disc,['rabbit at rabbit-1']}]},{running_nodes,['rabbit at rabbit-1']}]
> 
> Application environment of node 'rabbit at rabbit-1' ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,[]},
>  {collect_statistics,fine},
>  {collect_statistics_interval,5000},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {default_user,<<"guest">>},
>  {default_user_tags,[administrator]},
>  {default_vhost,<<"/">>},
>  {delegate_count,16},
>  {error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1.log"}},
>  {frame_max,131072},
>  {hipe_compile,false},
>  {included_applications,[]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>  {queue_index_max_journal_entries,262144},
>  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at rabbit-1-sasl.log"}},
>  {server_properties,[]},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
> 
> Connections:
> 
> Channels:
> 
> Queues on /:
> 
> Exchanges on /:
> name	type	durable	auto_delete	internal	arguments
> amq.rabbitmq.trace	topic	true	false	false	[]
> amq.rabbitmq.log	topic	true	false	false	[]
> amq.match	headers	true	false	false	[]
> amq.headers	headers	true	false	false	[]
> amq.topic	topic	true	false	false	[]
> amq.direct	direct	true	false	false	[]
> amq.fanout	fanout	true	false	false	[]
> 	direct	true	false	false	[]
> 
> Bindings on /:
> 
> Consumers on /:
> 
> Permissions on /:
> user	configure	write	read
> scalr	.*	.*	.*
> 
> End of server status report
> ...done.
> 
> 
> Den m?ndagen den 12:e mars 2012 kl. 11:43:20 UTC+1 skrev Steve Powell:
> Hi Jonas,
> Instead of issuing 'rabbitmq-server status', please can you try issuing
> 'rabbitmqctl status', or 'rabbitmqctl report' to get information about the
> running rabbit node.
> 
> You say 'I've tried running the python code on both the local host (ubuntu
> 10.04) and on osx.' but it would be quite useful to know a little more about
> your setup. Are you trying to access the same server in both cases?
> 
> Steve Powell  (a loppy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 7 Mar 2012, at 19:30, Jonas Colmsjo wrote:
> 
> > I've copied the send.py and receive.py in the Hellow World tutorial and keep getting time out errors.I've tried running the python code on both the local host (ubuntu 10.04) and on osx. The Rabbit server seams to be up and running and I can login to the management console.
> > 
> > Any help is greatly appreciated!
> > 
> > root at rabbit-1:~/tmp# rabbitmq-server status
> > Activating RabbitMQ plugins ...
> > 
> > ********************************************************************************
> > ********************************************************************************
> > 
> > 6 plugins activated:
> > * amqp_client-2.7.1
> > * mochiweb-1.3-rmq2.7.1-git
> > * rabbitmq_management-2.7.1
> > * rabbitmq_management_agent-2.7.1
> > * rabbitmq_mochiweb-2.7.1
> > * webmachine-1.7.0-rmq2.7.1-hg
> > 
> > node with name "rabbit" already running on "rabbit-1"
> > diagnostics:
> > - nodes and their ports on rabbit-1: [{rabbit,39652},
> >                                       {rabbitmqprelaunch17299,33245}]
> > - current node: 'rabbitmqprelaunch17299 at rabbit-1'
> > - current node home dir: /var/lib/rabbitmq
> > - current node cookie hash: QtJhQHUnJDOWPtTEH/uY/g==
> > 
> > --- ERROR ---
> > 
> > root at rabbit-1:~/tmp# sudo python send.py
> > Traceback (most recent call last):
> >   File "send.py", line 5, in <module>
> >     host='localhost'))
> >   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", line 32, in __init__
> >     BaseConnection.__init__(self, parameters, None, reconnection_strategy)
> >   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", line 50, in __init__
> >     reconnection_strategy)
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 170, in __init__
> >     self._connect()
> >   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 228, in _connect
> >     self.parameters.port or  spec.PORT)
> >   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", line 44, in _adapter_connect
> >     self._handle_read()
> >   File "/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", line 151, in _handle_read
> >     data = self.socket.recv(self._suggested_buffer_size)
> > socket.timeout: timed out
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mpietrek at skytap.com  Wed Mar 14 16:48:57 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 14 Mar 2012 09:48:57 -0700
Subject: [rabbitmq-discuss] Inconsistent queue synchronization behavior
In-Reply-To: <4F609D4E.7000009@rabbitmq.com>
References: <CB850D3D.3295D%mpietrek@skytap.com>
	<4F609D4E.7000009@rabbitmq.com>
Message-ID: <CACLE7ixM_P7Kr8V6XWS13iYEwt80=KxYTzCT=2+rYF502aHbMQ@mail.gmail.com>

> the data returned by rabbitmqctl reports is correct. Are you sure?

I'm working on reproing that exact scenario. However, I did uncover another
related inconsistency just now.

Starting from the original scenario (3 mirrored brokers, stop 1 of them),
the Node column in the "Queues" tab shows "+1" (as expected) for four of my
five queues.

However, one queue continues to show "+2". When hovering over it, the two
nodes listed include the broker node that I shut down. The "Overview" tab
confirms that this broker is indeed shut down.

As for the rabbitmqctl results, this time they *do* seem correct, i.e.

*rabbitmqctl list_queues name slave_pids synchronised_slave_pids*

indicates that all queues have exactly one mirror.



On Wed, Mar 14, 2012 at 6:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/03/12 21:42, Matt Pietrek wrote:
>
>> some
>> subset of the queues (varies from run to run) go back to "+2", while the
>> remaining queues switch to "+1 +1", meaning 1 synched, and 1 unsynched.
>>
>> Given that there are no messages in the queue, I don't understand why
>> some queues don't synch back up properly.
>>
>
> OK, given a bit of fiddling I have managed to recreate this.
> Congratulations, you just delayed the 2.8.0 release ;-)
>
>
>  Also, I've looked at the sync status of the queues in rabbitmqctl, and
>> the results seem consistent with what the HTTP API reports.
>>
>
> Hmm. In my recreation I don't see that - the data returned by rabbitmqctl
> reports is correct. Are you sure?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/5eb60251/attachment.htm>

From mpietrek at skytap.com  Wed Mar 14 17:06:21 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 14 Mar 2012 10:06:21 -0700
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7iz_KL2UYjWxXZbH6vsJqg6Ex9fO42JaLw6+0jgRoB8Chw@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
	<4F462871.4070602@rabbitmq.com>
	<CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>
	<4F4780FE.1060609@rabbitmq.com>
	<CACLE7iwzkasgaJ96RhRQ4jp1QL2kKF2ab8-PJHj=O3YPw9JWnA@mail.gmail.com>
	<CACLE7iz_KL2UYjWxXZbH6vsJqg6Ex9fO42JaLw6+0jgRoB8Chw@mail.gmail.com>
Message-ID: <CACLE7ixge+gpjkNpTq4BmniL9yAQ_TguU4qEoGhM+a_FMPk0Ow@mail.gmail.com>

Following up on this, I've gone back and looked at all the logs I can think
of.

On the node that hangs (stuck on "starting database   ..."), here's the
console output:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.7.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at play
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /home/mpietrek
config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
cookie hash    : pR5H9kY3Wra/XdLELT5hgQ==
log            : /home/mpietrek/work/logs/
play.mpietrek.internal.illumita.com/rabbit at play.log
sasl log       : /home/mpietrek/work/logs/
play.mpietrek.internal.illumita.com/rabbit at play-sasl.log
database dir   : /home/mpietrek/work/var/lib/rabbit at play
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database


And this is the last output in the log file:

=INFO REPORT==== 14-Mar-2012::09:50:33 ===
Limiting to approx 924 file handles (829 sockets)


On the node that's the master (labeled "disc stats" in the Overview tab),
there's nothing in the log about the new node joining.

Is there anyplace else I should be looking for clues to assist you? This
issue is a pretty big spanner in the works for our rolling upgrade scenario.

Thanks much,

Matt

On Tue, Mar 13, 2012 at 3:00 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Some other work came up so I needed to drop this thread for a few weeks.
> However, coming back to it, I can easily reproduce this issue within one or
> two tries.
>
> In a nutshell, in a clustered environment, simply stop one node, wait a
> few seconds, then restart it. The last output seen is:
>
> starting database
>                                ...
>
> I've let it wait for much longer than 30 seconds and it has never come
> back.
>
> Any chance this may have been stamped out in RabbitMQ 2.8?
>
>
>
> On Fri, Feb 24, 2012 at 1:43 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> | So how long are you waiting when determining it's hanging? Less than 30
>> seconds?
>>
>> Just to be double sure, I let it sit for an hour yesterday. I would have
>> expected a timeout, but it never came.
>>
>> It's a pretty easy scenario to script and try out. I'd send you my code,
>> but it relies on other internal commands.
>>
>> There may also be a timing issue. If I put a 10 second delay after
>> restarting one broker, and before stopping the next, it seems to help.
>>
>> That is:
>>
>> for x in broker_list:
>>     stop x
>>     start x
>>     sleep(10)
>>
>> Matt
>>
>>
>> On Fri, Feb 24, 2012 at 4:22 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>>
>>> On 23/02/12 21:00, Matt Pietrek wrote:
>>>
>>>> The nohup.out on the failing node ends with:
>>>>
>>>
>>> <snip>
>>>
>>>  starting database
>>>> ...
>>>>
>>>
>>> So how long are you waiting when determining it's hanging? Less than 30
>>> seconds?
>>>
>>> Because that looks like Rabbit is waiting for another cluster node (if
>>> it was not the last to shut down, but is the first to start up, it will
>>> wait for the one that was the last to shut down. But it will only wait for
>>> 30 seconds before spitting out an error. I'm not sure how else you could
>>> get it to stop there *without* any further output though.
>>>
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/592e18bb/attachment.htm>

From simon at rabbitmq.com  Wed Mar 14 17:58:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Mar 2012 17:58:52 +0000
Subject: [rabbitmq-discuss] Inconsistent queue synchronization behavior
In-Reply-To: <CACLE7ixM_P7Kr8V6XWS13iYEwt80=KxYTzCT=2+rYF502aHbMQ@mail.gmail.com>
References: <CB850D3D.3295D%mpietrek@skytap.com>	<4F609D4E.7000009@rabbitmq.com>
	<CACLE7ixM_P7Kr8V6XWS13iYEwt80=KxYTzCT=2+rYF502aHbMQ@mail.gmail.com>
Message-ID: <4F60DC5C.8020502@rabbitmq.com>

On 14/03/12 16:48, Matt Pietrek wrote:
>  > the data returned by rabbitmqctl reports is correct. Are you sure?
>
> I'm working on reproing that exact scenario. However, I did uncover
> another related inconsistency just now.

<snip>

This sounds like the same issue. Thanks for the additional information.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Mar 14 18:42:40 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Mar 2012 18:42:40 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <4F608FAE.9060608@gmail.com>
References: <4F608FAE.9060608@gmail.com>
Message-ID: <CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>

On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
<stavr.chris at gmail.com> wrote:
> I am using Puka client [1] in order to send messages with guaranteed
> delivery using publisher confirms.
>
> Trying to send 200.000 messages I see that waiting for the confirms, takes a
> lot of time.
>
> To be more specific:
>
> ??? promises = []
> ??? t0 = time.time()
> ??? for i in range(0,200000):
> ??? ??? promise = client.basic_publish(exchange='test_exchange',
> routing_key='test',
> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
> world!")
> ??? ??? promises.append(promise)
>
> ??? t1 = time.time()
> ??? client.wait(promises)

Right. This waits for _any_ promise to finish. So that doesn't guarantee
that all the messages will be delivered to the server.

If you want to wait for all the promises consider using wait_for_all.

> ??? t2 = time.time()
> ??? promise = client.close()
> ??? client.wait(promise)
>
> In this example t1-t0 is arround 9s while t2-t1 is more than 100 seconds!!
> Increasing the number of messages results in even worse performance.
>
> Can anyone explain this behavior ? Is there a more effective way to use
> publisher confirms ?

Right. Sending 100k messages to an empty exchange (no bindings):
For  client.wait(promises[-1]):
buffering:  4.14369106293
waiting:  3.26472091675
closing:  0.0569450855255

For client.wait_for_all(promises):
buffering:  4.61279606819
waiting:  4.67923402786
closing:  0.0479018688202

For client.wait(promises) (ie: waiting for first message to be delivered):
buffering:  4.18469595909
waiting:  0.0100059509277
closing:  3.30765604973

But, when we start sending to a queue that exists:
For  client.wait(promises[-1]):
buffering:  4.18939805031
waiting:  91.0133070946
closing:  0.150832891464

For some reason this gets really slow. Additionally, it looks like Puka is using
a lot of CPU. Not sure why.

Marek

From majek04 at gmail.com  Wed Mar 14 18:59:37 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Mar 2012 18:59:37 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
Message-ID: <CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>

On Wed, Mar 14, 2012 at 18:42, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
> <stavr.chris at gmail.com> wrote:
>> I am using Puka client [1] in order to send messages with guaranteed
>> delivery using publisher confirms.
>>
>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>> lot of time.
>>
>> To be more specific:
>>
>> ??? promises = []
>> ??? t0 = time.time()
>> ??? for i in range(0,200000):
>> ??? ??? promise = client.basic_publish(exchange='test_exchange',
>> routing_key='test',
>> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
>> world!")
>> ??? ??? promises.append(promise)
>>

Right, there is a performance problem with handling pubacks. The complexity
grows with n^2 of unacked messages

Good news: the problem is in this line:
   https://github.com/majek/puka/blob/master/puka/machine.py#L147-148

Bad news: I have no clue how to fix it.

I've rised an issue on github:
   https://github.com/majek/puka/issues/12

Marek

From james.r.carr at gmail.com  Wed Mar 14 19:57:54 2012
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 14 Mar 2012 14:57:54 -0500
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F60AA5D.1030907@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
Message-ID: <CAJreXKAK53pi-OuSuqmfeAgDzK8LH==43qN6-Az-sGaw1J8WwA@mail.gmail.com>

This is perfect... I just setup three clusters that will be federated
amongst each other for experimentation and discovered I needed
x-ha-policy queues. This release has support for that! :)

I just upgraded all 9 boxes and will be setting up my test runs soon,
I'll let you know how it goes. :)

Thanks,
James


On Wed, Mar 14, 2012 at 9:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 14/03/12 14:09, Lionel Cons wrote:
>>
>> Maybe it should be exposed to help people testing your pre-releases?
>
>
> Yes, just another thing for the TODO...
>
>
>> ?> ?You will need to set {ssl_cert_login, true} in your rabbitmq_stomp
>> ?> ?configuration and make sure the client does not send login and
>> passcode
>> ?> ?headers.
>>
>> Done. I still get the same error :-(
>
> <snip>
>>
>> Any hint?
>
>
> Damn, it looks like you need some default_user details defined for this to
> work. (They can be invalid credentials: they will not be used, they just
> need to exist.)
>
> /me goes and kicks the stomp tests, again...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Wed Mar 14 20:34:34 2012
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 14 Mar 2012 15:34:34 -0500
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
Message-ID: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>

Hi All,

I've been wondering what the "right" setup is to federate between
clusters. Do I just setup each node in the cluster to federate with
the upstream through the load balancer? My fear here is I'll end up
with with all the nodes on one cluster connected to a single node
(through the load balancer) and hence 3 sepeare queues causing
messages to be duplicated three times! :)

Thanks,
James

From mpietrek at skytap.com  Wed Mar 14 20:40:10 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 14 Mar 2012 13:40:10 -0700
Subject: [rabbitmq-discuss] Pika 0.9.5 KeyError: Tx.SelectOk
Message-ID: <CB86503A.32BBD%mpietrek@skytap.com>

I'm experiencing a KeyError exception, where the key is "Tx.SelectOk" when
using Pika 0.9.5.

The scenario: A simple program that simply writes two messages a second to a
queue. While this test is running, I stop the broker, then restart it a few
seconds later. I explicitly check for AMQPConnectionError exceptions, and if
seen reconnect to the broker. About half the time, the test works as
intended. However, other times I see the KeyError exception, which my guess
is not what's intended.

My writing code looks like this:
            try:
                channel = self._channel
                channel.tx_select()
                channel.basic_publish(exchange='',
                    routing_key=queue_name,
                    body=json_string,
                    properties=pika.BasicProperties(delivery_mode=2))
                channel.tx_commit()
                return
            except AMQPConnectionError as e:
                self._reconnect()

Digging into the traceback data, the faulting line is in Pika's
blocking_connection.py:rpc()

        # Find our reply in our list of replies
        for reply in self._replies:
            if reply in replies:
                frame = self._frames[reply] # THIS HERE IS THE LINE
                self._received_response = True
                if callback:
                    callback(frame)
                del(self._frames[reply])
                return frame

Known issue? Expected and acceptable? Thoughts?

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/5229e21f/attachment.htm>

From gmr at myyearbook.com  Wed Mar 14 20:52:47 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 14 Mar 2012 16:52:47 -0400
Subject: [rabbitmq-discuss] Pika 0.9.5 KeyError: Tx.SelectOk
In-Reply-To: <CB86503A.32BBD%mpietrek@skytap.com>
References: <CB86503A.32BBD%mpietrek@skytap.com>
Message-ID: <995BAAEAB9324B6A9A109E37B5D3E4B0@myyearbook.com>

Hi Matt, 

I'll have to go back through and look at the fixed bugs. I know I've applied a fair amount of fixes to BlockingConnection, I'd not be surprised if this was one of them. There is a known blocker in Github master right now, but I expect to see 0.9.6 drop "real soon"

Feel free to check the issues list at http://github.com/pika/pika

Gavin 


On Wednesday, March 14, 2012 at 4:40 PM, Matt Pietrek wrote:

> I'm experiencing a KeyError exception, where the key is "Tx.SelectOk" when using Pika 0.9.5.
> 
> The scenario: A simple program that simply writes two messages a second to a queue. While this test is running, I stop the broker, then restart it a few seconds later. I explicitly check for AMQPConnectionError exceptions, and if seen reconnect to the broker. About half the time, the test works as intended. However, other times I see the KeyError exception, which my guess is not what's intended.
> 
> My writing code looks like this:
>             try:
>                 channel = self._channel
>                 channel.tx_select()
>                 channel.basic_publish(exchange='',
>                     routing_key=queue_name,
>                     body=json_string,
>                     properties=pika.BasicProperties(delivery_mode=2))
>                 channel.tx_commit()
>                 return
>             except AMQPConnectionError as e:
>                 self._reconnect()
> 
> 
> 
> Digging into the traceback data, the faulting line is in Pika's blocking_connection.py:rpc()
> 
>         # Find our reply in our list of replies
>         for reply in self._replies:
>             if reply in replies:
>                 frame = self._frames[reply] # THIS HERE IS THE LINE
>                 self._received_response = True
>                 if callback:
>                     callback(frame)
>                 del(self._frames[reply])
>                 return frame
> 
> 
> Known issue? Expected and acceptable? Thoughts?
> 
> Thanks,
> 
> Matt 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/5a72d7f4/attachment.htm>

From mpietrek at skytap.com  Wed Mar 14 22:34:13 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 14 Mar 2012 15:34:13 -0700
Subject: [rabbitmq-discuss] Pika 0.9.5 KeyError: Tx.SelectOk
In-Reply-To: <995BAAEAB9324B6A9A109E37B5D3E4B0@myyearbook.com>
References: <CB86503A.32BBD%mpietrek@skytap.com>
	<995BAAEAB9324B6A9A109E37B5D3E4B0@myyearbook.com>
Message-ID: <CACLE7iwzq=2R2TRT7ptzoZDq8conR8P8L3YdOHGz08_70u3YOg@mail.gmail.com>

Cool, and thanks. Just wanted to make sure you knew about it in case it
hadn't been seen before.

Matt

On Wed, Mar 14, 2012 at 1:52 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>  Hi Matt,
>
> I'll have to go back through and look at the fixed bugs. I know I've
> applied a fair amount of fixes to BlockingConnection, I'd not be surprised
> if this was one of them. There is a known blocker in Github master right
> now, but I expect to see 0.9.6 drop "real soon"
>
> Feel free to check the issues list at http://github.com/pika/pika
>
> Gavin
>
> On Wednesday, March 14, 2012 at 4:40 PM, Matt Pietrek wrote:
>
> I'm experiencing a KeyError exception, where the key is "Tx.SelectOk" when
> using Pika 0.9.5.
>
> The scenario: A simple program that simply writes two messages a second to
> a queue. While this test is running, I stop the broker, then restart it a
> few seconds later. I explicitly check for AMQPConnectionError exceptions,
> and if seen reconnect to the broker. About half the time, the test works as
> intended. However, other times I see the KeyError exception, which my guess
> is not what's intended.
>
> My writing code looks like this:
>             try:
>                 channel = self._channel
>                 channel.tx_select()
>                 channel.basic_publish(exchange='',
>                     routing_key=queue_name,
>                     body=json_string,
>                     properties=pika.BasicProperties(delivery_mode=2))
>                 channel.tx_commit()
>                 return
>             except AMQPConnectionError as e:
>                 self._reconnect()
>
> Digging into the traceback data, the faulting line is in
> Pika's blocking_connection.py:rpc()
>
>         # Find our reply in our list of replies
>         for reply in self._replies:
>             if reply in replies:
> *                frame = self._frames[reply] # THIS HERE IS THE LINE*
>                 self._received_response = True
>                 if callback:
>                     callback(frame)
>                 del(self._frames[reply])
>                 return frame
>
> Known issue? Expected and acceptable? Thoughts?
>
> Thanks,
>
> Matt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/7e360ea7/attachment.htm>

From brian.newsgroup at gmail.com  Thu Mar 15 00:08:09 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Thu, 15 Mar 2012 11:08:09 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
	one machine
In-Reply-To: <4F6079B7.4050002@rabbitmq.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
	<4F6079B7.4050002@rabbitmq.com>
Message-ID: <CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>

Hi Emile,

On Wed, Mar 14, 2012 at 9:57 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Brian,
>
> On 14/03/12 00:26, Brian Jing wrote:
> > =INFO REPORT==== 14-Mar-2012::11:05:07 ===
> > started TCP Listener on [::]:4446
>
> Where does the config for this port number (4446) come from?


This comes from the NODE_PORT variable defined in the environment config
file. since the existing 1.8.0 already uses 5672 as the default port,  I
need a different port to be able to run this second instance of rabbitmq on
the same machine. Does this make sense?


> Are you
> sure the correct config file is being read during broker startup?  What
> does the broker startup banner say?
>
> I'm pretty sure that the correct config files are being used. I changed
the default env config file from /etc/rabbitmq/rabbitmq-env.conf to
/etc/rabbitmq/rabbitmq_env.conf before I rebuilt the source (only thing I
changed in the source). I know this env config file is being used because
rabbitmq 2.7.1 generates separate log files for the SERVICENAME I specified
and rabbitmq 2.7.1 listens to the port I specified in the env file as well.

The content of my rabbitmq_env.conf is as follows:

# cat /etc/rabbitmq/rabbitmq_env.conf
SERVICENAME=RabbitMQ-new
NODENAME=rabbit-new@$HOSTNAME
NODE_PORT=4446
CONFIG_FILE=/etc/rabbitmq/rabbitmq-2.7.1.config

Content of my new rabbitmq.conf:

# cat /etc/rabbitmq/rabbitmq-2.7.1.config
[
    {rabbit, [
        {ssl_listeners, [{"0.0.0.0",4445}]},
        {ssl_options, [
            {cacertfile,"/etc/rabbitmq/certs/testca/cacert.pem"},
            {certfile,"/etc/rabbitmq/certs/server/cert.pem"},
            {keyfile,"/etc/rabbitmq/certs/server/key.pem"},
            {verify, verify_peer},
            {fail_if_no_peer_cert, false}
        ]}

    ]}
].

Here is the rabbitmq startup information:

# /opt/rabbitmq-server-2.7.1/sbin/rabbitmq-server
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.7.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit-new at ServerA
app descriptor : /opt/rabbitmq-server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /root
config file(s) : (none)
cookie hash    :
log            : /var/log/rabbitmq/rabbit-new at ServerA.log
sasl log       : /var/log/rabbitmq/rabbit-new at ServerA-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit-new at ServerA
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting plugin registry
...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting alarm handler
...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange, queue and binding recovery
...done
starting mirror queue slave sup
...done
starting adding mirrors to queues
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...done
starting direct_client
...done
starting notify cluster nodes
...done

broker running

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/3e4d7b74/attachment.htm>

From brian.newsgroup at gmail.com  Thu Mar 15 00:15:38 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Thu, 15 Mar 2012 11:15:38 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
	one machine
In-Reply-To: <CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
	<4F6079B7.4050002@rabbitmq.com>
	<CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
Message-ID: <CALD4NQYGv-Gu6j+yOkMOJpjhOrpU4WL22=QrEiPONFaRxqSbTg@mail.gmail.com>

Hi Emile & Simon,

Is rabbit 2.7.1 *completely* compatible with client libraries that use AMQP
0-8? If we updated our rabbit 1.8.0 to 2.7.1, would it cause the old
clients to fail by any chance?

Cheers,

Brian

On Thu, Mar 15, 2012 at 11:08 AM, Brian Jing <brian.newsgroup at gmail.com>wrote:

> Hi Emile,
>
> On Wed, Mar 14, 2012 at 9:57 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi Brian,
>>
>> On 14/03/12 00:26, Brian Jing wrote:
>> > =INFO REPORT==== 14-Mar-2012::11:05:07 ===
>> > started TCP Listener on [::]:4446
>>
>> Where does the config for this port number (4446) come from?
>
>
> This comes from the NODE_PORT variable defined in the environment config
> file. since the existing 1.8.0 already uses 5672 as the default port,  I
> need a different port to be able to run this second instance of rabbitmq on
> the same machine. Does this make sense?
>
>
>> Are you
>> sure the correct config file is being read during broker startup?  What
>> does the broker startup banner say?
>>
>> I'm pretty sure that the correct config files are being used. I changed
> the default env config file from /etc/rabbitmq/rabbitmq-env.conf to
> /etc/rabbitmq/rabbitmq_env.conf before I rebuilt the source (only thing I
> changed in the source). I know this env config file is being used because
> rabbitmq 2.7.1 generates separate log files for the SERVICENAME I specified
> and rabbitmq 2.7.1 listens to the port I specified in the env file as well.
>
> The content of my rabbitmq_env.conf is as follows:
>
> # cat /etc/rabbitmq/rabbitmq_env.conf
> SERVICENAME=RabbitMQ-new
> NODENAME=rabbit-new@$HOSTNAME
> NODE_PORT=4446
> CONFIG_FILE=/etc/rabbitmq/rabbitmq-2.7.1.config
>
> Content of my new rabbitmq.conf:
>
> # cat /etc/rabbitmq/rabbitmq-2.7.1.config
>
> [
>     {rabbit, [
>         {ssl_listeners, [{"0.0.0.0",4445}]},
>         {ssl_options, [
>             {cacertfile,"/etc/rabbitmq/certs/testca/cacert.pem"},
>             {certfile,"/etc/rabbitmq/certs/server/cert.pem"},
>             {keyfile,"/etc/rabbitmq/certs/server/key.pem"},
>             {verify, verify_peer},
>             {fail_if_no_peer_cert, false}
>         ]}
>
>     ]}
> ].
>
> Here is the rabbitmq startup information:
>
> # /opt/rabbitmq-server-2.7.1/sbin/rabbitmq-server
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.7.1  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit-new at ServerA
> app descriptor : /opt/rabbitmq-server-2.7.1/sbin/../ebin/rabbit.app
> home dir       : /root
> config file(s) : (none)
> cookie hash    :
> log            : /var/log/rabbitmq/rabbit-new at ServerA.log
> sasl log       : /var/log/rabbitmq/rabbit-new at ServerA-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit-new at ServerA
> erlang version : 5.7.4
>
> -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
> ...done
> starting database
> ...done
> starting codec correctness check
> ...done
> -- external infrastructure ready
> starting plugin registry
> ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism amqplain
> ...done
> starting auth mechanism plain
> ...done
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
> ...done
> starting exchange type topic
> ...done
> -- kernel ready
> starting alarm handler
> ...done
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange, queue and binding recovery
> ...done
> starting mirror queue slave sup
> ...done
> starting adding mirrors to queues
> ...done
> -- message delivery logic ready
> starting error log relay
> ...done
> starting networking
> ...done
> starting direct_client
> ...done
> starting notify cluster nodes
> ...done
>
> broker running
>
> Cheers,
>
> Brian
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/5662ea5f/attachment.htm>

From alvinzmho at gmail.com  Thu Mar 15 01:43:47 2012
From: alvinzmho at gmail.com (AlvinRMQ)
Date: Wed, 14 Mar 2012 18:43:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Failure starting rabbitMQ broker
In-Reply-To: <4F5491F4.7050202@rabbitmq.com>
References: <33397550.post@talk.nabble.com> <4F5491F4.7050202@rabbitmq.com>
Message-ID: <33506992.post@talk.nabble.com>


Hi Simon,

It failed to restart again today. And the log file appeared normal apart
from a warning mesage just prior to restarting the broker:

=WARNING REPORT==== 15-Mar-2012::01:09:34 ===
exception on TCP connection <0.16970.16> from 192.168.0.145:49366
connection_closed_abruptly

I would think this is from one of the client machines shutting down.

Also, in which order should I restart the cluster of 2 nodes? Disc node or
the ram node first?

Thanks,
Alvin


Simon MacMullen-2 wrote:
> 
> Hi Alvin. Unfortunately the erl_crash.dump file is rarely particularly 
> useful in these circumstances. If you still have the log file around 
> from when the failure occurred that would be much more useful.
> 
> Cheers, Simon
> 
> On 02/03/2012 5:35PM, AlvinRMQ wrote:
>>
>> I have a 2 node rabbitMQ cluster that has been running for a few months.
>> The
>> nodes restart every morning but today the master node failed to start
>> properly with the following error message in the erl_crash.dump:
>>
>> =erl_crash_dump:0.1
>> Mon Feb 27 06:51:13 2012
>> Slogan: Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>> System version: Erlang R14B04 (erts-5.8.5) [smp:8:8] [rq:8]
>> [async-threads:30]
>> Compiled: Mon Oct  3 19:19:39 2011
>>
>> http://old.nabble.com/file/p33397550/erl_crash.dump erl_crash.dump
>>
>> However, I was able to make it start after rebooting the machine again. I
>> am
>> running RabbitMQ 2.7.0 server on windows 7. I do not have experience with
>> erlang. Can someone please explain to me what the error message means?
>>
>> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-- 
View this message in context: http://old.nabble.com/Failure-starting-rabbitMQ-broker-tp33397550p33506992.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From brian.newsgroup at gmail.com  Thu Mar 15 04:19:26 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Thu, 15 Mar 2012 15:19:26 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
	one machine
In-Reply-To: <CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
	<4F6079B7.4050002@rabbitmq.com>
	<CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
Message-ID: <CALD4NQZ0N+bxefzEiyQ3z=GOKApG9uUrMfX3OQhkchq6wKjEcw@mail.gmail.com>

On Thu, Mar 15, 2012 at 11:08 AM, Brian Jing <brian.newsgroup at gmail.com>wrote:

>
> config file(s) : (none)
>
Looks like it's not using any config files. I thought it was before how I
named it, I then tried different naming but the start banner still shows
(none).

Any idea why?

Cheers,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/3a36cd57/attachment.htm>

From brian.newsgroup at gmail.com  Thu Mar 15 04:45:49 2012
From: brian.newsgroup at gmail.com (Brian Jing)
Date: Thu, 15 Mar 2012 15:45:49 +1100
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
	one machine
In-Reply-To: <CALD4NQZ0N+bxefzEiyQ3z=GOKApG9uUrMfX3OQhkchq6wKjEcw@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
	<4F6079B7.4050002@rabbitmq.com>
	<CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
	<CALD4NQZ0N+bxefzEiyQ3z=GOKApG9uUrMfX3OQhkchq6wKjEcw@mail.gmail.com>
Message-ID: <CALD4NQa-m8d4L_0+qz4Ka_btUq6V8zqV=6bf03voQx+PK+RKXg@mail.gmail.com>

Hi all,

Never mind. It turns out that it was a stupid configuration problem. In the
env config file, the line for CONFIG_FILE should be:

CONFIG_FILE=/etc/rabbitmq/rabbitmq-2.7.1

instead of:

CONFIG_FILE=/etc/rabbitmq/rabbitmq-2.7.1.config

Everything now is working fine!

Thanks for all your help! Very much appreciated!

Cheers,

Brian

On Thu, Mar 15, 2012 at 3:19 PM, Brian Jing <brian.newsgroup at gmail.com>wrote:

> On Thu, Mar 15, 2012 at 11:08 AM, Brian Jing <brian.newsgroup at gmail.com>wrote:
>
>>
>> config file(s) : (none)
>>
> Looks like it's not using any config files. I thought it was before how I
> named it, I then tried different naming but the start banner still shows
> (none).
>
> Any idea why?
>
> Cheers,
>
> Brian
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/37bc5e92/attachment.htm>

From timya15 at gmail.com  Thu Mar 15 05:36:35 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Thu, 15 Mar 2012 11:06:35 +0530
Subject: [rabbitmq-discuss] Federation binding to a queue
In-Reply-To: <FECFD82F-2ED2-4D22-AD76-56BD07AED56C@rabbitmq.com>
References: <CAJ1FMH7w1BHq7g8c-2-BVG1x5c7x34MqxHWMoY6vBcVs0UxeqA@mail.gmail.com>
	<4F5DD509.40600@rabbitmq.com>
	<CAJ1FMH6F2digPcAa+VYWt1syacaaJJzF39BLTvYh5VDyzx+haw@mail.gmail.com>
	<FECFD82F-2ED2-4D22-AD76-56BD07AED56C@rabbitmq.com>
Message-ID: <CAJ1FMH4Ax=npeLL7GeNm3-nYS-yeqMymLbtZ6ZOrnFBw+5K1nA@mail.gmail.com>

Yes, rabbit_federation is a typo error.
Also clear about the release note on Federation queue mirroring.

Thanks for the Great Help...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/65bc6865/attachment.htm>

From timya15 at gmail.com  Thu Mar 15 06:03:08 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Thu, 15 Mar 2012 11:33:08 +0530
Subject: [rabbitmq-discuss] Shovel creation using Java client.
Message-ID: <CAJ1FMH4SUMrUU_YV6o8qc-+vJpw67RDkdOfpc+MZMCmLApu3KQ@mail.gmail.com>

The sample from the URL:
https://github.com/rabbitinaction/sourcecode/blob/master/configs/rabbitmq/rabbitmq.config.shovel

{rabbitmq_shovel,
 [{shovels,
  [{avocado_order_shovel,
    [{sources, [
      {broker, "amqp://guest:guest at ClientRabbit:5672"},
      {declarations,
        [{'queue.declare',[{queue, <<"backup_orders">>},durable]},
         {'exchange.declare',[{exchange, <<"incoming_orders">>},{type,
<<"direct">>}, durable]},
         {'queue.bind',[{exchange, <<"incoming_orders">>},{queue,
<<"backup_orders">>},{routing_key, <<"warehouse">>}]}
      ]}
     ]},
     {destinations, [
       {broker, "amqp://guest:guest at ServerRabbit:5672"},
       {declarations,
         [{'queue.declare',[{queue, <<"warehouse_carpinteria">>},durable]},
          {'exchange.declare', [{exchange, <<"incoming_orders">>},{type,
<<"direct">>}, durable]},
          {'queue.bind',[{exchange, <<"incoming_orders">>},{queue,
<<"warehouse_carpinteria">>},{routing_key, <<"warehouse">>}]}
       ]}
     ]},
     {queue, <<"backup_orders">>},
     {publish_properties, [{delivery_mode, 2}]},
     {publish_fields, [{exchange, <<"incoming_orders">>},{routing_key,
<<"warehouse">>}]},
     {reconnect_delay, 5}
   ]}
  ]
}]
}

Is there any sample, the shovel exchange/queue/binding created using Java
client library.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/6afb397c/attachment.htm>

From amathur.q at gmail.com  Thu Mar 15 08:06:04 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Thu, 15 Mar 2012 13:36:04 +0530
Subject: [rabbitmq-discuss] can activemq and rabbitmq be used together in
	the same application?
Message-ID: <CA+u4LE7kJoNFR7eTr1JF+tgVMBF5=q7XpC9gW87KNg-d-Otk8g@mail.gmail.com>

Hi,

-> Is it possible to use both ActiveMQ broker and RabbitMQ broker in the
same application/project? I want to send some messages using ActiveMQ/JMS
and some using RabbitMQ/AMQP(please don't ask why!!).
I tried using both ..but my application keeps giving a JMS exception .Is it
possible for ActiveMQ broker to interact/listen to a RabbitMQ broker and
vice-versa(i guess using  a bridge of some sort)? if yes,then how do we
build the bridge between the two?

->how can we define JAVA beans for
connection,template,connection-factory,message-senders,message-listener
using XML,so that we need not define connection,connection-factory in every
listener/sender we create.? is the following correct way of defining  a
Rabbit Template:

code-
<bean id="rabbitTemplate"
class="org.springframework.amqp.rabbit.core.RabbitTemplate"/>
    <property>name="connectionFactory"
ref="rabbitConnectionFactory"</property>
     </bean>

Thanks in advance.


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/96b4d3cf/attachment.htm>

From emile at rabbitmq.com  Thu Mar 15 09:58:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Mar 2012 09:58:58 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
Message-ID: <4F61BD62.3000109@rabbitmq.com>

Hi John,

On 14/03/12 22:36, John Stoner wrote:

>     Does the RabbitMQ logfile on rabbitmq-small02-dev contain an entry about
>     a connection attempt from a disallowed node at this time?

If it doesn't then network access between the cluster nodes needs to be
confirmed or established. See information here:

http://www.rabbitmq.com/clustering.html#firewall

> One other question: is it expected behavior that `rabbitmq-server stop`
> doesn't kill the process?

That is not a recognised parameter. Did you mean `rabbitmqctl stop` ?




-Emile

From emile at rabbitmq.com  Thu Mar 15 10:05:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Mar 2012 10:05:50 +0000
Subject: [rabbitmq-discuss] Issue with running two RabbitMQ servers on
 one machine
In-Reply-To: <CALD4NQYGv-Gu6j+yOkMOJpjhOrpU4WL22=QrEiPONFaRxqSbTg@mail.gmail.com>
References: <CALD4NQYn=sv9cEJMjQbP86FLf5Z5bG8__MnASjEMQZtDaaXJSA@mail.gmail.com>
	<4F5F3524.5030405@rabbitmq.com>
	<CALD4NQYT_qRY_KMV2c6RfQnDq-NQDiPDbOEzwZ8SiX+=2Lh62A@mail.gmail.com>
	<4F6079B7.4050002@rabbitmq.com>
	<CALD4NQZop5YENw8p_hnvXZTpHAu68Gb6V3RR==2VGcGfM8DFBg@mail.gmail.com>
	<CALD4NQYGv-Gu6j+yOkMOJpjhOrpU4WL22=QrEiPONFaRxqSbTg@mail.gmail.com>
Message-ID: <4F61BEFE.3080106@rabbitmq.com>

Hi Brian,

On 15/03/12 00:15, Brian Jing wrote:
> Is rabbit 2.7.1 *completely* compatible with client libraries that use
> AMQP 0-8? If we updated our rabbit 1.8.0 to 2.7.1, would it cause the
> old clients to fail by any chance?

Clients that implement AMQP 0-8 should have no problem communicating
with a v2.7.1 broker. More version compatibility information is
available here:

http://www.rabbitmq.com/specification.html


-Emile


From matt.higgins at gmail.com  Wed Mar 14 19:59:14 2012
From: matt.higgins at gmail.com (MattH)
Date: Wed, 14 Mar 2012 12:59:14 -0700 (PDT)
Subject: [rabbitmq-discuss] status Active in Management web portal
Message-ID: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>

I have a queu and a client that will continuously poll the queu so at
any given moment I do not have an active consumer. However the web
management portal still shows the queue as as active which is correct
given my application. The question is how dose the portal determine
this and can I get access to this status programmatically?

I am using Spring AMQP but I can dial back to the real rabbit api if
needed. I alos looked a the HTTP API and did not see any equivalent to
the Status active which is displayed in the web portal.

-Matt

From matt.c.ward at gmail.com  Thu Mar 15 02:46:14 2012
From: matt.c.ward at gmail.com (Matthew Ward)
Date: Wed, 14 Mar 2012 19:46:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
Message-ID: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>

I am running some tests for an async process that consumes messages from 
rabbitmq. We are trying to figure out how to gracefully handle rabbitmq 
going away and coming back. The goal is to have the async process reconnect 
and resume operations. To simulate the situation I start my consumer, then 
I turn rabbitmq off, wait then turn it back on.

As expected, Connection Refused exceptions are thrown (and caught) while 
rabbitmq is off. As soon as I bring the server back online, it throws 
ShutDownSignalExceptions:

com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
{#method<connection.close>(reply-code=320, reply-text=CONNECTION_FORCED - 
broker forced connection closure with reason 'shutdown', class-id=0, 
method-id=0), null, "[B at 275e538e"}
at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
at com.rabbitmq.client.QueueingConsumer.nextDelivery(
QueueingConsumer.java:214)

How do I gracefully handle the shutdown so that I can get back to 
consuming? I attempted shutting the channel / connection and creating a new 
connection from the factory but the shutdown signal exception is still 
thrown after 'reconnect'. What's going on under the hood that keeps me from 
successfully consuming again? Is there some sort of message I need to tell 
RabbitMQ "yes I know I shut you down, but its you're back up so 
stop crying..."

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/b67bc3a3/attachment.htm>

From matt.c.ward at gmail.com  Thu Mar 15 02:52:39 2012
From: matt.c.ward at gmail.com (Matthew Ward)
Date: Wed, 14 Mar 2012 19:52:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
Message-ID: <25484926.29.1331779959743.JavaMail.geo-discussion-forums@pbim5>

To Give  a few code examples, (I have omitted the non-relevant parts):

try {

this.consumer.nextDelivery();

} catch (ShutdownSignalException e) {

  log.error("ShutdownSignalException", e);

  if (this.channel.isOpen()) {
    try {
      this.channel.close();
    } catch (AlreadyClosedException e1) {}
  }

  if (this.connection.isOpen()) {

    try {
      this.connection.close();
    } catch (AlreadyClosedException e1) {}
  }

  this.connection = factory.newConnection();

  this.channel.basicRecover();



I've got some logic in there to back off during connection refused, but its 
when the server comes back online that I can't get rid of the 
ShutDownSignalExceptions.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/87f07b67/attachment.htm>

From matt.c.ward at gmail.com  Thu Mar 15 02:53:40 2012
From: matt.c.ward at gmail.com (Matthew Ward)
Date: Wed, 14 Mar 2012 19:53:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <25484926.29.1331779959743.JavaMail.geo-discussion-forums@pbim5>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
	<25484926.29.1331779959743.JavaMail.geo-discussion-forums@pbim5>
Message-ID: <11814748.3.1331780020443.JavaMail.geo-discussion-forums@pbdl8>

Sorry mistake on copy/paste. Replace basicRecover() with  

this.channel = this.connection.createChannel();
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/c83d3b50/attachment.htm>

From simon at rabbitmq.com  Thu Mar 15 10:50:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 10:50:58 +0000
Subject: [rabbitmq-discuss] status Active in Management web portal
In-Reply-To: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>
References: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>
Message-ID: <4F61C992.1010709@rabbitmq.com>

On 14/03/12 19:59, MattH wrote:
> I have a queu and a client that will continuously poll the queu so at
> any given moment I do not have an active consumer. However the web
> management portal still shows the queue as as active which is correct
> given my application. The question is how dose the portal determine
> this and can I get access to this status programmatically?
>
> I am using Spring AMQP but I can dial back to the real rabbit api if
> needed. I alos looked a the HTTP API and did not see any equivalent to
> the Status active which is displayed in the web portal.

This information is far too obscure and implementation-specific to make 
available via AMQP :-)

Via the management API, check if there's an idle_since key in the queue. 
If not, it's active.

FTR, this just means "has the queue done *anything* in the last few 
seconds?". If the queue is idle for a while it hibernates, which cuts 
memory use and takes a little while to come back out of.

I would be very wary of using this in an application though - queues can 
be woken up for all sorts of reasons. What were you planning on doing 
with the information?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 15 10:54:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 10:54:40 +0000
Subject: [rabbitmq-discuss] can activemq and rabbitmq be used together
 in	the same application?
In-Reply-To: <CA+u4LE7kJoNFR7eTr1JF+tgVMBF5=q7XpC9gW87KNg-d-Otk8g@mail.gmail.com>
References: <CA+u4LE7kJoNFR7eTr1JF+tgVMBF5=q7XpC9gW87KNg-d-Otk8g@mail.gmail.com>
Message-ID: <4F61CA70.2090304@rabbitmq.com>

On 15/03/12 08:06, Ashutosh Mathur wrote:
> Hi,
>
> -> Is it possible to use both ActiveMQ broker and RabbitMQ broker in the
> same application/project?

Absolutely, but you'll need different client libraries (or use STOMP, 
which they both talk).

> I want to send some messages using
> ActiveMQ/JMS and some using RabbitMQ/AMQP(please don't ask why!!).
> I tried using both ..but my application keeps giving a JMS exception .Is
> it possible for ActiveMQ broker to interact/listen to a RabbitMQ broker
> and vice-versa(i guess using  a bridge of some sort)? if yes,then how do
> we build the bridge between the two?

There's no pre-existing bridge to my knowledge, although you could write 
one I suppose.

> ->how can we define JAVA beans for
> connection,template,connection-factory,message-senders,message-listener
> using XML,so that we need not define connection,connection-factory in
> every listener/sender we create.? is the following correct way of
> defining  a Rabbit Template:
>
> code-
> <bean id="rabbitTemplate"
> class="org.springframework.amqp.rabbit.core.RabbitTemplate"/>
> <property>name="connectionFactory" ref="rabbitConnectionFactory"</property>
> </bean>

Any Spring-AMQP experts want to comment on this?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 15 10:55:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 10:55:15 +0000
Subject: [rabbitmq-discuss] Shovel creation using Java client.
In-Reply-To: <CAJ1FMH4SUMrUU_YV6o8qc-+vJpw67RDkdOfpc+MZMCmLApu3KQ@mail.gmail.com>
References: <CAJ1FMH4SUMrUU_YV6o8qc-+vJpw67RDkdOfpc+MZMCmLApu3KQ@mail.gmail.com>
Message-ID: <4F61CA93.8030000@rabbitmq.com>

On 15/03/12 06:03, Timya Tortus wrote:
> Is there any sample, the shovel exchange/queue/binding created using
> Java client library.

You can't declare a shovel using the Java client I'm afraid - it's 
server configuration only.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ozhurakousky at vmware.com  Thu Mar 15 10:58:38 2012
From: ozhurakousky at vmware.com (Oleg Zhurakousky)
Date: Thu, 15 Mar 2012 03:58:38 -0700 (PDT)
Subject: [rabbitmq-discuss] can activemq and rabbitmq be used together
	in	the same application?
In-Reply-To: <4F61CA70.2090304@rabbitmq.com>
Message-ID: <7f3df287-499a-43a2-baad-621c36c7b0f2@oleg-2.local>

You can also use Spring Integration which provides AMQP and JMS adapters.

http://static.springsource.org/spring-integration/reference/htmlsingle/#amqp
http://static.springsource.org/spring-integration/reference/htmlsingle/#jms

Cheers
Oleg

----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Ashutosh Mathur" <amathur.q at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, March 15, 2012 6:54:40 AM
Subject: Re: [rabbitmq-discuss] can activemq and rabbitmq be used together in	the same application?

On 15/03/12 08:06, Ashutosh Mathur wrote:
> Hi,
>
> -> Is it possible to use both ActiveMQ broker and RabbitMQ broker in the
> same application/project?

Absolutely, but you'll need different client libraries (or use STOMP, 
which they both talk).

> I want to send some messages using
> ActiveMQ/JMS and some using RabbitMQ/AMQP(please don't ask why!!).
> I tried using both ..but my application keeps giving a JMS exception .Is
> it possible for ActiveMQ broker to interact/listen to a RabbitMQ broker
> and vice-versa(i guess using  a bridge of some sort)? if yes,then how do
> we build the bridge between the two?

There's no pre-existing bridge to my knowledge, although you could write 
one I suppose.

> ->how can we define JAVA beans for
> connection,template,connection-factory,message-senders,message-listener
> using XML,so that we need not define connection,connection-factory in
> every listener/sender we create.? is the following correct way of
> defining  a Rabbit Template:
>
> code-
> <bean id="rabbitTemplate"
> class="org.springframework.amqp.rabbit.core.RabbitTemplate"/>
> <property>name="connectionFactory" ref="rabbitConnectionFactory"</property>
> </bean>

Any Spring-AMQP experts want to comment on this?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Mar 15 10:59:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 10:59:56 +0000
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>
Message-ID: <4F61CBAC.2040203@rabbitmq.com>

On 14/03/12 20:34, James Carr wrote:
> I've been wondering what the "right" setup is to federate between
> clusters. Do I just setup each node in the cluster to federate with
> the upstream through the load balancer? My fear here is I'll end up
> with with all the nodes on one cluster connected to a single node
> (through the load balancer) and hence 3 sepeare queues causing
> messages to be duplicated three times! :)

You need to make sure that all nodes in the cluster have the federation 
plugin enabled, and have the same configuration. The federation plugin 
will then make sure that only one node establishes a link to the 
upstream (which will fail over to another node if that node goes down).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 15 11:03:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 11:03:26 +0000
Subject: [rabbitmq-discuss] Failure starting rabbitMQ broker
In-Reply-To: <33506992.post@talk.nabble.com>
References: <33397550.post@talk.nabble.com> <4F5491F4.7050202@rabbitmq.com>
	<33506992.post@talk.nabble.com>
Message-ID: <4F61CC7E.4070209@rabbitmq.com>

On 15/03/12 01:43, AlvinRMQ wrote:
> Hi Simon,
>
> It failed to restart again today. And the log file appeared normal apart
> from a warning mesage just prior to restarting the broker:
>
> =WARNING REPORT==== 15-Mar-2012::01:09:34 ===
> exception on TCP connection<0.16970.16>  from 192.168.0.145:49366
> connection_closed_abruptly
>
> I would think this is from one of the client machines shutting down.

Yes, that's just a client closing the socket without the AMQP close 
handshake.

Did anything show up in the sasl log?

> Also, in which order should I restart the cluster of 2 nodes? Disc node or
> the ram node first?

You should start the disc node first, the RAM node won't know anything 
if it's started first!

In 2.7.1 starting a RAM node first will give you an empty broker which 
the disc node will then not cluster with. In 2.8.0 RAM nodes refuse to 
start first.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 15 11:07:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 11:07:24 +0000
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
Message-ID: <4F61CD6C.4080006@rabbitmq.com>

On 15/03/12 02:46, Matthew Ward wrote:
> As expected, Connection Refused exceptions are thrown (and caught) while
> rabbitmq is off. As soon as I bring the server back online, it throws
> ShutDownSignalExceptions:
>
> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
> {#method<connection.close>(reply-code=320, reply-text=CONNECTION_FORCED
> - broker forced connection closure with reason 'shutdown', class-id=0,
> method-id=0), null, "[B at 275e538e"}
> at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
> at
> com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)

Unfortunately there's a bug in the 2.7.1 Java client that obscures the 
real error message here. The server logs should tell you more about what 
the server is objecting to.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Thu Mar 15 11:44:07 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 15 Mar 2012 11:44:07 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <20320.44651.11407.44766@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
Message-ID: <BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>

Lionel,

The "hack" will no longer be required in the next release; thanks for
spotting this.

Logging ssl detail is a little scary; though the log could add some more
information. We'll improve that.

The DN/CN issues were discussed recently, but I'll leave it to Simon to
explain our position on that.

Cheers,

Steve Powell  (a cheery bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 14 Mar 2012, at 14:42, Lionel Cons wrote:

> Simon MacMullen writes:
>> Damn, it looks like you need some default_user details defined for this 
>> to work. (They can be invalid credentials: they will not be used, they 
>> just need to exist.)
> 
> Indeed, adding a default_user seems to work. It would be nice if this
> "hack" could be removed.
> 
> However, I've only progressed a tiny bit. I now get:
> 
> =ERROR REPORT==== 14-Mar-2012::15:37:22 ===
> STOMP error frame sent:
> Message: "Bad CONNECT"
> Detail: "Authentication failure\n"
> Server private detail: none
> 
> Which is normal since the certificate I've used is not known. However,
> could the DN be logged in the "Server private detail" section please?
> 
> I remember some discussions about DN formats, quotes, escaping... and
> I would like to know from RabbitMQ itself what it expects.
> 
> There was also the question of CN versus DN, is this configurable now?
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matt.higgins at gmail.com  Thu Mar 15 12:57:57 2012
From: matt.higgins at gmail.com (MattH)
Date: Thu, 15 Mar 2012 05:57:57 -0700 (PDT)
Subject: [rabbitmq-discuss] status Active in Management web portal
In-Reply-To: <4F61C992.1010709@rabbitmq.com>
References: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>
	<4F61C992.1010709@rabbitmq.com>
Message-ID: <674ddbb1-5cb1-4d07-80b7-dc69184bc03d@w1g2000vbx.googlegroups.com>

Thanks Simon,

Looks like the idol_since is what I was looking for. I can see that in
the http API call. I did realize I would be geting out of AMQP land to
get this data, however your concern is valid and I am also not
thrilled with this solution.

My application acts like a chat room where one user creates a room
(exchange) with say 5 users and a set of queues is created for each
user in the room at the time the room is created (queues bound to the
exchange). I could have many client endpoints, some could connect
directly to the queue (AMQP, STOMP) others may long poll a web
services that will pull messages off the queue, format and send back
to the client over HTTP.  If the client user goes idol I want to
reflect that in the UI and if a user never connected they will remain
idol from the time the room was created. In essence I am attempting to
represent presence through activity on the queue.

Another method may be to simply not create the queue in the first
place and force users to create a queue as they connect. This would
then require that I find all queues bound to a given exchange, if an
exchange has a queue for a given users then they are "active". This is
not as fine grained a presence indicator but may work. This is still
out of the scope of AMQP however.

I did look at XMPP for this part of the app but did not want to add
yet another server and deal with managing rosters etc since the bulk
of the app deals in much more traditional message paradigms.


-Matt





On Mar 15, 6:50?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 14/03/12 19:59, MattH wrote:
>
> > I have a queu and a client that will continuously poll the queu so at
> > any given moment I do not have an active consumer. However the web
> > management portal still shows the queue as as active which is correct
> > given my application. The question is how dose the portal determine
> > this and can I get access to this status programmatically?
>
> > I am using Spring AMQP but I can dial back to the real rabbit api if
> > needed. I alos looked a the HTTP API and did not see any equivalent to
> > the Status active which is displayed in the web portal.
>
> This information is far too obscure and implementation-specific to make
> available via AMQP :-)
>
> Via the management API, check if there's an idle_since key in the queue.
> If not, it's active.
>
> FTR, this just means "has the queue done *anything* in the last few
> seconds?". If the queue is idle for a while it hibernates, which cuts
> memory use and takes a little while to come back out of.
>
> I would be very wary of using this in an application though - queues can
> be woken up for all sorts of reasons. What were you planning on doing
> with the information?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Mar 15 13:03:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 13:03:04 +0000
Subject: [rabbitmq-discuss] status Active in Management web portal
In-Reply-To: <674ddbb1-5cb1-4d07-80b7-dc69184bc03d@w1g2000vbx.googlegroups.com>
References: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>	<4F61C992.1010709@rabbitmq.com>
	<674ddbb1-5cb1-4d07-80b7-dc69184bc03d@w1g2000vbx.googlegroups.com>
Message-ID: <4F61E888.5040102@rabbitmq.com>

On 15/03/12 12:57, MattH wrote:
> In essence I am attempting to
> represent presence through activity on the queue.

Very bad idea. "Activity" here means a whole bunch of stuff. For example 
"rabbitmqctl list_queues" will wake all the queues up.

> Another method may be to simply not create the queue in the first
> place and force users to create a queue as they connect. This would
> then require that I find all queues bound to a given exchange, if an
> exchange has a queue for a given users then they are "active". This is
> not as fine grained a presence indicator but may work. This is still
> out of the scope of AMQP however.

This could work.

Another possibility, letting you stay within AMQP:

https://github.com/tonyg/presence-exchange

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matt.higgins at gmail.com  Thu Mar 15 13:44:29 2012
From: matt.higgins at gmail.com (MattH)
Date: Thu, 15 Mar 2012 06:44:29 -0700 (PDT)
Subject: [rabbitmq-discuss] status Active in Management web portal
In-Reply-To: <4F61E888.5040102@rabbitmq.com>
References: <a3d1fe75-3ca1-4950-bc80-230d0cfb1b05@z31g2000vbt.googlegroups.com>
	<4F61C992.1010709@rabbitmq.com>
	<674ddbb1-5cb1-4d07-80b7-dc69184bc03d@w1g2000vbx.googlegroups.com>
	<4F61E888.5040102@rabbitmq.com>
Message-ID: <ed3e276a-268d-4743-9a4d-e3b98cc3ace7@i2g2000vbv.googlegroups.com>

Thanks for the heads up on the list_queues this is absolutely no going
to work.

I did not really think about the "presence" notion until I wrote that
response which gave me a bunch of ideas. I will look into the presence-
exchange but I also found this on your site which may be interesting
for anyone else following this thread.

http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

The post has a section on how you can leverage exchange to exchange
bindings to provide presence notifications which is exactly what I
want in my system.

-Matt


On Mar 15, 9:03?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 15/03/12 12:57, MattH wrote:
>
> > In essence I am attempting to
> > represent presence through activity on the queue.
>
> Very bad idea. "Activity" here means a whole bunch of stuff. For example
> "rabbitmqctl list_queues" will wake all the queues up.
>
> > Another method may be to simply not create the queue in the first
> > place and force users to create a queue as they connect. This would
> > then require that I find all queues bound to a given exchange, if an
> > exchange has a queue for a given users then they are "active". This is
> > not as fine grained a presence indicator but may work. This is still
> > out of the scope of AMQP however.
>
> This could work.
>
> Another possibility, letting you stay within AMQP:
>
> https://github.com/tonyg/presence-exchange
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From u2.storm at gmail.com  Thu Mar 15 13:57:07 2012
From: u2.storm at gmail.com (Artsiom)
Date: Thu, 15 Mar 2012 16:57:07 +0300
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
	<CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
Message-ID: <4F61F533.9020405@gmail.com>

I some questions concerning multithreading and using multiple channels 
within single connection.

Is structure amqp_connection_state_t is thread-safe?
Can I share connection between threads and at the same time
use separate channel for each thread in producer app? and in consumer app?

The second part of the question(about consumer) is needed to be explained.
When I looked at API, I didn't find any difficulties to use many 
channels within single connection
in producer app, because each method (declare queue\exchange, bind, 
publish & etc) has
"channel" parameter.

But in consumer app, where it is needed to receive messages (or frames 
as shown in example .c-files),
we have to call wait_for_single_frame method, which is lack of "channel" 
method.
Could you give an advice how to organize "multichannel" message fetch from
one queue?


*OR*
It is better to use separate connection for each thread and have no 
problems? :)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/3350851d/attachment.htm>

From james.r.carr at gmail.com  Thu Mar 15 14:26:19 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 15 Mar 2012 09:26:19 -0500
Subject: [rabbitmq-discuss] Up To Date Federation Details?
Message-ID: <CAJreXKA9yE=jMc-GuOOEAdpr2UPorqFBwTkmPVKrH==gLnpPbA@mail.gmail.com>

Hi,

I have a forthcoming blog post this week to describe rabbitmq
federation but in the meantime I've been wondering where a good source
of documentation is located at? A google search turns up the preview
release blog post and links to
http://hg.rabbitmq.com/rabbitmq-federation/file/rabbitmq_v2_5_0_preview/README
which seems fine but I fear may be a bit stale. The newest README
(http://hg.rabbitmq.com/rabbitmq-federation/file/9315d761316e/README)
points to http://www.rabbitmq.com/federation.html which returns a 404.

Unless http://www.rabbitmq.com/federation.html will have something on
it once the 2.8.0 release ships? :)

Thanks,
James

From alan.antonuk at gmail.com  Thu Mar 15 14:43:02 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 15 Mar 2012 10:43:02 -0400
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <4F61F533.9020405@gmail.com>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
	<CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
	<4F61F533.9020405@gmail.com>
Message-ID: <CAAt2poLRE7qrc350QQTpxd934kpX7+1DuRUQGzYfB9y08mVNKw@mail.gmail.com>

Inlined:

-Alan

On Thu, Mar 15, 2012 at 9:57 AM, Artsiom <u2.storm at gmail.com> wrote:

>  I some questions concerning multithreading and using multiple channels
> within single connection.
>
> Is structure amqp_connection_state_t is thread-safe?
> Can I share connection between threads and at the same time
> use separate channel for each thread in producer app? and in consumer app?
>

The amqp_connection_state_t object is not synchronized. In order to use it
from multiple threads you would have to synchronize its use across threads
(provide some external mutual exclusion when calling any amqp_* function
that uses a common amqp_connection_state_t).


> The second part of the question(about consumer) is needed to be explained.
> When I looked at API, I didn't find any difficulties to use many channels
> within single connection
> in producer app, because each method (declare queue\exchange, bind,
> publish & etc) has
> "channel" parameter.
>
> But in consumer app, where it is needed to receive messages (or frames as
> shown in example .c-files),
> we have to call wait_for_single_frame method, which is lack of "channel"
> method.
> Could you give an advice how to organize "multichannel" message fetch from
> one queue?
>

The API for consuming messages is pretty low-level at this point.  In order
to consume from multiple channels you need to read messages from all the
channels using amqp_simple_wait_frame, then provide your own logic to
handle messages from different channels appropriately.

>
>
> *OR*
> It is better to use separate connection for each thread and have no
> problems? :)
>
> That would the the easiest way to get started.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/9d238a39/attachment.htm>

From vbernard42 at gmail.com  Thu Mar 15 14:56:59 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Thu, 15 Mar 2012 07:56:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <4F61F533.9020405@gmail.com>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
	<CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
	<4F61F533.9020405@gmail.com>
Message-ID: <961bf6ea-7a60-4954-a333-9e7f10ace191@w32g2000vbt.googlegroups.com>

Hi,

With regard to thread-safety, I personally ended up manually
synchronizing every method using a given connection, so that any
channel can be used from any thread. There may be a more subtle
answer.

Concerning multichannel fetching, here is (very schematically) what I
do:

fetch_channel(channel_no) {
   if deliveries[channel_no].size() > 0
      return deliveries[channel_no].dequeue()
   else
      return receive_delivery(channel_no)

receive_delivery(channel_no)
   do {
      receive some_delivery
      if some_delivery.channel_no == channel_no
         return some_delivery
      else
         deliveries[channel_no].enqueue(some_delivery)
   } continue until we get a delivery for this channel or reach some
sort of timeout.

Cheers.

Valentin.

On 15 mar, 14:57, Artsiom <u2.st... at gmail.com> wrote:
> I some questions concerning multithreading and using multiple channels
> within single connection.
>
> Is structure amqp_connection_state_t is thread-safe?
> Can I share connection between threads and at the same time
> use separate channel for each thread in producer app? and in consumer app?
>
> The second part of the question(about consumer) is needed to be explained.
> When I looked at API, I didn't find any difficulties to use many
> channels within single connection
> in producer app, because each method (declare queue\exchange, bind,
> publish & etc) has
> "channel" parameter.
>
> But in consumer app, where it is needed to receive messages (or frames
> as shown in example .c-files),
> we have to call wait_for_single_frame method, which is lack of "channel"
> method.
> Could you give an advice how to organize "multichannel" message fetch from
> one queue?
>
> *OR*
> It is better to use separate connection for each thread and have no
> problems? :)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Mar 15 15:58:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 15:58:52 +0000
Subject: [rabbitmq-discuss] Up To Date Federation Details?
In-Reply-To: <CAJreXKA9yE=jMc-GuOOEAdpr2UPorqFBwTkmPVKrH==gLnpPbA@mail.gmail.com>
References: <CAJreXKA9yE=jMc-GuOOEAdpr2UPorqFBwTkmPVKrH==gLnpPbA@mail.gmail.com>
Message-ID: <4F6211BC.6020109@rabbitmq.com>

On 15/03/12 14:26, James Carr wrote:
> I have a forthcoming blog post this week to describe rabbitmq
> federation

Cool!

> but in the meantime I've been wondering where a good source
> of documentation is located at? A google search turns up the preview
> release blog post and links to
> http://hg.rabbitmq.com/rabbitmq-federation/file/rabbitmq_v2_5_0_preview/README
> which seems fine but I fear may be a bit stale.

A bit, yeah.

> The newest README
> (http://hg.rabbitmq.com/rabbitmq-federation/file/9315d761316e/README)
> points to http://www.rabbitmq.com/federation.html which returns a 404.
>
> Unless http://www.rabbitmq.com/federation.html will have something on
> it once the 2.8.0 release ships? :)

It will.

In the meantime, the README for 2.7.1 is at:

http://hg.rabbitmq.com/rabbitmq-federation/file/rabbitmq_v2_7_1/README

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 15 17:00:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Mar 2012 17:00:05 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
Message-ID: <4F622015.3@rabbitmq.com>

On 15/03/12 11:44, Steve Powell wrote:
> Logging ssl detail is a little scary; though the log could add some more
> information. We'll improve that.

Bah. I thought this was getting pushed through a generic login function 
that would log failures. But no. Clearly the username should end up 
somewhere.

> The DN/CN issues were discussed recently, but I'll leave it to Simon to
> explain our position on that.

It defaults to doing the best impersonation it can of a DN produced by 
the OpenSSL's -nameopt RFC2253, and can be switched to using (a 
concatenation of) the CN(s) with:

{rabbit, [{ssl_cert_login_from, common_name}]}

So if there's one thing I've learnt from this preview release thing, 
it's that we also need a preview release of all the documentation. Hmm...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Thu Mar 15 19:37:37 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 15 Mar 2012 14:37:37 -0500
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <4F622015.3@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
	<4F622015.3@rabbitmq.com>
Message-ID: <CAJreXKBQ8+pMc-5k-HFNk9Rc461Lk6FjdjY6L9jm5jmt5gjeJw@mail.gmail.com>

Not sure if this is a bug in the 2.7.9 release or not, but I am having
some problems consuming messages sent on an upstream broker by the
downstream broker cluster. Here is the error log I keep getting:

** Generic server <0.12040.0> terminating
** Last message in was {{'basic.deliver',
                            <<"amq.ctag-QLSHVB2QsF_PaKWvb99rv1">>,1,true,
                            <<"usage">>,<<"foo.bar">>},
                        {amqp_msg,
                            {'P_basic',undefined,undefined,[],1,undefined,
                                undefined,undefined,undefined,undefined,
                                undefined,undefined,undefined,undefined,
                                undefined},
                            <<"Hello!">>}}
** When Server state == {state,
                         {upstream,
                          {amqp_params_network,<<"guest">>,<<"guest">>,
                           <<"/">>,dc2tcserver2,undefined,0,0,1,infinity,none,
                           [#Fun<amqp_auth_mechanisms.plain.3>,
                            #Fun<amqp_auth_mechanisms.amqplain.3>],
                           [],[]},
                          <<"usage">>,none,5,1,none,10000,"all",
                          "dc2tcserver2"},
                         <0.12054.0>,<0.12064.0>,
                         <<"federation: usage -> rabbit at dc2rabbitmq3">>,
                         <<"federation: usage -> rabbit at dc2rabbitmq3 A">>,
                         {0,nil},
                         2,
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],
                            [[{<<"#">>,[]}|
                              {set,1,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],
                                 [{resource,<<"/">>,queue,<<"pit.stop">>}],
                                 [],[],[],[],[],[],[],[],[],[]}}}]],
                            [],[],[],[],[],[],[],[],[],[]}}},
                         <0.12042.0>,<0.12049.0>,
                         {resource,<<"/">>,exchange,<<"usage">>},
                         {0,nil}}
** Reason for termination ==
** {badarg,[{erlang,list_to_binary,[dc2tcserver2]},
            {rabbit_federation_upstream,to_table,1},
            {rabbit_federation_link,handle_info,2},
            {gen_server2,handle_msg,2},
            {proc_lib,init_p_do_apply,3}]}

Only difference is the upstream server is running 2.7.1.


Thanks,
James


On Thu, Mar 15, 2012 at 12:00 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 15/03/12 11:44, Steve Powell wrote:
>>
>> Logging ssl detail is a little scary; though the log could add some more
>> information. We'll improve that.
>
>
> Bah. I thought this was getting pushed through a generic login function that
> would log failures. But no. Clearly the username should end up somewhere.
>
>
>> The DN/CN issues were discussed recently, but I'll leave it to Simon to
>> explain our position on that.
>
>
> It defaults to doing the best impersonation it can of a DN produced by the
> OpenSSL's -nameopt RFC2253, and can be switched to using (a concatenation
> of) the CN(s) with:
>
> {rabbit, [{ssl_cert_login_from, common_name}]}
>
> So if there's one thing I've learnt from this preview release thing, it's
> that we also need a preview release of all the documentation. Hmm...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Thu Mar 15 19:38:21 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 15 Mar 2012 14:38:21 -0500
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <CAJreXKBQ8+pMc-5k-HFNk9Rc461Lk6FjdjY6L9jm5jmt5gjeJw@mail.gmail.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
	<4F622015.3@rabbitmq.com>
	<CAJreXKBQ8+pMc-5k-HFNk9Rc461Lk6FjdjY6L9jm5jmt5gjeJw@mail.gmail.com>
Message-ID: <CAJreXKDUMpEDoFn+TYqVE63nTu+6H5aaucD-Hrzt_FOrtdzJCQ@mail.gmail.com>

FYI, I will try upgrading the upstream and see if the problem persists.

Thanks,
James


On Thu, Mar 15, 2012 at 2:37 PM, James Carr <james.r.carr at gmail.com> wrote:
> Not sure if this is a bug in the 2.7.9 release or not, but I am having
> some problems consuming messages sent on an upstream broker by the
> downstream broker cluster. Here is the error log I keep getting:
>
> ** Generic server <0.12040.0> terminating
> ** Last message in was {{'basic.deliver',
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"amq.ctag-QLSHVB2QsF_PaKWvb99rv1">>,1,true,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"usage">>,<<"foo.bar">>},
> ? ? ? ? ? ? ? ? ? ? ? ?{amqp_msg,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{'P_basic',undefined,undefined,[],1,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,undefined,undefined,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,undefined,undefined,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"Hello!">>}}
> ** When Server state == {state,
> ? ? ? ? ? ? ? ? ? ? ? ? {upstream,
> ? ? ? ? ? ? ? ? ? ? ? ? ?{amqp_params_network,<<"guest">>,<<"guest">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? <<"/">>,dc2tcserver2,undefined,0,0,1,infinity,none,
> ? ? ? ? ? ? ? ? ? ? ? ? ? [#Fun<amqp_auth_mechanisms.plain.3>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?#Fun<amqp_auth_mechanisms.amqplain.3>],
> ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ?<<"usage">>,none,5,1,none,10000,"all",
> ? ? ? ? ? ? ? ? ? ? ? ? ?"dc2tcserver2"},
> ? ? ? ? ? ? ? ? ? ? ? ? <0.12054.0>,<0.12064.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? <<"federation: usage -> rabbit at dc2rabbitmq3">>,
> ? ? ? ? ? ? ? ? ? ? ? ? <<"federation: usage -> rabbit at dc2rabbitmq3 A">>,
> ? ? ? ? ? ? ? ? ? ? ? ? {0,nil},
> ? ? ? ? ? ? ? ? ? ? ? ? 2,
> ? ? ? ? ? ? ? ? ? ? ? ? {dict,1,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?[[{<<"#">>,[]}|
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{set,1,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [{resource,<<"/">>,queue,<<"pit.stop">>}],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[],[],[],[],[],[],[],[],[]}}}]],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[],[],[],[],[],[],[],[],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? <0.12042.0>,<0.12049.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,exchange,<<"usage">>},
> ? ? ? ? ? ? ? ? ? ? ? ? {0,nil}}
> ** Reason for termination ==
> ** {badarg,[{erlang,list_to_binary,[dc2tcserver2]},
> ? ? ? ? ? ?{rabbit_federation_upstream,to_table,1},
> ? ? ? ? ? ?{rabbit_federation_link,handle_info,2},
> ? ? ? ? ? ?{gen_server2,handle_msg,2},
> ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}
>
> Only difference is the upstream server is running 2.7.1.
>
>
> Thanks,
> James
>
>
> On Thu, Mar 15, 2012 at 12:00 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 15/03/12 11:44, Steve Powell wrote:
>>>
>>> Logging ssl detail is a little scary; though the log could add some more
>>> information. We'll improve that.
>>
>>
>> Bah. I thought this was getting pushed through a generic login function that
>> would log failures. But no. Clearly the username should end up somewhere.
>>
>>
>>> The DN/CN issues were discussed recently, but I'll leave it to Simon to
>>> explain our position on that.
>>
>>
>> It defaults to doing the best impersonation it can of a DN produced by the
>> OpenSSL's -nameopt RFC2253, and can be switched to using (a concatenation
>> of) the CN(s) with:
>>
>> {rabbit, [{ssl_cert_login_from, common_name}]}
>>
>> So if there's one thing I've learnt from this preview release thing, it's
>> that we also need a preview release of all the documentation. Hmm...
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Thu Mar 15 19:44:41 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 15 Mar 2012 14:44:41 -0500
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <CAJreXKDUMpEDoFn+TYqVE63nTu+6H5aaucD-Hrzt_FOrtdzJCQ@mail.gmail.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
	<4F622015.3@rabbitmq.com>
	<CAJreXKBQ8+pMc-5k-HFNk9Rc461Lk6FjdjY6L9jm5jmt5gjeJw@mail.gmail.com>
	<CAJreXKDUMpEDoFn+TYqVE63nTu+6H5aaucD-Hrzt_FOrtdzJCQ@mail.gmail.com>
Message-ID: <CAJreXKC8uZHEMO-E+OTv=hyWLvoAN2_jrtuF=ATSLE+OQ6j4TQ@mail.gmail.com>

Upgraded to 2.7.9 on the upstream and the problem persists.

Here's my configuration file for the downstream server:

[
        {rabbit, [
            {cluster_nodes, ['rabbit at dc2rabbitmq3',
'rabbit at dc2rabbitmq4', 'rabbit at dc2rabbitmq5', 'rabbit at dc2rabbitmq6']}
        ]},
        {rabbitmq_federation,
            [ {exchanges, [[{exchange,     "usage"},
                            {virtual_host, "/"},
                            {type,         "topic"},
                            {durable,      true},
                            {auto_delete,  false},
                            {internal,     false},
                            {upstream_set, "remotes"}]
                          ]},
              {upstream_sets, [{"remotes", [
                 [{connection,  "dc2tcserver1"},
                   {exchange,    "usage"},
                   {max_hops,    5}],
                 [{connection,  "dc2tcserver2"},
                   {exchange,    "usage"},
                   {max_hops,    5}]]}]},
              {connections, [
                {"dc2tcserver1", [
                    {host, 'dc2tcserver1'},
                    {heartbeat,       1},
                    {queue_expires,   30000},
                    {message_ttl,     10000},
                    {ha_policy,       "all"}]
                },
                {"dc2tcserver2", [
                    {host, 'dc2tcserver2'},
                    {heartbeat,       1},
                    {queue_expires,   30000},
                    {message_ttl,     10000},
                    {ha_policy,       "all"}]
                }]}
        ]}
].

Is there anything here I might just have off?


Thanks,
James


On Thu, Mar 15, 2012 at 2:38 PM, James Carr <james.r.carr at gmail.com> wrote:
> FYI, I will try upgrading the upstream and see if the problem persists.
>
> Thanks,
> James
>
>
> On Thu, Mar 15, 2012 at 2:37 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Not sure if this is a bug in the 2.7.9 release or not, but I am having
>> some problems consuming messages sent on an upstream broker by the
>> downstream broker cluster. Here is the error log I keep getting:
>>
>> ** Generic server <0.12040.0> terminating
>> ** Last message in was {{'basic.deliver',
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"amq.ctag-QLSHVB2QsF_PaKWvb99rv1">>,1,true,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"usage">>,<<"foo.bar">>},
>> ? ? ? ? ? ? ? ? ? ? ? ?{amqp_msg,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{'P_basic',undefined,undefined,[],1,undefined,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,undefined,undefined,undefined,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,undefined,undefined,undefined,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"Hello!">>}}
>> ** When Server state == {state,
>> ? ? ? ? ? ? ? ? ? ? ? ? {upstream,
>> ? ? ? ? ? ? ? ? ? ? ? ? ?{amqp_params_network,<<"guest">>,<<"guest">>,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? <<"/">>,dc2tcserver2,undefined,0,0,1,infinity,none,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? [#Fun<amqp_auth_mechanisms.plain.3>,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?#Fun<amqp_auth_mechanisms.amqplain.3>],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
>> ? ? ? ? ? ? ? ? ? ? ? ? ?<<"usage">>,none,5,1,none,10000,"all",
>> ? ? ? ? ? ? ? ? ? ? ? ? ?"dc2tcserver2"},
>> ? ? ? ? ? ? ? ? ? ? ? ? <0.12054.0>,<0.12064.0>,
>> ? ? ? ? ? ? ? ? ? ? ? ? <<"federation: usage -> rabbit at dc2rabbitmq3">>,
>> ? ? ? ? ? ? ? ? ? ? ? ? <<"federation: usage -> rabbit at dc2rabbitmq3 A">>,
>> ? ? ? ? ? ? ? ? ? ? ? ? {0,nil},
>> ? ? ? ? ? ? ? ? ? ? ? ? 2,
>> ? ? ? ? ? ? ? ? ? ? ? ? {dict,1,16,16,8,80,48,
>> ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>> ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?[[{<<"#">>,[]}|
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{set,1,16,16,8,80,48,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[]},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{[],[],[],[],[],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [{resource,<<"/">>,queue,<<"pit.stop">>}],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[],[],[],[],[],[],[],[],[]}}}]],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[],[],[],[],[],[],[],[],[]}}},
>> ? ? ? ? ? ? ? ? ? ? ? ? <0.12042.0>,<0.12049.0>,
>> ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,exchange,<<"usage">>},
>> ? ? ? ? ? ? ? ? ? ? ? ? {0,nil}}
>> ** Reason for termination ==
>> ** {badarg,[{erlang,list_to_binary,[dc2tcserver2]},
>> ? ? ? ? ? ?{rabbit_federation_upstream,to_table,1},
>> ? ? ? ? ? ?{rabbit_federation_link,handle_info,2},
>> ? ? ? ? ? ?{gen_server2,handle_msg,2},
>> ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}
>>
>> Only difference is the upstream server is running 2.7.1.
>>
>>
>> Thanks,
>> James
>>
>>
>> On Thu, Mar 15, 2012 at 12:00 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>>> On 15/03/12 11:44, Steve Powell wrote:
>>>>
>>>> Logging ssl detail is a little scary; though the log could add some more
>>>> information. We'll improve that.
>>>
>>>
>>> Bah. I thought this was getting pushed through a generic login function that
>>> would log failures. But no. Clearly the username should end up somewhere.
>>>
>>>
>>>> The DN/CN issues were discussed recently, but I'll leave it to Simon to
>>>> explain our position on that.
>>>
>>>
>>> It defaults to doing the best impersonation it can of a DN produced by the
>>> OpenSSL's -nameopt RFC2253, and can be switched to using (a concatenation
>>> of) the CN(s) with:
>>>
>>> {rabbit, [{ssl_cert_login_from, common_name}]}
>>>
>>> So if there's one thing I've learnt from this preview release thing, it's
>>> that we also need a preview release of all the documentation. Hmm...
>>>
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From hcoyote at ghostar.org  Thu Mar 15 19:57:28 2012
From: hcoyote at ghostar.org (Travis)
Date: Thu, 15 Mar 2012 14:57:28 -0500
Subject: [rabbitmq-discuss] Cluster fails when current primary node shuts
	down.
Message-ID: <CAChq9g33wZVMFUvba04S+ZbPKNDharX+4LAgc_wt3t+aQFUO3Q@mail.gmail.com>

We're running RabbitMQ 2.7.1 on CentoOS 5.6 with erlang R14B in a
clustered configuration with mirrored queues.

Both nodes in the cluster are configured as disc nodes.

Yesterday, we attempted to force a failover of the cluster from
machineA to machineB, by doing a

  service rabbitmq-server stop

on machineA.

When this completed on machineA, instead of the cluster failing over,
the rabbitmq on machineB died.  What we then noticed was that when we
tried to start up machineB's rabbitmq-server, it would fail the
startup process.  machineB would only ever start up if machineA's
rabbitmq-server was started first.

note:  this is ONLY happening on our production cluster; I can't seem
to reproduce it in our QA environment.  I suspect something is whacked
in cluster config in production.

Anyone else seen this?  Is service rabbitmq-server stop sufficient to
cause a safe failover?  Or is there a more preferred way?

Unfortunately, I don't have the log messages from machineB's
rabbitmq-server because it appears that they get overwritten upon
subsequent restarts of rabbitmq. :-(

Travis
-- 
Travis Campbell
travis at ghostar.org

From emile at rabbitmq.com  Thu Mar 15 22:59:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 15 Mar 2012 22:59:00 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
Message-ID: <4F627434.3000405@rabbitmq.com>


Hi John,

On 15/03/12 20:54, John Stoner wrote:
> OK, I don't think it's the firewall. 4369 is open to TCP (we tried
> adding UDP. Didn't help). Plus when I do a tcpdump, I see packets
> received on small01 on 'rabbitmqctl cluster rabbitmq-small01-dev'. 

The EPMD port is necessary but not sufficient. From the details provided
in your previous email you would have needed to open port 57641 also.
This is a random port. Do you see packets on this port in your network
trace?

I would suggest temporarily eliminating the firewall entirely for
debugging purposes. See the firewall section on the clustering page for
configuration details:

https://www.rabbitmq.com/clustering.html


-Emile


From johnstoner2 at gmail.com  Fri Mar 16 00:02:28 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Thu, 15 Mar 2012 19:02:28 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
Message-ID: <CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>

aack--I'm wrong, but not really. Looking again I see:

config file(s) : (none)

On Thu, Mar 15, 2012 at 7:00 PM, John Stoner <johnstoner2 at gmail.com> wrote:

> OK, I'm checking about deactivating the firewall with the people working
> with me on this.
>
> Following your link, I see
>
> Once a distributed Erlang node address has been resolved via epmd, other
> nodes will attempt to communicate directly with that address using the
> Erlang distributed node protocol. The port range for this communication can
> be configured with two parameters for the Erlang kernel application:
>
>    - inet_dist_listen_min
>    - inet_dist_listen_max
>
> Firewalls must permit traffic in this range to pass between clustered
> nodes (assuming all nodes use the same port range). The default port range
> is unrestricted.
>
> The Erlang kernel_app manpage<http://www.erlang.org/doc/man/kernel_app.html> contains
> more details on the port range that distributed Erlang nodes listen on. See
> the configuration <http://www.rabbitmq.com/configure.html> page for
> information on how to create and edit a configuration file.
>
> following the configuration page link I see
>
> Verify Configuration
>
> The active configuration can be verified in the startup banner, e.g. the
> active configuration file:
>
> config file(s) : /etc/rabbitmq/rabbitmq.config
>
>
> which I'm not seeing. I have an empty /etc/rabbitmq, and when I stop and
> restart rabbitmq I don't see any mention of a config file.
>
>
> On Thu, Mar 15, 2012 at 5:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi John,
>>
>> On 15/03/12 20:54, John Stoner wrote:
>> > OK, I don't think it's the firewall. 4369 is open to TCP (we tried
>> > adding UDP. Didn't help). Plus when I do a tcpdump, I see packets
>> > received on small01 on 'rabbitmqctl cluster rabbitmq-small01-dev'.
>>
>> The EPMD port is necessary but not sufficient. From the details provided
>> in your previous email you would have needed to open port 57641 also.
>> This is a random port. Do you see packets on this port in your network
>> trace?
>>
>> I would suggest temporarily eliminating the firewall entirely for
>> debugging purposes. See the firewall section on the clustering page for
>> configuration details:
>>
>> https://www.rabbitmq.com/clustering.html
>>
>>
>> -Emile
>>
>>
>
>
> --
> blogs:
> http://johnstoner.wordpress.com/
> 'In knowledge is power; in  wisdom, humility.'
>



-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120315/ef7173a0/attachment.htm>

From minaev at gmail.com  Fri Mar 16 09:49:34 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 16 Mar 2012 12:49:34 +0300
Subject: [rabbitmq-discuss] Customizing management plugin
Message-ID: <CANTUpDBZok1Azt7-pcvQ8cqNcDEonu6BB1Kdao84hkWr2FvJng@mail.gmail.com>

Hello,

We normally monitor Rabbit queues using 'rabbitmqctl' like this:

rabbitmqctl list_queues name messages_unacknowledged messages_ready
messages durable auto_delete pid arguments consumers

Seeing the number of consumers subscribed to each queue is very comfortable.

I've enabled management plugin today to see how it feels. Brilliant.
But it lacks that small feature, the number of consumers. Is there a
way I can customize the plugin to change the displayed columns? If
not, do you think it's possible to add the new column in the new
release of the plugin?

Thank you.

-- 
With best regards,
Dmitri Minaev

From shammi at arosys.com  Fri Mar 16 10:18:00 2012
From: shammi at arosys.com (cheepu)
Date: Fri, 16 Mar 2012 03:18:00 -0700 (PDT)
Subject: [rabbitmq-discuss] How to persist message when mq server restarts?
Message-ID: <33516102.post@talk.nabble.com>


Hi,
I am using RabbitMQ2.7 and having following code for the Publisher 

public void producer(String message,int noOfMessage) {
         try {
            String exchangeType = "direct";
            boolean durable = true;
            channel = mqConnection.createChannel();         
            channel.exchangeDeclare(exchangeName, exchangeType, durable);
            channel.queueDeclare(queueName, durable, false, false, null);
            channel.queueBind(queueName, exchangeName, routekeyName);
            channel.basicQos(1);
            QueueingConsumer consumer = new QueueingConsumer(channel);
            channel.basicConsume(queueName, false, consumer); //false

            AMQP.BasicProperties props = new AMQP.BasicProperties();
           
props.builder().type("application/octet-stream").deliveryMode(2).build();
            int counter = 0;
            while (counter++<noOfMessage) {                
                 byte[] messageBodyBytes=message.getBytes();
                 channel.basicPublish(exchangeName, routekeyName, props,
messageBodyBytes);
                 logger.info("Message Published: "+counter+" "+message);
        }  // end of While


        } catch (Exception e) {
            logger.error("Exception "+e);
        }

Messages are persistent when the server is running but when I restart the
server all the published messages are lost. For now there are no consumer
running.
As I know that for persistence of message queue should be durable and
deliveryMode should be 2 and I have configured that. What additional setting
needs to be done for the persistence of message even after the server goes
down?

Thanks 
-- 
View this message in context: http://old.nabble.com/How-to-persist-message-when-mq-server-restarts--tp33516102p33516102.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Fri Mar 16 10:24:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Mar 2012 10:24:48 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
Message-ID: <4F6314F0.2060400@rabbitmq.com>

Hi John,

On 16/03/12 05:41, John Stoner wrote:
> OK, I got it to start with a good config file. what's an appropriate
> range for these port numbers?

You are free to use any unused port range between 1024 and 65536.


-Emile


From simon at rabbitmq.com  Fri Mar 16 10:30:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Mar 2012 10:30:12 +0000
Subject: [rabbitmq-discuss] Customizing management plugin
In-Reply-To: <CANTUpDBZok1Azt7-pcvQ8cqNcDEonu6BB1Kdao84hkWr2FvJng@mail.gmail.com>
References: <CANTUpDBZok1Azt7-pcvQ8cqNcDEonu6BB1Kdao84hkWr2FvJng@mail.gmail.com>
Message-ID: <4F631634.3020105@rabbitmq.com>

On 16/03/12 09:49, Dmitri Minaev wrote:
> Hello,
>
> We normally monitor Rabbit queues using 'rabbitmqctl' like this:
>
> rabbitmqctl list_queues name messages_unacknowledged messages_ready
> messages durable auto_delete pid arguments consumers
>
> Seeing the number of consumers subscribed to each queue is very comfortable.
>
> I've enabled management plugin today to see how it feels. Brilliant.
> But it lacks that small feature, the number of consumers. Is there a
> way I can customize the plugin to change the displayed columns? If
> not, do you think it's possible to add the new column in the new
> release of the plugin?

Hmm. There's currently no way to customise the columns in the web UI. We 
could add another column, but I'm already worried about the number of 
columns in the queue list. I'll have a think about this.

Of course, this information is exposed by the underlying HTTP API, but 
that's probably not what you're asking...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From minaev at gmail.com  Fri Mar 16 10:36:18 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 16 Mar 2012 13:36:18 +0300
Subject: [rabbitmq-discuss] Customizing management plugin
In-Reply-To: <4F631634.3020105@rabbitmq.com>
References: <CANTUpDBZok1Azt7-pcvQ8cqNcDEonu6BB1Kdao84hkWr2FvJng@mail.gmail.com>
	<4F631634.3020105@rabbitmq.com>
Message-ID: <CANTUpDCzb0LhkRe7bPQxP9Rmm+=TeZcEWVpA4i0L0x7pokPGgw@mail.gmail.com>

On 16 March 2012 14:30, Simon MacMullen <simon at rabbitmq.com> wrote:

>> I've enabled management plugin today to see how it feels. Brilliant.
>> But it lacks that small feature, the number of consumers. Is there a
>> way I can customize the plugin to change the displayed columns? If
>> not, do you think it's possible to add the new column in the new
>> release of the plugin?
>
> Of course, this information is exposed by the underlying HTTP API, but
> that's probably not what you're asking...

Not really :). I've seen the number of consumers in the queue details,
but seeing them all together on one page, in a table, might simplify
things some.

-- 
With best regards,
Dmitri Minaev

From simon at rabbitmq.com  Fri Mar 16 10:36:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Mar 2012 10:36:43 +0000
Subject: [rabbitmq-discuss] How to persist message when mq server
	restarts?
In-Reply-To: <33516102.post@talk.nabble.com>
References: <33516102.post@talk.nabble.com>
Message-ID: <4F6317BB.7030107@rabbitmq.com>

On 16/03/12 10:18, cheepu wrote:
> Messages are persistent when the server is running but when I restart the
> server all the published messages are lost. For now there are no consumer
> running.

You are not using confirms or transactions - therefore you are telling 
RabbitMQ that the messages should be persisted, but not that there is 
any rush to do so. And RabbitMQ 2.7.1 will really not rush to do so in 
this situation.

The upcoming 2.8.0 release will be more aggressive about persisting 
messages in the absence of confirms / tx, but there is always the 
possibility of message loss if you are just asking RabbitMQ to persist 
the messages, but not tell you when it has done so.

I would suggest that you either:

* Wrap a batch of publishes in a transaction. When the transaction has 
committed, you know the messages are on disc.

* Switch on confirm mode, and every so often invoke the convenience 
method Channel.waitForConfirms(). When this has returned, you know the 
messages are on disc.

* For best performance, switch on confirm mode and add a confirm 
listener to your channel. You will then get notified whenever a message 
or batch of messages makes it to disc.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.spibey at gmail.com  Fri Mar 16 08:46:09 2012
From: james.spibey at gmail.com (James Spibey)
Date: Fri, 16 Mar 2012 01:46:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Beginner to message and RabbitMQ
Message-ID: <13053280.520.1331887569134.JavaMail.geo-discussion-forums@vbut24>

Hi,

I'm trying to determine if RabbitMQ is the right solution for me, and I was 
hoping someone here might be able to help answer a couple of questions?

The app I'm working on is fairly simple, a user creates a listing which 
they can then post to a website, but also post links to twitter and 
facebook and send out a bulk email to a list of subscribers. At the moment 
this is all done synchronously when the user saves the listing through a 
web site, but I would like to use a queue to increase the reliability of 
the solution. 

The following is how I think the new solution might work:-

1) User posts new listing through web app which we commit to database.
2) Listing is reformatted for each of Twitter/Facebook/Email and committed 
to the database.
2) Listing is added to a message queue.
3) Background process(es) read the queue and submit to facebook, twitter 
and email (SMTP).
4) User is notified if anything went wrong.

So my questions:-

- If this a good idea or am I thinking of queues in the wrong way?
- The listing is committed to the database, but at the moment we also 
persist the twitter/facebook/email messages to the database too because 
they are formatted differently. Should we continue to do this or should 
those just be RabbitMQ messages? I don't suppose we really need to be able 
to see those (except for debugging)
- Should the Message which is sent to the Queue be everything which the 
consumer needs to process the message or is it acceptable to just send a 
primary key and have the consumer (background process) fetch it from the 
database?
- How do I notify the client of a failure? Ideally I'd like to be able to 
present it back in the web app UI

Sorry for all the questions, I appreciate any help you can give

Regards

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/e3862c61/attachment.htm>

From simon at rabbitmq.com  Fri Mar 16 10:46:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Mar 2012 10:46:53 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <CAJreXKC8uZHEMO-E+OTv=hyWLvoAN2_jrtuF=ATSLE+OQ6j4TQ@mail.gmail.com>
References: <4F58F27B.5030209@rabbitmq.com>	<bw7mx7j1ep9.fsf@mail.cern.ch>	<4F60A3C8.1080504@rabbitmq.com>	<20320.42646.772214.890151@mail.cern.ch>	<4F60AA5D.1030907@rabbitmq.com>	<20320.44651.11407.44766@mail.cern.ch>	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>	<4F622015.3@rabbitmq.com>	<CAJreXKBQ8+pMc-5k-HFNk9Rc461Lk6FjdjY6L9jm5jmt5gjeJw@mail.gmail.com>	<CAJreXKDUMpEDoFn+TYqVE63nTu+6H5aaucD-Hrzt_FOrtdzJCQ@mail.gmail.com>
	<CAJreXKC8uZHEMO-E+OTv=hyWLvoAN2_jrtuF=ATSLE+OQ6j4TQ@mail.gmail.com>
Message-ID: <4F631A1D.8070500@rabbitmq.com>

On 15/03/12 19:44, James Carr wrote:
> Here's my configuration file for the downstream server:
>                      {host, 'dc2tcserver1'},

This is, I'm afraid, the problem.

In the configuration file, single and double quotes have different 
meanings - double quotes delimit strings, while single quotes optionally 
delimit atoms. You need a string there.

Yes, this is confusing. Not sure what the solution is.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Steve.Hurdsfield at TraderMedia.co.uk  Fri Mar 16 13:44:43 2012
From: Steve.Hurdsfield at TraderMedia.co.uk (Steve Hurdsfield)
Date: Fri, 16 Mar 2012 13:44:43 +0000
Subject: [rabbitmq-discuss] using load balancer with consumers to support
 automatic reconnection for node failure
Message-ID: <EE7965F7899C8844AFB99DE0EF3EAF56CB99812F41@TMG-E2K7CCR2.group.tradermedia.co.uk>

Were trying to use a load balanced address for the rabbit mq nodes with no luck in our Consumer code. The idea being that if we get an error due to the node going down we reconnect on the Load Balanced addres and get the other node that is running.

We are not having much luck. It works for a while but then we get "Connection Reset" errors every few minutes. Taking the 2nd node out of the pool makes it work but obviously that's not what we want. Using the "real" node address also works. I know we can do this through code using the conenctionFactory.newConnention(...Address[] addresses) method but would have preferred to do this using hardware load balancer.



________________________________________


This e-mail is sent on behalf of Trader Media Group Limited, Registered Office: Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower Earley, Reading, Berkshire, RG6 4UT(Registered in England No. 4768833). This email and any files transmitted with it are confidential and may be legally privileged, and intended solely for the use of the individual or entity to whom they are addressed. If you have received this email in error please notify the sender. This email message has been swept for the presence of computer viruses. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/45efdb69/attachment.htm>

From codevalid at gmail.com  Fri Mar 16 17:04:56 2012
From: codevalid at gmail.com (Ravicn)
Date: Fri, 16 Mar 2012 10:04:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Question on Queue
Message-ID: <ac071de2-5bb6-4828-9267-0c318037318c@fk28g2000vbb.googlegroups.com>

Hi,

I have just started with RabbitMq. I tired to create a que and bind it
to an exchange, which seems to work ok, but form the adminUI, when i
look at the queue that i created, it seems to be bound to the default
AND my declared exchange. Please let me know if that is the right
behaviour.

Regards
Ravicn

From simon at rabbitmq.com  Fri Mar 16 17:19:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Mar 2012 17:19:57 +0000
Subject: [rabbitmq-discuss] Question on Queue
In-Reply-To: <ac071de2-5bb6-4828-9267-0c318037318c@fk28g2000vbb.googlegroups.com>
References: <ac071de2-5bb6-4828-9267-0c318037318c@fk28g2000vbb.googlegroups.com>
Message-ID: <4F63763D.1050106@rabbitmq.com>

On 16/03/12 17:04, Ravicn wrote:
> I have just started with RabbitMq. I tired to create a que and bind it
> to an exchange, which seems to work ok, but form the adminUI, when i
> look at the queue that i created, it seems to be bound to the default
> AND my declared exchange. Please let me know if that is the right
> behaviour.

Yes.

All queues are automatically and implicitly bound to the default exchange.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From johnstoner2 at gmail.com  Fri Mar 16 17:25:02 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Fri, 16 Mar 2012 12:25:02 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
Message-ID: <CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>

[Just a bit of context, some of this conversation happened off list--I'm
trying to start a rabbitmq cluster on some firewalled EC2 instances, and
Emile has been helping me identify all the details about ports and
configuration and all that good stuff.]

We're looking to open fewer ports, not more.* *Is there a minimum we could
do? Would one work, or would it break something else?

Also, we have these ports open to all TCP.  In the spirit of securing our
systems, I guess we could open 4369 only to the IPs of the other machines
in the cluster. Is that a good idea? Can you think of more firewall
restrictions to add?

On Fri, Mar 16, 2012 at 5:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi John,
>
> On 16/03/12 05:41, John Stoner wrote:
> > OK, I got it to start with a good config file. what's an appropriate
> > range for these port numbers?
>
> You are free to use any unused port range between 1024 and 65536.
>
>
> -Emile
>
>

-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/e0a71e66/attachment.htm>

From k4t3r1n4 at gmail.com  Fri Mar 16 17:28:27 2012
From: k4t3r1n4 at gmail.com (Katerina Roukounaki)
Date: Fri, 16 Mar 2012 19:28:27 +0200
Subject: [rabbitmq-discuss] Run RabbitMQ server with N scheduler threads
Message-ID: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>

Hi!

Since the RabbitMQ server is an Erlang application, I wanted to see whether
it runs faster as I increase the number of scheduler threads in the Erlang
VM that runs it (+S option of the erl program).

For this purpose, I wrote a simple benchmark (in Erlang) that spawns P
producer and P consumer processes and creates P queues. The i-th producer
sends M messages to the i-th queue and the i-th consumer waits to receive
them. My benchmark uses native Erlang messaging for sending and receiving
messages.

I attach the results I get when I run the benchmark with P=M=1000 on a
machine with 16 cores and assign 1, 2, ?, 16 scheduler threads to the VM
that runs the RabbitMQ server.

As you can see, things get better up to 6 schedulers, but with 7 or more
schedulers it seems that there is no further speedup.
Do you have any idea why this is happening?
Is there some kind of synchronization among the processes that the RabbitMQ
server spawns that explains it or should I look for bugs in my benchmark?


Thanks!
Katerina
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/44a0e6e1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_onetoone_direct-time.ps
Type: application/postscript
Size: 17853 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/44a0e6e1/attachment.ps>

From jerryk at vmware.com  Fri Mar 16 17:39:46 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 16 Mar 2012 10:39:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Question on Queue
In-Reply-To: <4F63763D.1050106@rabbitmq.com>
Message-ID: <2be00c9f-0302-42e4-8f37-3d70a7679d68@strongmad.batnest.org>

And the default exchange can look a bit surprising at first in the management
UI since its zero length / empty string name causes it to be rendered as
nearly circular, rather than the rounded corners box that a non-empty named
exchange would get... :-)  The first time I saw it I'm not sure I realized
what it was until I moused over it and the bindings appeared...

Best regards,
Jerry

----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Ravicn" <codevalid at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 16, 2012 10:19:57 AM
Subject: Re: [rabbitmq-discuss] Question on Queue

On 16/03/12 17:04, Ravicn wrote:
> I have just started with RabbitMq. I tired to create a que and bind it
> to an exchange, which seems to work ok, but form the adminUI, when i
> look at the queue that i created, it seems to be bound to the default
> AND my declared exchange. Please let me know if that is the right
> behaviour.

Yes.

All queues are automatically and implicitly bound to the default exchange.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From carl.hoerberg at gmail.com  Fri Mar 16 17:43:57 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Fri, 16 Mar 2012 18:43:57 +0100
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
Message-ID: <CAFPidkNpbWH8sNx-7fg8V_UkLEkNpEVtSE5ZJZnNL8wnupBAQQ@mail.gmail.com>

you can allow traffic only between instances in the same security group by
setting the "source" field to the id of the security group

http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/using-network-security.html#adding-security-group-rule

On Fri, Mar 16, 2012 at 18:25, John Stoner <johnstoner2 at gmail.com> wrote:

> [Just a bit of context, some of this conversation happened off list--I'm
> trying to start a rabbitmq cluster on some firewalled EC2 instances, and
> Emile has been helping me identify all the details about ports and
> configuration and all that good stuff.]
>
> We're looking to open fewer ports, not more.* *Is there a minimum we
> could do? Would one work, or would it break something else?
>
> Also, we have these ports open to all TCP.  In the spirit of securing our
> systems, I guess we could open 4369 only to the IPs of the other machines
> in the cluster. Is that a good idea? Can you think of more firewall
> restrictions to add?
>
> On Fri, Mar 16, 2012 at 5:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
> Hi John,
>>
>> On 16/03/12 05:41, John Stoner wrote:
>> > OK, I got it to start with a good config file. what's an appropriate
>> > range for these port numbers?
>>
>> You are free to use any unused port range between 1024 and 65536.
>>
>>
>> -Emile
>>
>>
>
> --
> blogs:
> http://johnstoner.wordpress.com/
> 'In knowledge is power; in  wisdom, humility.'
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/ef59b159/attachment.htm>

From emile at rabbitmq.com  Fri Mar 16 17:56:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Mar 2012 17:56:57 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
Message-ID: <4F637EE9.5080503@rabbitmq.com>


Hi John,

I assume that you established the reason for the clustering problems
encountered earlier was due to firewall configuration.

On 16/03/12 17:25, John Stoner wrote:
> We're looking to open fewer ports, not more./ /Is there a minimum we
> could do? Would one work, or would it break something else?

One port is possible (then inet_dist_listen_min = inet_dist_listen_max),
but a small number like 5 is more common. Avoid the ephemeral port range
when you make your selection.

> Also, we have these ports open to all TCP.  In the spirit of securing
> our systems, I guess we could open 4369 only to the IPs of the other
> machines in the cluster. Is that a good idea? Can you think of more
> firewall restrictions to add?

As discussed previously and above, you need to open at least one port in
addition to the one used by the port mapper daemon. You are free to add
further firewall restrictions, as long as all clusternodes are
accessible from all other clusternodes on the relevant ports, as
discussed here:

http://www.rabbitmq.com/clustering.html#firewall



-Emile


From mcumings at narrativescience.com  Fri Mar 16 18:37:44 2012
From: mcumings at narrativescience.com (Michael Cumings)
Date: Fri, 16 Mar 2012 13:37:44 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <4F637EE9.5080503@rabbitmq.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
	<4F637EE9.5080503@rabbitmq.com>
Message-ID: <CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>

So what is the considerations on having 5 over 10 or 1?  Is there a
reasonable criteria that can be used to determine what an appropriate
number of ports that should be allocated?

On Fri, Mar 16, 2012 at 12:56 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi John,
>
> I assume that you established the reason for the clustering problems
> encountered earlier was due to firewall configuration.
>
> On 16/03/12 17:25, John Stoner wrote:
> > We're looking to open fewer ports, not more./ /Is there a minimum we
> > could do? Would one work, or would it break something else?
>
> One port is possible (then inet_dist_listen_min = inet_dist_listen_max),
> but a small number like 5 is more common. Avoid the ephemeral port range
> when you make your selection.
>
> > Also, we have these ports open to all TCP.  In the spirit of securing
> > our systems, I guess we could open 4369 only to the IPs of the other
> > machines in the cluster. Is that a good idea? Can you think of more
> > firewall restrictions to add?
>
> As discussed previously and above, you need to open at least one port in
> addition to the one used by the port mapper daemon. You are free to add
> further firewall restrictions, as long as all clusternodes are
> accessible from all other clusternodes on the relevant ports, as
> discussed here:
>
> http://www.rabbitmq.com/clustering.html#firewall
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/7ac4c049/attachment.htm>

From jerryk at vmware.com  Fri Mar 16 19:02:26 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 16 Mar 2012 12:02:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F631A1D.8070500@rabbitmq.com>
Message-ID: <ed8e4317-44db-4af2-aad6-03265876a45a@strongmad.batnest.org>

James FWIW an thing to be mindful of in Erlang code or terms is that
double quotes, e.g. "foo", get used for strings, or lists of characters, 
while single quotes are used for Erlang atoms, e.g. 'foo'.  

You could write 'foo' as just foo with no adornment... you typically use 
the single quotes if your atom name contains characters that are allowed 
in atom names, but that would otherwise trip up the Erlang parser.

For e.g. foo-bar will look like an arithmetic operation trying to 
nonsensically subtract atom bar from atom foo, while if you wrap it as
'foo-bar' you disabuse the parser of its base instincts.

These are really easy to not spot when one's either sleepy, or feeding data
to something whose expectations aren't yet familiar...

Best regards,
Jerry


----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "James Carr" <james.r.carr at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 16, 2012 3:46:53 AM
Subject: Re: [rabbitmq-discuss] Experimenting with release candidates: RabbitMQ 2.7.9

On 15/03/12 19:44, James Carr wrote:
> Here's my configuration file for the downstream server:
>                      {host, 'dc2tcserver1'},

This is, I'm afraid, the problem.

In the configuration file, single and double quotes have different 
meanings - double quotes delimit strings, while single quotes optionally 
delimit atoms. You need a string there.

Yes, this is confusing. Not sure what the solution is.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From msteele at beringmedia.com  Fri Mar 16 20:37:39 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 16 Mar 2012 16:37:39 -0400
Subject: [rabbitmq-discuss] RabbitMQ - Esper and back
Message-ID: <CAH24rBOLz+o47vp0jU9NfPq1xN+29usHiRiVZ2Faeu0pkY=NnQ@mail.gmail.com>

Hi folks,

I'm wondering if anyone has put together an open source integration of
RabbitMQ and Esper.

A couple approaches could be taken to get the data moved around. The
cleanest way is probably an Esper input plugin. Would something like this
work? (
http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_jms_spring.html),
if there's already an easy integration path and I'm just too ignorant of
java to know it, then please clue me in.

Specifically, what I'm looking for is a daemon that reads messages off AMQP
(in XML format), and pushes them into Esper. With outputs of EPL queries
being pushed back into AMQP.

Example code that does something similar can be found in reconnoiter (
https://labs.omniti.com/labs/reconnoiter/browser), cepmon (
https://github.com/fetep/cepmon) and rocksteady (
http://code.google.com/p/rocksteady/source/browse/), although a more
generic approach using XML as the event format, and XPATH transormations
configured in a config file would make it generic.

Another approach could be to use the socket input plugin (
http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_socket.html)
and build a bridge app to push events in (would still need to figure out
how to get the events out).

Once a generic approach like this would be implemented, it would be trivial
to integrate various apps to emit to AMQP (eg: collectd/graphite/etc) and
then send outputs out (eg: pagerduty/nagios/etc).

Mark Steele, CISSP, CSM
Bering Media Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/6887613b/attachment.htm>

From johnstoner2 at gmail.com  Fri Mar 16 21:26:52 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Fri, 16 Mar 2012 16:26:52 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
	<4F637EE9.5080503@rabbitmq.com>
	<CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
Message-ID: <CAMXtMFB=-Z018VJFGGCO57U-QKAZe1BEWoPvZ5zSNScrz=n85g@mail.gmail.com>

ok...

still getting

March 16, 2012 @ 08:54:01PM: ~
[jstoner at rabbitmq-small02-dev]> sudo rabbitmqctl cluster
rabbit at rabbitmq-small01-dev
Clustering node 'rabbit at rabbitmq-small02-dev' with
['rabbit at rabbitmq-small01-dev'] ...
Error: {no_running_cluster_nodes,['rabbit at rabbitmq-small01-dev'],
                                 ['rabbit at rabbitmq-small01-dev']}


I changed the rabbitmq.config to

[
                {kernel,
                        [{inet_dist_listen_min, [some number]},
                         {inet_dist_listen_max, [another number]}]
                }
].


on both servers, and restarted.

I think we have the right ports open now.

The erlang cookie matches.

seeing traffic on 4369, but not the other ports.

What else could be wrong?

On Fri, Mar 16, 2012 at 1:37 PM, Michael Cumings <
mcumings at narrativescience.com> wrote:

> So what is the considerations on having 5 over 10 or 1?  Is there a
> reasonable criteria that can be used to determine what an appropriate
> number of ports that should be allocated?
>
>
> On Fri, Mar 16, 2012 at 12:56 PM, Emile Joubert <emile at rabbitmq.com>wrote:
>
>>
>> Hi John,
>>
>> I assume that you established the reason for the clustering problems
>> encountered earlier was due to firewall configuration.
>>
>> On 16/03/12 17:25, John Stoner wrote:
>> > We're looking to open fewer ports, not more./ /Is there a minimum we
>> > could do? Would one work, or would it break something else?
>>
>> One port is possible (then inet_dist_listen_min = inet_dist_listen_max),
>> but a small number like 5 is more common. Avoid the ephemeral port range
>> when you make your selection.
>>
>> > Also, we have these ports open to all TCP.  In the spirit of securing
>> > our systems, I guess we could open 4369 only to the IPs of the other
>> > machines in the cluster. Is that a good idea? Can you think of more
>> > firewall restrictions to add?
>>
>> As discussed previously and above, you need to open at least one port in
>> addition to the one used by the port mapper daemon. You are free to add
>> further firewall restrictions, as long as all clusternodes are
>> accessible from all other clusternodes on the relevant ports, as
>> discussed here:
>>
>> http://www.rabbitmq.com/clustering.html#firewall
>>
>>
>>
>> -Emile
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/b054e5be/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Fri Mar 16 21:32:21 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 16 Mar 2012 17:32:21 -0400
Subject: [rabbitmq-discuss] RabbitMQ - Esper and back
In-Reply-To: <CAH24rBOLz+o47vp0jU9NfPq1xN+29usHiRiVZ2Faeu0pkY=NnQ@mail.gmail.com>
References: <CAH24rBOLz+o47vp0jU9NfPq1xN+29usHiRiVZ2Faeu0pkY=NnQ@mail.gmail.com>
Message-ID: <CAM8fPiSHn-YRD+B9=5xJQsgm1QF4dr4QqTA1rAvyVMzLEFUVVw@mail.gmail.com>

Might it make sense to have an "esper" exchange-type, where the queries
would be on the bindings, and the inputs would be what were published to
the exchange (and of course other inputs sent to the engine externally)?

Tony


On 16 March 2012 16:37, Mark Steele <msteele at beringmedia.com> wrote:

> Hi folks,
>
> I'm wondering if anyone has put together an open source integration of
> RabbitMQ and Esper.
>
> A couple approaches could be taken to get the data moved around. The
> cleanest way is probably an Esper input plugin. Would something like this
> work? (
> http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_jms_spring.html),
> if there's already an easy integration path and I'm just too ignorant of
> java to know it, then please clue me in.
>
> Specifically, what I'm looking for is a daemon that reads messages off
> AMQP (in XML format), and pushes them into Esper. With outputs of EPL
> queries being pushed back into AMQP.
>
> Example code that does something similar can be found in reconnoiter (
> https://labs.omniti.com/labs/reconnoiter/browser), cepmon (
> https://github.com/fetep/cepmon) and rocksteady (
> http://code.google.com/p/rocksteady/source/browse/), although a more
> generic approach using XML as the event format, and XPATH transormations
> configured in a config file would make it generic.
>
> Another approach could be to use the socket input plugin (
> http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_socket.html)
> and build a bridge app to push events in (would still need to figure out
> how to get the events out).
>
> Once a generic approach like this would be implemented, it would be
> trivial to integrate various apps to emit to AMQP (eg:
> collectd/graphite/etc) and then send outputs out (eg: pagerduty/nagios/etc).
>
> Mark Steele, CISSP, CSM
> Bering Media Inc.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/fa3d29fb/attachment.htm>

From emile at rabbitmq.com  Fri Mar 16 22:03:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Mar 2012 22:03:10 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMXtMFB=-Z018VJFGGCO57U-QKAZe1BEWoPvZ5zSNScrz=n85g@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
	<4F637EE9.5080503@rabbitmq.com>
	<CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
	<CAMXtMFB=-Z018VJFGGCO57U-QKAZe1BEWoPvZ5zSNScrz=n85g@mail.gmail.com>
Message-ID: <4F63B89E.4080701@rabbitmq.com>

Hi John,

On 16/03/12 21:26, John Stoner wrote:
>     [jstoner at rabbitmq-small02-dev]> sudo rabbitmqctl cluster
>     rabbit at rabbitmq-small01-dev
>     Clustering node 'rabbit at rabbitmq-small02-dev' with
>     ['rabbit at rabbitmq-small01-dev'] ...
>     Error: {no_running_cluster_nodes,['rabbit at rabbitmq-small01-dev'],
>                                      ['rabbit at rabbitmq-small01-dev']}

Does the RabbitMQ logfile on rabbitmq-small01-dev contain an entry about
a connection attempt from a disallowed node? If it doesn't then
internode network traffic is probably being blocked by a firewall.

>     [
>                     {kernel,
>                             [{inet_dist_listen_min, [some number]},
>                              {inet_dist_listen_max, [another number]}]
>                     }
>     ].

You can confirm whether that has taken effect by checking the port
numbers returned by "epmd -names".

> seeing traffic on 4369, but not the other ports.

If you don't see other internode traffic on the configured port(s) then
then the firewall config needs to be updated.

I suggest independently testing the firewall config with another
application such as netcat to get some confidence that it is correct.
Alternatively temporarily eliminate the firewall entirely for debugging
purposes if possible.


-Emile

From msteele at beringmedia.com  Sat Mar 17 00:55:16 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 16 Mar 2012 20:55:16 -0400
Subject: [rabbitmq-discuss] RabbitMQ - Esper and back
In-Reply-To: <CAM8fPiSHn-YRD+B9=5xJQsgm1QF4dr4QqTA1rAvyVMzLEFUVVw@mail.gmail.com>
References: <CAH24rBOLz+o47vp0jU9NfPq1xN+29usHiRiVZ2Faeu0pkY=NnQ@mail.gmail.com>
	<CAM8fPiSHn-YRD+B9=5xJQsgm1QF4dr4QqTA1rAvyVMzLEFUVVw@mail.gmail.com>
Message-ID: <CAH24rBNGGyFYYc1Y2kb+-8LL25-StHA3PkmR3HP9m33oT3VqSQ@mail.gmail.com>

My initial thought was only worrying about AMQP as an input/output. I was
thinking something as simple (?) as an EsperIO plugin that would embed a
java amqp client. I'd expect deeper integration (like an specialized
exchange) might be more complicated to put together,  I don't know how hard
it would be to do the erlang-java glue.

Cheers

Mark

On Fri, Mar 16, 2012 at 5:32 PM, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> Might it make sense to have an "esper" exchange-type, where the queries
> would be on the bindings, and the inputs would be what were published to
> the exchange (and of course other inputs sent to the engine externally)?
>
> Tony
>
>
> On 16 March 2012 16:37, Mark Steele <msteele at beringmedia.com> wrote:
>
>> Hi folks,
>>
>> I'm wondering if anyone has put together an open source integration of
>> RabbitMQ and Esper.
>>
>> A couple approaches could be taken to get the data moved around. The
>> cleanest way is probably an Esper input plugin. Would something like this
>> work? (
>> http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_jms_spring.html),
>> if there's already an easy integration path and I'm just too ignorant of
>> java to know it, then please clue me in.
>>
>> Specifically, what I'm looking for is a daemon that reads messages off
>> AMQP (in XML format), and pushes them into Esper. With outputs of EPL
>> queries being pushed back into AMQP.
>>
>> Example code that does something similar can be found in reconnoiter (
>> https://labs.omniti.com/labs/reconnoiter/browser), cepmon (
>> https://github.com/fetep/cepmon) and rocksteady (
>> http://code.google.com/p/rocksteady/source/browse/), although a more
>> generic approach using XML as the event format, and XPATH transormations
>> configured in a config file would make it generic.
>>
>> Another approach could be to use the socket input plugin (
>> http://esper.codehaus.org/esperio-4.5.0/doc/reference/en/html/adapter_socket.html)
>> and build a bridge app to push events in (would still need to figure out
>> how to get the events out).
>>
>> Once a generic approach like this would be implemented, it would be
>> trivial to integrate various apps to emit to AMQP (eg:
>> collectd/graphite/etc) and then send outputs out (eg: pagerduty/nagios/etc).
>>
>> Mark Steele, CISSP, CSM
>> Bering Media Inc.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120316/944266b4/attachment.htm>

From Simone.Busoli at ferrari.com  Sat Mar 17 04:09:04 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Sat, 17 Mar 2012 04:09:04 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
Message-ID: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>

Hello, I've experienced an unexpected behavior with a federated exchange whereby messages would build-up on the upstream queue for no apparent reasons.
The network link seemed ok, as well as the two machines on which the brokers are installed.
I would like to know under which circumstances the federation plugin on the downstream would slowdown pulling messages from the upstream.

Thanks

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120317/a3d0fdad/attachment.htm>

From aloroi18 at gmail.com  Sun Mar 18 08:11:15 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Sun, 18 Mar 2012 01:11:15 -0700 (PDT)
Subject: [rabbitmq-discuss]  Sample example with Enqueue
Message-ID: <33525430.post@talk.nabble.com>


Hy,

Is there any easy example using the Enqueue() method (with Java or C#)?

I only found example with Dequeue

It would really help me

Thanks

-- 
View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From videlalvaro at gmail.com  Sun Mar 18 08:16:25 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 18 Mar 2012 09:16:25 +0100
Subject: [rabbitmq-discuss] Sample example with Enqueue
In-Reply-To: <33525430.post@talk.nabble.com>
References: <33525430.post@talk.nabble.com>
Message-ID: <8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>

See here:

http://www.rabbitmq.com/tutorials/tutorial-one-java.html

It's called basicPublish

-Alvaro

On Mar 18, 2012, at 9:11 AM, Bamboula wrote:

> 
> Hy,
> 
> Is there any easy example using the Enqueue() method (with Java or C#)?
> 
> I only found example with Dequeue
> 
> It would really help me
> 
> Thanks
> 
> -- 
> View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120318/7d3420b3/attachment.htm>

From aloroi18 at gmail.com  Sun Mar 18 08:27:40 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Sun, 18 Mar 2012 01:27:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Sample example with Enqueue
In-Reply-To: <8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>
References: <33525430.post@talk.nabble.com>
	<8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>
Message-ID: <33525476.post@talk.nabble.com>


It's not really clear. How can I do Enqueue using basicPublish?

thanks

Alvaro Videla-2 wrote:
> 
> See here:
> 
> http://www.rabbitmq.com/tutorials/tutorial-one-java.html
> 
> It's called basicPublish
> 
> -Alvaro
> 
> On Mar 18, 2012, at 9:11 AM, Bamboula wrote:
> 
>> 
>> Hy,
>> 
>> Is there any easy example using the Enqueue() method (with Java or C#)?
>> 
>> I only found example with Dequeue
>> 
>> It would really help me
>> 
>> Thanks
>> 
>> -- 
>> View this message in context:
>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Sent form my Nokia 1100
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525476.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From videlalvaro at gmail.com  Sun Mar 18 08:29:36 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 18 Mar 2012 09:29:36 +0100
Subject: [rabbitmq-discuss] Sample example with Enqueue
In-Reply-To: <33525476.post@talk.nabble.com>
References: <33525430.post@talk.nabble.com>
	<8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>
	<33525476.post@talk.nabble.com>
Message-ID: <76B80A00-59FD-4AF6-8D85-1AF7DE8DFAC4@gmail.com>

Well. Basic publish puts a message on the queue? so it will "enqueue" it.

Have you read the rest of the tutorials? Specifically take a look at this one: http://www.rabbitmq.com/tutorials/amqp-concepts.html

-Alvaro

On Mar 18, 2012, at 9:27 AM, Bamboula wrote:

> 
> It's not really clear. How can I do Enqueue using basicPublish?
> 
> thanks
> 
> Alvaro Videla-2 wrote:
>> 
>> See here:
>> 
>> http://www.rabbitmq.com/tutorials/tutorial-one-java.html
>> 
>> It's called basicPublish
>> 
>> -Alvaro
>> 
>> On Mar 18, 2012, at 9:11 AM, Bamboula wrote:
>> 
>>> 
>>> Hy,
>>> 
>>> Is there any easy example using the Enqueue() method (with Java or C#)?
>>> 
>>> I only found example with Dequeue
>>> 
>>> It would really help me
>>> 
>>> Thanks
>>> 
>>> -- 
>>> View this message in context:
>>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525476.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From aloroi18 at gmail.com  Sun Mar 18 08:45:11 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Sun, 18 Mar 2012 01:45:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Sample example with Enqueue
In-Reply-To: <76B80A00-59FD-4AF6-8D85-1AF7DE8DFAC4@gmail.com>
References: <33525430.post@talk.nabble.com>
	<8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>
	<33525476.post@talk.nabble.com>
	<76B80A00-59FD-4AF6-8D85-1AF7DE8DFAC4@gmail.com>
Message-ID: <33525507.post@talk.nabble.com>


My boss wants me to show him an example using ....Enqueue(object o).

I've read these tutorials, it didn't help me

Alvaro Videla-2 wrote:
> 
> Well. Basic publish puts a message on the queue? so it will "enqueue" it.
> 
> Have you read the rest of the tutorials? Specifically take a look at this
> one: http://www.rabbitmq.com/tutorials/amqp-concepts.html
> 
> -Alvaro
> 
> On Mar 18, 2012, at 9:27 AM, Bamboula wrote:
> 
>> 
>> It's not really clear. How can I do Enqueue using basicPublish?
>> 
>> thanks
>> 
>> Alvaro Videla-2 wrote:
>>> 
>>> See here:
>>> 
>>> http://www.rabbitmq.com/tutorials/tutorial-one-java.html
>>> 
>>> It's called basicPublish
>>> 
>>> -Alvaro
>>> 
>>> On Mar 18, 2012, at 9:11 AM, Bamboula wrote:
>>> 
>>>> 
>>>> Hy,
>>>> 
>>>> Is there any easy example using the Enqueue() method (with Java or C#)?
>>>> 
>>>> I only found example with Dequeue
>>>> 
>>>> It would really help me
>>>> 
>>>> Thanks
>>>> 
>>>> -- 
>>>> View this message in context:
>>>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> Sent form my Nokia 1100
>>> 
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> -- 
>> View this message in context:
>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525476.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Sent form my Nokia 1100
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525507.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simone.busoli at gmail.com  Sun Mar 18 11:42:58 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 18 Mar 2012 12:42:58 +0100
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>
Message-ID: <CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>

Following up on this issue, the problem has worsened to a great extent.
Here's a bit more information about the setup.
Two brokers B1 and B2, running version 2.7.1 and Erlang R14B04 on Windows,
about 15000 km away from each other. Both machines running the brokers are
physical machines with several cores, lots of RAM, fast disks, and reported
no problems in disk access, CPU or memory consumption.

We have two federated durable topic exchanges X1 and X2, the upstream
connection to the other broker is configured with an hearbeat of a few
seconds and the prefetch count is 100. X1 is bidirectionally federated with
max_hops = 1 to prevent messages from going in loops (which nonetheless
suffer the additional roundtrip before being discarded, a problem I
reported a while ago), X2 unidirectionally federated from B1 to B2.
Messages are all published on B1, all those published on X1 are persistent,
while those published on X2 aren't. Messages are published on X1 with an
average rate of 3 msg/sec, and on X2 with an average rate of 10 msg/sec.

What we experienced is that messages published on X1 queue up on the
outgoing queue on B1, and even worse on the outgoing queue on B2 (although
we don't care about them as the would be discarded once delivered thanks to
the max_hops setting). Looking at the Web UI it appears that the
acknowledges for those messages come in more slowly than messages are
published, but I really can't understand why this might be the case, given
the very low publish rate. The visible effect is a delay of even several
minutes between when a message is published on B1 and received on B2, but
again, only for the low-rate messages published on X1 (perhaps even worse
for the other direction if the messages were not thrown away by the
federation because of the max_hops setting, as the outgoing queue on B2 has
several thousands of messages versus the few hundreds of that on B1). In
other words, the only difference between the two federated exchanges
appears to be the bidirectionality of the first versus the
unidirectionality of the second and the fact that those published on the
first are persistent.
The logs of the two brokers contain apparently no relevant information, and
the network link between the two has always appeared to be in a good state.

Any help is appreciated

On Sat, Mar 17, 2012 at 05:09, Busoli, Simone <Simone.Busoli at ferrari.com>wrote:

>  Hello, I?ve experienced an unexpected behavior with a federated exchange
> whereby messages would build-up on the upstream queue for no apparent
> reasons.****
>
> The network link seemed ok, as well as the two machines on which the
> brokers are installed.****
>
> I would like to know under which circumstances the federation plugin on
> the downstream would slowdown pulling messages from the upstream.****
>
> ** **
>
> Thanks****
>
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e
> puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non e il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain
> information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the
> intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
>
> _________________________________________________________________________________________________________________
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120318/86227ae9/attachment.htm>

From matt.c.ward at gmail.com  Mon Mar 19 00:12:04 2012
From: matt.c.ward at gmail.com (Matthew Ward)
Date: Sun, 18 Mar 2012 17:12:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <4F61CD6C.4080006@rabbitmq.com>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>
	<4F61CD6C.4080006@rabbitmq.com>
Message-ID: <8574a318-6680-4bda-bdb3-c8c548e480ca@r2g2000pbs.googlegroups.com>

Is there a work-around / when will the bug fix be available? This is a
pretty crippling bug when trying to handle fault tolerance.

From alvinzmho at gmail.com  Mon Mar 19 02:19:33 2012
From: alvinzmho at gmail.com (AlvinRMQ)
Date: Sun, 18 Mar 2012 19:19:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Failure starting rabbitMQ broker
In-Reply-To: <4F61CC7E.4070209@rabbitmq.com>
References: <33397550.post@talk.nabble.com> <4F5491F4.7050202@rabbitmq.com>
	<33506992.post@talk.nabble.com> <4F61CC7E.4070209@rabbitmq.com>
Message-ID: <33528907.post@talk.nabble.com>



Nothing showed up in the sasl log. I have been restarting the ram node
first, but the disc node doesn't restart until the ram node has been
restarted. I think that shouldn't be a problem right?

I really have no idea why the ram node doesn't restart properly sometimes(
The disc node should be up). 
Do you think it could be a network issue? 



Simon MacMullen-2 wrote:
> 
> On 15/03/12 01:43, AlvinRMQ wrote:
>> Hi Simon,
>>
>> It failed to restart again today. And the log file appeared normal apart
>> from a warning mesage just prior to restarting the broker:
>>
>> =WARNING REPORT==== 15-Mar-2012::01:09:34 ===
>> exception on TCP connection<0.16970.16>  from 192.168.0.145:49366
>> connection_closed_abruptly
>>
>> I would think this is from one of the client machines shutting down.
> 
> Yes, that's just a client closing the socket without the AMQP close 
> handshake.
> 
> Did anything show up in the sasl log?
> 
>> Also, in which order should I restart the cluster of 2 nodes? Disc node
>> or
>> the ram node first?
> 
> You should start the disc node first, the RAM node won't know anything 
> if it's started first!
> 
> In 2.7.1 starting a RAM node first will give you an empty broker which 
> the disc node will then not cluster with. In 2.8.0 RAM nodes refuse to 
> start first.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Failure-starting-rabbitMQ-broker-tp33397550p33528907.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Mon Mar 19 10:20:36 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 19 Mar 2012 10:20:36 +0000
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
	<4F637EE9.5080503@rabbitmq.com>
	<CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
Message-ID: <4F670874.4060407@rabbitmq.com>

Hi Michael,

On 16/03/12 18:37, Michael Cumings wrote:
> So what is the considerations on having 5 over 10 or 1?  Is there a
> reasonable criteria that can be used to determine what an appropriate
> number of ports that should be allocated?

Convenience only, I think. It is possible to configure one or as many
unused ports as you like.


-Emile



From simon at rabbitmq.com  Mon Mar 19 10:20:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 10:20:06 +0000
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <8574a318-6680-4bda-bdb3-c8c548e480ca@r2g2000pbs.googlegroups.com>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>	<4F61CD6C.4080006@rabbitmq.com>
	<8574a318-6680-4bda-bdb3-c8c548e480ca@r2g2000pbs.googlegroups.com>
Message-ID: <4F670856.7070804@rabbitmq.com>

On 19/03/12 00:12, Matthew Ward wrote:
> Is there a work-around / when will the bug fix be available? This is a
> pretty crippling bug when trying to handle fault tolerance.

The bug I was referring to was just hiding the error message in the Java 
client (and will be fixed in 2.8.0). You need to look in the server logs 
to see what the server is objecting to.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 19 10:23:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 10:23:46 +0000
Subject: [rabbitmq-discuss] using load balancer with consumers to
 support automatic reconnection for node failure
In-Reply-To: <EE7965F7899C8844AFB99DE0EF3EAF56CB99812F41@TMG-E2K7CCR2.group.tradermedia.co.uk>
References: <EE7965F7899C8844AFB99DE0EF3EAF56CB99812F41@TMG-E2K7CCR2.group.tradermedia.co.uk>
Message-ID: <4F670932.6050400@rabbitmq.com>

On 16/03/12 13:44, Steve Hurdsfield wrote:
> We are not having much luck. It works for a while but then we get
> ?Connection Reset? errors every few minutes. Taking the 2^nd node out of
> the pool makes it work but obviously that?s not what we want. Using the
> ?real? node address also works. I know we can do this through code using
> the conenctionFactory.newConnention(?Address[] addresses) method but
> would have preferred to do this using hardware load balancer.

Not sure what to suggest - if connecting to the server directly works, 
but connecting through a load balancer gives TCP-level errors, that does 
rather suggest that the load balancer is at fault...

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 19 10:44:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 10:44:44 +0000
Subject: [rabbitmq-discuss] Cluster fails when current primary node
 shuts down.
In-Reply-To: <CAChq9g33wZVMFUvba04S+ZbPKNDharX+4LAgc_wt3t+aQFUO3Q@mail.gmail.com>
References: <CAChq9g33wZVMFUvba04S+ZbPKNDharX+4LAgc_wt3t+aQFUO3Q@mail.gmail.com>
Message-ID: <4F670E1C.4000104@rabbitmq.com>

On 15/03/12 19:57, Travis wrote:
> When this completed on machineA, instead of the cluster failing over,
> the rabbitmq on machineB died.  What we then noticed was that when we
> tried to start up machineB's rabbitmq-server, it would fail the
> startup process.  machineB would only ever start up if machineA's
> rabbitmq-server was started first.
>
> note:  this is ONLY happening on our production cluster; I can't seem
> to reproduce it in our QA environment.  I suspect something is whacked
> in cluster config in production.

OK, that's alarming.

> Anyone else seen this?  Is service rabbitmq-server stop sufficient to
> cause a safe failover?  Or is there a more preferred way?

There was a racy bug in a previous release that did this. That should 
really be fixed though. "service rabbitmq-server stop" should be fine.

> Unfortunately, I don't have the log messages from machineB's
> rabbitmq-server because it appears that they get overwritten upon
> subsequent restarts of rabbitmq.:-(

Unfortunately it's not easy for us to debug problems without them...

They really should get appended to rather than overwritten though (well 
apart from the stdout/err logs) - are you sure you don't have them?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From john.doe44210 at gmail.com  Mon Mar 19 11:07:17 2012
From: john.doe44210 at gmail.com (john doe)
Date: Mon, 19 Mar 2012 12:07:17 +0100
Subject: [rabbitmq-discuss] dealing with poison-pill messages
Message-ID: <CALbPevmQ47tcymTCo02gWyuB5ebXvRCtuFkgVXghBJ-n1ZQQrg@mail.gmail.com>

Hello there,

I am aware the topic is marked as "planned" in rabbitmq's roadmap, but
I'd like to have your opinion of a quick-and-dirty way to handle this.

So the issue here is that we want to deal with:
- the case where a consumer crashes or is stopped in the middle of
processing a message (we want the message to be sent to another
consumer)
- the case where a message is somehow corrupted and cause any consumer
to crash (we don't want all our consumers to crash)

Here is a solution proposal, using a special flag (I used
delivery.getProperties().getType()) on the message. When a consumer
get a message:
a) if isRedeliver=false and flag=false, consumer processes the message
the regular way, then it acks the message
b) if isRedeliver=true and flag=false, consumer duplicates message,
then enable the flag on the duplicated message, then send this new
message to its own queue and acks the original message without
actually processing it
c) if isRedeliver=false and flag=true, consumer knows that this
message may cause it to crash, but it will try to process it
d) if is Redeliver=true and flag=true, consumer knows that this
message already caused two consumers to crash, so it will acknowledge
the message without even processing it.

In case of a poison-pill scenario, steps a b c d will happen in that
very order and at most two consumers will die.

There is a corner case though: if during steps a) and c) consumer is
killed by something else, a message may be considered as harmful
whereas it is not. But that should not happen very often.

What do you think?

Thanks

John

From simon at rabbitmq.com  Mon Mar 19 11:25:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 11:25:50 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>
	<CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
Message-ID: <4F6717BE.4070103@rabbitmq.com>

Hmm. Well, this *should* be very simple - the federation plugin is a bit 
tricky in terms of how it gets everything set up, but once the link is 
up it really just consumes and republishes the messages.

Assuming you have an even slightly fast network link I can't imagine why 
either federation queue would end up with messages backing up.

So assuming you are not network bound we could start by figuring out 
what is stopping the messages getting delivered immediately. If the 
prefetch count is 100, does that mean the queue is showing 100 messages 
unacked (i.e. the delay is happening because the federated exchange is 
not consuming fast enough), or fewer (i.e. the broker is just not 
delivering the messages for some reason)?

Cheers, Simon

On 18/03/12 11:42, Simone Busoli wrote:
> Following up on this issue, the problem has worsened to a great extent.
> Here's a bit more information about the setup.
> Two brokers B1 and B2, running version 2.7.1 and Erlang R14B04 on
> Windows, about 15000 km away from each other. Both machines running the
> brokers are physical machines with several cores, lots of RAM, fast
> disks, and reported no problems in disk access, CPU or memory consumption.
>
> We have two federated durable topic exchanges X1 and X2, the upstream
> connection to the other broker is configured with an hearbeat of a few
> seconds and the prefetch count is 100. X1 is bidirectionally federated
> with max_hops = 1 to prevent messages from going in loops (which
> nonetheless suffer the additional roundtrip before being discarded, a
> problem I reported a while ago), X2 unidirectionally federated from B1
> to B2. Messages are all published on B1, all those published on X1 are
> persistent, while those published on X2 aren't. Messages are published
> on X1 with an average rate of 3 msg/sec, and on X2 with an average rate
> of 10 msg/sec.
>
> What we experienced is that messages published on X1 queue up on the
> outgoing queue on B1, and even worse on the outgoing queue on B2
> (although we don't care about them as the would be discarded once
> delivered thanks to the max_hops setting). Looking at the Web UI it
> appears that the acknowledges for those messages come in more slowly
> than messages are published, but I really can't understand why this
> might be the case, given the very low publish rate. The visible effect
> is a delay of even several minutes between when a message is published
> on B1 and received on B2, but again, only for the low-rate messages
> published on X1 (perhaps even worse for the other direction if the
> messages were not thrown away by the federation because of the max_hops
> setting, as the outgoing queue on B2 has several thousands of messages
> versus the few hundreds of that on B1). In other words, the only
> difference between the two federated exchanges appears to be the
> bidirectionality of the first versus the unidirectionality of the second
> and the fact that those published on the first are persistent.
> The logs of the two brokers contain apparently no relevant information,
> and the network link between the two has always appeared to be in a good
> state.

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 19 12:01:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 12:01:32 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
Message-ID: <4F67201C.3080604@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ
2.8.0.

This release fixes a number of bugs and adds new features. Notable new 
features include:

    - dead lettering - queues can specify an exchange to which
      messages should be redirected when they are rejected or expire

    - internal flow control to limit memory use and make performance
      more predictable if the server is overloaded

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
               The RabbitMQ Team
               (http://www.rabbitmq.com)

-- 
Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.0.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/295b7608/attachment.txt>

From Simone.Busoli at ferrari.com  Mon Mar 19 12:04:19 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 19 Mar 2012 12:04:19 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <4F6717BE.4070103@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it><CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
	<4F6717BE.4070103@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>

Hi Simon, I can't imagine why as well. The network connection is not that fast but it's a bunch of MBits, way more than is required to transfer those messages around.
The federation queue is indeed showing 100 unacked messages, with way more ready to be delivered. The downstream broker nonetheless doesn't give us any clue about that might be happening, although as I said the bidirectional federated exchange on B2 behaved way worse than B1 and the outgoing federation queue showed lots more ready messages then there were in B1.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: luned? 19 marzo 2012 12:26
To: Simone Busoli
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federated exchange slowdown

Hmm. Well, this *should* be very simple - the federation plugin is a bit tricky in terms of how it gets everything set up, but once the link is up it really just consumes and republishes the messages.

Assuming you have an even slightly fast network link I can't imagine why either federation queue would end up with messages backing up.

So assuming you are not network bound we could start by figuring out what is stopping the messages getting delivered immediately. If the prefetch count is 100, does that mean the queue is showing 100 messages unacked (i.e. the delay is happening because the federated exchange is not consuming fast enough), or fewer (i.e. the broker is just not delivering the messages for some reason)?

Cheers, Simon

On 18/03/12 11:42, Simone Busoli wrote:
> Following up on this issue, the problem has worsened to a great extent.
> Here's a bit more information about the setup.
> Two brokers B1 and B2, running version 2.7.1 and Erlang R14B04 on 
> Windows, about 15000 km away from each other. Both machines running 
> the brokers are physical machines with several cores, lots of RAM, 
> fast disks, and reported no problems in disk access, CPU or memory consumption.
>
> We have two federated durable topic exchanges X1 and X2, the upstream 
> connection to the other broker is configured with an hearbeat of a few 
> seconds and the prefetch count is 100. X1 is bidirectionally federated 
> with max_hops = 1 to prevent messages from going in loops (which 
> nonetheless suffer the additional roundtrip before being discarded, a 
> problem I reported a while ago), X2 unidirectionally federated from B1 
> to B2. Messages are all published on B1, all those published on X1 are 
> persistent, while those published on X2 aren't. Messages are published 
> on X1 with an average rate of 3 msg/sec, and on X2 with an average 
> rate of 10 msg/sec.
>
> What we experienced is that messages published on X1 queue up on the 
> outgoing queue on B1, and even worse on the outgoing queue on B2 
> (although we don't care about them as the would be discarded once 
> delivered thanks to the max_hops setting). Looking at the Web UI it 
> appears that the acknowledges for those messages come in more slowly 
> than messages are published, but I really can't understand why this 
> might be the case, given the very low publish rate. The visible effect 
> is a delay of even several minutes between when a message is published 
> on B1 and received on B2, but again, only for the low-rate messages 
> published on X1 (perhaps even worse for the other direction if the 
> messages were not thrown away by the federation because of the 
> max_hops setting, as the outgoing queue on B2 has several thousands of 
> messages versus the few hundreds of that on B1). In other words, the 
> only difference between the two federated exchanges appears to be the 
> bidirectionality of the first versus the unidirectionality of the 
> second and the fact that those published on the first are persistent.
> The logs of the two brokers contain apparently no relevant 
> information, and the network link between the two has always appeared 
> to be in a good state.

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From brendan at soundcloud.com  Mon Mar 19 12:24:21 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 19 Mar 2012 13:24:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
In-Reply-To: <4F67201C.3080604@rabbitmq.com>
References: <4F67201C.3080604@rabbitmq.com>
Message-ID: <CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>

Great news, Simon.

Would it be possible to describe in more (technical/erlangy) detail how the
new flow-control mechanism works?


On Mon, Mar 19, 2012 at 1:01 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ
> 2.8.0.
>
> This release fixes a number of bugs and adds new features. Notable new
> features include:
>
>   - dead lettering - queues can specify an exchange to which
>     messages should be redirected when they are rejected or expire
>
>   - internal flow control to limit memory use and make performance
>     more predictable if the server is overloaded
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list.
>
> Regards,
>              The RabbitMQ Team
>              (http://www.rabbitmq.com)
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/95971342/attachment.htm>

From videlalvaro at gmail.com  Mon Mar 19 12:27:35 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 19 Mar 2012 13:27:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
In-Reply-To: <CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
References: <4F67201C.3080604@rabbitmq.com>
	<CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
Message-ID: <CAMcAHLV_WE0zn4u+k8-sTkC=09mtmmE1Y3a80nLJOMqukQFvDQ@mail.gmail.com>

I particularly like this feature:

"- server no longer fails to start when a durable exchange is declared using
  an exchange type plugin which is subsequently disabled. Instead the exchange
  exists but routes no messages"

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/ed78aea8/attachment.htm>

From simon at rabbitmq.com  Mon Mar 19 12:36:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 12:36:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
In-Reply-To: <CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
References: <4F67201C.3080604@rabbitmq.com>
	<CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
Message-ID: <4F67283E.2010806@rabbitmq.com>

On 19/03/12 12:24, Brendan Hay wrote:
> Would it be possible to describe in more (technical/erlangy) detail how
> the new flow-control mechanism works?

There's a few words at:

http://www.rabbitmq.com/memory.html

under "Per-Connection Flow Control", although that might not count as 
"technical/erlangy". In terms of implementation:

* A process that forwards AMQP messages on inside the broker is issued 
credit for each process it sends messages to.

* The receiving process will issue more credit as it processes these 
messages.

* If a process which receives messages from inside the broker runs out 
of credit, it will in turn stop issuing credit until it gets more.

* If a process which receives messages from the network runs out of 
credit, it will stop reading from its socket until it gets more.

* See the 'credit_flow' module (and its call sites) for more details.

Since all the processes in the chain need to opt in to this new 
mechanism for it to work, only the most common paths do flow control: 
messages published via AMQP and STOMP. Messages published via other 
direct client users (e.g. JSON-RPC or management) and messages which 
arise spontaneously in the broker (dead lettering, log and trace 
messages) are not flow controlled. Indeed it's hard to see how they 
could be.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Mon Mar 19 12:41:45 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 19 Mar 2012 13:41:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
In-Reply-To: <4F67283E.2010806@rabbitmq.com>
References: <4F67201C.3080604@rabbitmq.com>
	<CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
	<4F67283E.2010806@rabbitmq.com>
Message-ID: <CAHZsVQaTxWZ-jkxhaOBh75+q3CHUtGMiuuUO+QR02GbJ7owRvQ@mail.gmail.com>

Interesting approach, thanks Simon

On Mon, Mar 19, 2012 at 1:36 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 19/03/12 12:24, Brendan Hay wrote:
>
>> Would it be possible to describe in more (technical/erlangy) detail how
>> the new flow-control mechanism works?
>>
>
> There's a few words at:
>
> http://www.rabbitmq.com/**memory.html<http://www.rabbitmq.com/memory.html>
>
> under "Per-Connection Flow Control", although that might not count as
> "technical/erlangy". In terms of implementation:
>
> * A process that forwards AMQP messages on inside the broker is issued
> credit for each process it sends messages to.
>
> * The receiving process will issue more credit as it processes these
> messages.
>
> * If a process which receives messages from inside the broker runs out of
> credit, it will in turn stop issuing credit until it gets more.
>
> * If a process which receives messages from the network runs out of
> credit, it will stop reading from its socket until it gets more.
>
> * See the 'credit_flow' module (and its call sites) for more details.
>
> Since all the processes in the chain need to opt in to this new mechanism
> for it to work, only the most common paths do flow control: messages
> published via AMQP and STOMP. Messages published via other direct client
> users (e.g. JSON-RPC or management) and messages which arise spontaneously
> in the broker (dead lettering, log and trace messages) are not flow
> controlled. Indeed it's hard to see how they could be.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/ce02d662/attachment.htm>

From Simone.Busoli at ferrari.com  Mon Mar 19 14:00:01 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 19 Mar 2012 14:00:01 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it><CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
	<4F6717BE.4070103@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>
Message-ID: <88E590DC4586974D825FC82AE798294E5210E745@GSVCLU03.ges.ferlan.it>

Hi Simon, I think I've mostly tracked down the issue to the symmetric setup of the federated exchanges between the two brokers. I noticed that whenever I start publishing messages to an exchange configured that way the network starts behaving in surprisingly ways. For instance, I can no longer get two machines connected directly by two network switches to ping each other. Stop publishing messages and everything goes back to a normal state. A federated exchange which goes in one direction only as well as a shovel instead behave just fine.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Busoli, Simone
Sent: luned? 19 marzo 2012 13:04
To: Simon MacMullen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federated exchange slowdown

Hi Simon, I can't imagine why as well. The network connection is not that fast but it's a bunch of MBits, way more than is required to transfer those messages around.
The federation queue is indeed showing 100 unacked messages, with way more ready to be delivered. The downstream broker nonetheless doesn't give us any clue about that might be happening, although as I said the bidirectional federated exchange on B2 behaved way worse than B1 and the outgoing federation queue showed lots more ready messages then there were in B1.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: luned? 19 marzo 2012 12:26
To: Simone Busoli
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Federated exchange slowdown

Hmm. Well, this *should* be very simple - the federation plugin is a bit tricky in terms of how it gets everything set up, but once the link is up it really just consumes and republishes the messages.

Assuming you have an even slightly fast network link I can't imagine why either federation queue would end up with messages backing up.

So assuming you are not network bound we could start by figuring out what is stopping the messages getting delivered immediately. If the prefetch count is 100, does that mean the queue is showing 100 messages unacked (i.e. the delay is happening because the federated exchange is not consuming fast enough), or fewer (i.e. the broker is just not delivering the messages for some reason)?

Cheers, Simon

On 18/03/12 11:42, Simone Busoli wrote:
> Following up on this issue, the problem has worsened to a great extent.
> Here's a bit more information about the setup.
> Two brokers B1 and B2, running version 2.7.1 and Erlang R14B04 on 
> Windows, about 15000 km away from each other. Both machines running 
> the brokers are physical machines with several cores, lots of RAM, 
> fast disks, and reported no problems in disk access, CPU or memory consumption.
>
> We have two federated durable topic exchanges X1 and X2, the upstream 
> connection to the other broker is configured with an hearbeat of a few 
> seconds and the prefetch count is 100. X1 is bidirectionally federated 
> with max_hops = 1 to prevent messages from going in loops (which 
> nonetheless suffer the additional roundtrip before being discarded, a 
> problem I reported a while ago), X2 unidirectionally federated from B1 
> to B2. Messages are all published on B1, all those published on X1 are 
> persistent, while those published on X2 aren't. Messages are published 
> on X1 with an average rate of 3 msg/sec, and on X2 with an average 
> rate of 10 msg/sec.
>
> What we experienced is that messages published on X1 queue up on the 
> outgoing queue on B1, and even worse on the outgoing queue on B2 
> (although we don't care about them as the would be discarded once 
> delivered thanks to the max_hops setting). Looking at the Web UI it 
> appears that the acknowledges for those messages come in more slowly 
> than messages are published, but I really can't understand why this 
> might be the case, given the very low publish rate. The visible effect 
> is a delay of even several minutes between when a message is published 
> on B1 and received on B2, but again, only for the low-rate messages 
> published on X1 (perhaps even worse for the other direction if the 
> messages were not thrown away by the federation because of the 
> max_hops setting, as the outgoing queue on B2 has several thousands of 
> messages versus the few hundreds of that on B1). In other words, the 
> only difference between the two federated exchanges appears to be the 
> bidirectionality of the first versus the unidirectionality of the 
> second and the fact that those published on the first are persistent.
> The logs of the two brokers contain apparently no relevant 
> information, and the network link between the two has always appeared 
> to be in a good state.

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from your system.
_________________________________________________________________________________________________________________


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Mar 19 14:18:35 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 09:18:35 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 released
In-Reply-To: <CAHZsVQaTxWZ-jkxhaOBh75+q3CHUtGMiuuUO+QR02GbJ7owRvQ@mail.gmail.com>
References: <4F67201C.3080604@rabbitmq.com>
	<CAHZsVQZPrfRzYDW5=pcVvKXHdrJcNNx3mmxTJfdhgNVrg0ojuA@mail.gmail.com>
	<4F67283E.2010806@rabbitmq.com>
	<CAHZsVQaTxWZ-jkxhaOBh75+q3CHUtGMiuuUO+QR02GbJ7owRvQ@mail.gmail.com>
Message-ID: <CAJreXKCXZ-U0WU+bCjsiwjnkKRwNuqD9Xuso-3PJNbtJL8sgpA@mail.gmail.com>

This release has two new features I've been wanting forever.

- dead lettering
- mirrored queues for federated exchanges

Thanks a lot guys. :)

Thanks,
James

On Mon, Mar 19, 2012 at 7:41 AM, Brendan Hay <brendan at soundcloud.com> wrote:
> Interesting approach, thanks Simon
>
>
> On Mon, Mar 19, 2012 at 1:36 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> On 19/03/12 12:24, Brendan Hay wrote:
>>>
>>> Would it be possible to describe in more (technical/erlangy) detail how
>>> the new flow-control mechanism works?
>>
>>
>> There's a few words at:
>>
>> http://www.rabbitmq.com/memory.html
>>
>> under "Per-Connection Flow Control", although that might not count as
>> "technical/erlangy". In terms of implementation:
>>
>> * A process that forwards AMQP messages on inside the broker is issued
>> credit for each process it sends messages to.
>>
>> * The receiving process will issue more credit as it processes these
>> messages.
>>
>> * If a process which receives messages from inside the broker runs out of
>> credit, it will in turn stop issuing credit until it gets more.
>>
>> * If a process which receives messages from the network runs out of
>> credit, it will stop reading from its socket until it gets more.
>>
>> * See the 'credit_flow' module (and its call sites) for more details.
>>
>> Since all the processes in the chain need to opt in to this new mechanism
>> for it to work, only the most common paths do flow control: messages
>> published via AMQP and STOMP. Messages published via other direct client
>> users (e.g. JSON-RPC or management) and messages which arise spontaneously
>> in the broker (dead lettering, log and trace messages) are not flow
>> controlled. Indeed it's hard to see how they could be.
>>
>> Cheers, Simon
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Mon Mar 19 14:26:53 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 09:26:53 -0500
Subject: [rabbitmq-discuss] Shovel vs. RabbitMQ
Message-ID: <CAJreXKD1xt7LwOotMjS8e3AsUgQH4jRnYEx0N==b3PWQ8Fi8aQ@mail.gmail.com>

While working on a new messaging topology for a client I've found
myself wondering if a hybrid of shovel / federation might be a valid
approach rather than just using federation. While I have several
clusters that will be located in different geographical locations
federated amongst themselves we have dynamically created "pods" that
are really kind of mini-datacenters for each application. Basically
each app has all the components it needs to function independently and
if messaging is required to update data or do things across pods the
pod will have it's own rabbitmq broker.

The pods get spinned up and destroyed dynamically. I keep wondering if
perhaps the pods should use shovel to shovel to the cluster on it's
segment or if I should just setup my puppet modules to declared a
federated exchange on the cluster for a freshly created pod? Both
approaches seem valid (and I'll experiment with both anyway) but I'm
just curious if anyone on the list has experience or recommendations
with this kind of setup.


Thanks,
James

From simon at rabbitmq.com  Mon Mar 19 14:27:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 14:27:35 +0000
Subject: [rabbitmq-discuss] Run RabbitMQ server with N scheduler threads
In-Reply-To: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>
References: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>
Message-ID: <4F674257.3090507@rabbitmq.com>

On 16/03/12 17:28, Katerina Roukounaki wrote:
> Since the RabbitMQ server is an Erlang application, I wanted to see
> whether it runs faster as I increase the number of scheduler threads in
> the Erlang VM that runs it (+S option of the erl program).
>
> For this purpose, I wrote a simple benchmark (in Erlang) that spawns P
> producer and P consumer processes and creates P queues. The i-th
> producer sends M messages to the i-th queue and the i-th consumer waits
> to receive them. My benchmark uses native Erlang messaging for sending
> and receiving messages.

So just to be clear: you are using the direct client? Or something else?

> I attach the results I get when I run the benchmark with P=M=1000 on a
> machine with 16 cores and assign 1, 2, ?, 16 scheduler threads to the VM
> that runs the RabbitMQ server.
>
> As you can see, things get better up to 6 schedulers, but with 7 or more
> schedulers it seems that there is no further speedup.
> Do you have any idea why this is happening?

At a guess: hyperthreading? I assume your machine is 8 physical cores 
and 16 hyperthreads. In which case the extra cores presented by 
hyperthreading are presumably not helping much.

But I'm not an expert on the Erlang scheduler.

> Is there some kind of synchronization among the processes that the
> RabbitMQ server spawns that explains it or should I look for bugs in my
> benchmark?

All your producer-queue-consumer chains are independent, right? So it's:

P1 -> Q1 -> C1
P2 -> Q2 -> C2

?

If so then there's no synchronisation between the processes done by 
RabbitMQ.

You might want to play with the other scheduler options. +sbt looks 
particularly interesting...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Mon Mar 19 14:43:55 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 09:43:55 -0500
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <4F61CBAC.2040203@rabbitmq.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>
	<4F61CBAC.2040203@rabbitmq.com>
Message-ID: <CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>

Hi,

So one problem I had while testing out federation across clusters with
is the upstream node eventually gets queues created for each
downstream node in the downstream cluster. For example from randomly
restarting downstream brokers I wind up with the following queues on
the upstream box:

federation: usage -> rabbit at dc2rabbitmq3
federation: usage -> rabbit at dc2rabbitmq4
federation: usage -> rabbit at dc2rabbitmq5
federation: usage -> rabbit at dc2rabbitmq6

This would seem to be okay but unfortunately when the downstream
cluster reconnects to the upstream, only one of the nodes (say 6 will
connect and empty its queue. 3, 4, and 5 will just sit there with
messages in them and will only get empty if one of those nodes happen
to reconnect when node 6 disconnects.

Is there a good solution to this? it seems like it might work if there
was someway for each of the 4 nodes to just use the same queue on the
upstream broker since they are logically part of the same group.

Thanks,
James


On Thu, Mar 15, 2012 at 5:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 14/03/12 20:34, James Carr wrote:
>>
>> I've been wondering what the "right" setup is to federate between
>> clusters. Do I just setup each node in the cluster to federate with
>> the upstream through the load balancer? My fear here is I'll end up
>> with with all the nodes on one cluster connected to a single node
>> (through the load balancer) and hence 3 sepeare queues causing
>> messages to be duplicated three times! :)
>
>
> You need to make sure that all nodes in the cluster have the federation
> plugin enabled, and have the same configuration. The federation plugin will
> then make sure that only one node establishes a link to the upstream (which
> will fail over to another node if that node goes down).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware

From DWise at capulaglobal.com  Mon Mar 19 14:48:06 2012
From: DWise at capulaglobal.com (Dan Wise)
Date: Mon, 19 Mar 2012 14:48:06 +0000
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
Message-ID: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>

Hi,

I have noticed that intermittently there is a problem with using the management plugin from Firefox (haven't reproduced on other browsers yet). After visiting the Exchanges page a few times it no longer displays, but reports as error:

ReferenceError: fmt_exchange_type is not defined

Thought I would report it.

Thanks,

Dan.


_____________________________________________________________________________________________
This email and any attachments are confidential, for the exclusive  attention of the recipient 
and may also be legally privileged or otherwise protected from disclosure.  No information 
contained herein shall be disclosed to any other person without our written consent unless 
it is clearly publicly available or otherwise specified by us for onward transmission.  
If you received this email in error, please notify the sender by return email or by telephone 
on +44 (0)20 7071 0900; do not duplicate or redistribute it by any means; and delete or 
otherwise destroy all copies whether in electronic or hard copy form. 
 
Any views contained in this email are those of the author and may not reflect those of any 
Capula entity.  We reserve the right to monitor and review all emails within our network to 
ensure compliance with our policies and to protect our business. Emails are not secure and 
are not warranted by us to be free of errors nor of viruses nor of other defects which may
affect a computer system. Anyone who communicates with us by email is taken to accept these 
risks. Unless specifically indicated, this email is not an offer or solicitation to buy or 
sell any investment product. Any information regarding investment products is subject to 
change without notice.     
 
Capula Investment Management LLP is registered in England no. OC313398 and is authorised 
and regulated by the Financial Services Authority.  Capula Investment Services Ltd is 
registered in England no. 05460265. The registered office of both companies is 4th Floor, Reading Bridge House, George Street, Reading,RG1 8LS. The principal place of business of both companies is 
8 Lancelot Place, London SW7 1DR.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/1262070e/attachment.htm>

From simon at rabbitmq.com  Mon Mar 19 14:57:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 14:57:52 +0000
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>	<4F61CBAC.2040203@rabbitmq.com>
	<CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>
Message-ID: <4F674970.3070404@rabbitmq.com>

On 19/03/12 14:43, James Carr wrote:
> Is there a good solution to this? it seems like it might work if there
> was someway for each of the 4 nodes to just use the same queue on the
> upstream broker since they are logically part of the same group.

Check out the local_nodename configuration item. Although the 
documentation could probably do with mentioning its usefulness for 
clustering....

http://www.rabbitmq.com/federation.html#configuration

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From raphael.degiusti at guardis.com  Mon Mar 19 15:02:42 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Mon, 19 Mar 2012 16:02:42 +0100
Subject: [rabbitmq-discuss] Create many queues with Pika
Message-ID: <CAFw-din7isBzsXKHsbiY0mrr2PcZj2+pPxSvt2gMR2tew3Ykfw@mail.gmail.com>

Hello everyone,

I'm in a situation where I need to create a lot of queues, let's say 20,
using Pika 0.9.5.
I'm currently using the SelectConnection module which works with callbacks.

I don't want to cascade 20 consecutive callbacks to achieve this:

def on_channel_open(channel_):
>     global channel
>     channel = channel_
>     channel.queue_declare(queue="queue1", durable=True,
>                               exclusive=False, auto_delete=False,
>                               callback=on_queue_1_declared)
> def on_queue_1_declared(frame):
>     channel.queue_declare(queue="queue2", durable=True,
>                               exclusive=False, auto_delete=False,
>                               callback=on_queue_2_declared)
> def on_queue_2_declared(frame):
>     channel.queue_declare(queue="queue3", durable=True,
>                               exclusive=False, auto_delete=False,
>                               callback=on_queue_3_declared)
> def on_queue_3_declared(frame):
>     channel.queue_declare(queue="queue4", durable=True,
>                               exclusive=False, auto_delete=False,
>                               callback=on_queue_4_declared)


And so on...

This is not pretty. Any idea on how to achieve this without declaring all
those callbacks ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/755da90d/attachment.htm>

From simon at rabbitmq.com  Mon Mar 19 15:05:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 19 Mar 2012 15:05:03 +0000
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
References: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
Message-ID: <4F674B1F.7070508@rabbitmq.com>

On 19/03/12 14:48, Dan Wise wrote:
> /ReferenceError: fmt_exchange_type is not defined///

Hi.

That function was added in 2.8.0. It really is there!

You may need to do the traditional shift-refresh or even clear the cache 
if your browser is being particularly recalcitrant...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Mon Mar 19 15:06:51 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 10:06:51 -0500
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <4F674970.3070404@rabbitmq.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>
	<4F61CBAC.2040203@rabbitmq.com>
	<CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>
	<4F674970.3070404@rabbitmq.com>
Message-ID: <CAJreXKA5B20734+ybMASMqR+oynK7mB8KekeRw=9cS=bHVYpdg@mail.gmail.com>

Thanks!

On Mon, Mar 19, 2012 at 9:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 19/03/12 14:43, James Carr wrote:
>>
>> Is there a good solution to this? it seems like it might work if there
>> was someway for each of the 4 nodes to just use the same queue on the
>> upstream broker since they are logically part of the same group.
>
>
> Check out the local_nodename configuration item. Although the documentation
> could probably do with mentioning its usefulness for clustering....
>
> http://www.rabbitmq.com/federation.html#configuration
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware

From aaron at agoragames.com  Mon Mar 19 15:08:33 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 19 Mar 2012 11:08:33 -0400
Subject: [rabbitmq-discuss] Run RabbitMQ server with N scheduler threads
In-Reply-To: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>
References: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>
Message-ID: <CAHiEoM6e9CMqC1hFR5fZxOOiu926SfbJXd8eDoE+2UGPcS=q1Q@mail.gmail.com>

There are several things that can affect performance as you try to
saturate your cores. I documented some of what I encountered last year
in a blog post that may help you.

http://blog.agoragames.com/blog/2011/06/24/of-penguins-rabbits-and-buses/

cheers,
Aaron


On Fri, Mar 16, 2012 at 1:28 PM, Katerina Roukounaki <k4t3r1n4 at gmail.com> wrote:
> Hi!
>
> Since the RabbitMQ server is an Erlang application, I wanted to see whether
> it runs faster as I increase the number of scheduler threads in the Erlang
> VM that runs it (+S option of the erl program).
>
> For this purpose, I wrote a simple benchmark (in Erlang) that spawns P
> producer and P consumer processes and creates P queues. The i-th producer
> sends M messages to the i-th queue and the i-th consumer waits to receive
> them. My benchmark uses native Erlang messaging for sending and receiving
> messages.
>
> I attach the results I get when I run the benchmark with P=M=1000 on a
> machine with 16 cores and assign 1, 2, ?, 16 scheduler threads to the VM
> that runs the RabbitMQ server.
>
> As you can see, things get better up to 6 schedulers, but with 7 or more
> schedulers it seems that there is no further speedup.
> Do you have any idea why this is happening?
> Is there some kind of synchronization among the processes that the RabbitMQ
> server spawns that explains it or should I look for bugs in my benchmark?
>
>
> Thanks!
> Katerina
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From k4t3r1n4 at gmail.com  Mon Mar 19 15:27:55 2012
From: k4t3r1n4 at gmail.com (Katerina Roukounaki)
Date: Mon, 19 Mar 2012 17:27:55 +0200
Subject: [rabbitmq-discuss] Run RabbitMQ server with N scheduler threads
In-Reply-To: <4F674257.3090507@rabbitmq.com>
References: <CAEqHY8t6JO0OjHH-OFKoyKsVUde_pBCc2sSTLe8EVcO1JpHvBg@mail.gmail.com>
	<4F674257.3090507@rabbitmq.com>
Message-ID: <CAEqHY8vpn0cztX0JJPpcFPKDiR4R+1r0z4E1pBZf-ZZo3STO4w@mail.gmail.com>

On 19 March 2012 16:27, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/03/12 17:28, Katerina Roukounaki wrote:
>
>> Since the RabbitMQ server is an Erlang application, I wanted to see
>> whether it runs faster as I increase the number of scheduler threads in
>> the Erlang VM that runs it (+S option of the erl program).
>>
>> For this purpose, I wrote a simple benchmark (in Erlang) that spawns P
>> producer and P consumer processes and creates P queues. The i-th
>> producer sends M messages to the i-th queue and the i-th consumer waits
>> to receive them. My benchmark uses native Erlang messaging for sending
>> and receiving messages.
>>
>
> So just to be clear: you are using the direct client? Or something else?


Yes, I'm using the direct client.

>
>
>  I attach the results I get when I run the benchmark with P=M=1000 on a
>> machine with 16 cores and assign 1, 2, ?, 16 scheduler threads to the VM
>> that runs the RabbitMQ server.
>>
>> As you can see, things get better up to 6 schedulers, but with 7 or more
>> schedulers it seems that there is no further speedup.
>> Do you have any idea why this is happening?
>>
>
> At a guess: hyperthreading? I assume your machine is 8 physical cores and
> 16 hyperthreads. In which case the extra cores presented by hyperthreading
> are presumably not helping much.
>

No. The machine has 16 physical cores. This is the first reason I had not
expected the results I got.


>
> But I'm not an expert on the Erlang scheduler.
>
>
>  Is there some kind of synchronization among the processes that the
>> RabbitMQ server spawns that explains it or should I look for bugs in my
>> benchmark?
>>
>
> All your producer-queue-consumer chains are independent, right? So it's:
>
> P1 -> Q1 -> C1
> P2 -> Q2 -> C2
>
> ?
>
> If so then there's no synchronisation between the processes done by
> RabbitMQ.
>
> Exactly. And this is the second reason I had not expected the results I
got.


> You might want to play with the other scheduler options. +sbt looks
> particularly interesting...
>
>
I'll try that and I'll come back with fresh results.

Thanks,

Katerina


> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/8efeee59/attachment.htm>

From tim.blair at gmail.com  Mon Mar 19 12:51:07 2012
From: tim.blair at gmail.com (Tim Blair)
Date: Mon, 19 Mar 2012 05:51:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Manual "Failover" of Mirrored Queue
Message-ID: <31796526.75.1332161467886.JavaMail.geo-discussion-forums@vbnd9>

Hi,

We're currently using a 2-node cluster with mirrored queues.  Consumers 
connect to nodes through a load-balancer, but we quite often see a large 
number of persistent (and high-volume) queues created on one node, 
resulting in uneven load across the two boxes.  We're looking to find ways 
to more sensibly manage the load between the two boxes without any 
complicated logic or configuration within the consumers.

Assuming that a queue is in-sync across both nodes, is there any way to 
manually "fail-over" a specific queue so the slave becomes that queues 
master?

Thanks,

Tim.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/7515b016/attachment.htm>

From dirk.swart at gmail.com  Mon Mar 19 15:41:25 2012
From: dirk.swart at gmail.com (Dirk)
Date: Mon, 19 Mar 2012 08:41:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
Message-ID: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>

- Does anyone have code for the simplest possible message producer?

I would like to produce messages from a _very_ memory constrained
embedded system*. Can anyone advise me on what the absolute minimum I
have to do to produce and send a message is?

Also, if anyone can point me towards what a simple "hello world"
message template looks like, it would be appreciated. More details:
I'm thinking of the sort of message that the Tutorials cover (eg:
http://www.rabbitmq.com/tutorials/tutorial-one-python.html)

Thanks in advance - I'm a Rabbit noob, apologies if this post is not
using the correct terms.

* ATMega 328p, same chip the Arduino uses.

From ktopytatenpyta at gmail.com  Mon Mar 19 16:13:33 2012
From: ktopytatenpyta at gmail.com (mamut)
Date: Mon, 19 Mar 2012 09:13:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
Message-ID: <c48178bd-0ec4-4ee6-b0aa-b3e70d6696d4@ow8g2000pbc.googlegroups.com>

Is it possible to run RabbitMQ broker on VMware ESXi? (if yes, I'd
preffer detailed answers, if no - Are there any AMQP brokers that
would apply?)
I also want to set a RabbitMQ client (prefferably python, but other
are welcome too), but I don't know how to do it.
If anyone knows, please answer.

kind regards,
mamut

From ktopytatenpyta at gmail.com  Mon Mar 19 16:13:45 2012
From: ktopytatenpyta at gmail.com (ktopyta)
Date: Mon, 19 Mar 2012 09:13:45 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ on ESXi
Message-ID: <33532871.post@talk.nabble.com>


Is it possible to run RabbitMQ broker on VMware ESXi? (if yes, I'd preffer
detailed answers, if no - Are there any AMQP brokers that would apply?)
I also want to set a RabbitMQ client (prefferably python, but other are
welcome too), but I don't know how to do it.
If anyone knows, please answer.

kind regards,
mamut
-- 
View this message in context: http://old.nabble.com/RabbitMQ-on-ESXi-tp33532871p33532871.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jerryk at vmware.com  Mon Mar 19 16:21:24 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 19 Mar 2012 09:21:24 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <c48178bd-0ec4-4ee6-b0aa-b3e70d6696d4@ow8g2000pbc.googlegroups.com>
Message-ID: <85f8e1f0-3ead-4f18-a0fd-96fc357579c2@strongmad.batnest.org>

Hi, Mamut:

Running RabbitMQ on ESXi is certainly possible, but not bare on the 
hypervisor, i.e. you'd have to choose a guest OS into which to install 
Rabbit.  In practice this is probably the (supported) Linux of your 
choosing.

Best regards,
Jerry

----- Original Message -----
From: "mamut" <ktopytatenpyta at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 19, 2012 9:13:33 AM
Subject: [rabbitmq-discuss] RabbitMQ on ESXi

Is it possible to run RabbitMQ broker on VMware ESXi? (if yes, I'd
preffer detailed answers, if no - Are there any AMQP brokers that
would apply?)
I also want to set a RabbitMQ client (prefferably python, but other
are welcome too), but I don't know how to do it.
If anyone knows, please answer.

kind regards,
mamut
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Mar 19 16:32:39 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 11:32:39 -0500
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <85f8e1f0-3ead-4f18-a0fd-96fc357579c2@strongmad.batnest.org>
References: <c48178bd-0ec4-4ee6-b0aa-b3e70d6696d4@ow8g2000pbc.googlegroups.com>
	<85f8e1f0-3ead-4f18-a0fd-96fc357579c2@strongmad.batnest.org>
Message-ID: <CAJreXKAMpWfOBj48V+-p=eUK_hEku5rzf3si2k+KAyEqT4A+bw@mail.gmail.com>

Mamut,

We have been running 2 production and 2 development rabbitmq brokers
on RHEL running on ESXi for over a year without any problems.

Thanks,
James


On Mon, Mar 19, 2012 at 11:21 AM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, Mamut:
>
> Running RabbitMQ on ESXi is certainly possible, but not bare on the
> hypervisor, i.e. you'd have to choose a guest OS into which to install
> Rabbit. ?In practice this is probably the (supported) Linux of your
> choosing.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "mamut" <ktopytatenpyta at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, March 19, 2012 9:13:33 AM
> Subject: [rabbitmq-discuss] RabbitMQ on ESXi
>
> Is it possible to run RabbitMQ broker on VMware ESXi? (if yes, I'd
> preffer detailed answers, if no - Are there any AMQP brokers that
> would apply?)
> I also want to set a RabbitMQ client (prefferably python, but other
> are welcome too), but I don't know how to do it.
> If anyone knows, please answer.
>
> kind regards,
> mamut
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ktopytatenpyta at gmail.com  Mon Mar 19 16:36:23 2012
From: ktopytatenpyta at gmail.com (mamut)
Date: Mon, 19 Mar 2012 09:36:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <CAJreXKAMpWfOBj48V+-p=eUK_hEku5rzf3si2k+KAyEqT4A+bw@mail.gmail.com>
References: <c48178bd-0ec4-4ee6-b0aa-b3e70d6696d4@ow8g2000pbc.googlegroups.com>
	<85f8e1f0-3ead-4f18-a0fd-96fc357579c2@strongmad.batnest.org>
	<CAJreXKAMpWfOBj48V+-p=eUK_hEku5rzf3si2k+KAyEqT4A+bw@mail.gmail.com>
Message-ID: <ba158b5e-a24f-405a-ac77-e6874a4b0b0a@vy9g2000pbc.googlegroups.com>

Are you suggesting an OS run on VM on ESXi?

From jerryk at vmware.com  Mon Mar 19 16:43:29 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 19 Mar 2012 09:43:29 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <ba158b5e-a24f-405a-ac77-e6874a4b0b0a@vy9g2000pbc.googlegroups.com>
Message-ID: <ee4b4717-5826-414a-9c32-4de7c425032d@strongmad.batnest.org>

Hi, Mamut:

In the sense of "yes, you need one," yes we are. :-)

The choice is really yours, drawn from some subset of the following
list:

http://www.rabbitmq.com/platforms.html

For a variety of reasons, you'll probably have a more pleasant time
with one of the Linuxes.

Best regards,
Jerry

----- Original Message -----
From: "mamut" <ktopytatenpyta at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 19, 2012 9:36:23 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ on ESXi

Are you suggesting an OS run on VM on ESXi?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ktopytatenpyta at gmail.com  Mon Mar 19 16:51:46 2012
From: ktopytatenpyta at gmail.com (mamut)
Date: Mon, 19 Mar 2012 09:51:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <ee4b4717-5826-414a-9c32-4de7c425032d@strongmad.batnest.org>
References: <ee4b4717-5826-414a-9c32-4de7c425032d@strongmad.batnest.org>
Message-ID: <7f26fdef-6def-4b94-83af-b471f77fa4ba@t8g2000pbe.googlegroups.com>

Thank you very much. I hope I can do this now :)
Google didn't help that much in this case.

From egermann at limanews.com  Mon Mar 19 16:52:55 2012
From: egermann at limanews.com (Eric Germann)
Date: Mon, 19 Mar 2012 09:52:55 -0700
Subject: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster //
	newcomer question
Message-ID: <6244CA0E5130B349820CA2E8B24DC26250E98BA8@VA3DIAXVSC31.RED001.local>

Relative newcomer to RabbitMQ trying to go from 2.7.1 to 2.8.0

We have 3 servers in a development cluster

srv1 Disc
srv2 RAM
srv3 RAM

I brought down the two RAM nodes first, then the disc node.  We're running the RPM version on Centos/RHEL, so I updated using rpm -U on the disc node.  All is well on that node and it's up and reporting 2.8.0, etc from the management interface.

Started srv2 with a hold on the service start, updated it with rpm -U also, then started it and it fails with an error in startup_log

****

Cluster upgrade needed but this is a ram node.
Please first start the last disc node to shut down.

****


Same for srv3.

The disc node is running and the status (from srv1) is:

Cluster status of node 'rabbit at mq-clustera-srv1' ...
[{nodes,[{disc,['rabbit at mq-clustera-srv1']},
         {ram,['rabbit at mq-clustera-srv3','rabbit at mq-clustera-srv2']}]},
{running_nodes,['rabbit at mq-clustera-srv1']}]
...done.

From srv2, I think the cookie is fine because here's the status from there:

[root at mq-clustera-srv2 rabbitmq]# rabbitmqctl -n rabbit at mq-clustera-srv1 cluster_status
Cluster status of node 'rabbit at mq-clustera-srv1' ...
[{nodes,[{disc,['rabbit at mq-clustera-srv1']},
         {ram,['rabbit at mq-clustera-srv3','rabbit at mq-clustera-srv2']}]},
{running_nodes,['rabbit at mq-clustera-srv1']}]
...done.


Thoughts?  Any pointers?

Thanks

EKG


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/2bb17a14/attachment.htm>

From jerryk at vmware.com  Mon Mar 19 16:56:59 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 19 Mar 2012 09:56:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <7f26fdef-6def-4b94-83af-b471f77fa4ba@t8g2000pbe.googlegroups.com>
Message-ID: <2d2d6df6-fcdc-41e1-9c75-8c683822c0d5@strongmad.batnest.org>

Mamut:

Good luck and let us know if you have difficulties...

Best,
Jerry

----- Original Message -----
From: "mamut" <ktopytatenpyta at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 19, 2012 9:51:46 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ on ESXi

Thank you very much. I hope I can do this now :)
Google didn't help that much in this case.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Mar 19 18:30:20 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 19 Mar 2012 13:30:20 -0500
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <CAJreXKA5B20734+ybMASMqR+oynK7mB8KekeRw=9cS=bHVYpdg@mail.gmail.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>
	<4F61CBAC.2040203@rabbitmq.com>
	<CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>
	<4F674970.3070404@rabbitmq.com>
	<CAJreXKA5B20734+ybMASMqR+oynK7mB8KekeRw=9cS=bHVYpdg@mail.gmail.com>
Message-ID: <CAJreXKAMd4+RdtVyBWUizsGMPzoS9Jk_1VRKiXitZSpj==vytA@mail.gmail.com>

One more question... is it possible to define an alternate exchange
for the downstream exchange? Currently I have upstream exchanges that
any number of message types can be published to  and I'd like a "catch
all" for the downstream when messages don't get routed.


Thanks,
James

On Mon, Mar 19, 2012 at 10:06 AM, James Carr <james.r.carr at gmail.com> wrote:
> Thanks!
>
> On Mon, Mar 19, 2012 at 9:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 19/03/12 14:43, James Carr wrote:
>>>
>>> Is there a good solution to this? it seems like it might work if there
>>> was someway for each of the 4 nodes to just use the same queue on the
>>> upstream broker since they are logically part of the same group.
>>
>>
>> Check out the local_nodename configuration item. Although the documentation
>> could probably do with mentioning its usefulness for clustering....
>>
>> http://www.rabbitmq.com/federation.html#configuration
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware

From sahmed1020 at gmail.com  Mon Mar 19 20:07:03 2012
From: sahmed1020 at gmail.com (S Ahmed)
Date: Mon, 19 Mar 2012 16:07:03 -0400
Subject: [rabbitmq-discuss] memory requirements compared to activemq
Message-ID: <CAG2rwuNjyHQ+TPky_ArLm==NEKeO4GPgF91aa742qyszGeLcSg@mail.gmail.com>

I have a server with only 4gb ram on it, and I will have a few other
services running (tomcat, mysql, etc.)

My queueing needs are fairly simple, and I am looking at both activemq and
rabbitmq.

Which one would consume the least amount of memory generally speaking?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/4f1ee22c/attachment.htm>

From toby.corkindale at strategicdata.com.au  Tue Mar 20 04:49:25 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 20 Mar 2012 15:49:25 +1100
Subject: [rabbitmq-discuss] memory requirements compared to activemq
In-Reply-To: <CAG2rwuNjyHQ+TPky_ArLm==NEKeO4GPgF91aa742qyszGeLcSg@mail.gmail.com>
References: <CAG2rwuNjyHQ+TPky_ArLm==NEKeO4GPgF91aa742qyszGeLcSg@mail.gmail.com>
Message-ID: <4F680C55.1080707@strategicdata.com.au>

On 20/03/12 07:07, S Ahmed wrote:
> I have a server with only 4gb ram on it, and I will have a few other
> services running (tomcat, mysql, etc.)
>
> My queueing needs are fairly simple, and I am looking at both activemq
> and rabbitmq.
>
> Which one would consume the least amount of memory generally speaking?

In my experience of both, ActiveMQ uses a lot MORE memory than RabbitMQ, 
although that might just be a "feature" of the JVM.

RMQ seems to be quite efficient in terms of resource usage, and I'd 
definitely choose it over AMQ if memory use is a concern.

-Toby

From Saravana.Prabhu at emc.com  Tue Mar 20 04:50:18 2012
From: Saravana.Prabhu at emc.com (Saravana.Prabhu at emc.com)
Date: Tue, 20 Mar 2012 00:50:18 -0400
Subject: [rabbitmq-discuss] Identify RabbitMQ Broker Process Allocated Memory
Message-ID: <978435FA08D0814BAD1CBA3899FE9FB40297EC49D6@MX26A.corp.emc.com>

Hi,

I am new to RabbitMQ messaging.

I would like to know how does the Memory for the RabbitMQ Message Broker process is allocated and is there a way to modify it.

Thanks,
Prabhu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/e73be4b6/attachment.htm>

From gerolf.seitz at gmail.com  Tue Mar 20 06:43:51 2012
From: gerolf.seitz at gmail.com (Gerolf Seitz)
Date: Tue, 20 Mar 2012 07:43:51 +0100
Subject: [rabbitmq-discuss] Active consumers in declare-ok is less than the
	actual number of consumers
Message-ID: <CAPeHLwa1tHwpxbkY3Xd2+oeraWtrzTLzvNjzsduMDu-JwaCSHg@mail.gmail.com>

Hi,

When passively declaring a queue, the returned consumer count is not the
same as the consumer count via the management plugin / http API. Turns out,
rabbitmq returns the number of consumers that are ready to receive a
message.

As an example: there are 5 (manually acknowledging) consumers, 3 of which
have consumed a message from the queue, but have not sent an ACK for the
respective messages to the broker. Declaring a queue now returns a
declare-ok with consumer-count == 2, whereas I would have expected it to be
5.

Looking at the rabbitmq-server code reveals that the "active consumer" part
of the state is used for getting the next consumer for round robin delivery
and returning the number of consumers as part of the declare-ok message.

Since I don't suspect this to be an oversight but rather a conscious
decision, I'm interested in the rationale behind it. I'm aware that
changing the semantics at this point is probably not possible and I may
have to resort to fetching the consumer count via the http api (which
brings some organizational overhead).

Can anybody shed some light on this?

Cheers,
  Gerolf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/81c4d6fa/attachment.htm>

From josh at gebaschtel.ch  Tue Mar 20 08:34:51 2012
From: josh at gebaschtel.ch (Josh Geisser)
Date: Tue, 20 Mar 2012 08:34:51 +0000
Subject: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'
Message-ID: <B8B68C3D41791846910BA4C7AF61D25B034CFD@ganymede.gebaschtel.bnet>

Hi all

I just noticed that 'rabbitmq-server-2.8.0-1.suse.noarch.rpm' throws the following error when being started:

/etc/init.d/rabbitmq-server: line 60: runuser: command not found

The old 2.7.1 packaged rc-script was just fine

FYI & cheers
Josh

/etc/SuSE-release sais we're using
SUSE Linux Enterprise Server 11 (x86_64)
VERSION = 11
PATCHLEVEL = 1

-- 
----
ASG at hnet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/9e2ed26c/attachment.htm>

From nigelbenns at rogers.com  Mon Mar 19 17:00:54 2012
From: nigelbenns at rogers.com (Nigel Benns)
Date: Mon, 19 Mar 2012 10:00:54 -0700 (PDT)
Subject: [rabbitmq-discuss] queue_declare returning a (50,
 10) NOT_FOUND....
In-Reply-To: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
References: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
Message-ID: <7203268.334.1332176454978.JavaMail.geo-discussion-forums@vbw10>

Hey Guys,

I'm having this issue as well.
I have never had clustering enabled, but it appears that I was setting 
"autoDelete=true", "exclusive=true" and durable="true".
Since then have changed autoDelete=false.

I'm connecting through node-amqp.

rabbitmqctl doesn't appear to know anything about the queue, however I see 
the queue listed in rabbit_durable_queue.DCD and rabbit_durable_route.DCD.
Could the autoDelete logic have half succeeded?
Also I have a erl_crash.dump file, but I don't get much from it myself.

here is the output of status:

Status of node rabbit at beast ...
[{pid,531},
 {running_applications,
     [{rabbitmq_jsonrpc_channel_examples,"rabbit_jsonrpc_channel_examples",
          "2.6.1"},
      {rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.6.1"},
      {rabbitmq_management,"RabbitMQ Management Console","2.6.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.6.1"},
      {webmachine,"webmachine","1.7.0-rmq2.6.1-hg0c4b60a"},
      {amqp_client,"RabbitMQ AMQP Client","2.6.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.6.1"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.6.1-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.6.1"},
      {rabbit,"RabbitMQ","2.6.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,30854664},
      {processes,11967824},
      {processes_used,11953424},
      {system,18886840},
      {atom,1348001},
      {atom_used,1325858},
      {binary,48664},
      {code,14479935},
      {ets,1217440}]}]
...done.

On Wednesday, 29 September 2010 18:56:53 UTC-4, Nicol?s C?sar wrote:
>
> Hi i'm getting a
>
> (404, u"NOT_FOUND - no queue 'xxx in vhost '/'", (50, 10), 
> 'Channel.queue_declare') 
>
> doing a queque_declare, reading from my own thread time ago:
>
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d925b0bbaed7f86?pli=1
>
>
> Simon MacMullen replied:
>
> ISTR the only way you can get a not-found when declaring a queue is in a 
> clustering situation, if the queue exists on a node which is not 
> running. Does that sound like it could be a possibility? 
>
> Cheers, Simon 
> but I have no cluster situation:
>
> #/usr/sbin/rabbitmqctl status
> Status of node rabbit at sendsorium ...
> [{running_applications,[{rabbit,"RabbitMQ","1.8.1"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.14"},
>                         {os_mon,"CPO  CXC 138 46","2.2.5"},
>                         {sasl,"SASL  CXC 138 11","2.1.9.2"},
>                         {stdlib,"ERTS  CXC 138 10","1.17"},
>                         {kernel,"ERTS  CXC 138 10","2.14"}]},
>  {nodes,[{disc,[rabbit at sendsorium]}]},
>  {running_nodes,[rabbit at sendsorium]}]
> ...done.
>
> Thanks in advance!
>
>
> BTW. my last issue with rabbit not starting were bizarre virtualization 
> problems like not ping'ing 127.0.0.1 my apologies for the noise to the list.
>
>
> Nico C?sar
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120319/823c9e79/attachment.htm>

From ktopytatenpyta at gmail.com  Tue Mar 20 10:21:49 2012
From: ktopytatenpyta at gmail.com (mamut)
Date: Tue, 20 Mar 2012 03:21:49 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <2d2d6df6-fcdc-41e1-9c75-8c683822c0d5@strongmad.batnest.org>
References: <2d2d6df6-fcdc-41e1-9c75-8c683822c0d5@strongmad.batnest.org>
Message-ID: <de0df287-95b5-4a8c-9d9e-d665a149f779@t8g2000pbe.googlegroups.com>

I'm currently searching for (rabbit) client libs for VMware ESXi - any
language considered, and for Windows - c++. Are there any?

best regards,
mamut

From emile at rabbitmq.com  Tue Mar 20 10:24:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 20 Mar 2012 10:24:00 +0000
Subject: [rabbitmq-discuss] Identify RabbitMQ Broker Process Allocated
 Memory
In-Reply-To: <978435FA08D0814BAD1CBA3899FE9FB40297EC49D6@MX26A.corp.emc.com>
References: <978435FA08D0814BAD1CBA3899FE9FB40297EC49D6@MX26A.corp.emc.com>
Message-ID: <4F685AC0.5040707@rabbitmq.com>

Hi Prabhu,

On 20/03/12 04:50, Saravana.Prabhu at emc.com wrote:
> I would like to know how does the Memory for the RabbitMQ Message Broker
> process is allocated and is there a way to modify it.

Can you explain what you are trying to achieve?

You get some control over how RabbitMQ responds to memory pressure with
the "vm_memory_high_watermark" configuration setting (see
http://www.rabbitmq.com/configure.html and
http://www.rabbitmq.com/memory.html).

Memory for the broker is managed by the underlying Erlang VM. This
includes process heaps and separate space for message storage (Erlang
binaries). There are some internal flags that control Erlang memory
management, but it should not be necessary to touch them.


-Emile


From majek04 at gmail.com  Tue Mar 20 10:41:09 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 20 Mar 2012 10:41:09 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
	<CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>
Message-ID: <CABzX+qyK_-3zK3fsMsRA5F6k7yv62HsCB1gMsc2hiyR1pK9Z1A@mail.gmail.com>

On Wed, Mar 14, 2012 at 18:59, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Mar 14, 2012 at 18:42, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
>> <stavr.chris at gmail.com> wrote:
>>> I am using Puka client [1] in order to send messages with guaranteed
>>> delivery using publisher confirms.
>>>
>>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>>> lot of time.
>>>
>>> To be more specific:
>>>
>>> ??? promises = []
>>> ??? t0 = time.time()
>>> ??? for i in range(0,200000):
>>> ??? ??? promise = client.basic_publish(exchange='test_exchange',
>>> routing_key='test',
>>> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
>>> world!")
>>> ??? ??? promises.append(promise)
>>>
>
> Right, there is a performance problem with handling pubacks. The complexity
> grows with n^2 of unacked messages
>
> Good news: the problem is in this line:
> ? https://github.com/majek/puka/blob/master/puka/machine.py#L147-148
>
> Bad news: I have no clue how to fix it.
>
> I've rised an issue on github:
> ? https://github.com/majek/puka/issues/12

Christos,

Thanks for your report and for the pull request!

I just uploaded puka 0.0.4 to pypi, which solves the problem.

Cheers,
    Marek

From jan.afzal at gmail.com  Tue Mar 20 10:30:24 2012
From: jan.afzal at gmail.com (ajan)
Date: Tue, 20 Mar 2012 03:30:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Monitor memory and cpu usage of RabbitMQ message
	broker
Message-ID: <0c278d88-d7f8-4a1e-877d-cb5c42c0dc0f@cj6g2000vbb.googlegroups.com>

Are there any tools to monitor the memory and cpu usage of rabbitmq
message broker. For java process we have yourkit. Are there any such
tools for Erlang that I can use to monitor the message broker service.

From simon at rabbitmq.com  Tue Mar 20 10:46:30 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 10:46:30 +0000
Subject: [rabbitmq-discuss] Monitor memory and cpu usage of RabbitMQ
 message broker
In-Reply-To: <0c278d88-d7f8-4a1e-877d-cb5c42c0dc0f@cj6g2000vbb.googlegroups.com>
References: <0c278d88-d7f8-4a1e-877d-cb5c42c0dc0f@cj6g2000vbb.googlegroups.com>
Message-ID: <4F686006.8090801@rabbitmq.com>

On 20/03/12 10:30, ajan wrote:
> Are there any tools to monitor the memory and cpu usage of rabbitmq
> message broker. For java process we have yourkit. Are there any such
> tools for Erlang that I can use to monitor the message broker service.

The management plugin will report on memory use, but not CPU use. I 
would always assume if you wanted to monitor CPU use on a Rabbit node 
you'd use an external tool like Nagios anyway.

I note that yourkit is actually a *profiler*. If you want to *profile* 
RabbitMQ then Erlang has some profiling capabilities (albeit not shiny 
polished GUIs). But is that what you want? I would view profiling 
RabbitMQ as more my problem than yours :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 10:49:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 10:49:36 +0000
Subject: [rabbitmq-discuss] Shovel vs. RabbitMQ
In-Reply-To: <CAJreXKD1xt7LwOotMjS8e3AsUgQH4jRnYEx0N==b3PWQ8Fi8aQ@mail.gmail.com>
References: <CAJreXKD1xt7LwOotMjS8e3AsUgQH4jRnYEx0N==b3PWQ8Fi8aQ@mail.gmail.com>
Message-ID: <4F6860C0.9080807@rabbitmq.com>

Hi James. (I assume you mean Shovel vs Federation).

Since federation has quite a pull-based model it might prove more fiddly 
to use than shovel in a situation where you have a lot of satellite 
brokers publishing to a central broker. I view shovel as a lower level 
thing than federation, both have their uses...

Cheers, Simon

On 19/03/12 14:26, James Carr wrote:
> While working on a new messaging topology for a client I've found
> myself wondering if a hybrid of shovel / federation might be a valid
> approach rather than just using federation. While I have several
> clusters that will be located in different geographical locations
> federated amongst themselves we have dynamically created "pods" that
> are really kind of mini-datacenters for each application. Basically
> each app has all the components it needs to function independently and
> if messaging is required to update data or do things across pods the
> pod will have it's own rabbitmq broker.
>
> The pods get spinned up and destroyed dynamically. I keep wondering if
> perhaps the pods should use shovel to shovel to the cluster on it's
> segment or if I should just setup my puppet modules to declared a
> federated exchange on the cluster for a freshly created pod? Both
> approaches seem valid (and I'll experiment with both anyway) but I'm
> just curious if anyone on the list has experience or recommendations
> with this kind of setup.
>
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 11:06:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 11:06:35 +0000
Subject: [rabbitmq-discuss] Manual "Failover" of Mirrored Queue
In-Reply-To: <31796526.75.1332161467886.JavaMail.geo-discussion-forums@vbnd9>
References: <31796526.75.1332161467886.JavaMail.geo-discussion-forums@vbnd9>
Message-ID: <4F6864BB.1080608@rabbitmq.com>

On 19/03/12 12:51, Tim Blair wrote:
> Assuming that a queue is in-sync across both nodes, is there any way to
> manually "fail-over" a specific queue so the slave becomes that queues
> master?

No, I'm afraid not.

It's possible something like this might emerge in the future, although
it's likely to be a bit more high level - "try to keep my queues
distributed across the cluster".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 11:17:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 11:17:32 +0000
Subject: [rabbitmq-discuss] Active consumers in declare-ok is less than
 the	actual number of consumers
In-Reply-To: <CAPeHLwa1tHwpxbkY3Xd2+oeraWtrzTLzvNjzsduMDu-JwaCSHg@mail.gmail.com>
References: <CAPeHLwa1tHwpxbkY3Xd2+oeraWtrzTLzvNjzsduMDu-JwaCSHg@mail.gmail.com>
Message-ID: <4F68674C.4030407@rabbitmq.com>

On 20/03/12 06:43, Gerolf Seitz wrote:
> When passively declaring a queue, the returned consumer count is not the
> same as the consumer count via the management plugin / http API. Turns
> out, rabbitmq returns the number of consumers that are ready to receive
> a message.
>
> As an example: there are 5 (manually acknowledging) consumers, 3 of
> which have consumed a message from the queue, but have not sent an ACK
> for the respective messages to the broker. Declaring a queue now returns
> a declare-ok with consumer-count == 2, whereas I would have expected it
> to be 5.
>
> Looking at the rabbitmq-server code reveals that the "active consumer"
> part of the state is used for getting the next consumer for round robin
> delivery and returning the number of consumers as part of the declare-ok
> message.
>
> Since I don't suspect this to be an oversight but rather a conscious
> decision, I'm interested in the rationale behind it. I'm aware that
> changing the semantics at this point is probably not possible and I may
> have to resort to fetching the consumer count via the http api (which
> brings some organizational overhead).
>
> Can anybody shed some light on this?

Hi Gerolf.

Yes, this is deliberate. Code archaeology yielded this:

http://hg.rabbitmq.com/rabbitmq-server/rev/32e357ad03d6

"count queue consumers as required by the spec".

The spec actually says:

     Reports the number of active consumers for the queue. Note that
     consumers can  suspend activity (Channel.Flow) in which case they
     do not appear in this count.

So that is slightly ambiguous - we are excluding consumers that have 
issued channel.flow, but also those which are blocked due to qos / ack 
interaction. But those could easily be defined as "inactive"...

Hmm. I'll have a think about this. What are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 11:54:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 11:54:55 +0000
Subject: [rabbitmq-discuss] Federation with Clusters and Load Balancers
In-Reply-To: <CAJreXKAMd4+RdtVyBWUizsGMPzoS9Jk_1VRKiXitZSpj==vytA@mail.gmail.com>
References: <CAJreXKAWjGG6JSEMfA-O-Q7ibxVEWGrYXPOuQz+TUZYA8Sru3A@mail.gmail.com>	<4F61CBAC.2040203@rabbitmq.com>	<CAJreXKAFU-qRwncT+z2tMmh_pwxf4QT6Z=B+bihoPQZ5FzJWsw@mail.gmail.com>	<4F674970.3070404@rabbitmq.com>	<CAJreXKA5B20734+ybMASMqR+oynK7mB8KekeRw=9cS=bHVYpdg@mail.gmail.com>
	<CAJreXKAMd4+RdtVyBWUizsGMPzoS9Jk_1VRKiXitZSpj==vytA@mail.gmail.com>
Message-ID: <4F68700F.1060208@rabbitmq.com>

On 19/03/12 18:30, James Carr wrote:
> One more question... is it possible to define an alternate exchange
> for the downstream exchange? Currently I have upstream exchanges that
> any number of message types can be published to  and I'd like a "catch
> all" for the downstream when messages don't get routed.

It's possible to define an alternate exchange since federated exchanges 
are just exchanges, and you can define an alternate exchange on any 
exchange.

However, the federation plugin goes to some effort to avoid transmitting 
messages that will not be routed, so it won't be much use for messages 
transmitted over the link if you have a federated topic exchange.

You could work around this if you want all messages to be delivered via 
alternate-exchange. Federate a fanout exchange, then bind a topic (or 
whatever) exchange to that with alternate-exchange defined and the 
queues bound to it.

Because the federated exchange is of fanout type the federation plugin 
will federate all the messages for it.

Does this make sense?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 12:16:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 12:16:29 +0000
Subject: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster
 //	newcomer question
In-Reply-To: <6244CA0E5130B349820CA2E8B24DC26250E98BA8@VA3DIAXVSC31.RED001.local>
References: <6244CA0E5130B349820CA2E8B24DC26250E98BA8@VA3DIAXVSC31.RED001.local>
Message-ID: <4F68751D.9060007@rabbitmq.com>

On 19/03/12 16:52, Eric Germann wrote:
> Cluster upgrade needed but this is a ram node.
> Please first start the last disc node to shut down.

Damn, this is a bug.

If your RAM node does not contain any persistent messages in durable 
queues, you can just reset it and rejoin the cluster. If not, umm, 
you'll have to wait for the fix we will no doubt release soon.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 20 12:21:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 12:21:48 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <88E590DC4586974D825FC82AE798294E5210E745@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it><CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>	<4F6717BE.4070103@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E5210E745@GSVCLU03.ges.ferlan.it>
Message-ID: <4F68765C.2060706@rabbitmq.com>

On 19/03/12 14:00, Busoli, Simone wrote:
> Hi Simon, I think I've mostly tracked down the issue to the symmetric
> setup of the federated exchanges between the two brokers. I noticed
> that whenever I start publishing messages to an exchange configured
> that way the network starts behaving in surprisingly ways. For
> instance, I can no longer get two machines connected directly by two
> network switches to ping each other. Stop publishing messages and
> everything goes back to a normal state. A federated exchange which
> goes in one direction only as well as a shovel instead behave just
> fine.

I am very confused by this.

Really, nothing the federation plugin does should be able to stop ICMP 
pings from working, it's just a TCP connection after all.

The only thing I can think of is that somehow federation is going mad 
and flooding the link with traffic - but I'm sure you would have noticed 
that. And pings should still get through anyway.

Does wireshark / tcpdump / etc show anything unusual?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Mar 20 12:23:44 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 20 Mar 2012 12:23:44 +0000
Subject: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'
In-Reply-To: <B8B68C3D41791846910BA4C7AF61D25B034CFD@ganymede.gebaschtel.bnet>
References: <B8B68C3D41791846910BA4C7AF61D25B034CFD@ganymede.gebaschtel.bnet>
Message-ID: <2848820F-5EE8-47E3-B5C5-60DF11E8A3FB@rabbitmq.com>

Dear Josh,

Thanks for telling us about this -- this is rather embarrassing. In
attempting to get Linux server installations to start the rabbitmq-service
without blocking shutdown, we used runuser for certain systems. Our
mistake.

A workaround ought to be to replace runuser in the relevant script, as
below:

On line 29 (or thereabouts) in the rabbitmq-server script in init.d
there is a line like this:

START_PROG="runuser rabbitmq --session-command"

which you should replace with:

START_PROG="setsid"

This will cause the rabbitmq-server service to be started with 'su'. Be
aware that this might inhibit shutdown (since su creates a PAM session
for the user rabbitmq).

We'll update our SuSE rpm file, when we find a proper solution to this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 20 Mar 2012, at 08:34, Josh Geisser wrote:

> Hi all
>  
> I just noticed that ?rabbitmq-server-2.8.0-1.suse.noarch.rpm? throws the following error when being started:
>  
> /etc/init.d/rabbitmq-server: line 60: runuser: command not found
>  
> The old 2.7.1 packaged rc-script was just fine
>  
> FYI & cheers
> Josh
>  
> /etc/SuSE-release sais we?re using
> SUSE Linux Enterprise Server 11 (x86_64)
> VERSION = 11
> PATCHLEVEL = 1
> -- 
> ----
> ASG at hnet
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From egermann at limanews.com  Tue Mar 20 12:39:51 2012
From: egermann at limanews.com (Eric Germann)
Date: Tue, 20 Mar 2012 05:39:51 -0700
Subject: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster
	//	newcomer question
In-Reply-To: <4F68751D.9060007@rabbitmq.com>
References: <6244CA0E5130B349820CA2E8B24DC26250E98BA8@VA3DIAXVSC31.RED001.local>
	<4F68751D.9060007@rabbitmq.com>
Message-ID: <6244CA0E5130B349820CA2E8B24DC26250E98D12@VA3DIAXVSC31.RED001.local>

Thinking about it last night, I wondered if that might not be the answer.

Will do and post back.

EKG


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, March 20, 2012 8:16 AM
To: Eric Germann
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster // newcomer question

On 19/03/12 16:52, Eric Germann wrote:
> Cluster upgrade needed but this is a ram node.
> Please first start the last disc node to shut down.

Damn, this is a bug.

If your RAM node does not contain any persistent messages in durable queues, you can just reset it and rejoin the cluster. If not, umm, you'll have to wait for the fix we will no doubt release soon.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


From aaron at agoragames.com  Tue Mar 20 12:52:03 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 20 Mar 2012 08:52:03 -0400
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CABzX+qyK_-3zK3fsMsRA5F6k7yv62HsCB1gMsc2hiyR1pK9Z1A@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
	<CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>
	<CABzX+qyK_-3zK3fsMsRA5F6k7yv62HsCB1gMsc2hiyR1pK9Z1A@mail.gmail.com>
Message-ID: <CAHiEoM5oAu=6rZdwj2OPKk3i4QqtrepF2b+zsYmcHtmz7zbYVA@mail.gmail.com>

I looked at the changes and in addition to those, I recommend using
the Python deque class for your buffers. I noticed a significant
improvement in performance when I switched to them in haigha.

cheers,
Aaron



On Tue, Mar 20, 2012 at 6:41 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Mar 14, 2012 at 18:59, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Wed, Mar 14, 2012 at 18:42, Marek Majkowski <majek04 at gmail.com> wrote:
>>> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
>>> <stavr.chris at gmail.com> wrote:
>>>> I am using Puka client [1] in order to send messages with guaranteed
>>>> delivery using publisher confirms.
>>>>
>>>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>>>> lot of time.
>>>>
>>>> To be more specific:
>>>>
>>>> ??? promises = []
>>>> ??? t0 = time.time()
>>>> ??? for i in range(0,200000):
>>>> ??? ??? promise = client.basic_publish(exchange='test_exchange',
>>>> routing_key='test',
>>>> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
>>>> world!")
>>>> ??? ??? promises.append(promise)
>>>>
>>
>> Right, there is a performance problem with handling pubacks. The complexity
>> grows with n^2 of unacked messages
>>
>> Good news: the problem is in this line:
>> ? https://github.com/majek/puka/blob/master/puka/machine.py#L147-148
>>
>> Bad news: I have no clue how to fix it.
>>
>> I've rised an issue on github:
>> ? https://github.com/majek/puka/issues/12
>
> Christos,
>
> Thanks for your report and for the pull request!
>
> I just uploaded puka 0.0.4 to pypi, which solves the problem.
>
> Cheers,
> ? ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From majek04 at gmail.com  Tue Mar 20 13:06:51 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 20 Mar 2012 13:06:51 +0000
Subject: [rabbitmq-discuss] Puka client and publisher confirms
	performance
In-Reply-To: <CAHiEoM5oAu=6rZdwj2OPKk3i4QqtrepF2b+zsYmcHtmz7zbYVA@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
	<CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>
	<CABzX+qyK_-3zK3fsMsRA5F6k7yv62HsCB1gMsc2hiyR1pK9Z1A@mail.gmail.com>
	<CAHiEoM5oAu=6rZdwj2OPKk3i4QqtrepF2b+zsYmcHtmz7zbYVA@mail.gmail.com>
Message-ID: <CABzX+qw8NhngbH7DnirubzS7tXpMUm8cicye6gm0NVq_AdavZQ@mail.gmail.com>

On Tue, Mar 20, 2012 at 12:52, Aaron Westendorf <aaron at agoragames.com> wrote:
> I looked at the changes and in addition to those, I recommend using
> the Python deque class for your buffers. I noticed a significant
> improvement in performance when I switched to them in haigha.

For which buffers exactly? Network one: simplebuffer.py?

Marek

> On Tue, Mar 20, 2012 at 6:41 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Wed, Mar 14, 2012 at 18:59, Marek Majkowski <majek04 at gmail.com> wrote:
>>> On Wed, Mar 14, 2012 at 18:42, Marek Majkowski <majek04 at gmail.com> wrote:
>>>> On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
>>>> <stavr.chris at gmail.com> wrote:
>>>>> I am using Puka client [1] in order to send messages with guaranteed
>>>>> delivery using publisher confirms.
>>>>>
>>>>> Trying to send 200.000 messages I see that waiting for the confirms, takes a
>>>>> lot of time.
>>>>>
>>>>> To be more specific:
>>>>>
>>>>> ??? promises = []
>>>>> ??? t0 = time.time()
>>>>> ??? for i in range(0,200000):
>>>>> ??? ??? promise = client.basic_publish(exchange='test_exchange',
>>>>> routing_key='test',
>>>>> ???????? ?? ??? ??? ??? ??? ??? ??? ??? ? ??????????????????? body="Hello
>>>>> world!")
>>>>> ??? ??? promises.append(promise)
>>>>>
>>>
>>> Right, there is a performance problem with handling pubacks. The complexity
>>> grows with n^2 of unacked messages
>>>
>>> Good news: the problem is in this line:
>>> ? https://github.com/majek/puka/blob/master/puka/machine.py#L147-148
>>>
>>> Bad news: I have no clue how to fix it.
>>>
>>> I've rised an issue on github:
>>> ? https://github.com/majek/puka/issues/12
>>
>> Christos,
>>
>> Thanks for your report and for the pull request!
>>
>> I just uploaded puka 0.0.4 to pypi, which solves the problem.
>>
>> Cheers,
>> ? ?Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com

From gerolf.seitz at gmail.com  Tue Mar 20 13:17:35 2012
From: gerolf.seitz at gmail.com (Gerolf Seitz)
Date: Tue, 20 Mar 2012 14:17:35 +0100
Subject: [rabbitmq-discuss] Active consumers in declare-ok is less than
 the actual number of consumers
In-Reply-To: <4F68674C.4030407@rabbitmq.com>
References: <CAPeHLwa1tHwpxbkY3Xd2+oeraWtrzTLzvNjzsduMDu-JwaCSHg@mail.gmail.com>
	<4F68674C.4030407@rabbitmq.com>
Message-ID: <CAPeHLwb-hYXFWJEvO83yNk0FsGucPazEHQwu-hdPDW1v9D=y7A@mail.gmail.com>

On Tue, Mar 20, 2012 at 12:17 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 20/03/12 06:43, Gerolf Seitz wrote:
>
>> When passively declaring a queue, the returned consumer count is not the
>> same as the consumer count via the management plugin / http API. Turns
>> out, rabbitmq returns the number of consumers that are ready to receive
>> a message.
>>
>> As an example: there are 5 (manually acknowledging) consumers, 3 of
>> which have consumed a message from the queue, but have not sent an ACK
>> for the respective messages to the broker. Declaring a queue now returns
>> a declare-ok with consumer-count == 2, whereas I would have expected it
>> to be 5.
>>
>> Looking at the rabbitmq-server code reveals that the "active consumer"
>> part of the state is used for getting the next consumer for round robin
>> delivery and returning the number of consumers as part of the declare-ok
>> message.
>>
>> Since I don't suspect this to be an oversight but rather a conscious
>> decision, I'm interested in the rationale behind it. I'm aware that
>> changing the semantics at this point is probably not possible and I may
>> have to resort to fetching the consumer count via the http api (which
>> brings some organizational overhead).
>>
>> Can anybody shed some light on this?
>>
>
> Hi Gerolf.
>
> Yes, this is deliberate. Code archaeology yielded this:
>
> http://hg.rabbitmq.com/**rabbitmq-server/rev/**32e357ad03d6<http://hg.rabbitmq.com/rabbitmq-server/rev/32e357ad03d6>
>
> "count queue consumers as required by the spec".
>
> The spec actually says:
>
>    Reports the number of active consumers for the queue. Note that
>    consumers can  suspend activity (Channel.Flow) in which case they
>    do not appear in this count.
>
> So that is slightly ambiguous - we are excluding consumers that have
> issued channel.flow, but also those which are blocked due to qos / ack
> interaction. But those could easily be defined as "inactive"...
>
> Hmm. I'll have a think about this. What are you trying to do?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>

The reply-to-author setting of rabbitmq-discuss screwed me ;)



Hi,

The use case is this:

We have a pool of consumers (each running in a heavy weight process) that
can only process a single unit of work at a time each.
The messages that are sent to these consumers contain data that can become
"old" quite quickly (think stock ticks), so queuing hundreds of messages is
not an option.
Also, these consumers need to be kept busy all the time: as soon as a unit
of work is done, the next task will be submitted and picked up by the free
consumer. (prefetch=1, autoack=false).

Based on the number of consumers, the system decides which unit of work is
sent next, mostly based on the previous time the unit of work took to
complete.

Example:
7 consumers overall
Per configuration, only up to 4 consumers may be used to process really
long running tasks (eg. >1 minute task duration)
The rest of the consumers is used for short running tasks. (eg. <1 minute)

The reason why we don't have 2 different queues is twofold:
1) if there are no long running tasks to be executed, all consumers should
be used for short running tasks
2) the decision whether a task is short or long running is made by the
system that sends the messages to the broker and the decision process can
be tweaked via configuration. This is easier to manipulate than
reconfiguring and restarting the heavy weight consumer processes.

I hope this clears it up a bit ;)

Cheers


-- 
Gerolf Seitz

twitter: @gersei
code: github.com/gseitz
blog: www.gerolfseitz.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/e98dbf24/attachment.htm>

From egermann at limanews.com  Tue Mar 20 13:24:40 2012
From: egermann at limanews.com (Eric Germann)
Date: Tue, 20 Mar 2012 06:24:40 -0700
Subject: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster
	//	newcomer question
In-Reply-To: <4F68751D.9060007@rabbitmq.com>
References: <6244CA0E5130B349820CA2E8B24DC26250E98BA8@VA3DIAXVSC31.RED001.local>
	<4F68751D.9060007@rabbitmq.com>
Message-ID: <6244CA0E5130B349820CA2E8B24DC26250E98D31@VA3DIAXVSC31.RED001.local>

De-install / re-install of RAM nodes fixed it.

EKG


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, March 20, 2012 8:16 AM
To: Eric Germann
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrading 2.7.1 to 2.8.0 in a cluster // newcomer question

On 19/03/12 16:52, Eric Germann wrote:
> Cluster upgrade needed but this is a ram node.
> Please first start the last disc node to shut down.

Damn, this is a bug.

If your RAM node does not contain any persistent messages in durable queues, you can just reset it and rejoin the cluster. If not, umm, you'll have to wait for the fix we will no doubt release soon.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


From jan.afzal at gmail.com  Tue Mar 20 13:44:58 2012
From: jan.afzal at gmail.com (ajan)
Date: Tue, 20 Mar 2012 06:44:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Monitor memory and cpu usage of RabbitMQ
	message broker
In-Reply-To: <4F686006.8090801@rabbitmq.com>
References: <0c278d88-d7f8-4a1e-877d-cb5c42c0dc0f@cj6g2000vbb.googlegroups.com>
	<4F686006.8090801@rabbitmq.com>
Message-ID: <93706c59-b9fe-4105-bda0-589feae76f10@gw9g2000vbb.googlegroups.com>

Thanks for the quick response Simon.

My requirement is to come up with a recommendation on how and what
memory allocation is required for RabbitMQ for our usage. I need to
get a throughput of 5000 messages/second. For this do I need to
allocate 256MB or 3GB of my RAM. And what would be the CPU utilization
when I need the broker to pass 5000 messages/second.

The RabbitMQ broker will be part of a VM that hosts services as a
result if there is need for additional memory then I need to come up
with a number that would support the throughput required. Also there
would be need of Clustering and High Availability setup.

All these can be answered if I can profile the RabbitMQ broker. What u
say?

Cheers

On Mar 20, 3:46?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 20/03/12 10:30, ajan wrote:
>
> > Are there any tools to monitor the memory and cpu usage of rabbitmq
> > message broker. For java process we have yourkit. Are there any such
> > tools for Erlang that I can use to monitor the message broker service.
>
> The management plugin will report on memory use, but not CPU use. I
> would always assume if you wanted to monitor CPU use on a Rabbit node
> you'd use an external tool like Nagios anyway.
>
> I note that yourkit is actually a *profiler*. If you want to *profile*
> RabbitMQ then Erlang has some profiling capabilities (albeit not shiny
> polished GUIs). But is that what you want? I would view profiling
> RabbitMQ as more my problem than yours :-)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From daverstevens at gmail.com  Tue Mar 20 14:23:42 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Tue, 20 Mar 2012 07:23:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Autodelete queues not being deleted
Message-ID: <18062715.5930.1332253422020.JavaMail.geo-discussion-forums@vbiz13>

I frequently notice that queues which were created with autodelete are not 
actually deleted once there are no more consumers. This is an issue because 
they continue to receive messages when they should instead be deleted. Am I 
misunderstanding the effect that the autodelete flag has on queues? Is 
there another explanation for this behavior?

Using rabbitmq 2.7.1 on cluster.

Below is json from manager web api for one such queue. Node host name 
removed. Note consumers "consumers":0 and "auto_delete":true

{"memory":230544,"idle_since":"2012-3-20 10:12:51","exclusive_consumer_tag":"","messages_ready":318,"messages_unacknowledged":0,"messages":318,"consumers":0,"slave_nodes":[],"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":318,"len":318,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":318,"ram_ack_count":0,"next_seq_id":318,"persistent_count":0,"avg_ingress_rate":0.1407138438947011,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":56241811945,"last_event":1332252771225},"messages_ready_details":{"rate":0,"interval":56241811945,"last_event":1332252771225},"messages_unacknowledged_details":{"rate":0,"interval":56241811945,"last_event":1332252771225},"consumer_details":[],"name":"bt.cs.ep.private-7c49741e-018d-48c8-aee3-e654c302176d","vhost":"/","durable":false,"auto_delete":true,"arguments":{},"node":"********"}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/0cbfed78/attachment.htm>

From simon at rabbitmq.com  Tue Mar 20 14:32:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 14:32:13 +0000
Subject: [rabbitmq-discuss] Autodelete queues not being deleted
In-Reply-To: <18062715.5930.1332253422020.JavaMail.geo-discussion-forums@vbiz13>
References: <18062715.5930.1332253422020.JavaMail.geo-discussion-forums@vbiz13>
Message-ID: <4F6894ED.9070604@rabbitmq.com>

On 20/03/12 14:23, Dave Stevens wrote:
> I frequently notice that queues which were created with autodelete are
> not actually deleted once there are no more consumers.

Just to be absolutely clear here: you mean they had consumers once, and 
then the consumers all went away? If the queue never has consumers it 
will not autodelete (otherwise it would autodelete as soon as you 
created it).

If you do mean that there were once consumers and the queue is still not 
getting deleted, then yes, that would be wrong. We do test for this 
though :-) so a test program would be helpful.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From daverstevens at gmail.com  Tue Mar 20 14:44:35 2012
From: daverstevens at gmail.com (Dave Stevens)
Date: Tue, 20 Mar 2012 10:44:35 -0400
Subject: [rabbitmq-discuss] Autodelete queues not being deleted
In-Reply-To: <4F6894ED.9070604@rabbitmq.com>
References: <18062715.5930.1332253422020.JavaMail.geo-discussion-forums@vbiz13>
	<4F6894ED.9070604@rabbitmq.com>
Message-ID: <CALQa0h1uB-qxxOZKc-fK10f9Ejn_etEPiGZoWPivc-ESbAXdTw@mail.gmail.com>

Hrmmmm, you bring up a good point. A queue with this name definitely once
had consumers. It looks like there were never any deliveries for the exact
queue in question though. I'm thinking that the reconnect logic in the
library I'm using is causing queues to be redeclared when my app is
shutting down.


On Tue, Mar 20, 2012 at 10:32 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 20/03/12 14:23, Dave Stevens wrote:
>
>> I frequently notice that queues which were created with autodelete are
>> not actually deleted once there are no more consumers.
>>
>
> Just to be absolutely clear here: you mean they had consumers once, and
> then the consumers all went away? If the queue never has consumers it will
> not autodelete (otherwise it would autodelete as soon as you created it).
>
> If you do mean that there were once consumers and the queue is still not
> getting deleted, then yes, that would be wrong. We do test for this though
> :-) so a test program would be helpful.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/03e86c2d/attachment.htm>

From alan.antonuk at gmail.com  Tue Mar 20 15:06:45 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 20 Mar 2012 11:06:45 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
Message-ID: <CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>

I'm not sure AMQP/rabbitmq-c client would be able to run on that
constrained of a system (someone else on this list might correct me though).

In general you're going to need a TCP/IP stack so you can connect to the
broker, then enough memory to hold a couple frames (the minimum frame size
is 4096 bytes).  You could probably do it with smaller buffers but it's not
something done with most client libraries.

If that all will fit in your constrained system, I would probably pick
apart the the rabbitmq-c library and pare it down to something that does
the minimum you need. Then again I'm not experienced with development of
embedded devices, so I'm not sure how people typically accomplish these
things.

HTH
-Alan

On Mon, Mar 19, 2012 at 11:41 AM, Dirk <dirk.swart at gmail.com> wrote:

> - Does anyone have code for the simplest possible message producer?
>
> I would like to produce messages from a _very_ memory constrained
> embedded system*. Can anyone advise me on what the absolute minimum I
> have to do to produce and send a message is?
>
> Also, if anyone can point me towards what a simple "hello world"
> message template looks like, it would be appreciated. More details:
> I'm thinking of the sort of message that the Tutorials cover (eg:
> http://www.rabbitmq.com/tutorials/tutorial-one-python.html)
>
> Thanks in advance - I'm a Rabbit noob, apologies if this post is not
> using the correct terms.
>
> * ATMega 328p, same chip the Arduino uses.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/9bb801f9/attachment.htm>

From simon at rabbitmq.com  Tue Mar 20 15:13:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 15:13:06 +0000
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
Message-ID: <4F689E82.2050303@rabbitmq.com>

And if rabbitmq-c is still too big, and all you need to do is publish 
messages from the tiniest client possible, you might want to look at 
STOMP - you could probably write a minimal publish-only client quite 
simply, and it would be pretty small.

Cheers, Simon

On 20/03/12 15:06, Alan Antonuk wrote:
> I'm not sure AMQP/rabbitmq-c client would be able to run on that
> constrained of a system (someone else on this list might correct me though).
>
> In general you're going to need a TCP/IP stack so you can connect to the
> broker, then enough memory to hold a couple frames (the minimum frame
> size is 4096 bytes).  You could probably do it with smaller buffers but
> it's not something done with most client libraries.
>
> If that all will fit in your constrained system, I would probably pick
> apart the the rabbitmq-c library and pare it down to something that does
> the minimum you need. Then again I'm not experienced with development of
> embedded devices, so I'm not sure how people typically accomplish these
> things.
>
> HTH
> -Alan
>
> On Mon, Mar 19, 2012 at 11:41 AM, Dirk <dirk.swart at gmail.com
> <mailto:dirk.swart at gmail.com>> wrote:
>
>     - Does anyone have code for the simplest possible message producer?
>
>     I would like to produce messages from a _very_ memory constrained
>     embedded system*. Can anyone advise me on what the absolute minimum I
>     have to do to produce and send a message is?
>
>     Also, if anyone can point me towards what a simple "hello world"
>     message template looks like, it would be appreciated. More details:
>     I'm thinking of the sort of message that the Tutorials cover (eg:
>     http://www.rabbitmq.com/tutorials/tutorial-one-python.html)
>
>     Thanks in advance - I'm a Rabbit noob, apologies if this post is not
>     using the correct terms.
>
>     * ATMega 328p, same chip the Arduino uses.
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at myyearbook.com  Tue Mar 20 15:21:45 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 20 Mar 2012 11:21:45 -0400
Subject: [rabbitmq-discuss] Puka client and publisher confirms
 performance
In-Reply-To: <CAHiEoM5oAu=6rZdwj2OPKk3i4QqtrepF2b+zsYmcHtmz7zbYVA@mail.gmail.com>
References: <4F608FAE.9060608@gmail.com>
	<CABzX+qzjOifMDg7FX1VnPqpMJFuh-U6FSLjdoqqe3jsnWkDPVA@mail.gmail.com>
	<CABzX+qyZUb60gRPi28H0btPp8zWY7JcQKDanErvt25O993Ba2Q@mail.gmail.com>
	<CABzX+qyK_-3zK3fsMsRA5F6k7yv62HsCB1gMsc2hiyR1pK9Z1A@mail.gmail.com>
	<CAHiEoM5oAu=6rZdwj2OPKk3i4QqtrepF2b+zsYmcHtmz7zbYVA@mail.gmail.com>
Message-ID: <2AA5978570114CDD8D9A65E09DB719D5@myyearbook.com>

Thanks for the indirect heads up on this ;-) 


On Tuesday, March 20, 2012 at 8:52 AM, Aaron Westendorf wrote:

> I looked at the changes and in addition to those, I recommend using
> the Python deque class for your buffers. I noticed a significant
> improvement in performance when I switched to them in haigha.
> 
> cheers,
> Aaron
> 
> 
> 
> On Tue, Mar 20, 2012 at 6:41 AM, Marek Majkowski <majek04 at gmail.com (mailto:majek04 at gmail.com)> wrote:
> > On Wed, Mar 14, 2012 at 18:59, Marek Majkowski <majek04 at gmail.com (mailto:majek04 at gmail.com)> wrote:
> > > On Wed, Mar 14, 2012 at 18:42, Marek Majkowski <majek04 at gmail.com (mailto:majek04 at gmail.com)> wrote:
> > > > On Wed, Mar 14, 2012 at 12:31, Christos Stavrakakis
> > > > <stavr.chris at gmail.com (mailto:stavr.chris at gmail.com)> wrote:
> > > > > I am using Puka client [1] in order to send messages with guaranteed
> > > > > delivery using publisher confirms.
> > > > > 
> > > > > Trying to send 200.000 messages I see that waiting for the confirms, takes a
> > > > > lot of time.
> > > > > 
> > > > > To be more specific:
> > > > > 
> > > > >     promises = []
> > > > >     t0 = time.time()
> > > > >     for i in range(0,200000):
> > > > >         promise = client.basic_publish(exchange='test_exchange',
> > > > > routing_key='test',
> > > > >                                                               body="Hello
> > > > > world!")
> > > > >         promises.append(promise)
> > > > > 
> > > > 
> > > > 
> > > 
> > > 
> > > Right, there is a performance problem with handling pubacks. The complexity
> > > grows with n^2 of unacked messages
> > > 
> > > Good news: the problem is in this line:
> > >   https://github.com/majek/puka/blob/master/puka/machine.py#L147-148
> > > 
> > > Bad news: I have no clue how to fix it.
> > > 
> > > I've rised an issue on github:
> > >   https://github.com/majek/puka/issues/12
> > > 
> > 
> > 
> > Christos,
> > 
> > Thanks for your report and for the pull request!
> > 
> > I just uploaded puka 0.0.4 to pypi, which solves the problem.
> > 
> > Cheers,
> >    Marek
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> 
> 
> 
> -- 
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com (mailto:aaron at agoragames.com)
> www.agoragames.com (http://www.agoragames.com)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/2e473629/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 20 15:30:08 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Mar 2012 11:30:08 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <4F689E82.2050303@rabbitmq.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
Message-ID: <CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>

The other option would be to use UDP and build a trivial UDP-accepting
plugin for RabbitMQ, thus moving almost all of the complexity and
memory-requirements onto the server. (Actually that'd be a nice feature to
have in general.)


On 20 March 2012 11:13, Simon MacMullen <simon at rabbitmq.com> wrote:

> And if rabbitmq-c is still too big, and all you need to do is publish
> messages from the tiniest client possible, you might want to look at STOMP
> - you could probably write a minimal publish-only client quite simply, and
> it would be pretty small.
>
> Cheers, Simon
>
>
> On 20/03/12 15:06, Alan Antonuk wrote:
>
>> I'm not sure AMQP/rabbitmq-c client would be able to run on that
>> constrained of a system (someone else on this list might correct me
>> though).
>>
>> In general you're going to need a TCP/IP stack so you can connect to the
>> broker, then enough memory to hold a couple frames (the minimum frame
>> size is 4096 bytes).  You could probably do it with smaller buffers but
>> it's not something done with most client libraries.
>>
>> If that all will fit in your constrained system, I would probably pick
>> apart the the rabbitmq-c library and pare it down to something that does
>> the minimum you need. Then again I'm not experienced with development of
>> embedded devices, so I'm not sure how people typically accomplish these
>> things.
>>
>> HTH
>> -Alan
>>
>> On Mon, Mar 19, 2012 at 11:41 AM, Dirk <dirk.swart at gmail.com
>> <mailto:dirk.swart at gmail.com>> wrote:
>>
>>    - Does anyone have code for the simplest possible message producer?
>>
>>    I would like to produce messages from a _very_ memory constrained
>>    embedded system*. Can anyone advise me on what the absolute minimum I
>>    have to do to produce and send a message is?
>>
>>    Also, if anyone can point me towards what a simple "hello world"
>>    message template looks like, it would be appreciated. More details:
>>    I'm thinking of the sort of message that the Tutorials cover (eg:
>>    http://www.rabbitmq.com/**tutorials/tutorial-one-python.**html<http://www.rabbitmq.com/tutorials/tutorial-one-python.html>
>> )
>>
>>    Thanks in advance - I'm a Rabbit noob, apologies if this post is not
>>    using the correct terms.
>>
>>    * ATMega 328p, same chip the Arduino uses.
>>    ______________________________**_________________
>>    rabbitmq-discuss mailing list
>>    rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>    <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>    https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/bc557695/attachment.htm>

From simon at rabbitmq.com  Tue Mar 20 15:31:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Mar 2012 15:31:37 +0000
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
Message-ID: <4F68A2D9.4070804@rabbitmq.com>

On 20/03/12 15:30, Tony Garnock-Jones wrote:
> The other option would be to use UDP and build a trivial UDP-accepting
> plugin for RabbitMQ, thus moving almost all of the complexity and
> memory-requirements onto the server. (Actually that'd be a nice feature
> to have in general.)

Or MQTT maybe.

I was trying to come up with an option that didn't require me to do any 
work ;-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jerryk at vmware.com  Tue Mar 20 15:49:02 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 08:49:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
Message-ID: <13510180.145.1332258542124.JavaMail.jerryk@StrongMad.local>

This answer is likely to be less interesting/applicable to many
people than Tony and Simon's suggestions which can at least be
done entirely in software, but...

You could embrace the option of offloading more of the work into
another piece of hardware the way the Ethernet shields for Arduino
boards (also based on the ATmega family of microcontrollers) work.

For your network connectivity you could use an (almost, modulo
probably power supply) all in one part like the Wiznet W5100, 
which gives you a TCP and UDP supporting IP stack baked into an 
Ethernet chip.  Your could would then talk to this thing via SPI,
something that at least will fit on the ATmega side...

If you're using Arduino, you can buy most of this stuff pre-made.
If not, it's probably a few afternoons of breadboarding and debugging,
although IIRC the Wiznet only comes in a tiny surface mount package 
that might be annoying to work with, depending on how you're equipped.

Best regards,
Jerry

----- Original Message -----
From: "Tony Garnock-Jones" <tonygarnockjones+rabbitmq at gmail.com>
To: "Simon MacMullen" <simon at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com, "Dirk" <dirk.swart at gmail.com>
Sent: Tuesday, March 20, 2012 8:30:08 AM
Subject: Re: [rabbitmq-discuss] Simplest possible embedded message producer


The other option would be to use UDP and build a trivial UDP-accepting plugin for RabbitMQ, thus moving almost all of the complexity and memory-requirements onto the server. (Actually that'd be a nice feature to have in general.) 



On 20 March 2012 11:13, Simon MacMullen < simon at rabbitmq.com > wrote: 


And if rabbitmq-c is still too big, and all you need to do is publish messages from the tiniest client possible, you might want to look at STOMP - you could probably write a minimal publish-only client quite simply, and it would be pretty small. 

Cheers, Simon 


On 20/03/12 15:06, Alan Antonuk wrote: 



I'm not sure AMQP/rabbitmq-c client would be able to run on that 
constrained of a system (someone else on this list might correct me though). 

In general you're going to need a TCP/IP stack so you can connect to the 
broker, then enough memory to hold a couple frames (the minimum frame 
size is 4096 bytes). You could probably do it with smaller buffers but 
it's not something done with most client libraries. 

If that all will fit in your constrained system, I would probably pick 
apart the the rabbitmq-c library and pare it down to something that does 
the minimum you need. Then again I'm not experienced with development of 
embedded devices, so I'm not sure how people typically accomplish these 
things. 

HTH 
-Alan 

On Mon, Mar 19, 2012 at 11:41 AM, Dirk < dirk.swart at gmail.com 

<mailto: dirk.swart at gmail.com >> wrote: 

- Does anyone have code for the simplest possible message producer? 

I would like to produce messages from a _very_ memory constrained 
embedded system*. Can anyone advise me on what the absolute minimum I 
have to do to produce and send a message is? 

Also, if anyone can point me towards what a simple "hello world" 
message template looks like, it would be appreciated. More details: 
I'm thinking of the sort of message that the Tutorials cover (eg: 
http://www.rabbitmq.com/ tutorials/tutorial-one-python. html ) 

Thanks in advance - I'm a Rabbit noob, apologies if this post is not 
using the correct terms. 

* ATMega 328p, same chip the Arduino uses. 
______________________________ _________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists. rabbitmq.com 
<mailto: rabbitmq-discuss@ lists.rabbitmq.com > 
https://lists.rabbitmq.com/ cgi-bin/mailman/listinfo/ rabbitmq-discuss 





______________________________ _________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists. rabbitmq.com 
https://lists.rabbitmq.com/ cgi-bin/mailman/listinfo/ rabbitmq-discuss 


-- 
Simon MacMullen 
RabbitMQ, VMware 


______________________________ _________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists. rabbitmq.com 
https://lists.rabbitmq.com/ cgi-bin/mailman/listinfo/ rabbitmq-discuss 



-- 
Tony Garnock-Jones 
tonygarnockjones at gmail.com 
http://homepages.kcbbs.gen.nz/tonyg/ 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Tue Mar 20 15:56:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 08:56:34 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <de0df287-95b5-4a8c-9d9e-d665a149f779@t8g2000pbe.googlegroups.com>
Message-ID: <2713253.188.1332258994665.JavaMail.jerryk@StrongMad.local>

Hi, Mamut:

I'm not sure what you mean by Rabbit client libs for VMware ESXi...
The client libraries, i.e. the things that let you write applications
that send and receive messages via Rabbit are programming language
specific.  What language do you plan to write your applications in?
Clients exist in most of the popular languages (Java, C#, Python,
Ruby, etc...)

Jerry

----- Original Message -----
From: "mamut" <ktopytatenpyta at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 3:21:49 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ on ESXi

I'm currently searching for (rabbit) client libs for VMware ESXi - any
language considered, and for Windows - c++. Are there any?

best regards,
mamut
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ktopytatenpyta at gmail.com  Tue Mar 20 16:52:38 2012
From: ktopytatenpyta at gmail.com (mamut)
Date: Tue, 20 Mar 2012 09:52:38 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <2713253.188.1332258994665.JavaMail.jerryk@StrongMad.local>
References: <2713253.188.1332258994665.JavaMail.jerryk@StrongMad.local>
Message-ID: <90bf3027-7be8-48de-a8dc-91c129faf77e@pg2g2000pbb.googlegroups.com>

Hi, Jerry

You are quite right about what I wanted to express. Sorry for not
stating it clear enough. I try to write apps in c++ (windows) and I'm
interested if any language is supported by some libraries on ESXi.
(Yes, the things that let you write apps that send/receive messages
via RabbitMQ). I just know that c++ is not the best supported language
for RabbitMQ.

mamut

From jerryk at vmware.com  Tue Mar 20 17:00:25 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 10:00:25 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on ESXi
In-Reply-To: <90bf3027-7be8-48de-a8dc-91c129faf77e@pg2g2000pbb.googlegroups.com>
Message-ID: <11799657.221.1332262822179.JavaMail.jerryk@StrongMad.local>

Hi, Mamut:

Many clients are documented here:

http://www.rabbitmq.com/devtools.html

This is a C client, although it's not necessarily the easiest one to use.
If you're on Windows, you might consider using the .NET client, written in
C#, either from managed code, or perhaps via interop from unmanaged code.

ESXi I think still remains a red herring of sorts.  You'll be running Rabbit
on some OS, whether hosted baremetal or as a guest in a hypervisor, so choose
your language/client/build environment to suit that OS. :-)

Best regards,
Jerry

----- Original Message -----
From: "mamut" <ktopytatenpyta at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 9:52:38 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ on ESXi

Hi, Jerry

You are quite right about what I wanted to express. Sorry for not
stating it clear enough. I try to write apps in c++ (windows) and I'm
interested if any language is supported by some libraries on ESXi.
(Yes, the things that let you write apps that send/receive messages
via RabbitMQ). I just know that c++ is not the best supported language
for RabbitMQ.

mamut
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david.priddle at betgenius.com  Tue Mar 20 17:55:19 2012
From: david.priddle at betgenius.com (David Priddle)
Date: Tue, 20 Mar 2012 17:55:19 +0000
Subject: [rabbitmq-discuss] Rabbit 2.8.0 .NET Client available on Nuget?
Message-ID: <9C1945D202940B47A9F587776BEE7F401367F9B515@exchg02>

Hi.

Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET client libraries available via Nuget? (2.7.1 is the latest version available there.)

https://nuget.org/packages/RabbitMQ.Client

Regards,
Dave.

DAVID PRIDDLE
Development Team Lead

M: +44(0) 7964 901158
T:  +44(0) 207 438 8667
F:  +44(0) 207 900 2087
E: david.priddle at betgenius.com<mailto:david.priddle at betgenius.com>
W: betgenius.com<http://www.betgenius.com/>

[cid:image001.png at 01CD06C2.9D5444A0]
Betgenius Limited. Registered Office: 1st Floor Melbourne House, 46 Aldwych
London, WC2B 4LL. Company No. 4062777

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/d2a331aa/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 4792 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/d2a331aa/attachment.png>

From jay at custin.com  Tue Mar 20 18:23:41 2012
From: jay at custin.com (SenseiC)
Date: Tue, 20 Mar 2012 11:23:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <4F674B1F.7070508@rabbitmq.com>
References: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
	<4F674B1F.7070508@rabbitmq.com>
Message-ID: <33540704.post@talk.nabble.com>


Well at least you have it WORKING.  I have had no end of "entertainment" with
this plugin.  My latest attempt to get it to work... at all included:

Uninstalling RabbitMQ Server
Deleting the entire %AppData%\RabbitMQ directory
Installing RabbitMQ (2.8.0 in this case)
Enabling the Management Plugin

Opened browser.  Went to http://localhost:55672/ and...

Firefox can't establish a connection to the server at localhost:55672.

Equally entertaining (at least to me):

C:\netstat -an | find "5672"
  TCP    0.0.0.0:5672           0.0.0.0:0              LISTENING
  TCP    [::]:5672              [::]:0                 LISTENING

Which makes me scratch my head and wonder how it WOULD even respond since
nothing appears to listen to port 55672.  I thought I had misread the port
number, but nope.  I had the same behavior on my notebook.  Just in case
this matters, both systems have Windows 7 x64 installed.

C:\>rabbitmq-plugins list
[e] amqp_client                       2.8.0
[ ] eldap                             2.8.0-git
[ ] erlando                           2.8.0
[e] mochiweb                          1.3-rmq2.8.0-git
[ ] rabbitmq_auth_backend_ldap        2.8.0
[ ] rabbitmq_auth_mechanism_ssl       2.8.0
[ ] rabbitmq_consistent_hash_exchange 2.8.0
[ ] rabbitmq_federation               2.8.0
[ ] rabbitmq_jsonrpc                  2.8.0
[ ] rabbitmq_jsonrpc_channel          2.8.0
[ ] rabbitmq_jsonrpc_channel_examples 2.8.0
[E] rabbitmq_management               2.8.0
[e] rabbitmq_management_agent         2.8.0
[ ] rabbitmq_management_visualiser    2.8.0
[e] rabbitmq_mochiweb                 2.8.0
[ ] rabbitmq_shovel                   2.8.0
[ ] rabbitmq_shovel_management        2.8.0
[ ] rabbitmq_stomp                    2.8.0
[ ] rabbitmq_tracing                  2.8.0
[ ] rfc4627_jsonrpc                   2.8.0-git
[e] webmachine                        1.7.0-rmq2.8.0-hg

C:\>erl
Eshell V5.9  (abort with ^G)
1> q().
ok
2>
C:\>


I would appreciate any insight on what I have left out/overlooked
Jay
-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540704.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gmr at myyearbook.com  Tue Mar 20 18:30:18 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 20 Mar 2012 14:30:18 -0400
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <33540704.post@talk.nabble.com>
References: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
	<4F674B1F.7070508@rabbitmq.com> <33540704.post@talk.nabble.com>
Message-ID: <4CACFD89B7A64361AB7EAF127DAE5417@myyearbook.com>



On Tuesday, March 20, 2012 at 2:23 PM, SenseiC wrote:

> C:\netstat -an | find "5672" 
Did you mean 'C:\netstat -an | find "55672"'

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/a5df94cb/attachment.htm>

From jerryk at vmware.com  Tue Mar 20 18:30:36 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 11:30:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <33540704.post@talk.nabble.com>
Message-ID: <4732463.285.1332268233071.JavaMail.jerryk@StrongMad.local>

Hi, Jay:

Have you made sure to follow the indicated instructions that should
appear onscreen when you enable the plugin with rabbitmq-plugins.bat,
namely:

"If you have RabbitMQ running as a service then you must"
                       " reinstall by running~n  rabbitmq-service.bat stop~n"
                       "  rabbitmq-service.bat install~n"
                       "  rabbitmq-service.bat start~n~n

Best regards,
Jerry

----- Original Message -----
From: "SenseiC" <jay at custin.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 11:23:41 AM
Subject: Re: [rabbitmq-discuss] Management plugin browser issue on 2.8.0


Well at least you have it WORKING.  I have had no end of "entertainment" with
this plugin.  My latest attempt to get it to work... at all included:

Uninstalling RabbitMQ Server
Deleting the entire %AppData%\RabbitMQ directory
Installing RabbitMQ (2.8.0 in this case)
Enabling the Management Plugin

Opened browser.  Went to http://localhost:55672/ and...

Firefox can't establish a connection to the server at localhost:55672.

Equally entertaining (at least to me):

C:\netstat -an | find "5672"
  TCP    0.0.0.0:5672           0.0.0.0:0              LISTENING
  TCP    [::]:5672              [::]:0                 LISTENING

Which makes me scratch my head and wonder how it WOULD even respond since
nothing appears to listen to port 55672.  I thought I had misread the port
number, but nope.  I had the same behavior on my notebook.  Just in case
this matters, both systems have Windows 7 x64 installed.

C:\>rabbitmq-plugins list
[e] amqp_client                       2.8.0
[ ] eldap                             2.8.0-git
[ ] erlando                           2.8.0
[e] mochiweb                          1.3-rmq2.8.0-git
[ ] rabbitmq_auth_backend_ldap        2.8.0
[ ] rabbitmq_auth_mechanism_ssl       2.8.0
[ ] rabbitmq_consistent_hash_exchange 2.8.0
[ ] rabbitmq_federation               2.8.0
[ ] rabbitmq_jsonrpc                  2.8.0
[ ] rabbitmq_jsonrpc_channel          2.8.0
[ ] rabbitmq_jsonrpc_channel_examples 2.8.0
[E] rabbitmq_management               2.8.0
[e] rabbitmq_management_agent         2.8.0
[ ] rabbitmq_management_visualiser    2.8.0
[e] rabbitmq_mochiweb                 2.8.0
[ ] rabbitmq_shovel                   2.8.0
[ ] rabbitmq_shovel_management        2.8.0
[ ] rabbitmq_stomp                    2.8.0
[ ] rabbitmq_tracing                  2.8.0
[ ] rfc4627_jsonrpc                   2.8.0-git
[e] webmachine                        1.7.0-rmq2.8.0-hg

C:\>erl
Eshell V5.9  (abort with ^G)
1> q().
ok
2>
C:\>


I would appreciate any insight on what I have left out/overlooked
Jay
-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540704.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jay at custin.com  Tue Mar 20 18:58:09 2012
From: jay at custin.com (SenseiC)
Date: Tue, 20 Mar 2012 11:58:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <4732463.285.1332268233071.JavaMail.jerryk@StrongMad.local>
References: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
	<4F674B1F.7070508@rabbitmq.com> <33540704.post@talk.nabble.com>
	<4732463.285.1332268233071.JavaMail.jerryk@StrongMad.local>
Message-ID: <33540889.post@talk.nabble.com>


Yes.  I even tried/used restarting the RabbitMQ service from Windows
Services.  I included the comment about my notebook though omitted that I
even rebooted the notebook as a "last-ditch" effort.  No change.

BTW Since I hadn't DONE anything with RabbitMQ, my ACTUAL "installation"
method amounted to the following:

1. Shutdown RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - stop
2. From the Windows Control Panel uninstall RabbitMQ
3. From Windows Explorer delete the entire %AppData%\RabbitMQ directory
4. Install RabbitMQ V2.8.0 by double-clicking on the install image
5. Verify that any references to RabbitMQ v2.7.x in any defined system
variables I changed to v2.8.0
6. Start RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - start
7. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Command Prompt
(sbin dir)
8. rabbitmq-plugins.bat enable rabbitmq_management
9. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - stop
10. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - start
11. From browser: http://localhost:55672/mgmt

Firefox can't establish a connection to the server at localhost:55672.

Jay


Hi, Jay:

Have you made sure to follow the indicated instructions that should
appear onscreen when you enable the plugin with rabbitmq-plugins.bat,
namely:

"If you have RabbitMQ running as a service then you must"
                       " reinstall by running~n  rabbitmq-service.bat
stop~n"
                       "  rabbitmq-service.bat install~n"
                       "  rabbitmq-service.bat start~n~n

Best regards,
Jerry


-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540889.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jay at custin.com  Tue Mar 20 19:03:37 2012
From: jay at custin.com (SenseiC)
Date: Tue, 20 Mar 2012 12:03:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <4CACFD89B7A64361AB7EAF127DAE5417@myyearbook.com>
References: <CDC4D88A8145494AB11398668CB5793E02F3C1975E91@EXCHANGE.int.capulaglobal.com>
	<4F674B1F.7070508@rabbitmq.com> <33540704.post@talk.nabble.com>
	<4CACFD89B7A64361AB7EAF127DAE5417@myyearbook.com>
Message-ID: <33540918.post@talk.nabble.com>


NO.  I really did mean "5672" SPECIFICALLY because I already knew no listener
existed for 55672, but both share the same string so if a listener existed
for both, it would return two entries.  For example:

C:\>netstat -an | find ":80"
  TCP    192.168.1.130:7473     72.14.204.101:80       ESTABLISHED
  TCP    192.168.1.130:7543     72.14.204.101:80       ESTABLISHED

so in like fashion:

C:\>netstat -an | find "672"
  TCP    0.0.0.0:5672           0.0.0.0:0              LISTENING
  TCP    [::]:5672              [::]:0                 LISTENING

or

C:\>netstat -an | find "72"
  TCP    0.0.0.0:5672           0.0.0.0:0              LISTENING
  TCP    192.168.1.130:7543     72.14.204.101:80       ESTABLISHED
  TCP    [::]:5672              [::]:0                 LISTENING
  UDP    192.168.1.130:53072    *:*


Jay


Gavin M. Roy-3 wrote:
> 
> 
> 
> On Tuesday, March 20, 2012 at 2:23 PM, SenseiC wrote:
> 
>> C:\netstat -an | find "5672" 
> Did you mean 'C:\netstat -an | find "55672"'
> 
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540918.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jerryk at vmware.com  Tue Mar 20 19:46:47 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 12:46:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <33540889.post@talk.nabble.com>
Message-ID: <3509985.387.1332272804109.JavaMail.jerryk@StrongMad.local>

Hi, Jay:

As per the instructions, you need to actually *reinstall* the Rabbit service
by:

 1. Stopping it, via running:  rabbitmq-server.bat stop
 2. Running the service install script:  rabbitmq-service.bat install
 3. Restarting the service with:  rabbitmq-service start

You find the three .bat files in the sbin subdirectory of your Rabbit server
installation.

Best regards,
Jerry


----- Original Message -----
From: "SenseiC" <jay at custin.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 11:58:09 AM
Subject: Re: [rabbitmq-discuss] Management plugin browser issue on 2.8.0


Yes.  I even tried/used restarting the RabbitMQ service from Windows
Services.  I included the comment about my notebook though omitted that I
even rebooted the notebook as a "last-ditch" effort.  No change.

BTW Since I hadn't DONE anything with RabbitMQ, my ACTUAL "installation"
method amounted to the following:

1. Shutdown RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - stop
2. From the Windows Control Panel uninstall RabbitMQ
3. From Windows Explorer delete the entire %AppData%\RabbitMQ directory
4. Install RabbitMQ V2.8.0 by double-clicking on the install image
5. Verify that any references to RabbitMQ v2.7.x in any defined system
variables I changed to v2.8.0
6. Start RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - start
7. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Command Prompt
(sbin dir)
8. rabbitmq-plugins.bat enable rabbitmq_management
9. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - stop
10. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - start
11. From browser: http://localhost:55672/mgmt

Firefox can't establish a connection to the server at localhost:55672.

Jay


Hi, Jay:

Have you made sure to follow the indicated instructions that should
appear onscreen when you enable the plugin with rabbitmq-plugins.bat,
namely:

"If you have RabbitMQ running as a service then you must"
                       " reinstall by running~n  rabbitmq-service.bat
stop~n"
                       "  rabbitmq-service.bat install~n"
                       "  rabbitmq-service.bat start~n~n

Best regards,
Jerry


-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540889.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Tue Mar 20 19:53:42 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 20 Mar 2012 12:53:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin browser issue on 2.8.0
In-Reply-To: <3509985.387.1332272804109.JavaMail.jerryk@StrongMad.local>
Message-ID: <8911240.402.1332273221048.JavaMail.jerryk@StrongMad.local>

Jay:  Minor typos to correct in the below...

 1. Stopping it, via running:  rabbitmq-service.bat stop
 2. Running the service install script:  rabbitmq-service.bat install
 3. Restarting the service with:  rabbitmq-service.bat start

i.e. the 'rabbitmq-service.bat' is the script you want in each step.

Sorry about that and thanks to Matthias for catching my typos. I've been
working on something related to those scripts this morning and have typed
their names enough times that my fingers are on autopilot...

Jerry

----- Original Message -----
From: "Jerry Kuch" <jerryk at vmware.com>
To: "SenseiC" <jay at custin.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 12:46:47 PM
Subject: Re: [rabbitmq-discuss] Management plugin browser issue on 2.8.0

Hi, Jay:

As per the instructions, you need to actually *reinstall* the Rabbit service
by:

 1. Stopping it, via running:  rabbitmq-server.bat stop
 2. Running the service install script:  rabbitmq-service.bat install
 3. Restarting the service with:  rabbitmq-service start

You find the three .bat files in the sbin subdirectory of your Rabbit server
installation.

Best regards,
Jerry


----- Original Message -----
From: "SenseiC" <jay at custin.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, March 20, 2012 11:58:09 AM
Subject: Re: [rabbitmq-discuss] Management plugin browser issue on 2.8.0


Yes.  I even tried/used restarting the RabbitMQ service from Windows
Services.  I included the comment about my notebook though omitted that I
even rebooted the notebook as a "last-ditch" effort.  No change.

BTW Since I hadn't DONE anything with RabbitMQ, my ACTUAL "installation"
method amounted to the following:

1. Shutdown RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - stop
2. From the Windows Control Panel uninstall RabbitMQ
3. From Windows Explorer delete the entire %AppData%\RabbitMQ directory
4. Install RabbitMQ V2.8.0 by double-clicking on the install image
5. Verify that any references to RabbitMQ v2.7.x in any defined system
variables I changed to v2.8.0
6. Start RabbitMQ: Start Menu > All Programs > RabbitMQ Server > RabbitMQ
Service - start
7. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Command Prompt
(sbin dir)
8. rabbitmq-plugins.bat enable rabbitmq_management
9. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - stop
10. Start Menu > All Programs > RabbitMQ Server > RabbitMQ Service - start
11. From browser: http://localhost:55672/mgmt

Firefox can't establish a connection to the server at localhost:55672.

Jay


Hi, Jay:

Have you made sure to follow the indicated instructions that should
appear onscreen when you enable the plugin with rabbitmq-plugins.bat,
namely:

"If you have RabbitMQ running as a service then you must"
                       " reinstall by running~n  rabbitmq-service.bat
stop~n"
                       "  rabbitmq-service.bat install~n"
                       "  rabbitmq-service.bat start~n~n

Best regards,
Jerry


-- 
View this message in context: http://old.nabble.com/Management-plugin-browser-issue-on-2.8.0-tp33532095p33540889.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 20 20:24:11 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Mar 2012 16:24:11 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <4F68A2D9.4070804@rabbitmq.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
Message-ID: <CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>

On 20 March 2012 11:31, Simon MacMullen <simon at rabbitmq.com> wrote:

> I was trying to come up with an option that didn't require me to do any
> work ;-)
>

Challenge... *accepted*: https://github.com/tonyg/udp-exchange

:-)

Cheers,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/5ac5a32f/attachment.htm>

From gmr at myyearbook.com  Tue Mar 20 20:27:40 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 20 Mar 2012 16:27:40 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
Message-ID: <9AC5955782A64814A28ECD36B78415C7@myyearbook.com>

What is the format expected?  Straight out AMQP Basic.Public frame, Header and Body frames? No negotiation or what not?

I'm excited to play with this, it may be a solution to a problem I've been engineering around for a few years.

Cheers,

Gavin 


On Tuesday, March 20, 2012 at 4:24 PM, Tony Garnock-Jones wrote:

> On 20 March 2012 11:31, Simon MacMullen <simon at rabbitmq.com (mailto:simon at rabbitmq.com)> wrote:
> > I was trying to come up with an option that didn't require me to do any work ;-)
> 
> Challenge... *accepted*: https://github.com/tonyg/udp-exchange
> 
> :-)
> 
> Cheers,
>   Tony
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com (mailto:tonygarnockjones at gmail.com)
> http://homepages.kcbbs.gen.nz/tonyg/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/7e1e8714/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 20 20:40:08 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Mar 2012 16:40:08 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
	<9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
Message-ID: <CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>

On 20 March 2012 16:27, Gavin M. Roy <gmr at myyearbook.com> wrote:

>  What is the format expected?  Straight out AMQP Basic.Public frame,
> Header and Body frames? No negotiation or what not?
>

See https://github.com/tonyg/udp-exchange#readme under headings "Messages
arriving from UDP" and "Messages to be sent to UDP".

I'm excited to play with this, it may be a solution to a problem I've been
> engineering around for a few years.
>

Cool! I'm looking forward to hearing what you think.

Cheers,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/7bcbbcae/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 20 20:41:48 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Mar 2012 16:41:48 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
	<9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
	<CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>
Message-ID: <CAM8fPiRR+iWDu-tP7LOTY16WNrW3hAG7sRaFxMv35vM4pSQY2A@mail.gmail.com>

On 20 March 2012 16:40, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> See https://github.com/tonyg/udp-exchange#readme under headings "Messages
> arriving from UDP" and "Messages to be sent to UDP".
>

Um, to be slightly more informative: it simply takes the whole of the
arriving UDP packet and sticks it in as the body of an AMQP message. It
also copies as much of the packet as will fit into the routing key, after
the string "ipv4.A.B.C.D.Port" where A.B.C.D is the source IP address.
Bindings to the exchange get to use topic-exchange syntax for matching
routing_keys.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/6558a5c9/attachment.htm>

From gmr at myyearbook.com  Tue Mar 20 21:14:44 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 20 Mar 2012 17:14:44 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiRR+iWDu-tP7LOTY16WNrW3hAG7sRaFxMv35vM4pSQY2A@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
	<9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
	<CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>
	<CAM8fPiRR+iWDu-tP7LOTY16WNrW3hAG7sRaFxMv35vM4pSQY2A@mail.gmail.com>
Message-ID: <02DAC94AE1C1408EBABF97FAB26A0419@myyearbook.com>

Hmm, while cool, I'd really need the ability to use Basic.Properties. Given the single UDP packet restriction of the message, it's probably outside the realm of what I am looking for, but very cool none the less.

Gavin 


On Tuesday, March 20, 2012 at 4:41 PM, Tony Garnock-Jones wrote:

> On 20 March 2012 16:40, Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com (mailto:tonygarnockjones%2Brabbitmq at gmail.com)> wrote:
> > See https://github.com/tonyg/udp-exchange#readme under headings "Messages arriving from UDP" and "Messages to be sent to UDP".
> 
> Um, to be slightly more informative: it simply takes the whole of the arriving UDP packet and sticks it in as the body of an AMQP message. It also copies as much of the packet as will fit into the routing key, after the string "ipv4.A.B.C.D.Port" where A.B.C.D is the source IP address. Bindings to the exchange get to use topic-exchange syntax for matching routing_keys.
> 
> Tony
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/da3f3177/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 20 21:23:46 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Mar 2012 17:23:46 -0400
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <02DAC94AE1C1408EBABF97FAB26A0419@myyearbook.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
	<9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
	<CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>
	<CAM8fPiRR+iWDu-tP7LOTY16WNrW3hAG7sRaFxMv35vM4pSQY2A@mail.gmail.com>
	<02DAC94AE1C1408EBABF97FAB26A0419@myyearbook.com>
Message-ID: <CAM8fPiRupLVENMG3d25owX0Dzhk5kRf3u3QtQ+JRx4qW_4fhLw@mail.gmail.com>

On 20 March 2012 17:14, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Hmm, while cool, I'd really need the ability to use Basic.Properties.
> Given the single UDP packet restriction of the message, it's probably
> outside the realm of what I am looking for, but very cool none the less.
>

Getting to multiple-packets-per-delivery requires development of,
basically, a big chunk of what TCP does.

If you can stomach single-packet-per-delivery, then of course one way to
get a properties/body split might be to have an x-udp exchange routing to
an application which splits the packets and reinjects the results to some
other exchange...

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/54c47d1e/attachment.htm>

From simone.busoli at gmail.com  Tue Mar 20 23:03:00 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 21 Mar 2012 00:03:00 +0100
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <4F68765C.2060706@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>
	<CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
	<4F6717BE.4070103@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E5210E745@GSVCLU03.ges.ferlan.it>
	<4F68765C.2060706@rabbitmq.com>
Message-ID: <CAOn7oW8+cOLvRTumbfD-MPcYnm-qzAMPx94rYeXau9nSjRV1WA@mail.gmail.com>

Hi Simon, I'm confused as well. Please take my previous observation with a
grain of salt as I was publishing somewhat big messages (100KB) at a rate
that perhaps couldn't be handled very well by the network. As soon as I
reduced the size to one tenth everything started going more smoothly, for
as long as something weird didn't happen to the network. Here's the test
environment I've set up to reproduce the issue: two physical machines
connected each to a network switch (all devices are 100Mb), with the two
switches connected to each other. Of course B1 and B2 live on the two
machines, respectively. A bunch of consumers on each side. I'm faking a
network latency of a few hundreds of milliseconds via software, and
publishing 20 msg/s of 10 kB each on one side of a bidirectional federation
exchange seems to work fine.
If I try disconnecting the network cable which connects the two switched
and plug it back a few seconds later implies that the federated exchanges
never catch up with the messages queued up so far, in particular the
outgoing queue on the broker acting as the downstream in this scenario (the
one whose messages would then be discarded by the plugin once back to the
publisher side) seems to not be emptied by anyone anymore.

One other thing I noticed during the failure in the production environment
is that if I deleted this automatically created queue (i.e. the queue B2 ->
B1, with B1 being the originator of the messages), affected the queue B1 ->
B2, which from a slow delivery rate stopped completely. Now, as far as my
understanding goes each direction of an exchange federated between two
brokers in both directions should be independent of the other, but I
experienced exactly this, and given that a unidirectionally federated
exchange under the same conditions described above works just fine I am
wondering whether connecting two exchanges in this way implies some weird
behavior in which each side influences the other in a sort of cascading
behavior which leads to a deadlock.

Although unlikely to be the cause of this, I'm wondering if using
prefetch-count, which I'm using, could lead to this behavior. For example
after the network bounce mentioned above the prefetch count was reached on
both sides, so no more deliveries would be done until acks arrived from the
other side. Might it happen that this could imply a deadlock in which each
side is waiting for the other to send acknowledges before sending anymore
messages?

On Tue, Mar 20, 2012 at 13:21, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 19/03/12 14:00, Busoli, Simone wrote:
>
>> Hi Simon, I think I've mostly tracked down the issue to the symmetric
>> setup of the federated exchanges between the two brokers. I noticed
>> that whenever I start publishing messages to an exchange configured
>> that way the network starts behaving in surprisingly ways. For
>> instance, I can no longer get two machines connected directly by two
>> network switches to ping each other. Stop publishing messages and
>> everything goes back to a normal state. A federated exchange which
>> goes in one direction only as well as a shovel instead behave just
>> fine.
>>
>
> I am very confused by this.
>
> Really, nothing the federation plugin does should be able to stop ICMP
> pings from working, it's just a TCP connection after all.
>
> The only thing I can think of is that somehow federation is going mad and
> flooding the link with traffic - but I'm sure you would have noticed that.
> And pings should still get through anyway.
>
> Does wireshark / tcpdump / etc show anything unusual?
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/ca48a3cf/attachment.htm>

From dathan at schoolfeed.com  Wed Mar 21 00:15:07 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Tue, 20 Mar 2012 17:15:07 -0700
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
Message-ID: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>

My exchange is set with auto_delete to false non-persistent
My queue matches the exchange-it's auto_delete is false again non-persistent

My messages have a 120 second expire time and delivery mode is set to 1
which means the message is non-persistent. (Note I tried the combo of
setting this to 2 with non-persistent queues and exchanges)

If the consumer goes away, yet the queue exists shouldn't the message queue
until the consumer comes online?

For my case the message seems to just drop. Below are some admin commands
illustrating what I perceive is my problem.

./rabbitmqadmin.py list exchanges
+-------+--------------------+---------+-------------+---------+----------+
| vhost |        name        |  type   | auto_delete | durable | internal |
+-------+--------------------+---------+-------------+---------+----------+
| /     |                    | direct  | False       | True    | False    |
*| /     | 53613981           | direct  | False       | False   | False    |
*
| /     | amq.direct         | direct  | False       | True    | False    |
| /     | amq.fanout         | fanout  | False       | True    | False    |
| /     | amq.headers        | headers | False       | True    | False    |
| /     | amq.match          | headers | False       | True    | False    |
| /     | amq.rabbitmq.log   | topic   | False       | True    | False    |
| /     | amq.rabbitmq.trace | topic   | False       | True    | False    |
| /     | amq.topic          | topic   | False       | True    | False    |
+-------+--------------------+---------+-------------+---------+----------+


Notice the bold that is the exchange in question

./rabbitmqadmin.py list bindings
+-------+----------+---------------+------------------+---------------+-----------------+
| vhost |  source  |  destination  | destination_type |  routing_key  |
properties_key  |
+-------+----------+---------------+------------------+---------------+-----------------+
| /     | 53613981 | feed_53598242 | queue            | feed          |
feed            |
| /     | 53613981 | feed_53712882 | queue            | feed          |
feed            |
| /     |          | feed_53598242 | queue            | feed_53598242 |
feed%5F53598242 |
| /     |          | feed_53712882 | queue            | feed_53712882 |
feed%5F53712882 |
+-------+----------+---------------+------------------+---------------+-----------------+

./rabbitmqadmin.py list queues
+-------+---------------+-------------+-----------+---------+------------------------+--------------------+--------+----------+----------------+-------------------------+------------+-------------+
| vhost |     name      | auto_delete | consumers | durable |
exclusive_consumer_tag |     idle_since     | memory | messages |
messages_ready | messages_unacknowledged |    node    | slave_nodes |
+-------+---------------+-------------+-----------+---------+------------------------+--------------------+--------+----------+----------------+-------------------------+------------+-------------+
| /     | feed_53598242 | False       | 0         | False   |
         | 2012-3-20 16:49:28 | 6568   | 0        | 0              | 0
                  | rabbit at dev |             |
| /     | feed_53712882 | False       | 0         | False   |
         | 2012-3-20 16:49:28 | 6568   | 0        | 0              | 0
                  | rabbit at dev |             |
+-------+---------------+-------------+-----------+---------+------------------------+--------------------+--------+----------+----------------+-------------------------+------------+-------------+


Publishing the message succeeds yet the message does not queue it gets
discarded.

If the consumer is connected then the message flows as normal and I can see
rabbit work its magic.

How can I force rabbit to queue when the consumer is offline and the
queue/exchange exists on the server?

Note:

I made the exchange durable, the queue durable, and delivery_mode => 2
still I can't get rabbit to queue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120320/a03cfb47/attachment.htm>

From carl.hoerberg at gmail.com  Wed Mar 21 00:20:19 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Wed, 21 Mar 2012 01:20:19 +0100
Subject: [rabbitmq-discuss] 2.8.0 bug in the mgmt interface
Message-ID: <CAFPidkOqnn1-+CuyPQ_mqy_a6TVnhk7Bbj0HfxLTTM3RNxNBOQ@mail.gmail.com>

when accessing the management interface, if a user only got the
"management" tag, it gets 401 for "/api/nodes" which the javascript is
requesting..

From carl.hoerberg at gmail.com  Wed Mar 21 00:54:33 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Wed, 21 Mar 2012 01:54:33 +0100
Subject: [rabbitmq-discuss] 2.8.0 bug in the mgmt interface
In-Reply-To: <CAFPidkOqnn1-+CuyPQ_mqy_a6TVnhk7Bbj0HfxLTTM3RNxNBOQ@mail.gmail.com>
References: <CAFPidkOqnn1-+CuyPQ_mqy_a6TVnhk7Bbj0HfxLTTM3RNxNBOQ@mail.gmail.com>
Message-ID: <CAFPidkNLD3o6+uzAfBqhJsF2-_TFqXA2zf+a1ii8cv=jEx_ARQ@mail.gmail.com>

submitted a fixed for it here:
https://github.com/rabbitmq/rabbitmq-management/pull/2

On Wed, Mar 21, 2012 at 01:20, Carl H?rberg <carl.hoerberg at gmail.com> wrote:
> when accessing the management interface, if a user only got the
> "management" tag, it gets 401 for "/api/nodes" which the javascript is
> requesting..

From lionel.cons at cern.ch  Wed Mar 21 06:40:40 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 21 Mar 2012 07:40:40 +0100
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiRupLVENMG3d25owX0Dzhk5kRf3u3QtQ+JRx4qW_4fhLw@mail.gmail.com>
	(Tony Garnock-Jones's message of "Tue, 20 Mar 2012 17:23:46 -0400")
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
	<9AC5955782A64814A28ECD36B78415C7@myyearbook.com>
	<CAM8fPiSX=ZM28Jy7tz82fY7d8Xjw1wj6S75jW97+J+k4135dYA@mail.gmail.com>
	<CAM8fPiRR+iWDu-tP7LOTY16WNrW3hAG7sRaFxMv35vM4pSQY2A@mail.gmail.com>
	<02DAC94AE1C1408EBABF97FAB26A0419@myyearbook.com>
	<CAM8fPiRupLVENMG3d25owX0Dzhk5kRf3u3QtQ+JRx4qW_4fhLw@mail.gmail.com>
Message-ID: <bw7pqc6mp7b.fsf@mail.cern.ch>

Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com> writes:
> If you can stomach single-packet-per-delivery, then of course one way to
> get a properties/body split might be to have an x-udp exchange routing to
> an application which splits the packets and reinjects the results to some
> other exchange...

Another possibility would be to accept a STOMP SEND frame on this UDP
exchange. This way, you can control what ends up in the message header
or body.

Cheers,

Lionel

From lionel.cons at cern.ch  Wed Mar 21 06:52:17 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 21 Mar 2012 07:52:17 +0100
Subject: [rabbitmq-discuss] Experimenting with release candidates:
	RabbitMQ 2.7.9
In-Reply-To: <4F622015.3@rabbitmq.com>
References: <4F58F27B.5030209@rabbitmq.com> <bw7mx7j1ep9.fsf@mail.cern.ch>
	<4F60A3C8.1080504@rabbitmq.com>
	<20320.42646.772214.890151@mail.cern.ch>
	<4F60AA5D.1030907@rabbitmq.com>
	<20320.44651.11407.44766@mail.cern.ch>
	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>
	<4F622015.3@rabbitmq.com>
Message-ID: <20329.31393.763369.278293@mail.cern.ch>

Simon MacMullen writes:
 > > The DN/CN issues were discussed recently, but I'll leave it to Simon to
 > > explain our position on that.
 > 
 > It defaults to doing the best impersonation it can of a DN produced by 
 > the OpenSSL's -nameopt RFC2253 [...]

Simon,

I confirm that this works fine in 2.8.0. However, the user that is required
(which name is the DN) also allows to login without SSL.

One solution would be to generate long random passwords for these dummy
users indicating which DNs are allowed but this looks like bricolage. What
about using the (currently underused) tags for this purpose? We could
imagine an "ssl" tag meaning "this user can only login via SSL"...

Cheers,

Lionel

From dirk.swart at gmail.com  Tue Mar 20 16:25:13 2012
From: dirk.swart at gmail.com (Dirk)
Date: Tue, 20 Mar 2012 09:25:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <13510180.145.1332258542124.JavaMail.jerryk@StrongMad.local>
References: <13510180.145.1332258542124.JavaMail.jerryk@StrongMad.local>
Message-ID: <bef9863c-c494-4949-855c-bd1fff647136@cj6g2000vbb.googlegroups.com>

Hi Jerry,

I have the hardware all sorted out - I'm using a Microchip ENC28J60,
which is somewhat less capable than Wiznet, but not terribly so.
(Working with SMD is fine, although the ENC comes in PDIP-28)

What I am looking for is help with the Rabbit / AMPQ side of things:
- What does a "minimum acceptable message" look like in XML?
- If someone has a template or two of one, that would be great - just
"hello world".

Thanks

On Mar 20, 11:49?am, Jerry Kuch <jer... at vmware.com> wrote:
> This answer is likely to be less interesting/applicable to many
> people than Tony and Simon's suggestions which can at least be
> done entirely in software, but...
>
> You could embrace the option of offloading more of the work into
> another piece of hardware the way the Ethernet shields for Arduino
> boards (also based on the ATmega family of microcontrollers) work.
>
> For your network connectivity you could use an (almost, modulo
> probably power supply) all in one part like the Wiznet W5100,
> which gives you a TCP and UDP supporting IP stack baked into an
> Ethernet chip. ?Your could would then talk to this thing via SPI,
> something that at least will fit on the ATmega side...
>
> If you're using Arduino, you can buy most of this stuff pre-made.
> If not, it's probably a few afternoons of breadboarding and debugging,
> although IIRC the Wiznet only comes in a tiny surface mount package
> that might be annoying to work with, depending on how you're equipped.
>
> Best regards,
> Jerry
>
>
>
>
>
>
>
> ----- Original Message -----
> From: "Tony Garnock-Jones" <tonygarnockjones+rabbi... at gmail.com>
> To: "Simon MacMullen" <si... at rabbitmq.com>
>
> Cc: rabbitmq-disc... at lists.rabbitmq.com, "Dirk" <dirk.sw... at gmail.com>
> Sent: Tuesday, March 20, 2012 8:30:08 AM
> Subject: Re: [rabbitmq-discuss] Simplest possible embedded message producer
>
> The other option would be to use UDP and build a trivial UDP-accepting plugin for RabbitMQ, thus moving almost all of the complexity and memory-requirements onto the server. (Actually that'd be a nice feature to have in general.)
>
> On 20 March 2012 11:13, Simon MacMullen < si... at rabbitmq.com > wrote:
>
> And if rabbitmq-c is still too big, and all you need to do is publish messages from the tiniest client possible, you might want to look at STOMP - you could probably write a minimal publish-only client quite simply, and it would be pretty small.
>
> Cheers, Simon
>
> On 20/03/12 15:06, Alan Antonuk wrote:
>
> I'm not sure AMQP/rabbitmq-c client would be able to run on that
> constrained of a system (someone else on this list might correct me though).
>
> In general you're going to need a TCP/IP stack so you can connect to the
> broker, then enough memory to hold a couple frames (the minimum frame
> size is 4096 bytes). You could probably do it with smaller buffers but
> it's not something done with most client libraries.
>
> If that all will fit in your constrained system, I would probably pick
> apart the the rabbitmq-c library and pare it down to something that does
> the minimum you need. Then again I'm not experienced with development of
> embedded devices, so I'm not sure how people typically accomplish these
> things.
>
> HTH
> -Alan
>
> On Mon, Mar 19, 2012 at 11:41 AM, Dirk < dirk.sw... at gmail.com
>
> <mailto: dirk.sw... at gmail.com >> wrote:
>
> - Does anyone have code for the simplest possible message producer?
>
> I would like to produce messages from a _very_ memory constrained
> embedded system*. Can anyone advise me on what the absolute minimum I
> have to do to produce and send a message is?
>
> Also, if anyone can point me towards what a simple "hello world"
> message template looks like, it would be appreciated. More details:
> I'm thinking of the sort of message that the Tutorials cover (eg:http://www.rabbitmq.com/tutorials/tutorial-one-python. html )
>
> Thanks in advance - I'm a Rabbit noob, apologies if this post is not
> using the correct terms.
>
> * ATMega 328p, same chip the Arduino uses.
> ______________________________ _________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists. rabbitmq.com
> <mailto: rabbitmq-discuss@ lists.rabbitmq.com >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/ rabbitmq-discuss
>
> ______________________________ _________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists. rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/ rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________ _________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists. rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/ rabbitmq-discuss
>
> --
> Tony Garnock-Jones
> tonygarnockjo... at gmail.comhttp://homepages.kcbbs.gen.nz/tonyg/
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dirk.swart at gmail.com  Tue Mar 20 20:31:06 2012
From: dirk.swart at gmail.com (Dirk)
Date: Tue, 20 Mar 2012 13:31:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Simplest possible embedded message producer
In-Reply-To: <CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
References: <94ff4c50-1f90-4a86-b2d9-32f47c2ada7d@er9g2000vbb.googlegroups.com>
	<CAAt2po+2oKTMjL_Y8cY=CJV4j8xhrA6H4OinC1s9isppYSGhdg@mail.gmail.com>
	<4F689E82.2050303@rabbitmq.com>
	<CAM8fPiRCC4-r9vY72Np2vvPyHsttbL8T5DzsBLWK6Y_DOT1hbw@mail.gmail.com>
	<4F68A2D9.4070804@rabbitmq.com>
	<CAM8fPiR39zDe1dPU3pJYaz4ca=QeDzCA80zsdp7Nzvuff-YJbQ@mail.gmail.com>
Message-ID: <8fe5b6e3-5164-426d-aed3-258a89ba1eb2@i2g2000vbv.googlegroups.com>

Woot!!! This is great ... I'm taking a look at it now.

Thanks.
Dirk


From lionel.cons at cern.ch  Wed Mar 21 11:01:32 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 21 Mar 2012 12:01:32 +0100
Subject: [rabbitmq-discuss] Group/tag based access control
Message-ID: <20120321114639.213b.abe10f7e5afbbb3a79ce619739541149@cern.ch>

AFAIK, RabbitMQ's access control is user based. This can be cumbersome to
configure if you allow many different users as this requires many similar
permissions quintuples. It would be really nice to allow group based access
control, i.e. permissions applying to multiple users.

It seems that RabbitMQ has most of it already since it knows about user
tags. So what about extending the use of tags so that they can be used for
access control. I think that arbitrary tag names are already allowed so the
only missing thing is allowing permissions with tags.  Something like:

$ rabbitmqctl set_permissions -p /myvhost tag:foo "^bar-.*" ".*" ".*"

that would match any user with the tag "foo".

Cheers,

Lionel

From simon at rabbitmq.com  Wed Mar 21 11:08:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 11:08:27 +0000
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <20329.31393.763369.278293@mail.cern.ch>
References: <4F58F27B.5030209@rabbitmq.com>	<bw7mx7j1ep9.fsf@mail.cern.ch>	<4F60A3C8.1080504@rabbitmq.com>	<20320.42646.772214.890151@mail.cern.ch>	<4F60AA5D.1030907@rabbitmq.com>	<20320.44651.11407.44766@mail.cern.ch>	<BFE1691A-7F3F-4E24-AD91-F71C43FF7C8A@rabbitmq.com>	<4F622015.3@rabbitmq.com>
	<20329.31393.763369.278293@mail.cern.ch>
Message-ID: <4F69B6AB.6010005@rabbitmq.com>

On 21/03/12 06:52, Lionel Cons wrote:
> I confirm that this works fine in 2.8.0. However, the user that is required
> (which name is the DN) also allows to login without SSL.

You can disable password-based login for a user altogether, for exactly 
this reason. Either select "No password" in mgmt, or use "rabbitmqctl 
clear_password".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 21 11:13:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 21 Mar 2012 11:13:30 +0000
Subject: [rabbitmq-discuss] Rabbit 2.8.0 .NET Client available on Nuget?
In-Reply-To: <9C1945D202940B47A9F587776BEE7F401367F9B515@exchg02>
References: <9C1945D202940B47A9F587776BEE7F401367F9B515@exchg02>
Message-ID: <4F69B7DA.3040708@rabbitmq.com>

Hi Dave,

On 20/03/12 17:55, David Priddle wrote:
> Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET
> client libraries available via Nuget? (2.7.1 is the latest version
> available there.)

Thanks for your message. We will be in contact with all package
maintainers shortly.


-Emile


From matthias at rabbitmq.com  Wed Mar 21 11:12:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Mar 2012 11:12:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Erlang --enable-native-libs
In-Reply-To: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
References: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
Message-ID: <4F69B7B6.7010309@rabbitmq.com>

Elias,

On -10/01/37 20:59, Elias Levy wrote:
> FYI for any others that may be thinking of trying this, RabbitMQ will
> not start up if you compile Erlang R15B with the --enable-native-libs
> option.  It exits with the error:
>
> The code server called the unloaded module `alarm_handler'

I am unable to reproduce this. I built R15B like this:

$ cd ~/src/otp_src_R15B
$ make clean
$ ./configure --enable-native-libs
$ make
(there is a bunch of stuff that gets compiled with +native, so the 
option is definitely taking effect)
$ sudo make install

I then did a clean build of rabbit 2.7.1 and ran the test suite. All 
works fine. I also tried the "binary" generic unix package we released 
for 2.7.1 and that works fine too.


Please post the steps to reproduce the error.


Regards,

Matthias.

From steve at rabbitmq.com  Wed Mar 21 11:13:10 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 21 Mar 2012 11:13:10 +0000
Subject: [rabbitmq-discuss] Sample example with Enqueue
In-Reply-To: <33525507.post@talk.nabble.com>
References: <33525430.post@talk.nabble.com>
	<8A6154AE-88D4-4084-B320-A0A92E1E1C58@gmail.com>
	<33525476.post@talk.nabble.com>
	<76B80A00-59FD-4AF6-8D85-1AF7DE8DFAC4@gmail.com>
	<33525507.post@talk.nabble.com>
Message-ID: <A56C255D-D86B-44AE-9F6B-A8C653AA6518@rabbitmq.com>

Bamboula,

It really is not clear what you (or your boss) need.

Queues (in AMQP) are places to store messages published over the AMQP
protocol. A queue is where they are stored prior to delivery to a
consumer client.

In AMQP no client Enqueues to a queue, instead she will Publish a
message to an Exchange, and depending upon how the exchange is set up,
this may result in the message being placed on a queue.

AMQP clients register interest in certain queues (becoming consumers),
and the AMQP protocol will deliver those messages that arrive there to
the consumer, either upon client demand, or as they (and the consumer)
are available. Asking for messages one at a time (on demand) is not very
efficient, and requires polling the queue.

To receive messages as they are available, you need to supply an
implementation of the Consumer interface in the Java client.

Because the Java client needed an efficient way to receive messages, but
still wanted to get messages on-demand, RabbitMQ implemented a
QueueingConsumer and this used a Java Queue object which stored messages
from AMQP as they arrived (the efficient way) for the client application
to get them on-demand. This is the queue that client applications can
'dequeue' from. The client application will not 'enqueue' to this queue,
because that happens in the Java client's implementation of the
QueueingConsumer. The examples that use a QueueingConsumer will
'dequeue' messages from the consumer's queue.

A similar implementation is given in the dot-net-client, and for exactly
the same reasons.  There is where you might see implementations of
Enqueue() and Dequeue() operations.

So you can see we are confused by your request for an example using
'Enqueue'. You should not need to Enqueue to anything. If you want to
send a message to an AMQP queue, then you need to publish it (to an
exchange) and it will end up on an AMQP queue (enqueued onto it) if the
exchange rules permit this. We do not recommend you explicitly enqueue
messages onto the QueueingConsumer internal Queue, as you will break the
logic of the queueing consumer and it cannot be guaranteed to function
correctly after this.

I hope this helps you.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 18 Mar 2012, at 08:45, Bamboula wrote:

> 
> My boss wants me to show him an example using ....Enqueue(object o).
> 
> I've read these tutorials, it didn't help me
> 
> Alvaro Videla-2 wrote:
>> 
>> Well. Basic publish puts a message on the queue? so it will "enqueue" it.
>> 
>> Have you read the rest of the tutorials? Specifically take a look at this
>> one: http://www.rabbitmq.com/tutorials/amqp-concepts.html
>> 
>> -Alvaro
>> 
>> On Mar 18, 2012, at 9:27 AM, Bamboula wrote:
>> 
>>> 
>>> It's not really clear. How can I do Enqueue using basicPublish?
>>> 
>>> thanks
>>> 
>>> Alvaro Videla-2 wrote:
>>>> 
>>>> See here:
>>>> 
>>>> http://www.rabbitmq.com/tutorials/tutorial-one-java.html
>>>> 
>>>> It's called basicPublish
>>>> 
>>>> -Alvaro
>>>> 
>>>> On Mar 18, 2012, at 9:11 AM, Bamboula wrote:
>>>> 
>>>>> 
>>>>> Hy,
>>>>> 
>>>>> Is there any easy example using the Enqueue() method (with Java or C#)?
>>>>> 
>>>>> I only found example with Dequeue
>>>>> 
>>>>> It would really help me
>>>>> 
>>>>> Thanks
>>>>> 
>>>>> -- 
>>>>> View this message in context:
>>>>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525430.html
>>>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>>> 
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> Sent form my Nokia 1100
>>>> 
>>>> 
>>>> 
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>> 
>>> -- 
>>> View this message in context:
>>> http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525476.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/Sample-example-with-Enqueue-tp33525430p33525507.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Wed Mar 21 11:23:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 11:23:04 +0000
Subject: [rabbitmq-discuss] 2.8.0 bug in the mgmt interface
In-Reply-To: <CAFPidkNLD3o6+uzAfBqhJsF2-_TFqXA2zf+a1ii8cv=jEx_ARQ@mail.gmail.com>
References: <CAFPidkOqnn1-+CuyPQ_mqy_a6TVnhk7Bbj0HfxLTTM3RNxNBOQ@mail.gmail.com>
	<CAFPidkNLD3o6+uzAfBqhJsF2-_TFqXA2zf+a1ii8cv=jEx_ARQ@mail.gmail.com>
Message-ID: <4F69BA18.9090001@rabbitmq.com>

On 21/03/12 00:54, Carl H?rberg wrote:
> submitted a fixed for it here:
> https://github.com/rabbitmq/rabbitmq-management/pull/2

Thanks. I can't merge this as is since we need to populate the list of 
exchange types here. I'll fix this myself today though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 21 11:29:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 21 Mar 2012 11:29:37 +0000
Subject: [rabbitmq-discuss] dealing with poison-pill messages
In-Reply-To: <CALbPevmQ47tcymTCo02gWyuB5ebXvRCtuFkgVXghBJ-n1ZQQrg@mail.gmail.com>
References: <CALbPevmQ47tcymTCo02gWyuB5ebXvRCtuFkgVXghBJ-n1ZQQrg@mail.gmail.com>
Message-ID: <4F69BBA1.2000703@rabbitmq.com>


Hi John,

On 19/03/12 11:07, john doe wrote:
> What do you think?

You describe a reasonable emulation of toxic message handling. You
should be aware that republishing messages will destroy order, so this
solution is only applicable in scenarios where message ordering is
unimportant.

As an enhancement you could also consider marking the message with a
number instead of a flag to count how many times processing as been
attempted. You could also consider decorating the message with the
consumer identity to distinguish between processing attempts by
different consumers.


-Emile


From videlalvaro at gmail.com  Wed Mar 21 11:34:13 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 21 Mar 2012 12:34:13 +0100
Subject: [rabbitmq-discuss] problems at hg.rabbitmq.com
Message-ID: <7B7DD4A9-41D0-49E6-855A-13C2A4D0F5AF@gmail.com>

Hi,

I think this: http://hg.rabbitmq.com/ is timing out.

Cheers,

Alvaro

From simon at rabbitmq.com  Wed Mar 21 11:45:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 11:45:00 +0000
Subject: [rabbitmq-discuss] problems at hg.rabbitmq.com
In-Reply-To: <7B7DD4A9-41D0-49E6-855A-13C2A4D0F5AF@gmail.com>
References: <7B7DD4A9-41D0-49E6-855A-13C2A4D0F5AF@gmail.com>
Message-ID: <4F69BF3C.7020105@rabbitmq.com>

On 21/03/12 11:34, Alvaro Videla wrote:
> I think this: http://hg.rabbitmq.com/ is timing out.

Yes, there are some network issues at our data centre. Oddly though, I 
can see it from my home server. I'll poke our network guys...

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 21 11:51:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 11:51:46 +0000
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
In-Reply-To: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>
References: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>
Message-ID: <4F69C0D2.2090809@rabbitmq.com>

On 21/03/12 00:15, Dathan Pattishall wrote:
> My messages have a 120 second expire time

Just to be clear, did you set x-message-ttl to 120 or 120000? The time 
is in milliseconds, and what you report sounds a lot like the messages 
expiring near-instantly.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Wed Mar 21 12:10:36 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 21 Mar 2012 08:10:36 -0400
Subject: [rabbitmq-discuss] udp-exchange and STOMP SEND (was Re: Simplest
 possible embedded message producer)
Message-ID: <CAM8fPiQAdtar9uTCR6LUaO360WSjZNvyqaQY+9huGWgXJG_D4A@mail.gmail.com>

On 21 March 2012 02:40, Lionel Cons <lionel.cons at cern.ch> wrote:

> Another possibility would be to accept a STOMP SEND frame on this UDP
> exchange. This way, you can control what ends up in the message header
> or body.
>

Good idea! Anyone fancy giving it a go? I'd be happy to accept patches to
udp-exchange along these lines.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/0a1f65eb/attachment.htm>

From lionel.cons at cern.ch  Wed Mar 21 14:37:51 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 21 Mar 2012 15:37:51 +0100
Subject: [rabbitmq-discuss] SSL Authentication & Management
Message-ID: <20120321153403.a080.abe10f7e5afbbb3a79ce619739541149@cern.ch>

Following the recipe at http://www.rabbitmq.com/mochiweb.html, I've
been able to enable SSL to access the management interface. However,
RabbitMQ still asks for a name and password even after getting my
(valid) certificate.

Is there a way to have SSL authentication for the management interface
in the new RabbitMQ 2.8.0? Ideally, a valid certificate should be
enough on the management interface, like for AMQP and STOMP...

Cheers,

Lionel

From simon at rabbitmq.com  Wed Mar 21 14:39:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 14:39:14 +0000
Subject: [rabbitmq-discuss] SSL Authentication & Management
In-Reply-To: <20120321153403.a080.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120321153403.a080.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4F69E812.1080103@rabbitmq.com>

On 21/03/12 14:37, Lionel Cons wrote:
> Is there a way to have SSL authentication for the management interface
> in the new RabbitMQ 2.8.0?

Sorry, not yet...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 21 15:37:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 15:37:02 +0000
Subject: [rabbitmq-discuss] Federated exchange slowdown
In-Reply-To: <CAOn7oW8+cOLvRTumbfD-MPcYnm-qzAMPx94rYeXau9nSjRV1WA@mail.gmail.com>
References: <88E590DC4586974D825FC82AE798294E5210E147@GSVCLU03.ges.ferlan.it>
	<CAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh+vDZffQYdEy=wK4Dg@mail.gmail.com>
	<4F6717BE.4070103@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E5210E6A5@GSVCLU03.ges.ferlan.it>
	<88E590DC4586974D825FC82AE798294E5210E745@GSVCLU03.ges.ferlan.it>
	<4F68765C.2060706@rabbitmq.com>
	<CAOn7oW8+cOLvRTumbfD-MPcYnm-qzAMPx94rYeXau9nSjRV1WA@mail.gmail.com>
Message-ID: <4F69F59E.3060208@rabbitmq.com>

Hi Simone. I'm afraid I still can't replicate this. I was using iptables 
to interrupt connectivity between two brokers on the same machine, but 
apart from that I think I was doing the same thing.

One thing I noticed was that interrupting a connection that did not have 
heartbeating turned on meant the connection did not recover well unless 
manually killed. Do heartbeats help for you?

Also, what happens if you kill the federation connection when your test 
is stuck?

Cheers, Simon

On 20/03/12 23:03, Simone Busoli wrote:
> Hi Simon, I'm confused as well. Please take my previous observation with
> a grain of salt as I was publishing somewhat big messages (100KB) at a
> rate that perhaps couldn't be handled very well by the network. As soon
> as I reduced the size to one tenth everything started going more
> smoothly, for as long as something weird didn't happen to the network.
> Here's the test environment I've set up to reproduce the issue: two
> physical machines connected each to a network switch (all devices are
> 100Mb), with the two switches connected to each other. Of course B1 and
> B2 live on the two machines, respectively. A bunch of consumers on each
> side. I'm faking a network latency of a few hundreds of milliseconds via
> software, and publishing 20 msg/s of 10 kB each on one side of a
> bidirectional federation exchange seems to work fine.
> If I try disconnecting the network cable which connects the two switched
> and plug it back a few seconds later implies that the federated
> exchanges never catch up with the messages queued up so far, in
> particular the outgoing queue on the broker acting as the downstream in
> this scenario (the one whose messages would then be discarded by the
> plugin once back to the publisher side) seems to not be emptied by
> anyone anymore.
>
> One other thing I noticed during the failure in the production
> environment is that if I deleted this automatically created queue (i.e.
> the queue B2 -> B1, with B1 being the originator of the messages),
> affected the queue B1 -> B2, which from a slow delivery rate stopped
> completely. Now, as far as my understanding goes each direction of an
> exchange federated between two brokers in both directions should be
> independent of the other, but I experienced exactly this, and given that
> a unidirectionally federated exchange under the same conditions
> described above works just fine I am wondering whether connecting two
> exchanges in this way implies some weird behavior in which each side
> influences the other in a sort of cascading behavior which leads to a
> deadlock.
>
> Although unlikely to be the cause of this, I'm wondering if using
> prefetch-count, which I'm using, could lead to this behavior. For
> example after the network bounce mentioned above the prefetch count was
> reached on both sides, so no more deliveries would be done until acks
> arrived from the other side. Might it happen that this could imply a
> deadlock in which each side is waiting for the other to send
> acknowledges before sending anymore messages?
>
> On Tue, Mar 20, 2012 at 13:21, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 19/03/12 14:00, Busoli, Simone wrote:
>
>         Hi Simon, I think I've mostly tracked down the issue to the
>         symmetric
>         setup of the federated exchanges between the two brokers. I noticed
>         that whenever I start publishing messages to an exchange configured
>         that way the network starts behaving in surprisingly ways. For
>         instance, I can no longer get two machines connected directly by two
>         network switches to ping each other. Stop publishing messages and
>         everything goes back to a normal state. A federated exchange which
>         goes in one direction only as well as a shovel instead behave just
>         fine.
>
>
>     I am very confused by this.
>
>     Really, nothing the federation plugin does should be able to stop
>     ICMP pings from working, it's just a TCP connection after all.
>
>     The only thing I can think of is that somehow federation is going
>     mad and flooding the link with traffic - but I'm sure you would have
>     noticed that. And pings should still get through anyway.
>
>     Does wireshark / tcpdump / etc show anything unusual?
>
>     Cheers, Simon
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From dathan at schoolfeed.com  Wed Mar 21 15:43:14 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Wed, 21 Mar 2012 08:43:14 -0700
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
In-Reply-To: <4F69C0D2.2090809@rabbitmq.com>
References: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>
	<4F69C0D2.2090809@rabbitmq.com>
Message-ID: <CA+22WDRB2uHwBUXeEc0EigW6-wZgZ6RJ2uvCMF-wu8tsc1atSg@mail.gmail.com>

120000 additionally I turned that off as well.

On Wed, Mar 21, 2012 at 4:51 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/03/12 00:15, Dathan Pattishall wrote:
>
>> My messages have a 120 second expire time
>>
>
> Just to be clear, did you set x-message-ttl to 120 or 120000? The time is
> in milliseconds, and what you report sounds a lot like the messages
> expiring near-instantly.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/73505c9e/attachment.htm>

From jack.palf at gmail.com  Wed Mar 21 16:05:26 2012
From: jack.palf at gmail.com (Jack Palfrey)
Date: Wed, 21 Mar 2012 16:05:26 +0000
Subject: [rabbitmq-discuss] AS2 usage
Message-ID: <CAPpWrV=3=LVcTxxO85jtAx4fYknqHJhMCywJzDbZY4f9Toc5ZQ@mail.gmail.com>

Hey all,

I've got a legacy project I need to update to modern infrastructure, and
one of my requirements is to support AS2 projects on the RabbitMQ message
passing infrastructure. I can't find any living libraries (I kinda doubt
Rabbit is as old as AS2), but does anyone have experience of connecting to
a RabbitMQ broker using AS2?

Even anecdotal information would be useful!

Jack
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/211799fb/attachment.htm>

From aeells at qmetric.co.uk  Wed Mar 21 16:07:10 2012
From: aeells at qmetric.co.uk (Andrew Eells)
Date: Wed, 21 Mar 2012 16:07:10 +0000
Subject: [rabbitmq-discuss] /etc/init.d/rabbitmq-server startup script
Message-ID: <CANMsNJK56kb2tb6qSS2qYZ3p0UpguWabMWSmFG6x_3519hGjKQ@mail.gmail.com>

Hello,

I've recently upgraded from RabbitMQ v2.5.1 to v2.8.0 and having installed
via the Generic Linux tarball (as opposed to RPM) I'm wondering if there is
a server bootstrap startup script available, so as to run this as a
service? The script associated with the previous version no longer works.

It would be reasonably straightforward to write a simple one which just
launches the server detached, but I suspect I would lose some of the
functionality available, particularly around logging and locking that is
available in the previous script eg.

> echo "Usage: $0
{start|stop|status|rotate-logs|restart|condrestart|try-restart|reload|force-reload}"
>&2

Would appreciate any pointers as to best-practice with v2.8.0.

Thanks and regards,

Drew

----------------------------------------------------------------------------------

The information in this email is confidential and may be legally privileged.  It is intended solely for the addressee.  Access to this email by anyone else is unauthorised.  If you are not the intended recipient, any disclosure, copying, distribution or any action taken or omitted to be taken in reliance on it, is prohibited and may be unlawful.
 
Policy Expert is a trading name of QMetric Group Limited who is authorised and regulated by the Financial Services Authority.  The registered company address of QMetric Group Limited is: 32-38 Dukes Place, London, EC3A 7LP and its company registration number is 07151701.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/057ee51c/attachment.htm>

From puru.belagali at gazprom-mt.com  Wed Mar 21 16:12:23 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Wed, 21 Mar 2012 16:12:23 +0000
Subject: [rabbitmq-discuss] help
Message-ID: <1C007B2F327A00438987610C4ADC7116248879B3@EXCMBX02PR.Gazpromuk.intra>

Hi all,

I would like to know if Rabbit provides a heart beat mechanism for subscriber services. This is required to keep the connection active to overcome the firewall idle timers.

Thanks,
Puru

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/d914750d/attachment.htm>

From joeyfitz at gmail.com  Wed Mar 21 16:12:44 2012
From: joeyfitz at gmail.com (joefitzgerald)
Date: Wed, 21 Mar 2012 09:12:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit 2.8.0 .NET Client available on Nuget?
In-Reply-To: <4F69B7DA.3040708@rabbitmq.com>
References: <9C1945D202940B47A9F587776BEE7F401367F9B515@exchg02>
	<4F69B7DA.3040708@rabbitmq.com>
Message-ID: <29209107.249.1332346364384.JavaMail.geo-discussion-forums@pbctp7>

Hi Dave,

I have updated the RabbitMQ.Client and RabbitMQ.ServiceModel NuGet Packages 
to 2.8.0.

Also, I've created a github repo containing the source for these packages. 
You can view this 
here: https://github.com/joefitzgerald/rabbitmq-dotnet-client

Best Regards,
Joe Fitzgerald

On Wednesday, March 21, 2012 5:13:30 AM UTC-6, Emile Joubert wrote:
>
> Hi Dave,
>
> On 20/03/12 17:55, David Priddle wrote:
> > Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET
> > client libraries available via Nuget? (2.7.1 is the latest version
> > available there.)
>
> Thanks for your message. We will be in contact with all package
> maintainers shortly.
>
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
On Wednesday, March 21, 2012 5:13:30 AM UTC-6, Emile Joubert wrote:
>
> Hi Dave,
>
> On 20/03/12 17:55, David Priddle wrote:
> > Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET
> > client libraries available via Nuget? (2.7.1 is the latest version
> > available there.)
>
> Thanks for your message. We will be in contact with all package
> maintainers shortly.
>
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/7d2a3da3/attachment.htm>

From simon at rabbitmq.com  Wed Mar 21 16:28:30 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 16:28:30 +0000
Subject: [rabbitmq-discuss] help
In-Reply-To: <1C007B2F327A00438987610C4ADC7116248879B3@EXCMBX02PR.Gazpromuk.intra>
References: <1C007B2F327A00438987610C4ADC7116248879B3@EXCMBX02PR.Gazpromuk.intra>
Message-ID: <4F6A01AE.2020602@rabbitmq.com>

On 21/03/12 16:12, Puru Belagali wrote:
> I would like to know if Rabbit provides a heart beat mechanism for
> subscriber services. This is required to keep the connection active to
> overcome the firewall idle timers.

Yes. You specify it when creating a connection. How exactly you do that 
depends on the client library you're using.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From paulocheque2 at gmail.com  Wed Mar 21 16:26:49 2012
From: paulocheque2 at gmail.com (Paulo Cheque)
Date: Wed, 21 Mar 2012 09:26:49 -0700 (PDT)
Subject: [rabbitmq-discuss] 2 unack messages for 1 process
Message-ID: <67b0e4d2-c249-437d-bb39-09c6657ced74@x5g2000pbl.googlegroups.com>

Hi, I am using Celery (http://celeryproject.org/) to produce and
consume RabbitMQ messages. Only one process of Celery consume
messages, so why can I see in Rabbit 2 unack messages at the same
time?

I understand Rabbit had 1 unack message for each consumer process.

Thanks in advance
Paulo

From paulocheque2 at gmail.com  Wed Mar 21 16:28:18 2012
From: paulocheque2 at gmail.com (Paulo Cheque)
Date: Wed, 21 Mar 2012 09:28:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Is it possible to remove unacked messages?
Message-ID: <e3502b6e-7cc7-4b83-ae52-6f3f6e953b1f@s9g2000pba.googlegroups.com>

Is it possible to remove unacked messages?

The unique way I can remove unack messages is stopping my consumer, so
the message return to que "ready queue". So I can discard it, so I
restart my consumer again.

Thanks in advance
Paulo

From eric at holtmans.com  Wed Mar 21 16:38:30 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Wed, 21 Mar 2012 11:38:30 -0500
Subject: [rabbitmq-discuss] Odd management plugin behavior
Message-ID: <4F6A0406.8070606@holtmans.com>

Rabbit 2.7.1 / Erlang R15B / Windows Server 2008R2

I have the plugin running.   I go to localhost:55672, and
I can log in.

If I hit Users then try and add a user, when I click on
[Admin] under tags, the page just re-directs to

javascript:$('#tags').val('administrator');

This happens in both Firefox and IE.


Any clues?

From simon at rabbitmq.com  Wed Mar 21 16:41:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 16:41:17 +0000
Subject: [rabbitmq-discuss] Odd management plugin behavior
In-Reply-To: <4F6A0406.8070606@holtmans.com>
References: <4F6A0406.8070606@holtmans.com>
Message-ID: <4F6A04AD.5050506@rabbitmq.com>

On 21/03/12 16:38, Eric J. Holtman wrote:
> Any clues?

Yes, it's a bug in 2.7.1. Worked by coincidence in Chrome and older 
Firefox. Fixed in 2.8.0.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vbernard42 at gmail.com  Wed Mar 21 16:45:18 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Wed, 21 Mar 2012 09:45:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Autodelete queues not being deleted
In-Reply-To: <CALQa0h1uB-qxxOZKc-fK10f9Ejn_etEPiGZoWPivc-ESbAXdTw@mail.gmail.com>
References: <18062715.5930.1332253422020.JavaMail.geo-discussion-forums@vbiz13>
	<4F6894ED.9070604@rabbitmq.com>
	<CALQa0h1uB-qxxOZKc-fK10f9Ejn_etEPiGZoWPivc-ESbAXdTw@mail.gmail.com>
Message-ID: <50b390e0-d845-4f80-a908-74336c69951f@em9g2000vbb.googlegroups.com>

Hi,

We had a similar problem here. The most probable explanation in our
case was that the flow of the program could sometimes be interrupted
between the declaration of the queue and the actual consumption.

Our best solution was to declare our auto-delete queues with the x-
expires argument. That way, auto-delete queues with 0 consumers always
get deleted eventually.

Cheers.

On 20 mar, 15:44, Dave Stevens <daverstev... at gmail.com> wrote:
> Hrmmmm, you bring up a good point. A queue with this name definitely once
> had consumers. It looks like there were never any deliveries for the exact
> queue in question though. I'm thinking that the reconnect logic in the
> library I'm using is causing queues to be redeclared when my app is
> shutting down.
>
> On Tue, Mar 20, 2012 at 10:32 AM, Simon MacMullen <si... at rabbitmq.com>wrote:
>
>
>
>
>
>
>
> > On 20/03/12 14:23, Dave Stevens wrote:
>
> >> I frequently notice that queues which were created with autodelete are
> >> not actually deleted once there are no more consumers.
>
> > Just to be absolutely clear here: you mean they had consumers once, and
> > then the consumers all went away? If the queue never has consumers it will
> > not autodelete (otherwise it would autodelete as soon as you created it).
>
> > If you do mean that there were once consumers and the queue is still not
> > getting deleted, then yes, that would be wrong. We do test for this though
> > :-) so a test program would be helpful.
>
> > Cheers, Simon
>
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From andrea.rosa at hp.com  Wed Mar 21 16:46:10 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 21 Mar 2012 16:46:10 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
In-Reply-To: <4F1551B2.5040606@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
	<4F144156.6060700@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690DA84@G4W3209.americas.hpqcorp.net>
	<4F1551B2.5040606@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3694002D@G9W0721.americas.hpqcorp.net>

Hi Simon

Sorry for taking back this old thread, but my server crashed and in the log file there is a similar, but not exactly the same error.
This error is on a server with the 2.6.1 version, can you confirm me that the 2.7.1 will address this issue?
---------------------------------------------------------------------------------------
** Generic server <0.29404.1109> terminating
** Last message in was open
** When Server state == {state,1,<0.29396.1109>,<0.29403.1109>,direct,
                               {[],[]},
                               false,undefined,none,none,0,true,none,
                               #Fun<amqp_channel_sup.0.131580242>,
                               {0,nil},
                               {0,nil},
                               true}
** Reason for termination ==
** {{badmatch,
     {badrpc,
      {'EXIT',
       {noproc,
        {gen_server,call,
         [rabbit_direct_client_sup,
          {start_child,
           [{direct,1,<0.29404.1109>,<0.29396.1109>,
             rabbit_framing_amqp_0_9_1,
             {user,<<"username">>,
              [administrator],
              rabbit_auth_backend_internal,
              {internal_user,<<"username">>,
               <<113,183,91,238,32,251,27,79,102,247,113,214,59,13,65,84,102,
                 217,148,34>>,
               [administrator]}},
             <<"/">>,
             [{<<"publisher_confirms">>,bool,true},
              {<<"exchange_exchange_bindings">>,bool,true},
              {<<"basic.nack">>,bool,true},
              {<<"consumer_cancel_notify">>,bool,true}],
             <0.29401.1109>}]},
          infinity]}}}}},
    [{amqp_channel_sup,'-start_writer_fun/4-fun-0-',6},
     {amqp_channel,start_writer,1},
     {amqp_channel,do_rpc,1},
     {amqp_channel,handle_call,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}
---------------------------------------------------------------------------------------

Cheers
--
Andrea Rosa






>-----Original Message-----
>From: Simon MacMullen [mailto:simon at rabbitmq.com]
>Sent: 17 January 2012 10:47
>To: Rosa, Andrea
>Cc: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] server crash 2.6.1
>
>On 17/01/12 09:08, Rosa, Andrea wrote:
>> Thanks for your reply, I attached here a snippet of log files with
>more details.
>
> From the logs:
>
>** Reason for termination ==
>** {{badmatch,false},
>     [{rabbit_msg_store_ets_index,insert,2},
>      {rabbit_msg_store,write_message,3},
>      {rabbit_msg_store,handle_cast,2},
>      {gen_server2,handle_msg,2},
>      {proc_lib,wake_up,3}]}
>
>We believe we fixed this in 2.7.1 (although it was one of those that we
>got by staring at the code; we were never able to replicate it).
>
>Cheers, Simon
>
>--
>Simon MacMullen
>RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 21 16:50:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 16:50:28 +0000
Subject: [rabbitmq-discuss] server crash 2.6.1
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3694002D@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3690D8AD@G4W3209.americas.hpqcorp.net>
	<4F144156.6060700@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3690DA84@G4W3209.americas.hpqcorp.net>
	<4F1551B2.5040606@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3694002D@G9W0721.americas.hpqcorp.net>
Message-ID: <4F6A06D4.2090707@rabbitmq.com>

On 21/03/12 16:46, Rosa, Andrea (HP Cloud Services) wrote:
> Sorry for taking back this old thread, but my server crashed and in the log file there is a similar, but not exactly the same error.
> This error is on a server with the 2.6.1 version, can you confirm me that the 2.7.1 will address this issue?

This is not the same thing. It's also not the beginning of whatever went 
wrong - this is already complaining that the direct client supervisor is 
not there. Could you post the log file somewhere?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andreivereha at gmail.com  Wed Mar 21 17:14:48 2012
From: andreivereha at gmail.com (Andrei Vereha)
Date: Wed, 21 Mar 2012 19:14:48 +0200
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash
Message-ID: <20120321191448.2927b95a@cronos.dsdtm.ro>

Hello ,

A few hours ago our Rabbitmq server crashed with message:

=erl_crash_dump:0.1
Wed Mar 21 13:05:19 2012
Slogan: eheap_alloc: Cannot allocate 1824525600 bytes of memory (of
type "heap"). 
System version: Erlang R14B02 (erts-5.8.3) [source]
[64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]
Compiled: Fri May  6 16:15:00 2011 Taints: 

I uploaded the compressed erl_crash.dump file here(uncompressed it takes
1.5GB):

http://dl.transfer.ro/dump-transfer_RO-21mar-9ef325.7z

When this happened vm_memory_high_watermark was not 'activated':
grep vm_memory_high_watermark rabbit at rabbitmq-01.log -> prints nothing.

Why did it crashed?

Thank you,
  Andrei

From simon at rabbitmq.com  Wed Mar 21 17:22:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 17:22:07 +0000
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash
In-Reply-To: <20120321191448.2927b95a@cronos.dsdtm.ro>
References: <20120321191448.2927b95a@cronos.dsdtm.ro>
Message-ID: <4F6A0E3F.9070609@rabbitmq.com>

The erl_crash.dump is not terribly useful I'm afraid.

How much memory did the machine have?

What was the high watermark set to?

Can we see the logs?

Cheers, Simon

On 21/03/12 17:14, Andrei Vereha wrote:
> Hello ,
>
> A few hours ago our Rabbitmq server crashed with message:
>
> =erl_crash_dump:0.1
> Wed Mar 21 13:05:19 2012
> Slogan: eheap_alloc: Cannot allocate 1824525600 bytes of memory (of
> type "heap").
> System version: Erlang R14B02 (erts-5.8.3) [source]
> [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]
> Compiled: Fri May  6 16:15:00 2011 Taints:
>
> I uploaded the compressed erl_crash.dump file here(uncompressed it takes
> 1.5GB):
>
> http://dl.transfer.ro/dump-transfer_RO-21mar-9ef325.7z
>
> When this happened vm_memory_high_watermark was not 'activated':
> grep vm_memory_high_watermark rabbit at rabbitmq-01.log ->  prints nothing.
>
> Why did it crashed?
>
> Thank you,
>    Andrei
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From johnstoner2 at gmail.com  Wed Mar 21 17:27:27 2012
From: johnstoner2 at gmail.com (John Stoner)
Date: Wed, 21 Mar 2012 12:27:27 -0500
Subject: [rabbitmq-discuss] newbie problem--'Error: unable to connect to
 node 'rabbit@rabbitmq-small02-dev': nodedown'
In-Reply-To: <4F670874.4060407@rabbitmq.com>
References: <CAMXtMFB_jt-Kw=YRnrupbQU=8z2VQbxnxaH4kZ9_rMT_ZnYWhg@mail.gmail.com>
	<4F608634.1080104@rabbitmq.com>
	<CAMXtMFCby2P-BF+pEZvTm0cid0UZQ5mjppukfZXhWJJED4XRdw@mail.gmail.com>
	<4F61BD62.3000109@rabbitmq.com>
	<CAMXtMFCZ41ffyeWog4B3qdZ1rWy7MZ73=L14TWoDucRUXKimEw@mail.gmail.com>
	<CAMXtMFAmZ_3RbQvx997jKR2puHfWkked5o5Dd0=k=754cHbm0Q@mail.gmail.com>
	<4F627434.3000405@rabbitmq.com>
	<CAMXtMFDCKaU_iLFctct+u3h--DN8vsczBhrsf85K-y8DxgFtJg@mail.gmail.com>
	<CAMXtMFBUDkAMr60zZw7do6EfryrxfeifF82RrNEdA-gBSaPutQ@mail.gmail.com>
	<CAMXtMFAcweEZ5Gn1h7iSc0Z+uE-SoGqG17VSyhOrJZYTs1YwUQ@mail.gmail.com>
	<CAMXtMFB0z4jzrOW7ASV3uGf-0sOsB1YZ=vQ3rUD3bADFf=qW-A@mail.gmail.com>
	<4F6314F0.2060400@rabbitmq.com>
	<CAMXtMFACH=N=0XQPCjAwXLdB4hxdgW82kvgbAJLmy=u=xHTkQQ@mail.gmail.com>
	<CAMXtMFA63Ug-qkb30yfwOFoieuu-gHZSLikkxMQVY-VwiLpvzw@mail.gmail.com>
	<4F637EE9.5080503@rabbitmq.com>
	<CAMscK0bb4Yk5Fh9GxisfY1=B-Wrh-oLrHbZGamM=pFt14o-scw@mail.gmail.com>
	<4F670874.4060407@rabbitmq.com>
Message-ID: <CAMXtMFBbwracZC5vLCTKp8ZPBgzW=+ZNOakEz7xbcXnYfPRxwA@mail.gmail.com>

OK, apparently there was a bit of flakiness in EC2's security. We forced a
reapply of the rules by making a change and then undoing it, and now it
clusters ok.

On Mon, Mar 19, 2012 at 5:20 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Michael,
>
> On 16/03/12 18:37, Michael Cumings wrote:
> > So what is the considerations on having 5 over 10 or 1?  Is there a
> > reasonable criteria that can be used to determine what an appropriate
> > number of ports that should be allocated?
>
> Convenience only, I think. It is possible to configure one or as many
> unused ports as you like.
>
>
> -Emile
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
blogs:
http://johnstoner.wordpress.com/
'In knowledge is power; in  wisdom, humility.'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/4e4999ce/attachment.htm>

From threshar at torgo.978.org  Wed Mar 21 17:24:34 2012
From: threshar at torgo.978.org (Jeff)
Date: Wed, 21 Mar 2012 13:24:34 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
Message-ID: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>

this is a very small patch to add exclusive-access support to a queue when accessed via the stomp adaptor.  It is enabled by using the "exclusive" header.

If you are using Net::Stomp your subscribe would look like 

$stomp->subscribe({ "destination" => "/amq/queue/test",
						"ack" => "auto", 
						"exclusive" => "true"
				 }));


-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-2.7.1-exclusive-stomp.diff
Type: application/octet-stream
Size: 1980 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/cb92d592/attachment.obj>
-------------- next part --------------


--
Jeff Trout <jeff at jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/




From simon at rabbitmq.com  Wed Mar 21 18:17:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Mar 2012 18:17:38 +0000
Subject: [rabbitmq-discuss] Is it possible to remove unacked messages?
In-Reply-To: <e3502b6e-7cc7-4b83-ae52-6f3f6e953b1f@s9g2000pba.googlegroups.com>
References: <e3502b6e-7cc7-4b83-ae52-6f3f6e953b1f@s9g2000pba.googlegroups.com>
Message-ID: <4F6A1B42.7030901@rabbitmq.com>

On 21/03/12 16:28, Paulo Cheque wrote:
> Is it possible to remove unacked messages?
>
> The unique way I can remove unack messages is stopping my consumer, so
> the message return to que "ready queue". So I can discard it, so I
> restart my consumer again.

basic.recover should do this, assuming I understand the question correctly.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From david.priddle at betgenius.com  Wed Mar 21 18:53:19 2012
From: david.priddle at betgenius.com (David Priddle)
Date: Wed, 21 Mar 2012 18:53:19 +0000
Subject: [rabbitmq-discuss] Rabbit 2.8.0 .NET Client available on Nuget?
In-Reply-To: <29209107.249.1332346364384.JavaMail.geo-discussion-forums@pbctp7>
References: <9C1945D202940B47A9F587776BEE7F401367F9B515@exchg02>
	<4F69B7DA.3040708@rabbitmq.com>
	<29209107.249.1332346364384.JavaMail.geo-discussion-forums@pbctp7>
Message-ID: <9C1945D202940B47A9F587776BEE7F401367F9B959@exchg02>

Thanks Joe, Emile.

Much appreciated.

Cheers,
Dave.

From: joefitzgerald [mailto:joeyfitz at gmail.com]
Sent: 21 March 2012 16:13
To: rabbitmq-discuss at googlegroups.com
Cc: David Priddle; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Rabbit 2.8.0 .NET Client available on Nuget?

Hi Dave,

I have updated the RabbitMQ.Client and RabbitMQ.ServiceModel NuGet Packages to 2.8.0.

Also, I've created a github repo containing the source for these packages. You can view this here: https://github.com/joefitzgerald/rabbitmq-dotnet-client

Best Regards,
Joe Fitzgerald

On Wednesday, March 21, 2012 5:13:30 AM UTC-6, Emile Joubert wrote:
Hi Dave,

On 20/03/12 17:55, David Priddle wrote:
> Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET
> client libraries available via Nuget? (2.7.1 is the latest version
> available there.)

Thanks for your message. We will be in contact with all package
maintainers shortly.

-Emile

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

On Wednesday, March 21, 2012 5:13:30 AM UTC-6, Emile Joubert wrote:
Hi Dave,

On 20/03/12 17:55, David Priddle wrote:
> Just wondered when/if you were intending to make the 2.8.0 RabbitMQ .NET
> client libraries available via Nuget? (2.7.1 is the latest version
> available there.)

Thanks for your message. We will be in contact with all package
maintainers shortly.

-Emile

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/105906e4/attachment.htm>

From inoko at ms.scsk.jp  Thu Mar 22 05:34:51 2012
From: inoko at ms.scsk.jp (Toru Inoko)
Date: Thu, 22 Mar 2012 14:34:51 +0900
Subject: [rabbitmq-discuss] keepalived option in rabbitmq.config
Message-ID: <op.wbj4gdz8xfu728@rbxc0734.platz.scs.jp>

Hi all,

I set keepalived option in rabbitmq.config, but it seems it's not  
working...
When I quit client application without closing connection, the connecion  
on rabbitmq server is existed.
Why? Should I set keepalive-timeout?

Thanks, Toru


From zabrane3 at gmail.com  Thu Mar 22 08:23:35 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Thu, 22 Mar 2012 09:23:35 +0100
Subject: [rabbitmq-discuss] amqp_main_reader:handle_info/2 bad match
In-Reply-To: <op.wbj4gdz8xfu728@rbxc0734.platz.scs.jp>
References: <op.wbj4gdz8xfu728@rbxc0734.platz.scs.jp>
Message-ID: <ADBD3927-F33E-4F21-ADA0-F83746BBB3FA@gmail.com>

Hu guys,

Does anyone faced this error before:

23:06:41.312 [error] gen_server <0.220.0> terminated with reason: no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]}
23:06:41.329 [error] CRASH REPORT Process <0.220.0> with 0 neighbours crashed with reason: no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]}
23:06:41.419 [error] Supervisor amqp_connection_type_sup had child at module undefined at <0.220.0> exit with reason no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]} in context shutdown_error

I got this error when calling "init:stop()." to turn off my unique Erlang node.
Unfortunately I can't reproduce it.

Hints appreciated?

N.B: OSX 10.7.3, Erlang R15B, RabbitMQ 2.8.0 (not under any pressure, few messages only).

Regards,
Zabrane


From puru.belagali at gazprom-mt.com  Thu Mar 22 09:44:10 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Thu, 22 Mar 2012 09:44:10 +0000
Subject: [rabbitmq-discuss] help
In-Reply-To: <4F6A01AE.2020602@rabbitmq.com>
References: <1C007B2F327A00438987610C4ADC7116248879B3@EXCMBX02PR.Gazpromuk.intra>
	<4F6A01AE.2020602@rabbitmq.com>
Message-ID: <1C007B2F327A00438987610C4ADC711624888069@EXCMBX02PR.Gazpromuk.intra>

Hi Simon,

Thank you . I can see a property setter 'RequestedHeartbeat' = x secs on the ConnectionFactory. If I set this before CreateConnection(). Does that do the job?

Please let know if you any samples in .NET or any documentation to understand the internals of heartbeat better.

Thanks,
Puru


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 21 March 2012 16:29
To: Puru Belagali
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] help

On 21/03/12 16:12, Puru Belagali wrote:
> I would like to know if Rabbit provides a heart beat mechanism for 
> subscriber services. This is required to keep the connection active to 
> overcome the firewall idle timers.

Yes. You specify it when creating a connection. How exactly you do that depends on the client library you're using.

Cheers, Simon


--
Simon MacMullen
RabbitMQ, VMware

From andreivereha at gmail.com  Thu Mar 22 09:52:06 2012
From: andreivereha at gmail.com (Andrei Vereha)
Date: Thu, 22 Mar 2012 11:52:06 +0200
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash
In-Reply-To: <4F6A0E3F.9070609@rabbitmq.com>
References: <20120321191448.2927b95a@cronos.dsdtm.ro>
	<4F6A0E3F.9070609@rabbitmq.com>
Message-ID: <20120322115206.0be8399a@cronos.dsdtm.ro>

On Wed, 21 Mar 2012 17:22:07 +0000
Simon MacMullen <simon at rabbitmq.com> wrote:

> The erl_crash.dump is not terribly useful I'm afraid.
> 
> How much memory did the machine have?
> 
> What was the high watermark set to?

Quoting logs:
Memory limit set to 1585MB of 3963MB total.

> Can we see the logs?
> 

The logs are here:
http://dl.transfer.ro/logs-transfer_RO-22mar-8ea6e9.7z

The server started at :
=INFO REPORT==== 20-Mar-2012::19:15:20 ===
and it crashed at:
Wed Mar 21 13:05:19 2012
The startup_log is from the last startup(after 13:05).
The last entry in the -sasl file is from 28-Feb-2012.
The previous runs that you see in logs was a 2.8.0 install, but it
seemed to leak memory. That's why I downgraded it to 2.7.1.

Regarding 2.7.1, it crashed a few times before but killed by OOM killer.
This was the output in dmesg:

[4428010.034014] Out of memory: Kill process 18725 (beam.smp) score 855
or sacrifice child
[4428010.034117] Killed process 18725 (beam.smp) total-vm:4978220kB,
anon-rss:3319964kB, file-rss:0kB
[4428010.046305] beam.smp invoked oom-killer: gfp_mask=0x200da,
order=0, oom_adj=0, oom_score_adj=0
[4428010.046312] beam.smp cpuset=/ mems_allowed=0
[4428010.046315] Pid: 18777, comm: beam.smp Not tainted 3.0.0-12-server
#20-Ubuntu

Here is the "normal" memory usage(reported by rabbtimqctl status):

 {memory,
     [{total,283178496},
      {processes,153323688},
      {processes_used,151332168},
      {system,129854808},
      {atom,1575153},
      {atom_used,1552033},
      {binary,14064320},
      {code,14557226},
      {ets,22433696}]},
 {vm_memory_high_watermark,0.39999999985562695},
 {vm_memory_limit,1662359961}]

Thank you,
 Andrei

> Cheers, Simon
> 
> On 21/03/12 17:14, Andrei Vereha wrote:
> > Hello ,
> >
> > A few hours ago our Rabbitmq server crashed with message:
> >
> > =erl_crash_dump:0.1
> > Wed Mar 21 13:05:19 2012
> > Slogan: eheap_alloc: Cannot allocate 1824525600 bytes of memory (of
> > type "heap").
> > System version: Erlang R14B02 (erts-5.8.3) [source]
> > [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]
> > Compiled: Fri May  6 16:15:00 2011 Taints:
> >
> > I uploaded the compressed erl_crash.dump file here(uncompressed it
> > takes 1.5GB):
> >
> > http://dl.transfer.ro/dump-transfer_RO-21mar-9ef325.7z
> >
> > When this happened vm_memory_high_watermark was not 'activated':
> > grep vm_memory_high_watermark rabbit at rabbitmq-01.log ->  prints
> > nothing.
> >
> > Why did it crashed?
> >
> > Thank you,
> >    Andrei
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

From emile at rabbitmq.com  Thu Mar 22 10:37:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 22 Mar 2012 10:37:15 +0000
Subject: [rabbitmq-discuss] help
In-Reply-To: <1C007B2F327A00438987610C4ADC711624888069@EXCMBX02PR.Gazpromuk.intra>
References: <1C007B2F327A00438987610C4ADC7116248879B3@EXCMBX02PR.Gazpromuk.intra>
	<4F6A01AE.2020602@rabbitmq.com>
	<1C007B2F327A00438987610C4ADC711624888069@EXCMBX02PR.Gazpromuk.intra>
Message-ID: <4F6B00DB.8000607@rabbitmq.com>

Hi,

On 22/03/12 09:44, Puru Belagali wrote:
> Hi Simon,
> 
> Thank you . I can see a property setter 'RequestedHeartbeat' = x secs
> on the ConnectionFactory. If I set this before CreateConnection().
> Does that do the job?

Yes that is the correct method. You will find an example use in the
TestIDisposableImpl unit test.

Also see the spec for the description of the field:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune.heartbeat


-Emile


From clemens.kol at gmail.com  Wed Mar 21 21:44:01 2012
From: clemens.kol at gmail.com (Clemens Kolbitsch)
Date: Wed, 21 Mar 2012 14:44:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika warning (after write buffer exceeded)
	causes exception
Message-ID: <29974628.767.1332366241302.JavaMail.geo-discussion-forums@yncs14>

Hi guys,

let me start with the obvious: thanks for the great library :) I ran into 
the same problem as was mentioned here:

> 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-April/012223.html

where one sees below warning when using a Tornadoconnection:

/usr/local/lib/python2.6/dist-packages/pika/connection.py:642: UserWarning: 
Pika: Write buffer exceeded warning threshold at 1827 bytes and an 
estimated 53 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))

I tried to follow the first approach (disabling the warning and raising the 
set_backpressure_multiplier), but that raises another problem:

ERROR:root:Exception in I/O handler for fd 12
Traceback (most recent call last):
  File "/usr/local/lib/python2.6/dist-packages/tornado/ioloop.py", line 
308, in start
    self._handlers[fd](fd, events)
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 134, in _handle_events
    self._handle_read()
  File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 162, in _handle_read
    self._on_data_available(data)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
599, in _on_data_available
    self._channels[frame.channel_number].transport.deliver(frame)
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line 64, 
in deliver
    self.frame_dispatcher.process(frame)
  File "/usr/local/lib/python2.6/dist-packages/pika/frame.py", line 202, in 
process
    self._handler(frame)
  File "/usr/local/lib/python2.6/dist-packages/pika/frame.py", line 260, in 
handler
    finish()
  File "/usr/local/lib/python2.6/dist-packages/pika/frame.py", line 289, in 
finish
    ''.join(body_fragments))      # Arg 3
  File "/usr/local/lib/python2.6/dist-packages/pika/callback.py", line 124, 
in process
    callback(*args, **keywords)
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line 420, 
in _on_basic_deliver
    body)
  File "/home/blacklist/llupload/llupload/worker/queue_worker.py", line 
198, in process_message
    channel.basic_ack(delivery_tag=method.delivery_tag)
  File "/usr/local/lib/python2.6/dist-packages/pika/spec.py", line 2563, in 
basic_ack
    return self.transport.rpc(Basic.Ack(delivery_tag=delivery_tag, 
multiple=multiple))
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line 119, 
in rpc
    self.send_method(method)
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line 126, 
in send_method
    self.connection._send_method(self.channel_number, method, content)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
657, in _send_method
    self._send_frame(pika.frame.Method(channel_number, method))
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", line 
642, in _send_frame
    warn(message % (self.outbound_buffer.size, est_frames_behind))
TypeError: issubclass() arg 2 must be a class or tuple of classes

Is this a known problem or am I doing something wrong on my side?

Python 2.6.5 (r265:79063, Apr 16 2010, 13:57:41) 
[GCC 4.4.3] on linux2
>>> import pika
>>> pika.__version__
'0.9.5'

Any help is highly appreciated!

thanks,
Clemens

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120321/6fb6216b/attachment.htm>

From jonathan.gaillard at dominionenterprises.com  Thu Mar 22 03:39:59 2012
From: jonathan.gaillard at dominionenterprises.com (gaillard)
Date: Wed, 21 Mar 2012 20:39:59 -0700 (PDT)
Subject: [rabbitmq-discuss]  atomic transactions
Message-ID: <33544596.post@talk.nabble.com>


Hello everyone,

I have need to use transactions in the following way:
-get a message (m1) from queue A
-transforms the message and create new message (m2)
-publish m2 to queue B
-ack m1
-commit the transaction (includes ack and publish)

Which i believe in all failure scenarios should result in possibly two
things:
m1 on queue A, nothing on queue B
m2 on queue B, nothing on queue A

Is this what will happen in rabbit 2.7 or 2.8?

Note: the need above has nothing to do with how to detect that m1 got
delivered a second time or ensuring that cant happen (which of course it
could and should if it dies while transforming)

What I wouldn't expect to see would be m1 on queue A AND m2 on queue B

----------
As a simple example of a situation that I believe requires support of the
above, is a single queue with one or two message on it. Multiple consumers
on the queue that process each message and then put it back on the queue to
be picked up again. After a crash there shouldn't be two copies of the same
message on the queue.

By having a transaction that just picks up and publishes back to the same
queue and commits, I would think that example could be achieved with rabbit
2.7 or 2.8 from everything I have read in the mailing list, is that correct?

Thanks !!!


-- 
View this message in context: http://old.nabble.com/atomic-transactions-tp33544596p33544596.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From awilliam at whitemice.org  Thu Mar 22 11:30:58 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Thu, 22 Mar 2012 07:30:58 -0400
Subject: [rabbitmq-discuss] Centralized web logging options.
In-Reply-To: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
References: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
Message-ID: <1332415858.18176.6.camel@workstation.wmmi.net>

On Sat, 2012-02-25 at 06:25 +0700, Bill Moseley wrote:
> We have a busy pool of web servers running Apache that are currently
> logging on each machine.  I'm looking at using RabbitMQ and a
> centralized log server.

A syslog -> rabbit adaptor would be nice.  But I haven't found such a
thing.

> I have no concerns about RabbitMQ handling the traffic, and no
> concerns about getting the logs into the queue.

> Anyone here doing this currently?

Currently we log to syslog and funnel all the syslog traffic to a
central syslog server.   If messages could be wrapped up as rabbitmq
message they would be easier to deal with in an intelligent manner.  On
the other hand most NMS's can do this and already have a GUI for
configuring event patterns [ZenOSS is what we use].


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/e22cbafb/attachment.pgp>

From gmr at myyearbook.com  Thu Mar 22 13:05:46 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 22 Mar 2012 09:05:46 -0400
Subject: [rabbitmq-discuss] Centralized web logging options.
In-Reply-To: <1332415858.18176.6.camel@workstation.wmmi.net>
References: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
	<1332415858.18176.6.camel@workstation.wmmi.net>
Message-ID: <ED51A8FBDD4F4F6F94B3619293ACE328@myyearbook.com>



On Thursday, March 22, 2012 at 7:30 AM, Adam Tauno Williams wrote:

> On Sat, 2012-02-25 at 06:25 +0700, Bill Moseley wrote:
> > We have a busy pool of web servers running Apache that are currently
> > logging on each machine. I'm looking at using RabbitMQ and a
> > centralized log server.
> > 
> 
> 
> A syslog -> rabbit adaptor would be nice. But I haven't found such a
> thing.
> 
> 

https://github.com/bkjones/bevis 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/615961fb/attachment.htm>

From dsinclair at chariotsolutions.com  Thu Mar 22 13:13:04 2012
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Thu, 22 Mar 2012 09:13:04 -0400
Subject: [rabbitmq-discuss] Centralized web logging options.
In-Reply-To: <ED51A8FBDD4F4F6F94B3619293ACE328@myyearbook.com>
References: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
	<1332415858.18176.6.camel@workstation.wmmi.net>
	<ED51A8FBDD4F4F6F94B3619293ACE328@myyearbook.com>
Message-ID: <CAGtiFWVppgh-iQzts44P5rK9TEWwJp0E-Ojhqn1-sO6LsuBpdQ@mail.gmail.com>

We are using Flume https://cwiki.apache.org/FLUME/ with the RabbitMQ Plugin
https://github.com/stampy88/flume-amqp-plugin. Works like a charm

On Thu, Mar 22, 2012 at 9:05 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>
>  On Thursday, March 22, 2012 at 7:30 AM, Adam Tauno Williams wrote:
>
> On Sat, 2012-02-25 at 06:25 +0700, Bill Moseley wrote:
>
> We have a busy pool of web servers running Apache that are currently
> logging on each machine. I'm looking at using RabbitMQ and a
> centralized log server.
>
>
> A syslog -> rabbit adaptor would be nice. But I haven't found such a
> thing.
>
> https://github.com/bkjones/bevis
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/65e1f4e9/attachment.htm>

From holger.hoffstaette at googlemail.com  Thu Mar 22 13:43:37 2012
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Thu, 22 Mar 2012 14:43:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ installation vs. ERL_LIB
Message-ID: <pan.2012.03.22.13.43.35.158250@googlemail.com>


Dear Rabbits!

I've had RabbitMQ installed forever and it has been hopping along nicely. Some
time ago I tried to play with Riak and got strange build errors. This lead
to

  https://bugs.gentoo.org/show_bug.cgi?id=399831

which is really just a continuation of 

  http://www.mail-archive.com/riak-users at lists.basho.com/msg04075.html

This is so stupid that my head hurts, but I figured I still ask for
suggestions how to fix this. "Just temporarily move it aside" is OBVIOUSLY NOT an
option. !"?$%

It would be nice to fix this "upstream"; I'm relatively sure I don't want
to go to the trouble of rewriting the existing Gentoo ebuild, fix all
paths & startup scripts etc. and then maintain that fork.
A cheap first mitigation step would be to prefix the gen_server2 (or any
other conflicting modules) to rabbit_gen_server2 or similar. Long term it
would be much better to move the package out of the shared lib dir.

I realize that this is a limitation/bug/oddity/fail in Erlang, but
nevertheless it should be possible to install two different packages
without conflicts. I mean..it's 2012.

Any other ideas?

Holger



From simon at rabbitmq.com  Thu Mar 22 13:53:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Mar 2012 13:53:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ installation vs. ERL_LIB
In-Reply-To: <pan.2012.03.22.13.43.35.158250@googlemail.com>
References: <pan.2012.03.22.13.43.35.158250@googlemail.com>
Message-ID: <4F6B2EF2.2060202@rabbitmq.com>

On 22/03/12 13:43, Holger Hoffstaette wrote:
> Long term it
> would be much better to move the package out of the shared lib dir.

Or short term even.

I don't know anything about the Gentoo packaging for RabbitMQ, but 
installing it into /usr/lib/erlang/lib is definitely bad and wrong, for 
precisely this reason.

Yes, we used to do this for RPMs and debs back in ancient days, but then 
we came to our senses. These days you should be able to install it 
anywhere and the startup shell script will figure out the paths needed 
for the VM.

BTW, the assertion here:

http://www.mail-archive.com/riak-users at lists.basho.com/msg04097.html

about a symlink in Debian packaging is I think incorrect. (I just went 
back and installed our 2.3.1 deb and no such symlink exists.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From josh at gebaschtel.ch  Thu Mar 22 14:14:41 2012
From: josh at gebaschtel.ch (Josh Geisser)
Date: Thu, 22 Mar 2012 14:14:41 +0000
Subject: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'
In-Reply-To: <2848820F-5EE8-47E3-B5C5-60DF11E8A3FB@rabbitmq.com>
References: <B8B68C3D41791846910BA4C7AF61D25B034CFD@ganymede.gebaschtel.bnet>
	<2848820F-5EE8-47E3-B5C5-60DF11E8A3FB@rabbitmq.com>
Message-ID: <B8B68C3D41791846910BA4C7AF61D25B035913@ganymede.gebaschtel.bnet>

Thanks for the fast response

Actually, removing the whole START_PROG works as workaround for us with the 2.8.0-1.suse.noarch.rpm

Thanks a lot
Cheers
Josh

-----Urspr?ngliche Nachricht-----
Von: Steve Powell [mailto:steve at rabbitmq.com] 
Gesendet: Dienstag, 20. M?rz 2012 13:24
An: Josh Geisser
Cc: rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'

Dear Josh,

Thanks for telling us about this -- this is rather embarrassing. In
attempting to get Linux server installations to start the rabbitmq-service
without blocking shutdown, we used runuser for certain systems. Our
mistake.

A workaround ought to be to replace runuser in the relevant script, as
below:

On line 29 (or thereabouts) in the rabbitmq-server script in init.d
there is a line like this:

START_PROG="runuser rabbitmq --session-command"

which you should replace with:

START_PROG="setsid"

This will cause the rabbitmq-server service to be started with 'su'. Be
aware that this might inhibit shutdown (since su creates a PAM session
for the user rabbitmq).

We'll update our SuSE rpm file, when we find a proper solution to this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 20 Mar 2012, at 08:34, Josh Geisser wrote:

> Hi all
>  
> I just noticed that 'rabbitmq-server-2.8.0-1.suse.noarch.rpm' throws the following error when being started:
>  
> /etc/init.d/rabbitmq-server: line 60: runuser: command not found
>  
> The old 2.7.1 packaged rc-script was just fine
>  
> FYI & cheers
> Josh
>  
> /etc/SuSE-release sais we're using
> SUSE Linux Enterprise Server 11 (x86_64)
> VERSION = 11
> PATCHLEVEL = 1
> -- 
> ----
> ASG at hnet
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
----
ASG at hnet

From santiagomonttco at gmail.com  Thu Mar 22 14:41:52 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Thu, 22 Mar 2012 11:41:52 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?=7CSpam=7C_=22AUDITORIA_LABOR?=
	=?windows-1252?q?AL_PREVENTIVA=22_COMO_ENFRENTAR_CON_EXITO_LA_REFO?=
	=?windows-1252?q?RMA_LABORAL?=
Message-ID: <3218e4546729c4856e3ee3a80017e402@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/44063501/attachment.htm>

From zabrane3 at gmail.com  Thu Mar 22 16:14:40 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Thu, 22 Mar 2012 17:14:40 +0100
Subject: [rabbitmq-discuss] amqp_main_reader:handle_info/2 bad match
Message-ID: <D263412B-11F7-46A2-9F2C-73B2938081AB@gmail.com>

Hu guys,

Does anyone faced this error before:

23:06:41.312 [error] gen_server <0.220.0> terminated with reason: no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]}
23:06:41.329 [error] CRASH REPORT Process <0.220.0> with 0 neighbours crashed with reason: no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]}
23:06:41.419 [error] Supervisor amqp_connection_type_sup had child at module undefined at <0.220.0> exit with reason no match of right hand value {error,einval} in {amqp_main_reader,handle_info,2,[{file,[115,114,99,47,97,109,113,112,95,109,97,105,110,95,114,101,97,100,101,114,46,101,114,108]},{line,71}]} in context shutdown_error

I got this error when calling "init:stop()." to turn off my unique Erlang node.
Unfortunately I can't reproduce it.

Hints appreciated?

N.B: OSX 10.7.3, Erlang R15B, RabbitMQ 2.8.0 (broker not under any pressure, only few messages).

Regards,
Zabrane


From simon at rabbitmq.com  Thu Mar 22 16:21:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Mar 2012 16:21:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.8.1 released
Message-ID: <4F6B518F.6080904@rabbitmq.com>

The RabbitMQ team is pleased (and somewhat contrite) to announce the 
release of RabbitMQ 2.8.1.

This release fixes a small number of bugs in RabbitMQ 2.8.0, most 
notably a bug which prevented cluster RAM nodes which had run an earlier 
version from being upgraded.

See the attached release notes for more details.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                The RabbitMQ Team
                (http://www.rabbitmq.com)

-- 
Simon MacMullen
RabbitMQ, VMware

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/c64fe2f4/attachment.txt>

From simon at rabbitmq.com  Thu Mar 22 16:32:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Mar 2012 16:32:37 +0000
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
In-Reply-To: <CA+22WDTx-NRJWY_N27JYg1zBfLU1RSQ414Kas2T+U7DeVO2bLA@mail.gmail.com>
References: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>	<4F69C0D2.2090809@rabbitmq.com>	<CA+22WDRB2uHwBUXeEc0EigW6-wZgZ6RJ2uvCMF-wu8tsc1atSg@mail.gmail.com>
	<CA+22WDTx-NRJWY_N27JYg1zBfLU1RSQ414Kas2T+U7DeVO2bLA@mail.gmail.com>
Message-ID: <4F6B5425.7070100@rabbitmq.com>

Yes, definitely. Messages will not leave queues unless they are consumed 
or expire.

If you are still having trouble could you post your source code somewhere?

Cheers, Simon

On 22/03/12 16:28, Dathan Pattishall wrote:
> Hey Simon,
>
> Any idea on what I could look at? From the sounds of it - my settings
> should cause rabbit to queue if the consumer is not available.
>
> On Wed, Mar 21, 2012 at 8:43 AM, Dathan Pattishall
> <dathan at schoolfeed.com <mailto:dathan at schoolfeed.com>> wrote:
>
>     120000 additionally I turned that off as well.
>
>
>     On Wed, Mar 21, 2012 at 4:51 AM, Simon MacMullen <simon at rabbitmq.com
>     <mailto:simon at rabbitmq.com>> wrote:
>
>         On 21/03/12 00:15, Dathan Pattishall wrote:
>
>             My messages have a 120 second expire time
>
>
>         Just to be clear, did you set x-message-ttl to 120 or 120000?
>         The time is in milliseconds, and what you report sounds a lot
>         like the messages expiring near-instantly.
>
>         Cheers, Simon
>
>         --
>         Simon MacMullen
>         RabbitMQ, VMware
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 22 17:20:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Mar 2012 17:20:47 +0000
Subject: [rabbitmq-discuss] /etc/init.d/rabbitmq-server startup script
In-Reply-To: <CANMsNJK56kb2tb6qSS2qYZ3p0UpguWabMWSmFG6x_3519hGjKQ@mail.gmail.com>
References: <CANMsNJK56kb2tb6qSS2qYZ3p0UpguWabMWSmFG6x_3519hGjKQ@mail.gmail.com>
Message-ID: <4F6B5F6F.5020904@rabbitmq.com>

On 21/03/12 16:07, Andrew Eells wrote:
> Hello,
>
> I've recently upgraded from RabbitMQ v2.5.1 to v2.8.0 and having
> installed via the Generic Linux tarball (as opposed to RPM) I'm
> wondering if there is a server bootstrap startup script available, so as
> to run this as a service? The script associated with the previous
> version no longer works.

You can pull the one we use for RPM / debs from:

http://hg.rabbitmq.com/rabbitmq-server/file/7cefef84b261/packaging/common/rabbitmq-server.init

When you say "The script associated with the previous version no longer 
works", is that where you got it from?

Note that there's a change in the generic unix tarball in 2.8.0: it now 
locates logs, config, the database and so on within the unpacked 
tarball, keeping it all in one place and meaning you don't have to mess 
with permissions to get it working.

If you want the old behaviour, see the note "File Locations" at

http://www.rabbitmq.com/install-generic-unix.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 22 17:23:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Mar 2012 17:23:13 +0000
Subject: [rabbitmq-discuss] amqp_main_reader:handle_info/2 bad match
In-Reply-To: <D263412B-11F7-46A2-9F2C-73B2938081AB@gmail.com>
References: <D263412B-11F7-46A2-9F2C-73B2938081AB@gmail.com>
Message-ID: <4F6B6001.2050009@rabbitmq.com>

On 22/03/12 16:14, Zabrane Mickael wrote:
> I got this error when calling "init:stop()." to turn off my unique Erlang node.
> Unfortunately I can't reproduce it.
>
> Hints appreciated?

Ah. I think this is just us not handling the socket going away as the 
node shuts down. I'll file a bug for it, but it looks like it should be 
harmless.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From aeells at qmetric.co.uk  Thu Mar 22 17:26:05 2012
From: aeells at qmetric.co.uk (Andrew Eells)
Date: Thu, 22 Mar 2012 17:26:05 +0000
Subject: [rabbitmq-discuss] /etc/init.d/rabbitmq-server startup script
In-Reply-To: <4F6B5F6F.5020904@rabbitmq.com>
References: <CANMsNJK56kb2tb6qSS2qYZ3p0UpguWabMWSmFG6x_3519hGjKQ@mail.gmail.com>
	<4F6B5F6F.5020904@rabbitmq.com>
Message-ID: <CANMsNJKL2cByG5vnnRnWHGuG2VDsn4te_q2D6_X+25nOHJPSWQ@mail.gmail.com>

Thanks for your reply Simon, much appreciated.

We've had numerous problems, mostly with Erlang it seems to be fair, but
we're also on EC2 Linux which I know is not a preferred platform. We were
attempting to install both from source as we've had stability issues with
the RPM mirrors we were using for 2.5.1.

Anyway, we now have 2.8.0 running via Puppet configuration which is neat. I
may well publish the manifests as it might save a few people some
significant hacking!

Many thanks again,

Drew


On 22 March 2012 17:20, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/03/12 16:07, Andrew Eells wrote:
>
>> Hello,
>>
>> I've recently upgraded from RabbitMQ v2.5.1 to v2.8.0 and having
>> installed via the Generic Linux tarball (as opposed to RPM) I'm
>> wondering if there is a server bootstrap startup script available, so as
>> to run this as a service? The script associated with the previous
>> version no longer works.
>>
>
> You can pull the one we use for RPM / debs from:
>
> http://hg.rabbitmq.com/**rabbitmq-server/file/**
> 7cefef84b261/packaging/common/**rabbitmq-server.init<http://hg.rabbitmq.com/rabbitmq-server/file/7cefef84b261/packaging/common/rabbitmq-server.init>
>
> When you say "The script associated with the previous version no longer
> works", is that where you got it from?
>
> Note that there's a change in the generic unix tarball in 2.8.0: it now
> locates logs, config, the database and so on within the unpacked tarball,
> keeping it all in one place and meaning you don't have to mess with
> permissions to get it working.
>
> If you want the old behaviour, see the note "File Locations" at
>
> http://www.rabbitmq.com/**install-generic-unix.html<http://www.rabbitmq.com/install-generic-unix.html>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

*Andrew Eells*


32-38 Dukes Place, London, EC3A 7LP

tel:           +44 (0) 845 475 1415
mobile:    +44 (0) 772 555 1809
web:         www.qmetric.co.uk<http://www.google.com/url?q=http%3A%2F%2Fwww.qmetric.co.uk%2F&sa=D&sntz=1&usg=AFrqEzfNWYcveHajt6MLZJ_d6wzsSDVW3Q>
<http://www.google.com/url?q=http%3A%2F%2Fwww.qmetric.co.uk%2F&sa=D&sntz=1&usg=AFrqEzfNWYcveHajt6MLZJ_d6wzsSDVW3Q>


Follow me on:

 <http://www.linkedin.com/in/eells>   <http://www.twitter.com/tech_startup>
   <http://www.andrew-eells.com>

----------------------------------------------------------------------------------

The information in this email is confidential and may be legally privileged.  It is intended solely for the addressee.  Access to this email by anyone else is unauthorised.  If you are not the intended recipient, any disclosure, copying, distribution or any action taken or omitted to be taken in reliance on it, is prohibited and may be unlawful.
 
Policy Expert is a trading name of QMetric Group Limited who is authorised and regulated by the Financial Services Authority.  The registered company address of QMetric Group Limited is: 32-38 Dukes Place, London, EC3A 7LP and its company registration number is 07151701.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/e6fa3a39/attachment.htm>

From pacesysjosh at gmail.com  Thu Mar 22 18:20:56 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Thu, 22 Mar 2012 11:20:56 -0700 (PDT)
Subject: [rabbitmq-discuss] [java-client] Parallelizing message consumption
	from a single queue
Message-ID: <14018256.62.1332440456764.JavaMail.geo-discussion-forums@ynnk21>

I wanted to ask the experts since it's not clear to me - what is the best 
way to parallelize message consumption from a single queue, using the Java 
client? 

Thanks,
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/7de3139a/attachment.htm>

From dathan at schoolfeed.com  Thu Mar 22 18:32:17 2012
From: dathan at schoolfeed.com (Dathan Pattishall)
Date: Thu, 22 Mar 2012 11:32:17 -0700
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
In-Reply-To: <4F6B5425.7070100@rabbitmq.com>
References: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>
	<4F69C0D2.2090809@rabbitmq.com>
	<CA+22WDRB2uHwBUXeEc0EigW6-wZgZ6RJ2uvCMF-wu8tsc1atSg@mail.gmail.com>
	<CA+22WDTx-NRJWY_N27JYg1zBfLU1RSQ414Kas2T+U7DeVO2bLA@mail.gmail.com>
	<4F6B5425.7070100@rabbitmq.com>
Message-ID: <CA+22WDSbowYEH1PqRoPnkJs7hL5ehAAL++cqgN_x5j1Ox3KuNw@mail.gmail.com>

I figured it out

$ret = $this->channel->publish(json_encode($data), $this->routingKey,
AMQP_IMMEDIATE, array('Content-type' => 'text/json', 'delivery_mode' =>
2,));


AMQP_IMMEDIATE is the problem it would randomly drop messages. Thanks for
making it clear for me.

On Thu, Mar 22, 2012 at 9:32 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Yes, definitely. Messages will not leave queues unless they are consumed
> or expire.
>
> If you are still having trouble could you post your source code somewhere?
>
> Cheers, Simon
>
>
> On 22/03/12 16:28, Dathan Pattishall wrote:
>
>> Hey Simon,
>>
>> Any idea on what I could look at? From the sounds of it - my settings
>> should cause rabbit to queue if the consumer is not available.
>>
>> On Wed, Mar 21, 2012 at 8:43 AM, Dathan Pattishall
>> <dathan at schoolfeed.com <mailto:dathan at schoolfeed.com>**> wrote:
>>
>>    120000 additionally I turned that off as well.
>>
>>
>>    On Wed, Mar 21, 2012 at 4:51 AM, Simon MacMullen <simon at rabbitmq.com
>>    <mailto:simon at rabbitmq.com>> wrote:
>>
>>        On 21/03/12 00:15, Dathan Pattishall wrote:
>>
>>            My messages have a 120 second expire time
>>
>>
>>        Just to be clear, did you set x-message-ttl to 120 or 120000?
>>        The time is in milliseconds, and what you report sounds a lot
>>        like the messages expiring near-instantly.
>>
>>        Cheers, Simon
>>
>>        --
>>        Simon MacMullen
>>        RabbitMQ, VMware
>>        ______________________________**___________________
>>        rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>        <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>        https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>        <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/b7c471fa/attachment.htm>

From zabrane3 at gmail.com  Thu Mar 22 18:56:45 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Thu, 22 Mar 2012 19:56:45 +0100
Subject: [rabbitmq-discuss] amqp_main_reader:handle_info/2 bad match
In-Reply-To: <4F6B6001.2050009@rabbitmq.com>
References: <D263412B-11F7-46A2-9F2C-73B2938081AB@gmail.com>
	<4F6B6001.2050009@rabbitmq.com>
Message-ID: <B34845AF-C19A-42AF-8E7E-D7DA010050D8@gmail.com>

Hi Simon,

Great if it's harmless and thank for filling up the bug report.
Any chance that the bug will be fixed in next release?

Regards,
Zabrane


On Mar 22, 2012, at 6:23 PM, Simon MacMullen wrote:

> On 22/03/12 16:14, Zabrane Mickael wrote:
>> I got this error when calling "init:stop()." to turn off my unique Erlang node.
>> Unfortunately I can't reproduce it.
>> 
>> Hints appreciated?
> 
> Ah. I think this is just us not handling the socket going away as the node shuts down. I'll file a bug for it, but it looks like it should be harmless.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware



From mss at mawhrin.net  Thu Mar 22 19:10:55 2012
From: mss at mawhrin.net (Mikhail Sobolev)
Date: Thu, 22 Mar 2012 22:10:55 +0300
Subject: [rabbitmq-discuss] Access for "external" users
Message-ID: <20120322191055.GA3358@mawhrin.net>

Hi,

We use rabbitmq for message exchange in the internal system.  What we'd
like to do is to make it possible for "external" users to subscribe to
some of the messages.

Could you please advise how to do that? :)

--
Misha

From pablomolnar at gmail.com  Thu Mar 22 22:42:19 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Thu, 22 Mar 2012 19:42:19 -0300
Subject: [rabbitmq-discuss] Remove a node from a cluster from a different
	node
Message-ID: <CANVSfpLpxxEt4sugjRJwvMk9CAe7gUPy0M0t9905Cg+MRjq3kQ@mail.gmail.com>

Hi,

I've destroyed a VM that was running a node joined to a cluster. Now when a
execute *rabbitmqctl cluster_status *it states that a node is down. I've
read the documentation for how to remove a node in
http://www.rabbitmq.com/clustering.html and it seems that you must remove
it from the node you are taking away. In my case I can't do it because it
doesn't exists any more.

The question is how remove a node from a cluster from a different node?

Cheers,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120322/751f6d86/attachment.htm>

From lionel.cons at cern.ch  Fri Mar 23 07:36:52 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 23 Mar 2012 08:36:52 +0100
Subject: [rabbitmq-discuss] Failed to add an exchange via the web interface
Message-ID: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>

When tyring to use Tony's udp-exchange[1], I got an error while trying to
add an exchange via the web console. The x-udp exchange is documented to
use:

| Key   Type    Optional? Description
| -----------------------------------------------------------------------
| port  short   no        Port number to listen for incoming packets on
| ip    string  yes       IP address to listen on; default is 0.0.0.0

I did add a "port" argument but the web interface did not offer me to select
any type. This apparently generated an error:

{error,
    {exit,
        {{badarg,
             [{io_lib,format,
                  ["Missing 'port' argument to ~p exchange",
                   {resource,<<"rabbitmq">>,exchange,<<"lionel.udp">>}]},
              {rabbit_misc,format,2},
              {rabbit_misc,amqp_error,4},
              {rabbit_misc,protocol_error,4},
              {udp_exchange,endpoint_params,1},
              {udp_exchange,validate,1},
              {rabbit_exchange,declare,6},
              {rabbit_channel,handle_method,3}]},
         {gen_server,call,
             [<0.3764.0>,
              {call,
                  {'exchange.declare',0,<<"test.udp">>,<<"x-udp">>,false,
                      true,false,false,false,
                      [{<<"port">>,longstr,<<"12345">>}]},
                  none,<0.2441.0>},
              infinity]}},
        [{gen_server,call,3},
         {rabbit_mgmt_util,'-amqp_request/5-fun-0-',4},
         {rabbit_mgmt_util,with_channel,5},
         {rabbit_mgmt_util,http_to_amqp,5},
         {webmachine_resource,resource_call,3},
         {webmachine_resource,do,3},
         {webmachine_decision_core,resource_call,1},
         {webmachine_decision_core,accept_helper,0}]}}

If indeed the error comes from type mismatch (short expected and longstr
provided), could the web interface allow specifying the arguments types?

Cheers,

Lionel

[1] https://github.com/tonyg/udp-exchange

From simon at rabbitmq.com  Fri Mar 23 10:44:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 10:44:36 +0000
Subject: [rabbitmq-discuss] Failed to add an exchange via the web
	interface
In-Reply-To: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4F6C5414.4030701@rabbitmq.com>

On 23/03/12 07:36, Lionel Cons wrote:
> If indeed the error comes from type mismatch (short expected and longstr
> provided), could the web interface allow specifying the arguments types?

I've wanted to avoid doing this if at all possible; it makes the UI more 
confusing and means that we can't rely on the inherent JSON types any 
more; other API users would have to annotate too.

The way we handle this in Rabbit proper is to allow any number type for 
a number, any string type for a string. This also reduces hassle for 
people declaring things over AMQP. Tony - is there a reason not to do this?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar 23 10:46:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 10:46:27 +0000
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <20120322191055.GA3358@mawhrin.net>
References: <20120322191055.GA3358@mawhrin.net>
Message-ID: <4F6C5483.9010209@rabbitmq.com>

On 22/03/12 19:10, Mikhail Sobolev wrote:
> We use rabbitmq for message exchange in the internal system.  What we'd
> like to do is to make it possible for "external" users to subscribe to
> some of the messages.
>
> Could you please advise how to do that?:)

Err, create logins for them?

It's not very clear what you're asking here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar 23 10:48:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 10:48:37 +0000
Subject: [rabbitmq-discuss] Is it possible to have these settings and
 publish to a queue that exists yet there is no consumer
In-Reply-To: <CA+22WDSbowYEH1PqRoPnkJs7hL5ehAAL++cqgN_x5j1Ox3KuNw@mail.gmail.com>
References: <CA+22WDTc9Arcuz9yTNBZ9QL-T1Cay_2ZwnNU8rYK1viN5+RUeQ@mail.gmail.com>	<4F69C0D2.2090809@rabbitmq.com>	<CA+22WDRB2uHwBUXeEc0EigW6-wZgZ6RJ2uvCMF-wu8tsc1atSg@mail.gmail.com>	<CA+22WDTx-NRJWY_N27JYg1zBfLU1RSQ414Kas2T+U7DeVO2bLA@mail.gmail.com>	<4F6B5425.7070100@rabbitmq.com>
	<CA+22WDSbowYEH1PqRoPnkJs7hL5ehAAL++cqgN_x5j1Ox3KuNw@mail.gmail.com>
Message-ID: <4F6C5505.7010902@rabbitmq.com>

On 22/03/12 18:32, Dathan Pattishall wrote:
> AMQP_IMMEDIATE is the problem it would randomly drop messages. Thanks
> for making it clear for me.

Well, not randomly. "Immediate" means "if this message will not be 
consumed immediately, drop it (and send me a basic.return to let me know 
it happened). Therefore "immediate" messages will be dropped if there 
are no consumers, *and also if the queue has length > 0*.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar 23 10:48:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 10:48:55 +0000
Subject: [rabbitmq-discuss] amqp_main_reader:handle_info/2 bad match
In-Reply-To: <B34845AF-C19A-42AF-8E7E-D7DA010050D8@gmail.com>
References: <D263412B-11F7-46A2-9F2C-73B2938081AB@gmail.com>
	<4F6B6001.2050009@rabbitmq.com>
	<B34845AF-C19A-42AF-8E7E-D7DA010050D8@gmail.com>
Message-ID: <4F6C5517.7090205@rabbitmq.com>

On 22/03/12 18:56, Zabrane Mickael wrote:
> Any chance that the bug will be fixed in next release?

Probably :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar 23 10:49:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 10:49:36 +0000
Subject: [rabbitmq-discuss] Remove a node from a cluster from a
 different node
In-Reply-To: <CANVSfpLpxxEt4sugjRJwvMk9CAe7gUPy0M0t9905Cg+MRjq3kQ@mail.gmail.com>
References: <CANVSfpLpxxEt4sugjRJwvMk9CAe7gUPy0M0t9905Cg+MRjq3kQ@mail.gmail.com>
Message-ID: <4F6C5540.1010605@rabbitmq.com>

On 22/03/12 22:42, Pablo Molnar wrote:
> The question is how remove a node from a cluster from a different node?

I'm afraid you can't at the moment. This is on our todo list. For the 
time being, I'm afraid you have to bring up another node of the same 
name, recluster it and then remove it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Mar 23 10:52:42 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 23 Mar 2012 10:52:42 +0000
Subject: [rabbitmq-discuss] atomic transactions
In-Reply-To: <33544596.post@talk.nabble.com>
References: <33544596.post@talk.nabble.com>
Message-ID: <4F6C55FA.5090007@rabbitmq.com>

Hi,

On 22/03/12 03:39, gaillard wrote:
> I have need to use transactions in the following way:
> -get a message (m1) from queue A
> -transforms the message and create new message (m2)
> -publish m2 to queue B
> -ack m1
> -commit the transaction (includes ack and publish)
> 
> Which i believe in all failure scenarios should result in possibly two
> things:
> m1 on queue A, nothing on queue B
> m2 on queue B, nothing on queue A
> 
> Is this what will happen in rabbit 2.7 or 2.8?

Mostly yes, but bear in mind that transactions are not atomic in
RabbitMQ. So if the broker crashes or an error occurs during commit then
your invariant might not hold. If you are dealing with very high value
messages then you should add additional logging and correlate the input
and output.

This page has more information about transaction semantics:
http://www.rabbitmq.com/semantics.html


-Emile



From abdullahsaima at yahoo.com  Fri Mar 23 11:13:55 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Fri, 23 Mar 2012 11:13:55 +0000 (GMT)
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
	message in bytes
Message-ID: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>

Hi Everyone,
?
I am working on Rabbit MQ messages, I need you help about how to keep the length of a message in bytes. Before this I was just considering the routing key and taking the length of this string in bytes. Now I want to know what else is important in the message to consider that affects the message lenght. Any help would be highly appreciated.
?
Best Regards, ?
Saima 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/2a60fe8e/attachment.htm>

From emile at rabbitmq.com  Fri Mar 23 11:28:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 23 Mar 2012 11:28:20 +0000
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
 message in bytes
In-Reply-To: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
References: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
Message-ID: <4F6C5E54.5060405@rabbitmq.com>

Hi Saima,

On 23/03/12 11:13, Saima Asif wrote:
> I am working on Rabbit MQ messages, I need you help about how to keep
> the length of a message in bytes. Before this I was just considering the
> routing key and taking the length of this string in bytes. Now I want to
> know what else is important in the message to consider that affects the
> message lenght. Any help would be highly appreciated.

I'm not sure I understand your question. What are you trying to do?

The length of the message body (byte array) will normally exceed the
length of the routing key. Message headers and internal accounting
fields also contribute to the overall memory and/or disk footprint of a
message.

If you are performing a scoping exercise to estimate the amount of RAM
required then use the expected message body size instead of the routing key.


-Emile


From abdullahsaima at yahoo.com  Fri Mar 23 11:31:43 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Fri, 23 Mar 2012 11:31:43 +0000 (GMT)
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
	message in bytes
In-Reply-To: <4F6C5E54.5060405@rabbitmq.com>
References: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F6C5E54.5060405@rabbitmq.com>
Message-ID: <1332502303.33192.YahooMailNeo@web29704.mail.ird.yahoo.com>

Dear Emile,
?
Actually I am understanding by implemeting a kind of working of this RabbitMQ message. I actually want to simulate some of the basic ideas of this. What important features of the message I should consider. I want to keep the length of the message to estimate how much time an exchange would take to process it in my simulation. I dont know whether I am describing it properly or not. 
?
Thanks for help. 

Saima  

________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, 23 March 2012, 11:28
Subject: Re: [rabbitmq-discuss] Help required: How to keep the length of a message in bytes
  
Hi Saima,

On 23/03/12 11:13, Saima Asif wrote:
> I am working on Rabbit MQ messages, I need you help about how to keep
> the length of a message in bytes. Before this I was just considering the
> routing key and taking the length of this string in bytes. Now I want to
> know what else is important in the message to consider that affects the
> message lenght. Any help would be highly appreciated.

I'm not sure I understand your question. What are you trying to do?

The length of the message body (byte array) will normally exceed the
length of the routing key. Message headers and internal accounting
fields also contribute to the overall memory and/or disk footprint of a
message.

If you are performing a scoping exercise to estimate the amount of RAM
required then use the expected message body size instead of the routing key.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/9fdaaa52/attachment.htm>

From andreivereha at gmail.com  Fri Mar 23 12:09:12 2012
From: andreivereha at gmail.com (Andrei Vereha)
Date: Fri, 23 Mar 2012 14:09:12 +0200
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash - updates
In-Reply-To: <4F6A0E3F.9070609@rabbitmq.com>
References: <20120321191448.2927b95a@cronos.dsdtm.ro>
	<4F6A0E3F.9070609@rabbitmq.com>
Message-ID: <20120323140912.4fb1fe4b@cronos.dsdtm.ro>

Hello ,

I executed these comands on the server:
# ps aux | grep beam >  memory.txt
# rabbitmqctl status >> memory.txt

and attacheed the file.

The memory used by the queues:
root at rabbitmq-01:/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-01/msg_store_persistent#
rabbitmqctl list_queues  memory | awk '{ sum+=$1} END {print sum}'
324448024.

Why the beam process takes 1.4 Gb and the rabbitmqctl status reports
only a few hundred Mb?
I see the same value(raported by rabbitmqctl status) in the management
web inteface. 
Is there a way to find where goes the memory?
Am I using a wrong erlang version?

Thank you,
 Andrei


On Wed, 21 Mar 2012 17:22:07 +0000
Simon MacMullen <simon at rabbitmq.com> wrote:

> The erl_crash.dump is not terribly useful I'm afraid.
> 
> How much memory did the machine have?
> 
> What was the high watermark set to?
> 
> Can we see the logs?
> 
> Cheers, Simon
> 
> On 21/03/12 17:14, Andrei Vereha wrote:
> > Hello ,
> >
> > A few hours ago our Rabbitmq server crashed with message:
> >
> > =erl_crash_dump:0.1
> > Wed Mar 21 13:05:19 2012
> > Slogan: eheap_alloc: Cannot allocate 1824525600 bytes of memory (of
> > type "heap").
> > System version: Erlang R14B02 (erts-5.8.3) [source]
> > [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]
> > Compiled: Fri May  6 16:15:00 2011 Taints:
> >
> > I uploaded the compressed erl_crash.dump file here(uncompressed it
> > takes 1.5GB):
> >
> > http://dl.transfer.ro/dump-transfer_RO-21mar-9ef325.7z
> >
> > When this happened vm_memory_high_watermark was not 'activated':
> > grep vm_memory_high_watermark rabbit at rabbitmq-01.log ->  prints
> > nothing.
> >
> > Why did it crashed?
> >
> > Thank you,
> >    Andrei
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: memory.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/492db5d3/attachment.txt>

From steve at rabbitmq.com  Fri Mar 23 12:31:51 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 23 Mar 2012 12:31:51 +0000
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
Message-ID: <C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>

Thanks for the patch Jeff,

We are evaluating this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 21 Mar 2012, at 17:24, Jeff wrote:

> this is a very small patch to add exclusive-access support to a queue when accessed via the stomp adaptor.  It is enabled by using the "exclusive" header.
> 
> If you are using Net::Stomp your subscribe would look like 
> 
> $stomp->subscribe({ "destination" => "/amq/queue/test",
> 						"ack" => "auto", 
> 						"exclusive" => "true"
> 				 }));
> 
> 
> <rabbit-2.7.1-exclusive-stomp.diff>
> 
> --
> Jeff Trout <jeff at jefftrout.com>
> http://www.stuarthamm.net/
> http://www.dellsmartexitin.com/
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Fri Mar 23 12:34:12 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 23 Mar 2012 12:34:12 +0000
Subject: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'
In-Reply-To: <B8B68C3D41791846910BA4C7AF61D25B035913@ganymede.gebaschtel.bnet>
References: <B8B68C3D41791846910BA4C7AF61D25B034CFD@ganymede.gebaschtel.bnet>
	<2848820F-5EE8-47E3-B5C5-60DF11E8A3FB@rabbitmq.com>
	<B8B68C3D41791846910BA4C7AF61D25B035913@ganymede.gebaschtel.bnet>
Message-ID: <EFA29522-2F64-4056-8AF6-271B6455337A@rabbitmq.com>

Yes, it would.

The setsid fix has gone into the 2.8.1 release, but means we are using su.

If anyone has any advice about the correct use of startproc
we would be very grateful to receive it.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 22 Mar 2012, at 14:14, Josh Geisser wrote:

> Thanks for the fast response
> 
> Actually, removing the whole START_PROG works as workaround for us with the 2.8.0-1.suse.noarch.rpm
> 
> Thanks a lot
> Cheers
> Josh
> 
> -----Urspr?ngliche Nachricht-----
> Von: Steve Powell [mailto:steve at rabbitmq.com] 
> Gesendet: Dienstag, 20. M?rz 2012 13:24
> An: Josh Geisser
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Betreff: Re: [rabbitmq-discuss] SuSE: 2.8.0 start script uses 'runuser'
> 
> Dear Josh,
> 
> Thanks for telling us about this -- this is rather embarrassing. In
> attempting to get Linux server installations to start the rabbitmq-service
> without blocking shutdown, we used runuser for certain systems. Our
> mistake.
> 
> A workaround ought to be to replace runuser in the relevant script, as
> below:
> 
> On line 29 (or thereabouts) in the rabbitmq-server script in init.d
> there is a line like this:
> 
> START_PROG="runuser rabbitmq --session-command"
> 
> which you should replace with:
> 
> START_PROG="setsid"
> 
> This will cause the rabbitmq-server service to be started with 'su'. Be
> aware that this might inhibit shutdown (since su creates a PAM session
> for the user rabbitmq).
> 
> We'll update our SuSE rpm file, when we find a proper solution to this.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 20 Mar 2012, at 08:34, Josh Geisser wrote:
> 
>> Hi all
>> 
>> I just noticed that 'rabbitmq-server-2.8.0-1.suse.noarch.rpm' throws the following error when being started:
>> 
>> /etc/init.d/rabbitmq-server: line 60: runuser: command not found
>> 
>> The old 2.7.1 packaged rc-script was just fine
>> 
>> FYI & cheers
>> Josh
>> 
>> /etc/SuSE-release sais we're using
>> SUSE Linux Enterprise Server 11 (x86_64)
>> VERSION = 11
>> PATCHLEVEL = 1
>> -- 
>> ----
>> ASG at hnet
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> -- 
> ----
> ASG at hnet


From Massimo.Paladin at cern.ch  Fri Mar 23 13:30:17 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Fri, 23 Mar 2012 14:30:17 +0100
Subject: [rabbitmq-discuss] udp exchange and headers type
Message-ID: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>

Hello,

we are playing with the udp exchange and found some problem.

On the receiving side, both with pika and ruby amqp we were
having problems, for instance, with ruby:

/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/table.rb:88:in
`decode': NotImplementedError (NotImplementedError)
from
/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/client.rb:1482:in
`decode_properties'
 from
/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/client.rb:1465:in
`each'
from
/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/client.rb:1465:in
`decode_properties'
 from
/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/frame.rb:142:in
`decode_payload'
from
/Library/Ruby/Gems/1.8/gems/amq-protocol-0.9.0/lib/amq/protocol/frame.rb:115:in
`body_size'
 from
/Library/Ruby/Gems/1.8/gems/amq-client-0.9.2/lib/amq/client/async/adapter.rb:675:in
`content_complete?'
from
/Library/Ruby/Gems/1.8/gems/amq-client-0.9.2/lib/amq/client/async/adapter.rb:667:in
`frameset_complete?'
 from
/Library/Ruby/Gems/1.8/gems/amq-client-0.9.2/lib/amq/client/async/adapter.rb:518:in
`receive_frame'
from
/Library/Ruby/Gems/1.8/gems/amq-client-0.9.2/lib/amq/client/async/adapters/event_machine.rb:327:in
`receive_data'
 from
/Library/Ruby/Gems/1.8/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in
`run_machine'
from
/Library/Ruby/Gems/1.8/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in
`run'

with pika it gives a similar error on pika/data.py:128

The error obviously comes from the headers set by the udp plugin:
Headers = [{<<"source_ip">>, longstr, IpStr},
              {<<"source_port">>, short, Port}],

Changing it to signedint fixed the problem:
Headers = [{<<"source_ip">>, longstr, IpStr},
              {<<"source_port">>, signedint, Port}],

In the ruby client the type short int is explicitly rejected (
amq/protocol/table.rb:88)

Is this a problem in pika and amqp ruby clients or in the java one?

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/8b699954/attachment.htm>

From jccrespo at innova7.org  Fri Mar 23 14:23:14 2012
From: jccrespo at innova7.org (Juan Carlos Crespo)
Date: Fri, 23 Mar 2012 14:23:14 +0000
Subject: [rabbitmq-discuss] Rabbitmq and pika implementation.
In-Reply-To: <CAPTAU1AN9s4eb1SWbSr3utOLMxBNADhE4hyURU1+FGbANioVyw@mail.gmail.com>
References: <CAPTAU1AGrXPHhHKKduqddF+m3jZLDwZjxv0F35_+geLRjoaG0g@mail.gmail.com>
	<CAPTAU1AN9s4eb1SWbSr3utOLMxBNADhE4hyURU1+FGbANioVyw@mail.gmail.com>
Message-ID: <CAPTAU1Cfh4r0k-dy4xs5ph9CXvxhCxeQxy=-VsxGTY9QaQB2ww@mail.gmail.com>

Hello,


my name is Juan Carlos Crespo, I belong to a nonprofit association called
Innova7 (http://www.innova7.org/), we have been hosting an the most
important technology event at Canary Islands and one of the biggest in
Spain. Its name is Tenerife Lan Party.

We build our own applications, and we are thinking about building our own
RabbitMQ implementation. I've been reading the documentation and doing the
tutorials. We decided to use pika for communications but we came to a
problem:

What we want is to have a Main server, sending messages to a number of
nodes (probably 5 or 6) and then, each node will send the message to the
clients (around 250 clients per node).

The reason behind this is that our Main Server will have some load already,
this is why we want to have another server on the nodes dealing with the
clients.

Is there anyway to resend the message that you receive in a node? It would
be something like the figure attached to the e-mail.

Thanks in advance,

Juan Carlos Crespo.

--
Juan Carlos Crespo Llabr?s.
Integrante de Aplicaciones. Innova7.

Asociaci?n Innova7.
Centro de Desarrollo Tecnol?gico El Rosario.
Calle Cort?s, Centro Comercial El Paraiso. Local 6.
Radazul, El Rosario.
38109.
------------------------------------------------------------------

Este correo electr?nico est? dirigido exclusivamente al destinatario o
destinatarios especificados y la informaci?n contenida en ?l es
confidencial y privilegiada, siendo Ud.consciente del car?cter de la
misma. Si ha recibido este mensaje por error, por favor notif?queselo
inmediatamente al remitente por correo electr?nico y proceda a su
eliminaci?n de manera inmediata. Queda prohibido cualquier uso,
revisi?n, difusi?n, distribuci?n o copiado no autorizado de esta
informaci?n, que, si se produjera, constituir?a un incumplimiento de
la confidencialidad. Las opiniones, conclusiones e informaci?n
contenidas en este mensaje que no sean reconocidas oficialmente por la
Compa??a no vincular?n a la misma y se considerar?n como no
suministradas. Muchas gracias por su colaboraci?n.

This e-mail is intended only for its indicated address or addresses
and the information contained in it is confidential and privileged,
and you are on notice of its status.If you have received this e-mail
in error please notify immediately the sender by reply e-mail and
delete it immediately. Any use, review, dissemination, distribution or
copying non authorized of this e mail is prohibited, to do so could be
a breach of confidence. The opinions, conclusions and information in
this message that have not been officially assumed by the Company will
not be binding to it, and will be understood as neither given.Thank
you for your co-operation.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/f32f2a4c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: esquema.jpg
Type: image/jpeg
Size: 20071 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/f32f2a4c/attachment.jpg>

From simon at rabbitmq.com  Fri Mar 23 14:27:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Mar 2012 14:27:22 +0000
Subject: [rabbitmq-discuss] Rabbitmq and pika implementation.
In-Reply-To: <CAPTAU1Cfh4r0k-dy4xs5ph9CXvxhCxeQxy=-VsxGTY9QaQB2ww@mail.gmail.com>
References: <CAPTAU1AGrXPHhHKKduqddF+m3jZLDwZjxv0F35_+geLRjoaG0g@mail.gmail.com>	<CAPTAU1AN9s4eb1SWbSr3utOLMxBNADhE4hyURU1+FGbANioVyw@mail.gmail.com>
	<CAPTAU1Cfh4r0k-dy4xs5ph9CXvxhCxeQxy=-VsxGTY9QaQB2ww@mail.gmail.com>
Message-ID: <4F6C884A.1000109@rabbitmq.com>

On 23/03/12 14:23, Juan Carlos Crespo wrote:
> Is there anyway to resend the message that you receive in a node? It
> would be something like the figure attached to the e-mail.

Hi Juan.

Check out the federation plugin: http://www.rabbitmq.com/federation.html 
and in particular http://www.rabbitmq.com/federation.html#topology-diagrams.

You may also want to look at the shovel plugin: 
http://hg.rabbitmq.com/rabbitmq-shovel/file/rabbitmq_v2_8_1/README

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jonathan.gaillard at dominionenterprises.com  Fri Mar 23 14:25:37 2012
From: jonathan.gaillard at dominionenterprises.com (gaillard)
Date: Fri, 23 Mar 2012 14:25:37 +0000 (UTC)
Subject: [rabbitmq-discuss] atomic transactions
References: <33544596.post@talk.nabble.com> <4F6C55FA.5090007@rabbitmq.com>
Message-ID: <loom.20120323T151810-129@post.gmane.org>

Emile Joubert <emile at ...> writes:

> 
> Hi,
> 
> On 22/03/12 03:39, gaillard wrote:
> > I have need to use transactions in the following way:
> > -get a message (m1) from queue A
> > -transforms the message and create new message (m2)
> > -publish m2 to queue B
> > -ack m1
> > -commit the transaction (includes ack and publish)
> > 
> > Which i believe in all failure scenarios should result in possibly two
> > things:
> > m1 on queue A, nothing on queue B
> > m2 on queue B, nothing on queue A
> > 
> > Is this what will happen in rabbit 2.7 or 2.8?
> 
> Mostly yes, but bear in mind that transactions are not atomic in
> RabbitMQ. So if the broker crashes or an error occurs during commit then
> your invariant might not hold. If you are dealing with very high value
> messages then you should add additional logging and correlate the input
> and output.
> 
> This page has more information about transaction semantics:
> http://www.rabbitmq.com/semantics.html
> 
> -Emile
> 
> 

Well i have done some testing with different failure cases now..
As far as I can tell if the broker stays up, and clients are the ones that fail, 
the transactions are adhered to atomically. But if I kill the broker its not 
hard to get messages where they shouldnt be.

I dont have need for persistent messages so I think i am safe with relying on 
the atomicity since on broker death the messages are gone anyways. Is this not 
the case?

Any idea when fully atomic transactions will be put in rabbit? It is a common 
feature on jms and qpid etc..

Also, would you mind elaborating on how you would correlate in the publishing 
back to the same queue where you dont want multiple copies on that queue? The 
best I can come up with is just erroring if you receive the redelivered. But 
redeliveries are ok with the transaction route since you will never get the 
multiple copies. I see no substitute for transactions.

Thanks for the help !


From holger.hoffstaette at googlemail.com  Fri Mar 23 14:23:56 2012
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Fri, 23 Mar 2012 15:23:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ installation vs. ERL_LIB
References: <pan.2012.03.22.13.43.35.158250@googlemail.com>
	<4F6B2EF2.2060202@rabbitmq.com>
Message-ID: <pan.2012.03.23.14.23.56.860250@googlemail.com>

On Thu, 22 Mar 2012 13:53:54 +0000, Simon MacMullen wrote:

> On 22/03/12 13:43, Holger Hoffstaette wrote:
>> Long term it
>> would be much better to move the package out of the shared lib dir.
> 
> Or short term even.

:)

> I don't know anything about the Gentoo packaging for RabbitMQ, but
> installing it into /usr/lib/erlang/lib is definitely bad and wrong, for
> precisely this reason.

My guess is that this is a leftover from previous versions; I'm not the
maintainer, just trying to help out. Any suggestions for a better, more
common ebin/plugin location? /usr/lib/rabbitmq/ maybe?

Thanks
Holger



From tonygarnockjones at gmail.com  Fri Mar 23 15:26:35 2012
From: tonygarnockjones at gmail.com (Tony Garnock-Jones)
Date: Fri, 23 Mar 2012 11:26:35 -0400
Subject: [rabbitmq-discuss] Failed to add an exchange via the web
	interface
In-Reply-To: <4F6C5414.4030701@rabbitmq.com>
References: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F6C5414.4030701@rabbitmq.com>
Message-ID: <CAM8fPiQpKW_VmYGtA_cv-bWM4MXbWwT9L0L-AXDw58zegqCnDw@mail.gmail.com>

On 23 March 2012 06:44, Simon MacMullen <simon at rabbitmq.com> wrote:

> The way we handle this in Rabbit proper is to allow any number type for a
> number, any string type for a string. This also reduces hassle for people
> declaring things over AMQP. Tony - is there a reason not to do this?
>

That's the way the code already was. However, it was confusing two cases: a
missing "port" argument, and a "port" argument of non-numeric type. I've
just pushed a tweak to the error reporting that'll distinguish the two.

Lionel, please have another try with current master.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/6a042fa8/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Fri Mar 23 15:29:41 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 23 Mar 2012 11:29:41 -0400
Subject: [rabbitmq-discuss] udp exchange and headers type
In-Reply-To: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
References: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
Message-ID: <CAM8fPiT_W-tb4rg8_vJpnVpke4-c2Jmo0ConqQQafB_=QyZZQg@mail.gmail.com>

On 23 March 2012 09:30, Massimo Paladin <Massimo.Paladin at cern.ch> wrote:

> Changing it to signedint fixed the problem:
> Headers = [{<<"source_ip">>, longstr, IpStr},
>               {<<"source_port">>, signedint, Port}],
> [...]
> Is this a problem in pika and amqp ruby clients or in the java one?


It's more a problem with the AMQP specs. I've just updated master to use
signedint, as you suggest. Thanks for the report! Please try it again with
current master and let us know how it goes.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/04e9508a/attachment.htm>

From emile at rabbitmq.com  Fri Mar 23 16:23:36 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 23 Mar 2012 16:23:36 +0000
Subject: [rabbitmq-discuss] atomic transactions
In-Reply-To: <loom.20120323T151810-129@post.gmane.org>
References: <33544596.post@talk.nabble.com> <4F6C55FA.5090007@rabbitmq.com>
	<loom.20120323T151810-129@post.gmane.org>
Message-ID: <4F6CA388.5010200@rabbitmq.com>

Hi,

On 23/03/12 14:25, gaillard wrote:
> I dont have need for persistent messages so I think i am safe with relying on 
> the atomicity since on broker death the messages are gone anyways. Is this not 
> the case?

Just to be clear, the transactions in RabbitMQ are not atomic. Your
tests might not be able to distinguish batched operations from truly
atomic operations.

> Any idea when fully atomic transactions will be put in rabbit? It is a common 
> feature on jms and qpid etc..

This is unlikely to happen soon.

> Also, would you mind elaborating on how you would correlate in the publishing 
> back to the same queue where you dont want multiple copies on that queue? The 
> best I can come up with is just erroring if you receive the redelivered. But 
> redeliveries are ok with the transaction route since you will never get the 
> multiple copies. I see no substitute for transactions.

By comparing the messages (preferably containing a correlation id)
entering the broker with messages leaving the broker you can determine
whether messages were duplicated.


-Emile


From jonathan.gaillard at dominionenterprises.com  Fri Mar 23 17:02:25 2012
From: jonathan.gaillard at dominionenterprises.com (Jonathan Gaillard)
Date: Fri, 23 Mar 2012 13:02:25 -0400
Subject: [rabbitmq-discuss] atomic transactions
In-Reply-To: <4F6CA388.5010200@rabbitmq.com>
References: <33544596.post@talk.nabble.com> <4F6C55FA.5090007@rabbitmq.com>
	<loom.20120323T151810-129@post.gmane.org>
	<4F6CA388.5010200@rabbitmq.com>
Message-ID: <CAEQPmdYvQVf9OO3Tf3mnhJjn89LtvZ9rvBqk4ScZ+5dmXfEA8g@mail.gmail.com>

Hello again,

> Just to be clear, the transactions in RabbitMQ are not atomic. Your
> tests might not be able to distinguish batched operations from truly
> atomic operations.

I am clear on this (however I wasn't before :)) But I still have a
question; if the broker never goes down, and the client is in the middle of
a transaction commit, will the broker handle it correctly? It appears to.

I will try and transfer things over to confirms, however when i detect a
duplicate I cannot know whether it has a copy on the queue or not (in the
requeue senario) so all I can do is fail.. any ideas? this is where
transactions could really help.. come on rabbit ! :)

Thanks again
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/a249e335/attachment.htm>

From mss at mawhrin.net  Fri Mar 23 18:34:19 2012
From: mss at mawhrin.net (Mikhail Sobolev)
Date: Fri, 23 Mar 2012 21:34:19 +0300
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F6C5483.9010209@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
Message-ID: <20120323183418.GA1409@mawhrin.net>

Hi Simon,

On Fri, Mar 23, 2012 at 10:46:27AM +0000, Simon MacMullen wrote:
> On 22/03/12 19:10, Mikhail Sobolev wrote:
> >We use rabbitmq for message exchange in the internal system.  What we'd
> >like to do is to make it possible for "external" users to subscribe to
> >some of the messages.
> >
> >Could you please advise how to do that?:)
> 
> It's not very clear what you're asking here.
I have realized that after having re-read the origin message :)  Thanks
for pointing that out.  Let me try again.

We have a system that publishes messages about "interesting" events to a
topic exchange (let's say 'happenings').

We'd like interested parties (= "external users") to:
    * be able to create a transient queue that is bound to this exchange
    * not be able to do anything else (create exchanges, create durable
      queues, publish messages)

Is it possible to use permissions system to limit a given login (since
we'd like them to use a common username/password) in such a way?

--
Misha

From dawgtool at aol.com  Fri Mar 23 20:03:14 2012
From: dawgtool at aol.com (DawgTool)
Date: Fri, 23 Mar 2012 16:03:14 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
Message-ID: <4F6CD702.4050908@aol.com>

Hi All,

Wondering is anyone having issues with the Per-Connection Flow Control 
in 2.8.1?
Under 2.7.1 was able to push about 4.5MB/s per connection (about 
~7000msg/s).
Under 2.8.1 I am hitting the flow control constantly at about 2.4MB/s 
per connection.
Clean installed 2.8.1 on the same hardware as 2.7.1.

Is there someway to configure/monitor what is causing the Flow Control 
to be tripped?

Thanks in Advance.



Config: (both 2.7.1/2.8.1)
Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:30] 
[hipe] [kernel-poll:true]

==> enabled_plugins <==
[rabbitmq_management,rabbitmq_management_agent].

==> rabbitmq.config <==
[
   {rabbit,                    [{vm_memory_high_watermark, 0.6},
                                {collect_statistics_interval, 5000},
                                {hipe_compile, true}
                               ]
   },
   {mnesia,                    [{dc_dump_limit, 40},
                                {dump_log_write_threshold, 50000},
                                {no_table_loaders, 20},
                                {send_compressed, 9},
                                {snmp, true}
                               ]
   },
   {rabbitmq_management,       [ {http_log_dir, 
"/data/rabbitmq/dc001/rabbit-mgmt"} ] },
   {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
].

==> rabbitmq-env.conf <==
NODENAME=dc001
BASE=/data/rabbitmq/dc001
MNESIA_BASE=/data/rabbitmq/dc001/mnesia
LOG_BASE=/data/rabbitmq/dc001/log
SERVER_START_ARGS="+K true -smp enable"





From james.poole at rsa.com  Fri Mar 23 20:28:20 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Fri, 23 Mar 2012 16:28:20 -0400
Subject: [rabbitmq-discuss] Enable Plugins via Config
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>

Does anyone know a way to enable plugins without running the batch file on
Windows platforms?  What I was hoping for was a way to enable the STOMP
plugin by setting some value in "rabbitmq.config" rather than having to run
a batch file.  This would allow us to distribute it pre-configured.

 

I didn't see anything about this on the plugin related web pages.  They all
refer to running the batch files.

 

Any thoughts?

 

Thanks,

James

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/05982120/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/05982120/attachment.bin>

From pbell at syncsort.com  Fri Mar 23 21:02:45 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 23 Mar 2012 17:02:45 -0400
Subject: [rabbitmq-discuss] Support for CentOS
In-Reply-To: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
References: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B416958E1@MAILCCR.us.syncsort.com>

All,

I just opened the README for Erlang 15B.

I was slightly terrified to see therein no mention of either CentOS or RedHat as supported platforms. I then checked the www.erlang.se<http://www.erlang.se> site and my fears were not allayed. The erlang.org site does mention support for "Linux" but does not further qualify it.

So, with an eye to having a relaxed weekend, I put these questions:


1.       Are there open source versions of RabbitMQ and Erlang that will run on a 64-bit CentOS (or RedHat) machine?

2.       Are they binary distributions, or will we have to build them?

Please let me know!

Thanks very much.

-Paul

PS: I have indeed seen references on the Web to folks installing both on RedHat, e.g., http://helenaedelson.com/?p=571

________________________________


ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120323/c30592b5/attachment.htm>

From jerryk at vmware.com  Sat Mar 24 00:38:43 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 23 Mar 2012 17:38:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Enable Plugins via Config
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>
Message-ID: <3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>

Hi, James.

No you're pretty much stuck with the batch-file driven restart (and on Windows 
even a "reinstall" of the Windows service).

Best regards,
Jerry


----- Original Message -----
From: "james poole" <james.poole at rsa.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, March 23, 2012 1:28:20 PM
Subject: [rabbitmq-discuss] Enable Plugins via Config





Does anyone know a way to enable plugins without running the batch file on Windows platforms? What I was hoping for was a way to enable the STOMP plugin by setting some value in ?rabbitmq.config? rather than having to run a batch file. This would allow us to distribute it pre-configured. 



I didn?t see anything about this on the plugin related web pages. They all refer to running the batch files. 



Any thoughts? 



Thanks, 

James 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Sat Mar 24 06:26:14 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 24 Mar 2012 07:26:14 +0100
Subject: [rabbitmq-discuss] Enable Plugins via Config
In-Reply-To: <3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>
	<3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>
Message-ID: <CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>

Jerry, I'm pretty sure that editing the enabled_plugins file works just
fine. I've been doing that to prepare packages ready to be deployed and it
just works.
On Mar 24, 2012 1:39 AM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> Hi, James.
>
> No you're pretty much stuck with the batch-file driven restart (and on
> Windows
> even a "reinstall" of the Windows service).
>
> Best regards,
> Jerry
>
>
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, March 23, 2012 1:28:20 PM
> Subject: [rabbitmq-discuss] Enable Plugins via Config
>
>
>
>
>
> Does anyone know a way to enable plugins without running the batch file on
> Windows platforms? What I was hoping for was a way to enable the STOMP
> plugin by setting some value in ?rabbitmq.config? rather than having to run
> a batch file. This would allow us to distribute it pre-configured.
>
>
>
> I didn?t see anything about this on the plugin related web pages. They all
> refer to running the batch files.
>
>
>
> Any thoughts?
>
>
>
> Thanks,
>
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120324/7cb25ebd/attachment.htm>

From alexis at rabbitmq.com  Sat Mar 24 06:55:59 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 24 Mar 2012 06:55:59 +0000
Subject: [rabbitmq-discuss] Support for CentOS
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B416958E1@MAILCCR.us.syncsort.com>
References: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B416958E1@MAILCCR.us.syncsort.com>
Message-ID: <CACOPnvenU8uUUGn3gQnPtf9fiLn_LzXCVJB0ZThDKxcRGneWuw@mail.gmail.com>

Paul,

Let me try to help

Though, please note that suggested improvement to erlang.org should be
cross-posted to erlang-questions ;-)

YES; indeed lots of people use Rabbit with CentOS, Fedora, and of course RHEL.

If erlang.org's approach is not to your liking, another trusted
distribution point is Erlang Solutions.  They are "the" third party
commercial support provider for Erlang.  They provide distributions
too.  You can get 32 bit and 64 bit bundles for CentOS, Debian,
Fedora, MacOSX, OpenSUSE, Ubuntu, Windows and "Linux", all from here:
http://www.erlang-solutions.com/section/132/download-erlang-otp

I assume you have also seen our RPMs page here:
http://www.rabbitmq.com/install-rpm.html   Note that provides a RHEL
option using EPEL.  A general issue with RHEL, for any software, can
be that you need access to many dependencies; some corporate firewalls
block this.  A complete, hardened, RHEL binary could be created; we
don't provide one currently.

I can also tell you that older Windows, Gentoo, Solaris, OpenSolaris,
AIX, OpenVMS, and I think HP-UX are all doable and in most of these
cases you will find help for each on this list.

alexis



On Fri, Mar 23, 2012 at 9:02 PM, Bell, Paul M. <pbell at syncsort.com> wrote:
> All,
>
>
>
> I just opened the README for Erlang 15B.
>
>
>
> I was slightly terrified to see therein no mention of either CentOS or
> RedHat as supported platforms. I then checked the www.erlang.se site and my
> fears were not allayed. The erlang.org site does mention support for ?Linux?
> but does not further qualify it.
>
>
>
> So, with an eye to having a relaxed weekend, I put these questions:
>
>
>
> 1.?????? Are there open source versions of RabbitMQ and Erlang that will run
> on a 64-bit CentOS (or RedHat) machine?
>
> 2.?????? Are they binary distributions, or will we have to build them?
>
>
>
> Please let me know!
>
>
>
> Thanks very much.
>
>
>
> -Paul
>
>
>
> PS: I have indeed seen references on the Web to folks installing both on
> RedHat, e.g., http://helenaedelson.com/?p=571
>
>
> ________________________________
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
> confidential and/or legally privileged information. Any pricing information
> contained in this message or in any files transmitted with this message is
> always confidential and cannot be shared with any third parties without
> prior written approval from Syncsort. This message is intended to be read
> only by the individual or entity to whom it is addressed or by their
> designee. If the reader of this message is not the intended recipient, you
> are on notice that any use, disclosure, copying or distribution of this
> message, in any form, is strictly prohibited. If you have received this
> message in error, please immediately notify the sender and/or Syncsort and
> destroy all copies of this message in your possession, custody or control.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simone.busoli at gmail.com  Sat Mar 24 13:59:10 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 24 Mar 2012 14:59:10 +0100
Subject: [rabbitmq-discuss] [ann] ManagedShovel
Message-ID: <CAOn7oW93pfQYjKOVCS7yLpiYWu2A+E+Jcgy_URydLMEkpEtkUg@mail.gmail.com>

Hi, I'm glad to announce the availability of ManagedShovel, an external
mechanism to replace the built-in shovel addin.

Its purpose is to provide the same features of the official addin and add
some more. Currently the only additional feature is a max hops option,
which helps prevent messages from going in loops indefinitely.
The project uses the .NET client library to connect to RabbitMQ brokers and
can be configured using a fluent interface, which makes it easy to host it
anywhere from a console application to a windows service.
With the project comes a demo application which shows how to configure it,
although all the configuration options are semantically equivalent to those
of the original addin.

The source code is hosted on github at this
page<https://github.com/simoneb/ManagedShovel>.
Please be aware that this is pre-release software, and has not been tested
in production.

Any feedback and issue reports are welcome.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120324/952ca4a5/attachment.htm>

From jerryk at vmware.com  Sat Mar 24 17:42:27 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Sat, 24 Mar 2012 10:42:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Enable Plugins via Config
In-Reply-To: <CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>
	<3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>
	<CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
Message-ID: <05D3EF25-0240-4E0C-9516-95CC683C48F0@vmware.com>

Simone:  you might be right. Apologies if I was wrong. It's been a...  week. 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Mar 23, 2012, at 11:26 PM, Simone Busoli <simone.busoli at gmail.com> wrote:

> Jerry, I'm pretty sure that editing the enabled_plugins file works just fine. I've been doing that to prepare packages ready to be deployed and it just works.
> 
> On Mar 24, 2012 1:39 AM, "Jerry Kuch" <jerryk at vmware.com> wrote:
> Hi, James.
> 
> No you're pretty much stuck with the batch-file driven restart (and on Windows
> even a "reinstall" of the Windows service).
> 
> Best regards,
> Jerry
> 
> 
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, March 23, 2012 1:28:20 PM
> Subject: [rabbitmq-discuss] Enable Plugins via Config
> 
> 
> 
> 
> 
> Does anyone know a way to enable plugins without running the batch file on Windows platforms? What I was hoping for was a way to enable the STOMP plugin by setting some value in ?rabbitmq.config? rather than having to run a batch file. This would allow us to distribute it pre-configured.
> 
> 
> 
> I didn?t see anything about this on the plugin related web pages. They all refer to running the batch files.
> 
> 
> 
> Any thoughts?
> 
> 
> 
> Thanks,
> 
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120324/e40c9bc7/attachment.htm>

From pbell at syncsort.com  Sat Mar 24 22:01:33 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 24 Mar 2012 18:01:33 -0400
Subject: [rabbitmq-discuss] Support for CentOS
In-Reply-To: <CACOPnvenU8uUUGn3gQnPtf9fiLn_LzXCVJB0ZThDKxcRGneWuw@mail.gmail.com>
References: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com><AF4AD4ADFB23054CB4C75F50FF8C40B73B416958E1@MAILC
	CR.us.syncsort.com>
	<CACOPnvenU8uUUGn3gQnPtf9fiLn_LzXCVJB0ZThDKxcRGneWuw@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695900@MAILCCR.us.syncsort.com>

Alexis,

Thank you for your help.

Sorry for not cross-posting as you indicated. Truth be told, I did not know about the erlang-questions list.

I had, in fact, read the RPM page to which you refer. I came away thinking that the EPEL package for Erlang still(?) contains a relatively old version thereof. Can you clarify the status of this package, e.g., is it possible to get an EPEL with 15B?

Finally, I happened upon the "Erlang Solutions" website and late Friday sent them an e-mail asking about what it would cost to get a CentOS 6.2 compatible Erlang binary. But, looking now more closely at this site, it seems that the packages they make available are free. Bug fixes and general support will incur costs.

Am I right to think that, for CentOS, I should be looking at this part of the download page:

    RPM-based Linux distributions
    RPM packages are signed. To add Erlang Solutions key to execute command:

    # rpm --import http://binaries.erlang-solutions.com/debian/erlang_solutions.ascUsers of Fedora can add this file to /etc/yum.repos.d/

    Users of Centos can add this file to /etc/yum.repos.d/ (RPM Forge must be also added to repos)

Again, thanks.

-Paul


-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
Sent: Saturday, March 24, 2012 2:56 AM
To: Bell, Paul M.
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Support for CentOS

Paul,

Let me try to help

Though, please note that suggested improvement to erlang.org should be
cross-posted to erlang-questions ;-)

YES; indeed lots of people use Rabbit with CentOS, Fedora, and of course RHEL.

If erlang.org's approach is not to your liking, another trusted
distribution point is Erlang Solutions.  They are "the" third party
commercial support provider for Erlang.  They provide distributions
too.  You can get 32 bit and 64 bit bundles for CentOS, Debian,
Fedora, MacOSX, OpenSUSE, Ubuntu, Windows and "Linux", all from here:
http://www.erlang-solutions.com/section/132/download-erlang-otp

I assume you have also seen our RPMs page here:
http://www.rabbitmq.com/install-rpm.html   Note that provides a RHEL
option using EPEL.  A general issue with RHEL, for any software, can
be that you need access to many dependencies; some corporate firewalls
block this.  A complete, hardened, RHEL binary could be created; we
don't provide one currently.

I can also tell you that older Windows, Gentoo, Solaris, OpenSolaris,
AIX, OpenVMS, and I think HP-UX are all doable and in most of these
cases you will find help for each on this list.

alexis



On Fri, Mar 23, 2012 at 9:02 PM, Bell, Paul M. <pbell at syncsort.com> wrote:
> All,
>
>
>
> I just opened the README for Erlang 15B.
>
>
>
> I was slightly terrified to see therein no mention of either CentOS or
> RedHat as supported platforms. I then checked the www.erlang.se site and my
> fears were not allayed. The erlang.org site does mention support for "Linux"
> but does not further qualify it.
>
>
>
> So, with an eye to having a relaxed weekend, I put these questions:
>
>
>
> 1.       Are there open source versions of RabbitMQ and Erlang that will run
> on a 64-bit CentOS (or RedHat) machine?
>
> 2.       Are they binary distributions, or will we have to build them?
>
>
>
> Please let me know!
>
>
>
> Thanks very much.
>
>
>
> -Paul
>
>
>
> PS: I have indeed seen references on the Web to folks installing both on
> RedHat, e.g., http://helenaedelson.com/?p=571
>
>
> ________________________________
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted
> with this message) may contain proprietary, trade secret or other
> confidential and/or legally privileged information. Any pricing information
> contained in this message or in any files transmitted with this message is
> always confidential and cannot be shared with any third parties without
> prior written approval from Syncsort. This message is intended to be read
> only by the individual or entity to whom it is addressed or by their
> designee. If the reader of this message is not the intended recipient, you
> are on notice that any use, disclosure, copying or distribution of this
> message, in any form, is strictly prohibited. If you have received this
> message in error, please immediately notify the sender and/or Syncsort and
> destroy all copies of this message in your possession, custody or control.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From alexis at rabbitmq.com  Sun Mar 25 18:38:28 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 25 Mar 2012 18:38:28 +0100
Subject: [rabbitmq-discuss] Support for CentOS
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695900@MAILCCR.us.syncsort.com>
References: <CAMOXM28nuk8cbNiL0Vpm9ftyTbY-+fmZnuGPsEdmLdAXxmvWQQ@mail.gmail.com>
	<CACOPnvenU8uUUGn3gQnPtf9fiLn_LzXCVJB0ZThDKxcRGneWuw@mail.gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695900@MAILCCR.us.syncsort.com>
Message-ID: <CACOPnvc7q62+dJs-8ndiYiy5am+4NKx6r-DXP65OVEQ3e8Fkdg@mail.gmail.com>

Paul

AFAIK the EPEL repo is out of date and you need to follow the steps on
the downloads page to make sure your install is up to date.  Have you
tried this?

Re the ES site, for CentOS you should be able to select a bundle using
the drop-down menu thing in the middle of the page.

alexis



On Sat, Mar 24, 2012 at 10:01 PM, Bell, Paul M. <pbell at syncsort.com> wrote:
> Alexis,
>
> Thank you for your help.
>
> Sorry for not cross-posting as you indicated. Truth be told, I did not know about the erlang-questions list.
>
> I had, in fact, read the RPM page to which you refer. I came away thinking that the EPEL package for Erlang still(?) contains a relatively old version thereof. Can you clarify the status of this package, e.g., is it possible to get an EPEL with 15B?
>
> Finally, I happened upon the "Erlang Solutions" website and late Friday sent them an e-mail asking about what it would cost to get a CentOS 6.2 compatible Erlang binary. But, looking now more closely at this site, it seems that the packages they make available are free. Bug fixes and general support will incur costs.
>
> Am I right to think that, for CentOS, I should be looking at this part of the download page:
>
> ? ?RPM-based Linux distributions
> ? ?RPM packages are signed. To add Erlang Solutions key to execute command:
>
> ? ?# rpm --import http://binaries.erlang-solutions.com/debian/erlang_solutions.ascUsers of Fedora can add this file to /etc/yum.repos.d/
>
> ? ?Users of Centos can add this file to /etc/yum.repos.d/ (RPM Forge must be also added to repos)
>
> Again, thanks.
>
> -Paul
>
>
> -----Original Message-----
> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
> Sent: Saturday, March 24, 2012 2:56 AM
> To: Bell, Paul M.
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Support for CentOS
>
> Paul,
>
> Let me try to help
>
> Though, please note that suggested improvement to erlang.org should be
> cross-posted to erlang-questions ;-)
>
> YES; indeed lots of people use Rabbit with CentOS, Fedora, and of course RHEL.
>
> If erlang.org's approach is not to your liking, another trusted
> distribution point is Erlang Solutions. ?They are "the" third party
> commercial support provider for Erlang. ?They provide distributions
> too. ?You can get 32 bit and 64 bit bundles for CentOS, Debian,
> Fedora, MacOSX, OpenSUSE, Ubuntu, Windows and "Linux", all from here:
> http://www.erlang-solutions.com/section/132/download-erlang-otp
>
> I assume you have also seen our RPMs page here:
> http://www.rabbitmq.com/install-rpm.html ? Note that provides a RHEL
> option using EPEL. ?A general issue with RHEL, for any software, can
> be that you need access to many dependencies; some corporate firewalls
> block this. ?A complete, hardened, RHEL binary could be created; we
> don't provide one currently.
>
> I can also tell you that older Windows, Gentoo, Solaris, OpenSolaris,
> AIX, OpenVMS, and I think HP-UX are all doable and in most of these
> cases you will find help for each on this list.
>
> alexis
>
>
>
> On Fri, Mar 23, 2012 at 9:02 PM, Bell, Paul M. <pbell at syncsort.com> wrote:
>> All,
>>
>>
>>
>> I just opened the README for Erlang 15B.
>>
>>
>>
>> I was slightly terrified to see therein no mention of either CentOS or
>> RedHat as supported platforms. I then checked the www.erlang.se site and my
>> fears were not allayed. The erlang.org site does mention support for "Linux"
>> but does not further qualify it.
>>
>>
>>
>> So, with an eye to having a relaxed weekend, I put these questions:
>>
>>
>>
>> 1. ? ? ? Are there open source versions of RabbitMQ and Erlang that will run
>> on a 64-bit CentOS (or RedHat) machine?
>>
>> 2. ? ? ? Are they binary distributions, or will we have to build them?
>>
>>
>>
>> Please let me know!
>>
>>
>>
>> Thanks very much.
>>
>>
>>
>> -Paul
>>
>>
>>
>> PS: I have indeed seen references on the Web to folks installing both on
>> RedHat, e.g., http://helenaedelson.com/?p=571
>>
>>
>> ________________________________
>>
>>
>> ATTENTION: -----
>>
>> The information contained in this message (including any files transmitted
>> with this message) may contain proprietary, trade secret or other
>> confidential and/or legally privileged information. Any pricing information
>> contained in this message or in any files transmitted with this message is
>> always confidential and cannot be shared with any third parties without
>> prior written approval from Syncsort. This message is intended to be read
>> only by the individual or entity to whom it is addressed or by their
>> designee. If the reader of this message is not the intended recipient, you
>> are on notice that any use, disclosure, copying or distribution of this
>> message, in any form, is strictly prohibited. If you have received this
>> message in error, please immediately notify the sender and/or Syncsort and
>> destroy all copies of this message in your possession, custody or control.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> ATTENTION: -----
>
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other ?confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From alexis at rabbitmq.com  Sun Mar 25 19:59:45 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 25 Mar 2012 19:59:45 +0100
Subject: [rabbitmq-discuss] [ann] ManagedShovel
In-Reply-To: <CAOn7oW93pfQYjKOVCS7yLpiYWu2A+E+Jcgy_URydLMEkpEtkUg@mail.gmail.com>
References: <CAOn7oW93pfQYjKOVCS7yLpiYWu2A+E+Jcgy_URydLMEkpEtkUg@mail.gmail.com>
Message-ID: <CACOPnvcwVKbrb4Qi2V_ZRL=z3sVTXzirE0VLa--30CpgN+-gjQ@mail.gmail.com>

Cool!  Thank-you Simone.

alexis


On Sat, Mar 24, 2012 at 1:59 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
> Hi, I'm glad to announce the availability of ManagedShovel, an external
> mechanism to replace the built-in shovel addin.
>
> Its purpose is to provide the same features of the official addin and add
> some more. Currently the only additional feature is a max hops option, which
> helps prevent messages from going in loops indefinitely.
> The project uses the .NET client library to connect to RabbitMQ brokers and
> can be configured using a fluent interface, which makes it easy to host it
> anywhere from a console application to a windows service.
> With the project comes a demo application which shows how to configure it,
> although all the configuration options are semantically equivalent to those
> of the original addin.
>
> The source code is hosted on github at this page. Please be aware that this
> is pre-release software, and has not been tested in production.
>
> Any feedback and issue reports are welcome.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From lionel.cons at cern.ch  Mon Mar 26 06:41:43 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 26 Mar 2012 07:41:43 +0200
Subject: [rabbitmq-discuss] Failed to add an exchange via the web
	interface
In-Reply-To: <CAM8fPiQpKW_VmYGtA_cv-bWM4MXbWwT9L0L-AXDw58zegqCnDw@mail.gmail.com>
References: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F6C5414.4030701@rabbitmq.com>
	<CAM8fPiQpKW_VmYGtA_cv-bWM4MXbWwT9L0L-AXDw58zegqCnDw@mail.gmail.com>
Message-ID: <20336.407.362431.955583@mail.cern.ch>

Tony Garnock-Jones writes:
 > That's the way the code already was. However, it was confusing two cases: a
 > missing "port" argument, and a "port" argument of non-numeric type. I've
 > just pushed a tweak to the error reporting that'll distinguish the two.
 > 
 > Lionel, please have another try with current master.

This still does not work. With the new master, I get:

{error,
    {exit,
        {{badarg,
             [{io_lib,format,
                  ["Invalid 'port' argument to ~p exchange (wrong type)",
                   {resource,<<"rabbitmq">>,exchange,<<"test.udp">>}]},
              {rabbit_misc,format,2},
              {rabbit_misc,amqp_error,4},
              {rabbit_misc,protocol_error,4},
              {udp_exchange,endpoint_params,1},
              {udp_exchange,validate,1},
              {rabbit_exchange,declare,6},
              {rabbit_channel,handle_method,3}]},
         {gen_server,call,
             [<0.1258.0>,
              {call,
                  {'exchange.declare',0,<<"test.udp">>,<<"x-udp">>,false,
                      true,false,false,false,
                      [{<<"port">>,longstr,<<"12345">>}]},
                  none,<0.832.0>},
              infinity]}},
        [{gen_server,call,3},
         {rabbit_mgmt_util,'-amqp_request/5-fun-0-',4},
         {rabbit_mgmt_util,with_channel,5},
         {rabbit_mgmt_util,http_to_amqp,5},
         {webmachine_resource,resource_call,3},
         {webmachine_resource,do,3},
         {webmachine_decision_core,resource_call,1},
         {webmachine_decision_core,accept_helper,0}]}}

As you see, the web interface passed the port argument as "longstr",
which must be handled explicitly in endpoint_params I guess.

Cheers,

Lionel

From minaev at gmail.com  Mon Mar 26 06:45:45 2012
From: minaev at gmail.com (Dmitri Minaev)
Date: Mon, 26 Mar 2012 09:45:45 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4F59F976.4060807@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
	<4EFDDC6E.8060200@rabbitmq.com>
	<CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>
	<CANTUpDD+MSUSVCTDLtQpeTLsrHyrXv9TVm5a_c-=xCHbWisPrw@mail.gmail.com>
	<4F564161.5040601@rabbitmq.com>
	<CANTUpDBQVtYav2tEWqynEyhSKmvApo4Q1WjCArYB3T_TVLC9FA@mail.gmail.com>
	<4F577D3D.2020003@rabbitmq.com>
	<CANTUpDCYWUD_YxUaZGUz7VZzbWoGAUj72amAWYxVZdG=bhKEow@mail.gmail.com>
	<4F59F976.4060807@rabbitmq.com>
Message-ID: <CANTUpDDgWVbkXu+2ph9O7VcWCHdXyWXYDi3spEbL03LizdhW+Q@mail.gmail.com>

On 9 March 2012 16:37, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 09/03/12 07:57, Dmitri Minaev wrote:

>> If I understand correctly, the number of file descriptors used by
>> RabbitMQ in normal situation is roughly equal to the number of
>> `rabbitmqctl list_connections` + some constant (~30)? In case of that
>> hanging server, the number of AMQP connections never was close to the
>> FD limit (ulimit -n is 1024, fs.file-max = 1605698). The graph
>> reflecting ?the number of open AMQP connections is attached to this
>> message.
>
>
> It's not really a constant, but to a first approximation, yes.
>
> Ultimately, the error I saw being passed up from the OS was ENFILE - that's
> pretty unambiguous :)
>
> It's possible that if you're churning connections then "closed" connections
> in FIN_WAIT2 could account for the majority of the used FDs. In 2.8.0 we'll
> set SO_LINGER to 0 to prevent this.

I am still not sure about the role of the file descriptors in this
event. Last Friday, our Rabbit died again. Until the very last moment
the number of open file descriptors as reported by the management
plugin was 143 out of the total available number of 32765. It was
RabbitMQ v.2.7.0. On that same day I have upgraded to 2.8.1. Will
report on its behaviour later.

-- 
With best regards,
Dmitri Minaev

From simon at rabbitmq.com  Mon Mar 26 10:54:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 10:54:10 +0100
Subject: [rabbitmq-discuss] Enable Plugins via Config
In-Reply-To: <CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>	<3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>
	<CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
Message-ID: <4F703CC2.60102@rabbitmq.com>

On 24/03/12 06:26, Simone Busoli wrote:
> Jerry, I'm pretty sure that editing the enabled_plugins file works just
> fine. I've been doing that to prepare packages ready to be deployed and
> it just works.

Yes, this is what rabbitmq-plugins manipulates underneath.

Note that when running RabbitMQ as a Windows service, you will still 
need to reinstall the service after doing this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 26 11:25:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 11:25:08 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F6CD702.4050908@aol.com>
References: <4F6CD702.4050908@aol.com>
Message-ID: <4F704404.8080504@rabbitmq.com>

Hi.

There's no way to monitor what the flow control is doing.

I would assume that with 7k msg/s on 2.7.1 you see memory use steadily 
increasing? The flow control should just be preventing (significant 
numbers of) messages being queued up anywhere else than in queues. The 
idea is to ensure that whatever performance RabbitMQ is giving you is 
sustainable, rather than letting it absorb more messages in the short 
term at the cost of working itself into a hole that is difficult to get 
out of.

If you need the ability to absorb spikes in publishing rates then you 
can increase the size of TCP buffers on the server.

Cheers, Simon

On 23/03/12 20:03, DawgTool wrote:
> Hi All,
>
> Wondering is anyone having issues with the Per-Connection Flow Control
> in 2.8.1?
> Under 2.7.1 was able to push about 4.5MB/s per connection (about
> ~7000msg/s).
> Under 2.8.1 I am hitting the flow control constantly at about 2.4MB/s
> per connection.
> Clean installed 2.8.1 on the same hardware as 2.7.1.
>
> Is there someway to configure/monitor what is causing the Flow Control
> to be tripped?
>
> Thanks in Advance.
>
>
>
> Config: (both 2.7.1/2.8.1)
> Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:30]
> [hipe] [kernel-poll:true]
>
> ==> enabled_plugins <==
> [rabbitmq_management,rabbitmq_management_agent].
>
> ==> rabbitmq.config <==
> [
> {rabbit, [{vm_memory_high_watermark, 0.6},
> {collect_statistics_interval, 5000},
> {hipe_compile, true}
> ]
> },
> {mnesia, [{dc_dump_limit, 40},
> {dump_log_write_threshold, 50000},
> {no_table_loaders, 20},
> {send_compressed, 9},
> {snmp, true}
> ]
> },
> {rabbitmq_management, [ {http_log_dir,
> "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
> {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
> ].
>
> ==> rabbitmq-env.conf <==
> NODENAME=dc001
> BASE=/data/rabbitmq/dc001
> MNESIA_BASE=/data/rabbitmq/dc001/mnesia
> LOG_BASE=/data/rabbitmq/dc001/log
> SERVER_START_ARGS="+K true -smp enable"
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 26 11:33:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 11:33:08 +0100
Subject: [rabbitmq-discuss] Failed to add an exchange via the web
	interface
In-Reply-To: <20336.407.362431.955583@mail.cern.ch>
References: <20120323082759.a017.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4F6C5414.4030701@rabbitmq.com>	<CAM8fPiQpKW_VmYGtA_cv-bWM4MXbWwT9L0L-AXDw58zegqCnDw@mail.gmail.com>
	<20336.407.362431.955583@mail.cern.ch>
Message-ID: <4F7045E4.5030207@rabbitmq.com>

On 26/03/12 06:41, Lionel Cons wrote:
> As you see, the web interface passed the port argument as "longstr",
> which must be handled explicitly in endpoint_params I guess.

Bleh. I forgot that management has a magic list of integer-y arguments:

http://hg.rabbitmq.com/rabbitmq-management/file/4f9945a0c3fc/priv/www/js/global.js#l23

I was really determined to avoid having a type select in the UI. But I'm 
not sure that can be avoided. I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Mar 26 12:36:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 26 Mar 2012 12:36:47 +0100
Subject: [rabbitmq-discuss] atomic transactions
In-Reply-To: <CAEQPmdYvQVf9OO3Tf3mnhJjn89LtvZ9rvBqk4ScZ+5dmXfEA8g@mail.gmail.com>
References: <33544596.post@talk.nabble.com> <4F6C55FA.5090007@rabbitmq.com>
	<loom.20120323T151810-129@post.gmane.org>
	<4F6CA388.5010200@rabbitmq.com>
	<CAEQPmdYvQVf9OO3Tf3mnhJjn89LtvZ9rvBqk4ScZ+5dmXfEA8g@mail.gmail.com>
Message-ID: <4F7054CF.5020001@rabbitmq.com>

Hi Jonathan,

On 23/03/12 17:02, Jonathan Gaillard wrote:
> I am clear on this (however I wasn't before :)) But I still have a
> question; if the broker never goes down, and the client is in the middle
> of a transaction commit, will the broker handle it correctly? It appears to.


From a.pollock at encoded.co.uk  Mon Mar 26 13:11:34 2012
From: a.pollock at encoded.co.uk (Adam Pollock)
Date: Mon, 26 Mar 2012 13:11:34 +0100
Subject: [rabbitmq-discuss] Unclean shutdown followed by upgrade causes
 cluster to no longer come up.
Message-ID: <4F705CF6.3040408@encoded.co.uk>

Hi,

I have a cluster of three nodes which are auto-configured to be clustered.  The nodes are node1 at mq1, 
node2 at mq2 and node3 at mq3, which are a disc node and two RAM nodes respectively.  A few days ago in 
our test environment, something was powered off which caused all three machines with the nodes on to 
power off.  I decided (probably wrongly) that now was a good time to upgrade them to 2.8.1 (as there 
was a bug fix I was waiting for).  I've upgraded each node to 2.8.1, then attempted to start up the 
nodes.  Node1 started up correctly, but doesn't show any of the other nodes in the cluster status, 
even though the rabbitmq.conf file has them auto-configured.  Then, when I try to start up node2 and 
node3, they both give out the following message in /var/log/rabbit/startup_log:

[root at mq2 /etc/rabbitmq]# cat /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.1
* mochiweb-1.3-rmq2.8.1-git
* rabbitmq_management-2.8.1
* rabbitmq_management_agent-2.8.1
* rabbitmq_mochiweb-2.8.1
* webmachine-1.7.0-rmq2.8.1-hg

****
Cluster upgrade needed but this is a ram node.
Please first start the last disc node to shut down.
****

It seems like nothing I do (no combination of starting, stopping, resetting, etc) can make the 
cluster come back online.  My guess is that this has to do with the ungraceful shutdown of the disc 
node, but surely there must be a way to force it back into the cluster?

Here are the auto-configuration files from each node:

node1:
[{rabbit, [{cluster_nodes, ['node1 at mq1', 'node2 at mq2', 'node3 at mq3']}]}].

node2:
[{rabbit, [{cluster_nodes, ['node1 at mq1', 'node3 at mq3']}]}].

node3:
[{rabbit, [{cluster_nodes, ['node1 at mq1', 'node2 at mq2']}]}].

And here is the status and cluster status output of node1:

[root at mq1 /etc/rabbitmq]# rabbitmqctl status
Status of node node1 at mq1 ...
[{pid,2581},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
       {rabbit,"RabbitMQ","2.8.1"},
       {os_mon,"CPO  CXC 138 46","2.2.7"},
       {sasl,"SASL  CXC 138 11","2.1.10"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
       {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
       {inets,"INETS  CXC 138 49","5.7.1"},
       {mnesia,"MNESIA  CXC 138 12","4.5"},
       {stdlib,"ERTS  CXC 138 10","1.17.5"},
       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
  {memory,
      [{total,30333584},
       {processes,11865208},
       {processes_used,11854376},
       {system,18468376},
       {atom,1348801},
       {atom_used,1327436},
       {binary,145744},
       {code,14619638},
       {ets,1053712}]},
  {vm_memory_high_watermark,0.39999999922162066},
  {vm_memory_limit,205555302},
  {file_descriptors,
      [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
  {processes,[{limit,1048576},{used,167}]},
  {run_queue,0},
  {uptime,5}]
...done.
[root at mq1 /etc/rabbitmq]# rabbitmqctl cluster_status
Cluster status of node node1 at mq1 ...
[{nodes,[{disc,[node1 at mq1]}]},{running_nodes,[node1 at mq1]}]
...done.

OS is Centos release 6.2 (Final). Upgrade of rabbitmq was from 2.7.1 to 2.8.1.

-- 
Kind regards,

Adam Pollock.
Lead Software Engineer.

Encoded, Ltd.
T: +44 (0)845 120 9790
F: +44 (0)870 830 1945
E: a.pollock at encoded.co.uk
W: http://www.encoded.co.uk


From chen-hongqin at 163.com  Mon Mar 26 12:15:09 2012
From: chen-hongqin at 163.com (=?GBK?B?s8K66MfV?=)
Date: Mon, 26 Mar 2012 19:15:09 +0800 (CST)
Subject: [rabbitmq-discuss] |Spam| question about rabbitmq TPS
Message-ID: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>

hi, 
can you tell me why TPS is too high at first and sometimes maybe even more higher(maybe over 30000/s) when I send messages to rabbitmq cluster concurrently? thanks!
 
 
 
Some infos about this test:
1. all the messages are same and each message size is 1kb.
2. 300 queues created by multiple Producers at start and messages sent to the queues are random 
3. All messages are persistent and queues are all durable
4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the same host but different ports
the host info:
|

JAVA version

|

Java version "1.6.0_12" Java(TM) SE Runtime Environment (build 1.6.0_12-b04)

|
|

JAVA VM

|

Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)

|
|

CPU

|

Intel(R) Xeon(R) CPU E5504 @2.00GHz

|
|

number of cores

|

8

|
|

memory

|

33011192kb

|
|

Erlang VM

|

Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false]

|
|

RabbitMQ version

|

Release 2.7.1

|


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/18aee8ca/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2012-03-26_00-02-28.png
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/18aee8ca/attachment.png>

From tonygarnockjones at gmail.com  Mon Mar 26 13:42:33 2012
From: tonygarnockjones at gmail.com (Tony Garnock-Jones)
Date: Mon, 26 Mar 2012 08:42:33 -0400
Subject: [rabbitmq-discuss] Management console argument syntax (was Re:
 Failed to add an exchange via the web interface)
Message-ID: <CAM8fPiT6-T-VdhFk8GGd7SgtDmCRN77QZCnbRXi4uCJfsQhskw@mail.gmail.com>

On 26 March 2012 06:33, Simon MacMullen <simon at rabbitmq.com> wrote:

> I was really determined to avoid having a type select in the UI. But I'm
> not sure that can be avoided. I'll file a bug.
>


From simon at rabbitmq.com  Mon Mar 26 13:52:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 13:52:13 +0100
Subject: [rabbitmq-discuss] Unclean shutdown followed by upgrade causes
 cluster to no longer come up.
In-Reply-To: <4F705CF6.3040408@encoded.co.uk>
References: <4F705CF6.3040408@encoded.co.uk>
Message-ID: <4F70667D.3040304@rabbitmq.com>

On 26/03/12 13:11, Adam Pollock wrote:
> Hi,

Hi.

> Node1 started up correctly, but doesn't show any of the
> other nodes in the cluster status, even though the rabbitmq.conf file
> has them auto-configured.

This is normal in a cluster upgrade - the upgrade works by breaking the 
cluster on the first node to start, and then having other nodes rejoin.

Do you actually mean rabbitmq.conf? The file is usually called 
rabbitmq.config.

> Then, when I try to start up node2 and node3,
> they both give out the following message in /var/log/rabbit/startup_log:
>
> [root at mq2 /etc/rabbitmq]# cat /var/log/rabbitmq/startup_log
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.8.1
> * mochiweb-1.3-rmq2.8.1-git
> * rabbitmq_management-2.8.1
> * rabbitmq_management_agent-2.8.1
> * rabbitmq_mochiweb-2.8.1
> * webmachine-1.7.0-rmq2.8.1-hg
>
> ****
> Cluster upgrade needed but this is a ram node.
> Please first start the last disc node to shut down.
> ****

So this implies that they think no other cluster nodes are running.

Assuming the config file is really /etc/rabbitmq/rabbitmq.config, the 
only way I can think of for this to happen is if the cluster config file 
itself is corrupt / empty. What does 
/var/lib/rabbitmq/mnesia/cluster_nodes.config (I think that's the path) 
contain on the RAM nodes? It should contain the same list of nodes as 
are in rabbitmq.config.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon Mar 26 14:09:26 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 26 Mar 2012 14:09:26 +0100
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
Message-ID: <C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>

Hi Jeff,

The STOMP protocol itself doesn't have the notion of a queue, exclusive
or otherwise. Rather it talks about *destinations*. Sometimes there is a
queue associated with a destination, sometimes not.

In RabbitMQ's implementation of a STOMP subscription, the format of the
destination determines whether there is a queue, what it might be
called, and whether it is created exclusive or not to this client.
Subscriptions to Topic destinations, for example, are associated with
exclusive queues, created for each subscriber. Subscriptions to simple
queue destinations create a shared queue (of an appropriate name) mainly
because we are expecting some other STOMP client to SEND to it (or it
might already have sent to it); making it exclusive would prevent other
clients from seeing it and thus defeat the object.

What we cannot understand is why you would want to change the normal
exclusive/shared characteristic of a queue we might create from the
default? Can you explain why you might want this feature?

Steve Powell  (a puzzled bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 23 Mar 2012, at 12:31, Steve Powell wrote:

> Thanks for the patch Jeff,
> 
> We are evaluating this.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 21 Mar 2012, at 17:24, Jeff wrote:
> 
>> this is a very small patch to add exclusive-access support to a queue when accessed via the stomp adaptor.  It is enabled by using the "exclusive" header.
>> 
>> If you are using Net::Stomp your subscribe would look like 
>> 
>> $stomp->subscribe({ "destination" => "/amq/queue/test",
>> 						"ack" => "auto", 
>> 						"exclusive" => "true"
>> 				 }));
>> 
>> 
>> <rabbit-2.7.1-exclusive-stomp.diff>
>> 
>> --
>> Jeff Trout <jeff at jefftrout.com>
>> http://www.stuarthamm.net/
>> http://www.dellsmartexitin.com/
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar 26 14:11:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 14:11:15 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash - updates
In-Reply-To: <20120323140912.4fb1fe4b@cronos.dsdtm.ro>
References: <20120321191448.2927b95a@cronos.dsdtm.ro>	<4F6A0E3F.9070609@rabbitmq.com>
	<20120323140912.4fb1fe4b@cronos.dsdtm.ro>
Message-ID: <4F706AF3.8030200@rabbitmq.com>

On 23/03/12 12:09, Andrei Vereha wrote:
> Why the beam process takes 1.4 Gb and the rabbitmqctl status reports
> only a few hundred Mb?
> I see the same value(raported by rabbitmqctl status) in the management
> web inteface.
> Is there a way to find where goes the memory?
> Am I using a wrong erlang version?

That's a very good question. Both rabbitmqctl status and management are 
reporting on the amount of memory reported used by the Erlang VM. Which 
is the same value which controls the memory alarm.

This should match up with the RSS value reported by ps. Since yours 
doesn't, the best I can recommend is upgrading Erlang.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From a.pollock at encoded.co.uk  Mon Mar 26 14:09:52 2012
From: a.pollock at encoded.co.uk (Adam Pollock)
Date: Mon, 26 Mar 2012 14:09:52 +0100
Subject: [rabbitmq-discuss] Unclean shutdown followed by upgrade causes
 cluster to no longer come up.
In-Reply-To: <4F70667D.3040304@rabbitmq.com>
References: <4F705CF6.3040408@encoded.co.uk>
 <4F70667D.3040304@rabbitmq.com>
Message-ID: <4F706AA0.6020509@encoded.co.uk>

Hi Simon,

Thanks for your speedy response.

> Do you actually mean rabbitmq.conf? The file is usually called rabbitmq.config. 

Yes, sorry, that was just a typo. It is /etc/rabbitmq/rabbitmq.config.

> Assuming the config file is really /etc/rabbitmq/rabbitmq.config, the only way I can think of for 
> this to happen is if the cluster config file itself is corrupt / empty.

They're definitely not empty, and they don't appear to be corrupt (i.e. they open in vi fine and can 
be read, and deleting them and writing the configuration into a new file doesn't fix the error). 
They have been working previously before the upgrade.

> What does /var/lib/rabbitmq/mnesia/cluster_nodes.config (I think that's the path) contain on the 
> RAM nodes? It should contain the same list of nodes as are in rabbitmq.config. 

Node1 contains:

[root at mq1 ~]# cat /var/lib/rabbitmq/mnesia/node1/cluster_nodes.config
[node1 at mq1,node2 at mq2,node3 at mq3].

However, both node2 and node3 do not have this file present anywhere:

[root at mq3 /var/lib/rabbitmq/mnesia/node3]# ls
msg_store_persistent  msg_store_transient  rabbit_serial  schema_version
[root at mq3 /var/lib/rabbitmq/mnesia/node3]# updatedb
[root at mq3 /var/lib/rabbitmq/mnesia/node3]# locate cluster_nodes.config
[root at mq3 /var/lib/rabbitmq/mnesia/node3]#

There are also node2-upgrade-backup and node3-upgrade-backup directories in 
/var/lib/rabbitmq/mnesia, but these also do not contain and cluster_nodes.config files.

Kind regards,

Adam Pollock.
Lead Software Engineer.

Encoded, Ltd.
T: +44 (0)845 120 9790
F: +44 (0)870 830 1945
E: a.pollock at encoded.co.uk
W: http://www.encoded.co.uk


On 26/03/12 13:52, Simon MacMullen wrote:
> On 26/03/12 13:11, Adam Pollock wrote:
>> Hi,
>
> Hi.
>
>> Node1 started up correctly, but doesn't show any of the
>> other nodes in the cluster status, even though the rabbitmq.conf file
>> has them auto-configured.
>
> This is normal in a cluster upgrade - the upgrade works by breaking the cluster on the first node 
> to start, and then having other nodes rejoin.
>
> Do you actually mean rabbitmq.conf? The file is usually called rabbitmq.config.
>
>> Then, when I try to start up node2 and node3,
>> they both give out the following message in /var/log/rabbit/startup_log:
>>
>> [root at mq2 /etc/rabbitmq]# cat /var/log/rabbitmq/startup_log
>> Activating RabbitMQ plugins ...
>> 6 plugins activated:
>> * amqp_client-2.8.1
>> * mochiweb-1.3-rmq2.8.1-git
>> * rabbitmq_management-2.8.1
>> * rabbitmq_management_agent-2.8.1
>> * rabbitmq_mochiweb-2.8.1
>> * webmachine-1.7.0-rmq2.8.1-hg
>>
>> ****
>> Cluster upgrade needed but this is a ram node.
>> Please first start the last disc node to shut down.
>> ****
>
> So this implies that they think no other cluster nodes are running.
>
> Assuming the config file is really /etc/rabbitmq/rabbitmq.config, the only way I can think of for 
> this to happen is if the cluster config file itself is corrupt / empty. What does 
> /var/lib/rabbitmq/mnesia/cluster_nodes.config (I think that's the path) contain on the RAM nodes? 
> It should contain the same list of nodes as are in rabbitmq.config.
>
> Cheers, Simon
>

From simon at rabbitmq.com  Mon Mar 26 14:14:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 14:14:18 +0100
Subject: [rabbitmq-discuss] Management console argument syntax (was Re:
 Failed to add an exchange via the web interface)
In-Reply-To: <CAM8fPiT6-T-VdhFk8GGd7SgtDmCRN77QZCnbRXi4uCJfsQhskw@mail.gmail.com>
References: <CAM8fPiT6-T-VdhFk8GGd7SgtDmCRN77QZCnbRXi4uCJfsQhskw@mail.gmail.com>
Message-ID: <4F706BAA.5090704@rabbitmq.com>

I think letting the mgmt user select a JSON type is likely to be much 
friendlier than selecting an AMQP type. And yes, apps and plugins should 
be encouraged to use interoperable types.

Having said that, I find the pseudo-Excel syntax rather confusing. I am 
more inclined to just put a select box there.

Cheers, Simon

On 26/03/12 13:42, Tony Garnock-Jones wrote:
> On 26 March 2012 06:33, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     I was really determined to avoid having a type select in the UI. But
>     I'm not sure that can be avoided. I'll file a bug.
>
>
>  From the "Works for Excel" file: how about a magic escape into some
> kind of JSONish syntax?
>
> That is, if the user types
>
> 12345
>
> they get the longstr "12345";
>
> Hello
>
> they get the longstr "Hello";
>
> =12345
>
> they get a numeric type with value 12345;
>
> ="Hello"
>
> they get the longstr "Hello";
>
> =Hello
>
> they get a syntax error (it isn't JSON).
>
> JSON's numbers, strings, booleans, arrays and maps ought to be enough
> for the majority of cases. (It might be worth an Application Note on the
> website regarding the mapping from AMQP table data to and from JSON, and
> encouraging applications and plugins to stick to the common
> interoperable subset...)
>
> Tony
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com <mailto:tonygarnockjones at gmail.com>
> http://homepages.kcbbs.gen.nz/tonyg/


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 26 14:18:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 14:18:29 +0100
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <20120323183418.GA1409@mawhrin.net>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net>
Message-ID: <4F706CA5.4090602@rabbitmq.com>

On 23/03/12 18:34, Mikhail Sobolev wrote:
> Is it possible to use permissions system to limit a given login (since
> we'd like them to use a common username/password) in such a way?

Mostly - see http://www.rabbitmq.com/access-control.html for details. 
You can prevent them from creating exchanges or publishing messages. You 
can ensure they can only create server named queues. But you can't 
prevent them from creating durable queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From a.pollock at encoded.co.uk  Mon Mar 26 14:27:46 2012
From: a.pollock at encoded.co.uk (Adam Pollock)
Date: Mon, 26 Mar 2012 14:27:46 +0100
Subject: [rabbitmq-discuss] Unclean shutdown followed by upgrade causes
 cluster to no longer come up.
In-Reply-To: <4F706AA0.6020509@encoded.co.uk>
References: <4F705CF6.3040408@encoded.co.uk>
	<4F70667D.3040304@rabbitmq.com> <4F706AA0.6020509@encoded.co.uk>
Message-ID: <4F706ED2.3090905@encoded.co.uk>

Hi Simon,

Abort abort abort. This was an iptables issue. Your "So this implies that they think no other 
cluster nodes are running" remark gave it away after a few minutes of thinking about it. Someone has 
been on the machine and "hardened" it. Thanks very much for your help though and sorry for taking up 
your time.

Kind regards,

Adam Pollock.
Lead Software Engineer.

Encoded, Ltd.
T: +44 (0)845 120 9790
F: +44 (0)870 830 1945
E: a.pollock at encoded.co.uk
W: http://www.encoded.co.uk


On 26/03/12 14:09, Adam Pollock wrote:
> Hi Simon,
>
> Thanks for your speedy response.
>
>> Do you actually mean rabbitmq.conf? The file is usually called rabbitmq.config. 
>
> Yes, sorry, that was just a typo. It is /etc/rabbitmq/rabbitmq.config.
>
>> Assuming the config file is really /etc/rabbitmq/rabbitmq.config, the only way I can think of for 
>> this to happen is if the cluster config file itself is corrupt / empty.
>
> They're definitely not empty, and they don't appear to be corrupt (i.e. they open in vi fine and 
> can be read, and deleting them and writing the configuration into a new file doesn't fix the 
> error). They have been working previously before the upgrade.
>
>> What does /var/lib/rabbitmq/mnesia/cluster_nodes.config (I think that's the path) contain on the 
>> RAM nodes? It should contain the same list of nodes as are in rabbitmq.config. 
>
> Node1 contains:
>
> [root at mq1 ~]# cat /var/lib/rabbitmq/mnesia/node1/cluster_nodes.config
> [node1 at mq1,node2 at mq2,node3 at mq3].
>
> However, both node2 and node3 do not have this file present anywhere:
>
> [root at mq3 /var/lib/rabbitmq/mnesia/node3]# ls
> msg_store_persistent  msg_store_transient  rabbit_serial  schema_version
> [root at mq3 /var/lib/rabbitmq/mnesia/node3]# updatedb
> [root at mq3 /var/lib/rabbitmq/mnesia/node3]# locate cluster_nodes.config
> [root at mq3 /var/lib/rabbitmq/mnesia/node3]#
>
> There are also node2-upgrade-backup and node3-upgrade-backup directories in 
> /var/lib/rabbitmq/mnesia, but these also do not contain and cluster_nodes.config files.
>
> Kind regards,
>
> Adam Pollock.
> Lead Software Engineer.
>
> Encoded, Ltd.
> T: +44 (0)845 120 9790
> F: +44 (0)870 830 1945
> E: a.pollock at encoded.co.uk
> W: http://www.encoded.co.uk
>
>
> On 26/03/12 13:52, Simon MacMullen wrote:
>> On 26/03/12 13:11, Adam Pollock wrote:
>>> Hi,
>>
>> Hi.
>>
>>> Node1 started up correctly, but doesn't show any of the
>>> other nodes in the cluster status, even though the rabbitmq.conf file
>>> has them auto-configured.
>>
>> This is normal in a cluster upgrade - the upgrade works by breaking the cluster on the first node 
>> to start, and then having other nodes rejoin.
>>
>> Do you actually mean rabbitmq.conf? The file is usually called rabbitmq.config.
>>
>>> Then, when I try to start up node2 and node3,
>>> they both give out the following message in /var/log/rabbit/startup_log:
>>>
>>> [root at mq2 /etc/rabbitmq]# cat /var/log/rabbitmq/startup_log
>>> Activating RabbitMQ plugins ...
>>> 6 plugins activated:
>>> * amqp_client-2.8.1
>>> * mochiweb-1.3-rmq2.8.1-git
>>> * rabbitmq_management-2.8.1
>>> * rabbitmq_management_agent-2.8.1
>>> * rabbitmq_mochiweb-2.8.1
>>> * webmachine-1.7.0-rmq2.8.1-hg
>>>
>>> ****
>>> Cluster upgrade needed but this is a ram node.
>>> Please first start the last disc node to shut down.
>>> ****
>>
>> So this implies that they think no other cluster nodes are running.
>>
>> Assuming the config file is really /etc/rabbitmq/rabbitmq.config, the only way I can think of for 
>> this to happen is if the cluster config file itself is corrupt / empty. What does 
>> /var/lib/rabbitmq/mnesia/cluster_nodes.config (I think that's the path) contain on the RAM nodes? 
>> It should contain the same list of nodes as are in rabbitmq.config.
>>
>> Cheers, Simon
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jeff at jefftrout.com  Mon Mar 26 14:33:12 2012
From: jeff at jefftrout.com (Jeff)
Date: Mon, 26 Mar 2012 09:33:12 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
 adaptor
In-Reply-To: <C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
Message-ID: <1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>


On Mar 26, 2012, at 9:09 AM, Steve Powell wrote:
> 
> In RabbitMQ's implementation of a STOMP subscription, the format of the
> destination determines whether there is a queue, what it might be
> called, and whether it is created exclusive or not to this client.
> Subscriptions to Topic destinations, for example, are associated with
> exclusive queues, created for each subscriber. Subscriptions to simple
> queue destinations create a shared queue (of an appropriate name) mainly
> because we are expecting some other STOMP client to SEND to it (or it
> might already have sent to it); making it exclusive would prevent other
> clients from seeing it and thus defeat the object.
> 
> What we cannot understand is why you would want to change the normal
> exclusive/shared characteristic of a queue we might create from the
> default? Can you explain why you might want this feature?
> 

We're using Net::Stomp because I encountered a ton of problems getting Net::AMQP to work correctly.  (that and Net::Stomp's api is vastly simpler than Net::AMQP)

So we needed to setup some mirrored, persistent queues and there was no way, from what I could see, with stomp to create a mirrored queue.  So, we create the queue via the web-ui and access via /amq/queue/xxxx.  This was all fine until recently when I needed to ensure there was only a single consumer of a queue.  I looked around trying to see how I can set the exclusivity and ended up in the code for the stomp adaptor and ended up with the aforementioned patch. (Net::Stomp has an activemq specific extension to allow exclusive consumers, so I whipped up an extension for Rabbit)

It boils down to I needed to create and access mirrored queues using a stomp client. 

It does look like /queue/ would do the exclusive access (not sure from the docs - it just says message will be delivered to one subscriber, not sure if that means it'll block out other subscribers or distribute among connected subscribers).

thanks

> Steve Powell  (a puzzled bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 23 Mar 2012, at 12:31, Steve Powell wrote:
> 
>> Thanks for the patch Jeff,
>> 
>> We are evaluating this.
>> 
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> literacy (n.) A textually transmitted disease usually contracted in childhood.
>> 
>> On 21 Mar 2012, at 17:24, Jeff wrote:
>> 
>>> this is a very small patch to add exclusive-access support to a queue when accessed via the stomp adaptor.  It is enabled by using the "exclusive" header.
>>> 
>>> If you are using Net::Stomp your subscribe would look like 
>>> 
>>> $stomp->subscribe({ "destination" => "/amq/queue/test",
>>> 						"ack" => "auto", 
>>> 						"exclusive" => "true"
>>> 				 }));
>>> 
>>> 
>>> <rabbit-2.7.1-exclusive-stomp.diff>
>>> 
>>> --
>>> Jeff Trout <jeff at jefftrout.com>
>>> http://www.stuarthamm.net/
>>> http://www.dellsmartexitin.com/
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Jeff Trout <jeff at jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/




From threshar at torgo.978.org  Mon Mar 26 14:28:20 2012
From: threshar at torgo.978.org (Jeff)
Date: Mon, 26 Mar 2012 09:28:20 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
 adaptor
In-Reply-To: <C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
Message-ID: <15AEF979-0249-42F6-94B6-92E5551356DC@torgo.978.org>


On Mar 26, 2012, at 9:09 AM, Steve Powell wrote:

> 
> In RabbitMQ's implementation of a STOMP subscription, the format of the
> destination determines whether there is a queue, what it might be
> called, and whether it is created exclusive or not to this client.
> Subscriptions to Topic destinations, for example, are associated with
> exclusive queues, created for each subscriber. Subscriptions to simple
> queue destinations create a shared queue (of an appropriate name) mainly
> because we are expecting some other STOMP client to SEND to it (or it
> might already have sent to it); making it exclusive would prevent other
> clients from seeing it and thus defeat the object.
> 
> What we cannot understand is why you would want to change the normal
> exclusive/shared characteristic of a queue we might create from the
> default? Can you explain why you might want this feature?
> 

We're using Net::Stomp because I encountered a ton of problems getting Net::AMQP to work correctly.  (that and Net::Stomp's api is vastly simpler than Net::AMQP)

So we needed to setup some mirrored, persistent queues and there was no way, from what I could see, with stomp to create a mirrored queue.  So, we create the queue via the web-ui and access via /amq/queue/xxxx.  This was all fine until recently when I needed to ensure there was only a single consumer of a queue.  I looked around trying to see how I can set the exclusivity and ended up in the code for the stomp adaptor and ended up with the aforementioned patch. (Net::Stomp has an activemq specific extension to allow exclusive consumers, so I whipped up an extension for Rabbit)

It boils down to I needed to create and access mirrored queues using a stomp client. 

It does look like /queue/ would do the exclusive access (not sure from the docs - it just says message will be delivered to one subscriber, not sure if that means it'll block out other subscribers or distribute among connected subscribers).

thanks

> Steve Powell  (a puzzled bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 23 Mar 2012, at 12:31, Steve Powell wrote:
> 
>> Thanks for the patch Jeff,
>> 
>> We are evaluating this.
>> 
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> literacy (n.) A textually transmitted disease usually contracted in childhood.
>> 
>> On 21 Mar 2012, at 17:24, Jeff wrote:
>> 
>>> this is a very small patch to add exclusive-access support to a queue when accessed via the stomp adaptor.  It is enabled by using the "exclusive" header.
>>> 
>>> If you are using Net::Stomp your subscribe would look like 
>>> 
>>> $stomp->subscribe({ "destination" => "/amq/queue/test",
>>> 						"ack" => "auto", 
>>> 						"exclusive" => "true"
>>> 				 }));
>>> 
>>> 
>>> <rabbit-2.7.1-exclusive-stomp.diff>
>>> 
>>> --
>>> Jeff Trout <jeff at jefftrout.com>
>>> http://www.stuarthamm.net/
>>> http://www.dellsmartexitin.com/
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Jeff Trout <jeff at jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/




From ask at rabbitmq.com  Mon Mar 26 15:09:28 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 26 Mar 2012 15:09:28 +0100
Subject: [rabbitmq-discuss] 2 unack messages for 1 process
In-Reply-To: <67b0e4d2-c249-437d-bb39-09c6657ced74@x5g2000pbl.googlegroups.com>
References: <67b0e4d2-c249-437d-bb39-09c6657ced74@x5g2000pbl.googlegroups.com>
Message-ID: <33A63ACC-0999-4608-8D61-0D07A293571F@rabbitmq.com>


On 21 Mar 2012, at 16:26, Paulo Cheque wrote:

> Hi, I am using Celery (http://celeryproject.org/) to produce and
> consume RabbitMQ messages. Only one process of Celery consume
> messages, so why can I see in Rabbit 2 unack messages at the same
> time?
> 
> I understand Rabbit had 1 unack message for each consumer process.
> 

See http://docs.celeryproject.org/en/latest/userguide/optimizing.html#prefetch-limits

Also, Celery has two 'ack' settings: early or late.
With early ack (default) the message is acknowledged *before* the
task is executed, with late ack it is acknowledged after.

So with early ack it may reserve an additional message even if the prefetch multiplier
is set to 1.


You should read this FAQ entry to understand why Celery uses the early ack behavior
by default: http://docs.celeryproject.org/en/latest/faq.html#should-i-use-retry-or-acks-late


From steve at rabbitmq.com  Mon Mar 26 15:11:13 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 26 Mar 2012 15:11:13 +0100
Subject: [rabbitmq-discuss] [java-client] Parallelizing message
	consumption from a single queue
In-Reply-To: <14018256.62.1332440456764.JavaMail.geo-discussion-forums@ynnk21>
References: <14018256.62.1332440456764.JavaMail.geo-discussion-forums@ynnk21>
Message-ID: <58FAA50E-7E40-4B20-9568-CBC2A4A70983@rabbitmq.com>

Hi Josh,

In the absence of the experts -- you get me :-)

Questions that start 'what is the best way to...' often have no
definitive answer, I'm afraid; but here goes.

First, I'm going to have to explain what I *think* you are asking about,
before trying to answer it.

  I assume you are asking about multiple Consumers, in a Java client, all
  consuming from the same queue, allowing 'parallel' consumption -- which
  I take to mean multi-threaded -- within the same Java client. You want
  the 'best' application structure which achieves 'parallel' processing of 
  messages from the queue.

Well, there is nothing to stop you 'registering' the same Consumer
instance more than once, with different consumer tags, so it is easy to
drive multiple 'identical' Consumers. However, if you register
(Channel.basicConsume()) on the same channel, the consumers will be
called serially (this is done to preserve the ordering of messages
processed on a channel).

No doubt you've read the blurb on the Java Client API doc pages
(http://www.rabbitmq.com/api-guide.html#consuming) which says:

> Callbacks to Consumers are dispatched on a thread separate from the
> thread managed by the Connection. This means that Consumers can safely
> call blocking methods on the Connection or Channel, such asqueueDeclare,
> txCommit, basicCancel or basicPublish.
> 
> Each Channel has its own dispatch thread. For the most common use case
> of one Consumer per Channel, this means Consumers do not hold up other
> Consumers. If you have multiple Consumers per Channel be aware that a
> long-running Consumer may hold up dispatch of callbacks to other
> Consumers on that Channel.

and the section on advanced connection options mentions a thread-pool
(by default containing 5 threads) associated with the connection.

What this all means is that *on each channel* Consumer callbacks are
called serially. No overlapping there, so no chance to consume 'in
parallel', so distinct *channels* (on the same connection) are allowed
to run their consumers in parallel (up to five may run concurrently, in
the default case).

So, to 'consume' messages in parallel from a single queue you need to
have the consumers on separate channels. Now, if you define a single
Consumer instance, and get it to be invoked on multiple threads
concurrently (on separate channels) you have to be careful -- the code
in your Consumer must be thread-safe, and probably more than just that,
too. I'll assume you know what you are doing. If you create one Consumer
instance for each channel, RabbitMQ will guarantee that each channel's
Consumer is running on one thread, so the rules are simpler.

There is another option. Provided you are prepared to separate
consumption from processing (and possibly acknowledgement) you can
register a single consumer which does very little except pass the
message to another (worker) thread to do the actual processing. The
Consumer doesn't have to be sophisticated, but your dispatching
mechanism needs to be: you mustn't lose messages, and you must ensure
that you acknowledge them at some point (which may not be straight
away). Still, if you are adept at Java concurrent programming these are
all achievable. By managing your own worker threads you can achieve your
own dispatching and resource management rules, and by setting the
pre-fetch count (Qos) and managing acknowledgements you can gate the
amount of work done in parallel, and even decide which workers get which
messages.

Which of these is 'best' depends a lot on your requirements. If you need
just a little more control over the processing threads but don't want to
'roll-your-own' dispatcher mechanism there is an option for you to
supply your own ExecutorService for the RabbitMQ Connection to use, and
Java supplies some standard ExecutorService implementations which allow
you to do some of the management without considerable effort.

My general advice is that this might be a lot of work, and you should
consider investing in a sophisticated system only if you have determined
that you really need the advantages it might bring. Be aware that these
may not include faster throughput, and might upset any ordering
guarantees you may be relying upon at present.

I hope this helps.

Steve Powell  (a happy kitten)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 22 Mar 2012, at 18:20, Josh Stone wrote:

> I wanted to ask the experts since it's not clear to me - what is the best way to parallelize message consumption from a single queue, using the Java client? 
> 
> Thanks,
> Josh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon Mar 26 15:40:54 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 26 Mar 2012 15:40:54 +0100
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
Message-ID: <D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>

Hi Jeff,

> It does look like /queue/ would do the exclusive access (not sure from
> the docs - it just says message will be delivered to one subscriber, not
> sure if that means it'll block out other subscribers or distribute among
> connected subscribers).

The doc says it will create a shared queue (not exclusive). The
sentence:

> Queue destinations deliver each message to at most one subscriber.

means simply that any particular message is sent to only one of the
subscribers. There may be many subscribers, though.

I'm not sure that the 'exclusive' option that activemq supplies is quite
what your patch would achieve; here is what the AMQP reference says
about the exclusive bit on queue declarations:

> Exclusive queues may only be accessed by the current connection, and are
> deleted when that connection closes. Passive declaration of an exclusive
> queue by other connections are not allowed.

This doesn't stop the server putting messages on the queue -- this would
depend upon how it is bound to an exchange. Another connection doesn't
need access to the queue to publish a message that might get there.
However, if you SEND to the /queue/name (on another STOMP connection)
then that will fail if the queue was declared exclusive, because the
queue cannot be 'created' (or even passively declared).

HOWEVER, you said you were using amq/queue/<name> destinations. In that
case no queue declarations are ever made in STOMP SEND or SUBSCRIBE,
and so the mod you sent wouldn't help either.

Unfortunately, making it exclusive (via the web ui or anywhere else)
will prevent any other connection (a STOMP one, even) from accessing it
(SUBSCRIBE will fail -- the queue will look like it doesn't exist). So
you are scuppered there, too.

Can you explain more about activemq's exclusive option? How is it
applied? Can you define it and the 'first subscriber that comes along'
gets it? What happens exactly when we attempt to subscribe to it from
another connection?

At the moment, I'm not at all sure how we might ensure that there is
only one consumer (at a time?) for any queue. But IDKE.

Steve Powell  (a sorry bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

From aaron at agoragames.com  Mon Mar 26 15:53:45 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 26 Mar 2012 10:53:45 -0400
Subject: [rabbitmq-discuss] rabbitmqctl script still broken in Ubuntu package
Message-ID: <CAHiEoM52D4yuE6LqfXoYSAr6-v7BBUq=ChHgzr=k7hB5poXfgQ@mail.gmail.com>

I just installed the 2.8.1 package, having used 2.2 from source on my
workstation for some time now, and found that the rabbitmqctl script
is still broken. Specifically, it requires running as rabbitmq or root
user, even though I've copied the erlang cookie to the correct path.
I've run into this problem before and noted it on the mailing list but
can't find a place to submit a formal bug.

-Aaron



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From jon at jbrisbin.com  Mon Mar 26 15:58:51 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 26 Mar 2012 09:58:51 -0500 (CDT)
Subject: [rabbitmq-discuss] Updated rebar-ized rabbit_common,
	amqp_client and webhooks and riak-exchanges to 2.8.1
In-Reply-To: <4a10648c-55a8-434a-a587-206d708d3b6e@jbrisbin.local>
Message-ID: <b59e9330-c479-4534-b880-b4ceeb134d54@jbrisbin.local>

Hey folks! :) Hope every had a good Spring Break for those that had one this last week--or if yours is upcoming, hope the weather is better than ours was, which is to say about 8 inches of rain and no sun. :(

At any rate, I updated several of the packages I maintain that are Rabbity-related like the "rebar-ized" port of the AMQP Erlang client [1] and rabbit_common [2] (which is really handy for writing plugins for RabbitMQ that use rebar for their build), the RabbitMQ Webhooks plugin [3] (which sends a generic HTTP request to any host on receipt of a message to that exchange), as well as the Riak custom exchange [4] (which saves every message sent to that exchange to a document in Riak). They should all use the 2.8.1 version of things now. 

If you use these utilities and have issues, please let me know. I didn't do a whole lot of testing on them other than to make sure the broker starts with them enabled. ;)

[1] - https://github.com/jbrisbin/amqp_client
[2] - https://github.com/jbrisbin/rabbit_common
[3] - https://github.com/jbrisbin/rabbitmq-webhooks
[4] - https://github.com/jbrisbin/riak-exchange


Thanks! 

Jon Brisbin 
http://about.me/jonbrisbin 




From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 26 16:02:35 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 26 Mar 2012 11:02:35 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
	<D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
Message-ID: <CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>

On 26 March 2012 10:40, Steve Powell <steve at rabbitmq.com> wrote:

> At the moment, I'm not at all sure how we might ensure that there is
> only one consumer (at a time?) for any queue. But IDKE.
>

You're probably looking for the "exclusive" argument to *basic.consume*
rather than queue.declare.

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/311ca325/attachment.htm>

From steve at rabbitmq.com  Mon Mar 26 16:05:25 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 26 Mar 2012 16:05:25 +0100
Subject: [rabbitmq-discuss] Enable Plugins via Config
In-Reply-To: <CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F72B6EE2@MX36A.corp.emc.com>
	<3592929.1829.1332549518519.JavaMail.jerryk@StrongMad.local>
	<CAOn7oW-GvH2pobxUVA2eS_K04nk6TK1zQE3dmChP_rR_1ZvGDA@mail.gmail.com>
Message-ID: <4349A843-85B9-4B4F-831F-980FD9D7AA63@rabbitmq.com>

Hi, just spotted this.

> This would allow us to distribute it pre-configured.

If you want to pre-configure, since you have the
RABBITMQ_ENABLED_PLUGINS_FILE environment variable and can run
rabbitmq-plugins without starting the broker, the 'safe' way to do this
would seem to be to run 'rabbitmq-plugins enable' as you wish, and copy
the enabled plugins file so generated.

This is likely to work even if we 'completely and utterly improve up'
the format of the file in a future release.

Steve Powell  (a nosy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 24 Mar 2012, at 06:26, Simone Busoli wrote:

> Jerry, I'm pretty sure that editing the enabled_plugins file works just fine. I've been doing that to prepare packages ready to be deployed and it just works.
> 
> On Mar 24, 2012 1:39 AM, "Jerry Kuch" <jerryk at vmware.com> wrote:
> Hi, James.
> 
> No you're pretty much stuck with the batch-file driven restart (and on Windows
> even a "reinstall" of the Windows service).
> 
> Best regards,
> Jerry
> 
> 
> ----- Original Message -----
> From: "james poole" <james.poole at rsa.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, March 23, 2012 1:28:20 PM
> Subject: [rabbitmq-discuss] Enable Plugins via Config
> 
> 
> 
> 
> 
> Does anyone know a way to enable plugins without running the batch file on Windows platforms? What I was hoping for was a way to enable the STOMP plugin by setting some value in ?rabbitmq.config? rather than having to run a batch file. This would allow us to distribute it pre-configured.
> 
> 
> 
> I didn?t see anything about this on the plugin related web pages. They all refer to running the batch files.
> 
> 
> 
> Any thoughts?
> 
> 
> 
> Thanks,
> 
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jeff at jefftrout.com  Mon Mar 26 16:39:52 2012
From: jeff at jefftrout.com (Jeff)
Date: Mon, 26 Mar 2012 11:39:52 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
 adaptor
In-Reply-To: <CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
	<D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
	<CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>
Message-ID: <ACE38020-6EE4-43DE-9EBD-C574257BCFD2@jefftrout.com>


On Mar 26, 2012, at 11:02 AM, Tony Garnock-Jones wrote:

> On 26 March 2012 10:40, Steve Powell <steve at rabbitmq.com> wrote:
> At the moment, I'm not at all sure how we might ensure that there is
> only one consumer (at a time?) for any queue. But IDKE.
> 
> You're probably looking for the "exclusive" argument to *basic.consume* rather than queue.declare.
> 
> Tony

Yep - that is what this patch does - it allows us to pass in the exclusive argument to basic.consume in the stomp wrapper (it was previous hardcoded to be false) 


--
Jeff Trout <jeff at jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/




From mss at mawhrin.net  Mon Mar 26 17:14:54 2012
From: mss at mawhrin.net (Mikhail Sobolev)
Date: Mon, 26 Mar 2012 20:14:54 +0400
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F706CA5.4090602@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
Message-ID: <20120326161454.GA14190@mawhrin.net>

Hi Simon,

On Mon, Mar 26, 2012 at 02:18:29PM +0100, Simon MacMullen wrote:
> On 23/03/12 18:34, Mikhail Sobolev wrote:
> >Is it possible to use permissions system to limit a given login (since
> >we'd like them to use a common username/password) in such a way?
> 
> Mostly - see http://www.rabbitmq.com/access-control.html for details. 
> You can prevent them from creating exchanges or publishing messages. You 
> can ensure they can only create server named queues. But you can't 
> prevent them from creating durable queues.
I somehow overlooked the abovementioned page, thank you.

Any suggestions on how to prevent stacking up the "undelivered"
messages?

--
Misha

From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 26 17:21:44 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 26 Mar 2012 12:21:44 -0400
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F706CA5.4090602@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
Message-ID: <CAM8fPiT2qo=0ffWT8MqP9mNs+5nn4WRH=H=Bfo+tDmFbT1h4Pg@mail.gmail.com>

On 26 March 2012 09:18, Simon MacMullen <simon at rabbitmq.com> wrote:

> Mostly - see http://www.rabbitmq.com/access-control.html for details. You
> can prevent them from creating exchanges or publishing messages. You can
> ensure they can only create server named queues. But you can't prevent them
> from creating durable queues.
>

Isn't it possible to forbid them from creating any queues at all? It'd be
useful to be able to let people publish as much as they like (to certain
exchanges), but to forbid them from creating or deleting any exchanges or
any queues.

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/7ea93a7b/attachment.htm>

From simon at rabbitmq.com  Mon Mar 26 17:25:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Mar 2012 17:25:48 +0100
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <CAM8fPiT2qo=0ffWT8MqP9mNs+5nn4WRH=H=Bfo+tDmFbT1h4Pg@mail.gmail.com>
References: <20120322191055.GA3358@mawhrin.net>	<4F6C5483.9010209@rabbitmq.com>	<20120323183418.GA1409@mawhrin.net>	<4F706CA5.4090602@rabbitmq.com>
	<CAM8fPiT2qo=0ffWT8MqP9mNs+5nn4WRH=H=Bfo+tDmFbT1h4Pg@mail.gmail.com>
Message-ID: <4F70988C.3000507@rabbitmq.com>

On 26/03/12 17:21, Tony Garnock-Jones wrote:
> Isn't it possible to forbid them from creating any queues at all? It'd
> be useful to be able to let people publish as much as they like (to
> certain exchanges), but to forbid them from creating or deleting any
> exchanges or any queues.

Oh, yes. But the OP wanted to let them create some types of queues but 
not others.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 26 17:26:18 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 26 Mar 2012 12:26:18 -0400
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <ACE38020-6EE4-43DE-9EBD-C574257BCFD2@jefftrout.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
	<D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
	<CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>
	<ACE38020-6EE4-43DE-9EBD-C574257BCFD2@jefftrout.com>
Message-ID: <CAM8fPiT_7NL=qL62q8f+nh_Q8whbh7igfZixd_E_okFynGvn-Q@mail.gmail.com>

Hi Jeff,

Ah! I hadn't actually seen the patch, but I just went hunting through the
archives to find the root of this thread. Yep.

Steve, am I right in thinking your objections apply to the "exclusive"
argument to queue.declare, rather than that to basic.consume? It seems to
me that supporting "exclusive" for basic.consume would be a useful addition
to the STOMP adapter.

Regards,
  Tony


On 26 March 2012 11:39, Jeff <jeff at jefftrout.com> wrote:
>
> ...



> You're probably looking for the "exclusive" argument to *basic.consume*
> rather than queue.declare.
>
> Yep - that is what this patch does - it allows us to pass in the exclusive
> argument to basic.consume in the stomp wrapper (it was previous hardcoded
> to be false)
>

-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/3a3a0a30/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Mon Mar 26 17:27:50 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 26 Mar 2012 12:27:50 -0400
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F70988C.3000507@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<CAM8fPiT2qo=0ffWT8MqP9mNs+5nn4WRH=H=Bfo+tDmFbT1h4Pg@mail.gmail.com>
	<4F70988C.3000507@rabbitmq.com>
Message-ID: <CAM8fPiRJe7dW_aQ5EJmnSSK_XPKw0NVnEyh-28SKOmWC6VhC-g@mail.gmail.com>

Oops :-) I missed that. Sorry.

Tony


On 26 March 2012 12:25, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 26/03/12 17:21, Tony Garnock-Jones wrote:
>
>> Isn't it possible to forbid them from creating any queues at all? It'd
>> be useful to be able to let people publish as much as they like (to
>> certain exchanges), but to forbid them from creating or deleting any
>> exchanges or any queues.
>>
>
> Oh, yes. But the OP wanted to let them create some types of queues but not
> others.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/2c8dc52b/attachment.htm>

From dawgtool at aol.com  Mon Mar 26 17:31:24 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 26 Mar 2012 12:31:24 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F704404.8080504@rabbitmq.com>
References: <4F6CD702.4050908@aol.com> <4F704404.8080504@rabbitmq.com>
Message-ID: <4F7099DC.7040209@aol.com>

Hi Simon,

Memory seemed to be fine with 2.7.1, it ran without issue for several 
months before upgrading to 2.8.1.  For now I have increased the TCP 
buffer size, which I don't think will fix my issues, since I am getting 
locks with constant flow (normal flow causing control, not spikes).  Is 
there anyway to modify how much can be buffered on the exchange and queue?

Thanks

On 3/26/12 6:25 AM, Simon MacMullen wrote:
> Hi.
>
> There's no way to monitor what the flow control is doing.
>
> I would assume that with 7k msg/s on 2.7.1 you see memory use steadily 
> increasing? The flow control should just be preventing (significant 
> numbers of) messages being queued up anywhere else than in queues. The 
> idea is to ensure that whatever performance RabbitMQ is giving you is 
> sustainable, rather than letting it absorb more messages in the short 
> term at the cost of working itself into a hole that is difficult to 
> get out of.
>
> If you need the ability to absorb spikes in publishing rates then you 
> can increase the size of TCP buffers on the server.
>
> Cheers, Simon
>
> On 23/03/12 20:03, DawgTool wrote:
>> Hi All,
>>
>> Wondering is anyone having issues with the Per-Connection Flow Control
>> in 2.8.1?
>> Under 2.7.1 was able to push about 4.5MB/s per connection (about
>> ~7000msg/s).
>> Under 2.8.1 I am hitting the flow control constantly at about 2.4MB/s
>> per connection.
>> Clean installed 2.8.1 on the same hardware as 2.7.1.
>>
>> Is there someway to configure/monitor what is causing the Flow Control
>> to be tripped?
>>
>> Thanks in Advance.
>>
>>
>>
>> Config: (both 2.7.1/2.8.1)
>> Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:30]
>> [hipe] [kernel-poll:true]
>>
>> ==> enabled_plugins <==
>> [rabbitmq_management,rabbitmq_management_agent].
>>
>> ==> rabbitmq.config <==
>> [
>> {rabbit, [{vm_memory_high_watermark, 0.6},
>> {collect_statistics_interval, 5000},
>> {hipe_compile, true}
>> ]
>> },
>> {mnesia, [{dc_dump_limit, 40},
>> {dump_log_write_threshold, 50000},
>> {no_table_loaders, 20},
>> {send_compressed, 9},
>> {snmp, true}
>> ]
>> },
>> {rabbitmq_management, [ {http_log_dir,
>> "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
>> {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
>> ].
>>
>> ==> rabbitmq-env.conf <==
>> NODENAME=dc001
>> BASE=/data/rabbitmq/dc001
>> MNESIA_BASE=/data/rabbitmq/dc001/mnesia
>> LOG_BASE=/data/rabbitmq/dc001/log
>> SERVER_START_ARGS="+K true -smp enable"
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From dawgtool at aol.com  Mon Mar 26 17:37:48 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 26 Mar 2012 12:37:48 -0400
Subject: [rabbitmq-discuss] Strange Behavior with Queues - 2.8.1
Message-ID: <4F709B5C.3080600@aol.com>

Hi All,

Having some strange behavior with queues on 2.8.1.
If I publish to host 1 and the queue is on host 1, messages seem to flow 
correctly.
If I publish to host 1 and the queue is on host 2, message start then 
are blocked (flow control) and the servers become unresponsive to queue 
deletes, connections, etc.

Anyone else seeing this behavior?

Thanks


[{pid,3531},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
       {rabbit,"RabbitMQ","2.8.1"},
       {os_mon,"CPO  CXC 138 46","2.2.8"},
       {mnesia,"MNESIA  CXC 138 12","4.6"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
       {sasl,"SASL  CXC 138 11","2.2"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
       {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
       {inets,"INETS  CXC 138 49","5.8"},
       {stdlib,"ERTS  CXC 138 10","1.18"},
       {kernel,"ERTS  CXC 138 10","2.15"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,
      [{total,37721536},
       {processes,12717741},
       {processes_used,12717727},
       {system,25003795},
       {atom,711569},
       {atom_used,698984},
       {binary,2050000},
       {code,17209273},
       {ets,1382624}]},
  {vm_memory_high_watermark,0.5999999999767169},
  {vm_memory_limit,10307921510},
  {file_descriptors,
      
[{total_limit,924},{total_used,7},{sockets_limit,829},{sockets_used,5}]},
  {processes,[{limit,1048576},{used,203}]},
  {run_queue,0},
  {uptime,2880}]
...done.


From mspetrovic at gmail.com  Mon Mar 26 18:24:53 2012
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Mon, 26 Mar 2012 10:24:53 -0700
Subject: [rabbitmq-discuss] A Kotlin-based simple RabbitMQ producer and
	consumer
Message-ID: <CABMnSbFD+M9U4W9OAbeFUe80Zwbw=okpcMrwcRSqxxpJnZULfA@mail.gmail.com>

Super simple, but a valid PoC:  a simple producer and consumer written
in JetBrains new Kotlin language.

https://github.com/ae6rt/rabbitmq-kotlin

I like Kotlin and how simple it wants to be.



-- 
Mark

From aaron at agoragames.com  Mon Mar 26 21:01:15 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 26 Mar 2012 16:01:15 -0400
Subject: [rabbitmq-discuss] heartbeat bug
Message-ID: <CAHiEoM5SwYs3wr3QDj2KZgcuOS=Af1o=CNbAvWJqU=NF=pASqw@mail.gmail.com>

I think I've encountered a bug in the implementation of heartbeats,
repeatable in 2.5.1 and 2.7.1.

First, my observation is that assuming a heartbeat interval H seconds,
Rabbit only sends a heartbeat after H seconds of no traffic through a
connection. I've confirmed that this is valid behavior according to
the spec (sec 4.2.7). Upon a closer reading of the spec, I see that
the client "should" be sending heartbeat frames, but it is not
required to do so. At this time, haigha only responds to heartbeats
and does not initiate a client-side loop. As far as I know and have
observed in other implementations, this is standard practice. In other
words, I think both client and server are operating within spec.

So given this, I think there is a timing bug in RabbitMQ where sparse
traffic throws off the timer.  I've pasted example output, showing the
timestamps when we handled a heartbeat (interval=3) and when we
consumed an application message. This is a rare case in that we still
read a heartbeat frame at the very end; usually there are no heartbeat
frames between the final one and any application messages we process
before Rabbit kills the connection.

DEBUG: 1332791022.6 consume
DEBUG: 1332791025.57 heartbeat
DEBUG: 1332791025.72 consume
DEBUG: 1332791028.56 heartbeat
DEBUG: 1332791029.23 consume
DEBUG: 1332791030.16 consume
DEBUG: 1332791030.18 consume
DEBUG: 1332791033.06 heartbeat
DEBUG: 1332791034.06 consume
DEBUG: 1332791034.07 consume
DEBUG: 1332791036.07 heartbeat
DEBUG: 1332791039.07 consume
DEBUG: 1332791039.61 consume
DEBUG: 1332791042.07 heartbeat
DEBUG: 1332791044.74 consume
DEBUG: 1332791045.17 consume
DEBUG: 1332791046.26 consume
DEBUG: 1332791047.67 consume
DEBUG: 1332791049.58 heartbeat
DEBUG: 1332791049.58 transport closed

=ERROR REPORT==== 26-Mar-2012::15:44:09 ===
exception on TCP connection <0.2539.25> from 10.122.166.168:54322
{timeout,running}




-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From dawgtool at aol.com  Mon Mar 26 21:40:45 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 26 Mar 2012 16:40:45 -0400
Subject: [rabbitmq-discuss] [Q] Shovel Example - Dynamic Upstream to Central
	Broker
Message-ID: <4F70D44D.8030900@aol.com>

Hi All,

Looking for an example of Dynamic Upstream brokers connecting to a 
Central Broker.
The exchange on the Central Broker is type topic with several queues, 
and is very important that the Upstreams' routing key is preserved.

The Central server can not be bounced, so config changes can only be 
done on the Upstream servers.

Any suggestions/examples?

Thanks


From santiagomonttco at gmail.com  Mon Mar 26 23:36:22 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Mon, 26 Mar 2012 19:36:22 -0300
Subject: [rabbitmq-discuss] |Spam| EN COPIAPO ACCIDENTES DEL TRABAJO
	ACCIDENTES DEL TRABAJO
Message-ID: <e86aeeb7af7d13a51d1d109300132165@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/4bb2a4e8/attachment.htm>

From pacesysjosh at gmail.com  Tue Mar 27 00:49:07 2012
From: pacesysjosh at gmail.com (Josh Stone)
Date: Mon, 26 Mar 2012 16:49:07 -0700 (PDT)
Subject: [rabbitmq-discuss] [java-client] Parallelizing message
 consumption from a single queue
In-Reply-To: <58FAA50E-7E40-4B20-9568-CBC2A4A70983@rabbitmq.com>
References: <14018256.62.1332440456764.JavaMail.geo-discussion-forums@ynnk21>
	<58FAA50E-7E40-4B20-9568-CBC2A4A70983@rabbitmq.com>
Message-ID: <25697157.291.1332805747355.JavaMail.geo-discussion-forums@pbcvg9>

Thanks for the response. My response is inline below:

On Monday, March 26, 2012 7:11:13 AM UTC-7, Steve Powell wrote:
>
> Hi Josh,
>
> In the absence of the experts -- you get me :-)
>
> Questions that start 'what is the best way to...' often have no
> definitive answer, I'm afraid; but here goes.
>
> First, I'm going to have to explain what I *think* you are asking about,
> before trying to answer it.
>
>   I assume you are asking about multiple Consumers, in a Java client, all
>   consuming from the same queue, allowing 'parallel' consumption -- which
>   I take to mean multi-threaded -- within the same Java client. You want
>   the 'best' application structure which achieves 'parallel' processing of 
>   messages from the queue.
>
Yes - I have one client that is consuming from a single queue, and 
basically want to achieve the best throughput possible, whatever that means 
in terms of one or more connections, channels, consumers, and threads 
making use of these. This is the part I'm not sure about.
 

> Well, there is nothing to stop you 'registering' the same Consumer
> instance more than once, with different consumer tags, so it is easy to
> drive multiple 'identical' Consumers. However, if you register
> (Channel.basicConsume()) on the same channel, the consumers will be
> called serially (this is done to preserve the ordering of messages
> processed on a channel).
>
> No doubt you've read the blurb on the Java Client API doc pages
> (http://www.rabbitmq.com/api-guide.html#consuming) which says:
>
> > Callbacks to Consumers are dispatched on a thread separate from the
> > thread managed by the Connection. This means that Consumers can safely
> > call blocking methods on the Connection or Channel, such asqueueDeclare,
> > txCommit, basicCancel or basicPublish.
> > 
> > Each Channel has its own dispatch thread. For the most common use case
> > of one Consumer per Channel, this means Consumers do not hold up other
> > Consumers. If you have multiple Consumers per Channel be aware that a
> > long-running Consumer may hold up dispatch of callbacks to other
> > Consumers on that Channel.
>
> and the section on advanced connection options mentions a thread-pool
> (by default containing 5 threads) associated with the connection.
>
> What this all means is that *on each channel* Consumer callbacks are
> called serially. No overlapping there, so no chance to consume 'in
> parallel', so distinct *channels* (on the same connection) are allowed
> to run their consumers in parallel (up to five may run concurrently, in
> the default case).
>
> So, to 'consume' messages in parallel from a single queue you need to
> have the consumers on separate channels. Now, if you define a single
> Consumer instance, and get it to be invoked on multiple threads
> concurrently (on separate channels) you have to be careful -- the code
> in your Consumer must be thread-safe, and probably more than just that,
> too. I'll assume you know what you are doing. 
>
 

> If you create one Consumer
> instance for each channel, RabbitMQ will guarantee that each channel's
> Consumer is running on one thread, so the rules are simpler.
>
> There is another option. Provided you are prepared to separate
> consumption from processing (and possibly acknowledgement) you can
> register a single consumer which does very little except pass the
> message to another (worker) thread to do the actual processing.
>
The
> Consumer doesn't have to be sophisticated, but your dispatching
> mechanism needs to be: you mustn't lose messages, and you must ensure
> that you acknowledge them at some point (which may not be straight
> away). Still, if you are adept at Java concurrent programming these are
> all achievable. 
>
This is the approach I've taken so far. I have a single Connection, Channel 
and Consumer and a single thread that loop on consumer.nextDelivery(). As 
soon as consumer.nextDelivery() returns, the message is acknowledged and 
handed off to a separate thread pool for processing, allowing the thread to 
move on to the next delivery. 
 

> By managing your own worker threads you can achieve your
> own dispatching and resource management rules, and by setting the
> pre-fetch count (Qos) and managing acknowledgements you can gate the
> amount of work done in parallel, and even decide which workers get which
> messages.
>
> Which of these is 'best' depends a lot on your requirements. If you need
> just a little more control over the processing threads but don't want to
> 'roll-your-own' dispatcher mechanism there is an option for you to
> supply your own ExecutorService for the RabbitMQ Connection to use, and
> Java supplies some standard ExecutorService implementations which allow
> you to do some of the management without considerable effort.
>

My requirements are simply to maximize throughput of my message 
consumption. Rolling my own dispatcher is probably a bit much. Any 
alternative configuration recommendations (to the single Connection, 
Channel, Consumer setup), for maximizing throughput would be appreciated.

Thanks,
Josh
 

> My general advice is that this might be a lot of work, and you should
> consider investing in a sophisticated system only if you have determined
> that you really need the advantages it might bring. Be aware that these
> may not include faster throughput, and might upset any ordering
> guarantees you may be relying upon at present.
>
> I hope this helps.
>
> Steve Powell  (a happy kitten)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in 
> childhood.
>
> On 22 Mar 2012, at 18:20, Josh Stone wrote:
>
> > I wanted to ask the experts since it's not clear to me - what is the 
> best way to parallelize message consumption from a single queue, using the 
> Java client? 
> > 
> > Thanks,
> > Josh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
On Monday, March 26, 2012 7:11:13 AM UTC-7, Steve Powell wrote:
>
> Hi Josh,
>
> In the absence of the experts -- you get me :-)
>
> Questions that start 'what is the best way to...' often have no
> definitive answer, I'm afraid; but here goes.
>
> First, I'm going to have to explain what I *think* you are asking about,
> before trying to answer it.
>
>   I assume you are asking about multiple Consumers, in a Java client, all
>   consuming from the same queue, allowing 'parallel' consumption -- which
>   I take to mean multi-threaded -- within the same Java client. You want
>   the 'best' application structure which achieves 'parallel' processing of 
>   messages from the queue.
>
> Well, there is nothing to stop you 'registering' the same Consumer
> instance more than once, with different consumer tags, so it is easy to
> drive multiple 'identical' Consumers. However, if you register
> (Channel.basicConsume()) on the same channel, the consumers will be
> called serially (this is done to preserve the ordering of messages
> processed on a channel).
>
> No doubt you've read the blurb on the Java Client API doc pages
> (http://www.rabbitmq.com/api-guide.html#consuming) which says:
>
> > Callbacks to Consumers are dispatched on a thread separate from the
> > thread managed by the Connection. This means that Consumers can safely
> > call blocking methods on the Connection or Channel, such asqueueDeclare,
> > txCommit, basicCancel or basicPublish.
> > 
> > Each Channel has its own dispatch thread. For the most common use case
> > of one Consumer per Channel, this means Consumers do not hold up other
> > Consumers. If you have multiple Consumers per Channel be aware that a
> > long-running Consumer may hold up dispatch of callbacks to other
> > Consumers on that Channel.
>
> and the section on advanced connection options mentions a thread-pool
> (by default containing 5 threads) associated with the connection.
>
> What this all means is that *on each channel* Consumer callbacks are
> called serially. No overlapping there, so no chance to consume 'in
> parallel', so distinct *channels* (on the same connection) are allowed
> to run their consumers in parallel (up to five may run concurrently, in
> the default case).
>
> So, to 'consume' messages in parallel from a single queue you need to
> have the consumers on separate channels. Now, if you define a single
> Consumer instance, and get it to be invoked on multiple threads
> concurrently (on separate channels) you have to be careful -- the code
> in your Consumer must be thread-safe, and probably more than just that,
> too. I'll assume you know what you are doing. If you create one Consumer
> instance for each channel, RabbitMQ will guarantee that each channel's
> Consumer is running on one thread, so the rules are simpler.
>
> There is another option. Provided you are prepared to separate
> consumption from processing (and possibly acknowledgement) you can
> register a single consumer which does very little except pass the
> message to another (worker) thread to do the actual processing. The
> Consumer doesn't have to be sophisticated, but your dispatching
> mechanism needs to be: you mustn't lose messages, and you must ensure
> that you acknowledge them at some point (which may not be straight
> away). Still, if you are adept at Java concurrent programming these are
> all achievable. By managing your own worker threads you can achieve your
> own dispatching and resource management rules, and by setting the
> pre-fetch count (Qos) and managing acknowledgements you can gate the
> amount of work done in parallel, and even decide which workers get which
> messages.
>
> Which of these is 'best' depends a lot on your requirements. If you need
> just a little more control over the processing threads but don't want to
> 'roll-your-own' dispatcher mechanism there is an option for you to
> supply your own ExecutorService for the RabbitMQ Connection to use, and
> Java supplies some standard ExecutorService implementations which allow
> you to do some of the management without considerable effort.
>
> My general advice is that this might be a lot of work, and you should
> consider investing in a sophisticated system only if you have determined
> that you really need the advantages it might bring. Be aware that these
> may not include faster throughput, and might upset any ordering
> guarantees you may be relying upon at present.
>
> I hope this helps.
>
> Steve Powell  (a happy kitten)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in 
> childhood.
>
> On 22 Mar 2012, at 18:20, Josh Stone wrote:
>
> > I wanted to ask the experts since it's not clear to me - what is the 
> best way to parallelize message consumption from a single queue, using the 
> Java client? 
> > 
> > Thanks,
> > Josh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
On Monday, March 26, 2012 7:11:13 AM UTC-7, Steve Powell wrote:
>
> Hi Josh,
>
> In the absence of the experts -- you get me :-)
>
> Questions that start 'what is the best way to...' often have no
> definitive answer, I'm afraid; but here goes.
>
> First, I'm going to have to explain what I *think* you are asking about,
> before trying to answer it.
>
>   I assume you are asking about multiple Consumers, in a Java client, all
>   consuming from the same queue, allowing 'parallel' consumption -- which
>   I take to mean multi-threaded -- within the same Java client. You want
>   the 'best' application structure which achieves 'parallel' processing of 
>   messages from the queue.
>
> Well, there is nothing to stop you 'registering' the same Consumer
> instance more than once, with different consumer tags, so it is easy to
> drive multiple 'identical' Consumers. However, if you register
> (Channel.basicConsume()) on the same channel, the consumers will be
> called serially (this is done to preserve the ordering of messages
> processed on a channel).
>
> No doubt you've read the blurb on the Java Client API doc pages
> (http://www.rabbitmq.com/api-guide.html#consuming) which says:
>
> > Callbacks to Consumers are dispatched on a thread separate from the
> > thread managed by the Connection. This means that Consumers can safely
> > call blocking methods on the Connection or Channel, such asqueueDeclare,
> > txCommit, basicCancel or basicPublish.
> > 
> > Each Channel has its own dispatch thread. For the most common use case
> > of one Consumer per Channel, this means Consumers do not hold up other
> > Consumers. If you have multiple Consumers per Channel be aware that a
> > long-running Consumer may hold up dispatch of callbacks to other
> > Consumers on that Channel.
>
> and the section on advanced connection options mentions a thread-pool
> (by default containing 5 threads) associated with the connection.
>
> What this all means is that *on each channel* Consumer callbacks are
> called serially. No overlapping there, so no chance to consume 'in
> parallel', so distinct *channels* (on the same connection) are allowed
> to run their consumers in parallel (up to five may run concurrently, in
> the default case).
>
> So, to 'consume' messages in parallel from a single queue you need to
> have the consumers on separate channels. Now, if you define a single
> Consumer instance, and get it to be invoked on multiple threads
> concurrently (on separate channels) you have to be careful -- the code
> in your Consumer must be thread-safe, and probably more than just that,
> too. I'll assume you know what you are doing. If you create one Consumer
> instance for each channel, RabbitMQ will guarantee that each channel's
> Consumer is running on one thread, so the rules are simpler.
>
> There is another option. Provided you are prepared to separate
> consumption from processing (and possibly acknowledgement) you can
> register a single consumer which does very little except pass the
> message to another (worker) thread to do the actual processing. The
> Consumer doesn't have to be sophisticated, but your dispatching
> mechanism needs to be: you mustn't lose messages, and you must ensure
> that you acknowledge them at some point (which may not be straight
> away). Still, if you are adept at Java concurrent programming these are
> all achievable. By managing your own worker threads you can achieve your
> own dispatching and resource management rules, and by setting the
> pre-fetch count (Qos) and managing acknowledgements you can gate the
> amount of work done in parallel, and even decide which workers get which
> messages.
>
> Which of these is 'best' depends a lot on your requirements. If you need
> just a little more control over the processing threads but don't want to
> 'roll-your-own' dispatcher mechanism there is an option for you to
> supply your own ExecutorService for the RabbitMQ Connection to use, and
> Java supplies some standard ExecutorService implementations which allow
> you to do some of the management without considerable effort.
>
> My general advice is that this might be a lot of work, and you should
> consider investing in a sophisticated system only if you have determined
> that you really need the advantages it might bring. Be aware that these
> may not include faster throughput, and might upset any ordering
> guarantees you may be relying upon at present.
>
> I hope this helps.
>
> Steve Powell  (a happy kitten)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in 
> childhood.
>
> On 22 Mar 2012, at 18:20, Josh Stone wrote:
>
> > I wanted to ask the experts since it's not clear to me - what is the 
> best way to parallelize message consumption from a single queue, using the 
> Java client? 
> > 
> > Thanks,
> > Josh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
On Monday, March 26, 2012 7:11:13 AM UTC-7, Steve Powell wrote:
>
> Hi Josh,
>
> In the absence of the experts -- you get me :-)
>
> Questions that start 'what is the best way to...' often have no
> definitive answer, I'm afraid; but here goes.
>
> First, I'm going to have to explain what I *think* you are asking about,
> before trying to answer it.
>
>   I assume you are asking about multiple Consumers, in a Java client, all
>   consuming from the same queue, allowing 'parallel' consumption -- which
>   I take to mean multi-threaded -- within the same Java client. You want
>   the 'best' application structure which achieves 'parallel' processing of 
>   messages from the queue.
>
> Well, there is nothing to stop you 'registering' the same Consumer
> instance more than once, with different consumer tags, so it is easy to
> drive multiple 'identical' Consumers. However, if you register
> (Channel.basicConsume()) on the same channel, the consumers will be
> called serially (this is done to preserve the ordering of messages
> processed on a channel).
>
> No doubt you've read the blurb on the Java Client API doc pages
> (http://www.rabbitmq.com/api-guide.html#consuming) which says:
>
> > Callbacks to Consumers are dispatched on a thread separate from the
> > thread managed by the Connection. This means that Consumers can safely
> > call blocking methods on the Connection or Channel, such asqueueDeclare,
> > txCommit, basicCancel or basicPublish.
> > 
> > Each Channel has its own dispatch thread. For the most common use case
> > of one Consumer per Channel, this means Consumers do not hold up other
> > Consumers. If you have multiple Consumers per Channel be aware that a
> > long-running Consumer may hold up dispatch of callbacks to other
> > Consumers on that Channel.
>
> and the section on advanced connection options mentions a thread-pool
> (by default containing 5 threads) associated with the connection.
>
> What this all means is that *on each channel* Consumer callbacks are
> called serially. No overlapping there, so no chance to consume 'in
> parallel', so distinct *channels* (on the same connection) are allowed
> to run their consumers in parallel (up to five may run concurrently, in
> the default case).
>
> So, to 'consume' messages in parallel from a single queue you need to
> have the consumers on separate channels. Now, if you define a single
> Consumer instance, and get it to be invoked on multiple threads
> concurrently (on separate channels) you have to be careful -- the code
> in your Consumer must be thread-safe, and probably more than just that,
> too. I'll assume you know what you are doing. If you create one Consumer
> instance for each channel, RabbitMQ will guarantee that each channel's
> Consumer is running on one thread, so the rules are simpler.
>
> There is another option. Provided you are prepared to separate
> consumption from processing (and possibly acknowledgement) you can
> register a single consumer which does very little except pass the
> message to another (worker) thread to do the actual processing. The
> Consumer doesn't have to be sophisticated, but your dispatching
> mechanism needs to be: you mustn't lose messages, and you must ensure
> that you acknowledge them at some point (which may not be straight
> away). Still, if you are adept at Java concurrent programming these are
> all achievable. By managing your own worker threads you can achieve your
> own dispatching and resource management rules, and by setting the
> pre-fetch count (Qos) and managing acknowledgements you can gate the
> amount of work done in parallel, and even decide which workers get which
> messages.
>
> Which of these is 'best' depends a lot on your requirements. If you need
> just a little more control over the processing threads but don't want to
> 'roll-your-own' dispatcher mechanism there is an option for you to
> supply your own ExecutorService for the RabbitMQ Connection to use, and
> Java supplies some standard ExecutorService implementations which allow
> you to do some of the management without considerable effort.
>
> My general advice is that this might be a lot of work, and you should
> consider investing in a sophisticated system only if you have determined
> that you really need the advantages it might bring. Be aware that these
> may not include faster throughput, and might upset any ordering
> guarantees you may be relying upon at present.
>
> I hope this helps.
>
> Steve Powell  (a happy kitten)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in 
> childhood.
>
> On 22 Mar 2012, at 18:20, Josh Stone wrote:
>
> > I wanted to ask the experts since it's not clear to me - what is the 
> best way to parallelize message consumption from a single queue, using the 
> Java client? 
> > 
> > Thanks,
> > Josh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
On Monday, March 26, 2012 7:11:13 AM UTC-7, Steve Powell wrote:
>
> Hi Josh,
>
> In the absence of the experts -- you get me :-)
>
> Questions that start 'what is the best way to...' often have no
> definitive answer, I'm afraid; but here goes.
>
> First, I'm going to have to explain what I *think* you are asking about,
> before trying to answer it.
>
>   I assume you are asking about multiple Consumers, in a Java client, all
>   consuming from the same queue, allowing 'parallel' consumption -- which
>   I take to mean multi-threaded -- within the same Java client. You want
>   the 'best' application structure which achieves 'parallel' processing of 
>   messages from the queue.
>
> Well, there is nothing to stop you 'registering' the same Consumer
> instance more than once, with different consumer tags, so it is easy to
> drive multiple 'identical' Consumers. However, if you register
> (Channel.basicConsume()) on the same channel, the consumers will be
> called serially (this is done to preserve the ordering of messages
> processed on a channel).
>
> No doubt you've read the blurb on the Java Client API doc pages
> (http://www.rabbitmq.com/api-guide.html#consuming) which says:
>
> > Callbacks to Consumers are dispatched on a thread separate from the
> > thread managed by the Connection. This means that Consumers can safely
> > call blocking methods on the Connection or Channel, such asqueueDeclare,
> > txCommit, basicCancel or basicPublish.
> > 
> > Each Channel has its own dispatch thread. For the most common use case
> > of one Consumer per Channel, this means Consumers do not hold up other
> > Consumers. If you have multiple Consumers per Channel be aware that a
> > long-running Consumer may hold up dispatch of callbacks to other
> > Consumers on that Channel.
>
> and the section on advanced connection options mentions a thread-pool
> (by default containing 5 threads) associated with the connection.
>
> What this all means is that *on each channel* Consumer callbacks are
> called serially. No overlapping there, so no chance to consume 'in
> parallel', so distinct *channels* (on the same connection) are allowed
> to run their consumers in parallel (up to five may run concurrently, in
> the default case).
>
> So, to 'consume' messages in parallel from a single queue you need to
> have the consumers on separate channels. Now, if you define a single
> Consumer instance, and get it to be invoked on multiple threads
> concurrently (on separate channels) you have to be careful -- the code
> in your Consumer must be thread-safe, and probably more than just that,
> too. I'll assume you know what you are doing. If you create one Consumer
> instance for each channel, RabbitMQ will guarantee that each channel's
> Consumer is running on one thread, so the rules are simpler.
>
> There is another option. Provided you are prepared to separate
> consumption from processing (and possibly acknowledgement) you can
> register a single consumer which does very little except pass the
> message to another (worker) thread to do the actual processing. The
> Consumer doesn't have to be sophisticated, but your dispatching
> mechanism needs to be: you mustn't lose messages, and you must ensure
> that you acknowledge them at some point (which may not be straight
> away). Still, if you are adept at Java concurrent programming these are
> all achievable. By managing your own worker threads you can achieve your
> own dispatching and resource management rules, and by setting the
> pre-fetch count (Qos) and managing acknowledgements you can gate the
> amount of work done in parallel, and even decide which workers get which
> messages.
>
> Which of these is 'best' depends a lot on your requirements. If you need
> just a little more control over the processing threads but don't want to
> 'roll-your-own' dispatcher mechanism there is an option for you to
> supply your own ExecutorService for the RabbitMQ Connection to use, and
> Java supplies some standard ExecutorService implementations which allow
> you to do some of the management without considerable effort.
>
> My general advice is that this might be a lot of work, and you should
> consider investing in a sophisticated system only if you have determined
> that you really need the advantages it might bring. Be aware that these
> may not include faster throughput, and might upset any ordering
> guarantees you may be relying upon at present.
>
> I hope this helps.
>
> Steve Powell  (a happy kitten)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in 
> childhood.
>
> On 22 Mar 2012, at 18:20, Josh Stone wrote:
>
> > I wanted to ask the experts since it's not clear to me - what is the 
> best way to parallelize message consumption from a single queue, using the 
> Java client? 
> > 
> > Thanks,
> > Josh
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/02f3fb2d/attachment.htm>

From henri.pipe at gmail.com  Tue Mar 27 02:12:45 2012
From: henri.pipe at gmail.com (Henri Pipe)
Date: Mon, 26 Mar 2012 18:12:45 -0700
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
Message-ID: <CACz7V9mNES7KrjS0K+wfAF1nhTeiqH-_R+k+Rj7GW5pc08UZuQ@mail.gmail.com>

Hello,

Looking for ideas on how to collect snmp stats for rabbitmq queues.

I am running version 2.8.1 on linux

I looked into Scott Brooks' nagios plugin on github, but that was developed
for version 1.7.1 and I have had problems with it.

I have installed the nagios plugins developed by James Casey. Thank you
James.
https://github.com/jamesc/nagios-plugins-rabbitmq

However, I need more detailed queue stats.

Any suggestions?

I am also looking at RockSteady if anyone has any experience?

Thanks

Henri Pipe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/f6f31d9b/attachment.htm>

From jerryk at vmware.com  Tue Mar 27 02:26:29 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 26 Mar 2012 18:26:29 -0700 (PDT)
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
In-Reply-To: <CACz7V9mNES7KrjS0K+wfAF1nhTeiqH-_R+k+Rj7GW5pc08UZuQ@mail.gmail.com>
Message-ID: <30664589.583.1332811587856.JavaMail.jerryk@StrongMad.local>

Hi, Henri:

You might consider using the Rabbit management HTTP API from scripts that run
at Nagio's behest to monitor Rabbit.  The API exposes a huge wealth of info
on broker state and doesn't require you to add any plugins to the mix.

The very soon to release book "RabbitMQ in Action" by Williams and Videla (who
both lurk on this list) has a nice treatment of monitoring Rabbits in this way...
It's also currently available as a preview ebook, and I think their sample code
is on GitHub as well.

Best regards,
Jerry

----- Original Message -----
From: "Henri Pipe" <henri.pipe at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 26, 2012 6:12:45 PM
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?


Hello, 

Looking for ideas on how to collect snmp stats for rabbitmq queues. 

I am running version 2.8.1 on linux 

I looked into Scott Brooks' nagios plugin on github, but that was developed for version 1.7.1 and I have had problems with it. 

I have installed the nagios plugins developed by James Casey. Thank you James. 
https://github.com/jamesc/nagios-plugins-rabbitmq 

However, I need more detailed queue stats. 

Any suggestions? 

I am also looking at RockSteady if anyone has any experience? 

Thanks 

Henri Pipe 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From henri.pipe at gmail.com  Tue Mar 27 02:35:51 2012
From: henri.pipe at gmail.com (Henri Pipe)
Date: Mon, 26 Mar 2012 18:35:51 -0700
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
In-Reply-To: <30664589.583.1332811587856.JavaMail.jerryk@StrongMad.local>
References: <CACz7V9mNES7KrjS0K+wfAF1nhTeiqH-_R+k+Rj7GW5pc08UZuQ@mail.gmail.com>
	<30664589.583.1332811587856.JavaMail.jerryk@StrongMad.local>
Message-ID: <CACz7V9kSt+0wyinqOO_h25dMz2_ECMjqZEVfM2nhPr=bpJJzTQ@mail.gmail.com>

Hello Jerry,

Thanks much for getting back to me. I have been utilizing the API with the
James Casey plugins.

However, I need more detailed information. I have been looking at this API
call resource.

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_6_1/priv/www/api/index.html

which is quite helpful.

I guess I can build my own plugins with this information. If you know of
any more detailed api info, please let me know.

Thanks much Jerry,

Henri Pipe


On Mon, Mar 26, 2012 at 6:26 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Henri:
>
> You might consider using the Rabbit management HTTP API from scripts that
> run
> at Nagio's behest to monitor Rabbit.  The API exposes a huge wealth of info
> on broker state and doesn't require you to add any plugins to the mix.
>
> The very soon to release book "RabbitMQ in Action" by Williams and Videla
> (who
> both lurk on this list) has a nice treatment of monitoring Rabbits in this
> way...
> It's also currently available as a preview ebook, and I think their sample
> code
> is on GitHub as well.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Henri Pipe" <henri.pipe at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, March 26, 2012 6:12:45 PM
> Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
>
>
> Hello,
>
> Looking for ideas on how to collect snmp stats for rabbitmq queues.
>
> I am running version 2.8.1 on linux
>
> I looked into Scott Brooks' nagios plugin on github, but that was
> developed for version 1.7.1 and I have had problems with it.
>
> I have installed the nagios plugins developed by James Casey. Thank you
> James.
> https://github.com/jamesc/nagios-plugins-rabbitmq
>
> However, I need more detailed queue stats.
>
> Any suggestions?
>
> I am also looking at RockSteady if anyone has any experience?
>
> Thanks
>
> Henri Pipe
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/2e0b7365/attachment.htm>

From jerryk at vmware.com  Tue Mar 27 02:47:00 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 26 Mar 2012 18:47:00 -0700 (PDT)
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
In-Reply-To: <CACz7V9kSt+0wyinqOO_h25dMz2_ECMjqZEVfM2nhPr=bpJJzTQ@mail.gmail.com>
Message-ID: <23414343.598.1332812818036.JavaMail.jerryk@StrongMad.local>

I think the link you send may be the state of the art on our officially provided
docs on the management API...  Jason and Alvaro's book covers the how-to ground well,
and mated against this stuff as reference should get you off to the races...

Best regards,
Jerry

----- Original Message -----
From: "Henri Pipe" <henri.pipe at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, March 26, 2012 6:35:51 PM
Subject: Re: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?

Hello Jerry, 

Thanks much for getting back to me. I have been utilizing the API with the James Casey plugins. 

However, I need more detailed information. I have been looking at this API call resource. 

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_6_1/priv/www/api/index.html 

which is quite helpful. 

I guess I can build my own plugins with this information. If you know of any more detailed api info, please let me know. 

Thanks much Jerry, 

Henri Pipe 



On Mon, Mar 26, 2012 at 6:26 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Henri: 

You might consider using the Rabbit management HTTP API from scripts that run 
at Nagio's behest to monitor Rabbit. The API exposes a huge wealth of info 
on broker state and doesn't require you to add any plugins to the mix. 

The very soon to release book "RabbitMQ in Action" by Williams and Videla (who 
both lurk on this list) has a nice treatment of monitoring Rabbits in this way... 
It's also currently available as a preview ebook, and I think their sample code 
is on GitHub as well. 

Best regards, 
Jerry 



----- Original Message ----- 
From: "Henri Pipe" < henri.pipe at gmail.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, March 26, 2012 6:12:45 PM 
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1? 


Hello, 

Looking for ideas on how to collect snmp stats for rabbitmq queues. 

I am running version 2.8.1 on linux 

I looked into Scott Brooks' nagios plugin on github, but that was developed for version 1.7.1 and I have had problems with it. 

I have installed the nagios plugins developed by James Casey. Thank you James. 
https://github.com/jamesc/nagios-plugins-rabbitmq 

However, I need more detailed queue stats. 

Any suggestions? 

I am also looking at RockSteady if anyone has any experience? 

Thanks 

Henri Pipe 

_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From emile at rabbitmq.com  Tue Mar 27 10:47:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Mar 2012 10:47:18 +0100
Subject: [rabbitmq-discuss] heartbeat bug
In-Reply-To: <CAHiEoM5SwYs3wr3QDj2KZgcuOS=Af1o=CNbAvWJqU=NF=pASqw@mail.gmail.com>
References: <CAHiEoM5SwYs3wr3QDj2KZgcuOS=Af1o=CNbAvWJqU=NF=pASqw@mail.gmail.com>
Message-ID: <4F718CA6.8070008@rabbitmq.com>


Hi Aaron,

On 26/03/12 21:01, Aaron Westendorf wrote:
> required to do so. At this time, haigha only responds to heartbeats
> and does not initiate a client-side loop. As far as I know and have
> observed in other implementations, this is standard practice. In other
> words, I think both client and server are operating within spec.

If a client requests heartbeats then it must be able to send heartbeats
actively (after connection.tune). Depending on the traffic patterns, a
client that only echoes server heartbeats will not satisfy the
requirements of the spec. If traffic becomes one-way (e.g. asynchronous
calls from the server to the client like basic.deliver) then an echoing
client will not send enough heartbeats and the server will drop the
connection. It looks like that is what your trace shows.

If a client does not implement heartbeating then it must request no
heartbeats during connection tuning, and not send any heartbeats. If you
are aware of other RabbitMQ clients with the same problem then please
let us know so that the authors can be alerted.


-Emile


From simon at rabbitmq.com  Tue Mar 27 10:46:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 10:46:36 +0100
Subject: [rabbitmq-discuss] nagios snmp plugin for version 2.8.1?
In-Reply-To: <CACz7V9mNES7KrjS0K+wfAF1nhTeiqH-_R+k+Rj7GW5pc08UZuQ@mail.gmail.com>
References: <CACz7V9mNES7KrjS0K+wfAF1nhTeiqH-_R+k+Rj7GW5pc08UZuQ@mail.gmail.com>
Message-ID: <4F718C7C.407@rabbitmq.com>

On 27/03/12 02:12, Henri Pipe wrote:
> I have installed the nagios plugins developed by James Casey. Thank you
> James.
> https://github.com/jamesc/nagios-plugins-rabbitmq
>
> However, I need more detailed queue stats.

It looks like this already talks to the mgmt HTTP interface, so it might 
be a good candidate to start from.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jaaaelpumuki at gmail.com  Tue Mar 27 01:12:13 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix?=)
Date: Mon, 26 Mar 2012 17:12:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Default vhost and Http API
Message-ID: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>

Due to the default vhost's name is "/" i'm having troubles with some
tools, for example SoapUI, because they're always making the request
like "api/queues///queue_name/contents/", this also happens with the
chrome's bookmarks  (https://gist.github.com/2172067)

So I'm wondering if something can be done, for instance:
 - Change the name, root or default isntead of /
 - If there isn't a vhost in the url then use the default. (this can
complicate a lot the url mapper)


Thanks, F?lix

From henri.pipe at gmail.com  Tue Mar 27 01:36:06 2012
From: henri.pipe at gmail.com (Henri Pipe)
Date: Mon, 26 Mar 2012 17:36:06 -0700
Subject: [rabbitmq-discuss] nagios snmp plugin for v2.8.1
Message-ID: <CACz7V9nCq1qM31nqRa0tBGxQ_aWs2hzVxk+m=4+44uQmi88=jg@mail.gmail.com>

Hello,

Looking for ideas on how to collect snmp stats for rabbitmq queues.

I am running version 2.8.1 on linux

I looked into Scott Brooks' nagios plugin on github, but that was developed
for version 1.7.1 and I have had problems with it.

I have installed the nagios plugins developed by James Casey. Thank you
James.
https://github.com/jamesc/nagios-plugins-rabbitmq

However, I need more detailed queue stats.

Any suggestions?

Thanks

Henri Pipe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120326/3838adaf/attachment.htm>

From nickjosevski at gmail.com  Tue Mar 27 03:05:41 2012
From: nickjosevski at gmail.com (Nick Josevski)
Date: Mon, 26 Mar 2012 19:05:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Manual service stop or start via
 rabbitmq-service.bat on Windows has an %APPDATA% path bug.
Message-ID: <03306f5c-333c-4a13-b66e-81d7e6317d8f@x5g2000pbl.googlegroups.com>

I tried to enable the management web feature via rabbitmq-plugins, but
somewhere during the process of enabling, stopping, installing,
starting the service back up again. A rogue '%APPDATA%' folder was
created in the sbin folder. In my case C:\Program Files (x86)\RabbitMQ
Server\rabbitmq_server-2.8.1\sbin

I've experienced this issue on versions 2.7.1 and 2.8.1.

The worst part of this is once that happened, I kept getting nodedown
errors when trying to do anything even via the reset and force_reset
commands.

My solution was to uninstall RabbitMQ, delete all the folders (in
AppData and in Program Files), then go further to uninstall and re-
install Erlang, all with reboots scattered throughout to ensure
nothing was left behind.

To finally enable the rabbitmq_management plugin I had to just enable
it via the rabbitmq-plugins, **not** run stop or install or start via
rabbitmq-service.bat, but instead go into Services and just re-start
the RabbitMQ service via right click > start.

From emile at rabbitmq.com  Tue Mar 27 11:01:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Mar 2012 11:01:10 +0100
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
Message-ID: <4F718FE6.5040207@rabbitmq.com>

Hi F?lix,

On 27/03/12 01:12, F?lix wrote:
> Due to the default vhost's name is "/" i'm having troubles with some
> tools, for example SoapUI, because they're always making the request
> like "api/queues///queue_name/contents/", this also happens with the
> chrome's bookmarks  (https://gist.github.com/2172067)

A solution that normally works is to escape the "/" as "%2F".
You are also free to declare a different vhost and name it in a way that
sidesteps this problem.

See the spec for more details about AMQP URIs:
http://www.rabbitmq.com/uri-spec.html


-Emile


From simon at rabbitmq.com  Tue Mar 27 11:02:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 11:02:55 +0100
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
Message-ID: <4F71904F.8060100@rabbitmq.com>

On 27/03/12 01:12, F?lix wrote:
> Due to the default vhost's name is "/" i'm having troubles with some
> tools, for example SoapUI, because they're always making the request
> like "api/queues///queue_name/contents/", this also happens with the
> chrome's bookmarks  (https://gist.github.com/2172067)

The vhost name should be URL escaped - so "/" becomes "%2f".

> So I'm wondering if something can be done, for instance:
>   - Change the name, root or default isntead of /

It's a slightly unfortunate name. But there's nothing to stop people 
from creating other vhosts with names containing "/" or "?". Or "?" or " 
?" or lots of other characters that would need escaping. And it's not 
just vhosts either, queues and exchanges and users and bindings all have 
names (ish in the case of bindings).

Bottom line is, we'll always need escaping. And at least having the 
default vhost require it means people need to get this at least partly 
right in their tools ;-)

>   - If there isn't a vhost in the url then use the default. (this can
> complicate a lot the url mapper)

I think this would ultimately be more confusing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 27 11:04:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 11:04:59 +0100
Subject: [rabbitmq-discuss] Strange Behavior with Queues - 2.8.1
In-Reply-To: <4F709B5C.3080600@aol.com>
References: <4F709B5C.3080600@aol.com>
Message-ID: <4F7190CB.9010704@rabbitmq.com>

On 26/03/12 17:37, DawgTool wrote:
>
> Having some strange behavior with queues on 2.8.1.
> If I publish to host 1 and the queue is on host 1, messages seem to flow
> correctly.
> If I publish to host 1 and the queue is on host 2, message start then
> are blocked (flow control) and the servers become unresponsive to queue
> deletes, connections, etc.

You're talking about clustering, not shovel / federation, right?

> Anyone else seeing this behavior?

Afraid not - I just sanity checked this myself and it works fine.

You definitely have *both* cluster nodes on 2.8.1?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 27 11:09:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 11:09:04 +0100
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <20120326161454.GA14190@mawhrin.net>
References: <20120322191055.GA3358@mawhrin.net>
	<4F6C5483.9010209@rabbitmq.com>	<20120323183418.GA1409@mawhrin.net>
	<4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net>
Message-ID: <4F7191C0.1030400@rabbitmq.com>

On 26/03/12 17:14, Mikhail Sobolev wrote:
> I somehow overlooked the abovementioned page, thank you.
>
> Any suggestions on how to prevent stacking up the "undelivered"
> messages?

At the moment, the best I can suggest is to have some external process 
that looks for queues with 0 consumers and deletes them. Ugh.

Alternatively, some sort of AMQP proxy that modifies queue.declares that 
don't have the "right" properties. The Java Tracer may be a starting point.

But neither of these are that great. Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From timya15 at gmail.com  Tue Mar 27 11:09:14 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Tue, 27 Mar 2012 15:39:14 +0530
Subject: [rabbitmq-discuss] Multiple nodes on single box
Message-ID: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>

Having Ubuntu 10.04, wanted to get two rabbitmq nodes up on one machine.
There is documentation available for single-machine cluster on *
http://www.rabbitmq.com/clustering.html#single-machine*.
But I need to create two rabbitmq nodes (viz. rabbit1 and hare1) which
should reffer their respective rabbitmq.config file for setting up shovel
and listners for tcp/web-access/management. Is there any document available
to setup multiple rabbitmq nodes on one machine or any other way to
accomplish the same.

Regards,
Timya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/c0b48c07/attachment.htm>

From simon at rabbitmq.com  Tue Mar 27 11:12:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 11:12:44 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
Message-ID: <4F71929C.7070009@rabbitmq.com>

On 27/03/12 11:09, Timya Tortus wrote:
> Having Ubuntu 10.04, wanted to get two rabbitmq nodes up on one machine.
> There is documentation available for single-machine cluster on
> /http://www.rabbitmq.com/clustering.html#single-machine/.
> But I need to create two rabbitmq nodes (viz. rabbit1 and hare1) which
> should reffer their respective rabbitmq.config file for setting up
> shovel and listners for tcp/web-access/management. Is there any document
> available to setup multiple rabbitmq nodes on one machine or any other
> way to accomplish the same.

Basically the same concept, just don't cluster them.

You should probably read:

http://www.rabbitmq.com/relocate.html

You might be able to get away with just setting $RABBITMQ_BASE.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Tue Mar 27 11:16:26 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Tue, 27 Mar 2012 12:16:26 +0200
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F7191C0.1030400@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net>
	<4F7191C0.1030400@rabbitmq.com>
Message-ID: <CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>

You could write a custom middleware (to modify the queue.declares) for:
https://github.com/brendanhay/myxi
Example for adding x-ha-policy:
https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl

Although, as the author, I wouldn't recommend it (yet) =)

On Tue, Mar 27, 2012 at 12:09 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 26/03/12 17:14, Mikhail Sobolev wrote:
>
>> I somehow overlooked the abovementioned page, thank you.
>>
>> Any suggestions on how to prevent stacking up the "undelivered"
>> messages?
>>
>
> At the moment, the best I can suggest is to have some external process
> that looks for queues with 0 consumers and deletes them. Ugh.
>
> Alternatively, some sort of AMQP proxy that modifies queue.declares that
> don't have the "right" properties. The Java Tracer may be a starting point.
>
> But neither of these are that great. Hmm.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/bf9934d3/attachment.htm>

From simon at rabbitmq.com  Tue Mar 27 11:17:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 11:17:59 +0100
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
References: <20120322191055.GA3358@mawhrin.net>	<4F6C5483.9010209@rabbitmq.com>	<20120323183418.GA1409@mawhrin.net>	<4F706CA5.4090602@rabbitmq.com>	<20120326161454.GA14190@mawhrin.net>	<4F7191C0.1030400@rabbitmq.com>
	<CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
Message-ID: <4F7193D7.801@rabbitmq.com>

On 27/03/12 11:16, Brendan Hay wrote:
> You could write a custom middleware (to modify the queue.declares) for:
> https://github.com/brendanhay/myxi
> Example for adding x-ha-policy:
> https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl

Ooh, interesting!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Tue Mar 27 11:26:02 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 27 Mar 2012 11:26:02 +0100
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <4F7193D7.801@rabbitmq.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net>
	<4F7191C0.1030400@rabbitmq.com>
	<CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
	<4F7193D7.801@rabbitmq.com>
Message-ID: <CACOPnvewgTMthiTHt2Dwg2DUfY5Jdv7-hXvBbY99N46SLUsBEA@mail.gmail.com>

Good choice of project name Brendan ;-)


On Tue, Mar 27, 2012 at 11:17 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 27/03/12 11:16, Brendan Hay wrote:
>>
>> You could write a custom middleware (to modify the queue.declares) for:
>> https://github.com/brendanhay/myxi
>> Example for adding x-ha-policy:
>>
>> https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl
>
>
> Ooh, interesting!
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Tue Mar 27 11:32:37 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 27 Mar 2012 11:32:37 +0100
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <CAM8fPiT_7NL=qL62q8f+nh_Q8whbh7igfZixd_E_okFynGvn-Q@mail.gmail.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
	<D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
	<CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>
	<ACE38020-6EE4-43DE-9EBD-C574257BCFD2@jefftrout.com>
	<CAM8fPiT_7NL=qL62q8f+nh_Q8whbh7igfZixd_E_okFynGvn-Q@mail.gmail.com>
Message-ID: <17CFF6C1-56CE-4DE5-B50C-52602D913AA0@rabbitmq.com>

Yup, I missed that (I did say IDKE).  Thanks.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 26 Mar 2012, at 17:26, Tony Garnock-Jones wrote:

> Hi Jeff,
> 
> Ah! I hadn't actually seen the patch, but I just went hunting through the archives to find the root of this thread. Yep.
> 
> Steve, am I right in thinking your objections apply to the "exclusive" argument to queue.declare, rather than that to basic.consume? It seems to me that supporting "exclusive" for basic.consume would be a useful addition to the STOMP adapter.
> 
> Regards,
>   Tony
> 
> 
> On 26 March 2012 11:39, Jeff <jeff at jefftrout.com> wrote: 
> ...  
>  
> > You're probably looking for the "exclusive" argument to *basic.consume* rather than queue.declare.
> 
> Yep - that is what this patch does - it allows us to pass in the exclusive argument to basic.consume in the stomp wrapper (it was previous hardcoded to be false)
>  
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/


From emile at rabbitmq.com  Tue Mar 27 11:41:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Mar 2012 11:41:16 +0100
Subject: [rabbitmq-discuss] Manual service stop or start via
 rabbitmq-service.bat on Windows has an %APPDATA% path bug.
In-Reply-To: <03306f5c-333c-4a13-b66e-81d7e6317d8f@x5g2000pbl.googlegroups.com>
References: <03306f5c-333c-4a13-b66e-81d7e6317d8f@x5g2000pbl.googlegroups.com>
Message-ID: <4F71994C.6040609@rabbitmq.com>

Hi Nick,

On 27/03/12 03:05, Nick Josevski wrote:
> I tried to enable the management web feature via rabbitmq-plugins, but
> somewhere during the process of enabling, stopping, installing,
> starting the service back up again. A rogue '%APPDATA%' folder was
> created in the sbin folder. In my case C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.1\sbin
> 
> I've experienced this issue on versions 2.7.1 and 2.8.1.

The default script folder for v2.8.1 is
C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.1\sbin

If you select a different installation folder (such as C:\Program Files
(x86)) then the scripts will be installed in the folder you quoted.

> The worst part of this is once that happened, I kept getting nodedown
> errors when trying to do anything even via the reset and force_reset
> commands.

This is unlikely to be related to the installation path. Have you tried
the advice in the troubleshooting guide?
http://www.rabbitmq.com/troubleshooting.html

> My solution was to uninstall RabbitMQ, delete all the folders (in
> AppData and in Program Files), then go further to uninstall and re-
> install Erlang, all with reboots scattered throughout to ensure
> nothing was left behind.

The uninstaller should do that for you. It should not be necessary to
re-install Erlang.

> To finally enable the rabbitmq_management plugin I had to just enable
> it via the rabbitmq-plugins, **not** run stop or install or start via
> rabbitmq-service.bat, but instead go into Services and just re-start
> the RabbitMQ service via right click > start.

This is incorrect. Restarting the broker is not sufficient for enabling
plugins when running as a service. You must reinstall the service.


-Emile



From brendan at soundcloud.com  Tue Mar 27 11:45:19 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Tue, 27 Mar 2012 12:45:19 +0200
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <CACOPnvewgTMthiTHt2Dwg2DUfY5Jdv7-hXvBbY99N46SLUsBEA@mail.gmail.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net>
	<4F7191C0.1030400@rabbitmq.com>
	<CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
	<4F7193D7.801@rabbitmq.com>
	<CACOPnvewgTMthiTHt2Dwg2DUfY5Jdv7-hXvBbY99N46SLUsBEA@mail.gmail.com>
Message-ID: <CAHZsVQY_71k-+ssKHzkNT137iR956Y9we8Mi=WY2EBh_TN23gA@mail.gmail.com>

Hmm, wasn't sure if anyone outside of Aus/NZ would get the joke =)


On Tue, Mar 27, 2012 at 12:26 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Good choice of project name Brendan ;-)
>
>
> On Tue, Mar 27, 2012 at 11:17 AM, Simon MacMullen <simon at rabbitmq.com>
> wrote:
> > On 27/03/12 11:16, Brendan Hay wrote:
> >>
> >> You could write a custom middleware (to modify the queue.declares) for:
> >> https://github.com/brendanhay/myxi
> >> Example for adding x-ha-policy:
> >>
> >>
> https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl
> >
> >
> > Ooh, interesting!
> >
> >
> > Cheers, Simon
> >
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/2181eee4/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 27 12:49:59 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Tue, 27 Mar 2012 13:49:59 +0200
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <CAHZsVQY_71k-+ssKHzkNT137iR956Y9we8Mi=WY2EBh_TN23gA@mail.gmail.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net> <4F7191C0.1030400@rabbitmq.com>
	<CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
	<4F7193D7.801@rabbitmq.com>
	<CACOPnvewgTMthiTHt2Dwg2DUfY5Jdv7-hXvBbY99N46SLUsBEA@mail.gmail.com>
	<CAHZsVQY_71k-+ssKHzkNT137iR956Y9we8Mi=WY2EBh_TN23gA@mail.gmail.com>
Message-ID: <CAFPidkOREq0sayCyT+Vz8WzTrtdnu5j0OQKb20O7D5b+hT0MZg@mail.gmail.com>

looks promising! thanks Brendan!

On Tue, Mar 27, 2012 at 12:45, Brendan Hay <brendan at soundcloud.com> wrote:
> Hmm, wasn't sure if anyone outside of Aus/NZ would get the joke =)
>
>
>
> On Tue, Mar 27, 2012 at 12:26 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Good choice of project name Brendan ;-)
>>
>>
>> On Tue, Mar 27, 2012 at 11:17 AM, Simon MacMullen <simon at rabbitmq.com>
>> wrote:
>> > On 27/03/12 11:16, Brendan Hay wrote:
>> >>
>> >> You could write a custom middleware (to modify the queue.declares) for:
>> >> https://github.com/brendanhay/myxi
>> >> Example for adding x-ha-policy:
>> >>
>> >>
>> >> https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl
>> >
>> >
>> > Ooh, interesting!
>> >
>> >
>> > Cheers, Simon
>> >
>> > --
>> > Simon MacMullen
>> > RabbitMQ, VMware
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From dawgtool at aol.com  Tue Mar 27 13:00:47 2012
From: dawgtool at aol.com (DawgTool)
Date: Tue, 27 Mar 2012 08:00:47 -0400
Subject: [rabbitmq-discuss] Strange Behavior with Queues - 2.8.1
In-Reply-To: <4F7190CB.9010704@rabbitmq.com>
References: <4F709B5C.3080600@aol.com> <4F7190CB.9010704@rabbitmq.com>
Message-ID: <4F71ABEF.1000309@aol.com>

Hi Simon,

I forgot to reply last night, I started the reinstall on 2.8.1 on the 
hosts and noticed that the second host was 2.7.9, after upgrade 
everything worked fine.
Sorry for the false alarm, strange that it allowed me into the cluster 
with a un-match version.

Thanks



On 3/27/12 6:04 AM, Simon MacMullen wrote:
> On 26/03/12 17:37, DawgTool wrote:
>>
>> Having some strange behavior with queues on 2.8.1.
>> If I publish to host 1 and the queue is on host 1, messages seem to flow
>> correctly.
>> If I publish to host 1 and the queue is on host 2, message start then
>> are blocked (flow control) and the servers become unresponsive to queue
>> deletes, connections, etc.
>
> You're talking about clustering, not shovel / federation, right?
>
>> Anyone else seeing this behavior?
>
> Afraid not - I just sanity checked this myself and it works fine.
>
> You definitely have *both* cluster nodes on 2.8.1?
>
> Cheers, Simon
>


From emile at rabbitmq.com  Tue Mar 27 13:15:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Mar 2012 13:15:37 +0100
Subject: [rabbitmq-discuss] rabbitmqctl script still broken in Ubuntu
 package
In-Reply-To: <CAHiEoM52D4yuE6LqfXoYSAr6-v7BBUq=ChHgzr=k7hB5poXfgQ@mail.gmail.com>
References: <CAHiEoM52D4yuE6LqfXoYSAr6-v7BBUq=ChHgzr=k7hB5poXfgQ@mail.gmail.com>
Message-ID: <4F71AF69.20206@rabbitmq.com>

Hi Aaron,

On 26/03/12 15:53, Aaron Westendorf wrote:
> I just installed the 2.8.1 package, having used 2.2 from source on my
> workstation for some time now, and found that the rabbitmqctl script
> is still broken. Specifically, it requires running as rabbitmq or root
> user, even though I've copied the erlang cookie to the correct path.
> I've run into this problem before and noted it on the mailing list but
> can't find a place to submit a formal bug.

I see this goes back to a thread with subject "rabbitmqctl script
complaints" in Nov 2010:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-November/009978.html

Some of the exploration around the issue was done on branch bug23522:
http://hg.rabbitmq.com/rabbitmq-server/rev/7bea5ad84fb5

In the end we decided that only rabbitmq or root should run privileged
commands. "sudo" is a more appropriate mechanism for allowing other
users to execute privileged tasks.


-Emile


From simon at rabbitmq.com  Tue Mar 27 13:23:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 27 Mar 2012 13:23:53 +0100
Subject: [rabbitmq-discuss] Strange Behavior with Queues - 2.8.1
In-Reply-To: <4F71ABEF.1000309@aol.com>
References: <4F709B5C.3080600@aol.com> <4F7190CB.9010704@rabbitmq.com>
	<4F71ABEF.1000309@aol.com>
Message-ID: <4F71B159.1000008@rabbitmq.com>

On 27/03/12 13:00, DawgTool wrote:
> Sorry for the false alarm, strange that it allowed me into the cluster
> with a un-match version.

Ah, thanks.

We actually don't try to stop this, maybe we should...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mss at mawhrin.net  Tue Mar 27 13:47:46 2012
From: mss at mawhrin.net (Mikhail Sobolev)
Date: Tue, 27 Mar 2012 16:47:46 +0400
Subject: [rabbitmq-discuss] Access for "external" users
In-Reply-To: <CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
References: <20120322191055.GA3358@mawhrin.net> <4F6C5483.9010209@rabbitmq.com>
	<20120323183418.GA1409@mawhrin.net> <4F706CA5.4090602@rabbitmq.com>
	<20120326161454.GA14190@mawhrin.net>
	<4F7191C0.1030400@rabbitmq.com>
	<CAHZsVQYSis87HZkuGO7urZoSUe9X4vBVmOW2wb6EmwVMch985A@mail.gmail.com>
Message-ID: <20120327124746.GA6265@mawhrin.net>

On Tue, Mar 27, 2012 at 12:16:26PM +0200, Brendan Hay wrote:
> You could write a custom middleware (to modify the queue.declares) for:
> https://github.com/brendanhay/myxi
> Example for adding x-ha-policy:
> https://github.com/brendanhay/myxi/blob/master/apps/myxi/src/myxi_ha_middleware.erl
> 
> Although, as the author, I wouldn't recommend it (yet) =)
Thanks, Brendan.  I'll certainly have a look.

--
Misha

From abdullahsaima at yahoo.com  Tue Mar 27 14:14:40 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Tue, 27 Mar 2012 14:14:40 +0100 (BST)
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
	message in bytes
In-Reply-To: <1332854021.90206.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F6C5E54.5060405@rabbitmq.com>
	<1332502303.33192.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<1332854021.90206.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <1332854080.76110.YahooMailNeo@web29706.mail.ird.yahoo.com>

Hello,
?
I am working on my simulator that I want to build on specific features of RabbitMQ.?I want to?take the length of the message to estimate how much time an exchange would take to process it. How can I estimate the length of the message. I am done with considering the "routing key" and just taking its length in bytes. Now I want to have more realistci approach RabbitMQ is using. 
PLEASE HELP !
?

Saima Asif
 

________________________________
 From: Saima Asif <abdullahsaima at yahoo.com>
To: Emile Joubert <emile at rabbitmq.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, 23 March 2012, 11:31
Subject: Re: [rabbitmq-discuss] Help required: How to keep the length of a message in bytes
  

Dear Emile,
?
Actually I am understanding by implemeting a kind of working of this RabbitMQ message. I actually want to simulate some of the basic ideas of this. What important features of the message I should consider. I want to keep the length of the message to estimate how much time an exchange would take to process it in my simulation. I dont know whether I am describing it properly or not. 
?
Thanks for help. 

Saima  

________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, 23 March 2012, 11:28
Subject: Re: [rabbitmq-discuss] Help required: How to keep the length of a message in bytes
  
Hi Saima,

On 23/03/12 11:13, Saima Asif wrote:
> I am working on Rabbit MQ messages, I need you help about how to keep
> the length of a message in bytes. Before this I was just considering the
> routing
 key and taking the length of this string in bytes. Now I want to
> know what else is important in the message to consider that affects the
> message lenght. Any help would be highly appreciated.

I'm not sure I understand your question. What are you trying to do?

The length of the message body (byte array) will normally exceed the
length of the routing key. Message headers and internal accounting
fields also contribute to the overall memory and/or disk footprint of a
message.

If you are performing a scoping exercise to estimate the amount of RAM
required then use the expected message body size instead of the routing key.


-Emile



  
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/76877a5c/attachment.htm>

From emile at rabbitmq.com  Tue Mar 27 14:25:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Mar 2012 14:25:30 +0100
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
 message in bytes
In-Reply-To: <1332854080.76110.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F6C5E54.5060405@rabbitmq.com>
	<1332502303.33192.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<1332854021.90206.YahooMailNeo@web29706.mail.ird.yahoo.com>
	<1332854080.76110.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <4F71BFCA.5030002@rabbitmq.com>


Hi Saima,

On 27/03/12 14:14, Saima Asif wrote:
> I am working on my simulator that I want to build on specific features
> of RabbitMQ. I want to take the length of the message to estimate how
> much time an exchange would take to process it.

The length of a message is not a factor that will influence the routing
time - the number of bindings is a better indicator.

The body/payload of a message normally accounts for the bulk of the
total serialised length, so use that if you need an estimate of the length.



-Emile


From aaron at agoragames.com  Tue Mar 27 14:24:31 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 27 Mar 2012 09:24:31 -0400
Subject: [rabbitmq-discuss] rabbitmqctl script still broken in Ubuntu
	package
In-Reply-To: <4F71AF69.20206@rabbitmq.com>
References: <CAHiEoM52D4yuE6LqfXoYSAr6-v7BBUq=ChHgzr=k7hB5poXfgQ@mail.gmail.com>
	<4F71AF69.20206@rabbitmq.com>
Message-ID: <CAHiEoM7BEycFY=Lui_X_FqY5W+oLUur_9CjBOiw6RvAEwL0fpQ@mail.gmail.com>

Perhaps, but Erlang already has a mechanism (a PITA one at that) for
authorizing clustered nodes. In my development environment it's quite
annoying to run sudo, and the default install will require sudo to
access the cookie anyway. It's a minor complaint, but between Erlang
and Unix, the permissions are already enforced without the extra step
of having to hack this script. In my experience, it's best not to work
outside the permissions system of the host OS.



On Tue, Mar 27, 2012 at 8:15 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Aaron,
>
> On 26/03/12 15:53, Aaron Westendorf wrote:
>> I just installed the 2.8.1 package, having used 2.2 from source on my
>> workstation for some time now, and found that the rabbitmqctl script
>> is still broken. Specifically, it requires running as rabbitmq or root
>> user, even though I've copied the erlang cookie to the correct path.
>> I've run into this problem before and noted it on the mailing list but
>> can't find a place to submit a formal bug.
>
> I see this goes back to a thread with subject "rabbitmqctl script
> complaints" in Nov 2010:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-November/009978.html
>
> Some of the exploration around the issue was done on branch bug23522:
> http://hg.rabbitmq.com/rabbitmq-server/rev/7bea5ad84fb5
>
> In the end we decided that only rabbitmq or root should run privileged
> commands. "sudo" is a more appropriate mechanism for allowing other
> users to execute privileged tasks.
>
>
> -Emile
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 27 14:25:17 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 27 Mar 2012 09:25:17 -0400
Subject: [rabbitmq-discuss] Help required: How to keep the length of a
 message in bytes
In-Reply-To: <1332854080.76110.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1332501235.19180.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F6C5E54.5060405@rabbitmq.com>
	<1332502303.33192.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<1332854021.90206.YahooMailNeo@web29706.mail.ird.yahoo.com>
	<1332854080.76110.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <CAM8fPiQ_A2_VSFK3D9qxbd9zXEaRB2iLAWVtCTizBF+19aMv5g@mail.gmail.com>

On 27 March 2012 09:14, Saima Asif <abdullahsaima at yahoo.com> wrote:

> I am working on my simulator that I want to build on specific features of
> RabbitMQ. I want to take the length of the message to estimate how much
> time an exchange would take to process it. How can I estimate the length of
> the message. I am done with considering the "routing key" and just taking
> its length in bytes. Now I want to have more realistci approach RabbitMQ is
> using.
>

Rather than simulating it, I'd simply try it. Inject messages of varying
lengths; measure the variable of interest. Developing a nontrivial model of
the performance of RabbitMQ in terms of properties of the input messages
is... ambitious.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/f7d77300/attachment.htm>

From stammailbox at gmail.com  Tue Mar 27 14:36:28 2012
From: stammailbox at gmail.com (Mysurf Mail)
Date: Tue, 27 Mar 2012 14:36:28 +0100
Subject: [rabbitmq-discuss] best practice to handle multiple subscribers
Message-ID: <CAJ2-VrkJB7=GbXTL01q8zLB5RGFWy8mW1WR8bsYE4RrEjFmkww@mail.gmail.com>

I have a queue and everytime the client wants another information he adds
another routing key.
Now, I am adding some more clients.
The best practice to handle this is to create a queue for each client ?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/16cb88f0/attachment.htm>

From jaaaelpumuki at gmail.com  Tue Mar 27 15:37:27 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Tue, 27 Mar 2012 10:37:27 -0400
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <4F71904F.8060100@rabbitmq.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
Message-ID: <CAFdw231m8e41zAnkFg-1H=EkfpES6+m_neiZCXQV=Z2N5zXoSg@mail.gmail.com>

You can see in https://gist.github.com/2172067 I'm escaping the / but some
tools unescape it again, that?s why It's a pain.
People can create all those names but I think rabbitmq is promoting that.

IHMO the default vhost shouldn't be /, I don't know maybe i'm a little
annoying with this :)


2012/3/27 Simon MacMullen <simon at rabbitmq.com>

> On 27/03/12 01:12, F?lix wrote:
>
>> Due to the default vhost's name is "/" i'm having troubles with some
>> tools, for example SoapUI, because they're always making the request
>> like "api/queues///queue_name/**contents/", this also happens with the
>> chrome's bookmarks  (https://gist.github.com/**2172067<https://gist.github.com/2172067>
>> )
>>
>
> The vhost name should be URL escaped - so "/" becomes "%2f".
>
>  So I'm wondering if something can be done, for instance:
>>  - Change the name, root or default isntead of /
>>
>
> It's a slightly unfortunate name. But there's nothing to stop people from
> creating other vhosts with names containing "/" or "?". Or "?" or " ?" or
> lots of other characters that would need escaping. And it's not just vhosts
> either, queues and exchanges and users and bindings all have names (ish in
> the case of bindings).
>
> Bottom line is, we'll always need escaping. And at least having the
> default vhost require it means people need to get this at least partly
> right in their tools ;-)
>
>   - If there isn't a vhost in the url then use the default. (this can
>> complicate a lot the url mapper)
>>
>
> I think this would ultimately be more confusing.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/d7f23802/attachment.htm>

From steve at rabbitmq.com  Tue Mar 27 16:36:44 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 27 Mar 2012 16:36:44 +0100
Subject: [rabbitmq-discuss] [PATCH] Add exclusive queue support to stomp
	adaptor
In-Reply-To: <17CFF6C1-56CE-4DE5-B50C-52602D913AA0@rabbitmq.com>
References: <01F35E85-3648-44EB-8F18-9C90C47CBD65@torgo.978.org>
	<C2A9C04F-4934-4C82-BC8D-EF3908CA224E@rabbitmq.com>
	<C0386F87-532F-4BDD-BF9A-62E376222081@rabbitmq.com>
	<1EBDB151-E2F3-4E59-98BB-E61588075638@jefftrout.com>
	<D7E1FD94-C2F3-4F7A-87E4-5939A828ABAC@rabbitmq.com>
	<CAM8fPiT5YSE35HfmpLUbGoYmtZqF0X_twuEmtjJFtzhFwZbBag@mail.gmail.com>
	<ACE38020-6EE4-43DE-9EBD-C574257BCFD2@jefftrout.com>
	<CAM8fPiT_7NL=qL62q8f+nh_Q8whbh7igfZixd_E_okFynGvn-Q@mail.gmail.com>
	<17CFF6C1-56CE-4DE5-B50C-52602D913AA0@rabbitmq.com>
Message-ID: <37DD93EB-7F48-413A-8C86-B9F28975C382@rabbitmq.com>

Dear Jeff,

Now that I understand this (thanks Tony) I can see your patch is
appropriate.

I would want to understand the header 'exclusive' you propose is OK.
If activemq uses this header and it means the same thing there, then
I am satisfied.

If you specify exclusive:true on the SUBSCRIBE frame, then the
subscription will only be created if there are no other Consumers for
that queue. (Hold on, there may not be a queue; but yes, there is always
some queue; and yes, exclusive need not have any force for all cases, but
it seems OK in those cases. As you were.)

If there is another consumer/subscriber (anywhere) then we will send
an ERROR frame back, and the subscription is not created.

I have raised a bug (24832) for this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 27 Mar 2012, at 11:32, Steve Powell wrote:

> Yup, I missed that (I did say IDKE).  Thanks.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 26 Mar 2012, at 17:26, Tony Garnock-Jones wrote:
> 
>> Hi Jeff,
>> 
>> Ah! I hadn't actually seen the patch, but I just went hunting through the archives to find the root of this thread. Yep.
>> 
>> Steve, am I right in thinking your objections apply to the "exclusive" argument to queue.declare, rather than that to basic.consume? It seems to me that supporting "exclusive" for basic.consume would be a useful addition to the STOMP adapter.
>> 
>> Regards,
>>  Tony
>> 
>> 
>> On 26 March 2012 11:39, Jeff <jeff at jefftrout.com> wrote: 
>> ...  
>> 
>>> You're probably looking for the "exclusive" argument to *basic.consume* rather than queue.declare.
>> 
>> Yep - that is what this patch does - it allows us to pass in the exclusive argument to basic.consume in the stomp wrapper (it was previous hardcoded to be false)
>> 
>> -- 
>> Tony Garnock-Jones
>> tonygarnockjones at gmail.com
>> http://homepages.kcbbs.gen.nz/tonyg/
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From james.r.carr at gmail.com  Tue Mar 27 16:38:41 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 27 Mar 2012 10:38:41 -0500
Subject: [rabbitmq-discuss] Federation Many Connections?
Message-ID: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>

So I investigated why it seems that one of the nodes in my test
cluster wind up have hundreds of direct connections to itself lately.
It turned out that  one of the upstreams it was connecting to didn't
have the exchange that is meant to be federated defined. It seems that
when the exchange doesn't exist on the upstream it just periodically
keeps retrying but does't close the previous connection.

I can send more log details if needed. I am currently running 2.8.0
but will upgrade to 2.8.1 and see if the problem persists.


Thanks,
James

From james.r.carr at gmail.com  Tue Mar 27 16:57:57 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 27 Mar 2012 10:57:57 -0500
Subject: [rabbitmq-discuss] Federation Many Connections?
In-Reply-To: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>
References: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>
Message-ID: <CAJreXKDKUNCUBFkAQt7PNue7vQPj39Z3XtRhAiWhPAifu7FOyw@mail.gmail.com>

The issue persists with version 2.8.1 as well. It seems to work okay
when a single downstream connects to the upstream, but when a cluster
connects to the upstream the node making the connection creates new
direct connections to itself each time it fails to bind to the
upstream exchange.

Attached is a screenshot from the management console and here is the
contents of my log file: https://gist.github.com/b8714347f97a86b34724.
 The interesting thing to note is that the number of errors in the log
file correspond directly to the number of direct connections
dc2rabbitmq5 makes to itself (I cleared the logs before retrying
again).

Thanks,
James

On Tue, Mar 27, 2012 at 10:38 AM, James Carr <james.r.carr at gmail.com> wrote:
> So I investigated why it seems that one of the nodes in my test
> cluster wind up have hundreds of direct connections to itself lately.
> It turned out that ?one of the upstreams it was connecting to didn't
> have the exchange that is meant to be federated defined. It seems that
> when the exchange doesn't exist on the upstream it just periodically
> keeps retrying but does't close the previous connection.
>
> I can send more log details if needed. I am currently running 2.8.0
> but will upgrade to 2.8.1 and see if the problem persists.
>
>
> Thanks,
> James
-------------- next part --------------
A non-text attachment was scrubbed...
Name: many-connections.png
Type: image/png
Size: 121113 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/1068e681/attachment.png>

From james.r.carr at gmail.com  Tue Mar 27 17:00:39 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 27 Mar 2012 11:00:39 -0500
Subject: [rabbitmq-discuss] Federation Many Connections?
In-Reply-To: <CAJreXKDKUNCUBFkAQt7PNue7vQPj39Z3XtRhAiWhPAifu7FOyw@mail.gmail.com>
References: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>
	<CAJreXKDKUNCUBFkAQt7PNue7vQPj39Z3XtRhAiWhPAifu7FOyw@mail.gmail.com>
Message-ID: <CAJreXKAUj5MB7HtMGiC5zEL6NqnyrUT=G0z4UR2ds47PcvDAJg@mail.gmail.com>

Finally, here's my configuration in case it helps reproduce the
problem: https://gist.github.com/61a55a37e9c2e77d1797

Thanks,
James


On Tue, Mar 27, 2012 at 10:57 AM, James Carr <james.r.carr at gmail.com> wrote:
> The issue persists with version 2.8.1 as well. It seems to work okay
> when a single downstream connects to the upstream, but when a cluster
> connects to the upstream the node making the connection creates new
> direct connections to itself each time it fails to bind to the
> upstream exchange.
>
> Attached is a screenshot from the management console and here is the
> contents of my log file: https://gist.github.com/b8714347f97a86b34724.
> ?The interesting thing to note is that the number of errors in the log
> file correspond directly to the number of direct connections
> dc2rabbitmq5 makes to itself (I cleared the logs before retrying
> again).
>
> Thanks,
> James
>
> On Tue, Mar 27, 2012 at 10:38 AM, James Carr <james.r.carr at gmail.com> wrote:
>> So I investigated why it seems that one of the nodes in my test
>> cluster wind up have hundreds of direct connections to itself lately.
>> It turned out that ?one of the upstreams it was connecting to didn't
>> have the exchange that is meant to be federated defined. It seems that
>> when the exchange doesn't exist on the upstream it just periodically
>> keeps retrying but does't close the previous connection.
>>
>> I can send more log details if needed. I am currently running 2.8.0
>> but will upgrade to 2.8.1 and see if the problem persists.
>>
>>
>> Thanks,
>> James

From steve at rabbitmq.com  Tue Mar 27 17:28:00 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 27 Mar 2012 17:28:00 +0100
Subject: [rabbitmq-discuss] [java-client] Parallelizing message
	consumption from a single queue
In-Reply-To: <25697157.291.1332805747355.JavaMail.geo-discussion-forums@pbcvg9>
References: <14018256.62.1332440456764.JavaMail.geo-discussion-forums@ynnk21>
	<58FAA50E-7E40-4B20-9568-CBC2A4A70983@rabbitmq.com>
	<25697157.291.1332805747355.JavaMail.geo-discussion-forums@pbcvg9>
Message-ID: <25A82C11-C311-47CA-976D-EA64BA953A75@rabbitmq.com>

Hi Josh,

> This is the approach I've taken so far. I have a single Connection,
> Channel and Consumer and a single thread that loop on
> consumer.nextDelivery(). As soon as consumer.nextDelivery() returns, the
> message is acknowledged and handed off to a separate thread pool for
> processing, allowing the thread to move on to the next delivery.

Since you mention nextDelivery() this means you are using our
QueueingConsumer implementation. If all your single thread is doing is
to hand the message to another thread(pool) for processing, then you
don't need QueueingConsumer. Instead, define a DefaultConsumer extension
and acknowledge and hand-over the message in the handleDelivery()
method.

Here is what it might look like:

  Channel channel ...
  Consumer cons = new DefaultConsumer(channel) {
      @Override
      public void handleDelivery(String consumerTag,
                                 Envelope envelope,
                                 AMQP.BasicProperties properties,
                                 byte[] body)
          throws IOException
      {
              // acknowledge the message

              // pass it to your thread process
      }
  }

and of course you need to attach it to your queue...

  basicConsume(queueName, false, cons);

This will eliminate the internal queue set up by QueueingConsumer and
allow you greater control over error conditions (just add more callback
methods to your Consumer). The callback methods are called serially, and
you can issue channel method calls in the handleDelivery() body without
deadlocking.

You may want to use autoAck=true if you are *not* deferring the
acknowledgement until after processing. Only do this if you really do
want to acknowledge everything and have no limit on the messages handed
off to the thread pool.

Be aware that the basicQos() prefetch-count setting on the channel
(together with autoAck=false) will permit the delivery of multiple
messages before you have to acknowledge any of them, so it is possible
to defer the acknowledgement until the end of processing, if the
prefetch-count is larger than one, and still permit the concurrent
processing of up-to prefetch-count messages.

Please let us know how you get on.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 27 Mar 2012, at 00:49, Josh Stone wrote:
> ...many lines

From zmstone at gmail.com  Tue Mar 27 17:50:12 2012
From: zmstone at gmail.com (stone)
Date: Tue, 27 Mar 2012 18:50:12 +0200
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <4F71904F.8060100@rabbitmq.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
Message-ID: <CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>

Hi Simon

Speaking of escaped characters:
The other day, we accidentally created queues and bindings with UTF
characters in the names.
Then the management web GUI crashed (on mochiweb level if i remember
correctly), so we couldn't delete the queu on GUI.
And there was no CLI to do it, we actually had to reset the node to get rid
of the bad-naming queues.

/stone

? 2012?3?27? ??12:02?Simon MacMullen <simon at rabbitmq.com>???

> On 27/03/12 01:12, F?lix wrote:
>
>> Due to the default vhost's name is "/" i'm having troubles with some
>> tools, for example SoapUI, because they're always making the request
>> like "api/queues///queue_name/**contents/", this also happens with the
>> chrome's bookmarks  (https://gist.github.com/**2172067<https://gist.github.com/2172067>
>> )
>>
>
> The vhost name should be URL escaped - so "/" becomes "%2f".
>
>
>  So I'm wondering if something can be done, for instance:
>>  - Change the name, root or default isntead of /
>>
>
> It's a slightly unfortunate name. But there's nothing to stop people from
> creating other vhosts with names containing "/" or "?". Or "?" or " ?" or
> lots of other characters that would need escaping. And it's not just vhosts
> either, queues and exchanges and users and bindings all have names (ish in
> the case of bindings).
>
> Bottom line is, we'll always need escaping. And at least having the
> default vhost require it means people need to get this at least partly
> right in their tools ;-)
>
>
>   - If there isn't a vhost in the url then use the default. (this can
>> complicate a lot the url mapper)
>>
>
> I think this would ultimately be more confusing.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/49fb59da/attachment.htm>

From james.r.carr at gmail.com  Tue Mar 27 18:20:24 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 27 Mar 2012 12:20:24 -0500
Subject: [rabbitmq-discuss] Federation Many Connections?
In-Reply-To: <CAJreXKAUj5MB7HtMGiC5zEL6NqnyrUT=G0z4UR2ds47PcvDAJg@mail.gmail.com>
References: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>
	<CAJreXKDKUNCUBFkAQt7PNue7vQPj39Z3XtRhAiWhPAifu7FOyw@mail.gmail.com>
	<CAJreXKAUj5MB7HtMGiC5zEL6NqnyrUT=G0z4UR2ds47PcvDAJg@mail.gmail.com>
Message-ID: <CAJreXKD066=T=0Gh0Aomig+=hxS6wJAoPMUm49Y6-XELAjVitQ@mail.gmail.com>

One last note (I feel so spammy today) is that it stops generating new
connections when I go and define the exchange on the upstream server
that was missing it. The previous connections however stick around.

Thanks,
James


On Tue, Mar 27, 2012 at 11:00 AM, James Carr <james.r.carr at gmail.com> wrote:
> Finally, here's my configuration in case it helps reproduce the
> problem: https://gist.github.com/61a55a37e9c2e77d1797
>
> Thanks,
> James
>
>
> On Tue, Mar 27, 2012 at 10:57 AM, James Carr <james.r.carr at gmail.com> wrote:
>> The issue persists with version 2.8.1 as well. It seems to work okay
>> when a single downstream connects to the upstream, but when a cluster
>> connects to the upstream the node making the connection creates new
>> direct connections to itself each time it fails to bind to the
>> upstream exchange.
>>
>> Attached is a screenshot from the management console and here is the
>> contents of my log file: https://gist.github.com/b8714347f97a86b34724.
>> ?The interesting thing to note is that the number of errors in the log
>> file correspond directly to the number of direct connections
>> dc2rabbitmq5 makes to itself (I cleared the logs before retrying
>> again).
>>
>> Thanks,
>> James
>>
>> On Tue, Mar 27, 2012 at 10:38 AM, James Carr <james.r.carr at gmail.com> wrote:
>>> So I investigated why it seems that one of the nodes in my test
>>> cluster wind up have hundreds of direct connections to itself lately.
>>> It turned out that ?one of the upstreams it was connecting to didn't
>>> have the exchange that is meant to be federated defined. It seems that
>>> when the exchange doesn't exist on the upstream it just periodically
>>> keeps retrying but does't close the previous connection.
>>>
>>> I can send more log details if needed. I am currently running 2.8.0
>>> but will upgrade to 2.8.1 and see if the problem persists.
>>>
>>>
>>> Thanks,
>>> James

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 27 18:27:39 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 27 Mar 2012 13:27:39 -0400
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
	<CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>
Message-ID: <CAM8fPiTe+pVvgRxTAKb_3aA7Are13WmeUL5YW0kC8R6DUKr50w@mail.gmail.com>

On 27 March 2012 12:50, stone <zmstone at gmail.com> wrote:

> The other day, we accidentally created queues and bindings with UTF
> characters in the names.
> Then the management web GUI crashed (on mochiweb level if i remember
> correctly), so we couldn't delete the queu on GUI.
> And there was no CLI to do it, we actually had to reset the node to get
> rid of the bad-naming queues.
>

A test case would be extremely useful and welcome! Can you remember the
exact bytes used in the names? And which GUI actions caused the crashes?

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/1db5da55/attachment.htm>

From zmstone at gmail.com  Tue Mar 27 19:57:48 2012
From: zmstone at gmail.com (stone)
Date: Tue, 27 Mar 2012 20:57:48 +0200
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <CAM8fPiTe+pVvgRxTAKb_3aA7Are13WmeUL5YW0kC8R6DUKr50w@mail.gmail.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
	<CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>
	<CAM8fPiTe+pVvgRxTAKb_3aA7Are13WmeUL5YW0kC8R6DUKr50w@mail.gmail.com>
Message-ID: <CAPNZrFUxPFy40-LqWoiu4PEqRjyW6AJYqoV-W-b+NkQBVRtHOA@mail.gmail.com>

Hi Tony,

I didn't save the scene, didn't really look into the fault client code.
Just had a quick test, reproduced by using term_to_binary instead of
list_to_binary to make the queue name in Erlang client.
Perhaps this WAS exactly the case from the other day. shame :)
I simply though it was UTF used in that case because the crash report has
"utf" in it.

http://localhost:55672/#/queues
{error,{exit,{ucs,{bad_utf8_character_code}},
             [{xmerl_ucs,from_utf8,1},
              {mochijson2,json_encode_string,2},
              {mochijson2,'-json_encode_proplist/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_proplist,2},
              {mochijson2,'-json_encode_array/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_array,2}]}}

Anyway, perhaps  rabbit-server should have the name validated before
allowing the declaration.

BRs
/stone

? 2012?3?27? ??7:27?Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
???

> On 27 March 2012 12:50, stone <zmstone at gmail.com> wrote:
>
>> The other day, we accidentally created queues and bindings with UTF
>> characters in the names.
>> Then the management web GUI crashed (on mochiweb level if i remember
>> correctly), so we couldn't delete the queu on GUI.
>> And there was no CLI to do it, we actually had to reset the node to get
>> rid of the bad-naming queues.
>>
>
> A test case would be extremely useful and welcome! Can you remember the
> exact bytes used in the names? And which GUI actions caused the crashes?
>
> Regards,
>   Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/98fe0da9/attachment.htm>

From eric at holtmans.com  Tue Mar 27 20:00:40 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Tue, 27 Mar 2012 14:00:40 -0500
Subject: [rabbitmq-discuss] Using ACLs to filter on topics?
Message-ID: <4F720E58.9060904@holtmans.com>

Having looked over this, I think the answer to my question
is "NO", but....

Is there some way using Rabbit's permission system to filter
messages by topic?

That is.... let's say I have an exchange set up to provide
information on stock positions.   If I just have one exchange,
and the topic is "acct.symbol", and I post messages with topics
like "1.IBM", "2.IBM", "1.AAPL", is there any way to set up
a user so that if he binds a queue to that exchange for reading,
I could restrict him to only seeing the "2.*" messages?

Or would I have to promote the account up out of the topic
into its on exchange for something like this to work (and then
user "clerk" might have read access to "^2\..*", while "admin"
might have read access to "^{1,2}\..*"

From tonygarnockjones+rabbitmq at gmail.com  Tue Mar 27 20:30:57 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 27 Mar 2012 15:30:57 -0400
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <CAPNZrFUxPFy40-LqWoiu4PEqRjyW6AJYqoV-W-b+NkQBVRtHOA@mail.gmail.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
	<CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>
	<CAM8fPiTe+pVvgRxTAKb_3aA7Are13WmeUL5YW0kC8R6DUKr50w@mail.gmail.com>
	<CAPNZrFUxPFy40-LqWoiu4PEqRjyW6AJYqoV-W-b+NkQBVRtHOA@mail.gmail.com>
Message-ID: <CAM8fPiQsTA1dRV78FLZmaK0thsnYbCRzeiMzPMim+k0UByAV3A@mail.gmail.com>

Hi Stone,

Sorry, I don't quite understand: how are you declaring the queue? Is it
with the Erlang client across an AMQP network link? Or some other client
across an AMQP network link? Or is it with the Erlang client in the same
Erlang cluster as the server?

If it's across an AMQP network link, perhaps you could paste in tcpdump
output showing the bytes sent on the wire during the queue.declare. That
way it's crystal clear what's happening.

If it's not across an AMQP link then yeah, perhaps the Erlang client needs
more type-assertionish things in it :-)

Regards,
  Tony

2012/3/27 stone <zmstone at gmail.com>

> Hi Tony,
>
> I didn't save the scene, didn't really look into the fault client code.
> Just had a quick test, reproduced by using term_to_binary instead of
> list_to_binary to make the queue name in Erlang client.
> Perhaps this WAS exactly the case from the other day. shame :)
> I simply though it was UTF used in that case because the crash report has
> "utf" in it.
>
> http://localhost:55672/#/queues
> {error,{exit,{ucs,{bad_utf8_character_code}},
>              [{xmerl_ucs,from_utf8,1},
>               {mochijson2,json_encode_string,2},
>               {mochijson2,'-json_encode_proplist/2-fun-0-',3},
>               {lists,foldl,3},
>               {mochijson2,json_encode_proplist,2},
>               {mochijson2,'-json_encode_array/2-fun-0-',3},
>               {lists,foldl,3},
>               {mochijson2,json_encode_array,2}]}}
>
> Anyway, perhaps  rabbit-server should have the name validated before
> allowing the declaration.
>
> BRs
> /stone
>
> ? 2012?3?27? ??7:27?Tony Garnock-Jones <
> tonygarnockjones+rabbitmq at gmail.com>???
>
>> On 27 March 2012 12:50, stone <zmstone at gmail.com> wrote:
>>
>>> The other day, we accidentally created queues and bindings with UTF
>>> characters in the names.
>>> Then the management web GUI crashed (on mochiweb level if i remember
>>> correctly), so we couldn't delete the queu on GUI.
>>> And there was no CLI to do it, we actually had to reset the node to get
>>> rid of the bad-naming queues.
>>>
>>
>> A test case would be extremely useful and welcome! Can you remember the
>> exact bytes used in the names? And which GUI actions caused the crashes?
>>
>> Regards,
>>   Tony
>>
>>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/2d52e851/attachment.htm>

From mpietrek at skytap.com  Wed Mar 28 00:54:44 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 27 Mar 2012 16:54:44 -0700
Subject: [rabbitmq-discuss] Pika channels sensitive to prior operation state?
Message-ID: <CB97A153.3DFD7%mpietrek@skytap.com>

I have a Pika 0.9.5. app communicating with a 2.81 rabbitmq-server instance.

I'm noticing some odd behavior, and am not sure if it's a problem on my end,
on rabbitmq's end, or in Pika.

At it's simplest, I'm seeing a call to channel.tx_select() hang. Breaking in
with the debugger, the stack looks like this:

_handle_read [base_connection.py:151]
process_data_events [blocking_connection.py:94]
send_method [blocking_connection.py:244]
rpc [blocking_connection.py:216]
tx_select [spec.py:2615]

Stepping for a bit, I see that the code never gets out of the loop in the
send_method() function.

In ordinary circumstances, my code that calls tx_select() works fine.
However, in the case where it hangs, an immediately prior call to
channel.basic_get() has thrown an exception:

'pika.exceptions.AMQPChannelError'>:(404, "NOT_FOUND - no queue 'foobar' in
vhost '/'"

I'm baffled. Known issue? Something I'm doing wrong?

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120327/5bb4c84c/attachment.htm>

From dawgtool at aol.com  Wed Mar 28 04:20:50 2012
From: dawgtool at aol.com (DawgTool)
Date: Tue, 27 Mar 2012 23:20:50 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F704404.8080504@rabbitmq.com>
References: <4F6CD702.4050908@aol.com> <4F704404.8080504@rabbitmq.com>
Message-ID: <4F728392.5070602@aol.com>

Hi Simon,

The Flow-Control in 2.8.1 has been a huge failure for my UAT systems.
The blocking is completely takes over the system, in some cases it takes 
several minutes before RabbitMQ is able to process my disconnected channels.

I really need some guidance, my issues so far; (messages are non-persistent)
Flow-Control kicks in heavy around 3k msq/sec and is almost unusable at 
5k msg/sec
When using TTLs on queues, when memory exceeds 1gb for a queue, blocking 
start taking seconds while purging the queue.
When using TTLs on queues, memory above 1gb per queue and mirroring 
(ha:true) blocking completely locks up the system and take several 
minutes to recover.

None of my machines are running hot, average CPU is about 90 to 110% 
(smp:enable), no io wait issues, network is underutilized, memory less 
then 10% consumed.

last last_ state recv_oct recv_cnt   sendsend send
blocked blocked                                        oct cnt pend
by age
flow    28.036103    blocked    114346544    199970    384    4    0
flow    28.04571     blocked    114310503    200332    384    4    0
flow    28.033909    blocked    114317988    199906    384    4    0
flow    28.034395    blocked    114245740    199822    384    4    0
flow    28.046772    blocked    114198573    199882    384    4    0
flow    28.034031    blocked    114254993    200164    384    4    0
flow    28.034131    blocked     30595831     40077    384    4    0
flow    28.033161    blocked     30580062     40261    384    4    0
flow    28.035666    blocked     30605155     40355    384    4    0
flow    28.035648    blocked     30638405     40347    384    4    0
flow    28.394708    blocked     30560023     40286    384    4    0
flow    28.04654     blocked    114268244    200232    384    4    0
flow    28.045263    blocked    114245987    200025    384    4    0
flow    28.035341    blocked    114262211    199989    384    4    0
flow    28.035473    blocked    114319531    200172    384    4    0
flow    28.044786    blocked     30614203     40132    384    4    0
flow    28.401974    blocked     30588179     40063    384    4    0
flow    28.046696    blocked     30624773     40239    384    4    0
flow    28.037019    blocked     30617997     40074    384    4    0
flow    28.381844    blocked     30581067     40084    384    4    0



On 3/26/12 6:25 AM, Simon MacMullen wrote:
> Hi.
>
> There's no way to monitor what the flow control is doing.
>
> I would assume that with 7k msg/s on 2.7.1 you see memory use steadily 
> increasing? The flow control should just be preventing (significant 
> numbers of) messages being queued up anywhere else than in queues. The 
> idea is to ensure that whatever performance RabbitMQ is giving you is 
> sustainable, rather than letting it absorb more messages in the short 
> term at the cost of working itself into a hole that is difficult to 
> get out of.
>
> If you need the ability to absorb spikes in publishing rates then you 
> can increase the size of TCP buffers on the server.
>
> Cheers, Simon
>
> On 23/03/12 20:03, DawgTool wrote:
>> Hi All,
>>
>> Wondering is anyone having issues with the Per-Connection Flow Control
>> in 2.8.1?
>> Under 2.7.1 was able to push about 4.5MB/s per connection (about
>> ~7000msg/s).
>> Under 2.8.1 I am hitting the flow control constantly at about 2.4MB/s
>> per connection.
>> Clean installed 2.8.1 on the same hardware as 2.7.1.
>>
>> Is there someway to configure/monitor what is causing the Flow Control
>> to be tripped?
>>
>> Thanks in Advance.
>>
>>
>>
>> Config: (both 2.7.1/2.8.1)
>> Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:30]
>> [hipe] [kernel-poll:true]
>>
>> ==> enabled_plugins <==
>> [rabbitmq_management,rabbitmq_management_agent].
>>
>> ==> rabbitmq.config <==
>> [
>> {rabbit, [{vm_memory_high_watermark, 0.6},
>> {collect_statistics_interval, 5000},
>> {hipe_compile, true}
>> ]
>> },
>> {mnesia, [{dc_dump_limit, 40},
>> {dump_log_write_threshold, 50000},
>> {no_table_loaders, 20},
>> {send_compressed, 9},
>> {snmp, true}
>> ]
>> },
>> {rabbitmq_management, [ {http_log_dir,
>> "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
>> {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
>> ].
>>
>> ==> rabbitmq-env.conf <==
>> NODENAME=dc001
>> BASE=/data/rabbitmq/dc001
>> MNESIA_BASE=/data/rabbitmq/dc001/mnesia
>> LOG_BASE=/data/rabbitmq/dc001/log
>> SERVER_START_ARGS="+K true -smp enable"
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From nickjosevski at gmail.com  Wed Mar 28 07:26:01 2012
From: nickjosevski at gmail.com (Nick Josevski)
Date: Wed, 28 Mar 2012 17:26:01 +1100
Subject: [rabbitmq-discuss] Manual service stop or start via
 rabbitmq-service.bat on Windows has an %APPDATA% path bug.
In-Reply-To: <4F71994C.6040609@rabbitmq.com>
References: <03306f5c-333c-4a13-b66e-81d7e6317d8f@x5g2000pbl.googlegroups.com>
	<4F71994C.6040609@rabbitmq.com>
Message-ID: <CABhdX0PKxbK+gYS22tjiY6WMkaW8HhAknqH0-70QBjuo-hO06Q@mail.gmail.com>

Hi Emile,
  Thanks for the feedback, and the clarifications, if there's
anything outstanding that's still relevant to my concern is how a new
folder with the name %APPDATA% ended up in the sbin folder. This to me
seems to be a bug with the bat scripts and I do believe it played a factor
in making the setup on my machine dysfunctional.


On Tue, Mar 27, 2012 at 9:41 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Nick,
>
> On 27/03/12 03:05, Nick Josevski wrote:
> > I tried to enable the management web feature via rabbitmq-plugins, but
> > somewhere during the process of enabling, stopping, installing,
> > starting the service back up again. A rogue '%APPDATA%' folder was
> > created in the sbin folder. In my case C:\Program Files (x86)\RabbitMQ
> > Server\rabbitmq_server-2.8.1\sbin
> >
> > I've experienced this issue on versions 2.7.1 and 2.8.1.
>
> The default script folder for v2.8.1 is
> C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.1\sbin
>
> If you select a different installation folder (such as C:\Program Files
> (x86)) then the scripts will be installed in the folder you quoted.
>
> > The worst part of this is once that happened, I kept getting nodedown
> > errors when trying to do anything even via the reset and force_reset
> > commands.
>
> This is unlikely to be related to the installation path. Have you tried
> the advice in the troubleshooting guide?
> http://www.rabbitmq.com/troubleshooting.html
>
> > My solution was to uninstall RabbitMQ, delete all the folders (in
> > AppData and in Program Files), then go further to uninstall and re-
> > install Erlang, all with reboots scattered throughout to ensure
> > nothing was left behind.
>
> The uninstaller should do that for you. It should not be necessary to
> re-install Erlang.
>
> > To finally enable the rabbitmq_management plugin I had to just enable
> > it via the rabbitmq-plugins, **not** run stop or install or start via
> > rabbitmq-service.bat, but instead go into Services and just re-start
> > the RabbitMQ service via right click > start.
>
> This is incorrect. Restarting the broker is not sufficient for enabling
> plugins when running as a service. You must reinstall the service.
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/4bced39f/attachment.htm>

From zmstone at gmail.com  Wed Mar 28 09:00:34 2012
From: zmstone at gmail.com (stone)
Date: Wed, 28 Mar 2012 10:00:34 +0200
Subject: [rabbitmq-discuss] Default vhost and Http API
In-Reply-To: <CAM8fPiQsTA1dRV78FLZmaK0thsnYbCRzeiMzPMim+k0UByAV3A@mail.gmail.com>
References: <ff743acc-76ee-406b-8107-de8e2b7a4427@12g2000vba.googlegroups.com>
	<4F71904F.8060100@rabbitmq.com>
	<CAPNZrFV+CfJY+azNTJKe05ekHLjZoEGS7Ed80gdYvxHiDVex7g@mail.gmail.com>
	<CAM8fPiTe+pVvgRxTAKb_3aA7Are13WmeUL5YW0kC8R6DUKr50w@mail.gmail.com>
	<CAPNZrFUxPFy40-LqWoiu4PEqRjyW6AJYqoV-W-b+NkQBVRtHOA@mail.gmail.com>
	<CAM8fPiQsTA1dRV78FLZmaK0thsnYbCRzeiMzPMim+k0UByAV3A@mail.gmail.com>
Message-ID: <CAPNZrFVR+9q1oSZ+K=_PZqfwjFkV2j6R3nULWj8SqZSySQnYTg@mail.gmail.com>

Hi

Those queues are declared from Erlang client across an AMQP link.
Sorry, I don't know how to get tcpdump.
But I can give you an input that'll lead to the crash if this is what you
want.
1> A="queue.name".
"queue.name"
2> term_to_binary(A).
<<131,107,0,10,113,117,101,117,101,46,110,97,109,101>>
If this binary is used in #'queue.declare'.queue, GUI will crash.

Brs
/stone

On Tue, Mar 27, 2012 at 9:30 PM, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> Hi Stone,
>
> Sorry, I don't quite understand: how are you declaring the queue? Is it
> with the Erlang client across an AMQP network link? Or some other client
> across an AMQP network link? Or is it with the Erlang client in the same
> Erlang cluster as the server?
>
> If it's across an AMQP network link, perhaps you could paste in tcpdump
> output showing the bytes sent on the wire during the queue.declare. That
> way it's crystal clear what's happening.
>
> If it's not across an AMQP link then yeah, perhaps the Erlang client needs
> more type-assertionish things in it :-)
>
> Regards,
>   Tony
>
>
> 2012/3/27 stone <zmstone at gmail.com>
>
>> Hi Tony,
>>
>> I didn't save the scene, didn't really look into the fault client code.
>> Just had a quick test, reproduced by using term_to_binary instead of
>> list_to_binary to make the queue name in Erlang client.
>> Perhaps this WAS exactly the case from the other day. shame :)
>> I simply though it was UTF used in that case because the crash report has
>> "utf" in it.
>>
>> http://localhost:55672/#/queues
>> {error,{exit,{ucs,{bad_utf8_character_code}},
>>              [{xmerl_ucs,from_utf8,1},
>>               {mochijson2,json_encode_string,2},
>>               {mochijson2,'-json_encode_proplist/2-fun-0-',3},
>>               {lists,foldl,3},
>>               {mochijson2,json_encode_proplist,2},
>>               {mochijson2,'-json_encode_array/2-fun-0-',3},
>>               {lists,foldl,3},
>>               {mochijson2,json_encode_array,2}]}}
>>
>> Anyway, perhaps  rabbit-server should have the name validated before
>> allowing the declaration.
>>
>> BRs
>> /stone
>>
>> ? 2012?3?27? ??7:27?Tony Garnock-Jones <
>> tonygarnockjones+rabbitmq at gmail.com>???
>>
>>> On 27 March 2012 12:50, stone <zmstone at gmail.com> wrote:
>>>
>>>> The other day, we accidentally created queues and bindings with UTF
>>>> characters in the names.
>>>> Then the management web GUI crashed (on mochiweb level if i remember
>>>> correctly), so we couldn't delete the queu on GUI.
>>>> And there was no CLI to do it, we actually had to reset the node to get
>>>> rid of the bad-naming queues.
>>>>
>>>
>>> A test case would be extremely useful and welcome! Can you remember the
>>> exact bytes used in the names? And which GUI actions caused the crashes?
>>>
>>> Regards,
>>>   Tony
>>>
>>>
>>
>
>
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/584554b8/attachment.htm>

From emile at rabbitmq.com  Wed Mar 28 10:06:40 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 10:06:40 +0100
Subject: [rabbitmq-discuss] Manual service stop or start via
 rabbitmq-service.bat on Windows has an %APPDATA% path bug.
In-Reply-To: <CABhdX0PKxbK+gYS22tjiY6WMkaW8HhAknqH0-70QBjuo-hO06Q@mail.gmail.com>
References: <03306f5c-333c-4a13-b66e-81d7e6317d8f@x5g2000pbl.googlegroups.com>
	<4F71994C.6040609@rabbitmq.com>
	<CABhdX0PKxbK+gYS22tjiY6WMkaW8HhAknqH0-70QBjuo-hO06Q@mail.gmail.com>
Message-ID: <4F72D4A0.4090207@rabbitmq.com>

Hi Nick,

On 28/03/12 07:26, Nick Josevski wrote:
>   Thanks for the feedback, and the clarifications, if there's
> anything outstanding that's still relevant to my concern is how a new
> folder with the name %APPDATA% ended up in the sbin folder. This to me
> seems to be a bug with the bat scripts and I do believe it played a
> factor in making the setup on my machine dysfunctional.

If you can then please provide a sequence of steps guaranteed to
reproduce the problem so that we can investigate. It should not be
possible for the installer to make a machine dysfunctional or do
anything that the uninstaller cannot undo.

-Emile




From emile at rabbitmq.com  Wed Mar 28 10:20:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 10:20:09 +0100
Subject: [rabbitmq-discuss] best practice to handle multiple subscribers
In-Reply-To: <CAJ2-VrkJB7=GbXTL01q8zLB5RGFWy8mW1WR8bsYE4RrEjFmkww@mail.gmail.com>
References: <CAJ2-VrkJB7=GbXTL01q8zLB5RGFWy8mW1WR8bsYE4RrEjFmkww@mail.gmail.com>
Message-ID: <4F72D7C9.5030204@rabbitmq.com>

Hi,

On 27/03/12 14:36, Mysurf Mail wrote:
> I have a queue and everytime the client wants another information he
> adds another routing key. 
> Now, I am adding some more clients. 
> The best practice to handle this is to create a queue for each client ? 

The answer won't be the same in all cases, because it depends on your
application. If you want each client to receive the message then you
should create a separate queue and binding for each one. If you want a
message to be handled by only one client then you should use one queue
and subscribe all clients to the same queue.

Compare tutorials 2 and 3 for an illustration:
http://www.rabbitmq.com/getstarted.html


-Emile



From andreivereha at gmail.com  Wed Mar 28 10:30:40 2012
From: andreivereha at gmail.com (Andrei Vereha)
Date: Wed, 28 Mar 2012 12:30:40 +0300
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 / R14B02  crash - updates
In-Reply-To: <4F706AF3.8030200@rabbitmq.com>
References: <20120321191448.2927b95a@cronos.dsdtm.ro>
	<4F6A0E3F.9070609@rabbitmq.com>
	<20120323140912.4fb1fe4b@cronos.dsdtm.ro>
	<4F706AF3.8030200@rabbitmq.com>
Message-ID: <20120328123040.40b18eae@cronos.dsdtm.ro>

On Mon, 26 Mar 2012 14:11:15 +0100
Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/03/12 12:09, Andrei Vereha wrote:
> > Why the beam process takes 1.4 Gb and the rabbitmqctl status reports
> > only a few hundred Mb?
> > I see the same value(raported by rabbitmqctl status) in the
> > management web inteface.
> > Is there a way to find where goes the memory?
> > Am I using a wrong erlang version?
> 
> That's a very good question. Both rabbitmqctl status and management
> are reporting on the amount of memory reported used by the Erlang VM.
> Which is the same value which controls the memory alarm.
> 
> This should match up with the RSS value reported by ps. Since yours 
> doesn't, the best I can recommend is upgrading Erlang.
> 
> Cheers, Simon

Thank you for answering my question.
I updated erlang to R15B, and it looks better. There still is a
difference between the memory reported by ps and the one reported by
rabbitmqctl status: ps reports 441444, and rabbitmqctl reports
367336928. 

Regards,
  Andrei


From pursanovd at gmail.com  Wed Mar 28 10:47:05 2012
From: pursanovd at gmail.com (0x49D1)
Date: Wed, 28 Mar 2012 02:47:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Cant Start RabbitMQ after updating to 2.8.1 on
	Windows
Message-ID: <daa05add-aac5-4d24-8e52-5bcaf2a76e1f@q11g2000vbu.googlegroups.com>

Hello,
ive updated rabbitmq server from 2.7.1(which worked just fine in a
cluster) to 2.8.1 and now service fails to start.
log says that process was terminated unexpectedly(1067). In event
viewer i see the following:
RabbitMQ
   Erlang machine stopped instantly (distribution name conflict?). The
service is not restarted as OnFail is set to ignore.

Ive tried to uninstall rabbitmq, erlang, and reinstall them again. No
luck.
Cluster was with 2 nodes on different servers. After updating-on both
nodes rabbitmq cant start, tho ive managed(somehow) to downgrade one
node to 2.7.1 and now all clients work with that server. Another node
fails even downgrade, still returns the error ive provided in event
log.

Please help, i dont know what information exactly should i provide to
see where the problem is.
Thank you.

From simon at rabbitmq.com  Wed Mar 28 11:05:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 11:05:40 +0100
Subject: [rabbitmq-discuss] Federation Many Connections?
In-Reply-To: <CAJreXKD066=T=0Gh0Aomig+=hxS6wJAoPMUm49Y6-XELAjVitQ@mail.gmail.com>
References: <CAJreXKAz71QV7+o+-UOLNtM8GBQQYQ2Ok7W_+Jf_VG1UVRPFAg@mail.gmail.com>	<CAJreXKDKUNCUBFkAQt7PNue7vQPj39Z3XtRhAiWhPAifu7FOyw@mail.gmail.com>	<CAJreXKAUj5MB7HtMGiC5zEL6NqnyrUT=G0z4UR2ds47PcvDAJg@mail.gmail.com>
	<CAJreXKD066=T=0Gh0Aomig+=hxS6wJAoPMUm49Y6-XELAjVitQ@mail.gmail.com>
Message-ID: <4F72E274.5070205@rabbitmq.com>

On 27/03/12 18:20, James Carr wrote:
> One last note (I feel so spammy today) is that it stops generating new
> connections when I go and define the exchange on the upstream server
> that was missing it. The previous connections however stick around.

Thanks. Yes, this is a known issue; we'll fix it in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 28 11:06:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 11:06:18 +0100
Subject: [rabbitmq-discuss] Using ACLs to filter on topics?
In-Reply-To: <4F720E58.9060904@holtmans.com>
References: <4F720E58.9060904@holtmans.com>
Message-ID: <4F72E29A.6080401@rabbitmq.com>

On 27/03/12 20:00, Eric J. Holtman wrote:
> Having looked over this, I think the answer to my question
> is "NO", but....
>
> Is there some way using Rabbit's permission system to filter
> messages by topic?

No, there isn't.

> Or would I have to promote the account up out of the topic
> into its on exchange for something like this to work (and then
> user "clerk" might have read access to "^2\..*", while "admin"
> might have read access to "^{1,2}\..*"

You would have to do this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 28 11:32:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 11:32:04 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F728392.5070602@aol.com>
References: <4F6CD702.4050908@aol.com> <4F704404.8080504@rabbitmq.com>
	<4F728392.5070602@aol.com>
Message-ID: <4F72E8A4.1010609@rabbitmq.com>

On 28/03/12 04:20, DawgTool wrote:
> The Flow-Control in 2.8.1 has been a huge failure for my UAT systems.

Hi. Sorry to hear that. Obviously our testing hasn't shown any of the 
issues you raise. I'll try to reproduce your issues as best I can but 
the more information we have, the better. So just to be clear, you have:

* Clustering
* Non-persistent messages
* Queues with x-message-ttl set (and a large number of messages actually 
expiring, by the sound of it?)
* Large queues
* Some HA queues

I will try to reproduce based on the above, but anything else you can 
tell me would be a great help.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Wed Mar 28 12:12:37 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 28 Mar 2012 12:12:37 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <4F71929C.7070009@rabbitmq.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
Message-ID: <530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>

Timya,

> You might be able to get away with just setting $RABBITMQ_BASE.

Since you're on Ubuntu RABBITMQ_BASE is not relevant; the link to
relocate.html gives the full details.

The following settings are necessary to separate the node runtimes
completely, while allowing them to share the installed code base.

--------------------------var ----------------------default
RABBITMQ_CONFIG_FILE          /etc/rabbitmq/rabbitmq
RABBITMQ_MNESIA_BASE          /var/lib/rabbitmq/mnesia
RABBITMQ_LOG_BASE             /var/log/rabbitmq
RABBITMQ_ENABLED_PLUGINS_FILE /etc/rabbitmq/enabled_plugins

other file locations will, by default, be based on these.

If you set these in the shell environment then all the rabbitmq scripts
will pick them up (e.g. rabbitmqctl and so on). If you try to set them
in rabbitmq-env.conf, you can only have this file in one place per
rabbitmq installation, so you are limited to one node's settings.

So one way to work this is to have a wrapper script for each
node -- which sets the vars accordingly before calling the
rabbitmq{-server,ctl,-plugins} script. e.g.

node1:
-----------------------
#!/bin/sh
RABBITMQ_CONFIG_FILE=/node1/rabbitmq-node1
RABBITMQ_MNESIA_BASE=/node1/mnesia
RABBITMQ_LOG_BASE=/node1/log
RABBITMQ_ENABLED_PLUGINS_FILE=/node1/enabled_plugins

. $*
-----------------------

invoked as `node1 rabbitmqctl status`, or whatever. There are many many
ways to improve this (and you should!).

Ensure you do not share system resources (like tcp listeners)
accidentally by referring to common resources in the
${RABBITMQ_CONFIG_FILE}.config files.

Let us know how you get on.

Steve Powell  (a little bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 27 Mar 2012, at 11:12, Simon MacMullen wrote:

> On 27/03/12 11:09, Timya Tortus wrote:
>> Having Ubuntu 10.04, wanted to get two rabbitmq nodes up on one machine.
>> There is documentation available for single-machine cluster on
>> /http://www.rabbitmq.com/clustering.html#single-machine/.
>> But I need to create two rabbitmq nodes (viz. rabbit1 and hare1) which
>> should reffer their respective rabbitmq.config file for setting up
>> shovel and listners for tcp/web-access/management. Is there any document
>> available to setup multiple rabbitmq nodes on one machine or any other
>> way to accomplish the same.
> 
> Basically the same concept, just don't cluster them.
> 
> You should probably read:
> 
> http://www.rabbitmq.com/relocate.html
> 
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From zmstone at gmail.com  Wed Mar 28 12:37:13 2012
From: zmstone at gmail.com (stone)
Date: Wed, 28 Mar 2012 13:37:13 +0200
Subject: [rabbitmq-discuss] Why default connection heartbeat = 0?
Message-ID: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>

Why Erlang (perhaps other languages too?) client default connection
heartbeat value is set to 0 ?
Is there any special reason behind this or?
Because people often forget to give a value to this field,
this might lead to connection leaks due to some unexpected crashes or
network downtime.

BRs
/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/bab910be/attachment.htm>

From emile at rabbitmq.com  Wed Mar 28 12:38:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 12:38:28 +0100
Subject: [rabbitmq-discuss] Cant Start RabbitMQ after updating to 2.8.1
 on Windows
In-Reply-To: <daa05add-aac5-4d24-8e52-5bcaf2a76e1f@q11g2000vbu.googlegroups.com>
References: <daa05add-aac5-4d24-8e52-5bcaf2a76e1f@q11g2000vbu.googlegroups.com>
Message-ID: <4F72F834.9040006@rabbitmq.com>

Hi,

On 28/03/12 10:47, 0x49D1 wrote:
>    Erlang machine stopped instantly (distribution name conflict?). The
> service is not restarted as OnFail is set to ignore.

Can you confirm that you followed the instructions on upgrading clusters?
http://www.rabbitmq.com/clustering.html#upgrading
The error message indicates that a broker instance may already have been
running.

> Ive tried to uninstall rabbitmq, erlang, and reinstall them again. No
> luck.

What was the error? If you don't have any persistent messages or data
that needs to be preserved then you can move the database directory
(%RABBITMQ_BASE%) out of the way. If the installation still fails then
make sure you don't have a broker running with the same name.


-Emile



From emile at rabbitmq.com  Wed Mar 28 12:53:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 12:53:54 +0100
Subject: [rabbitmq-discuss] Why default connection heartbeat = 0?
In-Reply-To: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>
References: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>
Message-ID: <4F72FBD2.4040907@rabbitmq.com>

Hi,

On 28/03/12 12:37, stone wrote:
> Why Erlang (perhaps other languages too?) client default connection
> heartbeat value is set to 0 ?
> Is there any special reason behind this or?
> Because people often forget to give a value to this field,
> this might lead to connection leaks due to some unexpected crashes or
> network downtime.

The absence of AMQP heartbeats should not lead to connection leaks in
the broker or any well-written client.

The default broker behaviour is not to request heartbeats, but clients
may enable them if the network is known to be unreliable.

-Emile


From zmstone at gmail.com  Wed Mar 28 13:05:29 2012
From: zmstone at gmail.com (stone)
Date: Wed, 28 Mar 2012 14:05:29 +0200
Subject: [rabbitmq-discuss] Why default connection heartbeat = 0?
In-Reply-To: <4F72FBD2.4040907@rabbitmq.com>
References: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>
	<4F72FBD2.4040907@rabbitmq.com>
Message-ID: <CAPNZrFU_PpBJ=HeruNhYPfKcu89ENFW7WuJt1oBTUW+fn-Lp+A@mail.gmail.com>

Hi Emile

One more question, what could possibly be impacted if the default heartbeat
value is set to 2, 3 or 5 etc. ?

BRs
/stone

On Wed, Mar 28, 2012 at 1:53 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 28/03/12 12:37, stone wrote:
> > Why Erlang (perhaps other languages too?) client default connection
> > heartbeat value is set to 0 ?
> > Is there any special reason behind this or?
> > Because people often forget to give a value to this field,
> > this might lead to connection leaks due to some unexpected crashes or
> > network downtime.
>
> The absence of AMQP heartbeats should not lead to connection leaks in
> the broker or any well-written client.
>
> The default broker behaviour is not to request heartbeats, but clients
> may enable them if the network is known to be unreliable.
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/fb8c116c/attachment.htm>

From simon at rabbitmq.com  Wed Mar 28 13:42:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 13:42:00 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F72E8A4.1010609@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>
	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>
	<4F72E8A4.1010609@rabbitmq.com>
Message-ID: <4F730718.6080908@rabbitmq.com>

On 28/03/12 11:32, Simon MacMullen wrote:
> I will try to reproduce based on the above, but anything else you can
> tell me would be a great help.

Hmm, I'm struggling with this.

I can certainly get into a state with a combination of x-message-ttl, 
lots of messages expiring, and enough memory pressure to push much of 
the queue onto disc, such that the queue performance fluctuates quite a 
bit (as it switches between accepting new messages / paging messages out 
to disc / paging them back in / expiring them).

But I can't get a message rate that works OK in this scenario with flow 
control disabled but blocks for long periods with it enabled. If the 
message rate is high enough for flow control to kick in, then it's also 
high enough for memory use to go up as messages wait to enter the queue 
if flow control is disabled. Eventually the memory alarm goes off instead.

So can you provide more information about your use pattern?

Having said that, if you just want to disable flow control and are 
prepared to build from source, you could apply the following patch:

diff -r f0dafaca6cd1 src/rabbit_reader.erl
--- a/src/rabbit_reader.erl	Mon Mar 26 17:12:41 2012 +0100
+++ b/src/rabbit_reader.erl	Wed Mar 28 13:40:03 2012 +0100
@@ -360,7 +360,7 @@

  control_throttle(State = #v1{connection_state = CS,
                               conserve_memory  = Mem}) ->
-    case {CS, Mem orelse credit_flow:blocked()} of
+    case {CS, Mem} of
          {running,   true} -> State#v1{connection_state = blocking};
          {blocking, false} -> State#v1{connection_state = running};
          {blocked,  false} -> ok = rabbit_heartbeat:resume_monitor(

But I would like to understand more about what you're seeing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dawgtool at aol.com  Wed Mar 28 13:43:51 2012
From: dawgtool at aol.com (DawgTool)
Date: Wed, 28 Mar 2012 08:43:51 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F72E8A4.1010609@rabbitmq.com>
References: <4F6CD702.4050908@aol.com> <4F704404.8080504@rabbitmq.com>
	<4F728392.5070602@aol.com> <4F72E8A4.1010609@rabbitmq.com>
Message-ID: <4F730787.8050304@aol.com>

Hi Simon,

Thanks for looking into this.  This is a really large project which we 
will be scaling to handle ~300k msg/sec, right now 2.7.1 is running at 
90k msg/sec.

Here is my Configuration (UAT): (2 servers)
x4: Intel(R) Xeon(R) CPU X5650  @ 2.67GHz
x1: MemTotal:  16777216 kB

Number of publishers: 20
Testing with TTL only, No consumers (testing for durability during 
maintenance windows on consumers)
Publishing Rate: 100 - 350 messages/sec per publisher (ie: 100 x 20 = 
2000) to app.publish exchange
x-message-ttl at 10000 should cause flow control to block every second 
to 10 seconds
x-message-ttl at 60000 should cause flow control to block every second 
to 10 seconds, as queue reaches ~1gB expiring will lock the queue and 
everything will block for several minutes.


==> *rabbitmq status* <==
Linux 2.6.18-238.el5xen #1 SMP Thu Jan 13 16:41:45 EST 2011 x86_64 
x86_64 x86_64 GNU/Linux (CentOS 5)

Cluster status of node 'dc001 at dc001' ...
[{nodes,[{disc,['dc001 at dc002','dc001 at dc001']}]},
  {running_nodes,['dc001 at dc002','dc001 at dc001']}]
...done.

Status of node 'dc001 at dc001' ...
[{pid,26253},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
       {rabbit,"RabbitMQ","2.8.1"},
       {mnesia,"MNESIA  CXC 138 12","4.6"},
       {os_mon,"CPO  CXC 138 46","2.2.8"},
       {sasl,"SASL  CXC 138 11","2.2"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
       {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
       {inets,"INETS  CXC 138 49","5.8"},
       {stdlib,"ERTS  CXC 138 10","1.18"},
       {kernel,"ERTS  CXC 138 10","2.15"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,
      [{total,485192568},
       {processes,303500420},
       {processes_used,303400224},
       {system,181692148},
       {atom,711569},
       {atom_used,701087},
       {binary,158312632},
       {code,17241165},
       {ets,1651976}]},
  {vm_memory_high_watermark,0.3999999999650754},
  {vm_memory_limit,6871947673},
  {file_descriptors,
      [{total_limit,924},
       {total_used,23},
       {sockets_limit,829},
       {sockets_used,21}]},
  {processes,[{limit,1048576},{used,378}]},
  {run_queue,26},
  {uptime,32423}]
...done.


==> rabbitmq-cfg.dc001.config <==
[
   {rabbit,                    [{tcp_listeners,               [60001]},
                                {vm_memory_high_watermark,    0.4    },
                                {collect_statistics,          fine   },
                                {collect_statistics_interval, 5000   },
                                {hipe_compile,                true   }
                               ]
   },
   {mnesia,                    [{dc_dump_limit,            40   },
                                {dump_log_write_threshold, 50000},
                                {no_table_loaders,         1    },
                                {send_compressed,          9    },
                                {snmp,                     true }
                               ]
   },
   {rabbitmq_management,       [{http_log_dir,     
"/data/rabbitmq/dc001/rabbit-mgmt" },
                                {load_definitions, 
"/etc/rabbitmq/rabbitmq-mgt.dc001.json"}
                               ]
   },
   {rabbitmq_management_agent, [ {force_fine_statistics, true} ] },
   {rabbitmq_mochiweb,
                               [{listeners,
                                            [{'*',  [{port, 61001}]},
                                             {mgmt, [{port, 62001}]}
                                            ]
                               }]
   }
].

==> rabbitmq-env.dc001.conf <==
NODENAME=dc001
BASE=/data/rabbitmq/dc001
LOG_BASE=/data/rabbitmq/dc001/log
MNESIA_BASE=/data/rabbitmq/dc001/mnesia
CONFIG_FILE=/etc/rabbitmq/rabbitmq-cfg.dc001
SERVER_START_ARGS="+K true -smp enable"
ENABLED_PLUGINS_FILE=/etc/rabbitmq/rabbitmq-plg.dc001.conf

==> rabbitmq-mgt.dc001.json <==
{
"rabbit_version":"2.8.1",
"users":
   [
     {"name":"guest",     
"password_hash":"**secret**","tags":"administrator"     },
     {"name":"appadmin", "password_hash":"**secret**","tags":"app 
administrator"},
     {"name":"appwriter","password_hash":"**secret**","tags":"app 
write-only"   },
     {"name":"appreader","password_hash":"**secret**","tags":"app 
read-only"    }
    ],
"vhosts":
   [
     {"name":"/"},
     {"name":"app"}
   ],
"permissions":
   [
     {"user":"guest",     
"vhost":"app","configure":".*","write":".*","read":".*"},
     {"user":"guest",     "vhost":"/",   
"configure":".*","write":".*","read":".*"},
     {"user":"appadmin", 
"vhost":"app","configure":".*","write":".*","read":".*"},
     {"user":"appwriter","vhost":"app","configure":"",  
"write":".*","read":""  },
     {"user":"appreader","vhost":"app","configure":"",  "write":"",  
"read":".*"}
   ],
"queues":
   [
     
{"name":"app.noroute.all","vhost":"app","durable":true,"auto_delete":false,"arguments":{"x-message-ttl":360000,"x-ha-policy":"all"}},
     {"name":"app.q01.all",    
"vhost":"app","durable":true,"auto_delete":false,"arguments":{"x-message-ttl":10000, 
"x-ha-policy":"all"}},
     {"name":"app.q02.all",    
"vhost":"app","durable":true,"auto_delete":false,"arguments":{"x-message-ttl":10000, 
"x-ha-policy":"all"}}
   ],
"exchanges":
   [
     {"name":"app.publish","vhost":"app","type":"topic", 
"durable":true,"auto_delete":false,"internal":false,"arguments":{"alternate-exchange":"app.fanout"}},
     {"name":"app.fanout", 
"vhost":"app","type":"fanout","durable":true,"auto_delete":false,"internal":true, 
"arguments":{}                                  }
   ],
"bindings":
   [
     {"source":"app.fanout", 
"vhost":"app","destination":"app.noroute.all","destination_type":"queue","routing_key":"",      
"arguments":{}},
     
{"source":"app.publish","vhost":"app","destination":"app.q01.all",    
"destination_type":"queue","routing_key":"q01.#","arguments":{}},
     
{"source":"app.publish","vhost":"app","destination":"app.q02.all",    
"destination_type":"queue","routing_key":"q02.#","arguments":{}}
   ]
}


==> rabbitmq-plg.dc001.conf <==
[rabbitmq_management,rabbitmq_management_agent].


==> *record example* <==
Timestamp, Message_id, Delivery Mode, etc. set by the publisher.

Routing Key:      q01.abc.123.1025819054.1
Timestamp:        1332936969243454
Message_id:       648926607241636355
Delivery_mode:    1
Content_encoding: en_US.UTF-8
content_type:     application/octet-stream
Payload:          348 bytes
6Np6696Kw66666/To666R66S66W86pol3W66w6t66S646266666666Q666P4666Q6+66t6t6666n66/n669w666666/66rQt6766rTL06O/6626m662T7T4Qq6016W66QL6666OL66S56P6Orp3s666+6/6666666l666L0K0nQ64Q6n6s+6m66M86kT666M666321T6S6PR946Q66KO66666+s6o664K63T6W665066666n24p66+pMT66663t666n/4o606q67N6K6T7116mLS66676K66T666666O+6q8666r6666m68rQ666k668mm66p66W6l/QlmKW66666966666=




On 3/28/12 6:32 AM, Simon MacMullen wrote:
> On 28/03/12 04:20, DawgTool wrote:
>> The Flow-Control in 2.8.1 has been a huge failure for my UAT systems.
>
> Hi. Sorry to hear that. Obviously our testing hasn't shown any of the 
> issues you raise. I'll try to reproduce your issues as best I can but 
> the more information we have, the better. So just to be clear, you have:
>
> * Clustering
> * Non-persistent messages
> * Queues with x-message-ttl set (and a large number of messages 
> actually expiring, by the sound of it?)
> * Large queues
> * Some HA queues
>
> I will try to reproduce based on the above, but anything else you can 
> tell me would be a great help.
>
> Cheers, Simon
>


From simon at rabbitmq.com  Wed Mar 28 13:45:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 13:45:24 +0100
Subject: [rabbitmq-discuss] |Spam|  |Spam| question about rabbitmq TPS
In-Reply-To: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
Message-ID: <4F7307E4.2040800@rabbitmq.com>

On 26/03/12 12:15, ??? wrote:
> can you tell me why TPS is too high at first and sometimes maybe even
> more higher(maybe over 30000/s) when I send messages to rabbitmq cluster
> concurrently? thanks!

Hi. It's not quite clear what you mean by TPS, but lets assume you are 
measuring the message publish rate. The chart you show looks like TCP 
buffers filling up - your client app will initially be able to fill up 
buffers at the client and server side, and only when they are full will 
the speed of the system be constrained by how fast Rabbit can publish.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 28 13:48:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 13:48:50 +0100
Subject: [rabbitmq-discuss] Why default connection heartbeat = 0?
In-Reply-To: <CAPNZrFU_PpBJ=HeruNhYPfKcu89ENFW7WuJt1oBTUW+fn-Lp+A@mail.gmail.com>
References: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>
	<4F72FBD2.4040907@rabbitmq.com>
	<CAPNZrFU_PpBJ=HeruNhYPfKcu89ENFW7WuJt1oBTUW+fn-Lp+A@mail.gmail.com>
Message-ID: <4F7308B2.7080706@rabbitmq.com>

Hi,

On 28/03/12 13:05, stone wrote:
> One more question, what could possibly be impacted if the default
> heartbeat value is set to 2, 3 or 5 etc. ? 

There is a trade-off. More frequent heartbeats incur greater network and
CPU overhead but detect network conditions earlier. Lower frequencies
incur less overhead but are slower to detect network problems. You
should set the value appropriately for you environment.


In answer to your previous question, some reasons for the current
default have come to light. In previous versions of RabbitMQ (before
v1.7.0) the heartbeat was set to a non-zero value and this caused these
problems:

On busy machines the heartbeats would not be generated quickly enough
and this lead to dropped connections and poor performance.

One machines with thousands of connections the effort of generating
heartbeats would consume all the CPU resources.

On brokers that have no activity the heartbeats would prevent paging to
disk and even Erlang hibernation.



-Emile



From zmstone at gmail.com  Wed Mar 28 13:53:12 2012
From: zmstone at gmail.com (stone)
Date: Wed, 28 Mar 2012 14:53:12 +0200
Subject: [rabbitmq-discuss] Why default connection heartbeat = 0?
In-Reply-To: <4F7308B2.7080706@rabbitmq.com>
References: <CAPNZrFWe767cV41KCCUWF3go+Yp6LE35v_P9x83oZs59RWsW7Q@mail.gmail.com>
	<4F72FBD2.4040907@rabbitmq.com>
	<CAPNZrFU_PpBJ=HeruNhYPfKcu89ENFW7WuJt1oBTUW+fn-Lp+A@mail.gmail.com>
	<4F7308B2.7080706@rabbitmq.com>
Message-ID: <CAPNZrFW3zD-cLNk8yMnM8cSpDhyHuN4CWq4fnt7ZJhxTKe1GUQ@mail.gmail.com>

Thanks!

On Wed, Mar 28, 2012 at 2:48 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 28/03/12 13:05, stone wrote:
> > One more question, what could possibly be impacted if the default
> > heartbeat value is set to 2, 3 or 5 etc. ?
>
> There is a trade-off. More frequent heartbeats incur greater network and
> CPU overhead but detect network conditions earlier. Lower frequencies
> incur less overhead but are slower to detect network problems. You
> should set the value appropriately for you environment.
>
>
> In answer to your previous question, some reasons for the current
> default have come to light. In previous versions of RabbitMQ (before
> v1.7.0) the heartbeat was set to a non-zero value and this caused these
> problems:
>
> On busy machines the heartbeats would not be generated quickly enough
> and this lead to dropped connections and poor performance.
>
> One machines with thousands of connections the effort of generating
> heartbeats would consume all the CPU resources.
>
> On brokers that have no activity the heartbeats would prevent paging to
> disk and even Erlang hibernation.
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/56f80006/attachment.htm>

From denis.melique at morpho.com  Wed Mar 28 14:47:05 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Wed, 28 Mar 2012 15:47:05 +0200
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>

I'am testing shovel with Rabbit 2.7.1.
I set two clusters of 2 hosts RedHat 6, and a shovel configuration to forward incoming messages from one
cluster to the other.
Messages shoveled from one cluster to the other, are travelling through a bridge (Linux machine configured as bridge).
I can change the bridge configuration to simulate a WAN (slow speed, add latency, lose some packets),
I also can cut the WAN by resetting the bridge, wait a while and then reconnect it, to simulate a network outage.

The input throughput is about 4Mbit/s.

In most of cases everything is fine, I just notice two things :

First:
-----
When I slow the WAN to 1 Mbit/s, I see messages accumulating in the shovel queue, which is what as expected.
Then once my throughput go to zero, messages are slowly transferred to the distant cluster, and that's OK as well.

The problem is that messages are not processed in the same order on the distant cluster than on the local.
My feeling is that with 1 Mbit/s some messages fail to be transferred correctly, and are re-sent later.
( I have the same problem when I simulate a very high level of packet loss (30%), with a 10Mbit/s speed)

Is there such a logic in Shovel ?
Is there a way to configured Shovel to guaranty the sequence of messages ?

Second:
---------
When a simulate a WAN outage lasting 2 hours, messages staying in the shovel queue have a status,
first set to "unacknowledged".
Then, after about 900 sec,  they all have their status changed to "ready".
When the network recovers, all the pending messages change back to "unacknowledged", before being sent
to the distant cluster.
It does not seems to be a problem for us, just I'd like to understand this behavior, and if it could impact rabbit performances.

Thank you.

Denis
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/30769a2b/attachment.htm>

From puru.belagali at gazprom-mt.com  Wed Mar 28 14:52:46 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Wed, 28 Mar 2012 13:52:46 +0000
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections alive
Message-ID: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>

Hi All,

We are having an issue at the moment to keep connections alive between the Rabbit Client and Server across 2 different sites with a firewall/load balancer inbetween.
The Fire wall/Load balancer has an ldle timer of 1 hr after which it closes the underlying tcp connection if the channel is inactive for over an hour.
This is causing problems especially when the Client has a subscriber listening for messages from a rabbit server behind the firewall.

We added the connFactory.RequestedHeartbeat = 10; and tested this but the connection just seems to close after 10 seconds. It doesn?t seem to work. I don?t know if that?s something else needs to be enabled ?

Your help is must appreciated.

Thankyou,
Puru



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/307b8e7c/attachment.htm>

From e.gherardini at hotmail.com  Wed Mar 28 14:58:18 2012
From: e.gherardini at hotmail.com (Emanuele G)
Date: Wed, 28 Mar 2012 06:58:18 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
 randomly throwing exceptions
Message-ID: <33544834.post@talk.nabble.com>


Hello,
I am using the latest RabbitMQ java client, but while doing some perf. test
I randomly get this exception:
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: {#method<connection.close>(reply-code=503,
reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20,
method-id=10), null, ""}
	at com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:182)
~[amqp-client-2.8.1.jar:na]
	at com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:170)
~[amqp-client-2.8.1.jar:na]

Why is this happening and how can I workaround it ?
-- 
View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544834.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From e.gherardini at hotmail.com  Wed Mar 28 16:08:07 2012
From: e.gherardini at hotmail.com (Emanuele G)
Date: Wed, 28 Mar 2012 08:08:07 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
 randomly throwing exceptions
In-Reply-To: <33544834.post@talk.nabble.com>
References: <33544834.post@talk.nabble.com>
Message-ID: <33544840.post@talk.nabble.com>




Emanuele G wrote:
> 
> Hello,
> I am using the latest RabbitMQ java client, but while doing some perf.
> test I randomly get this exception:
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
> reason: {#method<connection.close>(reply-code=503,
> reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20,
> method-id=10), null, ""}
> 	at com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:182)
> ~[amqp-client-2.8.1.jar:na]
> 	at com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:170)
> ~[amqp-client-2.8.1.jar:na]
> 
> Why is this happening and how can I workaround it ?
> 

I want to add that I am getting the same error this user reported in this
discussion:

http://old.nabble.com/ShutdownSignalException-second-%27channel.open%27-to33227075.html#a33227075
-- 
View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544840.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From puru.belagali at gazprom-mt.com  Wed Mar 28 16:48:51 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Wed, 28 Mar 2012 15:48:51 +0000
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections
	alive
In-Reply-To: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
References: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
Message-ID: <1C007B2F327A00438987610C4ADC71162488D44E@EXCMBX02PR.Gazpromuk.intra>

Hi All,

To add, a clarification. Should the server and client both request for heartbeat. In our case, the server(subscriber) is requesting for heartbeat via RequestedHeartbeat property , but the client is not. Will that work?

Thanks,
Puru

Puru Belagali | Sapient | +44 7588 620 161 | pbelagali at sapient.com<mailto:pbelagali at sapient.com>

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Puru Belagali
Sent: 28 March 2012 14:53
To: rabbitmq-discuss at lists.rabbitmq.com; emile at rabbitmq.com; simon at rabbitmq.com
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections alive

Hi All,

We are having an issue at the moment to keep connections alive between the Rabbit Client and Server across 2 different sites with a firewall/load balancer inbetween.
The Fire wall/Load balancer has an ldle timer of 1 hr after which it closes the underlying tcp connection if the channel is inactive for over an hour.
This is causing problems especially when the Client has a subscriber listening for messages from a rabbit server behind the firewall.

We added the connFactory.RequestedHeartbeat = 10; and tested this but the connection just seems to close after 10 seconds. It doesn?t seem to work. I don?t know if that?s something else needs to be enabled ?

Your help is must appreciated.

Thankyou,
Puru



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/24b2616d/attachment.htm>

From simon at rabbitmq.com  Wed Mar 28 16:57:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 16:57:11 +0100
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
Message-ID: <4F7334D7.6030709@rabbitmq.com>

On 28/03/12 14:47, MELIQUE Denis (MORPHO) wrote:
> When I slow the WAN to 1 Mbit/s, I see messages accumulating in the
> shovel queue, which is what as expected.
>
> Then once my throughput go to zero, messages are slowly transferred to
> the distant cluster, and that?s OK as well.
>
> The problem is that messages are not processed in the same order on the
> distant cluster than on the local.
>
> My feeling is that with 1 Mbit/s some messages fail to be transferred
> correctly, and are re-sent later.
>
> ( I have the same problem when I simulate a very high level of packet
> loss (30%), with a 10Mbit/s speed)
>
> Is there such a logic in Shovel ?

That seems unlikely. Packet loss should lead to redelivery at the TCP 
level, which the shovel should be unaware of.

Messages should only get redelivered if the consumer rejects them or the 
TCP connection is interrupted completely. Shovel won't reject messages, 
but maybe the connection is being interrupted and re-established? You 
should be able to see this in the logs. You would also see a 
"redelivered" message rate in mgmt.

> Is there a way to configured Shovel to guaranty the sequence of messages ?

This should already be happening.

> Second:
>
> ---------
>
> When a simulate a WAN outage lasting 2 hours, messages staying in the
> shovel queue have a status,
>
> first set to ?unacknowledged?.
>
> Then, after about 900 sec, they all have their status changed to ?ready?.
>
> When the network recovers, all the pending messages change back to
> ?unacknowledged?, before being sent
>
> to the distant cluster.
>
> It does not seems to be a problem for us, just I?d like to understand
> this behavior, and if it could impact rabbit performances.

unacknowledged -> the message has been consumed by the remote end, but 
not acknowledged.

After 900 seconds presumably the connection is determined to be dead by 
RabbitMQ and then the messages go back into the queue ("ready").

Then when the network recovers, they are sent again and become 
"unacknowledged" again, until the acks come in.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Mar 28 16:58:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 28 Mar 2012 16:58:56 +0100
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections
	alive
In-Reply-To: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
References: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
Message-ID: <4F733540.50200@rabbitmq.com>

Hi Puru,

On 28/03/12 14:52, Puru Belagali wrote:
> We are having an issue at the moment to keep connections alive between
> the Rabbit Client and Server across 2 different sites with a
> firewall/load balancer inbetween.
> 
> The Fire wall/Load balancer has an ldle timer of 1 hr after which it
> closes the underlying tcp connection if the channel is inactive for over
> an hour.
> 
> This is causing problems especially when the Client has a subscriber
> listening for messages from a rabbit server behind the firewall.
> 
> We added the connFactory.RequestedHeartbeat = 10; and tested this but
> the connection just seems to close after 10 seconds. It doesn?t seem to
> work. I don?t know if that?s something else needs to be enabled ?

There is nothing else that needs to be enabled - setting the value in
the connection factory as you have done is correct. I'm unable to
reproduce the problem you report though. Using Rabbit v2.8.1 heartbeat
frames are exchanged in both directions between the broker and the C#
client.

May I suggest the use of a protocol analyser or network tracer on both
sides the firewall to confirm what traffic is passed between the client
and the broker? The RabbitMQ Java client includes a tracer that you may
find convenient for this purpose:

http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

Wireshark includes an AMQP dissector and may also be used.


-Emile




From puru.belagali at gazprom-mt.com  Wed Mar 28 17:20:53 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Wed, 28 Mar 2012 16:20:53 +0000
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections
	alive
In-Reply-To: <4F733540.50200@rabbitmq.com>
References: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
	<4F733540.50200@rabbitmq.com>
Message-ID: <1C007B2F327A00438987610C4ADC71162488D475@EXCMBX02PR.Gazpromuk.intra>

Thanks Emile,

Is this ok in Rabbit v2.6.0 ? 

There is definitely a firewall/load balancer between the C# client and Rabbit Broker. I'll investigate. 

Thanks,
Puru

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 28 March 2012 16:59
To: Puru Belagali
Cc: rabbitmq-discuss at lists.rabbitmq.com; simon at rabbitmq.com
Subject: Re: .NET rabbit heartbeat to keep connections alive

Hi Puru,

On 28/03/12 14:52, Puru Belagali wrote:
> We are having an issue at the moment to keep connections alive between 
> the Rabbit Client and Server across 2 different sites with a 
> firewall/load balancer inbetween.
> 
> The Fire wall/Load balancer has an ldle timer of 1 hr after which it 
> closes the underlying tcp connection if the channel is inactive for 
> over an hour.
> 
> This is causing problems especially when the Client has a subscriber 
> listening for messages from a rabbit server behind the firewall.
> 
> We added the connFactory.RequestedHeartbeat = 10; and tested this but 
> the connection just seems to close after 10 seconds. It doesn?t seem 
> to work. I don?t know if that?s something else needs to be enabled ?

There is nothing else that needs to be enabled - setting the value in the connection factory as you have done is correct. I'm unable to reproduce the problem you report though. Using Rabbit v2.8.1 heartbeat frames are exchanged in both directions between the broker and the C# client.

May I suggest the use of a protocol analyser or network tracer on both sides the firewall to confirm what traffic is passed between the client and the broker? The RabbitMQ Java client includes a tracer that you may find convenient for this purpose:

http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

Wireshark includes an AMQP dissector and may also be used.


-Emile




From puru.belagali at gazprom-mt.com  Wed Mar 28 17:30:00 2012
From: puru.belagali at gazprom-mt.com (Puru Belagali)
Date: Wed, 28 Mar 2012 16:30:00 +0000
Subject: [rabbitmq-discuss] .NET rabbit heartbeat to keep connections
	alive
In-Reply-To: <4F733540.50200@rabbitmq.com>
References: <1C007B2F327A00438987610C4ADC71162488D3B4@EXCMBX02PR.Gazpromuk.intra>
	<4F733540.50200@rabbitmq.com>
Message-ID: <1C007B2F327A00438987610C4ADC71162488D48C@EXCMBX02PR.Gazpromuk.intra>

Hi Emile,

I am trying to do a force close connection on the Rabbit Web UI. I am getting this error below. The underlying tcp connection is already closed when we look at the network. 

They seem be there lying around idle since yesterday morning. We have rebooted the Rabbit box yesterday evening. How do I close these connections?

Got response code 500 with body
Internal Server Error
The server encountered an error while processing this request:

{throw,{error,{not_a_connection_pid,<0.13436.209>}},
       [{rabbit_networking,close_connection,2},
        {rabbit_mgmt_wm_connection,delete_resource,2},
        {webmachine_resource,resource_call,3},
        {webmachine_resource,do,3},
        {webmachine_decision_core,resource_call,1},
        {webmachine_decision_core,decision,1},
        {webmachine_decision_core,handle_request,2},
        {rabbit_webmachine,'-makeloop/1-fun-0-',3}]}

Thanks,
Puru

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 28 March 2012 16:59
To: Puru Belagali
Cc: rabbitmq-discuss at lists.rabbitmq.com; simon at rabbitmq.com
Subject: Re: .NET rabbit heartbeat to keep connections alive

Hi Puru,

On 28/03/12 14:52, Puru Belagali wrote:
> We are having an issue at the moment to keep connections alive between 
> the Rabbit Client and Server across 2 different sites with a 
> firewall/load balancer inbetween.
> 
> The Fire wall/Load balancer has an ldle timer of 1 hr after which it 
> closes the underlying tcp connection if the channel is inactive for 
> over an hour.
> 
> This is causing problems especially when the Client has a subscriber 
> listening for messages from a rabbit server behind the firewall.
> 
> We added the connFactory.RequestedHeartbeat = 10; and tested this but 
> the connection just seems to close after 10 seconds. It doesn?t seem 
> to work. I don?t know if that?s something else needs to be enabled ?

There is nothing else that needs to be enabled - setting the value in the connection factory as you have done is correct. I'm unable to reproduce the problem you report though. Using Rabbit v2.8.1 heartbeat frames are exchanged in both directions between the broker and the C# client.

May I suggest the use of a protocol analyser or network tracer on both sides the firewall to confirm what traffic is passed between the client and the broker? The RabbitMQ Java client includes a tracer that you may find convenient for this purpose:

http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

Wireshark includes an AMQP dissector and may also be used.


-Emile




From ghepardo_1982 at hotmail.com  Wed Mar 28 17:29:51 2012
From: ghepardo_1982 at hotmail.com (Emanuele Gheradini)
Date: Wed, 28 Mar 2012 09:29:51 -0700 (PDT)
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
 randomly throwing exceptions
In-Reply-To: <33544840.post@talk.nabble.com>
References: <33544834.post@talk.nabble.com> <33544840.post@talk.nabble.com>
Message-ID: <33544845.post@talk.nabble.com>


I want also to add that what I understood is:

for some reasons RabbitMQ java client gives the same channel (or channel
number) to different threads, then these threads will perform different
operations on that channel which will be closed by RabbitMQjavaclient, thus
resulting in the crash of the waitForConfirm method, at line 182 (here is
the snipped):

 181: if (getCloseReason() != null) {
 182:                  throw Utility.fixStackTrace(getCloseReason());
 183:               }


I tried getting channels from rabbit in this way:

AtomicInteger chanNumber = new AtomicInteger(0);

connection.createChannel(chanNumber.getAndIncrement());

to be sure that each thread gets a channel with a different channelNumber,
but this does not work either...


I hope someone can give me a suggestion.

Thanks.
-- 
View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544845.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From steve at rabbitmq.com  Wed Mar 28 18:17:57 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 28 Mar 2012 18:17:57 +0100
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
	randomly throwing exceptions
In-Reply-To: <33544845.post@talk.nabble.com>
References: <33544834.post@talk.nabble.com> <33544840.post@talk.nabble.com>
	<33544845.post@talk.nabble.com>
Message-ID: <C9733A8F-F2BF-49BD-AD8A-84F5BF384A9A@rabbitmq.com>

Emanuele,

There should be no need to use AtomicInteger to guarantee a new channel
number; createChannel should guarantee this for you.

You have shown me the stack trace -- and I can see that your application
threads are issuing waitForConfirms().

Can you tell me a little more about how your threads use the Channel?
I'd like to know the state of the channel the thread is using, at the
time of the call. What happened on that channel immediately before the
waitForConfirms() call?

Perhaps some more snippets of the thread code would be useful, and a
little more of the stack trace would help.

Finally, was there anything in the rabbit log around this time?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 28 Mar 2012, at 17:29, Emanuele Gheradini wrote:

> 
> I want also to add that what I understood is:
> 
> for some reasons RabbitMQ java client gives the same channel (or channel
> number) to different threads, then these threads will perform different
> operations on that channel which will be closed by RabbitMQjavaclient, thus
> resulting in the crash of the waitForConfirm method, at line 182 (here is
> the snipped):
> 
> 181: if (getCloseReason() != null) {
> 182:                  throw Utility.fixStackTrace(getCloseReason());
> 183:               }
> 
> 
> I tried getting channels from rabbit in this way:
> 
> AtomicInteger chanNumber = new AtomicInteger(0);
> 
> connection.createChannel(chanNumber.getAndIncrement());
> 
> to be sure that each thread gets a channel with a different channelNumber,
> but this does not work either...
> 
> 
> I hope someone can give me a suggestion.
> 
> Thanks.
> -- 
> View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544845.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ejarendt at gmail.com  Wed Mar 28 18:19:37 2012
From: ejarendt at gmail.com (Eric)
Date: Wed, 28 Mar 2012 10:19:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Exclusive consuming with mirrored queues
Message-ID: <c6880118-7225-483e-b911-0a2ffe9d56bc@oq7g2000pbb.googlegroups.com>

I recently discovered exclusive consuming, which is a wonderful thing
for my application.  I need to match up pairs of messages coming
through the queue (order doesn't matter) so it's essential that
there's no round-robin stuff happening for queue consumers.

I'm also using mirrored queues in a cluster, so I was wondering if
there would be any trouble with exclusive consuming in that
situation.  If two consumers attempt to consume exclusively from the
same mirrored queue on different broker instances in the cluster, will
the cluster still restrict to one consumer?

From simon at rabbitmq.com  Wed Mar 28 18:27:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Mar 2012 18:27:35 +0100
Subject: [rabbitmq-discuss] Exclusive consuming with mirrored queues
In-Reply-To: <c6880118-7225-483e-b911-0a2ffe9d56bc@oq7g2000pbb.googlegroups.com>
References: <c6880118-7225-483e-b911-0a2ffe9d56bc@oq7g2000pbb.googlegroups.com>
Message-ID: <4F734A07.5090807@rabbitmq.com>

On 28/03/12 18:19, Eric wrote:
> If two consumers attempt to consume exclusively from the
> same mirrored queue on different broker instances in the cluster, will
> the cluster still restrict to one consumer?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ejarendt at gmail.com  Wed Mar 28 18:29:27 2012
From: ejarendt at gmail.com (Eric)
Date: Wed, 28 Mar 2012 10:29:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Exclusive consuming with mirrored queues
In-Reply-To: <4F734A07.5090807@rabbitmq.com>
References: <c6880118-7225-483e-b911-0a2ffe9d56bc@oq7g2000pbb.googlegroups.com>
	<4F734A07.5090807@rabbitmq.com>
Message-ID: <7687b580-8345-4f88-9ca5-ca8f66878bad@t2g2000pbg.googlegroups.com>

Great, thanks!  I assumed that was the case, but didn't want to find
out the hard way.

On Mar 28, 10:27?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 28/03/12 18:19, Eric wrote:
>
> > If two consumers attempt to consume exclusively from the
> > same mirrored queue on different broker instances in the cluster, will
> > the cluster still restrict to one consumer?
>
> Yes.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Wed Mar 28 19:04:27 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 28 Mar 2012 11:04:27 -0700
Subject: [rabbitmq-discuss] Pika channels sensitive to prior operation
	state?
In-Reply-To: <CB97A153.3DFD7%mpietrek@skytap.com>
References: <CB97A153.3DFD7%mpietrek@skytap.com>
Message-ID: <CACLE7ix_9u8a5d-m_khLyNYS3-u0jE50Z7tUS4FY1UegmH8Nng@mail.gmail.com>

Following up on this problem, I've narrowed the issue down to a trivial
example that hangs:

import pika
HOSTNAME = "192.168.78.18"  # Plug in your own server name here.

if __name__ == '__main__':
    connection =
pika.BlockingConnection(pika.ConnectionParameters(host=HOSTNAME, port=5672))
    channel = connection.channel()

    try:
        method_frame, _, body = channel.basic_get(queue="NotAValidQueue")
    except Exception as e:
        print "channel.basic_get threw %s - This is expected" % (e)
    else:
        print "channel.basic_get unexpectedly did not throw an exception."

    print "Before channel.tx_select - Will hang on next line."
    channel.tx_select()
    print "After channel.tx_select - Unexpectedly got here."

    channel.tx_commit()


On Tue, Mar 27, 2012 at 4:54 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> I have a Pika 0.9.5. app communicating with a 2.81 rabbitmq-server
> instance.
>
> I'm noticing some odd behavior, and am not sure if it's a problem on my
> end, on rabbitmq's end, or in Pika.
>
> At it's simplest, I'm seeing a call to channel.tx_select() hang. Breaking
> in with the debugger, the stack looks like this:
>
> _handle_read [base_connection.py:151]
> process_data_events [blocking_connection.py:94]
> send_method [blocking_connection.py:244]
> rpc [blocking_connection.py:216]
> tx_select [spec.py:2615]
>
> Stepping for a bit, I see that the code never gets out of the loop in the
> send_method() function.
>
> In ordinary circumstances, my code that calls tx_select() works fine.
> However, in the case where it hangs, an immediately prior call to
> channel.basic_get() has thrown an exception:
>
> 'pika.exceptions.AMQPChannelError'>:(404, "NOT_FOUND - no queue 'foobar'
> in vhost '/'"
>
> I'm baffled. Known issue? Something I'm doing wrong?
>
> Thanks,
>
> Matt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/b2adc54d/attachment.htm>

From alan.antonuk at gmail.com  Wed Mar 28 19:14:29 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 28 Mar 2012 14:14:29 -0400
Subject: [rabbitmq-discuss] Pika channels sensitive to prior operation
	state?
In-Reply-To: <CACLE7ix_9u8a5d-m_khLyNYS3-u0jE50Z7tUS4FY1UegmH8Nng@mail.gmail.com>
References: <CB97A153.3DFD7%mpietrek@skytap.com>
	<CACLE7ix_9u8a5d-m_khLyNYS3-u0jE50Z7tUS4FY1UegmH8Nng@mail.gmail.com>
Message-ID: <CAAt2poLEY2dVpLX1CgqyT=1qWxVz+x2XRnBdXhhEgUKXVNZrfQ@mail.gmail.com>

I can't tell you why its hanging, but in general when a channel throws an
exception, the channel is closed (its how the AMQP protocol works).  Trying
to use the channel after a channel exception (or any closed channel) will
result in connection exception which will shut down the entire connection.

-Alan

On Wed, Mar 28, 2012 at 2:04 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Following up on this problem, I've narrowed the issue down to a trivial
> example that hangs:
>
> import pika
> HOSTNAME = "192.168.78.18"  # Plug in your own server name here.
>
> if __name__ == '__main__':
>     connection =
> pika.BlockingConnection(pika.ConnectionParameters(host=HOSTNAME, port=5672))
>     channel = connection.channel()
>
>     try:
>         method_frame, _, body = channel.basic_get(queue="NotAValidQueue")
>     except Exception as e:
>         print "channel.basic_get threw %s - This is expected" % (e)
>     else:
>         print "channel.basic_get unexpectedly did not throw an exception."
>
>     print "Before channel.tx_select - Will hang on next line."
>     channel.tx_select()
>     print "After channel.tx_select - Unexpectedly got here."
>
>     channel.tx_commit()
>
>
>
> On Tue, Mar 27, 2012 at 4:54 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> I have a Pika 0.9.5. app communicating with a 2.81 rabbitmq-server
>> instance.
>>
>> I'm noticing some odd behavior, and am not sure if it's a problem on my
>> end, on rabbitmq's end, or in Pika.
>>
>> At it's simplest, I'm seeing a call to channel.tx_select() hang. Breaking
>> in with the debugger, the stack looks like this:
>>
>> _handle_read [base_connection.py:151]
>> process_data_events [blocking_connection.py:94]
>> send_method [blocking_connection.py:244]
>> rpc [blocking_connection.py:216]
>> tx_select [spec.py:2615]
>>
>> Stepping for a bit, I see that the code never gets out of the loop in the
>> send_method() function.
>>
>> In ordinary circumstances, my code that calls tx_select() works fine.
>> However, in the case where it hangs, an immediately prior call to
>> channel.basic_get() has thrown an exception:
>>
>> 'pika.exceptions.AMQPChannelError'>:(404, "NOT_FOUND - no queue 'foobar'
>> in vhost '/'"
>>
>> I'm baffled. Known issue? Something I'm doing wrong?
>>
>> Thanks,
>>
>> Matt
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/c429df63/attachment.htm>

From sgarten at purchasingpower.com  Wed Mar 28 20:21:36 2012
From: sgarten at purchasingpower.com (Scott Garten)
Date: Wed, 28 Mar 2012 15:21:36 -0400
Subject: [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory leak
Message-ID: <B4E959105FBF514F9500B9A20310D5BD027ED7A5E0@PPC-EMAIL.purchasingpwr.com>

Hi all,

This morning started out with an OutOfMemory exception after I kicked off a sustainability test before I left the office for the day; digging into it we found a number of classes failing to free up. They appear to correlate to the number of messages that we sent to rabbitmq. A web search revealed a defect # 24723 was identified and reported fixed.

We were using 2.7.1 of the Java client, but since have also tried 2.8.0 and 2.8.1 of the client - hoping that one of these later releases contained a fix. Unfortunately, we are still seeing the same memory leak behavior.

Here is a jmap dump of the classes that we witness not freeing (even after an explicit GC).

  19:          1979         189984  com.rabbitmq.client.impl.ChannelN
  28:          1980          79200  com.rabbitmq.client.impl.CommandAssembler
  29:          1979          79160  com.rabbitmq.client.ShutdownSignalException
  30:          1979          79160  com.rabbitmq.client.impl.ConsumerDispatcher
  35:          1979          63328  com.rabbitmq.client.impl.AMQImpl$Channel$Close
  48:          1980          31680  com.rabbitmq.client.impl.AMQCommand

Appears to be similar to that which was previously reported on the mailing list.

Not certain where to turn at this point. Can anyone confirm that they see the fix freeing up the objects?

Thanks, Scott.

The information contained in this transmission is confidential. It is intended solely for the use of the individual(s) or organization(s) to whom it is addressed. Any disclosure, copying or further distribution is not permitted unless such privilege is explicitly granted in writing by Purchasing Power LLC. Furthermore, Purchasing Power LLC.. is not responsible for the proper and complete transmission of the substance of this communication, nor for any delay in its receipt. 

All outgoing emails are scanned for viruses by Barracuda Spam Firewall.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/ba5c8c65/attachment.htm>

From zmstone at gmail.com  Wed Mar 28 20:23:24 2012
From: zmstone at gmail.com (stone)
Date: Wed, 28 Mar 2012 21:23:24 +0200
Subject: [rabbitmq-discuss] how to get higher throughput?
Message-ID: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>

Hi

I have a use case which is very similar to RPC:
The clients subscribe to their own queues bound to routing key
"response.myname",
and they publish messages with routing key "request.myname", then wait for
response.

On the other side of the broker, there is this RPC queue, bound to routing
key "request.#",
many workers consume from this queue, process the messages then send back
response.

The request size is around 10K bytes, response is just few bytes, and all
"RPC"s are synchronized calls.
i.e. client wait for response before send another request.

After some benchmark tests, we found that the message rate of the RPC queue
hits around 1400.
It doesn't help by increasing the number of publishers or consumers, or
both.

Hope it's enough background info to finally ask my question:
what could possibly be the bottleneck in my tests, and how to get higher
throughput ?

-----------------env-------------------
Rabbit version: 2.7.1
Memory high watermark: 25G
CPU (24 processors) model: Intel(R) Xeon(R) CPU X5690  @ 3.47GH

BRs
/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/8944b2d7/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Mar 28 20:35:59 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 28 Mar 2012 12:35:59 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.7.1 Failed and Stopped TCP Listener
Message-ID: <BCC407A444557E41B0D8B0260D68499204B12FF0@CA1EXCLV07.adcorp.kla-tencor.com>

Hi All,

 

I encountered an serious problem with RabbitMQ 2.7.1 that the server
failed with an internal error and stopped the TCP listener.

I used version 2.6.0 before, and this problem also happened once.

I searched the previous threads and found a similar one. However, in
that  thread someone said this problem had been fixed in version 2.6.x.

Can anyone give me some clue or suggestion?  Has this problem been fixed
in the new 2.8.x version?

 

Here is the error reports from the log file.

 

=ERROR REPORT==== 20-Mar-2012::13:26:34 ===

** Generic server msg_store_persistent terminating

** Last message in was timeout

** When Server state == {msstate,

"c:/DeepGreen/RabbitMQ/db/rabbit at AG4800-FECD-mnesia/msg_store_persistent
",

rabbit_msg_store_ets_index,

{state,213062,

"c:/DeepGreen/RabbitMQ/db/rabbit at AG4800-FECD-mnesia/msg_store_persistent
"},

146,#Ref<0.0.260.85084>,

{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[],[]}}},

#Ref<0.0.261.157347>,1312,11060186,[],<0.205.0>,

217159,208965,221256,225353,

{set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[],[]}}},

{dict,7,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[]},

{{[[<<76,234,98,250,210,227,133,72,116,172,

167,237,53,22,86,145>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[],[],[],[],

[[<<64,231,255,89,104,46,213,221,250,124,

155,237,113,220,72,107>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[[<<187,230,149,188,202,242,42,185,165,79,

164,64,142,20,243,220>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[],

[[<<160,131,23,20,173,229,110,121,181,239,

38,170,183,166,128,216>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[],[],

[[<<219,201,73,115,184,111,233,183,117,137,

240,164,237,74,235,24>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}],

[<<55,27,151,60,220,163,149,194,96,156,79,

240,181,46,225,165>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[],[],

[[<<12,164,39,77,197,231,20,230,228,240,

107,103,38,53,217,182>>|

{#Fun<rabbit_variable_queue.1.110539305>,

#Fun<rabbit_variable_queue.11.71636847>}]],

[]}}},

true,16777216,

{dict,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

[[<<12,164,39,77,197,231,20,230,228,240,

107,103,38,53,217,182>>|

{1,

{<<47,251,255,130,60,69,208,98,128,234,0,

66,213,165,140,176>>,

nil,nil}}]],

[]}}}}

** Reason for termination ==

** {{badmatch,{error,enospc}},

[{rabbit_msg_store,internal_sync,1},

{rabbit_msg_store,terminate,2},

{gen_server2,terminate,3},

{proc_lib,wake_up,3}]}

** In 'terminate' callback with reason ==

** {{badmatch,{error,enospc}},

[{rabbit_msg_store,internal_sync,1},

{rabbit_msg_store,handle_info,2},

{gen_server2,handle_msg,2},

{proc_lib,wake_up,3}]}

 

=INFO REPORT==== 20-Mar-2012::13:26:34 ===

stopped TCP Listener on 0.0.0.0:5672

 

=INFO REPORT==== 20-Mar-2012::13:26:34 ===

stopped TCP Listener on [::]:5672

 

 

Best regards,

--Bin Chen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/ed812bb7/attachment.htm>

From rlotun at gmail.com  Wed Mar 28 22:24:53 2012
From: rlotun at gmail.com (Reza Lotun)
Date: Wed, 28 Mar 2012 14:24:53 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
Message-ID: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>

Hi all,

I'm using RMQ 2.8.0 and am trying to create a cluster between two (disk)
nodes rabbit1 and rabbit2.

I'm getting the error "Error: {no_running_cluster_nodes,[rabbit at rabbit1
],[rabbit at rabbit1]}".

I can telnet to rabbit1 5672 from rabbit2 and vice-versa from rabbit2, and
I can do a rabbitmqctl -n rabbit1 status for rabbit2 and vice-versa as well
(so I think the cookie works). The one difference is that both RMQ servers
are running within a chroot env, due to requirements in my deployment
environment.

I've followed all the instructions on the clustering documentations (i.e.
stop_app, reset, cluster, start_app). Any ideas?

Thanks,
Reza

-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:  rlotun at gmail.com
work:   rlotun at twitter.com
@rlotun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/e48c70fe/attachment.htm>

From egermann at limanews.com  Wed Mar 28 23:15:01 2012
From: egermann at limanews.com (Eric Germann)
Date: Wed, 28 Mar 2012 15:15:01 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
Message-ID: <6244CA0E5130B349820CA2E8B24DC26250FA0B8A@VA3DIAXVSC31.RED001.local>

Firewall ip(tables|fw|chains)?

EKG


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Reza Lotun
Sent: Wednesday, March 28, 2012 5:25 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem

Hi all,

I'm using RMQ 2.8.0 and am trying to create a cluster between two (disk) nodes rabbit1 and rabbit2.

I'm getting the error "Error: {no_running_cluster_nodes,[rabbit at rabbit1],[rabbit at rabbit1]}".

I can telnet to rabbit1 5672 from rabbit2 and vice-versa from rabbit2, and I can do a rabbitmqctl -n rabbit1 status for rabbit2 and vice-versa as well (so I think the cookie works). The one difference is that both RMQ servers are running within a chroot env, due to requirements in my deployment environment.

I've followed all the instructions on the clustering documentations (i.e. stop_app, reset, cluster, start_app). Any ideas?

Thanks,
Reza

--
Reza Lotun
mobile: +44 (0)7521 310 763
email:  rlotun at gmail.com<mailto:rlotun at gmail.com>
work:   rlotun at twitter.com<mailto:rlotun at twitter.com>
@rlotun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/d7f5ea7d/attachment.htm>

From santiagomonttco at gmail.com  Thu Mar 29 00:05:51 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Wed, 28 Mar 2012 20:05:51 -0300
Subject: [rabbitmq-discuss] |Spam| PARA EMPRESAS CON DOMICILIO EN PERU
Message-ID: <683f25051bcef4e23d8c1909001517e8@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/c497e804/attachment.htm>

From mpietrek at skytap.com  Thu Mar 29 01:12:03 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 28 Mar 2012 17:12:03 -0700
Subject: [rabbitmq-discuss] Pika channels sensitive to prior operation
	state?
In-Reply-To: <CAAt2poLEY2dVpLX1CgqyT=1qWxVz+x2XRnBdXhhEgUKXVNZrfQ@mail.gmail.com>
References: <CB97A153.3DFD7%mpietrek@skytap.com>
	<CACLE7ix_9u8a5d-m_khLyNYS3-u0jE50Z7tUS4FY1UegmH8Nng@mail.gmail.com>
	<CAAt2poLEY2dVpLX1CgqyT=1qWxVz+x2XRnBdXhhEgUKXVNZrfQ@mail.gmail.com>
Message-ID: <CACLE7iyPP6TsRO8dbFYKyvOSHp_m96e7jEM4EvbL-=eknCoTzQ@mail.gmail.com>

Thanks Alan. After posting this, and doing some additional digging around,
I also uncovered the AMQP spec portion that indicates an AMQPChannelError
can result in a closed channel.

FWIW, I subsequently tried to detect this condition and reestablish the
channel before subsequent uses. However, I ran into problems with Pika
0.9.5, wherein the old channels hung around. Subsequent digging turned up
that there was a bug in Pika 0.9.5 where the correct response isn't set
back to the server in this situation.

Switching to 0.9.6pre, I got further (at least I could close the old
channel without hanging.) However, there was still enough issues that I
backed off to a more brute force solution - If the channel receives an
exception, I simply kill the connection and reestablish a new connection
and channel. Probably not optimal, but it seems more reliable.

Matt


On Wed, Mar 28, 2012 at 11:14 AM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> I can't tell you why its hanging, but in general when a channel throws an
> exception, the channel is closed (its how the AMQP protocol works).  Trying
> to use the channel after a channel exception (or any closed channel) will
> result in connection exception which will shut down the entire connection.
>
> -Alan
>
> On Wed, Mar 28, 2012 at 2:04 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> Following up on this problem, I've narrowed the issue down to a trivial
>> example that hangs:
>>
>> import pika
>> HOSTNAME = "192.168.78.18"  # Plug in your own server name here.
>>
>> if __name__ == '__main__':
>>     connection =
>> pika.BlockingConnection(pika.ConnectionParameters(host=HOSTNAME, port=5672))
>>     channel = connection.channel()
>>
>>     try:
>>         method_frame, _, body = channel.basic_get(queue="NotAValidQueue")
>>     except Exception as e:
>>         print "channel.basic_get threw %s - This is expected" % (e)
>>     else:
>>         print "channel.basic_get unexpectedly did not throw an exception."
>>
>>     print "Before channel.tx_select - Will hang on next line."
>>     channel.tx_select()
>>     print "After channel.tx_select - Unexpectedly got here."
>>
>>     channel.tx_commit()
>>
>>
>>
>> On Tue, Mar 27, 2012 at 4:54 PM, Matt Pietrek <mpietrek at skytap.com>wrote:
>>
>>> I have a Pika 0.9.5. app communicating with a 2.81 rabbitmq-server
>>> instance.
>>>
>>> I'm noticing some odd behavior, and am not sure if it's a problem on my
>>> end, on rabbitmq's end, or in Pika.
>>>
>>> At it's simplest, I'm seeing a call to channel.tx_select() hang.
>>> Breaking in with the debugger, the stack looks like this:
>>>
>>> _handle_read [base_connection.py:151]
>>> process_data_events [blocking_connection.py:94]
>>> send_method [blocking_connection.py:244]
>>> rpc [blocking_connection.py:216]
>>> tx_select [spec.py:2615]
>>>
>>> Stepping for a bit, I see that the code never gets out of the loop in
>>> the send_method() function.
>>>
>>> In ordinary circumstances, my code that calls tx_select() works fine.
>>> However, in the case where it hangs, an immediately prior call to
>>> channel.basic_get() has thrown an exception:
>>>
>>> 'pika.exceptions.AMQPChannelError'>:(404, "NOT_FOUND - no queue 'foobar'
>>> in vhost '/'"
>>>
>>> I'm baffled. Known issue? Something I'm doing wrong?
>>>
>>> Thanks,
>>>
>>> Matt
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/9a899217/attachment.htm>

From mpietrek at skytap.com  Thu Mar 29 01:16:08 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 28 Mar 2012 17:16:08 -0700
Subject: [rabbitmq-discuss] No error reported when
 tx_select/basic_publish/tx_commit is given an undefined queue name?
Message-ID: <CB98F7D8.3E055%mpietrek@skytap.com>

I have a Pika code sequence that looks like this:

                    channel = self._channel
                    channel.tx_select()
                    channel.basic_publish(exchange='',
                        routing_key=queue_name,
                        body=json_string,
                        properties=pika.BasicProperties(delivery_mode=2))
                    channel.tx_commit()

During some robustness testing, I found that if I passed an invalid queue
name to basic_get, I get an AMQPChannelError as expected. However, when
using the above code to write a message to an invalid queue name, no
exception is seen. 

Is this normal or am I missing something? In our scenario, we have to
absolutely, positively know that the message was received by the broker.

Thanks,

Matt




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/a93b3866/attachment.htm>

From denis.melique at morpho.com  Thu Mar 29 08:28:30 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Thu, 29 Mar 2012 09:28:30 +0200
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <4F7334D7.6030709@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
	<4F7334D7.6030709@rabbitmq.com>
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C702@Y000IIIV01.rd1.rf1>

Thank you Simon.

> That seems unlikely. Packet loss should lead to redelivery at the TCP 
> level, which the shovel should be unaware of.

> Messages should only get redelivered if the consumer rejects them or the 
> TCP connection is interrupted completely. Shovel won't reject messages, 
> but maybe the connection is being interrupted and re-established? You 
> should be able to see this in the logs. You would also see a 
> "redelivered" message rate in mgmt.

Where could I get the redelivered messages rate ?
I can't see it in the mngt interface. 
I only have : 
Messages /
	Ready
	Unack
	Total
Messages rate / 
	Incoming
	Deliver / get
	Ack
I also tried with the command : python rabbitmqadmin.py -H <myhost> -f raw_json list queues, and there no redelivered field in the displayed values.



> unacknowledged -> the message has been consumed by the remote end, but 
> not acknowledged.

As the network is cut, the remote end cannot consume messages.
They all stay in the Shovel queue, or somewhere else at the local end. 
Shouldn't they have the Ready Status ?

>
> After 900 seconds presumably the connection is determined to be dead by 
> RabbitMQ and then the messages go back into the queue ("ready").
What do you mean by "go back into the queue" ?
Does-it mean that unacknowledged messages, are no longer in the Shovel Queue ?
Shovel code, reads messages from its queue, and keep them in memory until an ack is received ?
If Yes, what if the broker crashes ? Are we going to lose all unack messages in that case (if we do not use HA queues)?

>
> Then when the network recovers, they are sent again and become 
> "unacknowledged" again, until the acks come in.

Cheers, 
Denis
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From zmstone at gmail.com  Thu Mar 29 09:35:31 2012
From: zmstone at gmail.com (stone)
Date: Thu, 29 Mar 2012 10:35:31 +0200
Subject: [rabbitmq-discuss] how to get higher throughput?
In-Reply-To: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>
References: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>
Message-ID: <CAPNZrFVHDr9+4-rV7WMB2m-B2bhe1e7E4xmdU74H6nQDEGAF0g@mail.gmail.com>

Hi again.

The traffic rate hit almost 9000/s if the "RPC" queue is non-HA.
Could someone explain a little bit why HA impact the throughput that much?

BRs
/stone

On Wed, Mar 28, 2012 at 9:23 PM, stone <zmstone at gmail.com> wrote:

> Hi
>
> I have a use case which is very similar to RPC:
> The clients subscribe to their own queues bound to routing key
> "response.myname",
> and they publish messages with routing key "request.myname", then wait for
> response.
>
> On the other side of the broker, there is this RPC queue, bound to routing
> key "request.#",
> many workers consume from this queue, process the messages then send back
> response.
>
> The request size is around 10K bytes, response is just few bytes, and all
> "RPC"s are synchronized calls.
> i.e. client wait for response before send another request.
>
> After some benchmark tests, we found that the message rate of the RPC
> queue hits around 1400.
> It doesn't help by increasing the number of publishers or consumers, or
> both.
>
> Hope it's enough background info to finally ask my question:
> what could possibly be the bottleneck in my tests, and how to get higher
> throughput ?
>
> -----------------env-------------------
> Rabbit version: 2.7.1
> Memory high watermark: 25G
> CPU (24 processors) model: Intel(R) Xeon(R) CPU X5690  @ 3.47GH
>
> BRs
> /stone
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/e125642a/attachment.htm>

From Robert.Wojcik at jhuapl.edu  Thu Mar 29 00:57:57 2012
From: Robert.Wojcik at jhuapl.edu (Wojcik, Robert C.)
Date: Wed, 28 Mar 2012 19:57:57 -0400
Subject: [rabbitmq-discuss] Generation of AMQP.java failed Error
Message-ID: <AC78983C72177B4D9D1C14F7F4AEBA21431AFAB1A0@aplesstripe.dom1.jhuapl.edu>

Hi all,

Does anybody know what causes the following error when building the client on Windows 7 with python 3.x?

C: \projects\com\rabbitmq\rabbitmq-java-client-2.8.1>ant  dist
Buildfile: C:\ projects\com\rabbitmq\rabbitmq-java-client-2.8.1\build.xml

amqp-generate-check:

amqp-generate:
    [mkdir] Created dir: C:\projects\com\rabbitmq\rabbitmq-java-client-2.8.1\build\gensrc\com\rabbitmq\client
     [exec] Result: 1

BUILD FAILED
C:\projects\com\rabbitmq\rabbitmq-java-client-2.8.1\build.xml:56: Generation of AMQP.java failed with message:
  File "codegen.py", line 148
    """
      ^
SyntaxError: invalid syntax

Total time: 10 seconds

Best Regards,
Robert C. Wojcik, Ph.D.
   Enterprise Knowledge Systems (AOD-QES)

   Johns Hopkins University
   Applied Physics Laboratory
   11100 Johns Hopkins Road
   M/S 24-E229
   Laurel, MD 20723-6099

   NIPRNet Email: robert.wojcik at jhuapl.edu<mailto:Robert.wojcik at jhuapl.edu>
    SIPRNet Email:  wojcirc1 at nova.jhuapl.contractor.navsea.navy.smil.mil
    IC Email:  rcwojci at nsa.ic.gov
   Blackberry: (410) 294-9651
   Phone: (240) 228-9168 / Washington
               (443) 778-9168 / Baltimore
   FAX:    (240) 228-2551 / Washington
               (443) 778-2551 / Baltimore

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/d9589d8a/attachment.htm>

From ka.fukui at ms.scsk.jp  Thu Mar 29 09:36:07 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Thu, 29 Mar 2012 17:36:07 +0900 (JST)
Subject: [rabbitmq-discuss] Mirrored queue failover
Message-ID: <23815485.1333010167174.JavaMail.ka.fukui@ms.scsk.jp>

Hi,

I'm a RabbitMQ newbie and am trying to use mirrored queue in the cluster (3 disc nodes on the 3 servers). I use RabbitMQ 2.8.1, Erlang R15B, CentOS 6.2. I wanted to see the behavior of the failover in the case of any issue, so I tested some scenarios and I have a little confusion with the case below:

a) 3 nodes (rabbit1, rabbit2, rabbit3) are running, and I created que1 on the rabbit1 with an argument "x-ha-policy":"all". So now que1 have a master node "rabbit1 and slave nodes "rabbit2" and "rabbit3", I confirmed it with the command "rabbitctl list_queues name durable pid slave_pids synchronised_slave_pids".

b) I stopped one of the slave node "rabbit2" with "rabbitctl stop". Now que1 has only one slave node "rabbit3". 

c) Next, I started the node "rabbit2" using "rabbit-server -detached" and checked the cluster status with "rabbitctl cluster_status". It seems good 3 nodes has 3 disc nodes and running. But when I checked the queue status, que1 has just one slave "rabbit3". I restarted rabbit2 again, but rabbit2 doesn't become a slave of que1, also I can find a log like this:
=ERROR REPORT==== 29-Mar-2012::15:12:40 ===
Discarding message {'$gen_call',{<0.1876.0>,#Ref<0.0.0.8584>},info} from <0.1876.0> to <0.426.0> in an old incarnation (2) of this node (3)

In my understanding, when a new node is added in the cluster, that node will become a slave of the mirrored queues in that cluster. Is this correct?

Thanks in advance,
Kats


From alexis at rabbitmq.com  Thu Mar 29 09:47:55 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 09:47:55 +0100
Subject: [rabbitmq-discuss] how to get higher throughput?
In-Reply-To: <CAPNZrFVHDr9+4-rV7WMB2m-B2bhe1e7E4xmdU74H6nQDEGAF0g@mail.gmail.com>
References: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>
	<CAPNZrFVHDr9+4-rV7WMB2m-B2bhe1e7E4xmdU74H6nQDEGAF0g@mail.gmail.com>
Message-ID: <CACOPnvfPK4m=wFZF34yAyOgQtSw1iCRmdVB5OWp0JuRn_wm__Q@mail.gmail.com>

HA replicates data to queue mirrors, which increases the amount of
networking and data processing per message.  This can impact
throughput.

You may find you can get higher throughput by using more clients, or a
faster client.

alexis


On Thu, Mar 29, 2012 at 9:35 AM, stone <zmstone at gmail.com> wrote:
> Hi again.
>
> The traffic rate hit almost 9000/s if the "RPC" queue is non-HA.
> Could someone explain a little bit why HA impact the throughput that much?
>
> BRs
> /stone
>
>
> On Wed, Mar 28, 2012 at 9:23 PM, stone <zmstone at gmail.com> wrote:
>>
>> Hi
>>
>> I have a use case which is very similar to RPC:
>> The clients subscribe to their own queues bound to routing key
>> "response.myname",
>> and they publish messages with routing key "request.myname", then wait for
>> response.
>>
>> On the other side of the broker, there is this RPC queue, bound to routing
>> key "request.#",
>> many workers consume from this queue, process the messages then send back
>> response.
>>
>> The request size is around 10K bytes, response is just few bytes, and all
>> "RPC"s are synchronized calls.
>> i.e. client wait for response before send another request.
>>
>> After some benchmark tests, we found that the message rate of the RPC
>> queue hits around 1400.
>> It doesn't help by increasing the number of publishers or consumers, or
>> both.
>>
>> Hope it's enough background info to finally ask my question:
>> what could possibly be the bottleneck in my tests, and how to get higher
>> throughput ?
>>
>> -----------------env-------------------
>> Rabbit version:?2.7.1
>> Memory high watermark: 25G
>> CPU (24 processors) model: Intel(R) Xeon(R) CPU X5690 ?@ 3.47GH
>>
>> BRs
>> /stone
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From zmstone at gmail.com  Thu Mar 29 10:16:47 2012
From: zmstone at gmail.com (stone)
Date: Thu, 29 Mar 2012 11:16:47 +0200
Subject: [rabbitmq-discuss] how to get higher throughput?
In-Reply-To: <CACOPnvfPK4m=wFZF34yAyOgQtSw1iCRmdVB5OWp0JuRn_wm__Q@mail.gmail.com>
References: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>
	<CAPNZrFVHDr9+4-rV7WMB2m-B2bhe1e7E4xmdU74H6nQDEGAF0g@mail.gmail.com>
	<CACOPnvfPK4m=wFZF34yAyOgQtSw1iCRmdVB5OWp0JuRn_wm__Q@mail.gmail.com>
Message-ID: <CAPNZrFUjPBkxqe2f9fxC=sFx0OruxheZh9AyiT0Z2Rik_d8nnQ@mail.gmail.com>

Thanks Alexis!
Just for the record,
I think I've hit the ceiling of the throughput ONE queue can provide,
because there is not difference between 12 and 24 clients in my tests.
Faster clients? not really the issue either, my workers just consume and
reply, do no extra computation.

Anyway, non-HA queue it's almost 5 times faster than HA in my tests.
I wasn't expecting such a significant difference.

BRs
/stone

On Thu, Mar 29, 2012 at 10:47 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> HA replicates data to queue mirrors, which increases the amount of
> networking and data processing per message.  This can impact
> throughput.
>
> You may find you can get higher throughput by using more clients, or a
> faster client.
>
> alexis
>
>
> On Thu, Mar 29, 2012 at 9:35 AM, stone <zmstone at gmail.com> wrote:
> > Hi again.
> >
> > The traffic rate hit almost 9000/s if the "RPC" queue is non-HA.
> > Could someone explain a little bit why HA impact the throughput that
> much?
> >
> > BRs
> > /stone
> >
> >
> > On Wed, Mar 28, 2012 at 9:23 PM, stone <zmstone at gmail.com> wrote:
> >>
> >> Hi
> >>
> >> I have a use case which is very similar to RPC:
> >> The clients subscribe to their own queues bound to routing key
> >> "response.myname",
> >> and they publish messages with routing key "request.myname", then wait
> for
> >> response.
> >>
> >> On the other side of the broker, there is this RPC queue, bound to
> routing
> >> key "request.#",
> >> many workers consume from this queue, process the messages then send
> back
> >> response.
> >>
> >> The request size is around 10K bytes, response is just few bytes, and
> all
> >> "RPC"s are synchronized calls.
> >> i.e. client wait for response before send another request.
> >>
> >> After some benchmark tests, we found that the message rate of the RPC
> >> queue hits around 1400.
> >> It doesn't help by increasing the number of publishers or consumers, or
> >> both.
> >>
> >> Hope it's enough background info to finally ask my question:
> >> what could possibly be the bottleneck in my tests, and how to get higher
> >> throughput ?
> >>
> >> -----------------env-------------------
> >> Rabbit version: 2.7.1
> >> Memory high watermark: 25G
> >> CPU (24 processors) model: Intel(R) Xeon(R) CPU X5690  @ 3.47GH
> >>
> >> BRs
> >> /stone
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/87ea079c/attachment.htm>

From ghepardo_1982 at hotmail.com  Thu Mar 29 09:43:58 2012
From: ghepardo_1982 at hotmail.com (Emanuele G)
Date: Thu, 29 Mar 2012 10:43:58 +0200
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
 randomly throwing exceptions
In-Reply-To: <C9733A8F-F2BF-49BD-AD8A-84F5BF384A9A@rabbitmq.com>
References: <33544834.post@talk.nabble.com> <33544840.post@talk.nabble.com>
	<33544845.post@talk.nabble.com>,
	<C9733A8F-F2BF-49BD-AD8A-84F5BF384A9A@rabbitmq.com>
Message-ID: <DUB106-W341ADB565A484B3381F98C90480@phx.gbl>


Hello Steve,
thanks a lot for answering, I really hope we can solve the issue. First of all let's state that I am using RabbitMQ 2.8.1 (and the 2.8.1 java client)

Now, I tried the AtomicInteger thing because, drilling down into the cause of the exception, I've found this comment in your source code:
Class: com.rabbitmq.client.impl.ChannelManager
Method: releaseChannelNumber(ChannelN channel)
        // Warning, here be dragons. Not great big ones, but little baby ones
        // which will nibble on your toes and occasionally trip you up when
        // you least expect it. (Pixies? HP2)
        // Basically, there's a race that can end us up here. It almost never
        // happens, but it's easier to repair it when it does than prevent it
        // from happening in the first place.
        // If we end up doing a Channel.close in one thread and a Channel.open
        // with the same channel number in another, the two can overlap in such
        // a way as to cause disconnectChannel on the old channel to try to
        // remove the new one. Ideally we would fix this race at the source,
        // but it's much easier to just catch it here.

This is exactly what I believe is happening.

Anyway here are the additional information:
this is the code that uses the channel (called mainChannel)
            mainChannel.addShutdownListener(this);
            mainChannel.basicQos(1);
            mainChannel.queueDeclare(endpoint.getQueueName(), endpoint.isDurable(),
                    !EXCLUSIVE, !AUTO_DELETE, args);

            // Ensure Exchange
            mainChannel.exchangeDeclare(endpoint.getExchangeName(),
                    endpoint.getExchangeTypeName(), endpoint.isDurable(),
                    !EXCLUSIVE, !AUTO_DELETE, args);

            // Bind Queue-Exchange
            mainChannel.queueBind(endpoint.getQueueName(),
                    endpoint.getExchangeName(), endpoint.getRoutingKey());


This is the complete stacktrace:
2012-03-28 15:05:46,057 DEBUG [main] c.b.g.r.u.RabbitLinker [RabbitLinker.java:217] Error while building channel, retrying.
com.rabbitmq.client.ShutdownSignalException : connection error; reason: {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20, method-id=10), null, ""}
       at com.rabbitmq.client.impl.ChannelN.waitForConfirms( ChannelN.java:182)
       at com.rabbitmq.client.impl.ChannelN.waitForConfirms( ChannelN.java:170)
       at myapplication.rabbitmq.util.RabbitLinker.send(RabbitLinker.java:262)
       at myapplication.rabbitmq.producer.AbstractRabbitProducer.send(AbstractRabbitProducer.java:69)
       at myapplication.rabbitmq.producer.AbstractCamelProducer.process(AbstractCamelProducer.java:64)
       at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61)
       at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
       at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:115)
       at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:285)
       at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:110)
       at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
       at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)
       at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
       at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91)
       at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
       at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:322)
       at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:213)
       at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45)
       at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
       at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303)
       at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45)
       at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
       at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150)
       at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117)
       at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
       at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)
       at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
       at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:71)
       at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99)
       at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86)2012-03-28 15:05:46,060 DEBUG [AMQP Connection 127.0.0.1:5672] c.b.g.r.u.RabbitFactory$ConnectionSaver [RabbitFactory.java:119] shutdownComplete:
com.rabbitmq.client.ShutdownSignalException : connection error; reason: {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20, method-id=10), null, ""}
       at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:654) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:610) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:584) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQConnection$1.processAsync(AMQConnection.java:89) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQChannel.handleFrame( AMQChannel.java:91) ~[amqp-client-2.8.1.jar:na]
       at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:509) ~[amqp-client-2.8.1.jar:na]
2012-03-28 15:05:46,061 DEBUG [pool-18-thread-2] c.b.g.r.u.RabbitLinker [RabbitLinker.java:322] Internal RabbitMQ Exception while ACK-ing a message,


I hope you can help me figuring out what is happening.

Thanks


> Subject: Re: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm randomly throwing exceptions
> From: steve at rabbitmq.com
> Date: Wed, 28 Mar 2012 18:17:57 +0100
> CC: rabbitmq-discuss at lists.rabbitmq.com
> To: ghepardo_1982 at hotmail.com
> 
> Emanuele,
> 
> There should be no need to use AtomicInteger to guarantee a new channel
> number; createChannel should guarantee this for you.
> 
> You have shown me the stack trace -- and I can see that your application
> threads are issuing waitForConfirms().
> 
> Can you tell me a little more about how your threads use the Channel?
> I'd like to know the state of the channel the thread is using, at the
> time of the call. What happened on that channel immediately before the
> waitForConfirms() call?
> 
> Perhaps some more snippets of the thread code would be useful, and a
> little more of the stack trace would help.
> 
> Finally, was there anything in the rabbit log around this time?
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 28 Mar 2012, at 17:29, Emanuele Gheradini wrote:
> 
> > 
> > I want also to add that what I understood is:
> > 
> > for some reasons RabbitMQ java client gives the same channel (or channel
> > number) to different threads, then these threads will perform different
> > operations on that channel which will be closed by RabbitMQjavaclient, thus
> > resulting in the crash of the waitForConfirm method, at line 182 (here is
> > the snipped):
> > 
> > 181: if (getCloseReason() != null) {
> > 182:                  throw Utility.fixStackTrace(getCloseReason());
> > 183:               }
> > 
> > 
> > I tried getting channels from rabbit in this way:
> > 
> > AtomicInteger chanNumber = new AtomicInteger(0);
> > 
> > connection.createChannel(chanNumber.getAndIncrement());
> > 
> > to be sure that each thread gets a channel with a different channelNumber,
> > but this does not work either...
> > 
> > 
> > I hope someone can give me a suggestion.
> > 
> > Thanks.
> > -- 
> > View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544845.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/7d713ee6/attachment.htm>

From simon at rabbitmq.com  Thu Mar 29 11:14:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Mar 2012 11:14:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.7.1 Failed and Stopped TCP
	Listener
In-Reply-To: <BCC407A444557E41B0D8B0260D68499204B12FF0@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D68499204B12FF0@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <4F74360E.5080007@rabbitmq.com>

On 28/03/12 20:35, Chen, Bin wrote:
> ** {{badmatch,{error,enospc}},

Sounds like you ran out of disc space. Unfortunately RabbitMQ does not 
handle running out of disc space well.

We intend to have disc space monitoring / alarms in a future version of 
RabbitMQ, but it's not in any released version, so you will have to keep 
an eye on disc space yourself.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Mar 29 11:15:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Mar 2012 11:15:32 +0100
Subject: [rabbitmq-discuss] Generation of AMQP.java failed Error
In-Reply-To: <AC78983C72177B4D9D1C14F7F4AEBA21431AFAB1A0@aplesstripe.dom1.jhuapl.edu>
References: <AC78983C72177B4D9D1C14F7F4AEBA21431AFAB1A0@aplesstripe.dom1.jhuapl.edu>
Message-ID: <4F743644.7000908@rabbitmq.com>

On 29/03/12 00:57, Wojcik, Robert C. wrote:
> Does anybody know what causes the following error when building the
> client on Windows 7 with python 3.x?

In general I'm not sure we support Python 3 as part of the build 
toolchain. Can you try Python 2?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Thu Mar 29 11:21:48 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 11:21:48 +0100
Subject: [rabbitmq-discuss] AS2 usage
In-Reply-To: <CAPpWrV=3=LVcTxxO85jtAx4fYknqHJhMCywJzDbZY4f9Toc5ZQ@mail.gmail.com>
References: <CAPpWrV=3=LVcTxxO85jtAx4fYknqHJhMCywJzDbZY4f9Toc5ZQ@mail.gmail.com>
Message-ID: <CACOPnvcYxd5LPt=V6h4ZxN=drVTnWmhWYy9p7dhioZfW-RFA=Q@mail.gmail.com>

Jack

I'm afraid you are the first person to mention AS2 in relation to
RabbitMQ, at least to my knowledge.  What do you think is the main
obstacle to implementation?

alexis



On Wed, Mar 21, 2012 at 4:05 PM, Jack Palfrey <jack.palf at gmail.com> wrote:
> Hey all,
>
> I've got a legacy project I need to update to modern infrastructure, and one
> of my requirements is to support AS2 projects on the RabbitMQ message
> passing infrastructure. I can't find any living libraries (I kinda doubt
> Rabbit is as old as AS2), but does anyone have experience of connecting to a
> RabbitMQ broker using AS2?
>
> Even anecdotal information would be useful!
>
> Jack
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Thu Mar 29 11:22:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Mar 2012 11:22:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <6244CA0E5130B349820CA2E8B24DC26250FA0B8A@VA3DIAXVSC31.RED001.local>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
	<6244CA0E5130B349820CA2E8B24DC26250FA0B8A@VA3DIAXVSC31.RED001.local>
Message-ID: <4F743801.4050204@rabbitmq.com>

On 28/03/12 23:15, Eric Germann wrote:
> Firewall ip(tables|fw|chains)?

In particular: http://www.rabbitmq.com/clustering.html#firewall

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Thu Mar 29 11:23:33 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 11:23:33 +0100
Subject: [rabbitmq-discuss] |Spam| question about rabbitmq TPS
In-Reply-To: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
Message-ID: <CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>

Hi,

There are lots of possible reasons for this, including that "measuring
anything accurately is hard".

What problem are you trying to solve?

alexis


2012/3/26 ??? <chen-hongqin at 163.com>

> hi,
> can you tell me why TPS is too high at first and sometimes maybe even more
> higher(maybe over 30000/s) when I send messages to rabbitmq cluster
> concurrently? thanks!
>
>
>
> Some infos about this test:
> 1. all the messages are same and each message size is 1kb.
> 2. 300 queues created by multiple Producers at start and messages sent to
> the queues are random
> 3. All messages are persistent and queues are all durable
> 4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the
> same host but different ports
> the host info:
>
> JAVA version****
>
> Java version "1.6.0_12" Java(TM) SE Runtime Environment (build
> 1.6.0_12-b04)****
>
> JAVA VM
>
> Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)****
>
> CPU****
>
> Intel(R) Xeon(R) CPU E5504 @2.00GHz****
>
> number of cores
>
> 8
>
> memory****
>
> 33011192kb****
>
> Erlang VM
>
> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
> [hipe] [kernel-poll:false]****
>
> RabbitMQ version
>
> Release 2.7.1****
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/0a7970c0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/0a7970c0/attachment.png>

From alexis at rabbitmq.com  Thu Mar 29 11:26:43 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 11:26:43 +0100
Subject: [rabbitmq-discuss] A Kotlin-based simple RabbitMQ producer and
	consumer
In-Reply-To: <CABMnSbFD+M9U4W9OAbeFUe80Zwbw=okpcMrwcRSqxxpJnZULfA@mail.gmail.com>
References: <CABMnSbFD+M9U4W9OAbeFUe80Zwbw=okpcMrwcRSqxxpJnZULfA@mail.gmail.com>
Message-ID: <CACOPnvcYAFwViyD8g+Rh6QjaxPc_CTKPaBG2tA8mmRa8Ty_QYg@mail.gmail.com>

Mark

Kotlin looks intriguing... Why are you a fan?  What makes it cool and
simple, vs all the other "JVM and js contenders"?

alexis


On Mon, Mar 26, 2012 at 6:24 PM, Mark Petrovic <mspetrovic at gmail.com> wrote:
> Super simple, but a valid PoC: ?a simple producer and consumer written
> in JetBrains new Kotlin language.
>
> https://github.com/ae6rt/rabbitmq-kotlin
>
> I like Kotlin and how simple it wants to be.
>
>
>
> --
> Mark
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Thu Mar 29 11:32:34 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 11:32:34 +0100
Subject: [rabbitmq-discuss] nagios snmp plugin for v2.8.1
In-Reply-To: <CACz7V9nCq1qM31nqRa0tBGxQ_aWs2hzVxk+m=4+44uQmi88=jg@mail.gmail.com>
References: <CACz7V9nCq1qM31nqRa0tBGxQ_aWs2hzVxk+m=4+44uQmi88=jg@mail.gmail.com>
Message-ID: <CACOPnvcQBOR=cpF-JLxnNpJO1Emm22CSi5n6EgFerUqTd4mUtg@mail.gmail.com>

Henri

What stats do you need?  Are they supplied by the management console and API?

alexis


On Tue, Mar 27, 2012 at 1:36 AM, Henri Pipe <henri.pipe at gmail.com> wrote:
> Hello,
>
> Looking for ideas on how to collect snmp stats for rabbitmq queues.
>
> I am running version 2.8.1 on linux
>
> I looked into Scott Brooks' nagios plugin on github, but that was developed
> for version 1.7.1 and I have had problems with it.
>
> I have installed the nagios plugins developed by James Casey. Thank you
> James.
> https://github.com/jamesc/nagios-plugins-rabbitmq
>
> However, I need more detailed queue stats.
>
> Any suggestions?
>
> Thanks
>
> Henri Pipe
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Thu Mar 29 11:37:18 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 11:37:18 +0100
Subject: [rabbitmq-discuss] Beginner to message and RabbitMQ
In-Reply-To: <13053280.520.1331887569134.JavaMail.geo-discussion-forums@vbut24>
References: <13053280.520.1331887569134.JavaMail.geo-discussion-forums@vbut24>
Message-ID: <CACOPnvcuPca_R8yz1oTEjYtAm7uXPRfx1BUNYn=MvW2ug82-=g@mail.gmail.com>

James

Please could you send emails to rabbitmq-discuss at rabbitmq.com?  The
google group is basically a mirror.

In general, put stuff in a database if you expect it to be read more
than a few times.  If on the other hand, you have data that needs to
be "routed and delivered" between processes, using a messaging system
may help you.  When messages are large, there is no upside to using a
database as well as a messaging system, if all you are doing is
passing data from 1 publisher to N consumers.

To notify a client of failure, you should first define failure.  Is it
a timeout?

alexis





On Fri, Mar 16, 2012 at 8:46 AM, James Spibey <james.spibey at gmail.com> wrote:
> Hi,
>
> I'm trying to determine if RabbitMQ is the right solution for me, and I was
> hoping someone here might be able to help answer a couple of questions?
>
> The app I'm working on is fairly simple, a user creates a listing which they
> can then post to a website, but also post links to twitter and facebook and
> send out a bulk email to a list of subscribers. At the moment this is all
> done?synchronously?when the user saves the listing through a web site, but I
> would like to use a queue to increase the reliability of the solution.
>
> The following is how I think the new solution might work:-
>
> 1) User posts new listing through web app which we commit to database.
> 2) Listing is reformatted for each of Twitter/Facebook/Email and committed
> to the database.
> 2) Listing is added to a message queue.
> 3) Background process(es) read the queue and submit to facebook, twitter and
> email (SMTP).
> 4) User is notified if anything went wrong.
>
> So my questions:-
>
> - If this a good idea or am I thinking of queues in the wrong way?
> - The listing is committed to the database, but at the moment we also
> persist the twitter/facebook/email messages to the database too because they
> are formatted differently. Should we continue to do this or should those
> just be RabbitMQ messages? I don't suppose we really need to be able to see
> those (except for debugging)
> - Should the Message which is sent to the Queue be everything which the
> consumer needs to process the message or is it acceptable to just send a
> primary key and have the consumer (background process) fetch it from the
> database?
> - How do I notify the client of a failure? Ideally I'd like to be able to
> present it back in the web app UI
>
> Sorry for all the questions, I appreciate any help you can give
>
> Regards
>
> James
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From steve at rabbitmq.com  Thu Mar 29 11:47:46 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 29 Mar 2012 11:47:46 +0100
Subject: [rabbitmq-discuss] Generation of AMQP.java failed Error
In-Reply-To: <4F743644.7000908@rabbitmq.com>
References: <AC78983C72177B4D9D1C14F7F4AEBA21431AFAB1A0@aplesstripe.dom1.jhuapl.edu>
	<4F743644.7000908@rabbitmq.com>
Message-ID: <CDE5BF8D-2A99-4CAB-9546-463AEE7ADE75@rabbitmq.com>

We certainly do not support Python 3 for build, and this error message 
is complaining about the print statement (starting on line 130).

The print statement was removed in Python 3 (and replaced by a print function).

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 29 Mar 2012, at 11:15, Simon MacMullen wrote:

> On 29/03/12 00:57, Wojcik, Robert C. wrote:
>> Does anybody know what causes the following error when building the
>> client on Windows 7 with python 3.x?
> 
> In general I'm not sure we support Python 3 as part of the build toolchain. Can you try Python 2?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/36b4d7c4/attachment.htm>

From majek04 at gmail.com  Thu Mar 29 11:52:52 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 29 Mar 2012 11:52:52 +0100
Subject: [rabbitmq-discuss] No error reported when
 tx_select/basic_publish/tx_commit is given an undefined queue name?
In-Reply-To: <CB98F7D8.3E055%mpietrek@skytap.com>
References: <CB98F7D8.3E055%mpietrek@skytap.com>
Message-ID: <CABzX+qy-nK=hcan=e+_vdduDSOnCTiatoO-1W7uvA9Us=WV66Q@mail.gmail.com>

On Thu, Mar 29, 2012 at 01:16, Matt Pietrek <mpietrek at skytap.com> wrote:
> I have a Pika code sequence that looks like this:
>
> ? ? ? ? ? ? ? ? ? ? channel = self._channel
> ? ? ? ? ? ? ? ? ? ? channel.tx_select()
> ? ? ? ? ? ? ? ? ? ? channel.basic_publish(exchange='',
> ? ? ? ? ? ? ? ? ? ? ? ? routing_key=queue_name,
> ? ? ? ? ? ? ? ? ? ? ? ? body=json_string,
> ? ? ? ? ? ? ? ? ? ? ? ? properties=pika.BasicProperties(delivery_mode=2))
> ? ? ? ? ? ? ? ? ? ? channel.tx_commit()
>
> During some robustness testing, I found that if I passed an invalid queue
> name to basic_get, I get an AMQPChannelError as expected. However, when
> using the above code to write a message to an invalid queue name, no
> exception is seen.
>
> Is this normal or am I missing?something? In our scenario, we have to
> absolutely, positively know that the message was received by the broker.

Yes, this is normal.

AMQP does not allow you to send message to a "queue", instead, you
send a message to an exchange with a routing key.

This routing key is a queue name in this case but it can be just anything.

Messages sent with a routing key that is not matched by appropriate
binding will be lost. This is the correct behaviour.

If you need to ensure that message is delivered use 'mandatory' flag
on basic.publish:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

Cheers,
  Marek

From simon at rabbitmq.com  Thu Mar 29 11:54:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 29 Mar 2012 11:54:51 +0100
Subject: [rabbitmq-discuss] how to get higher throughput?
In-Reply-To: <CAPNZrFUjPBkxqe2f9fxC=sFx0OruxheZh9AyiT0Z2Rik_d8nnQ@mail.gmail.com>
References: <CAPNZrFWhR8YcRPiAjHsoPaqmcPvjFcePgidP8uq8MsQUC7dUkw@mail.gmail.com>	<CAPNZrFVHDr9+4-rV7WMB2m-B2bhe1e7E4xmdU74H6nQDEGAF0g@mail.gmail.com>	<CACOPnvfPK4m=wFZF34yAyOgQtSw1iCRmdVB5OWp0JuRn_wm__Q@mail.gmail.com>
	<CAPNZrFUjPBkxqe2f9fxC=sFx0OruxheZh9AyiT0Z2Rik_d8nnQ@mail.gmail.com>
Message-ID: <4F743F7B.8030104@rabbitmq.com>

On 29/03/12 10:16, stone wrote:
> Anyway, non-HA queue it's almost 5 times faster than HA in my tests.
> I wasn't expecting such a significant difference.

That is the case, yes. Non-HA queues do significantly less work. Also 
less work has gone into optimising HA queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From denis.melique at morpho.com  Thu Mar 29 12:50:14 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Thu, 29 Mar 2012 13:50:14 +0200
Subject: [rabbitmq-discuss] How to configure Shovel with HA queue
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1CA4F@Y000IIIV01.rd1.rf1>

Hi,

Is it possible to set Shovel configuration to consume from a HA Queue ?
I did not find documentation about it on Rabbit MQ site, and I'am wondering if it's possible.
If Yes what is the correct syntax of the queue.declare in shovel declaration ?

I already have tried :
...
{'queue.declare',
                               [{queue, <<"shovel.forward.insertions">>},
                                {x-ha-policy,<<"all">>},
                                durable ]},
...
Which seems to be incorrect :)

Thank you.

Denis
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/62710441/attachment.htm>

From mikeb at rabbitmq.com  Thu Mar 29 13:13:33 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 29 Mar 2012 13:13:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
Message-ID: <4F7451ED.7060702@rabbitmq.com>

Hi Reza,

> I'm using RMQ 2.8.0 and am trying to create a cluster between two (disk)
> nodes rabbit1 and rabbit2.
>
> I'm getting the error "Error:
> {no_running_cluster_nodes,[rabbit at rabbit1],[rabbit at rabbit1]}".
>
> I can telnet to rabbit1 5672 from rabbit2 and vice-versa from rabbit2,
> and I can do a rabbitmqctl -n rabbit1 status for rabbit2 and vice-versa
> as well (so I think the cookie works). The one difference is that both
> RMQ servers are running within a chroot env, due to requirements in my
> deployment environment.

You can test the connectivity definitively by getting a shell into each 
Erlang node and pinging the other. You need to do this while rabbit is 
stopped.

E.g., on host rabbit1:

     $ rabbitmqctl stop_app

and on host rabbit2:

     $ rabbitmqctl stop_app

then on rabbit1 again:

     $ erl -remsh rabbit at rabbit1 -sname r1
     > net_adm:ping(rabbit at rabbit2).

which should give you the result 'pong';
then, on rabbit2

     $ erl -remsh rabbit at rabbit2 -sname r2
     > net_adm:ping(rabbit at rabbit1).

(and again expect 'pong').


-Michael

From mikeb at rabbitmq.com  Thu Mar 29 13:31:38 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 29 Mar 2012 13:31:38 +0100
Subject: [rabbitmq-discuss] .Net Client: Why is a channel called a model?
In-Reply-To: <10570039.324.1330799324115.JavaMail.geo-discussion-forums@vbne13>
References: <10570039.324.1330799324115.JavaMail.geo-discussion-forums@vbne13>
Message-ID: <4F74562A.3040809@rabbitmq.com>

Hi Marc,

> I'm new to RabbitMQ and have been using the .Net client. In the
> tutorials, AMQP documentation and the Java examples all refer to
> channels, is there a reason why channels appear to be called models in
> the .Net driver?
>
> Is there some history or context I'm missing?

The .NET client was developed after the Java client, and I think around 
the time AMQP 0-10 (which is quite different to 0-8 and 0-9-1) was being 
discussed. In these circumstances it received a more generic treatment 
than its Java predecessor. There's no hidden meaning to it.

-Michael

From alexis at rabbitmq.com  Thu Mar 29 14:17:04 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 14:17:04 +0100
Subject: [rabbitmq-discuss] |Spam| question about rabbitmq TPS
In-Reply-To: <748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
Message-ID: <CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>

are you using persistent messages?


2012/3/29 ??? <chen-hongqin at 163.com>

> This is about my master paper which is related with availability, and I
> use rabbitmq as the middle-ware component. So I am trying to find how can
> cause this problem. And my current answer I guess is that it is caused by
> the OS cache. Cache hit ratio is high at the very start and becomes lower
> because of the page replacement after more and more requests come. And the
> other reason maybe is messages are orderly sufficiently for the disk to
> write at start. But i am not sure if the rabbitmq has do some optimals for
> that?
> At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
>
> Hi,
>
> There are lots of possible reasons for this, including that "measuring
> anything accurately is hard".
>
> What problem are you trying to solve?
>
> alexis
>
>
> 2012/3/26 ??? <chen-hongqin at 163.com>
>
>>   hi,
>> can you tell me why TPS is too high at first and sometimes maybe even
>> more higher(maybe over 30000/s) when I send messages to rabbitmq cluster
>> concurrently? thanks!
>>
>>
>>
>> Some infos about this test:
>> 1. all the messages are same and each message size is 1kb.
>>  2. 300 queues created by multiple Producers at start and messages sent
>> to the queues are random
>> 3. All messages are persistent and queues are all durable
>> 4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the
>> same host but different ports
>> the host info:
>>
>> JAVA version****
>>
>> Java version "1.6.0_12" Java(TM) SE Runtime Environment (build
>> 1.6.0_12-b04)****
>>
>> JAVA VM
>>
>> Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)****
>>
>> CPU****
>>
>> Intel(R) Xeon(R) CPU E5504 @2.00GHz****
>>
>> number of cores
>>
>> 8
>>
>> memory****
>>
>> 33011192kb****
>>
>> Erlang VM
>>
>> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
>> [hipe] [kernel-poll:false]****
>>
>> RabbitMQ version
>>
>> Release 2.7.1****
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/bd43ab9d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/bd43ab9d/attachment.png>

From chen-hongqin at 163.com  Thu Mar 29 14:09:14 2012
From: chen-hongqin at 163.com (=?GBK?B?s8K66MfV?=)
Date: Thu, 29 Mar 2012 21:09:14 +0800 (CST)
Subject: [rabbitmq-discuss] |Spam| Re:Re: |Spam| question about rabbitmq TPS
In-Reply-To: <CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
Message-ID: <748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>

This is about my master paper which is related with availability, and I use rabbitmq as the middle-ware component. So I am trying to find how can cause this problem. And my current answer I guess is that it is caused by the OS cache. Cache hit ratio is high at the very start and becomes lower because of the page replacement after more and more requests come. And the other reason maybe is messages are orderly sufficiently for the disk to write at start. But i am not sure if the rabbitmq has do some optimals for that?

At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
Hi,


There are lots of possible reasons for this, including that "measuring anything accurately is hard".  


What problem are you trying to solve?


alexis



2012/3/26 ??? <chen-hongqin at 163.com>

hi, 
can you tell me why TPS is too high at first and sometimes maybe even more higher(maybe over 30000/s) when I send messages to rabbitmq cluster concurrently? thanks!
 
 
 
Some infos about this test:
1. all the messages are same and each message size is 1kb.
2. 300 queues created by multiple Producers at start and messages sent to the queues are random 
3. All messages are persistent and queues are all durable
4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the same host but different ports
the host info:
|

JAVA version

|

Java version "1.6.0_12" Java(TM) SE Runtime Environment (build 1.6.0_12-b04)

|
|

JAVA VM

|

Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)

|
|

CPU

|

Intel(R) Xeon(R) CPU E5504 @2.00GHz

|
|

number of cores

|

8

|
|

memory

|

33011192kb

|
|

Erlang VM

|

Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false]

|
|

RabbitMQ version

|

Release 2.7.1

|


 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/a3192444/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2012-03-26_00-02-28.png
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/a3192444/attachment.png>

From alexis at rabbitmq.com  Thu Mar 29 15:53:39 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Mar 2012 15:53:39 +0100
Subject: [rabbitmq-discuss] |Spam| question about rabbitmq TPS
In-Reply-To: <24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
	<CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>
	<24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>
Message-ID: <CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>

try it without persistence and see what graphs you get..?


2012/3/29 ??? <chen-hongqin at 163.com>

> yes, all the messages are persistent
>
>
> ? 2012-03-29 21:17:04?"Alexis Richardson" <alexis at rabbitmq.com> ???
>
> are you using persistent messages?
>
>
> 2012/3/29 ??? <chen-hongqin at 163.com>
>
>> This is about my master paper which is related with availability, and I
>> use rabbitmq as the middle-ware component. So I am trying to find how can
>> cause this problem. And my current answer I guess is that it is caused by
>> the OS cache. Cache hit ratio is high at the very start and becomes lower
>> because of the page replacement after more and more requests come. And the
>> other reason maybe is messages are orderly sufficiently for the disk to
>> write at start. But i am not sure if the rabbitmq has do some optimals for
>> that?
>> At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
>>
>> Hi,
>>
>> There are lots of possible reasons for this, including that "measuring
>> anything accurately is hard".
>>
>> What problem are you trying to solve?
>>
>> alexis
>>
>>
>> 2012/3/26 ??? <chen-hongqin at 163.com>
>>
>>>   hi,
>>> can you tell me why TPS is too high at first and sometimes maybe even
>>> more higher(maybe over 30000/s) when I send messages to rabbitmq cluster
>>> concurrently? thanks!
>>>
>>>
>>>
>>> Some infos about this test:
>>> 1. all the messages are same and each message size is 1kb.
>>>  2. 300 queues created by multiple Producers at start and messages sent
>>> to the queues are random
>>> 3. All messages are persistent and queues are all durable
>>> 4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the
>>> same host but different ports
>>> the host info:
>>>
>>> JAVA version****
>>>
>>> Java version "1.6.0_12" Java(TM) SE Runtime Environment (build
>>> 1.6.0_12-b04)****
>>>
>>> JAVA VM
>>>
>>> Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)****
>>>
>>> CPU****
>>>
>>> Intel(R) Xeon(R) CPU E5504 @2.00GHz****
>>>
>>> number of cores
>>>
>>> 8
>>>
>>> memory****
>>>
>>> 33011192kb****
>>>
>>> Erlang VM
>>>
>>> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
>>> [hipe] [kernel-poll:false]****
>>>
>>> RabbitMQ version
>>>
>>> Release 2.7.1****
>>>
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/dd516826/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/dd516826/attachment.png>

From rlotun at gmail.com  Thu Mar 29 16:30:39 2012
From: rlotun at gmail.com (Reza Lotun)
Date: Thu, 29 Mar 2012 08:30:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <4F7451ED.7060702@rabbitmq.com>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>
	<4F7451ED.7060702@rabbitmq.com>
Message-ID: <9549837.81.1333035040000.JavaMail.geo-discussion-forums@pblw1>

Hi all,

Thanks for al your replies.

On Thursday, March 29, 2012 5:13:33 AM UTC-7, Michael Bridgen wrote:
>
> You can test the connectivity definitively by getting a shell into each 
> Erlang node and pinging the other. You need to do this while rabbit is 
> stopped.
>
> E.g., on host rabbit1:
>
>      $ rabbitmqctl stop_app
>
> and on host rabbit2:
>
>      $ rabbitmqctl stop_app
>
> then on rabbit1 again:
>
>      $ erl -remsh rabbit at rabbit1 -sname r1
>      > net_adm:ping(rabbit at rabbit2).
>
> which should give you the result 'pong';
> then, on rabbit2
>
>      $ erl -remsh rabbit at rabbit2 -sname r2
>      > net_adm:ping(rabbit at rabbit1).
>
> (and again expect 'pong').
>

I've performed the above steps and have gotten the expected 'pong'. So, all 
tests (the above and connecting via 'rabbitmqctl -n rabbit at rabbit1 status' 
from rabbit2, etc) work, but clustering always gives me an error message.

I don't think it's a firewall issue if the above test worked, right?

Thanks,
Reza

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/c4c98a7b/attachment.htm>

From steve at rabbitmq.com  Thu Mar 29 16:30:37 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 29 Mar 2012 16:30:37 +0100
Subject: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm
	randomly throwing exceptions
In-Reply-To: <DUB106-W341ADB565A484B3381F98C90480@phx.gbl>
References: <33544834.post@talk.nabble.com> <33544840.post@talk.nabble.com>
	<33544845.post@talk.nabble.com>,
	<C9733A8F-F2BF-49BD-AD8A-84F5BF384A9A@rabbitmq.com>
	<DUB106-W341ADB565A484B3381F98C90480@phx.gbl>
Message-ID: <011E99D4-2DD3-496B-A9AE-8A55D81E39D8@rabbitmq.com>

Emanuele,

Bravo for trying AtomicInteger; however the comment you found is an old
one, and probably (I say probably) does not apply anymore. It is
extremely unlikely that a recently used channel number is reallocated
(unless you explicitly request one) and even in that case I think we
have the locking correct now so that this race cannot happen. In any
event, using AtomicInteger will only make things worse.

Incidentally, the code following the comment should detect and fix the
clash, so you shouldn't see it anyhow. (Famous last words.) Of course,
like all naive concurrent code, it does rather assume there are only
ever two threads involved, so could have a very rare bug -- but I doubt
it.

I'm grateful for the extra information; however, it doesn't appear to be
enough to follow what's happening.

It looks as though your application
myapplication.rabbitmq.util.RabbitLinker.send(RabbitLinker.java:262) is
calling waitForConfirms() on the channel. I don't see this in the code
outline you sent. Can you validate that confirmSelect is called on the
channel; that the correct channel is being used top issue
waitForConfirms() and that you issue this call before closing the
channel.

What do you do in the shutdownListener you register, for example?

If it is possible, a look at your application code would be helpful.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 29 Mar 2012, at 09:43, Emanuele G wrote:

> Hello Steve,
> thanks a lot for answering, I really hope we can solve the issue. First of all let's state that I am using RabbitMQ 2.8.1 (and the 2.8.1 java client)
> 
> Now, I tried the AtomicInteger thing because, drilling down into the cause of the exception, I've found this comment in your source code:
> Class: com.rabbitmq.client.impl.ChannelManager
> Method: releaseChannelNumber(ChannelN channel)
>         // Warning, here be dragons. Not great big ones, but little baby ones
>         // which will nibble on your toes and occasionally trip you up when
>         // you least expect it. (Pixies? HP2)
>         // Basically, there's a race that can end us up here. It almost never
>         // happens, but it's easier to repair it when it does than prevent it
>         // from happening in the first place.
>         // If we end up doing a Channel.close in one thread and a Channel.open
>         // with the same channel number in another, the two can overlap in such
>         // a way as to cause disconnectChannel on the old channel to try to
>         // remove the new one. Ideally we would fix this race at the source,
>         // but it's much easier to just catch it here.
> 
> This is exactly what I believe is happening.
> 
> Anyway here are the additional information:
> this is the code that uses the channel (called mainChannel)
>             mainChannel.addShutdownListener(this);
>             mainChannel.basicQos(1);
>             mainChannel.queueDeclare(endpoint.getQueueName(), endpoint.isDurable(),
>                     !EXCLUSIVE, !AUTO_DELETE, args);
> 
>             // Ensure Exchange
>             mainChannel.exchangeDeclare(endpoint.getExchangeName(),
>                     endpoint.getExchangeTypeName(), endpoint.isDurable(),
>                     !EXCLUSIVE, !AUTO_DELETE, args);
> 
>             // Bind Queue-Exchange
>             mainChannel.queueBind(endpoint.getQueueName(),
>                     endpoint.getExchangeName(), endpoint.getRoutingKey());
> 
> 
> This is the complete stacktrace:
> 2012-03-28 15:05:46,057 DEBUG [main] c.b.g.r.u.RabbitLinker [RabbitLinker.java:217] Error while building channel, retrying.
> com.rabbitmq.client.ShutdownSignalException : connection error; reason: {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20, method-id=10), null, ""}
>        at com.rabbitmq.client.impl.ChannelN.waitForConfirms( ChannelN.java:182)
>        at com.rabbitmq.client.impl.ChannelN.waitForConfirms( ChannelN.java:170)
>        at myapplication.rabbitmq.util.RabbitLinker.send(RabbitLinker.java:262)
>        at myapplication.rabbitmq.producer.AbstractRabbitProducer.send(AbstractRabbitProducer.java:69)
>        at myapplication.rabbitmq.producer.AbstractCamelProducer.process(AbstractCamelProducer.java:64)
>        at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61)
>        at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
>        at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:115)
>        at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:285)
>        at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:110)
>        at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
>        at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)
>        at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
>        at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91)
>        at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
>        at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:322)
>        at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:213)
>        at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45)
>        at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
>        at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303)
>        at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45)
>        at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
>        at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150)
>        at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117)
>        at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)
>        at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)
>        at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)
>        at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:71)
>        at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99)
>        at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86)2012-03-28 15:05:46,060 DEBUG [AMQP Connection 127.0.0.1:5672] c.b.g.r.u.RabbitFactory$ConnectionSaver [RabbitFactory.java:119] shutdownComplete:
> com.rabbitmq.client.ShutdownSignalException : connection error; reason: {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID - second 'channel.open' seen, class-id=20, method-id=10), null, ""}
>        at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:654) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:610) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:584) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQConnection$1.processAsync(AMQConnection.java:89) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQChannel.handleFrame( AMQChannel.java:91) ~[amqp-client-2.8.1.jar:na]
>        at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:509) ~[amqp-client-2.8.1.jar:na]
> 2012-03-28 15:05:46,061 DEBUG [pool-18-thread-2] c.b.g.r.u.RabbitLinker [RabbitLinker.java:322] Internal RabbitMQ Exception while ACK-ing a message,
> 
> 
> I hope you can help me figuring out what is happening.
> 
> Thanks
> 
> 
> > Subject: Re: [rabbitmq-discuss] RMQ Java Client - ChannelN.waitForConfirm randomly throwing exceptions
> > From: steve at rabbitmq.com
> > Date: Wed, 28 Mar 2012 18:17:57 +0100
> > CC: rabbitmq-discuss at lists.rabbitmq.com
> > To: ghepardo_1982 at hotmail.com
> > 
> > Emanuele,
> > 
> > There should be no need to use AtomicInteger to guarantee a new channel
> > number; createChannel should guarantee this for you.
> > 
> > You have shown me the stack trace -- and I can see that your application
> > threads are issuing waitForConfirms().
> > 
> > Can you tell me a little more about how your threads use the Channel?
> > I'd like to know the state of the channel the thread is using, at the
> > time of the call. What happened on that channel immediately before the
> > waitForConfirms() call?
> > 
> > Perhaps some more snippets of the thread code would be useful, and a
> > little more of the stack trace would help.
> > 
> > Finally, was there anything in the rabbit log around this time?
> > 
> > Steve Powell (a happy bunny)
> > ----------some more definitions from the SPD----------
> > chinchilla (n.) Cooling device for the lower jaw.
> > socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> > literacy (n.) A textually transmitted disease usually contracted in childhood.
> > 
> > On 28 Mar 2012, at 17:29, Emanuele Gheradini wrote:
> > 
> > > 
> > > I want also to add that what I understood is:
> > > 
> > > for some reasons RabbitMQ java client gives the same channel (or channel
> > > number) to different threads, then these threads will perform different
> > > operations on that channel which will be closed by RabbitMQjavaclient, thus
> > > resulting in the crash of the waitForConfirm method, at line 182 (here is
> > > the snipped):
> > > 
> > > 181: if (getCloseReason() != null) {
> > > 182: throw Utility.fixStackTrace(getCloseReason());
> > > 183: }
> > > 
> > > 
> > > I tried getting channels from rabbit in this way:
> > > 
> > > AtomicInteger chanNumber = new AtomicInteger(0);
> > > 
> > > connection.createChannel(chanNumber.getAndIncrement());
> > > 
> > > to be sure that each thread gets a channel with a different channelNumber,
> > > but this does not work either...
> > > 
> > > 
> > > I hope someone can give me a suggestion.
> > > 
> > > Thanks.
> > > -- 
> > > View this message in context: http://old.nabble.com/RMQ-Java-Client---ChannelN.waitForConfirm-randomly-throwing-exceptions-tp33544834p33544845.html
> > > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > > 
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/b3b24d2f/attachment.htm>

From mikeb at rabbitmq.com  Thu Mar 29 17:25:59 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 29 Mar 2012 17:25:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <9549837.81.1333035040000.JavaMail.geo-discussion-forums@pblw1>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>	<4F7451ED.7060702@rabbitmq.com>
	<9549837.81.1333035040000.JavaMail.geo-discussion-forums@pblw1>
Message-ID: <4F748D17.50408@rabbitmq.com>

Hi Reza,

> I've performed the above steps and have gotten the expected 'pong'. So,
> all tests (the above and connecting via 'rabbitmqctl -n rabbit at rabbit1
> status' from rabbit2, etc) work, but clustering always gives me an error
> message.
>
> I don't think it's a firewall issue if the above test worked, right?

Right, yep, Erlang distribution is working fine by the look of it.

Back to this:

 > I'm getting the error "Error:
 > {no_running_cluster_nodes,[rabbit at rabbit1],[rabbit at rabbit1]}".

Can you reliably reproduce it?

-Michael

From rui.favas at barclays.com  Thu Mar 29 17:22:37 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Thu, 29 Mar 2012 17:22:37 +0100
Subject: [rabbitmq-discuss] Dead Letter Exchanges
Message-ID: <1308E5CFD51CA14DA7B024A689B8B168024F536689@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

Hi,

Can?t get the Dead Letter Exchanges to work with ?x-message-ttl?. Please see details below:-

I can publish messages to the ?testqueue? queue and the messages get removed after the ?x-message-ttl? timeout but don?t get routed to the ?errorqueue? via the ?error_exc? exchange. Can you help??


I have two exchanges:

Exchange: error_exc
Type

direct

Parameters

durable:

true


Virtual host

/test


Exchange: test_exc
Type

direct

Parameters

durable:

true


Virtual host

/test



I have two queues:

Queue: testqueue
Parameters

arguments:

x-dead-letter-exchange:

error_exc


x-message-ttl:

5000

durable:

true


Exclusive owner

None

Status

Idle since
2012-3-29 16:52:55


Bindings:

From

Routing key

Arguments

test_exc<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/test_exc> Exchange



Top of Form
Bottom of Form

(AMQP default)<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/amq.default> Exchange

testqueue




? testqueue




Queue: errorqueue
Parameters

durable:

true


Exclusive owner

None

Status

Idle since
2012-3-29 16:49:46


Consumers

0

Memory

4.1kB


Virtual host

/test


Bindings:
From

Routing key

Arguments

error_exc<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/error_exc> Exchange

#



Top of Form
Bottom of Form

(AMQP default)<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/amq.default> Exchange

errorqueue




? errorqueue





_______________________________________________
Barclays is one of the world's leading banks, and we believe that by continuing to integrate the organisation we can better deliver the full power of Barclays to customers, clients and the communities in which we work. 
As a visible sign of that integration we are moving to a single Barclays brand for the majority of our divisions, including those formerly known as Barclays Capital, Barclays Wealth and Barclays Corporate.

_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/98bf0791/attachment.htm>

From steve at rabbitmq.com  Thu Mar 29 17:37:02 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 29 Mar 2012 17:37:02 +0100
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
In-Reply-To: <60407ca0-7e3c-4d9a-a24f-3c278583b73a@i10g2000pbl.googlegroups.com>
References: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
	<32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>
	<137381af-f9d8-4871-90d3-d60f478aa39b@x6g2000pbk.googlegroups.com>
	<A00A77EA-EB93-45F3-9148-BCDA8C5F3C06@rabbitmq.com>
	<60407ca0-7e3c-4d9a-a24f-3c278583b73a@i10g2000pbl.googlegroups.com>
Message-ID: <88026DC6-F609-49DF-A1E8-991E29574F23@rabbitmq.com>

Yogesh,

Apologies for not getting back to you sooner about this.

You appear to be 'polling' the App1_Return queue; taking things off and
requeueing them. I presume it is not possible for two different tasks to
interfere? While you are 'polling' the queue (and will requeue the
message) might another task look and see the _Return queue is empty?
Surely not.

Using a rabbitmq queue for storing one 'event' message like this is:

a) inherently buggy (races and stale data are two bad things that can
   happen)
b) slow (polling rabbitmq queues is network inefficient).

If all you want is that the process posts a message (reply) when it
finishes, this sounds like a perfect RPC application. If the process can
guarantee to respond somehow in all cases; then there is no need to poll
on the Return queue, just have a Consumer listen to it.

You might want to look at the RpcClient/Server classes in the
com.rabbitmq.client package.

One reason to introduce an external db is that rabbitmq queues aren't
databases. However, a much lighter-weight Java solution ought to be
possible if the external system is controlled synchronously by a Java
monitor thread, or else use the return queue like a reply-to queue and
monitor it with a Consumer as I suggest above.

> Can you give me an elegant pattern for
> - Process message from Main Queue
Yes -- use a DefaultConsumer (not the QueueingConsumer) overriding
handleDelivery() to process messages received, and handleShutdown() if
you want to avoid the shutdownListener() as well.

> - Declare/Redeclare appropriate Queue
declare

> - Attach a consume on this queue doing ch.basicConsume(...) only
>  if there are no consumers already on this queueUse the exclusive flag on the:
> 
> public String basicConsume( String queue
>                           , boolean autoAck
>                           , String consumerTag
>                           , boolean noLocal
>                           , boolean exclusive
>                           , Map<String, Object> arguments
>                           , Consumer callback )
> 
> call to have the consume fail if there is already a Consumer on that
> Queue. The parameter arguments can be null; noLocal is not supported (so
> set it to false); and set consumerTag to "" if you don't want to set
> your own tag.
> 


> - When cleaning method kicks in
>  - do ch.basicCancel on all queues, wait till you get
>    handleCancelOk on all consumers
basicCancel is an operation on the Consumer (and needs a tag), not on the queue.

>  - check message count of all queues
>  - delete all queues which are empty and have 0 consumers
>    btw, I use http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
>    to get queues, consumers and messages and then fire
>    foreach(queue)
>    if(messages == 0 && consumers == 0)
>        ch.queueDelete(queue, true, true)
>    Is this call http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
>    reliable?
It is inherently unreliable to delete in this manner, because this is an
asynchronous system. Asking first and then doing always opens a window
during which the resource you queried changes. The information you get
back from an external management call is bound to be out-of-date as soon
as you get it. Better to either:

set the queue to be auto-delete (this will go when all the Consumers are
cancelled), or use

 public Queue.DeleteOk queueDelete( String queue
                                  , boolean ifUnused
                                  , boolean ifEmpty )

which allows you to only delete the queue if it is empty and/or unused.

I hope this gives you some ideas. It is hard to be more precise without
getting down to your application details.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 3 Feb 2012, at 03:45, Yogesh Ketkar wrote:

> Hi Steve,
> 
> Couple of things
> 
> 1. Purpose of _Return queues
>   Say App1 Queues has 10 messages and first one is processed by
> calling an external system. This system
>   operates in asynchronous manner and just returns task-id. I put it
> on App1_Return queue and keep on
>   polling this queue, get task-id and query external system for
> status. If task is still going on, I
>   re-queue the message to App1_Return queue.
>   To process any message on App1 queue, I check if there is any
> message on App1_Return queue. If there
>   is none, only then can I process message from App1 queue as
> otherwise, it indicates that previous
>   operation is on App1 is still not complete.
>   App1_Return queue at any point of time will only have at most one
> message.
>   This probably can be done using an external db, but why introduce
> another system.
> 
> 2.
>> Just because you have thousands of queues doesn't mean you need to have
>> thousands of Consumer instances -- it is quite ok to use the same Consumer on
>> several basicConsume calls. The consumerTag is passed to every Consumer callback
>> so the Consumer code can distinguish for which basicConsume it is called.
> Can you give me an elegant pattern for
> - Process message from Main Queue
> - Declare/Redeclare appropriate Queue
> - Attach a consume on this queue doing ch.basicConsume(...) only
>  if there are no consumers already on this queue
> - When cleaning method kicks in
>  - do ch.basicCancel on all queues, wait till you get
>    handleCancelOk on all consumers
>  - check message count of all queues
>  - delete all queues which are empty and have 0 consumers
>    btw, I use http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
>    to get queues, consumers and messages and then fire
>    foreach(queue)
>    if(messages == 0 && consumers == 0)
>        ch.queueDelete(queue, true, true)
>    Is this call http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
>    reliable?
> 
> regards, Yogesh
> 
> On Feb 1, 3:35 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Yogesh,
>> 
>> Thanks for your explanation of your application structure, and the version you
>> are running.
>> 
>> I do not know how the second channel.open AMQP command (for the same channel)
>> was sent to the broker; can you send some more diagnostics of this failure (log,
>> full stack trace) so I can raise a bug. If possible, a demonstrating small
>> program. Thanks.
>> 
>> I see your difficulty. I would hope that creating 20000 queues (which are empty
>> almost all of the time) would not take up too much room, so I think you should
>> consider not deleting them at all. This would solve most of your problem.
>> 
>> The x-expires attribute for queues, really ought to have a 'only-if-empty'
>> option. I'll raise a bug (24722) for this, and see how difficult it would be.
>> 
>> I do not understand what the _Return queues are for. They look as though you are
>> using them as a private persistent store for each App. It would be better if you
>> put this information somewhere else, but heigh-ho -- you can safely delete these
>> queues since this app is in complete control of them, and the events are
>> processed serially.
>> 
>> One of the reasons, I don't do basicConsume on queues is, I am going to have
>> thousands of queues. I rather thought it would be easier to have a thread pool,
>> each consuming just one message from a queue in round-robin fashion.
>> 
>> Just because you have thousands of queues doesn't mean you need to have
>> thousands of Consumer instances -- it is quite ok to use the same Consumer on
>> several basicConsume calls. The consumerTag is passed to every Consumer callback
>> so the Consumer code can distinguish for which basicConsume it is called.
>> 
>> By default, the Java client will allocate a pool of 5 threads for each
>> connection, and dispatch Consumer callbacks onto one of those threads for you.
>> So your thread pool might be unnecessary if you used basicConsume(). I'd
>> consider doing that since basicGet() can be slow, and you'd have to get from
>> each potential queue just to tell if there is a message for it!
>> 
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 31 Jan 2012, at 13:56, Yogesh Ketkar wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> I am using RabbitMQ server version 2.7.1.
>>> Java Client Jar used is
>>> rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar
>> 
>>>> The Shutdown seems to be being called because the channel is being opened twice.
>>>> The broker complains about this and closes the connection. Are you creating
>>>> channels on different threads simultaneously?
>>> Yes indeed, I am creating channels on different threads.
>> 
>>>> I don't think the basicPublish will fail if the queue doesn't exist. Why would
>>>> you create a new channel in this case?
>>> Yes, you are right. I will basically lose the message in this case.
>> 
>>> Now about overall problem statement.
>>> My application has a main queue which looks like
>>> MainQueue
>>>  - App1-Event1
>>>  - App2-Event1
>>>  - App1-Event2
>>>  - App1-Event3
>>>  - App3-Event1
>>>  - App3-Event2
>>>  - App2-Event2
>> 
>>> Basically there are going to be events from different Apps (there can
>>> be thousands of apps) and events belonging to an App must
>>> be processed sequentially. Events across different apps can and should
>>> be be processed in parallel.
>>> So I have only one consumer on MainQueue (using basicConsume) which
>>> reads events from MainQueue and just moves it to appropriate declared/
>>> redeclared queue.
>>> So this is how new queue structure would look like.
>> 
>>> App1
>>>  - App1-Event1
>>>  - App1-Event2
>>>  - App1-Event3
>> 
>>> App2
>>>  - App2-Event1
>>>  - App2-Event2
>> 
>>> App3
>>>  - App3-Event1
>>>  - App3-Event2
>> 
>>> Now again when Event1 is processed from Queue App1, Event2 of App1
>>> can't be processed unless processing of Event1 is complete.
>>> Processing of event involves asynchronous communication with external
>>> systems, so once Event1 is fetched (and acknowledged) from queue
>>> App1,
>>> I create another queue like
>>> App1_Return
>>>  - App1-Event1-TaskId
>> 
>>> I need to query external system using TaskId after certain time
>>> interval, to check status of event processing of Event1. Once I get
>>> the status (either sucess or failure)
>>> I discard App1-Event1-TaskId and ready to process App1-Event2. So all
>>> _Return queues will only have one event at any point of time.
>> 
>>> An event on an app might even occur once a day. So I don't want to
>>> keep so many queues (potentially 20000 if there are 10000 apps)
>>> hanging around.
>>> Both auto_delete and x-expires are not very useful as in both the
>>> schemes, queues get deleted even when they have messages.
>>> Ideally whenever last message from any Queue (except MainQueue) is
>>> consumed, I want to delete that queue. Of course, one has to make sure
>>> while a queue is getting deleted, there might be an event destined for
>>> that. So if one guy is doing
>>> queueDelete('somequeue', true, true) and other guy is doing
>>> queueDeclare, queueBind, basicPublish. If queueDelete gets executed
>>> after
>>> queueBind, message will be lost.
>> 
>>> One of the reasons, I don't do basicConsume on queues is, I am going
>>> to have thousands of queues. I rather thought it would be easier to
>>> have a thread pool, each consuming just one message from a queue in
>>> round-robin fashion.
>> 
>>> As was mentioned in some other response, I will certainly not create a
>>> new channel in every thread, but would rather try and reuse them.
>> 
>>> Thanks for all the help.
>>> Regards, Yogesh
>> 
>>> On Jan 31, 5:19 pm, Steve Powell <st... at rabbitmq.com> wrote:
>>>> Yogesh,
>> 
>>>> Please can you provide some information about your environment? And your
>>>> application? What version of RabbitMQ (and client) are you using?
>> 
>>>> In your stack trace the ShutdownListener you registered is apparently being
>>>> called, because the Connection is being shut down. It is not clear why this
>>>> exception (and its associated stack trace) appears, it seems to come from your
>>>> Listener code, but perhaps that does nothing.
>> 
>>>> The Shutdown seems to be being called because the channel is being opened twice.
>>>> The broker complains about this and closes the connection. Are you creating
>>>> channels on different threads simultaneously? (Looking at your app 'design' you
>>>> might be.) Depending upon the version of RabbitMQ this might cause a problem.
>> 
>>>> I'm afraid your application design is unclear:
>> 
>>>>> This is how I handle doing basicPublish and basicGet on potentially
>>>>> non-existent queues
>>>>> - publish involves 3 steps
>>>>>  queueDeclare
>>>>>  queueBind
>>>>>  basicPublish
>>>>>  If some other thread deletes the queue after either queueDeclare or
>>>>> queueBind, basicPublish fails and I again create a new
>>>>>  channel and do these operations
>> 
>>>> I don't think the basicPublish will fail if the queue doesn't exist. Why would
>>>> you create a new channel in this case?
>> 
>>>> Please explain why you expect the queue might be deleted by some other thread.
>> 
>>>>> - if basicGet fails, I simply ignore it
>> 
>>>> What do you mean by ignoring it? Do you poll the queue periodically? Why aren't
>>>> you using basicConsume and a Consumer to get messages (which will be notified if
>>>> the queue is deleted)?
>> 
>>>> Steve Powell  (a loopy bunny)
>>>> ----------some more definitions from the SPD----------
>>>> vermin (v.) Treating the dachshund for roundworm.
>>>> chinchilla (n.) Cooling device for the lower jaw.
>>>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>>>> On 30 Jan 2012, at 04:33, Yogesh Ketkar wrote:
>> 
>>>>> Only operations I ever do with com.rabbitmq.client.Connection in the
>>>>> code are
>>>>>    c.addShutdownListener
>>>>>    c.createChannel
>> 
>>>>> What does this error signify?
>> 
>>>>> 2012-01-30 09:44:45,158 ERROR  [ConnectionShutdownHandler]
>>>>> ShutdownListener
>>>>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
>>>>> {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
>>>>> - second 'channel.open' seen, class-id=20, method-id=10), null,
>>>>> "[B at 105691e"}
>>>>>    at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
>>>>> 641)
>>>>>    at
>>>>> com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection. java:
>>>>> 599)
>>>>>    at
>>>>> com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection. java:
>>>>> 571)
>>>>>    at com.rabbitmq.client.impl.AMQConnection
>>>>> $1.processAsync(AMQConnection.java:88)
>>>>>    at
>>>>> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel .java:
>>>>> 144)
>>>>>    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
>>>>> 91)
>>>>>    at com.rabbitmq.client.impl.AMQConnection
>>>>> $MainLoop.run(AMQConnection.java:500)
>> 
>>>>> Some additional info.
>>>>> I create and close thousands of channels in the code. But at any point
>>>>> of time there are not more than 20/21 channels open.
>>>>> This is how I handle doing basicPublish and basicGet on potentially
>>>>> non-existent queues
>>>>> - publish involves 3 steps
>>>>>  queueDeclare
>>>>>  queueBind
>>>>>  basicPublish
>>>>>  If some other thread deletes the queue after either queueDeclare or
>>>>> queueBind, basicPublish fails and I again create a new
>>>>>  channel and do these operations
>>>>> - if basicGet fails, I simply ignore it
>> 
>>>>> regards, Yogesh
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing...
>> 
>> read more ?


From rlotun at gmail.com  Thu Mar 29 17:40:29 2012
From: rlotun at gmail.com (Reza Lotun)
Date: Thu, 29 Mar 2012 09:40:29 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.8.0 Clustering Problem
In-Reply-To: <4F748D17.50408@rabbitmq.com>
References: <CAFJezo1ReWwe-c7NTtYBSGuKHwQZvT8tDEcEFJT8JROQxtcxQg@mail.gmail.com>	<4F7451ED.7060702@rabbitmq.com>
	<9549837.81.1333035040000.JavaMail.geo-discussion-forums@pblw1>
	<4F748D17.50408@rabbitmq.com>
Message-ID: <30535672.1551.1333039229023.JavaMail.geo-discussion-forums@pbcpw7>

Hi Michael,

On Thursday, March 29, 2012 9:25:59 AM UTC-7, Michael Bridgen wrote:
>
>  > I'm getting the error "Error:
>  > {no_running_cluster_nodes,[rabbit at rabbit1],[rabbit at rabbit1]}".
>
> Can you reliably reproduce it?
>
So, upgrading to 2.8.1 fixed the problem!

I guess, reading the release notes, that it wasn't clear that 2.8.0 had 
problems with clustering in the general case. 

Thanks for your help,
Reza
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/c08ce245/attachment.htm>

From chen-hongqin at 163.com  Thu Mar 29 18:19:14 2012
From: chen-hongqin at 163.com (=?GBK?B?s8K66MfV?=)
Date: Fri, 30 Mar 2012 01:19:14 +0800 (CST)
Subject: [rabbitmq-discuss] |Spam| Re:Re: Re: Re: |Spam| question
	about	rabbitmq TPS
In-Reply-To: <CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
	<CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>
	<24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>
	<CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>
Message-ID: <79f5636d.ec79.1365f77e4e3.Coremail.chen-hongqin@163.com>

figure 1
figure 2


figure 3
 
Hi, I create 15 queues in the first case, and create 300 queues in the second case. Each message is acknowledged before sending the next one. Figure 3 illustrates the detail of figure2 when i remove the several top points.
 

 
? 2012-03-29 22:53:39?"Alexis Richardson" <alexis at rabbitmq.com> ???
try it without persistence and see what graphs you get..?




2012/3/29 ??? <chen-hongqin at 163.com>

yes, all the messages are persistent



? 2012-03-29 21:17:04?"Alexis Richardson" <alexis at rabbitmq.com> ???

are you using persistent messages?



2012/3/29 ??? <chen-hongqin at 163.com>

This is about my master paper which is related with availability, and I use rabbitmq as the middle-ware component. So I am trying to find how can cause this problem. And my current answer I guess is that it is caused by the OS cache. Cache hit ratio is high at the very start and becomes lower because of the page replacement after more and more requests come. And the other reason maybe is messages are orderly sufficiently for the disk to write at start. But i am not sure if the rabbitmq has do some optimals for that?

At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
Hi,


There are lots of possible reasons for this, including that "measuring anything accurately is hard".  


What problem are you trying to solve?


alexis



2012/3/26 ??? <chen-hongqin at 163.com>

hi, 
can you tell me why TPS is too high at first and sometimes maybe even more higher(maybe over 30000/s) when I send messages to rabbitmq cluster concurrently? thanks!
 
 
 
Some infos about this test:
1. all the messages are same and each message size is 1kb.
2. 300 queues created by multiple Producers at start and messages sent to the queues are random 
3. All messages are persistent and queues are all durable
4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the same host but different ports
the host info:
|

JAVA version

|

Java version "1.6.0_12" Java(TM) SE Runtime Environment (build 1.6.0_12-b04)

|
|

JAVA VM

|

Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)

|
|

CPU

|

Intel(R) Xeon(R) CPU E5504 @2.00GHz

|
|

number of cores

|

8

|
|

memory

|

33011192kb

|
|

Erlang VM

|

Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false]

|
|

RabbitMQ version

|

Release 2.7.1

|


 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss












-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/5e780f02/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 15.jpg
Type: image/jpeg
Size: 34912 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/5e780f02/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 300.jpg
Type: image/jpeg
Size: 32359 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/5e780f02/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: detail300.jpg
Type: image/jpeg
Size: 37945 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/5e780f02/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2012-03-26_00-02-28.png
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/5e780f02/attachment.png>

From mpietrek at skytap.com  Thu Mar 29 19:13:13 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 29 Mar 2012 11:13:13 -0700
Subject: [rabbitmq-discuss] No error reported when
 tx_select/basic_publish/tx_commit is given an undefined queue name?
In-Reply-To: <CABzX+qy-nK=hcan=e+_vdduDSOnCTiatoO-1W7uvA9Us=WV66Q@mail.gmail.com>
References: <CB98F7D8.3E055%mpietrek@skytap.com>
	<CABzX+qy-nK=hcan=e+_vdduDSOnCTiatoO-1W7uvA9Us=WV66Q@mail.gmail.com>
Message-ID: <CACLE7ixcbcsFN3Df5LuVWx+vFLo8O_9m0ND6md9V7V8RskmsbA@mail.gmail.com>

Thanks Marek,

Every day's a school day. I didn't know about the mandatory flag.

HOWEVER... Having added to the code below, I still don't get and indication
of error. Stepping into the tx_commit code, I see what looks like a
Tx.CommitOK message back from the server. I've double-verified that the
queue I'm sending to doesn't exist.

Matt

On Thu, Mar 29, 2012 at 3:52 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Thu, Mar 29, 2012 at 01:16, Matt Pietrek <mpietrek at skytap.com> wrote:
> > I have a Pika code sequence that looks like this:
> >
> >                     channel = self._channel
> >                     channel.tx_select()
> >                     channel.basic_publish(exchange='',
> >                         routing_key=queue_name,
> >                         body=json_string,
> >                         properties=pika.BasicProperties(delivery_mode=2))
> >                     channel.tx_commit()
> >
> > During some robustness testing, I found that if I passed an invalid queue
> > name to basic_get, I get an AMQPChannelError as expected. However, when
> > using the above code to write a message to an invalid queue name, no
> > exception is seen.
> >
> > Is this normal or am I missing something? In our scenario, we have to
> > absolutely, positively know that the message was received by the broker.
>
> Yes, this is normal.
>
> AMQP does not allow you to send message to a "queue", instead, you
> send a message to an exchange with a routing key.
>
> This routing key is a queue name in this case but it can be just anything.
>
> Messages sent with a routing key that is not matched by appropriate
> binding will be lost. This is the correct behaviour.
>
> If you need to ensure that message is delivered use 'mandatory' flag
> on basic.publish:
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish
>
> Cheers,
>  Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/d5d52efd/attachment.htm>

From mpietrek at skytap.com  Thu Mar 29 20:04:29 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 29 Mar 2012 12:04:29 -0700
Subject: [rabbitmq-discuss] Must basic.reject be done on the same channel as
	received on?
Message-ID: <CACLE7iwCSx21N2xYgK16wjH32zQAJF26RebHatShD6s3ht3FsA@mail.gmail.com>

Easy question.

know that messages must be acknowledged on the same channel they're
received on. Does reject have the same requirements? It's not obviously a
"yes" from where I'm looking in the AMQP spec.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/9df2e5cb/attachment.htm>

From simone.busoli at gmail.com  Thu Mar 29 20:21:12 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 29 Mar 2012 21:21:12 +0200
Subject: [rabbitmq-discuss] Must basic.reject be done on the same
 channel as received on?
In-Reply-To: <CACLE7iwCSx21N2xYgK16wjH32zQAJF26RebHatShD6s3ht3FsA@mail.gmail.com>
References: <CACLE7iwCSx21N2xYgK16wjH32zQAJF26RebHatShD6s3ht3FsA@mail.gmail.com>
Message-ID: <CAOn7oW-kc1LWJjgBWrR6oPPriEas1-mHXOf=M_qhN5rr4qCi7A@mail.gmail.com>

Hi Matt, you can reject a message you've been delivered, so yes, you can
only do that on the same channel through which the message has been
delivered. As a rule of thumb, anything that involves a delivery tag has
relevance only within the same channel.

On Thu, Mar 29, 2012 at 21:04, Matt Pietrek <mpietrek at skytap.com> wrote:

> Easy question.
>
> know that messages must be acknowledged on the same channel they're
> received on. Does reject have the same requirements? It's not obviously a
> "yes" from where I'm looking in the AMQP spec.
>
> Thanks,
>
> Matt
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/469650c6/attachment.htm>

From dawgtool at aol.com  Thu Mar 29 20:39:40 2012
From: dawgtool at aol.com (DawgTool)
Date: Thu, 29 Mar 2012 15:39:40 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F730718.6080908@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>
	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>
	<4F72E8A4.1010609@rabbitmq.com> <4F730718.6080908@rabbitmq.com>
Message-ID: <4F74BA7C.2020106@aol.com>

Hi Simon,

I have recompiled OTP R15B and RabbitMQ-Server 2.8.1 from source.
I have two versions of 2.8.1 compiled, one with the patch below(2.8.1b) 
and one without(2.8.1a).
I need to dive into the code a little more, but hopefully there will be 
some way to monitor what is in the buffer/cache and what is entering the 
queue.

I'll post up some stats once I get everything configured in the cluster.
I sent some info in a previous message, let me know if that was helpful 
or not.

Thanks


On 3/28/12 8:42 AM, Simon MacMullen wrote:
> On 28/03/12 11:32, Simon MacMullen wrote:
>> I will try to reproduce based on the above, but anything else you can
>> tell me would be a great help.
>
> Hmm, I'm struggling with this.
>
> I can certainly get into a state with a combination of x-message-ttl, 
> lots of messages expiring, and enough memory pressure to push much of 
> the queue onto disc, such that the queue performance fluctuates quite 
> a bit (as it switches between accepting new messages / paging messages 
> out to disc / paging them back in / expiring them).
>
> But I can't get a message rate that works OK in this scenario with 
> flow control disabled but blocks for long periods with it enabled. If 
> the message rate is high enough for flow control to kick in, then it's 
> also high enough for memory use to go up as messages wait to enter the 
> queue if flow control is disabled. Eventually the memory alarm goes 
> off instead.
>
> So can you provide more information about your use pattern?
>
> Having said that, if you just want to disable flow control and are 
> prepared to build from source, you could apply the following patch:
>
> diff -r f0dafaca6cd1 src/rabbit_reader.erl
> --- a/src/rabbit_reader.erl    Mon Mar 26 17:12:41 2012 +0100
> +++ b/src/rabbit_reader.erl    Wed Mar 28 13:40:03 2012 +0100
> @@ -360,7 +360,7 @@
>
>  control_throttle(State = #v1{connection_state = CS,
>                               conserve_memory  = Mem}) ->
> -    case {CS, Mem orelse credit_flow:blocked()} of
> +    case {CS, Mem} of
>          {running,   true} -> State#v1{connection_state = blocking};
>          {blocking, false} -> State#v1{connection_state = running};
>          {blocked,  false} -> ok = rabbit_heartbeat:resume_monitor(
>
> But I would like to understand more about what you're seeing.
>
> Cheers, Simon
>


From pbell at syncsort.com  Thu Mar 29 23:45:08 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 29 Mar 2012 18:45:08 -0400
Subject: [rabbitmq-discuss] New and Fundamental Confusion
In-Reply-To: <4F74BA7C.2020106@aol.com>
References: <4F6CD702.4050908@aol.com><4F704404.8080504@rabbitmq.com>
	<4F728392.5070602@aol.com><4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com> <4F74BA7C.2020106@aol.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695BA4@MAILCCR.us.syncsort.com>

Hi All,

As things are beginning to crystallize in our imminent use of Rabbit, I find myself going over various concepts, just trying to make sure that I understand what we are doing and how we are doing it.

I today stumbled upon a painful confusion which I am sure can be easily dispelled.

I was pondering what it means that a producer writes to an exchange when I realized that I didn't fully understand how this can even work without at least *some* hint as to what queue these messages are destined for. If such a hint, e.g., a queue name, is lacking when the messages are sent to the exchange, then how does it help a consumer to declare the queue name? That is, doesn't the broker need to know that the bunch of messages it is holding should be routed to one or more consumers because they've declared the *same* queue name as the producer?

Using a fanout exchange, my producer code looks like this. Note that the RabbitAdmin object is told via "declare" of both the exchange and the queue. Isn't this just such a "hint?"

                 RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
                 Exchange ex = new FanoutExchange(exchName, true, false);
                 admin.declareExchange(ex);
                 admin.declareQueue(new Queue(this.queueName));

But in the case of a topic exchange, my producer does this:

                rabbitTemplate = new RabbitTemplate(connectionFactory);
                rabbitAdmin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
                Queue queue = new Queue("pbJobMgmtRqst", false, false, false);
                rabbitAdmin.declareQueue(queue);
             rabbitTemplate.send(exchangeName, "mgmt.clientID." + routingKeySuffix, msg);

Is the declareQueue here even necessary? The .send() call specifies the exchange, the routing key, and the message. Or, could it be that, for a topic exchange, the broker needs only to pattern match the routing and binding keys, i.e., the producer need not provide any hint of the queue the message is destined for? But, for a fanout exchange where routing and binding is irrelevant, such a hint is needed?

Here's how my lack of understanding first hit me: if two consumers declare the same queue name, then the broker sees them as competing for messages, resulting in an "even" distribution of messages across consumers. But if they declare different queue names, then they are no longer competing, i.e., each will get all messages. I think I understand how this can work when routing and binding matter. But in the fanout exchange case, if one consumer declared "queue1" and the other declared "queue2", then only one of them is going to get messages, right? I mean the case where producer has declared "queue1"...

I am a bit embarrassed that so fundamental a question has escaped me until now. And I am grateful for your help.

Thanks.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From videlalvaro at gmail.com  Thu Mar 29 23:52:41 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 30 Mar 2012 00:52:41 +0200
Subject: [rabbitmq-discuss] New and Fundamental Confusion
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B41695BA4@MAILCCR.us.syncsort.com>
References: <4F6CD702.4050908@aol.com><4F704404.8080504@rabbitmq.com>
	<4F728392.5070602@aol.com><4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com> <4F74BA7C.2020106@aol.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B41695BA4@MAILCCR.us.syncsort.com>
Message-ID: <6CD30ACF-2D22-40B9-A0F3-C42507F2AC47@gmail.com>

Hi,

I think this might help you to understand how queues, exchanges and bindings work together:

http://www.rabbitmq.com/tutorials/amqp-concepts.html

Cheers,

Alvaro

On Mar 30, 2012, at 12:45 AM, Bell, Paul M. wrote:

> Hi All,
> 
> As things are beginning to crystallize in our imminent use of Rabbit, I find myself going over various concepts, just trying to make sure that I understand what we are doing and how we are doing it.
> 
> I today stumbled upon a painful confusion which I am sure can be easily dispelled.
> 
> I was pondering what it means that a producer writes to an exchange when I realized that I didn't fully understand how this can even work without at least *some* hint as to what queue these messages are destined for. If such a hint, e.g., a queue name, is lacking when the messages are sent to the exchange, then how does it help a consumer to declare the queue name? That is, doesn't the broker need to know that the bunch of messages it is holding should be routed to one or more consumers because they've declared the *same* queue name as the producer?
> 
> Using a fanout exchange, my producer code looks like this. Note that the RabbitAdmin object is told via "declare" of both the exchange and the queue. Isn't this just such a "hint?"
> 
>                 RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
>                 Exchange ex = new FanoutExchange(exchName, true, false);
>                 admin.declareExchange(ex);
>                 admin.declareQueue(new Queue(this.queueName));
> 
> But in the case of a topic exchange, my producer does this:
> 
>                rabbitTemplate = new RabbitTemplate(connectionFactory);
>                rabbitAdmin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
>                Queue queue = new Queue("pbJobMgmtRqst", false, false, false);
>                rabbitAdmin.declareQueue(queue);
>             rabbitTemplate.send(exchangeName, "mgmt.clientID." + routingKeySuffix, msg);
> 
> Is the declareQueue here even necessary? The .send() call specifies the exchange, the routing key, and the message. Or, could it be that, for a topic exchange, the broker needs only to pattern match the routing and binding keys, i.e., the producer need not provide any hint of the queue the message is destined for? But, for a fanout exchange where routing and binding is irrelevant, such a hint is needed?
> 
> Here's how my lack of understanding first hit me: if two consumers declare the same queue name, then the broker sees them as competing for messages, resulting in an "even" distribution of messages across consumers. But if they declare different queue names, then they are no longer competing, i.e., each will get all messages. I think I understand how this can work when routing and binding matter. But in the fanout exchange case, if one consumer declared "queue1" and the other declared "queue2", then only one of them is going to get messages, right? I mean the case where producer has declared "queue1"...
> 
> I am a bit embarrassed that so fundamental a question has escaped me until now. And I am grateful for your help.
> 
> Thanks.
> 
> -Paul
> 
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From james.r.carr at gmail.com  Fri Mar 30 06:15:07 2012
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 30 Mar 2012 00:15:07 -0500
Subject: [rabbitmq-discuss] Setting Per Message TTL?
Message-ID: <CAJreXKAn=AL1FbMkZTAqLiAn-RzRLPLwUjK-1w+cNQcWDVXYgw@mail.gmail.com>

Hi All,

I know how to set message TTL on a queue by queue basis, but is it
possible to set the message TTL on a message basis?

Thanks,
James

From james.r.carr at gmail.com  Fri Mar 30 06:56:44 2012
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 30 Mar 2012 00:56:44 -0500
Subject: [rabbitmq-discuss] How to configure Shovel with HA queue
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1CA4F@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1CA4F@Y000IIIV01.rd1.rf1>
Message-ID: <CAJreXKCE9zj+xL+aCvdj_p0ezjUQ7sZrqczGyKM7Hhi2bC2kSA@mail.gmail.com>

I don't think it's currently possible (I could be wrong). Maybe
federation would work better for you? I use federation with HA queues
on a couple clusters I've setup and it works like a charm.
http://www.rabbitmq.com/federation.html

Thanks,
James


On Thu, Mar 29, 2012 at 6:50 AM, MELIQUE Denis (MORPHO)
<denis.melique at morpho.com> wrote:
> Hi,
>
>
>
> Is it possible to set Shovel configuration to consume from a HA Queue ?
>
> I did not find documentation about it on Rabbit MQ site, and I?am wondering
> if it?s possible.
>
> If Yes what is the correct syntax of the queue.declare in shovel declaration
> ?
>
>
>
> I already have tried :
>
> ?
>
> {'queue.declare',
>
> ?????????????????????????????? [{queue, <<"shovel.forward.insertions">>},
>
> ??????????????????????????????? {x-ha-policy,<<"all">>},
>
> ??????????????????????????????? durable ]},
>
> ?
>
> Which seems to be incorrect J
>
>
>
> Thank you.
>
>
>
> Denis
>
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des
> informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont
> pas destin?s, nous vous signalons qu'il est strictement interdit de les
> divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit
> le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en
> informer l'exp?diteur et de supprimer imm?diatement de votre syst?me
> informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or
> proprietary information. If you are not the intended recipient, you are
> notified that any dissemination, copying of this e-mail and any attachments
> thereto or use of their contents by any means whatsoever is strictly
> prohibited. If you have received this e-mail in error, please advise the
> sender immediately and delete this e-mail and all attached documents from
> your computer system."
> #
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Fri Mar 30 07:08:10 2012
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 30 Mar 2012 01:08:10 -0500
Subject: [rabbitmq-discuss] Dead Letter Exchanges
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B168024F536689@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B168024F536689@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <CAJreXKDc1JoWQp9UR_Q9sKoFS5O-+QLgQaFsysKi2kjLx8_8PA@mail.gmail.com>

Your error_exc is defined as type direct yet you bound it using #. Change
it to a topic and your binding should work.

Thanks,
James


2012/3/29 <rui.favas at barclays.com>

>  Hi,****
>
> ** **
>
> Can?t get the Dead Letter Exchanges to work with ?x-message-ttl?. Please
> see details below:-****
>
> ** **
>
> I can publish messages to the ?testqueue? queue and the messages get
> removed after the ?x-message-ttl? timeout but don?t get routed to the
> ?errorqueue? via the ?error_exc? exchange. Can you help??****
>
> ** **
>
> ** **
>
> I have two exchanges:****
>
> ** **
>
> *Exchange: error_exc*
>
> Type****
>
> direct****
>
> Parameters****
>
> durable:****
>
> true****
>
> Virtual host****
>
> /test****
>
> ** **
>
> *Exchange: test_exc*
>
> Type****
>
> direct****
>
> Parameters****
>
> durable:****
>
> true****
>
> Virtual host****
>
> /test****
>
> ** **
>
> ** **
>
> I have two queues:****
>
> ** **
>
> *Queue: testqueue*
>
> Parameters****
>
> arguments:****
>
> x-dead-letter-exchange:****
>
> error_exc****
>
> x-message-ttl:****
>
> 5000****
>
> durable:****
>
> true****
>
> Exclusive owner****
>
> None ****
>
> Status****
>
> Idle since
> 2012-3-29 16:52:55****
>
> * *
>
> *Bindings:*
>
> * *
>
> From****
>
> Routing key****
>
> Arguments****
>
> *test_exc* <http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/test_exc>
> Exchange ****
>
> Top of Form****
>
> ****
>
> Bottom of Form****
>
> *(AMQP default)*<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/amq.default>
> Exchange ****
>
> testqueue****
>
> ? testqueue ****
>
> * *
>
> * *
>
> ** **
>
> *Queue: errorqueue*
>
> Parameters****
>
> durable:****
>
> true****
>
> Exclusive owner****
>
> None ****
>
> Status****
>
> Idle since
> 2012-3-29 16:49:46****
>
> ** **
>
> Consumers****
>
> 0****
>
> Memory****
>
> 4.1kB****
>
> ** **
>
> Virtual host****
>
> /test****
>
> * *
>
> *Bindings:*
>
> From****
>
> Routing key****
>
> Arguments****
>
> *error_exc* <http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/error_exc>
> Exchange ****
>
> #****
>
> Top of Form****
>
> ****
>
> Bottom of Form****
>
> *(AMQP default)*<http://bim_bus_admin_uat:55672/#/exchanges/%2Fbcfs/amq.default>
> Exchange ****
>
> errorqueue****
>
> ? errorqueue ****
>
> * *
>
> * *
>
> * *
>
> *_______________________________________________*
>
> Barclays is one of the world?s leading banks, and we believe that by
> continuing to integrate the organisation we can better deliver the full
> power of Barclays to customers, clients and the communities in which we
> work. ****
>
> As a visible sign of that integration we are moving to a single Barclays
> brand for the majority of our divisions, including those formerly known as
> Barclays Capital, Barclays Wealth and Barclays Corporate.****
>
>
>
> _______________________________________________****
>
> ****
>
> This e-mail may contain information that is confidential, privileged or
> otherwise protected from disclosure. If you are not an intended recipient
> of this e-mail, do not duplicate or redistribute it by any means. Please
> delete it and any attachments and notify the sender that you have received
> it in error. Unless specifically indicated, this e-mail is not an offer to
> buy or sell or a solicitation to buy or sell any securities, investment
> products or other financial product or service, an official confirmation of
> any transaction, or an official statement of Barclays. Any views or
> opinions presented are solely those of the author and do not necessarily
> represent those of Barclays. This e-mail is subject to terms available at
> the following link: www.barcap.com/emaildisclaimer<http://www.barclays.com/emaildisclaimer>.
> By messaging with Barclays you consent to the foregoing.  Barclays offers
> premier investment banking products and services to its clients through Barclays
> Bank PLC, a company registered in England (number 1026167) with its
> registered office at 1 Churchill Place, London, E14 5HP.  This email may
> relate to or be sent from other members of the Barclays Group.**
>
> _______________________________________________****
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/51e8b4db/attachment.htm>

From timya15 at gmail.com  Fri Mar 30 07:22:06 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Fri, 30 Mar 2012 11:52:06 +0530
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
Message-ID: <CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>

Thanks for the great information shared, this will be interesting to
have a wrapper
script for each node.

I think, the generic installation in multiple locations, having the
rabbitmq-defaults, rabbitmq-env and rabbitmq.config considering all
the listeners modified will work. Having installations on multiple
locations will make rabbitmq embed-able in one's application (required
Erlang is already available on the machine). Using this approach will free
me, by having the required properties to be picked-up externally. These
properties will then be used to create or modify the rabbitmq-defaults,
rabbitmq-env and rabbitmq.config as required.

Any thoughts ?

Regards,
Timya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/6568344d/attachment.htm>

From james.r.carr at gmail.com  Fri Mar 30 07:42:19 2012
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 30 Mar 2012 01:42:19 -0500
Subject: [rabbitmq-discuss] Scheduled Message Delivery
Message-ID: <CAJreXKAMLjOQhrqd_7UogFG-5ETaLnDFa5vKguiUC1qR0kS1QQ@mail.gmail.com>

Hey All,

I thought I'd share a neat "trick" I came up with lately to "schedule"
messages to be delivered at a specific duration. I had a lot of
polling going on in my application for things like scheduling
callbacks with leads and was getting sick of having to add even more
interval based polling each time a new feature came along.

So here's an example of what I'm doing to schedule messages to be
delivered at a time in the future:
https://github.com/jamescarr/rabbitmq-scheduled-delivery. It makes
interesting use of x-message-ttl and x-dead-letter-exchange. :)

Cheers,
James

From emile at rabbitmq.com  Fri Mar 30 10:20:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Mar 2012 10:20:52 +0100
Subject: [rabbitmq-discuss] Setting Per Message TTL?
In-Reply-To: <CAJreXKAn=AL1FbMkZTAqLiAn-RzRLPLwUjK-1w+cNQcWDVXYgw@mail.gmail.com>
References: <CAJreXKAn=AL1FbMkZTAqLiAn-RzRLPLwUjK-1w+cNQcWDVXYgw@mail.gmail.com>
Message-ID: <4F757AF4.2010806@rabbitmq.com>


Hi James,

On 30/03/12 06:15, James Carr wrote:
> I know how to set message TTL on a queue by queue basis, but is it
> possible to set the message TTL on a message basis?

No - this would have made it necessary for the broker to expire and
remove messages in the middle of the queue, which is difficult to do
efficiently.

If your producers and consumers share a time source then producers could
add a timestamp to messages and consumers could simply ignore expired
messages.


-Emile



From rich.aloha at gmail.com  Fri Mar 30 00:57:01 2012
From: rich.aloha at gmail.com (aloharich)
Date: Thu, 29 Mar 2012 16:57:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Basics: Queues, Routing Keys
Message-ID: <27963806.509.1333065421119.JavaMail.geo-discussion-forums@yno37>

I'm trying to wrap my head around exchanges,queues, routing keys. My 
assumption which code is proving incorrect is: I can create a single 
exchange, with multiple queues. A consumer can point to a particular queue 
and get messages just for that queue. Now here is where my brain loses the 
plot: I had assumed I could use routing keys to have particular consumers 
just get messages on a queue that match a particular "routing_key'.

So assuming I have a queue FOO and a queue BAR, I'd expect the below 
senders messages to queue BAR to NOT show up on queue FOO. However, when 
running the below, the queue FOO receiver receives messages if the routing 
key matches 

% python send.py a.b.c
% python recy.py a.b.c
(receives a message on QUEUE FOO since it appears routing key is matching)

Are routing keys global? Ie, if you have a key a.b.c any body on any queue 
will match that?

What I'm trying to achieve is the ability to send certain messages that 
only a group of consumers on a particular "queue" will process.

Thanks,

Rich


#!/usr/bin/env python
import pika
import sys

ex = "dev.test"
q = "BAR"

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='127.0.0.1'))
channel = connection.channel()
channel.exchange_declare(exchange=ex,
                         type='direct', durable=True)
result = channel.queue_declare(queue=q,auto_delete=False, durable=True)
print "queue %s" % result.method.queue
channel.queue_bind(exchange=ex,
                   queue=q)
routing_key = sys.argv[1] if len(sys.argv) > 1 else 'anonymous.info'
message = "hello"
for i in range(1,2):
    channel.basic_publish(exchange=ex,
                          routing_key=routing_key,
                          body=message,
                          properties=pika.BasicProperties(
            delivery_mode = 2, 
            ))
    print " [x] Sent %r" % (message,)


recv:

#!/usr/bin/env python
import pika
import sys

ex = "dev.test"
q = "FOO"

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='127.0.0.1'))
channel = connection.channel()
channel.exchange_declare(exchange=ex,
                         type='direct', durable=True)

result = channel.queue_declare(queue=q, durable=True)
queue_name = result.method.queue
binding_keys = sys.argv[1:]
if not binding_keys:
    print >> sys.stderr, "Usage: %s [binding_key]..." % (sys.argv[0],)
    sys.exit(1)

for binding_key in binding_keys:
    channel.queue_bind(exchange=ex,
                       queue=queue_name,
                       routing_key=binding_key)

print ' [*] Waiting for logs. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print "Routing key: %r" % (method.routing_key)
    print "Body %r" % (body,)

channel.basic_consume(callback,
                      queue=queue_name,
                      no_ack=True)

channel.start_consuming()

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/6b18078f/attachment.htm>

From octomeow at gmail.com  Fri Mar 30 01:26:44 2012
From: octomeow at gmail.com (octomeow)
Date: Thu, 29 Mar 2012 17:26:44 -0700 (PDT)
Subject: [rabbitmq-discuss] fanout queue not working
Message-ID: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>

newbie to rabbitmq  and I'm not getting messages into a certain queue

I have a simple fanout exchange
# rabbitmqctl list_exchanges
rawlogs fanout

I have bound this exchange to a few queues
# rabbitmqctl list_bindings
Listing bindings ...
        exchange        log2_consumer       queue
log2_consumer       []
        exchange        rawlogs_consumer        queue
rawlogs_consumer        []
rawlogs exchange        log2_consumer       queue           []
rawlogs exchange        rawlogs_consumer        queue
logstash        []
...done.

I connect fine to the log2_consumer queue....however, I get NO
messages.

my other queue..... the rawlogs_consumer does the the messges

From steve at rabbitmq.com  Fri Mar 30 11:17:20 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 11:17:20 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
	<CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
Message-ID: <45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>

My outline of a solution with a wrapper script was designed to allow a
common code installation to be shared by multiple broker instances
running the same machine.

By 'the generic installation in multiple locations' I'm assuming you
mean installing the Generic-Unix package muiltiple times. (You just have
to unpack the archive once and copy the directory structure.) If you do
this, then no adjustment of the RABBITMQ variables is necessary, just
invoke the appropriate script and each one will (by default) use it's
own code directory for its configuration, log and Mnesia files.

You still have to ensure their use of global resources do not clash.

I would prefer to have one shared code-base (upgrades are easier).

Let us know if you come across any problems.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 07:22, Timya Tortus wrote:

> Thanks for the great information shared, this will be interesting to have a wrapper script for each node. 
> 
> I think, the generic installation in multiple locations, having the rabbitmq-defaults, rabbitmq-env and rabbitmq.config considering all the listeners modified will work. Having installations on multiple locations will make rabbitmq embed-able in one's application (required Erlang is already available on the machine). Using this approach will free me, by having the required properties to be picked-up externally. These properties will then be used to create or modify the rabbitmq-defaults, rabbitmq-env and rabbitmq.config as required. 
> 
> Any thoughts ?
> 
> Regards,
> Timya


From steve at rabbitmq.com  Fri Mar 30 11:29:18 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 11:29:18 +0100
Subject: [rabbitmq-discuss] Scheduled Message Delivery
In-Reply-To: <CAJreXKAMLjOQhrqd_7UogFG-5ETaLnDFa5vKguiUC1qR0kS1QQ@mail.gmail.com>
References: <CAJreXKAMLjOQhrqd_7UogFG-5ETaLnDFa5vKguiUC1qR0kS1QQ@mail.gmail.com>
Message-ID: <96423259-A1F7-4BF6-A702-07101CB94635@rabbitmq.com>

Fascinating James,

I think the reason the queue stays around (even though you specify
auto-delete) is because auto-delete on queues is designed to be
triggered when the last consumer is cancelled. If there are never any
consumers for the queue this event never occurs and the queue stays
around. (If this wasn't the case, an auto-delete queue could disappear
as soon as it was created!). It's all in the spec  :-)

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 07:42, James Carr wrote:

> Hey All,
> 
> I thought I'd share a neat "trick" I came up with lately to "schedule"
> messages to be delivered at a specific duration. I had a lot of
> polling going on in my application for things like scheduling
> callbacks with leads and was getting sick of having to add even more
> interval based polling each time a new feature came along.
> 
> So here's an example of what I'm doing to schedule messages to be
> delivered at a time in the future:
> https://github.com/jamescarr/rabbitmq-scheduled-delivery. It makes
> interesting use of x-message-ttl and x-dead-letter-exchange. :)
> 
> Cheers,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Fri Mar 30 11:33:00 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 30 Mar 2012 11:33:00 +0100
Subject: [rabbitmq-discuss] No error reported when
 tx_select/basic_publish/tx_commit is given an undefined queue name?
In-Reply-To: <CACLE7ixcbcsFN3Df5LuVWx+vFLo8O_9m0ND6md9V7V8RskmsbA@mail.gmail.com>
References: <CB98F7D8.3E055%mpietrek@skytap.com>
	<CABzX+qy-nK=hcan=e+_vdduDSOnCTiatoO-1W7uvA9Us=WV66Q@mail.gmail.com>
	<CACLE7ixcbcsFN3Df5LuVWx+vFLo8O_9m0ND6md9V7V8RskmsbA@mail.gmail.com>
Message-ID: <CABzX+qzXQj8mUmor_xXYsGMAcdE5cCWGisVrXjH4g9EPwTZjng@mail.gmail.com>

On Thu, Mar 29, 2012 at 19:13, Matt Pietrek <mpietrek at skytap.com> wrote:
> Thanks Marek,
>
> Every day's a school day. I didn't know about the mandatory flag.
>
> HOWEVER... Having added to the code below, I still don't get and indication
> of error. Stepping into the tx_commit code, I see what looks like a
> Tx.CommitOK message back from the server. I've double-verified that the
> queue I'm sending to doesn't exist.

Yes, messages sent with `mandatory` ?flag don't result in an error.

Instead the message is returned by the broker to your client.
This is done using Basic.Return AMQP method, you should be able
to catch this from pika.

My guess is that `channel.add_on_return_callback` allows
you to pass a callback for this case.
? ?http://pika.github.com/channel.html#id1

Marek

> On Thu, Mar 29, 2012 at 3:52 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> On Thu, Mar 29, 2012 at 01:16, Matt Pietrek <mpietrek at skytap.com> wrote:
>> > I have a Pika code sequence that looks like this:
>> >
>> > ? ? ? ? ? ? ? ? ? ? channel = self._channel
>> > ? ? ? ? ? ? ? ? ? ? channel.tx_select()
>> > ? ? ? ? ? ? ? ? ? ? channel.basic_publish(exchange='',
>> > ? ? ? ? ? ? ? ? ? ? ? ? routing_key=queue_name,
>> > ? ? ? ? ? ? ? ? ? ? ? ? body=json_string,
>> >
>> > properties=pika.BasicProperties(delivery_mode=2))
>> > ? ? ? ? ? ? ? ? ? ? channel.tx_commit()
>> >
>> > During some robustness testing, I found that if I passed an invalid
>> > queue
>> > name to basic_get, I get an AMQPChannelError as expected. However, when
>> > using the above code to write a message to an invalid queue name, no
>> > exception is seen.
>> >
>> > Is this normal or am I missing?something? In our scenario, we have to
>> > absolutely, positively know that the message was received by the broker.
>>
>> Yes, this is normal.
>>
>> AMQP does not allow you to send message to a "queue", instead, you
>> send a message to an exchange with a routing key.
>>
>> This routing key is a queue name in this case but it can be just anything.
>>
>> Messages sent with a routing key that is not matched by appropriate
>> binding will be lost. This is the correct behaviour.
>>
>> If you need to ensure that message is delivered use 'mandatory' flag
>> on basic.publish:
>> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish
>>
>> Cheers,
>> ?Marek
>
>

From simon at rabbitmq.com  Fri Mar 30 11:36:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Mar 2012 11:36:04 +0100
Subject: [rabbitmq-discuss] How to configure Shovel with HA queue
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1CA4F@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1CA4F@Y000IIIV01.rd1.rf1>
Message-ID: <4F758C94.2090909@rabbitmq.com>

On 29/03/12 12:50, MELIQUE Denis (MORPHO) wrote:
> I already have tried :
> {'queue.declare',
>
>                                 [{queue, <<"shovel.forward.insertions">>},
>
>                                  {x-ha-policy,<<"all">>},
>
>                                  durable ]},

I think you want something like:

{'queue.declare',
   [{queue, <<"foo">>},
    {durable, true},
    {arguments, [{<<"x-ha-policy">>, longstr, <<"all">>}]}
   ]}

Note that x-ha-policy is a queue argument, and it takes an AMQP table, 
hence the longstr.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri Mar 30 11:44:23 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 11:44:23 +0100
Subject: [rabbitmq-discuss] Basics: Queues, Routing Keys
In-Reply-To: <27963806.509.1333065421119.JavaMail.geo-discussion-forums@yno37>
References: <27963806.509.1333065421119.JavaMail.geo-discussion-forums@yno37>
Message-ID: <2BDFA182-9AF5-48DD-A96B-710F330539A0@rabbitmq.com>

Hi Rich,

The bit you're missing is the proper role of the exchange and the
routing-key and the fact that queues are *bound* to the exchange with a
binding key. Try reading
http://www.rabbitmq.com/tutorials/amqp-concepts.html, and come back here
(the reading list <rabbitmq-discuss at lists.rabbitmq.com>) if you still
don't get it.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 00:57, aloharich wrote:

> I'm trying to wrap my head around exchanges,queues, routing keys. My assumption which code is proving incorrect is: I can create a single exchange, with multiple queues. A consumer can point to a particular queue and get messages just for that queue. Now here is where my brain loses the plot: I had assumed I could use routing keys to have particular consumers just get messages on a queue that match a particular "routing_key'.
> 
> So assuming I have a queue FOO and a queue BAR, I'd expect the below senders messages to queue BAR to NOT show up on queue FOO. However, when running the below, the queue FOO receiver receives messages if the routing key matches 
> 
> % python send.py a.b.c
> % python recy.py a.b.c
> (receives a message on QUEUE FOO since it appears routing key is matching)
> 
> Are routing keys global? Ie, if you have a key a.b.c any body on any queue will match that?
> 
> What I'm trying to achieve is the ability to send certain messages that only a group of consumers on a particular "queue" will process.
> 
> Thanks,
> 
> Rich
> 
> 
> #!/usr/bin/env python
> import pika
> import sys
> 
> ex = "dev.test"
> q = "BAR"
> 
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>         host='127.0.0.1'))
> channel = connection.channel()
> channel.exchange_declare(exchange=ex,
>                          type='direct', durable=True)
> result = channel.queue_declare(queue=q,auto_delete=False, durable=True)
> print "queue %s" % result.method.queue
> channel.queue_bind(exchange=ex,
>                    queue=q)
> routing_key = sys.argv[1] if len(sys.argv) > 1 else 'anonymous.info'
> message = "hello"
> for i in range(1,2):
>     channel.basic_publish(exchange=ex,
>                           routing_key=routing_key,
>                           body=message,
>                           properties=pika.BasicProperties(
>             delivery_mode = 2, 
>             ))
>     print " [x] Sent %r" % (message,)
> 
> 
> recv:
> 
> #!/usr/bin/env python
> import pika
> import sys
> 
> ex = "dev.test"
> q = "FOO"
> 
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>         host='127.0.0.1'))
> channel = connection.channel()
> channel.exchange_declare(exchange=ex,
>                          type='direct', durable=True)
> 
> result = channel.queue_declare(queue=q, durable=True)
> queue_name = result.method.queue
> binding_keys = sys.argv[1:]
> if not binding_keys:
>     print >> sys.stderr, "Usage: %s [binding_key]..." % (sys.argv[0],)
>     sys.exit(1)
> 
> for binding_key in binding_keys:
>     channel.queue_bind(exchange=ex,
>                        queue=queue_name,
>                        routing_key=binding_key)
> 
> print ' [*] Waiting for logs. To exit press CTRL+C'
> 
> def callback(ch, method, properties, body):
>     print "Routing key: %r" % (method.routing_key)
>     print "Body %r" % (body,)
> 
> channel.basic_consume(callback,
>                       queue=queue_name,
>                       no_ack=True)
> 
> channel.start_consuming()
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Mar 30 12:12:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Mar 2012 12:12:22 +0100
Subject: [rabbitmq-discuss] fanout queue not working
In-Reply-To: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>
References: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>
Message-ID: <4F759516.4080907@rabbitmq.com>

That sounds like it should be working. You are definitely publishing to 
the right exchange? Can you show us some sample code?

Cheers, Simon

On 30/03/12 01:26, octomeow wrote:
> newbie to rabbitmq  and I'm not getting messages into a certain queue
>
> I have a simple fanout exchange
> # rabbitmqctl list_exchanges
> rawlogs fanout
>
> I have bound this exchange to a few queues
> # rabbitmqctl list_bindings
> Listing bindings ...
>          exchange        log2_consumer       queue
> log2_consumer       []
>          exchange        rawlogs_consumer        queue
> rawlogs_consumer        []
> rawlogs exchange        log2_consumer       queue           []
> rawlogs exchange        rawlogs_consumer        queue
> logstash        []
> ...done.
>
> I connect fine to the log2_consumer queue....however, I get NO
> messages.
>
> my other queue..... the rawlogs_consumer does the the messges
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Fri Mar 30 12:16:58 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 30 Mar 2012 12:16:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ and SockJS at London Realtime hackathon
	- April 13th - 15th
Message-ID: <CABzX+qy6DHQGfC+cVC_Kyzi5ODARttR1+nBEmnXnoW6ahg1pZQ@mail.gmail.com>

Good news everyone!

VMware / RabbitMQ is sponsoring the London Realtime hackathon on Apr
13th - 15th:

  http://londonrealtime.co.uk/


If you want to meet us, or just eat, drink and hack, please join!

See you there!

Cheers,
    Marek

From santhosh at 8kmiles.com  Fri Mar 30 12:51:24 2012
From: santhosh at 8kmiles.com (Santhoshsd)
Date: Fri, 30 Mar 2012 04:51:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq - retrieving messages concurrently
Message-ID: <f2cd0a95-3486-4c1c-829d-c2cfa6d4c8a0@qg3g2000pbc.googlegroups.com>


I want to retrieve 5000 messages/second from a single RabbitMQ server
and for each message assign a number and then push it into redis.

I want to use a single queue multiple consumer approach in the
rabbitmq client. Please let me know the way the proceed after this
point in Java.

ConnectionFactory factory = new ConnectionFactory();
        factory.setUsername(Constants.USERNAME);
        factory.setPassword(Constants.PASSWORD);
        factory.setVirtualHost(Constants.VIRTUALHOST);
        factory.setHost(Constants.HOSTNAME);
        factory.setPort(Constants.PORTNUMBER);


        ExecutorService es = Executors.newFixedThreadPool(20);
        Connection conn = factory.newConnection(es);

From james.r.carr at gmail.com  Fri Mar 30 12:59:51 2012
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 30 Mar 2012 06:59:51 -0500
Subject: [rabbitmq-discuss] Scheduled Message Delivery
In-Reply-To: <96423259-A1F7-4BF6-A702-07101CB94635@rabbitmq.com>
References: <CAJreXKAMLjOQhrqd_7UogFG-5ETaLnDFa5vKguiUC1qR0kS1QQ@mail.gmail.com>
	<96423259-A1F7-4BF6-A702-07101CB94635@rabbitmq.com>
Message-ID: <CAJreXKBV8hpfyUwNaEjSBMBio18v2Yuijte+V8a1Ock1D=9rOg@mail.gmail.com>

Yeah, my suspicion is the broker might be a consumer when the queue is
dead lettered. Because until I defined it as a dead letter queue it
disappeared as soon as my consumer went away.

Still pretty cool though. I like it. :)

Thanks,
James


On Fri, Mar 30, 2012 at 5:29 AM, Steve Powell <steve at rabbitmq.com> wrote:
> Fascinating James,
>
> I think the reason the queue stays around (even though you specify
> auto-delete) is because auto-delete on queues is designed to be
> triggered when the last consumer is cancelled. If there are never any
> consumers for the queue this event never occurs and the queue stays
> around. (If this wasn't the case, an auto-delete queue could disappear
> as soon as it was created!). It's all in the spec ?:-)
>
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>
> On 30 Mar 2012, at 07:42, James Carr wrote:
>
>> Hey All,
>>
>> I thought I'd share a neat "trick" I came up with lately to "schedule"
>> messages to be delivered at a specific duration. I had a lot of
>> polling going on in my application for things like scheduling
>> callbacks with leads and was getting sick of having to add even more
>> interval based polling each time a new feature came along.
>>
>> So here's an example of what I'm doing to schedule messages to be
>> delivered at a time in the future:
>> https://github.com/jamescarr/rabbitmq-scheduled-delivery. It makes
>> interesting use of x-message-ttl and x-dead-letter-exchange. :)
>>
>> Cheers,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From steve at rabbitmq.com  Fri Mar 30 13:56:27 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 13:56:27 +0100
Subject: [rabbitmq-discuss] fanout queue not working
In-Reply-To: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>
References: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>
Message-ID: <33E93FF3-77D3-4F7D-83FD-5AC3B03DF121@rabbitmq.com>

Dear octo,

Trying to understand what queues and bindings you may have created I
reformatted the list_bindings output you sent:

Listing bindings ...
        exchange    log2_consumer       queue   log2_consumer       []
        exchange    rawlogs_consumer    queue   rawlogs_consumer        []
rawlogs exchange    log2_consumer       queue           []
rawlogs exchange    rawlogs_consumer    queue   logstash        []
...done.

The first column is the exchange name, followed by 'exchange', then the
destination (queue) name, followed by 'queue' then the routing key, and
lastly any arguments on the binding (you have none []).

So what appears is that you have

* bound log2_consumer to the default (blank) exchange (with the routing
  key set to the name of the queue -- which is normal for a direct
  exchange, which the default exchange is);

* bound rawlogs_consumer similarly;

These two are default bindings created whenever you create a queue.

Then again you have two (explicit) bindings which you have no-doubt
created yourself:

* bound log2_consumer to the rawlogs exchange, with a blank ("") routing
  key

* bound rawlogs_consumer to the rawlogs exchange with the logstash key.

If rawlogs is a fanout exchange then if you publish a message to that
exchange, both of these queues should get a copy of the message
(regardless of what routing key you supply on the publish -- and
regardless of the routing key used to bind the queue to the fanout
exchange).

So, the obvious question is 'how did you publish those messages'?
Supplementary: 'what do you mean "connect fine" to the queue'?

I can guess that if you publish to the default exchange ("") with
routing key "rawlogs_consumer" you would see what you say you see, but I
can't think how else you might see it. Certainly, if you publish to the
"rawlogs" exchange I would expect the message to appear on both queues.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 01:26, octomeow wrote:

> newbie to rabbitmq  and I'm not getting messages into a certain queue
> 
> I have a simple fanout exchange
> # rabbitmqctl list_exchanges
> rawlogs fanout
> 
> I have bound this exchange to a few queues
> # rabbitmqctl list_bindings
> Listing bindings ...
>        exchange        log2_consumer       queue
> log2_consumer       []
>        exchange        rawlogs_consumer        queue
> rawlogs_consumer        []
> rawlogs exchange        log2_consumer       queue           []
> rawlogs exchange        rawlogs_consumer        queue
> logstash        []
> ...done.
> 
> I connect fine to the log2_consumer queue....however, I get NO
> messages.
> 
> my other queue..... the rawlogs_consumer does the the messges
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Fri Mar 30 14:09:32 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 14:09:32 +0100
Subject: [rabbitmq-discuss] Rabbitmq - retrieving messages concurrently
In-Reply-To: <f2cd0a95-3486-4c1c-829d-c2cfa6d4c8a0@qg3g2000pbc.googlegroups.com>
References: <f2cd0a95-3486-4c1c-829d-c2cfa6d4c8a0@qg3g2000pbc.googlegroups.com>
Message-ID: <CF5E0AF0-A5B8-464F-A307-F8D1733CE2AE@rabbitmq.com>

Hi,

The critical point to realise is that to get multiple consumers running
concurrently in the same Java Client, you need to use multiple channels.

Your code so far has 20 threads (potentially) able to process concurrent
consumers; if you want 20 consumers to be concurrently receiving
messages from the same queue then create 20 channels on that connection
and put one consumer on each channel.

The consumers need not be instantiated each time (unless they have
private state), and the consumer calls (handleDelivery() for example)
get passed the consumerTag used when attaching the consumer (with
basicConsume()) as a parameter, so the code can, in principle service
many of the consumer callbacks. Be aware that if you set it up sharing
the Consumer objects in this way, the code you write must be
thread-safe.

As for assigning a number to each message this is going to be a little
tricky. However, using a shared AtomicInteger will permit you to
generate an increment a number in the handleDelivery callbacks, without
the possibility of accidentally using the same number. What you do with
that number is then up to you.

You have correctly created an ExecutorService to increase the number of
threads from the default (5). In this case you should ensure that the
ExecutorSercvice is shutdown after the connection is closed, or else you
might find that there are daemon threads left in the JVM that might
prevent an orderly shutdown.

I hope this helps you. The details are, of course, very application
specific.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 12:51, Santhoshsd wrote:

> 
> I want to retrieve 5000 messages/second from a single RabbitMQ server
> and for each message assign a number and then push it into redis.
> 
> I want to use a single queue multiple consumer approach in the
> rabbitmq client. Please let me know the way the proceed after this
> point in Java.
> 
> ConnectionFactory factory = new ConnectionFactory();
>        factory.setUsername(Constants.USERNAME);
>        factory.setPassword(Constants.PASSWORD);
>        factory.setVirtualHost(Constants.VIRTUALHOST);
>        factory.setHost(Constants.HOSTNAME);
>        factory.setPort(Constants.PORTNUMBER);
> 
> 
>        ExecutorService es = Executors.newFixedThreadPool(20);
>        Connection conn = factory.newConnection(es);
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Fri Mar 30 14:27:15 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Mar 2012 14:27:15 +0100
Subject: [rabbitmq-discuss] |Spam| question about rabbitmq TPS
In-Reply-To: <79f5636d.ec79.1365f77e4e3.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
	<CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>
	<24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>
	<CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>
	<79f5636d.ec79.1365f77e4e3.Coremail.chen-hongqin@163.com>
Message-ID: <CACOPnvemYH6zcRuYeFTqDRuF9OMMCMDL93TStVPPN8Drbhh8+w@mail.gmail.com>

So, what do you think is happening, given that spikes also occur when
persistence is off?


2012/3/29 ??? <chen-hongqin at 163.com>

> figure 1
>  figure 2
>
>  figure 3
>
> Hi, I create 15 queues in the first case, and create 300 queues in the
> second case. Each message is acknowledged before sending the next one.
> Figure 3 illustrates the detail of figure2 when i remove the several top
> points.
>
>
>
> ? 2012-03-29 22:53:39?"Alexis Richardson" <alexis at rabbitmq.com> ???
>
> try it without persistence and see what graphs you get..?
>
>
> 2012/3/29 ??? <chen-hongqin at 163.com>
>
>> yes, all the messages are persistent
>>
>>
>> ? 2012-03-29 21:17:04?"Alexis Richardson" <alexis at rabbitmq.com> ???
>>
>> are you using persistent messages?
>>
>>
>> 2012/3/29 ??? <chen-hongqin at 163.com>
>>
>>>  This is about my master paper which is related with availability, and
>>> I use rabbitmq as the middle-ware component. So I am trying to find how can
>>> cause this problem. And my current answer I guess is that it is caused by
>>> the OS cache. Cache hit ratio is high at the very start and becomes lower
>>> because of the page replacement after more and more requests come. And the
>>> other reason maybe is messages are orderly sufficiently for the disk to
>>> write at start. But i am not sure if the rabbitmq has do some optimals for
>>> that?
>>>  At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
>>>
>>> Hi,
>>>
>>> There are lots of possible reasons for this, including that "measuring
>>> anything accurately is hard".
>>>
>>> What problem are you trying to solve?
>>>
>>> alexis
>>>
>>>
>>> 2012/3/26 ??? <chen-hongqin at 163.com>
>>>
>>>>   hi,
>>>> can you tell me why TPS is too high at first and sometimes maybe even
>>>> more higher(maybe over 30000/s) when I send messages to rabbitmq cluster
>>>> concurrently? thanks!
>>>>
>>>>
>>>>
>>>> Some infos about this test:
>>>> 1. all the messages are same and each message size is 1kb.
>>>>  2. 300 queues created by multiple Producers at start and messages
>>>> sent to the queues are random
>>>> 3. All messages are persistent and queues are all durable
>>>> 4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the
>>>> same host but different ports
>>>> the host info:
>>>>
>>>> JAVA version****
>>>>
>>>> Java version "1.6.0_12" Java(TM) SE Runtime Environment (build
>>>> 1.6.0_12-b04)****
>>>>
>>>> JAVA VM
>>>>
>>>> Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)****
>>>>
>>>> CPU****
>>>>
>>>> Intel(R) Xeon(R) CPU E5504 @2.00GHz****
>>>>
>>>> number of cores
>>>>
>>>> 8
>>>>
>>>> memory****
>>>>
>>>> 33011192kb****
>>>>
>>>> Erlang VM
>>>>
>>>> Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0]
>>>> [hipe] [kernel-poll:false]****
>>>>
>>>> RabbitMQ version
>>>>
>>>> Release 2.7.1****
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>>
>>>
>>
>>
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/70140273/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/70140273/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 32359 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/70140273/attachment.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 34912 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/70140273/attachment-0001.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 37945 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/70140273/attachment-0002.jpeg>

From steve at rabbitmq.com  Fri Mar 30 14:28:00 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Mar 2012 14:28:00 +0100
Subject: [rabbitmq-discuss] Scheduled Message Delivery
In-Reply-To: <CAJreXKBV8hpfyUwNaEjSBMBio18v2Yuijte+V8a1Ock1D=9rOg@mail.gmail.com>
References: <CAJreXKAMLjOQhrqd_7UogFG-5ETaLnDFa5vKguiUC1qR0kS1QQ@mail.gmail.com>
	<96423259-A1F7-4BF6-A702-07101CB94635@rabbitmq.com>
	<CAJreXKBV8hpfyUwNaEjSBMBio18v2Yuijte+V8a1Ock1D=9rOg@mail.gmail.com>
Message-ID: <AD65495C-D45A-47BA-BCF3-061B47EABB7F@rabbitmq.com>

James, 

There is no such thing as a dead-letter queue. Just dead-letter
exchanges.

You never attached any consumers to the 'send.later' queue which has the
delayed messages, and the broker certainly doesn't attach any, so an
auto-delete event will never get triggered for that queue.

The act of transferring the messages from 'send.later' to the 'real' one
when the messages expire doesn't use consumers, and the broker is not
"maintaining a connection" to it.  The x-expires argument on the queue
is the right solution, but for the wrong reason; the auto-delete option
is not necessary.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 12:59, James Carr wrote:

> Yeah, my suspicion is the broker might be a consumer when the queue is
> dead lettered. Because until I defined it as a dead letter queue it
> disappeared as soon as my consumer went away.
> 
> Still pretty cool though. I like it. :)
> 
> Thanks,
> James
> 
> 
> On Fri, Mar 30, 2012 at 5:29 AM, Steve Powell <steve at rabbitmq.com> wrote:
>> Fascinating James,
>> 
>> I think the reason the queue stays around (even though you specify
>> auto-delete) is because auto-delete on queues is designed to be
>> triggered when the last consumer is cancelled. If there are never any
>> consumers for the queue this event never occurs and the queue stays
>> around. (If this wasn't the case, an auto-delete queue could disappear
>> as soon as it was created!). It's all in the spec  :-)
>> 
>> Steve Powell
>> steve at rabbitmq.com
>> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>> 
>> On 30 Mar 2012, at 07:42, James Carr wrote:
>> 
>>> Hey All,
>>> 
>>> I thought I'd share a neat "trick" I came up with lately to "schedule"
>>> messages to be delivered at a specific duration. I had a lot of
>>> polling going on in my application for things like scheduling
>>> callbacks with leads and was getting sick of having to add even more
>>> interval based polling each time a new feature came along.
>>> 
>>> So here's an example of what I'm doing to schedule messages to be
>>> delivered at a time in the future:
>>> https://github.com/jamescarr/rabbitmq-scheduled-delivery. It makes
>>> interesting use of x-message-ttl and x-dead-letter-exchange. :)
>>> 
>>> Cheers,
>>> James
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From denis.melique at morpho.com  Fri Mar 30 15:50:03 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Fri, 30 Mar 2012 16:50:03 +0200
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <4F7334D7.6030709@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
	<4F7334D7.6030709@rabbitmq.com>
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F66A0C7D19B@Y000IIIV01.rd1.rf1>

Hi 

To investigate this I set a small client in Python (spy.py) which subscribed the same exchange as my application, and 
traces some information from messages properties (code attached).
Before starting my test I run one spy.py on each end.
At the end of test I compare both information, to see if
there is a difference in the message_id sequences, or if messages have been redelivered.

I did a test first with the local broker clustered (as before):
- then I have a different sequence in messages
- but there is no redelivered messages 

Then I suspected that my problem could be in relation with the cluster configuration (why not), 
So I reconfigured the local end with a single node (no more cluster), leaving the remote end clustered.
- then I could not reproduce the difference in message_id sequences


May be I did something wrong when configuring Shovel with my local cluster ?
What I did is : 
- set a two node cluster on local end
- Have the Shovel plug-In configured on both nodes
  Each node has its one Shovel setting, with similar parameters except "sources [broker..]" and "destinations [broker...]", 
  That are specific to the node. 
  On each node I have defined one source broker and one destination broker.
  
- set a two node cluster on remote end, without Shovel setting.

I am wondering if this is correct with clusters ?

However, everything is working fine, when the WAN network is good enough.

Any Idea ?

Thank's a lot.

Denis

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, March 28, 2012 5:57 PM
To: MELIQUE Denis (MORPHO)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Testing Shovel on a WAN

On 28/03/12 14:47, MELIQUE Denis (MORPHO) wrote:
> When I slow the WAN to 1 Mbit/s, I see messages accumulating in the
> shovel queue, which is what as expected.
>
> Then once my throughput go to zero, messages are slowly transferred to
> the distant cluster, and that?s OK as well.
>
> The problem is that messages are not processed in the same order on the
> distant cluster than on the local.
>
> My feeling is that with 1 Mbit/s some messages fail to be transferred
> correctly, and are re-sent later.
>
> ( I have the same problem when I simulate a very high level of packet
> loss (30%), with a 10Mbit/s speed)
>
> Is there such a logic in Shovel ?

That seems unlikely. Packet loss should lead to redelivery at the TCP 
level, which the shovel should be unaware of.

Messages should only get redelivered if the consumer rejects them or the 
TCP connection is interrupted completely. Shovel won't reject messages, 
but maybe the connection is being interrupted and re-established? You 
should be able to see this in the logs. You would also see a 
"redelivered" message rate in mgmt.

> Is there a way to configured Shovel to guaranty the sequence of messages ?

This should already be happening.

> Second:
>
> ---------
>
> When a simulate a WAN outage lasting 2 hours, messages staying in the
> shovel queue have a status,
>
> first set to ?unacknowledged?.
>
> Then, after about 900 sec, they all have their status changed to ?ready?.
>
> When the network recovers, all the pending messages change back to
> ?unacknowledged?, before being sent
>
> to the distant cluster.
>
> It does not seems to be a problem for us, just I?d like to understand
> this behavior, and if it could impact rabbit performances.

unacknowledged -> the message has been consumed by the remote end, but 
not acknowledged.

After 900 seconds presumably the connection is determined to be dead by 
RabbitMQ and then the messages go back into the queue ("ready").

Then when the network recovers, they are sent again and become 
"unacknowledged" again, until the acks come in.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
A non-text attachment was scrubbed...
Name: spy.py
Type: application/octet-stream
Size: 6425 bytes
Desc: spy.py
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/e040b8e6/attachment.obj>

From simon at rabbitmq.com  Fri Mar 30 16:13:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Mar 2012 16:13:14 +0100
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F66A0C7D19B@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
	<4F7334D7.6030709@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F66A0C7D19B@Y000IIIV01.rd1.rf1>
Message-ID: <4F75CD8A.2020207@rabbitmq.com>

On 30/03/12 15:50, MELIQUE Denis (MORPHO) wrote:
> - set a two node cluster on local end
> - Have the Shovel plug-In configured on both nodes
>    Each node has its one Shovel setting, with similar parameters except "sources [broker..]" and "destinations [broker...]",
>    That are specific to the node.

Ah, right.

So the shovel does not handle clusters specially at all; if you 
configure the shovel on two cluster nodes you will get two shovels 
running in parallel. Each message will go through one shovel or the 
other, but the order will get mixed up.

Federation is different; in a cluster each federation link will only 
exist once. I wonder if the shovel should be more like federation in 
this regard...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matwey.kornilov at gmail.com  Fri Mar 30 16:20:40 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Fri, 30 Mar 2012 19:20:40 +0400
Subject: [rabbitmq-discuss] pub/sub and disconnections handling
Message-ID: <jl4j09$4u4$1@dough.gmane.org>


Hi,


I can't understand some amqp concepts because they are new to me. If I use 
pub/sub pattern (just as described in tutorial), there is exchange and 
consumers' queues bound with it. Do I understand right that there is no way 
for consumers to know whether there is client who writes to this exchange? 
Moreover, there is no way to know if the publisher is dead or just there is 
nothing to publish?

What is the right way to implement subscribers' behaviour such that they 
move to some 'autonomous' state in case of publisher death or disconnection? 


From chen-hongqin at 163.com  Fri Mar 30 18:45:55 2012
From: chen-hongqin at 163.com (=?GBK?B?s8K66MfV?=)
Date: Sat, 31 Mar 2012 01:45:55 +0800 (CST)
Subject: [rabbitmq-discuss] |Spam| Re:Re: Re: Re: Re: |Spam| question
	about	rabbitmq TPS
In-Reply-To: <CACOPnvemYH6zcRuYeFTqDRuF9OMMCMDL93TStVPPN8Drbhh8+w@mail.gmail.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>
	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>
	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>
	<CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>
	<24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>
	<CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>
	<79f5636d.ec79.1365f77e4e3.Coremail.chen-hongqin@163.com>
	<CACOPnvemYH6zcRuYeFTqDRuF9OMMCMDL93TStVPPN8Drbhh8+w@mail.gmail.com>
Message-ID: <4d3eb23c.27a.13664b6ae4a.Coremail.chen-hongqin@163.com>


I have no ideas, but it happens when the number of queues is large(for example, 300 queues)


? 2012-03-30 21:27:15?"Alexis Richardson" <alexis at rabbitmq.com> ???
So, what do you think is happening, given that spikes also occur when persistence is off?



2012/3/29 ??? <chen-hongqin at 163.com>

figure 1
figure 2


figure 3
 
Hi, I create 15 queues in the first case, and create 300 queues in the second case. Each message is acknowledged before sending the next one. Figure 3 illustrates the detail of figure2 when i remove the several top points.
 

 
? 2012-03-29 22:53:39?"Alexis Richardson" <alexis at rabbitmq.com> ???

try it without persistence and see what graphs you get..?




2012/3/29 ??? <chen-hongqin at 163.com>

yes, all the messages are persistent



? 2012-03-29 21:17:04?"Alexis Richardson" <alexis at rabbitmq.com> ???

are you using persistent messages?



2012/3/29 ??? <chen-hongqin at 163.com>

This is about my master paper which is related with availability, and I use rabbitmq as the middle-ware component. So I am trying to find how can cause this problem. And my current answer I guess is that it is caused by the OS cache. Cache hit ratio is high at the very start and becomes lower because of the page replacement after more and more requests come. And the other reason maybe is messages are orderly sufficiently for the disk to write at start. But i am not sure if the rabbitmq has do some optimals for that?

At 2012-03-29 18:23:33,"Alexis Richardson" <alexis at rabbitmq.com> wrote:
Hi,


There are lots of possible reasons for this, including that "measuring anything accurately is hard".  


What problem are you trying to solve?


alexis



2012/3/26 ??? <chen-hongqin at 163.com>

hi, 
can you tell me why TPS is too high at first and sometimes maybe even more higher(maybe over 30000/s) when I send messages to rabbitmq cluster concurrently? thanks!
 
 
 
Some infos about this test:
1. all the messages are same and each message size is 1kb.
2. 300 queues created by multiple Producers at start and messages sent to the queues are random 
3. All messages are persistent and queues are all durable
4. 3 nodes consists of a rabbitmq cluster and all the nodes are in the same host but different ports
the host info:
|

JAVA version

|

Java version "1.6.0_12" Java(TM) SE Runtime Environment (build 1.6.0_12-b04)

|
|

JAVA VM

|

Java HotSpot(TM) 64-Bit Server VM (build 11.2-b01, mixed mode)

|
|

CPU

|

Intel(R) Xeon(R) CPU E5504 @2.00GHz

|
|

number of cores

|

8

|
|

memory

|

33011192kb

|
|

Erlang VM

|

Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false]

|
|

RabbitMQ version

|

Release 2.7.1

|


 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

















-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/973b7a24/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 15.jpg
Type: image/jpeg
Size: 34912 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/973b7a24/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 300.jpg
Type: image/jpeg
Size: 32359 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/973b7a24/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: detail300.jpg
Type: image/jpeg
Size: 37945 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/973b7a24/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2012-03-26_00-02-28.png
Type: image/png
Size: 24610 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/973b7a24/attachment.png>

From tonygarnockjones+rabbitmq at gmail.com  Fri Mar 30 18:56:39 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 30 Mar 2012 13:56:39 -0400
Subject: [rabbitmq-discuss] pub/sub and disconnections handling
In-Reply-To: <jl4j09$4u4$1@dough.gmane.org>
References: <jl4j09$4u4$1@dough.gmane.org>
Message-ID: <CAM8fPiQ224jDaQAsdVtptk2SRYzB-Bmie20kx4jew8Q1dKF+kQ@mail.gmail.com>

Hi Matwey,

That's right. Publishers can sometimes learn about subscribers being
missing (see the "immediate" and "mandatory" flags to Basic.Publish), but
subscribers can in general not learn whether any matching publisher exists
at any given time.

One workaround might be to use something like my experimental
presence-exchange:

   - https://github.com/tonyg/presence-exchange
   -
   https://groups.google.com/forum/#!msg/rabbitmq-discuss/8BNgJ794840/VuNx-QiquKQJ

Cheers,
  Tony



On 30 March 2012 11:20, Matwey V. Kornilov <matwey.kornilov at gmail.com>wrote:

>
> Hi,
>
>
> I can't understand some amqp concepts because they are new to me. If I use
> pub/sub pattern (just as described in tutorial), there is exchange and
> consumers' queues bound with it. Do I understand right that there is no way
> for consumers to know whether there is client who writes to this exchange?
> Moreover, there is no way to know if the publisher is dead or just there is
> nothing to publish?
>
> What is the right way to implement subscribers' behaviour such that they
> move to some 'autonomous' state in case of publisher death or
> disconnection?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120330/61810a40/attachment.htm>

From brendan at soundcloud.com  Sat Mar 31 13:27:10 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sat, 31 Mar 2012 14:27:10 +0200
Subject: [rabbitmq-discuss] Firehose Tracer
Message-ID: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>

Yo,

I'm currently investigating the feasibility of storing/journaling a stream
of events that is delivered via rabbit. The firehose tracer would be ideal
for this, but it has a big fat disclaimer about performance implications.

I'm aware of projects like the riak-exchange, but ideally I want to apply
the same logic (journalling) to every single message passing through
rabbit, without having to make clients aware-of/declare yet another
exchange type. Transparency is king.

Would there be any other avenues (custom exchanges etc.) worth
investigating, or potential improvements that could be made to the firehose
feature itself?


Cheers,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/f29b188e/attachment.htm>

From matwey.kornilov at gmail.com  Sat Mar 31 15:35:48 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Sat, 31 Mar 2012 18:35:48 +0400
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
Message-ID: <jl74o6$o37$1@dough.gmane.org>


Hi,

When I try to build RabbitMQ from sources (rabbitmq-server-2.8.1.tar.gz) 
placed in directory which name contains a colon, common.mk fails with:

common.mk:87: *** target pattern contains no `%'.  Stop.


It seems that variable names at lines 87:89 should be escaped in some way.


p.s. I've not found a way how to report a bug. bugzilla.rabbitmq.com works 
strangely for me. There aren't any products to fill a new report.



From matwey.kornilov at gmail.com  Sat Mar 31 18:37:15 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Sat, 31 Mar 2012 21:37:15 +0400
Subject: [rabbitmq-discuss] erlang-rfc4627-wrapper and httpd.hrl
Message-ID: <jl7fcc$1oa$1@dough.gmane.org>


Hi,

rfc4627_jsonrpc_inets.erl includes httpd.hrl in a smart manner. At the same 
time (at least in my R15 erlang) src/http_server/httpd.hrl does only one 
thing:

-ifndef(src_httpd_hrl).
-define(src_httpd_hrl, true).

-include_lib("inets/include/httpd.hrl").

-endif. % -ifdef(src_httpd_hrl).


To include inets/include/httpd.hrl instead of inets/src/httpd.hrl would 
simplify building from source and remove build-dependence on packages like 
erlang-src.



From tonygarnockjones+rabbitmq at gmail.com  Sat Mar 31 21:41:01 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 31 Mar 2012 16:41:01 -0400
Subject: [rabbitmq-discuss] erlang-rfc4627-wrapper and httpd.hrl
In-Reply-To: <jl7fcc$1oa$1@dough.gmane.org>
References: <jl7fcc$1oa$1@dough.gmane.org>
Message-ID: <CAM8fPiRj75C-7iB5B_Pnc-uMrMHDu2cWxTO1XS074E7Y8A2rFQ@mail.gmail.com>

Thanks for the report! I've updated the "smart" logic in the makefile; see
https://github.com/tonyg/erlang-rfc4627/commit/0ad522600c1354a8f811906d23748ea2ed3c5c67.
I am guessing that Simon (presumably) will now need to update the RabbitMQ
wrapper for the library.

I actually downloaded the OTP git repo from github, and used (for the first
time) git bisect to discover exactly when various paths to httpd.hrl came
and went :-) so I learned something from the experience...

I've lightly tested the change. I'm downloading R12B-5 now to see if it
still compiles on that version.

If you try it, please let me know how it goes. Thanks!

Regards,
  Tony

On 31 March 2012 13:37, Matwey V. Kornilov <matwey.kornilov at gmail.com>wrote:

>
> Hi,
>
> rfc4627_jsonrpc_inets.erl includes httpd.hrl in a smart manner. At the same
> time (at least in my R15 erlang) src/http_server/httpd.hrl does only one
> thing:
>
> -ifndef(src_httpd_hrl).
> -define(src_httpd_hrl, true).
>
> -include_lib("inets/include/httpd.hrl").
>
> -endif. % -ifdef(src_httpd_hrl).
>
>
> To include inets/include/httpd.hrl instead of inets/src/httpd.hrl would
> simplify building from source and remove build-dependence on packages like
> erlang-src.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/42860e6b/attachment.htm>

From octomeow at gmail.com  Fri Mar 30 17:07:44 2012
From: octomeow at gmail.com (octomeow)
Date: Fri, 30 Mar 2012 09:07:44 -0700 (PDT)
Subject: [rabbitmq-discuss] fanout queue not working
In-Reply-To: <33E93FF3-77D3-4F7D-83FD-5AC3B03DF121@rabbitmq.com>
References: <bbc4c61e-ff9a-4285-b678-7b07f8fe29f7@9g2000pbn.googlegroups.com>
	<33E93FF3-77D3-4F7D-83FD-5AC3B03DF121@rabbitmq.com>
Message-ID: <a894cdf0-ac21-4e53-95ea-c10f65c4c06d@lf20g2000pbb.googlegroups.com>

Hi everyone

thanks for the comments. it pointed me in the right direction
the logstash code I was using did use a routing key so even though
it's a
fanout exchange, only one queue rawlogs_consumer would get it.

Julie

On Mar 30, 5:56?am, Steve Powell <st... at rabbitmq.com> wrote:
> Dear octo,
>
> Trying to understand what queues and bindings you may have created I
> reformatted the list_bindings output you sent:
>
> Listing bindings ...
> ? ? ? ?exchange? ?log2_consumer ? ? ? queue ? log2_consumer ? ? ? []
> ? ? ? ?exchange? ?rawlogs_consumer ? ?queue ? rawlogs_consumer ? ? ? ?[]
> rawlogsexchange? ?log2_consumer ? ? ? queue ? ? ? ? ? []
> rawlogsexchange? ?rawlogs_consumer ? ?queue ? logstash ? ? ? ?[]
> ...done.
>
> The first column is theexchangename, followed by 'exchange', then the
> destination (queue) name, followed by 'queue' then the routing key, and
> lastly any arguments on the binding (you have none []).
>
> So what appears is that you have
>
> * bound log2_consumer to the default (blank)exchange(with the routing
> ? key set to the name of the queue -- which is normal for a direct
> ?exchange, which the defaultexchangeis);
>
> * bound rawlogs_consumer similarly;
>
> These two are default bindings created whenever you create a queue.
>
> Then again you have two (explicit) bindings which you have no-doubt
> created yourself:
>
> * bound log2_consumer to the rawlogsexchange, with a blank ("") routing
> ? key
>
> * bound rawlogs_consumer to the rawlogsexchangewith the logstash key.
>
> If rawlogs is afanoutexchangethen if you publish a message to thatexchange, both of these queues should get a copy of the message
> (regardless of what routing key you supply on the publish -- and
> regardless of the routing key used to bind the queue to thefanoutexchange).
>
> So, the obvious question is 'how did you publish those messages'?
> Supplementary: 'what do you mean "connect fine" to the queue'?
>
> I can guess that if you publish to the defaultexchange("") with
> routing key "rawlogs_consumer" you would see what you say you see, but I
> can't think how else you might see it. Certainly, if you publish to the
> "rawlogs"exchangeI would expect the message to appear on both queues.
>
> Steve Powell
> st... at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>
> On 30 Mar 2012, at 01:26, octomeow wrote:
>
>
>
>
>
> > newbie to rabbitmq ?and I'm not getting messages into a certain queue
>
> > I have a simplefanoutexchange
> > # rabbitmqctl list_exchanges
> > rawlogsfanout
>
> > I have bound thisexchangeto a few queues
> > # rabbitmqctl list_bindings
> > Listing bindings ...
> > ? ? ? ?exchange? ? ? ?log2_consumer ? ? ? queue
> > log2_consumer ? ? ? []
> > ? ? ? ?exchange? ? ? ?rawlogs_consumer ? ? ? ?queue
> > rawlogs_consumer ? ? ? ?[]
> > rawlogsexchange? ? ? ?log2_consumer ? ? ? queue ? ? ? ? ? []
> > rawlogsexchange? ? ? ?rawlogs_consumer ? ? ? ?queue
> > logstash ? ? ? ?[]
> > ...done.
>
> > I connect fine to the log2_consumer queue....however, I get NO
> > messages.
>
> > my other queue..... the rawlogs_consumer does the the messges
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From zhisun.tech at gmail.com  Sat Mar 31 10:31:43 2012
From: zhisun.tech at gmail.com (zhi sun)
Date: Sat, 31 Mar 2012 17:31:43 +0800
Subject: [rabbitmq-discuss] have problem to follow client deployment steps
	in erlang client doc
Message-ID: <CACSB5m546Gw2+S6fKihggzCY6shwJgxYRdbG+zAijA=ntbtn5A@mail.gmail.com>

Hi All,

I am newbie to rabbitmq erlang client.

when I follow the client deployment steps described as below, I found the
steps are aged, and didn't work.
http://www.rabbitmq.com/erlang-client-user-guide.html

I finally is able to compile the amqp_example.erl successfully (and output
is amqp_example.beam), but get the following error:

1> amqp_example:test().
** exception error: undefined function amqp_example:test/0

Any help would be appreciated!
-iamsyt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/5f28646c/attachment.htm>

