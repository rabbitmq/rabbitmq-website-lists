From clegnitto at mozilla.com  Wed Sep  1 00:12:52 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 31 Aug 2010 16:12:52 -0700
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <4C7D7432.2050505@rabbitmq.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<4C7D7432.2050505@rabbitmq.com>
Message-ID: <E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>

Comments inline.

On Aug 31, 2010, at 2:29 PM, Matthias Radestock wrote:

> Christian,
> 
> Christian Legnitto wrote:
>> My main issue is I intend to have hundreds of queues with 100k+ messages that may or may not be processed in a timely manner. Memory is ok with the new persister (yay!), but the disk fills up quickly. Right now with only 1 consumer, if I don't ack messages coming from bugzilla for 2 days I use up 20GB of disk. I can of course throw hardware at the problem, but it seems I'd reach a point where it merely wouldn't scale.
> 
> Thanks for explaining the problem you are trying to solve.

No problem, I know my use-case isn't the common case, but I think it is fairly common as far as message brokers at large orgs go.

> 
> Note that in RabbitMQ messages are shared between queues, i.e. if the same message ends up in multiple queues we have at most one copy in memory and at most one copy on disk.
> 
> So you may find RabbitMQ scales better here than you expected.

That's good to know, though I imagine there will be scaling issues when I expand to different sorts of high-volume messages. Plus, at 20 GB every couple of days (before instituting all message types) I will likely need to find some sort of long-term solution.

> 
>> I don't think it is unreasonable to tell consumers that all messages
>> up to a point will be persisted, but once a threshold is reached only
>> x amount of messages will persist. I see other brokers support such a
>> thing, though it sounds like RabbitMQ likely does not.
> 
> We did introduce queue leases in the 2.0.0 release, which allows the server to remove entire queues when they haven't been used for a while. That may not be the best fit for your use case, but it's certainly a feature aimed at addressing similar problems.

Yep, it might work though would be less-than ideal. I'll look into it, though I would hate to clear a queue with 10 messages sitting in it because the consumer was down for a month or so.

> Another feature we have in our plans is per-queue message TTLs, i.e. messages will get removed from queues if they are older than a specified threshold. It sounds like that would fit your use case nicely, and arguably better than a count-based limit. Though the latter too is something we may support one day.

Again, I'm not sure this really covers my case. For my use case I only care about the timeliness of the message as long as I am resource constrained. If I have ample resources I'd be willing to have the messages sit there for months.

Thanks for the prompt reply and I'll look into the queue leases.

Christian

From jon at jbrisbin.com  Wed Sep  1 02:16:44 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 31 Aug 2010 20:16:44 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7D7B15.6060106@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
	<4C7D7B15.6060106@rabbitmq.com>
Message-ID: <10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>


On Aug 31, 2010, at 4:58 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>> I actually updated the Makefile with the "-u rabbitmq_v2_0_0" so they
>> would all be of the right tag.
> 
> Well, if you have the right source code then it must be picking up an old version of the server beams from somewhere. If a clean build (as suggested by Matthew) doesn't fix it then go hunting for stray .beam and .ez files.
> 

I'll do a fresh checkout again in the morning and try again.

>>> Also, why are you building from source anyway? Can't you simply use
>>> the stock 2.0.0 server and associated binary plugins?
>> I didn't see a link to the Erlang client (only) on the download page.
>> Did I miss it?
>> I would prefer to use a binary I didn't build myself but I need
>> something I can put in my project deps directory (I'm using rebar) to
>> compile against. This is a standalone OTP app.
> 
> Ah ok. No, there isn't a .ez for the standalone Erlang client, only the embedded version. The latter is on our todo list.
> 


Can I just put the .ez that make builds into deps/ and have it picked up by rebar? I was under the impression I had to have the source but that seems like overkill to me.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/03559aa4/attachment.htm>

From masoper at gmail.com  Wed Sep  1 02:17:31 2010
From: masoper at gmail.com (Mark Soper)
Date: Tue, 31 Aug 2010 21:17:31 -0400
Subject: [rabbitmq-discuss] First-time rabbitmq install crashed after a week
	& now node won't restart
Message-ID: <AANLkTimFDOe8sSaQA95Dq6G0OZrxz4Kvm7xSaoLhXpCk@mail.gmail.com>

Just getting started with rabbitmq, hoping for advice on how to troubleshoot
this:

Last week I started using celery with rabbitmq on EC2 Ubuntu server.
It ran fine for a week, then died.

> sudo rabbitmqctl status

Status of node 'rabbit at domU-12-31-39-05-6E-52' ...
Error: unable to connect to node 'rabbit at domU-12-31-39-05-6E-52': nodedown
diagnostics:
- nodes and their ports on domU-12-31-39-05-6E-52:
[{rabbitmqctl11365,50319}]
- current node: 'rabbitmqctl11365 at domU-12-31-39-05-6E-52'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: nF0wVuFwDDUCqBIAugLXcw==


> sudo rabbitmq-server

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.7.2  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at domU-12-31-39-05-6E-52
app descriptor:
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : nF0wVuFwDDUCqBIAugLXcw==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting internal event notification system
...done
starting logging server
...done
starting database
...done
-- kernel ready
starting alarm handler
 ...done
starting queue supervisor
...done
starting node monitor
...done
starting cluster router
...done
-- core initialized
starting empty DB check
...done
starting codec correctness check
 ...done
starting exchange recovery
 ...done
starting queue recovery
...done
starting persister
 ...done
starting guid generator
...done
-- message delivery logic ready
starting error log relay
 ...done
starting networking
...BOOT ERROR: FAILED
Reason: {{badmatch,
             {error,
                 {shutdown,

{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
                         {tcp_listener_sup,start_link,
                             [{0,0,0,0},
                              5672,
                              [binary,
                               {packet,raw},
                               {reuseaddr,true},
                               {exit_on_close,false}],
                              {rabbit_networking,tcp_listener_started,[]},
                              {rabbit_networking,tcp_listener_stopped,[]},
                              {rabbit_networking,start_client,[]},
                              "TCP Listener"]},
                         transient,infinity,supervisor,
                         [tcp_listener_sup]}}}},
         [{rabbit_networking,start_listener,4},
          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
          {rabbit_networking,boot_tcp,0},
          {rabbit_networking,boot,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2}]}
Erlang has closed
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/024560a3/attachment.htm>

From ian.ragsdale at gmail.com  Wed Sep  1 02:27:38 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Tue, 31 Aug 2010 21:27:38 -0400
Subject: [rabbitmq-discuss] First-time rabbitmq install crashed after a
	week & now node won't restart
In-Reply-To: <AANLkTimFDOe8sSaQA95Dq6G0OZrxz4Kvm7xSaoLhXpCk@mail.gmail.com>
References: <AANLkTimFDOe8sSaQA95Dq6G0OZrxz4Kvm7xSaoLhXpCk@mail.gmail.com>
Message-ID: <680557C5-BB04-4604-B0DA-60B279EB1EF3@gmail.com>

Did you happen to change your hostname?  That would cause rabbitmqctl to fail to connect to a running server that was started with a different hostname, and a running server would cause the second failure (because it couldn't listen on the correct port).

- Ian

On Aug 31, 2010, at 9:17 PM, Mark Soper <masoper at gmail.com> wrote:

> Just getting started with rabbitmq, hoping for advice on how to troubleshoot this:
> 
> Last week I started using celery with rabbitmq on EC2 Ubuntu server.
> It ran fine for a week, then died.  
> 
> > sudo rabbitmqctl status
> 
> Status of node 'rabbit at domU-12-31-39-05-6E-52' ...
> Error: unable to connect to node 'rabbit at domU-12-31-39-05-6E-52': nodedown
> diagnostics:
> - nodes and their ports on domU-12-31-39-05-6E-52: [{rabbitmqctl11365,50319}]
> - current node: 'rabbitmqctl11365 at domU-12-31-39-05-6E-52'
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: nF0wVuFwDDUCqBIAugLXcw==
> 
> 
> > sudo rabbitmq-server
> 
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.2  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> node          : rabbit at domU-12-31-39-05-6E-52
> app descriptor: /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
> home dir      : /var/lib/rabbitmq
> cookie hash   : nF0wVuFwDDUCqBIAugLXcw==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
> 
> starting internal event notification system                           ...done
> starting logging server                                               ...done
> starting database                                                     ...done
> -- kernel ready
> starting alarm handler                                                ...done
> starting queue supervisor                                             ...done
> starting node monitor                                                 ...done
> starting cluster router                                               ...done
> -- core initialized
> starting empty DB check                                               ...done
> starting codec correctness check                                      ...done
> starting exchange recovery                                            ...done
> starting queue recovery                                               ...done
> starting persister                                                    ...done
> starting guid generator                                               ...done
> -- message delivery logic ready
> starting error log relay                                              ...done
> starting networking                                                   ...BOOT ERROR: FAILED
> Reason: {{badmatch,
>              {error,
>                  {shutdown,
>                      {child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
>                          {tcp_listener_sup,start_link,
>                              [{0,0,0,0},
>                               5672,
>                               [binary,
>                                {packet,raw},
>                                {reuseaddr,true},
>                                {exit_on_close,false}],
>                               {rabbit_networking,tcp_listener_started,[]},
>                               {rabbit_networking,tcp_listener_stopped,[]},
>                               {rabbit_networking,start_client,[]},
>                               "TCP Listener"]},
>                          transient,infinity,supervisor,
>                          [tcp_listener_sup]}}}},
>          [{rabbit_networking,start_listener,4},
>           {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
>           {rabbit_networking,boot_tcp,0},
>           {rabbit_networking,boot,0},
>           {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>           {rabbit,run_boot_step,1},
>           {rabbit,'-start/2-lc$^0/1-0-',1},
>           {rabbit,start,2}]}
> Erlang has closed
> {"init terminating in do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100831/3f009940/attachment-0001.htm>

From matthias at rabbitmq.com  Wed Sep  1 04:22:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 04:22:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<4C7D7432.2050505@rabbitmq.com>
	<E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
Message-ID: <4C7DC70B.9000502@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> For my use case I only care about the timeliness of the message as
> long as I am resource constrained. If I have ample resources I'd be
> willing to have the messages sit there for months.

Interesting. That implies you don't actually want some fixed thresholds 
per queue but a means for rabbit to automatically evict some messages 
when disk space becomes tight. Though some per-queue controls are 
perhaps desirable for this as well, so that rabbit can be guided as to 
*which* messages to evict.

Say you have a whole bunch of queues with varying amounts of data, 
message ages, and throughput. And now rabbit notices that it is about to 
run out of disk space. How should rabbit go about deciding which 
messages to evict?

Your thoughts on this are much appreciated.

Regard,

Matthias.

From matthias at rabbitmq.com  Wed Sep  1 04:22:48 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 04:22:48 +0100
Subject: [rabbitmq-discuss] Fwd:  RabbitMQ and queue message limits?
In-Reply-To: <20100831225943.GA15761@rabbitmq.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>	<4C7D6AFC.6060805@rabbitmq.com>	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>	<4C7D7432.2050505@rabbitmq.com>	<AANLkTi=n8eSLNAZbTsksbL=gLvBJP3LuSE0EoCtDnwvG@mail.gmail.com>
	<20100831225943.GA15761@rabbitmq.com>
Message-ID: <4C7DC708.3070705@rabbitmq.com>

Matthew Sackman wrote:
> On Tue, Aug 31, 2010 at 06:54:01PM -0400, Jim Irrer wrote:
>> Our group has wanted this sort of functionality also.  The problem we want
>> to solve
>> is pretty much the same:  If a queue comes to contain more than X entries,
>> then it
>> means that there is a problem with the consumer(s), and we would like to be
>> notified.
> 
> That smells to me slightly like using the wrong tool for the job - is
> there not some other monitoring mechanism that would be more appropriate
> for detecting such issues

Indeed. Queue sizes can be monitored in several ways already - via AMQP 
using passive queue.declare, and via 'rabbitmqctl list_queues'. And I am 
pretty sure some of the tools built on top of these, such as Alice and 
Hyperic's rabbit management plug-in also provide this functionality; in 
the latter case including the ability to set thresholds and issue alerts.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Sep  1 04:27:28 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 04:27:28 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
	<4C7D7B15.6060106@rabbitmq.com>
	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>
Message-ID: <4C7DC820.4040204@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> Can I just put the .ez that make builds into deps/ and have it picked up 
> by rebar?

It would be two .ez files - rabbit_common.ez, which contains the 
portions of the code shared with the server, and amqp_client.ez, which 
is the actual Erlang client.

> I was under the impression I had to have the source but that  seems
> like overkill to me.

If rebar can't handle "binary" dependencies then rebar needs improving :)


Regards,

Matthias.

From scott at beamdog.com  Wed Sep  1 04:34:38 2010
From: scott at beamdog.com (Scott Brooks)
Date: Tue, 31 Aug 2010 21:34:38 -0600
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<4C7D7432.2050505@rabbitmq.com>
	<E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
Message-ID: <AANLkTikOUuDVkU-k=APTTSyPjk0Ya3iSgx0AYBsbBbOK@mail.gmail.com>

> Again, I'm not sure this really covers my case. For my use case I only care about the timeliness of the message as long as I am resource constrained. If I have ample resources I'd be willing to have the messages sit there for months.
>
> Thanks for the prompt reply and I'll look into the queue leases.
>
> Christian

If you are willing to throw away messages when resources are
constrained, how hard would it be to store a timestamp when you
publish the message, and in your consumer check the age and discard if
it's too old.

Scott

From matthias at rabbitmq.com  Wed Sep  1 04:38:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 04:38:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <AANLkTikOUuDVkU-k=APTTSyPjk0Ya3iSgx0AYBsbBbOK@mail.gmail.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>	<4C7D6AFC.6060805@rabbitmq.com>	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>	<4C7D7432.2050505@rabbitmq.com>	<E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
	<AANLkTikOUuDVkU-k=APTTSyPjk0Ya3iSgx0AYBsbBbOK@mail.gmail.com>
Message-ID: <4C7DCAAE.1040301@rabbitmq.com>

Scott,

Scott Brooks wrote:
> If you are willing to throw away messages when resources are
> constrained, how hard would it be to store a timestamp when you
> publish the message, and in your consumer check the age and discard if
> it's too old.

I believe in Christian's setup consumers may operate very slowly, or not 
connect at all for a very long time. Meanwhile messages are piling up at 
the server, which will eventually hit hard resource limits, namely disk 
space. So a mechanism is needed for messages to be evicted *in the 
absence of cooperating consumers*.

Matthias.

From masoper at gmail.com  Wed Sep  1 05:16:23 2010
From: masoper at gmail.com (Mark Soper)
Date: Wed, 1 Sep 2010 00:16:23 -0400
Subject: [rabbitmq-discuss] First-time rabbitmq install crashed after a
 week & now node won't restart
In-Reply-To: <680557C5-BB04-4604-B0DA-60B279EB1EF3@gmail.com>
References: <AANLkTimFDOe8sSaQA95Dq6G0OZrxz4Kvm7xSaoLhXpCk@mail.gmail.com>
	<680557C5-BB04-4604-B0DA-60B279EB1EF3@gmail.com>
Message-ID: <AANLkTinTdRxvP+5eaQy2C0KyGoX_1XvjT3h0dRXJdXMB@mail.gmail.com>

Update: Rabbitmq works again after reboot. Problem seems to have coincided
with maxing out of server memory.


Cc'ing:
I did not change the hostname.  You might be on to something - there may be
a problem with how ec2 handles hostnames/dhcp.  But as far as I know, the
hostname as been constant throughout.
Thanks, Ian.
Mark

On Tue, Aug 31, 2010 at 9:27 PM, Ian Ragsdale <ian.ragsdale at gmail.com>wrote:

> Did you happen to change your hostname?  That would cause rabbitmqctl to
> fail to connect to a running server that was started with a different
> hostname, and a running server would cause the second failure (because it
> couldn't listen on the correct port).
>
> - Ian
>
>
> On Aug 31, 2010, at 9:17 PM, Mark Soper <masoper at gmail.com> wrote:
>
> Just getting started with rabbitmq, hoping for advice on how to
> troubleshoot this:
>
> Last week I started using celery with rabbitmq on EC2 Ubuntu server.
> It ran fine for a week, then died.
>
> > sudo rabbitmqctl status
>
> Status of node 'rabbit at domU-12-31-39-05-6E-52' ...
> Error: unable to connect to node 'rabbit at domU-12-31-39-05-6E-52': nodedown
> diagnostics:
> - nodes and their ports on domU-12-31-39-05-6E-52:
> [{rabbitmqctl11365,50319}]
> - current node: 'rabbitmqctl11365 at domU-12-31-39-05-6E-52'
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: nF0wVuFwDDUCqBIAugLXcw==
>
>
> > sudo rabbitmq-server
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.7.2  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See <http://www.rabbitmq.com/>
> http://www.rabbitmq.com/
>
> node          : rabbit at domU-12-31-39-05-6E-52
> app descriptor:
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
> home dir      : /var/lib/rabbitmq
> cookie hash   : nF0wVuFwDDUCqBIAugLXcw==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
>
> starting internal event notification system
> ...done
> starting logging server
> ...done
> starting database
> ...done
> -- kernel ready
> starting alarm handler
>  ...done
> starting queue supervisor
> ...done
> starting node monitor
> ...done
> starting cluster router
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting codec correctness check
>  ...done
> starting exchange recovery
>  ...done
> starting queue recovery
> ...done
> starting persister
>  ...done
> starting guid generator
> ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...BOOT ERROR: FAILED
> Reason: {{badmatch,
>              {error,
>                  {shutdown,
>
> {child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
>                          {tcp_listener_sup,start_link,
>                              [{0,0,0,0},
>                               5672,
>                               [binary,
>                                {packet,raw},
>                                {reuseaddr,true},
>                                {exit_on_close,false}],
>                               {rabbit_networking,tcp_listener_started,[]},
>                               {rabbit_networking,tcp_listener_stopped,[]},
>                               {rabbit_networking,start_client,[]},
>                               "TCP Listener"]},
>                          transient,infinity,supervisor,
>                          [tcp_listener_sup]}}}},
>          [{rabbit_networking,start_listener,4},
>           {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
>           {rabbit_networking,boot_tcp,0},
>           {rabbit_networking,boot,0},
>           {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>           {rabbit,run_boot_step,1},
>           {rabbit,'-start/2-lc$^0/1-0-',1},
>           {rabbit,start,2}]}
> Erlang has closed
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
617-999-3047
masoper at gmail.com
http://twitter.com/marksoper
http://facebook.com/masoper
http://linkedin.com/in/marksoper
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/478b4844/attachment-0001.htm>

From jasonjwwilliams at gmail.com  Wed Sep  1 05:35:48 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 31 Aug 2010 22:35:48 -0600
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
Message-ID: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>

What is the default behavior for basic.reject if "requeue" is not specified?

-J

From matthias at rabbitmq.com  Wed Sep  1 05:41:49 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 05:41:49 +0100
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>
Message-ID: <4C7DD98D.4000902@rabbitmq.com>

Jason,

Jason J. W. Williams wrote:
> What is the default behavior for basic.reject if "requeue" is not specified?

 From the spec in amqp0-9-1.xml:

"If requeue is false or the requeue attempt fails the messages are 
discarded or dead-lettered."

Rabbit discards the messages.


Regards,

Matthias.

From jasonjwwilliams at gmail.com  Wed Sep  1 05:44:05 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 31 Aug 2010 22:44:05 -0600
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <4C7DD98D.4000902@rabbitmq.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>
	<4C7DD98D.4000902@rabbitmq.com>
Message-ID: <AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>

Sorry to pedantic, but to confirm back...if requeue is missing from
the reject parameters it's interpreted the same as requeue being set
to False.

-J

On Tue, Aug 31, 2010 at 10:41 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> What is the default behavior for basic.reject if "requeue" is not
>> specified?
>
> From the spec in amqp0-9-1.xml:
>
> "If requeue is false or the requeue attempt fails the messages are discarded
> or dead-lettered."
>
> Rabbit discards the messages.
>
>
> Regards,
>
> Matthias.
>

From matthias at rabbitmq.com  Wed Sep  1 05:51:55 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 05:51:55 +0100
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>	<4C7DD98D.4000902@rabbitmq.com>
	<AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>
Message-ID: <4C7DDBEB.3060903@rabbitmq.com>

Jason,

Jason J. W. Williams wrote:
> Sorry to pedantic, but to confirm back...if requeue is missing from
> the reject parameters it's interpreted the same as requeue being set
> to False.

AMQP commands can't have fields missing.

Are you referring to a specific client API? The Erlang client perhaps? 
There #'basic.consume'.requeue defaults to false, though arguably it 
should be 'true' since that is the more common option - I may change that.


Regards,

Matthias.

From jasonjwwilliams at gmail.com  Wed Sep  1 05:54:33 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 31 Aug 2010 22:54:33 -0600
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <4C7DDBEB.3060903@rabbitmq.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>
	<4C7DD98D.4000902@rabbitmq.com>
	<AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>
	<4C7DDBEB.3060903@rabbitmq.com>
Message-ID: <AANLkTi=Vo5aNWT_zdJHUu=qhq6D9g6XLS=wiAKuZqjay@mail.gmail.com>

I didn't realize AMQP commands couldn't have missing parameters. It's
good to know it's a client-specific implementation detail if requeue
has a default setting. Thank you! :)

-J

On Tue, Aug 31, 2010 at 10:51 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> Sorry to pedantic, but to confirm back...if requeue is missing from
>> the reject parameters it's interpreted the same as requeue being set
>> to False.
>
> AMQP commands can't have fields missing.
>
> Are you referring to a specific client API? The Erlang client perhaps? There
> #'basic.consume'.requeue defaults to false, though arguably it should be
> 'true' since that is the more common option - I may change that.
>
>
> Regards,
>
> Matthias.
>

From matthias at rabbitmq.com  Wed Sep  1 06:10:44 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 06:10:44 +0100
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <4C7DDBEB.3060903@rabbitmq.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>	<4C7DD98D.4000902@rabbitmq.com>
	<AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>
	<4C7DDBEB.3060903@rabbitmq.com>
Message-ID: <4C7DE054.5060102@rabbitmq.com>

Matthias Radestock wrote:
> Are you referring to a specific client API? The Erlang client perhaps? 
> There #'basic.consume'.requeue defaults to false, though arguably it 
> should be 'true' since that is the more common option - I may change that.

Er, the default there actually is 'true' already.

Matthias.

From jasonjwwilliams at gmail.com  Wed Sep  1 06:13:21 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 31 Aug 2010 23:13:21 -0600
Subject: [rabbitmq-discuss] Basic.reject default requeuing behavior.
In-Reply-To: <4C7DE054.5060102@rabbitmq.com>
References: <AANLkTinP-wRHN+x7c35aFcEJw_arKHRBUjrca5yEi7_r@mail.gmail.com>
	<4C7DD98D.4000902@rabbitmq.com>
	<AANLkTimeO=5rRRH4pASTdkLFAGCubhTcd_3gqw=KTW-R@mail.gmail.com>
	<4C7DDBEB.3060903@rabbitmq.com> <4C7DE054.5060102@rabbitmq.com>
Message-ID: <AANLkTi=-nFqxMnJYdojzAjD48cujaFXqdSgr6TWn1d-J@mail.gmail.com>

Thanks. :)

On Tue, Aug 31, 2010 at 11:10 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Matthias Radestock wrote:
>>
>> Are you referring to a specific client API? The Erlang client perhaps?
>> There #'basic.consume'.requeue defaults to false, though arguably it should
>> be 'true' since that is the more common option - I may change that.
>
> Er, the default there actually is 'true' already.
>
> Matthias.
>

From abhishek.kona at gmail.com  Wed Sep  1 07:18:52 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 01 Sep 2010 11:48:52 +0530
Subject: [rabbitmq-discuss] Write to Disk policy of RabbitMQ
Message-ID: <4C7DF04C.3000704@gmail.com>

  Hi

I am using RabbitMQ with all durable queues and persistent messages. 
What is the write to disk policies of RabbitMQ, does it do a disk 
operation for the persistent messages on each operation on the queues or 
it does a write to disk in once in n amount of time.

What is the exact policy.

Abhishek Kona

From matthias at rabbitmq.com  Wed Sep  1 07:39:00 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 07:39:00 +0100
Subject: [rabbitmq-discuss] Write to Disk policy of RabbitMQ
In-Reply-To: <4C7DF04C.3000704@gmail.com>
References: <4C7DF04C.3000704@gmail.com>
Message-ID: <4C7DF504.4060308@rabbitmq.com>

Abhishek,

Abhishek Kona wrote:
> I am using RabbitMQ with all durable queues and persistent messages. 
> What is the write to disk policies of RabbitMQ, does it do a disk 
> operation for the persistent messages on each operation on the queues or 
> it does a write to disk in once in n amount of time.

Neither :) There is a lot of caching, buffering, coalescing and various 
other optimisations going on.

Rabbit guarantees that data relating to persistent messages in durable 
queues will be written to disk *eventually* if a) that's actually 
necessary (e.g. the message hasn't been delivered and ack'ed already), 
and b) nothing disastrous happens to the broker.

The guarantee is strengthened when using tx. On receipt of a 
tx.commit-ok all the actions on persistent messages in durable queues 
are guaranteed to have been written to disk if necessary.

> What is the exact policy.

Matthew might explain some of the details in a blog post one day.


Regards,

Matthias.

From abhishek.kona at gmail.com  Wed Sep  1 09:38:36 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 01 Sep 2010 14:08:36 +0530
Subject: [rabbitmq-discuss] Ubuntu Issues
Message-ID: <4C7E110C.1010803@gmail.com>

  First, RabbitMQ is using the default settings for the Mnesia database 
as well as for the Logs. Even though I have set the environment 
variables for the same.

export RABBITMQ_MNESIA_BASE=/rabbit/mnesia
export RABBITMQ_LOG_BASE=/rabbit/log

Second, when I updated RabbitMQ using apt it downloaded the latest 
version or RabbitMQ but when I stopped and started the server it was 
still running 1.7.2

What can I be doing wrong here?


Abhishek Kona

From sigurd.hogsbro at museeka.com  Wed Sep  1 10:42:19 2010
From: sigurd.hogsbro at museeka.com (=?utf-8?Q?Sigurd_H=C3=B8gsbro?=)
Date: Wed, 1 Sep 2010 10:42:19 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
Message-ID: <C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>

Alexis,

A follow-on thought: could you add a key with the server hostname to the server_properties dict sent back from the server on connection.start? That would solve our diagnostics needs (and maybe Aaron's too) without breaking your conformance to the spec. 

Regards,

Sigurd

On 31 Aug 2010, at 14:57, Sigurd H?gsbro <sigurd.hogsbro at museeka.com> wrote:

> Hi Alexis,
> 
> As it is mainly for diagnostics we'll deal without it.
> 
> Regards,
> 
> Sigurd
> 
> On 31 Aug 2010, at 13:51, Alexis Richardson <alexis at rabbitmq.com> wrote:
> 
>> Sigurd
>> 
>> Do you think you will be able to develop a workaround?
>> 
>> alexis
>> 
>> 
>> 2010/8/31 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>:
>>> Thanks Aaron, I was afraid that's what would be coming back ;-)
>>> 
>>> Sigurd
>>> 
>>> On Aug 30, 8:38 pm, Aaron Westendorf <aa... at agoragames.com> wrote:
>>>> Some time ago we had a conversation with the team and learned that the
>>>> redirect was removed in the 0.9.1 spec.  I suspect that the
>>>> corresponding known_hosts data may have also been removed.  A quick
>>>> check of the protocol docs seem to confirm this.
>>>> 
>>>> -Aaron
>>>> 
>>>> 2010/8/30 Sigurd H?gsbro <sigurd.hogs... at museeka.com>:
>>>> 
>>>>> Hi,
>>>> 
>>>>> Since the upgrade to 2.0.0 I notice that the known_hosts property is
>>>>> no longer getting populated by the hostname of the server to which
>>>>> I've connected. This was quite useful to us for diagnostics since we
>>>>> use a proxy-based connection layer. Is this an oversight, or a
>>>>> deliberate change related to 0.9.1?
>>>> 
>>>>> Sigurd
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> --
>>>> Aaron Westendorf
>>>> Senior Software Engineer
>>>> Agora Games
>>>> 359 Broadway
>>>> Troy, NY 12180
>>>> Phone: 518.268.1000
>>>> aa... at agoragames.comwww.agoragames.com
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 

From mikeb at rabbitmq.com  Wed Sep  1 11:21:32 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 01 Sep 2010 11:21:32 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
Message-ID: <4C7E292C.5070505@rabbitmq.com>

Sigurd,

> A follow-on thought: could you add a key with the server hostname to 
> the server_properties dict sent back from the server on 
> connection.start? That would solve our diagnostics needs (and maybe 
> Aaron's too) without breaking your conformance to the spec.

The server properties is more or less a free-form map, so yes, it's 
certainly possible a hostname (or more likely, a node name including the 
hostname) could go there.

There may be concerns around leaking infrastructural information that 
way, but probably not strong ones.


Michael

> Regards,
> 
> Sigurd
> 
> On 31 Aug 2010, at 14:57, Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>  wrote:
> 
>> Hi Alexis,
>> 
>> As it is mainly for diagnostics we'll deal without it.
>> 
>> Regards,
>> 
>> Sigurd
>> 
>> On 31 Aug 2010, at 13:51, Alexis Richardson <alexis at rabbitmq.com> 
>> wrote:
>> 
>>> Sigurd
>>> 
>>> Do you think you will be able to develop a workaround?
>>> 
>>> alexis
>>> 
>>> 
>>> 2010/8/31 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>:
>>>> Thanks Aaron, I was afraid that's what would be coming back ;-)
>>>> 
>>>> 
>>>> 
>>>> Sigurd
>>>> 
>>>> On Aug 30, 8:38 pm, Aaron Westendorf <aa... at agoragames.com> 
>>>> wrote:
>>>>> Some time ago we had a conversation with the team and learned
>>>>>  that the redirect was removed in the 0.9.1 spec.  I suspect 
>>>>> that the corresponding known_hosts data may have also been 
>>>>> removed.  A quick check of the protocol docs seem to confirm 
>>>>> this.
>>>>> 
>>>>> -Aaron
>>>>> 
>>>>> 2010/8/30 Sigurd H?gsbro <sigurd.hogs... at museeka.com>:
>>>>> 
>>>>>> Hi, Since the upgrade to 2.0.0 I notice that the 
>>>>>> known_hosts property is no longer getting populated by the 
>>>>>> hostname of the server to which I've connected. This was 
>>>>>> quite useful to us for diagnostics since we use a 
>>>>>> proxy-based connection layer. Is this an oversight, or a 
>>>>>> deliberate change related to 0.9.1? Sigurd 
>>>>>> _______________________________________________ 
>>>>>> rabbitmq-discuss mailing list 
>>>>>> rabbitmq-disc... at lists.rabbitmq.com 
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>> 
>>>>>> 
>>>>> -- Aaron Westendorf Senior Software Engineer Agora Games 359 
>>>>> Broadway Troy, NY 12180 Phone: 518.268.1000 
>>>>> aa... at agoragames.comwww.agoragames.com 
>>>>> _______________________________________________ 
>>>>> rabbitmq-discuss mailing list 
>>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> 
>>>>> 
>>>> _______________________________________________ 
>>>> rabbitmq-discuss mailing list 
>>>> rabbitmq-discuss at lists.rabbitmq.com 
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>>> 
> _______________________________________________ rabbitmq-discuss 
> mailing list rabbitmq-discuss at lists.rabbitmq.com 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Wed Sep  1 11:26:59 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 11:26:59 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <4C7E292C.5070505@rabbitmq.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
	<4C7E292C.5070505@rabbitmq.com>
Message-ID: <4C7E2A73.5050309@rabbitmq.com>

Sigurd,

On 01/09/10 11:21, Michael Bridgen wrote:
>> A follow-on thought: could you add a key with the server hostname to
>> the server_properties dict sent back from the server on
>> connection.start? That would solve our diagnostics needs (and maybe
>> Aaron's too) without breaking your conformance to the spec.
>
> The server properties is more or less a free-form map, so yes, it's
> certainly possible a hostname (or more likely, a node name including the
> hostname) could go there.
>
> There may be concerns around leaking infrastructural information that
> way, but probably not strong ones.

I am reluctant to add ad-hoc properties without a sound technical 
rationale. And yes the information leakage *is* a concern.

Can you explain what you are trying to do?

connection.redirect and the known_hosts field got removed because they 
a) duplicate what load balancers do much better, and b) don't work in 
many network setups since they rely on the clients to be able to resolve 
servers by their internal names.


Regards,

Matthias.

From vlad at rabbitmq.com  Wed Sep  1 11:39:45 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 11:39:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ Message Server Connection.
In-Reply-To: <AANLkTi=wGENrNJks8p_aKXoyO20USUF8cmMgBDuLAT2U@mail.gmail.com>
References: <AANLkTi=wGENrNJks8p_aKXoyO20USUF8cmMgBDuLAT2U@mail.gmail.com>
Message-ID: <4C7E2D71.40506@rabbitmq.com>


Hi Jigar,

I don't think there's any way to do that.
Depending on the client you are using, you can catch the error and 
inspect it. That should give you enough info whether the server is 
unreachable or there is some other error.

Rgds,
Vlad.


On 08/31/2010 01:47 PM, jigar sheth wrote:
> How can i check if there is a message Server  Connection available or 
> not, so that i dont get Connection Error at Create Connection 
> Statement if no Server is Running ?
>
>
> Regards,
> Jigar Sheth
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/b6dde1e6/attachment.htm>

From david at rabbitmq.com  Wed Sep  1 11:56:00 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 01 Sep 2010 11:56:00 +0100
Subject: [rabbitmq-discuss] Ubuntu Issues
In-Reply-To: <4C7E110C.1010803@gmail.com> (Abhishek Kona's message of "Wed, 01
	Sep 2010 14:08:36 +0530")
References: <4C7E110C.1010803@gmail.com>
Message-ID: <yrv4c4oe9g2bj.fsf@dwragg.eng.vmware.com>

Hi Abhishek,

Abhishek Kona <abhishek.kona at gmail.com> writes:
> First, RabbitMQ is using the default settings for the Mnesia database
> as well as for the Logs. Even though I have set the environment
> variables for the same.
>
> export RABBITMQ_MNESIA_BASE=/rabbit/mnesia
> export RABBITMQ_LOG_BASE=/rabbit/log

How are you starting rabbit when you do this?

> Second, when I updated RabbitMQ using apt it downloaded the latest
> version or RabbitMQ but when I stopped and started the server it was
> still running 1.7.2
>
> What can I be doing wrong here?

When you say that apt downloaded that latest version, which version was
that?  The latest version in ubuntu is still in fact 1.7.2, due to their
release cycles.  If you want to install the actual latest version using
apt, you'll need to follow the instructions at
<http://www.rabbitmq.com/debian.html>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vlad at rabbitmq.com  Wed Sep  1 12:05:25 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 12:05:25 +0100
Subject: [rabbitmq-discuss] Acknowledging multiple messages.
In-Reply-To: <AANLkTimFXwQ_dRHdfXYwbAp9pNKPLc0Zs9=_kub0z4JJ@mail.gmail.com>
References: <AANLkTimFXwQ_dRHdfXYwbAp9pNKPLc0Zs9=_kub0z4JJ@mail.gmail.com>
Message-ID: <4C7E3375.4010003@rabbitmq.com>

Hi Ritesh,


The way it works is that if you set the multiple flag to true, you tell 
the broker that you acknowledge all messages /up to and including/ the 
message you specify with the delivery tag.
Perhaps worth mentioning that the order of delivery of messages is 
guaranteed.

There is no way of specifying more than one delivery tag.


Rgds,
Vlad.



On 08/31/2010 12:56 PM, rathi wrote:
> void*basicAck*(long deliveryTag, boolean multiple) throws java.io.IOException
> Acknowledge one or several received messages. Supply the deliveryTag from the|AMQP.Basic.GetOk|  <http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.GetOk.html>  or|AMQP.Basic.Deliver|  <http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.Deliver.html>  method containing the received message being acknowledged.
>
>
> The above method allows to acknowledge multiple messages based on the deliveryTag. But how do we set the same deliveryTag for multiple messages. Don't know
> if my understanding here is right. Please correct me if I am wrong.
>
>
> thanks&  regards,
> ritesh rathi
>
>    
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/bedc5644/attachment.htm>

From riteshrathi at gmail.com  Wed Sep  1 12:38:21 2010
From: riteshrathi at gmail.com (rathi)
Date: Wed, 1 Sep 2010 17:08:21 +0530
Subject: [rabbitmq-discuss] Acknowledging multiple messages.
In-Reply-To: <4C7E3375.4010003@rabbitmq.com>
References: <AANLkTimFXwQ_dRHdfXYwbAp9pNKPLc0Zs9=_kub0z4JJ@mail.gmail.com>
	<4C7E3375.4010003@rabbitmq.com>
Message-ID: <AANLkTimGnenD50ZhG+m06ix8jQg74bZsqq4eu4_dqA1q@mail.gmail.com>

Got it.

Thanks,
ritesh rathi

On Wed, Sep 1, 2010 at 4:35 PM, Vlad Alexandru Ionescu <vlad at rabbitmq.com>wrote:

>  Hi Ritesh,
>
>
> The way it works is that if you set the multiple flag to true, you tell the
> broker that you acknowledge all messages /up to and including/ the message
> you specify with the delivery tag.
> Perhaps worth mentioning that the order of delivery of messages is
> guaranteed.
>
> There is no way of specifying more than one delivery tag.
>
>
> Rgds,
> Vlad.
>
>
>
>
> On 08/31/2010 12:56 PM, rathi wrote:
>
> void *basicAck*(long deliveryTag, boolean multiple) throws java.io.IOException
> Acknowledge one or several received messages. Supply the deliveryTag from the AMQP.Basic.GetOk <http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.GetOk.html> or AMQP.Basic.Deliver <http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.1/rabbitmq-java-client-javadoc-1.5.1/com/rabbitmq/client/AMQP.Basic.Deliver.html> method containing the received message being acknowledged.
>
>
> The above method allows to acknowledge multiple messages based on the deliveryTag. But how do we set the same deliveryTag for multiple messages. Don't know
> if my understanding here is right. Please correct me if I am wrong.
>
>
> thanks & regards,
> ritesh rathi
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/7c6da4ba/attachment.htm>

From jon at jbrisbin.com  Wed Sep  1 13:00:38 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 1 Sep 2010 07:00:38 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7DC820.4040204@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
	<4C7D7B15.6060106@rabbitmq.com>
	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>
	<4C7DC820.4040204@rabbitmq.com>
Message-ID: <BB4E4439-D51E-49E6-BE0A-F91C0C7DA85A@jbrisbin.com>


On Aug 31, 2010, at 10:27 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>> Can I just put the .ez that make builds into deps/ and have it picked up by rebar?
> 
> It would be two .ez files - rabbit_common.ez, which contains the portions of the code shared with the server, and amqp_client.ez, which is the actual Erlang client.

As an aside: does the rabbit_common module contain the worker pool?

> 
>> I was under the impression I had to have the source but that  seems
>> like overkill to me.
> 
> If rebar can't handle "binary" dependencies then rebar needs improving :)
> 


rebar could use some improving one way or another. :) It's a pretty good tool but it has some significant shortcomings, particularly in generating/updating an OTP application (creating the .boot and startup script, etc...). I wish there was something more like maven or ant for erlang.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/fe390d9b/attachment.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 13:22:39 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 12:22:39 +0000
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <4C7E2A73.5050309@rabbitmq.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
	<4C7E292C.5070505@rabbitmq.com> <4C7E2A73.5050309@rabbitmq.com>
Message-ID: <AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>

Hi Matthias,

We use the hostname for follow-up diagnosis after identifying application
failures. In such scenarios it is useful to know which of the RabbitMQ
servers behind the (transparent) load-balancer to investigate.

Fair point on the information leakage, but I'm not sure why you're concerned
about the server hostname being exposed as it used to be exposed until
recently. We could also use a name/token specified in the server
configuration file if you prefer not to expose DNS names.

Otherwise we'll have to figure a way get this information from the
load-balancers.

Sigurd

2010/9/1 Matthias Radestock <matthias at rabbitmq.com>

> Sigurd,
>
>
> On 01/09/10 11:21, Michael Bridgen wrote:
>
>> A follow-on thought: could you add a key with the server hostname to
>>> the server_properties dict sent back from the server on
>>> connection.start? That would solve our diagnostics needs (and maybe
>>> Aaron's too) without breaking your conformance to the spec.
>>>
>>
>> The server properties is more or less a free-form map, so yes, it's
>> certainly possible a hostname (or more likely, a node name including the
>> hostname) could go there.
>>
>> There may be concerns around leaking infrastructural information that
>> way, but probably not strong ones.
>>
>
> I am reluctant to add ad-hoc properties without a sound technical
> rationale. And yes the information leakage *is* a concern.
>
> Can you explain what you are trying to do?
>
> connection.redirect and the known_hosts field got removed because they a)
> duplicate what load balancers do much better, and b) don't work in many
> network setups since they rely on the clients to be able to resolve servers
> by their internal names.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/c560df7d/attachment.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 13:22:39 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 12:22:39 +0000
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <4C7E2A73.5050309@rabbitmq.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
	<4C7E292C.5070505@rabbitmq.com> <4C7E2A73.5050309@rabbitmq.com>
Message-ID: <AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>

Hi Matthias,

We use the hostname for follow-up diagnosis after identifying application
failures. In such scenarios it is useful to know which of the RabbitMQ
servers behind the (transparent) load-balancer to investigate.

Fair point on the information leakage, but I'm not sure why you're concerned
about the server hostname being exposed as it used to be exposed until
recently. We could also use a name/token specified in the server
configuration file if you prefer not to expose DNS names.

Otherwise we'll have to figure a way get this information from the
load-balancers.

Sigurd

2010/9/1 Matthias Radestock <matthias at rabbitmq.com>

> Sigurd,
>
>
> On 01/09/10 11:21, Michael Bridgen wrote:
>
>> A follow-on thought: could you add a key with the server hostname to
>>> the server_properties dict sent back from the server on
>>> connection.start? That would solve our diagnostics needs (and maybe
>>> Aaron's too) without breaking your conformance to the spec.
>>>
>>
>> The server properties is more or less a free-form map, so yes, it's
>> certainly possible a hostname (or more likely, a node name including the
>> hostname) could go there.
>>
>> There may be concerns around leaking infrastructural information that
>> way, but probably not strong ones.
>>
>
> I am reluctant to add ad-hoc properties without a sound technical
> rationale. And yes the information leakage *is* a concern.
>
> Can you explain what you are trying to do?
>
> connection.redirect and the known_hosts field got removed because they a)
> duplicate what load balancers do much better, and b) don't work in many
> network setups since they rely on the clients to be able to resolve servers
> by their internal names.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/c560df7d/attachment-0003.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 13:22:39 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 12:22:39 +0000
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <4C7E2A73.5050309@rabbitmq.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
	<4C7E292C.5070505@rabbitmq.com> <4C7E2A73.5050309@rabbitmq.com>
Message-ID: <AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>

Hi Matthias,

We use the hostname for follow-up diagnosis after identifying application
failures. In such scenarios it is useful to know which of the RabbitMQ
servers behind the (transparent) load-balancer to investigate.

Fair point on the information leakage, but I'm not sure why you're concerned
about the server hostname being exposed as it used to be exposed until
recently. We could also use a name/token specified in the server
configuration file if you prefer not to expose DNS names.

Otherwise we'll have to figure a way get this information from the
load-balancers.

Sigurd

2010/9/1 Matthias Radestock <matthias at rabbitmq.com>

> Sigurd,
>
>
> On 01/09/10 11:21, Michael Bridgen wrote:
>
>> A follow-on thought: could you add a key with the server hostname to
>>> the server_properties dict sent back from the server on
>>> connection.start? That would solve our diagnostics needs (and maybe
>>> Aaron's too) without breaking your conformance to the spec.
>>>
>>
>> The server properties is more or less a free-form map, so yes, it's
>> certainly possible a hostname (or more likely, a node name including the
>> hostname) could go there.
>>
>> There may be concerns around leaking infrastructural information that
>> way, but probably not strong ones.
>>
>
> I am reluctant to add ad-hoc properties without a sound technical
> rationale. And yes the information leakage *is* a concern.
>
> Can you explain what you are trying to do?
>
> connection.redirect and the known_hosts field got removed because they a)
> duplicate what load balancers do much better, and b) don't work in many
> network setups since they rely on the clients to be able to resolve servers
> by their internal names.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/c560df7d/attachment-0004.htm>

From emile at rabbitmq.com  Wed Sep  1 13:41:16 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Sep 2010 13:41:16 +0100
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAJQQ2PBVBzpCs/OnVIcmCE8BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>	<AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAJQQ2PBVBzpCs/OnVIcmCE8BAAAAAA==@oryo.lt>
Message-ID: <4C7E49EC.3090501@rabbitmq.com>


Hi Andrius,

I've tried to get an overview of how hard it would be to get the
RabbitMQ .NET client to compile using only the Compact Framework
library. Here are some of the hurdles:

---
SSL-related classes, methods and parameters in AmqpTcpEndpoint don't exist

A few exceptions assume members that don't exist in the CF

AppDomain uploading and use of reflection in ConnectionBase will need to
be removed

Buffered streaming (in SocketFrameHandler) doesn't exist

ConfigurationSettings in Protocols is missing

UTF8 encoding and decoding in WireFormatting will need to be done
differently

Threading primitives in SharedQueue don't exist.
---

I get the sense that porting the .NET client to Compact Framework is not
impossible, but not a trivial undertaking. I'm not aware of anyone else
having attempted this.

Regards

Emile




On 28/08/10 00:20, Andrius Norkaitis wrote:
> Last time I tried using Rabbit .NET client in Windows Mobile/CE, some .NET
> function which was used was missing in .NET Compact.
> Maybe somebody has some ideas and want to look for solution? I'm not very
> familiar with source code of Rabbit .NET client, but I would be glad to
> help.
> Bringing RabbitMQ to mobile platforms would open so much possibilities...
> 
> Best,
> Andrius Norkaitis
> 
> 
> -----Original Message-----
> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On
> Behalf Of Alexis Richardson
> Sent: Friday, August 27, 2010 9:20 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
> 
> Andrius
> 
> I checked the archives and afaict only you have spoken up on this in the
> past!
> 
> Do you know why the .NET client might not work on WinCE?
> 
> alexis
> 
> 
> On Fri, Aug 27, 2010 at 6:17 PM, Andrius Norkaitis
> <andrius.norkaitis at oryo.lt> wrote:
>> We're using Microsoft .NET. As I know RabbitMQ .NET Client is not 
>> directly compatible with Microsoft .NET Compact Framework, isn't it?.
>> My question is maybe somebody ported it to work on .NET Compact or has 
>> experience by using other client with interop.
>>
>> Best,
>> Andrius Norkaitis
>>
>>
>> -----Original Message-----
>> From: David Wragg [mailto:david at rabbitmq.com]
>> Sent: Friday, August 27, 2010 6:38 PM
>> To: Andrius Norkaitis
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>>
>> Hi Andrius,
>>
>> "Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
>>> I would like to know if someone already use or did the source code 
>>> port of AMQP client API to run on Windows CE operating system ?
>>
>> What programming language/platform are you using to develop your 
>> Windows CE applications?
>>
>> (Forgive me if there is an obvious answer to this question; I'm not 
>> very familiar with WinCE.)
>>
>> David
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware

From matthias at rabbitmq.com  Wed Sep  1 13:55:18 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 13:55:18 +0100
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>	<4C7E292C.5070505@rabbitmq.com>	<4C7E2A73.5050309@rabbitmq.com>
	<AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>
Message-ID: <4C7E4D36.10304@rabbitmq.com>

Sigurd,

On 01/09/10 13:22, Sigurd H?gsbro wrote:
> Fair point on the information leakage, but I'm not sure why you're
> concerned about the server hostname being exposed as it used to be
> exposed until recently.

We all learn from our mistakes ;)

> We could also use a name/token specified in the server configuration
> file if you prefer not to expose DNS names.

Now *there* is an idea. Being able to extend/augment the 
server_properties as part of the server configuration, much like our 
client APIs allow you to do with the client properties. See, e.g. 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.0.0/rabbitmq-java-client-javadoc-2.0.0/com/rabbitmq/client/ConnectionFactory.html#setClientProperties(java.util.Map)

I have filed a bug for that.


Regards,

Matthias.

From vlad at rabbitmq.com  Wed Sep  1 14:01:15 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 14:01:15 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <BB4E4439-D51E-49E6-BE0A-F91C0C7DA85A@jbrisbin.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<BB4E4439-D51E-49E6-BE0A-F91C0C7DA85A@jbrisbin.com>
Message-ID: <4C7E4E9B.4060603@rabbitmq.com>



On 09/01/2010 01:00 PM, Jon Brisbin wrote:
> As an aside: does the rabbit_common module contain the worker pool?

No, it does not. The Erlang client doesn't use it.

Vlad.


From sigurd.hogsbro at museeka.com  Wed Sep  1 14:02:29 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 15:02:29 +0200
Subject: [rabbitmq-discuss] Open-Ok no longer populating known_hosts
In-Reply-To: <4C7E4D36.10304@rabbitmq.com>
References: <0011b89f-a5de-425c-95cd-4ef461cf03be@h19g2000yqb.googlegroups.com>
	<AANLkTikGrtmP24z7k2HM8Lv5BWoYyWyibfuv4Tc=SfeM@mail.gmail.com>
	<cad30278-6610-4737-8f3f-a504f826b416@q2g2000yqq.googlegroups.com>
	<AANLkTi=PiwNVTYTBgOj_Bk9gKiLJ2Bc5ewrhnsKeA=gs@mail.gmail.com>
	<88E72173-38E2-4A4F-84E3-BF7154EBC6FF@museeka.com>
	<C5F9DCAE-451F-4745-8202-537B5245E5C5@museeka.com>
	<4C7E292C.5070505@rabbitmq.com> <4C7E2A73.5050309@rabbitmq.com>
	<AANLkTi=mTCA-nnWct_mgzZjhELuRrM-GDtQ2KOj-OAFg@mail.gmail.com>
	<4C7E4D36.10304@rabbitmq.com>
Message-ID: <AANLkTi=CZZMM_TCfxsbDRVcMPiWjsJE0pigZmO4kU0ck@mail.gmail.com>

Matthias,

Excellent; configurable server properties work for me.

Sigurd

2010/9/1 Matthias Radestock <matthias at rabbitmq.com>

> Sigurd,
>
>
> On 01/09/10 13:22, Sigurd H?gsbro wrote:
>
>> Fair point on the information leakage, but I'm not sure why you're
>> concerned about the server hostname being exposed as it used to be
>> exposed until recently.
>>
>
> We all learn from our mistakes ;)
>
>
>  We could also use a name/token specified in the server configuration
>> file if you prefer not to expose DNS names.
>>
>
> Now *there* is an idea. Being able to extend/augment the server_properties
> as part of the server configuration, much like our client APIs allow you to
> do with the client properties. See, e.g.
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.0.0/rabbitmq-java-client-javadoc-2.0.0/com/rabbitmq/client/ConnectionFactory.html#setClientProperties(java.util.Map)
>
> I have filed a bug for that.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/c39a18c1/attachment.htm>

From jon.brisbin at npcinternational.com  Wed Sep  1 15:06:34 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 1 Sep 2010 09:06:34 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7DC820.4040204@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
	<4C7D7B15.6060106@rabbitmq.com>
	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>
	<4C7DC820.4040204@rabbitmq.com>
Message-ID: <AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>

I'm still getting the error.

I hope I'm doing this right. I did a fresh checkout of that tag:

hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
destination directory: rabbitmq-server
requesting all changes
adding changesets
adding manifests
adding file changes
added 4652 changesets with 8132 changes to 265 files (+27 heads)
updating to branch default
141 files updated, 0 files merged, 0 files removed, 0 files unresolved
...
hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
destination directory: rabbitmq-erlang-client
requesting all changes
adding changesets
adding manifests
adding file changes
added 823 changesets with 1788 changes to 136 files (+10 heads)
updating to branch default
26 files updated, 0 files merged, 0 files removed, 0 files unresolved
...

Build was okay. Had to copy the actual source files rather than the .ez files because rebar doesn't handle .ez files (c'est tr?s ennuyant!).

Re-generated the OTP application from scratch (which includes the new .beams). Still getting an error:

worker: {error,
            {bad_return_value,
                {error,
                    {auth_failure_likely,
                        {error,
                            {undef,
                                [{rabbit_writer,start_link,
                                     [#Port<0.704>,0,4096,
                                      rabbit_framing_amqp_0_9_1]},
                                 {amqp_channel_util,
                                     start_channel_infrastructure,3},
                                 {amqp_network_connection,do_handshake,1},
                                 {amqp_network_connection,init,1},
                                 {gen_server,init_it,6},
                                 {proc_lib,init_p_do_apply,3}]}}}}}}


When using:

		BrokerHost = proplists:get_value(host, AmqpConfig, <<"localhost">>),
		BrokerPort = proplists:get_value(port, AmqpConfig, 5672),
		BrokerUser = proplists:get_value(username, AmqpConfig, <<"guest">>),
		BrokerPass = proplists:get_value(password, AmqpConfig, <<"guest">>),
		BrokerVhost = proplists:get_value(vhost, AmqpConfig, <<"/">>),
		Connection = amqp_connection:start_network(#amqp_params{ host=BrokerHost, 
																														 port=BrokerPort, 
																														 username=BrokerUser, 
																														 password=BrokerPass, 
																														 virtual_host=BrokerVhost }),
		Channel = amqp_connection:open_channel(Connection),

I'm sure I'm not doing something right. I just don't know what it is. :/

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Aug 31, 2010, at 10:27 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>> Can I just put the .ez that make builds into deps/ and have it picked up by rebar?
> 
> It would be two .ez files - rabbit_common.ez, which contains the portions of the code shared with the server, and amqp_client.ez, which is the actual Erlang client.
> 
>> I was under the impression I had to have the source but that  seems
>> like overkill to me.
> 
> If rebar can't handle "binary" dependencies then rebar needs improving :)
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vlad at rabbitmq.com  Wed Sep  1 15:14:18 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 15:14:18 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
Message-ID: <4C7E5FBA.6020401@rabbitmq.com>


Hi Jon,


Doing

$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
$ cd rabbitmq-erlang-client
$ make test_network

works for me: "All 29 tests passed." Does it work for you?


Rgds,
Vlad.


From vlad at rabbitmq.com  Wed Sep  1 15:21:18 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 15:21:18 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
Message-ID: <4C7E615E.5060105@rabbitmq.com>


> worker: {error,
>              {bad_return_value,
>                  {error,
>                      {auth_failure_likely,
>                          {error,
>                              {undef,
>                                  [{rabbit_writer,start_link,
>                                       [#Port<0.704>,0,4096,
>                                        rabbit_framing_amqp_0_9_1]},
>                                   {amqp_channel_util,
>                                       start_channel_infrastructure,3},
>                                   {amqp_network_connection,do_handshake,1},
>                                   {amqp_network_connection,init,1},
>                                   {gen_server,init_it,6},
>                                   {proc_lib,init_p_do_apply,3}]}}}}}}
>
>
>    
I'm suspecting you're compiling with the latest version of the broker 
(rather than 2.0.0) still.


Rgds,
Vlad.


From jon.brisbin at npcinternational.com  Wed Sep  1 15:23:41 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 1 Sep 2010 09:23:41 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7E5FBA.6020401@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
	<4C7E5FBA.6020401@rabbitmq.com>
Message-ID: <234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>

Doing make test_network in the public-umbrella which I checked and using fresh checkouts out gives this error on Mac OS X 10.6.4 with macports Erlang installed (Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-poll:false]):

+-( ~/src/rabbitmq-2.0/rabbitmq-erlang-client ):> make test_network
uname: illegal option -- o
usage: uname [-amnprsv]
make -C test
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info amqp_dbg.erl
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info direct_client_SUITE.erl
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info negative_test_util.erl
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info network_client_SUITE.erl
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info ssl_client_SUITE.erl
ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info test_util.erl
make run_test_broker RUN_TEST_BROKER_ARGS="-s network_client_SUITE test"
uname: illegal option -- o
usage: uname [-amnprsv]
make -C ../rabbitmq-server start-background-node
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-/" RABBITMQ_MNESIA_DIR="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-//rabbitmq-rabbit-mnesia" \
		RABBITMQ_NODE_ONLY=true \
		RABBITMQ_SERVER_START_ARGS=" -detached" \
		./scripts/rabbitmq-server ; sleep 1
make -C ../rabbitmq-server start-rabbit-on-node
echo "rabbit:start()." | erl_call -sname rabbit -e
/bin/sh: erl_call: command not found
make[2]: *** [start-rabbit-on-node] Error 127
make[1]: *** [boot_broker] Error 2
make: *** [test_network] Error 2



Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Sep 1, 2010, at 9:14 AM, Vlad Alexandru Ionescu wrote:

> 
> Hi Jon,
> 
> 
> Doing
> 
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
> $ cd rabbitmq-erlang-client
> $ make test_network
> 
> works for me: "All 29 tests passed." Does it work for you?
> 
> 
> Rgds,
> Vlad.
> 


From matthias at rabbitmq.com  Wed Sep  1 15:21:56 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 01 Sep 2010 15:21:56 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>
	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>
	<4C7D7B15.6060106@rabbitmq.com>
	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>
	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
Message-ID: <4C7E6184.5080407@rabbitmq.com>

Jon,

On 01/09/10 15:06, Jon Brisbin wrote:
> I'm still getting the error.
>
> I hope I'm doing this right. I did a fresh checkout of that tag:
>
> hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server hg
> clone -u rabbitmq_v2_0_0
> http://hg.rabbitmq.com/rabbitmq-erlang-client

did you update the codegen too?

> Build was okay.

Do you have a complete transcript starting with the fresh checkout and
culminating with the error below?

> Had to copy the actual source files rather than the .ez files because
> rebar doesn't handle .ez files

As I said before, the error is a clear indication that the erlang client
is picking up the wrong version of the sever code. Or no code at all.
Since I am not familiar with your build process I can only make some
generic suggestions:

1) track down all .ez files and nuke them
2) track down all .beam files and nuke them
3) track down all rabbit_writer.erl files and check that they export
start_link/4 (not 3 or 5)
4) rebuild and run your test


Regards,

Matthias.

From vlad at rabbitmq.com  Wed Sep  1 15:53:03 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 15:53:03 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
	<4C7E5FBA.6020401@rabbitmq.com>
	<234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>
Message-ID: <4C7E68CF.6020105@rabbitmq.com>


Jon,


It seems you found a bug. Thank you for that.

Still, you are not using version 2.0.0, since this bug does not 
reproduce in 2.0.0.
Can you try the series of commands:

$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
$ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
$ cd rabbitmq-erlang-client
$ make test_network

After these, you should get a "dist" folder in the rabbitmq-erlang-client which contains the two .ez files. By looking inside these, you could deduce what source files you would need (from the generated .beam file names). If you then grab the source files from rabbitmq-server/src and rabbitmq-erlang-client/src (*after* having done the build) plus the includes, you should be fine.


Rgds,
Vlad.



On 09/01/2010 03:23 PM, Jon Brisbin wrote:
> Doing make test_network in the public-umbrella which I checked and using fresh checkouts out gives this error on Mac OS X 10.6.4 with macports Erlang installed (Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-poll:false]):
>
> +-( ~/src/rabbitmq-2.0/rabbitmq-erlang-client ):>  make test_network
> uname: illegal option -- o
> usage: uname [-amnprsv]
> make -C test
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info amqp_dbg.erl
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info direct_client_SUITE.erl
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info negative_test_util.erl
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info network_client_SUITE.erl
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info ssl_client_SUITE.erl
> ERL_LIBS=../deps erlc -I ../include -o ./ -Wall -v +debug_info test_util.erl
> make run_test_broker RUN_TEST_BROKER_ARGS="-s network_client_SUITE test"
> uname: illegal option -- o
> usage: uname [-amnprsv]
> make -C ../rabbitmq-server start-background-node
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-/" RABBITMQ_MNESIA_DIR="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-//rabbitmq-rabbit-mnesia" \
> 		RABBITMQ_NODE_ONLY=true \
> 		RABBITMQ_SERVER_START_ARGS=" -detached" \
> 		./scripts/rabbitmq-server ; sleep 1
> make -C ../rabbitmq-server start-rabbit-on-node
> echo "rabbit:start()." | erl_call -sname rabbit -e
> /bin/sh: erl_call: command not found
> make[2]: *** [start-rabbit-on-node] Error 127
> make[1]: *** [boot_broker] Error 2
> make: *** [test_network] Error 2
>
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> On Sep 1, 2010, at 9:14 AM, Vlad Alexandru Ionescu wrote:
>
>    
>> Hi Jon,
>>
>>
>> Doing
>>
>> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
>> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
>> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
>> $ cd rabbitmq-erlang-client
>> $ make test_network
>>
>> works for me: "All 29 tests passed." Does it work for you?
>>
>>
>> Rgds,
>> Vlad.
>>
>>      
>    

From jon.brisbin at npcinternational.com  Wed Sep  1 16:11:13 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 1 Sep 2010 10:11:13 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7E68CF.6020105@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
	<4C7E5FBA.6020401@rabbitmq.com>
	<234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>
	<4C7E68CF.6020105@rabbitmq.com>
Message-ID: <47A221B7-13A7-49A7-BC81-623C54777358@npcinternational.com>

On Sep 1, 2010, at 9:53 AM, Vlad Alexandru Ionescu wrote:

> 
> Jon,
> 
> 
> It seems you found a bug. Thank you for that.
> 
> Still, you are not using version 2.0.0, since this bug does not reproduce in 2.0.0.
> Can you try the series of commands:
> 
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
> $ hg clone -u rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
> $ cd rabbitmq-erlang-client
> $ make test_network

I don't remember if I put it in the last email or not but I also tried these commands in a separate directory from the umbrella checkout and got the same error:

...
make run_test_broker RUN_TEST_BROKER_ARGS="-s network_client_SUITE test"
make -C ../rabbitmq-server start-background-node
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-/" RABBITMQ_MNESIA_DIR="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-//rabbitmq-rabbit-mnesia" \
		RABBITMQ_NODE_ONLY=true \
		RABBITMQ_SERVER_START_ARGS=" -detached" \
		./scripts/rabbitmq-server ; sleep 1
make -C ../rabbitmq-server start-rabbit-on-node
echo "rabbit:start()." | erl_call -sname rabbit -e
/bin/sh: erl_call: command not found
make[2]: *** [start-rabbit-on-node] Error 127
make[1]: *** [boot_broker] Error 2
make: *** [test_network] Error 2


> 
> After these, you should get a "dist" folder in the rabbitmq-erlang-client which contains the two .ez files. By looking inside these, you could deduce what source files you would need (from the generated .beam file names). If you then grab the source files from rabbitmq-server/src and rabbitmq-erlang-client/src (*after* having done the build) plus the includes, you should be fine.
> 

I'm giving up for the time being. Too much to do to mess around with this today. :/

I know I can do this Java and I know it works because I've already got a nice event-based SQL executor. I just need to send it a bunch of messages to use it as a load tester.

I'll re-visit this in a couple days because I still want to get the remote erlang client going for another project where I'll be sending messages from a Nitrogen-based web app.

jb


From vlad at rabbitmq.com  Wed Sep  1 16:16:56 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 01 Sep 2010 16:16:56 +0100
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <47A221B7-13A7-49A7-BC81-623C54777358@npcinternational.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
	<4C7E5FBA.6020401@rabbitmq.com>
	<234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>
	<4C7E68CF.6020105@rabbitmq.com>
	<47A221B7-13A7-49A7-BC81-623C54777358@npcinternational.com>
Message-ID: <4C7E6E68.7040209@rabbitmq.com>


Jon,


On 09/01/2010 04:11 PM, Jon Brisbin wrote:
> ...
> make run_test_broker RUN_TEST_BROKER_ARGS="-s network_client_SUITE test"
> make -C ../rabbitmq-server start-background-node
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-/" RABBITMQ_MNESIA_DIR="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-//rabbitmq-rabbit-mnesia" \
> 		RABBITMQ_NODE_ONLY=true \
> 		RABBITMQ_SERVER_START_ARGS=" -detached" \
> 		./scripts/rabbitmq-server ; sleep 1
> make -C ../rabbitmq-server start-rabbit-on-node
> echo "rabbit:start()." | erl_call -sname rabbit -e
> /bin/sh: erl_call: command not found
> make[2]: *** [start-rabbit-on-node] Error 127
> make[1]: *** [boot_broker] Error 2
> make: *** [test_network] Error 2
>
>    

No, this is a /completely/ different error :) .
That means you don't have erl_call in your path. It is usually under 
$ERL_TOP/lib/erl_interface-3.7/bin (version may vary). You have to add 
that to your PATH env var.


Rgds,
Vlad.


From frank.goenninger at consequor.de  Wed Sep  1 16:17:56 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Wed, 1 Sep 2010 17:17:56 +0200
Subject: [rabbitmq-discuss] Cannot start RabbitMQ 2.0.0 server on Windows 7
	Ultimate 64 bit
Message-ID: <C9BAEABF-DF77-4DED-AE3C-E2CFE263D904@consequor.de>

Hi all:

I am trying to start my fresh 2.0.0 installation of RabbitMQ. I am using Erlang OTP R14A.

I have installed Erlang in

/opt/ccag/langtools/erlang/erl-5.8

and have set my paths accordingly:

-X-X-X- FILE: pib-env.bat -X-X-X-

REM ===================================================================
REM  CCAG PIB ENV SETTINGS
REM ===================================================================
REM  Version A.01.01

REM --- CCAG PATHS ---

set CCAG_ROOT=/opt/ccag
set CCAG_BIN=%CCAG_ROOT%/bin
set CCAG_DATA_ROOT=/var/opt/ccag/data

set LANGTOOLS_ROOT=%CCAG_ROOT%/langtools

set ERL_ROOT=%LANGTOOLS_ROOT%/erlang/erl5.8
set ERL_BIN=%ERL_ROOT%/bin

set RABBITMQ_ROOT=%CCAG_ROOT%/rabbitmq
set RABBITMQ_SERVER_ROOT=%RABBITMQ_ROOT%/rabbitmq-server-windows-2.0.0

set RABBITMQ_SERVER_SBIN=%RABBITMQ_SERVER_ROOT%/sbin

REM --- ERLANG ENV VARS ---

set ERLANG_HOME=%ERL_ROOT%

REM --- RABBITMQ ENV VARS ---

set RABBITMQ_SERVICENAME=RabbitMQ_PIB
set RABBITMQ_BASE=%CCAG_DATA_ROOT%/pib/rabbitmq-data
set RABBITMQ_MNESIA_BASE=%RABBITMQ_BASE%/db
set RABBITMQ_LOG_BASE=%RABBITMQ_BASE%/log
set RABBITMQ_CONFIG_FILE=%RABBITMQ_BASE/rabbitmq
set RABBITMQ_NODENAME=ideal
set RABBITMQ_NODE_IP_ADDRESS=127.0.0.1
set RABBITMQ_NODE_PORT=5672
set ERLANG_SERVICE_MANAGER_PATH=%ERL_ROOT%/erts-5.8/bin
REM set RABBITMQ_CLUSTER_CONFIG_FILE
set RABBITMQ_CONSOLE_LOG=new

PATH=%PATH%;%CCAG_BIN%;%ERL_BIN%;%RABBITMQ_SERVER_SBIN%

-X-X-X- END OF FILE -X-X-X-

I am sitting in the sbin directory of RabbitMQ Server and try to start rabbitmq-server.bat :

C:\opt\ccag\rabbitmq\rabbitmq_server-2.0.0\sbin > rabbitmq-server.bat

This results in the following error:

Activating RabbitMQ plugins ...
0 plugins activated:

{"init terminating in do_boot",{'cannot get bootfile','/var/opt/ccag/data/rabbitmq-data/db/ideal-mnesia\\plugins-scratch\\rabbit.boot'}}

Crash dump was written to: erl_crash.dumo
init terminating in do_boot ()

Needless to say: The rabbit.boot file is there (it gets created during first run). The rabbit.res file has the following contents (this file also gets created):

{release,{"rabbit","2.0.0"},
         {erts,"5.8"},
         [{mnesia,"4.4.14"},
          {stdlib,"1.17"},
          {rabbit,"2.0.0"},
          {kernel,"2.14"},
          {sasl,"2.1.9.2"},
          {os_mon,"2.2.5"}]}

The rabbit.script file contains:

%% script generated at {2010,9,1} {17,9,54}
{script,
    {"rabbit","2.0.0"},
    [{preLoaded,
         [erl_prim_loader,erlang,init,otp_ring0,prim_file,prim_inet,prim_zip,
          zlib]},
     {progress,preloaded},
     {path,
         ["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/kernel-2.14/ebin",
          "c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/stdlib-1.17/ebin"]},
     {primLoad,[error_handler]},
     {kernel_load_completed},
     {progress,kernel_load_completed},
     {path,["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/kernel-2.14/ebin"]},
     {primLoad,
         [application,application_controller,application_master,
          application_starter,auth,code,code_server,disk_log,disk_log_1,
          disk_log_server,disk_log_sup,dist_ac,dist_util,erl_boot_server,
          erl_ddll,erl_distribution,erl_epmd,erl_reply,error_logger,
          erts_debug,file,file_io_server,file_server,gen_sctp,gen_tcp,gen_udp,
          global,global_group,global_search,group,heart,hipe_unified_loader,
          inet,inet6_sctp,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,
          inet_db,inet_dns,inet_gethost_native,inet_hosts,inet_parse,inet_res,
          inet_sctp,inet_tcp,inet_tcp_dist,inet_udp,kernel,kernel_config,net,
          net_adm,net_kernel,os,packages,pg2,ram_file,rpc,seq_trace,
          standard_error,user,user_drv,user_sup,wrap_log_reader]},
     {path,["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/stdlib-1.17/ebin"]},
     {primLoad,
         [array,base64,beam_lib,binary,c,calendar,dets,dets_server,dets_sup,
          dets_utils,dets_v8,dets_v9,dict,digraph,digraph_utils,edlin,
          edlin_expand,epp,erl_bits,erl_compile,erl_eval,erl_expand_records,
          erl_internal,erl_lint,erl_parse,erl_posix_msg,erl_pp,erl_scan,
          erl_tar,error_logger_file_h,error_logger_tty_h,escript,ets,
          eval_bits,file_sorter,filelib,filename,gb_sets,gb_trees,gen,
          gen_event,gen_fsm,gen_server,io,io_lib,io_lib_format,io_lib_fread,
          io_lib_pretty,lib,lists,log_mf_h,math,ms_transform,orddict,ordsets,
          otp_internal,pg,pool,proc_lib,proplists,qlc,qlc_pt,queue,random,re,
          regexp,sets,shell,shell_default,slave,sofs,string,supervisor,
          supervisor_bridge,sys,timer,unicode,win32reg,zip]},
     {path,["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/mnesia-4.4.14/ebin"]},
     {primLoad,
         [mnesia,mnesia_backup,mnesia_bup,mnesia_checkpoint,
          mnesia_checkpoint_sup,mnesia_controller,mnesia_dumper,mnesia_event,
          mnesia_frag,mnesia_frag_hash,mnesia_frag_old_hash,mnesia_index,
          mnesia_kernel_sup,mnesia_late_loader,mnesia_lib,mnesia_loader,
          mnesia_locker,mnesia_log,mnesia_monitor,mnesia_recover,
          mnesia_registry,mnesia_schema,mnesia_snmp_hook,mnesia_snmp_sup,
          mnesia_sp,mnesia_subscr,mnesia_sup,mnesia_text,mnesia_tm]},
     {path,["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/sasl-2.1.9.2/ebin"]},
     {primLoad,
         [alarm_handler,erlsrv,format_lib_supp,misc_supp,overload,rb,
          rb_format_supp,release_handler,release_handler_1,sasl,sasl_report,
          sasl_report_file_h,sasl_report_tty_h,si,si_sasl_supp,systools,
          systools_lib,systools_make,systools_rc,systools_relup]},
     {path,["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/os_mon-2.2.5/ebin"]},
     {primLoad,
         [cpu_sup,disksup,memsup,nteventlog,os_mon,os_mon_mib,os_mon_sysinfo,
          os_sup]},
     {path,["c:/opt/ccag/rabbitmq/rabbitmq_server-2.0.0/sbin/../ebin"]},
     {primLoad,
         [bpqueue,delegate,delegate_sup,file_handle_cache,gatherer,
          gen_server2,pg_local,priority_queue,rabbit,rabbit_access_control,
          rabbit_alarm,rabbit_amqqueue,rabbit_amqqueue_process,
          rabbit_amqqueue_sup,rabbit_backing_queue,rabbit_basic,
          rabbit_binary_generator,rabbit_binary_parser,rabbit_channel,
          rabbit_control,rabbit_ctl_usage,rabbit_dialyzer,rabbit_error_logger,
          rabbit_error_logger_file_h,rabbit_event,rabbit_exchange,
          rabbit_exchange_type,rabbit_exchange_type_direct,
          rabbit_exchange_type_fanout,rabbit_exchange_type_headers,
          rabbit_exchange_type_registry,rabbit_exchange_type_topic,
          rabbit_framing_amqp_0_8,rabbit_framing_amqp_0_9_1,
          rabbit_framing_channel,rabbit_guid,rabbit_heartbeat,rabbit_hooks,
          rabbit_invariable_queue,rabbit_limiter,rabbit_load,rabbit_log,
          rabbit_memory_monitor,rabbit_misc,rabbit_mnesia,rabbit_msg_file,
          rabbit_msg_store,rabbit_msg_store_ets_index,rabbit_msg_store_gc,
          rabbit_msg_store_index,rabbit_multi,rabbit_multi_usage,rabbit_net,
          rabbit_networking,rabbit_node_monitor,rabbit_persister,
          rabbit_plugin_activator,rabbit_queue_collector,rabbit_queue_index,
          rabbit_reader,rabbit_restartable_sup,rabbit_router,
          rabbit_sasl_report_file_h,rabbit_sup,rabbit_tests,
          rabbit_tests_event_receiver,rabbit_tracer,rabbit_types,
          rabbit_variable_queue,rabbit_writer,supervisor2,tcp_acceptor,
          tcp_acceptor_sup,tcp_client_sup,tcp_listener,tcp_listener_sup,
          test_sup,vm_memory_monitor,worker_pool,worker_pool_sup,
          worker_pool_worker]},
     {progress,modules_loaded},
     {path,
         ["c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/kernel-2.14/ebin",
          "c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/stdlib-1.17/ebin",
          "c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/mnesia-4.4.14/ebin",
          "c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/sasl-2.1.9.2/ebin",
          "c:/opt/ccag/LANGTO~1/erlang/erl5.8/lib/os_mon-2.2.5/ebin",
          "c:/opt/ccag/rabbitmq/rabbitmq_server-2.0.0/sbin/../ebin"]},
     {kernelProcess,heart,{heart,start,[]}},
     {kernelProcess,error_logger,{error_logger,start_link,[]}},
     {kernelProcess,application_controller,
         {application_controller,start,
             [{application,kernel,
                  [{description,"ERTS  CXC 138 10"},
                   {vsn,"2.14"},
                   {id,[]},
                   {modules,
                       [application,application_controller,application_master,
                        application_starter,auth,code,packages,code_server,
                        dist_util,erl_boot_server,erl_distribution,erl_reply,
                        error_handler,error_logger,file,file_server,
                        file_io_server,global,global_group,global_search,
                        group,heart,hipe_unified_loader,inet6_tcp,
                        inet6_tcp_dist,inet6_udp,inet6_sctp,inet_config,
                        inet_hosts,inet_gethost_native,inet_tcp_dist,kernel,
                        kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,
                        user,user_drv,user_sup,disk_log,disk_log_1,
                        disk_log_server,disk_log_sup,dist_ac,erl_ddll,
                        erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,inet,
                        inet_db,inet_dns,inet_parse,inet_res,inet_tcp,
                        inet_udp,inet_sctp,pg2,seq_trace,standard_error,
                        wrap_log_reader]},
                   {registered,
                       [application_controller,erl_reply,auth,boot_server,
                        code_server,disk_log_server,disk_log_sup,
                        erl_prim_loader,error_logger,file_server_2,
                        fixtable_server,global_group,global_name_server,heart,
                        init,kernel_config,kernel_sup,net_kernel,net_sup,rex,
                        user,os_server,ddll_server,erl_epmd,inet_db,pg2]},
                   {applications,[]},
                   {included_applications,[]},
                   {env,[{error_logger,tty}]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity},
                   {mod,{kernel,[]}}]}]}},
     {progress,init_kernel_started},
     {apply,
         {application,load,
             [{application,stdlib,
                  [{description,"ERTS  CXC 138 10"},
                   {vsn,"1.17"},
                   {id,[]},
                   {modules,
                       [array,base64,beam_lib,binary,c,calendar,dets,
                        dets_server,dets_sup,dets_utils,dets_v8,dets_v9,dict,
                        digraph,digraph_utils,edlin,edlin_expand,epp,
                        eval_bits,erl_bits,erl_compile,erl_eval,
                        erl_expand_records,erl_internal,erl_lint,erl_parse,
                        erl_posix_msg,erl_pp,erl_scan,erl_tar,
                        error_logger_file_h,error_logger_tty_h,escript,ets,
                        file_sorter,filelib,filename,gb_trees,gb_sets,gen,
                        gen_event,gen_fsm,gen_server,io,io_lib,io_lib_format,
                        io_lib_fread,io_lib_pretty,lib,lists,log_mf_h,math,
                        ms_transform,orddict,ordsets,otp_internal,pg,pool,
                        proc_lib,proplists,qlc,qlc_pt,queue,random,re,regexp,
                        sets,shell,shell_default,slave,sofs,string,supervisor,
                        supervisor_bridge,sys,timer,unicode,win32reg,zip]},
                   {registered,
                       [timer_server,rsh_starter,take_over_monitor,
                        pool_master,dets]},
                   {applications,[kernel]},
                   {included_applications,[]},
                   {env,[]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity}]}]}},
     {apply,
         {application,load,
             [{application,mnesia,
                  [{description,"MNESIA  CXC 138 12"},
                   {vsn,"4.4.14"},
                   {id,[]},
                   {modules,
                       [mnesia,mnesia_backup,mnesia_bup,mnesia_checkpoint,
                        mnesia_checkpoint_sup,mnesia_controller,mnesia_dumper,
                        mnesia_event,mnesia_frag,mnesia_frag_hash,
                        mnesia_frag_old_hash,mnesia_index,mnesia_kernel_sup,
                        mnesia_late_loader,mnesia_lib,mnesia_loader,
                        mnesia_locker,mnesia_log,mnesia_monitor,
                        mnesia_recover,mnesia_registry,mnesia_schema,
                        mnesia_snmp_hook,mnesia_snmp_sup,mnesia_subscr,
                        mnesia_sup,mnesia_sp,mnesia_text,mnesia_tm]},
                   {registered,
                       [mnesia_dumper_load_regulator,mnesia_event,
                        mnesia_fallback,mnesia_controller,mnesia_kernel_sup,
                        mnesia_late_loader,mnesia_locker,mnesia_monitor,
                        mnesia_recover,mnesia_substr,mnesia_sup,mnesia_tm]},
                   {applications,[kernel,stdlib]},
                   {included_applications,[]},
                   {env,[]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity},
                   {mod,{mnesia_sup,[]}}]}]}},
     {apply,
         {application,load,
             [{application,sasl,
                  [{description,"SASL  CXC 138 11"},
                   {vsn,"2.1.9.2"},
                   {id,[]},
                   {modules,
                       [sasl,alarm_handler,format_lib_supp,misc_supp,overload,
                        rb,rb_format_supp,release_handler,release_handler_1,
                        erlsrv,sasl_report,sasl_report_tty_h,
                        sasl_report_file_h,si,si_sasl_supp,systools,
                        systools_make,systools_rc,systools_relup,
                        systools_lib]},
                   {registered,
                       [sasl_sup,alarm_handler,overload,release_handler]},
                   {applications,[kernel,stdlib]},
                   {included_applications,[]},
                   {env,[{sasl_error_logger,tty},{errlog_type,all}]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity},
                   {mod,{sasl,[]}}]}]}},
     {apply,
         {application,load,
             [{application,os_mon,
                  [{description,"CPO  CXC 138 46"},
                   {vsn,"2.2.5"},
                   {id,[]},
                   {modules,
                       [os_mon,os_mon_mib,os_sup,disksup,memsup,cpu_sup,
                        os_mon_sysinfo,nteventlog]},
                   {registered,
                       [os_mon_sup,os_mon_sysinfo,disksup,memsup,cpu_sup,
                        os_sup_server]},
                   {applications,[kernel,stdlib,sasl]},
                   {included_applications,[]},
                   {env,
                       [{start_cpu_sup,true},
                        {start_disksup,true},
                        {start_memsup,true},
                        {start_os_sup,false}]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity},
                   {mod,{os_mon,[]}}]}]}},
     {apply,
         {application,load,
             [{application,rabbit,
                  [{description,"RabbitMQ"},
                   {vsn,"2.0.0"},
                   {id,"RabbitMQ"},
                   {modules,
                       [bpqueue,delegate,delegate_sup,file_handle_cache,
                        gatherer,gen_server2,pg_local,priority_queue,rabbit,
                        rabbit_access_control,rabbit_alarm,rabbit_amqqueue,
                        rabbit_amqqueue_process,rabbit_amqqueue_sup,
                        rabbit_backing_queue,rabbit_basic,
                        rabbit_binary_generator,rabbit_binary_parser,
                        rabbit_channel,rabbit_control,rabbit_ctl_usage,
                        rabbit_dialyzer,rabbit_error_logger,
                        rabbit_error_logger_file_h,rabbit_event,
                        rabbit_exchange,rabbit_exchange_type,
                        rabbit_exchange_type_direct,
                        rabbit_exchange_type_fanout,
                        rabbit_exchange_type_headers,
                        rabbit_exchange_type_registry,
                        rabbit_exchange_type_topic,rabbit_framing_amqp_0_8,
                        rabbit_framing_amqp_0_9_1,rabbit_framing_channel,
                        rabbit_guid,rabbit_heartbeat,rabbit_hooks,
                        rabbit_invariable_queue,rabbit_limiter,rabbit_load,
                        rabbit_log,rabbit_memory_monitor,rabbit_misc,
                        rabbit_mnesia,rabbit_msg_file,rabbit_msg_store,
                        rabbit_msg_store_ets_index,rabbit_msg_store_gc,
                        rabbit_msg_store_index,rabbit_multi,
                        rabbit_multi_usage,rabbit_net,rabbit_networking,
                        rabbit_node_monitor,rabbit_persister,
                        rabbit_plugin_activator,rabbit_queue_collector,
                        rabbit_queue_index,rabbit_reader,
                        rabbit_restartable_sup,rabbit_router,
                        rabbit_sasl_report_file_h,rabbit_sup,rabbit_tests,
                        rabbit_tests_event_receiver,rabbit_tracer,
                        rabbit_types,rabbit_variable_queue,rabbit_writer,
                        supervisor2,tcp_acceptor,tcp_acceptor_sup,
                        tcp_client_sup,tcp_listener,tcp_listener_sup,test_sup,
                        vm_memory_monitor,worker_pool,worker_pool_sup,
                        worker_pool_worker]},
                   {registered,
                       [rabbit_amqqueue_sup,rabbit_log,rabbit_node_monitor,
                        rabbit_persister,rabbit_router,rabbit_sup,
                        rabbit_tcp_client_sup]},
                   {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
                   {included_applications,[]},
                   {env,
                       [{tcp_listeners,[{"0.0.0.0",5672}]},
                        {ssl_listeners,[]},
                        {ssl_options,[]},
                        {vm_memory_high_watermark,0.4},
                        {msg_store_index_module,rabbit_msg_store_ets_index},
                        {backing_queue_module,rabbit_variable_queue},
                        {persister_max_wrap_entries,500},
                        {persister_hibernate_after,10000},
                        {msg_store_file_size_limit,16777216},
                        {queue_index_max_journal_entries,262144},
                        {default_user,<<"guest">>},
                        {default_pass,<<"guest">>},
                        {default_vhost,<<"/">>},
                        {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
                        {collect_statistics,none}]},
                   {start_phases,undefined},
                   {maxT,infinity},
                   {maxP,infinity},
                   {mod,{rabbit,[]}}]}]}},
     {progress,applications_loaded},
     {apply,{application,start_boot,[kernel,permanent]}},
     {apply,{application,start_boot,[stdlib,permanent]}},
     {apply,{rabbit,prepare,[]}},
     {apply,{application,start_boot,[mnesia,permanent]}},
     {apply,{application,start_boot,[sasl,permanent]}},
     {apply,{application,start_boot,[os_mon,permanent]}},
     {apply,{application,start_boot,[rabbit,permanent]}},
     {apply,{c,erlangrc,[]}},
     {progress,started}]}.

This looks good for me ... so: Help!

TIA!!

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From emile at rabbitmq.com  Wed Sep  1 16:44:48 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Sep 2010 16:44:48 +0100
Subject: [rabbitmq-discuss] Cannot start RabbitMQ 2.0.0 server on
 Windows 7	Ultimate 64 bit
In-Reply-To: <C9BAEABF-DF77-4DED-AE3C-E2CFE263D904@consequor.de>
References: <C9BAEABF-DF77-4DED-AE3C-E2CFE263D904@consequor.de>
Message-ID: <4C7E74F0.6030100@rabbitmq.com>

Hi Frank,

On 01/09/10 16:17, Frank G?nninger wrote:
> Hi all:
> 
> I am trying to start my fresh 2.0.0 installation of RabbitMQ. I am using Erlang OTP R14A.
> 
> I have installed Erlang in
> 
> /opt/ccag/langtools/erlang/erl-5.8
> 
> and have set my paths accordingly:
> 
> -X-X-X- FILE: pib-env.bat -X-X-X-
> 
> REM ===================================================================
> REM  CCAG PIB ENV SETTINGS
> REM ===================================================================
> REM  Version A.01.01
> 
> REM --- CCAG PATHS ---
> 
> set CCAG_ROOT=/opt/ccag
> set CCAG_BIN=%CCAG_ROOT%/bin
> set CCAG_DATA_ROOT=/var/opt/ccag/data
> 
> set LANGTOOLS_ROOT=%CCAG_ROOT%/langtools
> 
> set ERL_ROOT=%LANGTOOLS_ROOT%/erlang/erl5.8
> set ERL_BIN=%ERL_ROOT%/bin
> 
> set RABBITMQ_ROOT=%CCAG_ROOT%/rabbitmq


Thanks for your detailed error report. I assume you are not using
cygwin. (If you are then you now have a c:/var folder, which you can
delete.)

The solution is to use c:/opt and c:/var instead of /opt and /var in
your CCAG_* variables, or at least for RABBITMQ_ROOT. If you have cygwin
available then the cygpath utility will do something similar when given
the "-m" parameter.

Regards

Emile



From jon.brisbin at npcinternational.com  Wed Sep  1 16:46:20 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 1 Sep 2010 10:46:20 -0500
Subject: [rabbitmq-discuss] erlang client blowing chunks
In-Reply-To: <4C7E6E68.7040209@rabbitmq.com>
References: <F39CB84D-1DD7-4B0D-A0B7-1B6B25B805F1@npcinternational.com>	<DE204BF0-CB6F-4F9C-AE4A-1F662C7D2848@npcinternational.com>	<4C7D76C7.3040201@rabbitmq.com>	<066F56AA-9EF6-4DFE-ADF4-084EC985ABFE@npcinternational.com>	<4C7D7B15.6060106@rabbitmq.com>	<10EAA3B2-10A1-4220-BF20-368ECCE84C23@jbrisbin.com>	<4C7DC820.4040204@rabbitmq.com>
	<AE524239-32F4-4D01-8E25-66E34A37933D@npcinternational.com>
	<4C7E5FBA.6020401@rabbitmq.com>
	<234260F9-F600-44B2-9BDA-D7CB398F285B@npcinternational.com>
	<4C7E68CF.6020105@rabbitmq.com>
	<47A221B7-13A7-49A7-BC81-623C54777358@npcinternational.com>
	<4C7E6E68.7040209@rabbitmq.com>
Message-ID: <EB01E2C5-91D4-481A-8DFD-75360198F5E6@npcinternational.com>



On Sep 1, 2010, at 10:16 AM, Vlad Alexandru Ionescu wrote:

> 
> Jon,
> 
> 
> On 09/01/2010 04:11 PM, Jon Brisbin wrote:
>> ...
>> make run_test_broker RUN_TEST_BROKER_ARGS="-s network_client_SUITE test"
>> make -C ../rabbitmq-server start-background-node
>> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-/" RABBITMQ_MNESIA_DIR="/var/folders/+E/+EAa1V61EkOEVs83Nv6vbU+++TI/-Tmp-//rabbitmq-rabbit-mnesia" \
>> 		RABBITMQ_NODE_ONLY=true \
>> 		RABBITMQ_SERVER_START_ARGS=" -detached" \
>> 		./scripts/rabbitmq-server ; sleep 1
>> make -C ../rabbitmq-server start-rabbit-on-node
>> echo "rabbit:start()." | erl_call -sname rabbit -e
>> /bin/sh: erl_call: command not found
>> make[2]: *** [start-rabbit-on-node] Error 127
>> make[1]: *** [boot_broker] Error 2
>> make: *** [test_network] Error 2
>> 
>>   
> 
> No, this is a /completely/ different error :) .
> That means you don't have erl_call in your path. It is usually under $ERL_TOP/lib/erl_interface-3.7/bin (version may vary). You have to add that to your PATH env var.

Sorry for not being clear. I meant that either checking out the umbrella and updating the Makefile to use the 2.0 tag or checking the three dependent projects individually using the same tag results in the same build failure. I didn't mean to say that this error was related to the problem connecting to a 2.0 broker. I'm getting hasty today. :)

Either way, I was not able to successfully build the erlang client and use it to connect to a 2.0 broker (installed using the rabbitmq apt repository) on my Linux box from a standalone OTP application.

Jon Brisbin
Portal Webmaster
NPC International, Inc.


> 
> 
> Rgds,
> Vlad.
> 


From frank.goenninger at consequor.de  Wed Sep  1 16:55:18 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Wed, 1 Sep 2010 17:55:18 +0200
Subject: [rabbitmq-discuss] Cannot start RabbitMQ 2.0.0 server on
 Windows 7	Ultimate 64 bit
In-Reply-To: <4C7E74F0.6030100@rabbitmq.com>
References: <C9BAEABF-DF77-4DED-AE3C-E2CFE263D904@consequor.de>
	<4C7E74F0.6030100@rabbitmq.com>
Message-ID: <259B82C8-C135-4240-A7ED-8966094F12B4@consequor.de>

Thanks, Emile - works now!

(it shows I am coming from a Unix background ... ;-)


Am 01.09.2010 um 17:44 schrieb Emile Joubert:

> Hi Frank,
> 
> On 01/09/10 16:17, Frank G?nninger wrote:
>> Hi all:
>> 
>> I am trying to start my fresh 2.0.0 installation of RabbitMQ. I am using Erlang OTP R14A.
>> 
>> I have installed Erlang in
>> 
>> /opt/ccag/langtools/erlang/erl-5.8
>> 
>> and have set my paths accordingly:
>> 
>> -X-X-X- FILE: pib-env.bat -X-X-X-
>> 
>> REM ===================================================================
>> REM  CCAG PIB ENV SETTINGS
>> REM ===================================================================
>> REM  Version A.01.01
>> 
>> REM --- CCAG PATHS ---
>> 
>> set CCAG_ROOT=/opt/ccag
>> set CCAG_BIN=%CCAG_ROOT%/bin
>> set CCAG_DATA_ROOT=/var/opt/ccag/data
>> 
>> set LANGTOOLS_ROOT=%CCAG_ROOT%/langtools
>> 
>> set ERL_ROOT=%LANGTOOLS_ROOT%/erlang/erl5.8
>> set ERL_BIN=%ERL_ROOT%/bin
>> 
>> set RABBITMQ_ROOT=%CCAG_ROOT%/rabbitmq
> 
> 
> Thanks for your detailed error report. I assume you are not using
> cygwin. (If you are then you now have a c:/var folder, which you can
> delete.)
> 
> The solution is to use c:/opt and c:/var instead of /opt and /var in
> your CCAG_* variables, or at least for RABBITMQ_ROOT. If you have cygwin
> available then the cygpath utility will do something similar when given
> the "-m" parameter.
> 
> Regards
> 
> Emile
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From sigurd.hogsbro at museeka.com  Wed Sep  1 17:08:38 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 18:08:38 +0200
Subject: [rabbitmq-discuss] pika library: pass channel to channel
	state-change callback?
Message-ID: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>

Sorry if discussion on pika is out of scope of this mailing-list, but I
thought it preferential to mailing Tony directly.

I'm use pika's asyncore programming model, and find it an excellent model
for dealing with connection & channel setup/teardown.

I have an issue on the channel state callback, which currently passes the
ChannelHandler() as a parameter to the callback. As I understand it, the
ChannelHandler() is not an object intended for client app usage, and does
not that I can see provide any methods useful to the client app.

As it works now, I cannot create a function to allocate a channel (using
pika.AsyncoreConnection.channel()) and setup the callbacks (using
channel.addStateChangeHandler()), as the channel state callback is called
before I can store the reference to the returned Channel() object in my
containing object.

By replacing the ChannelHandler() object with the Channel() reference
instead then the obvious channel operations (declaring of queues etc) could
use this parameter and avoid the catch-22 issue.

If there is general agreement to this change I'm happy to commit the
required changes to Github.

Cheers,

Sigurd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/00d18714/attachment.htm>

From alexis at rabbitmq.com  Wed Sep  1 17:12:31 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 1 Sep 2010 17:12:31 +0100
Subject: [rabbitmq-discuss] pika library: pass channel to channel
 state-change callback?
In-Reply-To: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
References: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
Message-ID: <AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>

Sigurd

It's fine and welcome to discuss AMQP clients on this list.  Thank-you for
the email.

I'd stick this on Github where people can see it ;-)

alexis


2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>

> Sorry if discussion on pika is out of scope of this mailing-list, but I
> thought it preferential to mailing Tony directly.
>
> I'm use pika's asyncore programming model, and find it an excellent model
> for dealing with connection & channel setup/teardown.
>
> I have an issue on the channel state callback, which currently passes the
> ChannelHandler() as a parameter to the callback. As I understand it, the
> ChannelHandler() is not an object intended for client app usage, and does
> not that I can see provide any methods useful to the client app.
>
> As it works now, I cannot create a function to allocate a channel (using
> pika.AsyncoreConnection.channel()) and setup the callbacks (using
> channel.addStateChangeHandler()), as the channel state callback is called
> before I can store the reference to the returned Channel() object in my
> containing object.
>
> By replacing the ChannelHandler() object with the Channel() reference
> instead then the obvious channel operations (declaring of queues etc) could
> use this parameter and avoid the catch-22 issue.
>
> If there is general agreement to this change I'm happy to commit the
> required changes to Github.
>
> Cheers,
>
> Sigurd
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/c46dd388/attachment.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 17:14:05 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 18:14:05 +0200
Subject: [rabbitmq-discuss] pika library: pass channel to channel
 state-change callback?
In-Reply-To: <AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>
References: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
	<AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>
Message-ID: <AANLkTinuYZzpYyNB8+77v5HvKZ36tY-eaBQkWKMG5bQu@mail.gmail.com>

OK, so I should raise a ticket against pika on Github?

Sigurd

2010/9/1 Alexis Richardson <alexis at rabbitmq.com>

> Sigurd
>
> It's fine and welcome to discuss AMQP clients on this list.  Thank-you for
> the email.
>
> I'd stick this on Github where people can see it ;-)
>
> alexis
>
>
> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>
>> Sorry if discussion on pika is out of scope of this mailing-list, but I
>> thought it preferential to mailing Tony directly.
>>
>> I'm use pika's asyncore programming model, and find it an excellent model
>> for dealing with connection & channel setup/teardown.
>>
>> I have an issue on the channel state callback, which currently passes the
>> ChannelHandler() as a parameter to the callback. As I understand it, the
>> ChannelHandler() is not an object intended for client app usage, and does
>> not that I can see provide any methods useful to the client app.
>>
>> As it works now, I cannot create a function to allocate a channel (using
>> pika.AsyncoreConnection.channel()) and setup the callbacks (using
>> channel.addStateChangeHandler()), as the channel state callback is called
>> before I can store the reference to the returned Channel() object in my
>> containing object.
>>
>> By replacing the ChannelHandler() object with the Channel() reference
>> instead then the obvious channel operations (declaring of queues etc) could
>> use this parameter and avoid the catch-22 issue.
>>
>> If there is general agreement to this change I'm happy to commit the
>> required changes to Github.
>>
>> Cheers,
>>
>> Sigurd
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/98b95e3c/attachment.htm>

From alexis at rabbitmq.com  Wed Sep  1 17:15:38 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 1 Sep 2010 17:15:38 +0100
Subject: [rabbitmq-discuss] pika library: pass channel to channel
 state-change callback?
In-Reply-To: <AANLkTinuYZzpYyNB8+77v5HvKZ36tY-eaBQkWKMG5bQu@mail.gmail.com>
References: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
	<AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>
	<AANLkTinuYZzpYyNB8+77v5HvKZ36tY-eaBQkWKMG5bQu@mail.gmail.com>
Message-ID: <AANLkTikP+1mnMs1M2hy3Rqet5ifGpUggLJJr+cMJGga9@mail.gmail.com>

sure - why not?

a


2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>

> OK, so I should raise a ticket against pika on Github?
>
> Sigurd
>
> 2010/9/1 Alexis Richardson <alexis at rabbitmq.com>
>
> Sigurd
>>
>> It's fine and welcome to discuss AMQP clients on this list.  Thank-you for
>> the email.
>>
>> I'd stick this on Github where people can see it ;-)
>>
>> alexis
>>
>>
>> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>>
>>>  Sorry if discussion on pika is out of scope of this mailing-list, but I
>>> thought it preferential to mailing Tony directly.
>>>
>>> I'm use pika's asyncore programming model, and find it an excellent model
>>> for dealing with connection & channel setup/teardown.
>>>
>>> I have an issue on the channel state callback, which currently passes the
>>> ChannelHandler() as a parameter to the callback. As I understand it, the
>>> ChannelHandler() is not an object intended for client app usage, and does
>>> not that I can see provide any methods useful to the client app.
>>>
>>> As it works now, I cannot create a function to allocate a channel (using
>>> pika.AsyncoreConnection.channel()) and setup the callbacks (using
>>> channel.addStateChangeHandler()), as the channel state callback is called
>>> before I can store the reference to the returned Channel() object in my
>>> containing object.
>>>
>>> By replacing the ChannelHandler() object with the Channel() reference
>>> instead then the obvious channel operations (declaring of queues etc) could
>>> use this parameter and avoid the catch-22 issue.
>>>
>>> If there is general agreement to this change I'm happy to commit the
>>> required changes to Github.
>>>
>>> Cheers,
>>>
>>> Sigurd
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/ba8afc3e/attachment-0001.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 17:22:56 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 18:22:56 +0200
Subject: [rabbitmq-discuss] pika library: pass channel to channel
 state-change callback?
In-Reply-To: <AANLkTikP+1mnMs1M2hy3Rqet5ifGpUggLJJr+cMJGga9@mail.gmail.com>
References: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
	<AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>
	<AANLkTinuYZzpYyNB8+77v5HvKZ36tY-eaBQkWKMG5bQu@mail.gmail.com>
	<AANLkTikP+1mnMs1M2hy3Rqet5ifGpUggLJJr+cMJGga9@mail.gmail.com>
Message-ID: <AANLkTimmqSt1DWomyVtXDRg_0jZLg27PcR_iPyF1t8p6@mail.gmail.com>

OK, raised as http://github.com/tonyg/pika/issues#issue/16

2010/9/1 Alexis Richardson <alexis at rabbitmq.com>

> sure - why not?
>
> a
>
>
> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>
>> OK, so I should raise a ticket against pika on Github?
>>
>> Sigurd
>>
>> 2010/9/1 Alexis Richardson <alexis at rabbitmq.com>
>>
>> Sigurd
>>>
>>> It's fine and welcome to discuss AMQP clients on this list.  Thank-you
>>> for the email.
>>>
>>> I'd stick this on Github where people can see it ;-)
>>>
>>> alexis
>>>
>>>
>>> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>>>
>>>>  Sorry if discussion on pika is out of scope of this mailing-list, but I
>>>> thought it preferential to mailing Tony directly.
>>>>
>>>> I'm use pika's asyncore programming model, and find it an excellent
>>>> model for dealing with connection & channel setup/teardown.
>>>>
>>>> I have an issue on the channel state callback, which currently passes
>>>> the ChannelHandler() as a parameter to the callback. As I understand it, the
>>>> ChannelHandler() is not an object intended for client app usage, and does
>>>> not that I can see provide any methods useful to the client app.
>>>>
>>>> As it works now, I cannot create a function to allocate a channel (using
>>>> pika.AsyncoreConnection.channel()) and setup the callbacks (using
>>>> channel.addStateChangeHandler()), as the channel state callback is called
>>>> before I can store the reference to the returned Channel() object in my
>>>> containing object.
>>>>
>>>> By replacing the ChannelHandler() object with the Channel() reference
>>>> instead then the obvious channel operations (declaring of queues etc) could
>>>> use this parameter and avoid the catch-22 issue.
>>>>
>>>> If there is general agreement to this change I'm happy to commit the
>>>> required changes to Github.
>>>>
>>>> Cheers,
>>>>
>>>> Sigurd
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/84f97628/attachment.htm>

From sigurd.hogsbro at museeka.com  Wed Sep  1 17:22:56 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Wed, 1 Sep 2010 18:22:56 +0200
Subject: [rabbitmq-discuss] pika library: pass channel to channel
 state-change callback?
In-Reply-To: <AANLkTikP+1mnMs1M2hy3Rqet5ifGpUggLJJr+cMJGga9@mail.gmail.com>
References: <AANLkTinMYVYMSKx44VM6ZFwwG+kzV9mP-M-LQ3ACh9KW@mail.gmail.com>
	<AANLkTi=x-PJAMqonG+679KEA9Kqn32+Eama1_eZZXkA_@mail.gmail.com>
	<AANLkTinuYZzpYyNB8+77v5HvKZ36tY-eaBQkWKMG5bQu@mail.gmail.com>
	<AANLkTikP+1mnMs1M2hy3Rqet5ifGpUggLJJr+cMJGga9@mail.gmail.com>
Message-ID: <AANLkTimmqSt1DWomyVtXDRg_0jZLg27PcR_iPyF1t8p6@mail.gmail.com>

OK, raised as http://github.com/tonyg/pika/issues#issue/16

2010/9/1 Alexis Richardson <alexis at rabbitmq.com>

> sure - why not?
>
> a
>
>
> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>
>> OK, so I should raise a ticket against pika on Github?
>>
>> Sigurd
>>
>> 2010/9/1 Alexis Richardson <alexis at rabbitmq.com>
>>
>> Sigurd
>>>
>>> It's fine and welcome to discuss AMQP clients on this list.  Thank-you
>>> for the email.
>>>
>>> I'd stick this on Github where people can see it ;-)
>>>
>>> alexis
>>>
>>>
>>> 2010/9/1 Sigurd H?gsbro <sigurd.hogsbro at museeka.com>
>>>
>>>>  Sorry if discussion on pika is out of scope of this mailing-list, but I
>>>> thought it preferential to mailing Tony directly.
>>>>
>>>> I'm use pika's asyncore programming model, and find it an excellent
>>>> model for dealing with connection & channel setup/teardown.
>>>>
>>>> I have an issue on the channel state callback, which currently passes
>>>> the ChannelHandler() as a parameter to the callback. As I understand it, the
>>>> ChannelHandler() is not an object intended for client app usage, and does
>>>> not that I can see provide any methods useful to the client app.
>>>>
>>>> As it works now, I cannot create a function to allocate a channel (using
>>>> pika.AsyncoreConnection.channel()) and setup the callbacks (using
>>>> channel.addStateChangeHandler()), as the channel state callback is called
>>>> before I can store the reference to the returned Channel() object in my
>>>> containing object.
>>>>
>>>> By replacing the ChannelHandler() object with the Channel() reference
>>>> instead then the obvious channel operations (declaring of queues etc) could
>>>> use this parameter and avoid the catch-22 issue.
>>>>
>>>> If there is general agreement to this change I'm happy to commit the
>>>> required changes to Github.
>>>>
>>>> Cheers,
>>>>
>>>> Sigurd
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100901/84f97628/attachment-0001.htm>

From emile at rabbitmq.com  Wed Sep  1 17:34:40 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Sep 2010 17:34:40 +0100
Subject: [rabbitmq-discuss] Broker accepts self-signed client
 certificate in verify_peer mode
In-Reply-To: <4C63B890.2090208@rabbitmq.com>
References: <20100805102135.19094860wnfezm2o@webmail.active24.cz>	<20100811084106.55876jocvl9p1mo0@webmail.active24.cz>	<4C626F8E.3000007@rabbitmq.com>	<AANLkTik1eiqe8FH_Dnt2Yj+GozJQsrN613yQQT1Ni0SC@mail.gmail.com>	<4C62BE7E.6030306@rabbitmq.com>	<AANLkTikNF+UvE=1vK2qZigmyfoq9zrFWjuetF50ssNUm@mail.gmail.com>	<20100811190431.89194ae463fxnri8@webmail.active24.cz>	<20100811170738.GV29106@rabbitmq.com>	<20100812083152.11144cemudqf0vac@webmail.active24.cz>
	<4C63B890.2090208@rabbitmq.com>
Message-ID: <4C7E80A0.1040709@rabbitmq.com>

On 12/08/10 10:02, Emile Joubert wrote:
> 
> Hi Jiri,
> 
> On 12/08/10 07:31, jiri at krutil.com wrote:
>>> Yes. I assure you this was not the behaviour of Erlang when I wrote the
>>> SSL guide. Unfortunately, a fix is not going to happen in time for the
>>> next release, but we're going to chase the Erlang SSL module authors to
>>> see if there's any reason for this behaviour, and I hope will change it
>>> either in their code or ours. I agree with you that with verify_peer on,
>>> the broker *must not* blindly trust *any* certs without being able to
>>> establish a chain of trust to the presented cert.
>>
>> Hi Matthew,
>>
>> thanks for clarifying this.
>>
>> Do you have a publicly accessible bug tracking system where we could
>> follow this issue and see when is it resolved?
> 
> We don't have a public bug tracker, but I have started a conversation on
> the erlang-questions mailing list which you can follow. Development
> effort that follows from that (if any) will take place on a branch of
> the rabbitmq-server mercurial repository named 'bug23017'.

That should have been bug23107, not bug23017. This bug has now been
merged into default, so building the broker from the latest source will
get you the desired behaviour.

-Emile

From clegnitto at mozilla.com  Wed Sep  1 18:19:36 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 1 Sep 2010 10:19:36 -0700
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <4C7DCAAE.1040301@rabbitmq.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>	<4C7D6AFC.6060805@rabbitmq.com>	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>	<4C7D7432.2050505@rabbitmq.com>	<E7F59343-E4F6-4E81-9B14-4F21BAF45419@mozilla.com>
	<AANLkTikOUuDVkU-k=APTTSyPjk0Ya3iSgx0AYBsbBbOK@mail.gmail.com>
	<4C7DCAAE.1040301@rabbitmq.com>
Message-ID: <35453464-F7AC-4AAA-B91B-BE5C285C3D38@mozilla.com>

Yep, exactly.

Christian

On Aug 31, 2010, at 8:38 PM, Matthias Radestock wrote:

> Scott,
> 
> Scott Brooks wrote:
>> If you are willing to throw away messages when resources are
>> constrained, how hard would it be to store a timestamp when you
>> publish the message, and in your consumer check the age and discard if
>> it's too old.
> 
> I believe in Christian's setup consumers may operate very slowly, or not connect at all for a very long time. Meanwhile messages are piling up at the server, which will eventually hit hard resource limits, namely disk space. So a mechanism is needed for messages to be evicted *in the absence of cooperating consumers*.
> 
> Matthias.


From elij.mx at gmail.com  Wed Sep  1 23:33:18 2010
From: elij.mx at gmail.com (elij)
Date: Wed, 1 Sep 2010 15:33:18 -0700
Subject: [rabbitmq-discuss] sasl_error_logger tty problem on 2.0.0?
In-Reply-To: <4C7CF1A6.50906@rabbitmq.com>
References: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
	<20100825191212.GD8173@wellquite.org> <4C7CF1A6.50906@rabbitmq.com>
Message-ID: <AANLkTi=yF4bk-6tqY_h+q8wv+_WVU6xS4nYfhR1X1ndT@mail.gmail.com>

On Tue, Aug 31, 2010 at 5:12 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 25/08/10 20:12, Matthew Sackman wrote:
>>
>> On Wed, Aug 25, 2010 at 11:55:44AM -0700, elij wrote:
>>>
>>> I tried '-sasl sasl_error_logger tty', and experience the identical
>>> crash as above.
>>
>> Confirmed. I get exactly the same.
>
> The fix for this has just been merged into 'default', so it will be in the
> next release.

Great news.
Thanks Matthias.

From vlad at rabbitmq.com  Thu Sep  2 10:15:59 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 02 Sep 2010 10:15:59 +0100
Subject: [rabbitmq-discuss] sasl_error_logger tty problem on 2.0.0?
In-Reply-To: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
References: <AANLkTikuV8A_WsOMHUCh4cPR8V=FPsu2kqZG6oJyyxGO@mail.gmail.com>
Message-ID: <4C7F6B4F.2030209@rabbitmq.com>


For the time being, you can try the following in 2.0.0:

Use env var:

RABBITMQ_SERVER_START_ARGS="-eval error_logger:tty(true)."

when starting rabbit.


Rgds,
Vlad.


On 08/25/2010 07:55 PM, elij wrote:
> I am testing out rabbitmq-2.0.0, and ran into an odd issue.
> We use rabbitmq and pipe our logs to syslog (with daemontools and a
> logger) from stdout.
> Because of this, we edit the rabbitmq-server script, and remove the
> "-sasl sasl_error_logger" line, which should then default to tty (it
> does on rabbitmq-1.8.x).
>
> However, I am getting this error:
>
> #######
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_log_to_tty,sasl_report_tty_h,not_installed}}},[{rabbit,ensure_working_log_handler,5},{rabbit,ensure_working_log_handlers,0},{rabbit,prepare,0},{init,eval_script,8},{init,do_boot,3}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> #######
>
>
> If I instead specify "-sasl sasl_error_logger false", and thus disable
> sasl logging, it starts up and runs fine.
> I tried '-sasl sasl_error_logger tty', and experience the identical
> crash as above.
>
> Is there a way to get tty output again for sasl error logging?
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From alexis at rabbitmq.com  Thu Sep  2 12:17:50 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 2 Sep 2010 12:17:50 +0100
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozilla Rhino
In-Reply-To: <AANLkTikVw9Zu6xLv-1=to7+wTPDgkJ_Rr9+w0aY8caHc@mail.gmail.com>
References: <AANLkTikVw9Zu6xLv-1=to7+wTPDgkJ_Rr9+w0aY8caHc@mail.gmail.com>
Message-ID: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>

Derek,

How are you getting on with this?  Has it proved useful or have you found
that you need more functionality than you expected?

alexis




On Thu, Aug 19, 2010 at 4:46 AM, Derek Moore <derek.p.moore at gmail.com>wrote:

> I wrote this today at work.  Others may find it useful also.
>
> I wanted what rabbitmqctl seemed to lack, so I wrote this up quick & dirty.
>  It is very simple, no validation, but functional.  I also needed something
> to inject messages for testing purposes.
>
> I run the JavaScript from a shell script called "rabbitutil":
> --
> #!/bin/bash
> java -cp js.jar:commons-io-1.2.jar:rabbitmq-client.jar \
> org.mozilla.javascript.tools.shell.Main rabbitutil.js $@
> --
> and/or jrunscript (which I haven't really tested):
> jrunscript -cp commons-io-1.2.jar:rabbitmq-client.jar rabbitutil.js
>
> Source attached as "rabbitutil.txt", since .js is commonly filtered.
>
> Cheers,
>
> Derek P. Moore
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/cf2c00e2/attachment.htm>

From gperrot at ubikod.com  Thu Sep  2 13:47:55 2010
From: gperrot at ubikod.com (Guillaume Perrot)
Date: Thu, 2 Sep 2010 14:47:55 +0200
Subject: [rabbitmq-discuss] rabbitmq-erlang-client: How to configure
	connection's heartbeat ?
Message-ID: <AANLkTim3zgpoKVRUT=0Z7Vo4n08ouguYN8dW5NqSSnRA@mail.gmail.com>

Hello,
I could'nt figure out how to configure the connection's heartbeat using
rabbitmq-erlang-client.
In the Java lib it was easy to do so by calling
ConnectionParams.setRequestedHeartbeat(), I did not find an equivalent
feature in rabbitmq-erlang-client.
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/17abb056/attachment.htm>

From vlad at rabbitmq.com  Thu Sep  2 13:55:04 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 02 Sep 2010 13:55:04 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client: How to
 configure	connection's heartbeat ?
In-Reply-To: <AANLkTim3zgpoKVRUT=0Z7Vo4n08ouguYN8dW5NqSSnRA@mail.gmail.com>
References: <AANLkTim3zgpoKVRUT=0Z7Vo4n08ouguYN8dW5NqSSnRA@mail.gmail.com>
Message-ID: <4C7F9EA8.2000605@rabbitmq.com>


Hi,


You can use the amqp_connection:start_network/1 function. You pass an 
#amqp_params{heartbeat = TimeoutSec} parameter. For example:

Connection = amqp_connection:start_network(#amqp_params{heartbeat = 5}).

... to start a network connection with 5 seconds heartbeat.

Make sure you include amqp_client.hrl.
There are quite a few things you can tweak through #amqp_params{}.


Rgds,
Vlad.



On 09/02/2010 01:47 PM, Guillaume Perrot wrote:
> Hello,
> I could'nt figure out how to configure the connection's heartbeat 
> using rabbitmq-erlang-client.
> In the Java lib it was easy to do so by calling 
> ConnectionParams.setRequestedHeartbeat(), I did not find an equivalent 
> feature in rabbitmq-erlang-client.
> Thanks in advance.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/9e583065/attachment.htm>

From vlad at rabbitmq.com  Thu Sep  2 14:14:12 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 02 Sep 2010 14:14:12 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client: How to configure
 connection's heartbeat ?
In-Reply-To: <AANLkTi=mxT0MZ+cg-zVqD6Thu-ey=Hyg5qMSyNRdqsZ8@mail.gmail.com>
References: <AANLkTim3zgpoKVRUT=0Z7Vo4n08ouguYN8dW5NqSSnRA@mail.gmail.com>
	<4C7F9EA8.2000605@rabbitmq.com>
	<AANLkTi=mxT0MZ+cg-zVqD6Thu-ey=Hyg5qMSyNRdqsZ8@mail.gmail.com>
Message-ID: <4C7FA324.3090603@rabbitmq.com>


Indeed, upgrading just the client(s) will break things for sure, since 
the clients now speak AMQP 0-9-1.
We do recommend upgrading all clients plus the server to version 2.0.0. 
There are many new features in it; including persistence to disk.
Note that the latest versions of broker and erlang client on default do 
not work together. We are working on fixing it. Use tag rabbitmq_v2_0_0 
instead, if you check source out from hg.


Rgds,
Vlad.


On 09/02/2010 02:03 PM, Guillaume Perrot wrote:
> Hi,
> I already use #amqp_params, but the record definition is missing the 
> heartbeat field:
>
> -record(amqp_params, {username     = <<"guest">>,
>                       password     = <<"guest">>,
>                       virtual_host = <<"/">>,
>                       host         = "localhost",
>                       port         = ?PROTOCOL_PORT,
>                       ssl_options  = none}).
>
> Apparently I use an outdated version of the client (hg clone --rev 
> 825eceaca84c http://hg.rabbitmq.com/rabbitmq-erlang-client/) and I am 
> not sure I can upgrade it without upgrading the server and codegen.
> (hg clone --rev b1089fcc31b7 http://hg.rabbitmq.com/rabbitmq-server/
> hg clone --rev a62e87645861 http://hg.rabbitmq.com/rabbitmq-codegen/)
>
> I'll try to update the whole, hoping migrating from the time rabbitmq 
> implemented the 0.8 version of the spec does not break anything (we 
> also have Java clients to update).
>
> 2010/9/2 Vlad Alexandru Ionescu <vlad at rabbitmq.com 
> <mailto:vlad at rabbitmq.com>>
>
>
>     Hi,
>
>
>     You can use the amqp_connection:start_network/1 function. You pass
>     an #amqp_params{heartbeat = TimeoutSec} parameter. For example:
>
>     Connection = amqp_connection:start_network(#amqp_params{heartbeat
>     = 5}).
>
>     ... to start a network connection with 5 seconds heartbeat.
>
>     Make sure you include amqp_client.hrl.
>     There are quite a few things you can tweak through #amqp_params{}.
>
>
>     Rgds,
>     Vlad.
>
>
>
>
>     On 09/02/2010 01:47 PM, Guillaume Perrot wrote:
>>     Hello,
>>     I could'nt figure out how to configure the connection's heartbeat
>>     using rabbitmq-erlang-client.
>>     In the Java lib it was easy to do so by calling
>>     ConnectionParams.setRequestedHeartbeat(), I did not find an
>>     equivalent feature in rabbitmq-erlang-client.
>>     Thanks in advance.
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>        
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/92307067/attachment.htm>

From david at rabbitmq.com  Thu Sep  2 15:23:06 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 02 Sep 2010 15:23:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com> (Christian
	Legnitto's message of "Tue, 31 Aug 2010 14:16:11 -0700")
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
Message-ID: <yrv4cd3sw8bsl.fsf@dwragg.eng.vmware.com>

Hi Christian,

Christian Legnitto <clegnitto at mozilla.com> writes:
> My main issue is I intend to have hundreds of queues with 100k+
> messages that may or may not be processed in a timely manner. Memory
> is ok with the new persister (yay!), but the disk fills up
> quickly. Right now with only 1 consumer, if I don't ack messages
> coming from bugzilla for 2 days I use up 20GB of disk. I can of course
> throw hardware at the problem, but it seems I'd reach a point where it
> merely wouldn't scale. I don't think it is unreasonable to tell
> consumers that all messages up to a point will be persisted, but once
> a threshold is reached only x amount of messages will persist. I see
> other brokers support such a thing, though it sounds like RabbitMQ
> likely does not.

It should be possible to achieve what you describe outside of the
RabbitMQ broker: A program could periodically use rabbitmqctl (or
whatever new improved monitoring interfaces we might add) to find queues
that are over their limit. And then, where necessary, it could consume
from queues to reduce their size.

You may already realize that, but it seems worth pointing out for the
general rabbitmq-discuss audience.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Thu Sep  2 15:34:08 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Sep 2010 15:34:08 +0100
Subject: [rabbitmq-discuss] clarifying plugin supervision, configuration
In-Reply-To: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
Message-ID: <4C7FB5E0.8050003@rabbitmq.com>

Hi Jon. I don't know if you've found answers to these questions yet, but 
I'll take a stab at answering anyway.

On 24/08/10 17:11, Jon Brisbin wrote:
> I'm looking at some of the existing plugins and I just want to make sure
> I understand how the plugins are supervised in the broker.
>
> It looks like it starts the application defined in the plugin's .app
> file, whose start() function should call my plugin's supervisor's
> start_link() function, correct?

Yes. It can start more than one supervisor of course, but it needs to 
return the pid of the top-level one.

> Looking at rabbit_shovel, the plugin loads the configuration in the
> start_link() function, which I assume is coming from the main
> rabbit.config file? I don't have to have a separate config file for my
> plugin, correct?

Yes.

> I'll need to listen on multiple exchanges, so I'm assuming I'll need a
> gen_server, which starts separate consumers, for each configuration
> element (akin to what rabbit_shovel is doing by creating a child
> configuration in the supervisor for each element in the configuration
> file). How far can I go before I need to worry about resource usage of
> the "process per consumer" approach?

Pretty far. Erlang processes are in general much cheaper than threads 
are in other languages precisely so you can do things like that.

Cheers, Simon

> Or should I have a consumer that
> listens to multiple exchanges (since it'll be doing almost the same
> thing for every message that comes through)?
>
> Thanks!
>
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jon at jbrisbin.com  Thu Sep  2 15:50:31 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 2 Sep 2010 09:50:31 -0500
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying plugin
	supervision, configuration
In-Reply-To: <4C7FB5E0.8050003@rabbitmq.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
	<4C7FB5E0.8050003@rabbitmq.com>
Message-ID: <4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>

Thanks for the info, Simon...comments below...(also question about gen_server2)


On Sep 2, 2010, at 9:34 AM, Simon MacMullen wrote:

> Hi Jon. I don't know if you've found answers to these questions yet, but I'll take a stab at answering anyway.
> 
> On 24/08/10 17:11, Jon Brisbin wrote:
>> I'm looking at some of the existing plugins and I just want to make sure
>> I understand how the plugins are supervised in the broker.
>> 
>> It looks like it starts the application defined in the plugin's .app
>> file, whose start() function should call my plugin's supervisor's
>> start_link() function, correct?
> 
> Yes. It can start more than one supervisor of course, but it needs to return the pid of the top-level one.

Okay, that makes sense. Just put supervisors in your top-level super's worker configs and they can, in turn, start the gen_servers.


>> I'll need to listen on multiple exchanges, so I'm assuming I'll need a
>> gen_server, which starts separate consumers, for each configuration
>> element (akin to what rabbit_shovel is doing by creating a child
>> configuration in the supervisor for each element in the configuration
>> file). How far can I go before I need to worry about resource usage of
>> the "process per consumer" approach?
> 
> Pretty far. Erlang processes are in general much cheaper than threads are in other languages precisely so you can do things like that.
> 

That's good. It sounds like I've got a ways to go before worrying about that.

What are the advantages to using the gen_server2 module rather than stock erlang gen_server? Would it be better in general for the webhooks plugin to use gen_server2?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/774ce729/attachment.htm>

From matthew at rabbitmq.com  Thu Sep  2 15:56:03 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 2 Sep 2010 15:56:03 +0100
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying
 plugin supervision, configuration
In-Reply-To: <4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
	<4C7FB5E0.8050003@rabbitmq.com>
	<4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
Message-ID: <20100902145603.GF21176@rabbitmq.com>

On Thu, Sep 02, 2010 at 09:50:31AM -0500, Jon Brisbin wrote:
> What are the advantages to using the gen_server2 module rather than stock erlang gen_server? Would it be better in general for the webhooks plugin to use gen_server2?

Best explained by reading the comments at the top of the gen_server2
module.

Matthew

From vlad at rabbitmq.com  Thu Sep  2 15:55:58 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 02 Sep 2010 15:55:58 +0100
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying
 plugin	supervision, configuration
In-Reply-To: <4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>	<4C7FB5E0.8050003@rabbitmq.com>
	<4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
Message-ID: <4C7FBAFE.5020704@rabbitmq.com>


>
> What are the advantages to using the gen_server2 module rather than 
> stock erlang gen_server? Would it be better in general for the 
> webhooks plugin to use gen_server2?
>

Hi Jon,

gen_server2 is a modified version of Erlang's gen_server, used 
internally in the broker. You can see a list of its modifications in the 
header of gen_server2.erl.
In general, it is advisable to stick with the stock gen_server version.

Rgds,
Vlad.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/dad3fc22/attachment.htm>

From simon at rabbitmq.com  Thu Sep  2 15:57:56 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Sep 2010 15:57:56 +0100
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying
 plugin	supervision, configuration
In-Reply-To: <4C7FBAFE.5020704@rabbitmq.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>	<4C7FB5E0.8050003@rabbitmq.com>
	<4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
	<4C7FBAFE.5020704@rabbitmq.com>
Message-ID: <4C7FBB74.2040702@rabbitmq.com>

On 02/09/10 15:55, Vlad Alexandru Ionescu wrote:
> gen_server2 is a modified version of Erlang's gen_server, used
> internally in the broker. You can see a list of its modifications in the
> header of gen_server2.erl.
> In general, it is advisable to stick with the stock gen_server version.

That's maybe slightly harsh. If you find the extra features worthwhile 
then feel free to use gen_server2. But be aware that you're using a 
RabbitMQ API rather than an Erlang one, with all that implies for API 
stability...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri at krutil.com  Thu Sep  2 16:09:20 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 02 Sep 2010 17:09:20 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
Message-ID: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>

Hello together

We are considering an active-active high availability broker setup and  
I wanted to check if there is someone here who could help with  
experience/advice.

We plan to run two RabbitMQ brokers with the same setup (same queues,  
exchanges, bindings), which are independent and not aware of each  
other. These would be behind a load balancer, so this should be  
transparent to client applications.

We use AMQP for two things:
- pub/sub broadcasts from back-end to clients (all clients bind to the  
same topic exchange)
- P2P request-response, where back-end responds to client requests  
(all clients send to the same request queue)

We have only one back-end server that serves the clients. Of course  
the back-end would have to publish broadcasts to and consume requests  
from both brokers.

When one broker dies, the clients will re-connect via load balancer to  
the other broker and continue. Of course any messages on the dead  
broker will be lost. We don't use persistent messages and can live  
with messages being lost.

So far I have only identified one problem - the order of message  
delivery across brokers. Since the design of our client-server  
interface relies on the guaranteed order of message delivery, we would  
probably have to force clients to put request sequence numbers to  
message headers, remember the last seen request number on the back-end  
for each client, and throw away any requests out of order.

Any ideas or hints will be much appreciated.

Cheers

Jiri
Deutsche Boerse Systems AG


From jon at jbrisbin.com  Thu Sep  2 16:13:20 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 2 Sep 2010 10:13:20 -0500
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying
	plugin supervision, configuration
In-Reply-To: <20100902145603.GF21176@rabbitmq.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
	<4C7FB5E0.8050003@rabbitmq.com>
	<4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
	<20100902145603.GF21176@rabbitmq.com>
Message-ID: <1298906D-D257-41B2-9E66-7E018B1E5BCB@jbrisbin.com>


On Sep 2, 2010, at 9:56 AM, Matthew Sackman wrote:

> On Thu, Sep 02, 2010 at 09:50:31AM -0500, Jon Brisbin wrote:
>> What are the advantages to using the gen_server2 module rather than stock erlang gen_server? Would it be better in general for the webhooks plugin to use gen_server2?
> 
> Best explained by reading the comments at the top of the gen_server2
> module.


Sure. Did that. But I'm wondering (out loud ;) if some of the situations described there (ordered delivery, hibernate etc...) wouldn't nicely fit what the webhooks plugin is doing. It will sit for periods of time with little activity and it would be nice to have that hibernation (though I don't know that I could take full advantage of it). I'm just not sure that spending time trying to use those features would really buy that much. I was wondering if there's a rule of thumb that's been discovered here that your situation should hit X number of messages or it should be doing Y before you really need to worry about using gen_server2? I'm not terribly afraid of being tied to an internal API because it'll likely stay a plugin for the foreseeable future.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/68e71ac8/attachment-0001.htm>

From alexis at rabbitmq.com  Thu Sep  2 17:02:54 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 2 Sep 2010 17:02:54 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
Message-ID: <AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>

Jiri

Thank-you for bringing this up.

I have two (initial) questions:

1. How will out-of-order behaviour be observed in your use case?

2. Do you plan to use shared queues, or will each queue have just one
consumer client so that all pubsub happens using the exchange?

Best wishes

alexis




On Thu, Sep 2, 2010 at 4:09 PM, <jiri at krutil.com> wrote:

> Hello together
>
> We are considering an active-active high availability broker setup and I
> wanted to check if there is someone here who could help with
> experience/advice.
>
> We plan to run two RabbitMQ brokers with the same setup (same queues,
> exchanges, bindings), which are independent and not aware of each other.
> These would be behind a load balancer, so this should be transparent to
> client applications.
>
> We use AMQP for two things:
> - pub/sub broadcasts from back-end to clients (all clients bind to the same
> topic exchange)
> - P2P request-response, where back-end responds to client requests (all
> clients send to the same request queue)
>
> We have only one back-end server that serves the clients. Of course the
> back-end would have to publish broadcasts to and consume requests from both
> brokers.
>
> When one broker dies, the clients will re-connect via load balancer to the
> other broker and continue. Of course any messages on the dead broker will be
> lost. We don't use persistent messages and can live with messages being
> lost.
>
> So far I have only identified one problem - the order of message delivery
> across brokers. Since the design of our client-server interface relies on
> the guaranteed order of message delivery, we would probably have to force
> clients to put request sequence numbers to message headers, remember the
> last seen request number on the back-end for each client, and throw away any
> requests out of order.
>
> Any ideas or hints will be much appreciated.
>
> Cheers
>
> Jiri
> Deutsche Boerse Systems AG
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/48086790/attachment.htm>

From jiri at krutil.com  Thu Sep  2 18:12:22 2010
From: jiri at krutil.com (Jiri Krutil)
Date: Thu, 2 Sep 2010 19:12:22 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
Message-ID: <FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>

Alex,

Not sure if I got your questons, but will try to answer...

On 2 Sep 2010, at 18:02, Alexis Richardson <alexis at rabbitmq.com> wrote:

> 1. How will out-of-order behaviour be observed in your use case?

Our client-server contract promises that requests from a given client  
will always be processed in the order in which they were delivered to  
the broker. The same applies for the server responses. This is  
strictly required for our business. It is acceptable though that  
requests from different clients connected to different brokers are  
delivered in a different order.

Our server could detect out-of-order requests using a request sequence  
number and throw them away. This would however require cooperation  
from the clients (always fill in the seq no).

> 2. Do you plan to use shared queues, or will each queue have just  
> one consumer client so that all pubsub happens using the exchange?

Clients receive broadcasts by declaring an exclusive queue and binding  
a well-known topic exchange to it.

Requests are processed by one (singleton) service, possibly consuming  
from two brokers, one request queue per broker.

Nothing at all is shared among the brokers.

Regards
Jiri

From alexis at rabbitmq.com  Thu Sep  2 18:44:21 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 2 Sep 2010 18:44:21 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
Message-ID: <AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>

Jiri

That answered my questions.  Now, as I understood your example:

a. you don't mind messages being lost
*and*
b. you don't use the secondary until after the primary has failed.

Note that if consumption is completely 'fire and forget' then it is possible
that a message from the primary may *arrive* after a message from the
secondary.  But this can happen whether you use sequence numbers or not.

So if the primary broker fails, why not just forget all undelivered
messages?  Consumers will know that any message consumed from the secondary
must be later in *all* orderings than any message consumed from the primary.
 So, additional sequence numbering is not necessary.

alexis





On Thu, Sep 2, 2010 at 6:12 PM, Jiri Krutil <jiri at krutil.com> wrote:

> Alex,
>
> Not sure if I got your questons, but will try to answer...
>
>
> On 2 Sep 2010, at 18:02, Alexis Richardson <alexis at rabbitmq.com> wrote:
>
>  1. How will out-of-order behaviour be observed in your use case?
>>
>
> Our client-server contract promises that requests from a given client will
> always be processed in the order in which they were delivered to the broker.
> The same applies for the server responses. This is strictly required for our
> business. It is acceptable though that requests from different clients
> connected to different brokers are delivered in a different order.
>
> Our server could detect out-of-order requests using a request sequence
> number and throw them away. This would however require cooperation from the
> clients (always fill in the seq no).
>
>
>  2. Do you plan to use shared queues, or will each queue have just one
>> consumer client so that all pubsub happens using the exchange?
>>
>
> Clients receive broadcasts by declaring an exclusive queue and binding a
> well-known topic exchange to it.
>
> Requests are processed by one (singleton) service, possibly consuming from
> two brokers, one request queue per broker.
>
> Nothing at all is shared among the brokers.
>
> Regards
> Jiri
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/8cdd3b8b/attachment.htm>

From oyvind at tjervaag.com  Thu Sep  2 19:18:20 2010
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Thu, 2 Sep 2010 20:18:20 +0200
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <yrv4cd3sw8bsl.fsf@dwragg.eng.vmware.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<yrv4cd3sw8bsl.fsf@dwragg.eng.vmware.com>
Message-ID: <4AEDE019-1BE8-417D-AA64-EE41D23D1BA8@tjervaag.com>

Hi!

This might be covered somewhere, but what happens to rabbit when there is no space left on your drives? Does it just crash?

?yvind


On Sep 2, 2010, at 4:23 PM, David Wragg wrote:
> 
> It should be possible to achieve what you describe outside of the
> RabbitMQ broker: A program could periodically use rabbitmqctl (or
> whatever new improved monitoring interfaces we might add) to find queues
> that are over their limit. And then, where necessary, it could consume
> from queues to reduce their size.
> 
> You may already realize that, but it seems worth pointing out for the
> general rabbitmq-discuss audience.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jiri at krutil.com  Thu Sep  2 21:46:38 2010
From: jiri at krutil.com (Jiri Krutil)
Date: Thu, 02 Sep 2010 22:46:38 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
Message-ID: <4C800D2E.9070409@krutil.com>

Alexis

Sorry I probably didn't express myself well.

We don't plan a primary and secondary broker, but a pair of brokers that 
are both active at the same time. A load balancer divides client 
connections to these brokers. A request queue with the same name exists 
on both brokers, but with different contents. Some clients send requests 
to one broker, some to the other. Our back-end server listens to both 
queues, processes requests and sends each response to an exclusive 
client queue on the broker from where the request came.

Ideally this would be transparent to the clients, because the brokers 
would be hidden by a virtual IP address. Of course it can't be 
transparent to the back-end server, which needs to talk to both brokers 
at the same time.

So (a) is correct, but (b) not.

Hope that makes it a bit clearer...

Cheers
Jiri


> Jiri
>
> That answered my questions.  Now, as I understood your example:
>
> a. you don't mind messages being lost
> *and*
> b. you don't use the secondary until after the primary has failed.
>
> Note that if consumption is completely 'fire and forget' then it is 
> possible that a message from the primary may *arrive* after a message 
> from the secondary.  But this can happen whether you use sequence 
> numbers or not.
>
> So if the primary broker fails, why not just forget all undelivered 
> messages?  Consumers will know that any message consumed from the 
> secondary must be later in *all* orderings than any message consumed 
> from the primary.  So, additional sequence numbering is not necessary.
>
> alexis

From alexis at rabbitmq.com  Thu Sep  2 23:50:18 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 2 Sep 2010 23:50:18 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <4C800D2E.9070409@krutil.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
Message-ID: <AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>

Jiri

You say that "Some clients send requests to one broker, some to the other".


Does this mean that one client publisher can send messages (requests) to
both brokers, in such a way that a pair of messages may arrive out of order
if one is sent to each broker?

If the answer is no, then I think my answer stands, because causal order
will be preserved even if messages are lost.  That is: messages that arrive
successfully, will not be out of order with each other.

If the answer is yes, then I am not sure how you can recover global ordering
without imposing it at the publisher using sequence numbers at the app
level.

Does this make sense?

alexis



On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:

> Alexis
>
> Sorry I probably didn't express myself well.
>
> We don't plan a primary and secondary broker, but a pair of brokers that
> are both active at the same time. A load balancer divides client connections
> to these brokers. A request queue with the same name exists on both brokers,
> but with different contents. Some clients send requests to one broker, some
> to the other. Our back-end server listens to both queues, processes requests
> and sends each response to an exclusive client queue on the broker from
> where the request came.
>
> Ideally this would be transparent to the clients, because the brokers would
> be hidden by a virtual IP address. Of course it can't be transparent to the
> back-end server, which needs to talk to both brokers at the same time.
>
> So (a) is correct, but (b) not.
>
> Hope that makes it a bit clearer...
>
> Cheers
> Jiri
>
>
>
>  Jiri
>>
>> That answered my questions.  Now, as I understood your example:
>>
>> a. you don't mind messages being lost
>> *and*
>> b. you don't use the secondary until after the primary has failed.
>>
>> Note that if consumption is completely 'fire and forget' then it is
>> possible that a message from the primary may *arrive* after a message from
>> the secondary.  But this can happen whether you use sequence numbers or not.
>>
>> So if the primary broker fails, why not just forget all undelivered
>> messages?  Consumers will know that any message consumed from the secondary
>> must be later in *all* orderings than any message consumed from the primary.
>>  So, additional sequence numbering is not necessary.
>>
>> alexis
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/80c076e0/attachment-0001.htm>

From matthew at rabbitmq.com  Thu Sep  2 23:53:34 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 2 Sep 2010 23:53:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ and queue message limits?
In-Reply-To: <4AEDE019-1BE8-417D-AA64-EE41D23D1BA8@tjervaag.com>
References: <D8BDFAF0-A5D8-4B33-9006-664F68E9AEA4@mozilla.com>
	<4C7D6AFC.6060805@rabbitmq.com>
	<6B73D300-5E7C-4DF3-A609-F23055B6D0B5@mozilla.com>
	<yrv4cd3sw8bsl.fsf@dwragg.eng.vmware.com>
	<4AEDE019-1BE8-417D-AA64-EE41D23D1BA8@tjervaag.com>
Message-ID: <20100902225334.GB4402@rabbitmq.com>

On Thu, Sep 02, 2010 at 08:18:20PM +0200, ?yvind Tjervaag wrote:
> This might be covered somewhere, but what happens to rabbit when there is no space left on your drives? Does it just crash?

Yes. This should probably get fixed.

Matthew

From nowgoo at gmail.com  Fri Sep  3 03:24:52 2010
From: nowgoo at gmail.com (Nowgoo)
Date: Thu, 2 Sep 2010 19:24:52 -0700 (PDT)
Subject: [rabbitmq-discuss]  problem on starting rabbitmq-server
Message-ID: <29579141.post@talk.nabble.com>


Hi list,

I've installed a rabbitmq (follow the instructions at
http://www.rabbitmq.com/install.html#install-rpm), but when I try to run
/etc/init.d/rabbitmq-server, the screen display "Starting rabbitmq-server:"
and stopped there, never display "SUCCESS" or anything else. at this time I
press ctrl+c, it just failed and quit.

btw, when it shows "Starting rabbitmq-server:", I noticed:
1. these lines were appened to /var/log/rabbitmq/startup_log:
......
-- message delivery logic ready
starting error log relay                                             
...done
starting networking                                                  
...done
-- network listeners available

broker running
seems the service is started?

2. the lock file /var/lock/subsys/rabbitmq-server did NOT exists.

so I guess maybe it's a bash problem?

here is my system info:
Linux localhost 2.6.18-92.el5 #1 SMP Tue Jun 10 18:49:47 EDT 2008 i686 i686
i386 GNU/Linux
Erlang (BEAM) emulator version 5.6.5
rabbitmq-server-2.0.0-1.noarch.rpm
-- 
View this message in context: http://old.nabble.com/problem-on-starting-rabbitmq-server-tp29579141p29579141.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From david at rabbitmq.com  Fri Sep  3 07:53:01 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 03 Sep 2010 07:53:01 +0100
Subject: [rabbitmq-discuss] problem on starting rabbitmq-server
In-Reply-To: <29579141.post@talk.nabble.com> (nowgoo@gmail.com's message of
	"Thu, 2 Sep 2010 19:24:52 -0700 (PDT)")
References: <29579141.post@talk.nabble.com>
Message-ID: <yrv4ceidbuxma.fsf@dwragg.eng.vmware.com>

Hi,

Nowgoo <nowgoo at gmail.com> writes:
> I've installed a rabbitmq (follow the instructions at
> http://www.rabbitmq.com/install.html#install-rpm), but when I try to run
> /etc/init.d/rabbitmq-server, the screen display "Starting rabbitmq-server:"
> and stopped there, never display "SUCCESS" or anything else. at this time I
> press ctrl+c, it just failed and quit.
>
> btw, when it shows "Starting rabbitmq-server:", I noticed:
> 1. these lines were appened to /var/log/rabbitmq/startup_log:
> ......
> -- message delivery logic ready
> starting error log relay                                             
> ...done
> starting networking                                                  
> ...done
> -- network listeners available
>
> broker running
> seems the service is started?

Thanks for the details.

One possible cause fopr your problem is that the hostname for your
machine returned by "hostname -s" does not actually resolve to a valid
IP address for your machine.  Could this be the case for you?

If it is, then you can fix it by creating a file
/etc/rabbitmq/rabbitmq.conf containing the line:

NODENAME=rabbit at localhost

You can replace localhost with any other valid short hostname for your
machine, i.e. one not containing dots.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Fri Sep  3 08:12:36 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Fri, 03 Sep 2010 09:12:36 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
Message-ID: <20100903091236.19695rzrv2yog5k4@webmail.active24.cz>

Alexis

The answer is no - a client can send requests to only one broker at  
any given moment. The client connects via load balancer to one of the  
brokers and stays connected all the time. The client does not even  
know that there are two brokers (it only sees one IP address).

I think requests may be delivered out of order only if a client fails  
over to another broker. Then messages send to one broker can get mixed  
up with messages sent to the other.

My concern was: are there any other issues with this kind of setup  
that I might have missed? Does anyone have experience with this?

Thanks a lot for your help
Jiri



> Jiri
>
> You say that "Some clients send requests to one broker, some to the other".
>
>
> Does this mean that one client publisher can send messages (requests) to
> both brokers, in such a way that a pair of messages may arrive out of order
> if one is sent to each broker?
>
> If the answer is no, then I think my answer stands, because causal order
> will be preserved even if messages are lost.  That is: messages that arrive
> successfully, will not be out of order with each other.
>
> If the answer is yes, then I am not sure how you can recover global ordering
> without imposing it at the publisher using sequence numbers at the app
> level.
>
> Does this make sense?
>
> alexis
>
>
>
> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>
>> Alexis
>>
>> Sorry I probably didn't express myself well.
>>
>> We don't plan a primary and secondary broker, but a pair of brokers that
>> are both active at the same time. A load balancer divides client connections
>> to these brokers. A request queue with the same name exists on both brokers,
>> but with different contents. Some clients send requests to one broker, some
>> to the other. Our back-end server listens to both queues, processes requests
>> and sends each response to an exclusive client queue on the broker from
>> where the request came.
>>
>> Ideally this would be transparent to the clients, because the brokers would
>> be hidden by a virtual IP address. Of course it can't be transparent to the
>> back-end server, which needs to talk to both brokers at the same time.
>>
>> So (a) is correct, but (b) not.
>>
>> Hope that makes it a bit clearer...
>>
>> Cheers
>> Jiri
>>
>>
>>
>>  Jiri
>>>
>>> That answered my questions.  Now, as I understood your example:
>>>
>>> a. you don't mind messages being lost
>>> *and*
>>> b. you don't use the secondary until after the primary has failed.
>>>
>>> Note that if consumption is completely 'fire and forget' then it is
>>> possible that a message from the primary may *arrive* after a message from
>>> the secondary.  But this can happen whether you use sequence  
>>> numbers or not.
>>>
>>> So if the primary broker fails, why not just forget all undelivered
>>> messages?  Consumers will know that any message consumed from the secondary
>>> must be later in *all* orderings than any message consumed from  
>>> the primary.
>>>  So, additional sequence numbering is not necessary.
>>>
>>> alexis
>>>
>>
>




From abhishek.kona at gmail.com  Fri Sep  3 08:14:17 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 03 Sep 2010 12:44:17 +0530
Subject: [rabbitmq-discuss] Not Able to keep messages persistent
Message-ID: <4C80A049.8020906@gmail.com>

  Hi

Please tell me what I am doing wrong here
I am using RabbitMQ 2.0 and the Java API

Bp=new AMQP.BasicProperties()
bp.setTimeStamp(Calendar.getInstance.getTime())
bp.setDeliveryMode(2)

channel.basicPublish("default_exchange", rkey, bp, message.getBytes());


None of my messages are persistent. All my Queues are empty when I 
restart RabbitMQ, The queues and Exchanges exist after a Restart, so 
they are Durable.

Please point out what I am doing wrong.
I have been breaking my head over it for a long time.

Abhishek Kona
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/dbeed972/attachment.htm>

From alexis at rabbitmq.com  Fri Sep  3 08:22:06 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Sep 2010 08:22:06 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
Message-ID: <AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>

Jiri

Cool.  So yes messages will then only arrive out of order in the case
where some arrive from the secondary before 'delayed' messages from
the failed primary; and then, for reordering them, it suffices to know
which broker they came from.  (In the absence of failure, TCP should
take care of reordering).

I think the issues will be:

1. Deciding when to stop listening to a primary.  Given consumers
don't care about message loss, I would suggest "as soon as consumers
are aware of primary failure, then they should ignore further messages
from the primary"

2. Failover time.  AIUI you want to minimise this by having a copy of
the whole queue/exchange/binding set-up on both brokers.  But how
exactly do you plan to do this?

alexis


On Fri, Sep 3, 2010 at 8:12 AM,  <jiri at krutil.com> wrote:
> Alexis
>
> The answer is no - a client can send requests to only one broker at any
> given moment. The client connects via load balancer to one of the brokers
> and stays connected all the time. The client does not even know that there
> are two brokers (it only sees one IP address).
>
> I think requests may be delivered out of order only if a client fails over
> to another broker. Then messages send to one broker can get mixed up with
> messages sent to the other.
>
> My concern was: are there any other issues with this kind of setup that I
> might have missed? Does anyone have experience with this?
>
> Thanks a lot for your help
> Jiri
>
>
>
>> Jiri
>>
>> You say that "Some clients send requests to one broker, some to the
>> other".
>>
>>
>> Does this mean that one client publisher can send messages (requests) to
>> both brokers, in such a way that a pair of messages may arrive out of
>> order
>> if one is sent to each broker?
>>
>> If the answer is no, then I think my answer stands, because causal order
>> will be preserved even if messages are lost. ?That is: messages that
>> arrive
>> successfully, will not be out of order with each other.
>>
>> If the answer is yes, then I am not sure how you can recover global
>> ordering
>> without imposing it at the publisher using sequence numbers at the app
>> level.
>>
>> Does this make sense?
>>
>> alexis
>>
>>
>>
>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>
>>> Alexis
>>>
>>> Sorry I probably didn't express myself well.
>>>
>>> We don't plan a primary and secondary broker, but a pair of brokers that
>>> are both active at the same time. A load balancer divides client
>>> connections
>>> to these brokers. A request queue with the same name exists on both
>>> brokers,
>>> but with different contents. Some clients send requests to one broker,
>>> some
>>> to the other. Our back-end server listens to both queues, processes
>>> requests
>>> and sends each response to an exclusive client queue on the broker from
>>> where the request came.
>>>
>>> Ideally this would be transparent to the clients, because the brokers
>>> would
>>> be hidden by a virtual IP address. Of course it can't be transparent to
>>> the
>>> back-end server, which needs to talk to both brokers at the same time.
>>>
>>> So (a) is correct, but (b) not.
>>>
>>> Hope that makes it a bit clearer...
>>>
>>> Cheers
>>> Jiri
>>>
>>>
>>>
>>> ?Jiri
>>>>
>>>> That answered my questions. ?Now, as I understood your example:
>>>>
>>>> a. you don't mind messages being lost
>>>> *and*
>>>> b. you don't use the secondary until after the primary has failed.
>>>>
>>>> Note that if consumption is completely 'fire and forget' then it is
>>>> possible that a message from the primary may *arrive* after a message
>>>> from
>>>> the secondary. ?But this can happen whether you use sequence numbers or
>>>> not.
>>>>
>>>> So if the primary broker fails, why not just forget all undelivered
>>>> messages? ?Consumers will know that any message consumed from the
>>>> secondary
>>>> must be later in *all* orderings than any message consumed from the
>>>> primary.
>>>> ?So, additional sequence numbering is not necessary.
>>>>
>>>> alexis
>>>>
>>>
>>
>
>
>
>

From nowgoo at gmail.com  Fri Sep  3 08:30:20 2010
From: nowgoo at gmail.com (Nowgoo)
Date: Fri, 3 Sep 2010 00:30:20 -0700 (PDT)
Subject: [rabbitmq-discuss] problem on starting rabbitmq-server
In-Reply-To: <yrv4ceidbuxma.fsf@dwragg.eng.vmware.com>
References: <29579141.post@talk.nabble.com>
	<yrv4ceidbuxma.fsf@dwragg.eng.vmware.com>
Message-ID: <29611818.post@talk.nabble.com>


It works! thanks very much.
it's all my fault, I had set hostname to a number :(


David Wragg-4 wrote:
> 
> Hi,
> 
> Nowgoo <nowgoo at gmail.com> writes:
>> I've installed a rabbitmq (follow the instructions at
>> http://www.rabbitmq.com/install.html#install-rpm), but when I try to run
>> /etc/init.d/rabbitmq-server, the screen display "Starting
>> rabbitmq-server:"
>> and stopped there, never display "SUCCESS" or anything else. at this time
>> I
>> press ctrl+c, it just failed and quit.
>>
>> btw, when it shows "Starting rabbitmq-server:", I noticed:
>> 1. these lines were appened to /var/log/rabbitmq/startup_log:
>> ......
>> -- message delivery logic ready
>> starting error log relay                                             
>> ...done
>> starting networking                                                  
>> ...done
>> -- network listeners available
>>
>> broker running
>> seems the service is started?
> 
> Thanks for the details.
> 
> One possible cause fopr your problem is that the hostname for your
> machine returned by "hostname -s" does not actually resolve to a valid
> IP address for your machine.  Could this be the case for you?
> 
> If it is, then you can fix it by creating a file
> /etc/rabbitmq/rabbitmq.conf containing the line:
> 
> NODENAME=rabbit at localhost
> 
> You can replace localhost with any other valid short hostname for your
> machine, i.e. one not containing dots.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/problem-on-starting-rabbitmq-server-tp29579141p29611818.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jiri at krutil.com  Fri Sep  3 08:40:40 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Fri, 03 Sep 2010 09:40:40 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
Message-ID: <20100903094040.25063qmuafrqw4u8@webmail.active24.cz>

Alexis

Our plan is to have two brokers with the same setup, both being  
actively used at the same time, but each broker serving a different  
set of clients.

Our back-end service will be connected to and process requests from  
both brokers at the same time.

When one broker fails, the clients will loose connection and will have  
to reconnect, ending up on the other broker. Messages that were on the  
dead broker will be lost.

So we don't need migration of resources between brokers in case of  
failure, we only need the clients to move their connections to the  
other broker.

Hope that makes sense...

Jiri


> Jiri
>
> Cool.  So yes messages will then only arrive out of order in the case
> where some arrive from the secondary before 'delayed' messages from
> the failed primary; and then, for reordering them, it suffices to know
> which broker they came from.  (In the absence of failure, TCP should
> take care of reordering).
>
> I think the issues will be:
>
> 1. Deciding when to stop listening to a primary.  Given consumers
> don't care about message loss, I would suggest "as soon as consumers
> are aware of primary failure, then they should ignore further messages
> from the primary"
>
> 2. Failover time.  AIUI you want to minimise this by having a copy of
> the whole queue/exchange/binding set-up on both brokers.  But how
> exactly do you plan to do this?
>
> alexis
>
>
> On Fri, Sep 3, 2010 at 8:12 AM,  <jiri at krutil.com> wrote:
>> Alexis
>>
>> The answer is no - a client can send requests to only one broker at any
>> given moment. The client connects via load balancer to one of the brokers
>> and stays connected all the time. The client does not even know that there
>> are two brokers (it only sees one IP address).
>>
>> I think requests may be delivered out of order only if a client fails over
>> to another broker. Then messages send to one broker can get mixed up with
>> messages sent to the other.
>>
>> My concern was: are there any other issues with this kind of setup that I
>> might have missed? Does anyone have experience with this?
>>
>> Thanks a lot for your help
>> Jiri
>>
>>
>>
>>> Jiri
>>>
>>> You say that "Some clients send requests to one broker, some to the
>>> other".
>>>
>>>
>>> Does this mean that one client publisher can send messages (requests) to
>>> both brokers, in such a way that a pair of messages may arrive out of
>>> order
>>> if one is sent to each broker?
>>>
>>> If the answer is no, then I think my answer stands, because causal order
>>> will be preserved even if messages are lost. ?That is: messages that
>>> arrive
>>> successfully, will not be out of order with each other.
>>>
>>> If the answer is yes, then I am not sure how you can recover global
>>> ordering
>>> without imposing it at the publisher using sequence numbers at the app
>>> level.
>>>
>>> Does this make sense?
>>>
>>> alexis
>>>
>>>
>>>
>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>
>>>> Alexis
>>>>
>>>> Sorry I probably didn't express myself well.
>>>>
>>>> We don't plan a primary and secondary broker, but a pair of brokers that
>>>> are both active at the same time. A load balancer divides client
>>>> connections
>>>> to these brokers. A request queue with the same name exists on both
>>>> brokers,
>>>> but with different contents. Some clients send requests to one broker,
>>>> some
>>>> to the other. Our back-end server listens to both queues, processes
>>>> requests
>>>> and sends each response to an exclusive client queue on the broker from
>>>> where the request came.
>>>>
>>>> Ideally this would be transparent to the clients, because the brokers
>>>> would
>>>> be hidden by a virtual IP address. Of course it can't be transparent to
>>>> the
>>>> back-end server, which needs to talk to both brokers at the same time.
>>>>
>>>> So (a) is correct, but (b) not.
>>>>
>>>> Hope that makes it a bit clearer...
>>>>
>>>> Cheers
>>>> Jiri
>>>>
>>>>
>>>>
>>>> ?Jiri
>>>>>
>>>>> That answered my questions. ?Now, as I understood your example:
>>>>>
>>>>> a. you don't mind messages being lost
>>>>> *and*
>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>
>>>>> Note that if consumption is completely 'fire and forget' then it is
>>>>> possible that a message from the primary may *arrive* after a message
>>>>> from
>>>>> the secondary. ?But this can happen whether you use sequence numbers or
>>>>> not.
>>>>>
>>>>> So if the primary broker fails, why not just forget all undelivered
>>>>> messages? ?Consumers will know that any message consumed from the
>>>>> secondary
>>>>> must be later in *all* orderings than any message consumed from the
>>>>> primary.
>>>>> ?So, additional sequence numbering is not necessary.
>>>>>
>>>>> alexis
>>>>>
>>>>
>>>
>>
>>
>>
>>
>



From abhishek.kona at gmail.com  Fri Sep  3 08:49:18 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 03 Sep 2010 13:19:18 +0530
Subject: [rabbitmq-discuss] Not Able to keep messages persistent
In-Reply-To: <4C80A049.8020906@gmail.com>
References: <4C80A049.8020906@gmail.com>
Message-ID: <4C80A87E.1070503@gmail.com>

  When I am using Transaction Commit, the messages are persisted but 
without the transaction commits, the messages are not persistent.

I am guessing the issue is the messages are not persisted as soon as 
they are received. But at some time later on by the RabbitMQ.
Is this the issue.

Abhishek Kona


On 03/09/10 12:44 PM, Abhishek Kona wrote:
> Hi
>
> Please tell me what I am doing wrong here
> I am using RabbitMQ 2.0 and the Java API
>
> Bp=new AMQP.BasicProperties()
> bp.setTimeStamp(Calendar.getInstance.getTime())
> bp.setDeliveryMode(2)
>
> channel.basicPublish("default_exchange", rkey, bp, message.getBytes());
>
>
> None of my messages are persistent. All my Queues are empty when I 
> restart RabbitMQ, The queues and Exchanges exist after a Restart, so 
> they are Durable.
>
> Please point out what I am doing wrong.
> I have been breaking my head over it for a long time.
>
> Abhishek Kona

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/a65ee812/attachment.htm>

From david at rabbitmq.com  Fri Sep  3 08:55:09 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 03 Sep 2010 08:55:09 +0100
Subject: [rabbitmq-discuss] problem on starting rabbitmq-server
In-Reply-To: <29611818.post@talk.nabble.com> (nowgoo@gmail.com's message of
	"Fri, 3 Sep 2010 00:30:20 -0700 (PDT)")
References: <29579141.post@talk.nabble.com>
	<yrv4ceidbuxma.fsf@dwragg.eng.vmware.com>
	<29611818.post@talk.nabble.com>
Message-ID: <yrv4caanzuuqq.fsf@dwragg.eng.vmware.com>

Nowgoo <nowgoo at gmail.com> writes:
> It works! thanks very much.
> it's all my fault, I had set hostname to a number :(

Glad to hear you got it working.

We've had similar problems reported on a few occasions now, so recently
we added code to handle this case more gracefully.  Rather than
rabbitmq-server hanging, it will actually fail to start with an error.
That enhancement should be in the next release.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From michaelburns1 at gmail.com  Fri Sep  3 09:03:25 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Fri, 3 Sep 2010 09:03:25 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
Message-ID: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>

Hi,

We're just starting out with RabbitMQ and have a very simple setup: one
queue, one producer doing a basicPublish and one consumer doing a
basicConsume using QueueingConsumer.

For the most part it works fine however at fairly regular intervals we are
finding that messages remain on the queue for a considerable period before
being delivered to the consumer.

We are putting a very low volume of messages through and have sometimes had
to wait up to 15 minutes for a single message to be delivered (at the time
this was the only message in the system).

In all cases the messages are eventually delivered.

I dont know where to start debugging this as there is nothing in the
RabbitMQ logs thats suggests something is going wrong - could anyone point
me in the right direction as to what may be causing this?

Many Thanks,
Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/4f3fd8e9/attachment.htm>

From david at rabbitmq.com  Fri Sep  3 09:04:12 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 03 Sep 2010 09:04:12 +0100
Subject: [rabbitmq-discuss] Not Able to keep messages persistent
In-Reply-To: <4C80A87E.1070503@gmail.com> (Abhishek Kona's message of "Fri, 03
	Sep 2010 13:19:18 +0530")
References: <4C80A049.8020906@gmail.com> <4C80A87E.1070503@gmail.com>
Message-ID: <yrv4c62ynuubn.fsf@dwragg.eng.vmware.com>

Hi Abhishek,

Abhishek Kona <abhishek.kona at gmail.com> writes:
> When I am using Transaction Commit, the messages are persisted but
> without the transaction commits, the messages are not persistent.
>
> I am guessing the issue is the messages are not persisted as soon as
> they are received. But at some time later on by the RabbitMQ.
> Is this the issue.

If you put an AMQP channel into transactional mode, and you don't commit
the transaction, then it's as if the messages were never published.  Not
only will the messages not be persisted, but the messages won't even go
into the message queues until you commit the transaction.

Is this consistent with what you are seeing?  If not, could you provide
a full test program to demonstrate you problem?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From alexandru at rabbitmq.com  Fri Sep  3 09:29:34 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 3 Sep 2010 09:29:34 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
Message-ID: <20100903082934.GB2873@dakota.eng.vmware.com>

Hi Michael,

> We are putting a very low volume of messages through and have sometimes had
> to wait up to 15 minutes for a single message to be delivered (at the time
> this was the only message in the system).

That sounds strage.  Are you up for a bit of debugging?

Download the java client,
 http://www.rabbitmq.com/java-client.html

Unpack it, and run
  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1

That command will run one of our example programmes in a way that
matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).

When I run it, I get speeds like:
  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637 microseconds
  sending rate: 6419 msg/s, basic returns: 0 ret/s

If you're getting similar speeds, there's probably something wrong with
the consumers/producers.  If not, it might be something to do with the
server.

Could you please try it?

Also, which version the broker and which client are you using?

Cheers,
Alex

On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> Hi,
> 
> We're just starting out with RabbitMQ and have a very simple setup: one
> queue, one producer doing a basicPublish and one consumer doing a
> basicConsume using QueueingConsumer.
> 
> For the most part it works fine however at fairly regular intervals we are
> finding that messages remain on the queue for a considerable period before
> being delivered to the consumer.
> 
> We are putting a very low volume of messages through and have sometimes had
> to wait up to 15 minutes for a single message to be delivered (at the time
> this was the only message in the system).
> 
> In all cases the messages are eventually delivered.
> 
> I dont know where to start debugging this as there is nothing in the
> RabbitMQ logs thats suggests something is going wrong - could anyone point
> me in the right direction as to what may be causing this?
> 
> Many Thanks,
> Michael

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Fri Sep  3 10:04:37 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Sep 2010 10:04:37 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
	<20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
Message-ID: <AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>

Jiri

It makes some sense, but you *will* need to migrate resources, or recreate
them, to continue working on the secondary.  You will not need to migrate
messages, but there is other broker state that you will need: for example a
consumer's exclusive queue on the primary, will need to exist on the
secondary, with the correct bindings, connection, etc.

So my question is: do you plan to create that queue (etc) on the secondary
after the primary fails?  If "yes" then a potential issue is managing the
failover window size and (possible, but less likely) resource limits on the
secondary.  If "no" then you will need to 'pre build' the spare resources
somehow.

These are not necessarily difficult issues to solve in any particular
instance, however I am highlighting them in response to your request for
feedback.  These issues do become deeper when you try to generalise to
multiple different failure scenarios, of course.

alexis


On Fri, Sep 3, 2010 at 8:40 AM, <jiri at krutil.com> wrote:

> Alexis
>
> Our plan is to have two brokers with the same setup, both being actively
> used at the same time, but each broker serving a different set of clients.
>
> Our back-end service will be connected to and process requests from both
> brokers at the same time.
>
> When one broker fails, the clients will loose connection and will have to
> reconnect, ending up on the other broker. Messages that were on the dead
> broker will be lost.
>
> So we don't need migration of resources between brokers in case of failure,
> we only need the clients to move their connections to the other broker.
>
> Hope that makes sense...
>
> Jiri
>
>
>
>  Jiri
>>
>> Cool.  So yes messages will then only arrive out of order in the case
>> where some arrive from the secondary before 'delayed' messages from
>> the failed primary; and then, for reordering them, it suffices to know
>> which broker they came from.  (In the absence of failure, TCP should
>> take care of reordering).
>>
>> I think the issues will be:
>>
>> 1. Deciding when to stop listening to a primary.  Given consumers
>> don't care about message loss, I would suggest "as soon as consumers
>> are aware of primary failure, then they should ignore further messages
>> from the primary"
>>
>> 2. Failover time.  AIUI you want to minimise this by having a copy of
>> the whole queue/exchange/binding set-up on both brokers.  But how
>> exactly do you plan to do this?
>>
>> alexis
>>
>>
>> On Fri, Sep 3, 2010 at 8:12 AM,  <jiri at krutil.com> wrote:
>>
>>> Alexis
>>>
>>> The answer is no - a client can send requests to only one broker at any
>>> given moment. The client connects via load balancer to one of the brokers
>>> and stays connected all the time. The client does not even know that
>>> there
>>> are two brokers (it only sees one IP address).
>>>
>>> I think requests may be delivered out of order only if a client fails
>>> over
>>> to another broker. Then messages send to one broker can get mixed up with
>>> messages sent to the other.
>>>
>>> My concern was: are there any other issues with this kind of setup that I
>>> might have missed? Does anyone have experience with this?
>>>
>>> Thanks a lot for your help
>>> Jiri
>>>
>>>
>>>
>>>  Jiri
>>>>
>>>> You say that "Some clients send requests to one broker, some to the
>>>> other".
>>>>
>>>>
>>>> Does this mean that one client publisher can send messages (requests) to
>>>> both brokers, in such a way that a pair of messages may arrive out of
>>>> order
>>>> if one is sent to each broker?
>>>>
>>>> If the answer is no, then I think my answer stands, because causal order
>>>> will be preserved even if messages are lost.  That is: messages that
>>>> arrive
>>>> successfully, will not be out of order with each other.
>>>>
>>>> If the answer is yes, then I am not sure how you can recover global
>>>> ordering
>>>> without imposing it at the publisher using sequence numbers at the app
>>>> level.
>>>>
>>>> Does this make sense?
>>>>
>>>> alexis
>>>>
>>>>
>>>>
>>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>>
>>>>  Alexis
>>>>>
>>>>> Sorry I probably didn't express myself well.
>>>>>
>>>>> We don't plan a primary and secondary broker, but a pair of brokers
>>>>> that
>>>>> are both active at the same time. A load balancer divides client
>>>>> connections
>>>>> to these brokers. A request queue with the same name exists on both
>>>>> brokers,
>>>>> but with different contents. Some clients send requests to one broker,
>>>>> some
>>>>> to the other. Our back-end server listens to both queues, processes
>>>>> requests
>>>>> and sends each response to an exclusive client queue on the broker from
>>>>> where the request came.
>>>>>
>>>>> Ideally this would be transparent to the clients, because the brokers
>>>>> would
>>>>> be hidden by a virtual IP address. Of course it can't be transparent to
>>>>> the
>>>>> back-end server, which needs to talk to both brokers at the same time.
>>>>>
>>>>> So (a) is correct, but (b) not.
>>>>>
>>>>> Hope that makes it a bit clearer...
>>>>>
>>>>> Cheers
>>>>> Jiri
>>>>>
>>>>>
>>>>>
>>>>>  Jiri
>>>>>
>>>>>>
>>>>>> That answered my questions.  Now, as I understood your example:
>>>>>>
>>>>>> a. you don't mind messages being lost
>>>>>> *and*
>>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>>
>>>>>> Note that if consumption is completely 'fire and forget' then it is
>>>>>> possible that a message from the primary may *arrive* after a message
>>>>>> from
>>>>>> the secondary.  But this can happen whether you use sequence numbers
>>>>>> or
>>>>>> not.
>>>>>>
>>>>>> So if the primary broker fails, why not just forget all undelivered
>>>>>> messages?  Consumers will know that any message consumed from the
>>>>>> secondary
>>>>>> must be later in *all* orderings than any message consumed from the
>>>>>> primary.
>>>>>>  So, additional sequence numbering is not necessary.
>>>>>>
>>>>>> alexis
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/8e70450d/attachment.htm>

From kapouer at melix.org  Fri Sep  3 10:24:17 2010
From: kapouer at melix.org (=?UTF-8?B?SsOpcsOpbXkgTGFs?=)
Date: Fri, 03 Sep 2010 11:24:17 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp : is it working with 2.0.0 ?
Message-ID: <4C80BEC1.8060109@melix.org>

Apparently it's not...
i tried building with umbrella, and when rabbitmq-server loads,
it crashes loading the plugin.

I guess it's not yet compatible ?

J?r?my.


From jiri at krutil.com  Fri Sep  3 10:33:59 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Fri, 03 Sep 2010 11:33:59 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
	<20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
	<AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>
Message-ID: <20100903113359.16751xhnxzvszcbo@webmail.active24.cz>

Alexis

I don't think that exclusive queues are a problem. Our clients use  
auto-delete server-named exclusive queues for receiving responses, so  
every time a client re-connects, it must re-create and re-bind its  
exclusive queue(s) anyway, even with a single broker.

The common exchange and queue where requests are sent are pre-declared  
as durable on both brokers.

So I really don't see any resources that require migration.

Regards
Jiri


> Jiri
>
> It makes some sense, but you *will* need to migrate resources, or recreate
> them, to continue working on the secondary.  You will not need to migrate
> messages, but there is other broker state that you will need: for example a
> consumer's exclusive queue on the primary, will need to exist on the
> secondary, with the correct bindings, connection, etc.
>
> So my question is: do you plan to create that queue (etc) on the secondary
> after the primary fails?  If "yes" then a potential issue is managing the
> failover window size and (possible, but less likely) resource limits on the
> secondary.  If "no" then you will need to 'pre build' the spare resources
> somehow.
>
> These are not necessarily difficult issues to solve in any particular
> instance, however I am highlighting them in response to your request for
> feedback.  These issues do become deeper when you try to generalise to
> multiple different failure scenarios, of course.
>
> alexis
>
>
> On Fri, Sep 3, 2010 at 8:40 AM, <jiri at krutil.com> wrote:
>
>> Alexis
>>
>> Our plan is to have two brokers with the same setup, both being actively
>> used at the same time, but each broker serving a different set of clients.
>>
>> Our back-end service will be connected to and process requests from both
>> brokers at the same time.
>>
>> When one broker fails, the clients will loose connection and will have to
>> reconnect, ending up on the other broker. Messages that were on the dead
>> broker will be lost.
>>
>> So we don't need migration of resources between brokers in case of failure,
>> we only need the clients to move their connections to the other broker.
>>
>> Hope that makes sense...
>>
>> Jiri
>>
>>
>>
>>  Jiri
>>>
>>> Cool.  So yes messages will then only arrive out of order in the case
>>> where some arrive from the secondary before 'delayed' messages from
>>> the failed primary; and then, for reordering them, it suffices to know
>>> which broker they came from.  (In the absence of failure, TCP should
>>> take care of reordering).
>>>
>>> I think the issues will be:
>>>
>>> 1. Deciding when to stop listening to a primary.  Given consumers
>>> don't care about message loss, I would suggest "as soon as consumers
>>> are aware of primary failure, then they should ignore further messages
>>> from the primary"
>>>
>>> 2. Failover time.  AIUI you want to minimise this by having a copy of
>>> the whole queue/exchange/binding set-up on both brokers.  But how
>>> exactly do you plan to do this?
>>>
>>> alexis
>>>
>>>
>>> On Fri, Sep 3, 2010 at 8:12 AM,  <jiri at krutil.com> wrote:
>>>
>>>> Alexis
>>>>
>>>> The answer is no - a client can send requests to only one broker at any
>>>> given moment. The client connects via load balancer to one of the brokers
>>>> and stays connected all the time. The client does not even know that
>>>> there
>>>> are two brokers (it only sees one IP address).
>>>>
>>>> I think requests may be delivered out of order only if a client fails
>>>> over
>>>> to another broker. Then messages send to one broker can get mixed up with
>>>> messages sent to the other.
>>>>
>>>> My concern was: are there any other issues with this kind of setup that I
>>>> might have missed? Does anyone have experience with this?
>>>>
>>>> Thanks a lot for your help
>>>> Jiri
>>>>
>>>>
>>>>
>>>>  Jiri
>>>>>
>>>>> You say that "Some clients send requests to one broker, some to the
>>>>> other".
>>>>>
>>>>>
>>>>> Does this mean that one client publisher can send messages (requests) to
>>>>> both brokers, in such a way that a pair of messages may arrive out of
>>>>> order
>>>>> if one is sent to each broker?
>>>>>
>>>>> If the answer is no, then I think my answer stands, because causal order
>>>>> will be preserved even if messages are lost.  That is: messages that
>>>>> arrive
>>>>> successfully, will not be out of order with each other.
>>>>>
>>>>> If the answer is yes, then I am not sure how you can recover global
>>>>> ordering
>>>>> without imposing it at the publisher using sequence numbers at the app
>>>>> level.
>>>>>
>>>>> Does this make sense?
>>>>>
>>>>> alexis
>>>>>
>>>>>
>>>>>
>>>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>>>
>>>>>  Alexis
>>>>>>
>>>>>> Sorry I probably didn't express myself well.
>>>>>>
>>>>>> We don't plan a primary and secondary broker, but a pair of brokers
>>>>>> that
>>>>>> are both active at the same time. A load balancer divides client
>>>>>> connections
>>>>>> to these brokers. A request queue with the same name exists on both
>>>>>> brokers,
>>>>>> but with different contents. Some clients send requests to one broker,
>>>>>> some
>>>>>> to the other. Our back-end server listens to both queues, processes
>>>>>> requests
>>>>>> and sends each response to an exclusive client queue on the broker from
>>>>>> where the request came.
>>>>>>
>>>>>> Ideally this would be transparent to the clients, because the brokers
>>>>>> would
>>>>>> be hidden by a virtual IP address. Of course it can't be transparent to
>>>>>> the
>>>>>> back-end server, which needs to talk to both brokers at the same time.
>>>>>>
>>>>>> So (a) is correct, but (b) not.
>>>>>>
>>>>>> Hope that makes it a bit clearer...
>>>>>>
>>>>>> Cheers
>>>>>> Jiri
>>>>>>
>>>>>>
>>>>>>
>>>>>>  Jiri
>>>>>>
>>>>>>>
>>>>>>> That answered my questions.  Now, as I understood your example:
>>>>>>>
>>>>>>> a. you don't mind messages being lost
>>>>>>> *and*
>>>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>>>
>>>>>>> Note that if consumption is completely 'fire and forget' then it is
>>>>>>> possible that a message from the primary may *arrive* after a message
>>>>>>> from
>>>>>>> the secondary.  But this can happen whether you use sequence numbers
>>>>>>> or
>>>>>>> not.
>>>>>>>
>>>>>>> So if the primary broker fails, why not just forget all undelivered
>>>>>>> messages?  Consumers will know that any message consumed from the
>>>>>>> secondary
>>>>>>> must be later in *all* orderings than any message consumed from the
>>>>>>> primary.
>>>>>>>  So, additional sequence numbering is not necessary.
>>>>>>>
>>>>>>> alexis
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>
>>>
>>
>>
>




From david at rabbitmq.com  Fri Sep  3 10:37:53 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 03 Sep 2010 10:37:53 +0100
Subject: [rabbitmq-discuss] C client now does AMQP 0-9-1 on default
Message-ID: <yrv4ciq2ndv66.fsf@dwragg.eng.vmware.com>

For those who use the rabbitmq-c C client (a.k.a librabbitmq):

I just merged our branch that switches this client to use the AMQP 0-9-1
protocol into "default".  This means that if you now build from
"default", you'll get a client that will only work with
rabbitmq-server-2.0.0 (and later releases).

For the convenience of anyone who wants to continue to use the client
with earlier releases of the server, I have created an "amqp_0_8" branch
in the rabbitmq-c mercurial repository.  But it's unlikely that there
will be much activity on that branch, if any; the focus of our efforts
will be on the 0-9-1-based client.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From abhishek.kona at gmail.com  Fri Sep  3 10:40:54 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 03 Sep 2010 15:10:54 +0530
Subject: [rabbitmq-discuss] Not Able to keep messages persistent
In-Reply-To: <yrv4c62ynuubn.fsf@dwragg.eng.vmware.com>
References: <4C80A049.8020906@gmail.com> <4C80A87E.1070503@gmail.com>
	<yrv4c62ynuubn.fsf@dwragg.eng.vmware.com>
Message-ID: <4C80C2A6.9080202@gmail.com>

  Ok my bad.

When I use transactional mode, (I commit after the operation), the 
messages are persisted.
When I do a basicpublish without any transactions the messages are not 
being persisted (the messages are sent to the queues for sure)

This is the exact problem.
The exact code is:


             this.channel = connection.createChannel();
             this.channel.txSelect();

         Item item = new Item();
         item.setData(data);
         item.setCreationTime(Calendar.getInstance().getTimeInMillis());
         item.setItemId(QUtils.genID());
         item.setQueueName(queuename);
         String itemStringRep = QUtils.ItemToString(item);
         BasicProperties bp = new AMQP.BasicProperties();
         bp.setTimestamp(Calendar.getInstance().getTime());
         bp.setDeliveryMode(2);

         try
         {
             this.channel.queueDeclarePassive(queuename);
             this.channel.basicPublish("default_exchange", queuename, 
bp, itemStringRep.getBytes());

         }
         catch (IOException e)
         {
             throw new QueueServiceException("Enqueue failed: [ Queue 
does not Exists ] " + "[ " + e + " ] ");
         }
         try
         {
             this.channel.txCommit();
         }

When I remove the txCommit and txSelect. the messages are not persisted.

Abhishek Kona



On 03/09/10 1:34 PM, David Wragg wrote:
> Hi Abhishek,
>
> Abhishek Kona<abhishek.kona at gmail.com>  writes:
>> When I am using Transaction Commit, the messages are persisted but
>> without the transaction commits, the messages are not persistent.
>>
>> I am guessing the issue is the messages are not persisted as soon as
>> they are received. But at some time later on by the RabbitMQ.
>> Is this the issue.
> If you put an AMQP channel into transactional mode, and you don't commit
> the transaction, then it's as if the messages were never published.  Not
> only will the messages not be persisted, but the messages won't even go
> into the message queues until you commit the transaction.
>
> Is this consistent with what you are seeing?  If not, could you provide
> a full test program to demonstrate you problem?
>
> David
>


From emile at rabbitmq.com  Fri Sep  3 10:40:55 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Sep 2010 10:40:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp : is it working with 2.0.0 ?
In-Reply-To: <4C80BEC1.8060109@melix.org>
References: <4C80BEC1.8060109@melix.org>
Message-ID: <4C80C2A7.2030304@rabbitmq.com>


Hi J?r?my,

On 03/09/10 10:24, J?r?my Lal wrote:
> Apparently it's not...
> i tried building with umbrella, and when rabbitmq-server loads,
> it crashes loading the plugin.
> 
> I guess it's not yet compatible ?
> 
> J?r?my.

I would suggest setting both rabbitmq-server and rabbitmq-erlang-client
to rabbitmq_v2_0_0 (run "hg up rabbitmq_v2_0_0") after doing a clean
checkout if you want to build plugins that rely on the erlang client at
the moment. What error do you get?



Regards

Emile

From alexis at rabbitmq.com  Fri Sep  3 10:48:01 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Sep 2010 10:48:01 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <20100903113359.16751xhnxzvszcbo@webmail.active24.cz>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
	<20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
	<AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>
	<20100903113359.16751xhnxzvszcbo@webmail.active24.cz>
Message-ID: <AANLkTikZf=HZ8mT08ee16ctwt4zHY1iiiPWCiQjk6KNs@mail.gmail.com>

Jiri

Ahh.  So maybe I misunderstood something.  Is it the case that there
is exactly one 'request' queue on each broker?

alexis


On Fri, Sep 3, 2010 at 10:33 AM,  <jiri at krutil.com> wrote:
> Alexis
>
> I don't think that exclusive queues are a problem. Our clients use
> auto-delete server-named exclusive queues for receiving responses, so every
> time a client re-connects, it must re-create and re-bind its exclusive
> queue(s) anyway, even with a single broker.
>
> The common exchange and queue where requests are sent are pre-declared as
> durable on both brokers.
>
> So I really don't see any resources that require migration.
>
> Regards
> Jiri
>
>
>> Jiri
>>
>> It makes some sense, but you *will* need to migrate resources, or recreate
>> them, to continue working on the secondary. ?You will not need to migrate
>> messages, but there is other broker state that you will need: for example
>> a
>> consumer's exclusive queue on the primary, will need to exist on the
>> secondary, with the correct bindings, connection, etc.
>>
>> So my question is: do you plan to create that queue (etc) on the secondary
>> after the primary fails? ?If "yes" then a potential issue is managing the
>> failover window size and (possible, but less likely) resource limits on
>> the
>> secondary. ?If "no" then you will need to 'pre build' the spare resources
>> somehow.
>>
>> These are not necessarily difficult issues to solve in any particular
>> instance, however I am highlighting them in response to your request for
>> feedback. ?These issues do become deeper when you try to generalise to
>> multiple different failure scenarios, of course.
>>
>> alexis
>>
>>
>> On Fri, Sep 3, 2010 at 8:40 AM, <jiri at krutil.com> wrote:
>>
>>> Alexis
>>>
>>> Our plan is to have two brokers with the same setup, both being actively
>>> used at the same time, but each broker serving a different set of
>>> clients.
>>>
>>> Our back-end service will be connected to and process requests from both
>>> brokers at the same time.
>>>
>>> When one broker fails, the clients will loose connection and will have to
>>> reconnect, ending up on the other broker. Messages that were on the dead
>>> broker will be lost.
>>>
>>> So we don't need migration of resources between brokers in case of
>>> failure,
>>> we only need the clients to move their connections to the other broker.
>>>
>>> Hope that makes sense...
>>>
>>> Jiri
>>>
>>>
>>>
>>> ?Jiri
>>>>
>>>> Cool. ?So yes messages will then only arrive out of order in the case
>>>> where some arrive from the secondary before 'delayed' messages from
>>>> the failed primary; and then, for reordering them, it suffices to know
>>>> which broker they came from. ?(In the absence of failure, TCP should
>>>> take care of reordering).
>>>>
>>>> I think the issues will be:
>>>>
>>>> 1. Deciding when to stop listening to a primary. ?Given consumers
>>>> don't care about message loss, I would suggest "as soon as consumers
>>>> are aware of primary failure, then they should ignore further messages
>>>> from the primary"
>>>>
>>>> 2. Failover time. ?AIUI you want to minimise this by having a copy of
>>>> the whole queue/exchange/binding set-up on both brokers. ?But how
>>>> exactly do you plan to do this?
>>>>
>>>> alexis
>>>>
>>>>
>>>> On Fri, Sep 3, 2010 at 8:12 AM, ?<jiri at krutil.com> wrote:
>>>>
>>>>> Alexis
>>>>>
>>>>> The answer is no - a client can send requests to only one broker at any
>>>>> given moment. The client connects via load balancer to one of the
>>>>> brokers
>>>>> and stays connected all the time. The client does not even know that
>>>>> there
>>>>> are two brokers (it only sees one IP address).
>>>>>
>>>>> I think requests may be delivered out of order only if a client fails
>>>>> over
>>>>> to another broker. Then messages send to one broker can get mixed up
>>>>> with
>>>>> messages sent to the other.
>>>>>
>>>>> My concern was: are there any other issues with this kind of setup that
>>>>> I
>>>>> might have missed? Does anyone have experience with this?
>>>>>
>>>>> Thanks a lot for your help
>>>>> Jiri
>>>>>
>>>>>
>>>>>
>>>>> ?Jiri
>>>>>>
>>>>>> You say that "Some clients send requests to one broker, some to the
>>>>>> other".
>>>>>>
>>>>>>
>>>>>> Does this mean that one client publisher can send messages (requests)
>>>>>> to
>>>>>> both brokers, in such a way that a pair of messages may arrive out of
>>>>>> order
>>>>>> if one is sent to each broker?
>>>>>>
>>>>>> If the answer is no, then I think my answer stands, because causal
>>>>>> order
>>>>>> will be preserved even if messages are lost. ?That is: messages that
>>>>>> arrive
>>>>>> successfully, will not be out of order with each other.
>>>>>>
>>>>>> If the answer is yes, then I am not sure how you can recover global
>>>>>> ordering
>>>>>> without imposing it at the publisher using sequence numbers at the app
>>>>>> level.
>>>>>>
>>>>>> Does this make sense?
>>>>>>
>>>>>> alexis
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>>>>
>>>>>> ?Alexis
>>>>>>>
>>>>>>> Sorry I probably didn't express myself well.
>>>>>>>
>>>>>>> We don't plan a primary and secondary broker, but a pair of brokers
>>>>>>> that
>>>>>>> are both active at the same time. A load balancer divides client
>>>>>>> connections
>>>>>>> to these brokers. A request queue with the same name exists on both
>>>>>>> brokers,
>>>>>>> but with different contents. Some clients send requests to one
>>>>>>> broker,
>>>>>>> some
>>>>>>> to the other. Our back-end server listens to both queues, processes
>>>>>>> requests
>>>>>>> and sends each response to an exclusive client queue on the broker
>>>>>>> from
>>>>>>> where the request came.
>>>>>>>
>>>>>>> Ideally this would be transparent to the clients, because the brokers
>>>>>>> would
>>>>>>> be hidden by a virtual IP address. Of course it can't be transparent
>>>>>>> to
>>>>>>> the
>>>>>>> back-end server, which needs to talk to both brokers at the same
>>>>>>> time.
>>>>>>>
>>>>>>> So (a) is correct, but (b) not.
>>>>>>>
>>>>>>> Hope that makes it a bit clearer...
>>>>>>>
>>>>>>> Cheers
>>>>>>> Jiri
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ?Jiri
>>>>>>>
>>>>>>>>
>>>>>>>> That answered my questions. ?Now, as I understood your example:
>>>>>>>>
>>>>>>>> a. you don't mind messages being lost
>>>>>>>> *and*
>>>>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>>>>
>>>>>>>> Note that if consumption is completely 'fire and forget' then it is
>>>>>>>> possible that a message from the primary may *arrive* after a
>>>>>>>> message
>>>>>>>> from
>>>>>>>> the secondary. ?But this can happen whether you use sequence numbers
>>>>>>>> or
>>>>>>>> not.
>>>>>>>>
>>>>>>>> So if the primary broker fails, why not just forget all undelivered
>>>>>>>> messages? ?Consumers will know that any message consumed from the
>>>>>>>> secondary
>>>>>>>> must be later in *all* orderings than any message consumed from the
>>>>>>>> primary.
>>>>>>>> ?So, additional sequence numbering is not necessary.
>>>>>>>>
>>>>>>>> alexis
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>
>
>
>
>

From kapouer at melix.org  Fri Sep  3 11:01:47 2010
From: kapouer at melix.org (=?UTF-8?B?SsOpcsOpbXkgTGFs?=)
Date: Fri, 03 Sep 2010 12:01:47 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp : is it working with 2.0.0 ?
In-Reply-To: <4C80C2A7.2030304@rabbitmq.com>
References: <4C80BEC1.8060109@melix.org> <4C80C2A7.2030304@rabbitmq.com>
Message-ID: <4C80C78B.1040304@melix.org>

On 03/09/2010 11:53, Emile Joubert wrote:
> 
> Hi J?r?my,
> 
> On 03/09/10 10:46, J?r?my Lal wrote:
>> On 03/09/2010 11:40, Emile Joubert wrote:
>>>
>>> Hi J?r?my,
>>>
>>> On 03/09/10 10:24, J?r?my Lal wrote:
>>>> Apparently it's not...
>>>> i tried building with umbrella, and when rabbitmq-server loads,
>>>> it crashes loading the plugin.
>>>>
>>>> I guess it's not yet compatible ?
>>>>
>>>> J?r?my.
>>>
>>> I would suggest setting both rabbitmq-server and rabbitmq-erlang-client
>>> to rabbitmq_v2_0_0 (run "hg up rabbitmq_v2_0_0") 
>>
>> is it rabbitmq-erlang-client a build dependency ? because it builds ok.
>> if it's only a runtime dependency it might be missing, indeed, i'll check it out.
>>
>>> after doing a clean
>>> checkout if you want to build plugins that rely on the erlang client at
>>> the moment. What error do you get?
>>
>> Activating RabbitMQ plugins ...{"init terminating in do_boot",{{badmatch,{error,eacces}},[{rabbit_plugin_activator,delete_dir,1},{rabbit_plugin_activator,'-delete_dir/1-lc$^0/1-0-',2},{rabbit_plugin_activator,delete_dir,1},{rabbit_plugin_activator,'-delete_dir/1-lc$^0/1-0-',2},{rabbit_plugin_activator,delete_dir,1},{rabbit_plugin_activator,unpack_ez_plugins,2},{rabbit_plugin_activator,start,0},{init,start_it,1}]}}
>>
>> Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>>
>> Regards,
>> J?r?my.
>>
> 
> I would suggest checking permissions in the
> $RABBITMQ_MNESIA_BASE/plugins-scratch folder. It looks like the failure
> occured in the rabbit_plugin_activator:delete_dir().

Well, there was some permission trouble indeed.
I purged rabbitmq and reinstalled it, and plugin-scratch files became owned
by rabbitmq instead of root.
Now it works.

Thank you,
J?r?my.


From simon at rabbitmq.com  Fri Sep  3 11:06:01 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 Sep 2010 11:06:01 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp : is it working with 2.0.0 ?
In-Reply-To: <4C80C78B.1040304@melix.org>
References: <4C80BEC1.8060109@melix.org> <4C80C2A7.2030304@rabbitmq.com>
	<4C80C78B.1040304@melix.org>
Message-ID: <4C80C889.8060302@rabbitmq.com>

On 03/09/10 11:01, J?r?my Lal wrote:
> Well, there was some permission trouble indeed.
> I purged rabbitmq and reinstalled it, and plugin-scratch files became owned
> by rabbitmq instead of root.

Ah. That implies you ran RabbitMQ as root somehow. I'd be interested to 
know how.

FWIW the next release will have some code to detect that and report 
something sensible.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri at krutil.com  Fri Sep  3 11:15:57 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Fri, 03 Sep 2010 12:15:57 +0200
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <AANLkTikZf=HZ8mT08ee16ctwt4zHY1iiiPWCiQjk6KNs@mail.gmail.com>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
	<20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
	<AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>
	<20100903113359.16751xhnxzvszcbo@webmail.active24.cz>
	<AANLkTikZf=HZ8mT08ee16ctwt4zHY1iiiPWCiQjk6KNs@mail.gmail.com>
Message-ID: <20100903121557.11176pg7e5zw09c8@webmail.active24.cz>

Alexis

Yes, precisely. One request queue bound to one request exchange per  
broker plus one response exchange per broker, all durable.

Responses go via the response exchange to client-specific exclusive  
auto-delete queues according to message reply-to attribute.

Sorry for not being clear about that.

Cheers
Jiri


> Jiri
>
> Ahh.  So maybe I misunderstood something.  Is it the case that there
> is exactly one 'request' queue on each broker?
>
> alexis
>
>
> On Fri, Sep 3, 2010 at 10:33 AM,  <jiri at krutil.com> wrote:
>> Alexis
>>
>> I don't think that exclusive queues are a problem. Our clients use
>> auto-delete server-named exclusive queues for receiving responses, so every
>> time a client re-connects, it must re-create and re-bind its exclusive
>> queue(s) anyway, even with a single broker.
>>
>> The common exchange and queue where requests are sent are pre-declared as
>> durable on both brokers.
>>
>> So I really don't see any resources that require migration.
>>
>> Regards
>> Jiri
>>
>>
>>> Jiri
>>>
>>> It makes some sense, but you *will* need to migrate resources, or recreate
>>> them, to continue working on the secondary. ?You will not need to migrate
>>> messages, but there is other broker state that you will need: for example
>>> a
>>> consumer's exclusive queue on the primary, will need to exist on the
>>> secondary, with the correct bindings, connection, etc.
>>>
>>> So my question is: do you plan to create that queue (etc) on the secondary
>>> after the primary fails? ?If "yes" then a potential issue is managing the
>>> failover window size and (possible, but less likely) resource limits on
>>> the
>>> secondary. ?If "no" then you will need to 'pre build' the spare resources
>>> somehow.
>>>
>>> These are not necessarily difficult issues to solve in any particular
>>> instance, however I am highlighting them in response to your request for
>>> feedback. ?These issues do become deeper when you try to generalise to
>>> multiple different failure scenarios, of course.
>>>
>>> alexis
>>>
>>>
>>> On Fri, Sep 3, 2010 at 8:40 AM, <jiri at krutil.com> wrote:
>>>
>>>> Alexis
>>>>
>>>> Our plan is to have two brokers with the same setup, both being actively
>>>> used at the same time, but each broker serving a different set of
>>>> clients.
>>>>
>>>> Our back-end service will be connected to and process requests from both
>>>> brokers at the same time.
>>>>
>>>> When one broker fails, the clients will loose connection and will have to
>>>> reconnect, ending up on the other broker. Messages that were on the dead
>>>> broker will be lost.
>>>>
>>>> So we don't need migration of resources between brokers in case of
>>>> failure,
>>>> we only need the clients to move their connections to the other broker.
>>>>
>>>> Hope that makes sense...
>>>>
>>>> Jiri
>>>>
>>>>
>>>>
>>>> ?Jiri
>>>>>
>>>>> Cool. ?So yes messages will then only arrive out of order in the case
>>>>> where some arrive from the secondary before 'delayed' messages from
>>>>> the failed primary; and then, for reordering them, it suffices to know
>>>>> which broker they came from. ?(In the absence of failure, TCP should
>>>>> take care of reordering).
>>>>>
>>>>> I think the issues will be:
>>>>>
>>>>> 1. Deciding when to stop listening to a primary. ?Given consumers
>>>>> don't care about message loss, I would suggest "as soon as consumers
>>>>> are aware of primary failure, then they should ignore further messages
>>>>> from the primary"
>>>>>
>>>>> 2. Failover time. ?AIUI you want to minimise this by having a copy of
>>>>> the whole queue/exchange/binding set-up on both brokers. ?But how
>>>>> exactly do you plan to do this?
>>>>>
>>>>> alexis
>>>>>
>>>>>
>>>>> On Fri, Sep 3, 2010 at 8:12 AM, ?<jiri at krutil.com> wrote:
>>>>>
>>>>>> Alexis
>>>>>>
>>>>>> The answer is no - a client can send requests to only one broker at any
>>>>>> given moment. The client connects via load balancer to one of the
>>>>>> brokers
>>>>>> and stays connected all the time. The client does not even know that
>>>>>> there
>>>>>> are two brokers (it only sees one IP address).
>>>>>>
>>>>>> I think requests may be delivered out of order only if a client fails
>>>>>> over
>>>>>> to another broker. Then messages send to one broker can get mixed up
>>>>>> with
>>>>>> messages sent to the other.
>>>>>>
>>>>>> My concern was: are there any other issues with this kind of setup that
>>>>>> I
>>>>>> might have missed? Does anyone have experience with this?
>>>>>>
>>>>>> Thanks a lot for your help
>>>>>> Jiri
>>>>>>
>>>>>>
>>>>>>
>>>>>> ?Jiri
>>>>>>>
>>>>>>> You say that "Some clients send requests to one broker, some to the
>>>>>>> other".
>>>>>>>
>>>>>>>
>>>>>>> Does this mean that one client publisher can send messages (requests)
>>>>>>> to
>>>>>>> both brokers, in such a way that a pair of messages may arrive out of
>>>>>>> order
>>>>>>> if one is sent to each broker?
>>>>>>>
>>>>>>> If the answer is no, then I think my answer stands, because causal
>>>>>>> order
>>>>>>> will be preserved even if messages are lost. ?That is: messages that
>>>>>>> arrive
>>>>>>> successfully, will not be out of order with each other.
>>>>>>>
>>>>>>> If the answer is yes, then I am not sure how you can recover global
>>>>>>> ordering
>>>>>>> without imposing it at the publisher using sequence numbers at the app
>>>>>>> level.
>>>>>>>
>>>>>>> Does this make sense?
>>>>>>>
>>>>>>> alexis
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>>>>>
>>>>>>> ?Alexis
>>>>>>>>
>>>>>>>> Sorry I probably didn't express myself well.
>>>>>>>>
>>>>>>>> We don't plan a primary and secondary broker, but a pair of brokers
>>>>>>>> that
>>>>>>>> are both active at the same time. A load balancer divides client
>>>>>>>> connections
>>>>>>>> to these brokers. A request queue with the same name exists on both
>>>>>>>> brokers,
>>>>>>>> but with different contents. Some clients send requests to one
>>>>>>>> broker,
>>>>>>>> some
>>>>>>>> to the other. Our back-end server listens to both queues, processes
>>>>>>>> requests
>>>>>>>> and sends each response to an exclusive client queue on the broker
>>>>>>>> from
>>>>>>>> where the request came.
>>>>>>>>
>>>>>>>> Ideally this would be transparent to the clients, because the brokers
>>>>>>>> would
>>>>>>>> be hidden by a virtual IP address. Of course it can't be transparent
>>>>>>>> to
>>>>>>>> the
>>>>>>>> back-end server, which needs to talk to both brokers at the same
>>>>>>>> time.
>>>>>>>>
>>>>>>>> So (a) is correct, but (b) not.
>>>>>>>>
>>>>>>>> Hope that makes it a bit clearer...
>>>>>>>>
>>>>>>>> Cheers
>>>>>>>> Jiri
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> ?Jiri
>>>>>>>>
>>>>>>>>>
>>>>>>>>> That answered my questions. ?Now, as I understood your example:
>>>>>>>>>
>>>>>>>>> a. you don't mind messages being lost
>>>>>>>>> *and*
>>>>>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>>>>>
>>>>>>>>> Note that if consumption is completely 'fire and forget' then it is
>>>>>>>>> possible that a message from the primary may *arrive* after a
>>>>>>>>> message
>>>>>>>>> from
>>>>>>>>> the secondary. ?But this can happen whether you use sequence numbers
>>>>>>>>> or
>>>>>>>>> not.
>>>>>>>>>
>>>>>>>>> So if the primary broker fails, why not just forget all undelivered
>>>>>>>>> messages? ?Consumers will know that any message consumed from the
>>>>>>>>> secondary
>>>>>>>>> must be later in *all* orderings than any message consumed from the
>>>>>>>>> primary.
>>>>>>>>> ?So, additional sequence numbering is not necessary.
>>>>>>>>>
>>>>>>>>> alexis
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>
>>>>
>>>
>>
>>
>>
>>
>



From jaimemm at gmail.com  Fri Sep  3 11:22:27 2010
From: jaimemm at gmail.com (Jaime Martinez)
Date: Fri, 3 Sep 2010 12:22:27 +0200
Subject: [rabbitmq-discuss] HA + Clustering in EC2 with Amazon Autoescale
Message-ID: <AANLkTi=HgiPS01fT1X2vCfqHBJGv3-zmCPFGxnLhikaC@mail.gmail.com>

Hi,

Here is the scenario:

- More than 1 pair of Active + Passive RabbitMQ servers per EC2 instance,
all of them in cluster.
- Autoescale will start a new EC2 instances and has to add the new RabbitMQ
HA servers to the same cluster as the previous instances

It looks pretty tricky since to add server instances to a cluster is
necessary to know their identifiers. Did anyone tried this? What would it be
the right way of doing it?

Thanks

-- 
Jaime Martinez Muradas
Spain Mobile: +34656833035
UK mobile: +447858503623
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/dd47c822/attachment.htm>

From michaelburns1 at gmail.com  Fri Sep  3 11:38:09 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Fri, 3 Sep 2010 11:38:09 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <20100903082934.GB2873@dakota.eng.vmware.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
Message-ID: <AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>

Hi Alex,
I ran the multicast client and am getting speeds like:

sending rate: 3550 msg/s, basic returns: 0 ret/s
recving rate: 3461 msg/s, min/avg/max latency: 11931197/12253891/12477030
microseconds

If I let it run for a bit then sometimes both the sending and receiving rate
drop significantly e.g.:

sending rate: 638 msg/s, basic returns: 0 ret/s
recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
microseconds

Not sure if this drop is indicative of anything?

We're using the java client 1.8.1, the broker is rabbitmq_server-1.8.1

Thanks
Michael

On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi Michael,
>
> > We are putting a very low volume of messages through and have sometimes
> had
> > to wait up to 15 minutes for a single message to be delivered (at the
> time
> > this was the only message in the system).
>
> That sounds strage.  Are you up for a bit of debugging?
>
> Download the java client,
>  http://www.rabbitmq.com/java-client.html
>
> Unpack it, and run
>  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
>
> That command will run one of our example programmes in a way that
> matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
>
> When I run it, I get speeds like:
>  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637
> microseconds
>  sending rate: 6419 msg/s, basic returns: 0 ret/s
>
> If you're getting similar speeds, there's probably something wrong with
> the consumers/producers.  If not, it might be something to do with the
> server.
>
> Could you please try it?
>
> Also, which version the broker and which client are you using?
>
> Cheers,
> Alex
>
> On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> > Hi,
> >
> > We're just starting out with RabbitMQ and have a very simple setup: one
> > queue, one producer doing a basicPublish and one consumer doing a
> > basicConsume using QueueingConsumer.
> >
> > For the most part it works fine however at fairly regular intervals we
> are
> > finding that messages remain on the queue for a considerable period
> before
> > being delivered to the consumer.
> >
> > We are putting a very low volume of messages through and have sometimes
> had
> > to wait up to 15 minutes for a single message to be delivered (at the
> time
> > this was the only message in the system).
> >
> > In all cases the messages are eventually delivered.
> >
> > I dont know where to start debugging this as there is nothing in the
> > RabbitMQ logs thats suggests something is going wrong - could anyone
> point
> > me in the right direction as to what may be causing this?
> >
> > Many Thanks,
> > Michael
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/a3eae644/attachment.htm>

From alexis at rabbitmq.com  Fri Sep  3 12:11:29 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Sep 2010 12:11:29 +0100
Subject: [rabbitmq-discuss] Active/active HA setup
In-Reply-To: <20100903121557.11176pg7e5zw09c8@webmail.active24.cz>
References: <20100902170920.19781kbuh1o0cd9c@webmail.active24.cz>
	<AANLkTi=U+aMTDG_N8TYHbkgTwESGFsgAvgdqhFR=7NLe@mail.gmail.com>
	<FAB6AFF1-80FE-439A-B70E-83997926186B@krutil.com>
	<AANLkTinLaUb3MiE1M4OMcfd12K-CunBiaq_n2DnCRMS4@mail.gmail.com>
	<4C800D2E.9070409@krutil.com>
	<AANLkTi=X2LABYt0-GCpRjytQdwLzR=UXs8YB7VLN378U@mail.gmail.com>
	<20100903091236.19695rzrv2yog5k4@webmail.active24.cz>
	<AANLkTin1QSGukHmQdWnzerW3YaCZY-E-KGtMyC7WsbfC@mail.gmail.com>
	<20100903094040.25063qmuafrqw4u8@webmail.active24.cz>
	<AANLkTineuO-6DRfPgQZZY51rQrNMJys6_4ZexaYvHehw@mail.gmail.com>
	<20100903113359.16751xhnxzvszcbo@webmail.active24.cz>
	<AANLkTikZf=HZ8mT08ee16ctwt4zHY1iiiPWCiQjk6KNs@mail.gmail.com>
	<20100903121557.11176pg7e5zw09c8@webmail.active24.cz>
Message-ID: <AANLkTimfBSZ6oJV8MY58SYqL79MFHjv6U5mG+LPmY5PA@mail.gmail.com>

Cool.

So, I would suggest going ahead with this.  I think we have explored
the main issues.  Thank-you very much for asking about it on the list!

Do please tell us how you get on...

alexis


On Fri, Sep 3, 2010 at 11:15 AM,  <jiri at krutil.com> wrote:
> Alexis
>
> Yes, precisely. One request queue bound to one request exchange per broker
> plus one response exchange per broker, all durable.
>
> Responses go via the response exchange to client-specific exclusive
> auto-delete queues according to message reply-to attribute.
>
> Sorry for not being clear about that.
>
> Cheers
> Jiri
>
>
>> Jiri
>>
>> Ahh. ?So maybe I misunderstood something. ?Is it the case that there
>> is exactly one 'request' queue on each broker?
>>
>> alexis
>>
>>
>> On Fri, Sep 3, 2010 at 10:33 AM, ?<jiri at krutil.com> wrote:
>>>
>>> Alexis
>>>
>>> I don't think that exclusive queues are a problem. Our clients use
>>> auto-delete server-named exclusive queues for receiving responses, so
>>> every
>>> time a client re-connects, it must re-create and re-bind its exclusive
>>> queue(s) anyway, even with a single broker.
>>>
>>> The common exchange and queue where requests are sent are pre-declared as
>>> durable on both brokers.
>>>
>>> So I really don't see any resources that require migration.
>>>
>>> Regards
>>> Jiri
>>>
>>>
>>>> Jiri
>>>>
>>>> It makes some sense, but you *will* need to migrate resources, or
>>>> recreate
>>>> them, to continue working on the secondary. ?You will not need to
>>>> migrate
>>>> messages, but there is other broker state that you will need: for
>>>> example
>>>> a
>>>> consumer's exclusive queue on the primary, will need to exist on the
>>>> secondary, with the correct bindings, connection, etc.
>>>>
>>>> So my question is: do you plan to create that queue (etc) on the
>>>> secondary
>>>> after the primary fails? ?If "yes" then a potential issue is managing
>>>> the
>>>> failover window size and (possible, but less likely) resource limits on
>>>> the
>>>> secondary. ?If "no" then you will need to 'pre build' the spare
>>>> resources
>>>> somehow.
>>>>
>>>> These are not necessarily difficult issues to solve in any particular
>>>> instance, however I am highlighting them in response to your request for
>>>> feedback. ?These issues do become deeper when you try to generalise to
>>>> multiple different failure scenarios, of course.
>>>>
>>>> alexis
>>>>
>>>>
>>>> On Fri, Sep 3, 2010 at 8:40 AM, <jiri at krutil.com> wrote:
>>>>
>>>>> Alexis
>>>>>
>>>>> Our plan is to have two brokers with the same setup, both being
>>>>> actively
>>>>> used at the same time, but each broker serving a different set of
>>>>> clients.
>>>>>
>>>>> Our back-end service will be connected to and process requests from
>>>>> both
>>>>> brokers at the same time.
>>>>>
>>>>> When one broker fails, the clients will loose connection and will have
>>>>> to
>>>>> reconnect, ending up on the other broker. Messages that were on the
>>>>> dead
>>>>> broker will be lost.
>>>>>
>>>>> So we don't need migration of resources between brokers in case of
>>>>> failure,
>>>>> we only need the clients to move their connections to the other broker.
>>>>>
>>>>> Hope that makes sense...
>>>>>
>>>>> Jiri
>>>>>
>>>>>
>>>>>
>>>>> ?Jiri
>>>>>>
>>>>>> Cool. ?So yes messages will then only arrive out of order in the case
>>>>>> where some arrive from the secondary before 'delayed' messages from
>>>>>> the failed primary; and then, for reordering them, it suffices to know
>>>>>> which broker they came from. ?(In the absence of failure, TCP should
>>>>>> take care of reordering).
>>>>>>
>>>>>> I think the issues will be:
>>>>>>
>>>>>> 1. Deciding when to stop listening to a primary. ?Given consumers
>>>>>> don't care about message loss, I would suggest "as soon as consumers
>>>>>> are aware of primary failure, then they should ignore further messages
>>>>>> from the primary"
>>>>>>
>>>>>> 2. Failover time. ?AIUI you want to minimise this by having a copy of
>>>>>> the whole queue/exchange/binding set-up on both brokers. ?But how
>>>>>> exactly do you plan to do this?
>>>>>>
>>>>>> alexis
>>>>>>
>>>>>>
>>>>>> On Fri, Sep 3, 2010 at 8:12 AM, ?<jiri at krutil.com> wrote:
>>>>>>
>>>>>>> Alexis
>>>>>>>
>>>>>>> The answer is no - a client can send requests to only one broker at
>>>>>>> any
>>>>>>> given moment. The client connects via load balancer to one of the
>>>>>>> brokers
>>>>>>> and stays connected all the time. The client does not even know that
>>>>>>> there
>>>>>>> are two brokers (it only sees one IP address).
>>>>>>>
>>>>>>> I think requests may be delivered out of order only if a client fails
>>>>>>> over
>>>>>>> to another broker. Then messages send to one broker can get mixed up
>>>>>>> with
>>>>>>> messages sent to the other.
>>>>>>>
>>>>>>> My concern was: are there any other issues with this kind of setup
>>>>>>> that
>>>>>>> I
>>>>>>> might have missed? Does anyone have experience with this?
>>>>>>>
>>>>>>> Thanks a lot for your help
>>>>>>> Jiri
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ?Jiri
>>>>>>>>
>>>>>>>> You say that "Some clients send requests to one broker, some to the
>>>>>>>> other".
>>>>>>>>
>>>>>>>>
>>>>>>>> Does this mean that one client publisher can send messages
>>>>>>>> (requests)
>>>>>>>> to
>>>>>>>> both brokers, in such a way that a pair of messages may arrive out
>>>>>>>> of
>>>>>>>> order
>>>>>>>> if one is sent to each broker?
>>>>>>>>
>>>>>>>> If the answer is no, then I think my answer stands, because causal
>>>>>>>> order
>>>>>>>> will be preserved even if messages are lost. ?That is: messages that
>>>>>>>> arrive
>>>>>>>> successfully, will not be out of order with each other.
>>>>>>>>
>>>>>>>> If the answer is yes, then I am not sure how you can recover global
>>>>>>>> ordering
>>>>>>>> without imposing it at the publisher using sequence numbers at the
>>>>>>>> app
>>>>>>>> level.
>>>>>>>>
>>>>>>>> Does this make sense?
>>>>>>>>
>>>>>>>> alexis
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>>>>>>
>>>>>>>> ?Alexis
>>>>>>>>>
>>>>>>>>> Sorry I probably didn't express myself well.
>>>>>>>>>
>>>>>>>>> We don't plan a primary and secondary broker, but a pair of brokers
>>>>>>>>> that
>>>>>>>>> are both active at the same time. A load balancer divides client
>>>>>>>>> connections
>>>>>>>>> to these brokers. A request queue with the same name exists on both
>>>>>>>>> brokers,
>>>>>>>>> but with different contents. Some clients send requests to one
>>>>>>>>> broker,
>>>>>>>>> some
>>>>>>>>> to the other. Our back-end server listens to both queues, processes
>>>>>>>>> requests
>>>>>>>>> and sends each response to an exclusive client queue on the broker
>>>>>>>>> from
>>>>>>>>> where the request came.
>>>>>>>>>
>>>>>>>>> Ideally this would be transparent to the clients, because the
>>>>>>>>> brokers
>>>>>>>>> would
>>>>>>>>> be hidden by a virtual IP address. Of course it can't be
>>>>>>>>> transparent
>>>>>>>>> to
>>>>>>>>> the
>>>>>>>>> back-end server, which needs to talk to both brokers at the same
>>>>>>>>> time.
>>>>>>>>>
>>>>>>>>> So (a) is correct, but (b) not.
>>>>>>>>>
>>>>>>>>> Hope that makes it a bit clearer...
>>>>>>>>>
>>>>>>>>> Cheers
>>>>>>>>> Jiri
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> ?Jiri
>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> That answered my questions. ?Now, as I understood your example:
>>>>>>>>>>
>>>>>>>>>> a. you don't mind messages being lost
>>>>>>>>>> *and*
>>>>>>>>>> b. you don't use the secondary until after the primary has failed.
>>>>>>>>>>
>>>>>>>>>> Note that if consumption is completely 'fire and forget' then it
>>>>>>>>>> is
>>>>>>>>>> possible that a message from the primary may *arrive* after a
>>>>>>>>>> message
>>>>>>>>>> from
>>>>>>>>>> the secondary. ?But this can happen whether you use sequence
>>>>>>>>>> numbers
>>>>>>>>>> or
>>>>>>>>>> not.
>>>>>>>>>>
>>>>>>>>>> So if the primary broker fails, why not just forget all
>>>>>>>>>> undelivered
>>>>>>>>>> messages? ?Consumers will know that any message consumed from the
>>>>>>>>>> secondary
>>>>>>>>>> must be later in *all* orderings than any message consumed from
>>>>>>>>>> the
>>>>>>>>>> primary.
>>>>>>>>>> ?So, additional sequence numbering is not necessary.
>>>>>>>>>>
>>>>>>>>>> alexis
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>>
>>
>
>
>

From jon at jbrisbin.com  Fri Sep  3 12:51:57 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 3 Sep 2010 06:51:57 -0500
Subject: [rabbitmq-discuss] suggestions for improving spring-amqp
Message-ID: <3F055192-FF17-4CF7-BB22-0FBF9A97430F@jbrisbin.com>

There's a couple things I'd like to suggest improvements for in spring-amqp and wanted to know if I should just create issues on the Jira or send patches or some combination of both?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/82b8a0ee/attachment.htm>

From alexandru at rabbitmq.com  Fri Sep  3 13:02:34 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 3 Sep 2010 13:02:34 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
Message-ID: <20100903120234.GD2873@dakota.eng.vmware.com>

Hi Michael,

> If I let it run for a bit then sometimes both the sending and receiving rate
> drop significantly e.g.:
> 
> sending rate: 638 msg/s, basic returns: 0 ret/s
> recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
> microseconds
> 
> Not sure if this drop is indicative of anything?

Probably not.  Since the sending rate tends to be a bit higher than the
receiving rate, messages are probably piling up in the queue and
rabbit's running out of memory.  You can check if this is the case by
running rabbitmqctl list_queues [when the slowdown occurs].

This means that the broker's fine in your setup.

When the slowdown occurs, does rabbit pick up speed a bit later?  Or do
you have to restart it or something else of the sort?

When it occurs, does list_queues show a large number of messages?  If
so, you're probably not ack'ing the messages after consuming them.

On an unrelated note, 2.0.0 is out, so you might want to upgrade.

Cheers,
Alex

On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
> Hi Alex,
> I ran the multicast client and am getting speeds like:
> 
> sending rate: 3550 msg/s, basic returns: 0 ret/s
> recving rate: 3461 msg/s, min/avg/max latency: 11931197/12253891/12477030
> microseconds
> 
> If I let it run for a bit then sometimes both the sending and receiving rate
> drop significantly e.g.:
> 
> sending rate: 638 msg/s, basic returns: 0 ret/s
> recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
> microseconds
> 
> Not sure if this drop is indicative of anything?
> 
> We're using the java client 1.8.1, the broker is rabbitmq_server-1.8.1
> 
> Thanks
> Michael
> 
> On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > Hi Michael,
> >
> > > We are putting a very low volume of messages through and have sometimes
> > had
> > > to wait up to 15 minutes for a single message to be delivered (at the
> > time
> > > this was the only message in the system).
> >
> > That sounds strage.  Are you up for a bit of debugging?
> >
> > Download the java client,
> >  http://www.rabbitmq.com/java-client.html
> >
> > Unpack it, and run
> >  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
> >
> > That command will run one of our example programmes in a way that
> > matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
> >
> > When I run it, I get speeds like:
> >  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637
> > microseconds
> >  sending rate: 6419 msg/s, basic returns: 0 ret/s
> >
> > If you're getting similar speeds, there's probably something wrong with
> > the consumers/producers.  If not, it might be something to do with the
> > server.
> >
> > Could you please try it?
> >
> > Also, which version the broker and which client are you using?
> >
> > Cheers,
> > Alex
> >
> > On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> > > Hi,
> > >
> > > We're just starting out with RabbitMQ and have a very simple setup: one
> > > queue, one producer doing a basicPublish and one consumer doing a
> > > basicConsume using QueueingConsumer.
> > >
> > > For the most part it works fine however at fairly regular intervals we
> > are
> > > finding that messages remain on the queue for a considerable period
> > before
> > > being delivered to the consumer.
> > >
> > > We are putting a very low volume of messages through and have sometimes
> > had
> > > to wait up to 15 minutes for a single message to be delivered (at the
> > time
> > > this was the only message in the system).
> > >
> > > In all cases the messages are eventually delivered.
> > >
> > > I dont know where to start debugging this as there is nothing in the
> > > RabbitMQ logs thats suggests something is going wrong - could anyone
> > point
> > > me in the right direction as to what may be causing this?
> > >
> > > Many Thanks,
> > > Michael
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >

From matthew at rabbitmq.com  Fri Sep  3 13:08:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 3 Sep 2010 13:08:07 +0100
Subject: [rabbitmq-discuss] Not Able to keep messages persistent
In-Reply-To: <4C80C2A6.9080202@gmail.com>
References: <4C80A049.8020906@gmail.com> <4C80A87E.1070503@gmail.com>
	<yrv4c62ynuubn.fsf@dwragg.eng.vmware.com>
	<4C80C2A6.9080202@gmail.com>
Message-ID: <20100903120806.GB10624@rabbitmq.com>

On Fri, Sep 03, 2010 at 03:10:54PM +0530, Abhishek Kona wrote:
> When I remove the txCommit and txSelect. the messages are not persisted.

How are you shutting down Rabbit? - if you're hard killing it then the
messages will be sitting in some buffer somewhere waiting to go to disk
and will never make it. If you shutdown Rabbit nicely, using the various
scripts, then all such buffers should be flushed.

Publishing persistent messages to durable queues without using
transactions gives no guarantees of when messages will be written to
disk.

Matthew

From alexis at rabbitmq.com  Fri Sep  3 15:18:44 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Sep 2010 15:18:44 +0100
Subject: [rabbitmq-discuss] suggestions for improving spring-amqp
In-Reply-To: <3F055192-FF17-4CF7-BB22-0FBF9A97430F@jbrisbin.com>
References: <3F055192-FF17-4CF7-BB22-0FBF9A97430F@jbrisbin.com>
Message-ID: <AANLkTi=6Vs9pRdGsA9ZkQVAQkNrRd0S0j-iBDe07eq1P@mail.gmail.com>

Mark,

Any thoughts on Jon's qn below?

alexis

On Fri, Sep 3, 2010 at 12:51 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> There's a couple things I'd like to suggest improvements for in spring-amqp
> and wanted to know if I should just create issues on the Jira or send
> patches or some combination of both?
>
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From markfisher at vmware.com  Fri Sep  3 15:19:20 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Fri, 3 Sep 2010 07:19:20 -0700
Subject: [rabbitmq-discuss] suggestions for improving spring-amqp
In-Reply-To: <AANLkTi=6Vs9pRdGsA9ZkQVAQkNrRd0S0j-iBDe07eq1P@mail.gmail.com>
References: <3F055192-FF17-4CF7-BB22-0FBF9A97430F@jbrisbin.com>,
	<AANLkTi=6Vs9pRdGsA9ZkQVAQkNrRd0S0j-iBDe07eq1P@mail.gmail.com>
Message-ID: <392922E81643B245A905B42E3E34C24014D3516CE1@EXCH-MBX-1.vmware.com>

Jon, we have a forum dedicated to Spring AMQP: http://forum.springsource.org/forumdisplay.php?f=74

That's a great place to discuss ideas and then create JIRA issues based on those discussions (and we can link to forum posts via JIRA).

So, please do visit the forum. Looking forward to your feedback!

Regards,
Mark
________________________________________
From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
Sent: Friday, September 03, 2010 10:18 AM
To: Jon Brisbin
Cc: RabbitMQ; Mark Fisher
Subject: Re: [rabbitmq-discuss] suggestions for improving spring-amqp

Mark,

Any thoughts on Jon's qn below?

alexis

On Fri, Sep 3, 2010 at 12:51 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> There's a couple things I'd like to suggest improvements for in spring-amqp
> and wanted to know if I should just create issues on the Jira or send
> patches or some combination of both?
>
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From agscala at gmail.com  Fri Sep  3 17:00:35 2010
From: agscala at gmail.com (Andrew Scala)
Date: Fri, 3 Sep 2010 12:00:35 -0400
Subject: [rabbitmq-discuss] "Already running" crash dump
Message-ID: <AANLkTikEfZe9tDc0ptuYM2yPt6ycPgdUqFVMmSiLtQq9@mail.gmail.com>

I'm running 32bit Ubuntu 9.10 and installed the 'rabbitmq-server' package
from the ubuntu repositories.  I suppose when it installed it started the
daemon automatically.  I tried to run the command `sudo rabbitmq-server
start` from the terminal and was greeted with:

[ andrew at andrew-scala:~ ]$ sudo rabbitmq-server stop
{error_logger,{{2010,9,2},{13,55,20}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,9,2},{13,55,20}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.97>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,517}],[]]}
{error_logger,{{2010,9,2},{13,55,20}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,9,2},{13,55,20}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,9,2},{13,55,20}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

After doing some digging I found out that this is because rabbitmq-server
was running already, though I feel like this is something that should be
handled more appropriately, like letting the user know in a friendly way
something along the lines of "rabbitmq-server is already running!" rather
than giving me a cryptic erlang error message.

-- Andrew Scala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100903/badce15e/attachment.htm>

From derek.p.moore at gmail.com  Sat Sep  4 02:11:09 2010
From: derek.p.moore at gmail.com (derek.p.moore at gmail.com)
Date: Sat, 04 Sep 2010 01:11:09 +0000
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozi
In-Reply-To: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>
Message-ID: <90e6ba3fd45df18517048f64b832@google.com>

Hi, Alexis,

I have been using the script at work to white-box test Python click  
processing servers (over @ my gracious employer Adknowledge). We use  
RabbitMQ to separate & stage events between the incoming  
(request/response), staging (persistence/replay), & handling  
(validation/processing/storage) steps of various event handling processes.

I have used JavaScript to do useful things with jars in telecom before (CTI  
& IVR)... And it suits itself quite well to application OLTP systems it  
seems... But in my haste & pride to post the script I left a few functions  
dangling, so here it is again for those interested:

http://github.com/derekm/rabbitutil

I slipped in the new RabbitMQ Java jars only to find they're 0-9-1-only. It  
would be nice if the new libs were dual-mode, since 2.0 upgrades will be  
phased in slowly by most organizations using these technologies.

I've expected similar queueing & messaging behaviors from systems like  
Alcatel/Lucent's Genesys platform and barely received it... Having only  
recently been introduced to these technologies, I have to say I like  
RabbitMQ & Qpid over that other stuff any day! I'm not sure yet if AMQP is  
the wire protocol to solve all wire protocols, but it's a step on the way  
there. (I used to prefer the wire protocol: "<<" followed by two characters  
of choice "CC" followed by 4-byte encoded 64-bit length of string followed  
by preferred interchange format. But with RabbitMQ I hope I never write  
another wire protocol again.)

I use my rabbitutil script's inject_msg, inject_msgs, & remove_msg daily,  
but I did setup my environment using its other commands. I like Rabbit's  
Java API over other ampq libs of various languages. The ease of working  
with it is illustrated by this script, I think. I haven't thought of much  
else to add to this basic set of commands, except to improve the commands  
themselves (arguments & options, etc.). But if people have ideas I'd be  
happy to work with them.

I'd do what I can help see functionality like this distributed with some  
component of RabbitMQ. rabbitmqctl is very useful. Would this kind of  
functionality have to be integrated into that command to ship?

Thanks!

Derek


On Sep 2, 2010 6:17am, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Derek,

> How are you getting on with this? Has it proved useful or have you found  
> that you need more functionality than you expected?


> alexis







> On Thu, Aug 19, 2010 at 4:46 AM, Derek Moore derek.p.moore at gmail.com>  
> wrote:

> I wrote this today at work. Others may find it useful also.

> I wanted what rabbitmqctl seemed to lack, so I wrote this up quick &  
> dirty. It is very simple, no validation, but functional. I also needed  
> something to inject messages for testing purposes.




> I run the JavaScript from a shell script called "rabbitutil":
> --
> #!/bin/bash
> java -cp js.jar:commons-io-1.2.jar:rabbitmq-client.jar \
> org.mozilla.javascript.tools.shell.Main rabbitutil.js $@



> --
> and/or jrunscript (which I haven't really tested):
> jrunscript -cp commons-io-1.2.jar:rabbitmq-client.jar rabbitutil.js


> Source attached as "rabbitutil.txt", since .js is commonly filtered.




> Cheers,


> <> div>Derek P. Moore


> _______________________________________________

> rabbitmq-discuss mailing list

> rabbitmq-discuss at lists.rabbitmq.com

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100904/7d48c1a1/attachment.htm>

From derek.p.moore at gmail.com  Sat Sep  4 02:17:08 2010
From: derek.p.moore at gmail.com (derek.p.moore at gmail.com)
Date: Sat, 04 Sep 2010 01:17:08 +0000
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java &
In-Reply-To: <90e6ba3fd45df18517048f64b832@google.com>
Message-ID: <90e6ba53aa4a5759a8048f64cedb@google.com>

> followed by 4-byte encoded 64-bit length of string

Er, you know what I meant!

After all, I'm not sure whether I meant 4B/32b or 8B/64b!

Derek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100904/b6542bc1/attachment.htm>

From jasonjwwilliams at gmail.com  Sun Sep  5 20:55:46 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 5 Sep 2010 13:55:46 -0600
Subject: [rabbitmq-discuss] Config File Options
Message-ID: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>

Hi Guys,

Is there a comprehensive listing of the configuration settings for
rabbitmq.config?

-J

From shane at digitalsanctum.com  Sun Sep  5 21:48:09 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Sun, 5 Sep 2010 16:48:09 -0400
Subject: [rabbitmq-discuss] new blog post: Using RabbitMQ,
	Spring AMQP and Spring Integration
Message-ID: <AANLkTimRuLr-n+eZVFKOoBQEGb8YTqKtUQDpm7Bdx_Hy@mail.gmail.com>

For those interested in using RabbitMQ with Java and/or Spring:
http://bit.ly/9MnJl1

-- 
-Shane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100905/f722162a/attachment.htm>

From tonyg at rabbitmq.com  Sun Sep  5 23:43:55 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Sun, 05 Sep 2010 18:43:55 -0400
Subject: [rabbitmq-discuss] STOMP needs updating for latest API changes
Message-ID: <4C841D2B.1090505@rabbitmq.com>

Hi,

To get the STOMP plugin to work against trunk rabbitmq-server, the following
patch (or similar) is required. Could a committer please apply it to the
rabbitmq-stomp project? Thanks!

Regards,
  Tony
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: stomp.patch
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100905/7ed2aa72/attachment.asc>

From jasonjwwilliams at gmail.com  Sun Sep  5 23:48:37 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 5 Sep 2010 16:48:37 -0600
Subject: [rabbitmq-discuss] Permissions
Message-ID: <AANLkTik1Q2PT9JF18hMKFrU7rJ5NQd129HruxAHqnvVQ@mail.gmail.com>

What version of RabbitMQ first implemented set_permissions as we know
it today for setting ACLs? (not the old set_permissions that was used
for realms).

-J

From michaelburns1 at gmail.com  Mon Sep  6 09:28:41 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Mon, 6 Sep 2010 09:28:41 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <20100903120234.GD2873@dakota.eng.vmware.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
Message-ID: <AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>

>
> When the slowdown occurs, does rabbit pick up speed a bit later?  Or do
> you have to restart it or something else of the sort?
>

Yes it will pick up speed after a bit without a server restart.


>
> When it occurs, does list_queues show a large number of messages?  If
> so, you're probably not ack'ing the messages after consuming them.
>

No. At the moment we're putting a very small number of messages through the
system. When the delay occurs I'm usually seeing one or two messages on the
queue. Eventually the messages will come through.
Is there anything we could whilst the message is on the queue that would
give more information as to why it is not being delivered?




>
> On an unrelated note, 2.0.0 is out, so you might want to upgrade.
>

Cool I'll try upgrading and see if that helps.

Cheers,
Michael


>
> Cheers,
> Alex
>
> On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
> > Hi Alex,
> > I ran the multicast client and am getting speeds like:
> >
> > sending rate: 3550 msg/s, basic returns: 0 ret/s
> > recving rate: 3461 msg/s, min/avg/max latency: 11931197/12253891/12477030
> > microseconds
> >
> > If I let it run for a bit then sometimes both the sending and receiving
> rate
> > drop significantly e.g.:
> >
> > sending rate: 638 msg/s, basic returns: 0 ret/s
> > recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
> > microseconds
> >
> > Not sure if this drop is indicative of anything?
> >
> > We're using the java client 1.8.1, the broker is rabbitmq_server-1.8.1
> >
> > Thanks
> > Michael
> >
> > On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
> > <alexandru at rabbitmq.com>wrote:
> >
> > > Hi Michael,
> > >
> > > > We are putting a very low volume of messages through and have
> sometimes
> > > had
> > > > to wait up to 15 minutes for a single message to be delivered (at the
> > > time
> > > > this was the only message in the system).
> > >
> > > That sounds strage.  Are you up for a bit of debugging?
> > >
> > > Download the java client,
> > >  http://www.rabbitmq.com/java-client.html
> > >
> > > Unpack it, and run
> > >  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
> > >
> > > That command will run one of our example programmes in a way that
> > > matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
> > >
> > > When I run it, I get speeds like:
> > >  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637
> > > microseconds
> > >  sending rate: 6419 msg/s, basic returns: 0 ret/s
> > >
> > > If you're getting similar speeds, there's probably something wrong with
> > > the consumers/producers.  If not, it might be something to do with the
> > > server.
> > >
> > > Could you please try it?
> > >
> > > Also, which version the broker and which client are you using?
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> > > > Hi,
> > > >
> > > > We're just starting out with RabbitMQ and have a very simple setup:
> one
> > > > queue, one producer doing a basicPublish and one consumer doing a
> > > > basicConsume using QueueingConsumer.
> > > >
> > > > For the most part it works fine however at fairly regular intervals
> we
> > > are
> > > > finding that messages remain on the queue for a considerable period
> > > before
> > > > being delivered to the consumer.
> > > >
> > > > We are putting a very low volume of messages through and have
> sometimes
> > > had
> > > > to wait up to 15 minutes for a single message to be delivered (at the
> > > time
> > > > this was the only message in the system).
> > > >
> > > > In all cases the messages are eventually delivered.
> > > >
> > > > I dont know where to start debugging this as there is nothing in the
> > > > RabbitMQ logs thats suggests something is going wrong - could anyone
> > > point
> > > > me in the right direction as to what may be causing this?
> > > >
> > > > Many Thanks,
> > > > Michael
> > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100906/0b81f95e/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep  6 09:53:13 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 6 Sep 2010 09:53:13 +0100
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
Message-ID: <20100906085313.GA2625@dakota.eng.vmware.com>

Hi,

Not really.  Most are undocumented because you don't normally need to
change them.

The ones you might be interested in (for the core broker) are
tcp_listeners, ssl_listeners and ssl_options (described in the SSL guide),
and cluster_nodes (described in the clustering guide).

There are others; do a
% grep 'application:get_env' src/*
in the source distribution if you're curious.

Also, some of the plugins define are configurable thorough
rabbitmq.config.  Look though their documentation if you want to see
how.

Cheers,
Alex

On Sun, Sep 05, 2010 at 01:55:46PM -0600, Jason J. W. Williams wrote:
> Hi Guys,
> 
> Is there a comprehensive listing of the configuration settings for
> rabbitmq.config?
> 
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Sep  6 10:35:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 6 Sep 2010 10:35:55 +0100
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <20100906085313.GA2625@dakota.eng.vmware.com>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
	<20100906085313.GA2625@dakota.eng.vmware.com>
Message-ID: <20100906093555.GA12146@rabbitmq.com>

On Mon, Sep 06, 2010 at 09:53:13AM +0100, Alexandru Scvor?ov wrote:
> There are others; do a
> % grep 'application:get_env' src/*
> in the source distribution if you're curious.

Actually, slightly better than this is the env element in the rabbit.app
file. The entries here correspond to items within the rabbit
environment. Thus eg

[...  {env, [{tcp_listeners, [{"0.0.0.0", 5672}]}, ...]} ]

would have a config file equivalent of

[{rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}, ...]}].

Matthew

From mikeb at rabbitmq.com  Mon Sep  6 12:00:52 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 06 Sep 2010 12:00:52 +0100
Subject: [rabbitmq-discuss] Permissions
In-Reply-To: <AANLkTik1Q2PT9JF18hMKFrU7rJ5NQd129HruxAHqnvVQ@mail.gmail.com>
References: <AANLkTik1Q2PT9JF18hMKFrU7rJ5NQd129HruxAHqnvVQ@mail.gmail.com>
Message-ID: <4C84C9E4.9060005@rabbitmq.com>

> What version of RabbitMQ first implemented set_permissions as we know
> it today for setting ACLs? (not the old set_permissions that was used
> for realms).

 From the RabbitMQ 1.6.0 (June 2009) release notes:
"- introduce a permissions system which allows fine-grained access
   control on resources involved in AMQP operations. See
   http://www.rabbitmq.com/admin-guide.html#access-control for details"


--Michael

From tom at devart.org  Mon Sep  6 14:03:44 2010
From: tom at devart.org (Tom Martin)
Date: Mon, 6 Sep 2010 14:03:44 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
Message-ID: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>

Hi,

I'm building a system which takes incoming messages, filters them and stores
them to DB. I have each of these three bits running as separate ruby
processes, if the filter or database saving processes die then when they
come back, new messages are waiting in the queue.

I've implemented this using two separate queues: an incoming queue and
a filtered queue. The filtering process just takes the incoming queue, does
it's business and inserts it into the filtered queue. The DB storing process
takes the filtered queue and stores them to DB.

I'm very new to RabbitMQ, is this kind of flow correct, creating two
different queues? or is there a better way to do it using Exchanges or some
other part of RabbitMQ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100906/ca492a44/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep  6 14:38:17 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 6 Sep 2010 14:38:17 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
In-Reply-To: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
References: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
Message-ID: <20100906133755.GD2625@dakota.eng.vmware.com>

Hi,

There's nothing inherently wrong with what you describe.

Depending on what you filter on, you could make it simpler.  If you
filter on a message name/id or something like that, you could probably
just bind the filtered queue to a direct exchange (match on the routing
key) or a topic exchange (match on something like a regexp).

If you're filtering rules are more complicated or if they involve
inspecting the message content, what you're doing is probably the way
to go.  You could also write a custom exchange type as a plugin.

Cheers,
Alex

On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
> Hi,
> 
> I'm building a system which takes incoming messages, filters them and stores
> them to DB. I have each of these three bits running as separate ruby
> processes, if the filter or database saving processes die then when they
> come back, new messages are waiting in the queue.
> 
> I've implemented this using two separate queues: an incoming queue and
> a filtered queue. The filtering process just takes the incoming queue, does
> it's business and inserts it into the filtered queue. The DB storing process
> takes the filtered queue and stores them to DB.
> 
> I'm very new to RabbitMQ, is this kind of flow correct, creating two
> different queues? or is there a better way to do it using Exchanges or some
> other part of RabbitMQ?

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vlad at rabbitmq.com  Mon Sep  6 14:41:38 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Mon, 06 Sep 2010 14:41:38 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
In-Reply-To: <20100906133755.GD2625@dakota.eng.vmware.com>
References: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
	<20100906133755.GD2625@dakota.eng.vmware.com>
Message-ID: <4C84EF92.6030708@rabbitmq.com>


Apart from the mentioned 'direct' and 'topic' exchange types, there is 
also the 'headers' exchange (match on a number of attributes that you 
specify).

Rgds,
Vlad.


On 09/06/2010 02:38 PM, Alexandru Scvor?ov wrote:
> Hi,
>
> There's nothing inherently wrong with what you describe.
>
> Depending on what you filter on, you could make it simpler.  If you
> filter on a message name/id or something like that, you could probably
> just bind the filtered queue to a direct exchange (match on the routing
> key) or a topic exchange (match on something like a regexp).
>
> If you're filtering rules are more complicated or if they involve
> inspecting the message content, what you're doing is probably the way
> to go.  You could also write a custom exchange type as a plugin.
>
> Cheers,
> Alex
>
> On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
>    
>> Hi,
>>
>> I'm building a system which takes incoming messages, filters them and stores
>> them to DB. I have each of these three bits running as separate ruby
>> processes, if the filter or database saving processes die then when they
>> come back, new messages are waiting in the queue.
>>
>> I've implemented this using two separate queues: an incoming queue and
>> a filtered queue. The filtering process just takes the incoming queue, does
>> it's business and inserts it into the filtered queue. The DB storing process
>> takes the filtered queue and stores them to DB.
>>
>> I'm very new to RabbitMQ, is this kind of flow correct, creating two
>> different queues? or is there a better way to do it using Exchanges or some
>> other part of RabbitMQ?
>>      
>    
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>      
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From tom at devart.org  Mon Sep  6 19:06:45 2010
From: tom at devart.org (Tom Martin)
Date: Mon, 6 Sep 2010 19:06:45 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
In-Reply-To: <4C84EF92.6030708@rabbitmq.com>
References: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
	<20100906133755.GD2625@dakota.eng.vmware.com>
	<4C84EF92.6030708@rabbitmq.com>
Message-ID: <AANLkTiknA-Xps4tW5vgV4b0shq1LfnQ1n=fD6Q79URG4@mail.gmail.com>

Thanks for your recommendations, I'll take a look at the topic exchange but
if what I've proposed sounds ok then I'll leave it as that.

When I receive a message from a queue does that remove it from the queue or
just mark is as read? Do messages get automatically stored to disk or do I
need to explicitly turn that on?

Thanks again.

On 6 September 2010 14:41, Vlad Alexandru Ionescu <vlad at rabbitmq.com> wrote:

>
> Apart from the mentioned 'direct' and 'topic' exchange types, there is also
> the 'headers' exchange (match on a number of attributes that you specify).
>
> Rgds,
> Vlad.
>
>
>
> On 09/06/2010 02:38 PM, Alexandru Scvor?ov wrote:
>
>> Hi,
>>
>> There's nothing inherently wrong with what you describe.
>>
>> Depending on what you filter on, you could make it simpler.  If you
>> filter on a message name/id or something like that, you could probably
>> just bind the filtered queue to a direct exchange (match on the routing
>> key) or a topic exchange (match on something like a regexp).
>>
>> If you're filtering rules are more complicated or if they involve
>> inspecting the message content, what you're doing is probably the way
>> to go.  You could also write a custom exchange type as a plugin.
>>
>> Cheers,
>> Alex
>>
>> On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
>>
>>
>>> Hi,
>>>
>>> I'm building a system which takes incoming messages, filters them and
>>> stores
>>> them to DB. I have each of these three bits running as separate ruby
>>> processes, if the filter or database saving processes die then when they
>>> come back, new messages are waiting in the queue.
>>>
>>> I've implemented this using two separate queues: an incoming queue and
>>> a filtered queue. The filtering process just takes the incoming queue,
>>> does
>>> it's business and inserts it into the filtered queue. The DB storing
>>> process
>>> takes the filtered queue and stores them to DB.
>>>
>>> I'm very new to RabbitMQ, is this kind of flow correct, creating two
>>> different queues? or is there a better way to do it using Exchanges or
>>> some
>>> other part of RabbitMQ?
>>>
>>>
>>
>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>


-- 
Tom Martin
devart.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100906/a587bde8/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep  6 20:01:26 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 6 Sep 2010 20:01:26 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
In-Reply-To: <AANLkTiknA-Xps4tW5vgV4b0shq1LfnQ1n=fD6Q79URG4@mail.gmail.com>
References: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
	<20100906133755.GD2625@dakota.eng.vmware.com>
	<4C84EF92.6030708@rabbitmq.com>
	<AANLkTiknA-Xps4tW5vgV4b0shq1LfnQ1n=fD6Q79URG4@mail.gmail.com>
Message-ID: <20100906190126.GC2329@dakota>

> When I receive a message from a queue does that remove it from the queue or
> just mark is as read?

It depends.  When you basic.get or basic.consume a message from the
queue, you have to say whether you do it in no-ack mode or not.  If
you enable no-ack, ``there no need to acknowledge the messages'', so
consuming it also dequeues it.  If you set no-ack to false, consuming
the message just marks it as delivered; it's not dequeued until you
explicitly basic.ack it; if the consumers dies before ack'ing, the
message is re-inserted into the queue.

> Do messages get automatically stored to disk or do I
> need to explicitly turn that on?

It depends on what you mean by ``stored to disk''.

As of 2.0.0, all messages may be persisted to disk.  That means that any
message may get written to disk (RabbitMQ tends to do this if it's
running low on memory).

Completely orthogonal to this, messages may be transient or persistent.
No guarantees are made about transient messages.  Persistent messages
that end up on durable queues are supposed to survive a broker restart;
this means that they tend to get written to disk fairly quickly and
are recovered on startup.  You choose whether a queue is durable or not
when you declare it.  You choose whether a message is persistent or not
when you publish it.

Still, you can lose persistent messages (if the broker dies before it
has had a chance to sync the disk buffers).  Currently, the only way to
ensure that messages are never lost is to set the channel to
transactional mode (tx.select) and do a commit after every message.  If
the commit succeeds, the message has been published successfully.

Hope this clears things up.

Cheers,
Alex

On Mon, Sep 06, 2010 at 07:06:45PM +0100, Tom Martin wrote:
> Thanks for your recommendations, I'll take a look at the topic exchange but
> if what I've proposed sounds ok then I'll leave it as that.
> 
> When I receive a message from a queue does that remove it from the queue or
> just mark is as read? Do messages get automatically stored to disk or do I
> need to explicitly turn that on?
> 
> Thanks again.
> 
> On 6 September 2010 14:41, Vlad Alexandru Ionescu <vlad at rabbitmq.com> wrote:
> 
> >
> > Apart from the mentioned 'direct' and 'topic' exchange types, there is also
> > the 'headers' exchange (match on a number of attributes that you specify).
> >
> > Rgds,
> > Vlad.
> >
> >
> >
> > On 09/06/2010 02:38 PM, Alexandru Scvor?ov wrote:
> >
> >> Hi,
> >>
> >> There's nothing inherently wrong with what you describe.
> >>
> >> Depending on what you filter on, you could make it simpler.  If you
> >> filter on a message name/id or something like that, you could probably
> >> just bind the filtered queue to a direct exchange (match on the routing
> >> key) or a topic exchange (match on something like a regexp).
> >>
> >> If you're filtering rules are more complicated or if they involve
> >> inspecting the message content, what you're doing is probably the way
> >> to go.  You could also write a custom exchange type as a plugin.
> >>
> >> Cheers,
> >> Alex
> >>
> >> On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
> >>
> >>
> >>> Hi,
> >>>
> >>> I'm building a system which takes incoming messages, filters them and
> >>> stores
> >>> them to DB. I have each of these three bits running as separate ruby
> >>> processes, if the filter or database saving processes die then when they
> >>> come back, new messages are waiting in the queue.
> >>>
> >>> I've implemented this using two separate queues: an incoming queue and
> >>> a filtered queue. The filtering process just takes the incoming queue,
> >>> does
> >>> it's business and inserts it into the filtered queue. The DB storing
> >>> process
> >>> takes the filtered queue and stores them to DB.
> >>>
> >>> I'm very new to RabbitMQ, is this kind of flow correct, creating two
> >>> different queues? or is there a better way to do it using Exchanges or
> >>> some
> >>> other part of RabbitMQ?
> >>>
> >>>
> >>
> >>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >
> 
> 
> -- 
> Tom Martin
> devart.org

From alexandru at rabbitmq.com  Mon Sep  6 20:18:23 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Mon, 6 Sep 2010 20:18:23 +0100
Subject: [rabbitmq-discuss] Am I using Queues Correctly?
In-Reply-To: <20100906190126.GC2329@dakota>
References: <AANLkTimseNoET94+5GAGUn_MyMw8Gungm2_J0RNyKugK@mail.gmail.com>
	<20100906133755.GD2625@dakota.eng.vmware.com>
	<4C84EF92.6030708@rabbitmq.com>
	<AANLkTiknA-Xps4tW5vgV4b0shq1LfnQ1n=fD6Q79URG4@mail.gmail.com>
	<20100906190126.GC2329@dakota>
Message-ID: <20100906191823.GD2329@dakota>

To clarify a point, when a message is consumed with no-ack disabled, it
is taken off the queue (in the sense that no other consumer will receive
it), but if the consumer dies without ack'ing it, the message will get
re-inserted into the queue and will be delivered to another consumer.

On Mon, Sep 06, 2010 at 08:01:26PM +0100, Alexandru Scvor?ov wrote:
> > When I receive a message from a queue does that remove it from the queue or
> > just mark is as read?
> 
> It depends.  When you basic.get or basic.consume a message from the
> queue, you have to say whether you do it in no-ack mode or not.  If
> you enable no-ack, ``there no need to acknowledge the messages'', so
> consuming it also dequeues it.  If you set no-ack to false, consuming
> the message just marks it as delivered; it's not dequeued until you
> explicitly basic.ack it; if the consumers dies before ack'ing, the
> message is re-inserted into the queue.
> 
> > Do messages get automatically stored to disk or do I
> > need to explicitly turn that on?
> 
> It depends on what you mean by ``stored to disk''.
> 
> As of 2.0.0, all messages may be persisted to disk.  That means that any
> message may get written to disk (RabbitMQ tends to do this if it's
> running low on memory).
> 
> Completely orthogonal to this, messages may be transient or persistent.
> No guarantees are made about transient messages.  Persistent messages
> that end up on durable queues are supposed to survive a broker restart;
> this means that they tend to get written to disk fairly quickly and
> are recovered on startup.  You choose whether a queue is durable or not
> when you declare it.  You choose whether a message is persistent or not
> when you publish it.
> 
> Still, you can lose persistent messages (if the broker dies before it
> has had a chance to sync the disk buffers).  Currently, the only way to
> ensure that messages are never lost is to set the channel to
> transactional mode (tx.select) and do a commit after every message.  If
> the commit succeeds, the message has been published successfully.
> 
> Hope this clears things up.
> 
> Cheers,
> Alex
> 
> On Mon, Sep 06, 2010 at 07:06:45PM +0100, Tom Martin wrote:
> > Thanks for your recommendations, I'll take a look at the topic exchange but
> > if what I've proposed sounds ok then I'll leave it as that.
> > 
> > When I receive a message from a queue does that remove it from the queue or
> > just mark is as read? Do messages get automatically stored to disk or do I
> > need to explicitly turn that on?
> > 
> > Thanks again.
> > 
> > On 6 September 2010 14:41, Vlad Alexandru Ionescu <vlad at rabbitmq.com> wrote:
> > 
> > >
> > > Apart from the mentioned 'direct' and 'topic' exchange types, there is also
> > > the 'headers' exchange (match on a number of attributes that you specify).
> > >
> > > Rgds,
> > > Vlad.
> > >
> > >
> > >
> > > On 09/06/2010 02:38 PM, Alexandru Scvor?ov wrote:
> > >
> > >> Hi,
> > >>
> > >> There's nothing inherently wrong with what you describe.
> > >>
> > >> Depending on what you filter on, you could make it simpler.  If you
> > >> filter on a message name/id or something like that, you could probably
> > >> just bind the filtered queue to a direct exchange (match on the routing
> > >> key) or a topic exchange (match on something like a regexp).
> > >>
> > >> If you're filtering rules are more complicated or if they involve
> > >> inspecting the message content, what you're doing is probably the way
> > >> to go.  You could also write a custom exchange type as a plugin.
> > >>
> > >> Cheers,
> > >> Alex
> > >>
> > >> On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
> > >>
> > >>
> > >>> Hi,
> > >>>
> > >>> I'm building a system which takes incoming messages, filters them and
> > >>> stores
> > >>> them to DB. I have each of these three bits running as separate ruby
> > >>> processes, if the filter or database saving processes die then when they
> > >>> come back, new messages are waiting in the queue.
> > >>>
> > >>> I've implemented this using two separate queues: an incoming queue and
> > >>> a filtered queue. The filtering process just takes the incoming queue,
> > >>> does
> > >>> it's business and inserts it into the filtered queue. The DB storing
> > >>> process
> > >>> takes the filtered queue and stores them to DB.
> > >>>
> > >>> I'm very new to RabbitMQ, is this kind of flow correct, creating two
> > >>> different queues? or is there a better way to do it using Exchanges or
> > >>> some
> > >>> other part of RabbitMQ?
> > >>>
> > >>>
> > >>
> > >>
> > >>> _______________________________________________
> > >>> rabbitmq-discuss mailing list
> > >>> rabbitmq-discuss at lists.rabbitmq.com
> > >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >>>
> > >>>
> > >> _______________________________________________
> > >> rabbitmq-discuss mailing list
> > >> rabbitmq-discuss at lists.rabbitmq.com
> > >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >>
> > >>
> > >
> > 
> > 
> > -- 
> > Tom Martin
> > devart.org
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Mon Sep  6 20:51:04 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 6 Sep 2010 13:51:04 -0600
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <20100906093555.GA12146@rabbitmq.com>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
	<20100906085313.GA2625@dakota.eng.vmware.com>
	<20100906093555.GA12146@rabbitmq.com>
Message-ID: <AANLkTi=UA3qvammo+qMNqv_HqR4EQym0RgAsN7atPqz2@mail.gmail.com>

Thank you Matthew. That's very helpful. Are persister_max_wrap_entries
and persister_hibernate_after anything you'd want to tune for your
workload in the new persister?

-J

Also, do you guys see any other Mnesia options besides
dump_log_write_threshold that usually need to be tuned for Rabbit?

On Mon, Sep 6, 2010 at 3:35 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Sep 06, 2010 at 09:53:13AM +0100, Alexandru Scvor?ov wrote:
>> There are others; do a
>> % grep 'application:get_env' src/*
>> in the source distribution if you're curious.
>
> Actually, slightly better than this is the env element in the rabbit.app
> file. The entries here correspond to items within the rabbit
> environment. Thus eg
>
> [... ?{env, [{tcp_listeners, [{"0.0.0.0", 5672}]}, ...]} ]
>
> would have a config file equivalent of
>
> [{rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}, ...]}].
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Mon Sep  6 21:05:51 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 6 Sep 2010 21:05:51 +0100
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozi
In-Reply-To: <90e6ba3fd45df18517048f64b832@google.com>
References: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>
	<90e6ba3fd45df18517048f64b832@google.com>
Message-ID: <AANLkTinKxe+MaD2WNQ0TWWxRCBw9ApCEpKEihOFoqkUf@mail.gmail.com>

Derek

Thanks for this comprehensive summary.  It's good to hear that Adk are
still using RabbitMQ :-)

In terms of protocol support in the Java client: noted.  Also noted
are your comments about shipping this.  We can certainly link to it
from the Getting Started page - would that be a good start?  A reason
for my hesitation is that management is undergoing a General Rethink
(http://downagain.com/blog/2010/09/06/wherein-our-hero-isnt-happy-with-work/).
 The person who is leading this effort is Simon, cc'd.

Simon - any thoughts?

alexis




On Sat, Sep 4, 2010 at 2:11 AM,  <derek.p.moore at gmail.com> wrote:
> Hi, Alexis,
>
> I have been using the script at work to white-box test Python click
> processing servers (over @ my gracious employer Adknowledge). We use
> RabbitMQ to separate & stage events between the incoming (request/response),
> staging (persistence/replay), & handling (validation/processing/storage)
> steps of various event handling processes.
>
> I have used JavaScript to do useful things with jars in telecom before (CTI
> & IVR)... And it suits itself quite well to application OLTP systems it
> seems... But in my haste & pride to post the script I left a few functions
> dangling, so here it is again for those interested:
>
> http://github.com/derekm/rabbitutil
>
> I slipped in the new RabbitMQ Java jars only to find they're 0-9-1-only. It
> would be nice if the new libs were dual-mode, since 2.0 upgrades will be
> phased in slowly by most organizations using these technologies.
>
> I've expected similar queueing & messaging behaviors from systems like
> Alcatel/Lucent's Genesys platform and barely received it... Having only
> recently been introduced to these technologies, I have to say I like
> RabbitMQ & Qpid over that other stuff any day! I'm not sure yet if AMQP is
> the wire protocol to solve all wire protocols, but it's a step on the way
> there. (I used to prefer the wire protocol: "<<" followed by two characters
> of choice "CC" followed by 4-byte encoded 64-bit length of string followed
> by preferred interchange format. But with RabbitMQ I hope I never write
> another wire protocol again.)
>
> I use my rabbitutil script's inject_msg, inject_msgs, & remove_msg daily,
> but I did setup my environment using its other commands. I like Rabbit's
> Java API over other ampq libs of various languages. The ease of working with
> it is illustrated by this script, I think. I haven't thought of much else to
> add to this basic set of commands, except to improve the commands themselves
> (arguments & options, etc.). But if people have ideas I'd be happy to work
> with them.
>
> I'd do what I can help see functionality like this distributed with some
> component of RabbitMQ. rabbitmqctl is very useful. Would this kind of
> functionality have to be integrated into that command to ship?
>
> Thanks!
>
> Derek
>
>
> On Sep 2, 2010 6:17am, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Derek,
>>
>> How are you getting on with this? ?Has it proved useful or have you found
>> that you need more functionality than you expected?
>>
>>
>> alexis
>>
>>
>>
>>
>>
>>
>>
>> On Thu, Aug 19, 2010 at 4:46 AM, Derek Moore derek.p.moore at gmail.com>
>> wrote:
>>
>> I wrote this today at work. ?Others may find it useful also.
>>
>> I wanted what rabbitmqctl seemed to lack, so I wrote this up quick &
>> dirty. ?It is very simple, no validation, but functional. ?I also needed
>> something to inject messages for testing purposes.
>>
>>
>>
>>
>> I run the JavaScript from a shell script called "rabbitutil":
>> --
>> #!/bin/bash
>> java -cp js.jar:commons-io-1.2.jar:rabbitmq-client.jar \
>> org.mozilla.javascript.tools.shell.Main rabbitutil.js $@
>>
>>
>>
>> --
>> and/or jrunscript (which I haven't really tested):
>> jrunscript -cp commons-io-1.2.jar:rabbitmq-client.jar rabbitutil.js
>>
>>
>> Source attached as "rabbitutil.txt", since .js is commonly filtered.
>>
>>
>>
>>
>> Cheers,
>>
>>
>> <> div>Derek P. Moore
>>
>>
>> _______________________________________________
>>
>> rabbitmq-discuss mailing list
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>
>>
>>

From matthew at rabbitmq.com  Mon Sep  6 21:17:09 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 6 Sep 2010 21:17:09 +0100
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <AANLkTi=UA3qvammo+qMNqv_HqR4EQym0RgAsN7atPqz2@mail.gmail.com>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
	<20100906085313.GA2625@dakota.eng.vmware.com>
	<20100906093555.GA12146@rabbitmq.com>
	<AANLkTi=UA3qvammo+qMNqv_HqR4EQym0RgAsN7atPqz2@mail.gmail.com>
Message-ID: <20100906201709.GA8521@wellquite.org>

On Mon, Sep 06, 2010 at 01:51:04PM -0600, Jason J. W. Williams wrote:
> Thank you Matthew. That's very helpful. Are persister_max_wrap_entries
> and persister_hibernate_after anything you'd want to tune for your
> workload in the new persister?

No, they're only for the old persister, not the new. The two that are
relevant for the new persister are:

msg_store_file_size_limit - this is the file size limit of the
msg_store. The default is 16MB. Larger values will allow you to drive
the disk faster, but GC will take longer.

queue_index_max_journal_entries - this is the number of entries in queue
journals before they get flushed out. Again, larger numbers will make
better use of disk bandwidth at the expense of a larger interruption
when journal scattering takes place.

In both cases, if you're doing lots of short transactions, smaller
numbers may help. The msg_store_file_size_limit is best tuned to the
size of your messages, whilst queue_index_max_journal_entries is best
tuned to the nature of your publications, regardless of size.

If I sound vague, it's because we're yet to do any investigation into
what workloads benefit best from what settings. Feel free to report your
findings. Also, SSDs make a good improvement, especially when Rabbit is
heavily loaded and doing transactions, or is very short of file
descriptors.

> Also, do you guys see any other Mnesia options besides
> dump_log_write_threshold that usually need to be tuned for Rabbit?

Rabbit only uses mnesia for exchange/binding/queue meta information. Not
for messages. Thus unless you have a very high churn rate of those
resources, you shouldn't need to tune it at all.

Matthew

From jasonjwwilliams at gmail.com  Mon Sep  6 21:24:50 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 6 Sep 2010 14:24:50 -0600
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <20100906201709.GA8521@wellquite.org>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
	<20100906085313.GA2625@dakota.eng.vmware.com>
	<20100906093555.GA12146@rabbitmq.com>
	<AANLkTi=UA3qvammo+qMNqv_HqR4EQym0RgAsN7atPqz2@mail.gmail.com>
	<20100906201709.GA8521@wellquite.org>
Message-ID: <AANLkTinMn2X6NHyhAFDyVSpPOvjCmC7zern3h63gK4Lr@mail.gmail.com>

Hi Matthew,

That helps a lot. Is msg_store_file_size_limit the maximum size of the
persistent store or the max size of the journal?

-J

On Mon, Sep 6, 2010 at 2:17 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Sep 06, 2010 at 01:51:04PM -0600, Jason J. W. Williams wrote:
>> Thank you Matthew. That's very helpful. Are persister_max_wrap_entries
>> and persister_hibernate_after anything you'd want to tune for your
>> workload in the new persister?
>
> No, they're only for the old persister, not the new. The two that are
> relevant for the new persister are:
>
> msg_store_file_size_limit - this is the file size limit of the
> msg_store. The default is 16MB. Larger values will allow you to drive
> the disk faster, but GC will take longer.
>
> queue_index_max_journal_entries - this is the number of entries in queue
> journals before they get flushed out. Again, larger numbers will make
> better use of disk bandwidth at the expense of a larger interruption
> when journal scattering takes place.
>
> In both cases, if you're doing lots of short transactions, smaller
> numbers may help. The msg_store_file_size_limit is best tuned to the
> size of your messages, whilst queue_index_max_journal_entries is best
> tuned to the nature of your publications, regardless of size.
>
> If I sound vague, it's because we're yet to do any investigation into
> what workloads benefit best from what settings. Feel free to report your
> findings. Also, SSDs make a good improvement, especially when Rabbit is
> heavily loaded and doing transactions, or is very short of file
> descriptors.
>
>> Also, do you guys see any other Mnesia options besides
>> dump_log_write_threshold that usually need to be tuned for Rabbit?
>
> Rabbit only uses mnesia for exchange/binding/queue meta information. Not
> for messages. Thus unless you have a very high churn rate of those
> resources, you shouldn't need to tune it at all.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Mon Sep  6 21:31:06 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 6 Sep 2010 21:31:06 +0100
Subject: [rabbitmq-discuss] Config File Options
In-Reply-To: <AANLkTinMn2X6NHyhAFDyVSpPOvjCmC7zern3h63gK4Lr@mail.gmail.com>
References: <AANLkTinRVSLCj_nahh-4XBmeBYdtG0ZV_Y+WGCap47_T@mail.gmail.com>
	<20100906085313.GA2625@dakota.eng.vmware.com>
	<20100906093555.GA12146@rabbitmq.com>
	<AANLkTi=UA3qvammo+qMNqv_HqR4EQym0RgAsN7atPqz2@mail.gmail.com>
	<20100906201709.GA8521@wellquite.org>
	<AANLkTinMn2X6NHyhAFDyVSpPOvjCmC7zern3h63gK4Lr@mail.gmail.com>
Message-ID: <20100906203106.GB8521@wellquite.org>

On Mon, Sep 06, 2010 at 02:24:50PM -0600, Jason J. W. Williams wrote:
> That helps a lot. Is msg_store_file_size_limit the maximum size of the
> persistent store or the max size of the journal?

Really this needs a proper blog post or some configuration guide to
explain but the following will suffice for the time being.

There is one msg_store per node. It creates files to hold messages from
all the queues. The files it creates are limited in size, and GC occurs
when conditions are met to avoid large amounts of wasted space in those
files when messages are removed. The msg_store_file_size_limit controls
the size of those files.

Each queue needs to (sometimes) record on disk the order and status of
messages in the queue. This is strictly meta information. For various
reasons relating to the ways in which queues are typically used, this
information is first written to a journal (per queue) before being
scattered (effectively, sorted) out to other files (again, all per
queue). The queue_index_max_journal_entries controls the number of
entries in the journal before it gets flushed. There no size control
here, but the maximum size is very low because these are simply meta
datums about each message and its state (has it been published, has it
been delivered, has it been acknowledged).

Matthew

From simon at rabbitmq.com  Tue Sep  7 10:00:57 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 10:00:57 +0100
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozi
In-Reply-To: <AANLkTinKxe+MaD2WNQ0TWWxRCBw9ApCEpKEihOFoqkUf@mail.gmail.com>
References: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>	<90e6ba3fd45df18517048f64b832@google.com>
	<AANLkTinKxe+MaD2WNQ0TWWxRCBw9ApCEpKEihOFoqkUf@mail.gmail.com>
Message-ID: <4C85FF49.7000601@rabbitmq.com>

On 06/09/10 21:05, Alexis Richardson wrote:
> In terms of protocol support in the Java client: noted.  Also noted
> are your comments about shipping this.  We can certainly link to it
> from the Getting Started page - would that be a good start?  A reason
> for my hesitation is that management is undergoing a General Rethink
> (http://downagain.com/blog/2010/09/06/wherein-our-hero-isnt-happy-with-work/).

Umm, are you sure that's the link you intended to post? ;)

>   The person who is leading this effort is Simon, cc'd.
>
> Simon - any thoughts?

I don't think we can ship this script per se. Adding a dependency on 
Javascript (and on Java for sysadmin work) seems a bit heavyweight to me.

However: the management plugin will add support for a lot of this sort 
of thing. At the moment there's no command line client for it, but you 
could write a simple one with bash and curl, or in almost any language. 
A nice command line client is on my TODO list, albeit not near the top. 
Funnily enough I was having an argument yesterday about the value of 
such a thing ;)

Also at the moment the management plugin won't let you publish or get 
messages. That's also on the TODO list in some form.

I'm planning on making a preview release of the management plugin later 
today, at which point things may start to become clearer...

Cheers, Simon

From alexis at rabbitmq.com  Tue Sep  7 11:55:33 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 7 Sep 2010 11:55:33 +0100
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozi
In-Reply-To: <4C85FF49.7000601@rabbitmq.com>
References: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>
	<90e6ba3fd45df18517048f64b832@google.com>
	<AANLkTinKxe+MaD2WNQ0TWWxRCBw9ApCEpKEihOFoqkUf@mail.gmail.com>
	<4C85FF49.7000601@rabbitmq.com>
Message-ID: <AANLkTi=xp+7F9NnaJaxmwXOtDDcOFrN+0LSK9yTgCKLx@mail.gmail.com>

On Tue, Sep 7, 2010 at 10:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 06/09/10 21:05, Alexis Richardson wrote:
>>
>> In terms of protocol support in the Java client: noted. ?Also noted
>> are your comments about shipping this. ?We can certainly link to it
>> from the Getting Started page - would that be a good start? ?A reason
>> for my hesitation is that management is undergoing a General Rethink
>>
>> (http://downagain.com/blog/2010/09/06/wherein-our-hero-isnt-happy-with-work/).
>
> Umm, are you sure that's the link you intended to post? ;)

Ha ha, indeed.

Well I can now post your latest -
http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/




>> ?The person who is leading this effort is Simon, cc'd.
>>
>> Simon - any thoughts?
>
> I don't think we can ship this script per se. Adding a dependency on
> Javascript (and on Java for sysadmin work) seems a bit heavyweight to me.
>
> However: the management plugin will add support for a lot of this sort of
> thing. At the moment there's no command line client for it, but you could
> write a simple one with bash and curl, or in almost any language. A nice
> command line client is on my TODO list, albeit not near the top. Funnily
> enough I was having an argument yesterday about the value of such a thing ;)
>
> Also at the moment the management plugin won't let you publish or get
> messages. That's also on the TODO list in some form.
>
> I'm planning on making a preview release of the management plugin later
> today, at which point things may start to become clearer...
>
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Tue Sep  7 11:59:07 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 11:59:07 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
Message-ID: <4C861AFB.1010102@rabbitmq.com>

I've made a preview release of the management plugin. Currently there 
are a few caveats around its use, but it's certainly ready for people to 
test / evaluate / judge / etc. Read all about it at the blog:

http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/

...but feel free to post opinions here too.

Cheers, Simon


From cal.leeming at simplicitymedialtd.co.uk  Tue Sep  7 12:19:06 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Tue, 7 Sep 2010 12:19:06 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C861AFB.1010102@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
Message-ID: <AANLkTi=0V9Q7BmfJ79NUFP6rK2CbUKojxpFOS2kQn8yU@mail.gmail.com>

Oh now thats hot.. Very hot.

I was thinking about making something like this, but didn't get a chance :(

I'll look forward to testing this out!

On Tue, Sep 7, 2010 at 11:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I've made a preview release of the management plugin. Currently there are a
> few caveats around its use, but it's certainly ready for people to test /
> evaluate / judge / etc. Read all about it at the blog:
>
> http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/
>
> ...but feel free to post opinions here too.
>
> Cheers, Simon
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/db3910bb/attachment.htm>

From videlalvaro at gmail.com  Tue Sep  7 13:50:51 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 7 Sep 2010 20:50:51 +0800
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C861AFB.1010102@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
Message-ID: <85AC5814-7B6C-45F6-A0A6-70853AAE07A3@gmail.com>

Hi Simon,

Judging by the blogpost, this plugin is looking great. I will see if we can stop using our PHP admin console and move on to use this tool. 

Regards,

Alvaro

Sent from my iFad

On Sep 7, 2010, at 6:59 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I've made a preview release of the management plugin. Currently there are a few caveats around its use, but it's certainly ready for people to test / evaluate / judge / etc. Read all about it at the blog:
> 
> http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/
> 
> ...but feel free to post opinions here too.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From frank.goenninger at consequor.de  Tue Sep  7 15:52:47 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Tue, 7 Sep 2010 16:52:47 +0200
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C861AFB.1010102@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
Message-ID: <4F74E9E7-BD05-4AF1-BE29-5A90CDA2D438@consequor.de>

Cool! Running here on Mac OS X Snow Leopard 10.6.5 with Erlang OTP R14A.

Go, Simon, go!

Cheers
  Frank

Am 07.09.2010 um 12:59 schrieb Simon MacMullen:

> I've made a preview release of the management plugin. Currently there 
> are a few caveats around its use, but it's certainly ready for people to 
> test / evaluate / judge / etc. Read all about it at the blog:
> 
> http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/
> 
> ...but feel free to post opinions here too.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matthew at rabbitmq.com  Tue Sep  7 16:02:42 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Sep 2010 16:02:42 +0100
Subject: [rabbitmq-discuss] gen_server2 ques. and was: Re: clarifying
 plugin supervision, configuration
In-Reply-To: <1298906D-D257-41B2-9E66-7E018B1E5BCB@jbrisbin.com>
References: <BE8137EE-D98C-4BA8-A9AD-65D4600DC704@jbrisbin.com>
	<4C7FB5E0.8050003@rabbitmq.com>
	<4F121276-2725-46D4-9CDE-D4ED3FF410A8@jbrisbin.com>
	<20100902145603.GF21176@rabbitmq.com>
	<1298906D-D257-41B2-9E66-7E018B1E5BCB@jbrisbin.com>
Message-ID: <20100907150241.GA25578@wellquite.org>

Hi Jon,

On Thu, Sep 02, 2010 at 10:13:20AM -0500, Jon Brisbin wrote:
> > Best explained by reading the comments at the top of the gen_server2
> > module.
> 
> Sure. Did that. But I'm wondering (out loud ;) if some of the
> situations described there (ordered delivery, hibernate etc...)
> wouldn't nicely fit what the webhooks plugin is doing. It will sit for
> periods of time with little activity and it would be nice to have that
> hibernation (though I don't know that I could take full advantage of
> it). I'm just not sure that spending time trying to use those features
> would really buy that much. I was wondering if there's a rule of thumb
> that's been discovered here that your situation should hit X number of
> messages or it should be doing Y before you really need to worry about
> using gen_server2? I'm not terribly afraid of being tied to an
> internal API because it'll likely stay a plugin for the foreseeable
> future.

There is no especial rule of thumb there. We tend to use gen_server2
when any of the following are met:

a) we need message priorities
b) we know that this process is going to need to make calls to other
processes whilst its mailbox is massive
c) we want the process to hibernate, but we also know that it might be
woken up fairly frequently and we don't want it to burn huge amounts of
CPU endlessly hibernating and waking up

Point (b) is now irrelevant if you're using a modern erlang - I think
they fixed that in either R13B04 or R14A - check the release notes.

Point (c) is really the motivation behind the backoff stuff - we noticed
that if you had lots of idle queues, and were doing a "watch rabbitmqctl
list_queues" you could max out your CPU because every queue was
hibernating and then waking up.

Matthew


From jasonjwwilliams at gmail.com  Tue Sep  7 17:28:35 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Sep 2010 10:28:35 -0600
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C861AFB.1010102@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
Message-ID: <3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>

Hey Simon,

Actually installed this yesterday from hg. It's phenomenal. Exactly what we've needed from day one. It looks pretty stable from my testing, any known gotchas that should keep it out of production?

Removing the rabbit_status plugin as we speak. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Sep 7, 2010, at 4:59, Simon MacMullen <simon at rabbitmq.com> wrote:

> I've made a preview release of the management plugin. Currently there are a few caveats around its use, but it's certainly ready for people to test / evaluate / judge / etc. Read all about it at the blog:
> 
> http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/
> 
> ...but feel free to post opinions here too.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Sep  7 17:38:13 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 17:38:13 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
Message-ID: <4C866A75.5090502@rabbitmq.com>

On 07/09/10 17:28, Jason J. W. Williams wrote:
> Hey Simon,
>
> Actually installed this yesterday from hg. It's phenomenal. Exactly
> what we've needed from day one. It looks pretty stable from my
> testing, any known gotchas that should keep it out of production?

Thanks :)

The two big concerns are the ones listed in the blog: it will slow your 
server down a few percentage points, and anyone who can log in can 
modify their own permissions. Obviously I'll be fixing those, and I 
suspect many people won't care, but those are the two biggies in my mind.

It's only had desk testing, but the supervision hierarchy should be 
right, so if it dies it shouldn't take Rabbit down with it.

Cheers, Simon

From jon at jbrisbin.com  Tue Sep  7 17:53:16 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 11:53:16 -0500
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C866A75.5090502@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
Message-ID: <3F63ED60-98DE-4E3C-845A-A9C6A83322BF@jbrisbin.com>


First off, thanks for the web admin. I'll be testing it as soon as I can...

On Sep 7, 2010, at 11:38 AM, Simon MacMullen wrote:

> 
> It's only had desk testing, but the supervision hierarchy should be right, so if it dies it shouldn't take Rabbit down with it.

Would you mind elaborating a little bit here? I'd like to have the same thing for my plugin but wasn't familiar enough with the Rabbit internals to do this. Could you maybe explain your supervisor a bit so I can see what you're doing?

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/997e31eb/attachment-0001.htm>

From simon at rabbitmq.com  Tue Sep  7 18:02:37 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 18:02:37 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <3F63ED60-98DE-4E3C-845A-A9C6A83322BF@jbrisbin.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
	<3F63ED60-98DE-4E3C-845A-A9C6A83322BF@jbrisbin.com>
Message-ID: <4C86702D.8070900@rabbitmq.com>

On 07/09/10 17:53, Jon Brisbin wrote:
> On Sep 7, 2010, at 11:38 AM, Simon MacMullen wrote:
>> It's only had desk testing, but the supervision hierarchy should be
>> right, so if it dies it shouldn't take Rabbit down with it.
>
> Would you mind elaborating a little bit here? I'd like to have the same
> thing for my plugin but wasn't familiar enough with the Rabbit internals
> to do this. Could you maybe explain your supervisor a bit so I can see
> what you're doing?

Nothing magical. It's an Erlang/OTP thing rather than a Rabbit thing per 
se. I was just trying to say that I had given the supervision hierarchy 
some thought :)

http://www.erlang.org/doc/design_principles/sup_princ.html
and
http://www.erlang.org/doc/man/supervisor.html
should explain supervisors.

Cheers, Simon

From ptmcg at austin.rr.com  Tue Sep  7 18:27:40 2010
From: ptmcg at austin.rr.com (Paul McGuire)
Date: Tue, 7 Sep 2010 10:27:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Any pre-tx_commit validation possible on a
	channel?
Message-ID: <cbaa67e1-5b3d-450e-a6fe-a0dc147cbc56@j18g2000yqd.googlegroups.com>

I realize that a 100% airtight solution is not possible, but is there
any way before calling tx_commit to anticipate at least some simple
failures in sending messages that have been buffered up in a
transaction?  I am trying to merge AMQP messaging with XA two-phase
commit.

In XA, I can send the messages (by calling tx_commit) at voting time,
which would rollback any db changes if the message send fails (at XA
voting time, any failure causes all other participants to rollback).
But if I send messages at voting time, consumers of the message see a
pre-commit view of the database, which is not really what I want.

If I send the message/call tx_commit at XA finish time, then consumers
will see the post-commit database view, but a failed message send will
not rollback the database.  (I do still get the benefit of database
failures causing the message transaction to abort with this approach.)

Is there any channel or message-publishing validation I can do at XA
voting time that might anticipate a message publishing failure?

Thanks,
-- Paul

From jasonjwwilliams at gmail.com  Tue Sep  7 18:40:25 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Sep 2010 11:40:25 -0600
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C866A75.5090502@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
Message-ID: <AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>

Thanks Simon! The performance hit is completely acceptable in my
opinion for the benefit. Have y'all considered adding a BQL query box?

-J

On Tue, Sep 7, 2010 at 10:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 07/09/10 17:28, Jason J. W. Williams wrote:
>>
>> Hey Simon,
>>
>> Actually installed this yesterday from hg. It's phenomenal. Exactly
>> what we've needed from day one. It looks pretty stable from my
>> testing, any known gotchas that should keep it out of production?
>
> Thanks :)
>
> The two big concerns are the ones listed in the blog: it will slow your
> server down a few percentage points, and anyone who can log in can modify
> their own permissions. Obviously I'll be fixing those, and I suspect many
> people won't care, but those are the two biggies in my mind.
>
> It's only had desk testing, but the supervision hierarchy should be right,
> so if it dies it shouldn't take Rabbit down with it.
>
> Cheers, Simon
>

From simon at rabbitmq.com  Tue Sep  7 19:56:39 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 19:56:39 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
References: <4C861AFB.1010102@rabbitmq.com>	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>	<4C866A75.5090502@rabbitmq.com>
	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
Message-ID: <4C868AE7.2020801@rabbitmq.com>

On 07/09/10 18:40, Jason J. W. Williams wrote:
> Thanks Simon! The performance hit is completely acceptable in my
> opinion for the benefit.

Cool. In future you'll be able to opt out of it, at the cost of seeing 
less statistics.

 > Have y'all considered adding a BQL query box?

Hmm, not really. My intention is to get rabbitmq-management to replace 
BQL eventually. What would you do with a BQL box if it were there?

Cheers, Simon

From jon at jbrisbin.com  Tue Sep  7 20:00:47 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 14:00:47 -0500
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0 broker
Message-ID: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>

I'm back to a point where I'm needing to start working with the erlang client in a Nitrogen-based web application I'm building. amqp_connection:start_network() won't work for me at all.

I tried a fresh checkout of the erlang client using the rabbitmq_v2_0_0 tag and built the source. I get the following error consistently, whether using a release version of the broker, or doing a make run from the rabbitmq-server directory just checked out from mercurial.

Channel 1 closing: received exit signal from writer. Reason: {badarg,
                                                              [{rabbit_framing_amqp_0_9_1,
                                                                encode_method_fields,
                                                                1},
                                                               {rabbit_binary_generator,
                                                                build_simple_method_frame,
                                                                3},
                                                               {rabbit_writer,
                                                                internal_send_command_async,
                                                                4},
                                                               {rabbit_writer,
                                                                handle_message,
                                                                2},
                                                               {rabbit_writer,
                                                                mainloop,1}]}

I'm 1000% sure I'm using the source I'm supposed to because I did an hg clone on the tag (transcript below) and I went to the repo in a browser and downloaded the files for that tag directly from Mercurial. Same result either way.

I've tried to include full transcripts of the build, the logging from the app, and relevant versions, etc... from my OS X erlang install. Any help/insight you can give here would be greatly appreciated! :)

Thanks!

J. Brisbin
http://jbrisbin.com/


Build transcript:

+--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:03 PM)-->
+-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-codegen
destination directory: rabbitmq-codegen
requesting all changes
adding changesets
adding manifests
adding file changes
added 137 changesets with 120 changes to 18 files
updating to branch default
10 files updated, 0 files merged, 0 files removed, 0 files unresolved
+--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
+-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-erlang-client
destination directory: rabbitmq-erlang-client
requesting all changes
adding changesets
adding manifests
adding file changes
added 695 changesets with 1400 changes to 126 files
updating to branch default
26 files updated, 0 files merged, 0 files removed, 0 files unresolved
+--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
+-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0 http://hg.rabbitmq.com/rabbitmq-server
destination directory: rabbitmq-server
requesting all changes
adding changesets
adding manifests
adding file changes
added 4135 changesets with 7116 changes to 229 files
updating to branch default
141 files updated, 0 files merged, 0 files removed, 0 files unresolved
+--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
+-( ~/src/rabbitmq/2.0 ):> cd rabbitmq-erlang-client/
+--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:05 PM)-->
+-( ~/src/rabbitmq/2.0/rabbitmq-erlang-client ):> make
sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app
mkdir -p dist
make -C ../rabbitmq-server
python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl xsltproc --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`" \ 		docs/usage.xsl docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp > src/rabbit_ctl_usage.erl.tmp2 fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3 mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2 xsltproc --stringparam modulename "`basename src/rabbit_multi_usage.erl .erl`" \ 		docs/usage.xsl docs/rabbitmq-multi.1.xml > src/rabbit_multi_usage.erl.tmp sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_multi_usage.erl.tmp > src/rabbit_multi_usage.erl.tmp2 fold -s src/rabbit_multi_usage.erl.tmp2 > src/rabbit_multi_usage.erl.tmp3 mv src/rabbit_multi_usage.erl.tmp3 src/rabbit_multi_usage.erl rm src/rabbit_multi_usage.erl.tmp src/rabbit_multi_usage.erl.tmp2 python codegen.py --ignore-conflicts header ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json ../rabbitmq-codegen//amqp-rabbitmq-0.8.json include/rabbit_framing.hrl escript generate_deps include src \$\(EBIN_DIR\) deps.mk
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/bpqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/gen_server2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/delegate.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/delegate_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/file_handle_cache.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/gatherer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/pg_local.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/priority_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_access_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_alarm.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_amqqueue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_amqqueue_process.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/supervisor2.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_amqqueue_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_backing_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_basic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_binary_generator.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_binary_parser.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_channel.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_control.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_dialyzer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_error_logger.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_error_logger_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_event.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type_direct.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type_fanout.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type_headers.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type_registry.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_exchange_type_topic.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_framing_channel.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_guid.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_heartbeat.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_hooks.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_invariable_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_limiter.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_load.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_log.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_misc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_mnesia.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_msg_file.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_msg_store.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_msg_store_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_msg_store_ets_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_msg_store_gc.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_multi.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_net.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_networking.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_node_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_persister.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_plugin_activator.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_queue_collector.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_queue_index.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_reader.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_restartable_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_router.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_sasl_report_file_h.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_tests.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_tests_event_receiver.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_tracer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_types.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_variable_queue.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_writer.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_acceptor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_acceptor_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_client_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_listener.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_listener_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/test_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/vm_memory_monitor.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/worker_pool.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/worker_pool_sup.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/worker_pool_worker.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_framing_amqp_0_9_1.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_framing_amqp_0_8.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_ctl_usage.erl
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_multi_usage.erl
escript generate_app ebin ebin/rabbit.app < ebin/rabbit_app.in
rm -rf dist/rabbit_common
mkdir -p dist/rabbit_common/include
mkdir -p dist/rabbit_common/ebin
cp rabbit_common.app dist/rabbit_common/ebin/
( cp ../rabbitmq-server/ebin/rabbit_writer.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_reader.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_framing_amqp_0_8.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_framing_amqp_0_9_1.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_framing_channel.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_basic.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_binary_generator.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_binary_parser.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_channel.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_exchange_type.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_misc.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_net.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/rabbit_heartbeat.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/gen_server2.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/priority_queue.beam dist/rabbit_common/ebin/ );  ( cp ../rabbitmq-server/ebin/supervisor2.beam dist/rabbit_common/ebin/ );
cp ../rabbitmq-server/include/*.hrl dist/rabbit_common/include/
(cd dist; zip -r rabbit_common.ez rabbit_common)
  adding: rabbit_common/ (stored 0%)
  adding: rabbit_common/ebin/ (stored 0%)
  adding: rabbit_common/ebin/gen_server2.beam (deflated 18%)
  adding: rabbit_common/ebin/priority_queue.beam (deflated 20%)
  adding: rabbit_common/ebin/rabbit_basic.beam (deflated 7%)
  adding: rabbit_common/ebin/rabbit_binary_generator.beam (deflated 12%)
  adding: rabbit_common/ebin/rabbit_binary_parser.beam (deflated 18%)
  adding: rabbit_common/ebin/rabbit_channel.beam (deflated 19%)
  adding: rabbit_common/ebin/rabbit_common.app (deflated 63%)
  adding: rabbit_common/ebin/rabbit_exchange_type.beam (deflated 20%)
  adding: rabbit_common/ebin/rabbit_framing_amqp_0_8.beam (deflated 21%)
  adding: rabbit_common/ebin/rabbit_framing_amqp_0_9_1.beam (deflated 17%)
  adding: rabbit_common/ebin/rabbit_framing_channel.beam (deflated 15%)
  adding: rabbit_common/ebin/rabbit_heartbeat.beam (deflated 20%)
  adding: rabbit_common/ebin/rabbit_misc.beam (deflated 16%)
  adding: rabbit_common/ebin/rabbit_net.beam (deflated 13%)
  adding: rabbit_common/ebin/rabbit_reader.beam (deflated 17%)
  adding: rabbit_common/ebin/rabbit_writer.beam (deflated 11%)
  adding: rabbit_common/ebin/supervisor2.beam (deflated 22%)
  adding: rabbit_common/include/ (stored 0%)
  adding: rabbit_common/include/rabbit.hrl (deflated 61%)
  adding: rabbit_common/include/rabbit_backing_queue_spec.hrl (deflated 67%)
  adding: rabbit_common/include/rabbit_exchange_type_spec.hrl (deflated 64%)
  adding: rabbit_common/include/rabbit_framing.hrl (deflated 75%)
  adding: rabbit_common/include/rabbit_msg_store.hrl (deflated 58%)
  adding: rabbit_common/include/rabbit_msg_store_index.hrl (deflated 66%)
mkdir -p deps
rm -rf deps/rabbit_common
mkdir -p deps/rabbit_common
unzip -o dist/rabbit_common.ez -d deps
Archive:  dist/rabbit_common.ez
   creating: deps/rabbit_common/ebin/
  inflating: deps/rabbit_common/ebin/gen_server2.beam  
  inflating: deps/rabbit_common/ebin/priority_queue.beam  
  inflating: deps/rabbit_common/ebin/rabbit_basic.beam  
  inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam  
  inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam  
  inflating: deps/rabbit_common/ebin/rabbit_channel.beam  
  inflating: deps/rabbit_common/ebin/rabbit_common.app  
  inflating: deps/rabbit_common/ebin/rabbit_exchange_type.beam  
  inflating: deps/rabbit_common/ebin/rabbit_framing_amqp_0_8.beam  
  inflating: deps/rabbit_common/ebin/rabbit_framing_amqp_0_9_1.beam  
  inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam  
  inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam  
  inflating: deps/rabbit_common/ebin/rabbit_misc.beam  
  inflating: deps/rabbit_common/ebin/rabbit_net.beam  
  inflating: deps/rabbit_common/ebin/rabbit_reader.beam  
  inflating: deps/rabbit_common/ebin/rabbit_writer.beam  
  inflating: deps/rabbit_common/ebin/supervisor2.beam  
   creating: deps/rabbit_common/include/
  inflating: deps/rabbit_common/include/rabbit.hrl  
  inflating: deps/rabbit_common/include/rabbit_backing_queue_spec.hrl  
  inflating: deps/rabbit_common/include/rabbit_exchange_type_spec.hrl  
  inflating: deps/rabbit_common/include/rabbit_framing.hrl  
  inflating: deps/rabbit_common/include/rabbit_msg_store.hrl  
  inflating: deps/rabbit_common/include/rabbit_msg_store_index.hrl  
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_channel.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_channel_util.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_connection.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_direct_connection.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_main_reader.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_network_connection.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_rpc_client.erl
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_rpc_server.erl
sed -e 's:%%VSN%%:0.0.0:g' < ebin/amqp_client.app.in > ebin/amqp_client.app
rm -rf dist/amqp_client
mkdir -p dist/amqp_client/ebin
cp -r ebin/*.beam dist/amqp_client/ebin
cp -r ebin/*.app dist/amqp_client/ebin
mkdir -p dist/amqp_client/include
cp -r include/* dist/amqp_client/include
(cd dist; zip -r amqp_client.ez amqp_client)
  adding: amqp_client/ (stored 0%)
  adding: amqp_client/ebin/ (stored 0%)
  adding: amqp_client/ebin/amqp_channel.beam (deflated 14%)
  adding: amqp_client/ebin/amqp_channel_util.beam (deflated 13%)
  adding: amqp_client/ebin/amqp_client.app (deflated 57%)
  adding: amqp_client/ebin/amqp_connection.beam (deflated 8%)
  adding: amqp_client/ebin/amqp_direct_connection.beam (deflated 11%)
  adding: amqp_client/ebin/amqp_main_reader.beam (deflated 10%)
  adding: amqp_client/ebin/amqp_network_connection.beam (deflated 14%)
  adding: amqp_client/ebin/amqp_rpc_client.beam (deflated 8%)
  adding: amqp_client/ebin/amqp_rpc_server.beam (deflated 7%)
  adding: amqp_client/include/ (stored 0%)
  adding: amqp_client/include/amqp_client.hrl (deflated 57%)


Logging from Nitrogen app:

params: {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,"localhost",5672,0,0,0,
                     none,[]}

=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
Channel 1 closing: received exit signal from writer. Reason: {badarg,
                                                              [{rabbit_framing_amqp_0_9_1,
                                                                encode_method_fields,
                                                                1},
                                                               {rabbit_binary_generator,
                                                                build_simple_method_frame,
                                                                3},
                                                               {rabbit_writer,
                                                                internal_send_command_async,
                                                                4},
                                                               {rabbit_writer,
                                                                handle_message,
                                                                2},
                                                               {rabbit_writer,
                                                                mainloop,1}]}

=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
** Generic server <0.115.0> terminating 
** Last message in was {'EXIT',<0.117.0>,
                           {badarg,
                               [{rabbit_framing_amqp_0_9_1,
                                    encode_method_fields,1},
                                {rabbit_binary_generator,
                                    build_simple_method_frame,3},
                                {rabbit_writer,internal_send_command_async,4},
                                {rabbit_writer,handle_message,2},
                                {rabbit_writer,mainloop,1}]}}
** When Server state == {c_state,1,<0.108.0>,<0.116.0>,<0.117.0>,network,
                            {[{{<0.107.0>,#Ref<0.0.0.193>},
                               {'channel.close',undefined,<<>>,undefined,
                                   undefined},
                               none}],
                             []},
                            {[],[]},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            just_channel,none,false,none,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            unknown}
** Reason for termination == 
** {writer_died,<0.117.0>,
                {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
                         {rabbit_binary_generator,build_simple_method_frame,3},
                         {rabbit_writer,internal_send_command_async,4},
                         {rabbit_writer,handle_message,2},
                         {rabbit_writer,mainloop,1}]}}

=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
Connection (<0.108.0>) closing: channel (<0.115.0>) died. Reason: {writer_died,
                                                                   <0.117.0>,
                                                                   {badarg,
                                                                    [{rabbit_framing_amqp_0_9_1,
                                                                      encode_method_fields,
                                                                      1},
                                                                     {rabbit_binary_generator,
                                                                      build_simple_method_frame,
                                                                      3},
                                                                     {rabbit_writer,
                                                                      internal_send_command_async,
                                                                      4},
                                                                     {rabbit_writer,
                                                                      handle_message,
                                                                      2},
                                                                     {rabbit_writer,
                                                                      mainloop,
                                                                      1}]}}

=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
** Generic server oja_amqp terminating 
** Last message in was {'$gen_cast',
                           {provision,
                               [{name,"test"},
                                {salt,"564a08ec9a45ba7f417fdf9ea401ddea"},
                                {password,
                                    "b0bb14adc08f9c98fa12e54f8c48dc855bdacd71"},
                                {roles,["applicant"]}]}}
** When Server state == {amqp_state,<0.115.0>}
** Reason for termination == 
** {{writer_died,<0.117.0>,
        {badarg,
            [{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
             {rabbit_binary_generator,build_simple_method_frame,3},
             {rabbit_writer,internal_send_command_async,4},
             {rabbit_writer,handle_message,2},
             {rabbit_writer,mainloop,1}]}},
    {gen_server,call,
        [<0.115.0>,
         {call,{'channel.close',undefined,<<>>,undefined,undefined},none},
         infinity]}}

=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
Error in process <0.117.0> on node 'oja at 127.0.0.1' with exit value: {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},{rabbit_binary_generator,build_simple_method_frame,3},{rabbit_writer,internal_send_command_async,4},{rabbit_writer,handle_message,2},{rabbit_writer... 


=ERROR REPORT==== 7-Sep-2010::13:08:04 ===
** Generic server <0.108.0> terminating 
** Last message in was {'$gen_cast',{method,{'connection.close_ok'},none}}
** When Server state == {nc_state,
                            {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
                                "localhost",5672,0,0,0,none,[]},
                            #Port<0.2012>,<0.113.0>,<0.112.0>,<0.111.0>,0,0,
                            {nc_closing,internal_error,
                                {'connection.close',541,<<>>,0,0},
                                none,wait_close_ok},
                            [{<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.0.0">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>}],
                            {{0,nil},
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}}}}
** Reason for termination == 
** {internal_error,541,<<>>}

=INFO REPORT==== 7-Sep-2010::13:08:04 ===
Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)


Broker:

Activating RabbitMQ plugins ...
0 plugins activated:

Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8


Client:

		BrokerParams = #amqp_params{ host=proplists:get_value(broker_host, Config, "localhost"),
																 port=proplists:get_value(broker_port, Config, 5672),
																 username=proplists:get_value(broker_user, Config, <<"guest">>),
																 password=proplists:get_value(broker_pass, Config, <<"guest">>),
																 virtual_host=proplists:get_value(broker_vhost, Config, <<"/">>) },
		io:format("params: ~p~n", [BrokerParams]),
		Connection = amqp_connection:start_network(BrokerParams),
		Channel = amqp_connection:open_channel(Connection),

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/1adcc204/attachment-0001.htm>

From darren.cruse at gmail.com  Tue Sep  7 20:02:02 2010
From: darren.cruse at gmail.com (darrencruse)
Date: Tue, 7 Sep 2010 12:02:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <552C4FCB-8E8C-4B45-A3E3-CD287A9021BD@npcinternational.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<552C4FCB-8E8C-4B45-A3E3-CD287A9021BD@npcinternational.com>
Message-ID: <29641616.post@talk.nabble.com>


Only skimmed this thread not sure if I should comment since I don't know much
about RabbitMQ at all, but I have worked with NetKernel and what you're
describing sounds real interesting.

The top-of-my-head thoughts fwiw:

a.  Are you familiar with the new NKP protocol?  Sounds like you should at
least take a look if not - it's very much about cloud computing using
NetKernel.  They've built a high speed protocol using Apache Etch for
allowing multiple NetKernel's to work together.  

https://cwiki.apache.org/ETCH/home.html

And they're latest downloads include an example doing a pub/sub model using
NetKernel with the NKP Protocol.

Here's a presentation about it from Peter Rodgers:
http://skillsmatter.com/podcast/cloud-grid/netkernel-and-the-resource-oriented-cloud

b.  But what you said about looking at the JMS source as a reference for
your RabbitMQ Transport was what I was going to suggest you beat me to it.
:)

c.  I didn't know enough to know is there definitely not a JMS Provider for
RabbitMQ (probably a dumb question from a brief google it sounds like maybe
there's not).  If there was I wondering if in fact you could just use
NetKernel's JMS Transport with RabbitMQ.

d.  From your arch drawing I was surprised you were talking about Scala
Actors - why wouldn't you just run NetKernel on both JVMs?  i.e. The
single-within-a JVM scala actor model seems redundant with NetKernel's
dymamic request resolution between endpoints within a single NetKernel, and
distributed actors likewise seem redundant with using your RabbitMQ
Transport and possibly using asynchronous requests.  It seems to me the real
beauty whether using NetKernel or actors would be the elegance of choosing
one approach and using that consistently throughout the architecture - it
wasn't clear to me why you'd want to mix both.  But I'm probably just not
following what you were after - are you integrating existing systems this
way that already use scala actors or something?

e.  Likewise I noticed you highlighted the use of cron on the one box, but
NetKernel has nice cron like capabilites based on quartz.  So again it seems
like there'd be more synergy by using NetKernel for those needs too(?)

Just some thoughts fwiw (again I'm not a RabbitMQ expert and I didn't look
closely at your thread so I may be missing some things in what you're
after),
-- 
View this message in context: http://old.nabble.com/RabbitKernel-tp29276795p29641616.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Tue Sep  7 20:11:31 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 20:11:31 +0100
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0
 broker
In-Reply-To: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
References: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
Message-ID: <4C868E63.8090100@rabbitmq.com>

On 07/09/10 20:00, Jon Brisbin wrote:
> params: {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,"localhost",5672,0,0,0,
>                       none,[]}

Hmm. That "localhost" looks very suspicious. Try <<"localhost">>.

Yes, that is an awful error message.

Cheers, Simon

From jasonjwwilliams at gmail.com  Tue Sep  7 20:13:54 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Sep 2010 13:13:54 -0600
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C868AE7.2020801@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
	<4C868AE7.2020801@rabbitmq.com>
Message-ID: <AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>

Write provisioning scripts for setting up new Rabbits.

-J

On Tue, Sep 7, 2010 at 12:56 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 07/09/10 18:40, Jason J. W. Williams wrote:
>>
>> Thanks Simon! The performance hit is completely acceptable in my
>> opinion for the benefit.
>
> Cool. In future you'll be able to opt out of it, at the cost of seeing less
> statistics.
>
>> Have y'all considered adding a BQL query box?
>
> Hmm, not really. My intention is to get rabbitmq-management to replace BQL
> eventually. What would you do with a BQL box if it were there?
>
> Cheers, Simon
>

From darren.cruse at gmail.com  Tue Sep  7 20:14:22 2010
From: darren.cruse at gmail.com (darrencruse)
Date: Tue, 7 Sep 2010 12:14:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <29641616.post@talk.nabble.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<552C4FCB-8E8C-4B45-A3E3-CD287A9021BD@npcinternational.com>
	<29641616.post@talk.nabble.com>
Message-ID: <29641617.post@talk.nabble.com>


I just noticed there's an XMPP gateway for RabbitMQ, and NetKernel does have
an XMPP Transport - don't know if that's of interest - maybe that would work
with NetKernel out of the box(?)

Also I should have mentioned how helpful I've found Peter Rodgers and Tony
Butterfield at 1060.org regarding NetKernel - if you haven't contacted them
that would be your best bet about NetKernel questions.  Or you could post a
message on their forum:

http://www.1060.org/forum/

-- 
View this message in context: http://old.nabble.com/RabbitKernel-tp29276795p29641617.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Tue Sep  7 20:27:16 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 20:27:16 +0100
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0
 broker
In-Reply-To: <4C868E63.8090100@rabbitmq.com>
References: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
	<4C868E63.8090100@rabbitmq.com>
Message-ID: <4C869214.30400@rabbitmq.com>

On 07/09/10 20:11, Simon MacMullen wrote:
> Hmm. That "localhost" looks very suspicious. Try <<"localhost">>.

Oops, ignore that. Host is meant to be a string.

Cheers, Simon

From simon at rabbitmq.com  Tue Sep  7 20:28:57 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 20:28:57 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>
References: <4C861AFB.1010102@rabbitmq.com>	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>	<4C866A75.5090502@rabbitmq.com>	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>	<4C868AE7.2020801@rabbitmq.com>
	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>
Message-ID: <4C869279.9070103@rabbitmq.com>

On 07/09/10 20:13, Jason J. W. Williams wrote:
 >>> Have y'all considered adding a BQL query box?
 >>
 >> Hmm, not really. My intention is to get rabbitmq-management to 
replace BQL
 >> eventually. What would you do with a BQL box if it were there?
 >
> Write provisioning scripts for setting up new Rabbits.

Ah, right. The intent is to provide you with a means to do that.

Cheers, Simon

From jon at jbrisbin.com  Tue Sep  7 20:33:56 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 14:33:56 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <29641616.post@talk.nabble.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<552C4FCB-8E8C-4B45-A3E3-CD287A9021BD@npcinternational.com>
	<29641616.post@talk.nabble.com>
Message-ID: <E9DFD38F-452D-4C61-AFA3-387716EC72C7@jbrisbin.com>

Thanks for the excellent thoughts here! :) Comments below...

On Sep 7, 2010, at 2:02 PM, darrencruse wrote:

> a.  Are you familiar with the new NKP protocol?  Sounds like you should at
> least take a look if not - it's very much about cloud computing using
> NetKernel.  They've built a high speed protocol using Apache Etch for
> allowing multiple NetKernel's to work together.  
> 
> https://cwiki.apache.org/ETCH/home.html
> 
> And they're latest downloads include an example doing a pub/sub model using
> NetKernel with the NKP Protocol.

This sounds very good, indeed! I'll be investigating this more right away.

> b.  But what you said about looking at the JMS source as a reference for
> your RabbitMQ Transport was what I was going to suggest you beat me to it.
> :)

Haven't actually written any code on this yet. Too many other things demanding my attention. 

I'm reworking my cloud job scheduler using Spring AMQP right now, so it might actually be a perfect time to revisit this in earnest and see if I can make something work. If you have a need for something similar, I love to collaborate. :)

> c.  I didn't know enough to know is there definitely not a JMS Provider for
> RabbitMQ (probably a dumb question from a brief google it sounds like maybe
> there's not).  If there was I wondering if in fact you could just use
> NetKernel's JMS Transport with RabbitMQ.

IMHO it's just as well there isn't a JMS provider for RabbitMQ. ;)

I like AMQP because it's truly cross-platform. I can write producers in Python and consumers in Java. Or Ruby. Or Erlang. :) 

> d.  From your arch drawing I was surprised you were talking about Scala
> Actors - why wouldn't you just run NetKernel on both JVMs?  i.e. The
> single-within-a JVM scala actor model seems redundant with NetKernel's
> dymamic request resolution between endpoints within a single NetKernel, and
> distributed actors likewise seem redundant with using your RabbitMQ
> Transport and possibly using asynchronous requests.  It seems to me the real
> beauty whether using NetKernel or actors would be the elegance of choosing
> one approach and using that consistently throughout the architecture - it
> wasn't clear to me why you'd want to mix both.  But I'm probably just not
> following what you were after - are you integrating existing systems this
> way that already use scala actors or something?

I guess that's a little confusing because I don't fully know what I want! :) 

The thing that prompted my looking into NetKernel was the frustration with having multiple copies of all the connections, channels, consumers, etc... in a Tomcat session manager I wrote for private clouds. Since I run multiple instances of Tomcat/tcServer per virtual machine (VMware virtual machine in this case), it seemed silly to me to be running, on a single "box", several instances of my session manager (one for each webapp) times the number of tcServer instances I'm running (usually 3) when all I need on that Linux box is a single manager for messages and a single cache that can service multiple tcServer instances without all the resource usage involved in duplicating everything. The better use I can make of those small VMs, the more traffic I can funnel through them. I need a way to communicate from a client in a session manager running in a Tomcat VM to the AMQP manager that's doing the message sending and session object mangling. Scala actors seemed to make sense here because they're friendly to the kind of cloud-scale distributed computing I'm trying to do but are still Java compatible. I wasn't sure I could get the same kind of ease of component communication by embedding NetKernel inside each Tomcat (again, I was concerned about unnecessary duplication of resources, whether it's NetKernel or RabbitMQ client stuff) considering a session manager is instantiated per webapp.

> e.  Likewise I noticed you highlighted the use of cron on the one box, but
> NetKernel has nice cron like capabilites based on quartz.  So again it seems
> like there'd be more synergy by using NetKernel for those needs too(?)

I'd prefer quartz, actually. I'd gladly stay within the context of NetKernel if I could. 

In general I use the term "cron" to refer to a scheduled, recurring job of some kind rather than the UNIX "cron" specifically. :)

> Just some thoughts fwiw (again I'm not a RabbitMQ expert and I didn't look
> closely at your thread so I may be missing some things in what you're
> after),


I really appreciate your thoughts! :) You've inspired me to get back in there and check out the NKP stuff and see if that will be a good fit. I've kind of hit a brick wall on another project I'm working on, so I think I'll get back into the job scheduler code today.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/763c9705/attachment-0001.htm>

From simon at rabbitmq.com  Tue Sep  7 20:35:29 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Sep 2010 20:35:29 +0100
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0
 broker
In-Reply-To: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
References: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
Message-ID: <4C869401.80409@rabbitmq.com>

So, that transcript looks ok to me. I just did the same things and got 
an Erlang client that worked. How are you starting the Erlang client? If 
you invoke "make run" in the rabbitmq_erlang_client directory, then type 
amqp_connection:start_network(). at the erl> prompt, does that work?

Cheers, Simon

On 07/09/10 20:00, Jon Brisbin wrote:
> I'm back to a point where I'm needing to start working with the erlang
> client in a Nitrogen-based web application I'm building.
> amqp_connection:start_network() won't work for me at all.
>
> I tried a fresh checkout of the erlang client using the rabbitmq_v2_0_0
> tag and built the source. I get the following error consistently,
> whether using a release version of the broker, or doing a make run from
> the rabbitmq-server directory just checked out from mercurial.
>
> Channel 1 closing: received exit signal from writer. Reason: {badarg,
> [{rabbit_framing_amqp_0_9_1,
> encode_method_fields,
> 1},
> {rabbit_binary_generator,
> build_simple_method_frame,
> 3},
> {rabbit_writer,
> internal_send_command_async,
> 4},
> {rabbit_writer,
> handle_message,
> 2},
> {rabbit_writer,
> mainloop,1}]}
>
> I'm 1000% sure I'm using the source I'm supposed to because I did an hg
> clone on the tag (transcript below) and I went to the repo in a browser
> and downloaded the files for that tag directly from Mercurial. Same
> result either way.
>
> I've tried to include full transcripts of the build, the logging from
> the app, and relevant versions, etc... from my OS X erlang install. Any
> help/insight you can give here would be greatly appreciated! :)
>
> Thanks!
>
> J. Brisbin
> http://jbrisbin.com/
>
>
> Build transcript:
>
> +--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:03 PM)-->
> +-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0
> http://hg.rabbitmq.com/rabbitmq-codegen
> destination directory: rabbitmq-codegen
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> added 137 changesets with 120 changes to 18 files
> updating to branch default
> 10 files updated, 0 files merged, 0 files removed, 0 files unresolved
> +--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
> +-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0
> http://hg.rabbitmq.com/rabbitmq-erlang-client
> destination directory: rabbitmq-erlang-client
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> added 695 changesets with 1400 changes to 126 files
> updating to branch default
> 26 files updated, 0 files merged, 0 files removed, 0 files unresolved
> +--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
> +-( ~/src/rabbitmq/2.0 ):> hg clone -r rabbitmq_v2_0_0
> http://hg.rabbitmq.com/rabbitmq-server
> destination directory: rabbitmq-server
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> added 4135 changesets with 7116 changes to 229 files
> updating to branch default
> 141 files updated, 0 files merged, 0 files removed, 0 files unresolved
> +--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:04 PM)-->
> +-( ~/src/rabbitmq/2.0 ):> cd rabbitmq-erlang-client/
> +--( jbrisbin at brisbins-mbp )-(Tue, Sep 07 13:05 PM)-->
> +-( ~/src/rabbitmq/2.0/rabbitmq-erlang-client ):> make
> sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app
> mkdir -p dist
> make -C ../rabbitmq-server
> python codegen.py body ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
> src/rabbit_framing_amqp_0_9_1.erl python codegen.py body
> ../rabbitmq-codegen//amqp-rabbitmq-0.8.json
> src/rabbit_framing_amqp_0_8.erl xsltproc --stringparam modulename
> "`basename src/rabbit_ctl_usage.erl .erl`" \ docs/usage.xsl
> docs/rabbitmqctl.1.xml > src/rabbit_ctl_usage.erl.tmp sed -e 's/"/\\"/g'
> -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp >
> src/rabbit_ctl_usage.erl.tmp2 fold -s src/rabbit_ctl_usage.erl.tmp2 >
> src/rabbit_ctl_usage.erl.tmp3 mv src/rabbit_ctl_usage.erl.tmp3
> src/rabbit_ctl_usage.erl rm src/rabbit_ctl_usage.erl.tmp
> src/rabbit_ctl_usage.erl.tmp2 xsltproc --stringparam modulename
> "`basename src/rabbit_multi_usage.erl .erl`" \ docs/usage.xsl
> docs/rabbitmq-multi.1.xml > src/rabbit_multi_usage.erl.tmp sed -e
> 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_multi_usage.erl.tmp >
> src/rabbit_multi_usage.erl.tmp2 fold -s src/rabbit_multi_usage.erl.tmp2
>  > src/rabbit_multi_usage.erl.tmp3 mv src/rabbit_multi_usage.erl.tmp3
> src/rabbit_multi_usage.erl rm src/rabbit_multi_usage.erl.tmp
> src/rabbit_multi_usage.erl.tmp2 python codegen.py --ignore-conflicts
> header ../rabbitmq-codegen//amqp-rabbitmq-0.9.1.json
> ../rabbitmq-codegen//amqp-rabbitmq-0.8.json include/rabbit_framing.hrl
> escript generate_deps include src \$\(EBIN_DIR\) deps.mk
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/bpqueue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/gen_server2.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/delegate.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/delegate_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/file_handle_cache.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/gatherer.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/pg_local.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/priority_queue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_access_control.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_alarm.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_amqqueue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_amqqueue_process.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/supervisor2.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_amqqueue_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_backing_queue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_basic.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_binary_generator.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_binary_parser.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_channel.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_control.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_dialyzer.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_error_logger.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_error_logger_file_h.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_event.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type_direct.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type_fanout.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type_headers.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type_registry.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_exchange_type_topic.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_framing_channel.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_guid.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_heartbeat.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_hooks.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_invariable_queue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_limiter.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_load.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_log.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_memory_monitor.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_misc.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_mnesia.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_msg_file.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_msg_store.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_msg_store_index.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_msg_store_ets_index.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_msg_store_gc.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_multi.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_net.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_networking.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_node_monitor.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_persister.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_plugin_activator.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_queue_collector.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_queue_index.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_reader.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_restartable_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_router.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_sasl_report_file_h.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_tests.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_tests_event_receiver.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_tracer.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_types.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_variable_queue.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_writer.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/tcp_acceptor.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/tcp_acceptor_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/tcp_client_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/tcp_listener.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/tcp_listener_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/test_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/vm_memory_monitor.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/worker_pool.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/worker_pool_sup.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/worker_pool_worker.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_framing_amqp_0_9_1.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_framing_amqp_0_8.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_ctl_usage.erl
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin
> src/rabbit_multi_usage.erl
> escript generate_app ebin ebin/rabbit.app < ebin/rabbit_app.in
> rm -rf dist/rabbit_common
> mkdir -p dist/rabbit_common/include
> mkdir -p dist/rabbit_common/ebin
> cp rabbit_common.app dist/rabbit_common/ebin/
> ( cp ../rabbitmq-server/ebin/rabbit_writer.beam dist/rabbit_common/ebin/
> ); ( cp ../rabbitmq-server/ebin/rabbit_reader.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_framing_amqp_0_8.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_framing_amqp_0_9_1.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_framing_channel.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_basic.beam dist/rabbit_common/ebin/ ); (
> cp ../rabbitmq-server/ebin/rabbit_binary_generator.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_binary_parser.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_channel.beam dist/rabbit_common/ebin/ );
> ( cp ../rabbitmq-server/ebin/rabbit_exchange_type.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/rabbit_misc.beam dist/rabbit_common/ebin/ ); (
> cp ../rabbitmq-server/ebin/rabbit_net.beam dist/rabbit_common/ebin/ ); (
> cp ../rabbitmq-server/ebin/rabbit_heartbeat.beam
> dist/rabbit_common/ebin/ ); ( cp
> ../rabbitmq-server/ebin/gen_server2.beam dist/rabbit_common/ebin/ ); (
> cp ../rabbitmq-server/ebin/priority_queue.beam dist/rabbit_common/ebin/
> ); ( cp ../rabbitmq-server/ebin/supervisor2.beam dist/rabbit_common/ebin/ );
> cp ../rabbitmq-server/include/*.hrl dist/rabbit_common/include/
> (cd dist; zip -r rabbit_common.ez rabbit_common)
> adding: rabbit_common/ (stored 0%)
> adding: rabbit_common/ebin/ (stored 0%)
> adding: rabbit_common/ebin/gen_server2.beam (deflated 18%)
> adding: rabbit_common/ebin/priority_queue.beam (deflated 20%)
> adding: rabbit_common/ebin/rabbit_basic.beam (deflated 7%)
> adding: rabbit_common/ebin/rabbit_binary_generator.beam (deflated 12%)
> adding: rabbit_common/ebin/rabbit_binary_parser.beam (deflated 18%)
> adding: rabbit_common/ebin/rabbit_channel.beam (deflated 19%)
> adding: rabbit_common/ebin/rabbit_common.app (deflated 63%)
> adding: rabbit_common/ebin/rabbit_exchange_type.beam (deflated 20%)
> adding: rabbit_common/ebin/rabbit_framing_amqp_0_8.beam (deflated 21%)
> adding: rabbit_common/ebin/rabbit_framing_amqp_0_9_1.beam (deflated 17%)
> adding: rabbit_common/ebin/rabbit_framing_channel.beam (deflated 15%)
> adding: rabbit_common/ebin/rabbit_heartbeat.beam (deflated 20%)
> adding: rabbit_common/ebin/rabbit_misc.beam (deflated 16%)
> adding: rabbit_common/ebin/rabbit_net.beam (deflated 13%)
> adding: rabbit_common/ebin/rabbit_reader.beam (deflated 17%)
> adding: rabbit_common/ebin/rabbit_writer.beam (deflated 11%)
> adding: rabbit_common/ebin/supervisor2.beam (deflated 22%)
> adding: rabbit_common/include/ (stored 0%)
> adding: rabbit_common/include/rabbit.hrl (deflated 61%)
> adding: rabbit_common/include/rabbit_backing_queue_spec.hrl (deflated 67%)
> adding: rabbit_common/include/rabbit_exchange_type_spec.hrl (deflated 64%)
> adding: rabbit_common/include/rabbit_framing.hrl (deflated 75%)
> adding: rabbit_common/include/rabbit_msg_store.hrl (deflated 58%)
> adding: rabbit_common/include/rabbit_msg_store_index.hrl (deflated 66%)
> mkdir -p deps
> rm -rf deps/rabbit_common
> mkdir -p deps/rabbit_common
> unzip -o dist/rabbit_common.ez -d deps
> Archive: dist/rabbit_common.ez
> creating: deps/rabbit_common/ebin/
> inflating: deps/rabbit_common/ebin/gen_server2.beam
> inflating: deps/rabbit_common/ebin/priority_queue.beam
> inflating: deps/rabbit_common/ebin/rabbit_basic.beam
> inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam
> inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam
> inflating: deps/rabbit_common/ebin/rabbit_channel.beam
> inflating: deps/rabbit_common/ebin/rabbit_common.app
> inflating: deps/rabbit_common/ebin/rabbit_exchange_type.beam
> inflating: deps/rabbit_common/ebin/rabbit_framing_amqp_0_8.beam
> inflating: deps/rabbit_common/ebin/rabbit_framing_amqp_0_9_1.beam
> inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam
> inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam
> inflating: deps/rabbit_common/ebin/rabbit_misc.beam
> inflating: deps/rabbit_common/ebin/rabbit_net.beam
> inflating: deps/rabbit_common/ebin/rabbit_reader.beam
> inflating: deps/rabbit_common/ebin/rabbit_writer.beam
> inflating: deps/rabbit_common/ebin/supervisor2.beam
> creating: deps/rabbit_common/include/
> inflating: deps/rabbit_common/include/rabbit.hrl
> inflating: deps/rabbit_common/include/rabbit_backing_queue_spec.hrl
> inflating: deps/rabbit_common/include/rabbit_exchange_type_spec.hrl
> inflating: deps/rabbit_common/include/rabbit_framing.hrl
> inflating: deps/rabbit_common/include/rabbit_msg_store.hrl
> inflating: deps/rabbit_common/include/rabbit_msg_store_index.hrl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_channel.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_channel_util.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_connection.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_direct_connection.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_main_reader.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_network_connection.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_rpc_client.erl
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> -Duse_specs src/amqp_rpc_server.erl
> sed -e 's:%%VSN%%:0.0.0:g' < ebin/amqp_client.app.in > ebin/amqp_client.app
> rm -rf dist/amqp_client
> mkdir -p dist/amqp_client/ebin
> cp -r ebin/*.beam dist/amqp_client/ebin
> cp -r ebin/*.app dist/amqp_client/ebin
> mkdir -p dist/amqp_client/include
> cp -r include/* dist/amqp_client/include
> (cd dist; zip -r amqp_client.ez amqp_client)
> adding: amqp_client/ (stored 0%)
> adding: amqp_client/ebin/ (stored 0%)
> adding: amqp_client/ebin/amqp_channel.beam (deflated 14%)
> adding: amqp_client/ebin/amqp_channel_util.beam (deflated 13%)
> adding: amqp_client/ebin/amqp_client.app (deflated 57%)
> adding: amqp_client/ebin/amqp_connection.beam (deflated 8%)
> adding: amqp_client/ebin/amqp_direct_connection.beam (deflated 11%)
> adding: amqp_client/ebin/amqp_main_reader.beam (deflated 10%)
> adding: amqp_client/ebin/amqp_network_connection.beam (deflated 14%)
> adding: amqp_client/ebin/amqp_rpc_client.beam (deflated 8%)
> adding: amqp_client/ebin/amqp_rpc_server.beam (deflated 7%)
> adding: amqp_client/include/ (stored 0%)
> adding: amqp_client/include/amqp_client.hrl (deflated 57%)
>
>
> Logging from Nitrogen app:
>
> params: {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,"localhost",5672,0,0,0,
> none,[]}
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> Channel 1 closing: received exit signal from writer. Reason: {badarg,
> [{rabbit_framing_amqp_0_9_1,
> encode_method_fields,
> 1},
> {rabbit_binary_generator,
> build_simple_method_frame,
> 3},
> {rabbit_writer,
> internal_send_command_async,
> 4},
> {rabbit_writer,
> handle_message,
> 2},
> {rabbit_writer,
> mainloop,1}]}
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> ** Generic server <0.115.0> terminating
> ** Last message in was {'EXIT',<0.117.0>,
> {badarg,
> [{rabbit_framing_amqp_0_9_1,
> encode_method_fields,1},
> {rabbit_binary_generator,
> build_simple_method_frame,3},
> {rabbit_writer,internal_send_command_async,4},
> {rabbit_writer,handle_message,2},
> {rabbit_writer,mainloop,1}]}}
> ** When Server state == {c_state,1,<0.108.0>,<0.116.0>,<0.117.0>,network,
> {[{{<0.107.0>,#Ref<0.0.0.193>},
> {'channel.close',undefined,<<>>,undefined,
> undefined},
> none}],
> []},
> {[],[]},
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> [],[]}}},
> just_channel,none,false,none,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> [],[]}}},
> unknown}
> ** Reason for termination ==
> ** {writer_died,<0.117.0>,
> {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
> {rabbit_binary_generator,build_simple_method_frame,3},
> {rabbit_writer,internal_send_command_async,4},
> {rabbit_writer,handle_message,2},
> {rabbit_writer,mainloop,1}]}}
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> Connection (<0.108.0>) closing: channel (<0.115.0>) died. Reason:
> {writer_died,
> <0.117.0>,
> {badarg,
> [{rabbit_framing_amqp_0_9_1,
> encode_method_fields,
> 1},
> {rabbit_binary_generator,
> build_simple_method_frame,
> 3},
> {rabbit_writer,
> internal_send_command_async,
> 4},
> {rabbit_writer,
> handle_message,
> 2},
> {rabbit_writer,
> mainloop,
> 1}]}}
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> ** Generic server oja_amqp terminating
> ** Last message in was {'$gen_cast',
> {provision,
> [{name,"test"},
> {salt,"564a08ec9a45ba7f417fdf9ea401ddea"},
> {password,
> "b0bb14adc08f9c98fa12e54f8c48dc855bdacd71"},
> {roles,["applicant"]}]}}
> ** When Server state == {amqp_state,<0.115.0>}
> ** Reason for termination ==
> ** {{writer_died,<0.117.0>,
> {badarg,
> [{rabbit_framing_amqp_0_9_1,encode_method_fields,1},
> {rabbit_binary_generator,build_simple_method_frame,3},
> {rabbit_writer,internal_send_command_async,4},
> {rabbit_writer,handle_message,2},
> {rabbit_writer,mainloop,1}]}},
> {gen_server,call,
> [<0.115.0>,
> {call,{'channel.close',undefined,<<>>,undefined,undefined},none},
> infinity]}}
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> Error in process <0.117.0> on node 'oja at 127.0.0.1' with exit value:
> {badarg,[{rabbit_framing_amqp_0_9_1,encode_method_fields,1},{rabbit_binary_generator,build_simple_method_frame,3},{rabbit_writer,internal_send_command_async,4},{rabbit_writer,handle_message,2},{rabbit_writer...
>
>
>
> =ERROR REPORT==== 7-Sep-2010::13:08:04 ===
> ** Generic server <0.108.0> terminating
> ** Last message in was {'$gen_cast',{method,{'connection.close_ok'},none}}
> ** When Server state == {nc_state,
> {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
> "localhost",5672,0,0,0,none,[]},
> #Port<0.2012>,<0.113.0>,<0.112.0>,<0.111.0>,0,0,
> {nc_closing,internal_error,
> {'connection.close',541,<<>>,0,0},
> none,wait_close_ok},
> [{<<"product">>,longstr,<<"RabbitMQ">>},
> {<<"version">>,longstr,<<"2.0.0">>},
> {<<"platform">>,longstr,<<"Erlang/OTP">>},
> {<<"copyright">>,longstr,
> <<"Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.">>},
> {<<"information">>,longstr,
> <<"Licensed under the MPL. See http://www.rabbitmq.com/">>}],
> {{0,nil},
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> [],[]},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> [],[]}}}}}
> ** Reason for termination ==
> ** {internal_error,541,<<>>}
>
> =INFO REPORT==== 7-Sep-2010::13:08:04 ===
> Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)
>
>
> Broker:
>
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+ +---+
> | | | |
> | | | |
> | | | |
> | +---+ +-------+
> | |
> | RabbitMQ +---+ |
> | | | |
> | v%%VSN%% +---+ |
> | |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
>
>
> Client:
>
> BrokerParams = #amqp_params{ host=proplists:get_value(broker_host,
> Config, "localhost"),
> port=proplists:get_value(broker_port, Config, 5672),
> username=proplists:get_value(broker_user, Config, <<"guest">>),
> password=proplists:get_value(broker_pass, Config, <<"guest">>),
> virtual_host=proplists:get_value(broker_vhost, Config, <<"/">>) },
> io:format("params: ~p~n", [BrokerParams]),
> Connection = amqp_connection:start_network(BrokerParams),
> Channel = amqp_connection:open_channel(Connection),
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Tue Sep  7 20:44:19 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 Sep 2010 20:44:19 +0100
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0
 broker
In-Reply-To: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
References: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
Message-ID: <4C869613.2010404@rabbitmq.com>

Jon,

Jon Brisbin wrote:
>     {gen_server,call,
>         [<0.115.0>,
>          {call,{'channel.close',undefined,<<>>,undefined,undefined},none},
>          infinity]}}

I suspect that is your problem. The above looks like a #'channel.close' 
record but without many of fields set to sensible values.

Are you perhaps sending that method directly? You really should be using 
  amqp_channel:close/{1,3} instead.


Matthias.

From jon at jbrisbin.com  Tue Sep  7 20:50:37 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 14:50:37 -0500
Subject: [rabbitmq-discuss] still no love with erlang client and 2.0.0
	broker
In-Reply-To: <4C869613.2010404@rabbitmq.com>
References: <AE473601-9EE6-4C4F-B99E-22D7EA318328@jbrisbin.com>
	<4C869613.2010404@rabbitmq.com>
Message-ID: <D4F1C85A-583A-483F-8C5E-49C9BBF6E7B7@jbrisbin.com>


On Sep 7, 2010, at 2:44 PM, Matthias Radestock wrote:

> Jon,
> 
> Jon Brisbin wrote:
>>    {gen_server,call,
>>        [<0.115.0>,
>>         {call,{'channel.close',undefined,<<>>,undefined,undefined},none},
>>         infinity]}}
> 
> I suspect that is your problem. The above looks like a #'channel.close' record but without many of fields set to sensible values.
> 
> Are you perhaps sending that method directly? You really should be using  amqp_channel:close/{1,3} instead.


For some reason (maybe copying from an example somewhere) I was sending a blank channel.close in terminate/2

I changed it to amqp_channel:close/1 and the error went bye-bye :)

I had another error which was causing the process to terminate, which is when it blew up with the error I sent.

I'll keep hacking on it and try to break something else unreasonably ;)

Thanks for the help!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/268761f7/attachment-0001.htm>

From davegreggory at yahoo.com  Tue Sep  7 20:59:19 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 7 Sep 2010 12:59:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C869279.9070103@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
	<4C868AE7.2020801@rabbitmq.com>
	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>
	<4C869279.9070103@rabbitmq.com>
Message-ID: <18126.83324.qm@web111013.mail.gq1.yahoo.com>

Glad to see this out there. It's great to be able to finally see send/receive 
rates.

Couple of questions.

1. Across what time frame are Send/receive rates calculated (ie rolling 5 minute 
intervals, etc)?
2. Where does this leave the Status plugin? Will that become discontinued or is 
that plugin's functionality complementary to this one? I'm asking because we 
have set up a lot of monitoring based on that plugin's output.

Feature requests:
Forgive me if these are already there, I haven't installed it yet. 

1. Rabbit MQ App Memory usage, Node Memory allocation, Queue Memory Use
2. Queue stats
3. Ability to clear queues (a la BQL's purge queue <queue-name>)
4. Importing / exporting broker state (a la BQL)
5. Ability to isolate plugin failures from taking down RabbitMQ - (ie run the 
plugin on a single RAM node in a cluster that no apps connect to, but from this 
node monitor the status of other nodes in the cluster)
6. Configurable permissions to lock down what can be done through the plugin

Dave



      

From jasonjwwilliams at gmail.com  Tue Sep  7 21:00:43 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Sep 2010 14:00:43 -0600
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C869279.9070103@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
	<4C868AE7.2020801@rabbitmq.com>
	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>
	<4C869279.9070103@rabbitmq.com>
Message-ID: <AANLkTimWtLLftLTzARht54hbxPcjq8Ns3+d++U+mhRZz@mail.gmail.com>

Excellent. :) Thank you again.

-J

On Tue, Sep 7, 2010 at 1:28 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 07/09/10 20:13, Jason J. W. Williams wrote:
>>>> Have y'all considered adding a BQL query box?
>>>
>>> Hmm, not really. My intention is to get rabbitmq-management to replace
>>> BQL
>>> eventually. What would you do with a BQL box if it were there?
>>
>>
>> Write provisioning scripts for setting up new Rabbits.
>
> Ah, right. The intent is to provide you with a means to do that.
>
> Cheers, Simon
>

From jon at jbrisbin.com  Tue Sep  7 22:00:22 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 16:00:22 -0500
Subject: [rabbitmq-discuss] couple of things on new admin interface
Message-ID: <9B8E1126-7A2B-4B89-9487-8C7DC5BA2E60@jbrisbin.com>

Just installed it on our Ubuntu Linux server using 2.0.0 from the RabbitMQ apt repo and it complained that "inets" was not installed. Installed erlang-inets from aptitude and it started right up. 

I like everything so far. I had a couple questions:

Is the list of queues pageable or will it display all of them at once? 

Can it be split up by vhost so I can look only at one vhost at a time or are they all mixed together? I try and use vhosts to keep things organized. It might get confusing put them all back into a single bucket.

A sort and search to find the queue I'm looking for would be very handy. :)

Looks like the beginnings of something very needed and very useful...

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/fbc28800/attachment.htm>

From jon at jbrisbin.com  Tue Sep  7 22:00:22 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 7 Sep 2010 16:00:22 -0500
Subject: [rabbitmq-discuss] couple of things on new admin interface
Message-ID: <9B8E1126-7A2B-4B89-9487-8C7DC5BA2E60@jbrisbin.com>

Just installed it on our Ubuntu Linux server using 2.0.0 from the RabbitMQ apt repo and it complained that "inets" was not installed. Installed erlang-inets from aptitude and it started right up. 

I like everything so far. I had a couple questions:

Is the list of queues pageable or will it display all of them at once? 

Can it be split up by vhost so I can look only at one vhost at a time or are they all mixed together? I try and use vhosts to keep things organized. It might get confusing put them all back into a single bucket.

A sort and search to find the queue I'm looking for would be very handy. :)

Looks like the beginnings of something very needed and very useful...

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/fbc28800/attachment-0001.htm>

From derek.p.moore at gmail.com  Wed Sep  8 02:56:57 2010
From: derek.p.moore at gmail.com (Derek Moore)
Date: Tue, 7 Sep 2010 20:56:57 -0500
Subject: [rabbitmq-discuss] rabbitutil.js - rabbitmqctl sibling in
 JavaScript w/ RabbitMQ Java & Mozi
In-Reply-To: <4C85FF49.7000601@rabbitmq.com>
References: <AANLkTimFDB_M_-XGiGzF3K8GDofKtGzhxUE=K=zPMNo2@mail.gmail.com>
	<90e6ba3fd45df18517048f64b832@google.com>
	<AANLkTinKxe+MaD2WNQ0TWWxRCBw9ApCEpKEihOFoqkUf@mail.gmail.com>
	<4C85FF49.7000601@rabbitmq.com>
Message-ID: <AANLkTinzF--FNZ7XDSi4hrKzpV41gnogmaEg25BK2_Ga@mail.gmail.com>

Of course I wouldn't expect this script to ship w/ RabbitMQ...  But it can
serve as ensample & encouragement!

I just meant I would help to see this functionality ship in whatever form it
must take.  (About the only language used around here that I don't know is
Erlang, hahaha...)

I see you're restructuring source control repos...  We are attempting
something very similar at work, you may have just solved our problems there,
too!  ;P

I will check out the new repos and see if I can help on the management
tools.

Thanks,

Derek


On Tue, Sep 7, 2010 at 4:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/09/10 21:05, Alexis Richardson wrote:
>
>> In terms of protocol support in the Java client: noted.  Also noted
>> are your comments about shipping this.  We can certainly link to it
>> from the Getting Started page - would that be a good start?  A reason
>> for my hesitation is that management is undergoing a General Rethink
>> (
>> http://downagain.com/blog/2010/09/06/wherein-our-hero-isnt-happy-with-work/
>> ).
>>
>
> Umm, are you sure that's the link you intended to post? ;)
>
>
>   The person who is leading this effort is Simon, cc'd.
>>
>> Simon - any thoughts?
>>
>
> I don't think we can ship this script per se. Adding a dependency on
> Javascript (and on Java for sysadmin work) seems a bit heavyweight to me.
>
> However: the management plugin will add support for a lot of this sort of
> thing. At the moment there's no command line client for it, but you could
> write a simple one with bash and curl, or in almost any language. A nice
> command line client is on my TODO list, albeit not near the top. Funnily
> enough I was having an argument yesterday about the value of such a thing ;)
>
> Also at the moment the management plugin won't let you publish or get
> messages. That's also on the TODO list in some form.
>
> I'm planning on making a preview release of the management plugin later
> today, at which point things may start to become clearer...
>
> Cheers, Simon
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100907/3943c0a2/attachment-0001.htm>

From romary.kremer at gmail.com  Wed Sep  8 10:33:03 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Wed, 8 Sep 2010 11:33:03 +0200
Subject: [rabbitmq-discuss] flow control issues
Message-ID: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>

We are performing evaluation on rabbitmq message broker, and we  
currently encounter difficulties to understand how does flow control  
work.

- Our application implies 10 000 peers producing messages periodically  
to a unique queue. This queue is listen asynchronously by another peer.
- All peer are written in Java, using amqp-client-1.8.1.
- The production rate of a single peer is 4 messages / hour
- We can simulate a time-consuming task in the consumer callback,  
simulating more or less fast consumer.
- we are using SSL certificate on the broker side to allow the peer to  
authenticate the broker.
	- we have noticed that the use of SSL as dramatic incidence on the  
memory occupied by Rabbitmq process

- we give us the possibility to add a second consumer to load-balance  
the consumption of messages
	- we are using prefetch windows of 1 message to enable credit-based  
flow control in this case

- we have settled several monitoring indicator on the broker side :
	- virtual memory occupied by rabbitmq process
	- cpu load
	- queue depth
	- disk occupation

- our test scenario is as follow:
	- during the 5 first hours, all peers join in the party (prods and  
cons)
	- after 5 hours, producers stop publishing messages
	- the test goes on for a configurable duration to allow the consumer  
to finish emptying the queue

during long running tests, we have encountered strange behaviour due  
to flow control :

The queue depth starts to increase linearly for about 2 hours, these  
is coherent since the message throughput of the single consumer
is not enough to absorb message ingress. Memory occupation grow faster  
as well, until the memory watermark is reached on the broker side.

 From that point, the producers are indeed paused, as flow control  
request has been issued by the broker, but the consumer seems to be  
blocked
as well. The queue level is flatten at its top value until the end of  
the test, even when memory occupation lowered under the threshold.

By registering the FlowListener callback, we have noticed that not all  
of the producers are notified all the time the alarm handler is set.
Does this mean that the broker applies some heuristic to try not to  
block every body every time ?
Or does it mean that some of the channels have been somehow  
blacklisted by the broker ?

Could anybody explain how the blocking of consumer is assumed to be  
implemented ?
Does the call of Channel.publish() is someHow blocking the connection  
Thread ?
How come that the consumer connection is also blocked ?
Does the implementation of FlowListener interface may help to handle  
flow control request ?
(I thought at first glance that the flow control should be implemented  
by hand using this interface,
but looking at this http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html 
  after all, it seems that it is not the case anyway)

Best regards,

Romary.

From majek04 at gmail.com  Wed Sep  8 10:45:44 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 8 Sep 2010 10:45:44 +0100
Subject: [rabbitmq-discuss] HA + Clustering in EC2 with Amazon Autoescale
In-Reply-To: <AANLkTi=HgiPS01fT1X2vCfqHBJGv3-zmCPFGxnLhikaC@mail.gmail.com>
References: <AANLkTi=HgiPS01fT1X2vCfqHBJGv3-zmCPFGxnLhikaC@mail.gmail.com>
Message-ID: <AANLkTimUU206S2WebNN9wEgron=+k4_H_bbmk+51iDSy@mail.gmail.com>

Jaime,

On Fri, Sep 3, 2010 at 11:22, Jaime Martinez <jaimemm at gmail.com> wrote:
> Here is the scenario:
> - More than 1 pair of Active + Passive RabbitMQ servers per EC2 instance,
> all of them in cluster.
> - Autoescale will start a new EC2 instances and has to add the new RabbitMQ
> HA servers to the same cluster as the previous instances
> It looks pretty tricky since to add server instances to a cluster is
> necessary to know their identifiers. Did anyone tried this? What would it be
> the right way of doing it?

Yes, in order to join RabbitMQ nodes into a cluster you need to know the shared
cookie and the addresses of all hosts in the cluster, as described here:
   http://www.rabbitmq.com/clustering.html

In my opinion clustering is not perfect. It helps scaling only for a set of use
cases. Basically, to exploit the benefits you need to really know what you're
doing. Generally, I wouldn't recommend it. Also, correctly configuring
clustering with HA is really tricky.

Saying that, I'd recommend just upgrading EC2 host if you need more capacity.
Store the persistent data on EBS and when you need more power - just
reattach EBS to a host with more CPU power. Sure, that's not zero-downtime,
but at least it's simple and manageable.

Cheers,
  Marek Majkowski

From alexandru at rabbitmq.com  Wed Sep  8 10:46:47 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 8 Sep 2010 10:46:47 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
Message-ID: <20100908094647.GB2851@dakota.eng.vmware.com>

Hi,

> Cool I'll try upgrading and see if that helps.

Any luck with 2.0.0?

Cheers,
Alex

On Mon, Sep 06, 2010 at 09:28:41AM +0100, Michael Burns wrote:
> >
> > When the slowdown occurs, does rabbit pick up speed a bit later?  Or do
> > you have to restart it or something else of the sort?
> >
> 
> Yes it will pick up speed after a bit without a server restart.
> 
> 
> >
> > When it occurs, does list_queues show a large number of messages?  If
> > so, you're probably not ack'ing the messages after consuming them.
> >
> 
> No. At the moment we're putting a very small number of messages through the
> system. When the delay occurs I'm usually seeing one or two messages on the
> queue. Eventually the messages will come through.
> Is there anything we could whilst the message is on the queue that would
> give more information as to why it is not being delivered?
> 
> 
> 
> 
> >
> > On an unrelated note, 2.0.0 is out, so you might want to upgrade.
> >
> 
> Cool I'll try upgrading and see if that helps.
> 
> Cheers,
> Michael
> 
> 
> >
> > Cheers,
> > Alex
> >
> > On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
> > > Hi Alex,
> > > I ran the multicast client and am getting speeds like:
> > >
> > > sending rate: 3550 msg/s, basic returns: 0 ret/s
> > > recving rate: 3461 msg/s, min/avg/max latency: 11931197/12253891/12477030
> > > microseconds
> > >
> > > If I let it run for a bit then sometimes both the sending and receiving
> > rate
> > > drop significantly e.g.:
> > >
> > > sending rate: 638 msg/s, basic returns: 0 ret/s
> > > recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
> > > microseconds
> > >
> > > Not sure if this drop is indicative of anything?
> > >
> > > We're using the java client 1.8.1, the broker is rabbitmq_server-1.8.1
> > >
> > > Thanks
> > > Michael
> > >
> > > On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
> > > <alexandru at rabbitmq.com>wrote:
> > >
> > > > Hi Michael,
> > > >
> > > > > We are putting a very low volume of messages through and have
> > sometimes
> > > > had
> > > > > to wait up to 15 minutes for a single message to be delivered (at the
> > > > time
> > > > > this was the only message in the system).
> > > >
> > > > That sounds strage.  Are you up for a bit of debugging?
> > > >
> > > > Download the java client,
> > > >  http://www.rabbitmq.com/java-client.html
> > > >
> > > > Unpack it, and run
> > > >  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
> > > >
> > > > That command will run one of our example programmes in a way that
> > > > matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
> > > >
> > > > When I run it, I get speeds like:
> > > >  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637
> > > > microseconds
> > > >  sending rate: 6419 msg/s, basic returns: 0 ret/s
> > > >
> > > > If you're getting similar speeds, there's probably something wrong with
> > > > the consumers/producers.  If not, it might be something to do with the
> > > > server.
> > > >
> > > > Could you please try it?
> > > >
> > > > Also, which version the broker and which client are you using?
> > > >
> > > > Cheers,
> > > > Alex
> > > >
> > > > On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> > > > > Hi,
> > > > >
> > > > > We're just starting out with RabbitMQ and have a very simple setup:
> > one
> > > > > queue, one producer doing a basicPublish and one consumer doing a
> > > > > basicConsume using QueueingConsumer.
> > > > >
> > > > > For the most part it works fine however at fairly regular intervals
> > we
> > > > are
> > > > > finding that messages remain on the queue for a considerable period
> > > > before
> > > > > being delivered to the consumer.
> > > > >
> > > > > We are putting a very low volume of messages through and have
> > sometimes
> > > > had
> > > > > to wait up to 15 minutes for a single message to be delivered (at the
> > > > time
> > > > > this was the only message in the system).
> > > > >
> > > > > In all cases the messages are eventually delivered.
> > > > >
> > > > > I dont know where to start debugging this as there is nothing in the
> > > > > RabbitMQ logs thats suggests something is going wrong - could anyone
> > > > point
> > > > > me in the right direction as to what may be causing this?
> > > > >
> > > > > Many Thanks,
> > > > > Michael
> > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > > >
> >

From jaimemm at gmail.com  Wed Sep  8 11:00:26 2010
From: jaimemm at gmail.com (Jaime Martinez)
Date: Wed, 8 Sep 2010 12:00:26 +0200
Subject: [rabbitmq-discuss] HA + Clustering in EC2 with Amazon Autoescale
In-Reply-To: <AANLkTimUU206S2WebNN9wEgron=+k4_H_bbmk+51iDSy@mail.gmail.com>
References: <AANLkTi=HgiPS01fT1X2vCfqHBJGv3-zmCPFGxnLhikaC@mail.gmail.com>
	<AANLkTimUU206S2WebNN9wEgron=+k4_H_bbmk+51iDSy@mail.gmail.com>
Message-ID: <AANLkTim-fE_wp5tHFWteWy8Gm-OGn4UGn6AwyyMT9eVe@mail.gmail.com>

Thanks for the reply.

We are just making a POC of how to use new Amazon's autoescale feature, so
we can add instances based on rules. Those instances must contain rabbitmq
servers in a cluster, all in the same cluster.
>From what I read, and what you're confirming, it looks like there's no
starightforward way of making it automatically.

Any ideas?

With regards

On Wed, Sep 8, 2010 at 11:45 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Jaime,
>
> On Fri, Sep 3, 2010 at 11:22, Jaime Martinez <jaimemm at gmail.com> wrote:
> > Here is the scenario:
> > - More than 1 pair of Active + Passive RabbitMQ servers per EC2 instance,
> > all of them in cluster.
> > - Autoescale will start a new EC2 instances and has to add the new
> RabbitMQ
> > HA servers to the same cluster as the previous instances
> > It looks pretty tricky since to add server instances to a cluster is
> > necessary to know their identifiers. Did anyone tried this? What would it
> be
> > the right way of doing it?
>
> Yes, in order to join RabbitMQ nodes into a cluster you need to know the
> shared
> cookie and the addresses of all hosts in the cluster, as described here:
>   http://www.rabbitmq.com/clustering.html
>
> In my opinion clustering is not perfect. It helps scaling only for a set of
> use
> cases. Basically, to exploit the benefits you need to really know what
> you're
> doing. Generally, I wouldn't recommend it. Also, correctly configuring
> clustering with HA is really tricky.
>
> Saying that, I'd recommend just upgrading EC2 host if you need more
> capacity.
> Store the persistent data on EBS and when you need more power - just
> reattach EBS to a host with more CPU power. Sure, that's not zero-downtime,
> but at least it's simple and manageable.
>
> Cheers,
>   Marek Majkowski
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/f9da3bc1/attachment.htm>

From simon at rabbitmq.com  Wed Sep  8 11:21:42 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Sep 2010 11:21:42 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <18126.83324.qm@web111013.mail.gq1.yahoo.com>
References: <4C861AFB.1010102@rabbitmq.com>	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>	<4C866A75.5090502@rabbitmq.com>	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>	<4C868AE7.2020801@rabbitmq.com>	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>	<4C869279.9070103@rabbitmq.com>
	<18126.83324.qm@web111013.mail.gq1.yahoo.com>
Message-ID: <4C8763B6.5070400@rabbitmq.com>

On 07/09/10 20:59, Dave Greggory wrote:
> Glad to see this out there. It's great to be able to finally see send/receive
> rates.
>
> Couple of questions.
>
> 1. Across what time frame are Send/receive rates calculated (ie rolling 5 minute
> intervals, etc)?

At the moment they're instantaneous. Yeah, I know that's lame. In the 
future they'll become moving averages of some sort. And there will be 
graphs :)

> 2. Where does this leave the Status plugin? Will that become discontinued or is
> that plugin's functionality complementary to this one? I'm asking because we
> have set up a lot of monitoring based on that plugin's output.

Ultimately I see the management plugin replacing the status plugin. 
However the status plugin is pretty simple and it's hardly taking any of 
our time to keep it working, so I imagine that state of affairs could 
persist for quite a while. I doubt it'll see any development though.

Having said that, if you're using the JSON page generated by the status 
plugin then the management plugin can provide the same stuff with a 
couple of queries, so you'll probably find porting quite easy if you 
want to do that.

> Feature requests:
> Forgive me if these are already there, I haven't installed it yet.
>
> 1. Rabbit MQ App Memory usage, Node Memory allocation, Queue Memory Use
 > 2. Queue stats

Those are all there.

> 3. Ability to clear queues (a la BQL's purge queue<queue-name>)

I hadn't thought of that. I'll add it to the list.

> 4. Importing / exporting broker state (a la BQL)

That seems to be a popular request. It's on the list too.

> 5. Ability to isolate plugin failures from taking down RabbitMQ - (ie run the
> plugin on a single RAM node in a cluster that no apps connect to, but from this
> node monitor the status of other nodes in the cluster)

At the moment the management plugin isn't very sensible in the context 
of clustering, but that will get fixed. I would hope the plugin should 
not be capable of taking down Rabbit though. If it ever does I most 
certainly want to hear about it!

> 6. Configurable permissions to lock down what can be done through the plugin

The short-term plan is to add a superuser bit to define whether users 
can manipulate non-AMQP objects (users / vhosts / permissions) at all. 
For AMQP objects the existing permission  system is used. Would this be 
adequate?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From romary.kremer at gmail.com  Wed Sep  8 11:49:14 2010
From: romary.kremer at gmail.com (Romary Kremer)
Date: Wed, 8 Sep 2010 12:49:14 +0200
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
Message-ID: <04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>

One more thing I forgot to mention :

- The previous situation have been encountered with rabbitMQ 1.8.1  
broker.

I've started playing a bit with the latest release 2.0.0 and I m  
affraid that it looks like their are some regression or at least some  
semantic updates.

I've just modified the provided MultiCast main sample of the java  
client library to add a FlowListener interface on both Producer and  
Consumer,
and registering the flow listener on their respective Channel.

It looks like any listener is called back  when the alarm handler is  
set or cleared, while the producers are still paused / resumed
like their are to be.

Does it mean some evolution in the flow control inner mechanism of the  
message broker or a regression on the Java client stack ?

Furthermore, what about the deployment of the client stack on the  
Maven repository ?

Le 8 sept. 10 ? 11:33, romary.kremer at gmail.com a ?crit :

> We are performing evaluation on rabbitmq message broker, and we  
> currently encounter difficulties to understand how does flow control  
> work.
>
> - Our application implies 10 000 peers producing messages  
> periodically to a unique queue. This queue is listen asynchronously  
> by another peer.
> - All peer are written in Java, using amqp-client-1.8.1.
> - The production rate of a single peer is 4 messages / hour
> - We can simulate a time-consuming task in the consumer callback,  
> simulating more or less fast consumer.
> - we are using SSL certificate on the broker side to allow the peer  
> to authenticate the broker.
> 	- we have noticed that the use of SSL as dramatic incidence on the  
> memory occupied by Rabbitmq process
>
> - we give us the possibility to add a second consumer to load- 
> balance the consumption of messages
> 	- we are using prefetch windows of 1 message to enable credit-based  
> flow control in this case
>
> - we have settled several monitoring indicator on the broker side :
> 	- virtual memory occupied by rabbitmq process
> 	- cpu load
> 	- queue depth
> 	- disk occupation
>
> - our test scenario is as follow:
> 	- during the 5 first hours, all peers join in the party (prods and  
> cons)
> 	- after 5 hours, producers stop publishing messages
> 	- the test goes on for a configurable duration to allow the  
> consumer to finish emptying the queue
>
> during long running tests, we have encountered strange behaviour due  
> to flow control :
>
> The queue depth starts to increase linearly for about 2 hours, these  
> is coherent since the message throughput of the single consumer
> is not enough to absorb message ingress. Memory occupation grow  
> faster as well, until the memory watermark is reached on the broker  
> side.
>
> From that point, the producers are indeed paused, as flow control  
> request has been issued by the broker, but the consumer seems to be  
> blocked
> as well. The queue level is flatten at its top value until the end  
> of the test, even when memory occupation lowered under the threshold.
>
> By registering the FlowListener callback, we have noticed that not  
> all of the producers are notified all the time the alarm handler is  
> set.
> Does this mean that the broker applies some heuristic to try not to  
> block every body every time ?
> Or does it mean that some of the channels have been somehow  
> blacklisted by the broker ?
>
> Could anybody explain how the blocking of consumer is assumed to be  
> implemented ?
> Does the call of Channel.publish() is someHow blocking the  
> connection Thread ?
> How come that the consumer connection is also blocked ?
> Does the implementation of FlowListener interface may help to handle  
> flow control request ?
> (I thought at first glance that the flow control should be  
> implemented by hand using this interface,
> but looking at this http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html 
>  after all, it seems that it is not the case anyway)
>
> Best regards,
>
> Romary.


From simon at rabbitmq.com  Wed Sep  8 13:42:21 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Sep 2010 13:42:21 +0100
Subject: [rabbitmq-discuss] couple of things on new admin interface
In-Reply-To: <9B8E1126-7A2B-4B89-9487-8C7DC5BA2E60@jbrisbin.com>
References: <9B8E1126-7A2B-4B89-9487-8C7DC5BA2E60@jbrisbin.com>
Message-ID: <4C8784AD.8090503@rabbitmq.com>

On 07/09/10 22:00, Jon Brisbin wrote:
> Just installed it on our Ubuntu Linux server using 2.0.0 from the
> RabbitMQ apt repo and it complained that "inets" was not installed.
> Installed erlang-inets from aptitude and it started right up.

That's interesting. I'll add it to the documentation somehow I guess. I 
wish those packages just included all of Erlang...

> I like everything so far. I had a couple questions:
>
> Is the list of queues pageable or will it display all of them at once?
>
> Can it be split up by vhost so I can look only at one vhost at a time or
> are they all mixed together? I try and use vhosts to keep things
> organized. It might get confusing put them all back into a single bucket.
>
> A sort and search to find the queue I'm looking for would be very handy. :)

All of these come under the heading of: not yet, but planned.

> Looks like the beginnings of something very needed and very useful...

Thanks!

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Wed Sep  8 14:13:08 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 8 Sep 2010 14:13:08 +0100
Subject: [rabbitmq-discuss] HA + Clustering in EC2 with Amazon Autoescale
In-Reply-To: <AANLkTim-fE_wp5tHFWteWy8Gm-OGn4UGn6AwyyMT9eVe@mail.gmail.com>
References: <AANLkTi=HgiPS01fT1X2vCfqHBJGv3-zmCPFGxnLhikaC@mail.gmail.com>
	<AANLkTimUU206S2WebNN9wEgron=+k4_H_bbmk+51iDSy@mail.gmail.com>
	<AANLkTim-fE_wp5tHFWteWy8Gm-OGn4UGn6AwyyMT9eVe@mail.gmail.com>
Message-ID: <AANLkTikXR1za3TCKpiQp54c+oyxJ3xnsm3kEVOc3VvZG@mail.gmail.com>

Well, in that case just hardcode some magical cookie, put it in
user-data EC2 script or something like that. Create a function
to read the host names of the hosts in a cluster and use that
to automate the setup.

Sounds like few dozen lines of shell, but should be possible.
I don't think anyone has done it yet..

Marek

On Wed, Sep 8, 2010 at 11:00, Jaime Martinez <jaimemm at gmail.com> wrote:
> We are just making a POC of how to use new Amazon's autoescale feature, so
> we can add instances based on rules. Those instances must contain rabbitmq
> servers in a cluster, all in the same cluster.
> From what I read, and what you're confirming, it looks like there's no
> starightforward way of making it automatically.
> Any ideas?
> With regards
>
> On Wed, Sep 8, 2010 at 11:45 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> Jaime,
>>
>> On Fri, Sep 3, 2010 at 11:22, Jaime Martinez <jaimemm at gmail.com> wrote:
>> > Here is the scenario:
>> > - More than 1 pair of Active + Passive RabbitMQ servers per EC2
>> > instance,
>> > all of them in cluster.
>> > - Autoescale will start a new EC2 instances and has to add the new
>> > RabbitMQ
>> > HA servers to the same cluster as the previous instances
>> > It looks pretty tricky since to add server instances to a cluster is
>> > necessary to know their identifiers. Did anyone tried this? What would
>> > it be
>> > the right way of doing it?
>>
>> Yes, in order to join RabbitMQ nodes into a cluster you need to know the
>> shared
>> cookie and the addresses of all hosts in the cluster, as described here:
>> ? http://www.rabbitmq.com/clustering.html
>>
>> In my opinion clustering is not perfect. It helps scaling only for a set
>> of use
>> cases. Basically, to exploit the benefits you need to really know what
>> you're
>> doing. Generally, I wouldn't recommend it. Also, correctly configuring
>> clustering with HA is really tricky.
>>
>> Saying that, I'd recommend just upgrading EC2 host if you need more
>> capacity.
>> Store the persistent data on EBS and when you need more power - just
>> reattach EBS to a host with more CPU power. Sure, that's not
>> zero-downtime,
>> but at least it's simple and manageable.
>>
>> Cheers,
>> ?Marek Majkowski
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From sunshinesucker at gmail.com  Wed Sep  8 16:30:01 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Wed, 8 Sep 2010 16:30:01 +0100
Subject: [rabbitmq-discuss] management plugin
Message-ID: <AANLkTi=kKUtCLeDCsqC-64pD1m55CDhQkbMxkQEtY_JQ@mail.gmail.com>

Hello,

I have noticed that there is a new management plugin for rabbit just
released.  I Downloaded the files and tried to install them on my rabbit
broker which is running on windows, however with no success.  Its seems to
activate the plugins when i run "rabbitmq-service.bat install" but when i
browse to http://*server-name*:55672/mgmt/ it get unable to connect error.

I tried running the rabbitmq-server.bat and get a dump file and the errror:

{"Kernal pid terminated",
application_controller,"{application_start_failure,
crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}


Anyone got any ideas what the problem is?
I am runing the latest release of rabbit broker.

thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/e78848e7/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 426473 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/e78848e7/attachment-0001.obj>

From davegreggory at yahoo.com  Wed Sep  8 16:36:30 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 8 Sep 2010 08:36:30 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
Message-ID: <142084.58889.qm@web111008.mail.gq1.yahoo.com>

We installed RMQ 2.0 yesterday in our QA environment and noticed that it had 
hung this morning.

Env Setup:
- RabbitMQ 2.0 on Erlang R13B04 on Centos VMWare VM
- 2 nodes clustered together with both nodes as disk nodes
- Load balancer in front of both nodes round robin directing connections to each 
node
- Status plugin
- Message producers/consumers: Tomcat webapps using Spring-AMQP 1.0 M1 and 
RabbitMQ client 1.8.1
- Very low message volume as this is a dev/QA environment, practically none 
overnight

Problem:
8-Sep-2010::09:30~    - We couldn't start our Tomcat webapps on our local dev 
machines this morning because they hung when attempting to connect to RabbitMQ
8-Sep-2010::09:40~    - Could not load Status Plugin webpage 
8-Sep-2010::09:40~    - rabbitmqctl status on node 1 indicated everything was ok
8-Sep-2010::09:40~    - rabbitmqctl list_queues hung on node 1
8-Sep-2010::09:45:38 - rabbitmqctl stop_app and start_app on node 1 didn't solve 
the problem
8-Sep-2010::09:53:03 - rabbitmqctl stop and rabbitmq-server -detached on node 1 
fixed the problem
No commands were run on node 2 - because the person troubleshooting didn't have 
access to that machine :) 


History:
Something similar had happened before on RabbitMQ 1.8.1 as well. It happens like 
once every 2 weeks in our QA environment (sometimes several times a day but then 
it goes fine for 2 weeks), never happened on production environment. We have 
both Status and BQL plugins installed on RMQ 1.8.1 in production, but only 
Status plugin on RMQ 2.0 that we're testing in QA. We can try disabling plugins 
but I don't think that's the right way to troubleshoot this because the problem 
happens very rarely, it might lead us to believe the problem was in a plugin 
when it actually was not.

Logs:
Attached logs from both nodes. 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
=INFO REPORT==== 8-Sep-2010::09:30:52 ===
accepted TCP connection on 0.0.0.0:5672 from LOADBALANCER_IP:38339

=INFO REPORT==== 8-Sep-2010::09:30:52 ===
starting TCP connection <0.12371.17> from LOADBALANCER_IP:38339

=WARNING REPORT==== 8-Sep-2010::09:30:52 ===
exception on TCP connection <0.12371.17> from LOADBALANCER_IP:38339
connection_closed_abruptly

=INFO REPORT==== 8-Sep-2010::09:30:52 ===
closing TCP connection <0.12371.17> from LOADBALANCER_IP:38339
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There's plenty of these in the logs, that's just our load balancer checking 
periodically (once every minute) to see whether RabbitMQ is alive by opening and 
closing a TCP connection. I've been told this is harmless -> 
http://old.nabble.com/connection-closed-abruptly-errors-on-logs-ts29248096.html#a29248096


But there are more interesting/suspicious entries in the both nodes logs around 
09:45:38 in node1 and 09:41:38/09:47:08 on node2.

I hope you can help me figure out the root cause of the problem.

Dave


      
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-node2.log
Type: application/octet-stream
Size: 29832 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/5cc34088/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-node1.log
Type: application/octet-stream
Size: 24374 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/5cc34088/attachment-0003.obj>

From simon at rabbitmq.com  Wed Sep  8 17:08:59 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Sep 2010 17:08:59 +0100
Subject: [rabbitmq-discuss] management plugin
In-Reply-To: <AANLkTi=kKUtCLeDCsqC-64pD1m55CDhQkbMxkQEtY_JQ@mail.gmail.com>
References: <AANLkTi=kKUtCLeDCsqC-64pD1m55CDhQkbMxkQEtY_JQ@mail.gmail.com>
Message-ID: <4C87B51B.5000104@rabbitmq.com>

On 08/09/10 16:30, sunghyun lee wrote:
> Hello,
>
> I have noticed that there is a new management plugin for rabbit just
> released.  I Downloaded the files and tried to install them on my rabbit
> broker which is running on windows, however with no success.  Its seems
> to activate the plugins when i run "rabbitmq-service.bat install" but
> when i browse to http:///server-name/:55672/mgmt/ it get unable to
> connect error.

Hmm, I just tried this on Windows 7 and it works for me. Did you restart 
the service after running "rabbitmq-service.bat install"?

> I tried running the rabbitmq-server.bat and get a dump file and the errror:
>
> {"Kernal pid terminated",
> application_controller,"{application_start_failure,
> crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}

That's odd. Unfortunately the dump file is not terribly useful - can you 
send your log and SASL log (typically in %%AppData%%\RabbitMQ\log on 
Windows) from a failed startup?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From sunshinesucker at gmail.com  Wed Sep  8 18:04:48 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Wed, 8 Sep 2010 18:04:48 +0100
Subject: [rabbitmq-discuss] FW:  management plugin
In-Reply-To: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
Message-ID: <AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>

I am running window 7 64bit.

I have attached the log however the saslog is empty. The service looks like
it starts but it doesnt...


On 8 September 2010 18:01, Sunghyun Lee <Sunghyun at altispartners.com> wrote:

>
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: 08 September 2010 17:09
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] management plugin
>
> On 08/09/10 16:30, sunghyun lee wrote:
> > Hello,
> >
> > I have noticed that there is a new management plugin for rabbit just
> > released. I Downloaded the files and tried to install them on my rabbit
> > broker which is running on windows, however with no success. Its seems
> > to activate the plugins when i run "rabbitmq-service.bat install" but
> > when i browse to http:///server-name/:55672/mgmt/ it get unable to
> > connect error.
>
> Hmm, I just tried this on Windows 7 and it works for me. Did you restart
> the service after running "rabbitmq-service.bat install"?
>
> > I tried running the rabbitmq-server.bat and get a dump file and the
> errror:
> >
> > {"Kernal pid terminated",
> > application_controller,"{application_start_failure,
> > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>
> That's odd. Unfortunately the dump file is not terribly useful - can you
> send your log and SASL log (typically in %%AppData%%\RabbitMQ\log on
> Windows) from a failed startup?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>  Sunghyun Lee | Senior Analyst Programmer
>  Altis Partners (Jersey)
> 2 Hill Street | St. Helier | Jersey, JE2 4UA
> t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w. www.altispartners.com
>
> Altis Partners (Jersey) Limited - registered with the Jersey Financial
> Services Commission, CFTC and a member of the NFA.
>
> This email and its contents is issued by Altis Partners Jersey Limited
> ('APJL') and is for private circulation only. APJL is registered with the
> Jersey Financial Services Commission of the States of Jersey for the conduct
> of investment business. The information contained in this email is strictly
> confidential. The information and opinions contained in this email are for
> background purposes only, and do not purport to be full or complete. Nor
> does this email constitute investment advice. APJL is not hereby arranging
> or agreeing to arrange any transaction in any investment or other
> undertaking requiring regulatory authorisation. This email does not
> constitute or form part of any offer to issue or sell, or any solicitation
> of an offer to subscribe or purchase, any investment nor shall it or the
> fact of its distribution form the basis of, or be relied on in connection
> with, any contract therefore. No representation, warranty, or undertaking,
> express or limited, is given as to the accuracy or completeness of the
> information or opinions contained in this email by any of APJL, its partners
> or employees and no liability is accepted by such persons for the accuracy
> or completeness of such information or opinions. As such, no reliance may be
> placed on the information and opinions in this email.
>
> This email may contain confidential and/or privileged information. If you
> are not the intended recipient or have received this email in error please
> notify the sender immediately and delete immediately. Any unauthorised
> copying, disclosure or distribution of this email is strictly forbidden
> Altis-Jersey Financial Services Commission-NFA
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/276fc36d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.log
Type: application/octet-stream
Size: 1037 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100908/276fc36d/attachment.obj>

From simon at rabbitmq.com  Wed Sep  8 18:07:29 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Sep 2010 18:07:29 +0100
Subject: [rabbitmq-discuss] FW:  management plugin
In-Reply-To: <AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
	<AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>
Message-ID: <4C87C2D1.9060009@rabbitmq.com>

That log has timestamps from 27th July in it - are you sure it's the 
right one?

Cheers, Simon

On 08/09/10 18:04, sunghyun lee wrote:
> I am running window 7 64bit.
>
> I have attached the log however the saslog is empty. The service looks
> like it starts but it doesnt...
>
>
> On 8 September 2010 18:01, Sunghyun Lee <Sunghyun at altispartners.com
> <mailto:Sunghyun at altispartners.com>> wrote:
>
>
>
>     -----Original Message-----
>     From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>     [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of
>     Simon MacMullen
>     Sent: 08 September 2010 17:09
>     To: rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     Subject: Re: [rabbitmq-discuss] management plugin
>
>     On 08/09/10 16:30, sunghyun lee wrote:
>      > Hello,
>      >
>      > I have noticed that there is a new management plugin for rabbit just
>      > released. I Downloaded the files and tried to install them on my
>     rabbit
>      > broker which is running on windows, however with no success. Its
>     seems
>      > to activate the plugins when i run "rabbitmq-service.bat install" but
>      > when i browse to http:///server-name/:55672/mgmt/ it get unable to
>      > connect error.
>
>     Hmm, I just tried this on Windows 7 and it works for me. Did you
>     restart
>     the service after running "rabbitmq-service.bat install"?
>
>      > I tried running the rabbitmq-server.bat and get a dump file and
>     the errror:
>      >
>      > {"Kernal pid terminated",
>      > application_controller,"{application_start_failure,
>      > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>
>     That's odd. Unfortunately the dump file is not terribly useful - can
>     you
>     send your log and SASL log (typically in %%AppData%%\RabbitMQ\log on
>     Windows) from a failed startup?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     Staff Engineer, RabbitMQ
>     SpringSource, a division of VMware
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>     Sunghyun Lee | Senior Analyst Programmer
>     Altis Partners (Jersey)
>     2 Hill Street | St. Helier | Jersey, JE2 4UA
>     t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w.
>     www.altispartners.com <http://www.altispartners.com>
>
>     Altis Partners (Jersey) Limited - registered with the Jersey
>     Financial Services Commission, CFTC and a member of the NFA.
>
>     This email and its contents is issued by Altis Partners Jersey
>     Limited ('APJL') and is for private circulation only. APJL is
>     registered with the Jersey Financial Services Commission of the
>     States of Jersey for the conduct of investment business. The
>     information contained in this email is strictly confidential. The
>     information and opinions contained in this email are for background
>     purposes only, and do not purport to be full or complete. Nor does
>     this email constitute investment advice. APJL is not hereby
>     arranging or agreeing to arrange any transaction in any investment
>     or other undertaking requiring regulatory authorisation. This email
>     does not constitute or form part of any offer to issue or sell, or
>     any solicitation of an offer to subscribe or purchase, any
>     investment nor shall it or the fact of its distribution form the
>     basis of, or be relied on in connection with, any contract
>     therefore. No representation, warranty, or undertaking, express or
>     limited, is given as to the accuracy or completeness of the
>     information or opinions contained in this email by any of APJL, its
>     partners or employees and no liability is accepted by such persons
>     for the accuracy or completeness of such information or opinions. As
>     such, no reliance may be placed on the information and opinions in
>     this email.
>
>     This email may contain confidential and/or privileged information.
>     If you are not the intended recipient or have received this email in
>     error please notify the sender immediately and delete immediately.
>     Any unauthorised copying, disclosure or distribution of this email
>     is strictly forbidden
>     Altis-Jersey Financial Services Commission-NFA
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From nicholas.silva at gmail.com  Wed Sep  8 19:40:45 2010
From: nicholas.silva at gmail.com (Nick)
Date: Wed, 8 Sep 2010 11:40:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Clean up stale connections without restarting?
Message-ID: <b384a3ba-8d8b-48ce-849f-3f365df7fa00@p12g2000prn.googlegroups.com>

Some of the clients connected to it quit uncleanly, and seem to have
caused RabbitMQ to leave the connection open.  When the client comes
back online, I now have two connections listed (via rabbitmqctl) to
that IP address but on different ports.  I'm worried that I'm losing
jobs to these zombie connections.  How can I clear them out without
restarting RabbitMQ entirely?

From davegreggory at yahoo.com  Wed Sep  8 21:20:23 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 8 Sep 2010 13:20:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <95349.23962.qm@web111006.mail.gq1.yahoo.com>

Anyone? 

Or is there any more info I can provide?



----- Original Message ----
From: Dave Greggory <davegreggory at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, September 8, 2010 11:36:30 AM
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging

We installed RMQ 2.0 yesterday in our QA environment and noticed that it had 
hung this morning.

Env Setup:
- RabbitMQ 2.0 on Erlang R13B04 on Centos VMWare VM
- 2 nodes clustered together with both nodes as disk nodes
- Load balancer in front of both nodes round robin directing connections to each 

node
- Status plugin
- Message producers/consumers: Tomcat webapps using Spring-AMQP 1.0 M1 and 
RabbitMQ client 1.8.1
- Very low message volume as this is a dev/QA environment, practically none 
overnight

Problem:
8-Sep-2010::09:30~    - We couldn't start our Tomcat webapps on our local dev 
machines this morning because they hung when attempting to connect to RabbitMQ
8-Sep-2010::09:40~    - Could not load Status Plugin webpage 
8-Sep-2010::09:40~    - rabbitmqctl status on node 1 indicated everything was ok
8-Sep-2010::09:40~    - rabbitmqctl list_queues hung on node 1
8-Sep-2010::09:45:38 - rabbitmqctl stop_app and start_app on node 1 didn't solve 

the problem
8-Sep-2010::09:53:03 - rabbitmqctl stop and rabbitmq-server -detached on node 1 
fixed the problem
No commands were run on node 2 - because the person troubleshooting didn't have 
access to that machine :) 


History:
Something similar had happened before on RabbitMQ 1.8.1 as well. It happens like 

once every 2 weeks in our QA environment (sometimes several times a day but then 

it goes fine for 2 weeks), never happened on production environment. We have 
both Status and BQL plugins installed on RMQ 1.8.1 in production, but only 
Status plugin on RMQ 2.0 that we're testing in QA. We can try disabling plugins 
but I don't think that's the right way to troubleshoot this because the problem 
happens very rarely, it might lead us to believe the problem was in a plugin 
when it actually was not.

Logs:
Attached logs from both nodes. 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
=INFO REPORT==== 8-Sep-2010::09:30:52 ===
accepted TCP connection on 0.0.0.0:5672 from LOADBALANCER_IP:38339

=INFO REPORT==== 8-Sep-2010::09:30:52 ===
starting TCP connection <0.12371.17> from LOADBALANCER_IP:38339

=WARNING REPORT==== 8-Sep-2010::09:30:52 ===
exception on TCP connection <0.12371.17> from LOADBALANCER_IP:38339
connection_closed_abruptly

=INFO REPORT==== 8-Sep-2010::09:30:52 ===
closing TCP connection <0.12371.17> from LOADBALANCER_IP:38339
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There's plenty of these in the logs, that's just our load balancer checking 
periodically (once every minute) to see whether RabbitMQ is alive by opening and 

closing a TCP connection. I've been told this is harmless -> 
http://old.nabble.com/connection-closed-abruptly-errors-on-logs-ts29248096.html#a29248096



But there are more interesting/suspicious entries in the both nodes logs around 
09:45:38 in node1 and 09:41:38/09:47:08 on node2.

I hope you can help me figure out the root cause of the problem.

Dave


      

From sunshinesucker at gmail.com  Thu Sep  9 10:18:00 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 9 Sep 2010 10:18:00 +0100
Subject: [rabbitmq-discuss] FW: management plugin
In-Reply-To: <4C87C442.9000008@rabbitmq.com>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
	<AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>
	<4C87C2D1.9060009@rabbitmq.com>
	<AANLkTim1x4qe=Uo6wXtiGdvYgy40rxuuhgViTbEuJoyW@mail.gmail.com>
	<4C87C442.9000008@rabbitmq.com>
Message-ID: <AANLkTimhpmdJZF0d1vPSQp2=FSTtMKeoYd70=GXo40ER@mail.gmail.com>

Simon,

I found the logs which I have attached and had a quick look.  It is
complaining that I did not have openssl on my system.  I have now installed
cygwin and installed the openssl runtime package, however I still get the
error.  Is there a path I need to set to tell the broker where to look?

thanks again for the help!


On 8 September 2010 18:13, Simon MacMullen <simon at rabbitmq.com> wrote:

> If you're running rabbitmq-server.bat the broker should tell you where the
> logs are going after the copyright message. Does it get that far? If not you
> might have to search for them I'm afraid.
>
> Cheers, Simon
>
>
> On 08/09/10 18:10, sunghyun lee wrote:
>
>> probably not, but thats the only one I can find in that directory.  Is
>> there anywhere else I should be looking?
>>
>>
>> On 8 September 2010 18:07, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    That log has timestamps from 27th July in it - are you sure it's the
>>    right one?
>>
>>    Cheers, Simon
>>
>>
>>    On 08/09/10 18:04, sunghyun lee wrote:
>>
>>        I am running window 7 64bit.
>>
>>        I have attached the log however the saslog is empty. The service
>>        looks
>>        like it starts but it doesnt...
>>
>>
>>        On 8 September 2010 18:01, Sunghyun Lee
>>        <Sunghyun at altispartners.com <mailto:Sunghyun at altispartners.com>
>>        <mailto:Sunghyun at altispartners.com
>>
>>        <mailto:Sunghyun at altispartners.com>>> wrote:
>>
>>
>>
>>            -----Original Message-----
>>            From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>>            [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>] On Behalf
>> Of
>>            Simon MacMullen
>>            Sent: 08 September 2010 17:09
>>            To: rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>            Subject: Re: [rabbitmq-discuss] management plugin
>>
>>            On 08/09/10 16:30, sunghyun lee wrote:
>>         > Hello,
>>         >
>>         > I have noticed that there is a new management plugin for
>>        rabbit just
>>         > released. I Downloaded the files and tried to install them on my
>>            rabbit
>>         > broker which is running on windows, however with no success. Its
>>            seems
>>         > to activate the plugins when i run "rabbitmq-service.bat
>>        install" but
>>         > when i browse to http:///server-name/:55672/mgmt/ it get
>>        unable to
>>         > connect error.
>>
>>            Hmm, I just tried this on Windows 7 and it works for me. Did
>> you
>>            restart
>>            the service after running "rabbitmq-service.bat install"?
>>
>>         > I tried running the rabbitmq-server.bat and get a dump file and
>>            the errror:
>>         >
>>         > {"Kernal pid terminated",
>>         > application_controller,"{application_start_failure,
>>         > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>>
>>            That's odd. Unfortunately the dump file is not terribly
>>        useful - can
>>            you
>>            send your log and SASL log (typically in
>>        %%AppData%%\RabbitMQ\log on
>>            Windows) from a failed startup?
>>
>>            Cheers, Simon
>>
>>            --
>>            Simon MacMullen
>>            Staff Engineer, RabbitMQ
>>            SpringSource, a division of VMware
>>
>>            _______________________________________________
>>            rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>            Sunghyun Lee | Senior Analyst Programmer
>>            Altis Partners (Jersey)
>>            2 Hill Street | St. Helier | Jersey, JE2 4UA
>>            t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w.
>>        www.altispartners.com <http://www.altispartners.com/>
>>        <http://www.altispartners.com <http://www.altispartners.com/>>
>>
>>
>>
>>            Altis Partners (Jersey) Limited - registered with the Jersey
>>            Financial Services Commission, CFTC and a member of the NFA.
>>
>>            This email and its contents is issued by Altis Partners Jersey
>>            Limited ('APJL') and is for private circulation only. APJL is
>>            registered with the Jersey Financial Services Commission of the
>>            States of Jersey for the conduct of investment business. The
>>            information contained in this email is strictly
>>        confidential. The
>>            information and opinions contained in this email are for
>>        background
>>            purposes only, and do not purport to be full or complete.
>>        Nor does
>>            this email constitute investment advice. APJL is not hereby
>>            arranging or agreeing to arrange any transaction in any
>>        investment
>>            or other undertaking requiring regulatory authorisation.
>>        This email
>>            does not constitute or form part of any offer to issue or
>>        sell, or
>>            any solicitation of an offer to subscribe or purchase, any
>>            investment nor shall it or the fact of its distribution form
>> the
>>            basis of, or be relied on in connection with, any contract
>>            therefore. No representation, warranty, or undertaking,
>>        express or
>>            limited, is given as to the accuracy or completeness of the
>>            information or opinions contained in this email by any of
>>        APJL, its
>>            partners or employees and no liability is accepted by such
>>        persons
>>            for the accuracy or completeness of such information or
>>        opinions. As
>>            such, no reliance may be placed on the information and
>>        opinions in
>>            this email.
>>
>>            This email may contain confidential and/or privileged
>>        information.
>>            If you are not the intended recipient or have received this
>>        email in
>>            error please notify the sender immediately and delete
>>        immediately.
>>            Any unauthorised copying, disclosure or distribution of this
>>        email
>>            is strictly forbidden
>>            Altis-Jersey Financial Services Commission-NFA
>>
>>
>>
>>
>>        _______________________________________________
>>        rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>    --
>>    Simon MacMullen
>>    Staff Engineer, RabbitMQ
>>    SpringSource, a division of VMware
>>
>>    _______________________________________________
>>    rabbitmq-discuss mailing list
>>    rabbitmq-discuss at lists.rabbitmq.com
>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/72c73d42/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE.log
Type: application/octet-stream
Size: 320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/72c73d42/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE-sasl.log
Type: application/octet-stream
Size: 804 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/72c73d42/attachment-0001.obj>

From simon at rabbitmq.com  Thu Sep  9 10:24:21 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Sep 2010 10:24:21 +0100
Subject: [rabbitmq-discuss] FW: management plugin
In-Reply-To: <AANLkTimhpmdJZF0d1vPSQp2=FSTtMKeoYd70=GXo40ER@mail.gmail.com>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>	<AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>	<4C87C2D1.9060009@rabbitmq.com>	<AANLkTim1x4qe=Uo6wXtiGdvYgy40rxuuhgViTbEuJoyW@mail.gmail.com>	<4C87C442.9000008@rabbitmq.com>
	<AANLkTimhpmdJZF0d1vPSQp2=FSTtMKeoYd70=GXo40ER@mail.gmail.com>
Message-ID: <4C88A7C5.3090909@rabbitmq.com>

Ah, cool. That makes things much clearer. I don't think the Cygwin 
OpenSSL is what you want though - Erlang doesn't know about Cygwin. This 
post:

http://www.trapexit.org/forum/viewtopic.php?p=48496

shows how to install the win32 OpenSSL.

I'm curious as to why I'm not seeing this though. Which version of 
Erlang do you have installed?

Cheers, Simon

On 09/09/10 10:18, sunghyun lee wrote:
>
> Simon,
>
> I found the logs which I have attached and had a quick look.  It is
> complaining that I did not have openssl on my system.  I have now
> installed cygwin and installed the openssl runtime package, however I
> still get the error.  Is there a path I need to set to tell the broker
> where to look?
>
> thanks again for the help!
>
>
> On 8 September 2010 18:13, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     If you're running rabbitmq-server.bat the broker should tell you
>     where the logs are going after the copyright message. Does it get
>     that far? If not you might have to search for them I'm afraid.
>
>     Cheers, Simon
>
>
>     On 08/09/10 18:10, sunghyun lee wrote:
>
>         probably not, but thats the only one I can find in that
>         directory.  Is
>         there anywhere else I should be looking?
>
>
>         On 8 September 2010 18:07, Simon MacMullen <simon at rabbitmq.com
>         <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>             That log has timestamps from 27th July in it - are you sure
>         it's the
>             right one?
>
>             Cheers, Simon
>
>
>             On 08/09/10 18:04, sunghyun lee wrote:
>
>                 I am running window 7 64bit.
>
>                 I have attached the log however the saslog is empty. The
>         service
>                 looks
>                 like it starts but it doesnt...
>
>
>                 On 8 September 2010 18:01, Sunghyun Lee
>         <Sunghyun at altispartners.com <mailto:Sunghyun at altispartners.com>
>         <mailto:Sunghyun at altispartners.com
>         <mailto:Sunghyun at altispartners.com>>
>         <mailto:Sunghyun at altispartners.com
>         <mailto:Sunghyun at altispartners.com>
>
>         <mailto:Sunghyun at altispartners.com
>         <mailto:Sunghyun at altispartners.com>>>> wrote:
>
>
>
>                     -----Original Message-----
>                     From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>
>                     [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>] On Behalf Of
>                     Simon MacMullen
>                     Sent: 08 September 2010 17:09
>                     To: rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>                     Subject: Re: [rabbitmq-discuss] management plugin
>
>                     On 08/09/10 16:30, sunghyun lee wrote:
>          > Hello,
>          >
>          > I have noticed that there is a new management plugin for
>                 rabbit just
>          > released. I Downloaded the files and tried to install them on my
>                     rabbit
>          > broker which is running on windows, however with no success. Its
>                     seems
>          > to activate the plugins when i run "rabbitmq-service.bat
>                 install" but
>          > when i browse to http:///server-name/:55672/mgmt/ it get
>                 unable to
>          > connect error.
>
>                     Hmm, I just tried this on Windows 7 and it works for
>         me. Did you
>                     restart
>                     the service after running "rabbitmq-service.bat
>         install"?
>
>          > I tried running the rabbitmq-server.bat and get a dump file and
>                     the errror:
>          >
>          > {"Kernal pid terminated",
>          > application_controller,"{application_start_failure,
>          > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>
>                     That's odd. Unfortunately the dump file is not terribly
>                 useful - can
>                     you
>                     send your log and SASL log (typically in
>                 %%AppData%%\RabbitMQ\log on
>                     Windows) from a failed startup?
>
>                     Cheers, Simon
>
>                     --
>                     Simon MacMullen
>                     Staff Engineer, RabbitMQ
>                     SpringSource, a division of VMware
>
>                     _______________________________________________
>                     rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>                     Sunghyun Lee | Senior Analyst Programmer
>                     Altis Partners (Jersey)
>                     2 Hill Street | St. Helier | Jersey, JE2 4UA
>                     t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w.
>         www.altispartners.com <http://www.altispartners.com>
>         <http://www.altispartners.com/>
>         <http://www.altispartners.com <http://www.altispartners.com/>>
>
>
>
>                     Altis Partners (Jersey) Limited - registered with
>         the Jersey
>                     Financial Services Commission, CFTC and a member of
>         the NFA.
>
>                     This email and its contents is issued by Altis
>         Partners Jersey
>                     Limited ('APJL') and is for private circulation
>         only. APJL is
>                     registered with the Jersey Financial Services
>         Commission of the
>                     States of Jersey for the conduct of investment
>         business. The
>                     information contained in this email is strictly
>                 confidential. The
>                     information and opinions contained in this email are for
>                 background
>                     purposes only, and do not purport to be full or
>         complete.
>                 Nor does
>                     this email constitute investment advice. APJL is not
>         hereby
>                     arranging or agreeing to arrange any transaction in any
>                 investment
>                     or other undertaking requiring regulatory authorisation.
>                 This email
>                     does not constitute or form part of any offer to
>         issue or
>                 sell, or
>                     any solicitation of an offer to subscribe or
>         purchase, any
>                     investment nor shall it or the fact of its
>         distribution form the
>                     basis of, or be relied on in connection with, any
>         contract
>                     therefore. No representation, warranty, or undertaking,
>                 express or
>                     limited, is given as to the accuracy or completeness
>         of the
>                     information or opinions contained in this email by
>         any of
>                 APJL, its
>                     partners or employees and no liability is accepted
>         by such
>                 persons
>                     for the accuracy or completeness of such information or
>                 opinions. As
>                     such, no reliance may be placed on the information and
>                 opinions in
>                     this email.
>
>                     This email may contain confidential and/or privileged
>                 information.
>                     If you are not the intended recipient or have
>         received this
>                 email in
>                     error please notify the sender immediately and delete
>                 immediately.
>                     Any unauthorised copying, disclosure or distribution
>         of this
>                 email
>                     is strictly forbidden
>                     Altis-Jersey Financial Services Commission-NFA
>
>
>
>
>                 _______________________________________________
>                 rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>             --
>             Simon MacMullen
>             Staff Engineer, RabbitMQ
>             SpringSource, a division of VMware
>
>             _______________________________________________
>             rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>     --
>     Simon MacMullen
>     Staff Engineer, RabbitMQ
>     SpringSource, a division of VMware
>
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From sunshinesucker at gmail.com  Thu Sep  9 11:03:24 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 9 Sep 2010 11:03:24 +0100
Subject: [rabbitmq-discuss] FW: management plugin
In-Reply-To: <4C88A7C5.3090909@rabbitmq.com>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
	<AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>
	<4C87C2D1.9060009@rabbitmq.com>
	<AANLkTim1x4qe=Uo6wXtiGdvYgy40rxuuhgViTbEuJoyW@mail.gmail.com>
	<4C87C442.9000008@rabbitmq.com>
	<AANLkTimhpmdJZF0d1vPSQp2=FSTtMKeoYd70=GXo40ER@mail.gmail.com>
	<4C88A7C5.3090909@rabbitmq.com>
Message-ID: <AANLkTik=upMN02xN7ewPsCa4v88XfL_ewwWMwtKnGHWF@mail.gmail.com>

 I have version 5.7.4 of erlang installed.  That seems to have fixed the
issue, thanks for all your help!



On 9 September 2010 10:24, Simon MacMullen <simon at rabbitmq.com> wrote:

> Ah, cool. That makes things much clearer. I don't think the Cygwin OpenSSL
> is what you want though - Erlang doesn't know about Cygwin. This post:
>
> http://www.trapexit.org/forum/viewtopic.php?p=48496
>
> shows how to install the win32 OpenSSL.
>
> I'm curious as to why I'm not seeing this though. Which version of Erlang
> do you have installed?
>
> Cheers, Simon
>
>
> On 09/09/10 10:18, sunghyun lee wrote:
>
>>
>> Simon,
>>
>> I found the logs which I have attached and had a quick look.  It is
>> complaining that I did not have openssl on my system.  I have now
>> installed cygwin and installed the openssl runtime package, however I
>> still get the error.  Is there a path I need to set to tell the broker
>> where to look?
>>
>> thanks again for the help!
>>
>>
>> On 8 September 2010 18:13, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    If you're running rabbitmq-server.bat the broker should tell you
>>    where the logs are going after the copyright message. Does it get
>>    that far? If not you might have to search for them I'm afraid.
>>
>>    Cheers, Simon
>>
>>
>>    On 08/09/10 18:10, sunghyun lee wrote:
>>
>>        probably not, but thats the only one I can find in that
>>        directory.  Is
>>        there anywhere else I should be looking?
>>
>>
>>        On 8 September 2010 18:07, Simon MacMullen <simon at rabbitmq.com
>>        <mailto:simon at rabbitmq.com>
>>        <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>            That log has timestamps from 27th July in it - are you sure
>>        it's the
>>            right one?
>>
>>            Cheers, Simon
>>
>>
>>            On 08/09/10 18:04, sunghyun lee wrote:
>>
>>                I am running window 7 64bit.
>>
>>                I have attached the log however the saslog is empty. The
>>        service
>>                looks
>>                like it starts but it doesnt...
>>
>>
>>                On 8 September 2010 18:01, Sunghyun Lee
>>        <Sunghyun at altispartners.com <mailto:Sunghyun at altispartners.com>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>
>>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>>>> wrote:
>>
>>
>>
>>                    -----Original Message-----
>>                    From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>
>>                    [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>] On Behalf
>> Of
>>                    Simon MacMullen
>>                    Sent: 08 September 2010 17:09
>>                    To: rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>>                    Subject: Re: [rabbitmq-discuss] management plugin
>>
>>                    On 08/09/10 16:30, sunghyun lee wrote:
>>         > Hello,
>>         >
>>         > I have noticed that there is a new management plugin for
>>                rabbit just
>>         > released. I Downloaded the files and tried to install them on my
>>                    rabbit
>>         > broker which is running on windows, however with no success. Its
>>                    seems
>>         > to activate the plugins when i run "rabbitmq-service.bat
>>                install" but
>>         > when i browse to http:///server-name/:55672/mgmt/ it get
>>                unable to
>>         > connect error.
>>
>>                    Hmm, I just tried this on Windows 7 and it works for
>>        me. Did you
>>                    restart
>>                    the service after running "rabbitmq-service.bat
>>        install"?
>>
>>         > I tried running the rabbitmq-server.bat and get a dump file and
>>                    the errror:
>>         >
>>         > {"Kernal pid terminated",
>>         > application_controller,"{application_start_failure,
>>         > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>>
>>                    That's odd. Unfortunately the dump file is not terribly
>>                useful - can
>>                    you
>>                    send your log and SASL log (typically in
>>                %%AppData%%\RabbitMQ\log on
>>                    Windows) from a failed startup?
>>
>>                    Cheers, Simon
>>
>>                    --
>>                    Simon MacMullen
>>                    Staff Engineer, RabbitMQ
>>                    SpringSource, a division of VMware
>>
>>                    _______________________________________________
>>                    rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>                    Sunghyun Lee | Senior Analyst Programmer
>>                    Altis Partners (Jersey)
>>                    2 Hill Street | St. Helier | Jersey, JE2 4UA
>>                    t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w.
>>        www.altispartners.com <http://www.altispartners.com>
>>        <http://www.altispartners.com/>
>>        <http://www.altispartners.com <http://www.altispartners.com/>>
>>
>>
>>
>>                    Altis Partners (Jersey) Limited - registered with
>>        the Jersey
>>                    Financial Services Commission, CFTC and a member of
>>        the NFA.
>>
>>                    This email and its contents is issued by Altis
>>        Partners Jersey
>>                    Limited ('APJL') and is for private circulation
>>        only. APJL is
>>                    registered with the Jersey Financial Services
>>        Commission of the
>>                    States of Jersey for the conduct of investment
>>        business. The
>>                    information contained in this email is strictly
>>                confidential. The
>>                    information and opinions contained in this email are
>> for
>>                background
>>                    purposes only, and do not purport to be full or
>>        complete.
>>                Nor does
>>                    this email constitute investment advice. APJL is not
>>        hereby
>>                    arranging or agreeing to arrange any transaction in any
>>                investment
>>                    or other undertaking requiring regulatory
>> authorisation.
>>                This email
>>                    does not constitute or form part of any offer to
>>        issue or
>>                sell, or
>>                    any solicitation of an offer to subscribe or
>>        purchase, any
>>                    investment nor shall it or the fact of its
>>        distribution form the
>>                    basis of, or be relied on in connection with, any
>>        contract
>>                    therefore. No representation, warranty, or undertaking,
>>                express or
>>                    limited, is given as to the accuracy or completeness
>>        of the
>>                    information or opinions contained in this email by
>>        any of
>>                APJL, its
>>                    partners or employees and no liability is accepted
>>        by such
>>                persons
>>                    for the accuracy or completeness of such information or
>>                opinions. As
>>                    such, no reliance may be placed on the information and
>>                opinions in
>>                    this email.
>>
>>                    This email may contain confidential and/or privileged
>>                information.
>>                    If you are not the intended recipient or have
>>        received this
>>                email in
>>                    error please notify the sender immediately and delete
>>                immediately.
>>                    Any unauthorised copying, disclosure or distribution
>>        of this
>>                email
>>                    is strictly forbidden
>>                    Altis-Jersey Financial Services Commission-NFA
>>
>>
>>
>>
>>                _______________________________________________
>>                rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>            --
>>            Simon MacMullen
>>            Staff Engineer, RabbitMQ
>>            SpringSource, a division of VMware
>>
>>            _______________________________________________
>>            rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>    --
>>    Simon MacMullen
>>    Staff Engineer, RabbitMQ
>>    SpringSource, a division of VMware
>>
>>
>>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/89593dc0/attachment-0001.htm>

From sunshinesucker at gmail.com  Thu Sep  9 11:03:24 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 9 Sep 2010 11:03:24 +0100
Subject: [rabbitmq-discuss] FW: management plugin
In-Reply-To: <4C88A7C5.3090909@rabbitmq.com>
References: <341ABE7319A5F14296A322844570DDF70599BD9A51@JYEXC1.ALTISPARTNERS.local>
	<AANLkTind9ABPs2qDTzog0U92t8Q_FPej7bmfvsXx=iU+@mail.gmail.com>
	<4C87C2D1.9060009@rabbitmq.com>
	<AANLkTim1x4qe=Uo6wXtiGdvYgy40rxuuhgViTbEuJoyW@mail.gmail.com>
	<4C87C442.9000008@rabbitmq.com>
	<AANLkTimhpmdJZF0d1vPSQp2=FSTtMKeoYd70=GXo40ER@mail.gmail.com>
	<4C88A7C5.3090909@rabbitmq.com>
Message-ID: <AANLkTik=upMN02xN7ewPsCa4v88XfL_ewwWMwtKnGHWF@mail.gmail.com>

 I have version 5.7.4 of erlang installed.  That seems to have fixed the
issue, thanks for all your help!



On 9 September 2010 10:24, Simon MacMullen <simon at rabbitmq.com> wrote:

> Ah, cool. That makes things much clearer. I don't think the Cygwin OpenSSL
> is what you want though - Erlang doesn't know about Cygwin. This post:
>
> http://www.trapexit.org/forum/viewtopic.php?p=48496
>
> shows how to install the win32 OpenSSL.
>
> I'm curious as to why I'm not seeing this though. Which version of Erlang
> do you have installed?
>
> Cheers, Simon
>
>
> On 09/09/10 10:18, sunghyun lee wrote:
>
>>
>> Simon,
>>
>> I found the logs which I have attached and had a quick look.  It is
>> complaining that I did not have openssl on my system.  I have now
>> installed cygwin and installed the openssl runtime package, however I
>> still get the error.  Is there a path I need to set to tell the broker
>> where to look?
>>
>> thanks again for the help!
>>
>>
>> On 8 September 2010 18:13, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    If you're running rabbitmq-server.bat the broker should tell you
>>    where the logs are going after the copyright message. Does it get
>>    that far? If not you might have to search for them I'm afraid.
>>
>>    Cheers, Simon
>>
>>
>>    On 08/09/10 18:10, sunghyun lee wrote:
>>
>>        probably not, but thats the only one I can find in that
>>        directory.  Is
>>        there anywhere else I should be looking?
>>
>>
>>        On 8 September 2010 18:07, Simon MacMullen <simon at rabbitmq.com
>>        <mailto:simon at rabbitmq.com>
>>        <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>            That log has timestamps from 27th July in it - are you sure
>>        it's the
>>            right one?
>>
>>            Cheers, Simon
>>
>>
>>            On 08/09/10 18:04, sunghyun lee wrote:
>>
>>                I am running window 7 64bit.
>>
>>                I have attached the log however the saslog is empty. The
>>        service
>>                looks
>>                like it starts but it doesnt...
>>
>>
>>                On 8 September 2010 18:01, Sunghyun Lee
>>        <Sunghyun at altispartners.com <mailto:Sunghyun at altispartners.com>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>
>>
>>        <mailto:Sunghyun at altispartners.com
>>        <mailto:Sunghyun at altispartners.com>>>> wrote:
>>
>>
>>
>>                    -----Original Message-----
>>                    From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>
>>                    [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>>>] On Behalf
>> Of
>>                    Simon MacMullen
>>                    Sent: 08 September 2010 17:09
>>                    To: rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>>                    Subject: Re: [rabbitmq-discuss] management plugin
>>
>>                    On 08/09/10 16:30, sunghyun lee wrote:
>>         > Hello,
>>         >
>>         > I have noticed that there is a new management plugin for
>>                rabbit just
>>         > released. I Downloaded the files and tried to install them on my
>>                    rabbit
>>         > broker which is running on windows, however with no success. Its
>>                    seems
>>         > to activate the plugins when i run "rabbitmq-service.bat
>>                install" but
>>         > when i browse to http:///server-name/:55672/mgmt/ it get
>>                unable to
>>         > connect error.
>>
>>                    Hmm, I just tried this on Windows 7 and it works for
>>        me. Did you
>>                    restart
>>                    the service after running "rabbitmq-service.bat
>>        install"?
>>
>>         > I tried running the rabbitmq-server.bat and get a dump file and
>>                    the errror:
>>         >
>>         > {"Kernal pid terminated",
>>         > application_controller,"{application_start_failure,
>>         > crypto,{shutdown,{crypto_app, start, [normal,[]]}}}"}
>>
>>                    That's odd. Unfortunately the dump file is not terribly
>>                useful - can
>>                    you
>>                    send your log and SASL log (typically in
>>                %%AppData%%\RabbitMQ\log on
>>                    Windows) from a failed startup?
>>
>>                    Cheers, Simon
>>
>>                    --
>>                    Simon MacMullen
>>                    Staff Engineer, RabbitMQ
>>                    SpringSource, a division of VMware
>>
>>                    _______________________________________________
>>                    rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>>
>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>                    Sunghyun Lee | Senior Analyst Programmer
>>                    Altis Partners (Jersey)
>>                    2 Hill Street | St. Helier | Jersey, JE2 4UA
>>                    t. +44 (0)1534 787 742 | f. +44 (0)870 460 1980 | w.
>>        www.altispartners.com <http://www.altispartners.com>
>>        <http://www.altispartners.com/>
>>        <http://www.altispartners.com <http://www.altispartners.com/>>
>>
>>
>>
>>                    Altis Partners (Jersey) Limited - registered with
>>        the Jersey
>>                    Financial Services Commission, CFTC and a member of
>>        the NFA.
>>
>>                    This email and its contents is issued by Altis
>>        Partners Jersey
>>                    Limited ('APJL') and is for private circulation
>>        only. APJL is
>>                    registered with the Jersey Financial Services
>>        Commission of the
>>                    States of Jersey for the conduct of investment
>>        business. The
>>                    information contained in this email is strictly
>>                confidential. The
>>                    information and opinions contained in this email are
>> for
>>                background
>>                    purposes only, and do not purport to be full or
>>        complete.
>>                Nor does
>>                    this email constitute investment advice. APJL is not
>>        hereby
>>                    arranging or agreeing to arrange any transaction in any
>>                investment
>>                    or other undertaking requiring regulatory
>> authorisation.
>>                This email
>>                    does not constitute or form part of any offer to
>>        issue or
>>                sell, or
>>                    any solicitation of an offer to subscribe or
>>        purchase, any
>>                    investment nor shall it or the fact of its
>>        distribution form the
>>                    basis of, or be relied on in connection with, any
>>        contract
>>                    therefore. No representation, warranty, or undertaking,
>>                express or
>>                    limited, is given as to the accuracy or completeness
>>        of the
>>                    information or opinions contained in this email by
>>        any of
>>                APJL, its
>>                    partners or employees and no liability is accepted
>>        by such
>>                persons
>>                    for the accuracy or completeness of such information or
>>                opinions. As
>>                    such, no reliance may be placed on the information and
>>                opinions in
>>                    this email.
>>
>>                    This email may contain confidential and/or privileged
>>                information.
>>                    If you are not the intended recipient or have
>>        received this
>>                email in
>>                    error please notify the sender immediately and delete
>>                immediately.
>>                    Any unauthorised copying, disclosure or distribution
>>        of this
>>                email
>>                    is strictly forbidden
>>                    Altis-Jersey Financial Services Commission-NFA
>>
>>
>>
>>
>>                _______________________________________________
>>                rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>            --
>>            Simon MacMullen
>>            Staff Engineer, RabbitMQ
>>            SpringSource, a division of VMware
>>
>>            _______________________________________________
>>            rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>    --
>>    Simon MacMullen
>>    Staff Engineer, RabbitMQ
>>    SpringSource, a division of VMware
>>
>>
>>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/89593dc0/attachment-0003.htm>

From david at rabbitmq.com  Thu Sep  9 11:56:05 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 09 Sep 2010 11:56:05 +0100
Subject: [rabbitmq-discuss] Any pre-tx_commit validation possible on a
	channel?
In-Reply-To: <cbaa67e1-5b3d-450e-a6fe-a0dc147cbc56@j18g2000yqd.googlegroups.com>
	(Paul McGuire's message of "Tue, 7 Sep 2010 10:27:40 -0700 (PDT)")
References: <cbaa67e1-5b3d-450e-a6fe-a0dc147cbc56@j18g2000yqd.googlegroups.com>
Message-ID: <yrv4cbp87w5h6.fsf@dwragg.eng.vmware.com>

Hi Paul,

Paul McGuire <ptmcg at austin.rr.com> writes:
> I realize that a 100% airtight solution is not possible, but is there
> any way before calling tx_commit to anticipate at least some simple
> failures in sending messages that have been buffered up in a
> transaction?  I am trying to merge AMQP messaging with XA two-phase
> commit.
>
> In XA, I can send the messages (by calling tx_commit) at voting time,
> which would rollback any db changes if the message send fails (at XA
> voting time, any failure causes all other participants to rollback).
> But if I send messages at voting time, consumers of the message see a
> pre-commit view of the database, which is not really what I want.
>
> If I send the message/call tx_commit at XA finish time, then consumers
> will see the post-commit database view, but a failed message send will
> not rollback the database.  (I do still get the benefit of database
> failures causing the message transaction to abort with this approach.)
>
> Is there any channel or message-publishing validation I can do at XA
> voting time that might anticipate a message publishing failure?

No, I'm afraid there is no way to do this.

AMQP (0-9-1) transactions in general are not intended to support
distributed transactions (there is the whole issue of transactions being
scoped to channels, the lack of support for transaction identifiers,
etc.)

It's also questionable whether it's a good idea to combine messaging and
distributed transactions (a significant use of messaging is exactly to
avoid the need for distributed transactions and the problems of
two-phase commit, by providing a robust means for systems to be loosely
coupled).

If you have to integrate AMQP and systems using XA, then I would suggest
using a database to mediate between the messaging system and the
distributed transactions, with some adapters to tie the things together.
For example, on the consuming side, an adapter would convert an incoming
message into a record in the database, commit this in a local
transaction, and ack the message; it would then initiate the distributed
transaction, involving the database but not the messaging system, to act
on that record.  The producing side is similar, though you might need to
use triggers of some kind to avoid polling.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From sunshinesucker at gmail.com  Thu Sep  9 13:06:14 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Thu, 9 Sep 2010 13:06:14 +0100
Subject: [rabbitmq-discuss] Webhooks plugin
Message-ID: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>

Hello,

I am currently working on testing the webhook plugin which was recently
released and am having a few problems.  The plugin seems to install ok and
created the exchange, queues and bindings I expect, however when I publish a
message (byte[] with one byte which is an integer) the broker crashes with
the "kernel pid terminated".  Attached are the logs.

Is there an example app somewhere I can look at? This plugin would solve a
lot of issues which IIS is causing so I am open to look at anything whihc
might help.

thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/79803f54/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE.log
Type: application/octet-stream
Size: 8707 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/79803f54/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE-sasl.log
Type: application/octet-stream
Size: 10795 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/79803f54/attachment-0003.obj>

From machado at zlw-ima.rwth-aachen.de  Thu Sep  9 14:02:00 2010
From: machado at zlw-ima.rwth-aachen.de (Paulo Machado)
Date: Thu, 09 Sep 2010 15:02:00 +0200
Subject: [rabbitmq-discuss] Help with shovel plug-in
Message-ID: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>

  Hi everyone,

sorry to bother with a total newbie doubts, but that's what I am, 
concerning rabbitmq/EMS. I've looked to the mailing list archive and 
couldn't find no help, so here I am.
So, to the point, I need to configure two brokers one of them shoveling 
messages to the other, but I can manage to make it work. The current 
setup is (on both brokers):
- erlang R13B04
- rabbitmq sources up to date (repo clone)
- shovel plug-in up to date (repo clone)
The rabbitmq works out of the box (after compiling...), but not when I 
try to use shoveling. I used the README file in the shovel plugin repo 
as guide, and I'm using the java-rabbitmq-client examples to test it. 
And when I call the producer with explicit destination (i.e. IP or 
hostname) it works, so I can conclude is not a network issue. Also, when 
I start the brokers it show the shovel_plugin as an active plug-in. So 
my questions are:
- do I need to install any other plugin?
- how can I debug/log the broker activity?
- do I need make any special configuration to the rabbitmq or just 
configure the shovel-plugin? (on both brokers?)

Attached the config file used in the shoveling broker.
Right now I need to setup a working test environment, so there's no need 
to refined configuration, just one that works!

thanks for your time,

-- 
Paulo S. Machado
Zentrum f?r Lern- und Wissensmanagement und
Lehrstuhl Informationsmanagement im Maschinenbau
(ZLW/IMA) der RWTH Aachen

Center for Learning and Knowledge Management and
Department of Information Management in Mechanical Engineering

Dennewartstr. 27, D-52068 Aachen
Telefon: +49 241 80-911-96
Fax    : +49 241 80-911-22
E-Mail :machado at zlw-ima.rwth-aachen.de
Internet:http://www.zlw-ima.rwth-aachen.de

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbitmq.config
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/9d2b2fed/attachment.txt>

From matthew at rabbitmq.com  Thu Sep  9 14:15:24 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 9 Sep 2010 14:15:24 +0100
Subject: [rabbitmq-discuss] Help with shovel plug-in
In-Reply-To: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
References: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
Message-ID: <20100909131524.GJ3950@rabbitmq.com>

Hi Paulo,

On Thu, Sep 09, 2010 at 03:02:00PM +0200, Paulo Machado wrote:
> So, to the point, I need to configure two brokers one of them
> shoveling messages to the other, but I can manage to make it work.
> The current setup is (on both brokers):
> - erlang R13B04
> - rabbitmq sources up to date (repo clone)
> - shovel plug-in up to date (repo clone)

The most likely issue is that you're running the latest default on the
broker and the erlang client. They currently don't work together owing
to a major change, the mirror image of which, for the client, is taking
a while to get through QA.

Your best bet is to:

(cd rabbitmq-server && hg up -C rabbitmq_v2_0_0 && make clean && make -j)
(cd rabbitmq-erlang-client && hg up -C rabbitmq_v2_0_0 && make clean && make -j)
(cd rabbitmq-shovel && make clean && make)

You should then find that the shovel works in the broker.

If not, I suspect the log files will tell us the most - if you still
can't get it to work, there may be information in the logs that
indicated why.

Matthew

From vlad at rabbitmq.com  Thu Sep  9 14:16:24 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 09 Sep 2010 14:16:24 +0100
Subject: [rabbitmq-discuss] Help with shovel plug-in
In-Reply-To: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
References: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
Message-ID: <4C88DE28.2070305@rabbitmq.com>


Hi,


The shovel uses the Erlang client, which is currently broken with the 
latest version of the server.
Try using the rabbitmq_v2_0_0 version:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella
make checkout
hg update -r rabbitmq_v2_0_0 -R rabbitmq-server
hg update -r rabbitmq_v2_0_0 -R rabbitmq-codegen
hg update -r rabbitmq_v2_0_0 -R rabbitmq-erlang-client
make -C rabbitmq-erlang-client
cd rabbitmq-shovel
make


That should build you the rabbitmq-shovel plugin correctly, which you 
can use.

Let us know if that doesn't work either.


Rgds,
Vlad.




On 09/09/2010 02:02 PM, Paulo Machado wrote:
>  Hi everyone,
>
> sorry to bother with a total newbie doubts, but that's what I am, 
> concerning rabbitmq/EMS. I've looked to the mailing list archive and 
> couldn't find no help, so here I am.
> So, to the point, I need to configure two brokers one of them 
> shoveling messages to the other, but I can manage to make it work. The 
> current setup is (on both brokers):
> - erlang R13B04
> - rabbitmq sources up to date (repo clone)
> - shovel plug-in up to date (repo clone)
> The rabbitmq works out of the box (after compiling...), but not when I 
> try to use shoveling. I used the README file in the shovel plugin repo 
> as guide, and I'm using the java-rabbitmq-client examples to test it. 
> And when I call the producer with explicit destination (i.e. IP or 
> hostname) it works, so I can conclude is not a network issue. Also, 
> when I start the brokers it show the shovel_plugin as an active 
> plug-in. So my questions are:
> - do I need to install any other plugin?
> - how can I debug/log the broker activity?
> - do I need make any special configuration to the rabbitmq or just 
> configure the shovel-plugin? (on both brokers?)
>
> Attached the config file used in the shoveling broker.
> Right now I need to setup a working test environment, so there's no 
> need to refined configuration, just one that works!
>
> thanks for your time,
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/f66495a9/attachment.htm>

From simon at rabbitmq.com  Thu Sep  9 14:20:30 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Sep 2010 14:20:30 +0100
Subject: [rabbitmq-discuss] Help with shovel plug-in
In-Reply-To: <4C88DE28.2070305@rabbitmq.com>
References: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
	<4C88DE28.2070305@rabbitmq.com>
Message-ID: <4C88DF1E.2080306@rabbitmq.com>

On 09/09/10 14:16, Vlad Alexandru Ionescu wrote:
> Try using the rabbitmq_v2_0_0 version:

Of course, if you intend to use version 2.0.0 you can use a binary 
server release:

https://www.rabbitmq.com/server.html

with a binary shovel release:

https://www.rabbitmq.com/plugins.html

...which may be easier.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthias at rabbitmq.com  Thu Sep  9 14:24:03 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Sep 2010 14:24:03 +0100
Subject: [rabbitmq-discuss] Help with shovel plug-in
In-Reply-To: <20100909131524.GJ3950@rabbitmq.com>
References: <4C88DAC8.4060305@zlw-ima.rwth-aachen.de>
	<20100909131524.GJ3950@rabbitmq.com>
Message-ID: <4C88DFF3.70900@rabbitmq.com>

Paulo,

On 09/09/10 14:15, Matthew Sackman wrote:
> The most likely issue is that you're running the latest default on the
> broker and the erlang client.

Indeed.

Though the config looks a bit weird too: you really shouldn't be 
declaring or binding to the default exchange (<<"">>, or just <<>>) - 
the default exchange always exists and queues get bound to it automatically.

Also: {delivery_mode, "keep"} - that's wrong; the delivery_mode needs to 
be either 1 (for transient) or 2 (for persistent).


Matthias.

From jon at jbrisbin.com  Thu Sep  9 14:37:39 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 9 Sep 2010 08:37:39 -0500
Subject: [rabbitmq-discuss] Webhooks plugin
In-Reply-To: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
References: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
Message-ID: <0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>

On Sep 9, 2010, at 7:06 AM, sunghyun lee wrote:

> Hello,
> 
> I am currently working on testing the webhook plugin which was recently released and am having a few problems.  The plugin seems to install ok and created the exchange, queues and bindings I expect, however when I publish a message (byte[] with one byte which is an integer) the broker crashes with the "kernel pid terminated".  Attached are the logs.  
> 
> Is there an example app somewhere I can look at? This plugin would solve a lot of issues which IIS is causing so I am open to look at anything whihc might help.
> 
> thanks!


It looks like this error happens when there are no message headers. I'll put some code in there to handle empty headers, but as a workaround, try creating empty headers on your message.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/fbf49f2e/attachment-0001.htm>

From jon.brisbin at npcinternational.com  Thu Sep  9 15:14:10 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 9 Sep 2010 09:14:10 -0500
Subject: [rabbitmq-discuss] Webhooks plugin
In-Reply-To: <0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>
References: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
	<0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>
Message-ID: <ED453D56-2623-4EEA-A224-40E7A799EA34@npcinternational.com>

On Sep 9, 2010, at 8:37 AM, Jon Brisbin wrote:

> On Sep 9, 2010, at 7:06 AM, sunghyun lee wrote:
> 
>> Hello,
>> 
>> I am currently working on testing the webhook plugin which was recently released and am having a few problems.  The plugin seems to install ok and created the exchange, queues and bindings I expect, however when I publish a message (byte[] with one byte which is an integer) the broker crashes with the "kernel pid terminated".  Attached are the logs.  
>> 
>> Is there an example app somewhere I can look at? This plugin would solve a lot of issues which IIS is causing so I am open to look at anything whihc might help.
>> 
>> thanks!
> 
> 
> It looks like this error happens when there are no message headers. I'll put some code in there to handle empty headers, but as a workaround, try creating empty headers on your message.
> 

I think what I meant to say is:

"I'll put some code in there to handle NO message headers".

As well as error handling...

Jon Brisbin
Portal Webmaster
NPC International, Inc.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/b2f1bf83/attachment.htm>

From jon at jbrisbin.com  Thu Sep  9 15:27:11 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 9 Sep 2010 09:27:11 -0500
Subject: [rabbitmq-discuss] Webhooks plugin
In-Reply-To: <ED453D56-2623-4EEA-A224-40E7A799EA34@npcinternational.com>
References: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
	<0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>
	<ED453D56-2623-4EEA-A224-40E7A799EA34@npcinternational.com>
Message-ID: <6EC2B923-84DF-46C1-A9DC-6DD8883244D4@jbrisbin.com>


I pushed to Git a fix for handling no message headers as well as putting a try/catch around the actual sending of the HTTP request which will keep an error there from crashing the broker.

.tar.gz of the required .ez files is in the downloads section:

http://github.com/jbrisbin/rabbitmq-webhooks/downloads

jb


On Sep 9, 2010, at 9:14 AM, Jon Brisbin wrote:

> On Sep 9, 2010, at 8:37 AM, Jon Brisbin wrote:
> 
>> On Sep 9, 2010, at 7:06 AM, sunghyun lee wrote:
>> 
>>> Hello,
>>> 
>>> I am currently working on testing the webhook plugin which was recently released and am having a few problems.  The plugin seems to install ok and created the exchange, queues and bindings I expect, however when I publish a message (byte[] with one byte which is an integer) the broker crashes with the "kernel pid terminated".  Attached are the logs.  
>>> 
>>> Is there an example app somewhere I can look at? This plugin would solve a lot of issues which IIS is causing so I am open to look at anything whihc might help.
>>> 
>>> thanks!
>> 
>> 
>> It looks like this error happens when there are no message headers. I'll put some code in there to handle empty headers, but as a workaround, try creating empty headers on your message.
>> 
> 
> I think what I meant to say is:
> 
> "I'll put some code in there to handle NO message headers".
> 
> As well as error handling...
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/4b2cc951/attachment.htm>

From shane at digitalsanctum.com  Thu Sep  9 20:59:00 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Thu, 9 Sep 2010 15:59:00 -0400
Subject: [rabbitmq-discuss] mitigating broker and consumer outages
Message-ID: <AANLkTinKygyP5SKHcJAfyzS6=Vbs-wxtgOZKf+NUYa7Z@mail.gmail.com>

I'm doing some analysis in terms of mitigating outages of rabbit brokers
and/or consumers. I have the following questions:


   1. I've noticed that all consumers connected to a broker (via Spring
   AMQP) stop whenever the broker is stopped. Is this behavior expected?
   2. What's the best practice for doing a complete reset (restarting the
   broker and consumers)?
   3. In a system with hundreds of consumers on dozens of machines, it's
   impractical to restart them by hand. Is there anything out of the box which
   can facilitate reconnecting consumers to a broker?


TIA

-- 
-Shane
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100909/aedbf8e1/attachment.htm>

From james.r.carr at gmail.com  Fri Sep 10 02:58:27 2010
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 9 Sep 2010 20:58:27 -0500
Subject: [rabbitmq-discuss] Websocket protocol plugin
Message-ID: <AANLkTi=Vvh1qtAfX52Fvs5SyvxqTFemS76J4MYQD6yjk@mail.gmail.com>

I think I'll take a stab at writing my first rabbitmq plugin and see
if I can get STOMP working over websockets. Any suggestions on where
to start?

Thanks,
James

From tonyg at rabbitmq.com  Fri Sep 10 03:28:07 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Thu, 09 Sep 2010 22:28:07 -0400
Subject: [rabbitmq-discuss] Websocket protocol plugin
In-Reply-To: <AANLkTi=Vvh1qtAfX52Fvs5SyvxqTFemS76J4MYQD6yjk@mail.gmail.com>
References: <AANLkTi=Vvh1qtAfX52Fvs5SyvxqTFemS76J4MYQD6yjk@mail.gmail.com>
Message-ID: <4C8997B7.6000309@rabbitmq.com>

On 09/09/2010 21:58, James Carr wrote:
> I think I'll take a stab at writing my first rabbitmq plugin and see
> if I can get STOMP working over websockets. Any suggestions on where
> to start?

Get websockets working in Erlang first; then get websockets working as a
RabbitMQ plugin generally; then munge rabbitmq-stomp to make use of the
websocket support you've built (if it's present). Each of those steps will be
interesting and valuable, is my guess :-)

If you get one or two steps in, it'd be fun to see if
http://github.com/tonyg/erlang-rfc4627 could be updated to speak JSON-RPC over
websockets (perhaps even with new-fangled JSON-RPC notifications!). (Actually
that reminds me it'd be cool to have JSON-RPC run over raw TCP, too.)

Note to get STOMP to run at all with the current default checkouts you'll need
the rabbitmq-stomp patch I sent through the other day, currently residing in hg
on branch bug23231 and not yet merged into default (ping, mikeb! ;-) ).

Regards,
  Tony

From sunshinesucker at gmail.com  Fri Sep 10 10:08:57 2010
From: sunshinesucker at gmail.com (sunghyun lee)
Date: Fri, 10 Sep 2010 10:08:57 +0100
Subject: [rabbitmq-discuss] Webhooks plugin
In-Reply-To: <6EC2B923-84DF-46C1-A9DC-6DD8883244D4@jbrisbin.com>
References: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
	<0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>
	<ED453D56-2623-4EEA-A224-40E7A799EA34@npcinternational.com>
	<6EC2B923-84DF-46C1-A9DC-6DD8883244D4@jbrisbin.com>
Message-ID: <AANLkTinOPz38jL4P2z_tO3G4DtHcueP=OqbqfCWvEZs4@mail.gmail.com>

that doesnt seem to have solved it, or I am still getting the same or
similar error.  Its a bit strange as when I set the time window and try and
send outside of it, the messages sit in the queue and I get information
stating it will try in x minutes, so I assume it something to do with the
actual http request its trying to make.


The test publish I am trying to do is:

channel.BasicPublish("webhooks.test", "test", null,
Encoding.UTF8.GetBytes("hello"));

but it can be changed to anything as I just want to see it working.

thanks!



On 9 September 2010 15:27, Jon Brisbin <jon at jbrisbin.com> wrote:

>
> I pushed to Git a fix for handling no message headers as well as putting a
> try/catch around the actual sending of the HTTP request which will keep an
> error there from crashing the broker.
>
> .tar.gz of the required .ez files is in the downloads section:
>
> http://github.com/jbrisbin/rabbitmq-webhooks/downloads
>
> jb
>
>
> On Sep 9, 2010, at 9:14 AM, Jon Brisbin wrote:
>
> On Sep 9, 2010, at 8:37 AM, Jon Brisbin wrote:
>
> On Sep 9, 2010, at 7:06 AM, sunghyun lee wrote:
>
> Hello,
>
> I am currently working on testing the webhook plugin which was recently
> released and am having a few problems.  The plugin seems to install ok and
> created the exchange, queues and bindings I expect, however when I publish a
> message (byte[] with one byte which is an integer) the broker crashes with
> the "kernel pid terminated".  Attached are the logs.
>
> Is there an example app somewhere I can look at? This plugin would solve a
> lot of issues which IIS is causing so I am open to look at anything whihc
> might help.
>
> thanks!
>
>
> It looks like this error happens when there are no message headers. I'll
> put some code in there to handle empty headers, but as a workaround, try
> creating empty headers on your message.
>
>
> I think what I meant to say is:
>
> "I'll put some code in there to handle NO message headers".
>
> As well as error handling...
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> Thanks!
>
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100910/7283f0a7/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE.log
Type: application/octet-stream
Size: 8126 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100910/7283f0a7/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at SLEE-sasl.log
Type: application/octet-stream
Size: 9692 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100910/7283f0a7/attachment-0003.obj>

From mikeb at rabbitmq.com  Fri Sep 10 11:24:45 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 10 Sep 2010 11:24:45 +0100
Subject: [rabbitmq-discuss] Websocket protocol plugin
In-Reply-To: <4C8997B7.6000309@rabbitmq.com>
References: <AANLkTi=Vvh1qtAfX52Fvs5SyvxqTFemS76J4MYQD6yjk@mail.gmail.com>
	<4C8997B7.6000309@rabbitmq.com>
Message-ID: <4C8A076D.7030401@rabbitmq.com>

> Note to get STOMP to run at all with the current default checkouts you'll need
> the rabbitmq-stomp patch I sent through the other day, currently residing in hg
> on branch bug23231 and not yet merged into default (ping, mikeb! ;-) ).

It's merged now.

mkb.

From matthias at rabbitmq.com  Fri Sep 10 12:15:48 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Sep 2010 12:15:48 +0100
Subject: [rabbitmq-discuss] Clean up stale connections without
	restarting?
In-Reply-To: <b384a3ba-8d8b-48ce-849f-3f365df7fa00@p12g2000prn.googlegroups.com>
References: <b384a3ba-8d8b-48ce-849f-3f365df7fa00@p12g2000prn.googlegroups.com>
Message-ID: <4C8A1364.7010304@rabbitmq.com>

Nick,

On 08/09/10 19:40, Nick wrote:
> Some of the clients connected to it quit uncleanly, and seem to have
> caused RabbitMQ to leave the connection open.  When the client comes
> back online, I now have two connections listed (via rabbitmqctl) to
> that IP address but on different ports.  I'm worried that I'm losing
> jobs to these zombie connections.  How can I clear them out without
> restarting RabbitMQ entirely?

The connections should clear eventually, though it may take quite a 
while depending on your kernel's settings.

Do the connections show up in 'rabbitmqctl list_connections'? If so you 
can close them with 'rabbitmqctl close_connection ...'.

If the dead connections cause problems and occur on a regular basis you 
may want to get the clients to request heartbeats (see 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.0.0/rabbitmq-java-client-javadoc-2.0.0/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int) 
for how to do this in the Java client; other AMQP clients ought to have 
a similar API). That will detect dead connections and close them.


Regards,

Matthias.

From majek04 at gmail.com  Fri Sep 10 14:06:56 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 10 Sep 2010 14:06:56 +0100
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
Message-ID: <AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>

Romary,

First, thank a lot for the feedback. For example the information about
SSL memory
usage is indeed very interesting. (if that is a big problem to you,
you may always
fall back to the old technique of using stunnel)

The flow control was heavily modified between 1.8.1 and 2.0.0. In summary:
 - 1.8.1 - we have send Channel.flow AMQP message to everyone once
   rabbit reached memory limit
 - 2.0.0 - once we reach memory limit, the connections from which we hear
   publishes are stopped temporarily. We stop receiving bytes from tcp sockets.
   That 'stop' shouldn't take too long, as data should be swapped out to disk
   and memory pressure will drop pretty quickly.


On Wed, Sep 8, 2010 at 11:49, Romary Kremer <romary.kremer at gmail.com> wrote:
> I've started playing a bit with the latest release 2.0.0 and I m affraid
> that it looks like their are some regression or at least some semantic
> updates.

It's best if you upgraded both server and client library. Do you have any
particular problems? A lot was changed in 2.0.0 but we think it's fully
functional. If you found something that blocks you to migrate, you
could report a bug.

> It looks like any listener is called back ?when the alarm handler is set or
> cleared, while the producers are still paused / resumed
> like their are to be.

Interesting. Maybe we have a race there? Or maybe you're blocking
the main java client thread? (nothing blocking should be done from
the main thread)

>> during long running tests, we have encountered strange behaviour due to
>> flow control :
>>
>> The queue depth starts to increase linearly for about 2 hours, these is
>> coherent since the message throughput of the single consumer
>> is not enough to absorb message ingress. Memory occupation grow faster as
>> well, until the memory watermark is reached on the broker side.

Are you sure your consumer is ACK-ing the messages it received?

>> From that point, the producers are indeed paused, as flow control request
>> has been issued by the broker, but the consumer seems to be blocked
>> as well. The queue level is flatten at its top value until the end of the
>> test, even when memory occupation lowered under the threshold.

That's how 1.8.1 behaves. In 2.0.0 we introduced swapping out big queues
to disk, so the memory usage shouldn't be dependent on a queue size.

>> By registering the FlowListener callback, we have noticed that not all of
>> the producers are notified all the time the alarm handler is set.
>> Does this mean that the broker applies some heuristic to try not to block
>> every body every time ?
>> Or does it mean that some of the channels have been somehow blacklisted by
>> the broker ?

No, in 1.8.1 broker should send 'channel.flow' to all the channels.

>> Could anybody explain how the blocking of consumer is assumed to be
>> implemented ?

The best description is probably here:
  http://www.rabbitmq.com/extensions.html#memsup

But it covers 2.0.0. I'd suggest an upgrade to 2.0.0 and monitoring
not only queue size but also number of unacknowledged messages
('Msg unack' in status plugin). This number should be near zero.

Cheers,
  Marek Majkowski

From jon at jbrisbin.com  Fri Sep 10 14:11:58 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 10 Sep 2010 08:11:58 -0500
Subject: [rabbitmq-discuss] Webhooks plugin
In-Reply-To: <AANLkTinOPz38jL4P2z_tO3G4DtHcueP=OqbqfCWvEZs4@mail.gmail.com>
References: <AANLkTi=6bg5LvKM8fxXMQRmRTH0nXx2eOZJG--ca-jmj@mail.gmail.com>
	<0DDF57BA-9555-4F18-AD7B-169BA85321FF@jbrisbin.com>
	<ED453D56-2623-4EEA-A224-40E7A799EA34@npcinternational.com>
	<6EC2B923-84DF-46C1-A9DC-6DD8883244D4@jbrisbin.com>
	<AANLkTinOPz38jL4P2z_tO3G4DtHcueP=OqbqfCWvEZs4@mail.gmail.com>
Message-ID: <FBF97E4E-F09B-4CFC-9F76-C7DACC1038FD@jbrisbin.com>

The plugin expects you to set a ContentType (on the message properties). It's giving an error because there isn't one. It passes this content-type along to the webhook in the form of the "Content-Type" header. Try using "text/plain" if you're just testing.

jb


On Sep 10, 2010, at 4:08 AM, sunghyun lee wrote:

> that doesnt seem to have solved it, or I am still getting the same or similar error.  Its a bit strange as when I set the time window and try and send outside of it, the messages sit in the queue and I get information stating it will try in x minutes, so I assume it something to do with the actual http request its trying to make.
> 
> 
> The test publish I am trying to do is:
> 
> channel.BasicPublish("webhooks.test", "test", null, Encoding.UTF8.GetBytes("hello"));
> 
> but it can be changed to anything as I just want to see it working. 
> 
> thanks!
> 
> 
> 
> On 9 September 2010 15:27, Jon Brisbin <jon at jbrisbin.com> wrote:
> 
> I pushed to Git a fix for handling no message headers as well as putting a try/catch around the actual sending of the HTTP request which will keep an error there from crashing the broker.
> 
> .tar.gz of the required .ez files is in the downloads section:
> 
> http://github.com/jbrisbin/rabbitmq-webhooks/downloads
> 
> jb
> 
> 
> On Sep 9, 2010, at 9:14 AM, Jon Brisbin wrote:
> 
>> On Sep 9, 2010, at 8:37 AM, Jon Brisbin wrote:
>> 
>>> On Sep 9, 2010, at 7:06 AM, sunghyun lee wrote:
>>> 
>>>> Hello,
>>>> 
>>>> I am currently working on testing the webhook plugin which was recently released and am having a few problems.  The plugin seems to install ok and created the exchange, queues and bindings I expect, however when I publish a message (byte[] with one byte which is an integer) the broker crashes with the "kernel pid terminated".  Attached are the logs.  
>>>> 
>>>> Is there an example app somewhere I can look at? This plugin would solve a lot of issues which IIS is causing so I am open to look at anything whihc might help.
>>>> 
>>>> thanks!
>>> 
>>> 
>>> It looks like this error happens when there are no message headers. I'll put some code in there to handle empty headers, but as a workaround, try creating empty headers on your message.
>>> 
>> 
>> I think what I meant to say is:
>> 
>> "I'll put some code in there to handle NO message headers".
>> 
>> As well as error handling...
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> Thanks!
> 
> J. Brisbin
> http://jbrisbin.com/
> 
> 
> 
> 
> 
> 
> 
> <rabbit at SLEE.log><rabbit at SLEE-sasl.log>


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100910/64169240/attachment.htm>

From vlad at rabbitmq.com  Mon Sep 13 14:30:52 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Mon, 13 Sep 2010 14:30:52 +0100
Subject: [rabbitmq-discuss] Erlang client now works on default and has some
	(important) API changes
Message-ID: <4C8E278C.3010408@rabbitmq.com>



The Erlang client was broken on default recently. We have now fixed it 
and it works with the latest version of the broker on default.
We recommend people that were using branches bug22993 or bug23024 to use 
the version on default instead (if you were using the latest broker 
version and not 2.0.0).

Please note that there have been some API changes as well:

- 
amqp_connection:{start_network,start_direct,start_network_link,start_direct_link}/{0,1} 
functions have been replaced by amqp_connection:start/{1,2}. Example usages:

     amqp_connection:start(network).
     amqp_connection:start(direct).
     amqp_connection:start(network, #amqp_params{heartbeat = 20}).

- amqp_connection:start/{0,1} functions do not return ConnectionPid. 
They return {ok, ConnectionPid} or {error, Error} instead:

     {ok, ConnectionPid} = amqp_connection:start(network).

- amqp_connection:open_channel/1 does not return ChannelPid. It returns 
{ok, ChannelPid} or {error, Error} instead:

     {ok, ChannelPid} = amqp_connection:open_channel(ConnectionPid).


The edoc is to be updated soon.
We hope that this will be the final version of the API, but cannot 
guarantee this until the Erlang client will become officially supported.


Cheers,
Vlad.


From flatline at stresstiming.de  Mon Sep 13 15:32:40 2010
From: flatline at stresstiming.de (diez)
Date: Mon, 13 Sep 2010 16:32:40 +0200
Subject: [rabbitmq-discuss] RabbitMQ not responding / not sending any errors
	to client
Message-ID: <4C8E3608.5080204@stresstiming.de>

Hi,

we are evaluating Rabbit as a solution for huge high performance and
high load environment.
During our tests we found encountered some problems with the clients we
used.

Our Environment consists of the following:

RabbitMQ using the new persister (version 2.0.0)
Debian Linux Lenny 5.0 (without any special tweaks)
Consumer and Producer written in Java with the spring-source generic
library (2.0.0) taken from rabbitmq website.

Our primary concern:

When the RabbitMQ Server runs into the vm_memory_high_watermark (or any
other load related issue) it does NOT communicate this to the clients.
We are not able to detect this failure on the client side. Obviously
there is a mechanism included in the Java client that seems to be the
right place to implement code to deal with this situation.


        channel.setReturnListener(new ReturnListener() {
               
                @Override
                public void handleBasicReturn(int arg0, String arg1,
String arg2,
                        String arg3, BasicProperties arg4, byte[] arg5)
throws IOException {
                   
                    System.out.println("Error: " + arg1);
                }
            });


If we run into the situation descibed above the ReturnListener isn't
invoked at all. Please note: The Server  (better the OTP Environment) is
configured not to consume all the systems memory, we decreased the
vm_memory_high_watermark to a realtively low level of some megs. So the
underlying operation system should not be the problem.

Is it necessary to configure the server in a special way to make this
work or are we missing anything else?

Sincerely your's

Dieter Schmidt








From davegreggory at yahoo.com  Mon Sep 13 15:28:59 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Mon, 13 Sep 2010 07:28:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <4C8763B6.5070400@rabbitmq.com>
References: <4C861AFB.1010102@rabbitmq.com>
	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>
	<4C866A75.5090502@rabbitmq.com>
	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>
	<4C868AE7.2020801@rabbitmq.com>
	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>
	<4C869279.9070103@rabbitmq.com>
	<18126.83324.qm@web111013.mail.gq1.yahoo.com>
	<4C8763B6.5070400@rabbitmq.com>
Message-ID: <360729.64008.qm@web111014.mail.gq1.yahoo.com>

Sending to list...



----- Forwarded Message ----
From: Dave Greggory <davegreggory at yahoo.com>
To: Simon MacMullen <simon at rabbitmq.com>
Sent: Mon, September 13, 2010 10:19:20 AM
Subject: Re: [rabbitmq-discuss] Management plugin preview release

Sounds good.



>Ultimately I see the management plugin replacing the status plugin. However the 

>status plugin is pretty simple and it's hardly taking any of our time to keep it 
>
>working, so 
>
>I imagine that state of affairs could persist for quite a while. I doubt it'll 
>see any development though.

If we can keep the Status plugin around until Management plugin comes out of 
beta, that should be good enough for us. I realize Status plugin is also beta, 
but we're comfortable with it for now (as opposed to not having any monitoring 
at all), but I'd hate to have to put another beta plugin out there on a 
production system.

>> 5. Ability to isolate plugin failures from taking down RabbitMQ - (ie run the
>> plugin on a single RAM node in a cluster that no apps connect to, but from 
>this
>> node monitor the status of other nodes in the cluster)

>At the moment the management plugin isn't very sensible in the context of 
>clustering, but that will get fixed. 
>

To be explicit, you're saying that you plan to have some way to have the 
Management plugin show the state of nodes in the cluster other than the one it's 

running on? I much rather prefer this approach because that way, we can have a 
node in the cluster that isn't really used for messaging, but solely to monitor 
other nodes in the cluster that do the actual work. 


>I would hope the plugin should not be capable of taking down Rabbit though. If 
>it ever does I most certainly want to hear about it!

Yep, but it'd be nice if we can pre-empt that possibility even for situtations 
you/we haven't come across yet :)

>> 6. Configurable permissions to lock down what can be done through the plugin

>The short-term plan is to add a superuser bit to define whether users can 
>manipulate non-AMQP objects (users / vhosts / permissions) at all. For AMQP 
>objects the >existing permission  system is used. Would this be adequate?

Yep taking away access from users/vhosts/permissions should suffice in terms of 
security. 


      

From matthew at rabbitmq.com  Mon Sep 13 15:53:24 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 13 Sep 2010 15:53:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <20100913145324.GC15229@rabbitmq.com>

Hi Dave,

Sorry for the delay in getting back to you.

Your node1 log had this in it:

=ERROR REPORT==== 8-Sep-2010::09:45:43 ===
** Generic server <0.29.0> terminating
** Last message in was {'EXIT',<0.30.0>,eio}
** When Server state == {state,user_sup,undefined,<0.30.0>,
                               {<0.29.0>,user_sup}}
** Reason for termination ==
** eio

This is utterly bizarre - we've never seen it before and it was
certainly enough to take down the node1 or at least hang it.

node2 log has:

=ERROR REPORT==== 8-Sep-2010::09:41:38 ===
** Generic server delegate_process_0 terminating
** Last message in was {'$gen_cast',{thunk,#Fun<delegate.4.123807736>}}
** When Server state == no_state
** Reason for termination ==
** {noproc,{gen_server2,call,
                        [{delegate_process_1,'rabbit at ent-jms-qa-1'},
                         {thunk,#Fun<delegate.5.131821234>},
                         infinity]}}

This is basically node2 finding that node1 has gone down. This suggests
(as does your timeline) that node1 actually failed some time previously
but that the immediate error was not logged and only at some later point
did a very generic "eio" come out of it - literally error in some form
of IO operation.

Now the eio comes out of process <0.30.0> which is a process which is
started very early on in the Erlang VM boot process. I can't quite tell
what the user_sup process is meant to be doing - it's so far buried that
there's no documentation for it. It's quite possible you've found a bug
in Erlang itself. Even having googled around for a while, I still can't
really find out what "user" is for - the best I can find is:
"user is a server which responds to all the messages defined in the I/O
interface. The code in user.erl can be used as a model for building
alternative I/O servers." so that's nice and clear. Anyway, my guess is
some error came out of said I/O server, took out user and user_sup which
was then logged. But as to what the fault actually was, I'm afraid I
have no idea.

When this next happens, any chance you could check things like number of
open file descriptors, see if there's any kernel log messages relevant
etc? Sorry I can't be more helpful - it's just not something we've ever
come across before.

Matthew

From chrisch at ecollege.com  Mon Sep 13 16:06:09 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Mon, 13 Sep 2010 09:06:09 -0600
Subject: [rabbitmq-discuss] Erlang client now works on default and has
	some(important) API changes
In-Reply-To: <4C8E278C.3010408@rabbitmq.com>
Message-ID: <74D4EDFED2256749A5BF5B59267E085303BBD86E@EXMBCL01CORP.eclg.org>

Hello Everyone.

Thank you for the update, Vlad.

Just to confirm...is it still recommended for an erlang client that
works against broker 2.0.0 to update the public umbrella to the
rabbitmq_v2_0_0 tag and build from there?

Thanks!

Chris Chew

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Vlad
Alexandru Ionescu
Sent: Monday, September 13, 2010 7:31 AM
To: RabbitMQ
Subject: [rabbitmq-discuss] Erlang client now works on default and has
some(important) API changes



The Erlang client was broken on default recently. We have now fixed it 
and it works with the latest version of the broker on default.
We recommend people that were using branches bug22993 or bug23024 to use

the version on default instead (if you were using the latest broker 
version and not 2.0.0).

Please note that there have been some API changes as well:

- 
amqp_connection:{start_network,start_direct,start_network_link,start_dir
ect_link}/{0,1} 
functions have been replaced by amqp_connection:start/{1,2}. Example
usages:

     amqp_connection:start(network).
     amqp_connection:start(direct).
     amqp_connection:start(network, #amqp_params{heartbeat = 20}).

- amqp_connection:start/{0,1} functions do not return ConnectionPid. 
They return {ok, ConnectionPid} or {error, Error} instead:

     {ok, ConnectionPid} = amqp_connection:start(network).

- amqp_connection:open_channel/1 does not return ChannelPid. It returns 
{ok, ChannelPid} or {error, Error} instead:

     {ok, ChannelPid} = amqp_connection:open_channel(ConnectionPid).


The edoc is to be updated soon.
We hope that this will be the final version of the API, but cannot 
guarantee this until the Erlang client will become officially supported.


Cheers,
Vlad.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Sep 13 16:11:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 13 Sep 2010 16:11:07 +0100
Subject: [rabbitmq-discuss] Erlang client now works on default and has
 some(important) API changes
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303BBD86E@EXMBCL01CORP.eclg.org>
References: <4C8E278C.3010408@rabbitmq.com>
	<74D4EDFED2256749A5BF5B59267E085303BBD86E@EXMBCL01CORP.eclg.org>
Message-ID: <20100913151106.GE15229@rabbitmq.com>

Hi Chris,

On Mon, Sep 13, 2010 at 09:06:09AM -0600, Chris Chew wrote:
> Just to confirm...is it still recommended for an erlang client that
> works against broker 2.0.0 to update the public umbrella to the
> rabbitmq_v2_0_0 tag and build from there?

If you need it to work with 2.0.0 broker, then you must use the erlang
client at revision rabbitmq_v2_0_0.

If you need it to work with the latest-on-default broker then you must
use the erlang latest-on-default.

Going forwards, only the new API will be supported with the next release
of RabbitMQ.

Matthew

From davegreggory at yahoo.com  Mon Sep 13 16:12:05 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Mon, 13 Sep 2010 08:12:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
Message-ID: <509856.68626.qm@web111016.mail.gq1.yahoo.com>

We register a shutdown listener to listen for connection-loss events and 
automatically re-connect clients to other RabbitMQ nodes in the cluster. This 
weekend we had to restart the load balancer that sits between rabbitmq and it's 
clients for some maintenance, but the ShutdownCompleted/ShutdownSignalException 
event never fired in the clients. 


I'm trying to understand how the shutdown signal works. Does it only fire the 
ShutDownCompleted event if RabbitMQ node shuts down and sends the signal back to 
clients? If that's the case, I'm probably misusing it to detect connection-loss. 
Is there a different way of detecting connection loss?

Thanks,
Dave



      

From tom.williams at CrispThinking.com  Mon Sep 13 16:12:33 2010
From: tom.williams at CrispThinking.com (Tom Williams)
Date: Mon, 13 Sep 2010 16:12:33 +0100
Subject: [rabbitmq-discuss] Multiple consumers and queue subscription
Message-ID: <555BCB283BEB174F9BF8A0A73C880BB20347AD2DF1@exchange02.crispthinking.local>

Hi chaps,
I'm pretty new to RabbitMQ, but I have an application which had multiple subscribers to the same queue in several different processes, when I push a message onto that queue should it be received by only 1 of the subscribers? All the subscribers are the same, they're just on separate processes (on separate machines) for the sake of load balancing, so any subscriber can pick up any message. Is the subscriber model the right thing to be using here?

Regards,
Tom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100913/68485716/attachment.htm>

From simon at rabbitmq.com  Mon Sep 13 16:26:00 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Sep 2010 16:26:00 +0100
Subject: [rabbitmq-discuss] Management plugin preview release
In-Reply-To: <360729.64008.qm@web111014.mail.gq1.yahoo.com>
References: <4C861AFB.1010102@rabbitmq.com>	<3B012FC4-C6A6-4865-BFA9-A6495D0EFF99@gmail.com>	<4C866A75.5090502@rabbitmq.com>	<AANLkTi=7Kh6bjepd8PWg3Zeh_Yt9diaTuMXyLpwKXmaD@mail.gmail.com>	<4C868AE7.2020801@rabbitmq.com>	<AANLkTimLiQ0MGEqBosFJa3wRMnt-==wUrbiSu-CNYFHD@mail.gmail.com>	<4C869279.9070103@rabbitmq.com>	<18126.83324.qm@web111013.mail.gq1.yahoo.com>	<4C8763B6.5070400@rabbitmq.com>
	<360729.64008.qm@web111014.mail.gq1.yahoo.com>
Message-ID: <4C8E4288.2080206@rabbitmq.com>

On 13/09/10 15:28, Dave Greggory wrote:
> Sending to list...

Thanks :)

> If we can keep the Status plugin around until Management plugin comes out of
> beta, that should be good enough for us. I realize Status plugin is also beta,
> but we're comfortable with it for now (as opposed to not having any monitoring
> at all), but I'd hate to have to put another beta plugin out there on a
> production system.

That sounds fairly plausible.

>>> 5. Ability to isolate plugin failures from taking down RabbitMQ - (ie run the
>>> plugin on a single RAM node in a cluster that no apps connect to, but from
>> this
>>> node monitor the status of other nodes in the cluster)
>
>> At the moment the management plugin isn't very sensible in the context of
>> clustering, but that will get fixed.
>>
>
> To be explicit, you're saying that you plan to have some way to have the
> Management plugin show the state of nodes in the cluster other than the one it's
> running on? I much rather prefer this approach because that way, we can have a
> node in the cluster that isn't really used for messaging, but solely to monitor
> other nodes in the cluster that do the actual work.

That's the plan. Note that it's currently far from what's actually 
happening, but it seems like the right thing to do in a clustered 
environment.

>>> 6. Configurable permissions to lock down what can be done through the plugin
>
>> The short-term plan is to add a superuser bit to define whether users can
>> manipulate non-AMQP objects (users / vhosts / permissions) at all. For AMQP
>> objects the>existing permission  system is used. Would this be adequate?
>
> Yep taking away access from users/vhosts/permissions should suffice in terms of
> security.

Cool. This is now implemented in the default branch.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From davegreggory at yahoo.com  Mon Sep 13 16:48:44 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Mon, 13 Sep 2010 08:48:44 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <20100913145324.GC15229@rabbitmq.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
Message-ID: <72349.33530.qm@web111005.mail.gq1.yahoo.com>

Wow... ok.

I'll grab lsof / dmesg / syslog output next time this happens.

Thanks for looking into it. Much appreciated.



----- Original Message ----
From: Matthew Sackman <matthew at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Mon, September 13, 2010 10:53:24 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging

Hi Dave,

Sorry for the delay in getting back to you.

Your node1 log had this in it:

=ERROR REPORT==== 8-Sep-2010::09:45:43 ===
** Generic server <0.29.0> terminating
** Last message in was {'EXIT',<0.30.0>,eio}
** When Server state == {state,user_sup,undefined,<0.30.0>,
                               {<0.29.0>,user_sup}}
** Reason for termination ==
** eio

This is utterly bizarre - we've never seen it before and it was
certainly enough to take down the node1 or at least hang it.

node2 log has:

=ERROR REPORT==== 8-Sep-2010::09:41:38 ===
** Generic server delegate_process_0 terminating
** Last message in was {'$gen_cast',{thunk,#Fun<delegate.4.123807736>}}
** When Server state == no_state
** Reason for termination ==
** {noproc,{gen_server2,call,
                        [{delegate_process_1,'rabbit at ent-jms-qa-1'},
                         {thunk,#Fun<delegate.5.131821234>},
                         infinity]}}

This is basically node2 finding that node1 has gone down. This suggests
(as does your timeline) that node1 actually failed some time previously
but that the immediate error was not logged and only at some later point
did a very generic "eio" come out of it - literally error in some form
of IO operation.

Now the eio comes out of process <0.30.0> which is a process which is
started very early on in the Erlang VM boot process. I can't quite tell
what the user_sup process is meant to be doing - it's so far buried that
there's no documentation for it. It's quite possible you've found a bug
in Erlang itself. Even having googled around for a while, I still can't
really find out what "user" is for - the best I can find is:
"user is a server which responds to all the messages defined in the I/O
interface. The code in user.erl can be used as a model for building
alternative I/O servers." so that's nice and clear. Anyway, my guess is
some error came out of said I/O server, took out user and user_sup which
was then logged. But as to what the fault actually was, I'm afraid I
have no idea.

When this next happens, any chance you could check things like number of
open file descriptors, see if there's any kernel log messages relevant
etc? Sorry I can't be more helpful - it's just not something we've ever
come across before.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      

From alexis at rabbitmq.com  Mon Sep 13 21:25:23 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 13 Sep 2010 21:25:23 +0100
Subject: [rabbitmq-discuss] Multiple consumers and queue subscription
In-Reply-To: <555BCB283BEB174F9BF8A0A73C880BB20347AD2DF1@exchange02.crispthinking.local>
References: <555BCB283BEB174F9BF8A0A73C880BB20347AD2DF1@exchange02.crispthinking.local>
Message-ID: <AANLkTik47aTKVn91rr983j9jRpDyBgTrYNJcMrAobF_e@mail.gmail.com>

Tom

On Mon, Sep 13, 2010 at 4:12 PM, Tom Williams
<tom.williams at crispthinking.com> wrote:
> Hi chaps,
>
> I?m pretty new to RabbitMQ, but I have an application which had multiple
> subscribers to the same queue in several different processes, when I push a
> message onto that queue should it be received by only 1 of the subscribers?

Yes.

A queue is either associated with one consumer or shared between many
consumers.  But the routing and delivery semantics are the same in
both cases, i.e. RabbitMQ tries to send the message to just one
consumer.


> All the subscribers are the same, they?re just on separate processes (on
> separate machines) for the sake of load balancing, so any subscriber can
> pick up any message. Is the subscriber model the right thing to be using
> here?
>

Yes.

In contrast, you would use *exchanges* to broadcast ("pubsub") to
multiple queues.

alexis



> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From stevvooe at gmail.com  Mon Sep 13 21:38:27 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Mon, 13 Sep 2010 13:38:27 -0700
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
Message-ID: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>

After restarting a server with configured durable queues, the web
interface doesn't display the queue information. Please see the
attached screenshot. The numbers don't seem to be available in the API
either:

{
name: "test"
vhost: "/"
durable: true
auto_delete: false
owner_pid: "none"
arguments: { }
pid: "<rabbit at venkman.238.0>"
}

Please let me know if you need any other details.

Thank you,

Stephen
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot.png
Type: image/png
Size: 33010 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100913/e697bedf/attachment-0001.png>

From simon at rabbitmq.com  Mon Sep 13 22:26:46 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Sep 2010 22:26:46 +0100
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
In-Reply-To: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>
References: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>
Message-ID: <4C8E9716.9090604@rabbitmq.com>

On 13/09/10 21:38, Stephen Day wrote:
> After restarting a server with configured durable queues, the web
> interface doesn't display the queue information. Please see the
> attached screenshot. The numbers don't seem to be available in the API
> either:

Thanks Stephen. We've actually been aware of this for a while; there 
should be a fix in the default branch soon.

Cheers, Simon

From bsullivan at lindenlab.com  Tue Sep 14 02:43:33 2010
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Mon, 13 Sep 2010 18:43:33 -0700
Subject: [rabbitmq-discuss] "node" no longer an option on rabbitmqctl
	list_queues
Message-ID: <AANLkTi=m8QZn9hcj1ZqVPjfn_0dSitc2Q-TygHROaKu2@mail.gmail.com>

Hi,

I just wanted to follow up on something we've noticed in the past few
versions - it looks like the "node" output option from the "rabbitmqctl
list_queues" command appears to have been dropped.  Can we get more detail
on why?

In the past, we've used this to help know why memory on a particular host is
abnormally high.  Now with disk-backed queues, this is less of an issue, but
still I'd be curious to know more about the rationale here.

Thanks,
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100913/fd567abd/attachment.htm>

From gmr at myyearbook.com  Tue Sep 14 03:39:31 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 13 Sep 2010 22:39:31 -0400
Subject: [rabbitmq-discuss] Pika question
Message-ID: <AANLkTinO1=pCCcUXVjFKpwvMz-L=zwsU_toRtPiBdMC0@mail.gmail.com>

I've been working on a native adapter for Pika for use with Tornado which
has gotten some attention on the Tornado list. I've been focused on trying
to implement a non-hacky adapter as other attempts are focused on either
moving away from stock Tornado (gTornado, Twisted implementations, etc) or
patching both Pika and Tornado.

In working through the process of implementation, I became focused on the
drain_events() function which is to be extended/implemented by the client.
 Basically, as I understand it, drain_events() is meant to be the blocking,
time based loop that allows Pika to let other things go on in the async
engine while it is not doing anything.  With asyncore this methodology works
because you can loop against it in a pseudo blocking fashion.
 Unfortunately, Tornado, as far as I can tell, does not have a similar loop
functionality.

In digging deeper I found the main purpose of this function is to block on
pika.connection.Connection._rpc() which in many cases is called without
regard to the response, but in others the response is part of the protocol
negotiation. I have some reservations about thinking of Pika as a truly
async library because of its dependence on the blocking behavior of
Connection._rpc().  As you can see, Connection._rpc() ends with
channel.wait_for_reply (
http://github.com/tonyg/pika/blob/master/pika/connection.py#L326) which on
line 124 (http://github.com/tonyg/pika/blob/master/pika/connection.py#L323)
calls up to the drain_events() function, waiting for the channel to have a
stack of replies to process.

I've been thinking about what it would take to make _rpc() an actual async
function where you register the call with a callback and then move on.
Obviously Tony G knows the code the best, but are there any other opinions
about how this should be done?

Tony, if I refractor this to work in a non-blocking way, would you be
interested in having it upstream?  Would anyone be interested in helping?

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100913/41f84e31/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 14 07:12:38 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Sep 2010 07:12:38 +0100
Subject: [rabbitmq-discuss] "node" no longer an option on rabbitmqctl
 list_queues
In-Reply-To: <AANLkTi=m8QZn9hcj1ZqVPjfn_0dSitc2Q-TygHROaKu2@mail.gmail.com>
References: <AANLkTi=m8QZn9hcj1ZqVPjfn_0dSitc2Q-TygHROaKu2@mail.gmail.com>
Message-ID: <4C8F1256.2040805@rabbitmq.com>

Brian,

Brian Sullivan wrote:
> I just wanted to follow up on something we've noticed in the past few 
> versions - it looks like the "node" output option from the "rabbitmqctl 
> list_queues" command appears to have been dropped.  Can we get more 
> detail on why?

The change happened in 
http://hg.rabbitmq.com/rabbitmq-server/annotate/561638e40147/src/rabbit_control.erl 
in December when we switched to displaying complete pids instead of just 
nodes. Our pid notation does contain the node name, so you can extract 
it from there.

Regards,

Matthias.

From romary.kremer at gmail.com  Tue Sep 14 09:07:20 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Tue, 14 Sep 2010 10:07:20 +0200
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
Message-ID: <66299676-639B-473C-92C5-62B60836DE35@gmail.com>

Thanks Marek for your reply.

Le 10 sept. 10 ? 15:06, Marek Majkowski a ?crit :

> Romary,
>
> First, thank a lot for the feedback. For example the information about
> SSL memory
> usage is indeed very interesting. (if that is a big problem to you,
> you may always
> fall back to the old technique of using stunnel)

Stunnel is not considered for now, We would rather ear your opinion  
and knowledge
of potential memory leak due to the use SSL (maybe from the Erlang  
stack itself).
It seems that memory is still growing even when the broker is running  
no activity
but connections. We ran a test in which we just open 10 000  
connections and do
noting for 2 hours but observing the memory occupation on the broker  
side to confirm it.

> The flow control was heavily modified between 1.8.1 and 2.0.0. In  
> summary:
> - 1.8.1 - we have send Channel.flow AMQP message to everyone once
>   rabbit reached memory limit
> - 2.0.0 - once we reach memory limit, the connections from which we  
> hear
>   publishes are stopped temporarily. We stop receiving bytes from  
> tcp sockets.
>   That 'stop' shouldn't take too long, as data should be swapped out  
> to disk
>   and memory pressure will drop pretty quickly.

Do you mean that in 2.0.0 the Channel.flow AMQP message is no longer  
sent to
the producer that are stopped temporarily ? So that would explain why
	1) Channel.publish() can be blocking on the client side when the  
broker stop
	reading from the socket !
	
	2) FlowListener.handleFlow() is no longer invoked on the registered  
listener when
	the alarm handler is set or cleared
Are my deduction wright ?

Do you have any figures to quantify "should, not take too long" ? Are  
their some
test reports available about that major evolution ?

>
>
> On Wed, Sep 8, 2010 at 11:49, Romary Kremer  
> <romary.kremer at gmail.com> wrote:
>> I've started playing a bit with the latest release 2.0.0 and I m  
>> affraid
>> that it looks like their are some regression or at least some  
>> semantic
>> updates.
>
> It's best if you upgraded both server and client library. Do you  
> have any
> particular problems? A lot was changed in 2.0.0 but we think it's  
> fully
> functional. If you found something that blocks you to migrate, you
> could report a bug.

Sorry If I wasn't clear on the previous post ,we are already in 2.0.0  
for both broker and
client library.

>
>> It looks like any listener is called back  when the alarm handler  
>> is set or
>> cleared, while the producers are still paused / resumed
>> like their are to be.
>
> Interesting. Maybe we have a race there? Or maybe you're blocking
> the main java client thread? (nothing blocking should be done from
> the main thread)

I am quite sure I am not blocking the main thread, neither the  
Connection Thread. All
the message-related logic is in a particular thread (Some kind of  
ProducerGroup
pool of threads actually).
Consumer call back are running within the Connection thread if I refer  
to the Javadoc !

The same code using the library version 1.8.1, The callback where  
invoked when
alarm handler is set or cleared anyway.

>
>>> during long running tests, we have encountered strange behaviour  
>>> due to
>>> flow control :
>>>
>>> The queue depth starts to increase linearly for about 2 hours,  
>>> these is
>>> coherent since the message throughput of the single consumer
>>> is not enough to absorb message ingress. Memory occupation grow  
>>> faster as
>>> well, until the memory watermark is reached on the broker side.
>
> Are you sure your consumer is ACK-ing the messages it received?

The Consumer call back does ACK messages upon reception, one at a time  
(multiple == false).
Does the basic.ack() method is eligible to be blocked as well as  
publish() upon flow control ?

>
>>> From that point, the producers are indeed paused, as flow control  
>>> request
>>> has been issued by the broker, but the consumer seems to be blocked
>>> as well. The queue level is flatten at its top value until the end  
>>> of the
>>> test, even when memory occupation lowered under the threshold.
>
> That's how 1.8.1 behaves. In 2.0.0 we introduced swapping out big  
> queues
> to disk, so the memory usage shouldn't be dependent on a queue size.

Good new, because we had identified 2 scenarios in wich memory-based  
channel flow
was triggered :

	- the use of SSL
	- the use of larger message (4kb, same ingress)
Now I hope that the message size will not be that much determinant for  
flow controll,as soon
as consumers are able to handle these message regularly.

>
>>> By registering the FlowListener callback, we have noticed that not  
>>> all of
>>> the producers are notified all the time the alarm handler is set.
>>> Does this mean that the broker applies some heuristic to try not  
>>> to block
>>> every body every time ?
>>> Or does it mean that some of the channels have been somehow  
>>> blacklisted by
>>> the broker ?
>
> No, in 1.8.1 broker should send 'channel.flow' to all the channels.
Strange so, their must be some thing very weird.
>
>>> Could anybody explain how the blocking of consumer is assumed to be
>>> implemented ?
>
> The best description is probably here:
>  http://www.rabbitmq.com/extensions.html#memsup
>
> But it covers 2.0.0. I'd suggest an upgrade to 2.0.0 and monitoring
> not only queue size but also number of unacknowledged messages
> ('Msg unack' in status plugin). This number should be near zero.
>
We are already with 2.0.0.
Where can I find some doc about the Status plugin anyway ?

Cheers, Romary.
> Cheers,
>  Marek Majkowski


From simon at rabbitmq.com  Tue Sep 14 10:21:01 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Sep 2010 10:21:01 +0100
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
In-Reply-To: <AANLkTim5kvZt+Jch=7aVaUr1VujWetAhFvVwAF9jTO_-@mail.gmail.com>
References: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>	<4C8E9716.9090604@rabbitmq.com>
	<AANLkTim5kvZt+Jch=7aVaUr1VujWetAhFvVwAF9jTO_-@mail.gmail.com>
Message-ID: <4C8F3E7D.1000108@rabbitmq.com>

The fix is in -management (but is still being QAed and hasn't been 
merged yet), but to build the management plugin from default you'll need 
everything else from default too I'm afraid.

Cheers, Simon

On 13/09/10 23:05, Stephen Day wrote:
> Thank you for the quick response.
>
> Is the fix in the default rabbitmq branch or the default management branch?
>
> On Mon, Sep 13, 2010 at 2:26 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> On 13/09/10 21:38, Stephen Day wrote:
>>>
>>> After restarting a server with configured durable queues, the web
>>> interface doesn't display the queue information. Please see the
>>> attached screenshot. The numbers don't seem to be available in the API
>>> either:
>>
>> Thanks Stephen. We've actually been aware of this for a while; there should
>> be a fix in the default branch soon.
>>
>> Cheers, Simon
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jon at jbrisbin.com  Tue Sep 14 12:59:45 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 14 Sep 2010 06:59:45 -0500
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
In-Reply-To: <4C8F3E7D.1000108@rabbitmq.com>
References: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>	<4C8E9716.9090604@rabbitmq.com>
	<AANLkTim5kvZt+Jch=7aVaUr1VujWetAhFvVwAF9jTO_-@mail.gmail.com>
	<4C8F3E7D.1000108@rabbitmq.com>
Message-ID: <E32E9190-219D-42B6-86F0-8AC99537E290@jbrisbin.com>

Will there also be a version that works with 2.0.0 release and not trunk? I'd like to get this fix for working in development but I really don't want to develop my app against a broker from trunk.

jb


On Sep 14, 2010, at 4:21 AM, Simon MacMullen wrote:

> The fix is in -management (but is still being QAed and hasn't been merged yet), but to build the management plugin from default you'll need everything else from default too I'm afraid.
> 
> Cheers, Simon
> 
> On 13/09/10 23:05, Stephen Day wrote:
>> Thank you for the quick response.
>> 
>> Is the fix in the default rabbitmq branch or the default management branch?
>> 
>> On Mon, Sep 13, 2010 at 2:26 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>>> On 13/09/10 21:38, Stephen Day wrote:
>>>> 
>>>> After restarting a server with configured durable queues, the web
>>>> interface doesn't display the queue information. Please see the
>>>> attached screenshot. The numbers don't seem to be available in the API
>>>> either:
>>> 
>>> Thanks Stephen. We've actually been aware of this for a while; there should
>>> be a fix in the default branch soon.
>>> 
>>> Cheers, Simon
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
> 
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/ffef67e7/attachment.htm>

From simon at rabbitmq.com  Tue Sep 14 14:10:57 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Sep 2010 14:10:57 +0100
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
In-Reply-To: <E32E9190-219D-42B6-86F0-8AC99537E290@jbrisbin.com>
References: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>	<4C8E9716.9090604@rabbitmq.com>
	<AANLkTim5kvZt+Jch=7aVaUr1VujWetAhFvVwAF9jTO_-@mail.gmail.com>
	<4C8F3E7D.1000108@rabbitmq.com>
	<E32E9190-219D-42B6-86F0-8AC99537E290@jbrisbin.com>
Message-ID: <4C8F7461.9090008@rabbitmq.com>

On 14/09/10 12:59, Jon Brisbin wrote:
> Will there also be a version that works with 2.0.0 release and not
> trunk? I'd like to get this fix for working in development but I really
> don't want to develop my app against a broker from trunk.

Hmm, I'm not sure that's very likely. rabbitmq-management default 
already depends on several changes which have happened on 
rabbitmq-server default...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jon at jbrisbin.com  Tue Sep 14 14:12:54 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 14 Sep 2010 08:12:54 -0500
Subject: [rabbitmq-discuss] Management Console: Doesn't display values
In-Reply-To: <4C8F7461.9090008@rabbitmq.com>
References: <AANLkTinn2YbmV=wyqSwcgGOY-SCBd5dLNCW0oQxzA8Wi@mail.gmail.com>	<4C8E9716.9090604@rabbitmq.com>
	<AANLkTim5kvZt+Jch=7aVaUr1VujWetAhFvVwAF9jTO_-@mail.gmail.com>
	<4C8F3E7D.1000108@rabbitmq.com>
	<E32E9190-219D-42B6-86F0-8AC99537E290@jbrisbin.com>
	<4C8F7461.9090008@rabbitmq.com>
Message-ID: <8A147E20-F108-4B77-B099-46D24220A9F9@jbrisbin.com>


On Sep 14, 2010, at 8:10 AM, Simon MacMullen wrote:

> On 14/09/10 12:59, Jon Brisbin wrote:
>> Will there also be a version that works with 2.0.0 release and not
>> trunk? I'd like to get this fix for working in development but I really
>> don't want to develop my app against a broker from trunk.
> 
> Hmm, I'm not sure that's very likely. rabbitmq-management default already depends on several changes which have happened on rabbitmq-server default...

Bummer...

I was afraid of that.

Ahh well. Adapt and move forward! :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/1771f2b3/attachment.htm>

From davegreggory at yahoo.com  Tue Sep 14 16:11:45 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 14 Sep 2010 08:11:45 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <72349.33530.qm@web111005.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
Message-ID: <408524.76533.qm@web111011.mail.gq1.yahoo.com>

So it happened again this morning. 

rabbitmqctl status, list_connections and list_exchanges worked, but list_queues 
and list_channels hung.

This time there were no errors in the log, unlike the last time. This has been 
quite common, that when it happens there's nothing in the logs. That's why I 
didn't report it any earlier. Very mysterious.

I have attached the output of status, list_connections, dmesg, and lsof from 
both rabbitmq nodes in the cluster.




----- Original Message ----
From: Dave Greggory <davegreggory at yahoo.com>
To: Matthew Sackman <matthew at rabbitmq.com>; rabbitmq-discuss at lists.rabbitmq.com
Sent: Mon, September 13, 2010 11:48:44 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging

Wow... ok.

I'll grab lsof / dmesg / syslog output next time this happens.

Thanks for looking into it. Much appreciated.



----- Original Message ----
From: Matthew Sackman <matthew at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Mon, September 13, 2010 10:53:24 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging

Hi Dave,

Sorry for the delay in getting back to you.

Your node1 log had this in it:

=ERROR REPORT==== 8-Sep-2010::09:45:43 ===
** Generic server <0.29.0> terminating
** Last message in was {'EXIT',<0.30.0>,eio}
** When Server state == {state,user_sup,undefined,<0.30.0>,
                               {<0.29.0>,user_sup}}
** Reason for termination ==
** eio

This is utterly bizarre - we've never seen it before and it was
certainly enough to take down the node1 or at least hang it.

node2 log has:

=ERROR REPORT==== 8-Sep-2010::09:41:38 ===
** Generic server delegate_process_0 terminating
** Last message in was {'$gen_cast',{thunk,#Fun<delegate.4.123807736>}}
** When Server state == no_state
** Reason for termination ==
** {noproc,{gen_server2,call,
                        [{delegate_process_1,'rabbit at ent-jms-qa-1'},
                         {thunk,#Fun<delegate.5.131821234>},
                         infinity]}}

This is basically node2 finding that node1 has gone down. This suggests
(as does your timeline) that node1 actually failed some time previously
but that the immediate error was not logged and only at some later point
did a very generic "eio" come out of it - literally error in some form
of IO operation.

Now the eio comes out of process <0.30.0> which is a process which is
started very early on in the Erlang VM boot process. I can't quite tell
what the user_sup process is meant to be doing - it's so far buried that
there's no documentation for it. It's quite possible you've found a bug
in Erlang itself. Even having googled around for a while, I still can't
really find out what "user" is for - the best I can find is:
"user is a server which responds to all the messages defined in the I/O
interface. The code in user.erl can be used as a model for building
alternative I/O servers." so that's nice and clear. Anyway, my guess is
some error came out of said I/O server, took out user and user_sup which
was then logged. But as to what the fault actually was, I'm afraid I
have no idea.

When this next happens, any chance you could check things like number of
open file descriptors, see if there's any kernel log messages relevant
etc? Sorry I can't be more helpful - it's just not something we've ever
come across before.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node2-status.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0008.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node1-connections.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0009.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node1-dmesg.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0010.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node1-lsof.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0011.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node1-status.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0012.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node2-connections.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0013.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node2-dmesg.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0014.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: node2-lsof.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/60fdefbb/attachment-0015.txt>

From shane at digitalsanctum.com  Tue Sep 14 16:16:58 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 14 Sep 2010 08:16:58 -0700 (PDT)
Subject: [rabbitmq-discuss] mitigating broker and consumer outages
In-Reply-To: <AANLkTinKygyP5SKHcJAfyzS6=Vbs-wxtgOZKf+NUYa7Z@mail.gmail.com>
References: <AANLkTinKygyP5SKHcJAfyzS6=Vbs-wxtgOZKf+NUYa7Z@mail.gmail.com>
Message-ID: <50e7e669-c054-4f68-b97d-ac3fa79382a7@a11g2000vbn.googlegroups.com>

I'm still looking for answers to my questions. Any guidance would be
appreciated.

On Sep 9, 3:59?pm, Shane Witbeck <sh... at digitalsanctum.com> wrote:
> I'm doing some analysis in terms of mitigating outages of rabbit brokers
> and/or consumers. I have the following questions:
>
> ? ?1. I've noticed that all consumers connected to a broker (via Spring
> ? ?AMQP) stop whenever the broker is stopped. Is this behavior expected?
> ? ?2. What's the best practice for doing a complete reset (restarting the
> ? ?broker and consumers)?
> ? ?3. In a system with hundreds of consumers on dozens of machines, it's
> ? ?impractical to restart them by hand. Is there anything out of the box which
> ? ?can facilitate reconnecting consumers to a broker?
>
> TIA
>
> --
> -Shane
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Tue Sep 14 19:38:50 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 14 Sep 2010 13:38:50 -0500
Subject: [rabbitmq-discuss] makefile for rabbitmq-management
Message-ID: <1C9929D2-AE7C-43BD-B136-3BC683FE4C87@jbrisbin.com>

For the mailling list archives:

If you do a fresh checkout of the public umbrella to build the management plugin, going into rabbitmq-management then "make" fails because it doesn't automagically build the dependencies. You have to manually build amqp_client and mochiweb before building management.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/df0b1fbd/attachment.htm>

From nfontes at cynigram.com  Tue Sep 14 20:13:38 2010
From: nfontes at cynigram.com (Noah Fontes)
Date: Tue, 14 Sep 2010 14:13:38 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <408524.76533.qm@web111011.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>	<20100913145324.GC15229@rabbitmq.com>	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
Message-ID: <4C8FC962.2040401@cynigram.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello Dave,

On 09/14/2010 10:11 AM, Dave Greggory wrote:
> So it happened again this morning. 
> 
> rabbitmqctl status, list_connections and list_exchanges worked, but list_queues 
> and list_channels hung.
> 
> This time there were no errors in the log, unlike the last time. This has been 
> quite common, that when it happens there's nothing in the logs. That's why I 
> didn't report it any earlier. Very mysterious.

This is quite interesting. We observed this behavior as well --
list_queues and list_channels hanging. This was also reflected in
consumers/publishers: we could publish messages fine, but trying to read
from a queue (or even delete one) would hang usually indefinitely.

We also noted that if we repeatedly attempted to run list_queues the RPC
call would eventually succeed -- maybe once out of 10 or 15 runs. With
the exception of certain queues building up with messages (as I
mentioned above) everything looked fine.

It started when we switched from 1.7.x to 1.8.x (which we're still
running for the moment). It only seems to happen when nodes are
clustered; I've never seen the problem on a non-clustered instance.

I'll try to grab some more information when/if it happens again for us.

I also haven't seen the issue occur in probably about 3 weeks now. It's
very sporadic, although I think I've seen it happen more than once in a
day (and then not again for a long time).

> I have attached the output of status, list_connections, dmesg, and lsof from 
> both rabbitmq nodes in the cluster.

FWIW, here's the minimal information I can offer now:

- - We have a four-node cluster of two disk nodes and two memory nodes
across two physical servers.
- - We're running RabbitMQ 1.8.1 with no additional plugins:
{rabbit,"RabbitMQ","1.8.1"},
{mnesia,"MNESIA  CXC 138 12","4.4.13"},
{os_mon,"CPO  CXC 138 46","2.2.5"},
{sasl,"SASL  CXC 138 11","2.1.9"},
{stdlib,"ERTS  CXC 138 10","1.16.5"},
{kernel,"ERTS  CXC 138 10","2.13.5"}

This is erlang R13B04 on SuSE Linux.

Hopefully this can shed a *little* more light on the problem. Sorry I
can't offer more details at the moment.

Regards,

Noah

> ----- Original Message ----
> From: Dave Greggory <davegreggory at yahoo.com>
> To: Matthew Sackman <matthew at rabbitmq.com>; rabbitmq-discuss at lists.rabbitmq.com
> Sent: Mon, September 13, 2010 11:48:44 AM
> Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
> 
> Wow... ok.
> 
> I'll grab lsof / dmesg / syslog output next time this happens.
> 
> Thanks for looking into it. Much appreciated.
> 
> 
> 
> ----- Original Message ----
> From: Matthew Sackman <matthew at rabbitmq.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Mon, September 13, 2010 10:53:24 AM
> Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
> 
> Hi Dave,
> 
> Sorry for the delay in getting back to you.
> 
> Your node1 log had this in it:
> 
> =ERROR REPORT==== 8-Sep-2010::09:45:43 ===
> ** Generic server <0.29.0> terminating
> ** Last message in was {'EXIT',<0.30.0>,eio}
> ** When Server state == {state,user_sup,undefined,<0.30.0>,
>                                {<0.29.0>,user_sup}}
> ** Reason for termination ==
> ** eio
> 
> This is utterly bizarre - we've never seen it before and it was
> certainly enough to take down the node1 or at least hang it.
> 
> node2 log has:
> 
> =ERROR REPORT==== 8-Sep-2010::09:41:38 ===
> ** Generic server delegate_process_0 terminating
> ** Last message in was {'$gen_cast',{thunk,#Fun<delegate.4.123807736>}}
> ** When Server state == no_state
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,
>                         [{delegate_process_1,'rabbit at ent-jms-qa-1'},
>                          {thunk,#Fun<delegate.5.131821234>},
>                          infinity]}}
> 
> This is basically node2 finding that node1 has gone down. This suggests
> (as does your timeline) that node1 actually failed some time previously
> but that the immediate error was not logged and only at some later point
> did a very generic "eio" come out of it - literally error in some form
> of IO operation.
> 
> Now the eio comes out of process <0.30.0> which is a process which is
> started very early on in the Erlang VM boot process. I can't quite tell
> what the user_sup process is meant to be doing - it's so far buried that
> there's no documentation for it. It's quite possible you've found a bug
> in Erlang itself. Even having googled around for a while, I still can't
> really find out what "user" is for - the best I can find is:
> "user is a server which responds to all the messages defined in the I/O
> interface. The code in user.erl can be used as a model for building
> alternative I/O servers." so that's nice and clear. Anyway, my guess is
> some error came out of said I/O server, took out user and user_sup which
> was then logged. But as to what the fault actually was, I'm afraid I
> have no idea.
> 
> When this next happens, any chance you could check things like number of
> open file descriptors, see if there's any kernel log messages relevant
> etc? Sorry I can't be more helpful - it's just not something we've ever
> come across before.
> 
> Matthew
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkyPyWEACgkQhitK+HuUQJRLpwCgnYY/YF8xTUW8xowocWKKPzbJ
BzUAn1aRtruRAgp/23v4mZB1JJXrBIaE
=CEzP
-----END PGP SIGNATURE-----

From cal.leeming at simplicitymedialtd.co.uk  Tue Sep 14 20:15:37 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Tue, 14 Sep 2010 20:15:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <4C8FC962.2040401@cynigram.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
Message-ID: <AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>

Just a quick thing, but I have also noticed this behaviour on both 1.8 and
2.0, when being used with Celery.

I don't know why it happens, the error log shows nothing has gone wrong....

In the end I had to abandon RabbitMQ because of this :/

On Tue, Sep 14, 2010 at 8:13 PM, Noah Fontes <nfontes at cynigram.com> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hello Dave,
>
> On 09/14/2010 10:11 AM, Dave Greggory wrote:
> > So it happened again this morning.
> >
> > rabbitmqctl status, list_connections and list_exchanges worked, but
> list_queues
> > and list_channels hung.
> >
> > This time there were no errors in the log, unlike the last time. This has
> been
> > quite common, that when it happens there's nothing in the logs. That's
> why I
> > didn't report it any earlier. Very mysterious.
>
> This is quite interesting. We observed this behavior as well --
> list_queues and list_channels hanging. This was also reflected in
> consumers/publishers: we could publish messages fine, but trying to read
> from a queue (or even delete one) would hang usually indefinitely.
>
> We also noted that if we repeatedly attempted to run list_queues the RPC
> call would eventually succeed -- maybe once out of 10 or 15 runs. With
> the exception of certain queues building up with messages (as I
> mentioned above) everything looked fine.
>
> It started when we switched from 1.7.x to 1.8.x (which we're still
> running for the moment). It only seems to happen when nodes are
> clustered; I've never seen the problem on a non-clustered instance.
>
> I'll try to grab some more information when/if it happens again for us.
>
> I also haven't seen the issue occur in probably about 3 weeks now. It's
> very sporadic, although I think I've seen it happen more than once in a
> day (and then not again for a long time).
>
> > I have attached the output of status, list_connections, dmesg, and lsof
> from
> > both rabbitmq nodes in the cluster.
>
> FWIW, here's the minimal information I can offer now:
>
> - - We have a four-node cluster of two disk nodes and two memory nodes
> across two physical servers.
> - - We're running RabbitMQ 1.8.1 with no additional plugins:
> {rabbit,"RabbitMQ","1.8.1"},
> {mnesia,"MNESIA  CXC 138 12","4.4.13"},
> {os_mon,"CPO  CXC 138 46","2.2.5"},
> {sasl,"SASL  CXC 138 11","2.1.9"},
> {stdlib,"ERTS  CXC 138 10","1.16.5"},
> {kernel,"ERTS  CXC 138 10","2.13.5"}
>
> This is erlang R13B04 on SuSE Linux.
>
> Hopefully this can shed a *little* more light on the problem. Sorry I
> can't offer more details at the moment.
>
> Regards,
>
> Noah
>
> > ----- Original Message ----
> > From: Dave Greggory <davegreggory at yahoo.com>
> > To: Matthew Sackman <matthew at rabbitmq.com>;
> rabbitmq-discuss at lists.rabbitmq.com
> > Sent: Mon, September 13, 2010 11:48:44 AM
> > Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
> >
> > Wow... ok.
> >
> > I'll grab lsof / dmesg / syslog output next time this happens.
> >
> > Thanks for looking into it. Much appreciated.
> >
> >
> >
> > ----- Original Message ----
> > From: Matthew Sackman <matthew at rabbitmq.com>
> > To: rabbitmq-discuss at lists.rabbitmq.com
> > Sent: Mon, September 13, 2010 10:53:24 AM
> > Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
> >
> > Hi Dave,
> >
> > Sorry for the delay in getting back to you.
> >
> > Your node1 log had this in it:
> >
> > =ERROR REPORT==== 8-Sep-2010::09:45:43 ===
> > ** Generic server <0.29.0> terminating
> > ** Last message in was {'EXIT',<0.30.0>,eio}
> > ** When Server state == {state,user_sup,undefined,<0.30.0>,
> >                                {<0.29.0>,user_sup}}
> > ** Reason for termination ==
> > ** eio
> >
> > This is utterly bizarre - we've never seen it before and it was
> > certainly enough to take down the node1 or at least hang it.
> >
> > node2 log has:
> >
> > =ERROR REPORT==== 8-Sep-2010::09:41:38 ===
> > ** Generic server delegate_process_0 terminating
> > ** Last message in was {'$gen_cast',{thunk,#Fun<delegate.4.123807736>}}
> > ** When Server state == no_state
> > ** Reason for termination ==
> > ** {noproc,{gen_server2,call,
> >                         [{delegate_process_1,'rabbit at ent-jms-qa-1'},
> >                          {thunk,#Fun<delegate.5.131821234>},
> >                          infinity]}}
> >
> > This is basically node2 finding that node1 has gone down. This suggests
> > (as does your timeline) that node1 actually failed some time previously
> > but that the immediate error was not logged and only at some later point
> > did a very generic "eio" come out of it - literally error in some form
> > of IO operation.
> >
> > Now the eio comes out of process <0.30.0> which is a process which is
> > started very early on in the Erlang VM boot process. I can't quite tell
> > what the user_sup process is meant to be doing - it's so far buried that
> > there's no documentation for it. It's quite possible you've found a bug
> > in Erlang itself. Even having googled around for a while, I still can't
> > really find out what "user" is for - the best I can find is:
> > "user is a server which responds to all the messages defined in the I/O
> > interface. The code in user.erl can be used as a model for building
> > alternative I/O servers." so that's nice and clear. Anyway, my guess is
> > some error came out of said I/O server, took out user and user_sup which
> > was then logged. But as to what the fault actually was, I'm afraid I
> > have no idea.
> >
> > When this next happens, any chance you could check things like number of
> > open file descriptors, see if there's any kernel log messages relevant
> > etc? Sorry I can't be more helpful - it's just not something we've ever
> > come across before.
> >
> > Matthew
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
>
> iEYEARECAAYFAkyPyWEACgkQhitK+HuUQJRLpwCgnYY/YF8xTUW8xowocWKKPzbJ
> BzUAn1aRtruRAgp/23v4mZB1JJXrBIaE
> =CEzP
> -----END PGP SIGNATURE-----
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
*IM: *AIM / ICQ / MSN / Skype (available upon request)
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/481c998f/attachment-0001.htm>

From davegreggory at yahoo.com  Tue Sep 14 20:58:27 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 14 Sep 2010 12:58:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
Message-ID: <77712.94210.qm@web111015.mail.gq1.yahoo.com>

Noah and Cal, thanks for letting us know that you've seen something similar.

We noticed it on our 2-node disk-node cluster (on both 1.8.1 and 2.0.0) running 
on Erlang 13B04 under Centos Linux on VMWare VM.

Cal, you're right, this is pretty serious and RabbitMQ is kind of getting a bad 
rep in our organization because of this (undeservedly so, in my opinion, its way 
better than other message brokers, but it's hard to fight the good fight when 
appearance is everything).


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/207a59a7/attachment.htm>

From cal.leeming at simplicitymedialtd.co.uk  Tue Sep 14 21:02:13 2010
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Tue, 14 Sep 2010 21:02:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <77712.94210.qm@web111015.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
Message-ID: <AANLkTik2rbCAcUDbR81O_MxDaimyWef=Zh3YvS609o23@mail.gmail.com>

Just so you all know, I had previously diagnosed the problem as being the
persister not supporting flush to disk, as you'll see from a rather lengthy
thread a month or so ago.

However, upon switching to 2.0, although it managed to stay alive for
longer, it did still eventually freeze up.

This was with 64 celeryd workers, both consuming and producing on the same
publisher.

It managed to stay alive with 4, but if I increased it any more than that,
it froze after a few minutes/hours.

On Tue, Sep 14, 2010 at 8:58 PM, Dave Greggory <davegreggory at yahoo.com>wrote:

> Noah and Cal, thanks for letting us know that you've seen something
> similar.
>
> We noticed it on our 2-node disk-node cluster (on both 1.8.1 and 2.0.0)
> running on Erlang 13B04 under Centos Linux on VMWare VM.
>
> Cal, you're right, this is pretty serious and RabbitMQ is kind of getting a
> bad rep in our organization because of this (undeservedly so, in my opinion,
> its way better than other message brokers, but it's hard to fight the good
> fight when appearance is everything).
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

Cal Leeming

Operational Security & Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
support at simplicitymedialtd.co.uk
*Fax: *+44 (02476) 578987 | *Email: *cal.leeming at simplicitymedialtd.co.uk
*IM: *AIM / ICQ / MSN / Skype (available upon request)
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/ab72c359/attachment.htm>

From shaneman at adobe.com  Tue Sep 14 21:28:21 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Tue, 14 Sep 2010 13:28:21 -0700
Subject: [rabbitmq-discuss] HA and database schema changes
Message-ID: <A1CB3D904533654CB64599397AC43ADE013D443ACEBD@NAMBX02.corp.adobe.com>

Hello,

I was looking over the release notes for "Release: RabbitMQ 2.0.0" and saw the following:

http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20100825/2c672695/attachment.txt

Upgrading
=========
The database schema and the format in which persistent messages are
stored have both changed since the last release (1.8.1). When
starting, the RabbitMQ server will detect the existence of an old
database and will move it to a backup location, before creating a
fresh, empty database, and will log a warning. If your RabbitMQ
installation contains important data then we recommend you contact
support at ... for assistance with the upgrade.

We are considering deploying a HA RabbitMQ cluster with Pacemaker and DRBD.  HA is very important for us.
If there is a database schema change in the future, specifically what is the process for the upgrade and how does it affect HA during the upgrade?
Also during the upgrade, how do we maintain durable exchanges and queues?

Thanks,
   Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/f5bcc372/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 14 21:36:52 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 14 Sep 2010 21:36:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <77712.94210.qm@web111015.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>	<20100913145324.GC15229@rabbitmq.com>	<72349.33530.qm@web111005.mail.gq1.yahoo.com>	<408524.76533.qm@web111011.mail.gq1.yahoo.com>	<4C8FC962.2040401@cynigram.com>	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
Message-ID: <4C8FDCE4.6050209@rabbitmq.com>

Dave, Noah, Cal,

Dave Greggory wrote:
> Noah and Cal, thanks for letting us know that you've seen something
> similar.

Could any of you give us access to your rabbit while it is exhibiting 
this problem?


Regards,

Matthias.

From davegreggory at yahoo.com  Tue Sep 14 22:23:28 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 14 Sep 2010 14:23:28 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <4C8FDCE4.6050209@rabbitmq.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
	<4C8FDCE4.6050209@rabbitmq.com>
Message-ID: <629763.47711.qm@web111015.mail.gq1.yahoo.com>

I wish I could give you access, but it's easier said than done due to both 
environment and security policies. I'm trying to get you access, but it'd be 
hell of a lot easier if you can tell me what to look for (troubleshooting steps) 
and all the data points (rabbitmq, erlang, linux kernel, VM) you need. 




----- Original Message ----
From: Matthias Radestock <matthias at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tue, September 14, 2010 4:36:52 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging

Dave, Noah, Cal,

Dave Greggory wrote:
> Noah and Cal, thanks for letting us know that you've seen something
> similar.

Could any of you give us access to your rabbit while it is exhibiting this 
problem?


Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      

From jasonjwwilliams at gmail.com  Tue Sep 14 22:59:39 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Sep 2010 15:59:39 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <629763.47711.qm@web111015.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
	<4C8FDCE4.6050209@rabbitmq.com>
	<629763.47711.qm@web111015.mail.gq1.yahoo.com>
Message-ID: <AANLkTi=46cBv7NtyKaHdMTHZpUpfpwJghboAmBevxU3G@mail.gmail.com>

Maybe a copilot.com session into Dave's workstation when he's SSH'd
in? Then nobody has to share credentials.

-J

On Tue, Sep 14, 2010 at 3:23 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
> I wish I could give you access, but it's easier said than done due to both
> environment and security policies. I'm trying to get you access, but it'd be
> hell of a lot easier if you can tell me what to look for (troubleshooting steps)
> and all the data points (rabbitmq, erlang, linux kernel, VM) you need.
>
>
>
>
> ----- Original Message ----
> From: Matthias Radestock <matthias at rabbitmq.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tue, September 14, 2010 4:36:52 PM
> Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
>
> Dave, Noah, Cal,
>
> Dave Greggory wrote:
>> Noah and Cal, thanks for letting us know that you've seen something
>> similar.
>
> Could any of you give us access to your rabbit while it is exhibiting this
> problem?
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Wed Sep 15 07:28:47 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 15 Sep 2010 14:28:47 +0800
Subject: [rabbitmq-discuss] new fork of php-amqplib on github
Message-ID: <BF216058-8FC5-47CC-BC86-7C7926C8BFD7@gmail.com>

Hi guys,

At TheNetCircle we have released our fork of the php-amplib library: http://github.com/tnc/php-amqplib

Sorry for adding more divergence to the status of PHP libraries for accessing RabbitMQ, but here are our reasons:

- We started using RabbitMQ more than one year ago, at that time the choices where this library or using STOMP. The STOMP library for PHP had problems accessing RabbitMQ because it was written with ActiveMQ in mind. So we choose this AMQP library: http://code.google.com/p/php-amqplib/ 

- The AMQP lib had several problems, the main one being that it wasn't compliant with PHP 5.2 STRICT, and when we moved our servers to PHP 5.3 we found even more problems. All those were fixed.

- The way the library used the error_log to "echo" was quite buggy, mostly to use the lib with fastcgi and Nginx. So that's also changed. There's a constant also that if defined will enable "echoing" those logs to standard output. The constant is AMQP_DEBUG. Also we did some performance optimizations in that area.

- We fixed some bugs related to how to set connections time out.

- For different reasons we never sent back our fixes to the original repo. 

- You may ask why we are not using the http://cn.php.net/amqp library? The answer is simple it wasn't there when we started using RabbitMQ. Also the one that we use handle our workload with no problems. To change to the C Extension will mean changing a lot of code.

Regards,

Alvaro

From josua.troesch at bluewin.ch  Wed Sep 15 11:34:01 2010
From: josua.troesch at bluewin.ch (josua.troesch at bluewin.ch)
Date: Wed, 15 Sep 2010 10:34:01 +0000 (GMT)
Subject: [rabbitmq-discuss] RabbitMQ keeps crashing,
	wrong rabbitmqctl nodedown
Message-ID: <1350837.77261284546841125.JavaMail.webmail@ps15zhb.bluewin.ch>

Hi,

Our RabbitMQ instance keeps crashing with an error like this:
eheap_alloc: Cannot allocate 373662860 bytes of 
memory (of type "old_heap")

Its still a version 1.6.0 but because of some application constraints we can't update yet. 
Also, I can't check the status with rabbitmqctl as this always reports a {badrpc,nodedown}

The crash dump is too long 
to post here, starts like this:

=erl_crash_dump:0.1
Wed Sep 15 10:37:25 2010
Slogan: eheap_alloc: Cannot allocate 
373662860 bytes of memory (of type "old_heap").
System version: Erlang R13B01 (erts-5.7.2) [smp:8:8] [rq:8] [async-
threads:30]
Compiled: Sun Jun  7 19:22:30 2009

rabbit-sasl.log reports this crash dump:

=CRASH REPORT==== 15-Sep-
2010::12:11:19 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.1559.0>
    registered_name: []
    exception 
exit: {writer,send_failed,badarg}
      in function  gen_server2:terminate/6
    ancestors: [<0.1558.0>]
    messages: 
[{'EXIT',<0.1558.0>,normal}]
    links: []
    dictionary: [{permission_cache,
                      [{{resource,<<"
/prd">>,queue,
                            <<"amq.gen-U0srCoW8TsaXjNh73pnVAw==">>},
                        read},

                       {{resource,<<"/prd">>,exchange,
                            <<"myapp">>},

                        read},
                       {{resource,<<"/prd">>,queue,
                            <<"amq.
gen-U0srCoW8TsaXjNh73pnVAw==">>},
                        write},
                       {{resource,<<"/prd">>,
exchange,
                            <<"myapp">>},
                        configure},
                       
{{resource,<<"/prd">>,queue,
                            <<"amq.gen-U0srCoW8TsaXjNh73pnVAw==">>},

                        configure}]},
                  {guid,{{177,<0.1559.0>},3}}]
    trap_exit: true
    status: 
running
    heap_size: 17711
    stack_size: 24
    reductions: 72448611
  neighbours:

Thanks for any hints!

From david at rabbitmq.com  Wed Sep 15 12:28:12 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 15 Sep 2010 12:28:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ keeps crashing,
	wrong rabbitmqctl nodedown
In-Reply-To: <1350837.77261284546841125.JavaMail.webmail@ps15zhb.bluewin.ch>
	(josua's message of "Wed, 15 Sep 2010 10:34:01 +0000 (GMT)")
References: <1350837.77261284546841125.JavaMail.webmail@ps15zhb.bluewin.ch>
Message-ID: <yrv4ck4mnqm9f.fsf@dwragg.eng.vmware.com>

Hi Josua,

"josua.troesch at bluewin.ch" <josua.troesch at bluewin.ch> writes:
> Our RabbitMQ instance keeps crashing with an error like this:
> eheap_alloc: Cannot allocate 373662860 bytes of 
> memory (of type "old_heap")

This indicates that rabbit is running out of memory.  

The normal approach to this kind of problem is to use rabbitmqctl to
find out where the messages are that are taking up your memory.

> Its still a version 1.6.0 but because of some application constraints
> we can't update yet. 

1.6.0 is really really old, and the handling of memory constraints has
been greatly improved since then.  What kind of application constraints
are preventing you upgrading?

> Also, I can't check the status with rabbitmqctl as this always reports
> a {badrpc,nodedown}

Even before the server crash (or does the crash happen when you start
rabbitmq-server)?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vlad at rabbitmq.com  Wed Sep 15 12:51:27 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 15 Sep 2010 12:51:27 +0100
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
In-Reply-To: <509856.68626.qm@web111016.mail.gq1.yahoo.com>
References: <509856.68626.qm@web111016.mail.gq1.yahoo.com>
Message-ID: <4C90B33F.6090002@rabbitmq.com>


Hi Dave,

AFAIK, the event should fire regardless of the shutdown reason (be it 
connection loss, server initiated connection close, sudden socket 
closed, heartbeat timeout etc.). It appears to me that you are using it 
correctly.

Depending on the type of load balancer you are using, perhaps the 
clients never got disconnected? It is also possible that there is a bug 
in the client code.

Rgds,
Vlad.


On 09/13/2010 04:12 PM, Dave Greggory wrote:
> We register a shutdown listener to listen for connection-loss events and
> automatically re-connect clients to other RabbitMQ nodes in the cluster. This
> weekend we had to restart the load balancer that sits between rabbitmq and it's
> clients for some maintenance, but the ShutdownCompleted/ShutdownSignalException
> event never fired in the clients.
>
>
> I'm trying to understand how the shutdown signal works. Does it only fire the
> ShutDownCompleted event if RabbitMQ node shuts down and sends the signal back to
> clients? If that's the case, I'm probably misusing it to detect connection-loss.
> Is there a different way of detecting connection loss?
>
> Thanks,
> Dave
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From mikeb at rabbitmq.com  Wed Sep 15 12:55:02 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 15 Sep 2010 12:55:02 +0100
Subject: [rabbitmq-discuss] mitigating broker and consumer outages
In-Reply-To: <50e7e669-c054-4f68-b97d-ac3fa79382a7@a11g2000vbn.googlegroups.com>
References: <AANLkTinKygyP5SKHcJAfyzS6=Vbs-wxtgOZKf+NUYa7Z@mail.gmail.com>
	<50e7e669-c054-4f68-b97d-ac3fa79382a7@a11g2000vbn.googlegroups.com>
Message-ID: <4C90B416.6050801@rabbitmq.com>

Hi Shane,

>>    1. I've noticed that all consumers connected to a broker (via Spring
>>    AMQP) stop whenever the broker is stopped. Is this behavior expected?

They will stop in the sense that when the connection to the broker is 
dropped, it is not automatically picked up again (well I don't think so, 
I've not looked at spring-amqp specifically).

Automatic reconnection is something that could certainly be built into 
clients (but isn't, in the case of our Java client) and applications, 
but it's not without difficulty -- see below.

>>    2. What's the best practice for doing a complete reset (restarting the
>>    broker and consumers)?

I don't know if there's a commonly understood best practice for how to 
restart consumers (especially lots of consumers) -- perhaps people on 
the list have tactics that work well for them?

Very broadly, I would expect that an orderly reset is best accomplished 
by stopping producers, then consumers, then the broker; and the reverse 
for starting up.

With regard to your application, if you are reconnecting, your 
application must be prepared to be delivered messages that it's already 
seen.  The reason is that messages that weren't acknowledged will be 
returned to the queue on channel close, and redelivered when there are 
again consumers.

In the case of multiple consumers (e.g., if you are using a shared queue 
to load-balance work items), this also means that messages may not be 
distributed among consumers in the same way as before.

Usually this means making work items either transient (in which case, 
you use no_ack=true when consuming) or idempotent (e.g., by having a 
de-duplication filter).

In the pub-sub case you probably either don't care if you're delivered 
messages more than once anyway, or are happy to miss messages.

>>    3. In a system with hundreds of consumers on dozens of machines, it's
>>    impractical to restart them by hand. Is there anything out of the box which
>>    can facilitate reconnecting consumers to a broker?

Rabbit will try very hard to shut connections down in an orderly fashion 
when you stop it.  For that reason, you can generally rely on having a 
known state in your application.  Hence it is reasonable to expect to 
simply respond to the AMQP connection closing by throwing away work in 
progress, and trying to reconnect (with a backoff).  But, as above, the 
details will depend very much on your application.


HTH,
Michael

From vlad at rabbitmq.com  Wed Sep 15 13:03:25 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 15 Sep 2010 13:03:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ not responding / not sending any
 errors	to client
In-Reply-To: <4C8E3608.5080204@stresstiming.de>
References: <4C8E3608.5080204@stresstiming.de>
Message-ID: <4C90B60D.4000109@rabbitmq.com>


Hi,


If the broker is overwhelmed by a producer, it sends a channel.flow 
command to the client, telling it to stop sending content. Our clients 
respond automatically to that message and block further publishes from 
the user application until the broker says it's ok to do so.

If you want to detect when that happens in your program, you need to use 
Channel.setFlowListener to listen to channel.flow events.

Conversely, if you are consuming from the broker and the amount of 
messages overwhelm your application, you can use Channel.flow(false) to 
pause the broker from sending and then Channel.flow(true) to resume.


Rgds,
Vlad.




On 09/13/2010 03:32 PM, diez wrote:
> Hi,
>
> we are evaluating Rabbit as a solution for huge high performance and
> high load environment.
> During our tests we found encountered some problems with the clients we
> used.
>
> Our Environment consists of the following:
>
> RabbitMQ using the new persister (version 2.0.0)
> Debian Linux Lenny 5.0 (without any special tweaks)
> Consumer and Producer written in Java with the spring-source generic
> library (2.0.0) taken from rabbitmq website.
>
> Our primary concern:
>
> When the RabbitMQ Server runs into the vm_memory_high_watermark (or any
> other load related issue) it does NOT communicate this to the clients.
> We are not able to detect this failure on the client side. Obviously
> there is a mechanism included in the Java client that seems to be the
> right place to implement code to deal with this situation.
>
>
>          channel.setReturnListener(new ReturnListener() {
>
>                  @Override
>                  public void handleBasicReturn(int arg0, String arg1,
> String arg2,
>                          String arg3, BasicProperties arg4, byte[] arg5)
> throws IOException {
>
>                      System.out.println("Error: " + arg1);
>                  }
>              });
>
>
> If we run into the situation descibed above the ReturnListener isn't
> invoked at all. Please note: The Server  (better the OTP Environment) is
> configured not to consume all the systems memory, we decreased the
> vm_memory_high_watermark to a realtively low level of some megs. So the
> underlying operation system should not be the problem.
>
> Is it necessary to configure the server in a special way to make this
> work or are we missing anything else?
>
> Sincerely your's
>
> Dieter Schmidt
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From abhishek.kona at gmail.com  Wed Sep 15 13:14:33 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 15 Sep 2010 17:44:33 +0530
Subject: [rabbitmq-discuss] A wiki page for EC2 installation of RabbitMQ
	with EBS
Message-ID: <4C90B8A9.7040101@gmail.com>

  Hi

I would like to create a similar page to 
http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1663 for 
installing RabbitMQ on EC2 instances with RabbitMQ.

On the wiki,

How can we edit the wiki right now?

Abhishek Kona

From isaias at madiva.com  Wed Sep 15 13:19:02 2010
From: isaias at madiva.com (=?ISO-8859-1?Q?Isa=EDas_Espejo_Badia?=)
Date: Wed, 15 Sep 2010 14:19:02 +0200
Subject: [rabbitmq-discuss] Admin client java
Message-ID: <AANLkTi=2vuNqWZvAnWasFxEfUdA4U+bDhqc3mOs0+jHM@mail.gmail.com>

Hello,

I am using the java client to rabbitmq and the queues work very well
I have three queues.
I know that I can see this with the command "rabbitmqctl  list_queues" in
the server but I need create a proccess in java that check how many elements
there are in each queue.

I am searching in the java client and I don?t have found any way to do this
Does it exist any client java to use administration command?

Regards,
Isaias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/e5030f99/attachment.htm>

From emile at rabbitmq.com  Wed Sep 15 13:25:52 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Sep 2010 13:25:52 +0100
Subject: [rabbitmq-discuss] Admin client java
In-Reply-To: <AANLkTi=2vuNqWZvAnWasFxEfUdA4U+bDhqc3mOs0+jHM@mail.gmail.com>
References: <AANLkTi=2vuNqWZvAnWasFxEfUdA4U+bDhqc3mOs0+jHM@mail.gmail.com>
Message-ID: <4C90BB50.9030407@rabbitmq.com>

Hi Isa?as,

On 15/09/10 13:19, Isa?as Espejo Badia wrote:
> Hello, 
> 
> I am using the java client to rabbitmq and the queues work very well 
> I have three queues. 
> I know that I can see this with the command "rabbitmqctl  list_queues"
> in the server but I need create a proccess in java that check how many
> elements there are in each queue.
> 
> I am searching in the java client and I don?t have found any way to do this
> Does it exist any client java to use administration command?


You can obtain a count of the number of items in a queue via AMQP by
redeclaring the queue and calling DeclareOk.getMessageCount().


-Emile

From vlad at rabbitmq.com  Wed Sep 15 13:28:21 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 15 Sep 2010 13:28:21 +0100
Subject: [rabbitmq-discuss] Admin client java
In-Reply-To: <AANLkTi=2vuNqWZvAnWasFxEfUdA4U+bDhqc3mOs0+jHM@mail.gmail.com>
References: <AANLkTi=2vuNqWZvAnWasFxEfUdA4U+bDhqc3mOs0+jHM@mail.gmail.com>
Message-ID: <4C90BBE5.8020104@rabbitmq.com>


Hi Isaias,


AFAIK, there is no way to list the queues declared on the broker 
directly from Java.

But there is a way of getting the number of messages in a given queue 
(provided that you know its name). Redeclare the Queue, setting only its 
name and passive=true, and then inspect the DeclareOk.getMessageCount() 
to get the number of messages.


Rgds,
Vlad.



On 09/15/2010 01:19 PM, Isa?as Espejo Badia wrote:
> Hello,
>
> I am using the java client to rabbitmq and the queues work very well
> I have three queues.
> I know that I can see this with the command "rabbitmqctl  list_queues" 
> in the server but I need create a proccess in java that check how many 
> elements there are in each queue.
>
> I am searching in the java client and I don?t have found any way to do 
> this
> Does it exist any client java to use administration command?
>
> Regards,
> Isaias
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/4e796e45/attachment-0001.htm>

From vlad at rabbitmq.com  Wed Sep 15 13:29:09 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 15 Sep 2010 13:29:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ not responding / not sending any
 errors	to client
In-Reply-To: <4C90B60D.4000109@rabbitmq.com>
References: <4C8E3608.5080204@stresstiming.de> <4C90B60D.4000109@rabbitmq.com>
Message-ID: <4C90BC15.1000706@rabbitmq.com>


Actually RabbitMQ 2.0.0 doesn't use channel.flow any more. It uses TCP 
back-pressure instead.

Also, since it is using the persister, RabbitMQ will not be limited by 
the amount of memory; it is only bounded by disk space.

So there is no failure to be detect there.


Rgds,
Vlad.



On 09/15/2010 01:03 PM, Vlad Alexandru Ionescu wrote:
>
> Hi,
>
>
> If the broker is overwhelmed by a producer, it sends a channel.flow 
> command to the client, telling it to stop sending content. Our clients 
> respond automatically to that message and block further publishes from 
> the user application until the broker says it's ok to do so.
>
> If you want to detect when that happens in your program, you need to 
> use Channel.setFlowListener to listen to channel.flow events.
>
> Conversely, if you are consuming from the broker and the amount of 
> messages overwhelm your application, you can use Channel.flow(false) 
> to pause the broker from sending and then Channel.flow(true) to resume.
>
>
> Rgds,
> Vlad.
>
>
>
>
> On 09/13/2010 03:32 PM, diez wrote:
>> Hi,
>>
>> we are evaluating Rabbit as a solution for huge high performance and
>> high load environment.
>> During our tests we found encountered some problems with the clients we
>> used.
>>
>> Our Environment consists of the following:
>>
>> RabbitMQ using the new persister (version 2.0.0)
>> Debian Linux Lenny 5.0 (without any special tweaks)
>> Consumer and Producer written in Java with the spring-source generic
>> library (2.0.0) taken from rabbitmq website.
>>
>> Our primary concern:
>>
>> When the RabbitMQ Server runs into the vm_memory_high_watermark (or any
>> other load related issue) it does NOT communicate this to the clients.
>> We are not able to detect this failure on the client side. Obviously
>> there is a mechanism included in the Java client that seems to be the
>> right place to implement code to deal with this situation.
>>
>>
>>          channel.setReturnListener(new ReturnListener() {
>>
>>                  @Override
>>                  public void handleBasicReturn(int arg0, String arg1,
>> String arg2,
>>                          String arg3, BasicProperties arg4, byte[] arg5)
>> throws IOException {
>>
>>                      System.out.println("Error: " + arg1);
>>                  }
>>              });
>>
>>
>> If we run into the situation descibed above the ReturnListener isn't
>> invoked at all. Please note: The Server  (better the OTP Environment) is
>> configured not to consume all the systems memory, we decreased the
>> vm_memory_high_watermark to a realtively low level of some megs. So the
>> underlying operation system should not be the problem.
>>
>> Is it necessary to configure the server in a special way to make this
>> work or are we missing anything else?
>>
>> Sincerely your's
>>
>> Dieter Schmidt
>>
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mikeb at rabbitmq.com  Wed Sep 15 13:42:17 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 15 Sep 2010 13:42:17 +0100
Subject: [rabbitmq-discuss] A wiki page for EC2 installation of RabbitMQ
 with EBS
In-Reply-To: <4C90B8A9.7040101@gmail.com>
References: <4C90B8A9.7040101@gmail.com>
Message-ID: <4C90BF29.3020705@rabbitmq.com>

Hi Abhishek,

> I would like to create a similar page to 
> http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1663 
> for installing RabbitMQ on EC2 instances with RabbitMQ.

That would be fantastic, thank you.
Bear in mind that there is already http://www.rabbitmq.com/ec2.html 
(though I see it is no longer directly linked from our homepage).

> On the wiki,
> 
> How can we edit the wiki right now?

Which wiki do you mean?

Regards,
Michael

From abhishek.kona at gmail.com  Wed Sep 15 13:49:01 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 15 Sep 2010 18:19:01 +0530
Subject: [rabbitmq-discuss] A wiki page for EC2 installation of RabbitMQ
 with EBS
In-Reply-To: <4C90BF29.3020705@rabbitmq.com>
References: <4C90B8A9.7040101@gmail.com> <4C90BF29.3020705@rabbitmq.com>
Message-ID: <4C90C0BD.8050705@gmail.com>

  On 15/09/10 6:12 PM, Michael Bridgen wrote:
> Hi Abhishek,
>
>> I would like to create a similar page to 
>> http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1663 
>> for installing RabbitMQ on EC2 instances with RabbitMQ.
>
> That would be fantastic, thank you.
> Bear in mind that there is already http://www.rabbitmq.com/ec2.html 
> (though I see it is no longer directly linked from our homepage).
>
>> On the wiki,
>>
>> How can we edit the wiki right now?
>
> Which wiki do you mean?
>
> Regards,
> Michael

There is a RabbitMQ community wiki right?
It seems to be in pretty bad shape though and not much used.
http://dev.rabbitmq.com/wiki/

Abhishek Kona

From mikeb at rabbitmq.com  Wed Sep 15 14:09:00 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 15 Sep 2010 14:09:00 +0100
Subject: [rabbitmq-discuss] A wiki page for EC2 installation of RabbitMQ
 with EBS
In-Reply-To: <4C90C0BD.8050705@gmail.com>
References: <4C90B8A9.7040101@gmail.com> <4C90BF29.3020705@rabbitmq.com>
	<4C90C0BD.8050705@gmail.com>
Message-ID: <4C90C56C.5000002@rabbitmq.com>

>>> I would like to create a similar page to 
>>> http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1663 
>>> for installing RabbitMQ on EC2 instances with RabbitMQ.
>>
>> That would be fantastic, thank you.
>> Bear in mind that there is already http://www.rabbitmq.com/ec2.html 
>> (though I see it is no longer directly linked from our homepage).
>>
>>> On the wiki,
>>>
>>> How can we edit the wiki right now?
>>
>> Which wiki do you mean?
 >
> There is a RabbitMQ community wiki right?
> It seems to be in pretty bad shape though and not much used.
> http://dev.rabbitmq.com/wiki/

Ah I see.  It's not really a community wiki, in the sense that it's not 
open to edit by everyone.  And yes, it is largely out of date.

(I thought you meant you would like to put a page up on 
http://developer.amazonwebservices.com/, hence my confusion over wikis)

Perhaps we ought to have a proper community-edited wiki; I can look into 
hosting one at SpringSource.org, say.  Who else would find this useful, 
and be keen to curate and write content?

Regards,
Michael

From matthew at rabbitmq.com  Wed Sep 15 14:09:08 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Sep 2010 14:09:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ with Erlang R14B
Message-ID: <20100915130907.GC9474@rabbitmq.com>

Hi,

Erlang R14B has just been released, and you can download it from
http://www.erlang.org/download.html

A couple of things are relevant for Rabbit:

1. If compiling Rabbit, you'll get some warnings like:
src/rabbit_plugin_activator.erl:75: Warning: ambiguous call of
overridden auto-imported BIF error/2
 - use erlang:error/2 or "-compile({no_auto_import,[error/2]})." to
   resolve name clash

They are only warnings, and they can be safely ignored - we have tested
and confirmed that it's doing the right thing, despite the warning.

2. Lots and lots and lots of fixes have happened in the SSL module.
Preliminary testing seems to show SSL now really does work. The R14B
release notes (http://www.erlang.org/download/otp_src_R14B.readme) even
mention that memory leaks in the crypto infrastructure have been fixed
(I know someone reported memory leaks with SSL recently here).

Hopefully the distros will quickly update their Erlang packages to R14B
so that people are not relying on a BETA release of Erlang that has bugs
in it. The fact that the now frozen Debian Squeeze has R14A in it is a
little worrying...

Matthew

From josua.troesch at bluewin.ch  Wed Sep 15 14:15:09 2010
From: josua.troesch at bluewin.ch (josua.troesch at bluewin.ch)
Date: Wed, 15 Sep 2010 13:15:09 +0000 (GMT)
Subject: [rabbitmq-discuss] RabbitMQ keeps crashing,
 wrong rabbitmqctl nodedown
In-Reply-To: <yrv4ck4mnqm9f.fsf@dwragg.eng.vmware.com>
References: <1350837.77261284546841125.JavaMail.webmail@ps15zhb.bluewin.ch>
	<yrv4ck4mnqm9f.fsf@dwragg.eng.vmware.com>
Message-ID: <22848104.97901284556509249.JavaMail.webmail@bluewin.ch>

Hi David,

Thank you for answering, I found out that the rabbitmqctl could not connect because of wrong cookies and 
fixed that. Sorry for not checking properly before.

Now, the queue listing is quite enlightening:

name durable 
messages_ready messages_unacknowledged messages_uncommitted consumers
amq.gen-rZubaQsH4+AebarUDtas4g==	false	270064	357	
0	2

A listing of the bindings shows that this queue is publishing to a topic.

Apparently this is the source of our 
memory problem. It says there are 2 consumers for this topic, but I don't know how to get more details about those 2 
consumers. How do I find out which application (source ip, username) is connected to that topic?

Thank you,
Josua

From gmr at myyearbook.com  Wed Sep 15 14:29:14 2010
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 15 Sep 2010 09:29:14 -0400
Subject: [rabbitmq-discuss] Pika + Tornado
Message-ID: <AANLkTi=GDpV6MJBdfSD+riwiA8jKpqb4fAa_hrXTY7MW@mail.gmail.com>

After spending a fair amount of time investigating previous work on what was
done to support Pika from Tornado I decided I wanted something more native
that supported all of the Pika functionality, was truly asynchronous and
worked off of Tornado's IOLoop.  The result is a new fork of pika at
http://github.com/gmr/pika.

I am planning on to work with Tony G to try and get my changes cleaned up in
a way that he'd like so that it can make it into the main pika branch but
until then, I'll see about keeping my branch up to date with changes and
working with the tornado adapter.

To the user of pika my change adds pika.tornado_adapter.TornadoConnection
which uses IOLoop cleanly without any blocking.  Under the covers I move the
_rpc function to work with callbacks and remove the drain_events dependency.
I've not tested extensively but the original examples work unchanged.  It
could use some eyes on it to catch anything I may have missed.

I hope it's of value to some of you who were after the same goal.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/64926a0f/attachment.htm>

From jon at jbrisbin.com  Wed Sep 15 14:34:37 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 15 Sep 2010 08:34:37 -0500
Subject: [rabbitmq-discuss] A wiki page for EC2 installation of RabbitMQ
	with EBS
In-Reply-To: <4C90C56C.5000002@rabbitmq.com>
References: <4C90B8A9.7040101@gmail.com> <4C90BF29.3020705@rabbitmq.com>
	<4C90C0BD.8050705@gmail.com> <4C90C56C.5000002@rabbitmq.com>
Message-ID: <0B46FE88-62D5-4A40-A276-354AE274FD47@jbrisbin.com>


On Sep 15, 2010, at 8:09 AM, Michael Bridgen wrote:

> Perhaps we ought to have a proper community-edited wiki; I can look into hosting one at SpringSource.org, say.  Who else would find this useful, and be keen to curate and write content?

I don't have a lot of time, but I might contribute some content.

At any rate, I'd be an avid reader and consumer of a community-edited wiki! :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/180b1506/attachment-0001.htm>

From ahussein.abdelrahman at gmail.com  Wed Sep 15 14:43:59 2010
From: ahussein.abdelrahman at gmail.com (abdelrahman)
Date: Wed, 15 Sep 2010 06:43:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq ctl script fail
Message-ID: <70b83751-43d5-4483-a486-f2459f26ba57@t11g2000vbc.googlegroups.com>

Hello all,
i am running rabbitmq-server version 1.7.1 and i needed to configure
clusters with nodenames related to ip addresses so i am using -name
instead of -sname in both rabbitmq-server and rabbitmqctl scripts like
the follwoing:
rabbitmq-server script:
exec erl \
    ${RABBITMQ_EBIN_PATH} \
    ${RABBITMQ_START_RABBIT} \
    -sname ${RABBITMQ_NODENAME} \
    -boot ${RABBITMQ_BOOT_FILE} \
    ${RABBITMQ_CONFIG_ARG} \
    +W w \
    ${RABBITMQ_SERVER_ERL_ARGS} \
    -rabbit tcp_listeners '[{"'${RABBITMQ_NODE_IP_ADDRESS}'", '$
{RABBITMQ_NODE_PORT}'}]' \
    -sasl errlog_type error \
    -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
    -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \
    -os_mon start_cpu_sup true \
    -os_mon start_disksup false \
    -os_mon start_memsup false \
    -mnesia dir "\"${RABBITMQ_MNESIA_DIR}\"" \
    ${RABBITMQ_CLUSTER_CONFIG_OPTION} \
    ${RABBITMQ_SERVER_START_ARGS} \
    "$@"

my rabbitmqctl script is:
NODENAME=rabbit

. `dirname $0`/rabbitmq-env

[ "x" = "x$RABBITMQ_NODENAME" ] && RABBITMQ_NODENAME=${NODENAME}
[ "x" = "x$RABBITMQ_CTL_ERL_ARGS" ] && RABBITMQ_CTL_ERL_ARGS=$
{CTL_ERL_ARGS}

exec erl \
    -pa "${RABBITMQ_HOME}/ebin" \
    -noinput \
    -hidden \
    ${RABBITMQ_CTL_ERL_ARGS} \
    -sname rabbitmqctl$$ \
    -s rabbit_control \
    -nodename $RABBITMQ_NODENAME \
    -extra "$@"

my rabbitmq.conf file is:
RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
RABBITMQ_NODE_PORT=5672
RABBITMQ_NODENAME=rabbit at 192.168.20.10

the problem is when starting the server using the rabbitmq-server
script, it starts correctly, but when trying to runt he rabbitmqctl
script it fails with the error:
{error_logger,{{2010,9,15},{13,24,20}},"Can't set long node name!
\nPlease check your configuration\n",[]}
{error_logger,{{2010,9,15},{13,24,20}},crash_report,[[{initial_call,
{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},
{error_info,{exit,{error,badarg},[{gen_server,init_it,6},
{proc_lib,init_p_do_apply,3}]}},{ancestors,
[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},
{dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
{heap_size,987},{stack_size,24},{reductions,835}],[]]}
{error_logger,{{2010,9,15},{13,24,20}},supervisor_report,[{supervisor,
{local,net_sup}},{errorContext,start_error},{reason,
{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},
{mfa,{net_kernel,start_link,[[rabbitmqctl20008,longnames]]}},
{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,9,15},{13,24,20}},supervisor_report,[{supervisor,
{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},
{offender,[{pid,undefined},{name,net_sup},{mfa,
{erl_distribution,start_link,[]}},{restart_type,permanent},
{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,9,15},{13,24,20}},std_info,[{application,kernel},
{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,
{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,
[]]}}})

i cannot know why it cannot set long node name since it is already
started with the same long name config ? any ideas ?

Thanks.

From romary.kremer at gmail.com  Wed Sep 15 14:45:50 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Wed, 15 Sep 2010 15:45:50 +0200
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
Message-ID: <E1ED8931-797F-4DC8-889A-2BDDFA6C54CD@gmail.com>

Hi,
since I can not find out the reasons of our problems yet, I've decided  
to perform some more basics tests.

Here are the latest results I' ve gathered by doing some test with the  
MultiCastMain program from java client 2.0.0

First of all, let me introduce the modifications I have performed on  
the MultiCastMain to allow more flexibility in the configuration :
	- introduction of optional parameter "-D" to toggle Durability of  
exchange and queue ON (missing value means OFF)
	- introduction of optional parameter "-A" to toggle autodelete of the  
queue ON (missing value means OFF)
	- introduction of optional parameter "-X" to toggle exclusiveness on  
the queue ON (missing value means OFF)
	- introduction of optional parameter "-Q" to give a name to a queue :  
useful to fetch messages from the same queue between several executions.
	- introduction of optional parameter "-K" to give the same routing  
key (for producer) and binding key (for consumer) between several  
executions.

Here after is a snippet of /etc/rabbitmq/rabbitmq.config :
	[
   	{rabbit, [
      		{vm_memory_high_watermark, 0.05},
      		{ssl_listeners, [{"0.0.0.0",5671}]},
      		{ssl_options, [{cacertfile,"/var/lib/rabbitmq/ssl/certificate- 
authority/schneider-ca.pem"},
                    	{certfile,"/var/lib/rabbitmq/ssl/broker-certs/ 
broker-cert.pem"},
                     	{keyfile,"/var/lib/rabbitmq/ssl/broker-certs/ 
broker-key.pem"},
                     	{verify,verify_none},
                     	{fail_if_no_peer_cert,false}]}
    		]}	
	].

To step in the memory limitations faster, I 've decreased the memory  
watermark threshold to .05 (5%)
This corresponds to 50 MB on the host we are using for this test as  
shown on the rabbit.log file upon startup of broker :

	=INFO REPORT==== 15-Sep-2010::12:36:15 ===
	Limiting to approx 65435 file handles (58889 sockets)

	=INFO REPORT==== 15-Sep-2010::12:36:15 ===
	Memory limit set to 50MB.

Finally the broker status description (rabbitmqctl status)

	[{running_applications,[{rabbit_status,"RabbitMQ Status Page","0.01"},
         	                {rabbit,"RabbitMQ","2.0.0"},
                 	        {ssl,"Erlang/OTP SSL application","3.10.7"},
                         	{public_key,"Public key  
infrastructure","0.4"},
                        	 	{mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        		{os_mon,"CPO  CXC 138 46","2.2.4"},
                         	{sasl,"SASL  CXC 138 11","2.1.8"},
                         	{rabbit_mochiweb,"RabbitMQ Mochiweb  
Embedding","0.01"},
                         	{mochiweb,"MochiMedia Web Server","1.3"},
                         	{crypto,"CRYPTO version 1","1.6.3"},
                         	{inets,"INETS  CXC 138 49","5.2"},
                         	{stdlib,"ERTS  CXC 138 10","1.16.4"},
                         	{kernel,"ERTS  CXC 138 10","2.13.4"}]},
	 {nodes,[{disc,['rabbit at mystic-buntu']}]},
  	{running_nodes,['rabbit at mystic-buntu']}]

Thanks to the modifications of the MultiCastMain, I've run a 2 phases  
producer / consumer test as described bellow :

	phase 0 : initialization of exchange and queue for the test :
		MultiCastMain -h <host> -p 5672 -s 1000 -n 1 -x 0 -y 1 -e testX -Q  
testQ -K testK -D -z 10
		this launches a single consumer creating the exchange testX and  
queue testQ with durability ON.
		The queue is bound to the exchange using key testK.
		The test is told to end after 10 seconds.
		
	phase 1 - launch a producer alone and watch memory occupation +  
connections status and queue depth (via rabbit_status plugin for  
instance)
		MultiCastMain -h <host> -p 5672 -s 1000 -n 1 -x 1 -y 0 -e testX -Q  
testQ -K testK -D

		This run a producer that will publish 1kb messages to the testX  
exchange with routing key testK.
		These messages will be queued inside testQ.

The producer is blocked after only few seconds running as the memory  
threshold is reached. The queue depth indicated 12 011 messages.
(You can scroll to the end of this mail to see an extract of broker  
log to illustrate the alarm_hanlder notifications.)

What do I mean by "the producer is blocked" :
	- rabbit_status plugin shows the connection in status "bocked"
	- rabbit_status plugin shows that the depth of queue testQ remains  
constant
	- The trace from MultiCastMain does not displays new stats of sending  
rate after a while
	- The last lines in the broker log are :
		=INFO REPORT==== 15-Sep-2010::14:53:44 ===
		vm_memory_high_watermark set. Memory used:53650536 allowed:52556595

		=INFO REPORT==== 15-Sep-2010::14:53:44 ===
     		alarm_handler: {set,{vm_memory_high_watermark,[]}}

 From that point, the producer is blocked without any possible  
recovery. As the flow control is designed in v 2.0.0, I would have  
expected the producer
to be released thanks to sawp of messages to the disk. Anyway, my  
second assumption was that a consumer is needed to release pressure on  
the queue,
so I decided to keep the producer f running, and start phase 2 as  
follow :
	
	phase 2 - launch a consumer alone and watch memory occupation +  
connections status and queue depth (via rabbit_status plugin for  
instance)

		MultiCastMain -h <host> -p 5672 -s 1000 -n 1 -x 0 -y 1 -e testX -Q  
testQ -K testK -D
		This runs a consumer that will get message out the queue testQ.

The messages from testQ are removed quite fast too, but the memory  
occupation does not seem to be impacted at all, as the producer is  
still blocked.
 From the rabbit_status plugin, the status of the connections remains :
	- "blocked" for the producer
	- "blocking" for the consumer

And memory usage is still over the threshold :  memory (used/ 
available) = 53MB / 50MB

The only way I found out to allow memory to fall back bellow the  
threshold is by killing manually the connection of the producer.
Killing the producer process on the client side does not do indeed :

	If  I kill the producer process, the connection seems to disappear  
but the memory remains over the threshold.
	The rabbit_status plugin seem to fail after this because I got a  
strange error report in the broker log. (see the end of this long  
mail !)
	
By closing the connection on the broker side, the memory has (not  
always) fallen below the threshold, back to normal (32 MB / 50 MB).

I think this behaviour is not expected and maybe that could be due to  
a bug somewhere, since it si fully reproductible on my configuration.
The fact that the memory occupation never falls below the threshold  
after message are removed from the queue is particularly strange and
unwilling from my point of view. It think that this simple test can  
points out an issue that would explains the problems that I mentioned  
in the
previous messages, but not sure about it.

I am sorry for this quite long message, but I thought that the more  
details you get, the better.

best regards,

Romary.
	
The following is an extract from the broker log during phase 1

	=INFO REPORT==== 15-Sep-2010::14:53:24 ===
	accepted TCP connection on 0.0.0.0:5672 from 192.168.0.71:1845

	=INFO REPORT==== 15-Sep-2010::14:53:24 ===
	starting TCP connection <0.16120.0> from 192.168.0.71:1845

	=INFO REPORT==== 15-Sep-2010::14:53:42 ===
	vm_memory_high_watermark set. Memory used:52632808 allowed:52556595

	=INFO REPORT==== 15-Sep-2010::14:53:42 ===
    	alarm_handler: {set,{vm_memory_high_watermark,[]}}

	=INFO REPORT==== 15-Sep-2010::14:53:43 ===
	vm_memory_high_watermark clear. Memory used:52355320 allowed:52556595

	=INFO REPORT==== 15-Sep-2010::14:53:43 ===
  	alarm_handler: {clear,vm_memory_high_watermark}

	=INFO REPORT==== 15-Sep-2010::14:53:44 ===
	vm_memory_high_watermark set. Memory used:53650536 allowed:52556595

	=INFO REPORT==== 15-Sep-2010::14:53:44 ===
     	alarm_handler: {set,{vm_memory_high_watermark,[]}}

The following is an extract from the broker log during phase 2
	
	=INFO REPORT==== 15-Sep-2010::15:21:38 ===
	accepted TCP connection on 0.0.0.0:5672 from 192.168.0.71:1880

	=INFO REPORT==== 15-Sep-2010::15:21:38 ===
	starting TCP connection <0.2101.1> from 192.168.0.71:1880

The following is the error report after shutting down the producer  
process (client side)

ERROR REPORT==== 15-Sep-2010::15:37:53 ===
** Generic server rabbit_status_web terminating
** Last message in was get_context
** When Server state == {state,1284557846311,"Wed, 15 Sep 2010  
11:37:26 GMT",
                                [<<"0.0.0.0:5672 ">>],
                                [[{pid,<<"<0.16120.0>">>},
                                  {address,<<"192.168.0.58">>},
                                  {port,5672},
                                  {peer_address,<<"192.168.0.71">>},
                                  {peer_port,1845},
                                  {recv_oct,12696041},
                                  {recv_cnt,72079},
                                  {send_oct,357},
                                  {send_cnt,5},
                                  {send_pend,0},
                                  {state,<<"blocked">>},
                                  {channels,1},
                                  {user,<<"guest">>},
                                  {vhost,<<"/">>},
                                  {timeout,0},
                                  {frame_max,131072}]],
                                [[{vhost,<<"/">>},
                                  {name,<<"testQ">>},
                                  {durable,<<"true">>},
                                  {auto_delete,<<"false">>},
                                  {arguments,<<"[]">>},
                                  {pid,<<"<0.12150.0>">>},
                                  {messages_ready,0},
                                  {messages_unacknowledged,0},
                                   
{messages_uncommitted,<<"undefined">>},
                                  {messages,0},
                                  {acks_uncommitted,<<"undefined">>},
                                  {consumers,0},
                                  {transactions,<<"undefined">>},
                                  {memory,6171332}]],
                                 
33,65535,55843456,52556595.0,161,1048576}
** Reason for termination ==
** {{badmatch,{error,enotconn}},{gen_server,call, 
[<0.16120.0>,info,infinity]}}

=ERROR REPORT==== 15-Sep-2010::15:37:53 ===
** Generic server <0.16124.0> terminating
** Last message in was {'EXIT',<0.16123.0>,{badmatch,{error,enotconn}}}
** When Server state == {ch,running, 
1,<0.16120.0>,<0.16122.0>,undefined,none,
                             {set,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[], 
[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]}}},
                             1,
                             {[],[]},
                             {[],[]},
                             <<"guest">>,<<"/">>,<<>>,
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             <0.16121.0>,
                             {state,none,undefined}}
** Reason for termination ==
** {badmatch,{error,enotconn}}




Le 10 sept. 10 ? 15:06, Marek Majkowski a ?crit :

> Romary,
>
> First, thank a lot for the feedback. For example the information about
> SSL memory
> usage is indeed very interesting. (if that is a big problem to you,
> you may always
> fall back to the old technique of using stunnel)
>
> The flow control was heavily modified between 1.8.1 and 2.0.0. In  
> summary:
> - 1.8.1 - we have send Channel.flow AMQP message to everyone once
>   rabbit reached memory limit
> - 2.0.0 - once we reach memory limit, the connections from which we  
> hear
>   publishes are stopped temporarily. We stop receiving bytes from  
> tcp sockets.
>   That 'stop' shouldn't take too long, as data should be swapped out  
> to disk
>   and memory pressure will drop pretty quickly.
>
>
> On Wed, Sep 8, 2010 at 11:49, Romary Kremer  
> <romary.kremer at gmail.com> wrote:
>> I've started playing a bit with the latest release 2.0.0 and I m  
>> affraid
>> that it looks like their are some regression or at least some  
>> semantic
>> updates.
>
> It's best if you upgraded both server and client library. Do you  
> have any
> particular problems? A lot was changed in 2.0.0 but we think it's  
> fully
> functional. If you found something that blocks you to migrate, you
> could report a bug.
>
>> It looks like any listener is called back  when the alarm handler  
>> is set or
>> cleared, while the producers are still paused / resumed
>> like their are to be.
>
> Interesting. Maybe we have a race there? Or maybe you're blocking
> the main java client thread? (nothing blocking should be done from
> the main thread)
>
>>> during long running tests, we have encountered strange behaviour  
>>> due to
>>> flow control :
>>>
>>> The queue depth starts to increase linearly for about 2 hours,  
>>> these is
>>> coherent since the message throughput of the single consumer
>>> is not enough to absorb message ingress. Memory occupation grow  
>>> faster as
>>> well, until the memory watermark is reached on the broker side.
>
> Are you sure your consumer is ACK-ing the messages it received?
>
>>> From that point, the producers are indeed paused, as flow control  
>>> request
>>> has been issued by the broker, but the consumer seems to be blocked
>>> as well. The queue level is flatten at its top value until the end  
>>> of the
>>> test, even when memory occupation lowered under the threshold.
>
> That's how 1.8.1 behaves. In 2.0.0 we introduced swapping out big  
> queues
> to disk, so the memory usage shouldn't be dependent on a queue size.
>
>>> By registering the FlowListener callback, we have noticed that not  
>>> all of
>>> the producers are notified all the time the alarm handler is set.
>>> Does this mean that the broker applies some heuristic to try not  
>>> to block
>>> every body every time ?
>>> Or does it mean that some of the channels have been somehow  
>>> blacklisted by
>>> the broker ?
>
> No, in 1.8.1 broker should send 'channel.flow' to all the channels.
>
>>> Could anybody explain how the blocking of consumer is assumed to be
>>> implemented ?
>
> The best description is probably here:
>  http://www.rabbitmq.com/extensions.html#memsup
>
> But it covers 2.0.0. I'd suggest an upgrade to 2.0.0 and monitoring
> not only queue size but also number of unacknowledged messages
> ('Msg unack' in status plugin). This number should be near zero.
>
> Cheers,
>  Marek Majkowski

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/f26d6487/attachment-0001.htm>

From marek at rabbitmq.com  Wed Sep 15 14:54:07 2010
From: marek at rabbitmq.com (Marek Majkowski)
Date: Wed, 15 Sep 2010 14:54:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 release
Message-ID: <4C90CFFF.1090402@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.0.

This release fixes a number of bugs, including some race conditions
and introduces minor enhancements in the server and clients.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

  The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.1.0.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/1352d435/attachment.txt>

From majek04 at gmail.com  Wed Sep 15 15:11:36 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 15 Sep 2010 15:11:36 +0100
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <66299676-639B-473C-92C5-62B60836DE35@gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
Message-ID: <AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>

On Tue, Sep 14, 2010 at 09:07, romary.kremer at gmail.com
<romary.kremer at gmail.com> wrote:
>> The flow control was heavily modified between 1.8.1 and 2.0.0. In summary:
>> - 1.8.1 - we have send Channel.flow AMQP message to everyone once
>> ?rabbit reached memory limit
>> - 2.0.0 - once we reach memory limit, the connections from which we hear
>> ?publishes are stopped temporarily. We stop receiving bytes from tcp
>> sockets.
>> ?That 'stop' shouldn't take too long, as data should be swapped out to
>> disk
>> ?and memory pressure will drop pretty quickly.
>
> Do you mean that in 2.0.0 the Channel.flow AMQP message is no longer sent to
> the producer that are stopped temporarily ? So that would explain why
> ? ? ? ?1) Channel.publish() can be blocking on the client side when the
> broker stop
> ? ? ? ?reading from the socket !
>
> ? ? ? ?2) FlowListener.handleFlow() is no longer invoked on the registered
> listener when
> ? ? ? ?the alarm handler is set or cleared
> Are my deduction wright ?

Yes. You will never hear "FlowListener.handleFlow()" and it may be possible for
channel.publish to block (though I would need to consult the sources
to be sure).

> Do you have any figures to quantify "should, not take too long" ? Are their
> some
> test reports available about that major evolution ?

That's the question we really avoided :) Oh, well. No, we haven't done any
'real' tests, it's only based on our intuition and experience. In most
cases the blocking goes away pretty quickly - after 30 seconds usually,
about two minutes sometimes.

But it is possible to create a very pessimistic environment in which the
memory usage will not drop - and the connection could be stuck for a long time.
(though it's pretty unlikely).

> Sorry If I wasn't clear on the previous post ,we are already in 2.0.0 for
> both broker and
> client library.

Good.

>>> It looks like any listener is called back ?when the alarm handler is set
>>> or
>>> cleared, while the producers are still paused / resumed
>>> like their are to be.
>>
>> Interesting. Maybe we have a race there? Or maybe you're blocking
>> the main java client thread? (nothing blocking should be done from
>> the main thread)
>
> I am quite sure I am not blocking the main thread, neither the Connection
> Thread. All
> the message-related logic is in a particular thread (Some kind of
> ProducerGroup
> pool of threads actually).
> Consumer call back are running within the Connection thread if I refer to
> the Javadoc !
>
> The same code using the library version 1.8.1, The callback where invoked
> when
> alarm handler is set or cleared anyway.
>>
>>>> during long running tests, we have encountered strange behaviour due to
>>>> flow control :
>>>>
>>>> The queue depth starts to increase linearly for about 2 hours, these is
>>>> coherent since the message throughput of the single consumer
>>>> is not enough to absorb message ingress. Memory occupation grow faster
>>>> as
>>>> well, until the memory watermark is reached on the broker side.
>>
>> Are you sure your consumer is ACK-ing the messages it received?
>
> The Consumer call back does ACK messages upon reception, one at a time
> (multiple == false).
> Does the basic.ack() method is eligible to be blocked as well as publish()
> upon flow control ?

Well, under current implementation of flow control - yes. As it's whole
tcp/ip connection that gets blocked. It will affect any commands, including
basic.ack.

What we usually propose is to use different tcp/ip connection for receiving
and different for publishing. On memory pressure we only block the publishers.
Using separate connection only for receiving you may be sure it will
never be blocked.

>>>> From that point, the producers are indeed paused, as flow control
>>>> request
>>>> has been issued by the broker, but the consumer seems to be blocked
>>>> as well. The queue level is flatten at its top value until the end of
>>>> the
>>>> test, even when memory occupation lowered under the threshold.
>>
>> That's how 1.8.1 behaves. In 2.0.0 we introduced swapping out big queues
>> to disk, so the memory usage shouldn't be dependent on a queue size.
>
> Good new, because we had identified 2 scenarios in wich memory-based channel
> flow
> was triggered :
>
> ? ? ? ?- the use of SSL
> ? ? ? ?- the use of larger message (4kb, same ingress)
> Now I hope that the message size will not be that much determinant for flow
> controll,as soon
> as consumers are able to handle these message regularly.
>
>>
>>>> By registering the FlowListener callback, we have noticed that not all
>>>> of
>>>> the producers are notified all the time the alarm handler is set.
>>>> Does this mean that the broker applies some heuristic to try not to
>>>> block
>>>> every body every time ?
>>>> Or does it mean that some of the channels have been somehow blacklisted
>>>> by
>>>> the broker ?
>>
>> No, in 1.8.1 broker should send 'channel.flow' to all the channels.
>
> Strange so, their must be some thing very weird.
>>
>>>> Could anybody explain how the blocking of consumer is assumed to be
>>>> implemented ?
>>
>> The best description is probably here:
>> ?http://www.rabbitmq.com/extensions.html#memsup
>>
>> But it covers 2.0.0. I'd suggest an upgrade to 2.0.0 and monitoring
>> not only queue size but also number of unacknowledged messages
>> ('Msg unack' in status plugin). This number should be near zero.
>>
> We are already with 2.0.0.
> Where can I find some doc about the Status plugin anyway ?

I'm afraid the old blog post is the only source:
http://www.lshift.net/blog/2009/11/30/introducing-rabbitmq-status-plugin

From jon.brisbin at npcinternational.com  Wed Sep 15 15:20:18 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 15 Sep 2010 09:20:18 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 release
In-Reply-To: <4C90CFFF.1090402@rabbitmq.com>
References: <4C90CFFF.1090402@rabbitmq.com>
Message-ID: <83748302-64C7-47BB-A55F-AF9D54DD9F30@npcinternational.com>

Just upgraded my Ubuntu boxes. :)

Is the management plugin compatible with 2.1?

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Sep 15, 2010, at 8:54 AM, Marek Majkowski wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.0.
> 
> This release fixes a number of bugs, including some race conditions
> and introduces minor enhancements in the server and clients.
> 
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
> 
> 
> Regards,
> 
>  The RabbitMQ Team
> 
> <README-2.1.0.txt>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david at rabbitmq.com  Wed Sep 15 15:25:00 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 15 Sep 2010 15:25:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ keeps crashing,
	wrong rabbitmqctl nodedown
In-Reply-To: <22848104.97901284556509249.JavaMail.webmail@bluewin.ch> (josua's
	message of "Wed, 15 Sep 2010 13:15:09 +0000 (GMT)")
References: <1350837.77261284546841125.JavaMail.webmail@ps15zhb.bluewin.ch>
	<yrv4ck4mnqm9f.fsf@dwragg.eng.vmware.com>
	<22848104.97901284556509249.JavaMail.webmail@bluewin.ch>
Message-ID: <yrv4cd3sfqe2r.fsf@dwragg.eng.vmware.com>

"josua.troesch at bluewin.ch" <josua.troesch at bluewin.ch> writes:
> Now, the queue listing is quite enlightening:
>
> name durable 
> messages_ready messages_unacknowledged messages_uncommitted consumers
> amq.gen-rZubaQsH4+AebarUDtas4g==	false	270064	357	
> 0	2
>
> A listing of the bindings shows that this queue is publishing to a
> topic.

(I assume you mean that the queue is bound to a topic exchange?)

> Apparently this is the source of our memory problem. It says there are
> 2 consumers for this topic, but I don't know how to get more details
> about those 2 consumers. How do I find out which application (source
> ip, username) is connected to that topic?

The list_consumers command in rabbitmqctl can (indirectly) tell you
this, but I'm afraid it wasn't present back in 1.6.0.

I'm afraid you'll have to look at your applications to try to figure out
which are the consumers.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthias at rabbitmq.com  Wed Sep 15 15:26:38 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Sep 2010 15:26:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <629763.47711.qm@web111015.mail.gq1.yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
	<4C8FDCE4.6050209@rabbitmq.com>
	<629763.47711.qm@web111015.mail.gq1.yahoo.com>
Message-ID: <4C90D79E.5060704@rabbitmq.com>

Dave,

On 14/09/10 22:23, Dave Greggory wrote:
> I wish I could give you access, but it's easier said than done due to both
> environment and security policies. I'm trying to get you access, but it'd be
> hell of a lot easier if you can tell me what to look for (troubleshooting steps)
> and all the data points (rabbitmq, erlang, linux kernel, VM) you need.

The decision tree is quite broad, unfortunately, so the fault finding 
needs to be interactive.

Btw, it turns out that Cal's problem is unrelated and has nothing to do 
with rabbit; it is most likely due to a bug in celery, amqplib or the 
app code.


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Wed Sep 15 15:40:48 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 15 Sep 2010 09:40:48 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 release
In-Reply-To: <83748302-64C7-47BB-A55F-AF9D54DD9F30@npcinternational.com>
References: <4C90CFFF.1090402@rabbitmq.com>
	<83748302-64C7-47BB-A55F-AF9D54DD9F30@npcinternational.com>
Message-ID: <A58B93BB-7E29-4221-A06D-0679685EFEFC@npcinternational.com>

On Sep 15, 2010, at 9:20 AM, Jon Brisbin wrote:

> Just upgraded my Ubuntu boxes. :)
> 
> Is the management plugin compatible with 2.1?

Answered my own question:

Freshly-built rabbitmq-management plugin from trunk works with 2.1.0 broker.

Jon Brisbin
Portal Webmaster
NPC International, Inc.



> 
> 
> On Sep 15, 2010, at 8:54 AM, Marek Majkowski wrote:
> 
>> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.0.
>> 
>> This release fixes a number of bugs, including some race conditions
>> and introduces minor enhancements in the server and clients.
>> 
>> As always, we welcome any questions, bug reports, and other feedback on
>> this release, as well as general suggestions for features and
>> enhancements in future releases. Mail us via the RabbitMQ discussion
>> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
>> info at rabbitmq.com.
>> 
>> 
>> Regards,
>> 
>> The RabbitMQ Team
>> 
>> <README-2.1.0.txt>_______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Wed Sep 15 15:45:18 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 15 Sep 2010 15:45:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 release
In-Reply-To: <A58B93BB-7E29-4221-A06D-0679685EFEFC@npcinternational.com>
References: <4C90CFFF.1090402@rabbitmq.com>	<83748302-64C7-47BB-A55F-AF9D54DD9F30@npcinternational.com>
	<A58B93BB-7E29-4221-A06D-0679685EFEFC@npcinternational.com>
Message-ID: <4C90DBFE.2070303@rabbitmq.com>

On 15/09/10 15:40, Jon Brisbin wrote:
>> Is the management plugin compatible with 2.1?
>
> Answered my own question:
>
> Freshly-built rabbitmq-management plugin from trunk works with 2.1.0 broker.

or just download the binary plugin released with 2.1.0 from 
http://www.rabbitmq.com/plugins.html#rabbitmq-management


Matthias.

From vlad at rabbitmq.com  Wed Sep 15 16:32:14 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 15 Sep 2010 16:32:14 +0100
Subject: [rabbitmq-discuss] HA and database schema changes
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE013D443ACEBD@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE013D443ACEBD@NAMBX02.corp.adobe.com>
Message-ID: <4C90E6FE.1070502@rabbitmq.com>


Hi Steve,

There is currently no easy way to migrate the database.

In general, it is advisable to use the same code which you first used to 
create the exchanges, queues etc. on the new version of Rabbit to 
reconstruct your setup.
In order to migrate messages, you would have to use the rabbitmq-shovel 
plugin, which would consume messages from the old broker and would 
publish them into the new one (you must come up with a sensible 
configuration, depending on you setup).

Hope that answers your question.

Rgds,
Vlad.



On 09/14/2010 09:28 PM, Steve Haneman wrote:
>
> Hello,
>
> I was looking over the release notes for "Release: RabbitMQ 2.0.0" and 
> saw the following:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20100825/2c672695/attachment.txt
>
> Upgrading
> =========
> The database schema and the format in which persistent messages are
> stored have both changed since the last release (1.8.1). When
> starting, the RabbitMQ server will detect the existence of an old
> database and will move it to a backup location, before creating a
> fresh, empty database, and will log a warning. If your RabbitMQ
> installation contains important data then we recommend you contact
> support at ... for assistance with the upgrade.
>
> We are considering deploying a HA RabbitMQ cluster with Pacemaker and 
> DRBD.  HA is very important for us.
>
> If there is a database schema change in the future, specifically what 
> is the process for the upgrade and how does it affect HA during the 
> upgrade?
>
> Also during the upgrade, how do we maintain durable exchanges and queues?
>
> Thanks,
>
>    Steve
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/0664b115/attachment.htm>

From romary.kremer at gmail.com  Wed Sep 15 19:11:47 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Wed, 15 Sep 2010 20:11:47 +0200
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
	<AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
Message-ID: <0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>

Le 15 sept. 10 ? 16:11, Marek Majkowski a ?crit :

> On Tue, Sep 14, 2010 at 09:07, romary.kremer at gmail.com
> <romary.kremer at gmail.com> wrote:
>>> The flow control was heavily modified between 1.8.1 and 2.0.0. In  
>>> summary:
>>> - 1.8.1 - we have send Channel.flow AMQP message to everyone once
>>>  rabbit reached memory limit
>>> - 2.0.0 - once we reach memory limit, the connections from which  
>>> we hear
>>>  publishes are stopped temporarily. We stop receiving bytes from tcp
>>> sockets.
>>>  That 'stop' shouldn't take too long, as data should be swapped  
>>> out to
>>> disk
>>>  and memory pressure will drop pretty quickly.
>>
>> Do you mean that in 2.0.0 the Channel.flow AMQP message is no  
>> longer sent to
>> the producer that are stopped temporarily ? So that would explain why
>>        1) Channel.publish() can be blocking on the client side when  
>> the
>> broker stop
>>        reading from the socket !
>>
>>        2) FlowListener.handleFlow() is no longer invoked on the  
>> registered
>> listener when
>>        the alarm handler is set or cleared
>> Are my deduction wright ?
>
> Yes. You will never hear "FlowListener.handleFlow()" and it may be  
> possible for
> channel.publish to block (though I would need to consult the sources
> to be sure).

It seems to me that FlowListener interface is likely to be deprecated  
so, does'nt it ?
Does not really matter for us anyway, cause we where on wrong idea  
using that.
Does this new implementation keep the broker on track for compliance  
with specification then ?

>
>> Do you have any figures to quantify "should, not take too long" ?  
>> Are their
>> some
>> test reports available about that major evolution ?
>
> That's the question we really avoided :) Oh, well. No, we haven't  
> done any
> 'real' tests, it's only based on our intuition and experience. In most
> cases the blocking goes away pretty quickly - after 30 seconds  
> usually,
> about two minutes sometimes.

This would be acceptable for our needs, only if we can somehow  
guarantee that's an upper boundary !
>
> But it is possible to create a very pessimistic environment in which  
> the
> memory usage will not drop - and the connection could be stuck for a  
> long time.
> (though it's pretty unlikely).

... Not that much unlikely, considering my little playing with the  
MultiCastMain sample (see my previous reply about it for details).
I get 100 % times blocked connection.
What would be, based on your knowledge and your intuition, "a very  
pessimistic environment in which the memory usage will not drop" ?

I think that the experimentation I've done on the MultiCastMain is  
maybe a beginning of an answer for that question, although I would
never have considered that a single producer could have such power to  
flood the broker.

>
>> Sorry If I wasn't clear on the previous post ,we are already in  
>> 2.0.0 for
>> both broker and
>> client library.
>
> Good.
>
>>>> It looks like any listener is called back  when the alarm handler  
>>>> is set
>>>> or
>>>> cleared, while the producers are still paused / resumed
>>>> like their are to be.
>>>
>>> Interesting. Maybe we have a race there? Or maybe you're blocking
>>> the main java client thread? (nothing blocking should be done from
>>> the main thread)
>>
>> I am quite sure I am not blocking the main thread, neither the  
>> Connection
>> Thread. All
>> the message-related logic is in a particular thread (Some kind of
>> ProducerGroup
>> pool of threads actually).
>> Consumer call back are running within the Connection thread if I  
>> refer to
>> the Javadoc !
>>
>> The same code using the library version 1.8.1, The callback where  
>> invoked
>> when
>> alarm handler is set or cleared anyway.
>>>
>>>>> during long running tests, we have encountered strange behaviour  
>>>>> due to
>>>>> flow control :
>>>>>
>>>>> The queue depth starts to increase linearly for about 2 hours,  
>>>>> these is
>>>>> coherent since the message throughput of the single consumer
>>>>> is not enough to absorb message ingress. Memory occupation grow  
>>>>> faster
>>>>> as
>>>>> well, until the memory watermark is reached on the broker side.
>>>
>>> Are you sure your consumer is ACK-ing the messages it received?
>>
>> The Consumer call back does ACK messages upon reception, one at a  
>> time
>> (multiple == false).
>> Does the basic.ack() method is eligible to be blocked as well as  
>> publish()
>> upon flow control ?
>
> Well, under current implementation of flow control - yes. As it's  
> whole
> tcp/ip connection that gets blocked. It will affect any commands,  
> including
> basic.ack.
>
> What we usually propose is to use different tcp/ip connection for  
> receiving
> and different for publishing. On memory pressure we only block the  
> publishers.
> Using separate connection only for receiving you may be sure it will
> never be blocked.

Weren't Channel design for that ? In our environment, we have  
(naively ?) considered the use of Channel to
separate the message production from the consumption.
Since we are targeting 10 000 peers doing both production and  
consumption, the fact of multiplying the number of
connections by 2 is not negligible at all, considering scalability.
Moreover, as I reported later on, we use SSL to authenticate the  
broker, and we are still unclear about memory leaks
induce by SSL connections. Doubling the number of connections will not  
be negligible at all considering memory occupation either.
In conclusion, we are not likely to implement our peers using 2  
connections for the same broker.
What would you recommend to us then ? And could you give us a better  
understanding on the use case of channels ?

>
>>>>> From that point, the producers are indeed paused, as flow control
>>>>> request
>>>>> has been issued by the broker, but the consumer seems to be  
>>>>> blocked
>>>>> as well. The queue level is flatten at its top value until the  
>>>>> end of
>>>>> the
>>>>> test, even when memory occupation lowered under the threshold.
>>>
>>> That's how 1.8.1 behaves. In 2.0.0 we introduced swapping out big  
>>> queues
>>> to disk, so the memory usage shouldn't be dependent on a queue size.
>>
>> Good new, because we had identified 2 scenarios in wich memory- 
>> based channel
>> flow
>> was triggered :
>>
>>        - the use of SSL
>>        - the use of larger message (4kb, same ingress)
>> Now I hope that the message size will not be that much determinant  
>> for flow
>> controll,as soon
>> as consumers are able to handle these message regularly.
>>
>>>
>>>>> By registering the FlowListener callback, we have noticed that  
>>>>> not all
>>>>> of
>>>>> the producers are notified all the time the alarm handler is set.
>>>>> Does this mean that the broker applies some heuristic to try not  
>>>>> to
>>>>> block
>>>>> every body every time ?
>>>>> Or does it mean that some of the channels have been somehow  
>>>>> blacklisted
>>>>> by
>>>>> the broker ?
>>>
>>> No, in 1.8.1 broker should send 'channel.flow' to all the channels.
>>
>> Strange so, their must be some thing very weird.
>>>
>>>>> Could anybody explain how the blocking of consumer is assumed to  
>>>>> be
>>>>> implemented ?
>>>
>>> The best description is probably here:
>>>  http://www.rabbitmq.com/extensions.html#memsup
>>>
>>> But it covers 2.0.0. I'd suggest an upgrade to 2.0.0 and monitoring
>>> not only queue size but also number of unacknowledged messages
>>> ('Msg unack' in status plugin). This number should be near zero.
>>>
>> We are already with 2.0.0.
>> Where can I find some doc about the Status plugin anyway ?
>
> I'm afraid the old blog post is the only source:
> http://www.lshift.net/blog/2009/11/30/introducing-rabbitmq-status-plugin

Take it easy, it was really straight forward to install it after all.  
for those who would experiment some issues just
go in /usr/lib/rabbitmq/lib/rabbitmq_server-2.0.0/plugins then get
	-mochiweb-2.0.0.ez
	-rabbitmq-mochiweb-2.0.0.ez
	-rabbit_status-2.0.0.ez
from here, and voila !!

B.R,

Romary.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100915/58b83b72/attachment-0001.htm>

From simon at rabbitmq.com  Wed Sep 15 21:43:38 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Sep 2010 21:43:38 +0100
Subject: [rabbitmq-discuss] makefile for rabbitmq-management
In-Reply-To: <1C9929D2-AE7C-43BD-B136-3BC683FE4C87@jbrisbin.com>
References: <1C9929D2-AE7C-43BD-B136-3BC683FE4C87@jbrisbin.com>
Message-ID: <4C912FFA.6050406@rabbitmq.com>

On 14/09/10 19:38, Jon Brisbin wrote:
> If you do a fresh checkout of the public umbrella to build the
> management plugin, going into rabbitmq-management then "make" fails
> because it doesn't automagically build the dependencies. You have to
> manually build amqp_client and mochiweb before building management.

This is a general failure of the public umbrella I'm afraid. If you 
don't want to figure out the dependencies then you can invoke "make" in 
the umbrella and it'll build everything...

And the management plugin is available from 
http://www.rabbitmq.com/plugins.html, of course.

Cheers, Simon

From stevvooe at gmail.com  Thu Sep 16 01:41:43 2010
From: stevvooe at gmail.com (Stephen Day)
Date: Wed, 15 Sep 2010 17:41:43 -0700
Subject: [rabbitmq-discuss] 500 Internal server error while consuming with
	2.1.0 management plugin
Message-ID: <AANLkTimo_i9B+wJ=0gMQUcgTzNnWEW0ZJoH_WTvnK_YB@mail.gmail.com>

Here is the text from the management console web interface:

Got response code 500 with body

Internal Server Error

The server encountered an error while processing this request:
{error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
                                {rabbit_mgmt_db,gs_update_add,3},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {dict,update_bkt,4},
                                {dict,on_bucket,3},
                                {dict,update,4},
                                {lists,foldl,3}]},
              {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2},
              {webmachine_mochiweb,loop,1}]}}

Here are the related error reports, from the logs:

=ERROR REPORT==== 15-Sep-2010::17:38:15 ===
** Generic server rabbit_mgmt_db terminating
** Last message in was get_overview
** When Server state == {state,[{channel_exchange_stats,442426},
                                {channel_queue_exchange_stats,446523},
                                {channel_queue_stats,438329},
                                {channel_stats,434232},
                                {connection_stats,430135},
                                {queue_stats,426038}]}
** Reason for termination ==
** {function_clause,[{proplists,get_value,[rate,0,unknown]},
                     {rabbit_mgmt_db,gs_update_add,3},
                     {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                     {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                     {dict,update_bkt,4},
                     {dict,on_bucket,3},
                     {dict,update,4},
                     {lists,foldl,3}]}

=ERROR REPORT==== 15-Sep-2010::17:38:15 ===
webmachine error: path="/api/overview"
{error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
                                {rabbit_mgmt_db,gs_update_add,3},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {dict,update_bkt,4},
                                {dict,on_bucket,3},
                                {dict,update,4},
                                {lists,foldl,3}]},
              {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2},
              {webmachine_mochiweb,loop,1}]}}

From rabbit at subscribed.udmvt.ru  Thu Sep 16 08:57:17 2010
From: rabbit at subscribed.udmvt.ru (rabbit at subscribed.udmvt.ru)
Date: Thu, 16 Sep 2010 11:57:17 +0400
Subject: [rabbitmq-discuss] Clustering and ordering, please explain
Message-ID: <20100916075717.GG8187@ruber.office.udmvt.ru>

Hello, everyone.

I'm amused by the rabbitmq server's clustering capabilities,
but it seem unlear to me how exactly the messages get distributed
within a cluster of nodes.

As far as I understand, queues are not replicated between nodes, right?
But what about exchanges? They are replicated and "exists" on every node, right?

So, I'm imagined such situation:
suppose we have N boxes, each running rabbitmq cluster node.

Every box also executes some application instance, that connects to it's own
rabbitmq node, creates it's personal queue and binds it to one globally
known fanout exchange. Application instances publish their messages to
the exchange and receive the global message flow from personal queues.

So, if one box gets down, the rest continues without interruption, no one
notices that, right?

But the question is: what if two boxes, A and B, each have published a message
to the same exchange at the same moment in time, is it true, that
there is no ordering guaranties when that messages gets delivered
to queues across nodes? Is it true, that different queues may deliver
two messages in different order, despite they had been published on the same
exchange?

Sorry if it has already been described somewhere, I'll gratefully accept any links
discussing the subject.

From michaelburns1 at gmail.com  Thu Sep 16 09:01:17 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Thu, 16 Sep 2010 09:01:17 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <20100908094647.GB2851@dakota.eng.vmware.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
Message-ID: <AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>

Hi Alex,
Haven't had a chance to try with 2.0.0 but will do so soon.

I've noticed sometimes that there are extra connections hanging about on the
RabbitMQ broker (using rabbitmqctl  list_connections).
It's possible sometimes in our consumers that we are not always closing the
connection cleanly (sometimes people are simply killing their app rather
than shutting down cleanly).

Could this somehow explain why we experience these delays?

Cheers,
Michael

On Wed, Sep 8, 2010 at 10:46 AM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi,
>
> > Cool I'll try upgrading and see if that helps.
>
> Any luck with 2.0.0?
>
> Cheers,
> Alex
>
> On Mon, Sep 06, 2010 at 09:28:41AM +0100, Michael Burns wrote:
> > >
> > > When the slowdown occurs, does rabbit pick up speed a bit later?  Or do
> > > you have to restart it or something else of the sort?
> > >
> >
> > Yes it will pick up speed after a bit without a server restart.
> >
> >
> > >
> > > When it occurs, does list_queues show a large number of messages?  If
> > > so, you're probably not ack'ing the messages after consuming them.
> > >
> >
> > No. At the moment we're putting a very small number of messages through
> the
> > system. When the delay occurs I'm usually seeing one or two messages on
> the
> > queue. Eventually the messages will come through.
> > Is there anything we could whilst the message is on the queue that would
> > give more information as to why it is not being delivered?
> >
> >
> >
> >
> > >
> > > On an unrelated note, 2.0.0 is out, so you might want to upgrade.
> > >
> >
> > Cool I'll try upgrading and see if that helps.
> >
> > Cheers,
> > Michael
> >
> >
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
> > > > Hi Alex,
> > > > I ran the multicast client and am getting speeds like:
> > > >
> > > > sending rate: 3550 msg/s, basic returns: 0 ret/s
> > > > recving rate: 3461 msg/s, min/avg/max latency:
> 11931197/12253891/12477030
> > > > microseconds
> > > >
> > > > If I let it run for a bit then sometimes both the sending and
> receiving
> > > rate
> > > > drop significantly e.g.:
> > > >
> > > > sending rate: 638 msg/s, basic returns: 0 ret/s
> > > > recving rate: 628 msg/s, min/avg/max latency:
> 11788406/12363242/12735553
> > > > microseconds
> > > >
> > > > Not sure if this drop is indicative of anything?
> > > >
> > > > We're using the java client 1.8.1, the broker is
> rabbitmq_server-1.8.1
> > > >
> > > > Thanks
> > > > Michael
> > > >
> > > > On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
> > > > <alexandru at rabbitmq.com>wrote:
> > > >
> > > > > Hi Michael,
> > > > >
> > > > > > We are putting a very low volume of messages through and have
> > > sometimes
> > > > > had
> > > > > > to wait up to 15 minutes for a single message to be delivered (at
> the
> > > > > time
> > > > > > this was the only message in the system).
> > > > >
> > > > > That sounds strage.  Are you up for a bit of debugging?
> > > > >
> > > > > Download the java client,
> > > > >  http://www.rabbitmq.com/java-client.html
> > > > >
> > > > > Unpack it, and run
> > > > >  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
> > > > >
> > > > > That command will run one of our example programmes in a way that
> > > > > matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
> > > > >
> > > > > When I run it, I get speeds like:
> > > > >  recving rate: 6052 msg/s, min/avg/max latency:
> 1063522/1118048/1164637
> > > > > microseconds
> > > > >  sending rate: 6419 msg/s, basic returns: 0 ret/s
> > > > >
> > > > > If you're getting similar speeds, there's probably something wrong
> with
> > > > > the consumers/producers.  If not, it might be something to do with
> the
> > > > > server.
> > > > >
> > > > > Could you please try it?
> > > > >
> > > > > Also, which version the broker and which client are you using?
> > > > >
> > > > > Cheers,
> > > > > Alex
> > > > >
> > > > > On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
> > > > > > Hi,
> > > > > >
> > > > > > We're just starting out with RabbitMQ and have a very simple
> setup:
> > > one
> > > > > > queue, one producer doing a basicPublish and one consumer doing a
> > > > > > basicConsume using QueueingConsumer.
> > > > > >
> > > > > > For the most part it works fine however at fairly regular
> intervals
> > > we
> > > > > are
> > > > > > finding that messages remain on the queue for a considerable
> period
> > > > > before
> > > > > > being delivered to the consumer.
> > > > > >
> > > > > > We are putting a very low volume of messages through and have
> > > sometimes
> > > > > had
> > > > > > to wait up to 15 minutes for a single message to be delivered (at
> the
> > > > > time
> > > > > > this was the only message in the system).
> > > > > >
> > > > > > In all cases the messages are eventually delivered.
> > > > > >
> > > > > > I dont know where to start debugging this as there is nothing in
> the
> > > > > > RabbitMQ logs thats suggests something is going wrong - could
> anyone
> > > > > point
> > > > > > me in the right direction as to what may be causing this?
> > > > > >
> > > > > > Many Thanks,
> > > > > > Michael
> > > > >
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > >
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/ceca819a/attachment.htm>

From romary.kremer at gmail.com  Thu Sep 16 10:32:12 2010
From: romary.kremer at gmail.com (Romary Kremer)
Date: Thu, 16 Sep 2010 11:32:12 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
Message-ID: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>

We are performing evaluation on rabbitmq message broker, and we  
currently encounter difficulties with release 2.0.0:

- Our application implies 10 000 peers producing messages periodically  
to a unique queue. This queue is listen asynchronously by another peer.
- All peer are written in Java.
- The production rate of a single peer is 4 messages / hour.
- We can simulate a time-consuming task in the consumer callback,  
simulating more or less fast consumer.
- we are using SSL certificate on the broker side to allow the peer to  
authenticate the broker.
	- we have noticed that the use of SSL as dramatic incidence on the  
memory occupied by Rabbitmq process

Since we upgraded to version 2.0.0, we are no longer able to make a  
test scenario running. The symptoms are listed bellow :

on the broker console first, we get the message :

Erlang has closed
Error: unable to connect to node rabbit at murphys: nodedown
diagnostics:
- nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
- current node: rabbitmqctl22609 at murphys
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==

we have kept the erl_crash.dump in case, but since i's about 200 MB  I  
cannot do nothing to send it to you.
Maybe some one can give us some hints or some indicators to look out  
in the dump to help diagnostics, but we are not Erlang fluent !

What we know for sure is that the crash happens while the 10 000  
connections are established, at the beginning of the test.
We have monitored the  number of connections established and the  
crashes happens always around 4500 - 5000 connections, but never the  
same exact number.
We also tried with and without SSL but this does not help at all (same  
symptoms).

On the client side, our application registers a ShutdownListener to  
implement a connection retry logic upon shutdown.
The retries always failed with the error : connection refused.

here are some figures we gathered during the test start up about the  
maximum number of connection established before it crashes

- with SSL : 5404, 4493, 4399

- without SSL : 4673
			
we dont think that the problem is about file descriptors since we  
haven't changed anything in the configuration when we upgraded to 2.0.0.
The same test used to run successfully on previous version of the  
broker (1.7.2, and 1.8.1).
Moreover, the rabbit_status plugin tells us we have enough file  
descriptors as well as erlang processes
	- file descriptors (used / available)= 34 / 65535
	- elrang processes (used / available)= 160 / 1 000 000
	- memory (used / available)= 40 MB / 1609 MB

We haven't try the 2.1.0 yet because we would like to have your  
feedback about this issue before.

We would appreciate your feedbacks on that point before we migrate to  
release 2.1.0.

Best regards,

Romary.






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/6a8bd3bb/attachment-0001.htm>

From videlalvaro at gmail.com  Thu Sep 16 10:37:37 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 16 Sep 2010 17:37:37 +0800
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
Message-ID: <C80EC0C9-61F5-408F-85E8-2B766C47C6D3@gmail.com>

What about the number of erlang processes?

We had a problem of RabbitMQ crashing due to too many processes. The problem was that our library was creating thousand of channels per PHP process and that was bad as in really bad.

Regards,

Alvaro

On Sep 16, 2010, at 5:32 PM, Romary Kremer wrote:

> We are performing evaluation on rabbitmq message broker, and we currently encounter difficulties with release 2.0.0:
> 
> - Our application implies 10 000 peers producing messages periodically to a unique queue. This queue is listen asynchronously by another peer.
> - All peer are written in Java.
> - The production rate of a single peer is 4 messages / hour.
> - We can simulate a time-consuming task in the consumer callback, simulating more or less fast consumer.
> - we are using SSL certificate on the broker side to allow the peer to authenticate the broker.
> 	- we have noticed that the use of SSL as dramatic incidence on the memory occupied by Rabbitmq process
> 
> Since we upgraded to version 2.0.0, we are no longer able to make a test scenario running. The symptoms are listed bellow :
> 
> on the broker console first, we get the message :
> 
> Erlang has closed
> Error: unable to connect to node rabbit at murphys: nodedown
> diagnostics:
> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
> - current node: rabbitmqctl22609 at murphys
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
> 
> we have kept the erl_crash.dump in case, but since i's about 200 MB  I cannot do nothing to send it to you.
> Maybe some one can give us some hints or some indicators to look out in the dump to help diagnostics, but we are not Erlang fluent !
> 
> What we know for sure is that the crash happens while the 10 000 connections are established, at the beginning of the test. 
> We have monitored the  number of connections established and the crashes happens always around 4500 - 5000 connections, but never the same exact number. 
> We also tried with and without SSL but this does not help at all (same symptoms).
> 
> On the client side, our application registers a ShutdownListener to implement a connection retry logic upon shutdown. 
> The retries always failed with the error : connection refused.
> 
> here are some figures we gathered during the test start up about the maximum number of connection established before it crashes 
> 
> - with SSL : 5404, 4493, 4399
> 
> - without SSL : 4673
> 			
> we dont think that the problem is about file descriptors since we haven't changed anything in the configuration when we upgraded to 2.0.0.
> The same test used to run successfully on previous version of the broker (1.7.2, and 1.8.1).
> Moreover, the rabbit_status plugin tells us we have enough file descriptors as well as erlang processes
> 	- file descriptors (used / available)= 34 / 65535
> 	- elrang processes (used / available)= 160 / 1 000 000
> 	- memory (used / available)= 40 MB / 1609 MB
> 
> We haven't try the 2.1.0 yet because we would like to have your feedback about this issue before.
> 
> We would appreciate your feedbacks on that point before we migrate to release 2.1.0.
> 
> Best regards,
> 
> Romary.
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/37a5df10/attachment.htm>

From simon at rabbitmq.com  Thu Sep 16 10:50:45 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 Sep 2010 10:50:45 +0100
Subject: [rabbitmq-discuss] 500 Internal server error while consuming
 with	2.1.0 management plugin
In-Reply-To: <AANLkTimo_i9B+wJ=0gMQUcgTzNnWEW0ZJoH_WTvnK_YB@mail.gmail.com>
References: <AANLkTimo_i9B+wJ=0gMQUcgTzNnWEW0ZJoH_WTvnK_YB@mail.gmail.com>
Message-ID: <4C91E875.6040209@rabbitmq.com>

Thanks for the bug report. Now I know where my automated tests are 
inadequate :)

If I'm correct this should happen a few seconds after a new client (not 
the first one) comes on line, and it's transient. Does that match what 
you're seeing?

Cheers, Simon

On 16/09/10 01:41, Stephen Day wrote:
> Here is the text from the management console web interface:
>
> Got response code 500 with body
>
> Internal Server Error
>
> The server encountered an error while processing this request:
> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
>                                  {rabbit_mgmt_db,gs_update_add,3},
>                                  {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                                  {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                                  {dict,update_bkt,4},
>                                  {dict,on_bucket,3},
>                                  {dict,update,4},
>                                  {lists,foldl,3}]},
>                {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
>               [{gen_server,call,3},
>                {rabbit_mgmt_wm_overview,to_json,2},
>                {webmachine_resource,resource_call,3},
>                {webmachine_resource,do,3},
>                {webmachine_decision_core,resource_call,1},
>                {webmachine_decision_core,decision,1},
>                {webmachine_decision_core,handle_request,2},
>                {webmachine_mochiweb,loop,1}]}}
>
> Here are the related error reports, from the logs:
>
> =ERROR REPORT==== 15-Sep-2010::17:38:15 ===
> ** Generic server rabbit_mgmt_db terminating
> ** Last message in was get_overview
> ** When Server state == {state,[{channel_exchange_stats,442426},
>                                  {channel_queue_exchange_stats,446523},
>                                  {channel_queue_stats,438329},
>                                  {channel_stats,434232},
>                                  {connection_stats,430135},
>                                  {queue_stats,426038}]}
> ** Reason for termination ==
> ** {function_clause,[{proplists,get_value,[rate,0,unknown]},
>                       {rabbit_mgmt_db,gs_update_add,3},
>                       {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                       {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                       {dict,update_bkt,4},
>                       {dict,on_bucket,3},
>                       {dict,update,4},
>                       {lists,foldl,3}]}
>
> =ERROR REPORT==== 15-Sep-2010::17:38:15 ===
> webmachine error: path="/api/overview"
> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
>                                  {rabbit_mgmt_db,gs_update_add,3},
>                                  {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                                  {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>                                  {dict,update_bkt,4},
>                                  {dict,on_bucket,3},
>                                  {dict,update,4},
>                                  {lists,foldl,3}]},
>                {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
>               [{gen_server,call,3},
>                {rabbit_mgmt_wm_overview,to_json,2},
>                {webmachine_resource,resource_call,3},
>                {webmachine_resource,do,3},
>                {webmachine_decision_core,resource_call,1},
>                {webmachine_decision_core,decision,1},
>                {webmachine_decision_core,handle_request,2},
>                {webmachine_mochiweb,loop,1}]}}
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Thu Sep 16 10:51:18 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 16 Sep 2010 10:51:18 +0100
Subject: [rabbitmq-discuss] Clustering and ordering, please explain
In-Reply-To: <20100916075717.GG8187@ruber.office.udmvt.ru>
	(rabbit@subscribed.udmvt.ru's message of "Thu, 16 Sep 2010 11:57:17
	+0400")
References: <20100916075717.GG8187@ruber.office.udmvt.ru>
Message-ID: <yrv4c4odqqand.fsf@dwragg.eng.vmware.com>

rabbit at subscribed.udmvt.ru writes:
> As far as I understand, queues are not replicated between nodes,
> right?

Correct, the contents of a queue are stored on only one node.

> But what about exchanges? They are replicated and "exists" on every
> node, right?

Correct.

But note that exchanges do not buffer any messages.  Queues also exist
on every node in the following sense: You can connect to any node, and
consume from any queue.  It's just that the messages in the queue only
reside on one node.  Exchanges do not hold messages, but only route
them, so the same issue of replication of stored messages does not
arise.

> So, I'm imagined such situation:
> suppose we have N boxes, each running rabbitmq cluster node.
>
> Every box also executes some application instance, that connects to it's own
> rabbitmq node, creates it's personal queue and binds it to one globally
> known fanout exchange. Application instances publish their messages to
> the exchange and receive the global message flow from personal queues.
>
> So, if one box gets down, the rest continues without interruption, no one
> notices that, right?

Right.

> But the question is: what if two boxes, A and B, each have published a
> message to the same exchange at the same moment in time, is it true,
> that there is no ordering guaranties when that messages gets delivered
> to queues across nodes? Is it true, that different queues may deliver
> two messages in different order, despite they had been published on
> the same exchange?

AMQP does not guarantee the order of messages in this case anyway, so
even without clustering, it would be ok for rabbit to route the messages
to queues bound to the same exchange in different orders.

The ordering guarantees of AMQP 0-9-1 are covered in section 4.7 of the
specification PDF (available at
<http://www.amqp.org/confluence/display/AMQP/AMQP+Specification>:

   [...] Specifically, contents flowing through a single path within the
   server will remain ordered. For contents of a given priority flowing
   through a single path, we define a content processing path as
   consisting of one incoming channel, one exchange, one queue, and one
   outgoing channel. [...]

So if you have two queues, you are dealing with two different content
processing paths, and the order that messages arrive in the two queues
does not have to be consistent.

The relaxed nature of this ordering guarantee may surprise people.  It
surprised me.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From majek04 at gmail.com  Thu Sep 16 11:31:28 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 16 Sep 2010 11:31:28 +0100
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <E1ED8931-797F-4DC8-889A-2BDDFA6C54CD@gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<E1ED8931-797F-4DC8-889A-2BDDFA6C54CD@gmail.com>
Message-ID: <AANLkTimz26CrRRVKcvX==NGjS3o18nbEvfYm_9NH-sSU@mail.gmail.com>

On Wed, Sep 15, 2010 at 14:45, romary.kremer at gmail.com
<romary.kremer at gmail.com> wrote:
> since I can not find out the reasons of our problems yet, I've decided to
> perform some more basics tests.

Hurray!

> To step in the memory limitations faster, I 've decreased the memory
> watermark threshold to .05 (5%)
> This corresponds to 50 MB on the host we are using for this test?as shown on
> the rabbit.log file upon startup of broker :
> =INFO REPORT==== 15-Sep-2010::12:36:15 ===
> Memory limit set to 50MB.

Hooa. 50 megs is _really_ small. Probably more than half of it is
taken by Erlang
internals, really not much is left for Rabbit!
It's hard to say what is the minimal sensible memory allowance, but I'd guess
not less than 150 megs. Probably even 250 megs if you do anything non-trivial.

In your  50megs setup you may run into situation when once the memory
alarm goes on it _never_ goes off. That would mean you won't be able
to publish any message.


> Finally the broker status description (rabbitmqctl status)
> [{running_applications,[{rabbit_status,"RabbitMQ Status Page","0.01"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{rabbit,"RabbitMQ","2.0.0"},
> ?? ? ? ? ? ? ? ? ? ? ? ?{ssl,"Erlang/OTP SSL application","3.10.7"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {public_key,"Public key infrastructure","0.4"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ?? ? ? ? ? ? ? ? ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.4"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {sasl,"SASL ?CXC 138 11","2.1.8"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {rabbit_mochiweb,"RabbitMQ Mochiweb
> Embedding","0.01"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {mochiweb,"MochiMedia Web Server","1.3"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {crypto,"CRYPTO version 1","1.6.3"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {inets,"INETS ?CXC 138 49","5.2"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ?? ? ? ? ? ? ? ? ? ? ? ? {kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{nodes,[{disc,['rabbit at mystic-buntu']}]},
> ? {running_nodes,['rabbit at mystic-buntu']}]

Ok. For testing and benchmarking I'd recommend to remove status plugin.
Status plugin (if you look at the results) constantly queries Queues, which
may in some cases make it less likely to GC/hibernate them.

The new management plugin is better and shouldn't affect the GC that much.
(though for benchmarking it's still better to disalbe all the pluigins)

> - The last lines in the broker log are :
> =INFO REPORT==== 15-Sep-2010::14:53:44 === vm_memory_high_watermark set.
> Memory used:53650536 allowed:52556595 =INFO REPORT==== 15-Sep-2010::14:53:44
> === alarm_handler: {set,{vm_memory_high_watermark,[]}}
> From that point, the producer is blocked without any possible recovery. As
> the flow control is designed in v 2.0.0, I would have expected the producer
> to be released thanks to sawp of messages to the disk.

Yes it will! But only if it has enough memory to breathe!

What has happened is that internal Erlang stuff took most of the memory,
and even if we write everything to disk we won't be able to keep the
memory usage
under the threshold.

> I think this behaviour is not expected and maybe that could be due to a bug
> somewhere, since it si fully reproductible on my configuration.
> The fact that the memory occupation never falls below the threshold after
> message are removed from the queue is particularly strange and
> unwilling from my point of view. It think that this simple test can points
> out an issue that would explains the problems that I mentioned in the
> previous messages, but not sure about it.
> I am sorry for this quite long message, but I thought that the more details
> you get, the better.

Few suggestions:
 - Give rabbit more memory. How much memory? That depends on your setup.
   If you run 10k of connections you need enough memory to handle those
   connections + some memory to keep messages and queues.
   If the connections will eat up all the memory - rabbit won't allow
you to publish.
 - Disable status plugin (you can try to use management plugin).
 - Try new Erlang, R14B. They claim to have fixed some memory leaks with SSL,
   so it may help.

Cheers!
  Marek

From vlad at rabbitmq.com  Thu Sep 16 12:53:27 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 16 Sep 2010 12:53:27 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>	<20100903082934.GB2873@dakota.eng.vmware.com>	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>	<20100903120234.GD2873@dakota.eng.vmware.com>	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
Message-ID: <4C920537.4040104@rabbitmq.com>


Hi Michael,


Killing the app is not recommended, because there may be unflushed 
buffers in the client - that may cause some messages not to be delivered 
and others to be delivered incompletely (which the broker will 
eventually drop). It is always recommended to close all the channels and 
all the connections before shutting down the application.

FWIW, RabbitMQ should detect when the socket closes (for whatever 
reason) and remove those connections pretty quickly (even if you didn't 
do a clean shutdown). I wonder why you still see the connections after 
killing the app.

Anyway, I don't see how that could interfere with the delays problem.


Rgds,
Vlad.


On 09/16/2010 09:01 AM, Michael Burns wrote:
> Hi Alex,
> Haven't had a chance to try with 2.0.0 but will do so soon.
>
> I've noticed sometimes that there are extra connections hanging about 
> on the RabbitMQ broker (using rabbitmqctl  list_connections).
> It's possible sometimes in our consumers that we are not always 
> closing the connection cleanly (sometimes people are simply killing 
> their app rather than shutting down cleanly).
>
> Could this somehow explain why we experience these delays?
>
> Cheers,
> Michael
>
> On Wed, Sep 8, 2010 at 10:46 AM, Alexandru Scvor?ov 
> <alexandru at rabbitmq.com <mailto:alexandru at rabbitmq.com>> wrote:
>
>     Hi,
>
>     > Cool I'll try upgrading and see if that helps.
>
>     Any luck with 2.0.0?
>
>     Cheers,
>     Alex
>
>     On Mon, Sep 06, 2010 at 09:28:41AM +0100, Michael Burns wrote:
>     > >
>     > > When the slowdown occurs, does rabbit pick up speed a bit
>     later?  Or do
>     > > you have to restart it or something else of the sort?
>     > >
>     >
>     > Yes it will pick up speed after a bit without a server restart.
>     >
>     >
>     > >
>     > > When it occurs, does list_queues show a large number of
>     messages?  If
>     > > so, you're probably not ack'ing the messages after consuming them.
>     > >
>     >
>     > No. At the moment we're putting a very small number of messages
>     through the
>     > system. When the delay occurs I'm usually seeing one or two
>     messages on the
>     > queue. Eventually the messages will come through.
>     > Is there anything we could whilst the message is on the queue
>     that would
>     > give more information as to why it is not being delivered?
>     >
>     >
>     >
>     >
>     > >
>     > > On an unrelated note, 2.0.0 is out, so you might want to upgrade.
>     > >
>     >
>     > Cool I'll try upgrading and see if that helps.
>     >
>     > Cheers,
>     > Michael
>     >
>     >
>     > >
>     > > Cheers,
>     > > Alex
>     > >
>     > > On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
>     > > > Hi Alex,
>     > > > I ran the multicast client and am getting speeds like:
>     > > >
>     > > > sending rate: 3550 msg/s, basic returns: 0 ret/s
>     > > > recving rate: 3461 msg/s, min/avg/max latency:
>     11931197/12253891/12477030
>     > > > microseconds
>     > > >
>     > > > If I let it run for a bit then sometimes both the sending
>     and receiving
>     > > rate
>     > > > drop significantly e.g.:
>     > > >
>     > > > sending rate: 638 msg/s, basic returns: 0 ret/s
>     > > > recving rate: 628 msg/s, min/avg/max latency:
>     11788406/12363242/12735553
>     > > > microseconds
>     > > >
>     > > > Not sure if this drop is indicative of anything?
>     > > >
>     > > > We're using the java client 1.8.1, the broker is
>     rabbitmq_server-1.8.1
>     > > >
>     > > > Thanks
>     > > > Michael
>     > > >
>     > > > On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor?ov
>     > > > <alexandru at rabbitmq.com <mailto:alexandru at rabbitmq.com>>wrote:
>     > > >
>     > > > > Hi Michael,
>     > > > >
>     > > > > > We are putting a very low volume of messages through and
>     have
>     > > sometimes
>     > > > > had
>     > > > > > to wait up to 15 minutes for a single message to be
>     delivered (at the
>     > > > > time
>     > > > > > this was the only message in the system).
>     > > > >
>     > > > > That sounds strage.  Are you up for a bit of debugging?
>     > > > >
>     > > > > Download the java client,
>     > > > > http://www.rabbitmq.com/java-client.html
>     > > > >
>     > > > > Unpack it, and run
>     > > > >  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
>     > > > >
>     > > > > That command will run one of our example programmes in a
>     way that
>     > > > > matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
>     > > > >
>     > > > > When I run it, I get speeds like:
>     > > > >  recving rate: 6052 msg/s, min/avg/max latency:
>     1063522/1118048/1164637
>     > > > > microseconds
>     > > > >  sending rate: 6419 msg/s, basic returns: 0 ret/s
>     > > > >
>     > > > > If you're getting similar speeds, there's probably
>     something wrong with
>     > > > > the consumers/producers.  If not, it might be something to
>     do with the
>     > > > > server.
>     > > > >
>     > > > > Could you please try it?
>     > > > >
>     > > > > Also, which version the broker and which client are you using?
>     > > > >
>     > > > > Cheers,
>     > > > > Alex
>     > > > >
>     > > > > On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
>     > > > > > Hi,
>     > > > > >
>     > > > > > We're just starting out with RabbitMQ and have a very
>     simple setup:
>     > > one
>     > > > > > queue, one producer doing a basicPublish and one
>     consumer doing a
>     > > > > > basicConsume using QueueingConsumer.
>     > > > > >
>     > > > > > For the most part it works fine however at fairly
>     regular intervals
>     > > we
>     > > > > are
>     > > > > > finding that messages remain on the queue for a
>     considerable period
>     > > > > before
>     > > > > > being delivered to the consumer.
>     > > > > >
>     > > > > > We are putting a very low volume of messages through and
>     have
>     > > sometimes
>     > > > > had
>     > > > > > to wait up to 15 minutes for a single message to be
>     delivered (at the
>     > > > > time
>     > > > > > this was the only message in the system).
>     > > > > >
>     > > > > > In all cases the messages are eventually delivered.
>     > > > > >
>     > > > > > I dont know where to start debugging this as there is
>     nothing in the
>     > > > > > RabbitMQ logs thats suggests something is going wrong -
>     could anyone
>     > > > > point
>     > > > > > me in the right direction as to what may be causing this?
>     > > > > >
>     > > > > > Many Thanks,
>     > > > > > Michael
>     > > > >
>     > > > > > _______________________________________________
>     > > > > > rabbitmq-discuss mailing list
>     > > > > > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     > > > > >
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     > > > >
>     > > > >
>     > >
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/6135687b/attachment.htm>

From emile at rabbitmq.com  Thu Sep 16 13:12:42 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Sep 2010 13:12:42 +0100
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
Message-ID: <4C9209BA.7030600@rabbitmq.com>


Hi Romary,

Thanks for this error report. Can you confirm whether the logfile
contained anything relevant before the broker became unavailable? Do you
override any default configuration variables in the broker config file?

If you find memory usage growing with SSL then try using Erlang R14B.
(Also see OTP-8810) What version of Erlang are you currently using?


Regards

Emile





On 16/09/10 10:32, Romary Kremer wrote:
> We are performing evaluation on rabbitmq message broker, and we
> currently encounter difficulties with release 2.0.0:
> 
> - Our application implies 10 000 peers producing messages periodically
> to a unique queue. This queue is listen asynchronously by another peer.
> - All peer are written in Java.
> - The production rate of a single peer is 4 messages / hour.
> - We can simulate a time-consuming task in the consumer callback,
> simulating more or less fast consumer.
> - we are using SSL certificate on the broker side to allow the peer to
> authenticate the broker.
> - we have noticed that the use of SSL as dramatic incidence on the
> memory occupied by Rabbitmq process
> 
> Since we upgraded to version *2.0.0*, we are no longer able to make a
> test scenario running. The symptoms are listed bellow :
> 
> on the broker console first, we get the message :
> 
> Erlang has closed
> Error: unable to connect to node rabbit at murphys: nodedown
> diagnostics:
> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
> - current node: rabbitmqctl22609 at murphys
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
> 
> we have kept the erl_crash.dump in case, but since i's about 200 MB  I
> cannot do nothing to send it to you.
> Maybe some one can give us some hints or some indicators to look out in
> the dump to help diagnostics, but we are not Erlang fluent !
> 
> What we know for sure is that the crash happens while the 10 000
> connections are established, at the beginning of the test. 
> We have monitored the  number of connections established and the crashes
> happens always around 4500 - 5000 connections, but never the same exact
> number. 
> We also tried with and without SSL but this does not help at all (same
> symptoms).
> 
> On the client side, our application registers a ShutdownListener to
> implement a connection retry logic upon shutdown. 
> The retries always failed with the error : connection refused.
> 
> here are some figures we gathered during the test start up about the
> maximum number of connection established before it crashes 
> 
> - with SSL : 5404, 4493, 4399
> 
> - without SSL : 4673
> we dont think that the problem is about file descriptors since we
> haven't changed anything in the configuration when we upgraded to 2.0.0.
> The same test used to run successfully on previous version of the broker
> (1.7.2, and 1.8.1).
> Moreover, the rabbit_status plugin tells us we have enough file
> descriptors as well as erlang processes
> - file descriptors (used / available)= 34 / 65535
> - elrang processes (used / available)= 160 / 1 000 000
> - memory (used / available)= 40 MB / 1609 MB
> 
> We haven't try the *2.1.0* yet because we would like to have your
> feedback about this issue before.
> 
> We would appreciate your feedbacks on that point before we migrate to
> release 2.1.0.
> 
> Best regards,
> 
> Romary.

From vlad at rabbitmq.com  Thu Sep 16 13:37:08 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Thu, 16 Sep 2010 13:37:08 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>	<20100903082934.GB2873@dakota.eng.vmware.com>	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>	<20100903120234.GD2873@dakota.eng.vmware.com>	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
Message-ID: <4C920F74.1040705@rabbitmq.com>


>
> I've noticed sometimes that there are extra connections hanging about 
> on the RabbitMQ broker (using rabbitmqctl  list_connections).

Michael, can you tell us which client(s) are you using?

Thanks,
Vlad.


From michaelburns1 at gmail.com  Thu Sep 16 13:39:50 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Thu, 16 Sep 2010 13:39:50 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <4C920F74.1040705@rabbitmq.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<4C920F74.1040705@rabbitmq.com>
Message-ID: <AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>

Hi Vlad,
We're using the Java client 1.8.1


Thanks,
Michael

On Thu, Sep 16, 2010 at 1:37 PM, Vlad Alexandru Ionescu
<vlad at rabbitmq.com>wrote:

>
>
>> I've noticed sometimes that there are extra connections hanging about on
>> the RabbitMQ broker (using rabbitmqctl  list_connections).
>>
>
> Michael, can you tell us which client(s) are you using?
>
> Thanks,
> Vlad.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/7d796057/attachment-0001.htm>

From majek04 at gmail.com  Thu Sep 16 13:49:39 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 16 Sep 2010 13:49:39 +0100
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
	<AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
	<0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>
Message-ID: <AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>

On Wed, Sep 15, 2010 at 19:11, romary.kremer at gmail.com
<romary.kremer at gmail.com> wrote:
> Yes. You will never hear "FlowListener.handleFlow()" and it may be possible
> for
> channel.publish to block (though I would need to consult the sources
> to be sure).
>
> It seems to me that FlowListener interface is likely to be deprecated so,
> does'nt it ?

It's more complex than that, but yes, you won't hear anything on that interface.

> Does not really matter for us anyway, cause we where on wrong idea using
> that.
> Does this new implementation keep the broker on track for compliance with
> specification then ?

Yes, the spec doesn't force us to send channel.flow. We implemented that
for a while but realized that it doesn't solve our problems.

> This would be acceptable for our needs, only if we can somehow guarantee
> that's an upper boundary !

Optimistically, the upper bouadary is not more than your memory usage
divided by the disk throughput.

> But it is possible to create a very pessimistic environment in which the
> memory usage will not drop - and the connection could be stuck for a long
> time.
> (though it's pretty unlikely).

> ... Not that much unlikely, considering my little?playing with the
> MultiCastMain sample (see my previous reply about it for details).
> I get 100 % times blocked connection.
> What would be, based on your knowledge and your intuition, "a very
> pessimistic environment in which the memory usage will not drop" ?
> I think that the experimentation I've done on the MultiCastMain is maybe a
> beginning of an answer for that question, although I would
> never have considered that a single producer could have such power to flood
> the broker.

Okay. The memory can stay high due to a lot of reasons. If your metadata
that rabbit never releases is using more memory than threshold -
rabbit will just get stuck.

Next thing. remember, we don't control how erlang eats memory - and it
has pretty
complex GC and memory allocation mechanisms.

If you think that you have enough memory for all the connections,
queues, exchanges and bindings. And some memory for the messages.
And you still hit the limit when you get stuck - feel free to tune
Erlang GC internals:
  http://www.erlang.org/doc/man/erts_alloc.html

> Weren't Channel design for that ? In our environment, we have (naively ?)
> considered the use of Channel to
> separate the message production from the consumption.
> Since we are targeting 10 000 peers doing both production and consumption,
> the fact of multiplying the number of
> connections by 2 is not negligible at all, considering scalability.
> Moreover, as I reported later on, we use SSL to authenticate the broker, and
> we are still unclear about memory leaks
> induce by SSL connections. Doubling the number of connections will not be
> negligible at all considering memory occupation either.
> In conclusion, we are not likely to implement our peers using 2 connections
> for the same broker.
> What would you recommend to us then ? And could you give us a better
> understanding on the use case of channels ?

Yes, channels were designed exactly for that. On the other hand, AMQP
has few pretty serious issues. For example when you open channel
you're free to publish a message. And broker can't 'refuse' accepting
a message. Channel.flow can be sent from the broker to the client
but *after* channel is opened. So there is a window in which
you just can publish (after channel.open before channel.flow). Sorry, there
just isn't other way of forbidding publishes than by stopping the whole
connection. I also don't like it, but it's the only way.


Cheers,
 Marek

From romary.kremer at gmail.com  Thu Sep 16 14:19:06 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Thu, 16 Sep 2010 15:19:06 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <4C9209BA.7030600@rabbitmq.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
	<4C9209BA.7030600@rabbitmq.com>
Message-ID: <BB914787-22C2-4D70-8620-4533BE06DF6F@gmail.com>


Le 16 sept. 10 ? 14:12, Emile Joubert a ?crit :

Hi,
thanks for the support. The same problem happens both with the version  
2.0.0 and 2.1.0 !!
I have just performed the upgrade on our development environment, but  
it does not seem to solve this issue.

>
> Hi Romary,
>
> Thanks for this error report. Can you confirm whether the logfile
> contained anything relevant before the broker became unavailable?

Nope, the broker log does not contain anything relevant. Here is an  
extract of the log file when the broker crashes :

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
Limiting to approx 65435 file handles (58889 sockets)

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
Memory limit set to 1609MB.

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 16-Sep-2010::14:47:47 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 16-Sep-2010::14:47:47 ===
started SSL Listener on 0.0.0.0:5671

> Do you
> override any default configuration variables in the broker config  
> file?
>

Ho yes we did :

here is the /etc/rabbitmq/rabbitmq.config

[
   {rabbit, [
      {vm_memory_high_watermark, 0.8},
      {ssl_listeners, [{"0.0.0.0",5671}]},
      {ssl_options, [{cacertfile,"/var/lib/rabbitmq/ssl/certificate- 
authority/schneider-ca.pem"},
                     {certfile,"/var/lib/rabbitmq/ssl/broker-certs/ 
broker-cert.pem"},
                     {keyfile,"/var/lib/rabbitmq/ssl/broker-certs/ 
broker-key.pem"},
                     {verify,verify_none},
                     {fail_if_no_peer_cert,false}]}
    ]}
].


and ther is the /etc/rabbitmq/rabbitmq.conf

# increase the max number of Erlang lightweight process
SERVER_ERL_ARGS="$SERVER_ERL_ARGS +P 1000000"
RABBITMQ_MULTI_ERL_ARGS="$RABBITMQ_MULTI_ERL_ARGS +P 1000000"

finaly the /etc/default/rabbitmq

# 65,635 maximum connections per rabbitmq process
ulimit -n 65535


> If you find memory usage growing with SSL then try using Erlang R14B.
> (Also see OTP-8810) What version of Erlang are you currently using?

Yes we are on our way to upgrade to Erlang R14B too !! I will let you  
know if it solves any of our troubles !

> Regards
>
> Emile
>

Thanks for all,

Romary.

>
>
>
>
> On 16/09/10 10:32, Romary Kremer wrote:
>> We are performing evaluation on rabbitmq message broker, and we
>> currently encounter difficulties with release 2.0.0:
>>
>> - Our application implies 10 000 peers producing messages  
>> periodically
>> to a unique queue. This queue is listen asynchronously by another  
>> peer.
>> - All peer are written in Java.
>> - The production rate of a single peer is 4 messages / hour.
>> - We can simulate a time-consuming task in the consumer callback,
>> simulating more or less fast consumer.
>> - we are using SSL certificate on the broker side to allow the peer  
>> to
>> authenticate the broker.
>> - we have noticed that the use of SSL as dramatic incidence on the
>> memory occupied by Rabbitmq process
>>
>> Since we upgraded to version *2.0.0*, we are no longer able to make a
>> test scenario running. The symptoms are listed bellow :
>>
>> on the broker console first, we get the message :
>>
>> Erlang has closed
>> Error: unable to connect to node rabbit at murphys: nodedown
>> diagnostics:
>> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
>> - current node: rabbitmqctl22609 at murphys
>> - current node home dir: /var/lib/rabbitmq
>> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
>>
>> we have kept the erl_crash.dump in case, but since i's about 200  
>> MB  I
>> cannot do nothing to send it to you.
>> Maybe some one can give us some hints or some indicators to look  
>> out in
>> the dump to help diagnostics, but we are not Erlang fluent !
>>
>> What we know for sure is that the crash happens while the 10 000
>> connections are established, at the beginning of the test.
>> We have monitored the  number of connections established and the  
>> crashes
>> happens always around 4500 - 5000 connections, but never the same  
>> exact
>> number.
>> We also tried with and without SSL but this does not help at all  
>> (same
>> symptoms).
>>
>> On the client side, our application registers a ShutdownListener to
>> implement a connection retry logic upon shutdown.
>> The retries always failed with the error : connection refused.
>>
>> here are some figures we gathered during the test start up about the
>> maximum number of connection established before it crashes
>>
>> - with SSL : 5404, 4493, 4399
>>
>> - without SSL : 4673
>> we dont think that the problem is about file descriptors since we
>> haven't changed anything in the configuration when we upgraded to  
>> 2.0.0.
>> The same test used to run successfully on previous version of the  
>> broker
>> (1.7.2, and 1.8.1).
>> Moreover, the rabbit_status plugin tells us we have enough file
>> descriptors as well as erlang processes
>> - file descriptors (used / available)= 34 / 65535
>> - elrang processes (used / available)= 160 / 1 000 000
>> - memory (used / available)= 40 MB / 1609 MB
>>
>> We haven't try the *2.1.0* yet because we would like to have your
>> feedback about this issue before.
>>
>> We would appreciate your feedbacks on that point before we migrate to
>> release 2.1.0.
>>
>> Best regards,
>>
>> Romary.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/e8e708fa/attachment.htm>

From romary.kremer at gmail.com  Thu Sep 16 14:54:39 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Thu, 16 Sep 2010 15:54:39 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <4C9209BA.7030600@rabbitmq.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>
	<4C9209BA.7030600@rabbitmq.com>
Message-ID: <19488F99-B178-493E-8846-989122D1A00C@gmail.com>

Well, I' ve done another run with the whole upgraded configuration
- RabbitMQ version 2.1.0
- Erlang R14B (version 5.8.1)
- No SSL connections (but SSL listener still active on the broker, not  
used)

The memory_high_watermark is set to 0.8, 80% equivalent to 1609 MB !

I've monitored with rabbit_status, even someone had advised not to  
while benchmarking (why not ?)
The memory available raised the threshold before the end of  
connections of 10 000 peers.

Maybe the average memory occupied by a single, non SSL connection has  
somehow get bigger between
release 1.8.x and 2.x.x ??

Does anybody has experiment or knows the impact of the new release on  
the memory occupied by connections ?

I insist in the fact that, in our environment, we can toggle SSL  
authentication of the broker by peers, but we always
keep the SSL listener running on the broker. The peer just "decide" to  
connect either on 5672 or 5671. In the later,
SSL authentication will be enable, in the former, it won't !

Thanks for any other idea we can follow, because we are facing a bit  
of a dead end since we upgraded to 2.x.x !

Cheers,

Romary.


Le 16 sept. 10 ? 14:12, Emile Joubert a ?crit :

>
> Hi Romary,
>
> Thanks for this error report. Can you confirm whether the logfile
> contained anything relevant before the broker became unavailable? Do  
> you
> override any default configuration variables in the broker config  
> file?
>
> If you find memory usage growing with SSL then try using Erlang R14B.
> (Also see OTP-8810) What version of Erlang are you currently using?
>
>
> Regards
>
> Emile
>
>
>
>
>
> On 16/09/10 10:32, Romary Kremer wrote:
>> We are performing evaluation on rabbitmq message broker, and we
>> currently encounter difficulties with release 2.0.0:
>>
>> - Our application implies 10 000 peers producing messages  
>> periodically
>> to a unique queue. This queue is listen asynchronously by another  
>> peer.
>> - All peer are written in Java.
>> - The production rate of a single peer is 4 messages / hour.
>> - We can simulate a time-consuming task in the consumer callback,
>> simulating more or less fast consumer.
>> - we are using SSL certificate on the broker side to allow the peer  
>> to
>> authenticate the broker.
>> - we have noticed that the use of SSL as dramatic incidence on the
>> memory occupied by Rabbitmq process
>>
>> Since we upgraded to version *2.0.0*, we are no longer able to make a
>> test scenario running. The symptoms are listed bellow :
>>
>> on the broker console first, we get the message :
>>
>> Erlang has closed
>> Error: unable to connect to node rabbit at murphys: nodedown
>> diagnostics:
>> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
>> - current node: rabbitmqctl22609 at murphys
>> - current node home dir: /var/lib/rabbitmq
>> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
>>
>> we have kept the erl_crash.dump in case, but since i's about 200  
>> MB  I
>> cannot do nothing to send it to you.
>> Maybe some one can give us some hints or some indicators to look  
>> out in
>> the dump to help diagnostics, but we are not Erlang fluent !
>>
>> What we know for sure is that the crash happens while the 10 000
>> connections are established, at the beginning of the test.
>> We have monitored the  number of connections established and the  
>> crashes
>> happens always around 4500 - 5000 connections, but never the same  
>> exact
>> number.
>> We also tried with and without SSL but this does not help at all  
>> (same
>> symptoms).
>>
>> On the client side, our application registers a ShutdownListener to
>> implement a connection retry logic upon shutdown.
>> The retries always failed with the error : connection refused.
>>
>> here are some figures we gathered during the test start up about the
>> maximum number of connection established before it crashes
>>
>> - with SSL : 5404, 4493, 4399
>>
>> - without SSL : 4673
>> we dont think that the problem is about file descriptors since we
>> haven't changed anything in the configuration when we upgraded to  
>> 2.0.0.
>> The same test used to run successfully on previous version of the  
>> broker
>> (1.7.2, and 1.8.1).
>> Moreover, the rabbit_status plugin tells us we have enough file
>> descriptors as well as erlang processes
>> - file descriptors (used / available)= 34 / 65535
>> - elrang processes (used / available)= 160 / 1 000 000
>> - memory (used / available)= 40 MB / 1609 MB
>>
>> We haven't try the *2.1.0* yet because we would like to have your
>> feedback about this issue before.
>>
>> We would appreciate your feedbacks on that point before we migrate to
>> release 2.1.0.
>>
>> Best regards,
>>
>> Romary.


From emile at rabbitmq.com  Thu Sep 16 15:27:42 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Sep 2010 15:27:42 +0100
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <19488F99-B178-493E-8846-989122D1A00C@gmail.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>
	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>
Message-ID: <4C92295E.9010300@rabbitmq.com>


Hi Romary,

On 16/09/10 14:54, romary.kremer at gmail.com wrote:
> Well, I' ve done another run with the whole upgraded configuration
> - RabbitMQ version 2.1.0
> - Erlang R14B (version 5.8.1)
> - No SSL connections (but SSL listener still active on the broker, not
> used)
> 
> The memory_high_watermark is set to 0.8, 80% equivalent to 1609 MB !

That is too high. It is not advised to set the highwater mark above 50%.
Can you reproduce the problem while the vm_memory_high_watermark is set
to 0.4 ?

> I've monitored with rabbit_status, even someone had advised not to while
> benchmarking (why not ?)

rabbitmqctl or rabbit_status are invaluable for debugging the kind of
problem you are reporting. Continuous use incurs a small performance
penalty and can prevent quiescent resources from hibernating.

> The memory available raised the threshold before the end of connections
> of 10 000 peers.
> 
> Maybe the average memory occupied by a single, non SSL connection has
> somehow get bigger between
> release 1.8.x and 2.x.x ??

The data structures have changed from 1.8.1 to 2.0.0, but I don't think
that is the cause of the problem.

> Does anybody has experiment or knows the impact of the new release on
> the memory occupied by connections ?
> 
> I insist in the fact that, in our environment, we can toggle SSL
> authentication of the broker by peers, but we always
> keep the SSL listener running on the broker. The peer just "decide" to
> connect either on 5672 or 5671. In the later,
> SSL authentication will be enable, in the former, it won't !
> 
> Thanks for any other idea we can follow, because we are facing a bit of
> a dead end since we upgraded to 2.x.x !

I'm surprised that the logfile you posted previously stops after opening
ssl and tcp listeners. I would expect to see evidence of 4000+ clients
connecting.

Are you able to get output from "rabbitmqctl list_connections" before
the broker becomes unresponsive? What is the status of the beam or
beam.smp process at that point - is it still running? How much memory
and CPU is it consuming?





Regards

Emile

From romary.kremer at gmail.com  Thu Sep 16 16:38:53 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Thu, 16 Sep 2010 17:38:53 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <4C92295E.9010300@rabbitmq.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>
	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>
	<4C92295E.9010300@rabbitmq.com>
Message-ID: <5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>


Le 16 sept. 10 ? 16:27, Emile Joubert a ?crit :

>
> Hi Romary,
>
> On 16/09/10 14:54, romary.kremer at gmail.com wrote:
>> Well, I' ve done another run with the whole upgraded configuration
>> - RabbitMQ version 2.1.0
>> - Erlang R14B (version 5.8.1)
>> - No SSL connections (but SSL listener still active on the broker,  
>> not
>> used)
>>
>> The memory_high_watermark is set to 0.8, 80% equivalent to 1609 MB !
>
> That is too high. It is not advised to set the highwater mark above  
> 50%.
> Can you reproduce the problem while the vm_memory_high_watermark is  
> set
> to 0.4 ?

Since we started to investigate on RabbitMQ, we started (with version  
1.7.2) we have never been able to successfully open
10 000 SSL connection with a watermark less that 0.8 (1609 MB) !

The fact is that with 1.7.2 and 1.8.x  we successfully managed to  
accept 10 000 connections, without SSL, with the default watermark of  
0.4
Let me get back into the past to persent the history :
	- we started with default setting of rabbitMQ 1.7.2, with a version  
that does not use  SSL. It works fine.

	- Then our requirements evolved, and we decided that peers must  
authenticate the borker upon connection, so we started to investigate  
on the use of SSL.
	
	- From that point, we could not manage a successful run unless we  
increase the watermark up to 0.8.

	- Now we upgrade to version 2.x.x of RabbitMQ and we realize that the  
application that used to work on 1.8.0, with SSL no longer work on the  
2.0.0, neither on 2.1.0.

	- That's why we decided to run the same test, disabling the SSL  
authentication, and the same issues happens again either on 2.0.0 or  
2.1.0.

>
>> I've monitored with rabbit_status, even someone had advised not to  
>> while
>> benchmarking (why not ?)
>
> rabbitmqctl or rabbit_status are invaluable for debugging the kind of
> problem you are reporting. Continuous use incurs a small performance
> penalty and can prevent quiescent resources from hibernating.

Then what would you recommend us for monitoring the broker a bit less  
intrusively ?
Actually, in our environment, we have settled a set of tool to monitor  
the CPU load and the overall memory of the rabbitMQ erlang process.  
For that we use the UNIX built in tools
such as sar, netstat, and ps with option to see the memory occupied.

We also monitor the queue depth by invoking rabbitmq_ctl list_queues,  
but the problem occurs also whit that monitoring turned OFF !!

After a test, we are able to built some graphics displaying the  
different statistics monitored.
If you want, I can send you extract of these reports so you will have  
better overview on how the broker behave during tests.

Just to have a look, I join you the following snapshots :

- S0_withSSL_withQueueMonitoring : shows the broker behaviour while  
trying to connect 10 000 peers, with SSL

- S0_noSSL_withQueueMonitoring : shows the broker behaviour while  
trying to connect 10 000 peers wihtout SSL

- S0_noSSL_noQueueMonitoring : shows the broker behaviour while trying  
to connect 10 000 peers without SSL, and without periodic call to  
rabbitmqctl list_queues

>
>> The memory available raised the threshold before the end of  
>> connections
>> of 10 000 peers.
>>
>> Maybe the average memory occupied by a single, non SSL connection has
>> somehow get bigger between
>> release 1.8.x and 2.x.x ??
>
> The data structures have changed from 1.8.1 to 2.0.0, but I don't  
> think
> that is the cause of the problem.
>
>> Does anybody has experiment or knows the impact of the new release on
>> the memory occupied by connections ?
>>
>> I insist in the fact that, in our environment, we can toggle SSL
>> authentication of the broker by peers, but we always
>> keep the SSL listener running on the broker. The peer just "decide"  
>> to
>> connect either on 5672 or 5671. In the later,
>> SSL authentication will be enable, in the former, it won't !
>>
>> Thanks for any other idea we can follow, because we are facing a  
>> bit of
>> a dead end since we upgraded to 2.x.x !
>
> I'm surprised that the logfile you posted previously stops after  
> opening
> ssl and tcp listeners. I would expect to see evidence of 4000+ clients
> connecting.

Yes sorry for that, but it indeed contains those line for connection  
accepted / started, but noting interesting after that. Basically we  
jump from a series of connection started
to a series of connection stopped, without no other warning, nor  
error, until the end of the log file.

>
> Are you able to get output from "rabbitmqctl list_connections" before
> the broker becomes unresponsive? What is the status of the beam or
> beam.smp process at that point - is it still running? How much memory
> and CPU is it consuming?

Those information can be gathered by our own "monitoring framework" as  
explained above. But as you said just before, the rabbitmq_ctl may be  
too intrusive, we use netstat to list the
established connection on the port 5672 (5671 if SSL is turned ON).

Thanks for the support again !

Best regards,

Romary.

See attach files :
-------------- next part --------------
A non-text attachment was scrubbed...
Name: S0_noSSL_noQueueMonitoring.jpg
Type: image/jpeg
Size: 41106 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/7d6db30f/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: S0_noSSL_withQueueMonitoring.jpg
Type: image/jpeg
Size: 52748 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/7d6db30f/attachment-0004.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: S0_withSSL_withQueueMonitoring.jpg
Type: image/jpeg
Size: 55918 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/7d6db30f/attachment-0005.jpg>
-------------- next part --------------

>
>
>
>
>
> Regards
>
> Emile


From v.p.saravanan at gmail.com  Fri Sep 17 09:51:35 2010
From: v.p.saravanan at gmail.com (specialsaran)
Date: Fri, 17 Sep 2010 01:51:35 -0700 (PDT)
Subject: [rabbitmq-discuss]  How to use Consumer as Producer in rabbitmq
Message-ID: <29736359.post@talk.nabble.com>


Hi,
I am new to RabbitMQ , i would like to know how to use consumer as producer
and vice versa ie the consumer will use to receive the message from the
queue at the same time it should be able to transmit the message to the
exchange and same for producer too , it should transmit and receive message.

Thankyou in advance
Saran 
-- 
View this message in context: http://old.nabble.com/How-to-use-Consumer-as-Producer-in-rabbitmq-tp29736359p29736359.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Fri Sep 17 10:11:38 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Sep 2010 10:11:38 +0100
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>	<4C92295E.9010300@rabbitmq.com>
	<5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>
Message-ID: <4C9330CA.6090800@rabbitmq.com>


Hi Romary,

On 16/09/10 16:38, romary.kremer at gmail.com wrote:
> 
> Le 16 sept. 10 ? 16:27, Emile Joubert a ?crit :
> 
>>
>> Hi Romary,
>>
>> On 16/09/10 14:54, romary.kremer at gmail.com wrote:
>>> Well, I' ve done another run with the whole upgraded configuration
>>> - RabbitMQ version 2.1.0
>>> - Erlang R14B (version 5.8.1)
>>> - No SSL connections (but SSL listener still active on the broker, not
>>> used)
>>>
>>> The memory_high_watermark is set to 0.8, 80% equivalent to 1609 MB !
>>
>> That is too high. It is not advised to set the highwater mark above 50%.
>> Can you reproduce the problem while the vm_memory_high_watermark is set
>> to 0.4 ?
> 
> Since we started to investigate on RabbitMQ, we started (with version
> 1.7.2) we have never been able to successfully open
> 10 000 SSL connection with a watermark less that 0.8 (1609 MB) !

If you need to set the highwater mark above 50% then it means your
server should have more RAM. Are you able to execute the test on a
server with 4Gb or more?

> The fact is that with 1.7.2 and 1.8.x  we successfully managed to accept
> 10 000 connections, without SSL, with the default watermark of 0.4
> Let me get back into the past to persent the history :
>     - we started with default setting of rabbitMQ 1.7.2, with a version
> that does not use  SSL. It works fine.
> 
>     - Then our requirements evolved, and we decided that peers must
> authenticate the borker upon connection, so we started to investigate on
> the use of SSL.
>     
>     - From that point, we could not manage a successful run unless we
> increase the watermark up to 0.8.
> 
>     - Now we upgrade to version 2.x.x of RabbitMQ and we realize that
> the application that used to work on 1.8.0, with SSL no longer work on
> the 2.0.0, neither on 2.1.0.
> 
>     - That's why we decided to run the same test, disabling the SSL
> authentication, and the same issues happens again either on 2.0.0 or 2.1.0.
> 
>>
>>> I've monitored with rabbit_status, even someone had advised not to while
>>> benchmarking (why not ?)
>>
>> rabbitmqctl or rabbit_status are invaluable for debugging the kind of
>> problem you are reporting. Continuous use incurs a small performance
>> penalty and can prevent quiescent resources from hibernating.
> 
> Then what would you recommend us for monitoring the broker a bit less
> intrusively ?

I *would* recommend using rabbitmqctl.

> Actually, in our environment, we have settled a set of tool to monitor
> the CPU load and the overall memory of the rabbitMQ erlang process. For
> that we use the UNIX built in tools
> such as sar, netstat, and ps with option to see the memory occupied.
> 
> We also monitor the queue depth by invoking rabbitmq_ctl list_queues,
> but the problem occurs also whit that monitoring turned OFF !!
> 
> After a test, we are able to built some graphics displaying the
> different statistics monitored.
> If you want, I can send you extract of these reports so you will have
> better overview on how the broker behave during tests.
> 
> Just to have a look, I join you the following snapshots :
> 
> - S0_withSSL_withQueueMonitoring : shows the broker behaviour while
> trying to connect 10 000 peers, with SSL
> 
> - S0_noSSL_withQueueMonitoring : shows the broker behaviour while trying
> to connect 10 000 peers wihtout SSL
> 
> - S0_noSSL_noQueueMonitoring : shows the broker behaviour while trying
> to connect 10 000 peers without SSL, and without periodic call to
> rabbitmqctl list_queues

These graphs show that you create the connections at a fast rate. Do you
get the same failure if you create connections at a lower rate?

>>> The memory available raised the threshold before the end of connections
>>> of 10 000 peers.
>>>
>>> Maybe the average memory occupied by a single, non SSL connection has
>>> somehow get bigger between
>>> release 1.8.x and 2.x.x ??
>>
>> The data structures have changed from 1.8.1 to 2.0.0, but I don't think
>> that is the cause of the problem.
>>
>>> Does anybody has experiment or knows the impact of the new release on
>>> the memory occupied by connections ?

It is possible that more memory is required per connection, If using a
large number of connections caused your RAM budget to be approached in
versions prior to 2.0.0 then you may now exceed it.

>>> I insist in the fact that, in our environment, we can toggle SSL
>>> authentication of the broker by peers, but we always
>>> keep the SSL listener running on the broker. The peer just "decide" to
>>> connect either on 5672 or 5671. In the later,
>>> SSL authentication will be enable, in the former, it won't !
>>>
>>> Thanks for any other idea we can follow, because we are facing a bit of
>>> a dead end since we upgraded to 2.x.x !
>>
>> I'm surprised that the logfile you posted previously stops after opening
>> ssl and tcp listeners. I would expect to see evidence of 4000+ clients
>> connecting.
> 
> Yes sorry for that, but it indeed contains those line for connection
> accepted / started, but noting interesting after that. Basically we jump
> from a series of connection started
> to a series of connection stopped, without no other warning, nor error,
> until the end of the log file.

That is very strange. I would expect to see evidence of the server
running out of memory.

>> Are you able to get output from "rabbitmqctl list_connections" before
>> the broker becomes unresponsive? What is the status of the beam or
>> beam.smp process at that point - is it still running? How much memory
>> and CPU is it consuming?
> 
> Those information can be gathered by our own "monitoring framework" as
> explained above. But as you said just before, the rabbitmq_ctl may be
> too intrusive, we use netstat to list the
> established connection on the port 5672 (5671 if SSL is turned ON).

rabbitmqctl does incur a small performance penalty if run continuously
and it may then prevent unused resources from hibernating. However it
was designed precisely to investigate the kind of problem you are
experiencing.

Can you confirm whether the beam or beam.smp process is running after
the test failed?



Regards

Emile

From simon at rabbitmq.com  Fri Sep 17 10:51:05 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Sep 2010 10:51:05 +0100
Subject: [rabbitmq-discuss] 500 Internal server error while consuming
 with 2.1.0 management plugin
In-Reply-To: <AANLkTinXzqo6asH1BZ+toP1FHijaDTwmB1yBHSq2jA-L@mail.gmail.com>
References: <AANLkTimo_i9B+wJ=0gMQUcgTzNnWEW0ZJoH_WTvnK_YB@mail.gmail.com>	<4C91E875.6040209@rabbitmq.com>
	<AANLkTinXzqo6asH1BZ+toP1FHijaDTwmB1yBHSq2jA-L@mail.gmail.com>
Message-ID: <4C933A09.6080700@rabbitmq.com>

Yes, absolutely. Thanks again for the clear report! Unfortunately a fix 
may be a little while coming as I'm getting distracted by 
non-management-plugin stuff for the next week or so...

Cheers, Simon

On 16/09/10 22:35, Stephen Day wrote:
> Your description is accurate, although I didn't have enough time to
> isolate exact chain of events. Were you able to reproduce this
> traceback?
>
> On Thu, Sep 16, 2010 at 2:50 AM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> Thanks for the bug report. Now I know where my automated tests are
>> inadequate :)
>>
>> If I'm correct this should happen a few seconds after a new client (not the
>> first one) comes on line, and it's transient. Does that match what you're
>> seeing?
>>
>> Cheers, Simon
>>
>> On 16/09/10 01:41, Stephen Day wrote:
>>>
>>> Here is the text from the management console web interface:
>>>
>>> Got response code 500 with body
>>>
>>> Internal Server Error
>>>
>>> The server encountered an error while processing this request:
>>> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
>>>                                  {rabbit_mgmt_db,gs_update_add,3},
>>>
>>> {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>
>>> {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>                                  {dict,update_bkt,4},
>>>                                  {dict,on_bucket,3},
>>>                                  {dict,update,4},
>>>                                  {lists,foldl,3}]},
>>>                {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
>>>               [{gen_server,call,3},
>>>                {rabbit_mgmt_wm_overview,to_json,2},
>>>                {webmachine_resource,resource_call,3},
>>>                {webmachine_resource,do,3},
>>>                {webmachine_decision_core,resource_call,1},
>>>                {webmachine_decision_core,decision,1},
>>>                {webmachine_decision_core,handle_request,2},
>>>                {webmachine_mochiweb,loop,1}]}}
>>>
>>> Here are the related error reports, from the logs:
>>>
>>> =ERROR REPORT==== 15-Sep-2010::17:38:15 ===
>>> ** Generic server rabbit_mgmt_db terminating
>>> ** Last message in was get_overview
>>> ** When Server state == {state,[{channel_exchange_stats,442426},
>>>                                  {channel_queue_exchange_stats,446523},
>>>                                  {channel_queue_stats,438329},
>>>                                  {channel_stats,434232},
>>>                                  {connection_stats,430135},
>>>                                  {queue_stats,426038}]}
>>> ** Reason for termination ==
>>> ** {function_clause,[{proplists,get_value,[rate,0,unknown]},
>>>                       {rabbit_mgmt_db,gs_update_add,3},
>>>                       {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>                       {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>                       {dict,update_bkt,4},
>>>                       {dict,on_bucket,3},
>>>                       {dict,update,4},
>>>                       {lists,foldl,3}]}
>>>
>>> =ERROR REPORT==== 15-Sep-2010::17:38:15 ===
>>> webmachine error: path="/api/overview"
>>> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
>>>                                  {rabbit_mgmt_db,gs_update_add,3},
>>>
>>> {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>
>>> {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
>>>                                  {dict,update_bkt,4},
>>>                                  {dict,on_bucket,3},
>>>                                  {dict,update,4},
>>>                                  {lists,foldl,3}]},
>>>                {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
>>>               [{gen_server,call,3},
>>>                {rabbit_mgmt_wm_overview,to_json,2},
>>>                {webmachine_resource,resource_call,3},
>>>                {webmachine_resource,do,3},
>>>                {webmachine_decision_core,resource_call,1},
>>>                {webmachine_decision_core,decision,1},
>>>                {webmachine_decision_core,handle_request,2},
>>>                {webmachine_mochiweb,loop,1}]}}
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> --
>> Simon MacMullen
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From vlad at rabbitmq.com  Fri Sep 17 13:53:29 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Fri, 17 Sep 2010 13:53:29 +0100
Subject: [rabbitmq-discuss] How to use Consumer as Producer in rabbitmq
In-Reply-To: <29736359.post@talk.nabble.com>
References: <29736359.post@talk.nabble.com>
Message-ID: <4C9364C9.8040205@rabbitmq.com>


Hi,


The easiest way would be to have two exchanges and two queues for that.
The route of the messages would be:
C1 -> X1 -> Q1 -> C2
C2 -> X2 -> Q2 -> C1
where C1 and C2 are your clients.

There are other ways to achieve this as well. See 
http://www.rabbitmq.com/documentation.html and 
http://www.amqp.org/confluence/display/AMQP/AMQP+Specification for all 
the details you need.


Rgds,
Vlad.



On 09/17/2010 09:51 AM, specialsaran wrote:
> Hi,
> I am new to RabbitMQ , i would like to know how to use consumer as producer
> and vice versa ie the consumer will use to receive the message from the
> queue at the same time it should be able to transmit the message to the
> exchange and same for producer too , it should transmit and receive message.
>
> Thankyou in advance
> Saran
>    

From vlad at rabbitmq.com  Fri Sep 17 14:45:55 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Fri, 17 Sep 2010 14:45:55 +0100
Subject: [rabbitmq-discuss] Rabbitmq ctl script fail
In-Reply-To: <70b83751-43d5-4483-a486-f2459f26ba57@t11g2000vbc.googlegroups.com>
References: <70b83751-43d5-4483-a486-f2459f26ba57@t11g2000vbc.googlegroups.com>
Message-ID: <4C937113.9010101@rabbitmq.com>

Hi,

We have a bug currently open for your problem.
 From the fact that it's been sitting there for a while I could say that 
it's probably not a trivial thing to fix.
I'm sorry I can't be of any more help at the moment.

Rgds,
Vlad.


On 09/15/2010 02:43 PM, abdelrahman wrote:
> Hello all,
> i am running rabbitmq-server version 1.7.1 and i needed to configure
> clusters with nodenames related to ip addresses so i am using -name
> instead of -sname in both rabbitmq-server and rabbitmqctl scripts like
> the follwoing:
> rabbitmq-server script:
> exec erl \
>      ${RABBITMQ_EBIN_PATH} \
>      ${RABBITMQ_START_RABBIT} \
>      -sname ${RABBITMQ_NODENAME} \
>      -boot ${RABBITMQ_BOOT_FILE} \
>      ${RABBITMQ_CONFIG_ARG} \
>      +W w \
>      ${RABBITMQ_SERVER_ERL_ARGS} \
>      -rabbit tcp_listeners '[{"'${RABBITMQ_NODE_IP_ADDRESS}'", '$
> {RABBITMQ_NODE_PORT}'}]' \
>      -sasl errlog_type error \
>      -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
>      -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \
>      -os_mon start_cpu_sup true \
>      -os_mon start_disksup false \
>      -os_mon start_memsup false \
>      -mnesia dir "\"${RABBITMQ_MNESIA_DIR}\"" \
>      ${RABBITMQ_CLUSTER_CONFIG_OPTION} \
>      ${RABBITMQ_SERVER_START_ARGS} \
>      "$@"
>
> my rabbitmqctl script is:
> NODENAME=rabbit
>
> . `dirname $0`/rabbitmq-env
>
> [ "x" = "x$RABBITMQ_NODENAME" ]&&  RABBITMQ_NODENAME=${NODENAME}
> [ "x" = "x$RABBITMQ_CTL_ERL_ARGS" ]&&  RABBITMQ_CTL_ERL_ARGS=$
> {CTL_ERL_ARGS}
>
> exec erl \
>      -pa "${RABBITMQ_HOME}/ebin" \
>      -noinput \
>      -hidden \
>      ${RABBITMQ_CTL_ERL_ARGS} \
>      -sname rabbitmqctl$$ \
>      -s rabbit_control \
>      -nodename $RABBITMQ_NODENAME \
>      -extra "$@"
>
> my rabbitmq.conf file is:
> RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
> RABBITMQ_NODE_PORT=5672
> RABBITMQ_NODENAME=rabbit at 192.168.20.10
>
> the problem is when starting the server using the rabbitmq-server
> script, it starts correctly, but when trying to runt he rabbitmqctl
> script it fails with the error:
> {error_logger,{{2010,9,15},{13,24,20}},"Can't set long node name!
> \nPlease check your configuration\n",[]}
> {error_logger,{{2010,9,15},{13,24,20}},crash_report,[[{initial_call,
> {net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},
> {error_info,{exit,{error,badarg},[{gen_server,init_it,6},
> {proc_lib,init_p_do_apply,3}]}},{ancestors,
> [net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},
> {dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
> {heap_size,987},{stack_size,24},{reductions,835}],[]]}
> {error_logger,{{2010,9,15},{13,24,20}},supervisor_report,[{supervisor,
> {local,net_sup}},{errorContext,start_error},{reason,
> {'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},
> {mfa,{net_kernel,start_link,[[rabbitmqctl20008,longnames]]}},
> {restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2010,9,15},{13,24,20}},supervisor_report,[{supervisor,
> {local,kernel_sup}},{errorContext,start_error},{reason,shutdown},
> {offender,[{pid,undefined},{name,net_sup},{mfa,
> {erl_distribution,start_link,[]}},{restart_type,permanent},
> {shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2010,9,15},{13,24,20}},std_info,[{application,kernel},
> {exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,
> {shutdown,{kernel,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,
> []]}}})
>
> i cannot know why it cannot set long node name since it is already
> started with the same long name config ? any ideas ?
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From romary.kremer at gmail.com  Fri Sep 17 15:32:09 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Fri, 17 Sep 2010 16:32:09 +0200
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
	<AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
	<0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>
	<AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>
Message-ID: <FBFC0A10-7AAD-40FB-9C4F-9149E4B0A019@gmail.com>

Their are still some point I don't understand quite well with flow  
control.

As Marek told, in version previous to 2.0.0, the broker sends  
Channel.flow AMQP message to everyone once
rabbit reached memory limit. However, I still dont' understand how it  
came to block the production with that version.

In first, I thought that the client application should implement its  
own pause/resume logic, and that FlowListener interface would be the
way to do that. I realized only later that the producer was paused as  
well without the use of FlowListener, for instance using the
MultiCastMain sample in Java client 1.7.2.

Can you give us hints about how the production was indeed paused,  
other by stopping reading from the socket ?
Does the broker shut the connection or only the channel if a content- 
bearing message is sent after the flow.control ?

What is the meaning of status "Blocked" and "Blocking" that we can  
gather by listing connections ! I often noticed that
the connection of producer in status "blocked" lead the connection of  
the consumer to be "Blocking".

Sharing the same connection for producer and consumer, by the use of  
Channel may not be safe, that is very sad !

Best regards,

Romary.

Le 16 sept. 10 ? 14:49, Marek Majkowski a ?crit :

> On Wed, Sep 15, 2010 at 19:11, romary.kremer at gmail.com
> <romary.kremer at gmail.com> wrote:
>> Yes. You will never hear "FlowListener.handleFlow()" and it may be  
>> possible
>> for
>> channel.publish to block (though I would need to consult the sources
>> to be sure).
>>
>> It seems to me that FlowListener interface is likely to be  
>> deprecated so,
>> does'nt it ?
>
> It's more complex than that, but yes, you won't hear anything on  
> that interface.
>
>> Does not really matter for us anyway, cause we where on wrong idea  
>> using
>> that.
>> Does this new implementation keep the broker on track for  
>> compliance with
>> specification then ?
>
> Yes, the spec doesn't force us to send channel.flow. We implemented  
> that
> for a while but realized that it doesn't solve our problems.
>
>> This would be acceptable for our needs, only if we can somehow  
>> guarantee
>> that's an upper boundary !
>
> Optimistically, the upper bouadary is not more than your memory usage
> divided by the disk throughput.
>
>> But it is possible to create a very pessimistic environment in  
>> which the
>> memory usage will not drop - and the connection could be stuck for  
>> a long
>> time.
>> (though it's pretty unlikely).
>
>> ... Not that much unlikely, considering my little playing with the
>> MultiCastMain sample (see my previous reply about it for details).
>> I get 100 % times blocked connection.
>> What would be, based on your knowledge and your intuition, "a very
>> pessimistic environment in which the memory usage will not drop" ?
>> I think that the experimentation I've done on the MultiCastMain is  
>> maybe a
>> beginning of an answer for that question, although I would
>> never have considered that a single producer could have such power  
>> to flood
>> the broker.
>
> Okay. The memory can stay high due to a lot of reasons. If your  
> metadata
> that rabbit never releases is using more memory than threshold -
> rabbit will just get stuck.
>
> Next thing. remember, we don't control how erlang eats memory - and it
> has pretty
> complex GC and memory allocation mechanisms.
>
> If you think that you have enough memory for all the connections,
> queues, exchanges and bindings. And some memory for the messages.
> And you still hit the limit when you get stuck - feel free to tune
> Erlang GC internals:
>  http://www.erlang.org/doc/man/erts_alloc.html
>
>> Weren't Channel design for that ? In our environment, we have  
>> (naively ?)
>> considered the use of Channel to
>> separate the message production from the consumption.
>> Since we are targeting 10 000 peers doing both production and  
>> consumption,
>> the fact of multiplying the number of
>> connections by 2 is not negligible at all, considering scalability.
>> Moreover, as I reported later on, we use SSL to authenticate the  
>> broker, and
>> we are still unclear about memory leaks
>> induce by SSL connections. Doubling the number of connections will  
>> not be
>> negligible at all considering memory occupation either.
>> In conclusion, we are not likely to implement our peers using 2  
>> connections
>> for the same broker.
>> What would you recommend to us then ? And could you give us a better
>> understanding on the use case of channels ?
>
> Yes, channels were designed exactly for that. On the other hand, AMQP
> has few pretty serious issues. For example when you open channel
> you're free to publish a message. And broker can't 'refuse' accepting
> a message. Channel.flow can be sent from the broker to the client
> but *after* channel is opened. So there is a window in which
> you just can publish (after channel.open before channel.flow).  
> Sorry, there
> just isn't other way of forbidding publishes than by stopping the  
> whole
> connection. I also don't like it, but it's the only way.
>
>
> Cheers,
> Marek


From jiri at krutil.com  Fri Sep 17 15:55:39 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Fri, 17 Sep 2010 16:55:39 +0200
Subject: [rabbitmq-discuss] RabbitMQ with Erlang R14B
In-Reply-To: <20100915130907.GC9474@rabbitmq.com>
References: <20100915130907.GC9474@rabbitmq.com>
Message-ID: <20100917165539.10139rm0uojnohhw@webmail.active24.cz>

Hi

Thanks for the info. SSL in Erlang R14B seems to work fine.

Maybe it would be good to update the info about various Erlang  
versions at http://www.rabbitmq.com/ssl.html ?

Cheers
Jiri


> Hi,
>
> Erlang R14B has just been released, and you can download it from
> http://www.erlang.org/download.html
>
> A couple of things are relevant for Rabbit:
>
> 1. If compiling Rabbit, you'll get some warnings like:
> src/rabbit_plugin_activator.erl:75: Warning: ambiguous call of
> overridden auto-imported BIF error/2
>  - use erlang:error/2 or "-compile({no_auto_import,[error/2]})." to
>    resolve name clash
>
> They are only warnings, and they can be safely ignored - we have tested
> and confirmed that it's doing the right thing, despite the warning.
>
> 2. Lots and lots and lots of fixes have happened in the SSL module.
> Preliminary testing seems to show SSL now really does work. The R14B
> release notes (http://www.erlang.org/download/otp_src_R14B.readme) even
> mention that memory leaks in the crypto infrastructure have been fixed
> (I know someone reported memory leaks with SSL recently here).
>
> Hopefully the distros will quickly update their Erlang packages to R14B
> so that people are not relying on a BETA release of Erlang that has bugs
> in it. The fact that the now frozen Debian Squeeze has R14A in it is a
> little worrying...
>
> Matthew


From michaelburns1 at gmail.com  Fri Sep 17 15:56:54 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Fri, 17 Sep 2010 15:56:54 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<4C920F74.1040705@rabbitmq.com>
	<AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>
Message-ID: <AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com>

Hi,

Just to add that I experienced the delay problem again - this time I checked
the number of connections that were open and saw a stray connection was
still hanging about. Upon manually killing this connection my message then
came through.
Any thoughts?

(Again just to add that I'm not 100% sure our consumer app shutdown cleanly,
it may have been killed before the connection could be closed our side)

Thanks,
Michael

On Thu, Sep 16, 2010 at 1:39 PM, Michael Burns <michaelburns1 at gmail.com>wrote:

> Hi Vlad,
> We're using the Java client 1.8.1
>
>
> Thanks,
> Michael
>
>
> On Thu, Sep 16, 2010 at 1:37 PM, Vlad Alexandru Ionescu <vlad at rabbitmq.com
> > wrote:
>
>>
>>
>>> I've noticed sometimes that there are extra connections hanging about on
>>> the RabbitMQ broker (using rabbitmqctl  list_connections).
>>>
>>
>> Michael, can you tell us which client(s) are you using?
>>
>> Thanks,
>> Vlad.
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/a7998afb/attachment.htm>

From vlad at rabbitmq.com  Fri Sep 17 16:13:52 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Fri, 17 Sep 2010 16:13:52 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>	<20100903082934.GB2873@dakota.eng.vmware.com>	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>	<20100903120234.GD2873@dakota.eng.vmware.com>	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>	<20100908094647.GB2851@dakota.eng.vmware.com>	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>	<4C920F74.1040705@rabbitmq.com>	<AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>
	<AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com>
Message-ID: <4C9385B0.2040109@rabbitmq.com>


Michael,


So I understand that it is the consumer's connection that was hanging in 
there.

I tried to reproduce your problem yesterday (killing off both consumer 
and producer apps), with no success.
What version of Java are you using?

By not having been shutdown cleanly... could it be possible, in your 
case, that the client has been disconnected from the network abruptly, 
in some way?

The only situation I can think of when you can have stray connections 
(and would not be a bug) would be the case when the socket has been 
broken in some way without doing a TCP FIN. If the app is killed, the 
underlying OS takes care of closing all its FDs, including all sockets 
that were held by the app - so that shouldn't cause stray connections. 
But, for example, if the client machine is physically disconnected from 
the network, the broker has no way of knowing that and expects the 
client to continue consuming (but it doesn't). Until the TCP socket 
times out (could take 15 mins), the message would remain blocked in the 
queue, as it is reserved for the disconnected client (which didn't 
receive the message entirely and/or didn't get to ack).


Rgds,
Vlad.


On 09/17/2010 03:56 PM, Michael Burns wrote:
> Hi,
>
> Just to add that I experienced the delay problem again - this time I 
> checked the number of connections that were open and saw a stray 
> connection was still hanging about. Upon manually killing this 
> connection my message then came through.
> Any thoughts?
>
> (Again just to add that I'm not 100% sure our consumer app shutdown 
> cleanly, it may have been killed before the connection could be closed 
> our side)
>
> Thanks,
> Michael
>
> On Thu, Sep 16, 2010 at 1:39 PM, Michael Burns 
> <michaelburns1 at gmail.com <mailto:michaelburns1 at gmail.com>> wrote:
>
>     Hi Vlad,
>     We're using the Java client 1.8.1
>
>
>     Thanks,
>     Michael
>
>
>     On Thu, Sep 16, 2010 at 1:37 PM, Vlad Alexandru Ionescu
>     <vlad at rabbitmq.com <mailto:vlad at rabbitmq.com>> wrote:
>
>
>
>             I've noticed sometimes that there are extra connections
>             hanging about on the RabbitMQ broker (using rabbitmqctl
>              list_connections).
>
>
>         Michael, can you tell us which client(s) are you using?
>
>         Thanks,
>         Vlad.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/d0a145c7/attachment-0001.htm>

From michaelburns1 at gmail.com  Fri Sep 17 16:26:57 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Fri, 17 Sep 2010 16:26:57 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <4C9385B0.2040109@rabbitmq.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<4C920F74.1040705@rabbitmq.com>
	<AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>
	<AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com>
	<4C9385B0.2040109@rabbitmq.com>
Message-ID: <AANLkTimH3d-XZuLRscCDJYdTYj2gzQvCgie8vJN0GDP9@mail.gmail.com>

On Fri, Sep 17, 2010 at 4:13 PM, Vlad Alexandru Ionescu
<vlad at rabbitmq.com>wrote:

>
> Michael,
>
>
> So I understand that it is the consumer's connection that was hanging in
> there.
>
> I tried to reproduce your problem yesterday (killing off both consumer and
> producer apps), with no success.
> What version of Java are you using?
>

We're using Java 1.6.0_15. Our consumers are running on OS X 10.6.2


>
> By not having been shutdown cleanly... could it be possible, in your case,
> that the client has been disconnected from the network abruptly, in some
> way?
>

Dont think so - the main cause of the app not shutting cleanly is a
deployment script we have for our dev environments which kills our JVM if it
doesnt shutdown within a specified time period (because we are running in a
web container with multiple web apps sometimes it can take a couple of
seconds to successfully shutdown). Also it may be worth mentioning that our
consumer is on a different network to the RabbitMQ broker - the broker is
running at amazon on an EC2 instance, while the consumer runs on our
internal network.


>
> The only situation I can think of when you can have stray connections (and
> would not be a bug) would be the case when the socket has been broken in
> some way without doing a TCP FIN. If the app is killed, the underlying OS
> takes care of closing all its FDs, including all sockets that were held by
> the app - so that shouldn't cause stray connections. But, for example, if
> the client machine is physically disconnected from the network, the broker
> has no way of knowing that and expects the client to continue consuming (but
> it doesn't). Until the TCP socket times out (could take 15 mins), the
> message would remain blocked in the queue, as it is reserved for the
> disconnected client (which didn't receive the message entirely and/or didn't
> get to ack).
>

Yes this make sense - if I see it happening again I'll try and wait to see
if the connection eventually times out.

Thanks
Michael




>
>
> Rgds,
> Vlad.
>
>
>
> On 09/17/2010 03:56 PM, Michael Burns wrote:
>
> Hi,
>
> Just to add that I experienced the delay problem again - this time I
> checked the number of connections that were open and saw a stray connection
> was still hanging about. Upon manually killing this connection my message
> then came through.
> Any thoughts?
>
> (Again just to add that I'm not 100% sure our consumer app shutdown
> cleanly, it may have been killed before the connection could be closed our
> side)
>
> Thanks,
> Michael
>
> On Thu, Sep 16, 2010 at 1:39 PM, Michael Burns <michaelburns1 at gmail.com>wrote:
>
>> Hi Vlad,
>> We're using the Java client 1.8.1
>>
>>
>> Thanks,
>> Michael
>>
>>
>> On Thu, Sep 16, 2010 at 1:37 PM, Vlad Alexandru Ionescu <
>> vlad at rabbitmq.com> wrote:
>>
>>>
>>>
>>>> I've noticed sometimes that there are extra connections hanging about on
>>>> the RabbitMQ broker (using rabbitmqctl  list_connections).
>>>>
>>>
>>>  Michael, can you tell us which client(s) are you using?
>>>
>>> Thanks,
>>> Vlad.
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/3ae3605d/attachment.htm>

From vlad at rabbitmq.com  Fri Sep 17 16:56:37 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Fri, 17 Sep 2010 16:56:37 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTimH3d-XZuLRscCDJYdTYj2gzQvCgie8vJN0GDP9@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>	<20100903082934.GB2873@dakota.eng.vmware.com>	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>	<20100903120234.GD2873@dakota.eng.vmware.com>	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>	<20100908094647.GB2851@dakota.eng.vmware.com>	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>	<4C920F74.1040705@rabbitmq.com>	<AANLkTim19NKpVpRtaU2GsdwuWcnzTFhN_76V28zJee=K@mail.gmail.com>	<AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com>	<4C9385B0.2040109@rabbitmq.com>
	<AANLkTimH3d-XZuLRscCDJYdTYj2gzQvCgie8vJN0GDP9@mail.gmail.com>
Message-ID: <4C938FB5.4080205@rabbitmq.com>


Michael,


I found something that could be related to your problem:

http://forum.soft32.com/mac/Mac-OSX-tcp-ip-problem-ftopict108937.html


If there's any way you could provide a tcpdump / wireshark output when 
this happens, I reckon that would be very helpful (I think the one from 
the client side is more interesting, but having both sides would be better).


>
> Yes this make sense - if I see it happening again I'll try and wait to 
> see if the connection eventually times out.
>
>
>

Also check that the script really terminates the JVM and that it is not 
somehow stuck, when this happens. Though I doubt that could be the problem.


Rgds,
Vlad.


From jon.rowland at isam.com  Fri Sep 17 21:01:56 2010
From: jon.rowland at isam.com (Jon Rowland)
Date: Fri, 17 Sep 2010 15:01:56 -0500
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting the
 RabbitMQ server on Windows
Message-ID: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>

I've just installed 2.1.0 of RabbitMQ on Windows, and when I start the server I get a lot of warnings, e.g.

C:\rabbitmq_server-2.1.0\sbin>rabbitmq-server.bat
Activating RabbitMQ plugins ...
*WARNING* rabbit: Object code (bpqueue) out of date
*WARNING* rabbit: Object code (delegate) out of date
*WARNING* rabbit: Object code (delegate_sup) out of date
...etc...

Is this something to worry about? I did have a 1.7.0 version installed, but uninstalled it before installing 2.1.0. Has the install left something on my machine that is causing the warnings?

Thanks,
Jon


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/e081aea3/attachment.htm>

From pdezwart at rubiconproject.com  Fri Sep 17 21:27:14 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 17 Sep 2010 13:27:14 -0700
Subject: [rabbitmq-discuss] Rabbitmq-c Help
Message-ID: <C8B91D32.FB42%pdezwart@rubiconproject.com>

Hey guys,

I need some help with rabbitmq-c. I inherited the PHP extension code base,
so I am a little lost. I pulled in RabbitMQ 2.1, along with the tip of
rabbitmq-c and rabbitmq-codegen. Everything compiles just fine, but when I
try to instantiate a new connection in the PHP extension, I get:

localhost:~/src/pecl/amqp/trunk$ php -f tests/test.php
Expected 0x000A000A method frame on channel 0, got frame on channel 19793

This is the stacktrace:
#0  0x009f4416 in __kernel_vsyscall ()
#1  0x00248d71 in raise (sig=6) at
../nptl/sysdeps/unix/sysv/linux/raise.c:64
#2  0x0024a64a in abort () at abort.c:92
#3  0x00137640 in amqp_simple_wait_method (state=0xa1604c0,
expected_channel=0, expected_method=655370, output=0xbfe31b20) at
amqp_socket.c:243
#4  0x001379fc in amqp_login_inner (state=0xa1604c0, vhost=0xa12d70c "/",
channel_max=0, frame_max=131072, heartbeat=0,
sasl_method=AMQP_SASL_METHOD_PLAIN) at amqp_socket.c:373
#5  amqp_login (state=0xa1604c0, vhost=0xa12d70c "/", channel_max=0,
frame_max=131072, heartbeat=0, sasl_method=AMQP_SASL_METHOD_PLAIN) at
amqp_socket.c:463
#6  0x00629b9f in zim_amqp_class___construct (ht=0, return_value=0xa12d0f0,
return_value_ptr=0x0, this_ptr=0xa12d10c, return_value_used=0) at
/home/pdezwart/src/pecl/amqp/trunk/amqp.c:413
#7  0x0825fd39 in zend_do_fcall_common_helper_SPEC (execute_data=<value
optimized out>) at /usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:316
#8  0x0823676e in execute (op_array=0xa12d580) at
/usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:107
#9  0x0820ef36 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at
/usr/src/debug/php-5.3.3/Zend/zend.c:1194
#10 0x081b5ac6 in php_execute_script (primary_file=0xbfe34274) at
/usr/src/debug/php-5.3.3/main/main.c:2260
#11 0x0829f358 in main (argc=3, argv=0xbfe343b4) at
/usr/src/debug/php-5.3.3/sapi/cli/php_cli.c:1192

These mean nothing to me... Help? =)

Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/897b75cc/attachment-0001.htm>

From adam at varud.com  Fri Sep 17 22:55:14 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 17 Sep 2010 17:55:14 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>

Hello,

I've been using RabbitMQ for 2 months now and I figured I would share my
experiences.

== Background ==

I'm using RabbitMQ because Celery recommends it.  If Celery recommended
something else, I would have used that.  I'm just pointing that out because
sometimes core services forget that people often use them because a
particular library favors that implementation.  It's important to take care
of the downstream libraries, especially when you're using an open protocol
like AMQP.

== Comments so Far ==

I think RabbitMQ is awesome and has done really well so far for me.  It's
been very fast (only marginally important for me) and very stable (much,
much more important for me).  Here's my constructive criticism (i.e. things
that can be addressed easily IMHO).

 * This newsgroup format is terrible.  Please move to Google Groups.
 * The code is very difficult to get at.  Please move to Github (or
BitBucket).  I see that you're using Mercurial already, so BitBucket is the
obvious choice.  I think GitHub is way more feature rich but if you're not
willing to move to Git, that won't work of course.
 * The documentation is not version-specific.  This has caused me enormous
problems (specifically with set-permissions, which is why I'm in the mode to
write this message at all).  Please move to a platform that supports
versioned documentation better.  I don't know the best solution to this
exactly - maybe Sphinx or just a wiki with a url structure that supports
multiple versions?
 * Where are the open tickets?  It appears that all bugs are going through
the mailing list - it's really hard on the users to not have an
easy-to-search ticket system.  Launchpad could work or BitBucket's issue
system, or Redmine, or Trac?
 * The site itself needs a fresh look.  I know MongoDB is funded, but
there's an example of a great site for this type of thing:
http://www.mongodb.org/ .
 * Outdated stuff should be taken down or have a disclaimer on it.  For
instance the ec2 page: http://www.rabbitmq.com/ec2.html has images for
Karmic Koala.  While that was great last year, it's really time to have a
Lucid ec2 images available - or nothing at all.  A Lucid image, because it
is long term, could be up for a year or two and it would be ok.
 * Please don't tell Mac users to use MacPorts:
http://www.rabbitmq.com/macports.html It's time to move them to HomeBrew at
http://github.com/mxcl/homebrew
 * Please be more descriptive about how to set up an environment with tools
like Alice and Wonderland.  These appear to be great assets to RabbitMQ, but
are hidden in the dense 'Getting Started' page:
http://www.rabbitmq.com/how.html .  All the links from a Getting Started
page should take no longer than 1 hour to read.  Check out Django's one hour
intro here: http://docs.djangoproject.com/en/dev/intro/tutorial01/  .  The
first link on RabbitMQ's Getting Started page goes to this Alexis Richardson
talk -
http://skillsmatter.com/podcast/erlang/alexis-richardson-introduction-to-rabbitmq
.  While the content is great, it's geared towards the intermediate user,
not a beginner just getting started.  Also, having dynamic delicious
searches is fine for an appendix maybe, but not the first page for people
getting started.

In fine, I really think the product is tremendous, it's just a matter of
fixing up the experience for users of the software.  The core issues are
documentation (plenty of it is there, almost too much, but not tightly
curated, updated or kept versioned), code access (archaic tools around this
- although using Mercurial is a huge plus over cvs or svn), and issue
tracking.

Thanks,
Adam


--
View this message in context:
http://old.nabble.com/Thoughts-from-a-new-user-tp29742723p29742723.html
Sent from the RabbitMQ mailing list archive at Nabble.com.





-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/e84a0d84/attachment.htm>

From ian.ragsdale at gmail.com  Fri Sep 17 23:17:01 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Fri, 17 Sep 2010 17:17:01 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
Message-ID: <DBA944CE-7B0B-4F3B-BB8B-8979DE5C375C@gmail.com>

On Sep 17, 2010, at 4:55 PM, Adam Nelson wrote:

> 
>  * This newsgroup format is terrible.  Please move to Google Groups.

Please!  This would be so much more useful. :)

>  * Please don't tell Mac users to use MacPorts:
> http://www.rabbitmq.com/macports.html It's time to move them to HomeBrew at
> http://github.com/mxcl/homebrew

As a mac user, I totally agree with this - Homebrew is WAY nicer to use.  I'd rather compile stuff by hand than use macports.  I installed rabbitmq 2.0 via homebrew a few days ago and it was super easy.  Macports installs a ton of stuff you don't need and reinstalls components already on the system, homebrew does not.

>  * Please be more descriptive about how to set up an environment with tools
> like Alice and Wonderland.  ...

I'd go even farther than this.  Why do a web interface and the BQL tools need to be plugins?  Make them part of the core server and add configuration to enable or disable them.  I'd be willing to bet that a huge majority of users have a need for these things, so why make them extra installs?  I think this would definitely improve your out-of-box experience.

- Ian

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/d77d941c/attachment.htm>

From david at rabbitmq.com  Sat Sep 18 03:46:42 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 18 Sep 2010 03:46:42 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	(Adam Nelson's message of "Fri, 17 Sep 2010 17:55:14 -0400")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
Message-ID: <yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>

Hi Adam,

Thanks for your feedback.  Within the team, we carefully consider how we
should deploy our resources, and we welcome input that helps us
understand what our users think is important and why.

I'll take on a few of your comments below.  And regarding the website in
general, we're aware there is room for improvement, particularly from
the perspective of new users, and we are working on it.

Adam Nelson <adam at varud.com> writes:
> [...]
>  * This newsgroup format is terrible.  Please move to Google Groups.

You can browse the mailing list at
<http://groups.google.com/group/rabbitmq-discuss>, and through various
other mailing list to web gateways.  What makes this arrangement
terrible for you?  Not being able to post through them, or something
else?

>  * The code is very difficult to get at.  Please move to Github (or
> BitBucket).  I see that you're using Mercurial already, so BitBucket is the
> obvious choice.  I think GitHub is way more feature rich but if you're not
> willing to move to Git, that won't work of course.

Could you explain more about how the code is very difficult to get at?
It can be browsed online through the standard Mercurial web interface at
<http://hg.rabbitmq.com/>, and the process of cloning the repos would be
very similar under github and bitbucket.  I appreciate that github and
bitbucket have some advantages, but what, from your perspective, are the
key ones that would apply to RabbitMQ?

>  * The documentation is not version-specific.  This has caused me enormous
> problems (specifically with set-permissions, which is why I'm in the mode to
> write this message at all).  Please move to a platform that supports
> versioned documentation better.  I don't know the best solution to this
> exactly - maybe Sphinx or just a wiki with a url structure that supports
> multiple versions?

The principal documentation for set_permission is the rabbitmqctl man
page.  It's true that we only make the current versions of the man pages
available on the web site.  Would your problems have been avoided if we
published older versions of the man pages on the web site?

The web site content is maintained in Mercurial alongside our codebase.
This is convenient in a number of ways for us (e.g. being able to handle
code changes and the corresponding web site documentation changes in the
same workflow).  So it's conceivable that we could publish multiple
versions of the documentation from Mercurial on the web site.  This
would however require us to draw more of a distinction between reference
documentation and other types of information, the former tending to be
much more strongly version-specific.  But maybe that's a good idea
anyway.

>  * Where are the open tickets?  It appears that all bugs are going through
> the mailing list - it's really hard on the users to not have an
> easy-to-search ticket system.  Launchpad could work or BitBucket's issue
> system, or Redmine, or Trac?

The rabbit team's development work is tracked in bugzilla, but that
bugzilla instance is not currently public.  We will make it public at
some point, though doing so is not quite as straightforward as it might
first seem.

Bugzilla might not be as modern or attractive as some of the issue
trackers you mention, but it is very featureful, and ours is integrated
into the rest of our development infrastructure.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From adam at varud.com  Sat Sep 18 14:47:55 2010
From: adam at varud.com (Adam Nelson)
Date: Sat, 18 Sep 2010 09:47:55 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>

David,

Thanks for the great replies, I've included comments below:

> [...]
> >  * This newsgroup format is terrible.  Please move to Google Groups.
>
> You can browse the mailing list at
> <http://groups.google.com/group/rabbitmq-discuss>, and through various
> other mailing list to web gateways.  What makes this arrangement
> terrible for you?  Not being able to post through them, or something
> else?
>
> Signup is difficult, it's one more username for me to get, manage, and
maintain.  I (and I presume 80% of the others here) already have a Gmail
account - so posting for the first time wouldn't require going through
several steps. The first time I posted, it was refused because the web
interface apparently isn't integrated well with the email interface.  I had
to sign up again the old fashioned way (via email).  Maybe it was a failure
on my end but it reminded me of 1998 in every way.

Searching the archive is also significantly slower than on Google Groups.


>  * The code is very difficult to get at.  Please move to Github (or
> > BitBucket).  I see that you're using Mercurial already, so BitBucket is
> the
> > obvious choice.  I think GitHub is way more feature rich but if you're
> not
> > willing to move to Git, that won't work of course.
>
> Could you explain more about how the code is very difficult to get at?
> It can be browsed online through the standard Mercurial web interface at
> <http://hg.rabbitmq.com/>, and the process of cloning the repos would be
> very similar under github and bitbucket.  I appreciate that github and
> bitbucket have some advantages, but what, from your perspective, are the
> key ones that would apply to RabbitMQ?
>

For a core developer, you probably already have a cloned hg copy.  I'm not a
core developer.  My use for the code is to examine documentation and places
where an exception is thrown.  I'm not going to be patching the code, but
instead posting a bug report if something like that comes up.  Being able to
access the code readily through a browser is key to that experience.

If you want more traction in the wider community outside of queues and
brokers (i.e. Python programmers writing websites), RabbitMQ needs to make
things more accessible more easily for the user.

http://github.com/zeromq/zeromq2


> >  * The documentation is not version-specific.  This has caused me
> enormous
> > problems (specifically with set-permissions, which is why I'm in the mode
> to
> > write this message at all).  Please move to a platform that supports
> > versioned documentation better.  I don't know the best solution to this
> > exactly - maybe Sphinx or just a wiki with a url structure that supports
> > multiple versions?
>
> The principal documentation for set_permission is the rabbitmqctl man
> page.  It's true that we only make the current versions of the man pages
> available on the web site.  Would your problems have been avoided if we
> published older versions of the man pages on the web site?
>
> Yes.  Ubuntu is only on the 1.7.x series and the stable series on your site
is 2.1.x

> The web site content is maintained in Mercurial alongside our codebase.
> This is convenient in a number of ways for us (e.g. being able to handle
> code changes and the corresponding web site documentation changes in the
> same workflow).  So it's conceivable that we could publish multiple
> versions of the documentation from Mercurial on the web site.  This
> would however require us to draw more of a distinction between reference
> documentation and other types of information, the former tending to be
> much more strongly version-specific.  But maybe that's a good idea
> anyway.
>
> Django does it like that:
http://docs.djangoproject.com/en/1.2/topics/db/models/
http://docs.djangoproject.com/en/dev/topics/db/models/


> >  * Where are the open tickets?  It appears that all bugs are going
> through
> > the mailing list - it's really hard on the users to not have an
> > easy-to-search ticket system.  Launchpad could work or BitBucket's issue
> > system, or Redmine, or Trac?
>
> The rabbit team's development work is tracked in bugzilla, but that
> bugzilla instance is not currently public.  We will make it public at
> some point, though doing so is not quite as straightforward as it might
> first seem.
>
> Bugzilla might not be as modern or attractive as some of the issue
> trackers you mention, but it is very featureful, and ours is integrated
> into the rest of our development infrastructure.
>

Modern and attractive is important.  I understand that there is a (large)
transaction cost tied to moving but it's an important one to swallow.  If
you're huge like Mozilla and are using Bugzilla, I understand that it's
simply too difficult to change horses.  However if you go public with
Bugzilla, you're going to get twice the duplicates (because searching is so
painful) and half the real useful user feedback (because posting is so
painful).

Obviously, you guys run the show.  I'm just hoping that as one of the early
users of your software in production who isn't otherwise tied to the
messaging community, that you'll take my comments to heart.  Most people in
my situation a year from now will choose the AMQP broker that has the best
documentation and the most transparent release, maintenance, and setup
processes - performance is secondary.  I see ZeroMQ successfully tackling
those issues well and I just think we'd all benefit from a stronger
RabbitMQ:

Thanks,
Adam



> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/f1188797/attachment.htm>

From shane at digitalsanctum.com  Sat Sep 18 15:09:21 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Sat, 18 Sep 2010 10:09:21 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
Message-ID: <-2638725974206513481@unknownmsgid>

A big +1 on all the points brought up here especially improved usability of
the website and docs. I assume the docs will eventually be more typical of
the springsource projects :)

I also much prefer homebrew for Mac installs over macports.

-Shane


On Sep 18, 2010, at 9:47 AM, Adam Nelson <adam at varud.com> wrote:

David,

Thanks for the great replies, I've included comments below:

> [...]
> >  * This newsgroup format is terrible.  Please move to Google Groups.
>
> You can browse the mailing list at
> <http://groups.google.com/group/rabbitmq-discuss>, and through various
> other mailing list to web gateways.  What makes this arrangement
> terrible for you?  Not being able to post through them, or something
> else?
>
> Signup is difficult, it's one more username for me to get, manage, and
maintain.  I (and I presume 80% of the others here) already have a Gmail
account - so posting for the first time wouldn't require going through
several steps. The first time I posted, it was refused because the web
interface apparently isn't integrated well with the email interface.  I had
to sign up again the old fashioned way (via email).  Maybe it was a failure
on my end but it reminded me of 1998 in every way.

Searching the archive is also significantly slower than on Google Groups.


 >  * The code is very difficult to get at.  Please move to Github (or
> > BitBucket).  I see that you're using Mercurial already, so BitBucket is
> the
> > obvious choice.  I think GitHub is way more feature rich but if you're
> not
> > willing to move to Git, that won't work of course.
>
> Could you explain more about how the code is very difficult to get at?
> It can be browsed online through the standard Mercurial web interface at
> <http://hg.rabbitmq.com/>, and the process of cloning the repos would be
> very similar under github and bitbucket.  I appreciate that github and
> bitbucket have some advantages, but what, from your perspective, are the
> key ones that would apply to RabbitMQ?
>

For a core developer, you probably already have a cloned hg copy.  I'm not a
core developer.  My use for the code is to examine documentation and places
where an exception is thrown.  I'm not going to be patching the code, but
instead posting a bug report if something like that comes up.  Being able to
access the code readily through a browser is key to that experience.

If you want more traction in the wider community outside of queues and
brokers (i.e. Python programmers writing websites), RabbitMQ needs to make
things more accessible more easily for the user.

http://github.com/zeromq/zeromq2


> >  * The documentation is not version-specific.  This has caused me
> enormous
> > problems (specifically with set-permissions, which is why I'm in the mode
> to
> > write this message at all).  Please move to a platform that supports
> > versioned documentation better.  I don't know the best solution to this
> > exactly - maybe Sphinx or just a wiki with a url structure that supports
> > multiple versions?
>
> The principal documentation for set_permission is the rabbitmqctl man
> page.  It's true that we only make the current versions of the man pages
> available on the web site.  Would your problems have been avoided if we
> published older versions of the man pages on the web site?
>
> Yes.  Ubuntu is only on the 1.7.x series and the stable series on your site
is 2.1.x

> The web site content is maintained in Mercurial alongside our codebase.
> This is convenient in a number of ways for us (e.g. being able to handle
> code changes and the corresponding web site documentation changes in the
> same workflow).  So it's conceivable that we could publish multiple
> versions of the documentation from Mercurial on the web site.  This
> would however require us to draw more of a distinction between reference
> documentation and other types of information, the former tending to be
> much more strongly version-specific.  But maybe that's a good idea
> anyway.
>
> Django does it like that:
http://docs.djangoproject.com/en/1.2/topics/db/models/
http://docs.djangoproject.com/en/dev/topics/db/models/


> >  * Where are the open tickets?  It appears that all bugs are going
> through
> > the mailing list - it's really hard on the users to not have an
> > easy-to-search ticket system.  Launchpad could work or BitBucket's issue
> > system, or Redmine, or Trac?
>
> The rabbit team's development work is tracked in bugzilla, but that
> bugzilla instance is not currently public.  We will make it public at
> some point, though doing so is not quite as straightforward as it might
> first seem.
>
> Bugzilla might not be as modern or attractive as some of the issue
> trackers you mention, but it is very featureful, and ours is integrated
> into the rest of our development infrastructure.
>

Modern and attractive is important.  I understand that there is a (large)
transaction cost tied to moving but it's an important one to swallow.  If
you're huge like Mozilla and are using Bugzilla, I understand that it's
simply too difficult to change horses.  However if you go public with
Bugzilla, you're going to get twice the duplicates (because searching is so
painful) and half the real useful user feedback (because posting is so
painful).

Obviously, you guys run the show.  I'm just hoping that as one of the early
users of your software in production who isn't otherwise tied to the
messaging community, that you'll take my comments to heart.  Most people in
my situation a year from now will choose the AMQP broker that has the best
documentation and the most transparent release, maintenance, and setup
processes - performance is secondary.  I see ZeroMQ successfully tackling
those issues well and I just think we'd all benefit from a stronger
RabbitMQ:

Thanks,
Adam



> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>



-- 
Adam

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/5aaf3df3/attachment-0001.htm>

From lists at zopyx.com  Sat Sep 18 16:02:12 2010
From: lists at zopyx.com (Andreas Jung)
Date: Sat, 18 Sep 2010 17:02:12 +0200
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
Message-ID: <4C94D474.9070502@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Adam Nelson wrote:


>  * The code is very difficult to get at.  Please move to Github (or
> BitBucket).  I see that you're using Mercurial already, so BitBucket is the
> obvious choice.  I think GitHub is way more feature rich but if you're not
> willing to move to Git, that won't work of course.

Why do you need to get the code from the repository? Unless you are a
RabbitMQ developer: you should be fine using the source tarball.
We install RabbitMQ from the source tarball automatically on Linux and
MacOSX for our Zope/Python based projects using zc.buildout without issues.

- -aj


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQGUBAEBAgAGBQJMlNR0AAoJEADcfz7u4AZj64ALv1MHDCHWKJMJlHI69fZhc5E9
sCfT6Cnhz1/aEQ1JVu04vEstOrMEYOL6ruFths48E9+DLW2LXhUxEQUaN0gdgr54
0QgUDQzrT+WK8DN5erVW2uuj9oOVn5B4PUQfnT4prAgBzfmEEZ0Icd8KXJuE7fvI
OLQH37cyMH6uz5qCBRLyiVdVjmtNV+Xu3m1Zz94R3p2x3S1ODBtQyHna00S6dYsg
2GbkbSD4+Sv4X7A83Lym7h4ZQkdlAtjLUOX/f0wTV6UHeXMWEpgVqziryWW64RUS
vMBhfoALCx4jtm/VDD8pVdMgaZrHznaxrqg/x/GetHJQeS+4qNmg5TNzV2Fp2l3v
/0dYPZHSruVLLcNUQ2oqLsfl41HOWRZ86Nqy97uAYCRiYG+OwrOO+UTsoMQ0EOlg
yqaD/lfKoAzefwYNjwt6eqOONclADE/k2rOnPYOo7eOQGulHkAkytMivZUbS+XJ0
QZOLha5tzj8QWpVuoLPcSje8RPCGqrc=
=/I8J
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/d11b8349/attachment.vcf>

From tim at cantemo.com  Sat Sep 18 17:05:45 2010
From: tim at cantemo.com (Tim Child)
Date: Sat, 18 Sep 2010 18:05:45 +0200
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <-2638725974206513481@unknownmsgid>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
Message-ID: <8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>

I totally agree as well.

The mailing list is/was a pain (I am subscribed to many lists through google and its become lovely to manage all those list through it), and I much prefer the archive/search facility on Google groups.

GIthub in my opinion is just excellent in so many ways right now, its browsing of code and the related documentation is really nice, the forking and community aspects are just fantastic. But I would rather have solidly built packages than run from the bleeding edge but I would read any documentation on there.

The documentation is something that really needs attention, I actually started putting documentation on my own Wiki based upon what I found for the version I was running, bits pulled from the newsgroup that are more up to date than the actual website just to be able to get somewhere. Of course Django (mentioned below) has one of the most respected documentation setups of any project that I have come across. My best example of how not to do things is VMWare - bad forum software, badly documented (forum is the place for hacks), - although fine if you pay the big bucks and get support its become a barrier to entry for uptake - I hope they are not an influence.

And I agree Homebrew is much nicer than MacPorts (I won't have that installed on any machine that I use) if you are developing on OSX.

Tim.


On 18 Sep 2010, at 16:09, Shane Witbeck wrote:

> A big +1 on all the points brought up here especially improved usability of the website and docs. I assume the docs will eventually be more typical of the springsource projects :)
> 
> I also much prefer homebrew for Mac installs over macports.
> 
> -Shane
> 
> 
> On Sep 18, 2010, at 9:47 AM, Adam Nelson <adam at varud.com> wrote:
> 
>> David,
>> 
>> Thanks for the great replies, I've included comments below:
>> 
>> > [...]
>> >  * This newsgroup format is terrible.  Please move to Google Groups.
>> 
>> You can browse the mailing list at
>> <http://groups.google.com/group/rabbitmq-discuss>, and through various
>> other mailing list to web gateways.  What makes this arrangement
>> terrible for you?  Not being able to post through them, or something
>> else?
>> 
>> Signup is difficult, it's one more username for me to get, manage, and maintain.  I (and I presume 80% of the others here) already have a Gmail account - so posting for the first time wouldn't require going through several steps. The first time I posted, it was refused because the web interface apparently isn't integrated well with the email interface.  I had to sign up again the old fashioned way (via email).  Maybe it was a failure on my end but it reminded me of 1998 in every way.
>> 
>> Searching the archive is also significantly slower than on Google Groups.
>> 
>> 
>> >  * The code is very difficult to get at.  Please move to Github (or
>> > BitBucket).  I see that you're using Mercurial already, so BitBucket is the
>> > obvious choice.  I think GitHub is way more feature rich but if you're not
>> > willing to move to Git, that won't work of course.
>> 
>> Could you explain more about how the code is very difficult to get at?
>> It can be browsed online through the standard Mercurial web interface at
>> <http://hg.rabbitmq.com/>, and the process of cloning the repos would be
>> very similar under github and bitbucket.  I appreciate that github and
>> bitbucket have some advantages, but what, from your perspective, are the
>> key ones that would apply to RabbitMQ?
>> 
>> For a core developer, you probably already have a cloned hg copy.  I'm not a core developer.  My use for the code is to examine documentation and places where an exception is thrown.  I'm not going to be patching the code, but instead posting a bug report if something like that comes up.  Being able to access the code readily through a browser is key to that experience.
>> 
>> If you want more traction in the wider community outside of queues and brokers (i.e. Python programmers writing websites), RabbitMQ needs to make things more accessible more easily for the user.
>> 
>> http://github.com/zeromq/zeromq2
>> 
>> 
>> >  * The documentation is not version-specific.  This has caused me enormous
>> > problems (specifically with set-permissions, which is why I'm in the mode to
>> > write this message at all).  Please move to a platform that supports
>> > versioned documentation better.  I don't know the best solution to this
>> > exactly - maybe Sphinx or just a wiki with a url structure that supports
>> > multiple versions?
>> 
>> The principal documentation for set_permission is the rabbitmqctl man
>> page.  It's true that we only make the current versions of the man pages
>> available on the web site.  Would your problems have been avoided if we
>> published older versions of the man pages on the web site?
>> 
>> Yes.  Ubuntu is only on the 1.7.x series and the stable series on your site is 2.1.x 
>> The web site content is maintained in Mercurial alongside our codebase.
>> This is convenient in a number of ways for us (e.g. being able to handle
>> code changes and the corresponding web site documentation changes in the
>> same workflow).  So it's conceivable that we could publish multiple
>> versions of the documentation from Mercurial on the web site.  This
>> would however require us to draw more of a distinction between reference
>> documentation and other types of information, the former tending to be
>> much more strongly version-specific.  But maybe that's a good idea
>> anyway.
>> 
>> Django does it like that:
>> http://docs.djangoproject.com/en/1.2/topics/db/models/
>> http://docs.djangoproject.com/en/dev/topics/db/models/
>>  
>> >  * Where are the open tickets?  It appears that all bugs are going through
>> > the mailing list - it's really hard on the users to not have an
>> > easy-to-search ticket system.  Launchpad could work or BitBucket's issue
>> > system, or Redmine, or Trac?
>> 
>> The rabbit team's development work is tracked in bugzilla, but that
>> bugzilla instance is not currently public.  We will make it public at
>> some point, though doing so is not quite as straightforward as it might
>> first seem.
>> 
>> Bugzilla might not be as modern or attractive as some of the issue
>> trackers you mention, but it is very featureful, and ours is integrated
>> into the rest of our development infrastructure.
>> 
>> Modern and attractive is important.  I understand that there is a (large) transaction cost tied to moving but it's an important one to swallow.  If you're huge like Mozilla and are using Bugzilla, I understand that it's simply too difficult to change horses.  However if you go public with Bugzilla, you're going to get twice the duplicates (because searching is so painful) and half the real useful user feedback (because posting is so painful).  
>> 
>> Obviously, you guys run the show.  I'm just hoping that as one of the early users of your software in production who isn't otherwise tied to the messaging community, that you'll take my comments to heart.  Most people in my situation a year from now will choose the AMQP broker that has the best documentation and the most transparent release, maintenance, and setup processes - performance is secondary.  I see ZeroMQ successfully tackling those issues well and I just think we'd all benefit from a stronger RabbitMQ:
>> 
>> Thanks,
>> Adam
>> 
>> 
>> 
>> David
>> 
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>> 
>> 
>> 
>> -- 
>> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/f4c7c7e1/attachment.htm>

From jon at jbrisbin.com  Sat Sep 18 21:36:03 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 18 Sep 2010 15:36:03 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
Message-ID: <3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>

+1 on Homebrew over MacPorts. I recently did an upgrade on RabbitMQ in MacPorts and it took about 3-4 hours while it compiled an update for almost everything I had installed. I only have MacPorts for a few utilities. As an example of the difference, here's some stats from du on my "/usr/local" vs. "/opt/local":

+-( ~ ):> sudo du -hs /usr/local
359M	/usr/local

+-( ~/src/erlang ):> sudo du -hs /opt/local
Password:
9.0G	/opt/local

I want to scream: "are you freaking kidding me!?!?" MacPorts has to install over 8.5GB more stuff to support the same amount of software? I've almost switched completely away from MacPorts. I'm not installing any new software with MacPorts, simply using what's already installed.

RabbitMQ 2.x runs great with Homebrew, BTW. That's what I'm using now (it's not 2.1 but 2.0...hopefully someone will update the formula pretty soon)...

+1 on github over anything else. Even gitorious (the new springsource git repo uses gitorious) would be better than mercurial. What's great about github (and would make working with Rabbit so much easier) is that I can fork the repo for myself, make changes, commit them to my repository, then send you a pull request so you can easily incorporate those changes or not. It makes contributing to projects uber easy. I can't imagine doing it any other way...

+1 on better docs. I *love* Django's documentation. It is, quite frankly, the best OSS project documentation anywhere. Period. Even doing half as good a job as Django does on docs would be awesome. But it's time-consuming, no arguments there. There was mention not too long ago about a community-lead wiki at the bare minimum. It shouldn't even be a question about whether or not these things are necessary with modern OSS projects. Most OSS developers and users coming to a project will *expect* there to be a wiki.

+1 on a public bug tracker. Even if it's separate from the internal one and you keep the private stuff away from the unwashed masses. People need to feel like they're able to make a contribution to something, no matter how seemingly insignificant. They also want their frustrations to be acknowledged and maybe validated. A public bug tracker is just a way for you to integrate with your users. It doesn't have to be where you get your daily task schedule. You could keep using Bugzilla for that (though I have to ask: "why in the world would you want to? ;)"). 


Thanks!

J. Brisbin
http://jbrisbin.com/



On Sep 18, 2010, at 11:05 AM, Tim Child wrote:

> I totally agree as well.
> 
> The mailing list is/was a pain (I am subscribed to many lists through google and its become lovely to manage all those list through it), and I much prefer the archive/search facility on Google groups.
> 
> GIthub in my opinion is just excellent in so many ways right now, its browsing of code and the related documentation is really nice, the forking and community aspects are just fantastic. But I would rather have solidly built packages than run from the bleeding edge but I would read any documentation on there.
> 
> The documentation is something that really needs attention, I actually started putting documentation on my own Wiki based upon what I found for the version I was running, bits pulled from the newsgroup that are more up to date than the actual website just to be able to get somewhere. Of course Django (mentioned below) has one of the most respected documentation setups of any project that I have come across. My best example of how not to do things is VMWare - bad forum software, badly documented (forum is the place for hacks), - although fine if you pay the big bucks and get support its become a barrier to entry for uptake - I hope they are not an influence.
> 
> And I agree Homebrew is much nicer than MacPorts (I won't have that installed on any machine that I use) if you are developing on OSX.
> 
> Tim.
> 
> 
> On 18 Sep 2010, at 16:09, Shane Witbeck wrote:
> 
>> A big +1 on all the points brought up here especially improved usability of the website and docs. I assume the docs will eventually be more typical of the springsource projects :)
>> 
>> I also much prefer homebrew for Mac installs over macports.
>> 
>> -Shane
>> 
>> 
>> On Sep 18, 2010, at 9:47 AM, Adam Nelson <adam at varud.com> wrote:
>> 
>>> David,
>>> 
>>> Thanks for the great replies, I've included comments below:
>>> 
>>> > [...]
>>> >  * This newsgroup format is terrible.  Please move to Google Groups.
>>> 
>>> You can browse the mailing list at
>>> <http://groups.google.com/group/rabbitmq-discuss>, and through various
>>> other mailing list to web gateways.  What makes this arrangement
>>> terrible for you?  Not being able to post through them, or something
>>> else?
>>> 
>>> Signup is difficult, it's one more username for me to get, manage, and maintain.  I (and I presume 80% of the others here) already have a Gmail account - so posting for the first time wouldn't require going through several steps. The first time I posted, it was refused because the web interface apparently isn't integrated well with the email interface.  I had to sign up again the old fashioned way (via email).  Maybe it was a failure on my end but it reminded me of 1998 in every way.
>>> 
>>> Searching the archive is also significantly slower than on Google Groups.
>>> 
>>> 
>>> >  * The code is very difficult to get at.  Please move to Github (or
>>> > BitBucket).  I see that you're using Mercurial already, so BitBucket is the
>>> > obvious choice.  I think GitHub is way more feature rich but if you're not
>>> > willing to move to Git, that won't work of course.
>>> 
>>> Could you explain more about how the code is very difficult to get at?
>>> It can be browsed online through the standard Mercurial web interface at
>>> <http://hg.rabbitmq.com/>, and the process of cloning the repos would be
>>> very similar under github and bitbucket.  I appreciate that github and
>>> bitbucket have some advantages, but what, from your perspective, are the
>>> key ones that would apply to RabbitMQ?
>>> 
>>> For a core developer, you probably already have a cloned hg copy.  I'm not a core developer.  My use for the code is to examine documentation and places where an exception is thrown.  I'm not going to be patching the code, but instead posting a bug report if something like that comes up.  Being able to access the code readily through a browser is key to that experience.
>>> 
>>> If you want more traction in the wider community outside of queues and brokers (i.e. Python programmers writing websites), RabbitMQ needs to make things more accessible more easily for the user.
>>> 
>>> http://github.com/zeromq/zeromq2
>>> 
>>> 
>>> >  * The documentation is not version-specific.  This has caused me enormous
>>> > problems (specifically with set-permissions, which is why I'm in the mode to
>>> > write this message at all).  Please move to a platform that supports
>>> > versioned documentation better.  I don't know the best solution to this
>>> > exactly - maybe Sphinx or just a wiki with a url structure that supports
>>> > multiple versions?
>>> 
>>> The principal documentation for set_permission is the rabbitmqctl man
>>> page.  It's true that we only make the current versions of the man pages
>>> available on the web site.  Would your problems have been avoided if we
>>> published older versions of the man pages on the web site?
>>> 
>>> Yes.  Ubuntu is only on the 1.7.x series and the stable series on your site is 2.1.x 
>>> The web site content is maintained in Mercurial alongside our codebase.
>>> This is convenient in a number of ways for us (e.g. being able to handle
>>> code changes and the corresponding web site documentation changes in the
>>> same workflow).  So it's conceivable that we could publish multiple
>>> versions of the documentation from Mercurial on the web site.  This
>>> would however require us to draw more of a distinction between reference
>>> documentation and other types of information, the former tending to be
>>> much more strongly version-specific.  But maybe that's a good idea
>>> anyway.
>>> 
>>> Django does it like that:
>>> http://docs.djangoproject.com/en/1.2/topics/db/models/
>>> http://docs.djangoproject.com/en/dev/topics/db/models/
>>>  
>>> >  * Where are the open tickets?  It appears that all bugs are going through
>>> > the mailing list - it's really hard on the users to not have an
>>> > easy-to-search ticket system.  Launchpad could work or BitBucket's issue
>>> > system, or Redmine, or Trac?
>>> 
>>> The rabbit team's development work is tracked in bugzilla, but that
>>> bugzilla instance is not currently public.  We will make it public at
>>> some point, though doing so is not quite as straightforward as it might
>>> first seem.
>>> 
>>> Bugzilla might not be as modern or attractive as some of the issue
>>> trackers you mention, but it is very featureful, and ours is integrated
>>> into the rest of our development infrastructure.
>>> 
>>> Modern and attractive is important.  I understand that there is a (large) transaction cost tied to moving but it's an important one to swallow.  If you're huge like Mozilla and are using Bugzilla, I understand that it's simply too difficult to change horses.  However if you go public with Bugzilla, you're going to get twice the duplicates (because searching is so painful) and half the real useful user feedback (because posting is so painful).  
>>> 
>>> Obviously, you guys run the show.  I'm just hoping that as one of the early users of your software in production who isn't otherwise tied to the messaging community, that you'll take my comments to heart.  Most people in my situation a year from now will choose the AMQP broker that has the best documentation and the most transparent release, maintenance, and setup processes - performance is secondary.  I see ZeroMQ successfully tackling those issues well and I just think we'd all benefit from a stronger RabbitMQ:
>>> 
>>> Thanks,
>>> Adam
>>> 
>>> 
>>> 
>>> David
>>> 
>>> --
>>> David Wragg
>>> Staff Engineer, RabbitMQ
>>> SpringSource, a division of VMware
>>> 
>>> 
>>> 
>>> -- 
>>> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/7bdd03c2/attachment-0001.htm>

From matthew at rabbitmq.com  Sat Sep 18 22:52:51 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 22:52:51 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
Message-ID: <20100918215251.GA16939@wellquite.org>

Hi Jon,

On Sat, Sep 18, 2010 at 03:36:03PM -0500, Jon Brisbin wrote:
> +1 on Homebrew over MacPorts. I recently did an upgrade on RabbitMQ in
> MacPorts and it took about 3-4 hours while it compiled an update for
> almost everything I had installed. I only have MacPorts for a few
> utilities. As an example of the difference, here's some stats from du
> on my "/usr/local" vs. "/opt/local":
> 
> +-( ~ ):> sudo du -hs /usr/local
> 359M	/usr/local
> 
> +-( ~/src/erlang ):> sudo du -hs /opt/local
> Password:
> 9.0G	/opt/local
> 
> I want to scream: "are you freaking kidding me!?!?" MacPorts has to
> install over 8.5GB more stuff to support the same amount of software?
> I've almost switched completely away from MacPorts. I'm not installing
> any new software with MacPorts, simply using what's already
> installed.

I certainly want to scream "are you freaking kidding me!?!?" too.

Not many people use Gentoo these days - many of us will remember leaving
our PIIs on over night with them compiling away at KDE or some similar
monster and waking up in the morning to find it's still going. That was
at least 10 years ago. There is absolutely _no_ _way_ I would tolerate a
system where I had to compile every piece of software I needed. I don't
understand why macports or homebrew users do. Having googled around,
macports does seem to support binary packages, but does no one use them?
I run Debian unstable (Sid) on my desktops and laptops, and I apt-get
dist-upgrade most days. That normally results in probably 200MB of
binary package downloads every day in total for maybe 40 updated
packages. Compiling that number of packages every day is clearly
ridiculous.

It seems to me that macports actually gets dependencies much more
accurate to support the _whole_ package than homebrew. For example, yes,
Erlang, in its entirety requires lots of extra stuff to, e.g. build the
documentation. It appears that if you're installing Erlang under
homebrew you're just not going to get that documentation. The same
applies for RabbitMQ itself (there's even a comment in
http://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb
saying that they disable documentation because it has additional compile
time dependencies). Again, distributing binary packages here is the
correct solution: _only_ the package maintainer need have everything
installed to build the documentation, and for the end users, they get it
all, and they don't have to do anything at their end. Runtime
dependencies are frequently a fraction of compile time dependencies.

_I_ am distinctly unhappy about the fact that if homebrew continues to
become more popular, more and more RabbitMQ users are going to be
installing it without the documentation. We put time and effort into the
man pages, and I will _always_ refer to locally installed documentation
in preference to websites: you should always be able to trust that the
locally installed documentation matches the version of the software you
have installed. Some software, in e.g. Ubuntu LTS releases, or Debian
Stable releases, can be 5 years old and no, I would not expect the
authors to clutter their websites with historical records of past
documentation. I would however expect to be able to install the
documentation, if it isn't already, via the package manager, and know
that it matches the version of the software I have installed.

There are other optional dependencies of Erlang, for example X Windows.
This is optional but having it means that you can use some tools (e.g.
appmon) that you otherwise wouldn't be able to use. Macports seems to
assume that you're always going to have X Windows installed somehow,
given how prominantly it's mentioned in
http://guide.macports.org/chunked/installing.html. I can't see any
evidence of X Windows at all looking through the homebrew list at
http://github.com/mxcl/homebrew/tree/master/Library/Formula/. Again, the
correct solution is demonstrated by Linux distributions which for
example have both erlang and erlang-nox packages thus allowing you to
choose which is installed. Then RabbitMQ can depend on erlang |
erlang-nox. In fact, in modern linux distributions, Erlang has been
split up into many smaller packages so that packages really can express
precisely which parts of Erlang they depend on, which bits are
optional, and which bits have no bearing at all on the package.

Over the last 20 years, Linux distributions have honed package managers.
It's no surprise that these days rpm and deb systems are comparable in
power in terms of package management and are extremely capable. _I_ am
frequently amazed at how incapable package management is on other
platforms.

IMHO, most of the pain caused by macports is only addressed by
homebrew's packages _seeming_ to do the absolute minimum required to
make something compile at the cost of excluding (almost?) all optional
features and components.

Matthew


From matthew at rabbitmq.com  Sat Sep 18 23:30:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 23:30:16 +0100
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <FBFC0A10-7AAD-40FB-9C4F-9149E4B0A019@gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
	<AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
	<0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>
	<AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>
	<FBFC0A10-7AAD-40FB-9C4F-9149E4B0A019@gmail.com>
Message-ID: <20100918223016.GB16939@wellquite.org>

On Fri, Sep 17, 2010 at 04:32:09PM +0200, romary.kremer at gmail.com wrote:
> Can you give us hints about how the production was indeed paused,
> other by stopping reading from the socket ?

The client itself understands the channel.flow messages that come from
the broker. Thus the client then itself blocks any publishes that the
application does, waiting for permission from the broker to resume
publishing.

> Does the broker shut the connection or only the channel if a
> content-bearing message is sent after the flow.control ?

I can't remember. I would think it should be channel only on the grounds
that other channels that may be consuming messages have done nothing
wrong. However, for that to happen is basically a client error: the
client itself should understand the channel flow messages and make
sending content-bearing messages a blocking operation at that point.

> What is the meaning of status "Blocked" and "Blocking" that we can
> gather by listing connections ! I often noticed that
> the connection of producer in status "blocked" lead the connection
> of the consumer to be "Blocking".

That will mean that channel.flow{active=false} has been sent to the
client, and then that channel.flow_ok has been received back by the
server.

> Sharing the same connection for producer and consumer, by the use of
> Channel may not be safe, that is very sad !

Well, it's fine provided you have a client that works properly and you
understand that at times, publishing a content bearing message may be a
blocking operation, and code accordingly.

Matthew

From matthew at rabbitmq.com  Sat Sep 18 23:30:50 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 23:30:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ with Erlang R14B
In-Reply-To: <20100917165539.10139rm0uojnohhw@webmail.active24.cz>
References: <20100915130907.GC9474@rabbitmq.com>
	<20100917165539.10139rm0uojnohhw@webmail.active24.cz>
Message-ID: <20100918223049.GC16939@wellquite.org>

On Fri, Sep 17, 2010 at 04:55:39PM +0200, jiri at krutil.com wrote:
> Thanks for the info. SSL in Erlang R14B seems to work fine.

Good good.

> Maybe it would be good to update the info about various Erlang
> versions at http://www.rabbitmq.com/ssl.html ?

Yes, we have a couple of bugs nearing completion which will see to that.

Matthew

From matthew at rabbitmq.com  Sat Sep 18 23:34:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 23:34:07 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
Message-ID: <20100918223406.GD16939@wellquite.org>

On Thu, Sep 16, 2010 at 09:01:17AM +0100, Michael Burns wrote:
> I've noticed sometimes that there are extra connections hanging about on the
> RabbitMQ broker (using rabbitmqctl  list_connections).
> It's possible sometimes in our consumers that we are not always closing the
> connection cleanly (sometimes people are simply killing their app rather
> than shutting down cleanly).
> 
> Could this somehow explain why we experience these delays?

Yes. If the TCP socket is still alive then Rabbit will not believe the
connection has died, and so will not make unacknowledged messages
available to other consumers.

It would seem that this is your problem. To ensure that the connection
is promptly detected to be detached, you could either turn on AMQP
heartbeats or TCP KeepAlive. Either should suffice.

Matthew

From jon at jbrisbin.com  Sat Sep 18 23:34:58 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 18 Sep 2010 17:34:58 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100918215251.GA16939@wellquite.org>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
Message-ID: <F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>


On Sep 18, 2010, at 4:52 PM, Matthew Sackman wrote:

> _I_ am distinctly unhappy about the fact that if homebrew continues to
> become more popular, more and more RabbitMQ users are going to be
> installing it without the documentation. We put time and effort into the
> man pages, and I will _always_ refer to locally installed documentation
> in preference to websites: you should always be able to trust that the
> locally installed documentation matches the version of the software you
> have installed.

I guess we'll have to agree to disagree on how developers use documentation. I can't speak for others, but I don't use man pages unless I'm forced to. When I'm developing, I have about a dozen tabs open with the various documentation sources I need while I'm developing. I use online documentation *exclusively*. I do have a few things with documentation installed locally. Spring framework and the Java SE API docs being the two I use most frequently. But I usually do that because they're so big.

For everything else, I always, always, always use the resources available online. I do that because I switch back and forth between the official docs and googling for examples. I mix other sources in with official documentation. I can't do that if I'm locked into less on a terminal. 

Sorry to burst your bubble, but I *really* hate man pages. I use them for finding out what options I need to pass to a program because it's been a while since I've used it and I don't quite remember. For that, they're really handy. I don't use them for anything else.

> Some software, in e.g. Ubuntu LTS releases, or Debian
> Stable releases, can be 5 years old and no, I would not expect the
> authors to clutter their websites with historical records of past
> documentation.

Having old versions of things on their website is an expectation I have. Maybe it's unrealistic. I can see no downside to having old versions of documentation hanging around for users of older versions of the software. If you put the version of your documentation in a position:fixed nav box somewhere on the page, you've addressed the problem of being half-way through a page of docs and forgetting what version you're looking at. 

When you write the documentation, if you cover a new feature introduced in that version, you simply put a "since: 2.1.0" or something. If enough of these are sprinkled throughout, people get used to that easily and understand that this feature was introduced in version 2.1.0. The python docs are great examples of this.

> I would however expect to be able to install the
> documentation, if it isn't already, via the package manager, and know
> that it matches the version of the software I have installed.

I think that's reasonable, but I go back to agreeing to disagree on what format most developers prefer to use documentation in. Erlang folks I think are a little skewed because of the prominence of Emacs, info docs, and the really old school conventions that are perfectly functional but aren't taking advantage of new possibilities.

> There are other optional dependencies of Erlang, for example X Windows.

Uggh. X. Don't get me started on that! :)

> I can't see any
> evidence of X Windows at all looking through the homebrew list at
> http://github.com/mxcl/homebrew/tree/master/Library/Formula/.

Thank heavens! :)

XQuartz is awesome and everything I need in an X distro.

> Again, the
> correct solution is demonstrated by Linux distributions which for
> example have both erlang and erlang-nox packages thus allowing you to
> choose which is installed. Then RabbitMQ can depend on erlang |
> erlang-nox. In fact, in modern linux distributions, Erlang has been
> split up into many smaller packages so that packages really can express
> precisely which parts of Erlang they depend on, which bits are
> optional, and which bits have no bearing at all on the package.

I do like this because it really burns me that I have to install X on server machines that will never have an X session run on them because it's a dependency.

> Over the last 20 years, Linux distributions have honed package managers.
> It's no surprise that these days rpm and deb systems are comparable in
> power in terms of package management and are extremely capable. _I_ am
> frequently amazed at how incapable package management is on other
> platforms.

I wish there were aptitude for Mac. If someone wants to really make Mac developers happy, they'd port apt to OS X and have a little GUI to download binaries, like you suggest.

Until such time I'll use Homebrew because it takes up less space on my harddrive and has fewer "parts" to keep track of.

> IMHO, most of the pain caused by macports is only addressed by
> homebrew's packages _seeming_ to do the absolute minimum required to
> make something compile at the cost of excluding (almost?) all optional
> features and components.


I can't speak for anyone else, but having every possible option turned on by default is the reason I don't like macports. The fact that Homebrew does exactly what you've pointed out is why I like it! :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100918/84337cfe/attachment-0001.htm>

From matthew at rabbitmq.com  Sat Sep 18 23:36:51 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 23:36:51 +0100
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting
 the RabbitMQ server on Windows
In-Reply-To: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
References: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
Message-ID: <20100918223650.GE16939@wellquite.org>

On Fri, Sep 17, 2010 at 03:01:56PM -0500, Jon Rowland wrote:
> I've just installed 2.1.0 of RabbitMQ on Windows, and when I start the server I get a lot of warnings, e.g.
> 
> C:\rabbitmq_server-2.1.0\sbin>rabbitmq-server.bat
> Activating RabbitMQ plugins ...
> *WARNING* rabbit: Object code (bpqueue) out of date
> *WARNING* rabbit: Object code (delegate) out of date
> *WARNING* rabbit: Object code (delegate_sup) out of date
> ...etc...
> 
> Is this something to worry about? I did have a 1.7.0 version installed, but uninstalled it before installing 2.1.0. Has the install left something on my machine that is causing the warnings?

Hmm, do you have any plugins installed manually - i.e. you've compiled
them? That smells to me like the plugins need to be updated and
recompiled.

Matthew

From jasonjwwilliams at gmail.com  Sat Sep 18 23:43:37 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 18 Sep 2010 16:43:37 -0600
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100918215251.GA16939@wellquite.org>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
Message-ID: <F614F3F6-A2A8-4236-B4D0-F8DAAFDF5F43@gmail.com>

I have to echo Matthew's sentiments on MacPorts. I've had pretty good luck with it once I got it tweaked the way I wanted. Also, I only use it to install Erlang when it comes to Rabbit. Rabbit itself I install just by unpacking the generic UNIX tarball into /opt. Fast and simple. Also, by symlinking /opt/rabbitmq-server to /opt/rabbitmq_server-xxxx I can keep multiple versions around for testing. 

I wouldn't be against supporting homebrew but I wouldn't abandon MacPorts to do it. 

Regarding the documentation, I usually find what I need but I'd agree it's not as neatly organized as MongoDB. I do like the design of RabbitMQ.com. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Sep 18, 2010, at 15:52, Matthew Sackman <matthew at rabbitmq.com> wrote:

> Hi Jon,
> 
> On Sat, Sep 18, 2010 at 03:36:03PM -0500, Jon Brisbin wrote:
>> +1 on Homebrew over MacPorts. I recently did an upgrade on RabbitMQ in
>> MacPorts and it took about 3-4 hours while it compiled an update for
>> almost everything I had installed. I only have MacPorts for a few
>> utilities. As an example of the difference, here's some stats from du
>> on my "/usr/local" vs. "/opt/local":
>> 
>> +-( ~ ):> sudo du -hs /usr/local
>> 359M    /usr/local
>> 
>> +-( ~/src/erlang ):> sudo du -hs /opt/local
>> Password:
>> 9.0G    /opt/local
>> 
>> I want to scream: "are you freaking kidding me!?!?" MacPorts has to
>> install over 8.5GB more stuff to support the same amount of software?
>> I've almost switched completely away from MacPorts. I'm not installing
>> any new software with MacPorts, simply using what's already
>> installed.
> 
> I certainly want to scream "are you freaking kidding me!?!?" too.
> 
> Not many people use Gentoo these days - many of us will remember leaving
> our PIIs on over night with them compiling away at KDE or some similar
> monster and waking up in the morning to find it's still going. That was
> at least 10 years ago. There is absolutely _no_ _way_ I would tolerate a
> system where I had to compile every piece of software I needed. I don't
> understand why macports or homebrew users do. Having googled around,
> macports does seem to support binary packages, but does no one use them?
> I run Debian unstable (Sid) on my desktops and laptops, and I apt-get
> dist-upgrade most days. That normally results in probably 200MB of
> binary package downloads every day in total for maybe 40 updated
> packages. Compiling that number of packages every day is clearly
> ridiculous.
> 
> It seems to me that macports actually gets dependencies much more
> accurate to support the _whole_ package than homebrew. For example, yes,
> Erlang, in its entirety requires lots of extra stuff to, e.g. build the
> documentation. It appears that if you're installing Erlang under
> homebrew you're just not going to get that documentation. The same
> applies for RabbitMQ itself (there's even a comment in
> http://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb
> saying that they disable documentation because it has additional compile
> time dependencies). Again, distributing binary packages here is the
> correct solution: _only_ the package maintainer need have everything
> installed to build the documentation, and for the end users, they get it
> all, and they don't have to do anything at their end. Runtime
> dependencies are frequently a fraction of compile time dependencies.
> 
> _I_ am distinctly unhappy about the fact that if homebrew continues to
> become more popular, more and more RabbitMQ users are going to be
> installing it without the documentation. We put time and effort into the
> man pages, and I will _always_ refer to locally installed documentation
> in preference to websites: you should always be able to trust that the
> locally installed documentation matches the version of the software you
> have installed. Some software, in e.g. Ubuntu LTS releases, or Debian
> Stable releases, can be 5 years old and no, I would not expect the
> authors to clutter their websites with historical records of past
> documentation. I would however expect to be able to install the
> documentation, if it isn't already, via the package manager, and know
> that it matches the version of the software I have installed.
> 
> There are other optional dependencies of Erlang, for example X Windows.
> This is optional but having it means that you can use some tools (e.g.
> appmon) that you otherwise wouldn't be able to use. Macports seems to
> assume that you're always going to have X Windows installed somehow,
> given how prominantly it's mentioned in
> http://guide.macports.org/chunked/installing.html. I can't see any
> evidence of X Windows at all looking through the homebrew list at
> http://github.com/mxcl/homebrew/tree/master/Library/Formula/. Again, the
> correct solution is demonstrated by Linux distributions which for
> example have both erlang and erlang-nox packages thus allowing you to
> choose which is installed. Then RabbitMQ can depend on erlang |
> erlang-nox. In fact, in modern linux distributions, Erlang has been
> split up into many smaller packages so that packages really can express
> precisely which parts of Erlang they depend on, which bits are
> optional, and which bits have no bearing at all on the package.
> 
> Over the last 20 years, Linux distributions have honed package managers.
> It's no surprise that these days rpm and deb systems are comparable in
> power in terms of package management and are extremely capable. _I_ am
> frequently amazed at how incapable package management is on other
> platforms.
> 
> IMHO, most of the pain caused by macports is only addressed by
> homebrew's packages _seeming_ to do the absolute minimum required to
> make something compile at the cost of excluding (almost?) all optional
> features and components.
> 
> Matthew
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Sat Sep 18 23:59:47 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 18 Sep 2010 23:59:47 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
	<F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
Message-ID: <20100918225946.GA8796@wellquite.org>

> On Sep 18, 2010, at 4:52 PM, Matthew Sackman wrote:
> I guess we'll have to agree to disagree on how developers use
> documentation. I can't speak for others, but I don't use man pages
> unless I'm forced to. When I'm developing, I have about a dozen tabs
> open with the various documentation sources I need while I'm
> developing. I use online documentation *exclusively*. I do have a few
> things with documentation installed locally. Spring framework and the
> Java SE API docs being the two I use most frequently. But I usually do
> that because they're so big.

Heh, yeah, I hear you about size. Also, I generally prefer info pages to
man pages as they can be cross-linked etc. I also have dozens of tabs
open too - but e.g. frequently to
file:///usr/share/doc/$PACKAGE-docs/html/... etc. There's no good reason
why HTML documentation can't be installed locally. Also, never
underestimate the utility of M-x man $PACKAGE in emacs ;)

> > Some software, in e.g. Ubuntu LTS releases, or Debian
> > Stable releases, can be 5 years old and no, I would not expect the
> > authors to clutter their websites with historical records of past
> > documentation.
> 
> Having old versions of things on their website is an expectation I
> have. Maybe it's unrealistic. I can see no downside to having old
> versions of documentation hanging around for users of older versions
> of the software. If you put the version of your documentation in a
> position:fixed nav box somewhere on the page, you've addressed the
> problem of being half-way through a page of docs and forgetting what
> version you're looking at.

Sure, I understand what you're saying. I think it's reasonable to have
documentation a few revisions back, but if you then have a massive
rethemeing or rebranding exercise, do you really want to slog through
the 60 releases you've made over the last 5 years? There are maintanence
tradeoffs. E.g. you choose to rewrite a paragraph because it's not
clear. The functionality that the paragraph describes hasn't changed for
N revisions. Does the paragraph need applying to all N copies of the
documentation? I know these sound like trivial issues, but whatever
policy is agreed on should be applied consistently, and when you're in a
team of just 6 full time developers, these things take a substantial
toll on man power.

> When you write the documentation, if you cover a new feature
> introduced in that version, you simply put a "since: 2.1.0" or
> something. If enough of these are sprinkled throughout, people get
> used to that easily and understand that this feature was introduced in
> version 2.1.0. The python docs are great examples of this.

Yeah, I don't think that's at all unreasonable. It depends on the style
of the documentation. For something like the extensions page, yes, I
think that would work well. For something like the clustering guide or
pacemaker guide, where the documentation is prose, I think it would
break the flow and so for stuff like that, I'd probably prefer to have
entirely separate versions of the page.

> I think that's reasonable, but I go back to agreeing to disagree on
> what format most developers prefer to use documentation in. Erlang
> folks I think are a little skewed because of the prominence of Emacs,
> info docs, and the really old school conventions that are perfectly
> functional but aren't taking advantage of new possibilities.

By the same token, I hope you'll allow me to say that maybe OS X users
are equally skewed ;) Personally, I think good integration with the
editor is really powerful: eclipse and other IDEs are excellent examples
of this. Emacs isn't /great/ at it, but it's, as you say, perfectly
functional. The key requirement is that any documentation can be
searched very quickly and efficiently. Man pages work well as leaves
(simply because they can't be anything else). I would agree that having
something like the Java API docs as man pages would be a horror show if
you didn't know what you were looking for, but being able to just type
"man HashTable" is _much_ faster than using a webbrowser.

> Until such time I'll use Homebrew because it takes up less space on my
> harddrive and has fewer "parts" to keep track of.

My only fear with that is that eventually people may get bitten by
missing features which were disabled simply because it would make
compilation more tricky. What is it about homebrew that you think will
prevent it from turning into macports again? Are they actively trying to
avoid supporting anything other than the simplest configuration of each
package?

> I can't speak for anyone else, but having every possible option turned
> on by default is the reason I don't like macports. The fact that
> Homebrew does exactly what you've pointed out is why I like it! :)

I think the users should have the choice. Neither system offers that.

Matthew


From tim at cantemo.com  Sun Sep 19 09:19:28 2010
From: tim at cantemo.com (Tim Child)
Date: Sun, 19 Sep 2010 10:19:28 +0200
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100918225946.GA8796@wellquite.org>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
	<F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
	<20100918225946.GA8796@wellquite.org>
Message-ID: <B99E52D5-09DA-401A-8597-2D77B05D51A5@cantemo.com>


On 19 Sep 2010, at 00:59, Matthew Sackman wrote:

>> On Sep 18, 2010, at 4:52 PM, Matthew Sackman wrote:
>> I guess we'll have to agree to disagree on how developers use
>> documentation. I can't speak for others, but I don't use man pages
>> unless I'm forced to. When I'm developing, I have about a dozen tabs
>> open with the various documentation sources I need while I'm
>> developing. I use online documentation *exclusively*. I do have a few
>> things with documentation installed locally. Spring framework and the
>> Java SE API docs being the two I use most frequently. But I usually do
>> that because they're so big.
> 
> Heh, yeah, I hear you about size. Also, I generally prefer info pages to
> man pages as they can be cross-linked etc. I also have dozens of tabs
> open too - but e.g. frequently to
> file:///usr/share/doc/$PACKAGE-docs/html/... etc. There's no good reason
> why HTML documentation can't be installed locally. Also, never
> underestimate the utility of M-x man $PACKAGE in emacs ;)

I also echo the fact that Man pages are usually the last place I look, reading properly formatted
HTML is a lot easier, I can even read it on my phone on the train if I wish.

> 
>>> Some software, in e.g. Ubuntu LTS releases, or Debian
>>> Stable releases, can be 5 years old and no, I would not expect the
>>> authors to clutter their websites with historical records of past
>>> documentation.
>> 
>> Having old versions of things on their website is an expectation I
>> have. Maybe it's unrealistic. I can see no downside to having old
>> versions of documentation hanging around for users of older versions
>> of the software. If you put the version of your documentation in a
>> position:fixed nav box somewhere on the page, you've addressed the
>> problem of being half-way through a page of docs and forgetting what
>> version you're looking at.
> 
> Sure, I understand what you're saying. I think it's reasonable to have
> documentation a few revisions back, but if you then have a massive
> rethemeing or rebranding exercise, do you really want to slog through
> the 60 releases you've made over the last 5 years? There are maintanence
> tradeoffs. E.g. you choose to rewrite a paragraph because it's not
> clear. The functionality that the paragraph describes hasn't changed for
> N revisions. Does the paragraph need applying to all N copies of the
> documentation? I know these sound like trivial issues, but whatever
> policy is agreed on should be applied consistently, and when you're in a
> team of just 6 full time developers, these things take a substantial
> toll on man power.

If you are concerned about the branding or something like that, look into Sphinx or
something equally powerful. It will save time for your developers in the long run.

I am not sure that I want it to go many versions back - usually the last point releases
and whatever is supported in the major distros. For example, a lot of people won't be
installing 2.x just yet, and will be a mix or 1.7 and 1.8

>> Until such time I'll use Homebrew because it takes up less space on my
>> harddrive and has fewer "parts" to keep track of.
> 
> My only fear with that is that eventually people may get bitten by
> missing features which were disabled simply because it would make
> compilation more tricky. What is it about homebrew that you think will
> prevent it from turning into macports again? Are they actively trying to
> avoid supporting anything other than the simplest configuration of each
> package?

Maybe it is a lack of understanding, but I have seen MacPorts do some really weird
things to my OS X machines. I am hoping that homebrew will be the apt of OS X
but I doubt it, as it requires a level of knowledge of what is happening further in the 
development of the operating system and lets face it Apple don't care.

> 
>> I can't speak for anyone else, but having every possible option turned
>> on by default is the reason I don't like macports. The fact that
>> Homebrew does exactly what you've pointed out is why I like it! :)
> 
> I think the users should have the choice. Neither system offers that.

True.

Tim.

From jon.rowland at isam.com  Sun Sep 19 11:01:55 2010
From: jon.rowland at isam.com (Jon Rowland)
Date: Sun, 19 Sep 2010 05:01:55 -0500
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting
 the RabbitMQ server on Windows
In-Reply-To: <20100918223650.GE16939@wellquite.org>
References: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100918223650.GE16939@wellquite.org>
Message-ID: <985477893245CF449ABD4F01814A9FF65E705C137E@34093-MBX-C06.mex07a.mlsrvr.com>

I don't think so, this is a fresh install of 2.1.0 (on a machine that previously has had 1.7.0, but was uninstalled).

There are a lot of the plug-in warnings (around 80), including rabbit ones, e.g.
...
*WARNING* rabbit: Object code (rabbit_exchange) out of date
*WARNING* rabbit: Object code (rabbit_exchange_type) out of date
...

I'm a new user and wouldn't even know how to install/compile a plug-in manually.

Could there be some compiled cache left lying around somewhere from the 1.7.0 install?

Thanks,
Jon

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: 18 September 2010 23:37
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Plug-in out of date warnings when starting the RabbitMQ server on Windows

On Fri, Sep 17, 2010 at 03:01:56PM -0500, Jon Rowland wrote:
> I've just installed 2.1.0 of RabbitMQ on Windows, and when I start the server I get a lot of warnings, e.g.
> 
> C:\rabbitmq_server-2.1.0\sbin>rabbitmq-server.bat
> Activating RabbitMQ plugins ...
> *WARNING* rabbit: Object code (bpqueue) out of date
> *WARNING* rabbit: Object code (delegate) out of date
> *WARNING* rabbit: Object code (delegate_sup) out of date
> ...etc...
> 
> Is this something to worry about? I did have a 1.7.0 version installed, but uninstalled it before installing 2.1.0. Has the install left something on my machine that is causing the warnings?

Hmm, do you have any plugins installed manually - i.e. you've compiled
them? That smells to me like the plugins need to be updated and
recompiled.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Sun Sep 19 11:09:11 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 19 Sep 2010 11:09:11 +0100
Subject: [rabbitmq-discuss] Plug-in out of date warnings when starting
 the RabbitMQ server on Windows
In-Reply-To: <985477893245CF449ABD4F01814A9FF65E705C137E@34093-MBX-C06.mex07a.mlsrvr.com>
References: <985477893245CF449ABD4F01814A9FF65E705C12A0@34093-MBX-C06.mex07a.mlsrvr.com>
	<20100918223650.GE16939@wellquite.org>
	<985477893245CF449ABD4F01814A9FF65E705C137E@34093-MBX-C06.mex07a.mlsrvr.com>
Message-ID: <20100919100910.GB28163@wellquite.org>

On Sun, Sep 19, 2010 at 05:01:55AM -0500, Jon Rowland wrote:
> I don't think so, this is a fresh install of 2.1.0 (on a machine that previously has had 1.7.0, but was uninstalled).
> 
> There are a lot of the plug-in warnings (around 80), including rabbit ones, e.g.
> ...
> *WARNING* rabbit: Object code (rabbit_exchange) out of date
> *WARNING* rabbit: Object code (rabbit_exchange_type) out of date
> ...

Right, it must be finding those _somewhere_. If you've only installed
the 2.1.0 broker and no plugins then it must be finding them from some
previous install. Hunt down the plugins directory, nuke it from orbit,
and then rerun "rabbitmq-service.bat install" as documented at
http://www.rabbitmq.com/admin-guide.html#uninstalling-plugins

Matthew

From jon at jbrisbin.com  Sun Sep 19 14:17:44 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sun, 19 Sep 2010 08:17:44 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100918225946.GA8796@wellquite.org>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
	<F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
	<20100918225946.GA8796@wellquite.org>
Message-ID: <28155C34-9764-4204-90DE-21FBDF88ABC5@jbrisbin.com>


On Sep 18, 2010, at 5:59 PM, Matthew Sackman wrote:

> Sure, I understand what you're saying. I think it's reasonable to have
> documentation a few revisions back, but if you then have a massive
> rethemeing or rebranding exercise, do you really want to slog through
> the 60 releases you've made over the last 5 years? There are maintanence
> tradeoffs. E.g. you choose to rewrite a paragraph because it's not
> clear. The functionality that the paragraph describes hasn't changed for
> N revisions. Does the paragraph need applying to all N copies of the
> documentation? I know these sound like trivial issues, but whatever
> policy is agreed on should be applied consistently, and when you're in a
> team of just 6 full time developers, these things take a substantial
> toll on man power.

Several years ago I started work on a CMS-like publishing app that would solve problems like this by handling content as paragraphs of text rather than as whole pages. I was trying to address this specific problem as well as provide streaming to browsers without having to download the whole page. Without anyone to help, though, it had to fall by the wayside. I still believe that a new publishing paradigm needs to be developed to put content on the Web 2.x that takes issues like this into account. But for the time being, a competent CMS combined with a fair bit of client-side code could provide a happy middle ground. Semantic CSS tags and jQuery would be sufficient to markup a page consistently, would be easy to change, and would be easy on the developers.

My hourly rate is quite cheap, BTW! ;)

> By the same token, I hope you'll allow me to say that maybe OS X users
> are equally skewed ;)

No arguments there! In fact, I'd say OS X users are quite convinced their way is the best way. Present company included. ;)

> I would agree that having
> something like the Java API docs as man pages would be a horror show if
> you didn't know what you were looking for, but being able to just type
> "man HashTable" is _much_ faster than using a webbrowser.

I recognize the truth in this but I still cringe at the thought. :) I guess I just prefer an HTML/web interface even though it's slower and probably more trouble in the end. They do put man pages on the web, too.

> My only fear with that is that eventually people may get bitten by
> missing features which were disabled simply because it would make
> compilation more tricky. What is it about homebrew that you think will
> prevent it from turning into macports again? Are they actively trying to
> avoid supporting anything other than the simplest configuration of each
> package?

I don't see anything that would really prevent Homebrew from becoming MacPorts in a couple years. But I'm okay with that. I'll use it for a couple years and when it gets bloated I'll switch to the next thing that will inevitably come along to suit the minimalists. :)

> I think the users should have the choice. Neither system offers that.

Couldn't agree more.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100919/9408f0a4/attachment.htm>

From shane at digitalsanctum.com  Sun Sep 19 15:13:04 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Sun, 19 Sep 2010 10:13:04 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<AANLkTimm8VK+2RmbshZnppGhWJK-4VBoENEemGKqWmho@mail.gmail.com>
	<-2638725974206513481@unknownmsgid>
	<8C342471-9CD8-4FB7-A81B-1E7B25669EDF@cantemo.com>
	<3A6BD2FD-096E-42F0-9BBC-76910CD8028B@jbrisbin.com>
	<20100918215251.GA16939@wellquite.org>
	<F8E46352-0442-4E72-BA2E-6F4CF4D32915@jbrisbin.com>
Message-ID: <3090315723562135801@unknownmsgid>

Well said. I feel the same way, preferring web docs and the simplicity of
homebrew.

-Shane


On Sep 18, 2010, at 6:34 PM, Jon Brisbin <jon at jbrisbin.com> wrote:


On Sep 18, 2010, at 4:52 PM, Matthew Sackman wrote:

_I_ am distinctly unhappy about the fact that if homebrew continues to
become more popular, more and more RabbitMQ users are going to be
installing it without the documentation. We put time and effort into the

man pages, and I will _always_ refer to locally installed documentation
in preference to websites: you should always be able to trust that the
locally installed documentation matches the version of the software you
have installed.


I guess we'll have to agree to disagree on how developers use documentation.
I can't speak for others, but I don't use man pages unless I'm forced to.
When I'm developing, I have about a dozen tabs open with the various
documentation sources I need while I'm developing. I use online
documentation *exclusively*. I do have a few things with documentation
installed locally. Spring framework and the Java SE API docs being the two I
use most frequently. But I usually do that because they're so big.

For everything else, I always, always, always use the resources available
online. I do that because I switch back and forth between the official docs
and googling for examples. I mix other sources in with official
documentation. I can't do that if I'm locked into less on a terminal.

Sorry to burst your bubble, but I *really* hate man pages. I use them for
finding out what options I need to pass to a program because it's been a
while since I've used it and I don't quite remember. For that, they're
really handy. I don't use them for anything else.

Some software, in e.g. Ubuntu LTS releases, or Debian
Stable releases, can be 5 years old and no, I would not expect the
authors to clutter their websites with historical records of past
documentation.


Having old versions of things on their website is an expectation I have.
Maybe it's unrealistic. I can see no downside to having old versions of
documentation hanging around for users of older versions of the software. If
you put the version of your documentation in a position:fixed nav box
somewhere on the page, you've addressed the problem of being half-way
through a page of docs and forgetting what version you're looking at.

When you write the documentation, if you cover a new feature introduced in
that version, you simply put a "since: 2.1.0" or something. If enough of
these are sprinkled throughout, people get used to that easily and
understand that this feature was introduced in version 2.1.0. The python
docs are great examples of this.

I would however expect to be able to install the
documentation, if it isn't already, via the package manager, and know
that it matches the version of the software I have installed.


I think that's reasonable, but I go back to agreeing to disagree on what
format most developers prefer to use documentation in. Erlang folks I think
are a little skewed because of the prominence of Emacs, info docs, and the
really old school conventions that are perfectly functional but aren't
taking advantage of new possibilities.

There are other optional dependencies of Erlang, for example X Windows.


Uggh. X. Don't get me started on that! :)

I can't see any
evidence of X Windows at all looking through the homebrew list at
http://github.com/mxcl/homebrew/tree/master/Library/Formula/.


Thank heavens! :)

XQuartz is awesome and everything I need in an X distro.

Again, the
correct solution is demonstrated by Linux distributions which for
example have both erlang and erlang-nox packages thus allowing you to
choose which is installed. Then RabbitMQ can depend on erlang |
erlang-nox. In fact, in modern linux distributions, Erlang has been
split up into many smaller packages so that packages really can express
precisely which parts of Erlang they depend on, which bits are
optional, and which bits have no bearing at all on the package.


I do like this because it really burns me that I have to install X on server
machines that will never have an X session run on them because it's a
dependency.

Over the last 20 years, Linux distributions have honed package managers.
It's no surprise that these days rpm and deb systems are comparable in
power in terms of package management and are extremely capable. _I_ am
frequently amazed at how incapable package management is on other
platforms.


I wish there were aptitude for Mac. If someone wants to really make Mac
developers happy, they'd port apt to OS X and have a little GUI to download
binaries, like you suggest.

Until such time I'll use Homebrew because it takes up less space on my
harddrive and has fewer "parts" to keep track of.

IMHO, most of the pain caused by macports is only addressed by
homebrew's packages _seeming_ to do the absolute minimum required to
make something compile at the cost of excluding (almost?) all optional
features and components.


I can't speak for anyone else, but having every possible option turned on by
default is the reason I don't like macports. The fact that Homebrew does
exactly what you've pointed out is why I like it! :)

Thanks!

J. Brisbin
http://jbrisbin.com/






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100919/5cac9446/attachment-0001.htm>

From oliver.senn at smart.mit.edu  Mon Sep 20 05:16:28 2010
From: oliver.senn at smart.mit.edu (Oliver Senn)
Date: Mon, 20 Sep 2010 12:16:28 +0800
Subject: [rabbitmq-discuss] RabbitHub installation problem
Message-ID: <4C96E01C.3010502@smart.mit.edu>

Hi list,

I just tried setting up RabbitHub under RabbitMQ 2.1.0. I managed to 
compile it but the installation does not seem to work. Here is what 
I did:
1) Downloaded and compiled the umbrella project (according to [1])
2) Downloaded the source of RabbitHub and compiled it
3) That leaves me with a 'dist' folder with the following contents
       rabbithub (folder)
       amqp_client.ez
       mochiweb.ez
       rabbit_common.ez
       rabbithub.ez
4) I then copied all of the above to the plugins directory of my
    RabbitMQ installation. Was that the right thing to do?
5) Tried to start RabbitMQ but got this error message:
       [...]
       Duplicated modules:
          supervisor2 specified in rabbit and rabbit_common
          ...
          gen_server2 specified in rabbit and rabbit_common
6) So I removed the rabbit_common.ez file from the plugins directory
    and restarted.
7) Then the server could be started and the following output was
    generated by rabbitmqctl status:
Status of node rabbit at satay ...
[{running_applications,
      [{amqp_client,"RabbitMQ AMQP Client","0.0.0"},
       {rabbit,"RabbitMQ","2.1.0"},
       {os_mon,"CPO  CXC 138 46","2.2.4"},
       {sasl,"SASL  CXC 138 11","2.1.8"},
       {mochiweb,"MochiMedia Web Server","1.3"},
       {inets,"INETS  CXC 138 49","5.2"},
       {rabbithub,"rabbithub","0.0.0"},
       {crypto,"CRYPTO version 1","1.6.3"},
       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.0.0"},
       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
       {stdlib,"ERTS  CXC 138 10","1.16.4"},
       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
  {nodes,[{disc,[rabbit at satay]}]},
  {running_nodes,[rabbit at satay]}]
...done.

So the rabbithub and mochiweb modules are there.

8) But access to http://localhost:8000 was not possible

Any idea what I did wrong?

Thanks for ideas / help :-)

Cheers,

Oli










[1] http://www.rabbitmq.com/plugin-development.html#getting-started

From abhishek.kona at gmail.com  Mon Sep 20 06:18:09 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Mon, 20 Sep 2010 10:48:09 +0530
Subject: [rabbitmq-discuss] Best way to have default queues and exchanges
Message-ID: <4C96EE91.8050005@gmail.com>

  Hi

We are using RabbitMQ on EC2 machines. Each time we bring up an EC2 
instance with RabbitMQ we need to have certain exchanges and queues 
available on the instance.

The way we currently do it is writing a python Client code which creates 
these instances, but this requires the instance to have the Python AMQP 
library installed.

Is there a better way in which I can define the exchanges and queues to 
exist on a RabbitMQ server on installation.
Or is there a way in which I can create these exchanges and queues 
without having to install any libraries (If possible using shell script)

Abhishek Kona



From Alister.Morton at tradition.com  Mon Sep 20 09:52:31 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 20 Sep 2010 09:52:31 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910695D8881168@SVR-2K3-BH-EMC.tradition.int>

You can browse the mailing list at
<http://groups.google.com/group/rabbitmq-discuss>, and through various
other mailing list to web gateways.  What makes this arrangement
terrible for you?  Not being able to post through them, or something
else?

I don't know about others, but I find the flat format of these mail to web interfaces really stone age compared to the proper threaded interfaces available (newsgroups can definitely be properly threaded). Compared with something like cix or even howwl unthreaded interfaces are primitive and don't make following conversations particularly easy.


The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From david at rabbitmq.com  Mon Sep 20 10:21:20 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 20 Sep 2010 10:21:20 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <5A46D132C446C04B9EFE8AD14E78910695D8881168@SVR-2K3-BH-EMC.tradition.int>
	(Alister Morton's message of "Mon, 20 Sep 2010 09:52:31 +0100")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cvd63dazx.fsf@dwragg.eng.vmware.com>
	<5A46D132C446C04B9EFE8AD14E78910695D8881168@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <yrv4c4odkpy7j.fsf@dwragg.eng.vmware.com>

Alister Morton <Alister.Morton at tradition.com> writes:
> I don't know about others, but I find the flat format of these mail to
> web interfaces really stone age compared to the proper threaded
> interfaces available (newsgroups can definitely be properly
> threaded). Compared with something like cix or even howwl unthreaded
> interfaces are primitive and don't make following conversations
> particularly easy.

In Google Groups defence, it does have a passable threaded view.  But
you have to click on "View All" (and then sometimes fiddle with the view
options?) to get to it.

(The threaded view is one of the few remaining hints of Google Group's
origins as the Deja News web-based usenet service.  But those origins
get further obscured with every revamp.)

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From rabbit at subscribed.udmvt.ru  Mon Sep 20 10:25:52 2010
From: rabbit at subscribed.udmvt.ru (rabbit at subscribed.udmvt.ru)
Date: Mon, 20 Sep 2010 13:25:52 +0400
Subject: [rabbitmq-discuss] Clustering and ordering, please explain
In-Reply-To: <yrv4c4odqqand.fsf@dwragg.eng.vmware.com>
References: <20100916075717.GG8187@ruber.office.udmvt.ru>
	<yrv4c4odqqand.fsf@dwragg.eng.vmware.com>
Message-ID: <20100920092552.GD3372@ruber.office.udmvt.ru>

On Thu, Sep 16, 2010 at 10:51:18AM +0100, David Wragg wrote:
> > But the question is: what if two boxes, A and B, each have published a
> > message to the same exchange at the same moment in time, is it true,
> > that there is no ordering guaranties when that messages gets delivered
> > to queues across nodes? Is it true, that different queues may deliver
> > two messages in different order, despite they had been published on
> > the same exchange?
> 
> AMQP does not guarantee the order of messages in this case anyway, so
> even without clustering, it would be ok for rabbit to route the messages
> to queues bound to the same exchange in different orders.
> 
> The ordering guarantees of AMQP 0-9-1 are covered in section 4.7 of the
> specification PDF (available at
> <http://www.amqp.org/confluence/display/AMQP/AMQP+Specification>:
> 
>    [...] Specifically, contents flowing through a single path within the
>    server will remain ordered. For contents of a given priority flowing
>    through a single path, we define a content processing path as
>    consisting of one incoming channel, one exchange, one queue, and one
>    outgoing channel. [...]
> 
> So if you have two queues, you are dealing with two different content
> processing paths, and the order that messages arrive in the two queues
> does not have to be consistent.
That means, that I cannot use rabbitmq cluster as a cheapo replacement for
a high-availability distributed event serializer with no single point of failure :(

> 
> The relaxed nature of this ordering guarantee may surprise people.  It
> surprised me.
> 
> David
Thanks for the answer!

And thanks for that great piece of software I am using.

-- 
Alexey

From mikeb at rabbitmq.com  Mon Sep 20 10:27:22 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 20 Sep 2010 10:27:22 +0100
Subject: [rabbitmq-discuss] RabbitHub installation problem
In-Reply-To: <4C96E01C.3010502@smart.mit.edu>
References: <4C96E01C.3010502@smart.mit.edu>
Message-ID: <4C9728FA.5020403@rabbitmq.com>

Oliver,

> I just tried setting up RabbitHub under RabbitMQ 2.1.0. I managed to 
> compile it but the installation does not seem to work. Here is what I did:
> 1) Downloaded and compiled the umbrella project (according to [1])
> 2) Downloaded the source of RabbitHub and compiled it
> 3) That leaves me with a 'dist' folder with the following contents
>       rabbithub (folder)
>       amqp_client.ez
>       mochiweb.ez
>       rabbit_common.ez
>       rabbithub.ez
> 4) I then copied all of the above to the plugins directory of my
>    RabbitMQ installation. Was that the right thing to do?

No, but it's perfectly understandable that you thought so. 
rabbit_common is needed for compilation but not for running; it's a 
fault of the plugin build scripts that it ends up in dist/.

> 5) Tried to start RabbitMQ but got this error message:
>       [...]
>       Duplicated modules:
>          supervisor2 specified in rabbit and rabbit_common
>          ...
>          gen_server2 specified in rabbit and rabbit_common
> 6) So I removed the rabbit_common.ez file from the plugins directory
>    and restarted.

(That's the correct solution.)

> 7) Then the server could be started and the following output was
>    generated by rabbitmqctl status:
> Status of node rabbit at satay ...
> [{running_applications,
>      [{amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>       {rabbit,"RabbitMQ","2.1.0"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {mochiweb,"MochiMedia Web Server","1.3"},
>       {inets,"INETS  CXC 138 49","5.2"},
>       {rabbithub,"rabbithub","0.0.0"},
>       {crypto,"CRYPTO version 1","1.6.3"},
>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.0.0"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {nodes,[{disc,[rabbit at satay]}]},
>  {running_nodes,[rabbit at satay]}]
> ...done.
> 
> So the rabbithub and mochiweb modules are there.

Yep, that looks good to me too.

> 8) But access to http://localhost:8000 was not possible

RabbitHub now runs as a context in rabbit_mochiweb; this is by default 
on e.g., http://localhost:55672/, and RabbitHub specifically on 
http://localhost:55672/rabbithub (though you will generally want a URL 
specific to an exchange or queue).

HTH
Michael


From oliver.senn at smart.mit.edu  Mon Sep 20 10:37:36 2010
From: oliver.senn at smart.mit.edu (Oliver Senn)
Date: Mon, 20 Sep 2010 17:37:36 +0800
Subject: [rabbitmq-discuss] RabbitHub installation problem
In-Reply-To: <4C9728FA.5020403@rabbitmq.com>
References: <4C96E01C.3010502@smart.mit.edu> <4C9728FA.5020403@rabbitmq.com>
Message-ID: <4C972B60.7010509@smart.mit.edu>

Hi Michael,

Thank you for the info. Everything was actually working fine!

Best,
Oliver

Michael Bridgen wrote:
> Oliver,
> 
> [...]
> RabbitHub now runs as a context in rabbit_mochiweb; this is by default 
> on e.g., http://localhost:55672/, and RabbitHub specifically on 
> http://localhost:55672/rabbithub (though you will generally want a URL 
> specific to an exchange or queue).
> 
> HTH
> Michael
> 
> .

From rafif at lookoutmobile.com  Mon Sep 20 10:51:37 2010
From: rafif at lookoutmobile.com (Rafif Yalda)
Date: Mon, 20 Sep 2010 19:51:37 +1000
Subject: [rabbitmq-discuss] Management plugin preview release
Message-ID: <72D2D5B1-1372-493F-A087-34B1847DDCBE@lookoutmobile.com>

Hi Simon,

Thanks for your hard work, this plugin looks really promising. Unfortunately I can't seem to get it going. rabbitmq-status is working fine, but /api/ results in nothing :(

$ curl -i http://exampledomain.com:89/api/
curl: (52) Empty reply from server

I am using haproxy to avoid our provider's firewall, but even if I turn it off and access 55672 on the machine locally, I get the same output. I disabled rabbitmq-status but that didn't help either.

http://exampledomain.com:89/mgmt/ loads in the browser but since it's using the API, it's unusable atm.

- Ubuntu 9.04
- Erlang R14B
- rabbitmq-server v.2.1.0

Could this be a due to my version of rabbitmq-erlang-client (or any other dep)?

Regards, 
Rafif Yalda

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100920/48417f80/attachment.htm>

From majek04 at gmail.com  Mon Sep 20 12:39:48 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 20 Sep 2010 12:39:48 +0100
Subject: [rabbitmq-discuss] Pika + Tornado
In-Reply-To: <AANLkTi=GDpV6MJBdfSD+riwiA8jKpqb4fAa_hrXTY7MW@mail.gmail.com>
References: <AANLkTi=GDpV6MJBdfSD+riwiA8jKpqb4fAa_hrXTY7MW@mail.gmail.com>
Message-ID: <AANLkTi=iY4x-Xwf0GETMQJ=Ri9LnejGsrKsaUEHEAgkP@mail.gmail.com>

That's a great news. I'll keep an eye on your work!

Do you have an example of how to use your pika fork with tornado?

Marek

On Wed, Sep 15, 2010 at 14:29, Gavin M. Roy <gmr at myyearbook.com> wrote:
> After spending a fair amount of time investigating previous work on what was
> done to support Pika from Tornado I decided I wanted something more native
> that supported all of the Pika functionality, was truly asynchronous and
> worked off of Tornado's IOLoop. ?The result is a new fork of pika
> at?http://github.com/gmr/pika.
> I am planning on to work with Tony G to try and get my changes cleaned up in
> a way that he'd like so that it can make it into the main pika branch but
> until then, I'll see about keeping my branch up to date with changes and
> working with the tornado adapter.
> To the user of pika my change adds pika.tornado_adapter.TornadoConnection
> which uses IOLoop cleanly without any blocking. ?Under the covers I move the
> _rpc function to work with callbacks and remove the drain_events dependency.
> I've not tested extensively but the original examples work unchanged. ?It
> could use some eyes on it to catch anything I may have missed.
> I hope it's of value to some of you who were after the same goal.
> Gavin

From david at rabbitmq.com  Mon Sep 20 13:14:37 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 20 Sep 2010 13:14:37 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	(Adam Nelson's message of "Fri, 17 Sep 2010 17:55:14 -0400")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
Message-ID: <yrv4cpqw8obma.fsf@dwragg.eng.vmware.com>

We are now mirroring all our public mercurial repositories to github:

http://github.com/rabbitmq/

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From rafif at lookoutmobile.com  Mon Sep 20 15:44:56 2010
From: rafif at lookoutmobile.com (Rafif Yalda)
Date: Tue, 21 Sep 2010 00:44:56 +1000
Subject: [rabbitmq-discuss] Management plugin preview release
Message-ID: <0389C650-D1D6-4D91-986D-908C908FBB10@lookoutmobile.com>

After more investigation I checked rabbit-sasl.log and found problems with the checked out version of rabbit-mochiweb. I cleared out all existing plugins and replaced them with the compiled 2.1.0 versions available at http://www.rabbitmq.com/plugins.html#rabbitmq-management and now everything's working.

Thanks again, I look forward to seeing how this evolves.

Regards, 
Rafif Yalda


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/c8f228bc/attachment.htm>

From icambron at gmail.com  Mon Sep 20 21:16:36 2010
From: icambron at gmail.com (Isaac Cambron)
Date: Mon, 20 Sep 2010 16:16:36 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <yrv4cpqw8obma.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4cpqw8obma.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=j8iSB+cVVyAb4RbSKWyzJfzKUwkTu2z+jcNAn@mail.gmail.com>

My two cents is that Mercurial is totally great, and the web client is fine
for one-off source browsing. Where github shines is turnkey collaboration;
it's no better at simple code sharing than anything else.

On Mon, Sep 20, 2010 at 8:14 AM, David Wragg <david at rabbitmq.com> wrote:

> We are now mirroring all our public mercurial repositories to github:
>
> http://github.com/rabbitmq/
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100920/97b2fd78/attachment.htm>

From shammi at arosys.com  Tue Sep 21 04:34:56 2010
From: shammi at arosys.com (cheepu)
Date: Mon, 20 Sep 2010 20:34:56 -0700 (PDT)
Subject: [rabbitmq-discuss]  Unable to break the loop!
Message-ID: <29758980.post@talk.nabble.com>


Hi,
Here my scenario is with the rabbitMQ:
I am getting two value from UI(Here i am getting manually)
Those value will be sent to rabbitMQ which produce those value.
Consumer will take both the value and add them and then put them in the
response queue.
>From response Queue I will get the answer and display them in the queue.

I am unable to return the value from the response queue.
How can I return the value so that I can display that in th UI.

Here is my Service class and RabbitMQConsumer class.(Consumer class is run
from out side)
thanks
http://old.nabble.com/file/p29758980/Service.java Service.java 
http://old.nabble.com/file/p29758980/RabbitMQConsumer.java
RabbitMQConsumer.java 
-- 
View this message in context: http://old.nabble.com/Unable-to-break-the-loop%21-tp29758980p29758980.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From romary.kremer at gmail.com  Tue Sep 21 08:03:18 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Tue, 21 Sep 2010 09:03:18 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <4C9330CA.6090800@rabbitmq.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>	<4C92295E.9010300@rabbitmq.com>
	<5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>
	<4C9330CA.6090800@rabbitmq.com>
Message-ID: <2A9BDBE0-F31E-407D-8AFE-2EAB42D1A8C6@gmail.com>


Hi Emile, thanks for the supports and the suggestions.

Le 17 sept. 10 ? 11:11, Emile Joubert a ?crit :

>
> Hi Romary,
>
> On 16/09/10 16:38, romary.kremer at gmail.com wrote:
>>
>> Le 16 sept. 10 ? 16:27, Emile Joubert a ?crit :
>>
>>>
>>> Hi Romary,
>>>
>>> On 16/09/10 14:54, romary.kremer at gmail.com wrote:
>>>> Well, I' ve done another run with the whole upgraded configuration
>>>> - RabbitMQ version 2.1.0
>>>> - Erlang R14B (version 5.8.1)
>>>> - No SSL connections (but SSL listener still active on the  
>>>> broker, not
>>>> used)
>>>>
>>>> The memory_high_watermark is set to 0.8, 80% equivalent to 1609  
>>>> MB !
>>>
>>> That is too high. It is not advised to set the highwater mark  
>>> above 50%.
>>> Can you reproduce the problem while the vm_memory_high_watermark  
>>> is set
>>> to 0.4 ?
>>
>> Since we started to investigate on RabbitMQ, we started (with version
>> 1.7.2) we have never been able to successfully open
>> 10 000 SSL connection with a watermark less that 0.8 (1609 MB) !
>
> If you need to set the highwater mark above 50% then it means your
> server should have more RAM. Are you able to execute the test on a
> server with 4Gb or more?
>
>> The fact is that with 1.7.2 and 1.8.x  we successfully managed to  
>> accept
>> 10 000 connections, without SSL, with the default watermark of 0.4
>> Let me get back into the past to persent the history :
>>    - we started with default setting of rabbitMQ 1.7.2, with a  
>> version
>> that does not use  SSL. It works fine.
>>
>>    - Then our requirements evolved, and we decided that peers must
>> authenticate the borker upon connection, so we started to  
>> investigate on
>> the use of SSL.
>>
>>    - From that point, we could not manage a successful run unless we
>> increase the watermark up to 0.8.
>>
>>    - Now we upgrade to version 2.x.x of RabbitMQ and we realize that
>> the application that used to work on 1.8.0, with SSL no longer work  
>> on
>> the 2.0.0, neither on 2.1.0.
>>
>>    - That's why we decided to run the same test, disabling the SSL
>> authentication, and the same issues happens again either on 2.0.0  
>> or 2.1.0.
>>
>>>
>>>> I've monitored with rabbit_status, even someone had advised not  
>>>> to while
>>>> benchmarking (why not ?)
>>>
>>> rabbitmqctl or rabbit_status are invaluable for debugging the kind  
>>> of
>>> problem you are reporting. Continuous use incurs a small performance
>>> penalty and can prevent quiescent resources from hibernating.
>>
>> Then what would you recommend us for monitoring the broker a bit less
>> intrusively ?
>
> I *would* recommend using rabbitmqctl.
>
>> Actually, in our environment, we have settled a set of tool to  
>> monitor
>> the CPU load and the overall memory of the rabbitMQ erlang process.  
>> For
>> that we use the UNIX built in tools
>> such as sar, netstat, and ps with option to see the memory occupied.
>>
>> We also monitor the queue depth by invoking rabbitmq_ctl list_queues,
>> but the problem occurs also whit that monitoring turned OFF !!
>>
>> After a test, we are able to built some graphics displaying the
>> different statistics monitored.
>> If you want, I can send you extract of these reports so you will have
>> better overview on how the broker behave during tests.
>>
>> Just to have a look, I join you the following snapshots :
>>
>> - S0_withSSL_withQueueMonitoring : shows the broker behaviour while
>> trying to connect 10 000 peers, with SSL
>>
>> - S0_noSSL_withQueueMonitoring : shows the broker behaviour while  
>> trying
>> to connect 10 000 peers wihtout SSL
>>
>> - S0_noSSL_noQueueMonitoring : shows the broker behaviour while  
>> trying
>> to connect 10 000 peers without SSL, and without periodic call to
>> rabbitmqctl list_queues
>
> These graphs show that you create the connections at a fast rate. Do  
> you
> get the same failure if you create connections at a lower rate?

We have a ramp up scenario to evaluate the kind of thing you're  
thinking of. the same
crashes occurs the same way about 4000 connections established.

>
>>>> The memory available raised the threshold before the end of  
>>>> connections
>>>> of 10 000 peers.
>>>>
>>>> Maybe the average memory occupied by a single, non SSL connection  
>>>> has
>>>> somehow get bigger between
>>>> release 1.8.x and 2.x.x ??
>>>
>>> The data structures have changed from 1.8.1 to 2.0.0, but I don't  
>>> think
>>> that is the cause of the problem.
>>>
>>>> Does anybody has experiment or knows the impact of the new  
>>>> release on
>>>> the memory occupied by connections ?
>
> It is possible that more memory is required per connection, If using a
> large number of connections caused your RAM budget to be approached in
> versions prior to 2.0.0 then you may now exceed it.
>
>>>> I insist in the fact that, in our environment, we can toggle SSL
>>>> authentication of the broker by peers, but we always
>>>> keep the SSL listener running on the broker. The peer just  
>>>> "decide" to
>>>> connect either on 5672 or 5671. In the later,
>>>> SSL authentication will be enable, in the former, it won't !
>>>>
>>>> Thanks for any other idea we can follow, because we are facing a  
>>>> bit of
>>>> a dead end since we upgraded to 2.x.x !
>>>
>>> I'm surprised that the logfile you posted previously stops after  
>>> opening
>>> ssl and tcp listeners. I would expect to see evidence of 4000+  
>>> clients
>>> connecting.
>>
>> Yes sorry for that, but it indeed contains those line for connection
>> accepted / started, but noting interesting after that. Basically we  
>> jump
>> from a series of connection started
>> to a series of connection stopped, without no other warning, nor  
>> error,
>> until the end of the log file.
>
> That is very strange. I would expect to see evidence of the server
> running out of memory.
>
>>> Are you able to get output from "rabbitmqctl list_connections"  
>>> before
>>> the broker becomes unresponsive? What is the status of the beam or
>>> beam.smp process at that point - is it still running? How much  
>>> memory
>>> and CPU is it consuming?
>>
>> Those information can be gathered by our own "monitoring framework"  
>> as
>> explained above. But as you said just before, the rabbitmq_ctl may be
>> too intrusive, we use netstat to list the
>> established connection on the port 5672 (5671 if SSL is turned ON).
>
> rabbitmqctl does incur a small performance penalty if run continuously
> and it may then prevent unused resources from hibernating. However it
> was designed precisely to investigate the kind of problem you are
> experiencing.

I have double checked that the same issue happens,even with no  
monitoring
with rabbitmqctl.

>
> Can you confirm whether the beam or beam.smp process is running after
> the test failed?
>
>
>
> Regards
>
> Emile

We are a bit of worry considering that all the propositions we get to  
fix this issue are
related to give the broker more memory, while we thought the purpose  
of the 2.x.x
was to allow the broker to rely more on disk. Moreover, we are  
wondering what have
caused a connection to be so greedy that we can no longer establish 10  
000 on the same
configuration.

Since we do not have a 4GB server available to run the same tests,  
and, as we have quite
short dead line to set up a field test, we are considering to get back  
using the rabbitMQ release 1.8.1,
with Erlang R14B, hopping that this would be the winning combinaison.

Best regards,

Romary.

From romary.kremer at gmail.com  Tue Sep 21 08:03:18 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Tue, 21 Sep 2010 09:03:18 +0200
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <4C9330CA.6090800@rabbitmq.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>	<4C92295E.9010300@rabbitmq.com>
	<5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>
	<4C9330CA.6090800@rabbitmq.com>
Message-ID: <2A9BDBE0-F31E-407D-8AFE-2EAB42D1A8C6@gmail.com>


Hi Emile, thanks for the supports and the suggestions.

Le 17 sept. 10 ? 11:11, Emile Joubert a ?crit :

>
> Hi Romary,
>
> On 16/09/10 16:38, romary.kremer at gmail.com wrote:
>>
>> Le 16 sept. 10 ? 16:27, Emile Joubert a ?crit :
>>
>>>
>>> Hi Romary,
>>>
>>> On 16/09/10 14:54, romary.kremer at gmail.com wrote:
>>>> Well, I' ve done another run with the whole upgraded configuration
>>>> - RabbitMQ version 2.1.0
>>>> - Erlang R14B (version 5.8.1)
>>>> - No SSL connections (but SSL listener still active on the  
>>>> broker, not
>>>> used)
>>>>
>>>> The memory_high_watermark is set to 0.8, 80% equivalent to 1609  
>>>> MB !
>>>
>>> That is too high. It is not advised to set the highwater mark  
>>> above 50%.
>>> Can you reproduce the problem while the vm_memory_high_watermark  
>>> is set
>>> to 0.4 ?
>>
>> Since we started to investigate on RabbitMQ, we started (with version
>> 1.7.2) we have never been able to successfully open
>> 10 000 SSL connection with a watermark less that 0.8 (1609 MB) !
>
> If you need to set the highwater mark above 50% then it means your
> server should have more RAM. Are you able to execute the test on a
> server with 4Gb or more?
>
>> The fact is that with 1.7.2 and 1.8.x  we successfully managed to  
>> accept
>> 10 000 connections, without SSL, with the default watermark of 0.4
>> Let me get back into the past to persent the history :
>>    - we started with default setting of rabbitMQ 1.7.2, with a  
>> version
>> that does not use  SSL. It works fine.
>>
>>    - Then our requirements evolved, and we decided that peers must
>> authenticate the borker upon connection, so we started to  
>> investigate on
>> the use of SSL.
>>
>>    - From that point, we could not manage a successful run unless we
>> increase the watermark up to 0.8.
>>
>>    - Now we upgrade to version 2.x.x of RabbitMQ and we realize that
>> the application that used to work on 1.8.0, with SSL no longer work  
>> on
>> the 2.0.0, neither on 2.1.0.
>>
>>    - That's why we decided to run the same test, disabling the SSL
>> authentication, and the same issues happens again either on 2.0.0  
>> or 2.1.0.
>>
>>>
>>>> I've monitored with rabbit_status, even someone had advised not  
>>>> to while
>>>> benchmarking (why not ?)
>>>
>>> rabbitmqctl or rabbit_status are invaluable for debugging the kind  
>>> of
>>> problem you are reporting. Continuous use incurs a small performance
>>> penalty and can prevent quiescent resources from hibernating.
>>
>> Then what would you recommend us for monitoring the broker a bit less
>> intrusively ?
>
> I *would* recommend using rabbitmqctl.
>
>> Actually, in our environment, we have settled a set of tool to  
>> monitor
>> the CPU load and the overall memory of the rabbitMQ erlang process.  
>> For
>> that we use the UNIX built in tools
>> such as sar, netstat, and ps with option to see the memory occupied.
>>
>> We also monitor the queue depth by invoking rabbitmq_ctl list_queues,
>> but the problem occurs also whit that monitoring turned OFF !!
>>
>> After a test, we are able to built some graphics displaying the
>> different statistics monitored.
>> If you want, I can send you extract of these reports so you will have
>> better overview on how the broker behave during tests.
>>
>> Just to have a look, I join you the following snapshots :
>>
>> - S0_withSSL_withQueueMonitoring : shows the broker behaviour while
>> trying to connect 10 000 peers, with SSL
>>
>> - S0_noSSL_withQueueMonitoring : shows the broker behaviour while  
>> trying
>> to connect 10 000 peers wihtout SSL
>>
>> - S0_noSSL_noQueueMonitoring : shows the broker behaviour while  
>> trying
>> to connect 10 000 peers without SSL, and without periodic call to
>> rabbitmqctl list_queues
>
> These graphs show that you create the connections at a fast rate. Do  
> you
> get the same failure if you create connections at a lower rate?

We have a ramp up scenario to evaluate the kind of thing you're  
thinking of. the same
crashes occurs the same way about 4000 connections established.

>
>>>> The memory available raised the threshold before the end of  
>>>> connections
>>>> of 10 000 peers.
>>>>
>>>> Maybe the average memory occupied by a single, non SSL connection  
>>>> has
>>>> somehow get bigger between
>>>> release 1.8.x and 2.x.x ??
>>>
>>> The data structures have changed from 1.8.1 to 2.0.0, but I don't  
>>> think
>>> that is the cause of the problem.
>>>
>>>> Does anybody has experiment or knows the impact of the new  
>>>> release on
>>>> the memory occupied by connections ?
>
> It is possible that more memory is required per connection, If using a
> large number of connections caused your RAM budget to be approached in
> versions prior to 2.0.0 then you may now exceed it.
>
>>>> I insist in the fact that, in our environment, we can toggle SSL
>>>> authentication of the broker by peers, but we always
>>>> keep the SSL listener running on the broker. The peer just  
>>>> "decide" to
>>>> connect either on 5672 or 5671. In the later,
>>>> SSL authentication will be enable, in the former, it won't !
>>>>
>>>> Thanks for any other idea we can follow, because we are facing a  
>>>> bit of
>>>> a dead end since we upgraded to 2.x.x !
>>>
>>> I'm surprised that the logfile you posted previously stops after  
>>> opening
>>> ssl and tcp listeners. I would expect to see evidence of 4000+  
>>> clients
>>> connecting.
>>
>> Yes sorry for that, but it indeed contains those line for connection
>> accepted / started, but noting interesting after that. Basically we  
>> jump
>> from a series of connection started
>> to a series of connection stopped, without no other warning, nor  
>> error,
>> until the end of the log file.
>
> That is very strange. I would expect to see evidence of the server
> running out of memory.
>
>>> Are you able to get output from "rabbitmqctl list_connections"  
>>> before
>>> the broker becomes unresponsive? What is the status of the beam or
>>> beam.smp process at that point - is it still running? How much  
>>> memory
>>> and CPU is it consuming?
>>
>> Those information can be gathered by our own "monitoring framework"  
>> as
>> explained above. But as you said just before, the rabbitmq_ctl may be
>> too intrusive, we use netstat to list the
>> established connection on the port 5672 (5671 if SSL is turned ON).
>
> rabbitmqctl does incur a small performance penalty if run continuously
> and it may then prevent unused resources from hibernating. However it
> was designed precisely to investigate the kind of problem you are
> experiencing.

I have double checked that the same issue happens,even with no  
monitoring
with rabbitmqctl.

>
> Can you confirm whether the beam or beam.smp process is running after
> the test failed?
>
>
>
> Regards
>
> Emile

We are a bit of worry considering that all the propositions we get to  
fix this issue are
related to give the broker more memory, while we thought the purpose  
of the 2.x.x
was to allow the broker to rely more on disk. Moreover, we are  
wondering what have
caused a connection to be so greedy that we can no longer establish 10  
000 on the same
configuration.

Since we do not have a 4GB server available to run the same tests,  
and, as we have quite
short dead line to set up a field test, we are considering to get back  
using the rabbitMQ release 1.8.1,
with Erlang R14B, hopping that this would be the winning combinaison.

Best regards,

Romary.

From emile at rabbitmq.com  Tue Sep 21 10:12:34 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Sep 2010 10:12:34 +0100
Subject: [rabbitmq-discuss] Erlang crashes reports
In-Reply-To: <2A9BDBE0-F31E-407D-8AFE-2EAB42D1A8C6@gmail.com>
References: <9CC136AE-3EB1-4222-85A9-67DDCA14899D@orange-ftgroup.com>	<4C9209BA.7030600@rabbitmq.com>	<19488F99-B178-493E-8846-989122D1A00C@gmail.com>	<4C92295E.9010300@rabbitmq.com>	<5F60E536-780F-442A-A8DD-A7FAE0B711FA@gmail.com>	<4C9330CA.6090800@rabbitmq.com>
	<2A9BDBE0-F31E-407D-8AFE-2EAB42D1A8C6@gmail.com>
Message-ID: <4C987702.5000408@rabbitmq.com>


Hi Romary,

On 21/09/10 08:03, romary.kremer at gmail.com wrote:
> Hi Emile, thanks for the supports and the suggestions.
> Le 17 sept. 10 ? 11:11, Emile Joubert a ?crit :
>> Hi Romary,
>> On 16/09/10 16:38, romary.kremer at gmail.com wrote:
>>> Le 16 sept. 10 ? 16:27, Emile Joubert a ?crit :
>>>> Hi Romary,
>>>> On 16/09/10 14:54, romary.kremer at gmail.com wrote:

[...]

>> These graphs show that you create the connections at a fast rate. Do you
>> get the same failure if you create connections at a lower rate?
> 
> We have a ramp up scenario to evaluate the kind of thing you're thinking
> of. the same
> crashes occurs the same way about 4000 connections established.

Ok, thanks for checking this.

>>>>> The memory available raised the threshold before the end of
>>>>> connections
>>>>> of 10 000 peers.
>>>>>
>>>>> Maybe the average memory occupied by a single, non SSL connection has
>>>>> somehow get bigger between
>>>>> release 1.8.x and 2.x.x ??
>>>>
>>>> The data structures have changed from 1.8.1 to 2.0.0, but I don't think
>>>> that is the cause of the problem.
>>>>
>>>>> Does anybody has experiment or knows the impact of the new release on
>>>>> the memory occupied by connections ?
>>
>> It is possible that more memory is required per connection, If using a
>> large number of connections caused your RAM budget to be approached in
>> versions prior to 2.0.0 then you may now exceed it.

I've tried to repeat your test of opening 10000 SSL connections from the
Java client, using rabbit version 2.1.0 and 1.8.1 . The Erlang VM (R14A)
memory consumption was no different: about 1Gb in both cases. The 1Gb
required is just to open the connections, without any queues or
exchanges being declared.

[...]

> We are a bit of worry considering that all the propositions we get to
> fix this issue are
> related to give the broker more memory, while we thought the purpose of
> the 2.x.x
> was to allow the broker to rely more on disk. Moreover, we are wondering
> what have
> caused a connection to be so greedy that we can no longer establish 10
> 000 on the same
> configuration.

The broker relies more on disk for storing messages. In your case the
persistence layer is less of an issue, because memory consumption is due
to connections rather than messages.

> Since we do not have a 4GB server available to run the same tests, and,
> as we have quite
> short dead line to set up a field test, we are considering to get back
> using the rabbitMQ release 1.8.1,
> with Erlang R14B, hopping that this would be the winning combinaison.

>From the information you provided so far it appears that insufficient
memory is the most probable cause of the problem. If you are forced to
set the highwater mark above 50% then you probably need more RAM, even
on older version of rabbit.

Some further things you can do to rule out alternative causes is to make
100% sure the rabbit logfile does not contain more information. The
establishment of 10000 connections will generate alot of entries which
you need to filter out. Is there anything that remains? You should also
check the OS log for entries around the time of the problem.

If a erl_crash.dump file was produced then it may be worth inspecting
with the crashdump_viewer (part of start_webtool), although I seldom
find this information to be of value.


Regards

-Emile

From michaelburns1 at gmail.com  Tue Sep 21 13:13:57 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Tue, 21 Sep 2010 13:13:57 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <20100918223406.GD16939@wellquite.org>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<20100918223406.GD16939@wellquite.org>
Message-ID: <AANLkTim6_srrRBO8qDwOHFHHPx7ZyBWqZpr+pA54Pqpb@mail.gmail.com>

Hi,

I've ran tcpdump on the consumer machine when the problem is occurring. The
Java process running the consumer has definitely gone. list_connections on
the broker shows there is still a connection:

The output of tcpdump:

11:55:15.277607 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
1777345129:1777345331, ack 955208465, win 33304, options [nop,nop,TS val
609354052 ecr 6381321], length 202
11:55:30.103223 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
3156241994:3156242015, ack 938385998, win 33304, options [nop,nop,TS val
609354200 ecr 6382341], length 21
11:56:19.384882 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:202, ack 1, win 33304, options [nop,nop,TS val 609354692 ecr 6381321],
length 202
11:56:34.208833 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:21, ack 1, win 33304, options [nop,nop,TS val 609354840 ecr 6382341],
length 21
11:57:23.489908 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:202, ack 1, win 33304, options [nop,nop,TS val 609355332 ecr 6381321],
length 202
11:57:38.313950 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:21, ack 1, win 33304, options [nop,nop,TS val 609355480 ecr 6382341],
length 21
11:58:27.594809 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:202, ack 1, win 33304, options [nop,nop,TS val 609355972 ecr 6381321],
length 202
11:58:42.417220 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:21, ack 1, win 33304, options [nop,nop,TS val 609356120 ecr 6382341],
length 21
11:59:31.693171 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:202, ack 1, win 33304, options [nop,nop,TS val 609356612 ecr 6381321],
length 202
11:59:46.516762 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:21, ack 1, win 33304, options [nop,nop,TS val 609356760 ecr 6382341],
length 21
12:00:35.791504 IP 192.168.2.64.59061 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [R.], seq 203,
ack 1, win 33304, length 0
12:00:50.614290 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [FP.], seq
0:21, ack 1, win 33304, options [nop,nop,TS val 609357400 ecr 6382341],
length 21
12:01:54.714736 IP 192.168.2.64.59048 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [R.], seq 22,
ack 1, win 33304, length 0
12:20:38.475816 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
1037575082:1037575118, ack 26733943, win 65535, options [nop,nop,TS val
115719776 ecr 11565352], length 36
12:20:38.475824 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
36:252, ack 1, win 65535, options [nop,nop,TS val 115719776 ecr 11565352],
length 216
12:20:38.476098 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
252:288, ack 1, win 65535, options [nop,nop,TS val 115719776 ecr 11565352],
length 36
12:20:38.476112 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
288:543, ack 1, win 65535, options [nop,nop,TS val 115719776 ecr 11565352],
length 255
12:20:38.494336 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [.], ack
14626648, win 65535, options [nop,nop,TS val 115719776 ecr 14886791], length
0
12:20:38.494473 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [.], ack 332,
win 65535, options [nop,nop,TS val 115719776 ecr 14886791], length 0
12:20:38.597240 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
0:21, ack 332, win 65535, options [nop,nop,TS val 115719777 ecr 14886791],
length 21
12:20:38.665082 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
21:42, ack 332, win 65535, options [nop,nop,TS val 115719777 ecr 14886911],
length 21
12:22:11.371665 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
543:579, ack 1, win 65535, options [nop,nop,TS val 115720704 ecr 14886791],
length 36
12:22:11.371673 IP 192.168.2.56.51686 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
579:834, ack 1, win 65535, options [nop,nop,TS val 115720704 ecr 14886791],
length 255
12:22:11.388416 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [.], ack 663,
win 65535, options [nop,nop,TS val 115720704 ecr 14979686], length 0
12:22:11.486539 IP 192.168.2.56.51683 >
ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp: Flags [P.], seq
42:63, ack 663, win 65535, options [nop,nop,TS val 115720705 ecr 14979686],
length 21

The consumer was shutdown at approx 11.50. More than an hour later I am
still seeing the connection on the broker.

Thanks,
Michael







On Sat, Sep 18, 2010 at 11:34 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Sep 16, 2010 at 09:01:17AM +0100, Michael Burns wrote:
> > I've noticed sometimes that there are extra connections hanging about on
> the
> > RabbitMQ broker (using rabbitmqctl  list_connections).
> > It's possible sometimes in our consumers that we are not always closing
> the
> > connection cleanly (sometimes people are simply killing their app rather
> > than shutting down cleanly).
> >
> > Could this somehow explain why we experience these delays?
>
> Yes. If the TCP socket is still alive then Rabbit will not believe the
> connection has died, and so will not make unacknowledged messages
> available to other consumers.
>
> It would seem that this is your problem. To ensure that the connection
> is promptly detected to be detached, you could either turn on AMQP
> heartbeats or TCP KeepAlive. Either should suffice.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/897868e7/attachment.htm>

From matthew at rabbitmq.com  Tue Sep 21 13:19:49 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Sep 2010 13:19:49 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <AANLkTim6_srrRBO8qDwOHFHHPx7ZyBWqZpr+pA54Pqpb@mail.gmail.com>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<20100918223406.GD16939@wellquite.org>
	<AANLkTim6_srrRBO8qDwOHFHHPx7ZyBWqZpr+pA54Pqpb@mail.gmail.com>
Message-ID: <20100921121949.GD21903@wellquite.org>

Hi,

On Tue, Sep 21, 2010 at 01:13:57PM +0100, Michael Burns wrote:
> I've ran tcpdump on the consumer machine when the problem is occurring. The
> Java process running the consumer has definitely gone. list_connections on
> the broker shows there is still a connection:

Ok. Have you tried turning on TCP KeepAlive or AMQP's Heartbeats?

Matthew

From michaelburns1 at gmail.com  Tue Sep 21 13:22:40 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Tue, 21 Sep 2010 13:22:40 +0100
Subject: [rabbitmq-discuss] Delay delivering messages
In-Reply-To: <20100921121949.GD21903@wellquite.org>
References: <AANLkTimzxjen4APb3HBYmYvpnSgnSBa9iWnHa52s2Z3E@mail.gmail.com>
	<20100903082934.GB2873@dakota.eng.vmware.com>
	<AANLkTi=x0NN_J5QeTghArtksCgvFGwagSTbK3yA3h7h_@mail.gmail.com>
	<20100903120234.GD2873@dakota.eng.vmware.com>
	<AANLkTinNFXk15ssN7vXaeCGSh19paENHbJjyOdRxePuE@mail.gmail.com>
	<20100908094647.GB2851@dakota.eng.vmware.com>
	<AANLkTin7ANf6kvYfgZ4dXFRhBHu616AzCMqxkYaeBknE@mail.gmail.com>
	<20100918223406.GD16939@wellquite.org>
	<AANLkTim6_srrRBO8qDwOHFHHPx7ZyBWqZpr+pA54Pqpb@mail.gmail.com>
	<20100921121949.GD21903@wellquite.org>
Message-ID: <AANLkTik6bVubSBi2VAxRssOV=ieEEk73nFXZ=ZEQzFoQ@mail.gmail.com>

>
> Ok. Have you tried turning on TCP KeepAlive or AMQP's Heartbeats?
>

No - not familiar with either of these; I'll have a read and see how to
configure.


>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/ca777c0b/attachment.htm>

From davegreggory at yahoo.com  Tue Sep 21 13:42:06 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 21 Sep 2010 08:42:06 -0400
Subject: [rabbitmq-discuss] Generally known configuration for open file
	descriptor limits
Message-ID: <6810F133-EE2D-47A1-9E7E-162EEBB2351A@yahoo.com>

What do you recommend setting the system wide and rabbitmq user's hard and soft limits for open file descriptors?

This is on a production RabbitMQ cluster (2 disk nodes). We currently have about 100 connections to the cluster (not necessarily balanced between nodes). Machines have 2.5 gb and RabbitMQ allocated about 993 MB for itself. Since the cluster is very low volume currently the a Rabbit node's memory usage stays around 30-50 MB. Consumers are pretty fast so there's hardly any messages waiting in queues. 

Rabbitmq user has the default hard/soft limit of 1024 currently. Given the above environment and adding a quite a bit of room to spare, what is a generally acceptable limit? 

Over the next 6 months to an year this will become a very high volume environment with lot of messages waiting in queues and probably over 1000 connections. When we scale up, what should watch for as an indication that we need to increase open file descriptor limits?

From davegreggory at yahoo.com  Tue Sep 21 13:50:51 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 21 Sep 2010 08:50:51 -0400
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <4C90D79E.5060704@rabbitmq.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
	<4C8FDCE4.6050209@rabbitmq.com>
	<629763.47711.qm@web111015.mail.gq1.yahoo.com>
	<4C90D79E.5060704@rabbitmq.com>
Message-ID: <6AD9DBF5-08F3-4BEA-A2AB-67AAE9DA6EBD@yahoo.com>

Thanks, Matthias. I appreciate your offer to help, believe me I do. If we had the environment we wish have (we're getting there... ), it'd be much easier to get you in. But I'm trying :)

I am curious as to what kind of access you need to the rabbitmq machines. Is it just sudo access to rabbitmq user or do you need root access? 



On Sep 15, 2010, at 10:26 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Dave,
> 
> On 14/09/10 22:23, Dave Greggory wrote:
>> I wish I could give you access, but it's easier said than done due to both
>> environment and security policies. I'm trying to get you access, but it'd be
>> hell of a lot easier if you can tell me what to look for (troubleshooting steps)
>> and all the data points (rabbitmq, erlang, linux kernel, VM) you need.
> 
> The decision tree is quite broad, unfortunately, so the fault finding needs to be interactive.
> 
> Btw, it turns out that Cal's problem is unrelated and has nothing to do with rabbit; it is most likely due to a bug in celery, amqplib or the app code.
> 
> 
> Regards,
> 
> Matthias.

From majek04 at gmail.com  Tue Sep 21 15:50:37 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 21 Sep 2010 15:50:37 +0100
Subject: [rabbitmq-discuss] Generally known configuration for open file
 descriptor limits
In-Reply-To: <6810F133-EE2D-47A1-9E7E-162EEBB2351A@yahoo.com>
References: <6810F133-EE2D-47A1-9E7E-162EEBB2351A@yahoo.com>
Message-ID: <AANLkTikWa4-tWvSHJWvjtybB5Hv8W9W4hvt6MO00J6j=@mail.gmail.com>

Dave,

You definitely need more file descriptors than number of connections.

As a rule of thumb I'd suggest:
 - 1 file descriptor for every connection
 - 3+ file descriptors for every queue that might be written to disk
 - reserve about 100 descriptors for internal erlang stuff

There isn't any penalty from setting high 'ulimit -n', so why not just
set it to maximum?

On linux:
cat /proc/sys/fs/file-max
ulimit -n 1048576

On Tue, Sep 21, 2010 at 13:42, Dave Greggory <davegreggory at yahoo.com> wrote:
> What do you recommend setting the system wide and rabbitmq user's hard and soft limits for open file descriptors?
>
> This is on a production RabbitMQ cluster (2 disk nodes). We currently have about 100 connections to the cluster (not necessarily balanced between nodes). Machines have 2.5 gb and RabbitMQ allocated about 993 MB for itself. Since the cluster is very low volume currently the a Rabbit node's memory usage stays around 30-50 MB. Consumers are pretty fast so there's hardly any messages waiting in queues.
>
> Rabbitmq user has the default hard/soft limit of 1024 currently. Given the above environment and adding a quite a bit of room to spare, what is a generally acceptable limit?
>
> Over the next 6 months to an year this will become a very high volume environment with lot of messages waiting in queues and probably over 1000 connections. When we scale up, what should watch for as an indication that we need to increase open file descriptor limits?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Tue Sep 21 15:57:36 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Sep 2010 15:57:36 +0100
Subject: [rabbitmq-discuss] Generally known configuration for open file
 descriptor limits
In-Reply-To: <AANLkTikWa4-tWvSHJWvjtybB5Hv8W9W4hvt6MO00J6j=@mail.gmail.com>
References: <6810F133-EE2D-47A1-9E7E-162EEBB2351A@yahoo.com>
	<AANLkTikWa4-tWvSHJWvjtybB5Hv8W9W4hvt6MO00J6j=@mail.gmail.com>
Message-ID: <20100921145736.GE21903@wellquite.org>

On Tue, Sep 21, 2010 at 03:50:37PM +0100, Marek Majkowski wrote:
> You definitely need more file descriptors than number of connections.
> 
> As a rule of thumb I'd suggest:
>  - 1 file descriptor for every connection
>  - 3+ file descriptors for every queue that might be written to disk

Err, that's actually a max of 1 per queue.

And that is a rule of thumb - there is no problem with running a million
queues off 1000 fds - rabbit will just cope as necessary, but you might
find performance is improved with additional fds.

If your ulimit is X, then the number of connections you'll be allowed to
open is (0.9*(X - 100))-2. Thus that should give you a minimum (via
rearrangement). More fds never hurt!

Matthew

From shaneman at adobe.com  Tue Sep 21 19:08:56 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Tue, 21 Sep 2010 11:08:56 -0700
Subject: [rabbitmq-discuss] HA and database schema changes
In-Reply-To: <4C90E6FE.1070502@rabbitmq.com>
References: <A1CB3D904533654CB64599397AC43ADE013D443ACEBD@NAMBX02.corp.adobe.com>
	<4C90E6FE.1070502@rabbitmq.com>
Message-ID: <A1CB3D904533654CB64599397AC43ADE013D444C5F36@NAMBX02.corp.adobe.com>

Thanks for the reply Vlad.  Is there any possible way to migrate the mnesia db or do live upgrades without bringing down a HA RabbitMQ cluster?
I'm looking specifically at the Pacemaker/Corosync/drdb HA RabbitMQ cluster configuration.

--Steve

From: Vlad Alexandru Ionescu [mailto:vlad at rabbitmq.com]
Sent: Wednesday, September 15, 2010 8:32 AM
To: Steve Haneman
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] HA and database schema changes


Hi Steve,

There is currently no easy way to migrate the database.

In general, it is advisable to use the same code which you first used to create the exchanges, queues etc. on the new version of Rabbit to reconstruct your setup.
In order to migrate messages, you would have to use the rabbitmq-shovel plugin, which would consume messages from the old broker and would publish them into the new one (you must come up with a sensible configuration, depending on you setup).

Hope that answers your question.

Rgds,
Vlad.



On 09/14/2010 09:28 PM, Steve Haneman wrote:
Hello,

I was looking over the release notes for "Release: RabbitMQ 2.0.0" and saw the following:

http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20100825/2c672695/attachment.txt

Upgrading
=========
The database schema and the format in which persistent messages are
stored have both changed since the last release (1.8.1). When
starting, the RabbitMQ server will detect the existence of an old
database and will move it to a backup location, before creating a
fresh, empty database, and will log a warning. If your RabbitMQ
installation contains important data then we recommend you contact
support at ... for assistance with the upgrade.

We are considering deploying a HA RabbitMQ cluster with Pacemaker and DRBD.  HA is very important for us.
If there is a database schema change in the future, specifically what is the process for the upgrade and how does it affect HA during the upgrade?
Also during the upgrade, how do we maintain durable exchanges and queues?

Thanks,
   Steve





_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/e512165c/attachment.htm>

From pdezwart at rubiconproject.com  Tue Sep 21 20:46:15 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 21 Sep 2010 12:46:15 -0700
Subject: [rabbitmq-discuss] Rabbitmq-c Help
In-Reply-To: <C8B91D32.FB42%pdezwart@rubiconproject.com>
Message-ID: <C8BE5997.FDB6%pdezwart@rubiconproject.com>

Hey guys,

Any help with this? Is there documentation somewhere I can use?

Thanks,
Pieter


On 9/17/10 1:27 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> Hey guys,
> 
> I need some help with rabbitmq-c. I inherited the PHP extension code base, so
> I am a little lost. I pulled in RabbitMQ 2.1, along with the tip of rabbitmq-c
> and rabbitmq-codegen. Everything compiles just fine, but when I try to
> instantiate a new connection in the PHP extension, I get:
> 
> localhost:~/src/pecl/amqp/trunk$ php -f tests/test.php
> Expected 0x000A000A method frame on channel 0, got frame on channel 19793
> 
> This is the stacktrace:
> #0  0x009f4416 in __kernel_vsyscall ()
> #1  0x00248d71 in raise (sig=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64
> #2  0x0024a64a in abort () at abort.c:92
> #3  0x00137640 in amqp_simple_wait_method (state=0xa1604c0,
> expected_channel=0, expected_method=655370, output=0xbfe31b20) at
> amqp_socket.c:243
> #4  0x001379fc in amqp_login_inner (state=0xa1604c0, vhost=0xa12d70c "/",
> channel_max=0, frame_max=131072, heartbeat=0,
> sasl_method=AMQP_SASL_METHOD_PLAIN) at amqp_socket.c:373
> #5  amqp_login (state=0xa1604c0, vhost=0xa12d70c "/", channel_max=0,
> frame_max=131072, heartbeat=0, sasl_method=AMQP_SASL_METHOD_PLAIN) at
> amqp_socket.c:463
> #6  0x00629b9f in zim_amqp_class___construct (ht=0, return_value=0xa12d0f0,
> return_value_ptr=0x0, this_ptr=0xa12d10c, return_value_used=0) at
> /home/pdezwart/src/pecl/amqp/trunk/amqp.c:413
> #7  0x0825fd39 in zend_do_fcall_common_helper_SPEC (execute_data=<value
> optimized out>) at /usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:316
> #8  0x0823676e in execute (op_array=0xa12d580) at
> /usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:107
> #9  0x0820ef36 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at
> /usr/src/debug/php-5.3.3/Zend/zend.c:1194
> #10 0x081b5ac6 in php_execute_script (primary_file=0xbfe34274) at
> /usr/src/debug/php-5.3.3/main/main.c:2260
> #11 0x0829f358 in main (argc=3, argv=0xbfe343b4) at
> /usr/src/debug/php-5.3.3/sapi/cli/php_cli.c:1192
> 
> These mean nothing to me... Help? =)
> 
> Pieter
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/7f28e59a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100921/7f28e59a/attachment-0001.png>

From davegreggory at yahoo.com  Tue Sep 21 22:14:30 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 21 Sep 2010 17:14:30 -0400
Subject: [rabbitmq-discuss] Generally known configuration for open file
	descriptor limits
In-Reply-To: <20100921145736.GE21903@wellquite.org>
References: <6810F133-EE2D-47A1-9E7E-162EEBB2351A@yahoo.com>
	<AANLkTikWa4-tWvSHJWvjtybB5Hv8W9W4hvt6MO00J6j=@mail.gmail.com>
	<20100921145736.GE21903@wellquite.org>
Message-ID: <63F093CD-2E37-4069-AF67-769EBBDE341F@yahoo.com>

Thanks, guys.


On Sep 21, 2010, at 10:57 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Tue, Sep 21, 2010 at 03:50:37PM +0100, Marek Majkowski wrote:
>> You definitely need more file descriptors than number of connections.
>> 
>> As a rule of thumb I'd suggest:
>> - 1 file descriptor for every connection
>> - 3+ file descriptors for every queue that might be written to disk
> 
> Err, that's actually a max of 1 per queue.
> 
> And that is a rule of thumb - there is no problem with running a million
> queues off 1000 fds - rabbit will just cope as necessary, but you might
> find performance is improved with additional fds.
> 
> If your ulimit is X, then the number of connections you'll be allowed to
> open is (0.9*(X - 100))-2. Thus that should give you a minimum (via
> rearrangement). More fds never hurt!
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Tue Sep 21 23:10:32 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 21 Sep 2010 23:10:32 +0100
Subject: [rabbitmq-discuss] Rabbitmq-c Help
In-Reply-To: <C8B91D32.FB42%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Fri, 17 Sep 2010 13:27:14 -0700")
References: <C8B91D32.FB42%pdezwart@rubiconproject.com>
Message-ID: <yrv4c8w2uoihz.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Sorry for the delay in responding.

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> I need some help with rabbitmq-c. I inherited the PHP extension code base,
> so I am a little lost. I pulled in RabbitMQ 2.1, along with the tip of
> rabbitmq-c and rabbitmq-codegen. Everything compiles just fine, but when I
> try to instantiate a new connection in the PHP extension, I get:
>
> localhost:~/src/pecl/amqp/trunk$ php -f tests/test.php
> Expected 0x000A000A method frame on channel 0, got frame on channel 19793
>
> This is the stacktrace:
> #0  0x009f4416 in __kernel_vsyscall ()
> #1  0x00248d71 in raise (sig=6) at
> ../nptl/sysdeps/unix/sysv/linux/raise.c:64
> #2  0x0024a64a in abort () at abort.c:92
> #3  0x00137640 in amqp_simple_wait_method (state=0xa1604c0,
> expected_channel=0, expected_method=655370, output=0xbfe31b20) at
> amqp_socket.c:243
> #4  0x001379fc in amqp_login_inner (state=0xa1604c0, vhost=0xa12d70c "/",
> channel_max=0, frame_max=131072, heartbeat=0,
> sasl_method=AMQP_SASL_METHOD_PLAIN) at amqp_socket.c:373

What's happening is that the C client is proposing a version of AMQP,
and the server is rejecting it.  I can't tell more that that, because
the C client doesn't handle this version mismatch situation well.

But the versions of rabbitmq-c, rabbitmq-codegen and rabbitmq-server you
describe all implement AMQP 0-9-1, so how that can be happening is a bit
of a mystery.

My guess is that you are actually pointing the current C client at an
old (pre-2.0) version of rabbitmq-server somehow.  Is that possible?
Please double check and let me know.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From erikseres at exosite.com  Wed Sep 22 08:42:46 2010
From: erikseres at exosite.com (Erik Seres)
Date: Wed, 22 Sep 2010 07:42:46 +0000 (UTC)
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
Message-ID: <loom.20100922T090432-103@post.gmane.org>

I have a few questions regarding the RabbitMQ Erlang client library...

1) The client now has layers of supervision built in. Apparently, however, the 
maximum restart count for the various supervisors is set to 0. This will prevent 
the supervisor from trying to restart its children in case of a crash. I have 
verified this to be the case by the following:
 - created a network type connection to the server,
 - opened 2 channels within that connection,
 - sent a non-normal exit signal to the newly opened channel process.

The channel process crashed, its supervisor propagated the exit signal to the 
other channel and finally, it shut down itself, too. The client has never 
started back up again.

Question: What would be the intended use case of a supervisor with MaxRetryCount 
set to 0?

2) There is a channels manager process sitting at the same level in the 
supervision tree as the supervisor that supervises the supervisors of the 
channels (and writer and framing channel). The channels manager process does not 
have any links to the channels it apparently is to manage.

Question: What is the intended purpose of the channels manager?

3) I am trying to figure out how the four layers of supervision is supposed to 
work and can't really wrap my head around it. The way I conceive it should work 
is something like this, from top down:
 - Layer 1: supervise the entire client library
 - Layer 2: one_for_all supervision per connection. That is, when the 
connection, main reader or writer dies, shutdown all channels within that 
connection, restart the connection and all previously open channels.
 - Layer 3: one_for_one supervision per channel. That is, when a channel dies, 
restart the channel only and not affect anything else.

Question: Is this the intended behavior or am I on the wrong track?

Thanks,
Erik


From spil.oss at gmail.com  Wed Sep 22 11:18:26 2010
From: spil.oss at gmail.com (Spil Oss)
Date: Wed, 22 Sep 2010 12:18:26 +0200
Subject: [rabbitmq-discuss] Addition to plugins documentation
Message-ID: <AANLkTimNA3iQVEyQSmUfBtBjPdXNK5iLG_eFccmcVxwb@mail.gmail.com>

Hi All,

Please add the windows prerequisite libeay to the plugins page or
Windows install instructions.

After a lot of work (on Windows 7 x64) the message:
Kernel pid terminated (application_controller)
({application_start_failure,crypto,{shutdown,{crypto_app,start,[normal,[]]}}})
finally dawned on me..... crypto....

The broker would start but any plugin that I wanted to install
required mochiweb and would make the broker fail to start with above
message.

A bit of googling then showed up libeay as a dependency. This lib is
all over the place but not in my SysWOW64 directory. After copying a
libeay32.dll to C:\Windows\SysWOW64 the broker would start.

Kind regards,

Spil.

From matthew at rabbitmq.com  Wed Sep 22 11:27:23 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Sep 2010 11:27:23 +0100
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
In-Reply-To: <loom.20100922T090432-103@post.gmane.org>
References: <loom.20100922T090432-103@post.gmane.org>
Message-ID: <20100922102722.GG24946@rabbitmq.com>

Hi Erik,

On Wed, Sep 22, 2010 at 07:42:46AM +0000, Erik Seres wrote:
> I have a few questions regarding the RabbitMQ Erlang client library...

Excellent. As you've probably noticed it is still very much experimental
and in a state of flux. Things should be calming down soon though, and
it might even become officially supported soon!

> 1) The client now has layers of supervision built in. Apparently, however, the 
> maximum restart count for the various supervisors is set to 0. This will prevent 
> the supervisor from trying to restart its children in case of a crash. I have 
> verified this to be the case by the following:
>  - created a network type connection to the server,
>  - opened 2 channels within that connection,
>  - sent a non-normal exit signal to the newly opened channel process.
> 
> The channel process crashed, its supervisor propagated the exit signal to the 
> other channel and finally, it shut down itself, too. The client has never 
> started back up again.
> 
> Question: What would be the intended use case of a supervisor with MaxRetryCount 
> set to 0?

This is a very common trick in our codebase and indeed further
requirements led us to introduce the "intrinsic" restart strategy in our
supervisor2 module.

In our view, one of the most important properties of supervisors is to
structure the relationship between different processes and lower
coupling. The fact that it can do restarting is almost irrelevant in
many cases.

In the case of the client, restarting the connection in the event of a
crash of some sort is a bizarre thing to do simply because it would be
_impossible_ to be sure that you've got the connection and all the
channels back to the same state. Channels themselves are stateful, but
the state is _not_ set at channel creation - e.g. channel.qos txn.select
basic.consume etc etc. Thus even if channel processes did restart, they
would not be able to get back to the same state they were last in.

It's not even reasonable to restart the connection: queues can be
declared with exclusive=true which means when the connection closes, for
whatever reason, the queues must be deleted. Of course, when the
connection is created, it has no idea what queues are going to be
declared this way, so if the connection gets automatically restarted, it
can't possibly get back to the same state.

All in all, this really means that there is just no way of hiding the
fact the connection / channels have died from the user of the client.
Also, AMQP is designed to pass errors back to the client by explicitly
forcing channels or even the connection to be closed. Obviously, if the
user has done something wrong, you would not want those events to be
silently papered over.

> 2) There is a channels manager process sitting at the same level in the 
> supervision tree as the supervisor that supervises the supervisors of the 
> channels (and writer and framing channel). The channels manager process does not 
> have any links to the channels it apparently is to manage.

I think you're on the wrong branch - that sounds a lot like branch
bug23024 which is not through QA yet. Please make sure you're using the
default branch.

> Question: What is the intended purpose of the channels manager?

Basically, channel number allocation and mapping from channel number <->
Pid. Also, don't worry about the lack of links - we use monitoring a lot
and rely on the supervisor hierarchy to tear down the world if something
really bad happens.

> 3) I am trying to figure out how the four layers of supervision is supposed to 
> work and can't really wrap my head around it. The way I conceive it should work 
> is something like this, from top down:
>  - Layer 1: supervise the entire client library
>  - Layer 2: one_for_all supervision per connection. That is, when the 
> connection, main reader or writer dies, shutdown all channels within that 
> connection, restart the connection and all previously open channels.
>  - Layer 3: one_for_one supervision per channel. That is, when a channel dies, 
> restart the channel only and not affect anything else.
> 
> Question: Is this the intended behavior or am I on the wrong track?

Well, no restarting will ever happen. This is by design. From the bug
that introduced this all, the diagram is roughly:

amqp_sup (amqp_sup) (simple-141-term) (Note, this isn't there yet!)
|
+--undefined (amqp_connection_sup) (one-for-all) *
   |
   +--connection (amqp_{network,direct}_connection) (i)
   |
   +--channels_manager (amqp_channels_manager) (i) (bug23024)
   |
   +--connection_type_sup (amqp_connection_specific_sup) (i) (def)
   |  |
   |  +--framing (rabbit_framing_channel) (i) (N)
   |  +--writer (rabbit_writer) (i) (N)
   |  +--main_reader (amqp_main_reader) (i) (N)
   |  +--rabbit_hearbeat_sender (rabbit_heartbeat) (i) (N) (def)
   |  +--rabbit_hearbeat_receiver (rabbit_heartbeat) (i) (N) (def)
   |  +--collector (rabbit_queue_collector) (i) (D)
   |
   +--channel_sup_sup (amqp_channel_sup_sup) (simple-141-kill)
      |
      +--undefined (amqp_channel_sup) (one-for-all) *
         |
         +--channel (amqp_channel) (i)
         +--framing (rabbit_framing_channel) (i) (N) (def)
         +--writer (rabbit_writer) (i) (N) (def)
         +--rabbit_channel (rabbit_channel) (t) (D)
         +--rabbit_limiter (rabbit_limiter) (t) (D) (def)

Legend:
(N) - only in the network case
(D) - only in the direct case
(i) - intrinsic
(t) - transient
(def) - started later on
* - multiple instances

Thus: a channel is itself multiple processes that sit under a
supervisor (amqp_channel_sup). You have many of these under a
channel_sup_sup, and you never care about any of them dying, which is
why channel_sup_sup is a simple-one-for-one (standard brutal kill).
Depending on the type of connection (network or direct), you need
different processes which is why we have the connection_type_sup which
is parameterised by the connection type.

That's about it really.

Matthew

From erikseres at exosite.com  Wed Sep 22 12:49:49 2010
From: erikseres at exosite.com (Erik Seres)
Date: Wed, 22 Sep 2010 11:49:49 +0000 (UTC)
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
References: <loom.20100922T090432-103@post.gmane.org>
	<20100922102722.GG24946@rabbitmq.com>
Message-ID: <loom.20100922T132427-860@post.gmane.org>

Matthew Sackman <matthew at ...> writes:

> 
> Hi Erik,
> 
> On Wed, Sep 22, 2010 at 07:42:46AM +0000, Erik Seres wrote:
> > I have a few questions regarding the RabbitMQ Erlang client library...
> 
> Excellent. As you've probably noticed it is still very much experimental
> and in a state of flux. Things should be calming down soon though, and
> it might even become officially supported soon!
> 
> > 1) The client now has layers of supervision built in. Apparently, however, 
the 
> > maximum restart count for the various supervisors is set to 0. This will 
prevent 
> > the supervisor from trying to restart its children in case of a crash. I 
have 
> > verified this to be the case by the following:
> >  - created a network type connection to the server,
> >  - opened 2 channels within that connection,
> >  - sent a non-normal exit signal to the newly opened channel process.
> > 
> > The channel process crashed, its supervisor propagated the exit signal to 
the 
> > other channel and finally, it shut down itself, too. The client has never 
> > started back up again.
> > 
> > Question: What would be the intended use case of a supervisor with 
MaxRetryCount 
> > set to 0?
> 
> This is a very common trick in our codebase and indeed further
> requirements led us to introduce the "intrinsic" restart strategy in our
> supervisor2 module.
> 
> In our view, one of the most important properties of supervisors is to
> structure the relationship between different processes and lower
> coupling. The fact that it can do restarting is almost irrelevant in
> many cases.
> 
> In the case of the client, restarting the connection in the event of a
> crash of some sort is a bizarre thing to do simply because it would be
> _impossible_ to be sure that you've got the connection and all the
> channels back to the same state. Channels themselves are stateful, but
> the state is _not_ set at channel creation - e.g. channel.qos txn.select
> basic.consume etc etc. Thus even if channel processes did restart, they
> would not be able to get back to the same state they were last in.
> 
> It's not even reasonable to restart the connection: queues can be
> declared with exclusive=true which means when the connection closes, for
> whatever reason, the queues must be deleted. Of course, when the
> connection is created, it has no idea what queues are going to be
> declared this way, so if the connection gets automatically restarted, it
> can't possibly get back to the same state.
> 
> All in all, this really means that there is just no way of hiding the
> fact the connection / channels have died from the user of the client.
> Also, AMQP is designed to pass errors back to the client by explicitly
> forcing channels or even the connection to be closed. Obviously, if the
> user has done something wrong, you would not want those events to be
> silently papered over.
> 
> > 2) There is a channels manager process sitting at the same level in the 
> > supervision tree as the supervisor that supervises the supervisors of the 
> > channels (and writer and framing channel). The channels manager process does 
not 
> > have any links to the channels it apparently is to manage.
> 
> I think you're on the wrong branch - that sounds a lot like branch
> bug23024 which is not through QA yet. Please make sure you're using the
> default branch.
> 
> > Question: What is the intended purpose of the channels manager?
> 
> Basically, channel number allocation and mapping from channel number <->
> Pid. Also, don't worry about the lack of links - we use monitoring a lot
> and rely on the supervisor hierarchy to tear down the world if something
> really bad happens.
> 
> > 3) I am trying to figure out how the four layers of supervision is supposed 
to 
> > work and can't really wrap my head around it. The way I conceive it should 
work 
> > is something like this, from top down:
> >  - Layer 1: supervise the entire client library
> >  - Layer 2: one_for_all supervision per connection. That is, when the 
> > connection, main reader or writer dies, shutdown all channels within that 
> > connection, restart the connection and all previously open channels.
> >  - Layer 3: one_for_one supervision per channel. That is, when a channel 
dies, 
> > restart the channel only and not affect anything else.
> > 
> > Question: Is this the intended behavior or am I on the wrong track?
> 
> Well, no restarting will ever happen. This is by design. From the bug
> that introduced this all, the diagram is roughly:
> 
> amqp_sup (amqp_sup) (simple-141-term) (Note, this isn't there yet!)
> |
> +--undefined (amqp_connection_sup) (one-for-all) *
>    |
>    +--connection (amqp_{network,direct}_connection) (i)
>    |
>    +--channels_manager (amqp_channels_manager) (i) (bug23024)
>    |
>    +--connection_type_sup (amqp_connection_specific_sup) (i) (def)
>    |  |
>    |  +--framing (rabbit_framing_channel) (i) (N)
>    |  +--writer (rabbit_writer) (i) (N)
>    |  +--main_reader (amqp_main_reader) (i) (N)
>    |  +--rabbit_hearbeat_sender (rabbit_heartbeat) (i) (N) (def)
>    |  +--rabbit_hearbeat_receiver (rabbit_heartbeat) (i) (N) (def)
>    |  +--collector (rabbit_queue_collector) (i) (D)
>    |
>    +--channel_sup_sup (amqp_channel_sup_sup) (simple-141-kill)
>       |
>       +--undefined (amqp_channel_sup) (one-for-all) *
>          |
>          +--channel (amqp_channel) (i)
>          +--framing (rabbit_framing_channel) (i) (N) (def)
>          +--writer (rabbit_writer) (i) (N) (def)
>          +--rabbit_channel (rabbit_channel) (t) (D)
>          +--rabbit_limiter (rabbit_limiter) (t) (D) (def)
> 
> Legend:
> (N) - only in the network case
> (D) - only in the direct case
> (i) - intrinsic
> (t) - transient
> (def) - started later on
> * - multiple instances
> 
> Thus: a channel is itself multiple processes that sit under a
> supervisor (amqp_channel_sup). You have many of these under a
> channel_sup_sup, and you never care about any of them dying, which is
> why channel_sup_sup is a simple-one-for-one (standard brutal kill).
> Depending on the type of connection (network or direct), you need
> different processes which is why we have the connection_type_sup which
> is parameterised by the connection type.
> 
> That's about it really.
> 
> Matthew
> 

Hi Matthew,

Thank you for the very quick and elaborate response. The concept of how you use 
supervisors to define hierarchy is interesting and now I understand why there is
no restart ever happening. In my case, I am not using transactions so the 
stateful nature of channels did not come to mind and I was not taking that into 
consideration.

I think I have one question regarding connections. So, you explain that an 
exclusive queue must be deleted when a connection closes. On that same note, 
however, how do you locate a durable queue after a connection had died (or had 
been closed) and then you reopened it? If one can locate a durable queue after a 
disconnect/connect, which my understanding is one must be able to, then why can 
one not locate an exclusive queue the same way? (Tell me if I just need to dive 
in the AMQP specs to understand this.)

In my application at startup, I will open a connection and then, each 
application process wanting to communicate over AMQP, will open a channel. The 
application will need to know if the amqp_client has crashed and the connection 
and channels have been lost. So, I thought I would add the process ID returned 
by amqp_connection:start(network, ...) to my supervision tree. This does not 
seem to work, though, as the connection PID never shows up under my application 
supervisor as a child. And, consequently, it never gets restarted in case of a 
crash. I have the "Type" in the ChildSpec set to 'supervisor' for this child. 
With that said, how should I go about detecting when/if the amqp client has 
crashed?

Also, what do you think is the expected time frame before this client library 
becomes officially supported?

Thanks for your help!
Erik




From matthew at rabbitmq.com  Wed Sep 22 13:00:59 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Sep 2010 13:00:59 +0100
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
In-Reply-To: <loom.20100922T132427-860@post.gmane.org>
References: <loom.20100922T090432-103@post.gmane.org>
	<20100922102722.GG24946@rabbitmq.com>
	<loom.20100922T132427-860@post.gmane.org>
Message-ID: <20100922120058.GJ24946@rabbitmq.com>

Hi Erik,

On Wed, Sep 22, 2010 at 11:49:49AM +0000, Erik Seres wrote:
> I think I have one question regarding connections. So, you explain that an 
> exclusive queue must be deleted when a connection closes. On that same note, 
> however, how do you locate a durable queue after a connection had died (or had 
> been closed) and then you reopened it? If one can locate a durable queue after a 
> disconnect/connect, which my understanding is one must be able to, then why can 
> one not locate an exclusive queue the same way? (Tell me if I just need to dive 
> in the AMQP specs to understand this.)

The details (but not content) of all queues are stored in mnesia, in
Rabbit. This means that when Rabbit restarts, we can check to find which
queues were durable and get them to be recreated. Non-durable queues
that we find on startup get nuked. Queues with exclusive owners record
the Pid of their owner. Thus at queue creation time (regardless of
whether it's rabbit startup or normal queue creation), we have the queue
monitor the pid of its owner. When the queue gets the DOWN message
(which may be immediately if the queue's being restarted), the queue
self-destructs.

The problem with restarting the connection then is that there is no way
to identify that the new connection is replacing the old: the Pid of the
connection will have changed, and you can't do it by user authentication
as there's nothing to stop the same username/password being used by many
connections concurrently. There is no session-id concept in AMQP which
is what prevents this sort of thing from being achievable.

> In my application at startup, I will open a connection and then, each 
> application process wanting to communicate over AMQP, will open a channel. The 
> application will need to know if the amqp_client has crashed and the connection 
> and channels have been lost. So, I thought I would add the process ID returned 
> by amqp_connection:start(network, ...) to my supervision tree. This does not 
> seem to work, though, as the connection PID never shows up under my application 
> supervisor as a child. And, consequently, it never gets restarted in case of a 
> crash. I have the "Type" in the ChildSpec set to 'supervisor' for this child. 
> With that said, how should I go about detecting when/if the amqp client has 
> crashed?

Just link directly to either the Pid of the connection or the Pid of the
channel. If either go down abnormally, it'll take out your process (and
vice versa - in fact, you may want to just monitor rather than link).

Also, the Pid you get back from amqp_connection:start/1 is _not_ the Pid of the
supervisor. It's the Pid of the amqp_{network,direct}_connection
process. The Pid of the connection_sup is never returned. Fairly soon,
the entire client will become a real application and then it will be
properly visible in things like appmon.

> Also, what do you think is the expected time frame before this client library 
> becomes officially supported?

Err, the really really pessimistic view is 3 months. So hopefully before
then.

Matthew

From erikseres at exosite.com  Wed Sep 22 15:43:16 2010
From: erikseres at exosite.com (Erik Seres)
Date: Wed, 22 Sep 2010 14:43:16 +0000 (UTC)
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
References: <loom.20100922T090432-103@post.gmane.org>
	<20100922102722.GG24946@rabbitmq.com>
	<loom.20100922T132427-860@post.gmane.org>
	<20100922120058.GJ24946@rabbitmq.com>
Message-ID: <loom.20100922T163603-466@post.gmane.org>

Matthew Sackman <matthew at ...> writes:

> Just link directly to either the Pid of the connection or the Pid of the
> channel. If either go down abnormally, it'll take out your process (and
> vice versa - in fact, you may want to just monitor rather than link).
> 
> Also, the Pid you get back from amqp_connection:start/1 is _not_ the Pid of 
the
> supervisor. It's the Pid of the amqp_{network,direct}_connection
> process. The Pid of the connection_sup is never returned. Fairly soon,
> the entire client will become a real application and then it will be
> properly visible in things like appmon.

Hi Matthew,

Ok, I understand all that. Linking to channel or connection works fine. Just out 
of curiosity, one last question... What stops me from being able to add the 
connection process to my supervisor child list? The process seems to be a 
gen_server so it should be ok to do that, right? Or, is it not possible because 
it is already on another supervisor's child list?

Thanks,
Erik



From matthew at rabbitmq.com  Wed Sep 22 15:48:10 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Sep 2010 15:48:10 +0100
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
In-Reply-To: <loom.20100922T163603-466@post.gmane.org>
References: <loom.20100922T090432-103@post.gmane.org>
	<20100922102722.GG24946@rabbitmq.com>
	<loom.20100922T132427-860@post.gmane.org>
	<20100922120058.GJ24946@rabbitmq.com>
	<loom.20100922T163603-466@post.gmane.org>
Message-ID: <20100922144810.GL24946@rabbitmq.com>

On Wed, Sep 22, 2010 at 02:43:16PM +0000, Erik Seres wrote:
> What stops me from being able to add the 
> connection process to my supervisor child list? The process seems to be a 
> gen_server so it should be ok to do that, right? Or, is it not possible because 
> it is already on another supervisor's child list?

A supervisor has to _start_ the process (the MFA invoked by the sup must
do return the pid of the child and must be linked to the child). If you
did a child spec which as the MFA did:

{ok, Pid} = amqp_connection:start(network, Params),
link(Pid),
{ok, Pid}

then I think that would work. The child spec would need to indicate the
child is a worker. It might then show up. I think. I might be wrong
though - I've never tried having a child supervised by two parents -
sounds a bit like incest to me.

Matthew

From erikseres at exosite.com  Wed Sep 22 16:03:23 2010
From: erikseres at exosite.com (Erik Seres)
Date: Wed, 22 Sep 2010 15:03:23 +0000 (UTC)
Subject: [rabbitmq-discuss] Rabbit Client Supervision Architecture
References: <loom.20100922T090432-103@post.gmane.org>
	<20100922102722.GG24946@rabbitmq.com>
	<loom.20100922T132427-860@post.gmane.org>
	<20100922120058.GJ24946@rabbitmq.com>
	<loom.20100922T163603-466@post.gmane.org>
	<20100922144810.GL24946@rabbitmq.com>
Message-ID: <loom.20100922T165719-266@post.gmane.org>

Matthew Sackman <matthew at ...> writes:

> {ok, Pid} = amqp_connection:start(network, Params),
> link(Pid),
> {ok, Pid}

Matthew,

Actually, that is what I had tried (had the supervisor start the process exactly
the way you show it above) and it did not work. So, I have come to the same 
conclusion that somehow the supervisors must be playing nicely behind the scenes 
and not grabbing each others' children.

Thanks,
Erik



From shaneman at adobe.com  Wed Sep 22 16:56:47 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Wed, 22 Sep 2010 08:56:47 -0700
Subject: [rabbitmq-discuss] HA and database schema changes
In-Reply-To: <4C90E6FE.1070502@rabbitmq.com>
References: <A1CB3D904533654CB64599397AC43ADE013D443ACEBD@NAMBX02.corp.adobe.com>
	<4C90E6FE.1070502@rabbitmq.com>
Message-ID: <A1CB3D904533654CB64599397AC43ADE013D444C623C@NAMBX02.corp.adobe.com>

Thanks for the reply Vlad.  Is there any possible way to migrate the mnesia db or do live upgrades without bringing down a HA RabbitMQ cluster?
I'm looking specifically at the Pacemaker/Corosync/drdb HA RabbitMQ cluster configuration.

--Steve


From: Vlad Alexandru Ionescu [mailto:vlad at rabbitmq.com]
Sent: Wednesday, September 15, 2010 8:32 AM
To: Steve Haneman
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] HA and database schema changes


Hi Steve,

There is currently no easy way to migrate the database.

In general, it is advisable to use the same code which you first used to create the exchanges, queues etc. on the new version of Rabbit to reconstruct your setup.
In order to migrate messages, you would have to use the rabbitmq-shovel plugin, which would consume messages from the old broker and would publish them into the new one (you must come up with a sensible configuration, depending on you setup).

Hope that answers your question.

Rgds,
Vlad.



On 09/14/2010 09:28 PM, Steve Haneman wrote:
Hello,

I was looking over the release notes for "Release: RabbitMQ 2.0.0" and saw the following:

http://lists.rabbitmq.com/pipermail/rabbitmq-announce/attachments/20100825/2c672695/attachment.txt

Upgrading
=========
The database schema and the format in which persistent messages are
stored have both changed since the last release (1.8.1). When
starting, the RabbitMQ server will detect the existence of an old
database and will move it to a backup location, before creating a
fresh, empty database, and will log a warning. If your RabbitMQ
installation contains important data then we recommend you contact
support at ... for assistance with the upgrade.

We are considering deploying a HA RabbitMQ cluster with Pacemaker and DRBD.  HA is very important for us.
If there is a database schema change in the future, specifically what is the process for the upgrade and how does it affect HA during the upgrade?
Also during the upgrade, how do we maintain durable exchanges and queues?

Thanks,
   Steve





_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100922/b938616d/attachment-0001.htm>

From pdezwart at rubiconproject.com  Wed Sep 22 20:33:42 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 22 Sep 2010 12:33:42 -0700
Subject: [rabbitmq-discuss] Rabbitmq-c Help
In-Reply-To: <yrv4c8w2uoihz.fsf@dwragg.eng.vmware.com>
Message-ID: <C8BFA826.FEE1%pdezwart@rubiconproject.com>

You diagnosis was absolutely correct. I wrongly assumed that the Fedora
repository contained the latest RabbitMQ server version, which it did not. I
am, however, at another impass. I have tweaked my code a little to work with
0-9-1, but I have run into a segfault in the rabbitmq-c client, which, lets
face it, is probably my doing.
The segfault occurs when I try to consume, with the following code:

    amqp_basic_consume_t s;
    s.ticket                = 0;
    s.queue.len                 = ctx->name_len;
    s.queue.bytes            = ctx->name;
    s.consumer_tag.len        = 0;
    s.consumer_tag.bytes    = NULL;
    s.no_local                = (AMQP_NOLOCAL & parms) ? 1 : 0;
    s.no_ack                = (AMQP_NOACK & parms) ? 1 : 0;
    s.exclusive                = (AMQP_EXCLUSIVE & parms) ? 1 : 0;
    s.nowait                = 0;

    amqp_method_number_t method_ok = AMQP_BASIC_CONSUME_OK_METHOD;
    res = (amqp_rpc_reply_t)amqp_simple_rpc(
        cnn->conn,
        AMQP_CHANNEL,
        AMQP_BASIC_CONSUME_METHOD,
        &method_ok,
        &s
    ); 

The backtrace is:

#0  0x00bbd416 in __kernel_vsyscall ()
#1  0x00248d71 in raise (sig=6) at
../nptl/sysdeps/unix/sysv/linux/raise.c:64
#2  0x0024a64a in abort () at abort.c:92
#3  0x0047ec9e in amqp_encode_field_value (encoded=..., entry=0x8864294,
offsetptr=0xbfca3a6c) at amqp_table.c:413
#4  0x0047f0c4 in amqp_encode_table (encoded=..., input=0xbfca3dcc,
offsetptr=0xbfca3ad8) at amqp_table.c:324
#5  0x004838a2 in amqp_encode_method (methodNumber=3932180,
decoded=0xbfca3da8, encoded=...) at amqp_framing.c:1357
#6  0x0047f98d in inner_send_frame (state=0x8897658, frame=0xbfca3bb4,
encoded=0xbfca3b80, payload_len=0xbfca3b88) at amqp_connection.c:367
#7  0x0047fabd in amqp_send_frame (state=0x8897658, frame=0xbfca3bb4) at
amqp_connection.c:427
#8  0x004806bb in amqp_send_method (state=0x8897658, channel=1, id=3932180,
decoded=0xbfca3da8) at amqp_socket.c:268
#9  0x00480729 in amqp_simple_rpc (state=0x8897658, channel=1,
request_id=3932180, expected_reply_ids=0xbfca3e00,
decoded_request_method=0xbfca3da8) at amqp_socket.c:291
#10 0x0014560d in zim_amqp_queue_class_consume (ht=1,
return_value=0x8865c44, return_value_ptr=0x0, this_ptr=0x886428c,
return_value_used=1) at /home/pdezwart/src/pecl/amqp/trunk/amqp.c:936
#11 0x0825fd39 in zend_do_fcall_common_helper_SPEC (execute_data=<value
optimized out>) at /usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:316
#12 0x0823676e in execute (op_array=0x8864738) at
/usr/src/debug/php-5.3.3/Zend/zend_vm_execute.h:107
#13 0x0820ef36 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at
/usr/src/debug/php-5.3.3/Zend/zend.c:1194
#14 0x081b5ac6 in php_execute_script (primary_file=0xbfca63c4) at
/usr/src/debug/php-5.3.3/main/main.c:2260
#15 0x0829f358 in main (argc=3, argv=0xbfca6504) at
/usr/src/debug/php-5.3.3/sapi/cli/php_cli.c:1192

Thoughts on what I am doing wrong? Is there a spec somewhere I can use? =)

Thanks,
me


On 9/21/10 3:10 PM, "David Wragg" <david at rabbitmq.com> wrote:

> Hi Pieter,
> 
> Sorry for the delay in responding.
> 
> Pieter de Zwart <pdezwart at rubiconproject.com> writes:
>> > I need some help with rabbitmq-c. I inherited the PHP extension code base,
>> > so I am a little lost. I pulled in RabbitMQ 2.1, along with the tip of
>> > rabbitmq-c and rabbitmq-codegen. Everything compiles just fine, but when I
>> > try to instantiate a new connection in the PHP extension, I get:
>> >
>> > localhost:~/src/pecl/amqp/trunk$ php -f tests/test.php
>> > Expected 0x000A000A method frame on channel 0, got frame on channel 19793
>> >
>> > This is the stacktrace:
>> > #0  0x009f4416 in __kernel_vsyscall ()
>> > #1  0x00248d71 in raise (sig=6) at
>> > ../nptl/sysdeps/unix/sysv/linux/raise.c:64
>> > #2  0x0024a64a in abort () at abort.c:92
>> > #3  0x00137640 in amqp_simple_wait_method (state=0xa1604c0,
>> > expected_channel=0, expected_method=655370, output=0xbfe31b20) at
>> > amqp_socket.c:243
>> > #4  0x001379fc in amqp_login_inner (state=0xa1604c0, vhost=0xa12d70c "/",
>> > channel_max=0, frame_max=131072, heartbeat=0,
>> > sasl_method=AMQP_SASL_METHOD_PLAIN) at amqp_socket.c:373
> 
> What's happening is that the C client is proposing a version of AMQP,
> and the server is rejecting it.  I can't tell more that that, because
> the C client doesn't handle this version mismatch situation well.
> 
> But the versions of rabbitmq-c, rabbitmq-codegen and rabbitmq-server you
> describe all implement AMQP 0-9-1, so how that can be happening is a bit
> of a mystery.
> 
> My guess is that you are actually pointing the current C client at an
> old (pre-2.0) version of rabbitmq-server somehow.  Is that possible?
> Please double check and let me know.
> 
> David
> 
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100922/1ff154bb/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100922/1ff154bb/attachment-0001.png>

From david at rabbitmq.com  Wed Sep 22 22:23:54 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 22 Sep 2010 22:23:54 +0100
Subject: [rabbitmq-discuss] Rabbitmq-c Help
In-Reply-To: <C8BFA826.FEE1%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Wed, 22 Sep 2010 12:33:42 -0700")
References: <C8BFA826.FEE1%pdezwart@rubiconproject.com>
Message-ID: <yrv4c1v8l5v6d.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> You diagnosis was absolutely correct. I wrongly assumed that the Fedora
> repository contained the latest RabbitMQ server version, which it did not. I
> am, however, at another impass. I have tweaked my code a little to work with
> 0-9-1, but I have run into a segfault in the rabbitmq-c client, which, lets
> face it, is probably my doing.
> The segfault occurs when I try to consume, with the following code:
>
>     amqp_basic_consume_t s;
>     s.ticket                = 0;
>     s.queue.len                 = ctx->name_len;
>     s.queue.bytes            = ctx->name;
>     s.consumer_tag.len        = 0;
>     s.consumer_tag.bytes    = NULL;
>     s.no_local                = (AMQP_NOLOCAL & parms) ? 1 : 0;
>     s.no_ack                = (AMQP_NOACK & parms) ? 1 : 0;
>     s.exclusive                = (AMQP_EXCLUSIVE & parms) ? 1 : 0;
>     s.nowait                = 0;
>
>     amqp_method_number_t method_ok = AMQP_BASIC_CONSUME_OK_METHOD;
>     res = (amqp_rpc_reply_t)amqp_simple_rpc(
>         cnn->conn,
>         AMQP_CHANNEL,
>         AMQP_BASIC_CONSUME_METHOD,
>         &method_ok,
>         &s
>     ); 

There are a couple of issues here.

The first, and the one that's leading to your segfault and backtrace
gave, is that you are not setting the "arguments" field of the
amqp_basic_consume_t struct.  Setting it to NULL would be fine.

With that fixed, I think you will run into a problem with
method_ok. That argument is supposed to be a zero-terminated array of
acceptable reply method ids.  So it should be something like:

    amqp_method_number_t methods_ok[] = { AMQP_BASIC_CONSUME_OK_METHOD, 0 };

But really, I think you should be calling amqp_basic_consume, which will
take case of both those things.  Is there a reason you're not using it?

> [...]
>
> Thoughts on what I am doing wrong? Is there a spec somewhere I can
> use? =)

I'm afraid not.  The C client could do with some documentation work.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vukasin at toroman.name  Thu Sep 23 09:33:13 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Thu, 23 Sep 2010 10:33:13 +0200
Subject: [rabbitmq-discuss] listing bindings for a queue
Message-ID: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>

Hi everyone,

I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:

My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling

	rabbitmqctl list_bindings

but that needs to be run as root and my code does not (and should not) have these privileges.
I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.

Best,
Vukasin

From mabrek at gmail.com  Thu Sep 23 09:40:19 2010
From: mabrek at gmail.com (mabrek)
Date: Thu, 23 Sep 2010 12:40:19 +0400
Subject: [rabbitmq-discuss] unsynchronized access to
 com.rabbitmq.client.impl.AMQChannel#_blockContent in java client
Message-ID: <4C9B1273.6050903@gmail.com>

Hello,

I use Channel.basicPublish() in http request handler (java client 2.1.0).
Messages should be sent immediately or exception should be thrown after rabbitmq server had sent channel.flow active=false. If I don't handle channel.flow status, basicPublish() will hang until server sends channel.flow active=true.
I'm trying to check channel flow status before sending messages. It seems that the proper way to do it is to check channel.getFlow().getActive() but com.rabbitmq.client.impl.ChannelN#getFlow uses unsynchronized access to field _blockContent. Access to _blockContent is protected by synchronized (_channelMutex) in all other places.

Regards,
Anton Lebedevich.

From videlalvaro at gmail.com  Thu Sep 23 09:41:35 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Sep 2010 16:41:35 +0800
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
Message-ID: <465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>

A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is

You could edit or create a new version of that script modifying the exec part:

exec erl \
    -pa "${RABBITMQ_HOME}/ebin" \
    -noinput \
    -hidden \
    ${RABBITMQ_CTL_ERL_ARGS} \
    -sname rabbitmqctl$$ \
    -s rabbit_control \
    -nodename $RABBITMQ_NODENAME \
    -setcookie COOKIEVALUE
    -extra "$@"

I've added this line there: -setcookie COOKIEVALUE

Another way to do that is to modify your local .erlang.cookie to be the same as the root one.

Regards,

Alvaro


On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:

> Hi everyone,
> 
> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
> 
> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
> 
> 	rabbitmqctl list_bindings
> 
> but that needs to be run as root and my code does not (and should not) have these privileges.
> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
> 
> Best,
> Vukasin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vukasin at toroman.name  Thu Sep 23 09:47:23 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Thu, 23 Sep 2010 10:47:23 +0200
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
Message-ID: <ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>

Thanks Alvaro,

this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.

Thanx,
Vukasin


On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:

> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
> 
> You could edit or create a new version of that script modifying the exec part:
> 
> exec erl \
>    -pa "${RABBITMQ_HOME}/ebin" \
>    -noinput \
>    -hidden \
>    ${RABBITMQ_CTL_ERL_ARGS} \
>    -sname rabbitmqctl$$ \
>    -s rabbit_control \
>    -nodename $RABBITMQ_NODENAME \
>    -setcookie COOKIEVALUE
>    -extra "$@"
> 
> I've added this line there: -setcookie COOKIEVALUE
> 
> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
> 
> Regards,
> 
> Alvaro
> 
> 
> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
> 
>> Hi everyone,
>> 
>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>> 
>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>> 
>> 	rabbitmqctl list_bindings
>> 
>> but that needs to be run as root and my code does not (and should not) have these privileges.
>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>> 
>> Best,
>> Vukasin
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From videlalvaro at gmail.com  Thu Sep 23 09:51:00 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Sep 2010 16:51:00 +0800
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
Message-ID: <0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>

You could do the same with Erlang. It's what the rabbitmqctl is doing BTW.

With some tweaks you can make it work to connect to other nodes across the network. You'll need to share the erlang cookie.

On Sep 23, 2010, at 4:47 PM, Vukasin Toroman wrote:

> Thanks Alvaro,
> 
> this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.
> 
> Thanx,
> Vukasin
> 
> 
> On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:
> 
>> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
>> 
>> You could edit or create a new version of that script modifying the exec part:
>> 
>> exec erl \
>>   -pa "${RABBITMQ_HOME}/ebin" \
>>   -noinput \
>>   -hidden \
>>   ${RABBITMQ_CTL_ERL_ARGS} \
>>   -sname rabbitmqctl$$ \
>>   -s rabbit_control \
>>   -nodename $RABBITMQ_NODENAME \
>>   -setcookie COOKIEVALUE
>>   -extra "$@"
>> 
>> I've added this line there: -setcookie COOKIEVALUE
>> 
>> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> 
>> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
>> 
>>> Hi everyone,
>>> 
>>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>>> 
>>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>>> 
>>> 	rabbitmqctl list_bindings
>>> 
>>> but that needs to be run as root and my code does not (and should not) have these privileges.
>>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>>> 
>>> Best,
>>> Vukasin
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 


From vukasin at toroman.name  Thu Sep 23 10:06:23 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Thu, 23 Sep 2010 11:06:23 +0200
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
	<0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>
Message-ID: <6A40120A-AB18-4E3A-8F97-18EDFC473DA8@toroman.name>

but wouldn't they miss the RABBITMQ_HOME directory on the other machines if they had no rabbitmq server installed but only erlang? could i distribute a subset of rabbitmq's files to each node?



On Sep 23, 2010, at 10:51 , Alvaro Videla wrote:

> You could do the same with Erlang. It's what the rabbitmqctl is doing BTW.
> 
> With some tweaks you can make it work to connect to other nodes across the network. You'll need to share the erlang cookie.
> 
> On Sep 23, 2010, at 4:47 PM, Vukasin Toroman wrote:
> 
>> Thanks Alvaro,
>> 
>> this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.
>> 
>> Thanx,
>> Vukasin
>> 
>> 
>> On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:
>> 
>>> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
>>> 
>>> You could edit or create a new version of that script modifying the exec part:
>>> 
>>> exec erl \
>>>  -pa "${RABBITMQ_HOME}/ebin" \
>>>  -noinput \
>>>  -hidden \
>>>  ${RABBITMQ_CTL_ERL_ARGS} \
>>>  -sname rabbitmqctl$$ \
>>>  -s rabbit_control \
>>>  -nodename $RABBITMQ_NODENAME \
>>>  -setcookie COOKIEVALUE
>>>  -extra "$@"
>>> 
>>> I've added this line there: -setcookie COOKIEVALUE
>>> 
>>> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> 
>>> 
>>> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
>>> 
>>>> Hi everyone,
>>>> 
>>>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>>>> 
>>>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>>>> 
>>>> 	rabbitmqctl list_bindings
>>>> 
>>>> but that needs to be run as root and my code does not (and should not) have these privileges.
>>>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>>>> 
>>>> Best,
>>>> Vukasin
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
> 


From videlalvaro at gmail.com  Thu Sep 23 10:16:14 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Sep 2010 17:16:14 +0800
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <6A40120A-AB18-4E3A-8F97-18EDFC473DA8@toroman.name>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
	<0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>
	<6A40120A-AB18-4E3A-8F97-18EDFC473DA8@toroman.name>
Message-ID: <C10FAA57-7934-475F-A84A-8DBDED919F04@gmail.com>

Well, 

You could execute the rabbit_control module remotely. Let me see If I can come up with a script to accomplish what you ask. I don't promise anything tough?

On Sep 23, 2010, at 5:06 PM, Vukasin Toroman wrote:

> but wouldn't they miss the RABBITMQ_HOME directory on the other machines if they had no rabbitmq server installed but only erlang? could i distribute a subset of rabbitmq's files to each node?
> 
> 
> 
> On Sep 23, 2010, at 10:51 , Alvaro Videla wrote:
> 
>> You could do the same with Erlang. It's what the rabbitmqctl is doing BTW.
>> 
>> With some tweaks you can make it work to connect to other nodes across the network. You'll need to share the erlang cookie.
>> 
>> On Sep 23, 2010, at 4:47 PM, Vukasin Toroman wrote:
>> 
>>> Thanks Alvaro,
>>> 
>>> this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.
>>> 
>>> Thanx,
>>> Vukasin
>>> 
>>> 
>>> On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:
>>> 
>>>> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
>>>> 
>>>> You could edit or create a new version of that script modifying the exec part:
>>>> 
>>>> exec erl \
>>>> -pa "${RABBITMQ_HOME}/ebin" \
>>>> -noinput \
>>>> -hidden \
>>>> ${RABBITMQ_CTL_ERL_ARGS} \
>>>> -sname rabbitmqctl$$ \
>>>> -s rabbit_control \
>>>> -nodename $RABBITMQ_NODENAME \
>>>> -setcookie COOKIEVALUE
>>>> -extra "$@"
>>>> 
>>>> I've added this line there: -setcookie COOKIEVALUE
>>>> 
>>>> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
>>>> 
>>>> Regards,
>>>> 
>>>> Alvaro
>>>> 
>>>> 
>>>> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
>>>> 
>>>>> Hi everyone,
>>>>> 
>>>>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>>>>> 
>>>>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>>>>> 
>>>>> 	rabbitmqctl list_bindings
>>>>> 
>>>>> but that needs to be run as root and my code does not (and should not) have these privileges.
>>>>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>>>>> 
>>>>> Best,
>>>>> Vukasin
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>> 
>> 
> 


From vukasin at toroman.name  Thu Sep 23 10:20:24 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Thu, 23 Sep 2010 11:20:24 +0200
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <C10FAA57-7934-475F-A84A-8DBDED919F04@gmail.com>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
	<0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>
	<6A40120A-AB18-4E3A-8F97-18EDFC473DA8@toroman.name>
	<C10FAA57-7934-475F-A84A-8DBDED919F04@gmail.com>
Message-ID: <A6FBC5D5-1322-41D3-9A64-3282AC6A5282@toroman.name>

thanx, 

i appreciate the help. 

greetz,
vukasin


On Sep 23, 2010, at 11:16 , Alvaro Videla wrote:

> Well, 
> 
> You could execute the rabbit_control module remotely. Let me see If I can come up with a script to accomplish what you ask. I don't promise anything tough?
> 
> On Sep 23, 2010, at 5:06 PM, Vukasin Toroman wrote:
> 
>> but wouldn't they miss the RABBITMQ_HOME directory on the other machines if they had no rabbitmq server installed but only erlang? could i distribute a subset of rabbitmq's files to each node?
>> 
>> 
>> 
>> On Sep 23, 2010, at 10:51 , Alvaro Videla wrote:
>> 
>>> You could do the same with Erlang. It's what the rabbitmqctl is doing BTW.
>>> 
>>> With some tweaks you can make it work to connect to other nodes across the network. You'll need to share the erlang cookie.
>>> 
>>> On Sep 23, 2010, at 4:47 PM, Vukasin Toroman wrote:
>>> 
>>>> Thanks Alvaro,
>>>> 
>>>> this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.
>>>> 
>>>> Thanx,
>>>> Vukasin
>>>> 
>>>> 
>>>> On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:
>>>> 
>>>>> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
>>>>> 
>>>>> You could edit or create a new version of that script modifying the exec part:
>>>>> 
>>>>> exec erl \
>>>>> -pa "${RABBITMQ_HOME}/ebin" \
>>>>> -noinput \
>>>>> -hidden \
>>>>> ${RABBITMQ_CTL_ERL_ARGS} \
>>>>> -sname rabbitmqctl$$ \
>>>>> -s rabbit_control \
>>>>> -nodename $RABBITMQ_NODENAME \
>>>>> -setcookie COOKIEVALUE
>>>>> -extra "$@"
>>>>> 
>>>>> I've added this line there: -setcookie COOKIEVALUE
>>>>> 
>>>>> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
>>>>> 
>>>>> Regards,
>>>>> 
>>>>> Alvaro
>>>>> 
>>>>> 
>>>>> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
>>>>> 
>>>>>> Hi everyone,
>>>>>> 
>>>>>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>>>>>> 
>>>>>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>>>>>> 
>>>>>> 	rabbitmqctl list_bindings
>>>>>> 
>>>>>> but that needs to be run as root and my code does not (and should not) have these privileges.
>>>>>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>>>>>> 
>>>>>> Best,
>>>>>> Vukasin
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> 
>>>> 
>>> 
>> 
> 


From videlalvaro at gmail.com  Thu Sep 23 10:32:50 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Sep 2010 17:32:50 +0800
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <A6FBC5D5-1322-41D3-9A64-3282AC6A5282@toroman.name>
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
	<0F28C4A3-AAE8-47A4-86F7-2663F7ABB4E2@gmail.com>
	<6A40120A-AB18-4E3A-8F97-18EDFC473DA8@toroman.name>
	<C10FAA57-7934-475F-A84A-8DBDED919F04@gmail.com>
	<A6FBC5D5-1322-41D3-9A64-3282AC6A5282@toroman.name>
Message-ID: <36DD018E-FEDC-4BF0-AE29-ACC2D762D844@gmail.com>

OK,

The solution is actually simpler? I tried this with the latest code from rabbitmqctl,

on the command line do:

$ export CTL_ERL_ARGS="-setcookie COOKIE_VALUE_HERE"
$ ./rabbitmqctl -n 'rabbit at hostname' list_queues

It Works For Me ? :D

Regards,

Alvaro


On Sep 23, 2010, at 5:20 PM, Vukasin Toroman wrote:

> thanx, 
> 
> i appreciate the help. 
> 
> greetz,
> vukasin
> 
> 
> On Sep 23, 2010, at 11:16 , Alvaro Videla wrote:
> 
>> Well, 
>> 
>> You could execute the rabbit_control module remotely. Let me see If I can come up with a script to accomplish what you ask. I don't promise anything tough?
>> 
>> On Sep 23, 2010, at 5:06 PM, Vukasin Toroman wrote:
>> 
>>> but wouldn't they miss the RABBITMQ_HOME directory on the other machines if they had no rabbitmq server installed but only erlang? could i distribute a subset of rabbitmq's files to each node?
>>> 
>>> 
>>> 
>>> On Sep 23, 2010, at 10:51 , Alvaro Videla wrote:
>>> 
>>>> You could do the same with Erlang. It's what the rabbitmqctl is doing BTW.
>>>> 
>>>> With some tweaks you can make it work to connect to other nodes across the network. You'll need to share the erlang cookie.
>>>> 
>>>> On Sep 23, 2010, at 4:47 PM, Vukasin Toroman wrote:
>>>> 
>>>>> Thanks Alvaro,
>>>>> 
>>>>> this will help me greatly in the short term. In the long term I would like to move this responsibility to the nodes (which do not have rabbitmq installed) and would need some over-the-wire method of listing. Since my cluster is currently fairly small, I can live with the solution you proposed.
>>>>> 
>>>>> Thanx,
>>>>> Vukasin
>>>>> 
>>>>> 
>>>>> On Sep 23, 2010, at 10:41 , Alvaro Videla wrote:
>>>>> 
>>>>>> A quick and dirty solution could be to modify the rabbitmqctl script and add there whatever the root /root/.erlang.cookie is
>>>>>> 
>>>>>> You could edit or create a new version of that script modifying the exec part:
>>>>>> 
>>>>>> exec erl \
>>>>>> -pa "${RABBITMQ_HOME}/ebin" \
>>>>>> -noinput \
>>>>>> -hidden \
>>>>>> ${RABBITMQ_CTL_ERL_ARGS} \
>>>>>> -sname rabbitmqctl$$ \
>>>>>> -s rabbit_control \
>>>>>> -nodename $RABBITMQ_NODENAME \
>>>>>> -setcookie COOKIEVALUE
>>>>>> -extra "$@"
>>>>>> 
>>>>>> I've added this line there: -setcookie COOKIEVALUE
>>>>>> 
>>>>>> Another way to do that is to modify your local .erlang.cookie to be the same as the root one.
>>>>>> 
>>>>>> Regards,
>>>>>> 
>>>>>> Alvaro
>>>>>> 
>>>>>> 
>>>>>> On Sep 23, 2010, at 4:33 PM, Vukasin Toroman wrote:
>>>>>> 
>>>>>>> Hi everyone,
>>>>>>> 
>>>>>>> I am using RabbitMQ as an underlying messaging infrastructure for my project and have run into a problem, and maybe someone on this list could point me in the right direction as to how to solve it:
>>>>>>> 
>>>>>>> My system has multiple nodes (physically distinct machines) which communicate using AMQP in a workflow. When the workflow is changed, the affected nodes are restarted and they reconnect to AMQP (rabbitmq) and declare their input queue and its bindings. In order to ensure that no unwanted (stale) subscriptions are still active I need to call "queue.unbind" on them. So far so good. BUT in order to do that I need to be able to list active bindings for a given queue. I wasn't able to find such method wether in the amqp spec nor in any of the API's. What am I missing? I can see this information by calling
>>>>>>> 
>>>>>>> 	rabbitmqctl list_bindings
>>>>>>> 
>>>>>>> but that needs to be run as root and my code does not (and should not) have these privileges.
>>>>>>> I keep thinking I must be missing something but I just can't seem to find the solution. Any help would be appreciated. The only other way would be to completely trash the queue but I would need to first get to persist the queued messages and reinject them, but this is a fairly ugly solution.
>>>>>>> 
>>>>>>> Best,
>>>>>>> Vukasin
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>> 
>>>>> 
>>>> 
>>> 
>> 
> 


From david at rabbitmq.com  Thu Sep 23 10:41:58 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 23 Sep 2010 10:41:58 +0100
Subject: [rabbitmq-discuss] listing bindings for a queue
In-Reply-To: <ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name> (Vukasin
	Toroman's message of "Thu, 23 Sep 2010 10:47:23 +0200")
References: <D2A6C741-6660-467C-803A-31E4802A0C93@toroman.name>
	<465CAFA2-01D0-49F7-AA45-50EECA162BC6@gmail.com>
	<ACA934CF-D258-4013-BABA-3D277AA1EED5@toroman.name>
Message-ID: <yrv4chbhgn6e1.fsf@dwragg.eng.vmware.com>

Hi Vukasin,

Vukasin Toroman <vukasin at toroman.name> writes:
> this will help me greatly in the short term. In the long term I would
> like to move this responsibility to the nodes (which do not have
> rabbitmq installed) and would need some over-the-wire method of
> listing. Since my cluster is currently fairly small, I can live with
> the solution you proposed.

Our work on improving the manageability of rabbit (see
<http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/>)
introduces HTTP-based APIs for querying the type of information
currently available through rabbitmqctl.  That's still at the stage of
preview release, but it might be of interest to you.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From emile at rabbitmq.com  Thu Sep 23 11:26:20 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 23 Sep 2010 11:26:20 +0100
Subject: [rabbitmq-discuss] Unable to break the loop!
In-Reply-To: <29758980.post@talk.nabble.com>
References: <29758980.post@talk.nabble.com>
Message-ID: <4C9B2B4C.3040609@rabbitmq.com>


Hi Cheepu

On 21/09/10 04:34, cheepu wrote:
> 
> Hi,
> Here my scenario is with the rabbitMQ:
> I am getting two value from UI(Here i am getting manually)
> Those value will be sent to rabbitMQ which produce those value.
> Consumer will take both the value and add them and then put them in the
> response queue.
> From response Queue I will get the answer and display them in the queue.
> 
> I am unable to return the value from the response queue.
> How can I return the value so that I can display that in th UI.
> 
> Here is my Service class and RabbitMQConsumer class.(Consumer class is run
> from out side)
> thanks
> http://old.nabble.com/file/p29758980/Service.java Service.java 
> http://old.nabble.com/file/p29758980/RabbitMQConsumer.java
> RabbitMQConsumer.java 


I notice that "myqueue" and "myQueue" are capitalised differently in the
two files - is this possibly the problem? You can confirm by running
"rabbitmqctl list_queues" at the point when you expect to be able to
retrieve a value. Check that the queue you are consuming from has any
messages.

I was not able to review all the code you posted. If you do provide code
then please keep it as short as possible while demonstrating the problem.



Regards

Emile

From majek04 at gmail.com  Thu Sep 23 11:37:25 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Sep 2010 11:37:25 +0100
Subject: [rabbitmq-discuss] Best way to have default queues and exchanges
In-Reply-To: <4C96EE91.8050005@gmail.com>
References: <4C96EE91.8050005@gmail.com>
Message-ID: <AANLkTimRkKkNL4exJ2NthYau49qoN=AFwWRRi6B5OQzo@mail.gmail.com>

Hi,

I'd say that creating  a durable queues/exchanges via python script is pretty
good idea. Other common option is just to recreate all the setup by your
programs when they start. Creating queues is idempotent - even if you
call queue.declare(name) many times, it will still create only a single queue.

And about python libraries - I'm sure you can script that pretty easily,
amqplib using easy_install -
http://pypi.python.org/pypi?:action=display&name=amqplib
or pika using pip:
pip install -e git://github.com/tonyg/pika.git#egg=pika

Marek

On Mon, Sep 20, 2010 at 06:18, Abhishek Kona <abhishek.kona at gmail.com> wrote:
> ?Hi
>
> We are using RabbitMQ on EC2 machines. Each time we bring up an EC2 instance
> with RabbitMQ we need to have certain exchanges and queues available on the
> instance.
>
> The way we currently do it is writing a python Client code which creates
> these instances, but this requires the instance to have the Python AMQP
> library installed.
>
> Is there a better way in which I can define the exchanges and queues to
> exist on a RabbitMQ server on installation.
> Or is there a way in which I can create these exchanges and queues without
> having to install any libraries (If possible using shell script)
>
> Abhishek Kona
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From sameek at arosys.com  Thu Sep 23 12:49:18 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 23 Sep 2010 04:49:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting problem to return value from response
 value
Message-ID: <29788377.post@talk.nabble.com>


Hi, i am using Rabbitmq Java client API.i am sending two number from GUI to
producer and producer put into queue another side consumer can listen the
queue and read it and perform the addition of two number and put result on
queue then again my producer will listen the my response queue and retrieve
the result.
code:

while (runInfinite) {
            QueueingConsumer.Delivery delivery;
            try
            {
               delivery = consumer.nextDelivery();
            } catch (InterruptedException ie)
            {
               continue;
            }
         System.out.println("Result received-"
+ new String(delivery.getBody()));
}

My problem is when the while loop run infinite time and i want to send the
fetched result to an GUI to show result.i want to know that, it is possible
,if possible then what i do?
http://old.nabble.com/file/p29788377/rabbit-rpc.png  just i want to follow
same flow.

Thanks
-- 
View this message in context: http://old.nabble.com/Getting-problem-to-return-value-from-response-value-tp29788377p29788377.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From david at rabbitmq.com  Thu Sep 23 13:22:54 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 23 Sep 2010 13:22:54 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	(Adam Nelson's message of "Fri, 17 Sep 2010 17:55:14 -0400")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
Message-ID: <yrv4caan8myxt.fsf@dwragg.eng.vmware.com>

Adam Nelson <adam at varud.com> writes:
>  * Please don't tell Mac users to use MacPorts:
> http://www.rabbitmq.com/macports.html It's time to move them to HomeBrew at
> http://github.com/mxcl/homebrew

I'm not a frequent OS X user.  I do have some experience with macports,
but it's been mixed.  So I like to think I have a fairly objective view
on the macports vs. homebrew thing (that being, they are both vastly
inferior to current Linux package systems :-)

So with that said:

I think we'd be happy to endorse homebrew alongside or instead of
macports, *if* it achieves parity with the rabbitmq-server port, and the
rabbitmq-server packages on Linuxes.  That means:

- The formula should be called rabbitmq-server

- It should create and use a rabbitmq user/group, and include the
  wrapper scripts to support this.

- It should have some way to run as an automatically started daemon.

- It should include the man pages (on-line documentation is great, man
  pages are too, we have both, and we want the man pages to be provided
  with the packages).

- We need to have a way to distribute an update package when we make a
  new release, for users that are willing to bypass the central
  repository.

We've made all this work for macports; it's unlikely we are going to
repeat that effort for homebrew (unless macports dies or something).

But if someone in the community wants to work on getting the homebrew
formula into the same shape, that would be great.  We could work with
them to integrate it into our build/release process.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From sameek at arosys.com  Thu Sep 23 13:26:23 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 23 Sep 2010 05:26:23 -0700 (PDT)
Subject: [rabbitmq-discuss] How to use Consumer as Producer in rabbitmq
In-Reply-To: <29736359.post@talk.nabble.com>
References: <29736359.post@talk.nabble.com>
Message-ID: <29788719.post@talk.nabble.com>



specialsaran wrote:
> 
> Hi,
> I am new to RabbitMQ , i would like to know how to use consumer as
> producer and vice versa ie the consumer will use to receive the message
> from the queue at the same time it should be able to transmit the message
> to the exchange and same for producer too , it should transmit and receive
> message.
> 
> Thankyou in advance
> Saran 
> 

Hi,
Here service.java file contain the code for producer and consumer.
The route of the messages would be: 
C1 -> X1 -> Q1 -> C2 
C2 -> X1 -> Q2 -> C1 
where C1 and C2 are your clients.
http://old.nabble.com/file/p29788719/Service.java Service.java 
and the result.java file can listen the response queue and print the
result.here i m using only one exchange.
http://old.nabble.com/file/p29788719/Result.java Result.java 

Rgds, 
Sameek
-- 
View this message in context: http://old.nabble.com/How-to-use-Consumer-as-Producer-in-rabbitmq-tp29736359p29788719.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mybayworkz at gmail.com  Thu Sep 23 14:22:26 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Thu, 23 Sep 2010 08:22:26 -0500
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
Message-ID: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>

Hello,

I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But it
is crashing on start.
Activating Rabbitmq plugins ...0 plugins activated and it crashes as erl.exe
uses up all the memory.

Is it because of resources  because I have set all the class paths and have
erlang installed at C:\Elang\erl5.7.4
and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
were some issues when trying to install at "Program files" because of the
space in the folder name.

Thank you for any help advice.
------------------ from erl_crash.dump-------------------------------

=erl_crash_dump:0.1
Thu Sep 23 08:19:02 2010
Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
"heap").
System version: Erlang R13B03 (erts-5.7.4) [rq:1] [async-threads:30]
Compiled: Tue Nov 24 11:12:28 2009
Atoms: 7290
=memory
total: 1175947208
processes: 1172250988
processes_used: 1172248436
system: 3696220
atom: 328561
atom_used: 315456

regards
Chandra
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/3ff76893/attachment.htm>

From mybayworkz at gmail.com  Thu Sep 23 14:22:26 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Thu, 23 Sep 2010 08:22:26 -0500
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
Message-ID: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>

Hello,

I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But it
is crashing on start.
Activating Rabbitmq plugins ...0 plugins activated and it crashes as erl.exe
uses up all the memory.

Is it because of resources  because I have set all the class paths and have
erlang installed at C:\Elang\erl5.7.4
and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
were some issues when trying to install at "Program files" because of the
space in the folder name.

Thank you for any help advice.
------------------ from erl_crash.dump-------------------------------

=erl_crash_dump:0.1
Thu Sep 23 08:19:02 2010
Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
"heap").
System version: Erlang R13B03 (erts-5.7.4) [rq:1] [async-threads:30]
Compiled: Tue Nov 24 11:12:28 2009
Atoms: 7290
=memory
total: 1175947208
processes: 1172250988
processes_used: 1172248436
system: 3696220
atom: 328561
atom_used: 315456

regards
Chandra
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/3ff76893/attachment-0001.htm>

From pdezwart at rubiconproject.com  Thu Sep 23 17:40:05 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 23 Sep 2010 09:40:05 -0700
Subject: [rabbitmq-discuss] Rabbitmq-c Help
In-Reply-To: <yrv4c1v8l5v6d.fsf@dwragg.eng.vmware.com>
Message-ID: <C8C0D0F5.FFC1%pdezwart@rubiconproject.com>

The sad and honest truth is that I inherited this code, so I am still
familiarizing myself with it.
Thank you very much for all of your help. I will go pound on it some more
and humbly request your assistance again next time I run into a roadblock =)
Pieter 


On 9/22/10 2:23 PM, "David Wragg" <david at rabbitmq.com> wrote:

> take case of both those things.  Is there a reason you're not using it?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/80da9ac4/attachment.htm>

From mybayworkz at gmail.com  Thu Sep 23 18:01:45 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Thu, 23 Sep 2010 12:01:45 -0500
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
In-Reply-To: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
References: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
Message-ID: <AANLkTik_9VQ51VaEhG7odCqgFjZC-MaEXq=bNp8mdo7u@mail.gmail.com>

Hi,
I still couldn't run it. This time I created a new windows xp VM with 3.5 gb
ram and installed rabbitmq 2.1.0 on it. But it still crashing on start as
erl.exe memory usage -585,332 k.

Is there something else I can try to run it please ?

Thank you for any input/advise.

Chandra


On Thu, Sep 23, 2010 at 8:22 AM, Chandra R <mybayworkz at gmail.com> wrote:

> Hello,
>
> I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But
> it is crashing on start.
> Activating Rabbitmq plugins ...0 plugins activated and it crashes as
> erl.exe uses up all the memory.
>
> Is it because of resources  because I have set all the class paths and have
> erlang installed at C:\Elang\erl5.7.4
> and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
> were some issues when trying to install at "Program files" because of the
> space in the folder name.
>
> Thank you for any help advice.
> ------------------ from erl_crash.dump-------------------------------
>
> =erl_crash_dump:0.1
> Thu Sep 23 08:19:02 2010
> Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
> "heap").
> System version: Erlang R13B03 (erts-5.7.4) [rq:1] [async-threads:30]
> Compiled: Tue Nov 24 11:12:28 2009
> Atoms: 7290
> =memory
> total: 1175947208
> processes: 1172250988
> processes_used: 1172248436
> system: 3696220
> atom: 328561
> atom_used: 315456
>
> regards
> Chandra
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/f37dabce/attachment-0001.htm>

From mybayworkz at gmail.com  Thu Sep 23 20:36:26 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Thu, 23 Sep 2010 14:36:26 -0500
Subject: [rabbitmq-discuss] RabbitMQ refuses to start , instead crash
Message-ID: <AANLkTikqqkRkdWey-mXwNwiFeUzPY1LZDouofSa6F+i3@mail.gmail.com>

Hello,

 I am new to rabbitmq and  I have been trying to run it on Windows XP with
2.5 gb on a VM (Also tried on XP with 3.5 gb on a VM) but it crashes.
Later I found that I was using extension .conf instead of .config, which I
corrected.
Still it does the same thing, crashing. No logs are being created.
I am using erlang 5.7.4 and tried rabbitmq 2.1.0 & 1.8.1.
I have attached crash dump zip
Please help me get started

Thank you

regards,
Chandra
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/b0ae25ea/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.zip
Type: application/zip
Size: 84770 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100923/b0ae25ea/attachment-0001.zip>

From alexis at rabbitmq.com  Thu Sep 23 22:50:48 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 23 Sep 2010 22:50:48 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>

Adam, everyone,

What are your thoughts on this thread?  Is this helping?

alexis



On Thu, Sep 23, 2010 at 1:22 PM, David Wragg <david at rabbitmq.com> wrote:
> Adam Nelson <adam at varud.com> writes:
>> ?* Please don't tell Mac users to use MacPorts:
>> http://www.rabbitmq.com/macports.html It's time to move them to HomeBrew at
>> http://github.com/mxcl/homebrew
>
> I'm not a frequent OS X user. ?I do have some experience with macports,
> but it's been mixed. ?So I like to think I have a fairly objective view
> on the macports vs. homebrew thing (that being, they are both vastly
> inferior to current Linux package systems :-)
>
> So with that said:
>
> I think we'd be happy to endorse homebrew alongside or instead of
> macports, *if* it achieves parity with the rabbitmq-server port, and the
> rabbitmq-server packages on Linuxes. ?That means:
>
> - The formula should be called rabbitmq-server
>
> - It should create and use a rabbitmq user/group, and include the
> ?wrapper scripts to support this.
>
> - It should have some way to run as an automatically started daemon.
>
> - It should include the man pages (on-line documentation is great, man
> ?pages are too, we have both, and we want the man pages to be provided
> ?with the packages).
>
> - We need to have a way to distribute an update package when we make a
> ?new release, for users that are willing to bypass the central
> ?repository.
>
> We've made all this work for macports; it's unlikely we are going to
> repeat that effort for homebrew (unless macports dies or something).
>
> But if someone in the community wants to work on getting the homebrew
> formula into the same shape, that would be great. ?We could work with
> them to integrate it into our build/release process.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tonyg at rabbitmq.com  Fri Sep 24 00:22:48 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Thu, 23 Sep 2010 19:22:48 -0400
Subject: [rabbitmq-discuss] Homebrew RabbitMQ (was Re: Thoughts from a new
 user)
In-Reply-To: <yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
Message-ID: <4C9BE148.7030401@rabbitmq.com>

Hi David,

On 23/09/2010 08:22, David Wragg wrote:
> - It should create and use a rabbitmq user/group, and include the
>   wrapper scripts to support this.

I disagree with this: it's against the homebrew "no sudo" philosophy:
http://wiki.github.com/mxcl/homebrew/installation#sudo

> - We need to have a way to distribute an update package when we make a
>   new release, for users that are willing to bypass the central
>   repository.

Maintaining a fork of homebrew on github is one good option here. It's also a
good way of getting the new package accepted upstream.

> We've made all this work for macports; it's unlikely we are going to
> repeat that effort for homebrew (unless macports dies or something).

Fair, though really, my (!) experience getting Rabbit running on Homebrew was
far, far more pleasant that getting it running on Macports.

Tony

From david at rabbitmq.com  Fri Sep 24 07:46:16 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 24 Sep 2010 07:46:16 +0100
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <4C9BE148.7030401@rabbitmq.com> (Tony Garnock-Jones's message of
	"Thu, 23 Sep 2010 19:22:48 -0400")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
Message-ID: <yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>

Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
> On 23/09/2010 08:22, David Wragg wrote:
>> - It should create and use a rabbitmq user/group, and include the
>>   wrapper scripts to support this.
>
> I disagree with this: it's against the homebrew "no sudo" philosophy:
> http://wiki.github.com/mxcl/homebrew/installation#sudo

That seems to be arguing that you shouldn't have to sudo to do the
build.  Which is something I completely agree with.

It also also says that you shouldn't need sudo to install textmate or
wget.  That's fair enough, I suppose.

But it doesn't address system services.  We package rabbitmq-server to
run as a system service, because that's the way most people will want to
run it.

If the hoembrew policy is that you should just run everything under your
user account, that seems very short-sighted to me.

>> - We need to have a way to distribute an update package when we make a
>>   new release, for users that are willing to bypass the central
>>   repository.
>
> Maintaining a fork of homebrew on github is one good option here. It's also a
> good way of getting the new package accepted upstream.
>
>> We've made all this work for macports; it's unlikely we are going to
>> repeat that effort for homebrew (unless macports dies or something).
>
> Fair, though really, my (!) experience getting Rabbit running on
> Homebrew was far, far more pleasant that getting it running on
> Macports.

So the question is whether that would continue to be the case if the
homebrew formula was updated to be comparable to the macports port.  The
macports port might be a lot more convenient to install if we cut all
the same corners.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From ian.ragsdale at gmail.com  Fri Sep 24 08:00:31 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Fri, 24 Sep 2010 02:00:31 -0500
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
	<yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
Message-ID: <63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>

On Sep 24, 2010, at 1:46 AM, David Wragg wrote:

> Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
> 
> But it doesn't address system services.  We package rabbitmq-server to
> run as a system service, because that's the way most people will want to
> run it.

I'd argue that's probably the case for a linux box, and possibly for a windows box, but I'd bet the vast majority of people running on a mac are likely to be developers writing software to be deployed elsewhere.  For that use case (my own) I much prefer the homebrew experience.  That said, if homebrew installed it under a rabbitmq account and required me to use sudo to do so, I certainly wouldn't mind doing so.

> If the hoembrew policy is that you should just run everything under your
> user account, that seems very short-sighted to me.
> 
> So the question is whether that would continue to be the case if the
> homebrew formula was updated to be comparable to the macports port.  The
> macports port might be a lot more convenient to install if we cut all
> the same corners.

Given my experiences with both, I'd be willing to bet homebrew would still be much nicer, but I certainly understand why you guys aren't interested in investing the time to get the homebrew install up to the level of the macports install in terms of functionality.  That said, it doesn't preclude you from listing it as an option on the install page, with the caveat that not everything is installed, so that people know it's an available option.

- Ian
 

From tim at cantemo.com  Fri Sep 24 08:41:42 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 24 Sep 2010 09:41:42 +0200
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
	<yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
	<63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>
Message-ID: <57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com>

I agree, most OS X users are probably developers looking for a local solution to develop for a system which will end up deployed on another OS.

However if you want to make it a system service its not exactly a hard step to make, something which we can document, give example of the launchd scripts or whatever it needs.

Tim.

On 24 Sep 2010, at 09:00, Ian Ragsdale wrote:

> On Sep 24, 2010, at 1:46 AM, David Wragg wrote:
> 
>> Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
>> 
>> But it doesn't address system services.  We package rabbitmq-server to
>> run as a system service, because that's the way most people will want to
>> run it.
> 
> I'd argue that's probably the case for a linux box, and possibly for a windows box, but I'd bet the vast majority of people running on a mac are likely to be developers writing software to be deployed elsewhere.  For that use case (my own) I much prefer the homebrew experience.  That said, if homebrew installed it under a rabbitmq account and required me to use sudo to do so, I certainly wouldn't mind doing so.
> 
>> If the hoembrew policy is that you should just run everything under your
>> user account, that seems very short-sighted to me.
>> 
>> So the question is whether that would continue to be the case if the
>> homebrew formula was updated to be comparable to the macports port.  The
>> macports port might be a lot more convenient to install if we cut all
>> the same corners.
> 
> Given my experiences with both, I'd be willing to bet homebrew would still be much nicer, but I certainly understand why you guys aren't interested in investing the time to get the homebrew install up to the level of the macports install in terms of functionality.  That said, it doesn't preclude you from listing it as an option on the install page, with the caveat that not everything is installed, so that people know it's an available option.


From davorin.rusevljan at gmail.com  Fri Sep 24 09:55:07 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Fri, 24 Sep 2010 10:55:07 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
Message-ID: <AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>

On Wed, May 5, 2010 at 9:58 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Hi everyone,
>
> As part of an ongoing drive to "be more open" as well as to "get to
> 1.0" the AMQP Working Group has published the 1-0 PR3 draft on the
> webs for Public Comment:
> http://www.amqp.org/confluence/download/attachments/2523279/amqp_1-0_PR3.pdf
>
> I would be thrilled if the whole community could take a look at this.
>
> Please:
>
> - Be quick! ?We need comments asap.

Well, this would hardly count as quick but here are some questions:

1)
Chapter 3 on Composite types in Book II Data types, on page 27 states:
"Compound types are formally defined in XML documents included with
specification."

Where are those XML documents located? I have found some in sample
Python broker, and I guess some of the xml sources used to build the
spec document could be used to extract that information, but I guess
they should be really packaged together with the spec.

More importantly, the format that is used to formally describe types
is not specified at all (or I have managed to miss it :) ). While
format does seem somehow natural, and recently added FAQ section on
the web site does address some of the issues, it definitely needs to
be described what each xml node and every possible attribute means,
and how do they interact. Without that whole type system seems to be
hanging in the air.  (again my apologizes if such definitions exists
and I have missed them)

2) Is there some kind of forum, or additional resources that potential
implementor of amqp related software might use? I have signed the
reviewer license, and received congrats on that, but I do not see it
offers any additional information that I could use, even not the
suggest way to send comments in and to whom to address them.

Many thanks!

Davorin Rusevljan
http://www.cloud208.com/

From vukasin at toroman.name  Fri Sep 24 10:02:39 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Fri, 24 Sep 2010 11:02:39 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
Message-ID: <F2A06B34-FE80-480D-8201-AE738A021E82@toroman.name>

Hi David,

I think they meant this specification:

http://www.rabbitmq.com/specification.html


You can take a look at all the supported functions along with the rules they adhere to.

Best,
Vukasin


On Sep 24, 2010, at 10:55 , Davorin Rusevljan wrote:

> On Wed, May 5, 2010 at 9:58 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Hi everyone,
>> 
>> As part of an ongoing drive to "be more open" as well as to "get to
>> 1.0" the AMQP Working Group has published the 1-0 PR3 draft on the
>> webs for Public Comment:
>> http://www.amqp.org/confluence/download/attachments/2523279/amqp_1-0_PR3.pdf
>> 
>> I would be thrilled if the whole community could take a look at this.
>> 
>> Please:
>> 
>> - Be quick!  We need comments asap.
> 
> Well, this would hardly count as quick but here are some questions:
> 
> 1)
> Chapter 3 on Composite types in Book II Data types, on page 27 states:
> "Compound types are formally defined in XML documents included with
> specification."
> 
> Where are those XML documents located? I have found some in sample
> Python broker, and I guess some of the xml sources used to build the
> spec document could be used to extract that information, but I guess
> they should be really packaged together with the spec.
> 
> More importantly, the format that is used to formally describe types
> is not specified at all (or I have managed to miss it :) ). While
> format does seem somehow natural, and recently added FAQ section on
> the web site does address some of the issues, it definitely needs to
> be described what each xml node and every possible attribute means,
> and how do they interact. Without that whole type system seems to be
> hanging in the air.  (again my apologizes if such definitions exists
> and I have missed them)
> 
> 2) Is there some kind of forum, or additional resources that potential
> implementor of amqp related software might use? I have signed the
> reviewer license, and received congrats on that, but I do not see it
> offers any additional information that I could use, even not the
> suggest way to send comments in and to whom to address them.
> 
> Many thanks!
> 
> Davorin Rusevljan
> http://www.cloud208.com/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From davorin.rusevljan at gmail.com  Fri Sep 24 10:23:42 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Fri, 24 Sep 2010 11:23:42 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <F2A06B34-FE80-480D-8201-AE738A021E82@toroman.name>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<F2A06B34-FE80-480D-8201-AE738A021E82@toroman.name>
Message-ID: <AANLkTi=i+hWZs=7u1TrVPC_EEF1YHyLK4uCrhaQUSeGc@mail.gmail.com>

On Fri, Sep 24, 2010 at 11:02 AM, Vukasin Toroman <vukasin at toroman.name> wrote:
> Hi David,
>
> I think they meant this specification:
>
> http://www.rabbitmq.com/specification.html

Hm, I do not  think so, that page is about rabbitmq implementation of
0.8, and 0.9 protocol, and I was referring to the public review of 1.0
spec, which differs a lot from 0.8, and 0.9

But thanks!

Davorin Rusevljan
http://www.cloud208.com/

From vukasin at toroman.name  Fri Sep 24 10:28:48 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Fri, 24 Sep 2010 11:28:48 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
Message-ID: <25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>

In that you should check this out:

http://www.amqp.org/confluence/display/AMQP/AMQP+Specification

Best,
Vukasin


On Sep 24, 2010, at 10:55 , Davorin Rusevljan wrote:

> On Wed, May 5, 2010 at 9:58 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Hi everyone,
>> 
>> As part of an ongoing drive to "be more open" as well as to "get to
>> 1.0" the AMQP Working Group has published the 1-0 PR3 draft on the
>> webs for Public Comment:
>> http://www.amqp.org/confluence/download/attachments/2523279/amqp_1-0_PR3.pdf
>> 
>> I would be thrilled if the whole community could take a look at this.
>> 
>> Please:
>> 
>> - Be quick!  We need comments asap.
> 
> Well, this would hardly count as quick but here are some questions:
> 
> 1)
> Chapter 3 on Composite types in Book II Data types, on page 27 states:
> "Compound types are formally defined in XML documents included with
> specification."
> 
> Where are those XML documents located? I have found some in sample
> Python broker, and I guess some of the xml sources used to build the
> spec document could be used to extract that information, but I guess
> they should be really packaged together with the spec.
> 
> More importantly, the format that is used to formally describe types
> is not specified at all (or I have managed to miss it :) ). While
> format does seem somehow natural, and recently added FAQ section on
> the web site does address some of the issues, it definitely needs to
> be described what each xml node and every possible attribute means,
> and how do they interact. Without that whole type system seems to be
> hanging in the air.  (again my apologizes if such definitions exists
> and I have missed them)
> 
> 2) Is there some kind of forum, or additional resources that potential
> implementor of amqp related software might use? I have signed the
> reviewer license, and received congrats on that, but I do not see it
> offers any additional information that I could use, even not the
> suggest way to send comments in and to whom to address them.
> 
> Many thanks!
> 
> Davorin Rusevljan
> http://www.cloud208.com/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From davorin.rusevljan at gmail.com  Fri Sep 24 10:43:24 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Fri, 24 Sep 2010 11:43:24 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
Message-ID: <AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>

On Fri, Sep 24, 2010 at 11:28 AM, Vukasin Toroman <vukasin at toroman.name> wrote:
> In that you should check this out:
>
> http://www.amqp.org/confluence/display/AMQP/AMQP+Specification

Great!

Now I am only missing detailed explanations of what each node and
attribute means in type definitions.

Davorin

From vukasin at toroman.name  Fri Sep 24 10:49:31 2010
From: vukasin at toroman.name (Vukasin Toroman)
Date: Fri, 24 Sep 2010 11:49:31 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
Message-ID: <C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>

Hi Davorin,

well you're on your own there, that spec is way more xml that I'd like to tackle :-). A good place to start are the commands and their responses definitions since that is what you as a client will be interacting with.

Good Luck,
Vukasin


On Sep 24, 2010, at 11:43 , Davorin Rusevljan wrote:

> On Fri, Sep 24, 2010 at 11:28 AM, Vukasin Toroman <vukasin at toroman.name> wrote:
>> In that you should check this out:
>> 
>> http://www.amqp.org/confluence/display/AMQP/AMQP+Specification
> 
> Great!
> 
> Now I am only missing detailed explanations of what each node and
> attribute means in type definitions.
> 
> Davorin


From v.p.saravanan at gmail.com  Fri Sep 24 11:26:35 2010
From: v.p.saravanan at gmail.com (specialsaran)
Date: Fri, 24 Sep 2010 10:26:35 +0000 (UTC)
Subject: [rabbitmq-discuss] How to use Consumer as Producer in rabbitmq
References: <29736359.post@talk.nabble.com> <29788719.post@talk.nabble.com>
Message-ID: <loom.20100924T122158-342@post.gmane.org>

Hi,

Thanks for the reply.

I cant see those two files (Service.java and Result.java). Pls post it again  

Regards
Saran






From mmenti at gmail.com  Fri Sep 24 12:07:13 2010
From: mmenti at gmail.com (Mario Menti)
Date: Fri, 24 Sep 2010 12:07:13 +0100
Subject: [rabbitmq-discuss] number of Erlang processes being used?
Message-ID: <4C9C8661.50909@gmail.com>

Apologies if this is a bit of a n00b question, but I haven't found the 
answer anywhere else:

Is there a way to see the number of lightweight Erlang processes 
currently in use by rabbitmq? We regularly run out of them, even with a 
higher-than-default number being specified (65535), and while I realise 
that there may be an underlying issue, it would still be very useful to 
monitor the usage.

Secondly, are there any guidlines re. the maximum recommended number of 
Erlang processes we should/could specify for a given machine spec (we're 
running on a RHEL server with 24GB RAM).

Note we're still running 1.7.2, not moved to 2.x yet.

Cheers,
Mario.

From matthew at rabbitmq.com  Fri Sep 24 12:22:10 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 24 Sep 2010 12:22:10 +0100
Subject: [rabbitmq-discuss] number of Erlang processes being used?
In-Reply-To: <4C9C8661.50909@gmail.com>
References: <4C9C8661.50909@gmail.com>
Message-ID: <20100924112210.GN19612@rabbitmq.com>

On Fri, Sep 24, 2010 at 12:07:13PM +0100, Mario Menti wrote:
> Is there a way to see the number of lightweight Erlang processes
> currently in use by rabbitmq? We regularly run out of them, even
> with a higher-than-default number being specified (65535), and while
> I realise that there may be an underlying issue, it would still be
> very useful to monitor the usage.

No - there's no way of figuring this out other than the total number of
processes being used in the erlang VM. Thus if you're using other
applications within the same VM, you won't be able to separate them out.

length(erlang:processes()).
 will tell you the total number of processes running in the VM.

Btw, you're not helping yourselves by running such an old version - we
pushed the default limit up to 1e6 around 1.8. You shouldn't have many
concerns with raising your limit substantially further (though it will
mean the VM will take up a bit more memory which might be relevant if
you're running in an embedded environment). The absolute maximum is 16bn
but if you use that I think I found the base VM on its own takes up some
400MB after booting (just due to the various arrays and bookkeeping
needed for every process). Given your 24GB of RAM, I would think that
you're not in an embedded enviroment and such paltry amounts of memory
are not a concern!

Matthew

From mmenti at gmail.com  Fri Sep 24 12:33:37 2010
From: mmenti at gmail.com (Mario Menti)
Date: Fri, 24 Sep 2010 12:33:37 +0100
Subject: [rabbitmq-discuss] number of Erlang processes being used?
In-Reply-To: <20100924112210.GN19612@rabbitmq.com>
References: <4C9C8661.50909@gmail.com> <20100924112210.GN19612@rabbitmq.com>
Message-ID: <4C9C8C91.6000001@gmail.com>

Matthew Sackman wrote:
> On Fri, Sep 24, 2010 at 12:07:13PM +0100, Mario Menti wrote:
>> Is there a way to see the number of lightweight Erlang processes
>> currently in use by rabbitmq? We regularly run out of them, even
>> with a higher-than-default number being specified (65535), and while
>> I realise that there may be an underlying issue, it would still be
>> very useful to monitor the usage.
>
> No - there's no way of figuring this out other than the total number of
> processes being used in the erlang VM. Thus if you're using other
> applications within the same VM, you won't be able to separate them out.
>
> length(erlang:processes()).
>   will tell you the total number of processes running in the VM.
Thanks - there's nothing else running in the VM, so this should be good 
enough.
> Btw, you're not helping yourselves by running such an old version - we
> pushed the default limit up to 1e6 around 1.8. You shouldn't have many
> concerns with raising your limit substantially further (though it will
> mean the VM will take up a bit more memory which might be relevant if
> you're running in an embedded environment). The absolute maximum is 16bn
> but if you use that I think I found the base VM on its own takes up some
> 400MB after booting (just due to the various arrays and bookkeeping
> needed for every process). Given your 24GB of RAM, I would think that
> you're not in an embedded enviroment and such paltry amounts of memory
> are not a concern!

Yes, these are dedicated servers. Thanks for the additional info - 
updating to latest/later versions of rabbitmq is pretty high somewhere 
on our Todo list :)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/eb8dcc47/attachment.htm>

From mcallus at gmail.com  Fri Sep 24 12:35:05 2010
From: mcallus at gmail.com (=?ISO-8859-1?B?SXNh7WFz?=)
Date: Fri, 24 Sep 2010 13:35:05 +0200
Subject: [rabbitmq-discuss] multiple threads in one queue
Message-ID: <AANLkTi=2ZWrjY_WHhCx9+ASFfDYGmdfj8L5eV26XFLP=@mail.gmail.com>

Hi All
I have a problem/doubt with a rabbit queue

I need that 25 threads consume one rabbit queue.

In this moment, I have an unique channel and consumer in a main thread, it
consume the queue and save the content in a normal java queue.

The sons threads get the tasks from java queue, i want know how can I send
one delay ack because my main thread can not follow consuming the rabbit
queue if i does not send the ack inmediately.

When the task finishs correctly in a son thread, it saves the task in a
second queue that main thread read and send the ack for this task to
eliminate the task from rabbit queue.

Is it possible this?? or is it better that i have one syncronize channel and
one syncronize consumer and that all threads consume the rabbit queue?

I show you the code that consume the queues

         try{
                ConnectionFactory factory = new ConnectionFactory();

                factory.setUsername(GesAgregaConstant.USER_RABBITMQ);
                factory.setPassword(GesAgregaConstant.PASS_RABBITMQ);

factory.setVirtualHost(GesAgregaConstant.VIRTUALHOST_RABBITMQ);
                factory.setRequestedHeartbeat(0);
                factory.setHost(GesAgregaConstant.SERVER_HOST_RABBITMQ);
                factory.setPort(GesAgregaConstant.SERVER_PORT_RABBITMQ);

                Connection conn = factory.newConnection();

                channel = conn.createChannel();
                String queueName = GesAgregaConstant.QUEUE_TAREAS_RABBITMQ;

                channel.basicQos(1);
                boolean noAck = false;

                QueueingConsumer consumer = new QueueingConsumer(channel);

                channel.basicConsume(queueName, noAck, consumer);
                boolean runInfinite = true;

                while (runInfinite) {

                    QueueingConsumer.Delivery delivery;
                    try {

                        //TODO poner el ack de todos los elementos de la
cola
                        synchronized (qAck){
                            while(qAck.size()>0){
                               UrlControl cAck = qAck.remove();
                               System.out.println("Sale DE LA COLA" +
cAck.getUrl() +"ACK " + cAck.getDelivery());
                               channel.basicAck(cAck.getDelivery(), false);
                            }
                        }

                        delivery = consumer.nextDelivery();

                        String url = new String(delivery.getBody());

                        System.out.println("CRAWLING " + url);
                        UrlControl cControl = new
UrlControl(url,delivery.getEnvelope().getDeliveryTag());

                        q.push(cControl,0);
                        //q.push(new URL(url),0);
                        tc.startThreads();

                    } catch (InterruptedException ie) {
                        continue;
                    } /*catch (IOException e) {
                        continue;
                    }*/catch (Exception e) {
                        continue;
                    }
                }

                channel.close();
                conn.close();

            }catch(IOException ioe){
                ioe.printStackTrace();
            }catch(Exception e){
                e.printStackTrace();
            }


Thank you.
Regards,
Isaias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/0dd888c0/attachment.htm>

From videlalvaro at gmail.com  Fri Sep 24 12:59:42 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 24 Sep 2010 19:59:42 +0800
Subject: [rabbitmq-discuss] number of Erlang processes being used?
In-Reply-To: <4C9C8C91.6000001@gmail.com>
References: <4C9C8661.50909@gmail.com> <20100924112210.GN19612@rabbitmq.com>
	<4C9C8C91.6000001@gmail.com>
Message-ID: <D14F65F7-757B-4095-B1CB-6D173A5EE774@gmail.com>

Hi,

In prod we are using a script like this: http://gist.github.com/595243 to find the number of Erlang processes and then we send that to Graphite to keep some nice graphs about it.

We had the same problem as you, running out of Erlang processes. That happened because our client library was creating one channel per message sent, that meant one new process on the Erlang side AFAIK. We gave the channels specific IDs and the problem got solved.

Regards,

Alvaro

On Sep 24, 2010, at 7:33 PM, Mario Menti wrote:

> Matthew Sackman wrote:
>> 
>> On Fri, Sep 24, 2010 at 12:07:13PM +0100, Mario Menti wrote:
>>> Is there a way to see the number of lightweight Erlang processes
>>> currently in use by rabbitmq? We regularly run out of them, even
>>> with a higher-than-default number being specified (65535), and while
>>> I realise that there may be an underlying issue, it would still be
>>> very useful to monitor the usage.
>> 
>> No - there's no way of figuring this out other than the total number of
>> processes being used in the erlang VM. Thus if you're using other
>> applications within the same VM, you won't be able to separate them out.
>> 
>> length(erlang:processes()).
>>  will tell you the total number of processes running in the VM.
> Thanks - there's nothing else running in the VM, so this should be good enough.
>> Btw, you're not helping yourselves by running such an old version - we
>> pushed the default limit up to 1e6 around 1.8. You shouldn't have many
>> concerns with raising your limit substantially further (though it will
>> mean the VM will take up a bit more memory which might be relevant if
>> you're running in an embedded environment). The absolute maximum is 16bn
>> but if you use that I think I found the base VM on its own takes up some
>> 400MB after booting (just due to the various arrays and bookkeeping
>> needed for every process). Given your 24GB of RAM, I would think that
>> you're not in an embedded enviroment and such paltry amounts of memory
>> are not a concern!
> 
> Yes, these are dedicated servers. Thanks for the additional info - updating to latest/later versions of rabbitmq is pretty high somewhere on our Todo list :)
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jon at jbrisbin.com  Fri Sep 24 14:12:46 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 24 Sep 2010 08:12:46 -0500
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
	<yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
	<63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>
	<57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com>
Message-ID: <6CAEB3EB-772B-44FA-AC8F-723E83808B43@jbrisbin.com>

+1 on Mac users deploying to other OSes.

It's sometimes a pain to run rabbitmq on a Mac as a service. It's convenient and all, but if I need to restart the server a lot, I'll just run the rabbitmq-server command (without sudo ;) in a terminal. I don't like to have stuff running when I'm not using it, so I don't always rely on background services. I also like seeing any stdout output without having to tail a log file.

IMHO I wouldn't plant a flag on Mac users needing a dedicated user for the broker and I'd also make it simple to optionally install the launchd service. I might not want to run it as a background service.

jb

On Sep 24, 2010, at 2:41 AM, Tim Child wrote:

> I agree, most OS X users are probably developers looking for a local solution to develop for a system which will end up deployed on another OS.
> 
> However if you want to make it a system service its not exactly a hard step to make, something which we can document, give example of the launchd scripts or whatever it needs.
> 
> Tim.
> 
> On 24 Sep 2010, at 09:00, Ian Ragsdale wrote:
> 
>> On Sep 24, 2010, at 1:46 AM, David Wragg wrote:
>> 
>>> Tony Garnock-Jones <tonyg at rabbitmq.com> writes:
>>> 
>>> But it doesn't address system services.  We package rabbitmq-server to
>>> run as a system service, because that's the way most people will want to
>>> run it.
>> 
>> I'd argue that's probably the case for a linux box, and possibly for a windows box, but I'd bet the vast majority of people running on a mac are likely to be developers writing software to be deployed elsewhere.  For that use case (my own) I much prefer the homebrew experience.  That said, if homebrew installed it under a rabbitmq account and required me to use sudo to do so, I certainly wouldn't mind doing so.
>> 
>>> If the hoembrew policy is that you should just run everything under your
>>> user account, that seems very short-sighted to me.
>>> 
>>> So the question is whether that would continue to be the case if the
>>> homebrew formula was updated to be comparable to the macports port.  The
>>> macports port might be a lot more convenient to install if we cut all
>>> the same corners.
>> 
>> Given my experiences with both, I'd be willing to bet homebrew would still be much nicer, but I certainly understand why you guys aren't interested in investing the time to get the homebrew install up to the level of the macports install in terms of functionality.  That said, it doesn't preclude you from listing it as an option on the install page, with the caveat that not everything is installed, so that people know it's an available option.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/2cc64277/attachment.htm>

From mabrek at gmail.com  Fri Sep 24 16:01:30 2010
From: mabrek at gmail.com (mabrek)
Date: Fri, 24 Sep 2010 19:01:30 +0400
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
Message-ID: <AANLkTikpVhPLc59ofGBKOBqrbz0YOwXD-OZu8T2rOy9N@mail.gmail.com>

On Fri, Sep 10, 2010 at 5:06 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> The flow control was heavily modified between 1.8.1 and 2.0.0. In summary:
> ?- 1.8.1 - we have send Channel.flow AMQP message to everyone once
> ? rabbit reached memory limit
> ?- 2.0.0 - once we reach memory limit, the connections from which we hear
> ? publishes are stopped temporarily. We stop receiving bytes from tcp sockets.
> ? That 'stop' shouldn't take too long, as data should be swapped out to disk
> ? and memory pressure will drop pretty quickly.

We use channel.basicPublish (java client) from web request handler and
need to reply quickly. Hanging basicPublish will ruin our response
time. It would be better to specify timeout on publishing or to throw
an exception in case of server reaching memory limit.

Regards,
Anton Lebedevich.

From mabrek at gmail.com  Fri Sep 24 16:12:10 2010
From: mabrek at gmail.com (mabrek)
Date: Fri, 24 Sep 2010 19:12:10 +0400
Subject: [rabbitmq-discuss] flow control issues
In-Reply-To: <AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>
References: <80F33D0A-45E8-4D2E-9B40-612BF97F378F@gmail.com>
	<04417D55-B864-4D50-9864-3E104B3F308B@orange-ftgroup.com>
	<AANLkTinTckbgOSDXwcSAQLObtPTi9m_w6aihU1ABGzZA@mail.gmail.com>
	<66299676-639B-473C-92C5-62B60836DE35@gmail.com>
	<AANLkTim6YCQJxx3-GFoWKBuyQonyDgiEnOu0SzzyAWKA@mail.gmail.com>
	<0AD84B1E-7A80-48AB-A4D9-477A577AA862@gmail.com>
	<AANLkTimL5v+vNi-aKR+735+Y4E_dxY_28Vvq4oYYdRH7@mail.gmail.com>
Message-ID: <AANLkTikuUQhWASYx5MXoSW6DR6G3P+QMTEwg3jkt1prV@mail.gmail.com>

On Thu, Sep 16, 2010 at 4:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> Yes, channels were designed exactly for that. On the other hand, AMQP
> has few pretty serious issues. For example when you open channel
> you're free to publish a message. And broker can't 'refuse' accepting
> a message. Channel.flow can be sent from the broker to the client
> but *after* channel is opened. So there is a window in which
> you just can publish (after channel.open before channel.flow). Sorry, there
> just isn't other way of forbidding publishes than by stopping the whole
> connection. I also don't like it, but it's the only way.

We do need to check stopped state of connection before sending messages.
Please leave some hints to client to decide if it can send messages
without hanging.
Something like 'boolean isPublishingAllowed()' in Channel or timeout
parameter in basicPublish would be fine.

Regards,
Anton Lebedevich.

From adam at varud.com  Fri Sep 24 19:33:56 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 24 Sep 2010 14:33:56 -0400
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
In-Reply-To: <AANLkTik_9VQ51VaEhG7odCqgFjZC-MaEXq=bNp8mdo7u@mail.gmail.com>
References: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
	<AANLkTik_9VQ51VaEhG7odCqgFjZC-MaEXq=bNp8mdo7u@mail.gmail.com>
Message-ID: <AANLkTikFO8f9z4pX49K7Vd9szFDYbWdo9aFSRvk2jjJh@mail.gmail.com>

Chandra,

It seems like a more modern OS would at least allow you to get more
assistance from others.  It looks like the common OSes to think about would
be:

Linux (I personally like Ubuntu)
Solaris
Windows 2003 or 2008
OS X Snow Leopard

I doubt many people are running RabbitMQ on Windows XP (although I could be
wrong).  You can spin up an instance on any of these OSes on Amazon ec2
pretty cheaply.

-Adam

On Thu, Sep 23, 2010 at 1:01 PM, Chandra R <mybayworkz at gmail.com> wrote:

> Hi,
> I still couldn't run it. This time I created a new windows xp VM with 3.5
> gb ram and installed rabbitmq 2.1.0 on it. But it still crashing on start as
> erl.exe memory usage -585,332 k.
>
> Is there something else I can try to run it please ?
>
> Thank you for any input/advise.
>
> Chandra
>
>
> On Thu, Sep 23, 2010 at 8:22 AM, Chandra R <mybayworkz at gmail.com> wrote:
>
>> Hello,
>>
>> I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But
>> it is crashing on start.
>> Activating Rabbitmq plugins ...0 plugins activated and it crashes as
>> erl.exe uses up all the memory.
>>
>> Is it because of resources  because I have set all the class paths and
>> have erlang installed at C:\Elang\erl5.7.4
>> and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
>> were some issues when trying to install at "Program files" because of the
>> space in the folder name.
>>
>> Thank you for any help advice.
>> ------------------ from erl_crash.dump-------------------------------
>>
>> =erl_crash_dump:0.1
>> Thu Sep 23 08:19:02 2010
>> Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
>> "heap").
>> System version: Erlang R13B03 (erts-5.7.4) [rq:1] [async-threads:30]
>> Compiled: Tue Nov 24 11:12:28 2009
>> Atoms: 7290
>> =memory
>> total: 1175947208
>> processes: 1172250988
>> processes_used: 1172248436
>> system: 3696220
>> atom: 328561
>> atom_used: 315456
>>
>> regards
>> Chandra
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/1c3b098c/attachment-0001.htm>

From adam at varud.com  Fri Sep 24 20:01:02 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 24 Sep 2010 15:01:02 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
Message-ID: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>

Alexis/David,

I think the response from the group has been awesome.  Takeaways:

1. Everybody who is on a Mac likes Homebrew.  It should at least be referred
to on the downloads page, and most likely, it should be the default
installation recommendation for Mac users.
2. David should make appropriate tickets on the Homebrew site (individual
ones, not one big one) for the naming conventions, etc... that you would
like homebrew to use.  I'm sure they'll be evenhanded.  Note item #3 though
when making the tickets.
3. Virtually all Mac users of rabbitmq are using it for development.
 Production installations for the Mac users are running Linux (frequently
Ubuntu).
4. The documentation needs a major overhaul - soon.
5. The codebase should be hosted on Github.com for easier interaction with
the wider community.
6. "it's unlikely we are going to repeat that effort for homebrew (unless
macports dies or something)." - Macports is dying - I hate to break it to
people.  Agreed, it is way ahead of Homebrew in maturity, but MacPorts is
too flawed to continue on.  The fundamental issue is that Mac is not a
server OS, so the pace of iteration on the platform is much faster than on
something like Debian/Ubuntu where it's been using the same package manager
for years and will continue to be.  All the mature features of MacPorts are
useless because nobody uses Mac as a server for anything but internal office
functions and specialized rendering stuff.  The vanguard of Mac users has
already moved to Homebrew even though it's only a few months old - that
battle is over.

Thanks so much for all the support from everybody on these issues.  I'd love
to continue using RabbitMQ and it's these types of rough edges that matter
to alot of us.

Thanks,
Adam

On Thu, Sep 23, 2010 at 5:50 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Adam, everyone,
>
> What are your thoughts on this thread?  Is this helping?
>
> alexis
>
>
>
> On Thu, Sep 23, 2010 at 1:22 PM, David Wragg <david at rabbitmq.com> wrote:
> > Adam Nelson <adam at varud.com> writes:
> >>  * Please don't tell Mac users to use MacPorts:
> >> http://www.rabbitmq.com/macports.html It's time to move them to
> HomeBrew at
> >> http://github.com/mxcl/homebrew
> >
> > I'm not a frequent OS X user.  I do have some experience with macports,
> > but it's been mixed.  So I like to think I have a fairly objective view
> > on the macports vs. homebrew thing (that being, they are both vastly
> > inferior to current Linux package systems :-)
> >
> > So with that said:
> >
> > I think we'd be happy to endorse homebrew alongside or instead of
> > macports, *if* it achieves parity with the rabbitmq-server port, and the
> > rabbitmq-server packages on Linuxes.  That means:
> >
> > - The formula should be called rabbitmq-server
> >
> > - It should create and use a rabbitmq user/group, and include the
> >  wrapper scripts to support this.
> >
> > - It should have some way to run as an automatically started daemon.
> >
> > - It should include the man pages (on-line documentation is great, man
> >  pages are too, we have both, and we want the man pages to be provided
> >  with the packages).
> >
> > - We need to have a way to distribute an update package when we make a
> >  new release, for users that are willing to bypass the central
> >  repository.
> >
> > We've made all this work for macports; it's unlikely we are going to
> > repeat that effort for homebrew (unless macports dies or something).
> >
> > But if someone in the community wants to work on getting the homebrew
> > formula into the same shape, that would be great.  We could work with
> > them to integrate it into our build/release process.
> >
> > David
> >
> > --
> > David Wragg
> > Staff Engineer, RabbitMQ
> > SpringSource, a division of VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/63172fbb/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 24 20:41:05 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Sep 2010 20:41:05 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
Message-ID: <4C9CFED1.40207@rabbitmq.com>

Adam,

Adam Nelson wrote:
> 1. Everybody who is on a Mac likes Homebrew.  It should at least be 
> referred to on the downloads page, and most likely, it should be the 
> default installation recommendation for Mac users.  
> 2. David should make appropriate tickets on the Homebrew site 
> (individual ones, not one big one) for the naming conventions, etc... 
> that you would like homebrew to use.  I'm sure they'll be evenhanded. 

David's list contained a number of suggestions based on our experience 
with packaging rabbit for other platforms and the desire to keep the 
setup similar across platforms. If none of the homebrew users of rabbit 
think they need any of that stuff then nothing needs to be done.

We do not have the bandwidth to maintain the homebrew formula ourselves, 
and we do not want to recommend a preferred installation option for a 
platform unless we can be confident that said option is going to be 
actively maintained.

With that in mind, would you, perhaps together with some of the other 
homebrew users who have posted on this thread, be willing to become the 
maintainer of the rabbitmq-server homebrew formula?

We would certainly support you in that effort.

> 4. The documentation needs a major overhaul - soon.

We try to improve the docs incrementally. If say, you had one day to 
improve some aspect of the docs, what would be top of your list?

> 5. The codebase should be hosted on Github.com for easier interaction 
> with the wider community.

All our public hg repos are now mirrored onto github.

> 6. "it's unlikely we are going to repeat that effort for homebrew 
> (unless macports dies or something)." - Macports is dying - I hate to 
> break it to people.  Agreed, it is way ahead of Homebrew in maturity, 
> but MacPorts is too flawed to continue on.

And eventually homebrew will morph into or be replaced by something that 
more resembles the current package managers of mature Linux distributions ;)


Regards,

Matthias.

From adam at varud.com  Fri Sep 24 21:06:05 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 24 Sep 2010 16:06:05 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <4C9CFED1.40207@rabbitmq.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
Message-ID: <AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>

Matthias,

On Fri, Sep 24, 2010 at 3:41 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Adam,
>
>
> Adam Nelson wrote:
>
>> 1. Everybody who is on a Mac likes Homebrew.  It should at least be
>> referred to on the downloads page, and most likely, it should be the default
>> installation recommendation for Mac users.  2. David should make appropriate
>> tickets on the Homebrew site (individual ones, not one big one) for the
>> naming conventions, etc... that you would like homebrew to use.  I'm sure
>> they'll be evenhanded.
>>
>
> David's list contained a number of suggestions based on our experience with
> packaging rabbit for other platforms and the desire to keep the setup
> similar across platforms. If none of the homebrew users of rabbit think they
> need any of that stuff then nothing needs to be done.
>
> We do not have the bandwidth to maintain the homebrew formula ourselves,
> and we do not want to recommend a preferred installation option for a
> platform unless we can be confident that said option is going to be actively
> maintained.
>
> With that in mind, would you, perhaps together with some of the other
> homebrew users who have posted on this thread, be willing to become the
> maintainer of the rabbitmq-server homebrew formula?
>
> We would certainly support you in that effort.
>
> The homebrew rabbitmq installation already exists and is maintained.  It's
just a matter of updating your documentation so new rabbitmq users on Mac
know what the easiest installation solution is.  I'm not advocating getting
rid of the MacPorts implementation, just that your documentation lets new
users know that most users of rabbitmq, who are developing on Mac, are using
the homebrew installation.


>  4. The documentation needs a major overhaul - soon.
>>
>
> We try to improve the docs incrementally. If say, you had one day to
> improve some aspect of the docs, what would be top of your list?
>
>
> Don't change any of the text or worry about versions (like I brought up
earlier).  Just focus on organizing the existing documentation, deleting any
low quality documents, and putting high quality documents onto the 'Getting
Started' page.


> 5. The codebase should be hosted on Github.com for easier interaction with
>> the wider community.
>>
>
> All our public hg repos are now mirrored onto github.
>
> Awesome.

>
>  6. "it's unlikely we are going to repeat that effort for homebrew (unless
>> macports dies or something)." - Macports is dying - I hate to break it to
>> people.  Agreed, it is way ahead of Homebrew in maturity, but MacPorts is
>> too flawed to continue on.
>>
>
> And eventually homebrew will morph into or be replaced by something that
> more resembles the current package managers of mature Linux distributions ;)
>
> :-)

But doubtful as homebrew satisfies the 'Mac is for developers' situation -
which is all that's needed.

>
> Regards,
>
> Matthias.
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/b848647a/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 24 21:47:31 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Sep 2010 21:47:31 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
Message-ID: <4C9D0E63.2030708@rabbitmq.com>

Adam,

Adam Nelson wrote:
> The homebrew rabbitmq installation already exists and is maintained. 

Who is maintaining it? For all official rabbit distributions which we do 
not maintain directly ourselves we know the individuals who maintain 
them and liaise with them for new releases, resolution of any problems 
reported to them about rabbit vs to us about their packaging, etc.

Also, note that the rabbitmq formula is still stuck at version 2.0.0 
nine days after 2.1.0 was released. And 2.0.0 itself took 13 days to 
appear. Now, to me 13 days seems quite ok, but what kind of turnaround 
do homebrew users generally expect? Contrast this, for example, with the 
latest release of Erlang/OTP, which came out on the same day as rabbit 
2.1.0 and only took three days to appear in homebrew.


Regards,

Matthias.

From adam at varud.com  Fri Sep 24 21:54:57 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 24 Sep 2010 16:54:57 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <4C9D0E63.2030708@rabbitmq.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
Message-ID: <AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>

Matthias,

I'm kind of confused about your point.  Ubuntu isn't even beyond the 1.8
series and it's likely one of the most heavily used production distributions
of rabbitmq.

I don't know why there's pushback on this.  Everybody who responded to this
thread who uses Mac was +1 for simply including Homebrew in your
documentation.

Do whatever you want.

-Adam

On Fri, Sep 24, 2010 at 4:47 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Adam,
>
>
> Adam Nelson wrote:
>
>> The homebrew rabbitmq installation already exists and is maintained.
>>
>
> Who is maintaining it? For all official rabbit distributions which we do
> not maintain directly ourselves we know the individuals who maintain them
> and liaise with them for new releases, resolution of any problems reported
> to them about rabbit vs to us about their packaging, etc.
>
> Also, note that the rabbitmq formula is still stuck at version 2.0.0 nine
> days after 2.1.0 was released. And 2.0.0 itself took 13 days to appear. Now,
> to me 13 days seems quite ok, but what kind of turnaround do homebrew users
> generally expect? Contrast this, for example, with the latest release of
> Erlang/OTP, which came out on the same day as rabbit 2.1.0 and only took
> three days to appear in homebrew.
>
>
> Regards,
>
> Matthias.
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/5f25c8a2/attachment.htm>

From alexis at rabbitmq.com  Fri Sep 24 22:16:58 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 24 Sep 2010 22:16:58 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
Message-ID: <AANLkTin7heknf-z2BeS8wPBpEHcUYy2QXnnmGukx3KCT@mail.gmail.com>

Thank you!



On 24/09/2010, Adam Nelson <adam at varud.com> wrote:
> Alexis/David,
>
> I think the response from the group has been awesome.  Takeaways:
>
> 1. Everybody who is on a Mac likes Homebrew.  It should at least be referred
> to on the downloads page, and most likely, it should be the default
> installation recommendation for Mac users.
> 2. David should make appropriate tickets on the Homebrew site (individual
> ones, not one big one) for the naming conventions, etc... that you would
> like homebrew to use.  I'm sure they'll be evenhanded.  Note item #3 though
> when making the tickets.
> 3. Virtually all Mac users of rabbitmq are using it for development.
>  Production installations for the Mac users are running Linux (frequently
> Ubuntu).
> 4. The documentation needs a major overhaul - soon.
> 5. The codebase should be hosted on Github.com for easier interaction with
> the wider community.
> 6. "it's unlikely we are going to repeat that effort for homebrew (unless
> macports dies or something)." - Macports is dying - I hate to break it to
> people.  Agreed, it is way ahead of Homebrew in maturity, but MacPorts is
> too flawed to continue on.  The fundamental issue is that Mac is not a
> server OS, so the pace of iteration on the platform is much faster than on
> something like Debian/Ubuntu where it's been using the same package manager
> for years and will continue to be.  All the mature features of MacPorts are
> useless because nobody uses Mac as a server for anything but internal office
> functions and specialized rendering stuff.  The vanguard of Mac users has
> already moved to Homebrew even though it's only a few months old - that
> battle is over.
>
> Thanks so much for all the support from everybody on these issues.  I'd love
> to continue using RabbitMQ and it's these types of rough edges that matter
> to alot of us.
>
> Thanks,
> Adam
>
> On Thu, Sep 23, 2010 at 5:50 PM, Alexis Richardson
> <alexis at rabbitmq.com>wrote:
>
>> Adam, everyone,
>>
>> What are your thoughts on this thread?  Is this helping?
>>
>> alexis
>>
>>
>>
>> On Thu, Sep 23, 2010 at 1:22 PM, David Wragg <david at rabbitmq.com> wrote:
>> > Adam Nelson <adam at varud.com> writes:
>> >>  * Please don't tell Mac users to use MacPorts:
>> >> http://www.rabbitmq.com/macports.html It's time to move them to
>> HomeBrew at
>> >> http://github.com/mxcl/homebrew
>> >
>> > I'm not a frequent OS X user.  I do have some experience with macports,
>> > but it's been mixed.  So I like to think I have a fairly objective view
>> > on the macports vs. homebrew thing (that being, they are both vastly
>> > inferior to current Linux package systems :-)
>> >
>> > So with that said:
>> >
>> > I think we'd be happy to endorse homebrew alongside or instead of
>> > macports, *if* it achieves parity with the rabbitmq-server port, and the
>> > rabbitmq-server packages on Linuxes.  That means:
>> >
>> > - The formula should be called rabbitmq-server
>> >
>> > - It should create and use a rabbitmq user/group, and include the
>> >  wrapper scripts to support this.
>> >
>> > - It should have some way to run as an automatically started daemon.
>> >
>> > - It should include the man pages (on-line documentation is great, man
>> >  pages are too, we have both, and we want the man pages to be provided
>> >  with the packages).
>> >
>> > - We need to have a way to distribute an update package when we make a
>> >  new release, for users that are willing to bypass the central
>> >  repository.
>> >
>> > We've made all this work for macports; it's unlikely we are going to
>> > repeat that effort for homebrew (unless macports dies or something).
>> >
>> > But if someone in the community wants to work on getting the homebrew
>> > formula into the same shape, that would be great.  We could work with
>> > them to integrate it into our build/release process.
>> >
>> > David
>> >
>> > --
>> > David Wragg
>> > Staff Engineer, RabbitMQ
>> > SpringSource, a division of VMware
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>
>
>
> --
> Adam
>

-- 
Sent from my mobile device

From nfontes at cynigram.com  Fri Sep 24 22:57:16 2010
From: nfontes at cynigram.com (Noah Fontes)
Date: Fri, 24 Sep 2010 16:57:16 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>	<4C9CFED1.40207@rabbitmq.com>	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
Message-ID: <4C9D1EBC.6010608@cynigram.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Adam,

On 09/24/2010 03:54 PM, Adam Nelson wrote:
> I don't know why there's pushback on this.  Everybody who responded to
> this thread who uses Mac was +1 for simply including Homebrew in your
> documentation.

The "pushback" is because it's not trivial to endorse a third-party
solution when you have no way to provide support for it. Because
inevitably when you do this, people will start coming to you for support
instead of the third party -- and then getting angry with you when you
say you can't help them. :)

Of course, they could publish their own version but it sounds like they
don't want to commit to doing that right now for several reasons
discussed previously.

> Do whatever you want.

I think your attitude is a little unacceptable. You seem to have some
grandiose ideas about how RabbitMQ should be developed with little
understanding of most of the community and developers surrounding it.
Saying things like "The documentation needs a major overhaul - soon."
is, to me, obnoxious having dealt with products whose documentation is
so abhorrent that it was far quicker to either attempt to read the
source code or, failing that, just find an alternative solution (the
case for probably 80% of all open-source projects, if not more). This is
not the case with RabbitMQ at all -- most of their documentation is
excellent, and although some is slightly outdated it's still valuable
because 99% of the concepts haven't changed between releases.

Please have a little respect for the engineers at RabbitMQ; I'd much
rather they focus on creating a stable, high-performance message-queuing
platform than spend their time trying to figure out how to migrate their
entire repository to git so you can fork and do pull requests by
clicking buttons instead of typing commands (and it's not like you can't
send patches to the mailing list or to their awesome legitimate
grievance address).

Not trying to start a flamewar or anything here, and you definitely make
some good points (e.g., RabbitMQ could use some better "beginner-level"
documentation imo -- it took me a few experiments to sort out how
exchanges, routing keys, and queues interacted for sure). Just my $0.02...

Regards,

Noah
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkydHrwACgkQhitK+HuUQJRKAQCggbn6jXAURZoRSjLWEcnfhbJS
s9IAoJsmgZ6xBf77rkwFt9a9oBTNdswX
=8xdk
-----END PGP SIGNATURE-----

From matthias at rabbitmq.com  Fri Sep 24 23:41:55 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 24 Sep 2010 23:41:55 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>	<4C9CFED1.40207@rabbitmq.com>	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
Message-ID: <4C9D2933.1060401@rabbitmq.com>

Adam,

Adam Nelson wrote:
> I'm kind of confused about your point.  Ubuntu isn't even beyond the 1.8 
> series and it's likely one of the most heavily used production 
> distributions of rabbitmq.

Ubuntu is an excellent example. They have quite a rigid release regime, 
so it can take a while for an upstream package to make it into a 
release. Ubuntu users are used to that. The question is, what do 
homebrew users expect?

We do have contacts at Canonical who we liaise with regarding the 
rabbitmq packaging. Quite a few issues with rabbit and its packaging 
have been resolved that way.  We'd like that situation to be the same 
for homebrew one day. Let's see what we can do in the meantime ...

> I don't know why there's pushback on this.  Everybody who responded to 
> this thread who uses Mac was +1 for simply including Homebrew in your 
> documentation.

My underlying motivation for enquiring about the maintainer status of 
the rabbitmq homebrew formula is so that I can phrase the addition to 
our documentation appropriately.

I've taken a first stab at mentioning homebrew in 
http://www.rabbitmq.com/server.html.

I'd also like to add something to http://www.rabbitmq.com/install.html 
at some point but that involves first figuring out what the equivalent 
of http://www.rabbitmq.com/install.html#macports looks like for 
homebrew, which I am not in a position to ascertain atm.


Regards,

Matthias.

From adam at varud.com  Sat Sep 25 03:23:12 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 24 Sep 2010 22:23:12 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <4C9D2933.1060401@rabbitmq.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
Message-ID: <AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>

Matthias,

Ubuntu is an excellent example. They have quite a rigid release regime, so
> it can take a while for an upstream package to make it into a release.
> Ubuntu users are used to that. The question is, what do homebrew users
> expect?
>
> We do have contacts at Canonical who we liaise with regarding the rabbitmq
> packaging. Quite a few issues with rabbit and its packaging have been
> resolved that way.  We'd like that situation to be the same for homebrew one
> day. Let's see what we can do in the meantime ...
>
>
> Homebrew is kind of a ... 'homebrew' right now.  I wish this hadn't been
picked up as the main point of the thread, because it's really the most
minor point - meant more as an example than anything else.

Anyway, here are some instructions:

http://ask.github.com/celery/getting-started/broker-installation.html#installing-rabbitmq-on-os-x

Thanks,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100924/4a60bfca/attachment.htm>

From david at rabbitmq.com  Sat Sep 25 09:09:11 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 25 Sep 2010 09:09:11 +0100
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com> (Tim Child's
	message of "Fri, 24 Sep 2010 09:41:42 +0200")
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
	<yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
	<63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>
	<57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com>
Message-ID: <yrv4cocbmjlco.fsf@dwragg.eng.vmware.com>

Tim Child <tim at cantemo.com> writes:
> I agree, most OS X users are probably developers looking for a local
> solution to develop for a system which will end up deployed on another
> OS.

Running rabbit as a service is very convenient, even if you are just
developing with rabbit.  That's what I do, unless I'm working on rabbit
itself or its plugins.  The idea that you only need to run it as a
service for deployment is one I haven't heard suggested until this
thread.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From ian.ragsdale at gmail.com  Sat Sep 25 09:33:37 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Sat, 25 Sep 2010 03:33:37 -0500
Subject: [rabbitmq-discuss] Homebrew RabbitMQ
In-Reply-To: <yrv4cocbmjlco.fsf@dwragg.eng.vmware.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<4C9BE148.7030401@rabbitmq.com>
	<yrv4cy6arhc5j.fsf_-_@dwragg.eng.vmware.com>
	<63D1B089-8E6F-435E-B3F1-5FC2FDAE78F1@gmail.com>
	<57B08C01-0E24-4677-80F4-60EB0E156B8C@cantemo.com>
	<yrv4cocbmjlco.fsf@dwragg.eng.vmware.com>
Message-ID: <07FC9033-D462-4A36-9800-E8A4B8AE715E@gmail.com>

It's quite convenient, and I don't think that anyone believes running it as a service is a detriment.  All things being equal, I'd prefer to have it running as a service.  However, in my own environment the advantages of having it run as a service are far outweighed by the extra 6GB of stuff (perhaps an exaggeration, but not by much) that macports want to install to get it running. 

- Ian

On Sep 25, 2010, at 3:09 AM, David Wragg wrote:

> Tim Child <tim at cantemo.com> writes:
>> I agree, most OS X users are probably developers looking for a local
>> solution to develop for a system which will end up deployed on another
>> OS.
> 
> Running rabbit as a service is very convenient, even if you are just
> developing with rabbit.  That's what I do, unless I'm working on rabbit
> itself or its plugins.  The idea that you only need to run it as a
> service for deployment is one I haven't heard suggested until this
> thread.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From nathan.marz at gmail.com  Sat Sep 25 01:25:00 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Fri, 24 Sep 2010 17:25:00 -0700 (PDT)
Subject: [rabbitmq-discuss] How do you configure where RabbitMQ persists
	data?
Message-ID: <9a30fb05-2e93-40b9-937b-a45aa4016b54@w15g2000pro.googlegroups.com>

I'd like to run RabbitMQ on EC2 and have it persist data to an EBS
drive. How do you configure RabbitMQ to write to a specified
directory?

Thanks,
Nathan Marz

From graham_smth at rediffmail.com  Sat Sep 25 05:52:19 2010
From: graham_smth at rediffmail.com (Graham Smith)
Date: Sat, 25 Sep 2010 04:52:19 -0000
Subject: [rabbitmq-discuss] =?utf-8?q?Atencion?=
Message-ID: <20100826124225.5990.qmail@f6mail-144-202.rediffmail.com>

Buenos Dias,

Me llamo Graham Smith, soy abogado privado en grande breta?a se trata de un asunto muy confidencial y necesito tu colaboraci?n. Aqu? va el asunto. Tengo un cliente difundo que se llamaba Patricio Moreno es un venezuelano que viv?a aqu? en Londres. el muri? hace 2 a?os. es una de las v?ctimas del accidente a?reo de Spanair el 20 de agosto de 2008 en el aeropuerto de Madrid Bajaras. El dejo una empresa industrial de textil aqu? en Londres ,un mes antes de su muerte el hizo un deposito de grande cantidad de dinero en una compa??a privada de financia y seguro aqu? en Londres la suma es de 4.000.000.00 Euros (Cuatro millones de euros ) y yo he sido testigo de ese fondo depositado.

Desde que muri? nadie ha venido a reclamar ese dinero, la empresa de compa??a de financia y seguro me llamaron varias veces para que si podr?a encontrar a uno de su miembro de familia para que vengan a reclamar el dinero depositado sinon ellos lo van a deposita en una cuenta del gobierno aqu? en Londres. 


Fui a Espa?a a buscar un miembro de su familia en una direcci?n que me dio a caso si tuviera un problema, pero cuando llegue en esta direcci?n nadie vive mas all?, yo decid? ponerme en contacto con usted para presentarle a la empresa como miembro de la familia extendida, ademas tengo todo los documentos relacionados a los fondos depositados, por lo que el fondo ser? lanzado a usted para nuestro beneficio.

Si usted acepta mandarme una repuesta por mi correo electr?nico para obtener mas informaci?n acerca de c?mo proceder en este caso voy estar esperando vuestra respuesta impacientemente. Por favor, responda a mi correo electr?nico, ya que esta informaci?n es secreta y confidencial
Email: grahamsmith2000 at aol.com 
Gracias por su atenci?n.


Graham Smith (Esq.)  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/73b07c07/attachment.htm>

From matthew at rabbitmq.com  Sat Sep 25 09:56:54 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 25 Sep 2010 09:56:54 +0100
Subject: [rabbitmq-discuss] How do you configure where RabbitMQ persists
 data?
In-Reply-To: <9a30fb05-2e93-40b9-937b-a45aa4016b54@w15g2000pro.googlegroups.com>
References: <9a30fb05-2e93-40b9-937b-a45aa4016b54@w15g2000pro.googlegroups.com>
Message-ID: <20100925085653.GB12677@rabbitmq.com>

On Fri, Sep 24, 2010 at 05:25:00PM -0700, nathanmarz wrote:
> I'd like to run RabbitMQ on EC2 and have it persist data to an EBS
> drive. How do you configure RabbitMQ to write to a specified
> directory?

Set _either_ the environment variable RABBITMQ_MNESIA_BASE or in
/etc/rabbitmq/rabbitmq.conf, set the variblae MNESIA_BASE. In both
cases, the value should be the directory in which you want Rabbit to
write.

Matthew

From matthias at rabbitmq.com  Sat Sep 25 11:57:08 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 25 Sep 2010 11:57:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.0 hanging
In-Reply-To: <6AD9DBF5-08F3-4BEA-A2AB-67AAE9DA6EBD@yahoo.com>
References: <142084.58889.qm@web111008.mail.gq1.yahoo.com>
	<20100913145324.GC15229@rabbitmq.com>
	<72349.33530.qm@web111005.mail.gq1.yahoo.com>
	<408524.76533.qm@web111011.mail.gq1.yahoo.com>
	<4C8FC962.2040401@cynigram.com>
	<AANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP+7Suy@mail.gmail.com>
	<77712.94210.qm@web111015.mail.gq1.yahoo.com>
	<4C8FDCE4.6050209@rabbitmq.com>
	<629763.47711.qm@web111015.mail.gq1.yahoo.com>
	<4C90D79E.5060704@rabbitmq.com>
	<6AD9DBF5-08F3-4BEA-A2AB-67AAE9DA6EBD@yahoo.com>
Message-ID: <4C9DD584.7010004@rabbitmq.com>

Dave,

Dave Greggory wrote:
> I am curious as to what kind of access you need to the rabbitmq
> machines. Is it just sudo access to rabbitmq user or do you need root
> access?

We definitely don't need root; sudo is sufficient. In fact we may not 
even need that and get at all the info we need with a very restricted 
account, as long as it can grab rabbit's erlang.cookie and run 
rabbitmqctl. That account could even be on a separate machine from the 
server.

Regards,

Matthias.

From ralf.kistner at gmail.com  Sat Sep 25 12:07:11 2010
From: ralf.kistner at gmail.com (Ralf Kistner)
Date: Sat, 25 Sep 2010 13:07:11 +0200
Subject: [rabbitmq-discuss] Questions on RabbitMQ
Message-ID: <AANLkTikrFyz3FiBf9cqEhizWUehAOgjZtFd4H81KYUgB@mail.gmail.com>

I'm new to RabbitMQ (and AMQP), but I'm considering its use in an application.

I currently have a web application (Rails), and a mobile client (J2ME)
communicating with the web server via HTTP. The mobile client has to
operate in offline mode, so it keeps a persistent queue of messages to
be sent to the server. It periodically tries to send these messages to
the server, and keeps them if there is a network or server error.

I'd like to use RabbitMQ to improve the reliability, and to move to
socket connections instead of HTTP. I'd like to do the following:

1. Have the mobile client send messages to RabbitMQ using the STOMP plugin.
2. Have a Ruby script that consumes the messages on the server.
3. Keep a backup of all the messages sent to the server.

I have some questions about the above:

1 a. The client needs to be authenticated. I already have a simple
authentication system in the web application. Is it possible to use
this for authentication, or would I need to copy the authentication
data to RabbitMQ?

1 b. Is there a simple way to use SSL/TLS for the STOMP connection?

2 a. Are there any recommended practices for running a (Ruby) process
to consume messages in an infinite loop?

2 b. The Ruby script would occasionally be unable to process a
message. This could be because of a temporary lock on the database, an
invalid message from the mobile client, or a bug on the server. The
ideal would be for these messages to be retried a few times, then
moved to a different queue if it still fails. The messages in the
queue could then be inspected manually, and moved back to the original
queue when the bug was fixed.
How would this be accomplished? Does RabbitMQ have something like a
dead letter queue? Or would I have to move the message to a different
queue myself (in the Ruby script), in case of an error?
Note that I can't return any messages to the sender, I want to keep it
on the server in a different queue.

3. What is the best way to create a backup of all the message sent to
the server? Does RabbitMQ automatically do this, or should I write an
additional consumer to create a backup?


Regards,
Ralf Kistner

From baoyiming at snda.com  Sat Sep 25 12:44:28 2010
From: baoyiming at snda.com (=?gb2312?B?savS48P6?=)
Date: Sat, 25 Sep 2010 19:44:28 +0800
Subject: [rabbitmq-discuss] deadlock at QueueingBasicConsumer.Queue.Dequeue
Message-ID: <000001cb5ca7$0300d0b0$09027210$@com>

Hi everyone,

 

I was blocked when calling QueueingBasicConsumer.Queue.Dequeue(), but after
several minutes the queue works well and messages can be dequeued.

I run deep into the source code and got that Monitor.Wait(m_queue) was
blocked.

 

Also I got an System.Threading.ThreadAbortException triggered by
System.Threading.Monitor.ObjWait(Boolean exitContext, Int32
millisecondsTimeout, Object obj)

 

Below is my code written by C#, the version of RabbitMQ.Client.dll is 1.8.1.
0.

 

public static void Send<T>(T data, string serverAddress, string exchange,
string queuename, string routingKey)

        {

            byte[] message = SerializeToByteArray(data);

            try

            {

                ConnectionFactory cf = new ConnectionFactory();

                cf.Address = serverAddress;

 

                using (IConnection conn = cf.CreateConnection())

                {

                    using (IModel ch = conn.CreateModel())

                    {

                        conn.AutoClose = true;

                        

                        ch.ExchangeDeclare(exchange, ExchangeType.Direct);

                        ch.QueueDeclare(queuename);

                        ch.QueueBind(queuename, exchange, routingKey, false,
null);

 

                        IBytesMessageBuilder ibm = new
BytesMessageBuilder(ch);

                        ibm.WriteBytes(message);

 

                        ch.BasicPublish(exchange, routingKey,
(IBasicProperties)ibm.GetContentHeader(), ibm.GetContentBody());

 

                        if (ch.IsOpen)

                        {

                            ch.Close();

                        }

                    }

 

                    if (conn.IsOpen)

                    {

                        conn.Close();

                    }

                }

            }

            catch (Exception exp)

            {

                throw exp;

            }

        }

 

public static T Receive<T>(string serverAddress, string queuename)

        {

            T data = default(T);

    ConnectionFactory cf = new ConnectionFactory();

            cf.Address = serverAddress;

            using (IConnection conn = cf.CreateConnection())

            {

                using (IModel ch = conn.CreateModel())

                {

                    conn.AutoClose = true;

 

                    ch.QueueDeclare(queuename);

 

                    BasicGetResult result = ch.BasicGet(queuename, false);

 

                    QueueingBasicConsumer consumer = new
QueueingBasicConsumer(ch);

                    ch.BasicConsume(queuename, null, consumer);

 

                    BasicDeliverEventArgs e = consumer.Queue.Dequeue() as
BasicDeliverEventArgs;

                    if (e != null)

                    {

                        IBasicProperties props = e.BasicProperties;

                        byte[] body = e.Body;

                        data = DeserializeFromByteArray<T>(body);

 

                        ch.BasicAck(e.DeliveryTag, false);

                    }

 

                    if (ch.IsOpen)

                    {

                        ch.Close();

                    }

                }

 

                if (conn.IsOpen)

                {

                    conn.Close();

                }

            }

 

            return data;

        }

 

I will be appreciated if anybody can help with this issue. Thank you in
advance.

 

Yiming

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/d7c9cd4c/attachment-0001.htm>

From jon at jbrisbin.com  Sat Sep 25 13:59:37 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 25 Sep 2010 07:59:37 -0500
Subject: [rabbitmq-discuss] Questions on RabbitMQ
In-Reply-To: <AANLkTikrFyz3FiBf9cqEhizWUehAOgjZtFd4H81KYUgB@mail.gmail.com>
References: <AANLkTikrFyz3FiBf9cqEhizWUehAOgjZtFd4H81KYUgB@mail.gmail.com>
Message-ID: <396F9222-9382-48DC-83F6-6AE7BA6F51CA@jbrisbin.com>

On Sep 25, 2010, at 6:07 AM, Ralf Kistner wrote:

> 2 a. Are there any recommended practices for running a (Ruby) process
> to consume messages in an infinite loop?

Check out the AMQP stuff in Ruby. It uses EventMachine. EM will run until you tell it to stop, which is what you're looking for.

> 2 b. The Ruby script would occasionally be unable to process a
> message. This could be because of a temporary lock on the database, an
> invalid message from the mobile client, or a bug on the server. The
> ideal would be for these messages to be retried a few times, then
> moved to a different queue if it still fails. The messages in the
> queue could then be inspected manually, and moved back to the original
> queue when the bug was fixed.
> How would this be accomplished? Does RabbitMQ have something like a
> dead letter queue? Or would I have to move the message to a different
> queue myself (in the Ruby script), in case of an error?
> Note that I can't return any messages to the sender, I want to keep it
> on the server in a different queue.

Redelivery is something I'm working on in my own application. I use it to update databases at remote locations that might or might not be online. If I get a timeout error, I write my message into a Riak bucket. There is a Quartz-based job that runs every five minutes that checks this retry bucket and simply deletes the messages and dumps them back into the broker. I haven't put it in yet, but I'm planning on implementing a "maxRetries" so that when a message exceeds the retry number, it will be either sent to a notification queue where it gets emailed, or moved to another Riak bucket where I can write an RSS feed over the top of it.

> 3. What is the best way to create a backup of all the message sent to
> the server? Does RabbitMQ automatically do this, or should I write an
> additional consumer to create a backup?


A NoSQL store where you keep the entire message in JSON format seems to me the safest and most performant way to persist messages with enough information to be able to resubmit the message at a later time. I have security tokens in the headers (I don't use logins but tokens) and of course I have to capture the exchange and routing key information. I use JSON data for my messages, so this fits nicely together but you could also base64 encode your data.

You could use an additional consumer (e.g. on routing key "#") but I let the consumer decide whether to persist a message to Riak or not.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/315aeb74/attachment.htm>

From alexis at rabbitmq.com  Sat Sep 25 15:42:52 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 25 Sep 2010 15:42:52 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
Message-ID: <AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>

I just wanted to thank everyone for all their input on this thread.
It has been really helpful.

As some folks have pointed out we are keen to improve the docs.  The
site grew and grew and got a little chaotic.  It is being improved.
Certainly we will be adding some 'get started in small steps' info
too.  If anyone would like to contribute, especially with patterns and
examples, let us know.

The roadmap question is a really interesting one for us.  To what
extent is it better to push forward quickly with broadening the reach
and possible use of Rabbit, versus strengthening its core?  Over time,
we try to do both, but at any given moment we may be leaning more in
one direction vs the other.  What are the best places where we can
engage with the community to achieve this?

I'm very interested in people's thoughts on this ;-)

alexis



On Sat, Sep 25, 2010 at 3:23 AM, Adam Nelson <adam at varud.com> wrote:
> Matthias,
>
>> Ubuntu is an excellent example. They have quite a rigid release regime, so
>> it can take a while for an upstream package to make it into a release.
>> Ubuntu users are used to that. The question is, what do homebrew users
>> expect?
>>
>> We do have contacts at Canonical who we liaise with regarding the rabbitmq
>> packaging. Quite a few issues with rabbit and its packaging have been
>> resolved that way. ?We'd like that situation to be the same for homebrew one
>> day. Let's see what we can do in the meantime ...
>>
> Homebrew is kind of a ... 'homebrew' right now. ?I wish this hadn't been
> picked up as the main point of the thread, because it's really the most
> minor point - meant more as an example than anything else.
> Anyway, here are some instructions:
> http://ask.github.com/celery/getting-started/broker-installation.html#installing-rabbitmq-on-os-x
> Thanks,
> Adam
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Sat Sep 25 16:05:23 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 25 Sep 2010 16:05:23 +0100
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
	<C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
Message-ID: <AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>

Davorin

In that 'recommended' draft, there are no node types.  So observable
behaviour is unconstrained.

alexis


On Fri, Sep 24, 2010 at 10:49 AM, Vukasin Toroman <vukasin at toroman.name> wrote:
> Hi Davorin,
>
> well you're on your own there, that spec is way more xml that I'd like to tackle :-). A good place to start are the commands and their responses definitions since that is what you as a client will be interacting with.
>
> Good Luck,
> Vukasin
>
>
> On Sep 24, 2010, at 11:43 , Davorin Rusevljan wrote:
>
>> On Fri, Sep 24, 2010 at 11:28 AM, Vukasin Toroman <vukasin at toroman.name> wrote:
>>> In that you should check this out:
>>>
>>> http://www.amqp.org/confluence/display/AMQP/AMQP+Specification
>>
>> Great!
>>
>> Now I am only missing detailed explanations of what each node and
>> attribute means in type definitions.
>>
>> Davorin
>
>

From davorin.rusevljan at gmail.com  Sat Sep 25 17:15:43 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Sat, 25 Sep 2010 18:15:43 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
	<C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
	<AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>
Message-ID: <AANLkTimmQ0eGvGDhHk1ZQKqorwRBhqTQ7pvHhY6qx+3a@mail.gmail.com>

On Sat, Sep 25, 2010 at 5:05 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Davorin
>
> In that 'recommended' draft, there are no node types. ?So observable
> behaviour is unconstrained.

I was referring to xml nodes and their attributes, that are used
inside xml files to formally define composite files, like one below:

    <type name="source" class="composite" source="map" provides="source">
      <descriptor name="amqp:source:map" code="0x00000001:0x00000208"/>
      <field name="address" type="*" requires="address">
        <error name="address-not-found" type="amqp-error" value="not-found"/>
      </field>
      <field name="dynamic" type="*" requires="lifetime-policy"/>
      <field name="distribution-mode" type="symbol"
requires="distribution-mode"/>
      <field name="filter" type="filter-set"/>
      <field name="default-outcome" type="*"/>
      <field name="outcomes" type="symbol" multiple="true"/>
      <field name="capabilities" type="symbol" multiple="true"/>
    </type>

While this is nice to get some idea what type source might be, it is
definitely necessary to provide complete explanation what each xml
node means, describe all their attributes, their possible values, and
what they mean all together.

And on my second question, how is reviewer status supposed to work?
Where does one forward remarks and questions? Also is there some forum
for people who would like to consider to implement amqp 1.0?

Thanks!

Davorin Rusevljan
http://www.cloud208.com/

From alexis at rabbitmq.com  Sat Sep 25 17:22:33 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 25 Sep 2010 17:22:33 +0100
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTimmQ0eGvGDhHk1ZQKqorwRBhqTQ7pvHhY6qx+3a@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
	<C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
	<AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>
	<AANLkTimmQ0eGvGDhHk1ZQKqorwRBhqTQ7pvHhY6qx+3a@mail.gmail.com>
Message-ID: <AANLkTi=pSciWL4y-2=Y0PeUS9pt0r5OMX6yLtjUDTtMP@mail.gmail.com>

Ah, sorry, I completely misunderstood you :-(

Reviewers need to sign a reviewers' agreement which essentially covers
IPR issues when commenting to the WG on the docs.  Or you can just
comment in the public domain (eg: here) since the docs themselves are
public, open, etc.


On Sat, Sep 25, 2010 at 5:15 PM, Davorin Rusevljan
<davorin.rusevljan at gmail.com> wrote:
> On Sat, Sep 25, 2010 at 5:05 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Davorin
>>
>> In that 'recommended' draft, there are no node types. ?So observable
>> behaviour is unconstrained.
>
> I was referring to xml nodes and their attributes, that are used
> inside xml files to formally define composite files, like one below:
>
> ? ?<type name="source" class="composite" source="map" provides="source">
> ? ? ?<descriptor name="amqp:source:map" code="0x00000001:0x00000208"/>
> ? ? ?<field name="address" type="*" requires="address">
> ? ? ? ?<error name="address-not-found" type="amqp-error" value="not-found"/>
> ? ? ?</field>
> ? ? ?<field name="dynamic" type="*" requires="lifetime-policy"/>
> ? ? ?<field name="distribution-mode" type="symbol"
> requires="distribution-mode"/>
> ? ? ?<field name="filter" type="filter-set"/>
> ? ? ?<field name="default-outcome" type="*"/>
> ? ? ?<field name="outcomes" type="symbol" multiple="true"/>
> ? ? ?<field name="capabilities" type="symbol" multiple="true"/>
> ? ?</type>
>
> While this is nice to get some idea what type source might be, it is
> definitely necessary to provide complete explanation what each xml
> node means, describe all their attributes, their possible values, and
> what they mean all together.
>
> And on my second question, how is reviewer status supposed to work?
> Where does one forward remarks and questions? Also is there some forum
> for people who would like to consider to implement amqp 1.0?
>
> Thanks!
>
> Davorin Rusevljan
> http://www.cloud208.com/
>

From davorin.rusevljan at gmail.com  Sat Sep 25 17:27:28 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Sat, 25 Sep 2010 18:27:28 +0200
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTi=pSciWL4y-2=Y0PeUS9pt0r5OMX6yLtjUDTtMP@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
	<C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
	<AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>
	<AANLkTimmQ0eGvGDhHk1ZQKqorwRBhqTQ7pvHhY6qx+3a@mail.gmail.com>
	<AANLkTi=pSciWL4y-2=Y0PeUS9pt0r5OMX6yLtjUDTtMP@mail.gmail.com>
Message-ID: <AANLkTim4zq9Z_kssOSaXHcXmF_JWLfUSPp01nuJeqW71@mail.gmail.com>

On Sat, Sep 25, 2010 at 6:22 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Ah, sorry, I completely misunderstood you :-(
>
> Reviewers need to sign a reviewers' agreement which essentially covers
> IPR issues when commenting to the WG on the docs. ?Or you can just
> comment in the public domain (eg: here) since the docs themselves are
> public, open, etc.

yep, I did that a week ago, but besides congratulations on that I did
not receive anything else, like where to send questions and feedback,
or perhaps access to forum or part of the web site where details of
standard could be discussed with people who work in it or on
implementations.

I do not mind putting them here, but it somehow seems like overloading
of rabbutmq mailing list with content that is not interesting to many.

Thanks,

Davorin Rusevljan

From alexis at rabbitmq.com  Sat Sep 25 17:41:48 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 25 Sep 2010 17:41:48 +0100
Subject: [rabbitmq-discuss] request for help!
In-Reply-To: <AANLkTim4zq9Z_kssOSaXHcXmF_JWLfUSPp01nuJeqW71@mail.gmail.com>
References: <p2w167204d21005051258r98d70969m3041569474944538@mail.gmail.com>
	<AANLkTinFsdc6v7QF-FuxLoG62RNMimNGqdHgb=WzaoWo@mail.gmail.com>
	<25F4C954-56CD-47EA-BE22-F30C2E98891B@toroman.name>
	<AANLkTinHCbyH=JW5cXDNyVaiweM9cFW2XjQF=tR06a7v@mail.gmail.com>
	<C8E8426B-00A5-414D-B2C0-921CD6F32954@toroman.name>
	<AANLkTikCKUmVWRxP2b0-3CB3Omjmtq_M2c9=fGKofBGa@mail.gmail.com>
	<AANLkTimmQ0eGvGDhHk1ZQKqorwRBhqTQ7pvHhY6qx+3a@mail.gmail.com>
	<AANLkTi=pSciWL4y-2=Y0PeUS9pt0r5OMX6yLtjUDTtMP@mail.gmail.com>
	<AANLkTim4zq9Z_kssOSaXHcXmF_JWLfUSPp01nuJeqW71@mail.gmail.com>
Message-ID: <AANLkTin8ok8f_GcR7WpmyHANZWyJQx5WxRGo+8jqbZf9@mail.gmail.com>

On Sat, Sep 25, 2010 at 5:27 PM, Davorin Rusevljan
<davorin.rusevljan at gmail.com> wrote:
> On Sat, Sep 25, 2010 at 6:22 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Ah, sorry, I completely misunderstood you :-(
>>
>> Reviewers need to sign a reviewers' agreement which essentially covers
>> IPR issues when commenting to the WG on the docs. ?Or you can just
>> comment in the public domain (eg: here) since the docs themselves are
>> public, open, etc.
>
> yep, I did that a week ago, but besides congratulations on that I did
> not receive anything else, like where to send questions and feedback,
> or perhaps access to forum or part of the web site where details of
> standard could be discussed with people who work in it or on
> implementations.

If you have signed it then there are some lists you can send review comments to:

http://lists.amqp.org/mailman/listinfo/amqp-1-0-sig
http://lists.amqp.org/mailman/listinfo/amqp-dev


> I do not mind putting them here, but it somehow seems like overloading
> of rabbutmq mailing list with content that is not interesting to many.

Indeed..

alexis

From shane at digitalsanctum.com  Sat Sep 25 17:55:09 2010
From: shane at digitalsanctum.com (Shane Witbeck)
Date: Sat, 25 Sep 2010 12:55:09 -0400
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
Message-ID: <8975685228782629149@unknownmsgid>

I think the single most important that can be done is complete
examples with all the code available on github. The examples should
illustrate how to implement all the features and patterns.

-Shane


On Sep 25, 2010, at 10:42 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:

> I just wanted to thank everyone for all their input on this thread.
> It has been really helpful.
>
> As some folks have pointed out we are keen to improve the docs.  The
> site grew and grew and got a little chaotic.  It is being improved.
> Certainly we will be adding some 'get started in small steps' info
> too.  If anyone would like to contribute, especially with patterns and
> examples, let us know.
>
> The roadmap question is a really interesting one for us.  To what
> extent is it better to push forward quickly with broadening the reach
> and possible use of Rabbit, versus strengthening its core?  Over time,
> we try to do both, but at any given moment we may be leaning more in
> one direction vs the other.  What are the best places where we can
> engage with the community to achieve this?
>
> I'm very interested in people's thoughts on this ;-)
>
> alexis
>
>
>
> On Sat, Sep 25, 2010 at 3:23 AM, Adam Nelson <adam at varud.com> wrote:
>> Matthias,
>>
>>> Ubuntu is an excellent example. They have quite a rigid release regime, so
>>> it can take a while for an upstream package to make it into a release.
>>> Ubuntu users are used to that. The question is, what do homebrew users
>>> expect?
>>>
>>> We do have contacts at Canonical who we liaise with regarding the rabbitmq
>>> packaging. Quite a few issues with rabbit and its packaging have been
>>> resolved that way.  We'd like that situation to be the same for homebrew one
>>> day. Let's see what we can do in the meantime ...
>>>
>> Homebrew is kind of a ... 'homebrew' right now.  I wish this hadn't been
>> picked up as the main point of the thread, because it's really the most
>> minor point - meant more as an example than anything else.
>> Anyway, here are some instructions:
>> http://ask.github.com/celery/getting-started/broker-installation.html#installing-rabbitmq-on-os-x
>> Thanks,
>> Adam
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Sat Sep 25 19:57:11 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 25 Sep 2010 13:57:11 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <8975685228782629149@unknownmsgid>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
	<8975685228782629149@unknownmsgid>
Message-ID: <4116B6D7-CA59-4B6C-A041-E1CDB811DA46@jbrisbin.com>


On Sep 25, 2010, at 11:55 AM, Shane Witbeck wrote:

> I think the single most important that can be done is complete
> examples with all the code available on github. The examples should
> illustrate how to implement all the features and patterns.
> 
> -Shane

+1 on this.

It seems like every application I write with RabbitMQ has a little bit different requirements, so I can't just rubber-stamp what I did last time. It would be great to have some comprehensive examples of the common usage patterns which will help you learn the API, understand the AMQP spec by example, and also show how applications should be structured. There's a lot of interesting stuff buried in the tests in the source tree that could be mined for some of this content.

How's the community wiki coming? ;)

jb


> 
> 
> On Sep 25, 2010, at 10:42 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> 
>> I just wanted to thank everyone for all their input on this thread.
>> It has been really helpful.
>> 
>> As some folks have pointed out we are keen to improve the docs.  The
>> site grew and grew and got a little chaotic.  It is being improved.
>> Certainly we will be adding some 'get started in small steps' info
>> too.  If anyone would like to contribute, especially with patterns and
>> examples, let us know.
>> 
>> The roadmap question is a really interesting one for us.  To what
>> extent is it better to push forward quickly with broadening the reach
>> and possible use of Rabbit, versus strengthening its core?  Over time,
>> we try to do both, but at any given moment we may be leaning more in
>> one direction vs the other.  What are the best places where we can
>> engage with the community to achieve this?
>> 
>> I'm very interested in people's thoughts on this ;-)
>> 
>> alexis
>> 
>> 
>> 
>> On Sat, Sep 25, 2010 at 3:23 AM, Adam Nelson <adam at varud.com> wrote:
>>> Matthias,
>>> 
>>>> Ubuntu is an excellent example. They have quite a rigid release regime, so
>>>> it can take a while for an upstream package to make it into a release.
>>>> Ubuntu users are used to that. The question is, what do homebrew users
>>>> expect?
>>>> 
>>>> We do have contacts at Canonical who we liaise with regarding the rabbitmq
>>>> packaging. Quite a few issues with rabbit and its packaging have been
>>>> resolved that way.  We'd like that situation to be the same for homebrew one
>>>> day. Let's see what we can do in the meantime ...
>>>> 
>>> Homebrew is kind of a ... 'homebrew' right now.  I wish this hadn't been
>>> picked up as the main point of the thread, because it's really the most
>>> minor point - meant more as an example than anything else.
>>> Anyway, here are some instructions:
>>> http://ask.github.com/celery/getting-started/broker-installation.html#installing-rabbitmq-on-os-x
>>> Thanks,
>>> Adam
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/b136ec58/attachment-0001.htm>

From matthew at rabbitmq.com  Sat Sep 25 20:40:35 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 25 Sep 2010 20:40:35 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <4116B6D7-CA59-4B6C-A041-E1CDB811DA46@jbrisbin.com>
References: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
	<8975685228782629149@unknownmsgid>
	<4116B6D7-CA59-4B6C-A041-E1CDB811DA46@jbrisbin.com>
Message-ID: <20100925194034.GA14485@rabbitmq.com>

On Sat, Sep 25, 2010 at 01:57:11PM -0500, Jon Brisbin wrote:
> How's the community wiki coming? ;)

You mean there's something wrong with dev.rabbitmq.com/wiki ? ;)

Matthew

From adam at varud.com  Sun Sep 26 03:40:38 2010
From: adam at varud.com (Adam Nelson)
Date: Sat, 25 Sep 2010 22:40:38 -0400
Subject: [rabbitmq-discuss] How do you configure where RabbitMQ persists
	data?
In-Reply-To: <20100925085653.GB12677@rabbitmq.com>
References: <9a30fb05-2e93-40b9-937b-a45aa4016b54@w15g2000pro.googlegroups.com>
	<20100925085653.GB12677@rabbitmq.com>
Message-ID: <AANLkTi=Ld5jb4_o-B9mydyfLNeChEwVJWq0r=Eh7p+E+@mail.gmail.com>

Nathan,

You can also just run the ec2 instance entirely on EBS.  Then you don't need
to change the stock RabbitMQ settings and you can stop and start the
instance at will.  I use the Ubuntu Lucid EBS backed AMIs:

http://alestic.com/

-Adam

On Sat, Sep 25, 2010 at 4:56 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Sep 24, 2010 at 05:25:00PM -0700, nathanmarz wrote:
> > I'd like to run RabbitMQ on EC2 and have it persist data to an EBS
> > drive. How do you configure RabbitMQ to write to a specified
> > directory?
>
> Set _either_ the environment variable RABBITMQ_MNESIA_BASE or in
> /etc/rabbitmq/rabbitmq.conf, set the variblae MNESIA_BASE. In both
> cases, the value should be the directory in which you want Rabbit to
> write.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/b60ae77d/attachment.htm>

From jon at jbrisbin.com  Sun Sep 26 14:10:20 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sun, 26 Sep 2010 08:10:20 -0500
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100925194034.GA14485@rabbitmq.com>
References: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
	<8975685228782629149@unknownmsgid>
	<4116B6D7-CA59-4B6C-A041-E1CDB811DA46@jbrisbin.com>
	<20100925194034.GA14485@rabbitmq.com>
Message-ID: <0C705838-8B9F-4C86-B884-5009B219B7B1@jbrisbin.com>


On Sep 25, 2010, at 2:40 PM, Matthew Sackman wrote:

> On Sat, Sep 25, 2010 at 01:57:11PM -0500, Jon Brisbin wrote:
>> How's the community wiki coming? ;)
> 
> You mean there's something wrong with dev.rabbitmq.com/wiki ? ;)


Guess I missed the link to that. Bookmarked now! :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100926/cc7c81b9/attachment.htm>

From elij.mx at gmail.com  Mon Sep 27 04:19:14 2010
From: elij.mx at gmail.com (elij)
Date: Sun, 26 Sep 2010 20:19:14 -0700
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>
	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>
	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>
	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
Message-ID: <AANLkTinpjL1QxQvBD2tHDPtNXiksZp6U77LS0N4jS0xO@mail.gmail.com>

On Fri, Sep 24, 2010 at 12:01 PM, Adam Nelson <adam at varud.com> wrote:
> Alexis/David,
> I think the response from the group has been awesome. ?Takeaways:
> 1. Everybody who is on a Mac likes Homebrew. ?It should at least be referred
> to on the downloads page, and most likely, it should be the default
> installation recommendation for Mac users.

I personally use macports, and prefer it.
I _want_ clean versions of core libraries not tied to os updates, so
if I get an osx update it will not break anything I have installed via
macports. Similarly, my macports binaries are using newever library
versions than the core os ships, and I often get security updates
there MUCH faster (such as the recent bzip2 vuln).

> 2. David?should make appropriate tickets on the Homebrew site (individual
> ones, not one big one) for the naming conventions, etc... that you would
> like homebrew to use. ?I'm sure they'll be evenhanded. ?Note item #3 though
> when making the tickets.
> 3. Virtually all Mac users of rabbitmq are using it for development.
> ?Production installations for the Mac users are running Linux (frequently
> Ubuntu).
> 4. The documentation needs a major overhaul - soon.
> 5. The codebase should be hosted on Github.com for easier interaction with
> the wider community.
> 6. "it's unlikely we are going to?repeat that effort for homebrew (unless
> macports dies or something)." -?Macports is dying - I hate to break it to
> people. ?Agreed, it is way ahead of Homebrew in maturity, but MacPorts is
> too flawed to continue on. ?The fundamental issue is that Mac is not a
> server OS, so the pace of iteration on the platform is much faster than on
> something like Debian/Ubuntu where it's been using the same package manager
> for years and will continue to be. ?All the mature features of MacPorts are
> useless because nobody uses Mac as a server for anything but internal office
> functions and specialized rendering stuff. ?The vanguard of Mac users has
> already moved to Homebrew even though it's only a few months old - that
> battle is over.

I really don't see this, but I have no problem with it being your opinion.

I would also like to comment about google groups. Please god no!
I am subscribed to a few google groups, and the raw amount of spam I
get through a google group mailing list compared to a more classic
mailing list (off google groups on some mailman, etc) is significant.
An example: http://ejohn.org/blog/google-groups-is-dead/

> Thanks so much for all the support from everybody on these issues. ?I'd love
> to continue using RabbitMQ and it's these types of rough edges that matter
> to alot of us.
> Thanks,
> Adam
> On Thu, Sep 23, 2010 at 5:50 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Adam, everyone,
>>
>> What are your thoughts on this thread? ?Is this helping?
>>
>> alexis
>>
>>
>>
>> On Thu, Sep 23, 2010 at 1:22 PM, David Wragg <david at rabbitmq.com> wrote:
>> > Adam Nelson <adam at varud.com> writes:
>> >> ?* Please don't tell Mac users to use MacPorts:
>> >> http://www.rabbitmq.com/macports.html It's time to move them to
>> >> HomeBrew at
>> >> http://github.com/mxcl/homebrew
>> >
>> > I'm not a frequent OS X user. ?I do have some experience with macports,
>> > but it's been mixed. ?So I like to think I have a fairly objective view
>> > on the macports vs. homebrew thing (that being, they are both vastly
>> > inferior to current Linux package systems :-)
>> >
>> > So with that said:
>> >
>> > I think we'd be happy to endorse homebrew alongside or instead of
>> > macports, *if* it achieves parity with the rabbitmq-server port, and the
>> > rabbitmq-server packages on Linuxes. ?That means:
>> >
>> > - The formula should be called rabbitmq-server
>> >
>> > - It should create and use a rabbitmq user/group, and include the
>> > ?wrapper scripts to support this.
>> >
>> > - It should have some way to run as an automatically started daemon.
>> >
>> > - It should include the man pages (on-line documentation is great, man
>> > ?pages are too, we have both, and we want the man pages to be provided
>> > ?with the packages).
>> >
>> > - We need to have a way to distribute an update package when we make a
>> > ?new release, for users that are willing to bypass the central
>> > ?repository.
>> >
>> > We've made all this work for macports; it's unlikely we are going to
>> > repeat that effort for homebrew (unless macports dies or something).
>> >
>> > But if someone in the community wants to work on getting the homebrew
>> > formula into the same shape, that would be great. ?We could work with
>> > them to integrate it into our build/release process.
>> >
>> > David
>> >
>> > --
>> > David Wragg
>> > Staff Engineer, RabbitMQ
>> > SpringSource, a division of VMware
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>
>
> --
> Adam
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From sameek at arosys.com  Mon Sep 27 06:39:09 2010
From: sameek at arosys.com (sam_mis)
Date: Sun, 26 Sep 2010 22:39:09 -0700 (PDT)
Subject: [rabbitmq-discuss] How to use Consumer as Producer in rabbitmq
In-Reply-To: <loom.20100924T122158-342@post.gmane.org>
References: <29736359.post@talk.nabble.com> <29788719.post@talk.nabble.com>
	<loom.20100924T122158-342@post.gmane.org>
Message-ID: <29815724.post@talk.nabble.com>



specialsaran wrote:
> 
> Hi,
> 
> Thanks for the reply.
> 
> I cant see those two files (Service.java and Result.java). Pls post it
> again  
> 
> Regards
> Saran
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

Hi

just see those required files see those two files (Service.java and
Result.java). http://old.nabble.com/file/p29815724/Service.java Service.java 
http://old.nabble.com/file/p29815724/Result.java Result.java 



-- 
View this message in context: http://old.nabble.com/How-to-use-Consumer-as-Producer-in-rabbitmq-tp29736359p29815724.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Mon Sep 27 06:54:25 2010
From: sameek at arosys.com (sam_mis)
Date: Sun, 26 Sep 2010 22:54:25 -0700 (PDT)
Subject: [rabbitmq-discuss]  How to return value from response Queue !!!!!
Message-ID: <29815725.post@talk.nabble.com>


Hi, i am using Rabbitmq Java client API.i am sending two number from GUI to
producer and producer put into queue another side consumer can listen the
queue and read it and perform the addition of two number and put result on
queue then again my producer will listen the my response queue and retrieve
the result.
code:

while (runInfinite) {
            QueueingConsumer.Delivery delivery;
            try
            {
               delivery = consumer.nextDelivery();
            } catch (InterruptedException ie)
            {
               continue;
            }
         System.out.println("Result received-"
+ new String(delivery.getBody()));
}

My problem is when the while loop run infinite time and i want to send the
fetched result to an GUI to show result.i want to know that, it is possible
,if possible then what i do?
http://old.nabble.com/file/p29815725/rabbit-rpc.png  just i want to use the
same flow.

Thanks
sameek
-- 
View this message in context: http://old.nabble.com/How-to-return-value-from-response-Queue-%21%21%21%21%21-tp29815725p29815725.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From romary.kremer at gmail.com  Mon Sep 27 08:52:02 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Mon, 27 Sep 2010 09:52:02 +0200
Subject: [rabbitmq-discuss] Failure on RedHat server
Message-ID: <D566E3E4-DA60-476C-9122-9D2D0D2A31AB@gmail.com>

Hi,

As some of you may already now from my others thread on that list, we  
are still working on 1.8.1 at the moment because of memory constraints.

We have a new production server that runs Red Hat distribution, while  
our test environment runs Ubuntu.

Yesterday I installed the rabbitmq-server-1.8.1 rpm on our Red Hat  
server and get the following message at startup :

./rabbitmq-server
{error_logger,{{2010,9,27},{8,38,20}},"Protocol: ~p: register error:  
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}}, 
[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4}, 
{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init, 
1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,9,27},{8,38,20}},crash_report,[[{initial_call, 
{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]}, 
{error_info,{exit,{error,badarg},[{gen_server,init_it,6}, 
{proc_lib,init_p_do_apply,3}]}},{ancestors, 
[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links, 
[#Port<0.106>,<0.17.0>]},{dictionary,[{longnames,false}]}, 
{trap_exit,true},{status,running},{heap_size,377},{stack_size,24}, 
{reductions,488}],[]]}
{error_logger,{{2010,9,27},{8,38,20}},supervisor_report,[{supervisor, 
{local,net_sup}},{errorContext,start_error},{reason, 
{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel}, 
{mfargs,{net_kernel,start_link,[['rabbit at 287834-app1',shortnames]]}}, 
{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,9,27},{8,38,20}},supervisor_report,[{supervisor, 
{local,kernel_sup}},{errorContext,start_error},{reason,shutdown}, 
{offender,[{pid,undefined},{name,net_sup},{mfargs, 
{erl_distribution,start_link,[]}},{restart_type,permanent}, 
{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,9,27},{8,38,20}},std_info,[{application,kernel}, 
{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid  
terminated",application_controller,"{application_start_failure,kernel, 
{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)  
({application_start_failure,kernel,{shutdown,{kernel,start,[normal, 
[]]}}})

Does anyone can tell us what is going wrong ?

Thanks a lot,

regards.

Romary.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100927/746c3041/attachment-0001.htm>

From videlalvaro at gmail.com  Mon Sep 27 08:55:20 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 27 Sep 2010 15:55:20 +0800
Subject: [rabbitmq-discuss] Failure on RedHat server
In-Reply-To: <D566E3E4-DA60-476C-9122-9D2D0D2A31AB@gmail.com>
References: <D566E3E4-DA60-476C-9122-9D2D0D2A31AB@gmail.com>
Message-ID: <46702827-B1DE-4390-B7F1-4FC2BD26B244@gmail.com>

Have you checked if rabbitmq is not already running?

> ps ax | grep rabbit  

should do.

Cheers,

Alvaro

On Sep 27, 2010, at 3:52 PM, romary.kremer at gmail.com wrote:

> Hi, 
> 
> As some of you may already now from my others thread on that list, we are still working on 1.8.1 at the moment because of memory constraints.
> 
> We have a new production server that runs Red Hat distribution, while our test environment runs Ubuntu.
> 
> Yesterday I installed the rabbitmq-server-1.8.1 rpm on our Red Hat server and get the following message at startup :
> 
> ./rabbitmq-server
> {error_logger,{{2010,9,27},{8,38,20}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2010,9,27},{8,38,20}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.106>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,488}],[]]}
> {error_logger,{{2010,9,27},{8,38,20}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at 287834-app1',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2010,9,27},{8,38,20}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2010,9,27},{8,38,20}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> Does anyone can tell us what is going wrong ?
> 
> Thanks a lot,
> 
> regards.
> 
> Romary.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100927/e9de6004/attachment.htm>

From romary.kremer at gmail.com  Mon Sep 27 09:01:31 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Mon, 27 Sep 2010 10:01:31 +0200
Subject: [rabbitmq-discuss] Failure on RedHat server
In-Reply-To: <46702827-B1DE-4390-B7F1-4FC2BD26B244@gmail.com>
References: <D566E3E4-DA60-476C-9122-9D2D0D2A31AB@gmail.com>
	<46702827-B1DE-4390-B7F1-4FC2BD26B244@gmail.com>
Message-ID: <8040F690-4D71-47C9-BDDE-AFBCABBA29A9@gmail.com>

Hi,

Indeed, a previous instance was running, with an older erlang ...
thanks for the reply it solves the problem !!

best regards,

romary.

Le 27 sept. 10 ? 09:55, Alvaro Videla a ?crit :

> Have you checked if rabbitmq is not already running?
>
> > ps ax | grep rabbit
>
> should do.
>
> Cheers,
>
> Alvaro
>
> On Sep 27, 2010, at 3:52 PM, romary.kremer at gmail.com wrote:
>
>> Hi,
>>
>> As some of you may already now from my others thread on that list,  
>> we are still working on 1.8.1 at the moment because of memory  
>> constraints.
>>
>> We have a new production server that runs Red Hat distribution,  
>> while our test environment runs Ubuntu.
>>
>> Yesterday I installed the rabbitmq-server-1.8.1 rpm on our Red Hat  
>> server and get the following message at startup :
>>
>> ./rabbitmq-server
>> {error_logger,{{2010,9,27},{8,38,20}},"Protocol: ~p: register  
>> error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}}, 
>> [{inet_tcp_dist,listen,1},{net_kernel,start_protos,4}, 
>> {net_kernel,start_protos,3},{net_kernel,init_node,2}, 
>> {net_kernel,init,1},{gen_server,init_it,6}, 
>> {proc_lib,init_p_do_apply,3}]}]}
>> {error_logger,{{2010,9,27},{8,38,20}},crash_report,[[{initial_call, 
>> {net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name, 
>> []},{error_info,{exit,{error,badarg},[{gen_server,init_it,6}, 
>> {proc_lib,init_p_do_apply,3}]}},{ancestors, 
>> [net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links, 
>> [#Port<0.106>,<0.17.0>]},{dictionary,[{longnames,false}]}, 
>> {trap_exit,true},{status,running},{heap_size,377},{stack_size,24}, 
>> {reductions,488}],[]]}
>> {error_logger,{{2010,9,27},{8,38,20}},supervisor_report, 
>> [{supervisor,{local,net_sup}},{errorContext,start_error},{reason, 
>> {'EXIT',nodistribution}},{offender,[{pid,undefined}, 
>> {name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at 287834- 
>> app1',shortnames]]}},{restart_type,permanent},{shutdown,2000}, 
>> {child_type,worker}]}]}
>> {error_logger,{{2010,9,27},{8,38,20}},supervisor_report, 
>> [{supervisor,{local,kernel_sup}},{errorContext,start_error}, 
>> {reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs, 
>> {erl_distribution,start_link,[]}},{restart_type,permanent}, 
>> {shutdown,infinity},{child_type,supervisor}]}]}
>> {error_logger,{{2010,9,27},{8,38,20}},std_info, 
>> [{application,kernel},{exited,{shutdown,{kernel,start,[normal, 
>> []]}}},{type,permanent}]}
>> {"Kernel pid  
>> terminated 
>> ",application_controller,"{application_start_failure,kernel, 
>> {shutdown,{kernel,start,[normal,[]]}}}"}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)  
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal, 
>> []]}}})
>>
>> Does anyone can tell us what is going wrong ?
>>
>> Thanks a lot,
>>
>> regards.
>>
>> Romary.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100927/ba4f36db/attachment.htm>

From emile at rabbitmq.com  Mon Sep 27 09:17:22 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 27 Sep 2010 09:17:22 +0100
Subject: [rabbitmq-discuss] deadlock at
	QueueingBasicConsumer.Queue.Dequeue
In-Reply-To: <000001cb5ca7$0300d0b0$09027210$@com>
References: <000001cb5ca7$0300d0b0$09027210$@com>
Message-ID: <4CA05312.5000807@rabbitmq.com>


Hi Yiming,

You are using both BasicGet() and BasicConsume() to retrieve messages.
You only need BasicGet(). The library is blocking because you are
attempting to retrieve the message twice.

The .net Client Library User Guide has more information about the
difference between polling and subscription in section 2.7 and 2.8:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.1.0/rabbitmq-dotnet-client-2.1.0-user-guide.pdf


Regards

Emile



On 25/09/10 12:44, ??? wrote:
> Hi everyone,
> 
>  
> 
> I was blocked when calling QueueingBasicConsumer.Queue.Dequeue(), but
> after several minutes the queue works well and messages can be dequeued.
> 
> I run deep into the source code and got that Monitor.Wait(m_queue) was
> blocked.
> 
>  
> 
> Also I got an System.Threading.ThreadAbortException triggered by
> System.Threading.Monitor.ObjWait(Boolean exitContext, Int32
> millisecondsTimeout, Object obj)
> 
>  
> 
> Below is my code written by C#, the version of RabbitMQ.Client.dll is
> 1.8.1.0.
> 
>  
> 
> public static void Send<T>(T data, string serverAddress, string
> exchange, string queuename, string routingKey)
> 
>         {
> 
>             byte[] message = SerializeToByteArray(data);
> 
>             try
> 
>             {
> 
>                 ConnectionFactory cf = new ConnectionFactory();
> 
>                 cf.Address = serverAddress;
> 
>  
> 
>                 using (IConnection conn = cf.CreateConnection())
> 
>                 {
> 
>                     using (IModel ch = conn.CreateModel())
> 
>                     {
> 
>                         conn.AutoClose = true;
> 
>                        
> 
>                         ch.ExchangeDeclare(exchange, ExchangeType.Direct);
> 
>                         ch.QueueDeclare(queuename);
> 
>                         ch.QueueBind(queuename, exchange, routingKey,
> false, null);
> 
>  
> 
>                         IBytesMessageBuilder ibm = new
> BytesMessageBuilder(ch);
> 
>                         ibm.WriteBytes(message);
> 
>  
> 
>                         ch.BasicPublish(exchange, routingKey,
> (IBasicProperties)ibm.GetContentHeader(), ibm.GetContentBody());
> 
>  
> 
>                         if (ch.IsOpen)
> 
>                         {
> 
>                             ch.Close();
> 
>                         }
> 
>                     }
> 
>  
> 
>                     if (conn.IsOpen)
> 
>                     {
> 
>                         conn.Close();
> 
>                     }
> 
>                 }
> 
>             }
> 
>             catch (Exception exp)
> 
>             {
> 
>                 throw exp;
> 
>             }
> 
>         }
> 
>  
> 
> public static T Receive<T>(string serverAddress, string queuename)
> 
>         {
> 
>             T data = default(T);
> 
>     ConnectionFactory cf = new ConnectionFactory();
> 
>             cf.Address = serverAddress;
> 
>             using (IConnection conn = cf.CreateConnection())
> 
>             {
> 
>                 using (IModel ch = conn.CreateModel())
> 
>                 {
> 
>                     conn.AutoClose = true;
> 
>  
> 
>                     ch.QueueDeclare(queuename);
> 
>  
> 
>                     BasicGetResult result = ch.BasicGet(queuename, false);
> 
>  
> 
>                     QueueingBasicConsumer consumer = new
> QueueingBasicConsumer(ch);
> 
>                     ch.BasicConsume(queuename, null, consumer);
> 
>  
> 
>                     BasicDeliverEventArgs e = consumer.Queue.Dequeue()
> as BasicDeliverEventArgs;
> 
>                     if (e != null)
> 
>                     {
> 
>                         IBasicProperties props = e.BasicProperties;
> 
>                         byte[] body = e.Body;
> 
>                         data = DeserializeFromByteArray<T>(body);
> 
>  
> 
>                         ch.BasicAck(e.DeliveryTag, false);
> 
>                     }
> 
>  
> 
>                     if (ch.IsOpen)
> 
>                     {
> 
>                         ch.Close();
> 
>                     }
> 
>                 }
> 
>  
> 
>                 if (conn.IsOpen)
> 
>                 {
> 
>                     conn.Close();
> 
>                 }
> 
>             }
> 
>  
> 
>             return data;
> 
>         }
> 
>  
> 
> I will be appreciated if anybody can help with this issue. Thank you in
> advance.
> 
>  
> 
> Yiming

From Alister.Morton at tradition.com  Mon Sep 27 09:56:50 2010
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 27 Sep 2010 09:56:50 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <20100925194034.GA14485@rabbitmq.com>
References: <AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>
	<4C9CFED1.40207@rabbitmq.com>
	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>
	<4C9D0E63.2030708@rabbitmq.com>
	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>
	<4C9D2933.1060401@rabbitmq.com>
	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>
	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
	<8975685228782629149@unknownmsgid>
	<4116B6D7-CA59-4B6C-A041-E1CDB811DA46@jbrisbin.com>
	<20100925194034.GA14485@rabbitmq.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910695D90B8E8A@SVR-2K3-BH-EMC.tradition.int>

> You mean there's something wrong with dev.rabbitmq.com/wiki ? ;)

Actually, it appears that there are some pages where there are mixed secure and insecure objects. So in /that/ respect maybe there is :-)

Al.

--------------------------------


The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From v.p.saravanan at gmail.com  Mon Sep 27 10:27:22 2010
From: v.p.saravanan at gmail.com (specialsaran)
Date: Mon, 27 Sep 2010 02:27:22 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
In-Reply-To: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
References: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
Message-ID: <29815736.post@talk.nabble.com>


Hi Chandra,

Please check if the service of your rabbitmq is also running. Start
-->Run--->Services.msc.Both the services(rabbitmq-service) and
server(rabbitmq-server) cannot run at the same time.I am not sure , but have
a look at this dimention too.As i too new for rabbitmq thought to share my
view.

Regards
Saran



Chandra R wrote:
> 
> Hello,
> 
> I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But
> it
> is crashing on start.
> Activating Rabbitmq plugins ...0 plugins activated and it crashes as
> erl.exe
> uses up all the memory.
> 
> Is it because of resources  because I have set all the class paths and
> have
> erlang installed at C:\Elang\erl5.7.4
> and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
> were some issues when trying to install at "Program files" because of the
> space in the folder name.
> 
> Thank you for any help advice.
> ------------------ from erl_crash.dump-------------------------------
> 
> =erl_crash_dump:0.1
> Thu Sep 23 08:19:02 2010
> Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
> "heap").
> System version: Erlang R13B03 (erts-5.7.4) [rq:1] [async-threads:30]
> Compiled: Tue Nov 24 11:12:28 2009
> Atoms: 7290
> =memory
> total: 1175947208
> processes: 1172250988
> processes_used: 1172248436
> system: 3696220
> atom: 328561
> atom_used: 315456
> 
> regards
> Chandra
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/rabbitmq-server-start-crashing-on-start-tp29789216p29815736.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mikeb at rabbitmq.com  Mon Sep 27 14:39:24 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 27 Sep 2010 14:39:24 +0100
Subject: [rabbitmq-discuss] Thoughts from a new user
In-Reply-To: <8975685228782629149@unknownmsgid>
References: <mailman.520.1284758604.13459.rabbitmq-discuss@lists.rabbitmq.com>	<AANLkTinHfDm+xL_BKVuBgWzciRCeZbZohUeULQp-waZZ@mail.gmail.com>	<yrv4caan8myxt.fsf@dwragg.eng.vmware.com>	<AANLkTimwTOtKnX4jZFi8jCQffFNZJiAPBpNiO7whnbyK@mail.gmail.com>	<AANLkTimnPfhkPjRJ0C3KBkCpE7HuStwBD-s1CRGNhPu=@mail.gmail.com>	<4C9CFED1.40207@rabbitmq.com>	<AANLkTinMiF-1iRw-nKKF_-VWWLs=jxb0P6h7tx92163h@mail.gmail.com>	<4C9D0E63.2030708@rabbitmq.com>	<AANLkTimg5uN1O8QFRAaaTcb9CM7PYE5sGV-+Kn1_bbkT@mail.gmail.com>	<4C9D2933.1060401@rabbitmq.com>	<AANLkTik9_sYh-OJ4UbBahyt+shdaYyYvR2BdWps8QgJU@mail.gmail.com>	<AANLkTi=tYFN+xkZ_6AfuKXbeD+rF=3Ae5=eV=M0YMLb5@mail.gmail.com>
	<8975685228782629149@unknownmsgid>
Message-ID: <4CA09E8C.90700@rabbitmq.com>

Shane,

> I think the single most important that can be done is complete
> examples with all the code available on github. The examples should
> illustrate how to implement all the features and patterns.

We started this recently:
http://github.com/rabbitmq/rabbitmq-tutorials

The tutorial there now is intended to be the simplest thing that does 
something.  We want to go on to explain the common messaging patterns in 
more detail, all with proper examples.


Michael

> On Sep 25, 2010, at 10:42 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> 
>> I just wanted to thank everyone for all their input on this thread.
>> It has been really helpful.
>>
>> As some folks have pointed out we are keen to improve the docs.  The
>> site grew and grew and got a little chaotic.  It is being improved.
>> Certainly we will be adding some 'get started in small steps' info
>> too.  If anyone would like to contribute, especially with patterns and
>> examples, let us know.
>>
>> The roadmap question is a really interesting one for us.  To what
>> extent is it better to push forward quickly with broadening the reach
>> and possible use of Rabbit, versus strengthening its core?  Over time,
>> we try to do both, but at any given moment we may be leaning more in
>> one direction vs the other.  What are the best places where we can
>> engage with the community to achieve this?
>>
>> I'm very interested in people's thoughts on this ;-)
>>
>> alexis
>>
>>
>>
>> On Sat, Sep 25, 2010 at 3:23 AM, Adam Nelson <adam at varud.com> wrote:
>>> Matthias,
>>>
>>>> Ubuntu is an excellent example. They have quite a rigid release regime, so
>>>> it can take a while for an upstream package to make it into a release.
>>>> Ubuntu users are used to that. The question is, what do homebrew users
>>>> expect?
>>>>
>>>> We do have contacts at Canonical who we liaise with regarding the rabbitmq
>>>> packaging. Quite a few issues with rabbit and its packaging have been
>>>> resolved that way.  We'd like that situation to be the same for homebrew one
>>>> day. Let's see what we can do in the meantime ...
>>>>
>>> Homebrew is kind of a ... 'homebrew' right now.  I wish this hadn't been
>>> picked up as the main point of the thread, because it's really the most
>>> minor point - meant more as an example than anything else.
>>> Anyway, here are some instructions:
>>> http://ask.github.com/celery/getting-started/broker-installation.html#installing-rabbitmq-on-os-x
>>> Thanks,
>>> Adam
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From shane at digitalsanctum.com  Mon Sep 27 14:47:04 2010
From: shane at digitalsanctum.com (Shane)
Date: Mon, 27 Sep 2010 06:47:04 -0700 (PDT)
Subject: [rabbitmq-discuss] suggestions for failover
Message-ID: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>

I'd like suggestions on automating failover of brokers and the
consumers that are connected to them. The failover doesn't have to be
active/active and may take up to a half hour. Ideally, I'd like to
have at least two brokers located on different hosts. The hosts will
have access to the same file system (NFS). The number of messages will
be relatively small (<5K/day) and the number of queues no more than 10
so one broker running at a time should be sufficient.

I've looked at the clustering guide and it's purpose seems to be for
scaling but not failover.

I've also looked at the Pacemaker guide but it seems to be an involved
and more complicated setup than what I need.

What steps are others doing for failover? What are my options beyond
the Pacemaker guide?

Thanks,
Shane

From darrenl at 10cms.com  Mon Sep 27 14:54:18 2010
From: darrenl at 10cms.com (Darren Lee)
Date: Mon, 27 Sep 2010 08:54:18 -0500
Subject: [rabbitmq-discuss] Schedule Messages
Message-ID: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>

Hi everyone,

I'm looking for advice on the best way to schedule messages to be received after a certain time. I have a system where files get published out to a CDN and then the system needs to verify the files were propagated out correctly, this can sometimes take hours. I would like my subscriber to see a message, check for completion and if not put the message back on the queue to be dealt with in X minutes time.

Thanks for any help,
Darren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100927/9e305f14/attachment.htm>

From jon.brisbin at npcinternational.com  Mon Sep 27 16:40:27 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 27 Sep 2010 10:40:27 -0500
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
Message-ID: <438877CA-AB01-42A6-8295-03DBA3B10739@npcinternational.com>

I do something very similar with retries when operations triggered by a message fail. On failure, I write the message, exchange, routing key, and header information to a Riak server. A scheduled job comes along later and removes these messages from Riak and re-publishes them. The process may or may not be repeated N times, depending on whether later runs were successful or not.

I don't know if Rabbit has this functionality built-in, but having a "delayed delivery" would be awesome.

The only other way to do it is to actually publish and deliver a message, but have the consumer delay acting on it. I felt like a more reliable solution is to persist a message to a NoSQL store where I can delete, retrieve, or replay the message as many times as I want to. It adds another component to the mix, but I use Riak for things like this anyway, so why not? :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Sep 27, 2010, at 8:54 AM, Darren Lee wrote:

> Hi everyone,
> 
> I?m looking for advice on the best way to schedule messages to be received after a certain time. I have a system where files get published out to a CDN and then the system needs to verify the files were propagated out correctly, this can sometimes take hours. I would like my subscriber to see a message, check for completion and if not put the message back on the queue to be dealt with in X minutes time.
> 
> Thanks for any help,
> Darren
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100927/d3ed89cc/attachment.htm>

From dougbarth at gmail.com  Mon Sep 27 17:51:13 2010
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 27 Sep 2010 09:51:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
Message-ID: <f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>

We needed similar functionality. The way we implemented it was to
create a service queue that takes a message and headers to indicate
the target queue and when to deliver it. Messages are either delivered
immediately because their delivery window has past, or they are queued
to a beanstalk server with a delay. The beanstalk server will send the
message back to our process after the delay time is up, which then
delivers the queue to its target queue.

From fblanch at gmail.com  Mon Sep 27 20:38:15 2010
From: fblanch at gmail.com (alcalino)
Date: Mon, 27 Sep 2010 12:38:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Config file properties to change file handlers
Message-ID: <29822132.post@talk.nabble.com>


Hi all,

I'm trying  to change the number of rabbitmq file handlers in order to tune
the broker. But i cannot find any list with the config file properties in
order t modify them. Please do you know which one is the config file key to
change the file handler parameter, sockets, available memory , etc? Thanks a
lot in advance , best regards. 
-- 
View this message in context: http://old.nabble.com/Config-file-properties-to-change-file-handlers-tp29822132p29822132.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From lusis.org at gmail.com  Mon Sep 27 21:05:34 2010
From: lusis.org at gmail.com (lusis)
Date: Mon, 27 Sep 2010 13:05:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
Message-ID: <e4697e58-98f1-4492-b78e-79742befaae2@i5g2000yqe.googlegroups.com>


On Sep 27, 9:54?am, Darren Lee <darr... at 10cms.com> wrote:
<snip>

You could also stand up an instance of Apache Camel and have it manage
the process for you too. The DSL and spring xml methods are both very
easy to understand and configure.

From alexandru at rabbitmq.com  Mon Sep 27 21:12:34 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 27 Sep 2010 21:12:34 +0100
Subject: [rabbitmq-discuss] Config file properties to change file
 handlers
In-Reply-To: <29822132.post@talk.nabble.com>
References: <29822132.post@talk.nabble.com>
Message-ID: <20100927201234.GB2377@dakota>

Hi,

There was a thread on this topic a few weeks back:
 http://old.nabble.com/Config-File-Options-td29629339.html

Following Matthew's advice in one of the top comments, here are some
common options with their default values:
	{env,[{tcp_listeners,[{"0.0.0.0",5672}]},
	    {ssl_listeners,[]},
	    {ssl_options,[]},
	    {vm_memory_high_watermark,0.4},
	    {msg_store_index_module,rabbit_msg_store_ets_index},
	    {backing_queue_module,rabbit_variable_queue},
	    {persister_max_wrap_entries,500},
	    {persister_hibernate_after,10000},
	    {msg_store_file_size_limit,16777216},
	    {queue_index_max_journal_entries,262144},
	    {default_user,<<"guest">>},
	    {default_pass,<<"guest">>},
	    {default_user_is_admin,true},
	    {default_vhost,<<"/">>},
	    {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
	    {collect_statistics,none}]}

Most of these are undocumented, so they could change/disappear at any time
without warning.

Cheers,
Alex

On Mon, Sep 27, 2010 at 12:38:15PM -0700, alcalino wrote:
> 
> Hi all,
> 
> I'm trying  to change the number of rabbitmq file handlers in order to tune
> the broker. But i cannot find any list with the config file properties in
> order t modify them. Please do you know which one is the config file key to
> change the file handler parameter, sockets, available memory , etc? Thanks a
> lot in advance , best regards. 
> -- 
> View this message in context: http://old.nabble.com/Config-file-properties-to-change-file-handlers-tp29822132p29822132.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From clegnitto at mozilla.com  Mon Sep 27 21:25:34 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 27 Sep 2010 13:25:34 -0700
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <e4697e58-98f1-4492-b78e-79742befaae2@i5g2000yqe.googlegroups.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<e4697e58-98f1-4492-b78e-79742befaae2@i5g2000yqe.googlegroups.com>
Message-ID: <2F484EC5-31D1-481D-8276-174AC1E347DE@mozilla.com>

Can't the client just not ack the message if the files aren't there, thus leaving the message in the queue for the next retry?

Christian

On Sep 27, 2010, at 1:05 PM, lusis wrote:

> 
> On Sep 27, 9:54 am, Darren Lee <darr... at 10cms.com> wrote:
> <snip>
> 
> You could also stand up an instance of Apache Camel and have it manage
> the process for you too. The DSL and spring xml methods are both very
> easy to understand and configure.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Mon Sep 27 22:18:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 27 Sep 2010 22:18:55 +0100
Subject: [rabbitmq-discuss] Config file properties to change file
 handlers
In-Reply-To: <20100927201234.GB2377@dakota>
References: <29822132.post@talk.nabble.com>
 <20100927201234.GB2377@dakota>
Message-ID: <20100927211854.GA28906@wellquite.org>

On Mon, Sep 27, 2010 at 09:12:34PM +0100, Alexandru Scvor?ov wrote:
> There was a thread on this topic a few weeks back:
>  http://old.nabble.com/Config-File-Options-td29629339.html

Err yes, and none of those have anything to do with file descriptors.

Rabbit detects via ulimit what the current limit is for file
descriptors. There are ways of overriding that, but it's unlikely that's
ever a good idea. What platform are you on? If it's OS X or any linux,
you should configure this via ulimit. If it's Windows, then
unfortunately, due to the Erlang windows port using the windows C
runtime, it's limited to 512 - see
http://msdn.microsoft.com/en-us/library/6e3b887c%28VS.80%29.aspx, which
is unfortunate because a) it's very low, and b) actually, windows is
perfectly happy to large numbers, like 16m -
http://blogs.technet.com/markrussinovich/archive/2009/09/29/3283844.aspx
- it's just that the windows C runtime doesn't support that.

Matthew

From simon at rabbitmq.com  Mon Sep 27 23:13:52 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Sep 2010 23:13:52 +0100
Subject: [rabbitmq-discuss] Config file properties to change file
	handlers
In-Reply-To: <20100927201234.GB2377@dakota>
References: <29822132.post@talk.nabble.com> <20100927201234.GB2377@dakota>
Message-ID: <4CA11720.4030808@rabbitmq.com>

On 27/09/10 21:12, Alexandru Scvor?ov wrote:
> Hi,
>
> There was a thread on this topic a few weeks back:
>   http://old.nabble.com/Config-File-Options-td29629339.html

However, assuming that Alcalino is looking to increase the maximum 
number of file handles available, that's not in the config file - it's a 
matter of tuning how many handles the OS makes available to Rabbit. On 
Linux, check the manpage for limits.conf - lines something like:

rabbitmq soft nofile <number>
rabbitmq hard nofile <number>

Cheers, Simon

>
> Following Matthew's advice in one of the top comments, here are some
> common options with their default values:
> 	{env,[{tcp_listeners,[{"0.0.0.0",5672}]},
> 	    {ssl_listeners,[]},
> 	    {ssl_options,[]},
> 	    {vm_memory_high_watermark,0.4},
> 	    {msg_store_index_module,rabbit_msg_store_ets_index},
> 	    {backing_queue_module,rabbit_variable_queue},
> 	    {persister_max_wrap_entries,500},
> 	    {persister_hibernate_after,10000},
> 	    {msg_store_file_size_limit,16777216},
> 	    {queue_index_max_journal_entries,262144},
> 	    {default_user,<<"guest">>},
> 	    {default_pass,<<"guest">>},
> 	    {default_user_is_admin,true},
> 	    {default_vhost,<<"/">>},
> 	    {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
> 	    {collect_statistics,none}]}
>
> Most of these are undocumented, so they could change/disappear at any time
> without warning.
>
> Cheers,
> Alex
>
> On Mon, Sep 27, 2010 at 12:38:15PM -0700, alcalino wrote:
>>
>> Hi all,
>>
>> I'm trying  to change the number of rabbitmq file handlers in order to tune
>> the broker. But i cannot find any list with the config file properties in
>> order t modify them. Please do you know which one is the config file key to
>> change the file handler parameter, sockets, available memory , etc? Thanks a
>> lot in advance , best regards.
>> --
>> View this message in context: http://old.nabble.com/Config-file-properties-to-change-file-handlers-tp29822132p29822132.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From hrabbie at tilera.com  Tue Sep 28 01:18:24 2010
From: hrabbie at tilera.com (Harold Rabbie)
Date: Tue, 28 Sep 2010 00:18:24 +0000
Subject: [rabbitmq-discuss] Are .beam files compiled for any architecture?
Message-ID: <D0970E9E901AFA40A7CFC4227879AA4D7059D8@USCAEXCH1.tad.internal.tilera.com>

I've downloaded rabbitmq-server-generic-unix-2.1.0.tar.gz, and I see that it includes precompiled Erlang .beam files.

Are these .beam files compiled with native code optimization for the x86 architecture?

Or are they just straight Erlang byte codes, and can therefore run on any (non-x86) architecture?

Thanks!

Harold 


From matthias at rabbitmq.com  Tue Sep 28 01:26:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Sep 2010 01:26:04 +0100
Subject: [rabbitmq-discuss] Are .beam files compiled for any
	architecture?
In-Reply-To: <D0970E9E901AFA40A7CFC4227879AA4D7059D8@USCAEXCH1.tad.internal.tilera.com>
References: <D0970E9E901AFA40A7CFC4227879AA4D7059D8@USCAEXCH1.tad.internal.tilera.com>
Message-ID: <4CA1361C.1020502@rabbitmq.com>

Harold,

Harold Rabbie wrote:
> I've downloaded rabbitmq-server-generic-unix-2.1.0.tar.gz, and I see
> that it includes precompiled Erlang .beam files.
> 
> Are these .beam files compiled with native code optimization for the
> x86 architecture?
> 
> Or are they just straight Erlang byte codes, and can therefore run on
> any (non-x86) architecture?

All the beam files are non-native, compiled with R12, so should work 
across platforms on any Erlang later than that.

Btw, I haven't looked at the native compilation in Erlang for a while. 
For rabbit it didn't yield any benefits last time I tried.


Regards,

Matthias.

From mcallus at gmail.com  Tue Sep 28 08:31:07 2010
From: mcallus at gmail.com (=?ISO-8859-1?B?SXNh7WFz?=)
Date: Tue, 28 Sep 2010 09:31:07 +0200
Subject: [rabbitmq-discuss] change the log level?
Message-ID: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>

Hi all

I need to change te log level to Error and warning only but I don?t find
that properties I can use.
Can you tell me what properties in the config file I can change for it?
Thank you

Regards,
Isaias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100928/40366401/attachment.htm>

From darrenl at 10cms.com  Tue Sep 28 09:03:53 2010
From: darrenl at 10cms.com (Darren Lee)
Date: Tue, 28 Sep 2010 03:03:53 -0500
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <2F484EC5-31D1-481D-8276-174AC1E347DE@mozilla.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<e4697e58-98f1-4492-b78e-79742befaae2@i5g2000yqe.googlegroups.com>
	<2F484EC5-31D1-481D-8276-174AC1E347DE@mozilla.com>
Message-ID: <5BB7251A7DC8094B8024D868E77E139818B503E7CD@34093-MBX-C03.mex07a.mlsrvr.com>

It's more a case of not actually attempting to do the work until after a certain amount of time has passed to conserve resources.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Christian Legnitto
Sent: 27 September 2010 09:26
To: lusis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Schedule Messages

Can't the client just not ack the message if the files aren't there, thus leaving the message in the queue for the next retry?

Christian

On Sep 27, 2010, at 1:05 PM, lusis wrote:

> 
> On Sep 27, 9:54 am, Darren Lee <darr... at 10cms.com> wrote:
> <snip>
> 
> You could also stand up an instance of Apache Camel and have it manage 
> the process for you too. The DSL and spring xml methods are both very 
> easy to understand and configure.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From kalpesh.p at directi.com  Tue Sep 28 10:57:06 2010
From: kalpesh.p at directi.com (Kalpesh Patel)
Date: Tue, 28 Sep 2010 15:27:06 +0530
Subject: [rabbitmq-discuss] invalid command name "depends_skip_archcheck"
Message-ID: <4CA1BBF2.9030709@directi.com>

mac port install for rabbitmq-server not working. following is debug trace.

$ sudo port -d install rabbitmq-server
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/net/rabbitmq-server
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/net/rabbitmq-server
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: not using configure, so not adding the default universal variant
DEBUG: Requested variant darwin is not provided by port rabbitmq-server.
DEBUG: Requested variant i386 is not provided by port rabbitmq-server.
DEBUG: Requested variant macosx is not provided by port rabbitmq-server.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/erlang
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: erlang R14A_0 exists in the ports tree
DEBUG: erlang R14A_0 +darwin_10 is the latest installed
DEBUG: Merging existing variants darwin_10 into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/erlang
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: 'universal_variant no' specified, so not adding the default 
universal variant
DEBUG: Requested variant darwin is not provided by port erlang.
DEBUG: Requested variant i386 is not provided by port erlang.
DEBUG: Requested variant macosx is not provided by port erlang.
DEBUG: Executing variant darwin_10 provides darwin_10
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/gawk
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: gawk 3.1.8_0 exists in the ports tree
DEBUG: gawk 3.1.8_0  is the latest installed
DEBUG: gawk 3.1.8_0  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/lang/gawk
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Requested variant darwin is not provided by port gawk.
DEBUG: Requested variant i386 is not provided by port gawk.
DEBUG: Requested variant macosx is not provided by port gawk.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libiconv
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: libiconv 1.13.1_0 exists in the ports tree
DEBUG: libiconv 1.13.1_0  is the latest installed
DEBUG: libiconv 1.13.1_0  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libiconv
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port libiconv.
DEBUG: Requested variant i386 is not provided by port libiconv.
DEBUG: Requested variant macosx is not provided by port libiconv.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gperf
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: gperf 3.0.4_0 exists in the ports tree
DEBUG: gperf 3.0.4_0  is the latest installed
DEBUG: gperf 3.0.4_0  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gperf
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port gperf.
DEBUG: Requested variant i386 is not provided by port gperf.
DEBUG: Requested variant macosx is not provided by port gperf.
DEBUG: No need to upgrade! gperf 3.0.4_0 >= gperf 3.0.4_0
DEBUG: No need to upgrade! libiconv 1.13.1_0 >= libiconv 1.13.1_0
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gettext
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: gettext 0.18.1.1_2 exists in the ports tree
DEBUG: gettext 0.18.1.1_2  is the latest installed
DEBUG: gettext 0.18.1.1_2  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/gettext
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port gettext.
DEBUG: Requested variant i386 is not provided by port gettext.
DEBUG: Requested variant macosx is not provided by port gettext.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncurses
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: ncurses 5.7_0 exists in the ports tree
DEBUG: ncurses 5.7_0 +darwin_10 is the latest installed
DEBUG: ncurses 5.7_0 +darwin_10 is active
DEBUG: Merging existing variants darwin_10 into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncurses
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port ncurses.
DEBUG: Requested variant i386 is not provided by port ncurses.
DEBUG: Requested variant macosx is not provided by port ncurses.
DEBUG: Executing variant darwin_10 provides darwin_10
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncursesw
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: ncursesw 5.7_0 exists in the ports tree
DEBUG: ncursesw 5.7_0 +darwin_10 is the latest installed
DEBUG: ncursesw 5.7_0 +darwin_10 is active
DEBUG: Merging existing variants darwin_10 into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/devel/ncursesw
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port ncursesw.
DEBUG: Requested variant i386 is not provided by port ncursesw.
DEBUG: Requested variant macosx is not provided by port ncursesw.
DEBUG: Executing variant darwin_10 provides darwin_10
DEBUG: No need to upgrade! ncursesw 5.7_0 >= ncursesw 5.7_0
DEBUG: No need to upgrade! ncurses 5.7_0 >= ncurses 5.7_0
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/expat
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: expat 2.0.1_1 exists in the ports tree
DEBUG: expat 2.0.1_1  is the latest installed
DEBUG: expat 2.0.1_1  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/expat
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Requested variant darwin is not provided by port expat.
DEBUG: Requested variant i386 is not provided by port expat.
DEBUG: Requested variant macosx is not provided by port expat.
DEBUG: No need to upgrade! expat 2.0.1_1 >= expat 2.0.1_1
DEBUG: No need to upgrade! gettext 0.18.1.1_2 >= gettext 0.18.1.1_2
DEBUG: No need to upgrade! gawk 3.1.8_0 >= gawk 3.1.8_0
DEBUG: No need to upgrade! erlang R14A_0 >= erlang R14A_0
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxslt
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: libxslt 1.1.26_0 exists in the ports tree
DEBUG: libxslt 1.1.26_0  is the latest installed
DEBUG: libxslt 1.1.26_0  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxslt
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/muniversal-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: universal variant already exists, so not adding the default one
DEBUG: Requested variant darwin is not provided by port libxslt.
DEBUG: Requested variant i386 is not provided by port libxslt.
DEBUG: Requested variant macosx is not provided by port libxslt.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxml2
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: libxml2 2.7.7_0 exists in the ports tree
DEBUG: libxml2 2.7.7_0  is the latest installed
DEBUG: libxml2 2.7.7_0  is active
DEBUG: Merging existing variants  into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/libxml2
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/archcheck-1.0.tcl
DEBUG: adding the default universal variant
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: Requested variant darwin is not provided by port libxml2.
DEBUG: Requested variant i386 is not provided by port libxml2.
DEBUG: Requested variant macosx is not provided by port libxml2.
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/archivers/zlib
DEBUG: epoch: in tree: 0 installed: 0
DEBUG: zlib 1.2.5_0 exists in the ports tree
DEBUG: zlib 1.2.5_0 +macosx is the latest installed
DEBUG: zlib 1.2.5_0 +macosx is active
DEBUG: Merging existing variants macosx into variants
DEBUG: new fully merged portvariants:
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/archivers/zlib
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: Using group file 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/group/xcodeversion-1.0.tcl
DEBUG: Reading variant descriptions from 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/_resources/port1.0/variant_descriptions.conf
DEBUG: adding the default universal variant
DEBUG: Requested variant darwin is not provided by port zlib.
DEBUG: Requested variant i386 is not provided by port zlib.
DEBUG: Executing variant macosx provides macosx
DEBUG: No need to upgrade! zlib 1.2.5_0 >= zlib 1.2.5_0
DEBUG: No need to upgrade! libxml2 2.7.7_0 >= libxml2 2.7.7_0
DEBUG: No need to upgrade! libxslt 1.1.26_0 >= libxslt 1.1.26_0
--->  Computing dependencies for rabbitmq-server
DEBUG: Searching for dependency: erlang
DEBUG: Found Dependency: receipt exists for erlang
DEBUG: Searching for dependency: xmlto
DEBUG: Didn't find receipt, going to depspec regex for: xmlto
DEBUG: Found port in 
file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
DEBUG: Changing to port directory: 
/opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
DEBUG: OS Platform: darwin
DEBUG: OS Version: 10.3.0
DEBUG: Mac OS X Version: 10.6
DEBUG: System Arch: i386
DEBUG: setting option os.universal_supported to yes
DEBUG: org.macports.load registered provides 'load', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.unload registered provides 'unload', a pre-existing 
procedure. Target override will not be provided
DEBUG: org.macports.distfiles registered provides 'distfiles', a 
pre-existing procedure. Target override will not be provided
DEBUG: invalid command name "depends_skip_archcheck"
     while executing
"depends_skip_archcheck dblatex findutils coreutils"
     (file "Portfile" line 43)
     invoked from within
"source Portfile"
     invoked from within
"$workername eval source Portfile"
     (procedure "mportopen" line 46)
     invoked from within
"mportopen $portinfo(porturl) $options $variations"
     (procedure "mportdepends" line 66)
     invoked from within
"mportdepends $mport $target"
     (procedure "mportexec" line 35)
     invoked from within
"mportexec $workername $target"
Error: Unable to execute port: invalid command name "depends_skip_archcheck"
To report a bug, see <http://guide.macports.org/#project.tickets>



From david at rabbitmq.com  Tue Sep 28 11:34:32 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 28 Sep 2010 11:34:32 +0100
Subject: [rabbitmq-discuss] invalid command name "depends_skip_archcheck"
In-Reply-To: <4CA1BBF2.9030709@directi.com> (Kalpesh Patel's message of "Tue, 
	28 Sep 2010 15:27:06 +0530")
References: <4CA1BBF2.9030709@directi.com>
Message-ID: <yrv4cd3rykvgn.fsf@dwragg.eng.vmware.com>

Hi Kalpesh,

Kalpesh Patel <kalpesh.p at directi.com> writes:
> mac port install for rabbitmq-server not working. following is debug trace.
>
> $ sudo port -d install rabbitmq-server
> [...]
> DEBUG: Found port in
> file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
> DEBUG: Changing to port directory:
> /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
> [...]
> DEBUG: invalid command name "depends_skip_archcheck"

This is actually in the xmlto port, which rabbitmq-server depends on.

It looks like the depends_skip_archcheck was added to macports a few
months ago.  Maybe you need to do a "sudo port selfupdate"?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Tue Sep 28 12:19:20 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 28 Sep 2010 12:19:20 +0100
Subject: [rabbitmq-discuss] rabbitmq-server start crashing on start
In-Reply-To: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
	(Chandra R.'s message of "Thu, 23 Sep 2010 08:22:26 -0500")
References: <AANLkTim_f_t-PbY=XBhcUGm8ryDt66uX8Uy0rj0fPfbD@mail.gmail.com>
Message-ID: <yrv4c62xqktdz.fsf@dwragg.eng.vmware.com>

Hi Chandra,

Chandra R <mybayworkz at gmail.com> writes:
> I am trying to run rabbitmq 2.1.0 on my PC as a server with 2 gb ram. But it
> is crashing on start.
> Activating Rabbitmq plugins ...0 plugins activated and it crashes as erl.exe
> uses up all the memory.
>
> Is it because of resources  because I have set all the class paths and have
> erlang installed at C:\Elang\erl5.7.4
> and rabbitmq at C:\rabbit\rabbitmq_server-2.1.0 because I was told there
> were some issues when trying to install at "Program files" because of the
> space in the folder name.

There are no issue with installing rabbitmq-server in a folder with
spaces in its name.  We often test with it installed under "C:\Program
Files\RabbitMQ".

>  I am new to rabbitmq and  I have been trying to run it on Windows XP with
> 2.5 gb on a VM (Also tried on XP with 3.5 gb on a VM) but it crashes.

Can you confirm whether you are seeing this problem with a fresh install
of rabbitmq-server, or was rabbitmq-server already installed on the
machine?

> Later I found that I was using extension .conf instead of .config,
> which I corrected.

What are you putting in the .config file?  If you are just trying to get
rabbit running for te first time, you shouldn't generally need to put
anything in config files.

> Still it does the same thing, crashing. No logs are being created.
> I am using erlang 5.7.4 and tried rabbitmq 2.1.0 & 1.8.1.

Are you sure that no logs are being created?  By default,
rabbitmq-server will log to files in the folder "%APPDATA%\RabbitMQ\log"
(do "echo %APPDATA%" at a command prompt to find out what it is set to).
Normally there should be rabbit.log and rabbit-sasl.log files there.

> I have attached crash dump zip

Thanks for including that.  But I'm afraid that it doesn't really give
much clue as to the cause of your problem.

It does indicate that several minutes pass between the erlang VM
starting and the crash dump being produced.  Is that correct?  What is
happening during that time?  If you observe the process in Task Manager,
is it using a lot of CPU?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From shane at digitalsanctum.com  Tue Sep 28 14:31:58 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 28 Sep 2010 06:31:58 -0700 (PDT)
Subject: [rabbitmq-discuss] suggestions for failover
In-Reply-To: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>
References: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>
Message-ID: <a41ff4f3-7f77-4b5d-b26e-f8933ae4c2db@28g2000yqm.googlegroups.com>

Anyone? This seems like it would be a pretty basic requirement for
serious users of RabbitMQ.

On Sep 27, 9:47?am, Shane <sh... at digitalsanctum.com> wrote:
> I'd like suggestions on automating failover of brokers and the
> consumers that are connected to them. The failover doesn't have to be
> active/active and may take up to a half hour. Ideally, I'd like to
> have at least two brokers located on different hosts. The hosts will
> have access to the same file system (NFS). The number of messages will
> be relatively small (<5K/day) and the number of queues no more than 10
> so one broker running at a time should be sufficient.
>
> I've looked at the clustering guide and it's purpose seems to be for
> scaling but not failover.
>
> I've also looked at the Pacemaker guide but it seems to be an involved
> and more complicated setup than what I need.
>
> What steps are others doing for failover? What are my options beyond
> the Pacemaker guide?
>
> Thanks,
> Shane
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bmurphy1976 at gmail.com  Tue Sep 28 14:56:53 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 28 Sep 2010 08:56:53 -0500
Subject: [rabbitmq-discuss] Uncaught exception 'AMQPConnectionException'
 with message 'Parameter 'host' exceeds 32 characters limit
Message-ID: <AANLkTin2518-c4ViBd0gg2Jk6Kjo3fDE8HnSp3ONi=o1@mail.gmail.com>

I'm trying to use php pecl amqp to set up some monitoring scripts.  When I
create a connection using a valid DNS name, I get the following exception:

PHP Fatal error:  Uncaught exception 'AMQPConnectionException' with message
'Parameter 'host' exceeds 32 characters limit.'

Seems way too restrictive to me.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100928/ff86054f/attachment.htm>

From david at rabbitmq.com  Tue Sep 28 15:24:14 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 28 Sep 2010 15:24:14 +0100
Subject: [rabbitmq-discuss] suggestions for failover
In-Reply-To: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>
	(shane@digitalsanctum.com's message of "Mon, 27 Sep 2010 06:47:04
	-0700 (PDT)")
References: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>
Message-ID: <yrv4cr5gej69d.fsf@dwragg.eng.vmware.com>

Hi Shane,

Shane <shane at digitalsanctum.com> writes:
> I'd like suggestions on automating failover of brokers and the
> consumers that are connected to them. The failover doesn't have to be
> active/active and may take up to a half hour. Ideally, I'd like to
> have at least two brokers located on different hosts. The hosts will
> have access to the same file system (NFS). The number of messages will
> be relatively small (<5K/day) and the number of queues no more than 10
> so one broker running at a time should be sufficient.

Note that while RabbitMQ persistence is intended to work on top of NFS,
we haven't done performance testing of that configuration.  With the
message rates you mention, it seems unlikely that you'll run into
problems in that regards, but it's something to be aware of.

> I've looked at the clustering guide and it's purpose seems to be for
> scaling but not failover.

That's correct.  What we have traditionally termed clustering is
intended for scaling, not availability.

> I've also looked at the Pacemaker guide but it seems to be an involved
> and more complicated setup than what I need.
>
> What steps are others doing for failover? What are my options beyond
> the Pacemaker guide?

The pacemaker guide is intended to be illustrative, as well as giving a
concrete guide on one way to implement failover with RabbitMQ.  There
are alternative technologies, both open source and proprietary, that can
be used instead of pacemaker, drbd, etc.  We'd welcome reports from
users that have implemented failover using other products.

If you have configured rabbit to store its data on NFS, then you won't
need the drbd component.  And if you already have appropriate monitoring
and alerting arrangements in place, then you might well be able to
achieve a 30 minute failover time without using pacemaker or some other
cluster resource manager.  Even a manual failover process might be
acceptable in such a context.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From genkuro at gmail.com  Tue Sep 28 16:42:10 2010
From: genkuro at gmail.com (Brian_Fox)
Date: Tue, 28 Sep 2010 08:42:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang has closed?
In-Reply-To: <20100519151508.GC1896@mrnibble.lshift.net>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>
	<4BF2E9F0.6050809@rabbitmq.com>
	<alpine.OSX.2.00.1005181535070.92989@imac.local>
	<4BF2F082.1070602@rabbitmq.com>
	<alpine.OSX.2.00.1005191008320.96027@imac.local>
	<20100519145513.GA1896@mrnibble.lshift.net>
	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>
	<20100519151508.GC1896@mrnibble.lshift.net>
Message-ID: <29827331.post@talk.nabble.com>




Matthew Sackman wrote:
> 
> On Wed, May 19, 2010 at 11:06:23AM -0400, Tyler Williams wrote:
>> =INFO REPORT==== 17-May-2010::14:24:30 ===
>>     application: rabbit
>>     exited: {{timeout_waiting_for_tables,[rabbit_disk_queue]},
>>              {rabbit,start,[normal,[]]}}
>>     type: temporary
>> 
>> =ERROR REPORT==== 17-May-2010::14:24:30 ===
>> Error in process <0.100.0> on node 'rabbit at echonest03' with exit
>> value:
>> {badarg,[{ets,insert,[rabbit_disk_queue,[{dq_msg_loc,{{resource,<<1
>> byte>>,queue,<<9 bytes>>},553567},false,true,<<16
>> bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue,<<18
>> bytes>>},563611},false,true,<<16 bytes>>},{dq_msg_loc,{{resource,<<1
>> byte>>,queue,<<18 bytes>>},80964},false,true,<<16
>> bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue...
>> 
>> 
>> =INFO REPORT==== 17-May-2010::14:24:33 ===
>>     application: mnesia
>>     exited: stopped
>>     type: temporary
>> 
>> =INFO REPORT==== 17-May-2010::14:24:33 ===
>>     application: os_mon
>>     exited: stopped
>>     type: temporary
>> 
>> Can you shed any light on this error?
> 
> I might have been able to last October when I was writing that code. So
> much has changed since then that I really can't remember too much about
> what was going on back then.
> 
> Also, pyamqplib does not support channel.flow. Even with the new
> persister, there are times where rabbit gets overwhelmed (disks just
> aren't fast enough most of the time) and so needs to temporarily stop
> publishers. It does this by using channel.flow. Given that pyamqplib
> doesn't support channel.flow, you are very likely to run into problems.
> There's a highly experimental patch by Tony (search the mailing list for
> it) which adds support for channel.flow, but you might also try looking
> at the other python clients such as txamqp and pika.
> 
> Matthew
> 

(Sorry to resurrect an older thread)

Has this rabbitmq + pyamqplib problem ever been resolved?  

Our group is experimenting with bringing up a massive amount of AMQP clients
using EC2.  And we're running into the same error described above,
presumably slamming memory on the broker.  It seems like we have a few
choices: bump up the memory (8GB currently), choose a different library with
flow control, or choose a different strategy to rapidly boot several hundred
clients.  Of the three, the last would be the least attractive option.

Any suggestions on the best alternative lib to avoid this error?  I'm
hearing mixed things about txAMQP's support of channel flow.  

Would clustering help the issue or make it worse?  (we're currently a single
broker on a development platform)

Thanks much,
Brian  
-- 
View this message in context: http://old.nabble.com/Erlang-has-closed--tp28600093p29827331.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gturnquist at vmware.com  Tue Sep 28 17:00:21 2010
From: gturnquist at vmware.com (Greg Turnquist)
Date: Tue, 28 Sep 2010 09:00:21 -0700
Subject: [rabbitmq-discuss] Erlang has closed?
In-Reply-To: <29827331.post@talk.nabble.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>
	<4BF2E9F0.6050809@rabbitmq.com>
	<alpine.OSX.2.00.1005181535070.92989@imac.local>
	<4BF2F082.1070602@rabbitmq.com>
	<alpine.OSX.2.00.1005191008320.96027@imac.local>
	<20100519145513.GA1896@mrnibble.lshift.net>
	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>
	<20100519151508.GC1896@mrnibble.lshift.net>
	<29827331.post@talk.nabble.com>
Message-ID: <68EE72DD-80B4-4614-8A12-8378608BFEF9@vmware.com>

There is a third option to check out: pika (http://github.com/tonyg/pika)

For a couple blog articles showing it's usage, checkout:
* http://blog.springsource.com/2010/08/19/building-rabbitmq-apps-using-python/ - comparison of using pika vs. py-amqplib
* http://blog.springsource.com/2010/09/20/mixing-rabbitmq-with-spring-python/ - showing how pika-based apps can be mixed in with Spring Python, an IoC container for python

I haven't used pika in this type of environment, so I can't tell you if it suffers the same problems.

On Sep 28, 2010, at 10:42 AM, Brian_Fox wrote:




Matthew Sackman wrote:

On Wed, May 19, 2010 at 11:06:23AM -0400, Tyler Williams wrote:
=INFO REPORT==== 17-May-2010::14:24:30 ===
   application: rabbit
   exited: {{timeout_waiting_for_tables,[rabbit_disk_queue]},
            {rabbit,start,[normal,[]]}}
   type: temporary

=ERROR REPORT==== 17-May-2010::14:24:30 ===
Error in process <0.100.0> on node 'rabbit at echonest03' with exit
value:
{badarg,[{ets,insert,[rabbit_disk_queue,[{dq_msg_loc,{{resource,<<1
byte>>,queue,<<9 bytes>>},553567},false,true,<<16
bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue,<<18
bytes>>},563611},false,true,<<16 bytes>>},{dq_msg_loc,{{resource,<<1
byte>>,queue,<<18 bytes>>},80964},false,true,<<16
bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue...


=INFO REPORT==== 17-May-2010::14:24:33 ===
   application: mnesia
   exited: stopped
   type: temporary

=INFO REPORT==== 17-May-2010::14:24:33 ===
   application: os_mon
   exited: stopped
   type: temporary

Can you shed any light on this error?

I might have been able to last October when I was writing that code. So
much has changed since then that I really can't remember too much about
what was going on back then.

Also, pyamqplib does not support channel.flow. Even with the new
persister, there are times where rabbit gets overwhelmed (disks just
aren't fast enough most of the time) and so needs to temporarily stop
publishers. It does this by using channel.flow. Given that pyamqplib
doesn't support channel.flow, you are very likely to run into problems.
There's a highly experimental patch by Tony (search the mailing list for
it) which adds support for channel.flow, but you might also try looking
at the other python clients such as txamqp and pika.

Matthew


(Sorry to resurrect an older thread)

Has this rabbitmq + pyamqplib problem ever been resolved?

Our group is experimenting with bringing up a massive amount of AMQP clients
using EC2.  And we're running into the same error described above,
presumably slamming memory on the broker.  It seems like we have a few
choices: bump up the memory (8GB currently), choose a different library with
flow control, or choose a different strategy to rapidly boot several hundred
clients.  Of the three, the last would be the least attractive option.

Any suggestions on the best alternative lib to avoid this error?  I'm
hearing mixed things about txAMQP's support of channel flow.

Would clustering help the issue or make it worse?  (we're currently a single
broker on a development platform)

Thanks much,
Brian
--
View this message in context: http://old.nabble.com/Erlang-has-closed--tp28600093p29827331.html
Sent from the RabbitMQ mailing list archive at Nabble.com<http://Nabble.com>.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Greg Turnquist (gturnquist at vmware.com<mailto:gturnquist at vmware.com>)
Senior Software Engineer
SpringSource, A division of VMware
http://springsource.com


From adam at varud.com  Tue Sep 28 17:10:03 2010
From: adam at varud.com (Adam Nelson)
Date: Tue, 28 Sep 2010 12:10:03 -0400
Subject: [rabbitmq-discuss] Erlang has closed?
In-Reply-To: <29827331.post@talk.nabble.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>
	<4BF2E9F0.6050809@rabbitmq.com>
	<alpine.OSX.2.00.1005181535070.92989@imac.local>
	<4BF2F082.1070602@rabbitmq.com>
	<alpine.OSX.2.00.1005191008320.96027@imac.local>
	<20100519145513.GA1896@mrnibble.lshift.net>
	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>
	<20100519151508.GC1896@mrnibble.lshift.net>
	<29827331.post@talk.nabble.com>
Message-ID: <AANLkTimaqx9_MhzjtVa6+ENg4HeAzy69j2EDScghL7tY@mail.gmail.com>

Brian,

It seems like you should be using Pika - which support channel.flow:

http://github.com/tonyg/pika

As for the other issues, it seems like you'll certainly want to use high
memory extra large instances (or larger) for the broker.  You can also use
beefier clients (fewer of them).  I know these are just mitigating
strategies but they seem to make sense for your situation.

-Adam

On Tue, Sep 28, 2010 at 11:42 AM, Brian_Fox <genkuro at gmail.com> wrote:

>
>
>
> Matthew Sackman wrote:
> >
> > On Wed, May 19, 2010 at 11:06:23AM -0400, Tyler Williams wrote:
> >> =INFO REPORT==== 17-May-2010::14:24:30 ===
> >>     application: rabbit
> >>     exited: {{timeout_waiting_for_tables,[rabbit_disk_queue]},
> >>              {rabbit,start,[normal,[]]}}
> >>     type: temporary
> >>
> >> =ERROR REPORT==== 17-May-2010::14:24:30 ===
> >> Error in process <0.100.0> on node 'rabbit at echonest03' with exit
> >> value:
> >> {badarg,[{ets,insert,[rabbit_disk_queue,[{dq_msg_loc,{{resource,<<1
> >> byte>>,queue,<<9 bytes>>},553567},false,true,<<16
> >> bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue,<<18
> >> bytes>>},563611},false,true,<<16 bytes>>},{dq_msg_loc,{{resource,<<1
> >> byte>>,queue,<<18 bytes>>},80964},false,true,<<16
> >> bytes>>},{dq_msg_loc,{{resource,<<1 byte>>,queue...
> >>
> >>
> >> =INFO REPORT==== 17-May-2010::14:24:33 ===
> >>     application: mnesia
> >>     exited: stopped
> >>     type: temporary
> >>
> >> =INFO REPORT==== 17-May-2010::14:24:33 ===
> >>     application: os_mon
> >>     exited: stopped
> >>     type: temporary
> >>
> >> Can you shed any light on this error?
> >
> > I might have been able to last October when I was writing that code. So
> > much has changed since then that I really can't remember too much about
> > what was going on back then.
> >
> > Also, pyamqplib does not support channel.flow. Even with the new
> > persister, there are times where rabbit gets overwhelmed (disks just
> > aren't fast enough most of the time) and so needs to temporarily stop
> > publishers. It does this by using channel.flow. Given that pyamqplib
> > doesn't support channel.flow, you are very likely to run into problems.
> > There's a highly experimental patch by Tony (search the mailing list for
> > it) which adds support for channel.flow, but you might also try looking
> > at the other python clients such as txamqp and pika.
> >
> > Matthew
> >
>
> (Sorry to resurrect an older thread)
>
> Has this rabbitmq + pyamqplib problem ever been resolved?
>
> Our group is experimenting with bringing up a massive amount of AMQP
> clients
> using EC2.  And we're running into the same error described above,
> presumably slamming memory on the broker.  It seems like we have a few
> choices: bump up the memory (8GB currently), choose a different library
> with
> flow control, or choose a different strategy to rapidly boot several
> hundred
> clients.  Of the three, the last would be the least attractive option.
>
> Any suggestions on the best alternative lib to avoid this error?  I'm
> hearing mixed things about txAMQP's support of channel flow.
>
> Would clustering help the issue or make it worse?  (we're currently a
> single
> broker on a development platform)
>
> Thanks much,
> Brian
> --
> View this message in context:
> http://old.nabble.com/Erlang-has-closed--tp28600093p29827331.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100928/6b9c652a/attachment-0001.htm>

From matthias at rabbitmq.com  Tue Sep 28 18:19:06 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Sep 2010 18:19:06 +0100
Subject: [rabbitmq-discuss] channel.flow in pyampqlib (was: Re: Erlang has
 closed?)
In-Reply-To: <29827331.post@talk.nabble.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>	<4BF2E9F0.6050809@rabbitmq.com>	<alpine.OSX.2.00.1005181535070.92989@imac.local>	<4BF2F082.1070602@rabbitmq.com>	<alpine.OSX.2.00.1005191008320.96027@imac.local>	<20100519145513.GA1896@mrnibble.lshift.net>	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>	<20100519151508.GC1896@mrnibble.lshift.net>
	<29827331.post@talk.nabble.com>
Message-ID: <4CA2238A.4010301@rabbitmq.com>

Brian,

On 28/09/10 16:42, Brian_Fox wrote:
> Matthew Sackman wrote:
>> Also, pyamqplib does not support channel.flow. [...]
>
> Has this rabbitmq + pyamqplib problem ever been resolved?

As others have pointed out, pika may be an option. HOWEVER, since the 
2.0.0 release rabbit is using tcp backpressure to throttle producers, 
which should work with *any* client regardless of whether they support 
channel.flow. See the docs at http://www.rabbitmq.com/extensions.html#memsup

> Our group is experimenting with bringing up a massive amount of AMQP clients
> using EC2.  And we're running into the same error described above,
> presumably slamming memory on the broker.

What version of rabbitmq are you running? And exactly what problem are 
you seeing?


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Tue Sep 28 20:23:51 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 28 Sep 2010 14:23:51 -0500
Subject: [rabbitmq-discuss] question on message delivery
Message-ID: <69076849-8988-46F8-8DA3-E715D1E7D7D2@npcinternational.com>

In my Groovy Map/Reduce framework, I've got everything mapping and reducing but I'm having a little trouble making sure everything that needs to know a key change has occurred is notified correctly.

The flow is basically: an SQL statement is executed and individual records are submitted to the Map phase via AMQP message. The map closure calls emit() N number of times, which sends that data to the reduce closure via AMQP message. When a key change occurs, I send a control message, which has its own consumer inside the (Spring AMQP) message handler.

My question is basically: how do I know I've fully processed all potential messages for a given key? If I send a control message out, I'm going to assume there's at least a theoretical possibility of consuming that control message before all map messages have been delivered to the handler. I probably need a two-phase key switch. The handler should be alerted that a key change has occurred by the control message, but the handler itself should decide whether a key change has yet occurred.

Clear as mud? :)

I'm basically wondering if message delivery can occur out-of-order if consumers are bound to different exchanges? Assuming the control message of a key change is published after all the map messages go out (but on a different exchange) can I rely on the map and reduce handlers (which are separate consumers) to watch for key changes in the usual fashion? e.g.

lastKey = null;
...
void onMessage(msg) {
  ...
  if(newKey != lastKey) {
    keyChange();
    lastKey = newKey;
  }
  ...
  invokeAfterClosure(row);
}

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From davegreggory at yahoo.com  Tue Sep 28 20:29:47 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 28 Sep 2010 12:29:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
In-Reply-To: <4C90B33F.6090002@rabbitmq.com>
References: <509856.68626.qm@web111016.mail.gq1.yahoo.com>
	<4C90B33F.6090002@rabbitmq.com>
Message-ID: <847412.22324.qm@web111008.mail.gq1.yahoo.com>

We had something similar happen again last night. For some reason, one of our 
producers lost the connection to RabbitMQ at 7:47 PM but the shutDownCompleted 
event did not fire on that producer till 8:58 PM. We have a separate thread to 
send out messages from our app so that the app is unaffected should it lose 
messaging functionality. Starting at 7:47 PM, this separate thread started 
blocking and we lost all messages sent beyond its internal buffer's capacity. At 
about 8:58 the shutdown event fired, we automatically reconnected and everything 
returned to normal.

Both of our RabbitMQ nodes stayed up the whole time. No errors or VM HIGH 
WATERMARK events in the logs. This is on RabbitMQ 1.8.1 in our production 
environment. This is a very low volume environment, RabbitMQ nodes were only 
using about 30 MB of the 993 MB it allocated itself. No CPU / Memory / Disk 
spikes.

Any thoughts? Is there something in the java client api that could prevent the 
shutdownEvent from firing quickly? AMQP Heartbeats were mentioned in another 
thread, would that help and how do we enable these?



----- Original Message ----
From: Vlad Alexandru Ionescu <vlad at rabbitmq.com>
To: Dave Greggory <davegreggory at yahoo.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, September 15, 2010 7:51:27 AM
Subject: Re: [rabbitmq-discuss] Shutdown Listener on Java Client API


Hi Dave,

AFAIK, the event should fire regardless of the shutdown reason (be it 
connection loss, server initiated connection close, sudden socket 
closed, heartbeat timeout etc.). It appears to me that you are using it 
correctly.

Depending on the type of load balancer you are using, perhaps the 
clients never got disconnected? It is also possible that there is a bug 
in the client code.

Rgds,
Vlad.


On 09/13/2010 04:12 PM, Dave Greggory wrote:
> We register a shutdown listener to listen for connection-loss events and
> automatically re-connect clients to other RabbitMQ nodes in the cluster. This
> weekend we had to restart the load balancer that sits between rabbitmq and 
it's
> clients for some maintenance, but the 
ShutdownCompleted/ShutdownSignalException
> event never fired in the clients.
>
>
> I'm trying to understand how the shutdown signal works. Does it only fire the
> ShutDownCompleted event if RabbitMQ node shuts down and sends the signal back 
>to
> clients? If that's the case, I'm probably misusing it to detect 
>connection-loss.
> Is there a different way of detecting connection loss?
>
> Thanks,
> Dave
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    



      

From matthias at rabbitmq.com  Tue Sep 28 22:08:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Sep 2010 22:08:04 +0100
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
In-Reply-To: <847412.22324.qm@web111008.mail.gq1.yahoo.com>
References: <509856.68626.qm@web111016.mail.gq1.yahoo.com>	<4C90B33F.6090002@rabbitmq.com>
	<847412.22324.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <4CA25934.1000903@rabbitmq.com>

Dave,

Dave Greggory wrote:
> We had something similar happen again last night. For some reason, one of our 
> producers lost the connection to RabbitMQ at 7:47 PM

How did you observe this?

> but the shutDownCompleted event did not fire on that producer till 8:58 PM.

It's possible for a stale network connection to go undetected for a long 
time. The presence of firewalls and loadbalancers in the path seems to 
increase the likelihood of this happening.

> Any thoughts? Is there something in the java client api that could prevent the 
> shutdownEvent from firing quickly?

No. The most likely cause is that the tcp stack simply took that long to 
  notice the connection was dead.

> AMQP Heartbeats were mentioned in another thread, would that help and
> how do we enable these?

Yes, heartbeats would help. Enable them with 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.1.0/rabbitmq-java-client-javadoc-2.1.0/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)

You could also try playing with TCP's Keepalive settings.


Regards,

Matthias.

From davegreggory at yahoo.com  Tue Sep 28 23:16:52 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 28 Sep 2010 18:16:52 -0400
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
In-Reply-To: <4CA25934.1000903@rabbitmq.com>
References: <509856.68626.qm@web111016.mail.gq1.yahoo.com>
	<4C90B33F.6090002@rabbitmq.com>
	<847412.22324.qm@web111008.mail.gq1.yahoo.com>
	<4CA25934.1000903@rabbitmq.com>
Message-ID: <B332427A-10AA-4C9F-AF44-7CFB2ABE0690@yahoo.com>


>> We had something similar happen again last night. For some reason, one of our producers lost the connection to RabbitMQ at 7:47 PM
> 
> How did you observe this?

The client web app started dropping messages at 7:47 PM. The app queues messages in internal buffer and a separate thread goes and empties this queue by sending them to rabbitMQ. This async thread prevents any blocking message sends from affecting the rest of functionality. Since we observed dropped messages we can presume that the internal buffer / queue was full and the message send thread either blocked or slowed to a crawl. No errors or exceptions in that thread. No CPU or memory or disk use spikes. We kept dropping messages from 7:47 till 8:58 PM when it detected the connection loss and automatically re-connected. 

Can't say for sure that the connection was lost at 7:47 PM but all things point to it. 

I think I mentioned previously that RabbitMQ nodes stayed up. No message build (our queues are mostly empty all the time as our consumer is really fast). No errors in RabbitMQ logs. 

>> but the shutDownCompleted event did not fire on that producer till 8:58 PM.
> 
> It's possible for a stale network connection to go undetected for a long time. The presence of firewalls and loadbalancers in the path seems to increase the likelihood of this happening.

True, the problem is probably not in RabbitMQ... But we'd like to detect it as quickly as possible when it happens to take preventive action. 

>> Any thoughts? Is there something in the java client api that could prevent the shutdownEvent from firing quickly?
> 
> No. The most likely cause is that the tcp stack simply took that long to  notice the connection was dead.
> 
>> AMQP Heartbeats were mentioned in another thread, would that help and
>> how do we enable these?
> 
> Yes, heartbeats would help. Enable them with http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.1.0/rabbitmq-java-client-javadoc-2.1.0/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)
> 
> You could also try playing with TCP's 

Thanks will try heart beats, TCP keep alive's are already enabled by the load balancer. 

From danielius.jurna at gmail.com  Wed Sep 29 07:03:42 2010
From: danielius.jurna at gmail.com (Danielius Jurna)
Date: Tue, 28 Sep 2010 23:03:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Java Client Heartbeat
Message-ID: <db219b5a-71f0-4051-bb1d-38453b92577a@j18g2000yqd.googlegroups.com>

Hi.
I'm testing the robustness of rabbitmq server/java client on
unreliable network.
It seems that there is a flaw in heartbeat implementatin in java
client.
Here is the scenario.
1. Message producer tries to publish message to server. During this
connection is lost in the network. Client blocks on socket write.
(SocketFrameHandler.writeFrame)
2. Heartbeat implementation tries to send heartbeat message to server.
It also blocks in SocketFrameHandler.writeFrame on synchronized
statement.
3. The whole client blocks until tcp timeouts. This takes ages.

I cannot see how current implementation can work correctly until you
have separate heartbeat thread.
Is there a plan to improve java client robustness on unreliabile
networks?

From abhishek.kona at gmail.com  Wed Sep 29 09:29:18 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 29 Sep 2010 13:59:18 +0530
Subject: [rabbitmq-discuss] RabbitMQ Java Client Example
Message-ID: <4CA2F8DE.8000506@gmail.com>

  Hi

In http://www.rabbitmq.com/api-guide.html#core

the example says

factory.setHostName(hostName);
factory.setPortNumber(portNumber);

But I think according to the API it is
factory.setHost(hostName);
factory.setPort(portNumber);

Please check this.

Abhishek Kona


From mabrek at gmail.com  Wed Sep 29 10:09:59 2010
From: mabrek at gmail.com (mabrek)
Date: Wed, 29 Sep 2010 13:09:59 +0400
Subject: [rabbitmq-discuss] channel.flow in pyampqlib (was: Re: Erlang
	has closed?)
In-Reply-To: <4CA2238A.4010301@rabbitmq.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>
	<4BF2E9F0.6050809@rabbitmq.com>
	<alpine.OSX.2.00.1005181535070.92989@imac.local>
	<4BF2F082.1070602@rabbitmq.com>
	<alpine.OSX.2.00.1005191008320.96027@imac.local>
	<20100519145513.GA1896@mrnibble.lshift.net>
	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>
	<20100519151508.GC1896@mrnibble.lshift.net>
	<29827331.post@talk.nabble.com> <4CA2238A.4010301@rabbitmq.com>
Message-ID: <AANLkTi=b3quZATSbXrFvDXNgSPurPanHcHVJReYE8Uqo@mail.gmail.com>

On Tue, Sep 28, 2010 at 9:19 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> As others have pointed out, pika may be an option. HOWEVER, since the 2.0.0
> release rabbit is using tcp backpressure to throttle producers, which should
> work with *any* client regardless of whether they support channel.flow. See
> the docs at http://www.rabbitmq.com/extensions.html#memsup

Java client uses blocking IO. It would hang on writing to server that
throttles producers. Dealing with it means starting separate thread by
hands for every connection just to use BlockingQueue.offer with
timeout.

Do you have any plans to switch java client to non-blocking IO (NIO)
and introduce timeouts in content sending methods?

Regards,
Anton Lebedevich.

From majek04 at gmail.com  Wed Sep 29 11:38:21 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Sep 2010 11:38:21 +0100
Subject: [rabbitmq-discuss] change the log level?
In-Reply-To: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>
References: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>
Message-ID: <AANLkTik3tR0GtuhKmdLSDU_FwMPHkhPVp_DyQaWT5E1B@mail.gmail.com>

I don't understand the question. If you are speaking about
RabbitMQ logs, they don't go to usual syslog, but rather
they are saved to Rabbitmq specific files. So nor Warn nor Error
log levels apply.

Marek

On Tue, Sep 28, 2010 at 08:31, Isa?as <mcallus at gmail.com> wrote:
> Hi all
>
> I need to change te log level to Error and warning only but I don?t find
> that properties I can use.
> Can you tell me what properties in the config file I can change for it?
> Thank you
>
> Regards,
> Isaias
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Wed Sep 29 11:42:24 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Sep 2010 11:42:24 +0100
Subject: [rabbitmq-discuss] change the log level?
In-Reply-To: <AANLkTik3tR0GtuhKmdLSDU_FwMPHkhPVp_DyQaWT5E1B@mail.gmail.com>
References: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>
	<AANLkTik3tR0GtuhKmdLSDU_FwMPHkhPVp_DyQaWT5E1B@mail.gmail.com>
Message-ID: <AANLkTikMUkGEKWnM49DUM8Gcc09JmBctyjCSQqPA3Kab@mail.gmail.com>

Ok, I was wrong, actually the stuff in our logs is Error/Warn/Info.

So do you want to kill the Info messages?

On Wed, Sep 29, 2010 at 11:38, Marek Majkowski <majek04 at gmail.com> wrote:
> I don't understand the question. If you are speaking about
> RabbitMQ logs, they don't go to usual syslog, but rather
> they are saved to Rabbitmq specific files. So nor Warn nor Error
> log levels apply.

From kalpesh.p at directi.com  Wed Sep 29 13:48:50 2010
From: kalpesh.p at directi.com (Kalpesh Patel)
Date: Wed, 29 Sep 2010 18:18:50 +0530
Subject: [rabbitmq-discuss] invalid command name "depends_skip_archcheck"
In-Reply-To: <yrv4cd3rykvgn.fsf@dwragg.eng.vmware.com>
References: <4CA1BBF2.9030709@directi.com>
	<yrv4cd3rykvgn.fsf@dwragg.eng.vmware.com>
Message-ID: <4CA335B2.1040907@directi.com>

Thanks David

After port update I able to install rabbitmq-server

- Kalpesh


On 28/09/10 4:04 PM, David Wragg wrote:
> Hi Kalpesh,
>
> Kalpesh Patel<kalpesh.p at directi.com>  writes:
>    
>> mac port install for rabbitmq-server not working. following is debug trace.
>>
>> $ sudo port -d install rabbitmq-server
>> [...]
>> DEBUG: Found port in
>> file:///opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
>> DEBUG: Changing to port directory:
>> /opt/local/var/macports/sources/rsync.macports.org/release/ports/textproc/xmlto
>> [...]
>> DEBUG: invalid command name "depends_skip_archcheck"
>>      
> This is actually in the xmlto port, which rabbitmq-server depends on.
>
> It looks like the depends_skip_archcheck was added to macports a few
> months ago.  Maybe you need to do a "sudo port selfupdate"?
>
> David
>
>    


From majek04 at gmail.com  Wed Sep 29 14:09:28 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Sep 2010 14:09:28 +0100
Subject: [rabbitmq-discuss] Uncaught exception 'AMQPConnectionException'
 with message 'Parameter 'host' exceeds 32 characters limit
In-Reply-To: <AANLkTin2518-c4ViBd0gg2Jk6Kjo3fDE8HnSp3ONi=o1@mail.gmail.com>
References: <AANLkTin2518-c4ViBd0gg2Jk6Kjo3fDE8HnSp3ONi=o1@mail.gmail.com>
Message-ID: <AANLkTik8h-eh74E=xjDZ7ANnAEDBDspTk=c6B2bO==Bs@mail.gmail.com>

I'm afraid we know nothing about the php lib. But going through
the sources reveals more 32-byte limits:
http://svn.php.net/repository/pecl/amqp/trunk/amqp.c

Let's ask the author:

Pieter,
  is there any reason for the 32 byte limits?

Cheers,
  Marek

On Tue, Sep 28, 2010 at 14:56, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> I'm trying to use php pecl amqp to set up some monitoring scripts. ?When I
> create a connection using a valid DNS name, I get the following exception:
> PHP Fatal error: ?Uncaught exception 'AMQPConnectionException' with message
> 'Parameter 'host' exceeds 32 characters limit.'
>
> Seems way too restrictive to me.

From mcallus at gmail.com  Wed Sep 29 14:10:08 2010
From: mcallus at gmail.com (=?ISO-8859-1?B?SXNh7WFz?=)
Date: Wed, 29 Sep 2010 15:10:08 +0200
Subject: [rabbitmq-discuss] change the log level?
In-Reply-To: <AANLkTikMUkGEKWnM49DUM8Gcc09JmBctyjCSQqPA3Kab@mail.gmail.com>
References: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>
	<AANLkTik3tR0GtuhKmdLSDU_FwMPHkhPVp_DyQaWT5E1B@mail.gmail.com>
	<AANLkTikMUkGEKWnM49DUM8Gcc09JmBctyjCSQqPA3Kab@mail.gmail.com>
Message-ID: <AANLkTin1z4yT4FCYVt-+u1K2h6RrGQq4=ThfprfRtryG@mail.gmail.com>

Yes, I want Kill the info messages becouse it generate a very big file (>90
MB)
Is it possible??


2010/9/29 Marek Majkowski <majek04 at gmail.com>

> Ok, I was wrong, actually the stuff in our logs is Error/Warn/Info.
>
> So do you want to kill the Info messages?
>
> On Wed, Sep 29, 2010 at 11:38, Marek Majkowski <majek04 at gmail.com> wrote:
> > I don't understand the question. If you are speaking about
> > RabbitMQ logs, they don't go to usual syslog, but rather
> > they are saved to Rabbitmq specific files. So nor Warn nor Error
> > log levels apply.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/6bb48d7f/attachment.htm>

From majek04 at gmail.com  Wed Sep 29 14:29:29 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Sep 2010 14:29:29 +0100
Subject: [rabbitmq-discuss] change the log level?
In-Reply-To: <AANLkTin1z4yT4FCYVt-+u1K2h6RrGQq4=ThfprfRtryG@mail.gmail.com>
References: <AANLkTikASXcJWJKRrLRkC8qgy5q5ZpHGQGHZ+83eti6k@mail.gmail.com>
	<AANLkTik3tR0GtuhKmdLSDU_FwMPHkhPVp_DyQaWT5E1B@mail.gmail.com>
	<AANLkTikMUkGEKWnM49DUM8Gcc09JmBctyjCSQqPA3Kab@mail.gmail.com>
	<AANLkTin1z4yT4FCYVt-+u1K2h6RrGQq4=ThfprfRtryG@mail.gmail.com>
Message-ID: <AANLkTi=34ZSrDXR4z8K7zAv41=LvdoOKU=Y81qqr4fGb@mail.gmail.com>

On Wed, Sep 29, 2010 at 14:10, Isa?as <mcallus at gmail.com> wrote:
> Yes, I want Kill the info messages becouse it generate a very big file (>90
> MB)
> Is it possible??

Probably, but it's rather not trivial and may require changes in the code.

What you could do instead is to run `rabbitmqctl rotate_logs .1`, to force
rabbitmq to rotate logs. You can gzip or remove old logs after that.

Details:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Commands

From vlad at rabbitmq.com  Wed Sep 29 14:46:43 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 29 Sep 2010 14:46:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client Example
In-Reply-To: <4CA2F8DE.8000506@gmail.com>
References: <4CA2F8DE.8000506@gmail.com>
Message-ID: <4CA34343.4000801@rabbitmq.com>


Thank you! It seems you are right. I have filed a bug for that.

Rgds,
Vlad.


On 09/29/2010 09:29 AM, Abhishek Kona wrote:
>  Hi
>
> In http://www.rabbitmq.com/api-guide.html#core
>
> the example says
>
> factory.setHostName(hostName);
> factory.setPortNumber(portNumber);
>
> But I think according to the API it is
> factory.setHost(hostName);
> factory.setPort(portNumber);
>
> Please check this.
>
> Abhishek Kona
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wdrozd at i-a-i.com  Wed Sep 29 14:55:48 2010
From: wdrozd at i-a-i.com (wdrozd)
Date: Wed, 29 Sep 2010 06:55:48 -0700 (PDT)
Subject: [rabbitmq-discuss]  Rabbit MQ AMQP
Message-ID: <29838814.post@talk.nabble.com>


I have a couple of questions about Rabbit MQ:

1) On the home page it says that Rabbit MQ is the leading implementation of
AMQP, but Rabbit MQ doesn't support 0-10, only 0-9-1. What do you mean when
you say "leading" do you mean "most users"? 

2) What are the differences between AMQP 0-9-1 and 0-10? I cannot find a
changes list at all.

3) Is Rabbit MQ planning on implementing AMQP 1.0? 

4) Is Rabbit MQ owned by VMWare?

I am trying to decide between Rabbit MQ and QPid, does anyone have an
opinion on this?
-- 
View this message in context: http://old.nabble.com/Rabbit-MQ-AMQP-tp29838814p29838814.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexis at rabbitmq.com  Wed Sep 29 15:08:49 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 29 Sep 2010 15:08:49 +0100
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <29838814.post@talk.nabble.com>
References: <29838814.post@talk.nabble.com>
Message-ID: <AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>

Hi,

On Wed, Sep 29, 2010 at 2:55 PM, wdrozd <wdrozd at i-a-i.com> wrote:
>
> I have a couple of questions about Rabbit MQ:
>
> 1) On the home page it says that Rabbit MQ is the leading implementation of
> AMQP, but Rabbit MQ doesn't support 0-10, only 0-9-1. What do you mean when
> you say "leading" do you mean "most users"?

Most users and largest number of implementations.



> 2) What are the differences between AMQP 0-9-1 and 0-10? I cannot find a
> changes list at all.

AMQP 0-9-1 was created after 0-10.  Both are preceded by 0-9.

I'm not sure if a list of changes is in the public domain.  It would
not be a simple document to write.




> 3) Is Rabbit MQ planning on implementing AMQP 1.0?

When we know what it is.



> 4) Is Rabbit MQ owned by VMWare?

Yes.



> I am trying to decide between Rabbit MQ and QPid, does anyone have an
> opinion on this?

It depends what problem you are trying to solve.  The two products
have different strengths.

alexis



> --
> View this message in context: http://old.nabble.com/Rabbit-MQ-AMQP-tp29838814p29838814.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From vlad at rabbitmq.com  Wed Sep 29 15:16:23 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 29 Sep 2010 15:16:23 +0100
Subject: [rabbitmq-discuss] question on message delivery
In-Reply-To: <69076849-8988-46F8-8DA3-E715D1E7D7D2@npcinternational.com>
References: <69076849-8988-46F8-8DA3-E715D1E7D7D2@npcinternational.com>
Message-ID: <4CA34A37.40804@rabbitmq.com>


Hi Jon,


Message ordering is _only_ guaranteed if the messages follow the same path:

   Publisher Channel -> Exchange -> Queue -> Consumer Channel.

If any of these four is different for any two messages, then the 
messages may arrive out of order.
Hope that answers your question.


Rgds,
Vlad.



On 09/28/2010 08:23 PM, Jon Brisbin wrote:
> In my Groovy Map/Reduce framework, I've got everything mapping and reducing but I'm having a little trouble making sure everything that needs to know a key change has occurred is notified correctly.
>
> The flow is basically: an SQL statement is executed and individual records are submitted to the Map phase via AMQP message. The map closure calls emit() N number of times, which sends that data to the reduce closure via AMQP message. When a key change occurs, I send a control message, which has its own consumer inside the (Spring AMQP) message handler.
>
> My question is basically: how do I know I've fully processed all potential messages for a given key? If I send a control message out, I'm going to assume there's at least a theoretical possibility of consuming that control message before all map messages have been delivered to the handler. I probably need a two-phase key switch. The handler should be alerted that a key change has occurred by the control message, but the handler itself should decide whether a key change has yet occurred.
>
> Clear as mud? :)
>
> I'm basically wondering if message delivery can occur out-of-order if consumers are bound to different exchanges? Assuming the control message of a key change is published after all the map messages go out (but on a different exchange) can I rely on the map and reduce handlers (which are separate consumers) to watch for key changes in the usual fashion? e.g.
>
> lastKey = null;
> ...
> void onMessage(msg) {
>    ...
>    if(newKey != lastKey) {
>      keyChange();
>      lastKey = newKey;
>    }
>    ...
>    invokeAfterClosure(row);
> }
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

From felix at ravelsoft.com  Wed Sep 29 15:22:28 2010
From: felix at ravelsoft.com (=?iso-8859-1?Q?F=E9lix_Delval?=)
Date: Wed, 29 Sep 2010 16:22:28 +0200
Subject: [rabbitmq-discuss] Rabbitmq - "Protocol: ~p: register error: ~p~n"
Message-ID: <E1D94E64-C3D2-447C-865D-2EF51AA2F965@ravelsoft.com>

Hello,

I am trying to get rabbitmq-server running, but I seem to have some issues. I am running Ubuntu 10.04.1 LTS.

When launching the rabbitmg-server through it's init.d script i get these errors in the log files:

{error_logger,{{2010,9,29},{16,21,1}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,9,29},{16,21,1}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.116>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,481}],[]]}
{error_logger,{{2010,9,29},{16,21,1}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,9,29},{16,21,1}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,9,29},{16,21,1}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

I have joined the erl_crash.dump

-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 233094 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/37ca24cf/attachment-0001.obj>
-------------- next part --------------



I have checked that there is no other running entities of the server.

Thank you for you help

--
F?lix Delval

From vlad at rabbitmq.com  Wed Sep 29 15:35:51 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 29 Sep 2010 15:35:51 +0100
Subject: [rabbitmq-discuss] Rabbitmq - "Protocol: ~p: register error:
 ~p~n"
In-Reply-To: <E1D94E64-C3D2-447C-865D-2EF51AA2F965@ravelsoft.com>
References: <E1D94E64-C3D2-447C-865D-2EF51AA2F965@ravelsoft.com>
Message-ID: <4CA34EC7.10200@rabbitmq.com>


Hi F?lix,

> I have checked that there is no other running entities of the server.

Indeed, it looks like there is another rabbit instance running. Can you 
double check? The process is called beam.smp - there could be more than 
one (look for root processes as well).

Did you install rabbit from the standard Ubuntu repo? Which version is it?


Rgds,
Vlad.


From david at rabbitmq.com  Wed Sep 29 15:51:11 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 29 Sep 2010 15:51:11 +0100
Subject: [rabbitmq-discuss] Rabbitmq - "Protocol: ~p: register error:
	~p~n"
In-Reply-To: <E1D94E64-C3D2-447C-865D-2EF51AA2F965@ravelsoft.com>
	(=?utf-8?Q?=22F=C3=A9lix?=
	Delval"'s message of "Wed, 29 Sep 2010 16:22:28 +0200")
References: <E1D94E64-C3D2-447C-865D-2EF51AA2F965@ravelsoft.com>
Message-ID: <yrv4c4od8k3hc.fsf@dwragg.eng.vmware.com>

Hi F?lix,

F?lix Delval <felix at ravelsoft.com> writes:
> I am trying to get rabbitmq-server running, but I seem to have some issues. I am running Ubuntu 10.04.1 LTS.
>
> When launching the rabbitmg-server through it's init.d script i get these errors in the log files:
>
> [...]
>
> I have checked that there is no other running entities of the server.

This error does usually indicate that rabbitmq-server is already running
(more precisely, it means that another Erlang node with the same name is
already running).  Are you sure that there are no other running
instances?  Check the output of "ps ax" for "beam" processes.

If you are absolutely sure it is not running, kill the epmd process, and
then try starting it again.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jon.brisbin at npcinternational.com  Wed Sep 29 15:56:19 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Wed, 29 Sep 2010 09:56:19 -0500
Subject: [rabbitmq-discuss] question on message delivery
In-Reply-To: <4CA34A37.40804@rabbitmq.com>
References: <69076849-8988-46F8-8DA3-E715D1E7D7D2@npcinternational.com>
	<4CA34A37.40804@rabbitmq.com>
Message-ID: <3BD21F4E-75C9-477A-A667-0DFA56CA2F39@npcinternational.com>


On Sep 29, 2010, at 9:16 AM, Vlad Alexandru Ionescu wrote:

> 
> Hi Jon,
> 
> 
> Message ordering is _only_ guaranteed if the messages follow the same path:
> 
>  Publisher Channel -> Exchange -> Queue -> Consumer Channel.
> 
> If any of these four is different for any two messages, then the messages may arrive out of order.


Assuming data like this:

KEY1
KEY1
KEY1
KEY2
KEY2
KEY2

...and assuming three consumers, can I rely on data from KEY2 to arrive after any possible data for KEY1 in each consumer? In other words, on my consumers, I will see this:

Consumer 1: KEY1    Consumer 2: KEY1    Consumer 3: KEY1
Consumer 1: KEY2    Consumer 2: KEY2    Consumer 3: KEY2

and NOT:

Consumer 1: KEY1    Consumer 2: KEY2    Consumer 3: KEY2
Consumer 1: KEY2    Consumer 2: KEY1    Consumer 3: KEY1

The only thing that's different here are the consumer channels. Everything else follows the same path.

Thanks for the info! :)

jb




From thiago.rondon at gmail.com  Wed Sep 29 15:57:06 2010
From: thiago.rondon at gmail.com (Thiago Rondon)
Date: Wed, 29 Sep 2010 11:57:06 -0300
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
Message-ID: <AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>

>> I am trying to decide between Rabbit MQ and QPid, does anyone have an
>> opinion on this?
>
> It depends what problem you are trying to solve. ?The two products
> have different strengths.
>

Alexis,

Can you explain in your opinion more about the strengths of both ?

Thanks,
-Thiago Rondon

From matthew at rabbitmq.com  Wed Sep 29 15:59:57 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Sep 2010 15:59:57 +0100
Subject: [rabbitmq-discuss] question on message delivery
In-Reply-To: <3BD21F4E-75C9-477A-A667-0DFA56CA2F39@npcinternational.com>
References: <69076849-8988-46F8-8DA3-E715D1E7D7D2@npcinternational.com>
	<4CA34A37.40804@rabbitmq.com>
	<3BD21F4E-75C9-477A-A667-0DFA56CA2F39@npcinternational.com>
Message-ID: <20100929145956.GC29758@wellquite.org>

On Wed, Sep 29, 2010 at 09:56:19AM -0500, Jon Brisbin wrote:
> ...and assuming three consumers, can I rely on data from KEY2 to arrive after any possible data for KEY1 in each consumer? In other words, on my consumers, I will see this:
> 
> Consumer 1: KEY1    Consumer 2: KEY1    Consumer 3: KEY1
> Consumer 1: KEY2    Consumer 2: KEY2    Consumer 3: KEY2
> 
> and NOT:
> 
> Consumer 1: KEY1    Consumer 2: KEY2    Consumer 3: KEY2
> Consumer 1: KEY2    Consumer 2: KEY1    Consumer 3: KEY1

Sort of. That assumes the consumers work at the same rate. Other valid
combinations would include

Consmuer 1: KEY 1    Consumer 2:         Consumer 3:
Consmuer 1: KEY 1
Consmuer 1: KEY 1
Consmuer 1: KEY 2
Consmuer 1: KEY 2
Consmuer 1: KEY 2

Consumer 1: KEY 1
Consumer 1: KEY 1
Consumer 1: KEY 1
Consmuer 1: KEY 2    Consumer 2: KEY 2   Consumer 3: KEY 2

and so forth.

Matthew

From adam at varud.com  Wed Sep 29 16:09:25 2010
From: adam at varud.com (Adam Nelson)
Date: Wed, 29 Sep 2010 11:09:25 -0400
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
	<AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>
Message-ID: <AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>

>
> Alexis,
>
> Can you explain in your opinion more about the strengths of both ?
>
> Thanks,
> -Thiago Rondon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


Thiago,

I ended up picking RabbitMQ because of its maturity and because Celery says
it's the most commonly used and since I'm definitely using Celery, the rest
is a cascading decision for me.

In the interest of completeness however, people are also using ZeroMQ also
which has alot of open source support and goes through OpenAMQ (at least
that's how I understand it):

http://www.zeromq.org/docs:welcome-from-amqp
http://www.openamq.org/

For me it's all about Python support and docs (since I'm
developer-constrained).

-Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/449550fe/attachment.htm>

From videlalvaro at gmail.com  Wed Sep 29 16:12:27 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 29 Sep 2010 23:12:27 +0800
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
	<AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>
	<AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>
Message-ID: <5D81A753-2602-4813-937C-1D0C2A78D94A@gmail.com>

I would add that ZeroMQ is a library for networking while RabbitMQ is a complete messaging broker, so I wouldn't compare them?


On Sep 29, 2010, at 11:09 PM, Adam Nelson wrote:

> Alexis,
> 
> Can you explain in your opinion more about the strengths of both ?
> 
> Thanks,
> -Thiago Rondon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> Thiago,
> 
> I ended up picking RabbitMQ because of its maturity and because Celery says it's the most commonly used and since I'm definitely using Celery, the rest is a cascading decision for me.  
> 
> In the interest of completeness however, people are also using ZeroMQ also which has alot of open source support and goes through OpenAMQ (at least that's how I understand it):
> 
> http://www.zeromq.org/docs:welcome-from-amqp
> http://www.openamq.org/
> 
> For me it's all about Python support and docs (since I'm developer-constrained).
> 
> -Adam
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/b1c6a847/attachment.htm>

From shane at digitalsanctum.com  Wed Sep 29 16:13:35 2010
From: shane at digitalsanctum.com (Shane)
Date: Wed, 29 Sep 2010 08:13:35 -0700 (PDT)
Subject: [rabbitmq-discuss] suggestions for failover
In-Reply-To: <yrv4cr5gej69d.fsf@dwragg.eng.vmware.com>
References: <bd5648d7-a321-45b0-87a9-e6c1af868397@t20g2000yqa.googlegroups.com>
	<yrv4cr5gej69d.fsf@dwragg.eng.vmware.com>
Message-ID: <9108ff9e-543e-461b-a602-f3f479a247b4@l6g2000yqb.googlegroups.com>

Am I correct in that anything connected to the broker needs to
reconnect (via new hostname) after the failover takes place? So the
sequence needs to be something like the following:

Producers, Consumers connected to Broker 1
Failover occurs: Broker 1 goes down, Broker 2 comes up
Producers, Consumers reconnect to Broker 2

In general, it would be nice to have documentation that outlines what
needs to occur in a failover scenario as opposed to outlining steps of
a specific implementation (the Pacemaker guide).

Thanks,
Shane


On Sep 28, 10:24?am, David Wragg <da... at rabbitmq.com> wrote:
> Hi Shane,
>
> Shane <sh... at digitalsanctum.com> writes:
> > I'd like suggestions on automating failover of brokers and the
> > consumers that are connected to them. The failover doesn't have to be
> > active/active and may take up to a half hour. Ideally, I'd like to
> > have at least two brokers located on different hosts. The hosts will
> > have access to the same file system (NFS). The number of messages will
> > be relatively small (<5K/day) and the number of queues no more than 10
> > so one broker running at a time should be sufficient.
>
> Note that while RabbitMQ persistence is intended to work on top of NFS,
> we haven't done performance testing of that configuration. ?With the
> message rates you mention, it seems unlikely that you'll run into
> problems in that regards, but it's something to be aware of.
>
> > I've looked at the clustering guide and it's purpose seems to be for
> > scaling but not failover.
>
> That's correct. ?What we have traditionally termed clustering is
> intended for scaling, not availability.
>
> > I've also looked at the Pacemaker guide but it seems to be an involved
> > and more complicated setup than what I need.
>
> > What steps are others doing for failover? What are my options beyond
> > the Pacemaker guide?
>
> The pacemaker guide is intended to be illustrative, as well as giving a
> concrete guide on one way to implement failover with RabbitMQ. ?There
> are alternative technologies, both open source and proprietary, that can
> be used instead of pacemaker, drbd, etc. ?We'd welcome reports from
> users that have implemented failover using other products.
>
> If you have configured rabbit to store its data on NFS, then you won't
> need the drbd component. ?And if you already have appropriate monitoring
> and alerting arrangements in place, then you might well be able to
> achieve a 30 minute failover time without using pacemaker or some other
> cluster resource manager. ?Even a manual failover process might be
> acceptable in such a context.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From thiago.rondon at gmail.com  Wed Sep 29 16:17:12 2010
From: thiago.rondon at gmail.com (Thiago Rondon)
Date: Wed, 29 Sep 2010 12:17:12 -0300
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
	<AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>
	<AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>
Message-ID: <AANLkTikg4m5+Rs1K-Ne_Fb+wBpSNi5giyD9o=WsEJABH@mail.gmail.com>

> Thiago,
> I ended up picking RabbitMQ because of its maturity and because Celery says
> it's the most commonly used and since I'm definitely using Celery, the rest
> is a cascading decision for me.
> In the interest of completeness however, people are also using ZeroMQ also
> which has alot of open source support and goes through OpenAMQ (at least
> that's how I understand it):
> http://www.zeromq.org/docs:welcome-from-amqp
> http://www.openamq.org/
> For me it's all about Python support and docs (since I'm
> developer-constrained).
> -Adam

Adam,

I'm starting to develop this library in Perl for make simple syntax to
librabbitmq (and to learn about) .

http://github.com/maluco/Net-RabbitMQ-Simple

Suggestions are welcome.

-Thiago Rondon

From taylste at gmail.com  Wed Sep 29 16:51:45 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 29 Sep 2010 16:51:45 +0100
Subject: [rabbitmq-discuss] erl.exe crash
Message-ID: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>

Hi all,

I'm new to RabbitMQ. I just decided to throw 1 million messages at a
RabbitMQ server using RabbitMQ.Client.Examples.PerfTest. The server is an
old 3.2 GHz 2 Core; 32 bit XP OS; 4 GB RAM. Nothing special. 100K messages
worked fine, 1 M messages crashed. The page file didn't fill up, so it
doesn't look like a resources issue.

I'm just finding my way around. Are there any monitoring type stats or
dashboards available so that I can watch what might be going on in the
queue?

Are there any rules of thumb for how powerful the RabbitMQ box should be?

This isn't an extreme messaging requirement, and I can throttle if needs be,
but I do need to get a feel for where things stand moving forward + how much
confidence I can have.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/ba263462/attachment.htm>

From simon at rabbitmq.com  Wed Sep 29 17:03:17 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Sep 2010 17:03:17 +0100
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>
References: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>
Message-ID: <4CA36345.3010304@rabbitmq.com>

On 29/09/10 16:51, Steven Taylor wrote:
> Hi all,
> I'm new to RabbitMQ. I just decided to throw 1 million messages at a
> RabbitMQ server using RabbitMQ.Client.Examples.PerfTest. The server is
> an old 3.2 GHz 2 Core; 32 bit XP OS; 4 GB RAM. Nothing special. 100K
> messages worked fine, 1 M messages crashed. The page file didn't fill
> up, so it doesn't look like a resources issue.

Hi Steven. Which version of RabbitMQ are you using? - that sounds like a 
way 1.x might crash. Is there anything in the logs?

> I'm just finding my way around. Are there any monitoring type stats or
> dashboards available so that I can watch what might be going on in the
> queue?

Have a look at the management plugin:

http://www.rabbitmq.com/management.html

and at rabbitmqctl:

http://www.rabbitmq.com/man/rabbitmqctl.1.man.html

> Are there any rules of thumb for how powerful the RabbitMQ box should be?
> This isn't an extreme messaging requirement, and I can throttle if needs
> be, but I do need to get a feel for where things stand moving forward +
> how much confidence I can have.

Rabbit shouldn't require anything too ridiculous in terms of power. 
Having said that, Windows is a bit limiting as Erlang only exists in 32 
bit form for that platform, so you can't go to more than ~2GB memory used.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Sep 29 17:11:11 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Sep 2010 17:11:11 +0100
Subject: [rabbitmq-discuss] Addition to plugins documentation
In-Reply-To: <AANLkTimNA3iQVEyQSmUfBtBjPdXNK5iLG_eFccmcVxwb@mail.gmail.com>
References: <AANLkTimNA3iQVEyQSmUfBtBjPdXNK5iLG_eFccmcVxwb@mail.gmail.com>
Message-ID: <4CA3651F.3020508@rabbitmq.com>

On 22/09/10 11:18, Spil Oss wrote:
> Hi All,
>
> Please add the windows prerequisite libeay to the plugins page or
> Windows install instructions.

Hi Spil. This is documented on the management plugin page itself. I'll 
add it to the plugins page also.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From murphy.chris.j at gmail.com  Wed Sep 29 20:37:46 2010
From: murphy.chris.j at gmail.com (Chris Murphy)
Date: Wed, 29 Sep 2010 14:37:46 -0500
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
Message-ID: <C8C8FFBA.32145%murphy.chris.j@gmail.com>

Hello,

I am having an issue where shovel seems to be crashing my source rabbitmq
instance intermittently. This is on 2.1.0 version of rabbitmq shoveling to a
2 node cluster using the same version. The publish rate is probably
somewhere around 1 message/sec. The size of the message doesn?t seem to
matter. 

Here are links to the shovel config and a log containing the crash:

Config: https://gist.github.com/feebbc2d6c63589ed5b0
Crash: https://gist.github.com/041f757a6e4ae1dd50b1

Thanks for your help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/cfdc8ba4/attachment.htm>

From matthew at rabbitmq.com  Wed Sep 29 21:22:42 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Sep 2010 21:22:42 +0100
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <C8C8FFBA.32145%murphy.chris.j@gmail.com>
References: <C8C8FFBA.32145%murphy.chris.j@gmail.com>
Message-ID: <20100929202241.GF29758@wellquite.org>

Hi Chris,

On Wed, Sep 29, 2010 at 02:37:46PM -0500, Chris Murphy wrote:
> I am having an issue where shovel seems to be crashing my source rabbitmq
> instance intermittently. This is on 2.1.0 version of rabbitmq shoveling to a
> 2 node cluster using the same version. The publish rate is probably
> somewhere around 1 message/sec. The size of the message doesn?t seem to
> matter. 

Now that is an excellent crash! It's actually tripping over in a
function we wrote to assert various invariants within the queue.
This could well be something we've been trying to track down for a long
time. Is it happening repeatably for you? If so, is there any chance we
can get access to your box and see it going on?

Matthew

From murphy.chris.j at gmail.com  Wed Sep 29 21:36:02 2010
From: murphy.chris.j at gmail.com (Chris Murphy)
Date: Wed, 29 Sep 2010 15:36:02 -0500
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <20100929202241.GF29758@wellquite.org>
Message-ID: <C8C90D62.32159%murphy.chris.j@gmail.com>

Matthew,

I don't think I'd be able to give you access to these servers but I may be
able to set it up on another server and see if I can get it to reproduce.

Right now I am able to reproduce fairly consistently albeit not every single
time. I've been trying to figure out what combination of events makes it
crash but so far no luck.

I'll see what I can do about getting this to a server you can access, in the
meantime I can try to answer any other questions that might be helpful.

Chris


On 9/29/10 3:22 PM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:

> Hi Chris,
> 
> On Wed, Sep 29, 2010 at 02:37:46PM -0500, Chris Murphy wrote:
>> I am having an issue where shovel seems to be crashing my source rabbitmq
>> instance intermittently. This is on 2.1.0 version of rabbitmq shoveling to a
>> 2 node cluster using the same version. The publish rate is probably
>> somewhere around 1 message/sec. The size of the message doesn?t seem to
>> matter. 
> 
> Now that is an excellent crash! It's actually tripping over in a
> function we wrote to assert various invariants within the queue.
> This could well be something we've been trying to track down for a long
> time. Is it happening repeatably for you? If so, is there any chance we
> can get access to your box and see it going on?
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthew at rabbitmq.com  Wed Sep 29 21:47:29 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Sep 2010 21:47:29 +0100
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <20100929202241.GF29758@wellquite.org>
References: <C8C8FFBA.32145%murphy.chris.j@gmail.com>
	<20100929202241.GF29758@wellquite.org>
Message-ID: <20100929204728.GG29758@wellquite.org>

Hi Chris,

> On Wed, Sep 29, 2010 at 02:37:46PM -0500, Chris Murphy wrote:
> > I am having an issue where shovel seems to be crashing my source rabbitmq
> > instance intermittently. This is on 2.1.0 version of rabbitmq shoveling to a
> > 2 node cluster using the same version. The publish rate is probably
> > somewhere around 1 message/sec. The size of the message doesn?t seem to
> > matter. 
> 
> Now that is an excellent crash!

Is anyone issuing queue.purge commands to that queue? I think I've
spotted the bug, and I can trip it, but it's a bug in queue.purge, so
I'm wondering if you've issued any of those.

Matthew

From murphy.chris.j at gmail.com  Wed Sep 29 21:49:25 2010
From: murphy.chris.j at gmail.com (Chris Murphy)
Date: Wed, 29 Sep 2010 15:49:25 -0500
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <20100929204728.GG29758@wellquite.org>
Message-ID: <C8C91085.3219F%murphy.chris.j@gmail.com>

Yes, we are issuing purge commands right before we begin inserting to the
queue!


On 9/29/10 3:47 PM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:

> Hi Chris,
> 
>> On Wed, Sep 29, 2010 at 02:37:46PM -0500, Chris Murphy wrote:
>>> I am having an issue where shovel seems to be crashing my source rabbitmq
>>> instance intermittently. This is on 2.1.0 version of rabbitmq shoveling to a
>>> 2 node cluster using the same version. The publish rate is probably
>>> somewhere around 1 message/sec. The size of the message doesn?t seem to
>>> matter. 
>> 
>> Now that is an excellent crash!
> 
> Is anyone issuing queue.purge commands to that queue? I think I've
> spotted the bug, and I can trip it, but it's a bug in queue.purge, so
> I'm wondering if you've issued any of those.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From nico at nicocesar.com  Wed Sep 29 21:52:12 2010
From: nico at nicocesar.com (=?UTF-8?B?Tmljb2zDoXMgQ8Opc2Fy?=)
Date: Wed, 29 Sep 2010 17:52:12 -0300
Subject: [rabbitmq-discuss] Rabbit won't start "Protocol: ~p: register
	error: ~p~n"
Message-ID: <AANLkTikkJpwnpGntcDtizAaYwdQsYDbsqD__RP17xOpc@mail.gmail.com>

It's very hard for me to understand errors. I've added -x to shell scripts
so

First O've checked if anything is running
# ps ax | grep beam | grep -v grep
# ps ax | grep epmd | grep -v grep
#

then:

----------------------------------
/usr/sbin/rabbitmq-multi start_all 1
+ for arg in '"$@"'
++ sed -e 's/"/\\"/g'
+ arg=start_all
+ CMDLINE=' "start_all"'
+ for arg in '"$@"'
++ sed -e 's/"/\\"/g'
+ arg=1
+ CMDLINE=' "start_all" "1"'
+ cd /var/lib/rabbitmq
++ basename /usr/sbin/rabbitmq-multi
+ SCRIPT=rabbitmq-multi
++ id -u
+ '[' 0 = 0 ']'
+ su rabbitmq -s /bin/sh -c '/usr/lib/rabbitmq/bin/rabbitmq-multi
"start_all" "1"'
+ '[' x = xsendsorium.com ']'
+ NODENAME=rabbit at sendsorium
++ dirname /usr/lib/rabbitmq/bin/rabbitmq-multi
+ SCRIPT_HOME=/usr/lib/rabbitmq/bin
+ PIDS_FILE=/var/lib/rabbitmq/pids
+ MULTI_ERL_ARGS=
+ MULTI_START_ARGS=
+ CONFIG_FILE=/etc/rabbitmq/rabbitmq
++ dirname /usr/lib/rabbitmq/bin/rabbitmq-multi
+ . /usr/lib/rabbitmq/bin/rabbitmq-env
++ SCRIPT_PATH=/usr/lib/rabbitmq/bin/rabbitmq-multi
++ '[' -h /usr/lib/rabbitmq/bin/rabbitmq-multi ']'
+++ readlink -f /usr/lib/rabbitmq/bin/rabbitmq-multi
++ FULL_PATH=/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/rabbitmq-multi
++ '[' 0 '!=' 0 ']'
++
SCRIPT_PATH=/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/rabbitmq-multi
++ '[' -h /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/rabbitmq-multi
']'
+++ dirname /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/rabbitmq-multi
++ SCRIPT_DIR=/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin
++ RABBITMQ_HOME=/usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/..
++ '[' -f /etc/rabbitmq/rabbitmq.conf ']'
+ DEFAULT_NODE_IP_ADDRESS=0.0.0.0
+ DEFAULT_NODE_PORT=5672
+ '[' x = x ']'
+ '[' x '!=' x ']'
+ '[' x = x ']'
+ '[' x '!=' x ']'
+ '[' x = x ']'
+ '[' x '!=' x ']'
+ '[' x = x ']'
+ RABBITMQ_NODENAME=rabbit at sendsorium
+ '[' x = x ']'
+ RABBITMQ_SCRIPT_HOME=/usr/lib/rabbitmq/bin
+ '[' x = x ']'
+ RABBITMQ_PIDS_FILE=/var/lib/rabbitmq/pids
+ '[' x = x ']'
+ RABBITMQ_MULTI_ERL_ARGS=
+ '[' x = x ']'
+ RABBITMQ_MULTI_START_ARGS=
+ '[' x = x ']'
+ RABBITMQ_CONFIG_FILE=/etc/rabbitmq/rabbitmq
+ export RABBITMQ_NODENAME RABBITMQ_NODE_IP_ADDRESS RABBITMQ_NODE_PORT
RABBITMQ_SCRIPT_HOME RABBITMQ_PIDS_FILE RABBITMQ_CONFIG_FILE
+ RABBITMQ_CONFIG_ARG=
+ '[' -f /etc/rabbitmq/rabbitmq.config ']'
+ RABBITMQ_CONFIG_ARG='-config /etc/rabbitmq/rabbitmq'
+ set -f
+ exec erl -pa /usr/lib/rabbitmq/lib/rabbitmq_server-1.8.1/sbin/../ebin
-noinput -hidden -sname rabbitmq_multi16112 -config /etc/rabbitmq/rabbitmq
-s rabbit_multi -extra start_all 1
{error_logger,{{2010,9,29},{20,36,33}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,9,29},{20,36,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.100>,<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,513}],[]]}
{error_logger,{{2010,9,29},{20,36,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmq_multi16112,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,9,29},{20,36,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,9,29},{20,36,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
--------------------------


I'm using rabbit 1.8.1
Erlang R14A (erts-5.8) [source] [smp:2:2] [rq:2] [async-threads:0]
[kernel-poll:false]
Linux sendsorium.com 2.6.18-028stab069.6 #1 SMP Wed May 26 18:10:06 MSD 2010
i686 GNU/Linux



cat /etc/rabbitmq/rabbitmq.config
[{rabbit, [{vm_memory_high_watermark, 0.4}]}].


PS: erl_crash.dump  compressed is about 50K ..if anyone wants to see it.

Nico Cesar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/97f367d4/attachment.htm>

From matthias at rabbitmq.com  Wed Sep 29 22:15:09 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Sep 2010 22:15:09 +0100
Subject: [rabbitmq-discuss] Rabbit won't start "Protocol: ~p: register
 error: ~p~n"
In-Reply-To: <AANLkTikkJpwnpGntcDtizAaYwdQsYDbsqD__RP17xOpc@mail.gmail.com>
References: <AANLkTikkJpwnpGntcDtizAaYwdQsYDbsqD__RP17xOpc@mail.gmail.com>
Message-ID: <4CA3AC5D.2000600@rabbitmq.com>

Nicolas,

Nicol?s C?sar wrote:
> + '[' x = xsendsorium.com <http://xsendsorium.com> ']'
> + NODENAME=rabbit at sendsorium

and

> Linux sendsorium.com <http://sendsorium.com> 2.6.18-028stab069.6 #1 SMP 

So what is the hostname of your machine?

Does 'ping sendsorium' work?

You may want to try setting the rabbit nodename to rabbit at localhost.


Matthias.

From matthew at rabbitmq.com  Wed Sep 29 22:17:02 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Sep 2010 22:17:02 +0100
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <C8C91085.3219F%murphy.chris.j@gmail.com>
References: <20100929204728.GG29758@wellquite.org>
	<C8C91085.3219F%murphy.chris.j@gmail.com>
Message-ID: <20100929211701.GH29758@wellquite.org>

On Wed, Sep 29, 2010 at 03:49:25PM -0500, Chris Murphy wrote:
> Yes, we are issuing purge commands right before we begin inserting to the
> queue!

Cool, well it's 10:15pm here and I'm not going to fix this right now,
I'm afraid. There'll most likely be a fix for this tomorrow and it will
be included in the next release. Many thanks for reporting this - we've
been searching for the cause of _a_ bug in this area for a while. I'm
not totally sure that the bug you've reported is exactly the same as the
other bug we're seeing but they could very well be related.

Best wishes,

Matthew

From nico at nicocesar.com  Wed Sep 29 22:24:05 2010
From: nico at nicocesar.com (=?UTF-8?B?Tmljb2zDoXMgQ8Opc2Fy?=)
Date: Wed, 29 Sep 2010 18:24:05 -0300
Subject: [rabbitmq-discuss] Rabbit won't start "Protocol: ~p: register
 error: ~p~n"
In-Reply-To: <4CA3AC5D.2000600@rabbitmq.com>
References: <AANLkTikkJpwnpGntcDtizAaYwdQsYDbsqD__RP17xOpc@mail.gmail.com>
	<4CA3AC5D.2000600@rabbitmq.com>
Message-ID: <AANLkTinhsuXBAHLt2iS8sCt0ORPENBN+Sw9OMdzu5ZB2@mail.gmail.com>

Thanks Matt there is a major problem with the network...

sendsorium:~# host sendsorium
sendsorium.com          A       72.249.105.206
sendsorium:~# ifconfig | grep -B1 72.249.105.206
venet0:0  Link encap:UNSPEC  HWaddr
00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          inet addr:72.249.105.206  P-t-P:72.249.105.206  Bcast:0.0.0.0
Mask:255.255.255.255
sendsorium:~# ping 72.249.105.206
PING 72.249.105.206 (72.249.105.206) 56(84) bytes of data.
(no ping??... WTF...?)

It's not a rabbit issue thanks for the tip

Nico C?sar
http://blog.nicocesar.com


El 29 de septiembre de 2010 18:15, Matthias Radestock <matthias at rabbitmq.com
> escribi?:

> Nicolas,
>
> Nicol?s C?sar wrote:
>
>> + '[' x = xsendsorium.com <http://xsendsorium.com> ']'
>> + NODENAME=rabbit at sendsorium
>>
>
> and
>
>  Linux sendsorium.com <http://sendsorium.com> 2.6.18-028stab069.6 #1 SMP
>>
>
> So what is the hostname of your machine?
>
> Does 'ping sendsorium' work?
>
> You may want to try setting the rabbit nodename to rabbit at localhost.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/0facd7d5/attachment-0001.htm>

From nico at nicocesar.com  Wed Sep 29 23:56:53 2010
From: nico at nicocesar.com (=?UTF-8?B?Tmljb2zDoXMgQ8Opc2Fy?=)
Date: Wed, 29 Sep 2010 19:56:53 -0300
Subject: [rabbitmq-discuss] queue_declare returning a (50, 10) NOT_FOUND....
Message-ID: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>

Hi i'm getting a

(404, u"NOT_FOUND - no queue 'xxx in vhost '/'", (50, 10),
'Channel.queue_declare')

doing a queque_declare, reading from my own thread time ago:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d925b0bbaed7f86?pli=1


Simon MacMullen replied:

ISTR the only way you can get a not-found when declaring a queue is in a
clustering situation, if the queue exists on a node which is not
running. Does that sound like it could be a possibility?

Cheers, Simon
but I have no cluster situation:

#/usr/sbin/rabbitmqctl status
Status of node rabbit at sendsorium ...
[{running_applications,[{rabbit,"RabbitMQ","1.8.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.14"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {stdlib,"ERTS  CXC 138 10","1.17"},
                        {kernel,"ERTS  CXC 138 10","2.14"}]},
 {nodes,[{disc,[rabbit at sendsorium]}]},
 {running_nodes,[rabbit at sendsorium]}]
...done.

Thanks in advance!


BTW. my last issue with rabbit not starting were bizarre virtualization
problems like not ping'ing 127.0.0.1 my apologies for the noise to the list.


Nico C?sar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100929/00ad3978/attachment.htm>

From matthias at rabbitmq.com  Thu Sep 30 07:43:26 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Sep 2010 07:43:26 +0100
Subject: [rabbitmq-discuss] queue_declare returning a (50,
	10) NOT_FOUND....
In-Reply-To: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
References: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
Message-ID: <4CA4318E.4020909@rabbitmq.com>

Nicolas,

Nicol?s C?sar wrote:
> Hi i'm getting a
> 
> (404, u"NOT_FOUND - no queue 'xxx in vhost '/'", (50, 10), 
> 'Channel.queue_declare')

How are you issuing the queue.declare? Do you perhaps have the 'passive' 
flag set?


Matthias.

From simon at rabbitmq.com  Thu Sep 30 11:47:22 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 Sep 2010 11:47:22 +0100
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <AANLkTikGb6BGFjT8Bm_q=URVdpL2oz3pmVGg-SiKHQ-d@mail.gmail.com>
References: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>	<4CA36345.3010304@rabbitmq.com>
	<AANLkTikGb6BGFjT8Bm_q=URVdpL2oz3pmVGg-SiKHQ-d@mail.gmail.com>
Message-ID: <4CA46ABA.4080700@rabbitmq.com>

On 30/09/10 01:20, Steven Taylor wrote:
>
>     Hi Steven. Which version of RabbitMQ are you using? - that sounds
>     like a way 1.x might crash. Is there anything in the logs?
>
> The most recent one. Actually, the CPU was maxing out. It handled 500K
> of messages okay, but somewhere between 500K and 1M it broke.

Hmm. I really wouldn't expect that to happen with 2.x. I'll pop open a 
Windows VM and see if I can replicate it.

>     Rabbit shouldn't require anything too ridiculous in terms of power.
>     Having said that, Windows is a bit limiting as Erlang only exists in
>     32 bit form for that platform, so you can't go to more than ~2GB
>     memory used.
>
> Okay. So probably wise to run Rabbit on Linux. Are there any upper
> limits on message size? Is 100MB too big for a message?

If you have the option I'd recommend it. 100MB is probably getting 
within sight of the sensible maximum - while there's no formal upper 
bound, we don't stream messages internally so multi-GB ones might be 
problematic.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Thu Sep 30 12:00:26 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 30 Sep 2010 12:00:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ refuses to start , instead crash
In-Reply-To: <AANLkTikqqkRkdWey-mXwNwiFeUzPY1LZDouofSa6F+i3@mail.gmail.com>
References: <AANLkTikqqkRkdWey-mXwNwiFeUzPY1LZDouofSa6F+i3@mail.gmail.com>
Message-ID: <AANLkTimn2FNh9OqCH9OJm_zqM51RUrPzuTTMrhTfk4ok@mail.gmail.com>

Chandra,

Right in the top of your erl_crash.dump there is an reason of the death:
Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type "heap").

In future, please send us not only erl_crash.dump but also rabbit.log
and rabbit-sasl.log.

The error means that for some reason RabbitMQ was not able to allocate
 556 megs of RAM.
Do you know why it needs so much memory? Do you have a lot of data in
mnesia directory,
a large number of queues or something like that?

Further, we encourage to run Rabbit on 64 bit operating systems. Even
if you'll give
3.5 GB memory for windows VM, rabbit won't be able to use it on 32 bit system!

Cheers,
  Marek


On Thu, Sep 23, 2010 at 20:36, Chandra R <mybayworkz at gmail.com> wrote:
> Hello,
> ?I am new to rabbitmq and ?I have been trying to run it on Windows XP with
> 2.5 gb on a VM (Also tried on XP with 3.5 gb on a VM) but it crashes.
> Later I found that I was using extension .conf instead of .config, which I
> corrected.
> Still it does the same thing, crashing. No logs are being created.
> I am using erlang 5.7.4 and tried rabbitmq 2.1.0 & 1.8.1.
> I have attached crash dump zip
> Please help me get started
> Thank you
> regards,
> Chandra
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthew at rabbitmq.com  Thu Sep 30 12:08:41 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 30 Sep 2010 12:08:41 +0100
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <4CA46ABA.4080700@rabbitmq.com>
References: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>
	<4CA36345.3010304@rabbitmq.com>
	<AANLkTikGb6BGFjT8Bm_q=URVdpL2oz3pmVGg-SiKHQ-d@mail.gmail.com>
	<4CA46ABA.4080700@rabbitmq.com>
Message-ID: <20100930110841.GM11194@rabbitmq.com>

On Thu, Sep 30, 2010 at 11:47:22AM +0100, Simon MacMullen wrote:
> If you have the option I'd recommend it. 100MB is probably getting
> within sight of the sensible maximum - while there's no formal upper
> bound, we don't stream messages internally so multi-GB ones might be
> problematic.

Due to unavoidable copying of messages within the OS and memory
generally, I wouldn't recommend trying to pass any msgs around which are
bigger than one quarter of your available memory.

Matthew

From simon at rabbitmq.com  Thu Sep 30 12:27:11 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 Sep 2010 12:27:11 +0100
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <4CA46ABA.4080700@rabbitmq.com>
References: <AANLkTi=WREMnm24VNR+w_=591Ruz7N7enJLiofCdpu8t@mail.gmail.com>	<4CA36345.3010304@rabbitmq.com>	<AANLkTikGb6BGFjT8Bm_q=URVdpL2oz3pmVGg-SiKHQ-d@mail.gmail.com>
	<4CA46ABA.4080700@rabbitmq.com>
Message-ID: <4CA4740F.8000502@rabbitmq.com>

On 30/09/10 11:47, Simon MacMullen wrote:
> On 30/09/10 01:20, Steven Taylor wrote:
>>
>> Hi Steven. Which version of RabbitMQ are you using? - that sounds
>> like a way 1.x might crash. Is there anything in the logs?
>>
>> The most recent one. Actually, the CPU was maxing out. It handled 500K
>> of messages okay, but somewhere between 500K and 1M it broke.
>
> Hmm. I really wouldn't expect that to happen with 2.x. I'll pop open a
> Windows VM and see if I can replicate it.

Hmm, I just used perftest.exe to put 1M messages through a 2.1.0 broker 
in a 32bit Windows 7 VM with 1GB of memory. Took a while but it worked :)

So - are you using on older version of Erlang? That shouldn't influence 
things but it's worth checking. Can you replicate this?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From vbarat at ubikod.com  Thu Sep 30 14:30:37 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Thu, 30 Sep 2010 15:30:37 +0200
Subject: [rabbitmq-discuss] How to use more than 4GB of RAM ?
Message-ID: <4CA490FD.6090009@ubikod.com>

  Hello,

I run RabbitMQ 1.7.2 on a 8GB RAM 64bits machine.

When the RabbitMQ process reach a 4GB limit of heap size, it crashes.
Do you know if it is a limitation of the RabbitMQ server or Erlang 
VM itself ?
Is there a workarround ?

My Erlang is:
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:0] [kernel-poll:false]

Thank a lot

From majek04 at gmail.com  Thu Sep 30 14:35:25 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 30 Sep 2010 14:35:25 +0100
Subject: [rabbitmq-discuss] How to use more than 4GB of RAM ?
In-Reply-To: <4CA490FD.6090009@ubikod.com>
References: <4CA490FD.6090009@ubikod.com>
Message-ID: <AANLkTin_9v-fe8W4KOge01Hi+0EihcZE=cPjZqt=VUe_@mail.gmail.com>

On Thu, Sep 30, 2010 at 14:30, Vincent Barat <vbarat at ubikod.com> wrote:
> I run RabbitMQ 1.7.2 on a 8GB RAM 64bits machine.
>
> When the RabbitMQ process reach a 4GB limit of heap size, it crashes.
> Do you know if it is a limitation of the RabbitMQ server or Erlang VM itself
> ?
> Is there a workarround ?

On releases pre 2.0.0 there is a limit of 4GB persistent messages in one queue.
If you're using many persistent(durable) messages in a single queue please:
 - upgrade to at least 2.0.0
 - split your one huge queue into many smaller and make sure that you
   never reach 4GB/queue limit.

Cheers,
  Marek

From shane at digitalsanctum.com  Thu Sep 30 17:37:32 2010
From: shane at digitalsanctum.com (Shane)
Date: Thu, 30 Sep 2010 09:37:32 -0700 (PDT)
Subject: [rabbitmq-discuss] use of an NFS for broker failover
Message-ID: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>

Given two brokers (Broker A and Broker B) use the same file system
space via NFS and the following events occur:

1. Broker A goes down with producers/consumers connected to it.
2. Broker B starts up
3. Producers/consumers reconnect to Broker B.

All exchanges/queues are created upon startup of the producers/
consumers.

What else should I be considering to achieve failover?

From matthias at rabbitmq.com  Thu Sep 30 18:18:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Sep 2010 18:18:07 +0100
Subject: [rabbitmq-discuss] channel.flow in pyampqlib
In-Reply-To: <AANLkTi=b3quZATSbXrFvDXNgSPurPanHcHVJReYE8Uqo@mail.gmail.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>	<4BF2E9F0.6050809@rabbitmq.com>	<alpine.OSX.2.00.1005181535070.92989@imac.local>	<4BF2F082.1070602@rabbitmq.com>	<alpine.OSX.2.00.1005191008320.96027@imac.local>	<20100519145513.GA1896@mrnibble.lshift.net>	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>	<20100519151508.GC1896@mrnibble.lshift.net>	<29827331.post@talk.nabble.com>
	<4CA2238A.4010301@rabbitmq.com>
	<AANLkTi=b3quZATSbXrFvDXNgSPurPanHcHVJReYE8Uqo@mail.gmail.com>
Message-ID: <4CA4C64F.1040603@rabbitmq.com>

Anton,

On 29/09/10 10:09, mabrek wrote:
> Java client uses blocking IO. It would hang on writing to server that
> throttles producers.
>
> Do you have any plans to switch java client to non-blocking IO (NIO)
> and introduce timeouts in content sending methods?

you could try setting a timeout on the socket with setSoTimeout. One 
place to do that is by overriding 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.1.0/rabbitmq-java-client-javadoc-2.1.0/com/rabbitmq/client/ConnectionFactory.html#configureSocket(java.net.Socket)

I haven't tried this myself, and it may not work, or indeed break other 
parts of the client API. But it's worth a shot.


Matthias.

From matthias at rabbitmq.com  Thu Sep 30 18:27:10 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Sep 2010 18:27:10 +0100
Subject: [rabbitmq-discuss] How to return value from response Queue !!!!!
In-Reply-To: <29815725.post@talk.nabble.com>
References: <29815725.post@talk.nabble.com>
Message-ID: <4CA4C86E.7040809@rabbitmq.com>

Sameek,

On 27/09/10 06:54, sam_mis wrote:
> Hi, i am using Rabbitmq Java client API.i am sending two number from GUI to
> producer and producer put into queue another side consumer can listen the
> queue and read it and perform the addition of two number and put result on
> queue then again my producer will listen the my response queue and retrieve
> the result. [...]  what i do?

Take a look at the com.rabbitmq.client.Rpc{Server,Client} classes. You 
can probably just use these or, if not, learn from how they are implemented.


Regards,

Matthias.

From mybayworkz at gmail.com  Thu Sep 30 19:14:53 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Thu, 30 Sep 2010 13:14:53 -0500
Subject: [rabbitmq-discuss] RabbitMQ refuses to start , instead crash
In-Reply-To: <AANLkTimn2FNh9OqCH9OJm_zqM51RUrPzuTTMrhTfk4ok@mail.gmail.com>
References: <AANLkTikqqkRkdWey-mXwNwiFeUzPY1LZDouofSa6F+i3@mail.gmail.com>
	<AANLkTimn2FNh9OqCH9OJm_zqM51RUrPzuTTMrhTfk4ok@mail.gmail.com>
Message-ID: <AANLkTin5efk5ikrD2vNZHVN-avR1=0DQS7A+pd1P=fgH@mail.gmail.com>

Thank you Marek,

I have moved to Ubuntu 64 bit for good. Its was just the mindset that made
me think it would be easier to try on win xp , which is a mistake.

Emile , I tried really hard to somehow make the logs activate and in this
process I really learned a lot about RabbitMQ but never could get the logs
to work. I am moving to Ubuntu now and hope it will be easy on the new
platform.


Thanks again
Chandra




On Thu, Sep 30, 2010 at 6:00 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Chandra,
>
> Right in the top of your erl_crash.dump there is an reason of the death:
> Slogan: eheap_alloc: Cannot allocate 583848200 bytes of memory (of type
> "heap").
>
> In future, please send us not only erl_crash.dump but also rabbit.log
> and rabbit-sasl.log.
>
> The error means that for some reason RabbitMQ was not able to allocate
>  556 megs of RAM.
> Do you know why it needs so much memory? Do you have a lot of data in
> mnesia directory,
> a large number of queues or something like that?
>
> Further, we encourage to run Rabbit on 64 bit operating systems. Even
> if you'll give
> 3.5 GB memory for windows VM, rabbit won't be able to use it on 32 bit
> system!
>
> Cheers,
>  Marek
>
>
> On Thu, Sep 23, 2010 at 20:36, Chandra R <mybayworkz at gmail.com> wrote:
> > Hello,
> >  I am new to rabbitmq and  I have been trying to run it on Windows XP
> with
> > 2.5 gb on a VM (Also tried on XP with 3.5 gb on a VM) but it crashes.
> > Later I found that I was using extension .conf instead of .config, which
> I
> > corrected.
> > Still it does the same thing, crashing. No logs are being created.
> > I am using erlang 5.7.4 and tried rabbitmq 2.1.0 & 1.8.1.
> > I have attached crash dump zip
> > Please help me get started
> > Thank you
> > regards,
> > Chandra
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100930/b84d5804/attachment-0001.htm>

From mabrek at gmail.com  Thu Sep 30 19:34:12 2010
From: mabrek at gmail.com (mabrek)
Date: Thu, 30 Sep 2010 22:34:12 +0400
Subject: [rabbitmq-discuss] channel.flow in pyampqlib
In-Reply-To: <4CA4C64F.1040603@rabbitmq.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>	<4BF2E9F0.6050809@rabbitmq.com>	<alpine.OSX.2.00.1005181535070.92989@imac.local>	<4BF2F082.1070602@rabbitmq.com>	<alpine.OSX.2.00.1005191008320.96027@imac.local>	<20100519145513.GA1896@mrnibble.lshift.net>	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>	<20100519151508.GC1896@mrnibble.lshift.net>	<29827331.post@talk.nabble.com>	<4CA2238A.4010301@rabbitmq.com>	<AANLkTi=b3quZATSbXrFvDXNgSPurPanHcHVJReYE8Uqo@mail.gmail.com>
	<4CA4C64F.1040603@rabbitmq.com>
Message-ID: <4CA4D824.1090303@gmail.com>

On 09/30/2010 09:18 PM, Matthias Radestock wrote:
> On 29/09/10 10:09, mabrek wrote:
>> Java client uses blocking IO. It would hang on writing to server
>> that throttles producers.
>>
>> Do you have any plans to switch java client to non-blocking IO
>> (NIO) and introduce timeouts in content sending methods?
>
> you could try setting a timeout on the socket with setSoTimeout. One
> place to do that is by overriding
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.1.0/rabbitmq-java-client-javadoc-2.1.0/com/rabbitmq/client/ConnectionFactory.html#configureSocket(java.net.Socket)

It doesn't work. setSoTimeout affects only read timeout. There is no write timeout in java blocking sockets. Attempt to write to stuck socket may result in hanging up to 30min (last tcp retransmit attempt on linux).

Regards,
Anton Lebedevich.

From matthias at rabbitmq.com  Thu Sep 30 20:05:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Sep 2010 20:05:15 +0100
Subject: [rabbitmq-discuss] channel.flow in pyampqlib
In-Reply-To: <4CA4D824.1090303@gmail.com>
References: <alpine.OSX.2.00.1005181457340.92989@imac.local>	<4BF2E9F0.6050809@rabbitmq.com>	<alpine.OSX.2.00.1005181535070.92989@imac.local>	<4BF2F082.1070602@rabbitmq.com>	<alpine.OSX.2.00.1005191008320.96027@imac.local>	<20100519145513.GA1896@mrnibble.lshift.net>	<AANLkTikd7YPxlXS9Rplm_E0H4CN1ENGBjpugwMTGXxvx@mail.gmail.com>	<20100519151508.GC1896@mrnibble.lshift.net>	<29827331.post@talk.nabble.com>	<4CA2238A.4010301@rabbitmq.com>	<AANLkTi=b3quZATSbXrFvDXNgSPurPanHcHVJReYE8Uqo@mail.gmail.com>	<4CA4C64F.1040603@rabbitmq.com>
	<4CA4D824.1090303@gmail.com>
Message-ID: <4CA4DF6B.7010306@rabbitmq.com>

Anton,

On 30/09/10 19:34, mabrek wrote:
> setSoTimeout affects only read timeout.

Thought so. I have filed a bug to look into this, but I doubt we'll find 
the time to work on this in the near future.


Matthias.

From russell at borogove.org  Thu Sep 30 21:23:24 2010
From: russell at borogove.org (Russell Borogove)
Date: Thu, 30 Sep 2010 13:23:24 -0700
Subject: [rabbitmq-discuss] Plugins not starting?
Message-ID: <B78735AC-425D-4B84-8902-A3FA25DF6A89@borogove.org>

1.6.0 on Ubuntu. 

I'm trying to run the managment plugin. 

I found /usr/lib/erlang/lib/rabbitmq_server-1.6.0, created a plugins directory, and downloaded the .ez files into it. 

After restarting rabbit, I'm not seeing a listen port on 55672, and rabbitmqctl status doesn't show the plugins:
Status of node 'rabbit at ip-10-162-102-179' ...
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.10"},
                        {os_mon,"CPO  CXC 138 46","2.2.2"},
                        {sasl,"SASL  CXC 138 11","2.1.6"},
                        {stdlib,"ERTS  CXC 138 10","1.16.2"},
                        {kernel,"ERTS  CXC 138 10","2.13.2"}]},
 {nodes,['rabbit at ip-10-162-102-179']},
 {running_nodes,['rabbit at ip-10-162-102-179']}]

I also added this line to /etc/rabbitmq/rabbitmq.conf:
PLUGINS_DIR=/usr/lib/erlang/lib/rabbitmq_server-1.6.0/plugins

I see no mention of plugins and nothing else interesting in the startup_log. 

Fishing-lesson questions:
* How do I know if rabbitmq.conf is being read?
* How can I tell what environment variables are set on a running instance of rabbit?


From jon.brisbin at npcinternational.com  Thu Sep 30 21:41:51 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 30 Sep 2010 15:41:51 -0500
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
Message-ID: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>

I've got a pest of a sticky wicket in my map/reduce implementation that's using Groovy for the logic and RabbitMQ for the plumbing. It's frustrating because I'm so close.

The problem I'm having is knowing when I'm finished. Using data like this:

1
2
3
4
5
6
7
8
9
10
END

The "END" goes through a separate consumer thread because it goes out on a fanout exchange (it has to go to all workers), so it comes in out-of-order from the other data:

1    2    3
          END
4    5    6
END  END  
7    8    9
...etc...

I can sort of work around this by keeping track of id changes in my consumers using the classic "if this.id != last.id" approach. But the last record is a tricky one because there's no key change event to trigger sending the response back. Unless I simply wait until a timeout has occurred, I'm not sure how I can tell when I've collected all the responses I'm going to get.

The problem is that I only know how many message I've sent and not how many to expect in return. emit() can be called multiple times from a map phase and the reduce phase can take (records per key) * (emitted) and either rereduce the result or reply back to the requestor. The requestor shouldn't know whether the result has been rereduced or not. It should simply process the return values.

What am I missing to handle situations like this? Should I introduce another component to this that keeps track of how many messages are sent and received? Maybe put a ZooKeeper install in somewhere and coordinate all this? I've already got Riak integrated, though I'd think ZooKeeper would be better at managing concurrent updates.

Any help or suggestions here would be greatly appreciated! :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100930/4e41638a/attachment.htm>

From jon.brisbin at npcinternational.com  Thu Sep 30 21:50:00 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 30 Sep 2010 15:50:00 -0500
Subject: [rabbitmq-discuss] Plugins not starting?
In-Reply-To: <B78735AC-425D-4B84-8902-A3FA25DF6A89@borogove.org>
References: <B78735AC-425D-4B84-8902-A3FA25DF6A89@borogove.org>
Message-ID: <89A96850-B182-4BD6-88E6-0FC58742CA20@npcinternational.com>

The management plugin only works in version 2 and later of the broker.

"(Update 2010-09-22: Note that the plugins referenced in this blog post are for version 2.0.0 of RabbitMQ. We?ve now released 2.1.0 - for this and subsequent versions you can get the management plugin from here)."

http://www.rabbitmq.com/blog/2010/09/07/management-plugin-preview-release/

The plugins on the download page all have "v2.1.0" in their path names. I'm assuming that means if you've downloaded from the website, you'll have to run the 2.1.0 broker to use them.

Using it on Ubuntu is super simple. Use the apt repo the Rabbit folks keep up-to-date:

http://www.rabbitmq.com/debian.html

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Sep 30, 2010, at 3:23 PM, Russell Borogove wrote:

> 1.6.0 on Ubuntu. 
> 
> I'm trying to run the managment plugin. 
> 
> I found /usr/lib/erlang/lib/rabbitmq_server-1.6.0, created a plugins directory, and downloaded the .ez files into it. 
> 
> After restarting rabbit, I'm not seeing a listen port on 55672, and rabbitmqctl status doesn't show the plugins:
> Status of node 'rabbit at ip-10-162-102-179' ...
> [{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.10"},
>                        {os_mon,"CPO  CXC 138 46","2.2.2"},
>                        {sasl,"SASL  CXC 138 11","2.1.6"},
>                        {stdlib,"ERTS  CXC 138 10","1.16.2"},
>                        {kernel,"ERTS  CXC 138 10","2.13.2"}]},
> {nodes,['rabbit at ip-10-162-102-179']},
> {running_nodes,['rabbit at ip-10-162-102-179']}]
> 
> I also added this line to /etc/rabbitmq/rabbitmq.conf:
> PLUGINS_DIR=/usr/lib/erlang/lib/rabbitmq_server-1.6.0/plugins
> 
> I see no mention of plugins and nothing else interesting in the startup_log. 
> 
> Fishing-lesson questions:
> * How do I know if rabbitmq.conf is being read?
> * How can I tell what environment variables are set on a running instance of rabbit?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Sep 30 21:53:29 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 Sep 2010 21:53:29 +0100
Subject: [rabbitmq-discuss] Plugins not starting?
In-Reply-To: <89A96850-B182-4BD6-88E6-0FC58742CA20@npcinternational.com>
References: <B78735AC-425D-4B84-8902-A3FA25DF6A89@borogove.org>
	<89A96850-B182-4BD6-88E6-0FC58742CA20@npcinternational.com>
Message-ID: <4CA4F8C9.4060608@rabbitmq.com>

On 30/09/10 21:50, Jon Brisbin wrote:
>  The plugins on the download page all have "v2.1.0" in their path
> names. I'm assuming that means if you've downloaded from the website,
> you'll have to run the 2.1.0 broker to use them.

Yeah, pretty much. In general plugins may use internal APIs of RabbitMQ, 
and those change all the time, so they're usually tied to a given server 
version.

I don't think 1.6.0 even had a plugin mechanism...

Cheers, Simon

From tsuraan at gmail.com  Thu Sep 30 22:52:46 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 30 Sep 2010 16:52:46 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
Message-ID: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>

I'm migrating machines from using the old bug21673 snapshot that I've
been using to the new rabbit 2.1.0 release.  Fortunately, all of our
queue information is recoverable from our databases, so I am able to
wipe the old mq directory and start a new rabbit instance.  I'm having
a problem repopulating the queues though; what's happening is that as
I send the messages that belong in their respective queues, I'm
getting hanging in the py-amqplib socket.flush method (if the hang
happens while sending) or in the socket.recv method (if the hang
happens during a tx_commit).  I don't believe I've successfully sent
any messages at all on the machines that are doing this.

The way I'm repopulating the queues is by binding each queue to the
amq.direct exchange with the queue name as the routing key, and then
sending messages to that exchange with the desired queue's name as the
key.  The messages are being created as persistent messages, and the
sends are done in a transactional channel with a commit every hundred
messages.  While this is happening, the consumers are consuming from
the queues.  If I stop the consumers, then the hangs also stop.  I
also don't ever seem to get hangs when doing normal message sending
through the exchanges that I normally use; at least I haven't seen any
evidence or heard any bug reports that would indicate that's
happening.  There is nothing in my sasl log, and the only unusual
thing in my other log is that I'm sometimes hitting the high water
mark, but I haven't seen that happen while I've been attempting to
send messages.

Can anybody give me some advice on how to debug what's going on?  Am I
abusing the amq.direct exchange?  Any ideas would be appreciated; this
isn't happening on many machines, but it concerns me a bit.

From matthew at rabbitmq.com  Thu Sep 30 23:01:34 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 30 Sep 2010 23:01:34 +0100
Subject: [rabbitmq-discuss] Shovel crashing source rabbitmq
In-Reply-To: <20100929211701.GH29758@wellquite.org>
References: <20100929204728.GG29758@wellquite.org>
	<C8C91085.3219F%murphy.chris.j@gmail.com>
	<20100929211701.GH29758@wellquite.org>
Message-ID: <20100930220133.GB26599@wellquite.org>

On Wed, Sep 29, 2010 at 10:17:02PM +0100, Matthew Sackman wrote:
> There'll most likely be a fix for this tomorrow

There is indeed. It's been through QA and is on default, thus you'll
need to compile from the head of our default branch to get it. It will
be in the next release.

Matthew

From russell at borogove.org  Thu Sep 30 23:20:20 2010
From: russell at borogove.org (Russell Borogove)
Date: Thu, 30 Sep 2010 15:20:20 -0700
Subject: [rabbitmq-discuss] Plugins not starting?
In-Reply-To: <89A96850-B182-4BD6-88E6-0FC58742CA20@npcinternational.com>
References: <B78735AC-425D-4B84-8902-A3FA25DF6A89@borogove.org>
	<89A96850-B182-4BD6-88E6-0FC58742CA20@npcinternational.com>
Message-ID: <3D15D221-8579-4492-868C-F5DADC405307@borogove.org>


On Sep 30, 2010, at 1:50 PM, Jon Brisbin wrote:

> The management plugin only works in version 2 and later of the broker.

Aha! I feel silly now.

> Using it on Ubuntu is super simple. Use the apt repo the Rabbit folks keep up-to-date:
> 
> http://www.rabbitmq.com/debian.html

This was the big missing piece for me. Thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100930/96625d61/attachment.htm>

