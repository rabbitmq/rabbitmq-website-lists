<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang-client%20problem%20on%20OS%20X%0A%09%28empty_rpc_bottom_half%29&In-Reply-To=F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C%40mindspring.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002237.html">
   <LINK REL="Next"  HREF="002243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang-client%20problem%20on%20OS%20X%0A%09%28empty_rpc_bottom_half%29&In-Reply-To=F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C%40mindspring.com"
       TITLE="[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)">0x6e6562 at gmail.com
       </A><BR>
    <I>Tue Dec  9 09:16:19 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002237.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
        <LI>Next message: <A HREF="002243.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2238">[ date ]</a>
              <a href="thread.html#2238">[ thread ]</a>
              <a href="subject.html#2238">[ subject ]</a>
              <a href="author.html#2238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matt,

On Tue, Dec 9, 2008 at 6:37 AM, Matt Stancliff &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sysop at mindspring.com</A>&gt; wrote:
&gt;<i> Rabbits,
</I>&gt;<i>
</I>&gt;<i> I've spent the past two days attempting to track down why the erlang-
</I>&gt;<i> client doesn't work for me on OS X.
</I>&gt;<i> Everything works fine on my Linux box.
</I>&gt;<i> The Linux and OS X (10.5.5) installs of everything are performed by
</I>&gt;<i> the same automated scripts.
</I>&gt;<i>
</I>&gt;<i> I'm running erlang (R12B-5), rabbitmq-server (tip: cedf2c7e873d) and
</I>&gt;<i> the erlang-client (tip: a9695aaf5083).
</I>
Interesting. I've just tried these revisions (runnning R12B-5 on OS X
10.5.5) and I am unable to reproduce that error.

&gt;<i> =ERROR REPORT==== 8-Dec-2008::22:14:21 ===
</I>&gt;<i> ** Generic server &lt;0.242.0&gt; terminating
</I>&gt;<i> ** Last message in was {send_command,{'channel.flow',false}}
</I>&gt;<i> ** When Server state == {channel_state,1,&lt;0.241.0&gt;,undefined,&lt;0.243.0&gt;,
</I>&gt;<i>                             #Fun&lt;amqp_direct_driver.do.2&gt;,
</I>&gt;<i>                             #Fun&lt;amqp_direct_driver.do.3&gt;,
</I>&gt;<i>                             #Fun&lt;amqp_direct_driver.close_channel.1&gt;,
</I>&gt;<i>                             {[],[]},
</I>&gt;<i>                             {[],[]},
</I>&gt;<i>                             {dict,0,16,16,8,80,48,
</I>&gt;<i>                                 {[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> [],[],[],
</I>&gt;<i>                                  []},
</I>&gt;<i>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> [],[],
</I>&gt;<i>                                   [],[]}}},
</I>&gt;<i>                             false,undefined,
</I>&gt;<i>                             {dict,0,16,16,8,80,48,
</I>&gt;<i>                                 {[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> [],[],[],
</I>&gt;<i>                                  []},
</I>&gt;<i>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i> [],[],
</I>&gt;<i>                                   [],[]}}}}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** empty_rpc_bottom_half
</I>&gt;<i> =====
</I>
Can you have a look in the rabbit log to see if there is anything like
this in it:

=INFO REPORT==== 9-Dec-2008::08:54:49 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

My first thought is that the client may be receiving a
channel.flow{active=false} notification that it is not able to handle,
but if the client revision is a9695aaf5083 then you are on the 19963
branch which handles that command.

I've tried to channel.flow on before testing this but I still can't
reproduce this symptom.

Furthermore, I can't see how this can occur with that branch, because
the error that you are seeing, empty_rpc_bottom_half, means that the
client has received an RPC response from the server for which it has
no original request, i.e. a phantom RPC repsonse. The channel.flow
command is a reverse RPC, i.e. the server sends the client the RPC and
the client responds with a channel.flow_ok. However, the channel.flow
command has special handling in the client which does not use the
client's RPC queue. So I'm a bit baffled as to how this can happen.

So I think we need to approach this one systematically firstly using
the default branch of the server and the default branch of the client.

Can you first do a make clean run on the server and check the logs for
the alarm handler.

Then do a make clean test_network on the client and report what happens.

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002237.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
	<LI>Next message: <A HREF="002243.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2238">[ date ]</a>
              <a href="thread.html#2238">[ thread ]</a>
              <a href="subject.html#2238">[ subject ]</a>
              <a href="author.html#2238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
