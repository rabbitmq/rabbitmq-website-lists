<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BQ%5D%20best%20way%20to%20add%20a%20sequencer%20to%20the%20broker&In-Reply-To=2840ECA2-9E57-4BD9-B8E1-BB5A40544532%40mac.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002338.html">
   <LINK REL="Next"  HREF="002339.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [Q] best way to add a sequencer to the broker</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BQ%5D%20best%20way%20to%20add%20a%20sequencer%20to%20the%20broker&In-Reply-To=2840ECA2-9E57-4BD9-B8E1-BB5A40544532%40mac.com"
       TITLE="[rabbitmq-discuss] [Q] best way to add a sequencer to the broker">0x6e6562 at gmail.com
       </A><BR>
    <I>Mon Dec 29 16:18:35 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002338.html">[rabbitmq-discuss] [Q] best way to add a sequencer to the broker
</A></li>
        <LI>Next message: <A HREF="002339.html">[rabbitmq-discuss] [Q] best way to add a sequencer to the broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2335">[ date ]</a>
              <a href="thread.html#2335">[ thread ]</a>
              <a href="subject.html#2335">[ subject ]</a>
              <a href="author.html#2335">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chuck,

On Mon, Dec 29, 2008 at 2:04 PM, Chuck Remes &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cremes.devlist at mac.com</A>&gt; wrote:
&gt;<i> 1. This code will likely start before other services, so it will
</I>&gt;<i> declare the exchanges and block on them while waiting for traffic. The
</I>&gt;<i> topic Consumer/Producer examples all illustrate how to do this with a
</I>&gt;<i> single exchange. How do I accomplish this task with multiple
</I>&gt;<i> exchanges? Do I need a separate thread and channel for each exchange?
</I>
In general, one should avoid sharing channels across threads - for
background, see here:
<A HREF="http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html">http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html</A>

&gt;<i> 2. Is there a better way to accomplish this task?
</I>
I'm not quite sure I fully understand the actual use case. AFAICT you
want each message to have it's own sequence number that you want to
set yourself but have some kind of intermediary increment this number.
But because this is stateless operation (because you are just
incrementing a context free number), I must conclude that I don't
really understand what you are really trying to achieve (although I've
read through your post twice - maybe I'm just being stupid). Or is
that the publisher always sets this sequence number to 0 and you want
to stamp it with a globally incremented number?

BTW I don't whether the delivery tag that is sent in the header of the
message to the consumer is of any use to you for sequencing.

&gt;<i> I've read some notes
</I>&gt;<i> about future releases of rabbitmq allowing for &quot;internal&quot; clients that
</I>&gt;<i> run inside the rabbitmq memory space. I think this is an ideal use of
</I>&gt;<i> that capability. Am I right or barking up the wrong tree? And does
</I>&gt;<i> that internal client need to be written in erlang or can it be java/c/
</I>&gt;<i> whatever?
</I>
The Erlang AMQP library can run transparently in the address space of
the broker. The interface is exactly the same as the client library
that uses TCP, the only difference is that the TCP stack and the
message serialization/deserialization is avoided. This basically takes
advantage of the fact that Erlang messages natively and hence you can
unobtrusively abstract out the AMQP wire format.

The types of things that this is useful for is processing messages in
a custom fashion without a network hop and you can stick to the AMQP
model rather than having to write something that is Rabbit specific.
This also takes advantage of the fact that Erlang processes are
isolated from each other and so it is ok to run &quot;foreign code&quot; in the
same memory space as the broker.

But I don't know if this solves your problem, because as I stated
above, I didn't really understand it.

&gt;<i> 3. Is there a way to make this more dynamic so I do not have to
</I>&gt;<i> declare all the exchanges up-front in this sequencer code? Ideally
</I>&gt;<i> this service could detect that new exchanges were declared by other
</I>&gt;<i> services and automatically subscribe to them to do the sequence
</I>&gt;<i> stamping and routing.
</I>
I don't know if the terminology is right here, because you generally
don't subscribe to an exchange, rather to a queue.

In general, it doesn't matter who declares an exchange - the operation
is idempotent - see this FAQ:
<A HREF="http://lettuce.squarespace.com/faq/exchanges/im-interested-in-creating-an-exchange-which-entity-should-de.html">http://lettuce.squarespace.com/faq/exchanges/im-interested-in-creating-an-exchange-which-entity-should-de.html</A>

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002338.html">[rabbitmq-discuss] [Q] best way to add a sequencer to the broker
</A></li>
	<LI>Next message: <A HREF="002339.html">[rabbitmq-discuss] [Q] best way to add a sequencer to the broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2335">[ date ]</a>
              <a href="thread.html#2335">[ thread ]</a>
              <a href="subject.html#2335">[ subject ]</a>
              <a href="author.html#2335">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
