<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang-client%20problem%20on%20OS%20X%0A%09%28empty_rpc_bottom_half%29&In-Reply-To=269388e30812090116t6a4af96elbee6c591ccbe4743%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002238.html">
   <LINK REL="Next"  HREF="002244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)</H1>
    <B>Matt Stancliff</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang-client%20problem%20on%20OS%20X%0A%09%28empty_rpc_bottom_half%29&In-Reply-To=269388e30812090116t6a4af96elbee6c591ccbe4743%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)">sysop at mindspring.com
       </A><BR>
    <I>Wed Dec 10 08:21:17 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002238.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
        <LI>Next message: <A HREF="002244.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2243">[ date ]</a>
              <a href="thread.html#2243">[ thread ]</a>
              <a href="subject.html#2243">[ subject ]</a>
              <a href="author.html#2243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Dec 9, 2008, at 1:16 AM, Ben Hood wrote:

&gt;<i> Can you have a look in the rabbit log to see if there is anything like
</I>&gt;<i> this in it:
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 9-Dec-2008::08:54:49 ===
</I>&gt;<i>    alarm_handler: {set,{system_memory_high_watermark,[]}}
</I>
   Yes, that shows up on startup.

&gt;<i> My first thought is that the client may be receiving a
</I>&gt;<i> channel.flow{active=false} notification that it is not able to handle,
</I>
   You are correct, sir.  Traces of amqp_channel show the first  
rpc_bottom_half handles channel.open_ok.  Then a {channel.flow, false}  
is sent directly to the bottom half without being enqueued anywhere.

&gt;<i> but if the client revision is a9695aaf5083 then you are on the 19963
</I>&gt;<i> branch which handles that command.
</I>
   I ran tests in tip and some previous client and server releases to  
no avail.

&gt;<i> The channel.flow
</I>&gt;<i> command is a reverse RPC, i.e. the server sends the client the RPC and
</I>&gt;<i> the client responds with a channel.flow_ok.
</I>
   Thanks for clearing up where the channel.flow is coming from.

&gt;<i> However, the channel.flow
</I>&gt;<i> command has special handling in the client which does not use the
</I>&gt;<i> client's RPC queue. So I'm a bit baffled as to how this can happen.
</I>
   I don't see special handling of channel.flow in the client  
anywhere.  channel.flow gets passed through handle_info-&gt;handle_method- 
 &gt;rpc_bottom_half:
(&lt;0.74.0&gt;) call amqp_channel:handle_info({method, 
{'channel.flow',false},none},{channel_state, 
1,&lt;0.70.0&gt;,&lt;0.72.0&gt;,&lt;0.75.0&gt;,#Fun&lt;amqp_network_driver.do.2&gt;, ...
(&lt;0.74.0&gt;) call amqp_channel:handle_method({'channel.flow',false}, 
{channel_state, 
1,&lt;0.70.0&gt;,&lt;0.72.0&gt;,&lt;0.75.0&gt;,#Fun&lt;amqp_network_driver.do.2&gt;, ...
(&lt;0.74.0&gt;) call amqp_channel:rpc_bottom_half({'channel.flow',false}, 
{channel_state, 
1,&lt;0.70.0&gt;,&lt;0.72.0&gt;,&lt;0.75.0&gt;,#Fun&lt;amqp_network_driver.do.2&gt;, ...

&gt;<i> Can you first do a make clean run on the server and check the logs for
</I>&gt;<i> the alarm handler.
</I>
   The alarm handler is present.

&gt;<i> Then do a make clean test_network on the client and report what  
</I>&gt;<i> happens.
</I>
   Lots of:
** Reason for termination ==
** empty_rpc_bottom_half

   If I remove the exit(empty_rpc_bottom_half) and replace it with an  
empty queue, the tests pass.  But I have no explanation why the errors  
are only happening on my OS X machine.


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
&quot;The best way to predict the future is to invent it.&quot; --Alan Kay



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002238.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
	<LI>Next message: <A HREF="002244.html">[rabbitmq-discuss] erlang-client problem on OS X	(empty_rpc_bottom_half)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2243">[ date ]</a>
              <a href="thread.html#2243">[ thread ]</a>
              <a href="subject.html#2243">[ subject ]</a>
              <a href="author.html#2243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
