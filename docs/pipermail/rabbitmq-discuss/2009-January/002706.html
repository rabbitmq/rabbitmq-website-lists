<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ experience
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20experience&In-Reply-To=497E2B07.7060906%40redhat.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002705.html">
   <LINK REL="Next"  HREF="002710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ experience</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20experience&In-Reply-To=497E2B07.7060906%40redhat.com"
       TITLE="[rabbitmq-discuss] RabbitMQ experience">matthias at lshift.net
       </A><BR>
    <I>Mon Jan 26 23:19:20 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002705.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
        <LI>Next message: <A HREF="002710.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2706">[ date ]</a>
              <a href="thread.html#2706">[ thread ]</a>
              <a href="subject.html#2706">[ subject ]</a>
              <a href="author.html#2706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gordon,

Gordon Sim wrote:
&gt;<i> A more meaningful result is often the throughput as measured from 
</I>&gt;<i> publishing client to receiving client.
</I>
Indeed. That plus latency for the same setup are the performance figures 
we usually look at.

&gt;<i> (Adding in a reply queue and  periodic status updates back from the
</I>&gt;<i> consumer to the producer also allows such a test to 'throttle' itself
</I>&gt;<i> and avoid the overload that Matthias refers to).
</I>
It is actually surprisingly difficult to determine the *maximum* 
sustainable throughput that way. My experiments have shown that in a 
test where the feedback loop ensures a constant lag (the number of 
messages &quot;in flight&quot;, i.e. the difference between the number of messages 
sent by the producer and received by the consumer), plotting the lag vs 
throughput exhibits some peculiar characteristics:

- there are local maxima, due to buffering and other effects

- the graph is very sensitive to the setup

- the graph changes over time, due in part to the effects of JITs

- sampling intervals have to be very long to get anything approaching 
reproducible results

And all that happens when the feedback loop has been minimised by 
colocating the producer and consumer in the same O/S process and using 
internal message passing for the feedback. Routing the feedback through 
the broker would make the results even more unpredictable.

That's why so far the goal of writing a &quot;press a button and get the 
maximum throughput figure&quot; test has eluded us. Coming up with a test 
that delivers results with a +/-20% accuracy isn't too hard. But that is 
far too insensitive for performance regression tests, where we are 
interested in spotting variations of as little as 2%.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002705.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
	<LI>Next message: <A HREF="002710.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2706">[ date ]</a>
              <a href="thread.html#2706">[ thread ]</a>
              <a href="subject.html#2706">[ subject ]</a>
              <a href="author.html#2706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
