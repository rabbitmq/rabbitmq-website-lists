<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ experience
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20experience&In-Reply-To=497B0CB6.6030007%40imatix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002687.html">
   <LINK REL="Next"  HREF="002689.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ experience</H1>
    <B>Valentino Volonghi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20experience&In-Reply-To=497B0CB6.6030007%40imatix.com"
       TITLE="[rabbitmq-discuss] RabbitMQ experience">dialtone at gmail.com
       </A><BR>
    <I>Sun Jan 25 22:53:29 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002687.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
        <LI>Next message: <A HREF="002689.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2688">[ date ]</a>
              <a href="thread.html#2688">[ thread ]</a>
              <a href="subject.html#2688">[ subject ]</a>
              <a href="author.html#2688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Jan 24, 2009, at 4:42 AM, Martin Sustrik wrote:

&gt;<i> Matthias,
</I>&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> RabbitMQ/stomp (np)     4475/360    362/33    175/17    85/8
</I>&gt;&gt;&gt;&gt;<i> (persistent)            3920/371    375/35    180/18    88/8
</I>&gt;<i>
</I>&gt;<i> The interesting thing about the test is that the overall throughput
</I>&gt;<i> corresponds to message size in a very straightforward way. The network
</I>&gt;<i> wasn't exhausted (unless very low-bandwidth connection was used or a
</I>&gt;<i> very unefficient format for encoding the message body) so it seems  
</I>&gt;<i> that
</I>&gt;<i> the main bottleneck has to do with processing the body of the message.
</I>&gt;<i> Excessive copying may be the cause, or maybe a slow binary-&gt;text- 
</I>&gt;<i> &gt;binary
</I>&gt;<i> conversions)...
</I>

A lot of help comes from using zlib:compress() on the payload before  
sending
it. I've measured about 4400 persistent messages per second on a simple
dual processor using the erlang client and rabbitmq 1.5.0 with a  
payload of
about 4K compressed. And that value is actually the req/sec that I was  
able to
serve from a mochiweb that was using rabbitmq to log requests. Another  
probable
reason for the increased speed I'm seeing is the use of the erlang  
client that sits
in the same process and doesn't incur in tcp performance hit on the  
wire.

Actually I'm VERY satisfied performance wise with RabbitMQ and really  
the
only thing missing to make it the perfect store-and-forward solution
is page-to-disk.

My tests were done on a Core 2 Duo 2.4Ghz with 4GB of memory on
a Gigabit network (used by the python consumer that was able to get  
more than
150msg/sec, including decompression), but this value is probably also  
changed
by the shovel that runs on the source rabbitmq that batches 1000  
messages together
before sending them to a destination rabbitmq.

I should probably run more rigorous tests and see what happens again,  
it would
be very interesting for me too. With 1KB messages though I remember  
seeing
about 8000 msg/sec on the producer side (just pushed in rabbitmq, not  
queued)
with about 4000 msg/sec on the consumer side (consumed). So it could  
indeed
be an 'issue' with serialization as the body of the message grows.

On EC2 instead it's totally different story :), unfortunately the  
shared nature of
the machines makes them pretty slow in almost all cases, a medium high- 
cpu
instance barely reaches 1500 req/sec in the 'same' configuration (the  
one with
mochiweb) and only for short times but the ability to scale on demand  
could be
put to good use :).

I'm not sure if this is useful to anybody, hope so.

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>
<A HREF="http://www.adroll.com">http://www.adroll.com</A>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkl87WkACgkQ9Llz28widGXK4wCbBvKRu/D5C2e72f6djV0Ju4cH
EYEAoJxN0adnuwUHZexIJ0cm8NYmr4ZP
=sBVb
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002687.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
	<LI>Next message: <A HREF="002689.html">[rabbitmq-discuss] RabbitMQ experience
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2688">[ date ]</a>
              <a href="thread.html#2688">[ thread ]</a>
              <a href="subject.html#2688">[ subject ]</a>
              <a href="author.html#2688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
