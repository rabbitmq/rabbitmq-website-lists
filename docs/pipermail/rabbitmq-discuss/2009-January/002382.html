<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: question on the faq
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=7222C973-08E5-494E-8FDD-1F35808F4C56%40coote.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002372.html">
   <LINK REL="Next"  HREF="002388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: question on the faq</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=7222C973-08E5-494E-8FDD-1F35808F4C56%40coote.org"
       TITLE="[rabbitmq-discuss] Fwd: question on the faq">alexis.richardson at cohesiveft.com
       </A><BR>
    <I>Mon Jan  5 16:30:06 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002372.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
        <LI>Next message: <A HREF="002388.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2382">[ date ]</a>
              <a href="thread.html#2382">[ thread ]</a>
              <a href="subject.html#2382">[ subject ]</a>
              <a href="author.html#2382">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tim,

On Mon, Jan 5, 2009 at 3:11 PM, Tim Coote &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim+rabbitmq.com at coote.org</A>&gt; wrote:
&gt;<i> Hullo
</I>
Hi :-)


&gt;<i> Remember, I'm new to messaging technology. I'm coming at this area from a
</I>&gt;<i> more general perspective.
</I>
Understood and I would not wish to dissuade anyone from asking about
this stuff.  It is an essential part of the community process around
AMQP.  Ask away and comment freely!

If you follow the google cloud computing group, you will see a similar
discussion, this time about eventual consistency.  My point being -
here be dragons - people should discuss it and discuss it until it is
clear and all good implementations work.



&gt;<i> Starting with Gray and Reuter's definition of a
</I>&gt;<i> Transaction (an ACID unit of work). My guess is that the term's used in a
</I>&gt;<i> different way in the messaging community, so I'm likely to make mistakes.
</I>&gt;<i>  My background is mostly about understanding how to control technology and
</I>&gt;<i> its use, so I focus on understanding the limits first.
</I>
For sure; and your point about making it easier for end users (eg app
dev) to avoid mistakes, with minimal code, was spot on.

In fact one can take two different views of transactions in the sense
of AMQP TX:

1. Operations are operations on *resources* - so more like databases
(Jim Gray et al.).

This would be fine if it made sense for messaging but arguably it does
not fit messaging in every case.  It makes some sense in the MQ-style
idempotent delivery case; and when HA is well defined in combination
with that; and in some DTX cases.  It would also make sense if all
operations on resources in AMQP (when that makes sense) were
explicitly formalised as such and grouping laws were similarly
defined.

2. Operations are about control of a *stream*.

We like this view as being consistent with AMQP in its full
generality.  Also, as Carl implied, there is a case for seeing TX as
an &quot;acknowledgement pattern&quot; if you take the interpretation Matthias
and I described for 0-8/9 TX.




&gt;<i> Atomic means either everything happens or nothing happens as far as the
</I>&gt;<i> system using a transactional interface is concerned.
</I>
At the risk of being Clintonian, it depends what you mean by
'happens'.  Routing to a queue is acceptable streaming behaviour.  So
if the queue fails after being routed to, then it is not unreasonable
to treat something as having 'happened'.



&gt;<i> At minimum, I'd expect
</I>&gt;<i> that if my app sends a message to n recipients, they either all get it or
</I>&gt;<i> none of them do and my app is reliably informed what the outcome was.
</I>
We should discuss this some more.  In my own view some of such cases
are better handled using idemptotent delivery; or even DTX.


&gt;<i> I
</I>&gt;<i> interpreted Gordon's comment to mean that there were side effects that could
</I>&gt;<i> be abused by programmers to mean that the message had got through.
</I>
I don't think so - but I may be wrong.  I think Gordon's point shows
how TX in 0-8/9 leaves room for debate in some cases.  We would LOVE
to reach a more precise definition acceptable to the 0-8/9 user base,
pending 1.0.


&gt;<i> My
</I>&gt;<i> concern would be that some programmer would use a side effect and come to
</I>&gt;<i> the wrong conclusion.  I probably need to read the specs before I make more
</I>&gt;<i> of a fool of myself.  I'll try to read them before I make any comment after
</I>&gt;<i> this.
</I>
Please DO let us know what you think of 0-9-1.  How can we improve it?


&gt;<i> I know some of the guys in JPMC at that time.  They knew what they were
</I>&gt;<i> doing.
</I>
Yes they did.  Maximum respect.


&gt;<i> Of course, they could have been different people from the ones that
</I>&gt;<i> were working on what became RabbitMQ, although one did tell me that he was
</I>&gt;<i> sponsoring some open source messaging work.
</I>
Yes - RabbitMQ implementation began after 0-8 was made public.  Since
then we have had discussions with past and new implementors through
the magic of the AMQP WG.

alexis



&gt;<i>
</I>&gt;<i> Tim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 5 Jan 2009, at 12:55, Alexis Richardson wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tim,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Jan 5, 2009 at 12:36 PM, Tim Coote &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim+rabbitmq.com at coote.org</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mostly the value comes from
</I>&gt;&gt;&gt;<i> not having application programmers try to fix errors that they
</I>&gt;&gt;&gt;<i> misunderstand, leading to increased cost and decreased quality and
</I>&gt;&gt;&gt;<i> performance.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I agree this is a key benefit of ACID in a system with side effects.
</I>&gt;&gt;<i> But it is also important to be clear about what sorts of consistency
</I>&gt;&gt;<i> (etc) are promised.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> your description implies to me that RabbitMQ message delivery cannot
</I>&gt;&gt;&gt;<i> be Atomic, even at the single message level,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't understand how you can draw this conclusion from what I said
</I>&gt;&gt;<i> (note that the comment below is from Gordon).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My statement included the assertion that at the single message level
</I>&gt;&gt;<i> RabbitMQ delivery *is* atomic.  Without single message atomicity it
</I>&gt;&gt;<i> would be very hard to reason about consistency *at all*.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> let alone defining units
</I>&gt;&gt;&gt;<i> of work that span messages.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> RabbitMQ provides a correct implementation of the TX class which
</I>&gt;&gt;<i> enables work to be grouped.  It is the TX class to which Gordon refers
</I>&gt;&gt;<i> in his email below.  The problem is that the definition of TX is open
</I>&gt;&gt;<i> to *some* interpretation in edge cases, and is implemented slightly
</I>&gt;&gt;<i> differently by the various brokers.  When we discussed the differences
</I>&gt;&gt;<i> in the working group we agreed that it would be more useful to clarify
</I>&gt;&gt;<i> how each 'correct' interpretation actually works for pre 1.0 specs,
</I>&gt;&gt;<i> pending AMQP 1.0.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We would welcome a discussion of the subtleties of TX on this list.
</I>&gt;&gt;<i> If you can find holes in our implementation we would be delighted to
</I>&gt;&gt;<i> make it better!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Shame.  Promising that it's even been discussed tho'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TX was defined in the period 2004-2006 before AMQP became a public
</I>&gt;&gt;<i> spec, when it was in incubation at JPMorgan Chase with the assistance
</I>&gt;&gt;<i> of several groups of software professionals.  But it's not yet
</I>&gt;&gt;<i> perfect.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The complexity of TX arises due to the fact that messaging is about
</I>&gt;&gt;<i> routing and delivery as much as it is about enforcing various forms of
</I>&gt;&gt;<i> seriality in the presence of change.  For example consider the case
</I>&gt;&gt;<i> where N messages are sent in a TX transaction, over multiple queues,
</I>&gt;&gt;<i> and during this operation one queue disappears (eg due to failure).  A
</I>&gt;&gt;<i> proper treatment of this requires a proper treatment of multiple
</I>&gt;&gt;<i> failure cases, and a clear definition of ordering.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'll see if I
</I>&gt;&gt;&gt;<i> can find the spec that you refer to.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please do take a look and let us know what you think.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> alexis
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Tim
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 5 Jan 2009, at 11:35, Gordon Sim wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Alexis Richardson wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> On Wed, Dec 31, 2008 at 12:17 PM, Tim Coote &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim+rabbitmq.com at coote.org</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> A neophyte's question:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> The  faq includes 'is rabbitmq transactional?'
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> The answer is 'yes' and then says that it has atomicity and
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> durability
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> guarantees. What about Isolation and consistency?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> There are senses in which AMQP, and RabbitMQ, behaviour can be
</I>&gt;&gt;&gt;&gt;&gt;<i> described as ACID, following the wikipedia definition:
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://en.wikipedia.org/wiki/ACID">http://en.wikipedia.org/wiki/ACID</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> In recent discussions on improving the text for the tx 'class' in
</I>&gt;&gt;&gt;&gt;<i> the 0-9-1 spec there appeared to be some disagreement around the
</I>&gt;&gt;&gt;&gt;<i> atomicity guarantee.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> In particular, I understood from comments by members of the RabbitMQ
</I>&gt;&gt;&gt;&gt;<i> team that though effects of all contained (publish and ack)
</I>&gt;&gt;&gt;&gt;<i> operations are visible if the the commit is successful, RabbitMQ
</I>&gt;&gt;&gt;&gt;<i> does not guarantee that none of them would be visible in the event
</I>&gt;&gt;&gt;&gt;<i> of a failure.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Tim Coote
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Tim Coote
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at coote.org</A>
</I>&gt;<i> vincit veritas
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002372.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
	<LI>Next message: <A HREF="002388.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2382">[ date ]</a>
              <a href="thread.html#2382">[ thread ]</a>
              <a href="subject.html#2382">[ subject ]</a>
              <a href="author.html#2382">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
