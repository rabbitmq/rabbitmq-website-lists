<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang client not working?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%20not%20working%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002605.html">
   <LINK REL="Next"  HREF="002603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang client not working?</H1>
    <B>Valentino Volonghi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%20not%20working%3F&In-Reply-To="
       TITLE="[rabbitmq-discuss] Erlang client not working?">dialtone at gmail.com
       </A><BR>
    <I>Thu Jan 15 01:47:38 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002605.html">[rabbitmq-discuss] Miscellaneous Question
</A></li>
        <LI>Next message: <A HREF="002603.html">[rabbitmq-discuss] Erlang client not working?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2602">[ date ]</a>
              <a href="thread.html#2602">[ thread ]</a>
              <a href="subject.html#2602">[ subject ]</a>
              <a href="author.html#2602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not sure what's going on but...

I'm trying to send messages using the rabbitmq-erlang-client using  
these lines:

             Properties = #'P_basic'{
                 content_type = &lt;&lt;&quot;application/octet-stream&quot;&gt;&gt;,
                 delivery_mode = 2,
                 priority = 0
             },
             lib_amqp:publish(Broker, &lt;&lt;&quot;flow&quot;&gt;&gt;, list_to_binary(Key),  
Payload, Properties)

But then I receive this error:

Channel 1 is shutting down due to: {badarg,
                                     [{erlang,size,
                                       [&quot;2009:1:15:1:37:50|| 
BOIXKZLU35DNVNIAJG5QX3||FB2ECVNZMRHUPP65V3VIDU|| 
d57564110fee0b631a95d9adceb713cc.ev||US||USA||United States||CA|| 
37.79150000000001||-122.4089||415||807||San Francisco||94108|| 
127.0.0.1|||| 
TW96aWxsYS81LjAgKE1hY2ludG9zaDsgVTsgSW50ZWwgTWFjIE9TIFggMTBfNV82OyBlbi11cykgQXBwbGVXZWJLaXQvNTI1LjI3LjEgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzMuMi4xIFNhZmFyaS81MjUuMjcuMQ 
==||ff32ff680112993033bc3fde17d49f5e&quot;]},
                                      {rabbit_binary_generator,
                                       build_content_frames,5},
                                      {rabbit_binary_generator,
                                       build_simple_content_frames,3},
                                      {rabbit_writer,assemble_frames,4},
                                      {rabbit_writer,
                                       internal_send_command_async,5},
                                      {rabbit_writer,handle_message,2},
                                      {rabbit_writer,mainloop,1}]}

It only does that for some messages apparently though, those that are  
delivered then raise
this error on the consumer side (that still forwards messages):

** Reason for termination ==
** {noproc,
        {gen_server,call,
            [&lt;0.219.0&gt;,
             {call,
                 {'basic.publish',1,&lt;&lt;&quot;flow&quot;&gt;&gt;,
                      
&lt;&lt;&quot;event.BOIXKZLU35DNVNIAJG5QX3.FB2ECVNZMRHUPP65V3VIDU&quot;&gt;&gt;,
                     false,false},
                 {content,60,
                     {'P_basic',&lt;&lt;&quot;application/octet- 
stream&quot;&gt;&gt;,undefined,
                         undefined, 
2,0,undefined,undefined,undefined,undefined,
                          
undefined,undefined,undefined,undefined,undefined},
                     none,
                     [&quot;2009:1:15:1:37:52||BOIXKZLU35DNVNIAJG5QX3|| 
FB2ECVNZMRHUPP65V3VIDU||d57564110fee0b631a95d9adceb713cc.ev||US||USA|| 
United States||CA||37.79150000000001||-122.4089||415||807||San  
Francisco||94108||127.0.0.1|||| 
TW96aWxsYS81LjAgKE1hY2ludG9zaDsgVTsgSW50ZWwgTWFjIE9TIFggMTBfNV82OyBlbi11cykgQXBwbGVXZWJLaXQvNTI1LjI3LjEgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzMuMi4xIFNhZmFyaS81MjUuMjcuMQ 
==||52dd6625acfffde415c6b9da26f6be68&quot;]}}]}}

It seems that something is mixing the arguments moving the Payload  
where a Size should be.

I'm using:

rabbitmq-server (default branch):
changeset:   727:89756e9329f4
tag:         tip
parent:      718:0a1371be4f98
parent:      726:97e40f6bb50a
user:        Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;
date:        Mon Jan 12 17:24:05 2009 +0000
summary:     merge v1_5_1 into default

rabbitmq-erlang-client (default branch):
changeset:   213:437d0e4d66c8
branch:      bug20103
tag:         tip
user:        Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt;
date:        Fri Jan 09 18:28:35 2009 +0000
summary:     Switched over to gen_server2 handling


-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>
<A HREF="http://www.adroll.com">http://www.adroll.com</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090114/c9cd333f/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090114/c9cd333f/attachment.htm</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090114/c9cd333f/attachment.pgp">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090114/c9cd333f/attachment.pgp</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002605.html">[rabbitmq-discuss] Miscellaneous Question
</A></li>
	<LI>Next message: <A HREF="002603.html">[rabbitmq-discuss] Erlang client not working?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2602">[ date ]</a>
              <a href="thread.html#2602">[ thread ]</a>
              <a href="subject.html#2602">[ subject ]</a>
              <a href="author.html#2602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
