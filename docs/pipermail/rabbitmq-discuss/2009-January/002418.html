<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: question on the faq
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=49635E75.5010904%40redhat.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002416.html">
   <LINK REL="Next"  HREF="002419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: question on the faq</H1>
    <B>Tim Coote</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=49635E75.5010904%40redhat.com"
       TITLE="[rabbitmq-discuss] Fwd: question on the faq">tim+rabbitmq.com at coote.org
       </A><BR>
    <I>Tue Jan  6 14:44:47 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002416.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
        <LI>Next message: <A HREF="002419.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2418">[ date ]</a>
              <a href="thread.html#2418">[ thread ]</a>
              <a href="subject.html#2418">[ subject ]</a>
              <a href="author.html#2418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, Carl. Where can I find 1.0 - I could only find 10 when I  
looked at the amqp site.

Now I'm very confused. In my mind, to book my holiday example, I need:
1/ Begin transaction
2/ prepare definition of what to book (cab to airport, insurance,  
flight, hotel, etc)
3/ send booking requests
4/ receive and record booking confirmations
5/ Commit

with corresponding compensating transactions if any of the elements  
fails.

As far as I can see, 3 and 4 are dependent on the semantics of the  
message and how they are processed downstream, not just the queue that  
I'm sending them to/receiving them from. As a system specifier, I'd  
want to treat a booking failure for whatever reason (message didn't  
get thro' or no resource available) in the same way. I want all 5  
steps with ACID semantics (although I may swap 1 and 2 around). Have I  
got hold of the wrong end of the stick?

2pc vs 1pc is really just an implementation issue, it's much better if  
I can treat them as the same thing, at least initially, and fwiw, 2pc  
doesn't actually guarantee ACID semantics, although the hole is  
usually ignored and handled as a system failure.

On 6 Jan 2009, at 13:36, Carl Trieloff wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just a note, we at the Qpid project interpret txn's to be atomic and  
</I>&gt;<i> support full XA and TM integration. So it works like any other  
</I>&gt;<i> messaging software that supports txn's
</I>Maybe I just need to be aware that the word Transaction means  
something different for messaging systems to elsewhere. If so, I bet  
working with Oracle (as a company) is a bunch of fun, as they mostly  
don't appreciate that a transaction doesn't imply a dbms :-)
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> TX and DTX ARE to cover the 'normal semantics of a transaction'  The  
</I>&gt;<i> DTX work in AMQP was done by the guys that worked on Arjuna,  
</I>&gt;<i> Bluestone, Encina and a few other TMs. TX in 0-10 and 1.0 is just  
</I>&gt;<i> the 1PC case where you want transactional semantics with a single  
</I>&gt;<i> resource the broker, as where DTX is needed when you want more than  
</I>&gt;<i> one transactional resource. In AMQP 1.0 you will see that en-listing  
</I>&gt;<i> of txn has been moved to the session, and the coordinator part of  
</I>&gt;<i> DTX has been named such so avoid the TX/DTX confusion.
</I>so the tx class is only to do with interactions with the messaging  
system itself (cf recorded delivery for the postal service), vs a  
simple order processing model (send order, schedule delivery, confirm  
order).
&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Using what I'd call the normal semantics of a transaction, I'd  
</I>&gt;&gt;<i> define a unit of work that booked all of my components of my  
</I>&gt;&gt;<i> holiday in one block and I'd know whether everything were ok or not.
</I>&gt;<i>
</I>&gt;<i> Ack, this is what TX and DTX are for
</I>&gt;<i>
</I>&gt;&gt;<i> It also makes it very obvious that I need to think about the legal  
</I>&gt;&gt;<i> contracts that I'm 'committing' to so that I can form suitable  
</I>&gt;&gt;<i> compensating transactions.
</I>&gt;<i>
</I>&gt;<i> correct
</I>&gt;<i>
</I>&gt;&gt;<i> Using the AQMP definition, all I know is that the booking requests  
</I>&gt;&gt;<i> were delivered, and possibly not even that they'd all been delivered.
</I>&gt;<i>
</I>&gt;<i> AMQP transaction means that all the messages in the txn where  
</I>&gt;<i> correctly enqueded/dequeded on the broker or aborted atomically. i.e  
</I>&gt;<i> all my messages in the txn where consumed are put back in an abort  
</I>&gt;<i> atomically and all my published messaged are enqueued. Also that no  
</I>&gt;<i> published messages are made available to the consumer until the txn  
</I>&gt;<i> has been committed.
</I>Surely the luw would normally include correct consumption and  
processing of the messages, otherwise all that my app knows about the  
state of the world is that the messages went. I was coming to the  
conclusion that that was the AMQP guarantee (essentially proof of  
sending or proof of delivery), but your example implies to me that it  
could also include correct understanding of, and action on the messages.
&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> tx and dtx classes have value (I still need to get to the bottom of  
</I>&gt;&gt;<i> what).
</I>&gt;<i>
</I>&gt;<i> This is my key point -- if you chose to decide that the AMQP  
</I>&gt;<i> transaction is not atomic, I have no clue what it is used for and I  
</I>&gt;<i> no way in a transaction in my mind.
</I>&gt;<i>
</I>&gt;&gt;<i> However, their naming - especially if dtx is defined in terms of XA  
</I>&gt;&gt;<i> spec, but doesn't cover the content of messages, is going to create  
</I>&gt;&gt;<i> an adoption barrier to the technology.  Have a scan of XA and DTP  
</I>&gt;&gt;<i> and see if you agree.  (Section 2.2 et seq - I won't reproduce it  
</I>&gt;&gt;<i> here: it's short, but doesn't format well when I drop it into an  
</I>&gt;&gt;<i> email).
</I>&gt;<i>
</I>&gt;<i> The content of the message is transactional as it is contained in  
</I>&gt;<i> the message.
</I>if and only if the luw is the sending/receipt of the message, which is  
ok, but I don't think it's what you're saying.
Tim


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002416.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
	<LI>Next message: <A HREF="002419.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2418">[ date ]</a>
              <a href="thread.html#2418">[ thread ]</a>
              <a href="subject.html#2418">[ subject ]</a>
              <a href="author.html#2418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
