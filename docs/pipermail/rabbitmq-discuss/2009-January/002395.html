<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: question on the faq
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=49627DC3.3070508%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002394.html">
   <LINK REL="Next"  HREF="002396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: question on the faq</H1>
    <B>Gordon Sim</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=49627DC3.3070508%40lshift.net"
       TITLE="[rabbitmq-discuss] Fwd: question on the faq">gsim at redhat.com
       </A><BR>
    <I>Mon Jan  5 22:18:18 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002394.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
        <LI>Next message: <A HREF="002396.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2395">[ date ]</a>
              <a href="thread.html#2395">[ thread ]</a>
              <a href="subject.html#2395">[ subject ]</a>
              <a href="author.html#2395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias Radestock wrote:
&gt;<i> Gordon,
</I>&gt;<i> Gordon,
</I>&gt;<i> 
</I>&gt;<i> Gordon Sim wrote:
</I>&gt;&gt;<i> I'm not sure I follow you. If, as I understood your earlier comment to 
</I>&gt;&gt;<i> imply, the various transactional operations cannot be atomically 
</I>&gt;&gt;<i> aborted, it would seem to me that it is not ACID under either 
</I>&gt;&gt;<i> interpretation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> E.g. if a transaction where I publish a message and acknowledge 
</I>&gt;&gt;<i> another is aborted, is it possible that the published message is 
</I>&gt;&gt;<i> delivered to a subscriber of some matching queue and the acknowledged 
</I>&gt;&gt;<i> message is left on the queue and is subsequently redelivered to 
</I>&gt;&gt;<i> another subscriber? If so it is not atomic.
</I>&gt;<i> 
</I>&gt;<i> The above cannot happen when the abort was caused by a fault or 
</I>&gt;<i> tx.rollback. It can only happen in the event of node or communication 
</I>&gt;<i> failure in a clustered set up when performing a tx.commit, though 
</I>&gt;<i> arguably the error in that case is signalling a breakdown of the tx 
</I>&gt;<i> mechanics (&quot;all bets are off&quot;) rather than a controlled tx abort.
</I>

&gt;<i> 
</I>&gt;&gt;<i> Personally I'm not convinced the stream/resource distinction alters 
</I>&gt;&gt;<i> the issue which for me relates to the success of operations. A 
</I>&gt;&gt;<i> successful publish operation causes a message to become available for 
</I>&gt;&gt;<i> delivery to subscribers on all matching queues; a successful ack 
</I>&gt;&gt;<i> operation prevents the referenced message from being redelivered. 
</I>&gt;&gt;<i> Atomicity means that either all the are 'successful', or none of them 
</I>&gt;&gt;<i> have any effect.
</I>&gt;<i> 
</I>&gt;<i> The spec has nothing to say regarding the semantics of &quot;successful 
</I>&gt;<i> publish&quot;, except in regard to a few obvious cases (e.g. non-existence of 
</I>&gt;<i> the exchange) and in the context of the mandatory/immediate flags, which 
</I>&gt;<i> don't actually cause the publish to fail (a basic.return is not a failure).
</I>
I'm not sure I agree. The semantics of an exchange are clearly defined 
as routing a message to any queue with a matching binding. Failure to do 
so is in my view fairly obviously 'unsuccessful'. Not finding a matching 
binding is a separate case of course and is not an error.

&gt;&gt;&gt;<i> And because ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Routing to a queue is acceptable streaming behaviour.  So
</I>&gt;&gt;&gt;&gt;<i> if the queue fails after being routed to, then it is not unreasonable
</I>&gt;&gt;&gt;&gt;<i> to treat something as having 'happened'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A bug (or indeed some hardware failure) may prevent a message from 
</I>&gt;&gt;<i> being accepted by the queue. Thats a different case from the queue not 
</I>&gt;&gt;<i> existing. In the current AMQP routing model publishing a message for 
</I>&gt;&gt;<i> which no binding matches is not an error, but the failure or a bound 
</I>&gt;&gt;<i> queue to accept a message routed to it is in my view an error and 
</I>&gt;&gt;<i> should be signaled as such.
</I>&gt;<i> 
</I>&gt;<i> AMQP does not define the latter case as an error. We can debate whether 
</I>&gt;<i> it should, but in RabbitMQ we decided that the disappearance of a queue 
</I>&gt;<i> - for whatever reason, including as a result of some fault during the 
</I>&gt;<i> handling a basic.publish - does not result in a failure of ordinary 
</I>&gt;<i> publishes, though for mandatory/immediate publishes a basic.return will 
</I>&gt;<i> be issued if none of the bound queues accept the message.
</I>
I don't believe it is valid for a queue to disappear due to some 
internal fault. That to me is a bug and outside the scope of the 
specification.

&gt;&gt;&gt;<i> ... arguably, to be fully consistent with the second interpretation a 
</I>&gt;&gt;&gt;<i> tx.commit (and rollback) should *succeed* even if some of the queues 
</I>&gt;&gt;&gt;<i> to which messages/acks were delivered disappears. RabbitMQ's 
</I>&gt;&gt;&gt;<i> tx.commit currently returns an error for this, which is something we 
</I>&gt;&gt;&gt;<i> may want to change.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the queue is explicitly deleted by the application, I think thats 
</I>&gt;&gt;<i> fair enough. If it 'disappears' due to some failure condition I think 
</I>&gt;&gt;<i> that should cause an error which would in turn abort the transaction.
</I>&gt;<i> 
</I>&gt;<i> That's certainly a valid point of view. However, there is also a case 
</I>&gt;<i> for saying that queues are of no concern to publishers, only consumers, 
</I>&gt;<i> since publishers never address them directly. 
</I>
True, but a system as a whole needs to be able to rely on the semantics 
of an exchange and the lifecycle of the queue. I think what confuses me 
is the notion of a queue vanishing due to some unspecified error, and I 
would feel very uncomfortable having the broker simply continue without 
signaling that potentially catastrophic violation of the specified 
semantics of a broker.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002394.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
	<LI>Next message: <A HREF="002396.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2395">[ date ]</a>
              <a href="thread.html#2395">[ thread ]</a>
              <a href="subject.html#2395">[ subject ]</a>
              <a href="author.html#2395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
