<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Making persistence simpler (Was: AMQP &amp; Python	Write-Up)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Making%20persistence%20simpler%20%28Was%3A%20AMQP%20%26%20Python%0A%09Write-Up%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002639.html">
   <LINK REL="Next"  HREF="002633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Making persistence simpler (Was: AMQP &amp; Python	Write-Up)</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Making%20persistence%20simpler%20%28Was%3A%20AMQP%20%26%20Python%0A%09Write-Up%29&In-Reply-To="
       TITLE="[rabbitmq-discuss] Making persistence simpler (Was: AMQP &amp; Python	Write-Up)">alexis.richardson at cohesiveft.com
       </A><BR>
    <I>Sat Jan 17 13:10:51 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002639.html">[rabbitmq-discuss] Message deleted at subscription?
</A></li>
        <LI>Next message: <A HREF="002633.html">[rabbitmq-discuss] Making persistence simpler (Was: AMQP &amp; Python Write-Up)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2632">[ date ]</a>
              <a href="thread.html#2632">[ thread ]</a>
              <a href="subject.html#2632">[ subject ]</a>
              <a href="author.html#2632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am reposting Jason's thoughts on simplifying AMQP persistence to the
list, with his permission.

alexis


---------- Forwarded message ----------
From: Jason J. W. Williams &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jasonjwwilliams at gmail.com</A>&gt;
Date: Thu, Jan 15, 2009 at 8:56 PM
Subject: Re: [rabbitmq-discuss] AMQP &amp; Python Write-Up
To: Alexis Richardson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>&gt;


Hi Alexis,

My thinking on it is that the publisher should be able to be as &quot;dumb&quot;
as possible. This seems to be a tenet of AMQP from my reading, based
on the fact that it doesn't know where the message is going.

In the way we're designing uses for the queues, the consumers are the
ones that know if they need the messages to be persistent, or rather
know the value of the message. Largely because they have the details
on what they're doing with the message.

To that end, requiring every publisher to mark a message consistent,
means one accidentally may not be coded that way, and thereby will
override the consumer's need for the message to be persistent.

It seems to me in that regard, it makes more sense to make persistence
an attribute of the exchange and the queue (as durable is).

Fewer moving parts to keep track of, and the publishers can be
simple-minded minions. ;-)

Just my very uninformed opinion.

-J

On Thu, Jan 15, 2009 at 2:15 AM, Alexis Richardson
&gt;<i> On Thu, Jan 15, 2009 at 12:58 AM, Jason J. W. Williams
</I>&gt;<i> &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jasonjwwilliams at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Barry &amp; Gordon,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Entry has been updated with the correct no_ack explanation. Regarding
</I>&gt;&gt;<i> the None return on &quot;no message waiting&quot; from basic_get(), I chose to
</I>&gt;&gt;<i> explain that in words, rather than trap it out in the code to maintain
</I>&gt;&gt;<i> clarity.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/">http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you very much for your help.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -J
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Wed, Jan 14, 2009 at 5:28 PM, Barry Pederson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bp at barryp.org</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Gordon Sim wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Jason J. W. Williams wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> I've written up a quick start on the basics of AMQP and using it in
</I>&gt;&gt;&gt;&gt;&gt;<i> Python, that is the kind of document I wished I'd been able to find in
</I>&gt;&gt;&gt;&gt;&gt;<i> one place: <A HREF="http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/">http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> It's probably laced with errors, and I'd appreciate any
</I>&gt;&gt;&gt;&gt;&gt;<i> feedback/corrections.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Nice article!
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I am not that familiar with py-amqplib but the no_ack argument to
</I>&gt;&gt;&gt;&gt;<i> basic_consume/basic_get is defined in the AMQP spec to mean that the server
</I>&gt;&gt;&gt;&gt;<i> should not expect an ack and should discard the message on delivery. I.e.
</I>&gt;&gt;&gt;&gt;<i> its an unreliable mode of delivery[1] rather than a signal to the client
</I>&gt;&gt;&gt;&gt;<i> library to automatically acknowledge on receiving a message.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I just read the article too, very nice.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Gordon's right about the no_ack flag, this sentence:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  If you set the no_ack argument to true, then py-amqplib will
</I>&gt;&gt;&gt;<i>  automatically send the acknowledgement immediately for you.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> should probably instead say something like what Gordon mentions above - it's
</I>&gt;&gt;&gt;<i> the broker that acts differently based on that flag, not the client library.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The only other thing I noticed was this section:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ----
</I>&gt;&gt;&gt;<i> Now, there's two methods of getting messages out of the queue. The first is
</I>&gt;&gt;&gt;<i> to call chan.basic_get() to pull the next message off the queue:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   1. msg = chan.basic_get(&quot;po_box&quot;)
</I>&gt;&gt;&gt;<i>   2. print msg.body()
</I>&gt;&gt;&gt;<i>   3. chan.basic_ack(msg.delivery_tag)
</I>&gt;&gt;&gt;<i> ----
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If there isn't a message waiting in the queue when line 1 executes, then msg
</I>&gt;&gt;&gt;<i> is set to None and line 2 will die since None does not have a &quot;body&quot;
</I>&gt;&gt;&gt;<i> attribute.  Also, body is not a function to call, it's just a string, so
</I>&gt;&gt;&gt;<i> this would be more appropriate:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    msg = chan.basic_get(&quot;po_box&quot;)
</I>&gt;&gt;&gt;<i>    if msg is not None:
</I>&gt;&gt;&gt;<i>        print msg.body
</I>&gt;&gt;&gt;<i>        chan.basic_ack(msg.delivery_tag)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ================
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>        Barry
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002639.html">[rabbitmq-discuss] Message deleted at subscription?
</A></li>
	<LI>Next message: <A HREF="002633.html">[rabbitmq-discuss] Making persistence simpler (Was: AMQP &amp; Python Write-Up)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2632">[ date ]</a>
              <a href="thread.html#2632">[ thread ]</a>
              <a href="subject.html#2632">[ subject ]</a>
              <a href="author.html#2632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
