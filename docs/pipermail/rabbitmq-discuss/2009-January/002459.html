<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ timing out under small load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20timing%20out%20under%20small%20load&In-Reply-To=21342279.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002458.html">
   <LINK REL="Next"  HREF="002460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ timing out under small load</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20timing%20out%20under%20small%20load&In-Reply-To=21342279.post%40talk.nabble.com"
       TITLE="[rabbitmq-discuss] RabbitMQ timing out under small load">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Jan  8 00:51:40 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002458.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
        <LI>Next message: <A HREF="002460.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2459">[ date ]</a>
              <a href="thread.html#2459">[ thread ]</a>
              <a href="subject.html#2459">[ subject ]</a>
              <a href="author.html#2459">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greg,

On Wed, Jan 7, 2009 at 10:56 PM, gfodor &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">gfodor at gmail.com</A>&gt; wrote:
&gt;<i> That said, I was having connectivity problems on both of them for sure, from
</I>&gt;<i> running consumers through list_queues. At the end of the day the thing I
</I>&gt;<i> would have been able to determine is basically if one node was dropping them
</I>&gt;<i> less frequently than others (ie, node 2 may have just simply been
</I>&gt;<i> terminating them upon connection, whereas the other one may only have
</I>&gt;<i> terminated them once the connection tried to access a queue on node 2.)
</I>
What you mean exactly with connectivity problems? What I am trying to
isolate with this question is whether the Rabbit instance was
unresponsive or whether you were having general network issues.

&gt;<i> Honestly I am not sure where the queues lived, since I don't think RabbitMQ
</I>&gt;<i> can really tell you directly.
</I>
There is no API call to tell you the node (mainly because this should
be transparent to the API consumer) but if you use the Erlang shell,
you could get the PID of the queue and from that, Erlang can tell on
which node the queue resides. I'm not going to go into the details of
this because this would involve a learning curve and I'm trying to
narrow down the possibilities, but suffice is to say that one of nice
things about Erlang/OTP is all of the features that allow you to poke
around in a running system.

&gt;<i> I was not able to drain them by performing get operations due to the
</I>&gt;<i> constant timeouts and the fact that the get operations were taking 2-3
</I>&gt;<i> seconds a piece. I ended up fixing it by performing a delete queue
</I>&gt;<i> operations and then creating the queue over again.
</I>
This may be OT but have you tried purging the queue?

The timeouts that you are seeing *may* be due to network latency, but
I can't know for sure. For example, if you connect to a node in the
cluster and issue a basic.get for a queue that exists on a different
node, internally this will send a message to a remote process and wait
for the response, with a default timeout of 5 seconds.

&gt;<i> Here's a potentially more productive question: if I am able to get to the
</I>&gt;<i> point where I am sure that rabbitMQ is causing the problem and not some
</I>&gt;<i> external TCP factors, is there any other way to see what RabbitMQ is doing
</I>&gt;<i> internally other than by looking at the log?
</I>
In general yes. As I mentioned before, one of features of OTP is all
of the built in monitoring tools, which if you know how to use, can
help troubleshoot a running Erlang application. But I don't want to
just say, do this, do that, poke around there, because there is a
learning curve associated with doing this and we may be able to get
the bottom of this issue for you. It would be a bit like telling a
non-Unix person to go to the shell and type in &quot;ps -elf | grep foo&quot;.

As indicated beforehand, it would helpful if you were able to
reproduce this in some way.

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002458.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
	<LI>Next message: <A HREF="002460.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2459">[ date ]</a>
              <a href="thread.html#2459">[ thread ]</a>
              <a href="subject.html#2459">[ subject ]</a>
              <a href="author.html#2459">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
