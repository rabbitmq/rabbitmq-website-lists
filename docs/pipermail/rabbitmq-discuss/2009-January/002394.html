<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: question on the faq
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=496272BD.9080009%40redhat.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002393.html">
   <LINK REL="Next"  HREF="002395.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: question on the faq</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20question%20on%20the%20faq&In-Reply-To=496272BD.9080009%40redhat.com"
       TITLE="[rabbitmq-discuss] Fwd: question on the faq">matthias at lshift.net
       </A><BR>
    <I>Mon Jan  5 21:38:11 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002393.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
        <LI>Next message: <A HREF="002395.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2394">[ date ]</a>
              <a href="thread.html#2394">[ thread ]</a>
              <a href="subject.html#2394">[ subject ]</a>
              <a href="author.html#2394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gordon,
Gordon,

Gordon Sim wrote:
&gt;<i> I'm not sure I follow you. If, as I understood your earlier comment to 
</I>&gt;<i> imply, the various transactional operations cannot be atomically 
</I>&gt;<i> aborted, it would seem to me that it is not ACID under either 
</I>&gt;<i> interpretation.
</I>&gt;<i> 
</I>&gt;<i> E.g. if a transaction where I publish a message and acknowledge another 
</I>&gt;<i> is aborted, is it possible that the published message is delivered to a 
</I>&gt;<i> subscriber of some matching queue and the acknowledged message is left 
</I>&gt;<i> on the queue and is subsequently redelivered to another subscriber? If 
</I>&gt;<i> so it is not atomic.
</I>
The above cannot happen when the abort was caused by a fault or 
tx.rollback. It can only happen in the event of node or communication 
failure in a clustered set up when performing a tx.commit, though 
arguably the error in that case is signalling a breakdown of the tx 
mechanics (&quot;all bets are off&quot;) rather than a controlled tx abort.

&gt;<i> Personally I'm not convinced the stream/resource distinction alters the 
</I>&gt;<i> issue which for me relates to the success of operations. A successful 
</I>&gt;<i> publish operation causes a message to become available for delivery to 
</I>&gt;<i> subscribers on all matching queues; a successful ack operation prevents 
</I>&gt;<i> the referenced message from being redelivered. Atomicity means that 
</I>&gt;<i> either all the are 'successful', or none of them have any effect.
</I>
The spec has nothing to say regarding the semantics of &quot;successful 
publish&quot;, except in regard to a few obvious cases (e.g. non-existence of 
the exchange) and in the context of the mandatory/immediate flags, which 
don't actually cause the publish to fail (a basic.return is not a failure).

&gt;&gt;<i> And because ...
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Routing to a queue is acceptable streaming behaviour.  So
</I>&gt;&gt;&gt;<i> if the queue fails after being routed to, then it is not unreasonable
</I>&gt;&gt;&gt;<i> to treat something as having 'happened'.
</I>&gt;<i> 
</I>&gt;<i> A bug (or indeed some hardware failure) may prevent a message from being 
</I>&gt;<i> accepted by the queue. Thats a different case from the queue not 
</I>&gt;<i> existing. In the current AMQP routing model publishing a message for 
</I>&gt;<i> which no binding matches is not an error, but the failure or a bound 
</I>&gt;<i> queue to accept a message routed to it is in my view an error and should 
</I>&gt;<i> be signaled as such.
</I>
AMQP does not define the latter case as an error. We can debate whether 
it should, but in RabbitMQ we decided that the disappearance of a queue 
- for whatever reason, including as a result of some fault during the 
handling a basic.publish - does not result in a failure of ordinary 
publishes, though for mandatory/immediate publishes a basic.return will 
be issued if none of the bound queues accept the message.

&gt;&gt;<i> ... arguably, to be fully consistent with the second interpretation a 
</I>&gt;&gt;<i> tx.commit (and rollback) should *succeed* even if some of the queues 
</I>&gt;&gt;<i> to which messages/acks were delivered disappears. RabbitMQ's tx.commit 
</I>&gt;&gt;<i> currently returns an error for this, which is something we may want to 
</I>&gt;&gt;<i> change.
</I>&gt;<i> 
</I>&gt;<i> If the queue is explicitly deleted by the application, I think thats 
</I>&gt;<i> fair enough. If it 'disappears' due to some failure condition I think 
</I>&gt;<i> that should cause an error which would in turn abort the transaction.
</I>
That's certainly a valid point of view. However, there is also a case 
for saying that queues are of no concern to publishers, only consumers, 
since publishers never address them directly. One problem with the spec 
is that there currently is no way for *consumers* to be notified of the 
death/deletion of a queue, which imho would be far more useful.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002393.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
	<LI>Next message: <A HREF="002395.html">[rabbitmq-discuss] Fwd: question on the faq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2394">[ date ]</a>
              <a href="thread.html#2394">[ thread ]</a>
              <a href="subject.html#2394">[ subject ]</a>
              <a href="author.html#2394">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
