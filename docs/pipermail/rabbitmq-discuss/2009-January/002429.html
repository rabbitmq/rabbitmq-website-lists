<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ timing out under small load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20timing%20out%20under%20small%20load&In-Reply-To=21315520.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002426.html">
   <LINK REL="Next"  HREF="002431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ timing out under small load</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20timing%20out%20under%20small%20load&In-Reply-To=21315520.post%40talk.nabble.com"
       TITLE="[rabbitmq-discuss] RabbitMQ timing out under small load">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Tue Jan  6 19:35:24 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002426.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
        <LI>Next message: <A HREF="002431.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2429">[ date ]</a>
              <a href="thread.html#2429">[ thread ]</a>
              <a href="subject.html#2429">[ subject ]</a>
              <a href="author.html#2429">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

Please note that I personally haven't observed symptoms that you describe, so I can't 
speak from practical experience, only theoretical.


gfodor wrote:
&gt;<i> We had an incident yesterday while restarting some servers where RabbitMQ
</I>&gt;<i> began basically being dysfunctional -- we were getting connection timeouts
</I>&gt;<i> in our log everywhere, and were not even able to perform a rabbitmqctl
</I>&gt;<i> list_queues without it timing out 70-80% of the time.
</I>Was there anything to suggest overall network latency or connection timeouts or connection 
issues to other services running on the hosts where rabbitmq was running? In other words, 
is it possible that the issues were related to the host and/or OS?

Also, to confirm, you are running 2 rabbitmq brokers on 2 different EC2 instances (1 
broker per instance) and the problem happened on both instances, both brokers at the same 
time and brokers are not in a rabbitmq cluster, right?


&gt;<i> 
</I>&gt;<i> Here's our setup. We have two RabbitMQ nodes running on EC2 running Ubuntu
</I>&gt;<i> hardy. They have four queues, all of them durable, each with &lt;1kb message
</I>&gt;<i> sizes. Yesterday we were doing a deployment so naturally these queues filled
</I>&gt;<i> up with backlog as the servers responsible for processing them were
</I>&gt;<i> temporarily turned off. We ran into a snag in the deployment, so this
</I>&gt;<i> downtime was extended, which resulted in the queues backlogging more than
</I>&gt;<i> we've had to do in the past.
</I>&gt;<i> 
</I>&gt;<i> At the time of the incident, both nodes were displaying the same behavior,
</I>&gt;<i> though anecdotally it appeared that one node was slightly more responsive
</I>&gt;<i> than the other. list_queues was timing out and our consumers (once brought
</I>&gt;<i> back up) were throwing connection timeout errors left and right. We also
</I>
Can you replay your deployment scenario (maybe not in production, of course) and check if 
you get the same problem? Alternatively, if I were to recreate an edge case of your 
scenario, I assume I'll need N producers sending messages with size=1K to the same queue 
(say amq.direct exchange, routing_key=foo) at aggregate rate 60 messages per second for 1 
hour without consuming, and the expected result is that broker will enter the bad state? 
What value corresponds to N in your situation?

Which version of rabbitmq were you running and on which erlang?

Did you have a chance to capture any system runtime info (netstat, tcpdump, etc) while 
this was happening?


&gt;<i> One thing to notice obviously is this isn't a very high workload, so we are
</I>&gt;<i> pretty perplexed why things basically died after our queue backed up for an
</I>&gt;<i> hour. We managed to fix the problem by basically purging the two larger
</I>&gt;<i> queues (after several attempts), and things basically snapped out of it.
</I>So you drained the queues by attaching a consumer to them? Did you restart brokers?

Also wondering if anybody on the list observed something similar, not necessarily in EC2.

- Dmitriy





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002426.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
	<LI>Next message: <A HREF="002431.html">[rabbitmq-discuss] RabbitMQ timing out under small load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2429">[ date ]</a>
              <a href="thread.html#2429">[ thread ]</a>
              <a href="subject.html#2429">[ subject ]</a>
              <a href="author.html#2429">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
