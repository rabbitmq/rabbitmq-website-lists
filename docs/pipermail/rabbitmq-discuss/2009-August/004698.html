<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] direct queue throughput
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=15FDFBBA-B8E0-4FBD-BBA1-7BC516A46CD4%40mac.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004718.html">
   <LINK REL="Next"  HREF="004704.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] direct queue throughput</H1>
    <B>Charity Majors</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=15FDFBBA-B8E0-4FBD-BBA1-7BC516A46CD4%40mac.com"
       TITLE="[rabbitmq-discuss] direct queue throughput">charity at lindenlab.com
       </A><BR>
    <I>Sat Aug 29 00:34:47 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004718.html">[rabbitmq-discuss] direct queue throughput
</A></li>
        <LI>Next message: <A HREF="004704.html">[rabbitmq-discuss] Is RabbitMQ indeed &quot;hype ware&quot;?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4698">[ date ]</a>
              <a href="thread.html#4698">[ thread ]</a>
              <a href="subject.html#4698">[ subject ]</a>
              <a href="author.html#4698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Whoops, sorry -- I'm not getting 7k msgs/sec through rabbitmq.  I'm
getting closer to *2k*/sec through rmq.

7k/sec is the mysql query count.  But we serialize the queries into
sequences and submit those sequences into the worker-jobs queue, to
better mimic the way the queries were originally executed.

&gt;<i> 1. RabbitMQ is written in Erlang. I am pretty sure the latest stable
</I>&gt;<i> releases are still a single-threaded process (though internally the
</I>&gt;<i> application uses hundreds or thousands of &quot;green&quot; threads). Therefore
</I>&gt;<i> you won't get much throughput increase by running on a larger multi-
</I>&gt;<i> core box.
</I>
Good to know.  The CPU load does seem awfully low.

&gt;<i> 3. Are you certain that your worker processes are keeping up? It's
</I>&gt;<i> possible you are only seeing 7k msgs/sec because your worker processes
</I>&gt;<i> aren't consuming them fast enough (ie. back pressure on the queue).
</I>
Yeah, I'm sure.  I can run rabbitmqctl list_queues and look at the
message counts, and the consumers are keeping the queues basically
clear.

&gt;<i> 4. It sounds odd that you have higher than 7k queries/sec in your
</I>&gt;<i> environment. Is your mysql system really capable of returning every
</I>&gt;<i> query within 140 microseconds? I'm probably just misunderstanding
</I>&gt;<i> something here so feel free to clarify what you mean by 7k queries/sec.
</I>
Yeah.  This wasn't really a problem until I started testing the SSDs.
With the SSDs and my current test setup, I can push the QPS up close
to 10k queries per second (according to innotop and my ganglia
graphs), and the box is still basically just yawning at me.  It's
still only using like 20% of the IO.

It's a nice problem to have, but still ... :)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004718.html">[rabbitmq-discuss] direct queue throughput
</A></li>
	<LI>Next message: <A HREF="004704.html">[rabbitmq-discuss] Is RabbitMQ indeed &quot;hype ware&quot;?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4698">[ date ]</a>
              <a href="thread.html#4698">[ thread ]</a>
              <a href="subject.html#4698">[ subject ]</a>
              <a href="author.html#4698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
