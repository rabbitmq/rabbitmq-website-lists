<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with multiple subscribers on the same	queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20subscribers%20on%20the%20same%0A%09queue&In-Reply-To=4A929CEE.8030201%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004645.html">
   <LINK REL="Next"  HREF="004649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with multiple subscribers on the same	queue</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20subscribers%20on%20the%20same%0A%09queue&In-Reply-To=4A929CEE.8030201%40lshift.net"
       TITLE="[rabbitmq-discuss] Problem with multiple subscribers on the same	queue">0x6e6562 at gmail.com
       </A><BR>
    <I>Mon Aug 24 15:00:08 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004645.html">[rabbitmq-discuss] RabbitMQ version 1.7
</A></li>
        <LI>Next message: <A HREF="004649.html">[rabbitmq-discuss] Problem with multiple subscribers on the	same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4646">[ date ]</a>
              <a href="thread.html#4646">[ thread ]</a>
              <a href="subject.html#4646">[ subject ]</a>
              <a href="author.html#4646">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Frank,

Sorry about the late response of your mail.

Boisson, Franck wrote:
&gt;<i> I have an exchange, let&#8217;s say &#8220;marketdata.test.command&#8221; and a queue name
</I>&gt;<i> &#8220;marketdata.test#RPC&#8221;.
</I>&gt;<i>
</I>&gt;<i> Queue &#8220;marketdata.test#RPC&#8221; is binded to &#8220;marketdata.test.command&#8221;
</I>&gt;<i> exchange through &#8220;subscribe&#8221; key.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have severals subscribers (which, in my case, are
</I>&gt;<i> data-producers)listening to &#8220;marketdata.test#RPC&#8221; queue and each time a
</I>&gt;<i> message is sent on this queue, one of the producer take it as a
</I>&gt;<i> subscriber request.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My problem appears when a data-producer can handle only a given type of
</I>&gt;<i> product. In this case, if it is the first joined to subscribe to a A
</I>&gt;<i> product, and if it does not support this product, it should be able to
</I>&gt;<i> requeue the message in order to join another data-producer (which could
</I>&gt;<i> be able to handle the request).
</I>&gt;<i>
</I>&gt;<i> The simple way I was seeing was to reject the message when it arrive on
</I>&gt;<i> A (basic.Reject) but I see that RabbitMQ do not support it yet.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do you have a solution for my case?
</I>
There are couple of ways around this:

- When a consumer decides that it can't process a message, it could
publish it back to an alternate exchange that has no binding to a queue
that this consumer would read from. After re-publishing the message,
this consumer would acknowledge the message so that it is gone from the
original queue. Whilst this would straight forward to implement, it is a
bit of hack and increases the amount of orchestration you'd have to do
in total;

- You could set up more judicious bindings so that the type of message
exposed in the routing key or a message header and then bind queues
based on this predicate. If you were to use a topic exchange, you could
publish with routing keys that indicate what type of message it is, e.g.
&quot;product.A&quot;, &quot;product.B&quot;, etc. Consumers would then be as exact as then
can when setting up bindings to their queues. A consumer that could only
process type B messages would bind with &quot;product.B&quot; and an omnivorous
consumer would bind with &quot;product.*&quot;. The same can be achieved with a
headers exchange. You could put the message type into a header field and
then set up a routing rule that only binds on a particular message type.
Both approaches are similar.

That would get you out of the woods, but there may be some things you
might want to consider, such as:

- Be aware that both topic exchanges and headers exchanges incur a
linear scan of all the bindings. If this is an issue for you, you might
have to put some effort into more sophisticated direct exchange bindings;

- At any stage of the game, for whatever reason (e.g. a bug in your
setup), you will *invariably* receive a message you cannot process and
you will have to think about some kind of catch all error handling,
either by reposting to an exception queue or just logging the bad
message and discarding it;

&gt;<i>
</I>&gt;<i> Do you have a release date for the basic.reject feature?
</I>
No, we don't. This is due to the fact that up until now, very few have
asked for this feature, so it has been deprioritized over other
features. Also, it is slightly tricky to implement because it is a
stateful command. Having said that, I myself encountered a scenario
recently on a customer project where this would have been very handy :-(


BTW would you be OK with with taking this topic onto the public
discussion forum as other people might be interested in it too?

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004645.html">[rabbitmq-discuss] RabbitMQ version 1.7
</A></li>
	<LI>Next message: <A HREF="004649.html">[rabbitmq-discuss] Problem with multiple subscribers on the	same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4646">[ date ]</a>
              <a href="thread.html#4646">[ thread ]</a>
              <a href="subject.html#4646">[ subject ]</a>
              <a href="author.html#4646">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
