<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] One queue and several subscribers,	load 	balancing (using ... rabbitmq + txamqp + python)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20One%20queue%20and%20several%20subscribers%2C%0A%09load%20%09balancing%20%28using%20...%20rabbitmq%20%2B%20txamqp%20%2B%20python%29&In-Reply-To=F52DC5EE-AB98-4FC5-A2B5-5BD44E1DDE4C%40iinet.net.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004495.html">
   <LINK REL="Next"  HREF="004497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] One queue and several subscribers,	load 	balancing (using ... rabbitmq + txamqp + python)</H1>
    <B>Darien Kindlund</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20One%20queue%20and%20several%20subscribers%2C%0A%09load%20%09balancing%20%28using%20...%20rabbitmq%20%2B%20txamqp%20%2B%20python%29&In-Reply-To=F52DC5EE-AB98-4FC5-A2B5-5BD44E1DDE4C%40iinet.net.au"
       TITLE="[rabbitmq-discuss] One queue and several subscribers,	load 	balancing (using ... rabbitmq + txamqp + python)">darien at kindlund.com
       </A><BR>
    <I>Thu Aug 13 02:47:03 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004495.html">[rabbitmq-discuss] One queue and several subscribers,	load balancing (using ... rabbitmq + txamqp + python)
</A></li>
        <LI>Next message: <A HREF="004497.html">[rabbitmq-discuss] One queue and several subscribers,	load  balancing (using ... rabbitmq + txamqp + python)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dale,
RabbitMQ v1.6.0 rolled out a &quot;prefetch&quot; (or window size?) option,
which allows you to specify how many messages should be cached per
consumer upon subscribe.  To accomplish your goal, simply set that
attribute to 1, when declaring and subscribing to the queue.  I'm not
familiar with txAMQP, but it should support this feature.  Others more
knowledgeable in txAMQP can provide example code; all I can tell you
is that the feature exists on the server.
-- Darien

On Wed, Aug 12, 2009 at 8:47 PM, Dale&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dale.obrien at iinet.net.au</A>&gt; wrote:
&gt;<i> Is it possible to load balance messages, using one queue and several
</I>&gt;<i> consumers ?
</I>&gt;<i>
</I>&gt;<i> So, for example, given 1 queue and 2 consumers;
</I>&gt;<i> &#160; &#160; &#160; &#160;1) a publisher sends 10 messages to the queue
</I>&gt;<i> &#160; &#160; &#160; &#160;2) for each consumer;
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;a) receive just 1 message at time
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;b) &#160;processes it, which takes an arbitrary amount of time (say,
</I>&gt;<i> between a few seconds and a few minutes)
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;c) &#160;once processed, repeat from (a)
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;Thus, if 1 consumer is tens time slower than the other, it will
</I>&gt;<i> process only 1 message while the other consumer will have processed
</I>&gt;<i> the remaining 9 messages.
</I>&gt;<i>
</I>&gt;<i> I guess this scenario is like a queue of jobs which are processed by
</I>&gt;<i> the next available worker (consumer).
</I>&gt;<i>
</I>&gt;<i> However, &#160;it appears that txamqp will cache the messages, e.g. each
</I>&gt;<i> consumer will always get 5 messages each.
</I>&gt;<i> So, to get the kind of the behavior I want, for each consumer I do;
</I>&gt;<i> &#160; &#160; &#160; &#160;a) send a basic_ack(...) on the first msg, so acknowledge just the
</I>&gt;<i> first message txamqp yields
</I>&gt;<i> &#160; &#160; &#160; &#160;b) ignore any other messages tzamqp may have queued up
</I>&gt;<i> &#160; &#160; &#160; &#160;b) send a basic_recover(True), so that rabbitmq will redistributing
</I>&gt;<i> the remaining messages to all consumers
</I>&gt;<i>
</I>&gt;<i> However, this method doesn't seem right to me. &#160;I'm worried it will;
</I>&gt;<i> &#160; &#160; &#160; &#160;a) create a lot of unwanted AMQP traffic
</I>&gt;<i> &#160; &#160; &#160; &#160;b) will occasionally allow the one message to be received by two or
</I>&gt;<i> more consumers,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;e.g. one consumer might send a basic_recover(...) just before
</I>&gt;<i> another consumer is about to acknowledge it's received message.
</I>&gt;<i>
</I>&gt;<i> So is there a way to only get one message at a time for a given queue
</I>&gt;<i> for a given consumer ?
</I>&gt;<i>
</I>&gt;<i> Any help is much appreciated.
</I>&gt;<i> Thanks
</I>&gt;<i> Dale
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004495.html">[rabbitmq-discuss] One queue and several subscribers,	load balancing (using ... rabbitmq + txamqp + python)
</A></li>
	<LI>Next message: <A HREF="004497.html">[rabbitmq-discuss] One queue and several subscribers,	load  balancing (using ... rabbitmq + txamqp + python)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
