<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Using%20rabbitmq-http2%20%28was%3A%20simple.publish%0A%20over%20the%20JSON%20RPC%20interface%29&In-Reply-To=65a6e3960908101411y14d8bbabnf7d3557bc06fedff%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004466.html">
   <LINK REL="Next"  HREF="004474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Using%20rabbitmq-http2%20%28was%3A%20simple.publish%0A%20over%20the%20JSON%20RPC%20interface%29&In-Reply-To=65a6e3960908101411y14d8bbabnf7d3557bc06fedff%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)">tonyg at lshift.net
       </A><BR>
    <I>Tue Aug 11 12:19:31 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004466.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
        <LI>Next message: <A HREF="004474.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4468">[ date ]</a>
              <a href="thread.html#4468">[ thread ]</a>
              <a href="subject.html#4468">[ subject ]</a>
              <a href="author.html#4468">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nathan Gray wrote:
&gt;&gt;<i>  1. the &quot;session&quot; timeout.
</I>&gt;&gt;<i>  2. a per-method-call timeout
</I>&gt;<i> Ok, so if you set timeout 1 bigger than timeout 2 you get trouble,
</I>&gt;<i> unless there's something else keeping the channel alive.
</I>
Hmm. There are two kinds of trouble:

 - the session closing when you want it kept open

 - individual blocking operations timing out, perhaps because the
   server is slow, or whatever other reason

To avoid the session closing, you have to poke it every
sessionTimeout-minus-epsilon. To avoid individual blocking operation
timeouts, you have to either make the server not take forever or set the
x-json-rpc-timeout longer.

Where they interact is in the case of the long-poll. The AMQP channel
object is set to deliberately not answer poll() requests until
sessionTimeout/2 has elapsed -- giving long-polling behaviour -- so in
the case of the poll() method, you want the x-json-rpc-timeout header to
let the operation take *at least* as long as sessionTimeout/2.

I did it that way because it's nice and simple, has fairly predictable
behaviour, and generally seemed like a reasonable first approach. Is
there a better way of doing it?

So in summary:

 - poll()'s request timeout needs to be sessionTimeout/2 + epsilon

 - blocking operation timeouts should be under user control but
   some reasonable default should exist

 - sessionTimeout should be under user control, but values less than
   about a minute are probably not a good idea, especially once the
   number of connections goes up? We haven't good data here.

... and of course I still need to make the changes we discussed
yesterday :-)

Cheers,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004466.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
	<LI>Next message: <A HREF="004474.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4468">[ date ]</a>
              <a href="thread.html#4468">[ thread ]</a>
              <a href="subject.html#4468">[ subject ]</a>
              <a href="author.html#4468">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
