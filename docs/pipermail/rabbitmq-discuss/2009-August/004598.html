<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Broker failover
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Broker%20failover&In-Reply-To=c4f7626d0908190706x6cbe48d1j235a06aeb031bf18%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004597.html">
   <LINK REL="Next"  HREF="004599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Broker failover</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Broker%20failover&In-Reply-To=c4f7626d0908190706x6cbe48d1j235a06aeb031bf18%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Broker failover">matthew at lshift.net
       </A><BR>
    <I>Wed Aug 19 15:41:59 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004597.html">[rabbitmq-discuss] Broker failover
</A></li>
        <LI>Next message: <A HREF="004599.html">[rabbitmq-discuss] Broker failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4598">[ date ]</a>
              <a href="thread.html#4598">[ thread ]</a>
              <a href="subject.html#4598">[ subject ]</a>
              <a href="author.html#4598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Niko,

On Wed, Aug 19, 2009 at 03:06:50PM +0100, Niko Felger wrote:
&gt;<i> Are there any best practices how to achieve broker failover?
</I>&gt;<i> 
</I>&gt;<i> We are currently using two clustered nodes with durable queues and
</I>&gt;<i> exchanges. The clients are configured to connect to the first node. In the
</I>&gt;<i> event that this node dies, I would like both existing consumers as well as
</I>&gt;<i> newly started ones to connect to the other node. Are there standard patterns
</I>&gt;<i> or recipies to achieve this?
</I>
There's nothing standard just yet, but we're getting a lot of interest
in this area and are working on solutions. Just at the moment the
situation is as follows:

Due to the way mnesia works, you can't just transfer the files from one
machine to another and start the broker up. To make this work, both
machines must have the same hostname as mnesia records this in the
database. To solve this, you can just use the nodename of
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost.</A> However, this prevents you doing clustering, which is
a shame.

Therefore, if HA and failover is important to you, we'd recommend the
following:

1) Put a simple TCP/IP load balancer in front of the nodes of rabbits,
but do this only for producers. The load balancer needs to be able to
dynamically cope with nodes going down, reappearing etc.
2) For consumers you really want them to all try and consume from all
the nodes at the same time. They also need to be able to silently cope
with nodes going down and reappearing. Obviously the exact details of
this vary between application.
3) Have a SAN with some shared storage which is not partitioned. All the
rabbit nodes need access to this.
4) Use Linux-HA or equiv to do monitoring of your rabbit nodes, and
start up all the brokers with the nodename of <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>

Now, when a node fails, Linux-HA will notice, and should tell a spare
node to start up, setting the RABBITMQ_MNESIA_DIR to the location on the
SAN of the files for the failed node. It should all just start up.

Obviously, this depends on the reliability and availability of your SAN,
and the drawbacks of not having clustering available complicate at least
consumers. However, if HA and failover is more important then this may
be a tradeoff you're willing to make just at the moment.

Also, be aware that with this solution, non persistent messages can be
lost as a node goes down, and even persistent messages which are not
part of a transaction can also be lost.

Needless to say, a more comprehensive solution is on our TODO list, but
may be a little way off just at the moment.

I hope this helps,

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004597.html">[rabbitmq-discuss] Broker failover
</A></li>
	<LI>Next message: <A HREF="004599.html">[rabbitmq-discuss] Broker failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4598">[ date ]</a>
              <a href="thread.html#4598">[ thread ]</a>
              <a href="subject.html#4598">[ subject ]</a>
              <a href="author.html#4598">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
