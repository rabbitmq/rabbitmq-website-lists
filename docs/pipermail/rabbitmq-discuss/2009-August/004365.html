<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd:  Erlang client: Future of lib_amqp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20%20Erlang%20client%3A%20Future%20of%20lib_amqp&In-Reply-To=E548ED85-C5E6-4B08-92E0-0FFB72270FD0%40epicadvertising.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004374.html">
   <LINK REL="Next"  HREF="004371.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd:  Erlang client: Future of lib_amqp</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20%20Erlang%20client%3A%20Future%20of%20lib_amqp&In-Reply-To=E548ED85-C5E6-4B08-92E0-0FFB72270FD0%40epicadvertising.com"
       TITLE="[rabbitmq-discuss] Fwd:  Erlang client: Future of lib_amqp">0x6e6562 at gmail.com
       </A><BR>
    <I>Wed Aug  5 14:51:10 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004374.html">[rabbitmq-discuss] &quot;Unable to write data to the transport	connection: An established connection was aborted by the	software in your host machine.&quot;
</A></li>
        <LI>Next message: <A HREF="004371.html">[rabbitmq-discuss] Python library (py-amqplib)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4365">[ date ]</a>
              <a href="thread.html#4365">[ thread ]</a>
              <a href="subject.html#4365">[ subject ]</a>
              <a href="author.html#4365">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>---------- Forwarded message ----------
From: Scott Brooks &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.brooks at epicadvertising.com</A>&gt;
Date: Wed, Aug 5, 2009 at 2:09 PM
Subject: Re: [rabbitmq-discuss] Erlang client: Future of lib_amqp
To: Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt;


Yeah, there are valid reasons on either side. &#160;It would be nice to
have an interface to program against so if the records changed, it
wouldn't really matter.

Either way once the first real release is out there, there should be a
relatively stable interface.

I've got some patches for the rabbitmq-c library that I'll clean up
and send along.

Thanks
Scott


On 4-Aug-09, at 6:28 PM, Ben Hood wrote:

&gt;<i> Scott,
</I>&gt;<i>
</I>&gt;<i> On Tue, Aug 4, 2009 at 3:23 PM, Scott
</I>&gt;<i> Brooks&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.brooks at epicadvertising.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The main feature I saw when using lib_amqp was a constant interface that
</I>&gt;&gt;<i> divorced the rest of the apps from the rabbitmq server. &#160;That way I didn't
</I>&gt;&gt;<i> need to include the rabbit hrl's into the rest of my app, I just used the
</I>&gt;&gt;<i> interface exposed by lib_amqp.
</I>&gt;<i>
</I>&gt;<i> On the subject on being able to include header files in a more
</I>&gt;<i> convenient way, I have to agree. Since R12B-5 you can load code from
</I>&gt;<i> archives, unfortunately the same doesn't apply for header files.
</I>&gt;<i>
</I>&gt;<i> However, I don't think avoiding the need to set the include path in a
</I>&gt;<i> make file is sufficient justification to wrap records with functions.
</I>&gt;<i>
</I>&gt;<i> lib_amqp has the tendency to cover over the expressiveness of Erlang's
</I>&gt;<i> record and pattern matching syntax. This is even more apparent with a
</I>&gt;<i> command structured protocol like AMQP.
</I>&gt;<i>
</I>&gt;&gt;<i> I've attached a rough patch that expands on it a bit to be able to adjust
</I>&gt;&gt;<i> the defaults when defining a queue, and exchange.
</I>&gt;<i>
</I>&gt;<i> Thanks for the patch, I've seen what you've tried to achieve, but it
</I>&gt;<i> would be inconsistent of me to accept it and still stand behind what I
</I>&gt;<i> said above :-) Because the codegen now generates sensible defaults, I
</I>&gt;<i> think the plain jane Erlang syntax is most concise way to override
</I>&gt;<i> defaults. For example, the default exchange type is the direct
</I>&gt;<i> exchange, so declaring a direct exchange looks like this in the lower
</I>&gt;<i> API:
</I>&gt;<i>
</I>&gt;<i> amqp_channel:call(Pid, #'exchange.declare'{exchange = &lt;&lt;&quot;foo&quot;&gt;&gt;})
</I>&gt;<i>
</I>&gt;<i> If you need this exchange to be a topic exchange, it would look like:
</I>&gt;<i>
</I>&gt;<i> amqp_channel:call(Pid, #'exchange.declare'{exchange = &lt;&lt;&quot;foo&quot;&gt;&gt;, type
</I>&gt;<i> = &lt;&lt;&quot;topic&quot;&gt;&gt;})
</I>&gt;<i>
</I>&gt;<i> lib_amqp shortened this to:
</I>&gt;<i>
</I>&gt;<i> lib_amqp:declare_exchange(Pid, &lt;&lt;&quot;foo&quot;&gt;&gt;, &lt;&lt;&quot;topic&quot;&gt;&gt;)
</I>&gt;<i>
</I>&gt;<i> Which is not that much shorter. Furthermore, this is the shortest
</I>&gt;<i> variant - as soon as you want to set other flags on the
</I>&gt;<i> exchange.declare command, the arity of the necessary overloads grows
</I>&gt;<i> considerably which in turn reduces clarity. Basic.Publish is probably
</I>&gt;<i> the best example of this.
</I>&gt;<i>
</I>&gt;<i> Also, when reading somebody else's code, it is immediately apparent
</I>&gt;<i> what each variable means.
</I>&gt;<i>
</I>&gt;<i> A counterexample in lib_amqp is bind_queue. Who remenbers off by heart
</I>&gt;<i> what order the parameters (routing key, exchange and queue) are
</I>&gt;<i> supposed to be passed in?
</I>&gt;<i>
</I>&gt;<i> Anyway, thanks again for the patch, please don't get discouraged by
</I>&gt;<i> the judgement of this particular matter, so keep them coming because
</I>&gt;<i> we are interested in popular usage patterns.
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Ben
</I>
---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.brooks at epicadvertising.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004374.html">[rabbitmq-discuss] &quot;Unable to write data to the transport	connection: An established connection was aborted by the	software in your host machine.&quot;
</A></li>
	<LI>Next message: <A HREF="004371.html">[rabbitmq-discuss] Python library (py-amqplib)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4365">[ date ]</a>
              <a href="thread.html#4365">[ thread ]</a>
              <a href="subject.html#4365">[ subject ]</a>
              <a href="author.html#4365">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
