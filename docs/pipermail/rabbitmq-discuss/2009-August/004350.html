<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang client: Future of lib_amqp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%3A%20Future%20of%20lib_amqp&In-Reply-To=82B554A0-F607-41F1-AC8F-5AEAD32BBCC1%40epicadvertising.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004388.html">
   <LINK REL="Next"  HREF="004352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang client: Future of lib_amqp</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%3A%20Future%20of%20lib_amqp&In-Reply-To=82B554A0-F607-41F1-AC8F-5AEAD32BBCC1%40epicadvertising.com"
       TITLE="[rabbitmq-discuss] Erlang client: Future of lib_amqp">0x6e6562 at gmail.com
       </A><BR>
    <I>Tue Aug  4 23:28:35 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004388.html">[rabbitmq-discuss] Issue in Java client while fetching channel
</A></li>
        <LI>Next message: <A HREF="004352.html">[rabbitmq-discuss] rabbitmq-server halting with	rabbit_sasl_report_file_h crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4350">[ date ]</a>
              <a href="thread.html#4350">[ thread ]</a>
              <a href="subject.html#4350">[ subject ]</a>
              <a href="author.html#4350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Scott,

On Tue, Aug 4, 2009 at 3:23 PM, Scott
Brooks&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">scott.brooks at epicadvertising.com</A>&gt; wrote:
&gt;<i> The main feature I saw when using lib_amqp was a constant interface that
</I>&gt;<i> divorced the rest of the apps from the rabbitmq server. &#160;That way I didn't
</I>&gt;<i> need to include the rabbit hrl's into the rest of my app, I just used the
</I>&gt;<i> interface exposed by lib_amqp.
</I>
On the subject on being able to include header files in a more
convenient way, I have to agree. Since R12B-5 you can load code from
archives, unfortunately the same doesn't apply for header files.

However, I don't think avoiding the need to set the include path in a
make file is sufficient justification to wrap records with functions.

lib_amqp has the tendency to cover over the expressiveness of Erlang's
record and pattern matching syntax. This is even more apparent with a
command structured protocol like AMQP.

&gt;<i> I've attached a rough patch that expands on it a bit to be able to adjust
</I>&gt;<i> the defaults when defining a queue, and exchange.
</I>
Thanks for the patch, I've seen what you've tried to achieve, but it
would be inconsistent of me to accept it and still stand behind what I
said above :-) Because the codegen now generates sensible defaults, I
think the plain jane Erlang syntax is most concise way to override
defaults. For example, the default exchange type is the direct
exchange, so declaring a direct exchange looks like this in the lower
API:

amqp_channel:call(Pid, #'exchange.declare'{exchange = &lt;&lt;&quot;foo&quot;&gt;&gt;})

If you need this exchange to be a topic exchange, it would look like:

amqp_channel:call(Pid, #'exchange.declare'{exchange = &lt;&lt;&quot;foo&quot;&gt;&gt;, type
= &lt;&lt;&quot;topic&quot;&gt;&gt;})

lib_amqp shortened this to:

lib_amqp:declare_exchange(Pid, &lt;&lt;&quot;foo&quot;&gt;&gt;, &lt;&lt;&quot;topic&quot;&gt;&gt;)

Which is not that much shorter. Furthermore, this is the shortest
variant - as soon as you want to set other flags on the
exchange.declare command, the arity of the necessary overloads grows
considerably which in turn reduces clarity. Basic.Publish is probably
the best example of this.

Also, when reading somebody else's code, it is immediately apparent
what each variable means.

A counterexample in lib_amqp is bind_queue. Who remenbers off by heart
what order the parameters (routing key, exchange and queue) are
supposed to be passed in?

Anyway, thanks again for the patch, please don't get discouraged by
the judgement of this particular matter, so keep them coming because
we are interested in popular usage patterns.

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004388.html">[rabbitmq-discuss] Issue in Java client while fetching channel
</A></li>
	<LI>Next message: <A HREF="004352.html">[rabbitmq-discuss] rabbitmq-server halting with	rabbit_sasl_report_file_h crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4350">[ date ]</a>
              <a href="thread.html#4350">[ thread ]</a>
              <a href="subject.html#4350">[ subject ]</a>
              <a href="author.html#4350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
