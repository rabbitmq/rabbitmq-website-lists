<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] questions about distributed queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20questions%20about%20distributed%20queue&In-Reply-To=167204d20908171132m71c3e7b0t3d6e016ae96f3a6d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004564.html">
   <LINK REL="Next"  HREF="004572.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] questions about distributed queue</H1>
    <B>Paul Dix</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20questions%20about%20distributed%20queue&In-Reply-To=167204d20908171132m71c3e7b0t3d6e016ae96f3a6d%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] questions about distributed queue">paul at pauldix.net
       </A><BR>
    <I>Mon Aug 17 20:36:03 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004564.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
        <LI>Next message: <A HREF="004572.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4565">[ date ]</a>
              <a href="thread.html#4565">[ thread ]</a>
              <a href="subject.html#4565">[ subject ]</a>
              <a href="author.html#4565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yeah, that's what I'm talking about. There will probably be upwards of
a few hundred producers and a few hundred consumers. The total ingress
is definitely what I'm most worried about right now. Later, memory may
be a concern, but hopefully the consumers are pulling so quickly that
the queue never gets extremely large.

Can you give me more specific details (or a pointer) to how the flow1,
flow2 thing work (both producer and consumer side)?

Thanks,
Paul

On Mon, Aug 17, 2009 at 2:32 PM, Alexis
Richardson&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>&gt; wrote:
&gt;<i> On Mon, Aug 17, 2009 at 5:22 PM, Paul Dix&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">paul at pauldix.net</A>&gt; wrote:
</I>&gt;&gt;<i> So what exactly does option 1 look like?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It sounds like it's possible to have a queue with the same id on two
</I>&gt;&gt;<i> different nodes bound to the same exchange.
</I>&gt;<i>
</I>&gt;<i> Not quite. &#160;Same routing - two queues, two ids. &#160;Actually now that I
</I>&gt;<i> think about it that won't give you exactly what you need. &#160;More below.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Will the exchange will
</I>&gt;&gt;<i> then round robin the messages to the two different queues? If so,
</I>&gt;&gt;<i> that's exactly what I'm looking for. I don't really care about order
</I>&gt;&gt;<i> on this queue.
</I>&gt;<i>
</I>&gt;<i> No it won't and that's why my suggestion was wrong.
</I>&gt;<i>
</I>&gt;<i> Round robin does occur when you have two consumers (clients) connected
</I>&gt;<i> to one queue. &#160;This WILL help you by draining the queue faster, if
</I>&gt;<i> memory is a limitation.
</I>&gt;<i>
</I>&gt;<i> If total ingress is the limitation you can increase that by splitting
</I>&gt;<i> the flow. &#160;Suppose you start with one queue bound once to one exchange
</I>&gt;<i> with key &quot;flow1&quot;. &#160;Then all messages with routing key flow1 will go to
</I>&gt;<i> that queue. &#160;When load is heavy, add a queue with key &quot;flow2&quot;, on a
</I>&gt;<i> second node. &#160;Then, alternate (if you prefer, randomly) between
</I>&gt;<i> routing keys flow1 and flow2. &#160;This will spread the load as you
</I>&gt;<i> require. &#160;And so on, for more queues.
</I>&gt;<i>
</I>&gt;<i> You can make this part of a load balancing layer on the server side,
</I>&gt;<i> so that clients don't have to be coded too much.
</I>&gt;<i>
</I>&gt;<i> Is this along the lines of what you need? &#160;Let me know, and I can elaborate.
</I>&gt;<i>
</I>&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Aug 17, 2009 at 10:55 AM, Alexis
</I>&gt;&gt;<i> Richardson&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Paul
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mon, Aug 17, 2009 at 3:34 PM, Paul Dix&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">paul at pauldix.net</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> Sorry for the confusion. I mean scalability on a single queue. Say I
</I>&gt;&gt;&gt;&gt;<i> want to push 20k messages per second through a single queue. If a
</I>&gt;&gt;&gt;&gt;<i> single node can't handle that it seems I'm out of luck. That is, if
</I>&gt;&gt;&gt;&gt;<i> I'm understanding how things work.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You can in principle just add more nodes to the cluster. &#160;More details below.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> So I guess I'm not worried about total queue size, but queue
</I>&gt;&gt;&gt;&gt;<i> throughput (although size may become an issue, I'm not sure). It seems
</I>&gt;&gt;&gt;&gt;<i> the solution is to split out across multiple queues, but I was hoping
</I>&gt;&gt;&gt;&gt;<i> to avoid that since it will add a layer of complexity to my producers
</I>&gt;&gt;&gt;&gt;<i> and consumers.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. To maximise throughput, don't use persistence. &#160;To make it bigger,
</I>&gt;&gt;&gt;<i> forget about ordering. &#160;So for example, you can easily have two
</I>&gt;&gt;&gt;<i> queues, one per node, subscribed to the same direct exchange with the
</I>&gt;&gt;&gt;<i> same key, and you ought to double throughput (assuming all other
</I>&gt;&gt;&gt;<i> things being equal and fair).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2. If you want to be both fast and 'reliable' (no loss of acked
</I>&gt;&gt;&gt;<i> messages), then add more queues and make them durable, and set
</I>&gt;&gt;&gt;<i> messages to be persistent.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 3. If you want to preserve ordering, label each message with an ID and
</I>&gt;&gt;&gt;<i> dedup at the endpoints. &#160;This does as you say, add some small noise to
</I>&gt;&gt;&gt;<i> your producers and consumers, but the above two options 1 and 2, do
</I>&gt;&gt;&gt;<i> not.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I don't think I understand how using Linux-HA with clustering would
</I>&gt;&gt;&gt;&gt;<i> lead to a splitting a single queue across multiple nodes. I'm not
</I>&gt;&gt;&gt;&gt;<i> familiar with HA, but it looked like it was a solution to provide a
</I>&gt;&gt;&gt;&gt;<i> replicated failover.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You are right that HA techniques, indeed any kind of queue replication
</I>&gt;&gt;&gt;<i> or replicated failover, will not help you here.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What you want is 'flow over' ie. &quot;when load is high, make a new node
</I>&gt;&gt;&gt;<i> with the same routing info&quot;. &#160;This is certainly doable.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> alexis
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Thanks again,
</I>&gt;&gt;&gt;&gt;<i> Paul
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On Mon, Aug 17, 2009 at 10:24 AM, Tony Garnock-Jones&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Paul Dix wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Do you have a roadmap for when a scalable queue
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> will be available?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> If by &quot;scalable&quot; you mean &quot;replicated&quot;, then that's available now, by
</I>&gt;&gt;&gt;&gt;&gt;<i> configuration along the lines I hinted at in my previous message. Adding
</I>&gt;&gt;&gt;&gt;&gt;<i> clustering into the mix can help increase capacity, on top of that (at a
</I>&gt;&gt;&gt;&gt;&gt;<i> certain cost in configuration complexity).
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> If instead you mean &quot;exceeding RAM+swap size&quot;, we're hoping to have that
</I>&gt;&gt;&gt;&gt;&gt;<i> for the 1.7 release -- which ought to be out within a month or so.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Just to give you a little more information on what I'm doing, I'm
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> building a live search/aggregation system. I'm hoping to push updates
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> of a constant internet crawl through the messaging system so workers
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> can analyze the content and build indexes as everything comes in.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Sounds pretty cool!
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Tony
</I>&gt;&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;&gt;<i> &#160;[][][] Tony Garnock-Jones &#160; &#160; | Mob: +44 (0)7905 974 211
</I>&gt;&gt;&gt;&gt;&gt;<i> &#160; [][] LShift Ltd &#160; &#160; &#160; &#160; &#160; &#160; | Tel: +44 (0)20 7729 7060
</I>&gt;&gt;&gt;&gt;&gt;<i> &#160;[] &#160;[] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004564.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
	<LI>Next message: <A HREF="004572.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4565">[ date ]</a>
              <a href="thread.html#4565">[ thread ]</a>
              <a href="subject.html#4565">[ subject ]</a>
              <a href="author.html#4565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
