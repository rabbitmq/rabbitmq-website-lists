<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] direct queue throughput
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=f7541d9c0908281516n3e6545c1m8cbe7cd611af7e0%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004695.html">
   <LINK REL="Next"  HREF="004697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] direct queue throughput</H1>
    <B>Chuck Remes</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=f7541d9c0908281516n3e6545c1m8cbe7cd611af7e0%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] direct queue throughput">cremes.devlist at mac.com
       </A><BR>
    <I>Fri Aug 28 23:38:58 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004695.html">[rabbitmq-discuss] direct queue throughput
</A></li>
        <LI>Next message: <A HREF="004697.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4696">[ date ]</a>
              <a href="thread.html#4696">[ thread ]</a>
              <a href="subject.html#4696">[ subject ]</a>
              <a href="author.html#4696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Aug 28, 2009, at 5:16 PM, Charity Majors wrote:

&gt;<i> Hi.  I'm working on a distributed load testing tool for mysql, where
</I>&gt;<i> we capture several hours worth of peak query load and replay the
</I>&gt;<i> queries against different db versions and configurations.  Rabbitmq is
</I>&gt;<i> the pipeline between the central aggregator process and the workers.
</I>&gt;<i>
</I>&gt;<i> I have (essentially) two queues set up, one for farming query
</I>&gt;<i> sequences out to workers and one for sending mysql return codes back
</I>&gt;<i> to the central.  Both queues are non-durable and use a direct
</I>&gt;<i> exchange.
</I>&gt;<i>
</I>&gt;<i> So far, so good.  But it's starting to look like this configuration
</I>&gt;<i> isn't fast enough to let me test SSDs.  Rabbitmq appears to top out at
</I>&gt;<i> a throughput rate of around 7k msgs/sec for the two queues.  Does that
</I>&gt;<i> number sound right?  The rate is the same whether I'm running on an 8
</I>&gt;<i> core box with 32 gigs of memory or a 4 core with 4 gigs.
</I>
I don't have an answer for you but I do have a few things to point out.

1. RabbitMQ is written in Erlang. I am pretty sure the latest stable  
releases are still a single-threaded process (though internally the  
application uses hundreds or thousands of &quot;green&quot; threads). Therefore  
you won't get much throughput increase by running on a larger multi- 
core box.

2. You don't really describe what kind of data stream the queues  
carry. A fanout exchange has higher throughput than a direct exchange  
since it does fewer routing checks. That may or may not be a more  
appropriate choice for you.

3. Are you certain that your worker processes are keeping up? It's  
possible you are only seeing 7k msgs/sec because your worker processes  
aren't consuming them fast enough (ie. back pressure on the queue).

4. It sounds odd that you have higher than 7k queries/sec in your  
environment. Is your mysql system really capable of returning every  
query within 140 microseconds? I'm probably just misunderstanding  
something here so feel free to clarify what you mean by 7k queries/sec.

I hope some of this is useful to you.

cr



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004695.html">[rabbitmq-discuss] direct queue throughput
</A></li>
	<LI>Next message: <A HREF="004697.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4696">[ date ]</a>
              <a href="thread.html#4696">[ thread ]</a>
              <a href="subject.html#4696">[ subject ]</a>
              <a href="author.html#4696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
