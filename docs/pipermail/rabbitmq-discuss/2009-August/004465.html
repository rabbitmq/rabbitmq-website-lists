<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Receiving Undelivered Persistent Messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Receiving%20Undelivered%20Persistent%20Messages&In-Reply-To=4e1b00700908100732y184ef1dap72d6109f77a8e4cc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004460.html">
   <LINK REL="Next"  HREF="004469.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Receiving Undelivered Persistent Messages</H1>
    <B>amit bhatnagar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Receiving%20Undelivered%20Persistent%20Messages&In-Reply-To=4e1b00700908100732y184ef1dap72d6109f77a8e4cc%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Receiving Undelivered Persistent Messages">brownspice at gmail.com
       </A><BR>
    <I>Mon Aug 10 21:30:50 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004460.html">[rabbitmq-discuss] Receiving Undelivered Persistent Messages
</A></li>
        <LI>Next message: <A HREF="004469.html">[rabbitmq-discuss] Receiving Undelivered Persistent Messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4465">[ date ]</a>
              <a href="thread.html#4465">[ thread ]</a>
              <a href="subject.html#4465">[ subject ]</a>
              <a href="author.html#4465">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vidit.

Check the consumer code. Probably a cut and paste error, but you are
creating the connection / channel and declaring the exchange and
bindings within the loop. This is probably what is causing you to
think you have received only one of the messages that is in the
queue.

On Aug 10, 8:32&#160;am, Vidit Drolia &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">viditdro... at gmail.com</A>&gt; wrote:
&gt;<i> Matthias,
</I>&gt;<i>
</I>&gt;<i> I am using RabbitMQ Java AMQP library ver. 1.6.0. PFA the scratch code
</I>&gt;<i> for the Consumer and Producer. You will have to pass in the username
</I>&gt;<i> and password as command line arguments.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Aug 10, 2009 at 4:16 AM, Matthias Radestock&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matth... at lshift.net</A>&gt; wrote:
</I>&gt;<i> &gt; Vidit,
</I>&gt;<i>
</I>&gt;<i> &gt; Vidit Drolia wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; When a consumer's channel is closed, then all unacknowledged messages
</I>&gt;<i> &gt;&gt; are still available in the queue for subsequent consumers. If there
</I>&gt;<i> &gt;&gt; are N messages in the queue when the last consumer died, then when a
</I>&gt;<i> &gt;&gt; new consumer fires up, 1 message is delivered when the consumer
</I>&gt;<i> &gt;&gt; requests for a message by subscription. That is to say, executing:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; while(true){
</I>&gt;<i> &gt;&gt; &#160;delivery = consumer.nextDelivery();
</I>&gt;<i> &gt;&gt; //do something...
</I>&gt;<i> &gt;&gt; //acknowledge for delivery
</I>&gt;<i> &gt;&gt; }
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; will deliver 1 message leaving N-1 messages in the queue. However,
</I>&gt;<i> &gt;&gt; after one execution of the above loop, the consumer keeps waiting for
</I>&gt;<i> &gt;&gt; the next delivery, even though there are N-1 messages in the queue. My
</I>&gt;<i> &gt;&gt; question was, is this supposed to happen by design of a subscription.
</I>&gt;<i>
</I>&gt;<i> &gt; No, that is not supposed to happen. If there are N messages in the queue and
</I>&gt;<i> &gt; you have one consumer connecting to it and consuming messages as you
</I>&gt;<i> &gt; describe then that consumer should receive all the messages.
</I>&gt;<i>
</I>&gt;<i> &gt; What client are you using? Can you post all the code to reproduce this?
</I>&gt;<i>
</I>&gt;<i> &gt; Regards,
</I>&gt;<i>
</I>&gt;<i> &gt; Matthias.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Vidit Drolia
</I>&gt;<i>
</I>&gt;<i> &#160;QueueConsumer.java
</I>&gt;<i> 3KViewDownload
</I>&gt;<i>
</I>&gt;<i> &#160;QueueProducer.java
</I>&gt;<i> 2KViewDownload
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttp</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004460.html">[rabbitmq-discuss] Receiving Undelivered Persistent Messages
</A></li>
	<LI>Next message: <A HREF="004469.html">[rabbitmq-discuss] Receiving Undelivered Persistent Messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4465">[ date ]</a>
              <a href="thread.html#4465">[ thread ]</a>
              <a href="subject.html#4465">[ subject ]</a>
              <a href="author.html#4465">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
