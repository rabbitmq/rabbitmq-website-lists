<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] is there a good way to upgrade my broker without losing messages?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20is%20there%20a%20good%20way%20to%20upgrade%20my%20broker%0A%20without%20losing%20messages%3F&In-Reply-To=4A7081CF.8020901%40acceleration.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004360.html">
   <LINK REL="Next"  HREF="004329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] is there a good way to upgrade my broker without losing messages?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20is%20there%20a%20good%20way%20to%20upgrade%20my%20broker%0A%20without%20losing%20messages%3F&In-Reply-To=4A7081CF.8020901%40acceleration.net"
       TITLE="[rabbitmq-discuss] is there a good way to upgrade my broker without losing messages?">matthias at lshift.net
       </A><BR>
    <I>Mon Aug  3 21:37:14 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004360.html">[rabbitmq-discuss] Erlang client: Future of lib_amqp
</A></li>
        <LI>Next message: <A HREF="004329.html">[rabbitmq-discuss] queue is locked exclusively
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4326">[ date ]</a>
              <a href="thread.html#4326">[ thread ]</a>
              <a href="subject.html#4326">[ subject ]</a>
              <a href="author.html#4326">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ryan,

Ryan Davis wrote:
&gt;<i> I'm currently running an older version of RabbitMQ (1.5.1) on windows,
</I>&gt;<i> using a single broker for my lightly-loaded system.  All
</I>&gt;<i> publishers/consumers are pointed to that broker.  I want to upgrade to
</I>&gt;<i> 1.6, but don't want to lose any messages.  I cannot turn off all
</I>&gt;<i> publishers (messages come from external sources).   I've read that the
</I>&gt;<i> db schema changes, and the old db essentially gets replaced.  This means
</I>&gt;<i> even durable messages will get discarded, right?
</I>
Yes, persistent messages would indeed get discarded.

However, the format of the message store (as opposed to the routing 
tables, etc) didn't actually change between 1.5.x and 1.6.0, so in 
theory it should be possible to do the following:

1) stop old rabbit version
2) move the rabbit_persister.LOG to a safe place
3) start new rabbit version
4) use some client code to re-create all the durable queues and exchanges
5) stop the new rabbit version
6) replace the fresh rabbit_persister.LOG with the old one
7) restart the new rabbit version

At that point the persisted messages should be available in their 
respective durable queues again, so your clients can connect and consume 
them.

&gt;<i> I've come up with a few ideas involving putting up another RabbitMQ
</I>&gt;<i> instance (point publishers at the new broker, let my consumers empty the
</I>&gt;<i> old broker, point consumers at the new broker), but I was wondering: is
</I>&gt;<i> there easier way to do it?
</I>
Arguably your suggestion is simpler than the above :) Plus it will work 
even when the message store format *has* changed. I know which one I'd 
choose ;)


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004360.html">[rabbitmq-discuss] Erlang client: Future of lib_amqp
</A></li>
	<LI>Next message: <A HREF="004329.html">[rabbitmq-discuss] queue is locked exclusively
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4326">[ date ]</a>
              <a href="thread.html#4326">[ thread ]</a>
              <a href="subject.html#4326">[ subject ]</a>
              <a href="author.html#4326">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
