<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20%2891MB%20message%20over%20STOMP%29%0A%09%5BReproducible%5D&In-Reply-To=50c8ffe90908090028j62dbedcat1bea5d7934a9ae1e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004449.html">
   <LINK REL="Next"  HREF="004452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20%2891MB%20message%20over%20STOMP%29%0A%09%5BReproducible%5D&In-Reply-To=50c8ffe90908090028j62dbedcat1bea5d7934a9ae1e%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]">matthias at lshift.net
       </A><BR>
    <I>Sun Aug  9 09:58:18 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004449.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
        <LI>Next message: <A HREF="004452.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4450">[ date ]</a>
              <a href="thread.html#4450">[ thread ]</a>
              <a href="subject.html#4450">[ subject ]</a>
              <a href="author.html#4450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Darien,

Darien Kindlund wrote:
&gt;<i> The perl code below will generate a ~96MB message and send it to
</I>&gt;<i> RabbitMQ via STOMP.  The exchange and destination need not even exist
</I>&gt;<i> on the server -- just as long as there's a valid vhost.  Once the
</I>&gt;<i> message is sent, RabbitMQ v1.6.0 will crash before the STOMP client
</I>&gt;<i> has a chance to even disconnect.
</I>
Thanks for the code. I can reproduce the problem, even for the minimal 
case of using the default exchange (thus ensuring no error occurs) and 
non-persistent messages, i.e.

$stomp-&gt;send({
      'destination'   =&gt; 'bar',
      'body'          =&gt; &quot;a&quot; x 100_000_000 . &quot;\n&quot;,
  });

I reckon the cause is some inefficiency in the way we process stomp 
bodies, causing the server to allocate far more memory than it ought to.

Shouldn't be too hard to track down and fix. Will do so hopefully this week.

Thanks again for your detailed bug report and constructing such a simple 
test case. Saves us a lot of time.


Regards,

Matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004449.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
	<LI>Next message: <A HREF="004452.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4450">[ date ]</a>
              <a href="thread.html#4450">[ thread ]</a>
              <a href="subject.html#4450">[ subject ]</a>
              <a href="author.html#4450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
