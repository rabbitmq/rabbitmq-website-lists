<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with multiple subscribers on the	same queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20subscribers%20on%20the%0A%09same%20queue&In-Reply-To=269388e30908240700u3cb8c779rf46e41301221b549%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004646.html">
   <LINK REL="Next"  HREF="004650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with multiple subscribers on the	same queue</H1>
    <B>Jason J. W. Williams</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20subscribers%20on%20the%0A%09same%20queue&In-Reply-To=269388e30908240700u3cb8c779rf46e41301221b549%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Problem with multiple subscribers on the	same queue">jasonjwwilliams at gmail.com
       </A><BR>
    <I>Mon Aug 24 15:49:52 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004646.html">[rabbitmq-discuss] Problem with multiple subscribers on the same	queue
</A></li>
        <LI>Next message: <A HREF="004650.html">[rabbitmq-discuss] Problem with multiple subscribers on the	same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4649">[ date ]</a>
              <a href="thread.html#4649">[ thread ]</a>
              <a href="subject.html#4649">[ subject ]</a>
              <a href="author.html#4649">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'll have to check our code but I think we handle this by not ack'ing  
the message. The ineffecient part is it may be reassigned to another  
consumer who also can't handle it.

-J

Sent via iPhone

On Aug 24, 2009, at 8:00, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:

&gt;<i> Frank,
</I>&gt;<i>
</I>&gt;<i> Sorry about the late response of your mail.
</I>&gt;<i>
</I>&gt;<i> Boisson, Franck wrote:
</I>&gt;&gt;<i> I have an exchange, let&#8217;s say &#8220;marketdata.test.command&#8221; and a  
</I>&gt;&gt;<i> queue name
</I>&gt;&gt;<i> &#8220;marketdata.test#RPC&#8221;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Queue &#8220;marketdata.test#RPC&#8221; is binded to &#8220;marketdata.test.comma 
</I>&gt;&gt;<i> nd&#8221;
</I>&gt;&gt;<i> exchange through &#8220;subscribe&#8221; key.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have severals subscribers (which, in my case, are
</I>&gt;&gt;<i> data-producers)listening to &#8220;marketdata.test#RPC&#8221; queue and each  
</I>&gt;&gt;<i> time a
</I>&gt;&gt;<i> message is sent on this queue, one of the producer take it as a
</I>&gt;&gt;<i> subscriber request.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My problem appears when a data-producer can handle only a given  
</I>&gt;&gt;<i> type of
</I>&gt;&gt;<i> product. In this case, if it is the first joined to subscribe to a A
</I>&gt;&gt;<i> product, and if it does not support this product, it should be able  
</I>&gt;&gt;<i> to
</I>&gt;&gt;<i> requeue the message in order to join another data-producer (which  
</I>&gt;&gt;<i> could
</I>&gt;&gt;<i> be able to handle the request).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The simple way I was seeing was to reject the message when it  
</I>&gt;&gt;<i> arrive on
</I>&gt;&gt;<i> A (basic.Reject) but I see that RabbitMQ do not support it yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you have a solution for my case?
</I>&gt;<i>
</I>&gt;<i> There are couple of ways around this:
</I>&gt;<i>
</I>&gt;<i> - When a consumer decides that it can't process a message, it could
</I>&gt;<i> publish it back to an alternate exchange that has no binding to a  
</I>&gt;<i> queue
</I>&gt;<i> that this consumer would read from. After re-publishing the message,
</I>&gt;<i> this consumer would acknowledge the message so that it is gone from  
</I>&gt;<i> the
</I>&gt;<i> original queue. Whilst this would straight forward to implement, it  
</I>&gt;<i> is a
</I>&gt;<i> bit of hack and increases the amount of orchestration you'd have to do
</I>&gt;<i> in total;
</I>&gt;<i>
</I>&gt;<i> - You could set up more judicious bindings so that the type of message
</I>&gt;<i> exposed in the routing key or a message header and then bind queues
</I>&gt;<i> based on this predicate. If you were to use a topic exchange, you  
</I>&gt;<i> could
</I>&gt;<i> publish with routing keys that indicate what type of message it is,  
</I>&gt;<i> e.g.
</I>&gt;<i> &quot;product.A&quot;, &quot;product.B&quot;, etc. Consumers would then be as exact as  
</I>&gt;<i> then
</I>&gt;<i> can when setting up bindings to their queues. A consumer that could  
</I>&gt;<i> only
</I>&gt;<i> process type B messages would bind with &quot;product.B&quot; and an omnivorous
</I>&gt;<i> consumer would bind with &quot;product.*&quot;. The same can be achieved with a
</I>&gt;<i> headers exchange. You could put the message type into a header field  
</I>&gt;<i> and
</I>&gt;<i> then set up a routing rule that only binds on a particular message  
</I>&gt;<i> type.
</I>&gt;<i> Both approaches are similar.
</I>&gt;<i>
</I>&gt;<i> That would get you out of the woods, but there may be some things you
</I>&gt;<i> might want to consider, such as:
</I>&gt;<i>
</I>&gt;<i> - Be aware that both topic exchanges and headers exchanges incur a
</I>&gt;<i> linear scan of all the bindings. If this is an issue for you, you  
</I>&gt;<i> might
</I>&gt;<i> have to put some effort into more sophisticated direct exchange  
</I>&gt;<i> bindings;
</I>&gt;<i>
</I>&gt;<i> - At any stage of the game, for whatever reason (e.g. a bug in your
</I>&gt;<i> setup), you will *invariably* receive a message you cannot process and
</I>&gt;<i> you will have to think about some kind of catch all error handling,
</I>&gt;<i> either by reposting to an exception queue or just logging the bad
</I>&gt;<i> message and discarding it;
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you have a release date for the basic.reject feature?
</I>&gt;<i>
</I>&gt;<i> No, we don't. This is due to the fact that up until now, very few have
</I>&gt;<i> asked for this feature, so it has been deprioritized over other
</I>&gt;<i> features. Also, it is slightly tricky to implement because it is a
</I>&gt;<i> stateful command. Having said that, I myself encountered a scenario
</I>&gt;<i> recently on a customer project where this would have been very  
</I>&gt;<i> handy :-(
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> BTW would you be OK with with taking this topic onto the public
</I>&gt;<i> discussion forum as other people might be interested in it too?
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Ben
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004646.html">[rabbitmq-discuss] Problem with multiple subscribers on the same	queue
</A></li>
	<LI>Next message: <A HREF="004650.html">[rabbitmq-discuss] Problem with multiple subscribers on the	same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4649">[ date ]</a>
              <a href="thread.html#4649">[ thread ]</a>
              <a href="subject.html#4649">[ subject ]</a>
              <a href="author.html#4649">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
