<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] direct queue throughput
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=f7541d9c0908281651g36073d79x561b99ea118ed2d3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004699.html">
   <LINK REL="Next"  HREF="004702.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] direct queue throughput</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=f7541d9c0908281651g36073d79x561b99ea118ed2d3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] direct queue throughput">matthew at lshift.net
       </A><BR>
    <I>Sat Aug 29 11:44:35 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004699.html">[rabbitmq-discuss] direct queue throughput
</A></li>
        <LI>Next message: <A HREF="004702.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4701">[ date ]</a>
              <a href="thread.html#4701">[ thread ]</a>
              <a href="subject.html#4701">[ subject ]</a>
              <a href="author.html#4701">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Charity,

On Fri, Aug 28, 2009 at 04:51:19PM -0700, Charity Majors wrote:
&gt;<i> We aren't acking at all.
</I>
Err, this seems odd. Do you mean that your consumers set noAck to true
when setting up the subscription to the queue? If you're not, and you're
not explicitly acking then Rabbit will be keeping a copy of the message
in memory all the time, because it won't discard messages until it
receives an ack from the consumer for the msg.

Are the queues durable and are the messages being published persistent
(delivery_mode = 2)? If so, this /may/ slow things down depending on
the nature of your consumers.

However, if a) cpu load is very low, and b) rabbitmqctl list_queues
shows that the queues are being kept empty, I rather suspect that
messages aren't getting in to Rabbit fast enough.

&gt;<i> Network load ... I would have to check on that.  But I don't think
</I>&gt;<i> that's the ceiling we're bumping up against.  I can run it with a null
</I>&gt;<i> plugin, so it just pushes the jobs through the rabbitmq queues and
</I>&gt;<i> fakes the mysql responses, and everything stays on the same box.  And
</I>&gt;<i> my throughput rate looks identical to the rates I see testing the
</I>&gt;<i> SSDs.
</I>
Yes, I think this backs up my theory - if a null consumer isn't going
any faster, then I would definitely point the finger at the producers.
How big are the messages you're sending? If you're all on the same box,
I find this a bit surprising - I can push above 400M*Bytes*/s over
localhost loopback to and from Rabbit.

First of all though, if you've got noAck false in the consumers then
you *must* explicitly ack messages. I'd correct that and then see where
you are.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004699.html">[rabbitmq-discuss] direct queue throughput
</A></li>
	<LI>Next message: <A HREF="004702.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4701">[ date ]</a>
              <a href="thread.html#4701">[ thread ]</a>
              <a href="subject.html#4701">[ subject ]</a>
              <a href="author.html#4701">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
