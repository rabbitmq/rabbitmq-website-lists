<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] direct queue throughput
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=BE40AB7E-4963-434F-BB33-6122C5637B5E%40mac.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004717.html">
   <LINK REL="Next"  HREF="004698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] direct queue throughput</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20direct%20queue%20throughput&In-Reply-To=BE40AB7E-4963-434F-BB33-6122C5637B5E%40mac.com"
       TITLE="[rabbitmq-discuss] direct queue throughput">matthew at lshift.net
       </A><BR>
    <I>Sun Aug 30 22:14:16 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004717.html">[rabbitmq-discuss] direct queue throughput
</A></li>
        <LI>Next message: <A HREF="004698.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4718">[ date ]</a>
              <a href="thread.html#4718">[ thread ]</a>
              <a href="subject.html#4718">[ subject ]</a>
              <a href="author.html#4718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chuck,

On Sun, Aug 30, 2009 at 03:13:26PM -0500, Chuck Remes wrote:
&gt;<i> I don't disbelieve you but in my testing I have never seen a rabbit  
</I>&gt;<i> process go above 100%. This is using Erlang 13B and the &quot;generic&quot; unix  
</I>&gt;<i> rabbitmq 1.5.5 under OSX. Perhaps the defaults disable SMP?
</I>
I don't think we're doing anything special under OS X to disable SMP
support.

<A HREF="http://developer.studivz.net/tag/erlang/">http://developer.studivz.net/tag/erlang/</A> has some information about
recent developments in the Erlang interpreter for SMP support.

It's possible that I'm overstating the contribution of SMP to Rabbit,
but I've definitely seen Rabbit use more than 1 CPU under Linux.

Just a quick test - 100 queues, one producer, default direct exchange,
fire in messages to every queue in turn. Output of top:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                               
29500 matthew   20   0  805m 542m 2284 S  203 13.7   1:23.53 beam.smp

and it sits there at &gt; 190% CPU for most of the test. This is on a
quad-core - one core is totally maxed out with the producer. Having run
this test for a little while, my load average is now sitting at 3.1,
which makes sense.

So no, we're not scaling linearly with the number of cores available,
and we will continue to try and improve this. But we definitely are
taking at least some advantage of parallel hardware. Without wishing to
bash OS X unnecessarily, it is known to fair badly in multithreaded
testing - I seem to recall a lot of multithreaded MySQL tests
demonstrating OS X really performs badly, due (hazy memory) to its
threads actually being quite heavy weight - IIRC, they took the
lightweight Mach threads, and wrapped round them several times, ending
up with something very heavy and performing badly. However, the reports
I'm thinking of definitely happened several years ago, and I wouldn't be
surpised if Apple have improved things since, assuming they took some
time out from polishing pretty buttons! ;)

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004717.html">[rabbitmq-discuss] direct queue throughput
</A></li>
	<LI>Next message: <A HREF="004698.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4718">[ date ]</a>
              <a href="thread.html#4718">[ thread ]</a>
              <a href="subject.html#4718">[ subject ]</a>
              <a href="author.html#4718">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
