<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Weird Crash - Recovery logic for durable	messages/queues/exchanges?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20-%20Recovery%20logic%20for%20durable%0A%09messages/queues/exchanges%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004428.html">
   <LINK REL="Next"  HREF="004412.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Weird Crash - Recovery logic for durable	messages/queues/exchanges?</H1>
    <B>Darien Kindlund</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20-%20Recovery%20logic%20for%20durable%0A%09messages/queues/exchanges%3F&In-Reply-To="
       TITLE="[rabbitmq-discuss] Weird Crash - Recovery logic for durable	messages/queues/exchanges?">darien at kindlund.com
       </A><BR>
    <I>Fri Aug  7 04:12:49 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004428.html">[rabbitmq-discuss] Problems cloning hg repository
</A></li>
        <LI>Next message: <A HREF="004412.html">[rabbitmq-discuss] Weird Crash - Recovery logic for	durable	messages/queues/exchanges?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4411">[ date ]</a>
              <a href="thread.html#4411">[ thread ]</a>
              <a href="subject.html#4411">[ subject ]</a>
              <a href="author.html#4411">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So after running RabbitMQ v1.6.0 for awhile, I've encountered a
strange crash, where the server unexpectedly dies with no crash report
or any applicable log information written to disk.  I'm trying to see
if I can replicate the issue, but in the meantime, when I recover the
server, it dutifully recovers all my messages, queues, exchanges, and
bindings (great!).  However, once the server recovers, all the durable
messages in the queues (from rabbitmqctl) are still marked as
*messages_unacknowledged&quot; -- not &quot;messages_ready&quot;... To my knowledge,
this means: &quot;RabbitMQ thinks there is already an AMQP channel and
connection open which already has these messages -- and is simply
waiting for an ACK back from this AMQP consumer.&quot;  ... The problem is:
when RabbitMQ recovers, all AMQP channels/connections are terminated,
so this assumption is clearly wrong (in this scenario).

I'm wondering if the &quot;persister recovery&quot; was designed so that when
RabbitMQ attempts to re-start up and sees that there was a crash -- if
it has built-in logic to essentially &quot;reset&quot; all durable messages in
the queues back to a &quot;ready&quot; state -- so that a new AMQP consumer can
process them.

So, my questions are:

1) Does such &quot;persister recovery&quot; logic exist? Or not?
2) Is there any recommended _manual_ way (via the erl shell?) to
perform this &quot;reset&quot;? ... or do I simply have to obliterate my
persister log and regenerate all my queues, exchanges, and bindings?

Regards,
-- Darien


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004428.html">[rabbitmq-discuss] Problems cloning hg repository
</A></li>
	<LI>Next message: <A HREF="004412.html">[rabbitmq-discuss] Weird Crash - Recovery logic for	durable	messages/queues/exchanges?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4411">[ date ]</a>
              <a href="thread.html#4411">[ thread ]</a>
              <a href="subject.html#4411">[ subject ]</a>
              <a href="author.html#4411">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
