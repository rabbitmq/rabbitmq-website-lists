<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] questions about distributed queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20questions%20about%20distributed%20queue&In-Reply-To=c0a615890908170922h3e73b73fhd915c3e731000ad9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004563.html">
   <LINK REL="Next"  HREF="004565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] questions about distributed queue</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20questions%20about%20distributed%20queue&In-Reply-To=c0a615890908170922h3e73b73fhd915c3e731000ad9%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] questions about distributed queue">alexis.richardson at gmail.com
       </A><BR>
    <I>Mon Aug 17 19:32:44 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004563.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
        <LI>Next message: <A HREF="004565.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4564">[ date ]</a>
              <a href="thread.html#4564">[ thread ]</a>
              <a href="subject.html#4564">[ subject ]</a>
              <a href="author.html#4564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Aug 17, 2009 at 5:22 PM, Paul Dix&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">paul at pauldix.net</A>&gt; wrote:
&gt;<i> So what exactly does option 1 look like?
</I>&gt;<i>
</I>&gt;<i> It sounds like it's possible to have a queue with the same id on two
</I>&gt;<i> different nodes bound to the same exchange.
</I>
Not quite.  Same routing - two queues, two ids.  Actually now that I
think about it that won't give you exactly what you need.  More below.


&gt;<i> Will the exchange will
</I>&gt;<i> then round robin the messages to the two different queues? If so,
</I>&gt;<i> that's exactly what I'm looking for. I don't really care about order
</I>&gt;<i> on this queue.
</I>
No it won't and that's why my suggestion was wrong.

Round robin does occur when you have two consumers (clients) connected
to one queue.  This WILL help you by draining the queue faster, if
memory is a limitation.

If total ingress is the limitation you can increase that by splitting
the flow.  Suppose you start with one queue bound once to one exchange
with key &quot;flow1&quot;.  Then all messages with routing key flow1 will go to
that queue.  When load is heavy, add a queue with key &quot;flow2&quot;, on a
second node.  Then, alternate (if you prefer, randomly) between
routing keys flow1 and flow2.  This will spread the load as you
require.  And so on, for more queues.

You can make this part of a load balancing layer on the server side,
so that clients don't have to be coded too much.

Is this along the lines of what you need?  Let me know, and I can elaborate.

alexis




&gt;<i> Thanks,
</I>&gt;<i> Paul
</I>&gt;<i>
</I>&gt;<i> On Mon, Aug 17, 2009 at 10:55 AM, Alexis
</I>&gt;<i> Richardson&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Mon, Aug 17, 2009 at 3:34 PM, Paul Dix&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">paul at pauldix.net</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Sorry for the confusion. I mean scalability on a single queue. Say I
</I>&gt;&gt;&gt;<i> want to push 20k messages per second through a single queue. If a
</I>&gt;&gt;&gt;<i> single node can't handle that it seems I'm out of luck. That is, if
</I>&gt;&gt;&gt;<i> I'm understanding how things work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can in principle just add more nodes to the cluster. &#160;More details below.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So I guess I'm not worried about total queue size, but queue
</I>&gt;&gt;&gt;<i> throughput (although size may become an issue, I'm not sure). It seems
</I>&gt;&gt;&gt;<i> the solution is to split out across multiple queues, but I was hoping
</I>&gt;&gt;&gt;<i> to avoid that since it will add a layer of complexity to my producers
</I>&gt;&gt;&gt;<i> and consumers.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. To maximise throughput, don't use persistence. &#160;To make it bigger,
</I>&gt;&gt;<i> forget about ordering. &#160;So for example, you can easily have two
</I>&gt;&gt;<i> queues, one per node, subscribed to the same direct exchange with the
</I>&gt;&gt;<i> same key, and you ought to double throughput (assuming all other
</I>&gt;&gt;<i> things being equal and fair).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. If you want to be both fast and 'reliable' (no loss of acked
</I>&gt;&gt;<i> messages), then add more queues and make them durable, and set
</I>&gt;&gt;<i> messages to be persistent.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3. If you want to preserve ordering, label each message with an ID and
</I>&gt;&gt;<i> dedup at the endpoints. &#160;This does as you say, add some small noise to
</I>&gt;&gt;<i> your producers and consumers, but the above two options 1 and 2, do
</I>&gt;&gt;<i> not.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I don't think I understand how using Linux-HA with clustering would
</I>&gt;&gt;&gt;<i> lead to a splitting a single queue across multiple nodes. I'm not
</I>&gt;&gt;&gt;<i> familiar with HA, but it looked like it was a solution to provide a
</I>&gt;&gt;&gt;<i> replicated failover.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You are right that HA techniques, indeed any kind of queue replication
</I>&gt;&gt;<i> or replicated failover, will not help you here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What you want is 'flow over' ie. &quot;when load is high, make a new node
</I>&gt;&gt;<i> with the same routing info&quot;. &#160;This is certainly doable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> alexis
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks again,
</I>&gt;&gt;&gt;<i> Paul
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mon, Aug 17, 2009 at 10:24 AM, Tony Garnock-Jones&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> Paul Dix wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Do you have a roadmap for when a scalable queue
</I>&gt;&gt;&gt;&gt;&gt;<i> will be available?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> If by &quot;scalable&quot; you mean &quot;replicated&quot;, then that's available now, by
</I>&gt;&gt;&gt;&gt;<i> configuration along the lines I hinted at in my previous message. Adding
</I>&gt;&gt;&gt;&gt;<i> clustering into the mix can help increase capacity, on top of that (at a
</I>&gt;&gt;&gt;&gt;<i> certain cost in configuration complexity).
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> If instead you mean &quot;exceeding RAM+swap size&quot;, we're hoping to have that
</I>&gt;&gt;&gt;&gt;<i> for the 1.7 release -- which ought to be out within a month or so.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Just to give you a little more information on what I'm doing, I'm
</I>&gt;&gt;&gt;&gt;&gt;<i> building a live search/aggregation system. I'm hoping to push updates
</I>&gt;&gt;&gt;&gt;&gt;<i> of a constant internet crawl through the messaging system so workers
</I>&gt;&gt;&gt;&gt;&gt;<i> can analyze the content and build indexes as everything comes in.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Sounds pretty cool!
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Tony
</I>&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;<i> &#160;[][][] Tony Garnock-Jones &#160; &#160; | Mob: +44 (0)7905 974 211
</I>&gt;&gt;&gt;&gt;<i> &#160; [][] LShift Ltd &#160; &#160; &#160; &#160; &#160; &#160; | Tel: +44 (0)20 7729 7060
</I>&gt;&gt;&gt;&gt;<i> &#160;[] &#160;[] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004563.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
	<LI>Next message: <A HREF="004565.html">[rabbitmq-discuss] questions about distributed queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4564">[ date ]</a>
              <a href="thread.html#4564">[ thread ]</a>
              <a href="subject.html#4564">[ subject ]</a>
              <a href="author.html#4564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
