<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering Issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Clustering%20Issue&In-Reply-To=4A98517C.5030402%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004693.html">
   <LINK REL="Next"  HREF="004695.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering Issue</H1>
    <B>Jorge Varona</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Clustering%20Issue&In-Reply-To=4A98517C.5030402%40lshift.net"
       TITLE="[rabbitmq-discuss] Clustering Issue">jvarona at attinteractive.com
       </A><BR>
    <I>Fri Aug 28 23:08:20 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004693.html">[rabbitmq-discuss] Clustering Issue
</A></li>
        <LI>Next message: <A HREF="004695.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4694">[ date ]</a>
              <a href="thread.html#4694">[ thread ]</a>
              <a href="subject.html#4694">[ subject ]</a>
              <a href="author.html#4694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mattias,

Thanks for the quick response. I understand that if the Server A dies
other nodes should be able to assume that the queue is dead as well. My
real concern is that the queue(s) are not distributed and the box that
carries the physical queue is a single point of failure. While the
current clustering helps load-balance read operations very well it
doesn't address durability and reliability concerns, which happen to be
important to my project. 

I guess my real question is if there are or will be efforts to
distribute the queues across physical nodes? I understand that this
implies locking, consensus, and a bunch of other things that could
hinder scale. If not, do you have any recommendations on how I could
provide a higher durability and fault-tolerance guarantees to my
consumers?

Jorge



-----Original Message-----
From: Matthias Radestock [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>] 
Sent: Friday, August 28, 2009 2:52 PM
To: Jorge Varona
Cc: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Clustering Issue

Jorge,

Jorge Varona wrote:
&gt;<i> I've noticed some issues with clustered boxes that are weird. For 
</I>&gt;<i> example, in a two-box cluster I have Client A sending messages to
</I>Server 
&gt;<i> A and Client B pulling messages from Server B. We already know that if
</I>
&gt;<i> we shut down Server A (it was first to declare a queue) messages stop 
</I>&gt;<i> being delivered to Server B and in turn Client B. The strange behavior
</I>
&gt;<i> I've noticed is that if I bring Server A back up and send messages to
</I>it 
&gt;<i> they are not relayed to Server B, which has Client B attached. Only 
</I>&gt;<i> after I restart Server B do messages begin to be relayed to Client B.
</I>
When node A dies, as far as B is concerned all the queues on A die too. 
If client B attempted a 'basic.get', or indeed any other operation on 
any of A's queues it would get a 'not_found' error.

BUT - and this is what you are seeing - there is no way in AMQP to 
inform existing subscribers that a queue has vanished.

This isn't just a problem for clustering - you can run into the same 
issue on just a single node if one client consumes from a queue and 
another client removes that queue.

&gt;<i> Here are my assumptions:
</I>&gt;<i> 
</I>&gt;<i> 1. Queues exist only on the server on which they were first declared.
</I>&gt;<i> 
</I>&gt;<i> 2. Nodes within a cluster relay requests to the server on which the 
</I>&gt;<i> queue exists instead of messages being relayed to the server after
</I>first 
&gt;<i> received.
</I>
Both correct.

&gt;<i> are there efforts to address these issues/scenarios?
</I>
It is possible that AMQP 1.0 addresses this. Not sure.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004693.html">[rabbitmq-discuss] Clustering Issue
</A></li>
	<LI>Next message: <A HREF="004695.html">[rabbitmq-discuss] direct queue throughput
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4694">[ date ]</a>
              <a href="thread.html#4694">[ thread ]</a>
              <a href="subject.html#4694">[ subject ]</a>
              <a href="author.html#4694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
