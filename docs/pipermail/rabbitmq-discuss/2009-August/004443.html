<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20%2891MB%20message%20over%20STOMP%29%0A%09%5BReproducible%5D&In-Reply-To=50c8ffe90908080053h6f60e7fp3129db2c2f63b4ad%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004442.html">
   <LINK REL="Next"  HREF="004446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]</H1>
    <B>Darien Kindlund</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Weird%20Crash%20%2891MB%20message%20over%20STOMP%29%0A%09%5BReproducible%5D&In-Reply-To=50c8ffe90908080053h6f60e7fp3129db2c2f63b4ad%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]">darien at kindlund.com
       </A><BR>
    <I>Sat Aug  8 09:29:49 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004442.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
        <LI>Next message: <A HREF="004446.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4443">[ date ]</a>
              <a href="thread.html#4443">[ thread ]</a>
              <a href="subject.html#4443">[ subject ]</a>
              <a href="author.html#4443">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> including the &quot;messages show up as unacknowledged after restart&quot; problem?
</I>&gt;<i>
</I>&gt;<i> YES. &#160;I think this problem is also STOMP specific! &#160;After recovering
</I>&gt;<i> the persister from the last crash. &#160;I start up a single STOMP client
</I>&gt;<i> and attempt to subscribe and get the first message off the queue. &#160;At
</I>&gt;<i> that time, rabbit.log generates this error:
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 8-Aug-2009::03:40:01 ===
</I>&gt;<i> accepted TCP connection on 0.0.0.0:61613 from 127.0.0.1:50113
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 8-Aug-2009::03:40:01 ===
</I>&gt;<i> starting STOMP connection &lt;0.6224.0&gt; from 127.0.0.1:50113
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 8-Aug-2009::03:40:01 ===
</I>&gt;<i> STOMP Reply command unhandled: {'basic.deliver',
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;&lt;&quot;Q_500.manager.workers&quot;&gt;&gt;,
</I>
Actually, this problem is a bit worse.... apparently, when RabbitMQ
restarts and recovers the persister -- even persistent messages marked
'ready' on OTHER durable queues are NOT retrievable by other STOMP
clients.... I get the same type of error in the rabbit.log:

=ERROR REPORT==== 8-Aug-2009::04:21:16 ===
STOMP Reply command unhandled: {'basic.deliver',
                                   &lt;&lt;&quot;Q_1.manager.workers&quot;&gt;&gt;,
                                   1,
                                   false,
                                   &lt;&lt;&quot;events&quot;&gt;&gt;,
                                   &lt;&lt;&quot;1.job.create.job.urls.job_alerts&quot;&gt;&gt;}

The unit test case for this would be:
1) Create a durable exchange
2) Create a durable queue
3) Bind the queue to the exchange
4) Make sure the queue has no consumers subscribed
5) Send a small (normal) persistent message to the queue
6) Crash RabbitMQ by sending a large message to a different, unrelated queue
7) Kill epmd
8) Restart RabbitMQ
9) Verify the (normal) message still exists via rabbitmqctl
10) Start STOMP consumer and attempt to subscribe to the queue
11) STOMP consumer waits, RabbitMQ generates the log message, but no
persistent (normal) message gets delivered

Let me know if this makes sense.... I'm thinking the STOMP adapter
doesn't know how to properly deal with recovered, persisted messages
in general... but I'd like to know if this is a general problem or a
specific one.

-- Darien


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004442.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
	<LI>Next message: <A HREF="004446.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4443">[ date ]</a>
              <a href="thread.html#4443">[ thread ]</a>
              <a href="subject.html#4443">[ subject ]</a>
              <a href="author.html#4443">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
