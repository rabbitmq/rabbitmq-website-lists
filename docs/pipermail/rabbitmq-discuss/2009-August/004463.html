<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Using%20rabbitmq-http2%20%28was%3A%20simple.publish%0A%20over%20the%20JSON%20RPC%20interface%29&In-Reply-To=65a6e3960908052309l445de974h3db61bc43833f6e3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004383.html">
   <LINK REL="Next"  HREF="004466.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Using%20rabbitmq-http2%20%28was%3A%20simple.publish%0A%20over%20the%20JSON%20RPC%20interface%29&In-Reply-To=65a6e3960908052309l445de974h3db61bc43833f6e3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish over the JSON RPC interface)">tonyg at lshift.net
       </A><BR>
    <I>Mon Aug 10 18:24:29 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004383.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
        <LI>Next message: <A HREF="004466.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4463">[ date ]</a>
              <a href="thread.html#4463">[ thread ]</a>
              <a href="subject.html#4463">[ subject ]</a>
              <a href="author.html#4463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nathan Gray wrote:
&gt;<i> &quot;simple.publish&quot; block until the session times out.  This seems very
</I>&gt;<i> odd to me.  Is there some rationale for this design that I'm not
</I>&gt;<i> understanding?
</I>
There are *two* timeouts involved:

 1. the &quot;session&quot; timeout. This is the length of time that an open
    channel object will survive in the absence of any active poll()
    calls. It's also used to compute the length of time to wait for
    incoming work before replying to active polls.

 2. a per-method-call timeout on JSON-RPC objects (including those
    implementing the AMQP channel API). This is a normal RPC timeout
    and defaults to five seconds.

With regard to (1), the idea is that because AMQP can involve
asynchronous events, there will usually be a long-polling call
outstanding -- either a cast() or a poll(). Previously this has been
fine, but I suspect now that cast() *shouldn't* also act as a long-poll.
The session timeout is set at channel creation time. If a channel is
left alone for longer than the session timeout, it closes itself.

With regard to (2), this is controllable on a per-request basis with and
&quot;x-json-rpc-timeout&quot; header that can take values of &quot;default&quot; (5s,
currently), &quot;infinity&quot;, or a whole number of milliseconds.

So, for your specific use case:

 1. run a long-polling poll() call in the background to keep the
    channel alive.

 2. set the session timeout (argument to &quot;open&quot;) to a bigger
    number of seconds.

 3. set each individual request timeout to longer than 5000ms by
    using the &quot;x-json-rpc-timeout&quot; header.

I will alter the code to make cast() non-long-polling. Thanks for
drawing this to my attention!

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004383.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
	<LI>Next message: <A HREF="004466.html">[rabbitmq-discuss] Using rabbitmq-http2 (was: simple.publish	over the JSON RPC interface)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4463">[ date ]</a>
              <a href="thread.html#4463">[ thread ]</a>
              <a href="subject.html#4463">[ subject ]</a>
              <a href="author.html#4463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
