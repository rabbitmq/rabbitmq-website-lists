<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP error messages saner (was Re: Weird Crash (91MB message over STOMP) [Reproducible])
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20STOMP%20error%20messages%20saner%20%28was%20Re%3A%20Weird%0A%20Crash%20%2891MB%20message%20over%20STOMP%29%20%5BReproducible%5D%29&In-Reply-To=50c8ffe90908180741j5975f640lad9e5be5e98e90a6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004581.html">
   <LINK REL="Next"  HREF="004611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP error messages saner (was Re: Weird Crash (91MB message over STOMP) [Reproducible])</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20STOMP%20error%20messages%20saner%20%28was%20Re%3A%20Weird%0A%20Crash%20%2891MB%20message%20over%20STOMP%29%20%5BReproducible%5D%29&In-Reply-To=50c8ffe90908180741j5975f640lad9e5be5e98e90a6%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] STOMP error messages saner (was Re: Weird Crash (91MB message over STOMP) [Reproducible])">tonyg at lshift.net
       </A><BR>
    <I>Thu Aug 20 11:51:58 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004581.html">[rabbitmq-discuss] STOMP error messages saner (was Re: Weird	Crash (91MB message over STOMP) [Reproducible])
</A></li>
        <LI>Next message: <A HREF="004611.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4609">[ date ]</a>
              <a href="thread.html#4609">[ thread ]</a>
              <a href="subject.html#4609">[ subject ]</a>
              <a href="author.html#4609">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Darien Kindlund wrote:
&gt;<i> One quick question: Is there any way to swap different versions of
</I>&gt;<i> compiled STOMP adapters without having to restart RabbitMQ?
</I>
Yessssss.... maybe. Um. Erlang lets you reload modules. We haven't
provided an interface for doing so, though. Um. You could try replacing
the .beam file and then using

  erl_call -a 'code load_file [stomp_frame]' -n rabbit
  erl_call -a 'code load_file [rabbit_stomp]' -n rabbit

With the specific changes you want to test, that's unlikely to work,
because the state records have changed shape. Existing connections will
probably crash (but the broker should stay up, and new connections
should be fine).

In situations where only the code changes, though, or where the OTP
structured state upgrade mechanism are in place, then using
code:load_file/1 should work fine to upgrade bits and pieces in a
running system.

Note that there are plenty of caveats about the precise way this works.
&gt;<i>From the code(3erl) manpage:
</I>
CURRENT AND OLD CODE
       The  code  of a module can exists in two variants in a
       system: current code and old code. When  a  module  is
       loaded into the system for the first time, the code of
       the module becomes &#8217;current&#8217; and the global export ta&#8208;
       ble  is  updated  with  references  to  all  functions
       exported from the module.

       If then a new instance of the module is  loaded  (per&#8208;
       haps  because of the correction of an error), then the
       code of the previous instance becomes &#8217;old&#8217;,  and  all
       export  entries referring to the previous instance are
       removed. After that the new instance is loaded  as  if
       it  was loaded for the first time, as described above,
       and becomes &#8217;current&#8217;.

       Both old and current code for a module are valid,  and
       may  even be evaluated concurrently. The difference is
       that exported functions in old code  are  unavailable.
       Hence  there  is  no  way  to make a global call to an
       exported function in old code, but old code may  still
       be evaluated because of processes lingering in it.

       If  a third instance of the module is loaded, the code
       server will remove (purge) the old code and  any  pro&#8208;
       cesses  lingering  in  it will be terminated. Then the
       third instance becomes &#8217;current&#8217;  and  the  previously
       current code becomes &#8217;old&#8217;.

       For  more  information about old and current code, and
       how to make a process switch from old to current code,
       refer to Erlang Reference Manual.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004581.html">[rabbitmq-discuss] STOMP error messages saner (was Re: Weird	Crash (91MB message over STOMP) [Reproducible])
</A></li>
	<LI>Next message: <A HREF="004611.html">[rabbitmq-discuss] Weird Crash (91MB message over STOMP)	[Reproducible]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4609">[ date ]</a>
              <a href="thread.html#4609">[ thread ]</a>
              <a href="subject.html#4609">[ subject ]</a>
              <a href="author.html#4609">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
