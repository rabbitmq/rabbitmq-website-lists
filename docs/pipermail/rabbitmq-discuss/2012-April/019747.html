<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F981D3F.6050706%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019741.html">
   <LINK REL="Next"  HREF="019751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F981D3F.6050706%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1">matthias at rabbitmq.com
       </A><BR>
    <I>Wed Apr 25 16:50:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019741.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
        <LI>Next message: <A HREF="019751.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19747">[ date ]</a>
              <a href="thread.html#19747">[ thread ]</a>
              <a href="subject.html#19747">[ subject ]</a>
              <a href="author.html#19747">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/04/12 15:41, DawgTool wrote:
&gt;<i> I haven't run these same tests on 2.7.1 yet, since its our production
</I>&gt;<i> machines (which are currently stable... enough).
</I>
I see. So, just to be clear, we are now no longer looking at the 
original problem you reported, namely that you thought 2.7.1 could 
handle a considerably higher rate than 2.8.1?

&gt;<i> The spiking and the locking is not unusual? ;)
</I>&gt;<i> Maybe the large gaps between queue memory and actual memory is not
</I>&gt;<i> unusual also? ;)
</I>&gt;<i> Maybe the flat queue sizes for several seconds while hundreds of
</I>&gt;<i> thousands of records are added and purged? ;)
</I>&gt;<i> All joking aside.... =)
</I>
Running, as you were, with considerably higher flow control credits than 
standard make all of the above worse. One of the reasons we introduced 
flow control (and picked the standard settings we have) is to reduce the 
magnitude of these.

&gt;<i> When RabbitMQ is cleaning its index/journals and data files, the queues
</I>&gt;<i> are all locked.
</I>
Paging to disk happens largely asynchronously. However, ordering and 
other causality constraints may require certain operations to wait until 
others have completed. There is not much we can do about that.

&gt;<i> The current flow control {200,50} hides a lot of this
</I>
Yep. Quite intentionally.

&gt;<i> On my test machine, all the non-persistent messages were dropped to disk
</I>&gt;<i> (causing a lock) around 4GB every time. On smaller systems, its usually
</I>&gt;<i> around 1.5 to 2GB. This happens regardless of any settings on rabbitmq
</I>&gt;<i> or mnesia (unless I missed something).
</I>
With the default credit settings I can get publishers to pause for a few 
seconds every now and then, but not longer. Are you seeing something 
different?

Regards,

Matthias.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019741.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
	<LI>Next message: <A HREF="019751.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19747">[ date ]</a>
              <a href="thread.html#19747">[ thread ]</a>
              <a href="subject.html#19747">[ subject ]</a>
              <a href="author.html#19747">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
