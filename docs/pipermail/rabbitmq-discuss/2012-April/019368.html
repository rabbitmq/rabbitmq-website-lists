<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] DLQ Problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DLQ%20Problems&In-Reply-To=%3C4F7B1679.60003%40vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019367.html">
   <LINK REL="Next"  HREF="019370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] DLQ Problems</H1>
    <B>Gary Russell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DLQ%20Problems&In-Reply-To=%3C4F7B1679.60003%40vmware.com%3E"
       TITLE="[rabbitmq-discuss] DLQ Problems">grussell at vmware.com
       </A><BR>
    <I>Tue Apr  3 16:25:45 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019367.html">[rabbitmq-discuss] Running RabbitMQ as a daemon on Suse
</A></li>
        <LI>Next message: <A HREF="019370.html">[rabbitmq-discuss] DLQ Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19368">[ date ]</a>
              <a href="thread.html#19368">[ thread ]</a>
              <a href="subject.html#19368">[ subject ]</a>
              <a href="author.html#19368">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am testing DLQs with 2.8.1.

I have a simple durable queue, with the x-dead-letter-exhange set to a 
simple direct exchange.

When I receive a message, I send a basic.reject (with requeue false); my 
understanding is that this should go the d-l-exhange and use the  same 
routing key there.

I have routing key 'si.test.binding' bound to 'si.test.queue' on my 
primary exchange (si.test.exchange); and 'si.test.binding' bound to 
'si.dlq' on the si.dlq.exchange.

Before sending a message, I see si.test.queue with the D and DLX flags 
in the admin console. However, when I reject the message, my original 
queue disappears, and the message does not show up on the DLQ.

I figure I must be missing something simple, but the fact my original 
queue is deleted concerns me.

This is in the log...

=INFO REPORT==== 3-Apr-2012::11:01:25 ===
accepting AMQP connection &lt;0.26275.1&gt; (127.0.1.1:38710 -&gt; 127.0.1.1:5672)

=ERROR REPORT==== 3-Apr-2012::11:01:31 ===
** Generic server &lt;0.26290.1&gt; terminating
** Last message in was {'$gen_cast',
                         {dead_letter,
                          {{basic_message,
                            
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;si.test.exchange&quot;&gt;&gt;},
                            [&lt;&lt;&quot;si.test.binding&quot;&gt;&gt;],
                            {content,60,none,
&lt;&lt;248,0,10,116,101,120,116,47,112,108,97,105,110,5,
                               85,84,70,45,56,0,0,0,0,2,0&gt;&gt;,
                             rabbit_framing_amqp_0_9_1,
                             [&lt;&lt;&quot;xxx&quot;&gt;&gt;]},
&lt;&lt;45,248,235,97,167,255,225,89,178,123,85,134,123,
                              221,200,209&gt;&gt;,
                            true},
                           0},
                          rejected}}
** When Server state == {q,
                          {amqqueue,
                           {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;si.test.queue&quot;&gt;&gt;},
                           true,false,none,
                           [{&lt;&lt;&quot;x-dead-letter-exchange&quot;&gt;&gt;,longstr,
&lt;&lt;&quot;si.dlq.exchange&quot;&gt;&gt;}],
&lt;0.26290.1&gt;,[],undefined},
                          none,true,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           1,
                           {1,
                            {0,
                             {msg_status,0,
&lt;&lt;45,248,235,97,167,255,225,89,178,123,85,134,123,
                                221,200,209&gt;&gt;,
                              undefined,true,true,true,true,
                              {message_properties,undefined,false}},
                             nil,nil}},
                           undefined,
                           {0,nil},
                           {qistate,
                            
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/queues/89R1RVA4SJVF9J34SJFJ3SI0K&quot;,
                            {{dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             [{segment,0,
                               
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/queues/89R1RVA4SJVF9J34SJFJ3SI0K/0.idx&quot;,
                               {array,16384,0,undefined,
                                
{{{{{{{&lt;&lt;45,248,235,97,167,255,225,89,178,123,
                                         85,134,123,221,200,209&gt;&gt;,
                                       {message_properties,undefined,false},
                                       true},
                                      del,no_ack},
                                     
undefined,undefined,undefined,undefined,
                                     
undefined,undefined,undefined,undefined,
                                     undefined},
                                    10,10,10,10,10,10,10,10,10,10},
                                   100,100,100,100,100,100,100,100,100,100},
                                  
1000,1000,1000,1000,1000,1000,1000,1000,1000,
                                  1000},
                                 10000,10000,10000,10000,10000,10000,10000,
                                 10000,10000,10000}},
                               1}]},
                            #Ref&lt;0.0.0.108169&gt;,2,262144,
                            #Fun&lt;rabbit_variable_queue.2.91259159&gt;,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,
&lt;&lt;54,34,9,193,160,112,127,104,114,220,250,198,197,
                               219,10,49&gt;&gt;,
                             {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,229447,
                              
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/msg_store_persistent&quot;},
                             rabbit_msg_store_ets_index,
                             
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/msg_store_persistent&quot;,
&lt;0.210.0&gt;,233544,225350,237641,241738},
                            {client_msstate,msg_store_transient,
&lt;&lt;236,159,45,16,62,51,168,190,137,52,88,73,76,239,
                               82,120&gt;&gt;,
                             {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,208962,
                              
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/msg_store_transient&quot;},
                             rabbit_msg_store_ets_index,
                             
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at arwen3</A>/msg_store_transient&quot;,
&lt;0.205.0&gt;,213059,204858,217156,221253}},
                           
true,0,#Fun&lt;rabbit_amqqueue_process.5.77899751&gt;,0,1,
                           infinity,1,0,0,1,1,
                           {rates,
                            {{1333,465285,369999},0},
                            {{1333,465285,369999},0},
                            0.0,0.0,
                            {1333,465286,453226}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,1,
                           {rates,
                            {{1333,465285,369999},0},
                            {{1333,465285,369999},0},
                            0.0,0.0,
                            {1333,465286,453226}}},
                          {[{&lt;0.26279.1&gt;,
                             
{consumer,&lt;&lt;&quot;amq.ctag-Q3QQmteYvhLYCrhOvf6xLB&quot;&gt;&gt;,
                              true}}],
                           []},
                          undefined,undefined,#Ref&lt;0.0.0.108171&gt;,undefined,
                          {state,fine,5000,#Ref&lt;0.0.0.108172&gt;},
                          {0,nil},
                          undefined,undefined,1,
                          {0,nil},
                          {0,nil},
                          undefined,
                          {dict,0,16,16,8,80,48,
                           
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                          {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;si.dlq.exchange&quot;&gt;&gt;},
                          undefined}
** Reason for termination ==
** {{badrecord,'P_basic'},
     [{rabbit_basic,replace_headers,2},
      {rabbit_amqqueue_process,make_dead_letter_msg,4},
      {rabbit_amqqueue_process,dead_letter_msg_existing_dlx,4},
      {gen_server2,handle_msg,2},
      {proc_lib,wake_up,3}]}

=ERROR REPORT==== 3-Apr-2012::11:01:32 ===
connection &lt;0.26275.1&gt;, channel 2 - error:
{amqp_error,not_found,&quot;no queue 'si.test.queue' in vhost 
'/'&quot;,'queue.declare'}

Thanks
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019367.html">[rabbitmq-discuss] Running RabbitMQ as a daemon on Suse
</A></li>
	<LI>Next message: <A HREF="019370.html">[rabbitmq-discuss] DLQ Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19368">[ date ]</a>
              <a href="thread.html#19368">[ thread ]</a>
              <a href="subject.html#19368">[ subject ]</a>
              <a href="author.html#19368">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
