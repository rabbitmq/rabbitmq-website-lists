<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active-active crash report
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active-active%20crash%20report&In-Reply-To=%3C4F9B988E.8070103%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019799.html">
   <LINK REL="Next"  HREF="019815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active-active crash report</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active-active%20crash%20report&In-Reply-To=%3C4F9B988E.8070103%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Active-active crash report">matthias at rabbitmq.com
       </A><BR>
    <I>Sat Apr 28 08:13:18 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019799.html">[rabbitmq-discuss] haigha 0.5.0 release
</A></li>
        <LI>Next message: <A HREF="019815.html">[rabbitmq-discuss] Active-active crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19801">[ date ]</a>
              <a href="thread.html#19801">[ thread ]</a>
              <a href="subject.html#19801">[ subject ]</a>
              <a href="author.html#19801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vadim,

(putting the list back on cc)

On 27/04/12 23:28, Vadim Chekan wrote:
&gt;<i> I've spent some time today playing with different client settings. Seems
</I>&gt;<i> ttl does not affect failures at all.
</I>
That's good to know. The more factors we can eliminate as possible 
causes the better.

&gt;<i> I managed to reproduce crash many times today. Basic idea is: an
</I>&gt;<i> application, 40 threads create a pub/sub exchange and publish a message
</I>&gt;<i> every second. Under this load I bring the master node (all queues are
</I>&gt;<i> usually created on the same node) and often it causes another node to
</I>&gt;<i> fail. Here is my load simulator (in c#):
</I>&gt;<i> <A HREF="http://www.heypasteit.com/clip/0B5W">http://www.heypasteit.com/clip/0B5W</A>
</I>
That code connects to &quot;rabbitmq-dev&quot;. Is that a load balancer sitting in 
front of the three nodes?

How do you deal with the disconnects resulting from the shutting down of 
nodes? There doesn't seem to be any code to handle that.

Mind you, I suspect that the failure should still be reproducible 
without any subscriptions and publishes. Would be good to try that and 
just watch the broker logs for errors.

&gt;<i> As long as maillist does not allow zip attaches, I'm mailing to you guys
</I>&gt;<i> directly
</I>
Thanks for posting these. There is an error in the logs that we haven't 
seen before:

            {{badmatch,[]},
             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2},
              {mnesia_tm,apply_fun,3},
              {mnesia_tm,execute_transaction,5},
              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
              {worker_pool_worker,handle_call,3},
              {gen_server2,handle_msg,2},
              {proc_lib,wake_up,3}]}

Looking at the code, this appears to indicate that there are no 
master/mirror processes left for the queue. Which is...unexpected. That 
should give us something to go on.

Regards,

Matthias.
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019799.html">[rabbitmq-discuss] haigha 0.5.0 release
</A></li>
	<LI>Next message: <A HREF="019815.html">[rabbitmq-discuss] Active-active crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19801">[ date ]</a>
              <a href="thread.html#19801">[ thread ]</a>
              <a href="subject.html#19801">[ subject ]</a>
              <a href="author.html#19801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
