<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory	leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Java%20Client%20-%20Defect%2024723%20-%20Memory%0A%09leak&In-Reply-To=%3C7E254AC0-7D01-4286-9A16-C41370DDF5E5%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019492.html">
   <LINK REL="Next"  HREF="019344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory	leak</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Java%20Client%20-%20Defect%2024723%20-%20Memory%0A%09leak&In-Reply-To=%3C7E254AC0-7D01-4286-9A16-C41370DDF5E5%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory	leak">steve at rabbitmq.com
       </A><BR>
    <I>Mon Apr  2 16:13:10 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019492.html">[rabbitmq-discuss] Client connection to ssl rabbitMQ is very slow
</A></li>
        <LI>Next message: <A HREF="019344.html">[rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19342">[ date ]</a>
              <a href="thread.html#19342">[ thread ]</a>
              <a href="subject.html#19342">[ subject ]</a>
              <a href="author.html#19342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Scott,

The original problem was due to the failure of the Java client to free
up the resources associated with the Consumer callbacks on a channel.

This was fixed by putting in a clean-up call (in
handleShutdownSignal()); but it is just possible that this is not being
called in some circumstances.

Can you tell us more about how the channels are being closed? How many
channels are created for the messages you are sending in the
sustainability tests?

In the bug you cite, the reported used the following mechanism to
analyse the memory usage:

Get process id &lt;pid&gt; and do the following:

 jmap -dump:format=b,file=yo.bin &lt;pid&gt;
 jhat jhat -J-mx768m -stack false yo.bin

Once jhat brings up http server, go here:

 <A HREF="http://localhost:7000/showInstanceCounts/">http://localhost:7000/showInstanceCounts/</A>

The original problem was the WorkPool object holding on to all the
channels after they were closed. This looks extremely similar, but the
bug was fixed in 2.7.1, so you may have found a bug in the fix.

Steve Powell  (a silly bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 28 Mar 2012, at 20:21, Scott Garten wrote:

&gt;<i> Hi all,
</I>&gt;<i>  
</I>&gt;<i> This morning started out with an OutOfMemory exception after I kicked off a sustainability test before I left the office for the day; digging into it we found a number of classes failing to free up. They appear to correlate to the number of messages that we sent to rabbitmq. A web search revealed a defect # 24723 was identified and reported fixed.
</I>&gt;<i>  
</I>&gt;<i> We were using 2.7.1 of the Java client, but since have also tried 2.8.0 and 2.8.1 of the client &#8211; hoping that one of these later releases contained a fix. Unfortunately, we are still seeing the same memory leak behavior.
</I>&gt;<i>  
</I>&gt;<i> Here is a jmap dump of the classes that we witness not freeing (even after an explicit GC).
</I>&gt;<i>  
</I>&gt;<i>   19:          1979         189984  com.rabbitmq.client.impl.ChannelN
</I>&gt;<i>   28:          1980          79200  com.rabbitmq.client.impl.CommandAssembler
</I>&gt;<i>   29:          1979          79160  com.rabbitmq.client.ShutdownSignalException
</I>&gt;<i>   30:          1979          79160  com.rabbitmq.client.impl.ConsumerDispatcher
</I>&gt;<i>   35:          1979          63328  com.rabbitmq.client.impl.AMQImpl$Channel$Close
</I>&gt;<i>   48:          1980          31680  com.rabbitmq.client.impl.AMQCommand
</I>&gt;<i>  
</I>&gt;<i> Appears to be similar to that which was previously reported on the mailing list.
</I>&gt;<i>  
</I>&gt;<i> Not certain where to turn at this point. Can anyone confirm that they see the fix freeing up the objects?
</I>&gt;<i>  
</I>&gt;<i> Thanks, Scott.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ====================
</I>&gt;<i> The information contained in this transmission is confidential. It is intended solely for the use of the individual(s) or organization(s) to whom it is addressed. Any disclosure, copying or further distribution is not permitted unless such privilege is explicitly granted in writing by Purchasing Power LLC. Furthermore, Purchasing Power LLC.. is not responsible for the proper and complete transmission of the substance of this communication, nor for any delay in its receipt. 
</I>&gt;<i> ----------------------------------------------------- 
</I>&gt;<i> All outgoing emails are scanned for viruses by Barracuda Spam Firewall   &#173;&#173;  _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019492.html">[rabbitmq-discuss] Client connection to ssl rabbitMQ is very slow
</A></li>
	<LI>Next message: <A HREF="019344.html">[rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19342">[ date ]</a>
              <a href="thread.html#19342">[ thread ]</a>
              <a href="subject.html#19342">[ subject ]</a>
              <a href="author.html#19342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
