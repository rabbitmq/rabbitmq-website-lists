<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Missing dependency in management	plugin/mochiweb
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Missing%20dependency%20in%20management%0A%09plugin/mochiweb&In-Reply-To=%3CCAMcAHLWnE0K5gv-86bvZopY73M5dEQhN24F5Jg7p%3Di%3DkD6Xv5A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019738.html">
   <LINK REL="Next"  HREF="019739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Missing dependency in management	plugin/mochiweb</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Missing%20dependency%20in%20management%0A%09plugin/mochiweb&In-Reply-To=%3CCAMcAHLWnE0K5gv-86bvZopY73M5dEQhN24F5Jg7p%3Di%3DkD6Xv5A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Missing dependency in management	plugin/mochiweb">videlalvaro at gmail.com
       </A><BR>
    <I>Wed Apr 25 13:24:14 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019738.html">[rabbitmq-discuss] Missing dependency in	management	plugin/mochiweb
</A></li>
        <LI>Next message: <A HREF="019739.html">[rabbitmq-discuss] Missing dependency in management	plugin/mochiweb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19740">[ date ]</a>
              <a href="thread.html#19740">[ thread ]</a>
              <a href="subject.html#19740">[ subject ]</a>
              <a href="author.html#19740">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

So let's start again because my first error report was wrong. I shouldn't
have mentioned mochiweb or the management plugin. I did so because the
first time this error happened to me I was trying to enable those plugins.

So, yes. The release is created based on the dependencies from the
rabbit.app which doesn't declare inets as one if its dependencies:

<A HREF="http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/ebin/rabbit_app.in#l13">http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/ebin/rabbit_app.in#l13</A>

So when the Erlang release is generated the inets is not shipped with the
.tar created.

Actually I think any app used by the project which also appears here: ls
/usr/local/lib/erlang/lib/ should be declared as a dependency. (kernel and
stdlib are required anyway, same thing with erts and sasl if used).

Declaring the app dependency is not required to generate a release per-se,
but is required by the rabbit_prelaunch.erl script that generates the
release file automatically: See:
<A HREF="http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/src/rabbit_prelaunch.erl#l72">http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/src/rabbit_prelaunch.erl#l72</A>

So when generating a .rel file you can actually write all the app
dependencies manually but I automated the process by &quot;borrowing&quot; code from
the rabbit_prelaunch script.

So in my case to fix the issue I just added some extra apps here:
<A HREF="https://github.com/videlalvaro/tamedrabbit/blob/master/erlang/rabbit_release.erl#L9(Note">https://github.com/videlalvaro/tamedrabbit/blob/master/erlang/rabbit_release.erl#L9(Note</A>
that rabbit_prelaunch.erl has the same erlang macro on top). By
adding inets and xmerl there I made sure that those apps are shipped with
my custom release.

So I use my own rabbit_release.erl to generate the release .tar and what
not. Then rabbitmq-server uses rabbit_prelaunch.erl to generate it's own
release file that is loaded during server startup. That release file
generated by the prelaunch script is based on the target system, that of
course will not include inets.

Does it make sense now?

Regards,

Alvaro

On Wed, Apr 25, 2012 at 1:57 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 25/04/12 12:52, Alvaro Videla wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I tried to reproduce the problem. Actually *rabbitmq-server* needs to
</I>&gt;&gt;<i> declare *inets* in its app dependencies.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I still don't get it - does the release build thing that you have check
</I>&gt;<i> only the rabbit.app descriptor, or those of all the plugins too?
</I>&gt;<i>
</I>&gt;<i> If the former, why did adding xmerl to rabbitmq-management fix anything?
</I>&gt;<i> (it was the right thing to do anyway, but why did it not cause this
</I>&gt;<i> problem?)
</I>&gt;<i>
</I>&gt;<i> If the latter, why is inets not being picked up due to its presence in
</I>&gt;<i> mochiweb.app?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/521fe727/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/521fe727/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019738.html">[rabbitmq-discuss] Missing dependency in	management	plugin/mochiweb
</A></li>
	<LI>Next message: <A HREF="019739.html">[rabbitmq-discuss] Missing dependency in management	plugin/mochiweb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19740">[ date ]</a>
              <a href="thread.html#19740">[ thread ]</a>
              <a href="subject.html#19740">[ subject ]</a>
              <a href="author.html#19740">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
