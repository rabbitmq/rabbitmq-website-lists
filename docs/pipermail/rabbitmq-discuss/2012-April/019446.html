<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster fails when current primary node shuts down.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20fails%20when%20current%20primary%20node%0A%20shuts%20down.&In-Reply-To=%3C4F8417A1.70608%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019393.html">
   <LINK REL="Next"  HREF="019395.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster fails when current primary node shuts down.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20fails%20when%20current%20primary%20node%0A%20shuts%20down.&In-Reply-To=%3C4F8417A1.70608%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster fails when current primary node shuts down.">simon at rabbitmq.com
       </A><BR>
    <I>Tue Apr 10 12:21:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019393.html">[rabbitmq-discuss] Cluster fails when current primary node	shuts down.
</A></li>
        <LI>Next message: <A HREF="019395.html">[rabbitmq-discuss] No message is delivered to consumer workers when	a message is requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19446">[ date ]</a>
              <a href="thread.html#19446">[ thread ]</a>
              <a href="subject.html#19446">[ subject ]</a>
              <a href="author.html#19446">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/04/2012 12:37AM, Travis wrote:
&gt;<i> Ok, so I've gotten another chance to test this on our production
</I>&gt;<i> server.  What appears to be happening is that, when we initiate the
</I>&gt;<i> stop on machineA, rabbitmq*looks*  like it fails the mirrored queues
</I>&gt;<i> over to machineB, but as soon as this completes, the management plugin
</I>&gt;<i> dies on machineB.  We can confirm that the queues are alive because
</I>&gt;<i> our applications consuming from the queue continue chugging along
</I>&gt;<i> happily, processing messages that have been published.
</I>
Oh, that's odd, and definitely should not be happening.

&gt;<i> rabbitmqctl cluster_status also shows that the instance on machineB is alive.
</I>&gt;<i>
</I>&gt;<i> Oddly, if I've failed from machineA to machineB, done a
</I>&gt;<i> stop_app/start_app to get the management plugin working on machineB,
</I>&gt;<i> brought up machineA again, and then initiated the failover back to
</I>&gt;<i> machineA, the failover completes without issue (eg, the management
</I>&gt;<i> plugin has no failures).
</I>&gt;<i>
</I>&gt;<i> So ...
</I>&gt;<i>
</I>&gt;<i> 1)  As I understand it, the node in the management interface
</I>&gt;<i> associated with the stats service is the node considered the master.
</I>&gt;<i> How can I tell which node has the stats service running if the
</I>&gt;<i> management plugin is not running?
</I>
The stats service is part of the management plugin, so if mgmt is not 
running it isn't either. There's no inherent &quot;master&quot; node in a RabbitMQ 
cluster; the node with stats is just the node with stats (and this 
doesn't have to mean anything with respect to where mirrored queues have 
their masters).

&gt;<i> 2) How do I restart the management plugin and associated parts without
</I>&gt;<i> doing a full stop_app/start_app?
</I>
You should be able to do:

rabbitmqctl eval 'application:stop(rabbitmq_management).'
rabbitmqctl eval 'application:start(rabbitmq_management).'

to just restart the management plugin.

&gt;<i> 3) What other things would be needed to debug this further?  I can
</I>&gt;<i> reliably cause this issue to occur failing from machineA to machineB.
</I>
Logs (including the &quot;sasl&quot; log) from when the failure occurs. If you can 
reliably reproduce this that's great, I would like to get to the bottom 
of this.

Cheers, Simon
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019393.html">[rabbitmq-discuss] Cluster fails when current primary node	shuts down.
</A></li>
	<LI>Next message: <A HREF="019395.html">[rabbitmq-discuss] No message is delivered to consumer workers when	a message is requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19446">[ date ]</a>
              <a href="thread.html#19446">[ thread ]</a>
              <a href="subject.html#19446">[ subject ]</a>
              <a href="author.html#19446">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
