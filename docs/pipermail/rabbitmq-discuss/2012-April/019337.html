<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [bug] umbrella common.mk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bbug%5D%20umbrella%20common.mk&In-Reply-To=%3C177DC886-3D76-4152-A97C-B0B3195BDD30%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019329.html">
   <LINK REL="Next"  HREF="019346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [bug] umbrella common.mk</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bbug%5D%20umbrella%20common.mk&In-Reply-To=%3C177DC886-3D76-4152-A97C-B0B3195BDD30%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] [bug] umbrella common.mk">steve at rabbitmq.com
       </A><BR>
    <I>Mon Apr  2 14:44:18 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019329.html">[rabbitmq-discuss] [bug] umbrella common.mk
</A></li>
        <LI>Next message: <A HREF="019346.html">[rabbitmq-discuss] [bug] umbrella common.mk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19337">[ date ]</a>
              <a href="thread.html#19337">[ thread ]</a>
              <a href="subject.html#19337">[ subject ]</a>
              <a href="author.html#19337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matwey,

Thanks for raising this. I have managed to reproduce your problem (on
MacOS) -- almost.

My builds fail with lots of lines like this:

do-package.mk:507: warning: overriding commands for target `mochiweb-wrapper/dist/.done'
do-package.mk:507: warning: ignoring old commands for target `mochiweb-wrapper/dist/.done'

followed by:

rabbitmq-stomp/package.mk:31: *** target pattern contains no `%'.  Stop.
make[1]: *** [clean] Error 2
rm -f include/rabbit_framing.hrl src/rabbit_framing_amqp_*.erl codegen.pyc
rm -f docs/*.[0-9].gz docs/*.man.xml docs/*.erl     src/rabbit_ctl_usage.erl     src/rabbit_plugins_usage.erl
rm -f rabbit.plt
rm -f deps.mk

but then I have only one colon in my containing directory
(I used rabbitmq:build).

The problem is that rabbitmq's make uses full file paths as targets; and
colons are significant in dependency lines (target:sources). Hence the
rather cryptic error message from make. It also explains the overriding
noise I get: the colons interfere with target lines (they become wrong
ones) and the make dependency tree is tangled/confused. I'm not sure why
you don't get them, too (but maybe it depends exactly what your dir
containing colons is called).

To make the make referentially transparent wrt directory names is
probably more work than we will undertake; but the workaround is very
easy.

I'm sorry the advice is the doctor's one: if it hurts doing that -- then
don't do it.

If you feel strongly about this, then I'll raise a bug; but it is
unlikely to be fixed IMO.

Yours,
Steve Powell  (a droopy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 12:07, Matwey V. Kornilov wrote:

&gt;<i> 
</I>&gt;<i> Hi Steve, Emile,
</I>&gt;<i> 
</I>&gt;<i> * Platform details/Installation details:
</I>&gt;<i> 
</I>&gt;<i> My OS: openSUSE 12.1, GNU Make 3.82, Erlang/OTP R15B,
</I>&gt;<i> x86 cpu, reiserfs 3.6 filesystem.
</I>&gt;<i> I am trying to compile RabbitMQ 2.8.1 from source package.
</I>&gt;<i> 
</I>&gt;<i> * Directory details/Command sequence/What happens:
</I>&gt;<i> 
</I>&gt;<i> matwey@?:~/temp/my:test:dir&gt; pwd
</I>&gt;<i> /home/matwey/temp/my:test:dir
</I>&gt;<i> matwey@?:~/temp/my:test:dir&gt; wget <A HREF="http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz">http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz</A>
</I>&gt;<i> &lt;&lt;I've skipped wget output&gt;&gt;
</I>&gt;<i> 2012-04-02 14:53:16 (475 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]
</I>&gt;<i> 
</I>&gt;<i> matwey@?:~/temp/my:test:dir&gt; tar -zxf rabbitmq-server-2.8.1.tar.gz 
</I>&gt;<i> matwey@?:~/temp/my:test:dir&gt; cd rabbitmq-server-2.8.1/
</I>&gt;<i> matwey@?:~/temp/my:test:dir/rabbitmq-server-2.8.1&gt; make
</I>&gt;<i> python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
</I>&gt;<i> python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
</I>&gt;<i> &lt;&lt;I've skipped erlang compiling&gt;&gt;
</I>&gt;<i> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
</I>&gt;<i> [ -d &quot;plugins-src/rabbitmq-server&quot; ] || ln -s &quot;/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1&quot; &quot;plugins-src/rabbitmq-server&quot;
</I>&gt;<i> mkdir -p plugins
</I>&gt;<i> PLUGINS_SRC_DIR=&quot;&quot; make -C &quot;plugins-src&quot; plugins-dist PLUGINS_DIST_DIR=&quot;/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins&quot; VERSION=0.0.0
</I>&gt;<i> make[1]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> make -f all-packages.mk all-releasable VERSION=0.0.0
</I>&gt;<i> make[2]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> common.mk:87: *** target pattern contains no `%'.  Stop.
</I>&gt;<i> make[2]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> make[1]: *** [release] Error 2
</I>&gt;<i> make[1]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> make: *** [plugins] Error 2
</I>&gt;<i> 
</I>&gt;<i> * What I expected:
</I>&gt;<i> 
</I>&gt;<i> matwey@?:~/temp/dir_wo_columns&gt; pwd
</I>&gt;<i> /home/matwey/temp/dir_wo_columns
</I>&gt;<i> matwey@?:~/temp/dir_wo_columns&gt; wget <A HREF="http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz">http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz</A>
</I>&gt;<i> &lt;&lt;I've skipped wget output&gt;&gt;
</I>&gt;<i> 2012-04-02 14:58:30 (425 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]
</I>&gt;<i> 
</I>&gt;<i> matwey@?:~/temp/dir_wo_columns&gt; tar -zxf rabbitmq-server-2.8.1.tar.gz 
</I>&gt;<i> matwey@?:~/temp/dir_wo_columns&gt; cd rabbitmq-server-2.8.1/
</I>&gt;<i> matwey@?:~/temp/dir_wo_columns/rabbitmq-server-2.8.1&gt; make
</I>&gt;<i> python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
</I>&gt;<i> python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
</I>&gt;<i> &lt;&lt;I've skipped erlang compiling&gt;&gt;
</I>&gt;<i> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
</I>&gt;<i> [ -d &quot;plugins-src/rabbitmq-server&quot; ] || ln -s &quot;/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1&quot; &quot;plugins-src/rabbitmq-server&quot;
</I>&gt;<i> mkdir -p plugins
</I>&gt;<i> PLUGINS_SRC_DIR=&quot;&quot; make -C &quot;plugins-src&quot; plugins-dist PLUGINS_DIST_DIR=&quot;/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins&quot; VERSION=0.0.0
</I>&gt;<i> make[1]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> make -f all-packages.mk all-releasable VERSION=0.0.0
</I>&gt;<i> make[2]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> [elided] generate deps
</I>&gt;<i> [elided] fix test deps
</I>&gt;<i> &lt;&lt;I've skipped plugins building&gt;&gt;
</I>&gt;<i> cp rabbitmq-auth-mechanism-ssl/dist/*.ez /home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins
</I>&gt;<i> make[2]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> make[1]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
</I>&gt;<i> echo &quot;Put your EZs here and use rabbitmq-plugins to enable them.&quot; &gt; plugins/README
</I>&gt;<i> rm -f plugins/rabbit_common*.ez
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019329.html">[rabbitmq-discuss] [bug] umbrella common.mk
</A></li>
	<LI>Next message: <A HREF="019346.html">[rabbitmq-discuss] [bug] umbrella common.mk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19337">[ date ]</a>
              <a href="thread.html#19337">[ thread ]</a>
              <a href="subject.html#19337">[ subject ]</a>
              <a href="author.html#19337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
