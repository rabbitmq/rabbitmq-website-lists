<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20hipe_compile%20in%20RHEL%206&In-Reply-To=%3C4F9E5D97.6010900%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019804.html">
   <LINK REL="Next"  HREF="019806.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Enabling hipe_compile in RHEL 6</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20hipe_compile%20in%20RHEL%206&In-Reply-To=%3C4F9E5D97.6010900%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Enabling hipe_compile in RHEL 6">emile at rabbitmq.com
       </A><BR>
    <I>Mon Apr 30 10:38:31 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019804.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
        <LI>Next message: <A HREF="019806.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19805">[ date ]</a>
              <a href="thread.html#19805">[ thread ]</a>
              <a href="subject.html#19805">[ subject ]</a>
              <a href="author.html#19805">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chris,

On 30/04/12 04:51, Chris Schmidt wrote:
&gt;<i> I'm running RabbitMQ 2.71/R14B04 on RHEL 6.2 and am encountering scaling
</I>&gt;<i> issues with (I believe) RMQ. I'm interested in using the hipe_compile or
</I>&gt;<i> other configurations to tune RMQ's throughput. Right now we get around
</I>&gt;<i> 20k messages per second, but anything beyond that the queues begin to
</I>&gt;<i> grow (there are a number of producer/consumer workers and around 15
</I>&gt;<i> queues/exchanges they read/write to). Each worker is acknowledging
</I>&gt;<i> messages as they are processed and sent on to the next process. The
</I>&gt;<i> messages have variable size.
</I>
If the queues start to grow then you should focus on speeding up the
consumers. If the consumers can't keep up then increasing the speed of
the broker won't keep the queues short.

Versions of the broker later then 2.7.1 feature internal flow control
which helps to limit latency. Your problem might benefit from this.

&gt;<i>  I've changed the frame_max setting but that doesn't appear to
</I>&gt;<i> help. I've tried increasing the number of workers across additional
</I>&gt;<i> hardware as well, but Rabbit still seems to cap at 20k message/sec. When
</I>
The maximum framesize allows you to choose between better latency (small
framesize) or throughput (large framesize). If many messages are larger
than 128Kb then increasing framesize may improve throughput (provided
consumers can keep up).

When you increased the number of workers, were you able to determine
whether the load was effectively spread amongst all of them? The QoS
prefetch count setting will help to ensure fair distribution. Try a
small number (e.g. 10) as a starting point for tuning this value.

&gt;<i> I set hipe_compile to true, the systems states 'Not HiPE compiling: HiPE
</I>&gt;<i> not found in this Erlang installation.' What's odd is
</I>&gt;<i> that erlang-hipe-R14B-04.1.el6.x86_64 is installed. Is there something
</I>&gt;<i> else that needs to be done for RHEL systems to enable hipe_compile? I
</I>
That message means that your installation of Erlang lacks the hipe.beam
file in the code loading path. The name of the package that includes
this file depends on how Erlang was packaged in your system. Making use
of HiPE won't address the core problem though.

&gt;<i> think that it may help get beyond the current problem. If that doesn't
</I>&gt;<i> help, are there other settings or something I can look at to determine
</I>&gt;<i> where the bottleneck is? The RMQ server is 60% idle, doesn't have a
</I>&gt;<i> large amount of I/O wait, and doesn't seem to be saturating its network
</I>&gt;<i> cards (the server has a bonded ethernet interface). The worker machines
</I>&gt;<i> are relatively idle as well.
</I>
Are *all* the workers idle, or are a small number taking all the load?
Uneven worker load is a potential cause for the problem you describe and
can be addressed using prefetch count:

<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count">http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count</A>


-Emile


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019804.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
	<LI>Next message: <A HREF="019806.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19805">[ date ]</a>
              <a href="thread.html#19805">[ thread ]</a>
              <a href="subject.html#19805">[ subject ]</a>
              <a href="author.html#19805">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
