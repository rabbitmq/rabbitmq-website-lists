<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cannot send message with STOMP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cannot%20send%20message%20with%20STOMP&In-Reply-To=%3C20369.27543.718619.701208%40mail.cern.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019677.html">
   <LINK REL="Next"  HREF="019777.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cannot send message with STOMP</H1>
    <B>Lionel Cons</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cannot%20send%20message%20with%20STOMP&In-Reply-To=%3C20369.27543.718619.701208%40mail.cern.ch%3E"
       TITLE="[rabbitmq-discuss] Cannot send message with STOMP">lionel.cons at cern.ch
       </A><BR>
    <I>Fri Apr 20 14:58:47 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019677.html">[rabbitmq-discuss] Cannot send message with STOMP
</A></li>
        <LI>Next message: <A HREF="019777.html">[rabbitmq-discuss] Cannot send message with STOMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19678">[ date ]</a>
              <a href="thread.html#19678">[ thread ]</a>
              <a href="subject.html#19678">[ subject ]</a>
              <a href="author.html#19678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Steve Powell writes:
 &gt; The STOMP 1.0 specification is unsatisfactory in many respects, [...]

Indeed. This is what triggered the creation of 1.1.

 &gt; The STOMP 1.1 specification has drawbacks of its own -- [...]

Although I agree that 1.1 is not perfect (so I'm sure we will see 1.2
or 2.0 one day), I do not share your view on the points you mention.

 &gt; the rather arbitrary notion of escaping colons in header values as
 &gt; well as names (why?) [...]

Without backslash escaping, header names and values would have been
limited. This quite simple escaping removed this restriction.

 &gt; and the insistence of UTF-8 for all header names and values [...]

Here again, without this in the spec, the headers would have been
limited to basically US-ASCII. Some users (us included) do need
more. This widely used encoding allows any text string in the header.
Icing on the cake: it's backward compatible with 1.0 and transparent
to implementations using only US-ASCII.

 &gt; So I think it is _incorrect_ in that it specifies a considerable
 &gt; superset of what you can receive (or are allowed to send) over the wire.

The BNF indeed allows more than what the protocol accepts. The best
solution is probably to ignore the BNF and only implement what is in
the protocol text. After all, it's probably two orders of magnitude
shorter than AMQP 1-0 ;-)

 &gt; I'm going to raise a bug [24896] to track this, and propose the
 &gt; following solution:

Thanks.

 &gt; We use the negotiated connection type to determine the parsing rules
 &gt; (and generating rules) for frame headers.

Perfect.

 &gt; For 1.0 connections we will allow OCTET streams for header names and
 &gt; values, excepting colons in names, and excepting newlines (\u000A
 &gt; newline character coded in UTF-8 is x'0A') anywhere, and do NO escaping
 &gt; either on input or output. We will reject no headers on input unless
 &gt; they do not contain a colon before the first newline (because they
 &gt; cannot be malformed under these rules) though the remaining frame
 &gt; parsing can fail.

Maybe you also want reject empty header names (e.g. SEND\n:foo\n\n\0).
This is arguable.

 &gt; For 1.1 connections we will allow OCTET streams for header names and
 &gt; values, excepting colons, newlines and backslashes, interpreting escape
 &gt; sequences for these, and generating escapes for these characters on
 &gt; output. We will NOT reject non-UTF-8 OCTETs but instead just pass them
 &gt; through asis in order to allow the simplest client access. We will NOT
 &gt; reject other escapes (\ followed by non c, n or \), but leave these
 &gt; asis.
 &gt; 
 &gt; Although this is not strictly what the spec says (we would not enforce
 &gt; UTF-8 or the errors on bad escape sequences) I believe it is a
 &gt; reasonable compromise.

Fair enough.

IMHO, the main point is that RabbitMQ should accept any valid STOMP
1.1 input. Your proposed solution seems address this point.

If you also accept invalid input, this should not be a problem in
practice.

Thanks for your work improving RabbitMQ's STOMP support.

Cheers,

Lionel
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019677.html">[rabbitmq-discuss] Cannot send message with STOMP
</A></li>
	<LI>Next message: <A HREF="019777.html">[rabbitmq-discuss] Cannot send message with STOMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19678">[ date ]</a>
              <a href="thread.html#19678">[ thread ]</a>
              <a href="subject.html#19678">[ subject ]</a>
              <a href="author.html#19678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
