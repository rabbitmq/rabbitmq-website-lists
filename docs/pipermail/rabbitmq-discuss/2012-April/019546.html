<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Routing on multiple criteria but hitting only	one consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20on%20multiple%20criteria%20but%20hitting%20only%0A%09one%20consumer&In-Reply-To=%3C90116f8d-196e-492b-9ea3-e2ba8dd5a140%40j9g2000pbn.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019627.html">
   <LINK REL="Next"  HREF="019549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Routing on multiple criteria but hitting only	one consumer</H1>
    <B>AgileZebra</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20on%20multiple%20criteria%20but%20hitting%20only%0A%09one%20consumer&In-Reply-To=%3C90116f8d-196e-492b-9ea3-e2ba8dd5a140%40j9g2000pbn.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Routing on multiple criteria but hitting only	one consumer">netsinque at gmail.com
       </A><BR>
    <I>Sun Apr 15 10:04:01 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019627.html">[rabbitmq-discuss] Publisher throttled way too early
</A></li>
        <LI>Next message: <A HREF="019549.html">[rabbitmq-discuss] Routing on multiple criteria but hitting only one consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19546">[ date ]</a>
              <a href="thread.html#19546">[ thread ]</a>
              <a href="subject.html#19546">[ subject ]</a>
              <a href="author.html#19546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How can we distribute work such that worker pools can subscribe to
work messages based on differing (but frequently overlapping) criteria
from each other but such that when a message is routed that matches to
multiple worker pools, only one worker will pick up the job?

Simplified example:

* We have host1 and host2.
* Host1 handles jobs of classA and classB; host2 handles jobs of
classB and classC.
* If we route a job of classA, only host1 will pick it up; if we route
a job of classB, either host1 or host2 will pick it up (based on their
current load / first available) but never both.
It would seem that we need to use a topic exchange, as our routing
criteria is complex and using wildcards gives us the type of flexible
matching we want.

However:

1) If we use the same name for the worker pool queue (say &#8220;worker-
jobs&#8221;) we get the desired work splitting out to arbitrary matching
workers, but every worker subscribing to the named queue seems to
infect the other workers with each other&#8217;s routing criteria as they
bind it. I.e. the binding of the routing key seems to be at the
central queue name level not on a connection-to-queue basis.
2) If we use different queue names for each worker pool connection
(say &#8220;poolA-jobs&#8221; and &#8220;poolB-jobs&#8221;) to the same exchange then we get
the desired behavior with the different routing criteria maintained
between pools but a job coming in that can match to both poolA and
poolB gets routed to both of them (albeit only to one worker in each).

Notes:
1) I&#8217;ve spared you the details of why but suffice to say we have an
existing multi-petabyte distributed search application that needs
response times &lt; 50ms. We already achieve this with our own custom
routing hub but we&#8217;d like to replace this with RabbitMQ as its
performance is attractive (as is retiring homemade code that overlaps
with general purpose community projects) if we can get the more
sophisticated routing we need.
2) We use Python
3) We actually have the luxury of already knowing upfront which hosts
are capable of serving which jobs, so we can do something like have
host1 subscribe to #.host1.# and host2 to #.host2.#. Then when we
route a classB message, we can give it a key of host1.host2 to
indicate which backends are acceptable for service. This simplifies
the routing rules but still doesn&#8217;t overcome the problem described.
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019627.html">[rabbitmq-discuss] Publisher throttled way too early
</A></li>
	<LI>Next message: <A HREF="019549.html">[rabbitmq-discuss] Routing on multiple criteria but hitting only one consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19546">[ date ]</a>
              <a href="thread.html#19546">[ thread ]</a>
              <a href="subject.html#19546">[ subject ]</a>
              <a href="author.html#19546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
