<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 2.4.1 broker failure/crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.4.1%20broker%20failure/crash&In-Reply-To=%3C26652355.2332.1334779942949.JavaMail.geo-discussion-forums%40ynaz34%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019632.html">
   <LINK REL="Next"  HREF="019634.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 2.4.1 broker failure/crash</H1>
    <B>Mark Geib</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.4.1%20broker%20failure/crash&In-Reply-To=%3C26652355.2332.1334779942949.JavaMail.geo-discussion-forums%40ynaz34%3E"
       TITLE="[rabbitmq-discuss] 2.4.1 broker failure/crash">mark.geib.44 at gmail.com
       </A><BR>
    <I>Wed Apr 18 21:12:22 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019632.html">[rabbitmq-discuss] Bookmark to purge all the queues in a vhost
</A></li>
        <LI>Next message: <A HREF="019634.html">[rabbitmq-discuss] 2.4.1 broker failure/crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19633">[ date ]</a>
              <a href="thread.html#19633">[ thread ]</a>
              <a href="subject.html#19633">[ subject ]</a>
              <a href="author.html#19633">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are running rabbitmq 2.4.1 in production and recently had a failure that 
we can not determine the root cause. Also we tried a restart of the broker 
and the restart hung, never returned. We rebooted the machine to restore 
the broker.

We have only the rabbitmq and sasl logs at this point, but the error 
messages don't mean much to us.

rabbitmq log snippet:

=INFO REPORT==== 11-Apr-2012::05:04:08 ===
starting TCP connection &lt;0.28490.65&gt; from 172.17.208.67:1522

=INFO REPORT==== 11-Apr-2012::05:04:08 ===
closing TCP connection &lt;0.9195.65&gt; from 10.70.20.75:62045

=INFO REPORT==== 11-Apr-2012::05:04:31 ===
closing TCP connection &lt;0.10243.65&gt; from 10.70.40.77:53173

=ERROR REPORT==== 11-Apr-2012::05:04:31 ===
** Generic server msg_store_transient terminating
** Last message in was {'$gen_cast',
                           {client_dying,
                               &lt;&lt;74,18,61,37,8,55,8,91,210,27,70,185,112,89,
                                 171,154&gt;&gt;}}
** When Server state == {msstate,
                        
 &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at che-csebrokerp1</A>/msg_store_transient&quot;,
                         rabbit_msg_store_ets_index,
                         {state,417861,
                          
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at che-csebrokerp1</A>/msg_store_transient&quot;},
                         0,#Ref&lt;0.0.0.875&gt;,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         [],undefined,0,12073198,[],&lt;0.233.0&gt;,421958,413764,
                         426055,
                         {set,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
...skipping...
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                            []}}}}
** Reason for termination == 
** {{badmatch,false},
    [{rabbit_msg_store_ets_index,insert,2},
     {rabbit_msg_store,write_message,3},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}
...skipping...
=INFO REPORT==== 11-Apr-2012::05:04:43 ===
closing TCP connection &lt;0.5032.4496&gt; from 172.16.216.217:60234

=INFO REPORT==== 11-Apr-2012::05:04:43 ===
closing TCP connection &lt;0.8419.6115&gt; from 10.65.10.72:54580

=ERROR REPORT==== 11-Apr-2012::05:04:43 ===
** Generic server &lt;0.31907.9&gt; terminating
** Last message in was {'EXIT',&lt;0.241.0&gt;,shutdown}
** When Server state == {q,
                         {amqqueue,
                          {resource,&lt;&lt;&quot;/alarming&quot;&gt;&gt;,queue,&lt;&lt;&quot;alarming.9&quot;&gt;&gt;},
                          false,false,none,[],&lt;0.31907.9&gt;},
                         none,true,rabbit_variable_queue,
                         {vqstate,
                          {[],[]},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
...skipping...
                         {state,fine,undefined},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination == 
** {noproc,
       {gen_server2,call,
           [msg_store_transient,
            {client_terminate,
                
&lt;&lt;17,102,9,148,6,184,165,141,162,246,194,57,36,62,208,135&gt;&gt;},
            infinity]}}
** In 'terminate' callback with reason ==
** shutdown

=ERROR REPORT==== 11-Apr-2012::05:04:43 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,&lt;0.146.0&gt;,
                    {&lt;0.9700.6&gt;,
                     &quot;** Generic server ~p terminating~n** Last message in 
was ~p~n** When Server state == ~p~n** Reason for termination == ~n** 
~p~n** In 'terminate' callback with reason ==~n** ~p~n&quot;,
                     [&lt;0.9700.6&gt;,
                      {'EXIT',&lt;0.241.0&gt;,shutdown},
                      {q,
                       {amqqueue,
                        {resource,&lt;&lt;&quot;/rssm&quot;&gt;&gt;,queue,
                         &lt;&lt;&quot;cse.rssm.logManager.sqlserver&quot;&gt;&gt;},
                        false,false,none,[],&lt;0.9700.6&gt;},
                       none,true,rabbit_variable_queue,
                       {vqstate,
                        {[],[]},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
...skipping...
                      {noproc,
                       {gen_server2,call,
                        [msg_store_transient,
                         {client_terminate,
                          &lt;&lt;143,174,238,76,144,209,125,211,110,123,56,1,237,
                            217,136,2&gt;&gt;},
                         infinity]}},
                      shutdown]}}
** When handler state == {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;amq.rabbitmq.log&quot;&gt;&gt;}
** Reason == {badarg,[{ets,lookup,[rabbit_registry,{exchange,topic}]},
                      {rabbit_registry,lookup_module,2},
                      {rabbit_exchange,type_to_module,1},
                      {rabbit_exchange,route,2},
                      {rabbit_exchange,publish,2},
                      {rabbit_basic,publish,1},
                      {rabbit_error_logger,publish1,4},
                      {rabbit_error_logger,handle_event,2}]}

=INFO REPORT==== 11-Apr-2012::05:04:43 ===
    application: rabbit
    exited: shutdown
    type: permanent


sasl log snippet:
=SUPERVISOR REPORT==== 11-Apr-2012::00:15:30 ===
     Supervisor: {&lt;0.5419.34&gt;,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,&lt;0.5731.34&gt;},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=CRASH REPORT==== 11-Apr-2012::05:04:32 ===
  crasher:
    initial call: gen:init_it/7
    pid: &lt;0.232.0&gt;
    registered_name: msg_store_transient
    exception exit: {{badmatch,false},
                     [{rabbit_msg_store_ets_index,insert,2},
                      {rabbit_msg_store,write_message,3},
                      {rabbit_msg_store,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_sup,&lt;0.147.0&gt;]
    messages: [{'EXIT',&lt;0.233.0&gt;,normal}]
    links: [&lt;0.148.0&gt;]
    dictionary: [{fhc_age_tree,{0,nil}}]
    trap_exit: true
    status: running
    heap_size: 10946
    stack_size: 24
    reductions: 98380626
  neighbours:
=SUPERVISOR REPORT==== 11-Apr-2012::05:04:32 ===
     Supervisor: {local,rabbit_sup}
     Context:    child_terminated
     Reason:     {{badmatch,false},
                  [{rabbit_msg_store_ets_index,insert,2},
                   {rabbit_msg_store,write_message,3},
                   {rabbit_msg_store,handle_cast,2},
                   {gen_server2,handle_msg,2},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,&lt;0.232.0&gt;},
                  {name,msg_store_transient},
                  {mfargs,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                          
 &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at che-csebrokerp1</A>&quot;,
                           undefined,
                           {#Fun&lt;rabbit_variable_queue.0.66952436&gt;,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 11-Apr-2012::05:04:32 ===
     Supervisor: {local,rabbit_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.232.0&gt;},
                  {name,msg_store_transient},
                  {mfargs,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                          
 &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at che-csebrokerp1</A>&quot;,
                           undefined,
                           {#Fun&lt;rabbit_variable_queue.0.66952436&gt;,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]
...skipping...
=CRASH REPORT==== 11-Apr-2012::05:04:43 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.31907.9&gt;
    registered_name: []
    exception exit: {noproc,
                        {gen_server2,call,
                            [msg_store_transient,
                             {client_terminate,
                                
 &lt;&lt;213,104,174,241,176,121,164,159,98,43,221,
                                   160,120,109,6,107&gt;&gt;},
                             infinity]}}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.147.0&gt;]
    messages: []
    links: []
    dictionary: [{guid,{{9,&lt;0.31907.9&gt;},0}}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 443158598
  neighbours:

=SUPERVISOR REPORT==== 11-Apr-2012::05:04:43 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    shutdown_error
     Reason:     {noproc,
                     {gen_server2,call,
                         [msg_store_transient,
                          {client_terminate,
                              
&lt;&lt;213,104,174,241,176,121,164,159,98,43,221,160,
                                120,109,6,107&gt;&gt;},
                          infinity]}}
     Offender:   [{pid,&lt;0.31907.9&gt;},
                  {name,rabbit_amqqueue},
                  {mfa,{rabbit_amqqueue_process,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

Any help determining the cause would be appreciated.

Mark.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/c471ea9b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/c471ea9b/attachment.htm</A>&gt;
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019632.html">[rabbitmq-discuss] Bookmark to purge all the queues in a vhost
</A></li>
	<LI>Next message: <A HREF="019634.html">[rabbitmq-discuss] 2.4.1 broker failure/crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19633">[ date ]</a>
              <a href="thread.html#19633">[ thread ]</a>
              <a href="subject.html#19633">[ subject ]</a>
              <a href="author.html#19633">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
