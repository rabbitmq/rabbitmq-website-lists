<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20hipe_compile%20in%20RHEL%206&In-Reply-To=%3C4F9E6CE3.4050708%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019805.html">
   <LINK REL="Next"  HREF="019812.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Enabling hipe_compile in RHEL 6</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20hipe_compile%20in%20RHEL%206&In-Reply-To=%3C4F9E6CE3.4050708%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Enabling hipe_compile in RHEL 6">simon at rabbitmq.com
       </A><BR>
    <I>Mon Apr 30 11:43:47 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019805.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
        <LI>Next message: <A HREF="019812.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19806">[ date ]</a>
              <a href="thread.html#19806">[ thread ]</a>
              <a href="subject.html#19806">[ subject ]</a>
              <a href="author.html#19806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/04/12 10:38, Emile Joubert wrote:
&gt;&gt;<i>   I've changed the frame_max setting but that doesn't appear to
</I>&gt;&gt;<i> help. I've tried increasing the number of workers across additional
</I>&gt;&gt;<i> hardware as well, but Rabbit still seems to cap at 20k message/sec. When
</I>&gt;<i>
</I>&gt;<i> The maximum framesize allows you to choose between better latency (small
</I>&gt;<i> framesize) or throughput (large framesize). If many messages are larger
</I>&gt;<i> than 128Kb then increasing framesize may improve throughput (provided
</I>&gt;<i> consumers can keep up).
</I>
(But for small messages it makes no difference.)

&gt;<i> When you increased the number of workers, were you able to determine
</I>&gt;<i> whether the load was effectively spread amongst all of them? The QoS
</I>&gt;<i> prefetch count setting will help to ensure fair distribution. Try a
</I>&gt;<i> small number (e.g. 10) as a starting point for tuning this value.
</I>&gt;<i>
</I>&gt;&gt;<i> I set hipe_compile to true, the systems states 'Not HiPE compiling: HiPE
</I>&gt;&gt;<i> not found in this Erlang installation.' What's odd is
</I>&gt;&gt;<i> that erlang-hipe-R14B-04.1.el6.x86_64 is installed. Is there something
</I>&gt;&gt;<i> else that needs to be done for RHEL systems to enable hipe_compile? I
</I>&gt;<i>
</I>&gt;<i> That message means that your installation of Erlang lacks the hipe.beam
</I>&gt;<i> file in the code loading path. The name of the package that includes
</I>&gt;<i> this file depends on how Erlang was packaged in your system. Making use
</I>&gt;<i> of HiPE won't address the core problem though.
</I>
Well, HiPE will help if a CPU-bound RabbitMQ is in fact the bottleneck. 
It won't help if RabbitMQ is IO-bound, or not the bottleneck.

But HiPE is two parts; there are support libraries in the HiPE package, 
but there also needs to be support in the VM - and I've just had a quick 
look at Peter's Erlang packages installed on my CentOS 5 box and it 
looks like HiPE support is not compiled into the VM. (You should see 
&quot;[hipe]&quot; in the banner displayed when starting erl.) That's not the same 
RPM as you're using, but maybe it comes from the same source?

&gt;&gt;<i> think that it may help get beyond the current problem. If that doesn't
</I>&gt;&gt;<i> help, are there other settings or something I can look at to determine
</I>&gt;&gt;<i> where the bottleneck is? The RMQ server is 60% idle, doesn't have a
</I>&gt;&gt;<i> large amount of I/O wait, and doesn't seem to be saturating its network
</I>&gt;&gt;<i> cards (the server has a bonded ethernet interface). The worker machines
</I>&gt;&gt;<i> are relatively idle as well.
</I>&gt;<i>
</I>&gt;<i> Are *all* the workers idle, or are a small number taking all the load?
</I>&gt;<i> Uneven worker load is a potential cause for the problem you describe and
</I>&gt;<i> can be addressed using prefetch count:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count">http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count</A>
</I>
This is certainly suspicious. Something somewhere in your system ought 
to be running at 100% capacity. If your queues are growing it should be 
the workers, but the other possibility is that RabbitMQ is not able to 
push out messages fast enough to the consumers. If so you'll be happy to 
hear that the imminent 2.8.2 release has some performance improvements 
in that area.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019805.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
	<LI>Next message: <A HREF="019812.html">[rabbitmq-discuss] Enabling hipe_compile in RHEL 6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19806">[ date ]</a>
              <a href="thread.html#19806">[ thread ]</a>
              <a href="subject.html#19806">[ subject ]</a>
              <a href="author.html#19806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
