<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] private exchange name generation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20private%20exchange%20name%20generation&In-Reply-To=%3C20120409162823.GC15896%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019428.html">
   <LINK REL="Next"  HREF="019437.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] private exchange name generation</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20private%20exchange%20name%20generation&In-Reply-To=%3C20120409162823.GC15896%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] private exchange name generation">matthew at rabbitmq.com
       </A><BR>
    <I>Mon Apr  9 17:28:24 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019428.html">[rabbitmq-discuss] private exchange name generation
</A></li>
        <LI>Next message: <A HREF="019437.html">[rabbitmq-discuss] How to plan for RAM?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19426">[ date ]</a>
              <a href="thread.html#19426">[ thread ]</a>
              <a href="subject.html#19426">[ subject ]</a>
              <a href="author.html#19426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Apr 09, 2012 at 07:59:25PM +0400, Matwey V.  Kornilov wrote:
&gt;<i> It is hard to avoid collisions. If I create private exchange and its names 
</I>&gt;<i> and arguments coincide with such of other one, then there is no way to 
</I>&gt;<i> detect the collision. If type or args are different then I can detect it and 
</I>&gt;<i> try to regenerate the name.
</I>
Yeah, you can't actually solve that one robustly. The closest you can
get is to do a passive declare immediately before and hope it errors,
but that's a race condition anyway. Alas, tx does not capture resource
creation.

It's pretty yucky, but you could use a queue by the same name with
&quot;exclusive&quot; to act as a lock. Thus:

1. MyGuid = make_me_a_guid()
2. queue.declare (name = MyGuid, exclusive = true)
3. (if it hasn't errored) exchange.declare (name = MyGuid)

The reason that should work is because you can't redeclare an exclusive
queue unless you're the owner of it (i.e. you created it in the first
place). Thus on collision, you'll fail at step 2, even though step 3
would pass. Yes, it's yucky and a waste of resources, but it's the best
I can think of. Don't delete the queue until after you've deleted the
exchange.

Matthew
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019428.html">[rabbitmq-discuss] private exchange name generation
</A></li>
	<LI>Next message: <A HREF="019437.html">[rabbitmq-discuss] How to plan for RAM?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19426">[ date ]</a>
              <a href="thread.html#19426">[ thread ]</a>
              <a href="subject.html#19426">[ subject ]</a>
              <a href="author.html#19426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
