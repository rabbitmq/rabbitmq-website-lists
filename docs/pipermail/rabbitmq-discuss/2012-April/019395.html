<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] No message is delivered to consumer workers when	a message is requeued
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20No%20message%20is%20delivered%20to%20consumer%20workers%20when%0A%09a%20message%20is%20requeued&In-Reply-To=%3Cec3eb346-a028-4081-a14b-5e24a5c8de08%40jx17g2000pbb.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019446.html">
   <LINK REL="Next"  HREF="019404.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] No message is delivered to consumer workers when	a message is requeued</H1>
    <B>Pham Cong Dinh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20No%20message%20is%20delivered%20to%20consumer%20workers%20when%0A%09a%20message%20is%20requeued&In-Reply-To=%3Cec3eb346-a028-4081-a14b-5e24a5c8de08%40jx17g2000pbb.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] No message is delivered to consumer workers when	a message is requeued">pcdinh at gmail.com
       </A><BR>
    <I>Thu Apr  5 06:28:01 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019446.html">[rabbitmq-discuss] Cluster fails when current primary node shuts down.
</A></li>
        <LI>Next message: <A HREF="019404.html">[rabbitmq-discuss] No message is delivered to consumer workers	when a message is requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19395">[ date ]</a>
              <a href="thread.html#19395">[ thread ]</a>
              <a href="subject.html#19395">[ subject ]</a>
              <a href="author.html#19395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I got a strange issue with RabbitMQ when I launched 4 workers to
listen on a single queue to process incoming message.

However, there is a bug with worker that caused an invalid message can
not be processed successfully. In that case, that message will be
redelivered back to the original queue using

channel.basic_reject(delivery_tag, requeue=True) # Python code (Kombu
framework)
# Just reject the message. Not closing the channel or releasing
connection after that

As you may guess, none of 4 workers could process the message because
the bug. After that no worker received incoming message any more. The
output of strace shows that worker still polled RabbitMQ for new
message but they received no message. I also listed all the message
available in the queue using rabbitmqctl and found that there were 4
unacknowledged messages and a lot of incoming messages in the queue
too.

Have anyone here experienced the same issue?

My configuration:

consumer_options = {
    'exchange_name': 'feed',
    'exchange_type': 'direct',
    'queue_name': 'feed',
    'routing_key': 'importer',
    'durable': True,
    'delivery_mode': 2,
    'no_ack': False,
    'auto_ack': False,
    'prefetch_count': 1
}

I use the same consumer_tag for all workers. Did it cause any problem?

Thanks


Dinh
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019446.html">[rabbitmq-discuss] Cluster fails when current primary node shuts down.
</A></li>
	<LI>Next message: <A HREF="019404.html">[rabbitmq-discuss] No message is delivered to consumer workers	when a message is requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19395">[ date ]</a>
              <a href="thread.html#19395">[ thread ]</a>
              <a href="subject.html#19395">[ subject ]</a>
              <a href="author.html#19395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
