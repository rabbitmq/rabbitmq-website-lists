<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F9ADE54.108%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019788.html">
   <LINK REL="Next"  HREF="019505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F9ADE54.108%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Apr 27 18:58:44 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019788.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
        <LI>Next message: <A HREF="019505.html">[rabbitmq-discuss] RabbitMQ client behind firewall
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19795">[ date ]</a>
              <a href="thread.html#19795">[ thread ]</a>
              <a href="subject.html#19795">[ subject ]</a>
              <a href="author.html#19795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/04/12 15:42, DawgTool wrote:
&gt;<i> On 4/25/12 12:36 PM, Matthias Radestock wrote:
</I>&gt;&gt;<i> 2.7.1 can absorb longer spikes than 2.8.1; you can compensate for that
</I>&gt;&gt;<i> somewhat by increasing the tcp buffer sizes.
</I>&gt;&gt;<i>
</I>&gt;<i> Agreed that 2.7.1 absorbs the spikes, which I think a message broker
</I>&gt;<i> should be able to do.
</I>
Both 2.7.1 and 2.8.1 can absorb spikes. 2.7.1 can absorb longer ones by 
default but at a price (see below).

&gt;<i> Accept the message, route when message is ready or queue is available.
</I>
The downside of this approach is that the broker builds up an enormous 
backlog of work. Eventually it is going to have to catch up. And when it 
does then message acceptance rate slows to a crawl, or indeed stops 
completely for sustained periods of time. That is undesirable in most 
use cases.

Furthermore, the per-message cost of processing messages that way is 
higher since the system is more highly stressed - memory allocation, 
garbage collection, scheduling all become more expensive. And Rabbit's 
page-to-disk logic is working sub-optimally since it operates only on 
messages residing in queues. All this combined results in the number of 
messages that the broker can process over a longer period of time to be 
noticeably lower than with the new credit flow control.

Having said that, the ultimate &quot;accept messages as quickly as you can; 
think about them later&quot; behaviour is achieved by increasing the tcp 
buffer sizes, as I noted in my previous reply. So if that's the 
behaviour you are after, then I'd suggest you focus your tuning efforts 
there.

Matthias.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019788.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
	<LI>Next message: <A HREF="019505.html">[rabbitmq-discuss] RabbitMQ client behind firewall
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19795">[ date ]</a>
              <a href="thread.html#19795">[ thread ]</a>
              <a href="subject.html#19795">[ subject ]</a>
              <a href="author.html#19795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
