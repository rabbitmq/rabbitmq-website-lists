<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active-active crash report
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active-active%20crash%20report&In-Reply-To=%3C20120426223123.GA9230%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019765.html">
   <LINK REL="Next"  HREF="019773.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active-active crash report</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active-active%20crash%20report&In-Reply-To=%3C20120426223123.GA9230%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] Active-active crash report">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Apr 26 23:31:24 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019765.html">[rabbitmq-discuss] Active-active crash report
</A></li>
        <LI>Next message: <A HREF="019773.html">[rabbitmq-discuss] Active-active crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19769">[ date ]</a>
              <a href="thread.html#19769">[ thread ]</a>
              <a href="subject.html#19769">[ subject ]</a>
              <a href="author.html#19769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Vadim,

On Thu, Apr 26, 2012 at 01:01:20PM -0700, Vadim Chekan wrote:
&gt;<i> I'm testing my active-active setup (2.8.1, linux 64) and I am randomly
</I>&gt;<i> running into some crashes when I'm stopping a node. I can stop one node
</I>&gt;<i> abut another one fails along with it. Below is a crash log.
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 26-Apr-2012::12:15:59 ===
</I>&gt;<i> Discarding message
</I>&gt;<i> {'$gen_call',{&lt;0.1955.0&gt;,#Ref&lt;0.0.0.5513&gt;},{add_on_right,{9,&lt;0.1955.0&gt;}}}
</I>&gt;<i> from &lt;0.1955.0&gt; to &lt;0.26823.834&gt;
</I>&gt;<i>  in an old incarnation (2) of this node (3)
</I>
I'm worried about these messages. Someone else on this list has seen
this sort of thing too and it's causing them trouble. I've not seen this
issue myself in testing which is frustrating. However, that's not the
cause of your crash in this case (I think).

&gt;<i> ** Generic server &lt;0.1800.0&gt; terminating
</I>&gt;<i> ** Last message in was {'$gen_cast',{gm_deaths,[&lt;0.4684.0&gt;]}}
</I>&gt;<i> ** When Server state == {state,
</I>&gt;<i>                             {amqqueue,
</I>&gt;<i>                                 {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;test_29&quot;&gt;&gt;},
</I>&gt;<i>                                 true,false,&lt;0.1433.0&gt;,
</I>&gt;<i>                                 [{&lt;&lt;&quot;x-ha-policy&quot;&gt;&gt;,longstr,&lt;&lt;&quot;all&quot;&gt;&gt;},
</I>&gt;<i>                                  {&lt;&lt;&quot;x-message-ttl&quot;&gt;&gt;,signedint,600000}],
</I>&gt;<i>                                 &lt;0.1799.0&gt;,[],all},
</I>&gt;<i>                             &lt;0.1801.0&gt;,
</I>&gt;<i>                             {dict,0,16,16,8,80,48,
</I>&gt;<i> 
</I>&gt;<i> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i>                                  []},
</I>&gt;<i>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
</I>&gt;<i>                                   [],[]}}},
</I>&gt;<i>                             #Fun&lt;rabbit_mirror_queue_master.1.2951048&gt;,
</I>&gt;<i>                             #Fun&lt;rabbit_mirror_queue_master.2.72654940&gt;}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** {{case_clause,{ok,&lt;3066.9234.0&gt;,[&lt;0.4683.0&gt;]}},
</I>&gt;<i>     [{rabbit_mirror_queue_coordinator,handle_cast,2},
</I>&gt;<i>      {gen_server2,handle_msg,2},
</I>&gt;<i>      {proc_lib,wake_up,3}]}
</I>
Well this is very odd. We fixed a bug that looked like this, but it got
fixed in 2.7.1 (and related to x-ha-policy = nodes. Could you just check
that you really are running 2.8.1? We're not aware of any bug in this
area in 2.8.1, but that's certainly not saying there's not one there! Is
there any particular sequence of events that you can perform that
reliably triggers this crash? Could you also check the logs of the other
nodes (both .log and -sasl.log) to see if there's further crash reports
in there?

Also, there have been discovered lots of bugs relating to the code
changes made to add DLX support in 2.8.1, especially in relation to HA.
It's possible one of the issues I found with TTL and HA is causing this.
2.8.2 should be out soonish which might introduce fewer new bugs than it
fixes, but in the mean time, could you try without the TTL and see if
that helps?

Matthew
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019765.html">[rabbitmq-discuss] Active-active crash report
</A></li>
	<LI>Next message: <A HREF="019773.html">[rabbitmq-discuss] Active-active crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19769">[ date ]</a>
              <a href="thread.html#19769">[ thread ]</a>
              <a href="subject.html#19769">[ subject ]</a>
              <a href="author.html#19769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
