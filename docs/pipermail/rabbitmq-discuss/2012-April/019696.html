<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Sender-selected distribution appears to not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Sender-selected%20distribution%20appears%20to%20not%20work&In-Reply-To=%3CCBB8194B.1F05%25Michael.Laing%40nytimes.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019701.html">
   <LINK REL="Next"  HREF="019697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Sender-selected distribution appears to not work</H1>
    <B>Laing, Michael P.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Sender-selected%20distribution%20appears%20to%20not%20work&In-Reply-To=%3CCBB8194B.1F05%25Michael.Laing%40nytimes.com%3E"
       TITLE="[rabbitmq-discuss] Sender-selected distribution appears to not work">Michael.Laing at nytimes.com
       </A><BR>
    <I>Sat Apr 21 13:27:46 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019701.html">[rabbitmq-discuss] Redefining queue/exchange attributes
</A></li>
        <LI>Next message: <A HREF="019697.html">[rabbitmq-discuss] Sender-selected distribution appears to not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19696">[ date ]</a>
              <a href="thread.html#19696">[ thread ]</a>
              <a href="subject.html#19696">[ subject ]</a>
              <a href="author.html#19696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I would like to use this feature as documented at <A HREF="http://www.rabbitmq.com/blog/2011/03/">http://www.rabbitmq.com/blog/2011/03/</A> and <A HREF="http://www.rabbitmq.com/extensions.html">http://www.rabbitmq.com/extensions.html</A>

I tested both manually using the management console and with a coffeescript program but cannot make it work.

Of course it is possible &#8211; even probable &#8211; that I have an error in understanding&#8230; :)

My application is one where I would like to publish each message using multiple routing keys.

In general each subscriber will bind with one key.

Here is a test that fails both on my mac using RabbitMQ 2.7.1 / Erlang R15B and a linux box using RabbitMQ 2.7.1 / Erlang R14B:

# test.coffee
amqp = require 'amqp'

t1_message = (message, headers, properties) -&gt;
  console.log &quot;&quot;+
    &quot;\nSuccess: t1: message: #{JSON.stringify message}&quot;+
    &quot;\nheaders: #{JSON.stringify headers}&quot;+
    &quot;\nproperties: #{JSON.stringify properties, undefined, 4}&quot;

  process.exit 0

t0_message = (message, headers, properties) -&gt;
  console.log &quot;&quot;+
    &quot;\nBroadcast: t0: message: #{JSON.stringify message}&quot;+
    &quot;\nheaders: #{JSON.stringify headers}&quot;+
    &quot;\nproperties: #{JSON.stringify properties, undefined, 4}&quot;

bailout = -&gt;
  console.log &quot;\nFailure&quot;
  process.exit 1

amqp_connection = amqp.createConnection()

amqp_connection.on 'ready', () -&gt;
  properties = type:'topic', durable: true

  amqp_connection.exchange &quot;test&quot;, properties, (exchange) -&gt;
    properties = durable:true, autoDelete:false

    amqp_connection.queue &quot;t1&quot;, properties, (queue) -&gt;
      queue.bind exchange, &quot;foo&quot;

      queue.subscribe (message, headers, properties) -&gt;
        t1_message message, headers, properties

      amqp_connection.queue &quot;t0&quot;, properties, (queue) -&gt;
        queue.bind exchange, &quot;*&quot;

        queue.subscribe (message, headers, properties) -&gt;
          t0_message message, headers, properties

        cc_header = cc:[&quot;foo&quot;,&quot;bar&quot;]
        properties = contentType:&quot;application/json&quot;, headers:cc_header
        message = test:&quot;message content&quot;
        exchange.publish &quot;whatever&quot;, message, properties
        setTimeout bailout, 1000

Here's the output &#8211; if it had succeeded, both queues would have received the message:

Broadcast: t0: message: {&quot;test&quot;:&quot;message content&quot;}
headers: {&quot;cc&quot;:{&quot;0&quot;:&quot;foo&quot;,&quot;1&quot;:&quot;bar&quot;}}
properties: {
&quot;contentType&quot;: &quot;application/json&quot;,
&quot;headers&quot;: {

        &quot;cc&quot;: {
            &quot;0&quot;: &quot;foo&quot;,
            &quot;1&quot;: &quot;bar&quot;
        }
    },
    &quot;queue&quot;: &quot;t0&quot;,
    &quot;deliveryTag&quot;: 1,
    &quot;redelivered&quot;: false,
    &quot;exchange&quot;: &quot;test&quot;,
    &quot;routingKey&quot;: &quot;whatever&quot;,
    &quot;consumerTag&quot;: &quot;node-amqp-38169-0.10587440640665591&quot;
}

Failure
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/1668b6d9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/1668b6d9/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019701.html">[rabbitmq-discuss] Redefining queue/exchange attributes
</A></li>
	<LI>Next message: <A HREF="019697.html">[rabbitmq-discuss] Sender-selected distribution appears to not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19696">[ date ]</a>
              <a href="thread.html#19696">[ thread ]</a>
              <a href="subject.html#19696">[ subject ]</a>
              <a href="author.html#19696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
