<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Help understanding a crash report
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Help%20understanding%20a%20crash%20report&In-Reply-To=%3CCAE0Sz%3Dzmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025617.html">
   <LINK REL="Next"  HREF="025634.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Help understanding a crash report</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Help%20understanding%20a%20crash%20report&In-Reply-To=%3CCAE0Sz%3Dzmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Help understanding a crash report">jerryk at rbcon.com
       </A><BR>
    <I>Fri Feb 22 20:48:04 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025617.html">[rabbitmq-discuss] Help understanding a crash report
</A></li>
        <LI>Next message: <A HREF="025634.html">[rabbitmq-discuss] Help understanding a crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25633">[ date ]</a>
              <a href="thread.html#25633">[ thread ]</a>
              <a href="subject.html#25633">[ subject ]</a>
              <a href="author.html#25633">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Simone...

I am relatively new to Rabbitmq and would appreciate help in
&gt;<i> troubleshooting a recurring issue on a cluster, apologies for the long
</I>&gt;<i> email.
</I>&gt;<i>
</I>
No problem!  Details are usually helpful...


&gt;<i> I run a 3 instances cluster in ec2, 2 disk nodes (A and B) 1 ram node (C),
</I>&gt;<i> exchanges and queues are static and limited in number (less than 50), the
</I>&gt;<i> volume of messages can reach a few thousands per second and the queues can
</I>&gt;<i> occasionally grow up to a few hundred thousands until the processes manage
</I>&gt;<i> to catch up, but this is well within our memory/disk high watermark.
</I>&gt;<i> Rabbitmq is v. 2.8.4 on ubuntu 12.
</I>&gt;<i>
</I>
2.8.4 is now getting a bit old, and was from the middle of a sequence of
bug fix releases, during which many things improved...  you might want to
consider upgrading.  Before you do, see remarks below.


&gt;<i> I would like to better understand the crash report and perhaps have some
</I>&gt;<i> ideas on what went wrong and how to more effectively troubleshoot issues
</I>&gt;<i> (what more info should I collect before restarting the nodes, erlang
</I>&gt;<i> processes list, mnesia tables, ets tables etc).
</I>&gt;<i>
</I>&gt;<i> =CRASH REPORT==== 14-Feb-2013::10:36:54 ===
</I>&gt;<i>   crasher:
</I>&gt;<i>     initial call: rabbit_reader:init/4
</I>&gt;<i>     pid: &lt;*0.29283.387*&gt;
</I>&gt;<i>     registered_name: []
</I>&gt;<i>     exception error: bad argument
</I>&gt;<i>       in function  port_close/1
</I>&gt;<i>          called as port_close(#Port&lt;0.746540&gt;)
</I>&gt;<i>       in call from rabbit_net:maybe_fast_close/1
</I>&gt;<i>       in call from rabbit_reader:start_connection/7
</I>&gt;<i>     ancestors: [&lt;0.29280.387&gt;,rabbit_tcp_client_sup,rabbit_sup,&lt;0.161.0&gt;]
</I>&gt;<i>     messages: []
</I>&gt;<i>     links: [&lt;0.29280.387&gt;]
</I>&gt;<i>     dictionary: [{{channel,10},
</I>&gt;<i>                    {&lt;0.29364.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29338.387&gt;},{7,#Ref&lt;0.0.2158.60093&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29333.387&gt;},{6,#Ref&lt;0.0.2158.60085&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29325.387&gt;},{5,#Ref&lt;0.0.2158.60053&gt;}},
</I>&gt;<i>                   {{channel,3},
</I>&gt;<i>                    {&lt;0.29313.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29305.387&gt;},{2,#Ref&lt;0.0.2158.60002&gt;}},
</I>&gt;<i>                   {{channel,4},
</I>&gt;<i>                    {&lt;0.29321.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{channel,11},
</I>&gt;<i>                    {&lt;0.29370.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29313.387&gt;},{3,#Ref&lt;0.0.2158.60017&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29299.387&gt;},{1,#Ref&lt;0.0.2158.59976&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29346.387&gt;},{8,#Ref&lt;0.0.2158.60112&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29370.387&gt;},{11,#Ref&lt;0.0.2158.60189&gt;}},
</I>&gt;<i>                   {{channel,7},
</I>&gt;<i>                    {&lt;0.29338.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{channel,9},
</I>&gt;<i>                    {&lt;0.29356.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29321.387&gt;},{4,#Ref&lt;0.0.2158.60034&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29364.387&gt;},{10,#Ref&lt;0.0.2158.60166&gt;}},
</I>&gt;<i>                   {{ch_pid,&lt;0.29356.387&gt;},{9,#Ref&lt;0.0.2158.60140&gt;}},
</I>&gt;<i>                   {{channel,8},
</I>&gt;<i>                    {&lt;0.29346.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{channel,5},
</I>&gt;<i>                    {&lt;0.29325.387&gt;,{method,rabbit_framing_amqp_0_9_1}}},
</I>&gt;<i>                   {{channel,1},
</I>&gt;<i>                    {&lt;0.29299.387&gt;,
</I>&gt;<i>                     {content_body,
</I>&gt;<i>                         {'basic.publish',0,&lt;&lt;&quot;some_exchange&quot;&gt;&gt;,&lt;&lt;&gt;&gt;,false,
</I>&gt;<i>                             false},
</I>&gt;<i>                         1048189,
</I>&gt;<i>                         {content,60,none,
</I>&gt;<i>                             &lt;&lt;BYTES IN HERE&gt;&gt;,   --&gt; this showed which
</I>&gt;<i> process was sending the message
</I>&gt;<i>                             rabbit_framing_amqp_0_9_1,
</I>&gt;<i>                             [&lt;&lt;MORE BYTES IN HERE&gt;&gt;]  --&gt; This I haven't
</I>&gt;<i> been able to decode, it is fairly big, is it truncated?
</I>&gt;<i>
</I>
Unfortunately, nothing springs to mind immediately to pursue from this...


&gt;<i> And in the logs we can find the pid *0.29283.387 *right before the crash:
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 14-Feb-2013::10:31:46 ===
</I>&gt;<i> accepting AMQP connection &lt;*0.29283.387*&gt; (10.xx.xx.xx:58622 -&gt; 10.
</I>&gt;<i> xx.xx.xx:5672)
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 14-Feb-2013::10:31:46 ===
</I>&gt;<i> accepting AMQP connection &lt;0.29287.387&gt; (10.xx.xx.xx:58623 -&gt; 10.xx.xx.xx
</I>&gt;<i> :5672)
</I>&gt;<i>
</I>&gt;<i> =WARNING REPORT==== 14-Feb-2013::10:32:27 ===
</I>&gt;<i> closing AMQP connection &lt;0.27107.387&gt; (10.xx.xx.xx:50882 -&gt; 10.xx.xx.xx
</I>&gt;<i> :5672):
</I>&gt;<i> connection_closed_abruptly
</I>&gt;<i>
</I>
This could be pretty much anything, from client misbehavior to connection
disruption...

Looking at the rabbitmqctl report I have not been able to map the memory
&gt;<i> consumption to something specific yet.
</I>&gt;<i>
</I>
I'd proceed with an upgrade to a more recent Rabbit...  check here first:

<A HREF="http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/">http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/</A>

And if none of the changes in 3.0.x are going to provide you short term
inconvenience, then try going straight to the latest 3.0.2; if there are
3.0 changes that you think will bother you or require changes to your apps
or infrastructure, then jump to 2.8.6 for now... it was the seventh and
last of the 2.8.x series and contains a pile of incremental fixes that may
help with this (otherwise tricky to diagnose from what we have available
right now) problem.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/7e6e08aa/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/7e6e08aa/attachment.htm</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025617.html">[rabbitmq-discuss] Help understanding a crash report
</A></li>
	<LI>Next message: <A HREF="025634.html">[rabbitmq-discuss] Help understanding a crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25633">[ date ]</a>
              <a href="thread.html#25633">[ thread ]</a>
              <a href="subject.html#25633">[ subject ]</a>
              <a href="author.html#25633">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
