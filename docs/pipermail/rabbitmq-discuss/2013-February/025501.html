<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Python worker consuming 100% cpu
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Python%20worker%20consuming%20100%25%20cpu&In-Reply-To=%3CCAPmeV-OaLZPYfUp45yqLZXe9ovq2K0ovSREj7SBbxfaT1RyOfQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025507.html">
   <LINK REL="Next"  HREF="025506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Python worker consuming 100% cpu</H1>
    <B>Manuchandraprasad R</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Python%20worker%20consuming%20100%25%20cpu&In-Reply-To=%3CCAPmeV-OaLZPYfUp45yqLZXe9ovq2K0ovSREj7SBbxfaT1RyOfQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Python worker consuming 100% cpu">manuchandraprasadr at gmail.com
       </A><BR>
    <I>Thu Feb 14 09:25:13 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025507.html">[rabbitmq-discuss] rabbitmq-auth-backend-ldap patch adding caching and subtree searches
</A></li>
        <LI>Next message: <A HREF="025506.html">[rabbitmq-discuss] Python worker consuming 100% cpu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25501">[ date ]</a>
              <a href="thread.html#25501">[ thread ]</a>
              <a href="subject.html#25501">[ subject ]</a>
              <a href="author.html#25501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I worte this python script which acts as an RPC server by modifying the
default RPC example in RabbitMQ tutorial found
here&lt;<A HREF="http://www.rabbitmq.com/tutorials/tutorial-six-python.html">http://www.rabbitmq.com/tutorials/tutorial-six-python.html</A>&gt;.
It runs fine in my laptop. But when i run it in an amazon ec2 High CPU
Medium Instance with these specs :

1.7 GiB of memory

5 EC2 Compute Units (2 virtual cores with 2.5 EC2 Compute Units each)

350 GB of instance storage

It takes up 100% CPU. Although my laptop with almost the same config runs
this with less than 4% CPU use.I run this in Ubuntu-12.04 in both my laptop
and amazon.

Here is my code

    #!/usr/bin/env python
    import pika
    import commands
    import socket
    import base64

    connection = pika.BlockingConnection(pika.ConnectionParameters(
             host='localhost'))
    channel = connection.channel()
    channel.queue_declare(queue='rpc_queue')
    def on_request(ch, method, props, body):
        #print body
        body = base64.b64decode(body)
        print body
        run = commands.getoutput(body)
        response = socket.gethostname()
        print response
        ch.basic_publish(exchange='',
                        routing_key=props.reply_to,
                        properties=pika.BasicProperties(correlation_id = \
                                                      props.correlation_id),
                        body=str(response))
        ch.basic_ack(delivery_tag = method.delivery_tag)
    channel.basic_qos(prefetch_count=1)
    channel.basic_consume(on_request, queue='rpc_queue')
    print &quot; [x] Awaiting RPC requests&quot;
    channel.start_consuming()

How can i fix this ?

Manu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/de50e8b9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/de50e8b9/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025507.html">[rabbitmq-discuss] rabbitmq-auth-backend-ldap patch adding caching and subtree searches
</A></li>
	<LI>Next message: <A HREF="025506.html">[rabbitmq-discuss] Python worker consuming 100% cpu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25501">[ date ]</a>
              <a href="thread.html#25501">[ thread ]</a>
              <a href="subject.html#25501">[ subject ]</a>
              <a href="author.html#25501">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
