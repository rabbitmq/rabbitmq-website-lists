<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Python worker consuming 100% cpu
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Python%20worker%20consuming%20100%25%20cpu&In-Reply-To=%3CCAKwdTWeE67WCrdBaBa4XAgwzvo0D2mpX5CjvpHQRsw4PbZ8coQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025501.html">
   <LINK REL="Next"  HREF="025508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Python worker consuming 100% cpu</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Python%20worker%20consuming%20100%25%20cpu&In-Reply-To=%3CCAKwdTWeE67WCrdBaBa4XAgwzvo0D2mpX5CjvpHQRsw4PbZ8coQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Python worker consuming 100% cpu">gmr at meetme.com
       </A><BR>
    <I>Thu Feb 14 13:50:00 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025501.html">[rabbitmq-discuss] Python worker consuming 100% cpu
</A></li>
        <LI>Next message: <A HREF="025508.html">[rabbitmq-discuss] RabbitMQ LDAP Configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25506">[ date ]</a>
              <a href="thread.html#25506">[ thread ]</a>
              <a href="subject.html#25506">[ subject ]</a>
              <a href="author.html#25506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It's an issue that is fixed in pika's master branch and will be pushed to
pypi soon. You can test by installing pika with pip from git.

On Thursday, February 14, 2013, Manuchandraprasad R wrote:

&gt;<i> I worte this python script which acts as an RPC server by modifying the
</I>&gt;<i> default RPC example in RabbitMQ tutorial found here&lt;<A HREF="http://www.rabbitmq.com/tutorials/tutorial-six-python.html">http://www.rabbitmq.com/tutorials/tutorial-six-python.html</A>&gt;.
</I>&gt;<i> It runs fine in my laptop. But when i run it in an amazon ec2 High CPU
</I>&gt;<i> Medium Instance with these specs :
</I>&gt;<i>
</I>&gt;<i> 1.7 GiB of memory
</I>&gt;<i>
</I>&gt;<i> 5 EC2 Compute Units (2 virtual cores with 2.5 EC2 Compute Units each)
</I>&gt;<i>
</I>&gt;<i> 350 GB of instance storage
</I>&gt;<i>
</I>&gt;<i> It takes up 100% CPU. Although my laptop with almost the same config runs
</I>&gt;<i> this with less than 4% CPU use.I run this in Ubuntu-12.04 in both my laptop
</I>&gt;<i> and amazon.
</I>&gt;<i>
</I>&gt;<i> Here is my code
</I>&gt;<i>
</I>&gt;<i>     #!/usr/bin/env python
</I>&gt;<i>     import pika
</I>&gt;<i>     import commands
</I>&gt;<i>     import socket
</I>&gt;<i>     import base64
</I>&gt;<i>
</I>&gt;<i>     connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>              host='localhost'))
</I>&gt;<i>     channel = connection.channel()
</I>&gt;<i>     channel.queue_declare(queue='rpc_queue')
</I>&gt;<i>     def on_request(ch, method, props, body):
</I>&gt;<i>         #print body
</I>&gt;<i>         body = base64.b64decode(body)
</I>&gt;<i>         print body
</I>&gt;<i>         run = commands.getoutput(body)
</I>&gt;<i>         response = socket.gethostname()
</I>&gt;<i>         print response
</I>&gt;<i>         ch.basic_publish(exchange='',
</I>&gt;<i>                         routing_key=props.reply_to,
</I>&gt;<i>                         properties=pika.BasicProperties(correlation_id = \
</I>&gt;<i>                                                       props.correlation_id),
</I>&gt;<i>                         body=str(response))
</I>&gt;<i>         ch.basic_ack(delivery_tag = method.delivery_tag)
</I>&gt;<i>     channel.basic_qos(prefetch_count=1)
</I>&gt;<i>     channel.basic_consume(on_request, queue='rpc_queue')
</I>&gt;<i>     print &quot; [x] Awaiting RPC requests&quot;
</I>&gt;<i>     channel.start_consuming()
</I>&gt;<i>
</I>&gt;<i>  How can i fix this ?
</I>&gt;<i>
</I>&gt;<i> Manu
</I>


-- 

Gavin M. Roy
Chief Technology Officer

&lt;<A HREF="http://www.meetme.com/">http://www.meetme.com/</A>&gt;
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

&lt;<A HREF="https://www.facebook.com/pages/MeetMe/21931227129">https://www.facebook.com/pages/MeetMe/21931227129</A>&gt;
&lt;<A HREF="https://twitter.com/meetme">https://twitter.com/meetme</A>&gt;
    &lt;<A HREF="http://www.youtube.com/user/MeetMeVideos">http://www.youtube.com/user/MeetMeVideos</A>&gt;

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/5170b101/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/5170b101/attachment.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025501.html">[rabbitmq-discuss] Python worker consuming 100% cpu
</A></li>
	<LI>Next message: <A HREF="025508.html">[rabbitmq-discuss] RabbitMQ LDAP Configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25506">[ date ]</a>
              <a href="thread.html#25506">[ thread ]</a>
              <a href="subject.html#25506">[ subject ]</a>
              <a href="author.html#25506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
