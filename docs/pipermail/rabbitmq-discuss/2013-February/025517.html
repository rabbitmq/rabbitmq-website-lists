<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unable to delete vhost
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unable%20to%20delete%20vhost&In-Reply-To=%3C8e0160d2-c8fa-4289-a7da-3767ca00de40%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025516.html">
   <LINK REL="Next"  HREF="025520.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unable to delete vhost</H1>
    <B>Ben Corlett</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Unable%20to%20delete%20vhost&In-Reply-To=%3C8e0160d2-c8fa-4289-a7da-3767ca00de40%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Unable to delete vhost">ben.corlett at gmail.com
       </A><BR>
    <I>Fri Feb 15 12:08:08 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025516.html">[rabbitmq-discuss] Python to Java
</A></li>
        <LI>Next message: <A HREF="025520.html">[rabbitmq-discuss] Unable to delete vhost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25517">[ date ]</a>
              <a href="thread.html#25517">[ thread ]</a>
              <a href="subject.html#25517">[ subject ]</a>
              <a href="author.html#25517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am having some issues when trying to delete a vhost. 

I'm using the latest version of rabbitmq 3.0.2 and my set up has two 
clusters (2 machines in each) with a federation for pub/sub messages. 

When trying to remove the vhost via the web interface I get the error :

Internal Server Error

The server encountered an error while processing this request:
{throw,
    {error,
        {{badmatch,
             {error_string,
                 &quot;Validation failed\n\nname not recognised: undefined\n&quot;}},
         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
          {rabbit_vhost,internal_delete,1},
          {rabbit_vhost,'-delete/1-fun-0-',1},
          {mnesia_tm,apply_fun,3},
          {mnesia_tm,execute_transaction,5},
          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
          {worker_pool_worker,handle_call,3},
          {gen_server2,handle_msg,2}]}},
    [{rabbit_misc,execute_mnesia_transaction,1},
     {rabbit_mgmt_wm_vhost,delete_resource,2},
     {webmachine_resource,resource_call,3},
     {webmachine_resource,do,3},
     {webmachine_decision_core,resource_call,1},
     {webmachine_decision_core,decision,1},
     {webmachine_decision_core,handle_request,2},
     {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}

When trying to remove the vhost from the command line I get something 
similar :

[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq at chi-sc-cget-m-rabbitmq-001</A> ~]$ rabbitmqctl delete_vhost 
v4e73843117c745bb8c1796c2a423b177
Deleting vhost &quot;v4e73843117c745bb8c1796c2a423b177&quot; ...
Error: {{badmatch,{error_string,&quot;Validation failed\n\nname not recognised: 
undefined\n&quot;}},
        [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
         {rabbit_vhost,internal_delete,1},
         {rabbit_vhost,'-delete/1-fun-0-',1},
         {mnesia_tm,apply_fun,3},
         {mnesia_tm,execute_transaction,5},
         {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
         {worker_pool_worker,handle_call,3},
         {gen_server2,handle_msg,2}]}


Here are the commands to initially set up the vhost via a script (the hosts 
used here are vips which are load balanced across both nodes in the 
cluster) :

Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare vhost 
name=v46997afd74174f1ea120fbeae38877b9 2&gt;&amp;1
vhost declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare vhost 
name=v46997afd74174f1ea120fbeae38877b9 2&gt;&amp;1
vhost declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user 
name=aumh4l0SBFJBe3 password=***** tags= 2&gt;&amp;1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user 
name=aumh4l0SBFJBe3 password=***** tags= 2&gt;&amp;1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.* 
read=.* write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.* 
read=.* write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=federate-me 
pattern=&quot;^ps.&quot; 'definition={&quot;federation-upstream-set&quot;:&quot;all&quot;}' 2&gt;&amp;1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=federate-me 
pattern=&quot;^ps.&quot; 'definition={&quot;federation-upstream-set&quot;:&quot;all&quot;}' 2&gt;&amp;1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all 
pattern=&quot;^ha.&quot; 'definition={&quot;ha-mode&quot;:&quot;all&quot;}' 2&gt;&amp;1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all 
pattern=&quot;^ha.&quot; 'definition={&quot;ha-mode&quot;:&quot;all&quot;}' 2&gt;&amp;1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation-upstream name=my-upstream 
value='{&quot;uri&quot;:&quot;<A HREF="amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com&quot;,&quot;expires&quot;:3600000}'">amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com&quot;,&quot;expires&quot;:3600000}'</A>
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation name=local-username value='&quot;aumh4l0SBFJBe3&quot;'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation-upstream name=my-upstream 
value='{&quot;uri&quot;:&quot;<A HREF="amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com&quot;,&quot;expires&quot;:3600000}'">amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com&quot;,&quot;expires&quot;:3600000}'</A>
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation name=local-username value='&quot;aumh4l0SBFJBe3&quot;'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user name=urFZ5xudDA1Sk 
password=***** tags= 2&gt;&amp;1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user name=urFZ5xudDA1Sk 
password=***** tags= 2&gt;&amp;1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.* 
read=.* write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.* 
read=.* write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2&gt;&amp;1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2&gt;&amp;1
permission declared

Here are the commands used to clean away this vhost :

Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=urFZ5xudDA1Sk 
2&gt;&amp;1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=urFZ5xudDA1Sk 
2&gt;&amp;1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation-upstream name=my-upstream 2&gt;&amp;1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation-upstream name=my-upstream 2&gt;&amp;1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation name=local-username 2&gt;&amp;1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation name=local-username 2&gt;&amp;1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me 
2&gt;&amp;1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me 
2&gt;&amp;1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2&gt;&amp;1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2&gt;&amp;1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete vhost 
name=v46997afd74174f1ea120fbeae38877b9 2&gt;&amp;1
Traceback (most recent call last):\n  File 
&quot;/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin&quot;, line 889, in 
&lt;module&gt;\n    main()\n  File 
&quot;/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin&quot;, line 354, in main\n 
   method()\n  File &quot;/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin&quot;, 
line 534, in invoke_delete\n    self.delete(uri)\n  File 
&quot;/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin&quot;, line 386, in 
delete\n    return self.http(&quot;DELETE&quot;, &quot;/api%s&quot; % path, &quot;&quot;)\n  File 
&quot;/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin&quot;, line 421, in http\n 
   % (resp.status, resp.reason, path, resp.read()))\nException: Received 
500 Internal Server Error for path 
/api/vhosts/v46997afd74174f1ea120fbeae38877b9\n&lt;html&gt;&lt;head&gt;&lt;title&gt;500 
Internal Server Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Internal Server Error&lt;/h1&gt;The 
server encountered an error while processing this 
request:&lt;br&gt;&lt;pre&gt;{throw,\n    {error,\n        {{badmatch,\n             
{error_string,\n                 &quot;Validation failed\n\nname not recognised: 
undefined\n&quot;}},\n         
[{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n         
 {rabbit_vhost,internal_delete,1},\n         
 {rabbit_vhost,'-delete/1-fun-0-',1},\n          {mnesia_tm,apply_fun,3},\n 
         {mnesia_tm,execute_transaction,5},\n         
 {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n         
 {worker_pool_worker,handle_call,3},\n         
 {gen_server2,handle_msg,2}]}},\n   
 [{rabbit_misc,execute_mnesia_transaction,1},\n     
{rabbit_mgmt_wm_vhost,delete_resource,2},\n     
{webmachine_resource,resource_call,3},\n     {webmachine_resource,do,3},\n 
    {webmachine_decision_core,resource_call,1},\n     
{webmachine_decision_core,decision,1},\n     
{webmachine_decision_core,handle_request,2},\n     
{rabbit_webmachine,'-makeloop/1-fun-0-',2}]}&lt;/pre&gt;&lt;P&gt;&lt;HR&gt;&lt;ADDRESS&gt;mochiweb+webmachine 
web server&lt;/ADDRESS&gt;&lt;/body&gt;&lt;/html&gt;\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=aumh4l0SBFJBe3 
2&gt;&amp;1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=aumh4l0SBFJBe3 
2&gt;&amp;1
user deleted\n

Anyone got any ideas?

Thanks,

Ben.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/dacdad8b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/dacdad8b/attachment.htm</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025516.html">[rabbitmq-discuss] Python to Java
</A></li>
	<LI>Next message: <A HREF="025520.html">[rabbitmq-discuss] Unable to delete vhost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25517">[ date ]</a>
              <a href="thread.html#25517">[ thread ]</a>
              <a href="subject.html#25517">[ subject ]</a>
              <a href="author.html#25517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
