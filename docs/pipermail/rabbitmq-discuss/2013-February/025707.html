<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Producer confirms as a heuristic for rate limiting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producer%20confirms%20as%20a%20heuristic%20for%20rate%0A%20limiting&In-Reply-To=%3C7509F24FF37749B7AB16B2C3B72775DE%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025702.html">
   <LINK REL="Next"  HREF="025710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Producer%20confirms%20as%20a%20heuristic%20for%20rate%0A%20limiting&In-Reply-To=%3C7509F24FF37749B7AB16B2C3B72775DE%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Feb 28 08:49:28 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025702.html">[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting
</A></li>
        <LI>Next message: <A HREF="025710.html">[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25707">[ date ]</a>
              <a href="thread.html#25707">[ thread ]</a>
              <a href="subject.html#25707">[ subject ]</a>
              <a href="author.html#25707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias, 


On Wednesday, 27 February 2013 at 18:52, Matthias Radestock wrote:

&gt;<i> Using confirms to exert back pressure on a producing application is
</I>&gt;<i> fine. But I wouldn't expect that to result in particularly stable 
</I>&gt;<i> latencies. For a few reasons:
</I>&gt;<i> 
</I>&gt;<i> 1) one way that the internal confirm logic gets triggered is by &quot;absence 
</I>&gt;<i> of other stuff happening&quot;, so when throttling producers, confirms may 
</I>&gt;<i> well happen a lot quicker.
</I>&gt;<i> 
</I>
If I understand you correctly, then this is precisely the feedback loop that I'm trying to achieve - when the sender is throttled, this gives the internals of Rabbit more head room to do whatever it is a Rabbit does. In Rabbit becoming more free, the rate of confirms increases, and hence the more credit the sender will receive. When the sender ramps up again, the reverse should happen, and so the feedback cycle continues.
 
&gt;<i> 
</I>&gt;<i> 2) more generally, much of the internal confirm logic will try to batch 
</I>&gt;<i> things if it can, which reduces the overall cost but makes the timing of 
</I>&gt;<i> confirms more variable.
</I>

That's understandable - fine grained ingress credits would come at a premium in any case.

In my scenario I'm setting a timestamp into the message header and the receiver is decoding this in order to compare it with its current timestamp. With the measurement being end to end, would the asynchronous nature of the confirms not be obviated by the fact that you are measuring the speed of the uplink plus the routing overhead plus the speed of a separate delivery (he says had waving)?
 
&gt;<i> 3) confirms do come at a noticeable penalty on throughput and latency. 
</I>&gt;<i> So a benchmark employing confirms would not be a very good proxy for a 
</I>&gt;<i> real system running w/o confirms.
</I>

What constitutes the performance penalty in this case? Do confirms increase the latency because they add to the measurable round trip as seen by the sender, or does the fact that they are turned on add extra processing effort which is CPU time that has to be spread over each message and hence on average adding latency to each message? If the answer is the latter, does the same apply to throughput - since confirms have a non-zero accounting cost, having them turned on diminishes the ability to process as many items in the same amount of time? 
 
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Having said all that, go and try it :)
</I>
I'm very tempted, but the reason why I'm asking first is to avoid going down any rabbit holes that a more experienced person could potentially advise me to avoid :-)

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/c8177618/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/c8177618/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025702.html">[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting
</A></li>
	<LI>Next message: <A HREF="025710.html">[rabbitmq-discuss] Producer confirms as a heuristic for rate limiting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25707">[ date ]</a>
              <a href="thread.html#25707">[ thread ]</a>
              <a href="subject.html#25707">[ subject ]</a>
              <a href="author.html#25707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
