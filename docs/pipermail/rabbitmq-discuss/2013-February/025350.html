<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ scaling with OpenStack
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20scaling%20with%20OpenStack&In-Reply-To=%3C1360086653814-24874.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025349.html">
   <LINK REL="Next"  HREF="025422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ scaling with OpenStack</H1>
    <B>Ray Pekowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20scaling%20with%20OpenStack&In-Reply-To=%3C1360086653814-24874.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ scaling with OpenStack">pekowski at gmail.com
       </A><BR>
    <I>Tue Feb  5 17:50:53 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025349.html">[rabbitmq-discuss] about the deliver confirm
</A></li>
        <LI>Next message: <A HREF="025422.html">[rabbitmq-discuss] RabbitMQ scaling with OpenStack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25350">[ date ]</a>
              <a href="thread.html#25350">[ thread ]</a>
              <a href="subject.html#25350">[ subject ]</a>
              <a href="author.html#25350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ask Solem-3 wrote
&gt;&gt;<i> On Jan 22, 2013, at 1:58 PM, Ask Solem 
</I>&gt;<i> &lt;ask at rabbitmq.com&gt;
</I>&gt;<i>  wrote:
</I>&gt;<i> 
</I>&gt;<i> I've spent some time reviewing the code, but it's really hard to follow,
</I>&gt;<i> and it's
</I>&gt;<i> reinventing a lot of things that Kombu already supports.   Having two sets
</I>&gt;<i> of
</I>&gt;<i> implementations means that we both have to debug and maintain it, this
</I>&gt;<i> code could
</I>&gt;<i> definitely be reduced by a lot.
</I>
Thank you for taking the time to review the code.  Yes, it is confusing and
perhaps impossible to fully understand without also reading amqp.py
(<A HREF="https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/amqp.py">https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/amqp.py</A>),
which is a common module between the kombu and Qpid implementations for
OpenStack.


Ask Solem-3 wrote
&gt;<i> One thing that I'm unable to understand is whether it's creating a channel
</I>&gt;<i> or not
</I>&gt;<i> (other than the Connection.default_channel), and if so if it creates a
</I>&gt;<i> channel for
</I>&gt;<i> every request.  This would be bad since creating channels is very
</I>&gt;<i> expensive (at least in amqplib/py-amqp).
</I>
It does not create a new channel on each request.  The channel object is
held in a impl_kombu.Connection class instance and instances of
impl_kombu.Connection are pooled.  You can find the pool implementation in
amqp.py that I mentioned earlier.


Ask Solem-3 wrote
&gt;<i> Also, it seems that the reply messages are persistent, do they have to be?
</I>
The reply messages are RPC replies are implemented in the DirectPublisher
class which has {'durable': False} for its exchange and queue options.  The
RPC call is done via the TopicPublisher class and it has the durable option
that defaults to False, but can be overridden using a OpenStack nova.conf
file configuration setting.

BTW, one of the questions that has come up is whether it makes sense for the
RPC reply queues to mirrored.  Is HA generally thought of as important for
RPC replies?  I just am not sure.  Our current implementation has mirroring
turned off for reply queues, but we are trying to figure out if that was
just an oversight.

Ray








--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-scaling-with-OpenStack-tp24646p24874.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-scaling-with-OpenStack-tp24646p24874.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025349.html">[rabbitmq-discuss] about the deliver confirm
</A></li>
	<LI>Next message: <A HREF="025422.html">[rabbitmq-discuss] RabbitMQ scaling with OpenStack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25350">[ date ]</a>
              <a href="thread.html#25350">[ thread ]</a>
              <a href="subject.html#25350">[ subject ]</a>
              <a href="author.html#25350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
