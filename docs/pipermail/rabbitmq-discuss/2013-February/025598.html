<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] about &quot;exactly&quot; policy on RabbitMQ 3.0.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20about%20%22exactly%22%20policy%20on%20RabbitMQ%203.0.1&In-Reply-To=%3C5125F821.40409%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025594.html">
   <LINK REL="Next"  HREF="025601.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] about &quot;exactly&quot; policy on RabbitMQ 3.0.1</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20about%20%22exactly%22%20policy%20on%20RabbitMQ%203.0.1&In-Reply-To=%3C5125F821.40409%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] about &quot;exactly&quot; policy on RabbitMQ 3.0.1">simon at rabbitmq.com
       </A><BR>
    <I>Thu Feb 21 10:34:09 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025594.html">[rabbitmq-discuss] about &quot;exactly&quot; policy on RabbitMQ 3.0.1
</A></li>
        <LI>Next message: <A HREF="025601.html">[rabbitmq-discuss] RabbitMQ cluster with potentially millions	of connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25598">[ date ]</a>
              <a href="thread.html#25598">[ thread ]</a>
              <a href="subject.html#25598">[ subject ]</a>
              <a href="author.html#25598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/02/13 07:58, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">t.otoda.freemail at gmail.com</A> wrote:
&gt;<i> 1. How does RabbitMQ select nodes that queue is mirrored to in the cluster ?
</I>&gt;<i>
</I>&gt;<i>     I want to know
</I>&gt;<i>     whether all mirrored Queue is mirrored to same 3 nodes,
</I>&gt;<i>     when there are more than 3 nodes in the cluster.
</I>
When the queue is first created, the nodes are selected randomly.

However, if you then take all the nodes in the cluster down and bring 
them back up again, all queues will end up on the same three nodes - 
because the queue will have come up on the first three nodes to be 
available rather than waiting for the nodes it was originally on - since 
there's no guarantee those nodes will ever come back up. I think this is 
the best we can do without becoming a lot more complicated, having 
queues migrate around the cluster for load balancing.

&gt;<i> 2. With the following cases,
</I>&gt;<i>     what does RabbitMQ set &quot;exactly&quot; policy do ?
</I>&gt;<i>
</I>&gt;<i> # As a premise,
</I>&gt;<i> # I suppose ha-params to be 3.
</I>&gt;<i>
</I>&gt;<i>    1) 1 node ( named A) to which Queue is mirrored goes down
</I>&gt;<i>
</I>&gt;<i>       I want to know
</I>&gt;<i>       whether RabbitMQ continue to publish messages to other 2 nodes
</I>&gt;<i> (named B and C)
</I>&gt;<i>       without data lost.
</I>
Yes.

&gt;<i>
</I>&gt;<i>    2) after 1), A is recovered
</I>&gt;<i>
</I>&gt;<i>       I want to know
</I>&gt;<i>       whether Queue is mirrored to it again.
</I>
Yes.

&gt;<i>    3) instead of 2), another node ( named D ) is added in the cluster
</I>&gt;<i>
</I>&gt;<i>       What should I do to allow Queue to be mirrored to D
</I>&gt;<i>       instead of A ?
</I>
It should be mirrored to D, you shouldn't need to do anything - assuming 
there is an {exactly, 3} queue, and two nodes in the cluster, and a 
third comes up, it should mirror to the new node regardless of whether 
that node was in the cluster before.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025594.html">[rabbitmq-discuss] about &quot;exactly&quot; policy on RabbitMQ 3.0.1
</A></li>
	<LI>Next message: <A HREF="025601.html">[rabbitmq-discuss] RabbitMQ cluster with potentially millions	of connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25598">[ date ]</a>
              <a href="thread.html#25598">[ thread ]</a>
              <a href="subject.html#25598">[ subject ]</a>
              <a href="author.html#25598">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
