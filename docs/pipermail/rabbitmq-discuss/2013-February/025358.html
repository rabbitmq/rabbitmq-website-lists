<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Correct way of determining which node is master?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Correct%20way%20of%20determining%20which%20node%20is%0A%20master%3F&In-Reply-To=%3Cc6506d1e-5e48-4d17-aabf-acd9b9ed3898%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025352.html">
   <LINK REL="Next"  HREF="025363.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Correct way of determining which node is master?</H1>
    <B>aminer at groupon.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Correct%20way%20of%20determining%20which%20node%20is%0A%20master%3F&In-Reply-To=%3Cc6506d1e-5e48-4d17-aabf-acd9b9ed3898%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Correct way of determining which node is master?">aminer at groupon.com
       </A><BR>
    <I>Tue Feb  5 20:11:17 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025352.html">[rabbitmq-discuss] Publisher confirms clarification
</A></li>
        <LI>Next message: <A HREF="025363.html">[rabbitmq-discuss] Correct way of determining which node is	master?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25358">[ date ]</a>
              <a href="thread.html#25358">[ thread ]</a>
              <a href="subject.html#25358">[ subject ]</a>
              <a href="author.html#25358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm faced with much the same issue Matt P. mentions, but I wanted to make 
sure I understand how this works.  Is the following correct?

The system is set up to have a set of three hosts each running a single 
RabbitMQ node.  A load-balancer routes traffic evenly between all the 
nodes, and has a health-check to determine whether each node is active and 
healthy.  The entire cluster is served by a single external IP address 
(which points to the load balancer).

Within the cluster, let's say I have a topic exchange, and a number of 
clients who each subscribe to a specific topic (several clients to a topic) 
by creating a permanent, named queue for themselves and binding it to the 
exchange.  The messages come from another server whose sole function is to 
generate these messages and publish them to the exchange.  Let's assume 
everyone connects successfully and a while passes during which everyone 
gets their messages as expected.

Then, one node fails.  The load balancer detects this and stop routing new 
connections to that machine.  All clients connected to that node lose their 
connections and re-connect (through the load balancer) to one of the 
functioning nodes.  They re-subscribe to their named queues, and find all 
the messages they missed while they were re-connecting are waiting for them 
(assuming the mirroring was up-to-date when the one node failed), and 
continue to receive all new messages posted to their topics.

The server publishing the messages opens and closes its connection each 
time it needs to publish a message, so it notices nothing.  The load 
balancer automatically routes it to a functioning node, and publishes to 
the exchange which automatically routes the message to the queue no matter 
what node is current the master node for that queue.

Am I missing anything here?  Thanks very much for any help!


On Wednesday, February 22, 2012 12:10:05 PM UTC-8, Matthew Sackman wrote:
&gt;<i>
</I>&gt;<i> On Wed, Feb 22, 2012 at 10:39:04AM -0800, Matt Pietrek wrote:
</I>&gt;<i> &gt; | Messages are *always* read from the master node (for a given queue).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This is very helpful. Going a step further, is it true to say that in a
</I>&gt;<i> &gt; cluster where we mirror all queues, there's really no benefit to 
</I>&gt;<i> assigning
</I>&gt;<i> &gt; the VIP to one node over another?
</I>&gt;<i>
</I>&gt;<i> Correct, though for performance reasons you might like to ensure the
</I>&gt;<i> masters are roughly uniformly spread over all the nodes.
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq... at lists.rabbitmq.com</A> &lt;javascript:&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/d7dc9fad/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/d7dc9fad/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025352.html">[rabbitmq-discuss] Publisher confirms clarification
</A></li>
	<LI>Next message: <A HREF="025363.html">[rabbitmq-discuss] Correct way of determining which node is	master?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25358">[ date ]</a>
              <a href="thread.html#25358">[ thread ]</a>
              <a href="subject.html#25358">[ subject ]</a>
              <a href="author.html#25358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
