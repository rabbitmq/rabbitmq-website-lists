<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High Performance Setup Strategy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20Performance%20Setup%20Strategy&In-Reply-To=%3CCAJXWVj6%2BNr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025549.html">
   <LINK REL="Next"  HREF="025553.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High Performance Setup Strategy</H1>
    <B>Florian M&#252;ller</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20Performance%20Setup%20Strategy&In-Reply-To=%3CCAJXWVj6%2BNr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] High Performance Setup Strategy">max06.net at googlemail.com
       </A><BR>
    <I>Mon Feb 18 13:45:36 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025549.html">[rabbitmq-discuss] High Performance Setup Strategy
</A></li>
        <LI>Next message: <A HREF="025553.html">[rabbitmq-discuss] High Performance Setup Strategy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25550">[ date ]</a>
              <a href="thread.html#25550">[ thread ]</a>
              <a href="subject.html#25550">[ subject ]</a>
              <a href="author.html#25550">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

2013/2/18 Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;

&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> On 18/02/13 10:53, Florian M&#252;ller wrote:
</I>&gt;<i> &gt; (Using only one exchange crashes when reaching 64k bindings)
</I>&gt;<i>
</I>&gt;<i> Do you have a crash report or a logfile entry from this crash? If you
</I>&gt;<i> can explain the precise nature of the difficulty encountered at this
</I>&gt;<i> point then it might apply in the 120k case as well.
</I>&gt;<i>
</I>
Sadly no system log. Just an own snippet:

17:57:12316599977 #13371 17:56:49: bind_65534
#13371 17:56:49: =============&gt; EXCEPTION: Error: NOT_FOUND - no exchange
'getNotificaions' in vhost '/websocket'
(The exchange disappeared completely - It happened on Dec. 3rd 2012, it
might be already fixed in newer version, we didn't test it)

When we started this project, we used only one exchange (direct) for all
messages. At exactly the 64k th (+1?) Binding on this one exchange, the
whole thing crashed. So we decided to split the exchange up to 100, and
distribute the users to specific ones (for example User ID xxxxxxxx817 -&gt;
exchange17). That balances the bindings well.


&gt;<i> &gt; Problem:
</I>&gt;<i> &gt; Queues are starting to fill up when reaching 120k Bindings (130-140k
</I>&gt;<i> &gt; unique Websocket-Connections). 4-6k delivered Msg/s.
</I>&gt;<i>
</I>&gt;<i> Queues getting longer is not normally a cause for concern, unless your
</I>&gt;<i> hardware spec is not sufficient to deal with so many queues when they
</I>&gt;<i> get longer. Queues will consume more broker resources when they get
</I>&gt;<i> longer. Consider setting a TTL limit to make sure queues don't grow very
</I>&gt;<i> long: <A HREF="http://www.rabbitmq.com/ttl.html">http://www.rabbitmq.com/ttl.html</A>
</I>&gt;<i>
</I>
Hardware-Specs of the &quot;big&quot; one should be more than enough... 2* Xeon E5645
2.40 GHz, 24GB ram, 50G SSD (not in use), GBit Ethernet. Ram usage stays
below 40% all the time.

We're already using TTL, every Messageis being redirected after 5 seconds
to a separate Queue (for debugging).


&gt;<i> Queues getting longer could be a sign that consumers are not able to
</I>&gt;<i> keep up, or some other bottleneck between the broker and consumers. Make
</I>&gt;<i> sure the network is not saturated.
</I>&gt;<i>
</I>
Every consumer (Nodejs-Sockets, 16 per Host, 3 Hosts) is fine at crashing
time. Load is below 30%. Ram is far away from limit.
(Network bandwidth needs to be checked, but reproduction is not a good
idea, because we can only reach this load in production environment)


&gt;<i>
</I>&gt;<i> Do changes to the consumption patterns make any difference to limit for
</I>&gt;<i> maximum number of bindings? E.g. What happens when you change the
</I>&gt;<i> prefetch count, or switch between server-side and client-side
</I>&gt;<i> acknowledgements?
</I>&gt;<i>
</I>
Forwarding this to dev...

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Florian
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/75f6f4ea/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/75f6f4ea/attachment.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025549.html">[rabbitmq-discuss] High Performance Setup Strategy
</A></li>
	<LI>Next message: <A HREF="025553.html">[rabbitmq-discuss] High Performance Setup Strategy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25550">[ date ]</a>
              <a href="thread.html#25550">[ thread ]</a>
              <a href="subject.html#25550">[ subject ]</a>
              <a href="author.html#25550">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
