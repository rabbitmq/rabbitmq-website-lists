<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ blocking issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20blocking%20issue&In-Reply-To=%3C5128C40B.4080400%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025612.html">
   <LINK REL="Next"  HREF="025676.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ blocking issue</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20blocking%20issue&In-Reply-To=%3C5128C40B.4080400%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ blocking issue">matthias at rabbitmq.com
       </A><BR>
    <I>Sat Feb 23 13:28:43 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025612.html">[rabbitmq-discuss] RabbitMQ blocking issue
</A></li>
        <LI>Next message: <A HREF="025676.html">[rabbitmq-discuss] RabbitMQ blocking issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25641">[ date ]</a>
              <a href="thread.html#25641">[ thread ]</a>
              <a href="subject.html#25641">[ subject ]</a>
              <a href="author.html#25641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

On 21/02/13 17:26, Matthias Radestock wrote:
&gt;<i> After staring at the code for a couple of days I have identified and
</I>&gt;<i> fixed one scenarios in which a connection could end up in the state you
</I>&gt;<i> are seeing. It happens only after an illegal sequence of channel.close
</I>&gt;<i> followed by basic.publish on the same channel, and only during a very
</I>&gt;<i> narrow window in conjunction with flow control. So I doubt this is the
</I>&gt;<i> cause, but it would still be worth giving that fix a try, just to rule
</I>&gt;<i> out that scenario. I will send you a patch by private email.
</I>
After staring at the code some more, it turns out that there is a 
*legal* sequence of AMQP commands that triggers the bug: a bunch of 
basic.publish commands followed by a channel.close, followed by a 
basic.publish on *another* channel.

The precise conditions are very intricate and highly timing sensitive, 
which explains why we have not seen any prior reports of this even 
though the bug was introduced nearly a year ago, in 2.8.0.

The patch I sent you fixes the problem and will appear in the next 
RabbitMQ bugfix release.

Thank you very much for the detailed reports and all the effort you 
invested in helping us track this down.

Regards,

Matthias.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025612.html">[rabbitmq-discuss] RabbitMQ blocking issue
</A></li>
	<LI>Next message: <A HREF="025676.html">[rabbitmq-discuss] RabbitMQ blocking issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25641">[ date ]</a>
              <a href="thread.html#25641">[ thread ]</a>
              <a href="subject.html#25641">[ subject ]</a>
              <a href="author.html#25641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
