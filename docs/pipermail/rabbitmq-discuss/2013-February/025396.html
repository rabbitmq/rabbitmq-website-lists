<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Round robin Topic exchange s
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Round%20robin%20Topic%20exchange%20s&In-Reply-To=%3C5113C2FB.4050809%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025395.html">
   <LINK REL="Next"  HREF="025403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Round robin Topic exchange s</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Round%20robin%20Topic%20exchange%20s&In-Reply-To=%3C5113C2FB.4050809%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Round robin Topic exchange s">simon at rabbitmq.com
       </A><BR>
    <I>Thu Feb  7 15:06:35 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025395.html">[rabbitmq-discuss] Round robin Topic exchange s
</A></li>
        <LI>Next message: <A HREF="025403.html">[rabbitmq-discuss] Round robin Topic exchange s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25396">[ date ]</a>
              <a href="thread.html#25396">[ thread ]</a>
              <a href="subject.html#25396">[ subject ]</a>
              <a href="author.html#25396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK, so the bad news is that I don't think this kind of routing is 
possible with off the shelf RabbitMQ.

It would be possible to write a custom exchange type quite easily to do 
this *if* the &quot;round robin&quot; part could be replaced by &quot;pick one of the 
routes at random&quot;. Essentially you would have an exchange type that 
delegated to the topic exchange for everything, but intercepted the 
queues returned from route/2 and made a random choice.

If the number of routing keys is limited and topic wildcards are not 
needed then you could just have one queue per routing key and have 
consumers consume from all the queues they are interested in, and the 
built in round robin would work for you.

If neither of these constraints hold then I think implementing what you 
want would pose a bigger problem - presumably there would need to be one 
round robin &quot;cursor&quot; per routing key that has ever been published to the 
exchange? So I think you would have a potentially unbounded amount of 
space taken by these cursors, and no way to ever know you can safely GC 
them.

Cheers, Simon


On 07/02/13 11:23, Marc Teichtahl wrote:
&gt;<i> Simon
</I>&gt;<i>
</I>&gt;<i> You are correct in your last statement
</I>&gt;<i>
</I>&gt;<i> For each message to a topic exchange identify the matching queues and
</I>&gt;<i> then round robin between theses.
</I>&gt;<i>
</I>&gt;<i> Sent from my iPhone
</I>&gt;<i>
</I>&gt;<i> On 07/02/2013, at 16:40, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Sorry, it's not very clear what 'I would like the exchange to round
</I>&gt;<i> robin messages to each consumer queue for the &quot;same&quot; topic' means.
</I>&gt;<i>
</I>&gt;<i> Do you mean something like: for each message, evaluate the routing as
</I>&gt;<i> a topic exchange normally would, giving a list of queues. But then
</I>&gt;<i> rather than routing to all those queues, just route to one, in some
</I>&gt;<i> round robin fashion?
</I>&gt;<i>
</I>&gt;<i> Or something else?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 07/02/13 10:50, Marc Teichtahl wrote:
</I>&gt;&gt;<i> Im seeking some advise as to how best configure my rabbitMQ exchanges.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Im trying to use a topic exchange in a round robin methodology. Each
</I>&gt;&gt;<i> consumer has its own (uniquely) named queue attached to a topic
</I>&gt;&gt;<i> exchange. I would like the exchange to round robin messages to each
</I>&gt;&gt;<i> consumer queue for the &quot;same&quot; topic - lets say *.log for example.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have tried multiple combinations and only seem to be able to
</I>&gt;&gt;<i> simultaneously deliver messages to the consumer queues which effectively
</I>&gt;&gt;<i> means Im processing the message twice, once in each consumer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for clarity I also have a fanout exchange, which I use to &quot;control&quot; the
</I>&gt;&gt;<i> consumers (start, stop etc).this should remain in place in any outcome.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any guidance on how best to achieve the stated outcome would be great.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Marc
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025395.html">[rabbitmq-discuss] Round robin Topic exchange s
</A></li>
	<LI>Next message: <A HREF="025403.html">[rabbitmq-discuss] Round robin Topic exchange s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25396">[ date ]</a>
              <a href="thread.html#25396">[ thread ]</a>
              <a href="subject.html#25396">[ subject ]</a>
              <a href="author.html#25396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
