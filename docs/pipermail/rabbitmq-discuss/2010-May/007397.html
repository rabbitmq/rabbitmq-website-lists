<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss]  Java client problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%20Java%20client%20problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007412.html">
   <LINK REL="Next"  HREF="007400.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss]  Java client problem</H1>
    <B>jacek_</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%20Java%20client%20problem&In-Reply-To="
       TITLE="[rabbitmq-discuss]  Java client problem">jacekolszak at gmail.com
       </A><BR>
    <I>Thu May 27 13:07:40 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007412.html">[rabbitmq-discuss] Can the consumer know who sent the message?
</A></li>
        <LI>Next message: <A HREF="007400.html">[rabbitmq-discuss] Java client problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7397">[ date ]</a>
              <a href="thread.html#7397">[ thread ]</a>
              <a href="subject.html#7397">[ subject ]</a>
              <a href="author.html#7397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi, 

I am testing currently the Java RabbitMQ client. I want to make sure that
any problems that can occur with connection to RabbitMQ server will be
handled properly. To test if everything is working fine I stopped rabbitmq
server proces (using kill -s SIGSTOP command). This imitate more or less
problems which can occur in the future. I specified the heartbeat in Java
client and want to get exceptions when the server does not respond.
Unfortunatelly when the client tries to connect it enters into endless loop.
The socket timeout exception is thrown by standard Java socket mechanism but
RabbitMQ client catch this exception and retry.  No MissedHeartbeatException
exception is thrown. I have looked into source code of AMQConnection class
and found that method: 

    public void handleSocketTimeout() throws MissedHeartbeatException { 
        if (_heartbeat == 0) { 
            // No heartbeating. Go back and wait some more. 
            return; 
        } 

        _missedHeartbeats++; 

        // We check against 8 = 2 * 4 because we need to wait for at 
        // least two complete heartbeat setting intervals before 
        // complaining, and we've set the socket timeout to a quarter 
        // of the heartbeat setting in setHeartbeat above. 
        if (_missedHeartbeats &gt; (2 * 4)) { 
            throw new MissedHeartbeatException(&quot;Heartbeat missing with
heartbeat == &quot; + 
                                               _heartbeat + &quot; seconds&quot;); 
        } 
    } 


The problem is that _heartbeat field is filled with data after connection is
created (not before). The initial value is 0. Until connection is
successfully made client will try to connect again and again. Exception will
never be thrown, so my application will have no information about server
problems. In my opinion only minor changes are required to make this thing
work - _hearbeat field should be filled before making the connection. Please
correct me if I am wrong. 

Thanks in advance, 
Jacek 
-- 
View this message in context: <A HREF="http://old.nabble.com/Java-client-problem-tp28693038p28693038.html">http://old.nabble.com/Java-client-problem-tp28693038p28693038.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007412.html">[rabbitmq-discuss] Can the consumer know who sent the message?
</A></li>
	<LI>Next message: <A HREF="007400.html">[rabbitmq-discuss] Java client problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7397">[ date ]</a>
              <a href="thread.html#7397">[ thread ]</a>
              <a href="subject.html#7397">[ subject ]</a>
              <a href="author.html#7397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
