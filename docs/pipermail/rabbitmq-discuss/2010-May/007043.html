<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20a%20two-site%20deployment%20connected%0A%20via%09WAN.&In-Reply-To=874oioot7c.fsf%40rimspace.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007042.html">
   <LINK REL="Next"  HREF="007044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20a%20two-site%20deployment%20connected%0A%20via%09WAN.&In-Reply-To=874oioot7c.fsf%40rimspace.net"
       TITLE="[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.">simon at rabbitmq.com
       </A><BR>
    <I>Tue May  4 13:56:08 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007042.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.
</A></li>
        <LI>Next message: <A HREF="007044.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected	via	WAN.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7043">[ date ]</a>
              <a href="thread.html#7043">[ thread ]</a>
              <a href="subject.html#7043">[ subject ]</a>
              <a href="author.html#7043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Daniel.

On 04/05/10 11:29, Daniel Pittman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">daniel at rimspace.net</A>&gt; said:
&gt;<i> G'day.
</I>&gt;<i>
</I>&gt;<i> I am looking at deploying RabbitMQ to provide messaging services inside, and
</I>&gt;<i> between, our two sites using both the AMQP and STOMP interfaces.
</I>&gt;<i>
</I>&gt;<i> As far as I can tell we have two choices for deploying this:
</I>&gt;<i>
</I>&gt;<i> 1. Use an Erlang cluster over the WAN, as a single instance of RabbitMQ
</I>&gt;<i>
</I>&gt;<i> 2. Use the 'shovel' extension to push messages between two distinct RabbitMQ
</I>&gt;<i>     clusters, one at each site.
</I>&gt;<i>
</I>&gt;<i> The only real discussion I can find about this is from 35 weeks ago, where the
</I>&gt;<i> comment was that using shovel might better handle a situation where the WAN
</I>&gt;<i> was down, but that it was not production ready.
</I>
As an aside, Matthew now tells me that the shovel is &quot;production ready&quot;, 
although at the moment it still requires compiling the broker, Erlang 
client and shovel from source.

&gt;<i> My impression is that, generally speaking, we are likely to be best served by
</I>&gt;<i> using an Erlang cluster over the network: the WAN is fairly reliable, and will
</I>&gt;<i> soon have two redundant paths, further reducing the risk of a split cluster.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Am I correct in my understanding that using RabbitMQ in this way means:
</I>&gt;<i>
</I>&gt;<i> Clients will connect to their local RabbitMQ node, and when they create a
</I>&gt;<i> queue it will exist only on that specific node.
</I>
Yes.

&gt;<i> Erlang will route messages to the correct node, either inside the site or over
</I>&gt;<i> the WAN as required.
</I>
Yes.

&gt;<i> Erlang and/or RabbitMQ will ensure that only one copy of a message traverses
</I>&gt;<i> the WAN, even if there are multiple recipients at the remote site.
</I>
Not in 1.7.2. Versions of this optimisation existed in previous versions 
of RabbitMQ, but have since been disabled since they broke some ordering 
guarantees.

There's a new, correct, version of this optimisation on branch bug19844 
in Mercurial (so, err, requiring you to compile from source again). It's 
in a fairly reasonable state and hopefully should get merged into the 
default branch soon and thus find its way into the next release. You are 
very welcome, and indeed encouraged, to test it out before that happens.

&gt;<i> Erlang and RabbitMQ will recover from a brief interruption of clustering, such
</I>&gt;<i> as a reboot of the server at one site, without manual intervention.
</I>
I believe so.

&gt;<i> Further, is there anything useful that I can read about Erlang and RabbitMQ
</I>&gt;<i> WAN clustering?  My research, to date, has not given me much to learn from,
</I>&gt;<i> which makes me wonder what hidden complexity I might be risking...
</I>
I assume you've seen the clustering guide:

<A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A>

(but that's pretty basic, I admit), and the Distributed Erlang manpage:

<A HREF="http://www.erlang.org/doc/reference_manual/distributed.html">http://www.erlang.org/doc/reference_manual/distributed.html</A>

(or at least the section on security).

Yes, we could probably do with more documentation...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007042.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.
</A></li>
	<LI>Next message: <A HREF="007044.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected	via	WAN.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7043">[ date ]</a>
              <a href="thread.html#7043">[ thread ]</a>
              <a href="subject.html#7043">[ subject ]</a>
              <a href="author.html#7043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
