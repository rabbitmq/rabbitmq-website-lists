<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20a%20two-site%20deployment%20connected%0A%20via%09WAN.&In-Reply-To=87hbmnolpx.fsf%40rimspace.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007044.html">
   <LINK REL="Next"  HREF="007046.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20a%20two-site%20deployment%20connected%0A%20via%09WAN.&In-Reply-To=87hbmnolpx.fsf%40rimspace.net"
       TITLE="[rabbitmq-discuss] RabbitMQ and a two-site deployment connected via	WAN.">simon at rabbitmq.com
       </A><BR>
    <I>Tue May  4 16:07:56 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007044.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected	via	WAN.
</A></li>
        <LI>Next message: <A HREF="007046.html">[rabbitmq-discuss]  Publishing to a non-existing exchange
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7045">[ date ]</a>
              <a href="thread.html#7045">[ thread ]</a>
              <a href="subject.html#7045">[ subject ]</a>
              <a href="author.html#7045">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/05/10 11:29, Daniel Pittman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">daniel at rimspace.net</A>&gt; said:
&lt;snip&gt;
&gt;<i> I figured in most of a year things might have moved on; is it still likely
</I>&gt;<i> that shovel will avoid losing messages across a WAN split where Erlang
</I>&gt;<i> clustering would lose them?
</I>
Yeees, but it's really two different concepts. The clustered case is 
really a big RabbitMQ server; when a node vanishes it's as if that 
node's queues just don't exist. The shovel case is two separate servers. 
For your case the shovel is more reliable, since messages can back up in 
either broker if the other is not visible; BUT it makes the topology of 
the whole thing visible to clients (and something you have to manage). 
This may not be a problem of course.

&gt;&gt;<i> Not in 1.7.2. Versions of this optimisation existed in previous versions
</I>&gt;&gt;<i> of RabbitMQ, but have since been disabled since they broke some ordering
</I>&gt;&gt;<i> guarantees.
</I>&gt;<i>
</I>&gt;<i> OK.  Given I do value stability and correctness over performance, in 1.7.2 is
</I>&gt;<i> this going to be one copy per subscriber on the remote node over the WAN?
</I>
Yes.

&gt;&gt;<i> There's a new, correct, version of this optimisation on branch bug19844
</I>&gt;&gt;<i> in Mercurial (so, err, requiring you to compile from source again). It's
</I>&gt;&gt;<i> in a fairly reasonable state and hopefully should get merged into the
</I>&gt;&gt;<i> default branch soon and thus find its way into the next release. You are
</I>&gt;&gt;<i> very welcome, and indeed encouraged, to test it out before that happens.
</I>&gt;<i>
</I>&gt;<i> Depending, I might well do so &#8212; but given we are testing the message queue
</I>&gt;<i> system, we are very unlikely to actually find problems with this.
</I>
Fair enough :)

&lt;snip&gt;
&gt;<i> I want to understand better what, for example, high latency or low bandwidth
</I>&gt;<i> links mean in the context of a WAN Erlang cluster: if latency gets high
</I>&gt;<i> enough, do messages time-out and get retried?  Is this congestion-controlled?
</I>&gt;<i>
</I>&gt;<i> When the Erlang messages start to back up, do they take down the cluster?
</I>&gt;<i>
</I>&gt;<i> I *think* the answer is that Erlang is good about this, and time-out control
</I>&gt;<i> is application specific, but there doesn't seem to be a good guide to what
</I>&gt;<i> there is that I *should* be worrying about.
</I>
No, there isn't :( To answer your specific questions:

If the latency gets very high, but a node is not down/disconnected, 
messages will back up indefinitely, so they don't retry per se, but 
don't get dropped either. In very high load / latency situations Erlang 
can decide that the other node is down depending on the &quot;ticktime&quot; - see 
this thread for more:

<A HREF="http://markmail.org/message/wakptvfyogtgqnen">http://markmail.org/message/wakptvfyogtgqnen</A>

Hope this helps.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007044.html">[rabbitmq-discuss] RabbitMQ and a two-site deployment connected	via	WAN.
</A></li>
	<LI>Next message: <A HREF="007046.html">[rabbitmq-discuss]  Publishing to a non-existing exchange
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7045">[ date ]</a>
              <a href="thread.html#7045">[ thread ]</a>
              <a href="subject.html#7045">[ subject ]</a>
              <a href="author.html#7045">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
