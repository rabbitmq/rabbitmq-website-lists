<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Unexplained shutdown of RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Unexplained%20shutdown%20of%20RabbitMQ&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007290.html">
   <LINK REL="Next"  HREF="007283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Unexplained shutdown of RabbitMQ</H1>
    <B>Jason Zaugg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Unexplained%20shutdown%20of%20RabbitMQ&In-Reply-To="
       TITLE="[rabbitmq-discuss] Unexplained shutdown of RabbitMQ">jzaugg at gmail.com
       </A><BR>
    <I>Fri May 14 12:44:43 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007290.html">[rabbitmq-discuss] Bunny fork
</A></li>
        <LI>Next message: <A HREF="007283.html">[rabbitmq-discuss] Unexplained shutdown of RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7282">[ date ]</a>
              <a href="thread.html#7282">[ thread ]</a>
              <a href="subject.html#7282">[ subject ]</a>
              <a href="author.html#7282">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>=System Details:=

Erlang .572
RabbitMQ 1.6.0
Windows Server 2003 64Bit
8 core machine.
Lots of free disk space.

=Application Details=

The RabbitMQ Broker and the message consumers/publishers are running
on the same machine. All the queues in this application are
non-persistent. There are some other very low traffic applications
with small persistent queues on the same broker.

Five Java processes are running on this machine consuming and
publishing messages through one VHost and one Exchange. There are
desktop applications

I've sent the architecture diagram separately to <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">info at rabbitmq.com</A>,
but I can't share it with this list right now. I can send by private
email if required.

The applications and broker have been running smoothly in production
for the last few weeks.

=Symptoms=

Today, a problem is occuring. After 5-60 minutes of uptime, the
clients report that the broker is shutting down, then the Erlang
process starts spinning on one CPU. I suspect it is writing the large
error log during this time. We killed the erl.exe, and restarted.

The shutdown produces this logging. For more context, see the attachment.

  =ERROR REPORT==== 14-May-2010::10:27:29 ===
  ** Generic server &lt;0.1962.0&gt; terminating
  ** Last message in was {'EXIT',&lt;0.1960.0&gt;,{writer,send_failed,badarg}}
  ** When Server state == {ch,running,1,&lt;0.1957.0&gt;,&lt;0.1960.0&gt;,undefined,none,
  [snip reams of output with the queued messages]
  ** Reason for termination ==
  ** {writer,send_failed,badarg}

=Questions=

1. Can we configure RabbitMQ to suppress logging of the message queue
when this error occurs. The log files are growing to 4GB+, and it's
tricky to follow them.
2. What might &quot;writer,send_failed,badarg&quot; as the termination reason
suggest as the root cause?
3. Prior the the shutdown, what is the meaning of:

  exception on TCP connection &lt;0.2021.0&gt; from 10.30.33.169:3251
  {timeout,running}
  exception on TCP connection &lt;0.1707.0&gt; from 10.30.32.44:2692
  connection_closed_abruptly

4. When I try to run rabbitmqctl, it fails with:

  C:\Documents and Settings\sophis_server&gt;rabbitmqctl list_connections
  Listing connections ...
  Error: {badrpc,nodedown}

and in the rabbit.log

  =ERROR REPORT==== 14-May-2010::10:36:28 ===
  ** Connection attempt from disallowed node <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl at CHGVASSOPP105</A> **


Let me know if I can provide more information, and thanks in advance
for your help!

Jason Zaugg
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-restart-loop.log
Type: application/octet-stream
Size: 13531 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100514/79b55dfe/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100514/79b55dfe/attachment.obj</A> 
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007290.html">[rabbitmq-discuss] Bunny fork
</A></li>
	<LI>Next message: <A HREF="007283.html">[rabbitmq-discuss] Unexplained shutdown of RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7282">[ date ]</a>
              <a href="thread.html#7282">[ thread ]</a>
              <a href="subject.html#7282">[ subject ]</a>
              <a href="author.html#7282">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
