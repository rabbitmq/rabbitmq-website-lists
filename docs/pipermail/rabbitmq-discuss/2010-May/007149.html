<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scalability?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Scalability%3F&In-Reply-To=4BE476C3.8040707%40dataraker.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007148.html">
   <LINK REL="Next"  HREF="007150.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scalability?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Scalability%3F&In-Reply-To=4BE476C3.8040707%40dataraker.com"
       TITLE="[rabbitmq-discuss] Scalability?">matthias at rabbitmq.com
       </A><BR>
    <I>Fri May  7 22:30:45 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007148.html">[rabbitmq-discuss] Scalability?
</A></li>
        <LI>Next message: <A HREF="007150.html">[rabbitmq-discuss] Scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7149">[ date ]</a>
              <a href="thread.html#7149">[ thread ]</a>
              <a href="subject.html#7149">[ subject ]</a>
              <a href="author.html#7149">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wayne,

Wayne Van Den Handel wrote:
&gt;<i> I tried the high water mark setting and it now prevents too much memory 
</I>&gt;<i> from being used (barely) but as my test continued it eventually had a 
</I>&gt;<i> hard crash for another reason. I was hitting it with 2 producers 
</I>&gt;<i> throttled to 1000 messages each to a separate queue and 5 consumers. 
</I>
Just to clarify ... the producer limits the publishing rate by checking 
on the queue size with a passive queue.declare, and only sends more 
messages when the size is less than 1000, right?

How often is that check performed?

&gt;<i> There was always 1000 messages each in the 2 queues and after 15 minutes 
</I>&gt;<i> one of the producers crashed with an error (from the logs) 
</I>&gt;<i> {amqp_error,not_found,&quot;no queue 'xxx' in vhost '/'&quot;, queue.declare'}. I 
</I>&gt;<i> figured this was a timeout or something as the queue did exist and was 
</I>&gt;<i> being emptied by 3 different consumers actively.
</I>
How many queues do you see when running &quot;rabbitmqctl list_queues&quot;?

&gt;<i> 5 seconds later the entire process died with an error (from the logs) 
</I>&gt;<i> &quot;exception on TCP connection ... connection_closed_abruptly&quot; and then 
</I>&gt;<i> &quot;closing TCP connection&quot;.
</I>
Which process died? The producers/consumers? Rabbit?

Are there any other interesting messages in the rabbit.log or 
rabbit-sasl.log?

If you could
1) clear the log files,
2) restart rabbit,
3) do a complete run of your tests until they fail,
4) put the logs somewhere we can see them

then we may be able to determine the cause of the problem from looking 
at the logs.

And, as Colin suggests, if you can post the code then we can try to 
reproduce the problem.

&gt;<i> I am new to queuing but frankly I don't know what to do. My Experience 
</I>&gt;<i> with this and other MQ products is less than compelling. Does this take 
</I>&gt;<i> a ton of tweaking to get stable? How do people manage to push 500k 
</I>&gt;<i> messages a day?
</I>
How many messages did you actually send in your above test? Rabbit can 
easily route tens of thousands of messages a second. So if your test was 
running for 15 minutes and the producers/consumers weren't a bottleneck 
then rabbit will have processed tens of millions of messages in that time.

Regards,

Matthias.

</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007148.html">[rabbitmq-discuss] Scalability?
</A></li>
	<LI>Next message: <A HREF="007150.html">[rabbitmq-discuss] Scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7149">[ date ]</a>
              <a href="thread.html#7149">[ thread ]</a>
              <a href="subject.html#7149">[ subject ]</a>
              <a href="author.html#7149">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
