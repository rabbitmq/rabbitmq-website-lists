<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [PATCH 00 of 10] Several improvements to the OCF resource agent
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BPATCH%2000%20of%2010%5D%20Several%20improvements%20to%20the%0A%20OCF%20resource%20agent&In-Reply-To=20100511190445.GA20197%40wellquite.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007230.html">
   <LINK REL="Next"  HREF="007229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [PATCH 00 of 10] Several improvements to the OCF resource agent</H1>
    <B>Florian Haas</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BPATCH%2000%20of%2010%5D%20Several%20improvements%20to%20the%0A%20OCF%20resource%20agent&In-Reply-To=20100511190445.GA20197%40wellquite.org"
       TITLE="[rabbitmq-discuss] [PATCH 00 of 10] Several improvements to the OCF resource agent">florian.haas at linbit.com
       </A><BR>
    <I>Tue May 11 20:26:00 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007230.html">[rabbitmq-discuss] [PATCH 00 of 10] Several improvements to the OCF resource agent
</A></li>
        <LI>Next message: <A HREF="007229.html">[rabbitmq-discuss] Fwd:  Fwd: active/active
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7232">[ date ]</a>
              <a href="thread.html#7232">[ thread ]</a>
              <a href="subject.html#7232">[ subject ]</a>
              <a href="author.html#7232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/11/2010 09:04 PM, Matthew Sackman wrote:
&gt;<i> On Tue, May 11, 2010 at 08:50:19PM +0200, Florian Haas wrote:
</I>&gt;&gt;<i> On 05/11/2010 08:01 PM, Matthew Sackman wrote:
</I>&gt;&gt;&gt;<i> These are excellent, and I have no doubt they will likely all be
</I>&gt;&gt;&gt;<i> accepted. As I'm sure you've been able to gather, some of the
</I>&gt;&gt;&gt;<i> documentation and example scripts that I've read in order to be able to
</I>&gt;&gt;&gt;<i> write the OCF script are out of date themselves, hence some of the
</I>&gt;&gt;&gt;<i> issues you've spotted and corrected.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Would you mind sharing exactly what documentation and example scripts
</I>&gt;&gt;<i> you were following? We should get those fixed.
</I>&gt;<i> 
</I>&gt;<i> Sure, a lot of it was just done from reading other OCF scripts, such as
</I>&gt;<i> the DRBD, IPAddr and such like. But I think I got the most out of the
</I>&gt;<i> docs at
</I>&gt;<i> <A HREF="http://www.clusterlabs.org/doc/en-US/Pacemaker/1.0/html/Pacemaker_Explained/ap-ocf.html">http://www.clusterlabs.org/doc/en-US/Pacemaker/1.0/html/Pacemaker_Explained/ap-ocf.html</A>
</I>&gt;<i> 
</I>&gt;<i> For example, that only talks of the monitor action, not status, and no
</I>&gt;<i> where that I found is there any real documentation as to what the
</I>&gt;<i> library of functions that is supplied with pacemaker do, nor how or when
</I>&gt;<i> they should be used (eg the ocf_is_probe function you've used).
</I>
Those are not part of Pacemaker, they ship with the Linux-HA resource
agents package. The relevant functions library is in
$OCF_ROOT/resource.d/heartbeat/.ocf-shellfuncs.

&gt;&gt;<i> One other thing that came to mind while looking at the RA: the
</I>&gt;&gt;<i> recommended minimum start timeout of 600s seems a bit excessive.
</I>&gt;&gt;<i> Starting with Pacemaker 1.0.8 the crm shell will warn if the
</I>&gt;&gt;<i> configuration provides for shorter timeouts than the RA recommends. Sure
</I>&gt;&gt;<i> you need a 10-minute start timeout?
</I>&gt;<i> 
</I>&gt;<i> Currently, startup time can be very long if you have an awful lot of
</I>&gt;<i> data to recover from disk. We think this might be partially fixed very
</I>&gt;<i> soon as some work that's recently been done will all Rabbit to come up
</I>&gt;<i> even before all recovery is complete (only the queues still being
</I>&gt;<i> recovered will continue to be unavailable). However, even in this case,
</I>&gt;<i> there are still some internal resources that must be fully recovered
</I>&gt;<i> before Rabbit can be in any way considered to be up, and that can be
</I>&gt;<i> proportional to the amount of data it has previously stored on disk.
</I>&gt;<i> 
</I>&gt;<i> Thus, in conclusion, yes, 10 mins may be far too long. But in some cases
</I>&gt;<i> it may also be too short. Any advice you have as to what we should be
</I>&gt;<i> doing wrt the OCF script would be gratefully received.
</I>
There's a misconception in play here, I'm afraid. What you define as the
timeout in the RA metadata is just a recommendation for the minimum
timeout the cluster administrator should configure. It doesn't actually
set or enforce that timeout, it merely recommends one to be set. Long
story short: you don't want to set this piece of metadata to the maximum
time you'd expect startup to take, but the time that most real-word
configurations will take to start, plus some 20-30% extra.

MySQL (with InnoDB recovery) has much similar issues when failing over
hard on DRBD or shared storage. The recommended minimum start timeout
there is 120s.

Cheers,
Florian

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 262 bytes
Desc: OpenPGP digital signature
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100511/f20ec55c/attachment.pgp">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100511/f20ec55c/attachment.pgp</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007230.html">[rabbitmq-discuss] [PATCH 00 of 10] Several improvements to the OCF resource agent
</A></li>
	<LI>Next message: <A HREF="007229.html">[rabbitmq-discuss] Fwd:  Fwd: active/active
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7232">[ date ]</a>
              <a href="thread.html#7232">[ thread ]</a>
              <a href="subject.html#7232">[ subject ]</a>
              <a href="author.html#7232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
