<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] detecting publish failure across restart
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20detecting%20publish%20failure%20across%20restart&In-Reply-To=yrv4cpr0cyznu.fsf%40dwragg.eng.vmware.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007418.html">
   <LINK REL="Next"  HREF="007420.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] detecting publish failure across restart</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20detecting%20publish%20failure%20across%20restart&In-Reply-To=yrv4cpr0cyznu.fsf%40dwragg.eng.vmware.com"
       TITLE="[rabbitmq-discuss] detecting publish failure across restart">matthew at rabbitmq.com
       </A><BR>
    <I>Mon May 31 14:42:14 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007418.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
        <LI>Next message: <A HREF="007420.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7419">[ date ]</a>
              <a href="thread.html#7419">[ thread ]</a>
              <a href="subject.html#7419">[ subject ]</a>
              <a href="author.html#7419">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, May 31, 2010 at 02:21:57PM +0100, David Wragg wrote:
&gt;<i> The workaroud is to use the transaction support in AMQP: Start a
</I>&gt;<i> transaction (with Channel.txSelect), do some publishes on the channel,
</I>&gt;<i> and then commit the transaction (with Channel.txCommit).  If the commit
</I>&gt;<i> completes successfully, you know that the publishes have taken place on
</I>&gt;<i> the server.
</I>
Note that doing this converts the semantics from &quot;at most once&quot; to &quot;at
least once&quot;. I.e. before, with mandatory set, you will not have to deal
with duplicates - if the error (due to not being able to route the msg
to a queue) gets lost (network issue or client/server crashing) then the
published message is lost, but you don't run the risk of duplicates -
even in the case where you republish if you get the delivery failure.

With transactions, there's the possibility that the commit_ok message
gets lost as it goes back from the server to the client. In that case
you have no choice but to assume in the client that the server has not
accepted responsibility for the messages in the transaction and thus you
must republish yourself. However, if it's just the commit_ok message
that got lost then you'll be publishing the same messages more than once
and thus you need to account for the possibility of duplicates when
receiving messages.

Matthew

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007418.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
	<LI>Next message: <A HREF="007420.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7419">[ date ]</a>
              <a href="thread.html#7419">[ thread ]</a>
              <a href="subject.html#7419">[ subject ]</a>
              <a href="author.html#7419">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
