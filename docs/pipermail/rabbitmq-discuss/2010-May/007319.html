<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consumer%20stop%20to%20receive%20messages%20but%0A%09continue%20listening%20queue%20problem.&In-Reply-To=7fd310d11003261315m39a8d63eo11e36e72e9308e62%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007335.html">
   <LINK REL="Next"  HREF="007320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.</H1>
    <B>Gustavo Aquino</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consumer%20stop%20to%20receive%20messages%20but%0A%09continue%20listening%20queue%20problem.&In-Reply-To=7fd310d11003261315m39a8d63eo11e36e72e9308e62%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.">aquino.gustavo at gmail.com
       </A><BR>
    <I>Wed May 19 02:51:47 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007335.html">[rabbitmq-discuss] Erlang has closed?
</A></li>
        <LI>Next message: <A HREF="007320.html">[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7319">[ date ]</a>
              <a href="thread.html#7319">[ thread ]</a>
              <a href="subject.html#7319">[ subject ]</a>
              <a href="author.html#7319">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I come back here about this assumption, it's a big concern today for us.

Let's explain the facts.

We have 1 exchange e 1 persistent queue binding for routing key = book.APPL

We have a publisher putting messages from exchange, each message have ~213
bytes and each routing key identify the goup of message like book.APPL,
book.PETR4 and etc. We are publishing about ~3000 m/s

We have one consumer listening queue.

The problem.

We put test to run for 1 hour, and monitoring queue size with rabbitmqctl
list_queues, all the time list have 0 size, so consumer are getting all on
the fly, and now we stop publisher and here is the BIG PROBLEM, consumer
continue to consume messages from queue... and it's remain for 20 minutes
after stop publisher......

If we stop consumer we can see the queue growing for long time..., therefore
looking for it's we can conclude that our consumer are 20 minutes late
behind publisher and it's a f... problem last message from publisher will be
received by consumer just 20 minutes after.

About environments.

We are using a P550 Machine with 4 PPC64 processors 5.4Ghz, and 100Gb of
ram, during our tests it's have just 20% of processor busy, and 2Gb of
memory allocated.

We are using Red Hat 5 for ppc in our tests.

We replicate this scenario using Intel x86_64 with Red Hat linux for 64bits,
and Real Time Kernel, this machine have 8 cores and 32Gb of ram, and during
the tests it consume just 25% of CPU and 2Gb of ram.

So can anyone help me ? Its's a common problem in Rabbit ? anybody here have
this same problem ? We have talked about a possible exchange buffer cause
and etc in this way, but to be sincerely in my thoughts ~3000 m/s is a bit
easy to be processed for one message server.

Gustavo.





On Fri, Mar 26, 2010 at 5:15 PM, Bryan Murphy &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bmurphy1976 at gmail.com</A>&gt; wrote:

&gt;<i> Make sense, although we don't care about the order so it doesn't affect us
</I>&gt;<i> so much.
</I>&gt;<i>
</I>&gt;<i> Bryan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Mar 26, 2010 at 1:11 PM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, Mar 26, 2010 at 08:33:19AM -0500, Bryan Murphy wrote:
</I>&gt;&gt;<i> &gt; Another technique we use:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Start one consumer.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Start your other consumers.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Restart the first consumer.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; This let's you keep the high prefetch settings while still getting the
</I>&gt;&gt;<i> &gt; messages to distribute more evenly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would not recommend that at all - you're likely to get messages in
</I>&gt;&gt;<i> different orders with this scheme. QoS is much better idea, or, use
</I>&gt;&gt;<i> channel.flow from the client (may only work in newer-than-1.7.2 - can't
</I>&gt;&gt;<i> remember when it appeared) to prevent any messages being sent out
</I>&gt;&gt;<i> *before* issuing the basic.consume.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You could then have either a delay or some signal through some other
</I>&gt;&gt;<i> exchange and queues (and channel) to get the clients to drop the
</I>&gt;&gt;<i> channel.flow and start consuming.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthew
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100518/e9420aaa/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100518/e9420aaa/attachment-0001.htm</A> 
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007335.html">[rabbitmq-discuss] Erlang has closed?
</A></li>
	<LI>Next message: <A HREF="007320.html">[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7319">[ date ]</a>
              <a href="thread.html#7319">[ thread ]</a>
              <a href="subject.html#7319">[ subject ]</a>
              <a href="author.html#7319">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
