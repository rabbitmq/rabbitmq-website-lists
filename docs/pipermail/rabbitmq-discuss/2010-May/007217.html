<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [PATCH 04 of 10] OCF resource agent: on error,	exit, don't return
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BPATCH%2004%20of%2010%5D%20OCF%20resource%20agent%3A%20on%20error%2C%0A%09exit%2C%20don%27t%20return&In-Reply-To=patchbomb.1273597777%40gluehwein.linbit">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007219.html">
   <LINK REL="Next"  HREF="007223.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [PATCH 04 of 10] OCF resource agent: on error,	exit, don't return</H1>
    <B>Florian Haas</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BPATCH%2004%20of%2010%5D%20OCF%20resource%20agent%3A%20on%20error%2C%0A%09exit%2C%20don%27t%20return&In-Reply-To=patchbomb.1273597777%40gluehwein.linbit"
       TITLE="[rabbitmq-discuss] [PATCH 04 of 10] OCF resource agent: on error,	exit, don't return">florian.haas at linbit.com
       </A><BR>
    <I>Tue May 11 18:09:41 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007219.html">[rabbitmq-discuss] [PATCH 03 of 10] OCF resource agent: correctly	behave on start and	stop
</A></li>
        <LI>Next message: <A HREF="007223.html">[rabbitmq-discuss] [PATCH 05 of 10] OCF resource agent: fix	validate exit codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7217">[ date ]</a>
              <a href="thread.html#7217">[ thread ]</a>
              <a href="subject.html#7217">[ subject ]</a>
              <a href="author.html#7217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE># HG changeset patch
# User Florian Haas &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">florian.haas at linbit.com</A>&gt;
# Date 1273593909 -7200
# Node ID f0a7e4621b20a35c6cf20b2393d7d6b3f02fbc7b
# Parent  62ca42a0d9e9ee39a7c4348795693c1a71af269b
OCF resource agent: on error, exit, don't return

When they encounter an error condition, OCF RAs can simply exit. No
need to return from the relevant functions.

diff -r 62ca42a0d9e9 -r f0a7e4621b20 packaging/common/rabbitmq-server.ocf
--- a/packaging/common/rabbitmq-server.ocf	Tue May 11 17:50:42 2010 +0200
+++ b/packaging/common/rabbitmq-server.ocf	Tue May 11 18:05:09 2010 +0200
@@ -204,34 +204,34 @@
 rabbit_validate_partial() {
     if [ ! -x $RABBITMQ_MULTI ]; then
 	ocf_log err &quot;rabbitmq-server multi $RABBITMQ_MULTI does not exist or is not executable&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 
     if [ ! -x $RABBITMQ_CTL ]; then
 	ocf_log err &quot;rabbitmq-server ctl $RABBITMQ_CTL does not exist or is not executable&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 }
 
 rabbit_validate_full() {
     if [ ! -z $RABBITMQ_CLUSTER_CONFIG_FILE ] &amp;&amp; [ ! -e $RABBITMQ_CLUSTER_CONFIG_FILE ]; then
 	ocf_log err &quot;rabbitmq-server cluster_config_file $RABBITMQ_CLUSTER_CONFIG_FILE does not exist or is not a file&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 
     if [ ! -z $RABBITMQ_CONFIG_FILE ] &amp;&amp; [ ! -e $RABBITMQ_CONFIG_FILE ]; then
 	ocf_log err &quot;rabbitmq-server config_file $RABBITMQ_CONFIG_FILE does not exist or is not a file&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 
     if [ ! -z $RABBITMQ_LOG_BASE ] &amp;&amp; [ ! -d $RABBITMQ_LOG_BASE ]; then
 	ocf_log err &quot;rabbitmq-server log_base $RABBITMQ_LOG_BASE does not exist or is not a directory&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 
     if [ ! -z $RABBITMQ_MNESIA_BASE ] &amp;&amp; [ ! -d $RABBITMQ_MNESIA_BASE ]; then
 	ocf_log err &quot;rabbitmq-server mnesia_base $RABBITMQ_MNESIA_BASE does not exist or is not a directory&quot;;
-	return $OCF_ERR_ARGS;
+	exit $OCF_ERR_ARGS;
     fi
 
     rabbit_validate_partial
@@ -252,7 +252,7 @@
 	    ;;
 	*)
 	    ocf_log err &quot;Unexpected return from rabbitmqctl $NODENAME_ARG status: $rc&quot;
-	    return $OCF_ERR_GENERIC
+	    exit $OCF_ERR_GENERIC
     esac
 }
 
@@ -285,7 +285,7 @@
 
 	elif [ &quot;$rc&quot; != $OCF_NOT_RUNNING ]; then
 	    ocf_log info &quot;rabbitmq-server start failed: $rc&quot;
-	    return $OCF_ERR_GENERIC
+	    exit $OCF_ERR_GENERIC
 	fi
         sleep 2
     done
@@ -320,7 +320,7 @@
             break
 	elif [ &quot;$rc&quot; != $OCF_SUCCESS ]; then
 	    ocf_log info &quot;rabbitmq-server stop failed: $rc&quot;
-	    return $OCF_ERR_GENERIC
+	    exit $OCF_ERR_GENERIC
 	fi
         sleep 2
     done
@@ -345,9 +345,9 @@
 esac
 
 if ocf_is_probe; then
-    rabbit_validate_partial || exit
+    rabbit_validate_partial
 else
-    rabbit_validate_full || exit
+    rabbit_validate_full
 fi
 
 case $__OCF_ACTION in



</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007219.html">[rabbitmq-discuss] [PATCH 03 of 10] OCF resource agent: correctly	behave on start and	stop
</A></li>
	<LI>Next message: <A HREF="007223.html">[rabbitmq-discuss] [PATCH 05 of 10] OCF resource agent: fix	validate exit codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7217">[ date ]</a>
              <a href="thread.html#7217">[ thread ]</a>
              <a href="subject.html#7217">[ subject ]</a>
              <a href="author.html#7217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
