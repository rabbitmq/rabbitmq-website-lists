<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] high number of unack'ed messages when queue grows large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20high%20number%20of%20unack%27ed%20messages%20when%20queue%0A%20grows%20large&In-Reply-To=z2w2dd7faef1005070643j2c556b7cv590cf7db4b82a6d1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007134.html">
   <LINK REL="Next"  HREF="007136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] high number of unack'ed messages when queue grows large</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20high%20number%20of%20unack%27ed%20messages%20when%20queue%0A%20grows%20large&In-Reply-To=z2w2dd7faef1005070643j2c556b7cv590cf7db4b82a6d1%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] high number of unack'ed messages when queue grows large">matthew at lshift.net
       </A><BR>
    <I>Fri May  7 14:49:21 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007134.html">[rabbitmq-discuss] high number of unack'ed messages when queue	grows large
</A></li>
        <LI>Next message: <A HREF="007136.html">[rabbitmq-discuss] high number of unack'ed messages when queue	grows large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7135">[ date ]</a>
              <a href="thread.html#7135">[ thread ]</a>
              <a href="subject.html#7135">[ subject ]</a>
              <a href="author.html#7135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mario,

On Fri, May 07, 2010 at 02:43:42PM +0100, <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mmenti at gmail.com</A> wrote:
&gt;<i> We've been seeing an issue where the number of unack'ed messages suddenly
</I>&gt;<i> starts growing much larger than the number of connected consumers, whenever
</I>&gt;<i> the queue gets to a certain size  (somewhere around 50k messages in the
</I>&gt;<i> queue, with 250 consumers connected). We've noticed that by reducing the
</I>&gt;<i> number of consumers, the issue becomes less pronounced, but was wondering if
</I>&gt;<i> anyone else is seeing this, and if there's any ways to avoid this? We're
</I>&gt;<i> using rabbitmq 1.7.0 on an 64-bit Amazon EC2 Ubuntu 8.04 hardy AMI.
</I>
There are two parts to this issue. Firstly, some priorities of messages
internally were changed either in 1.7.1 or 1.7.2 so that acks would have
higher priority internally than publishes. This helps solve this
problem, and so I would recommend you upgrade.

Secondly, you can help by setting a qos prefetch count on your consumers
- if, say, you set it to 10, then you're ensuring that each consumer
will only receive 10 messages before it must a) ack a message and b)
that ack is received *and*processed* by Rabbit. This will ensure the
unacked message count stays low.

Matthew

</PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007134.html">[rabbitmq-discuss] high number of unack'ed messages when queue	grows large
</A></li>
	<LI>Next message: <A HREF="007136.html">[rabbitmq-discuss] high number of unack'ed messages when queue	grows large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7135">[ date ]</a>
              <a href="thread.html#7135">[ thread ]</a>
              <a href="subject.html#7135">[ subject ]</a>
              <a href="author.html#7135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
