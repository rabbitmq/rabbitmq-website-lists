<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scalability?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Scalability%3F&In-Reply-To=4BE476C3.8040707%40dataraker.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007147.html">
   <LINK REL="Next"  HREF="007149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scalability?</H1>
    <B>Colin Clark</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Scalability%3F&In-Reply-To=4BE476C3.8040707%40dataraker.com"
       TITLE="[rabbitmq-discuss] Scalability?">colin at cloudeventprocessing.com
       </A><BR>
    <I>Fri May  7 21:40:03 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007147.html">[rabbitmq-discuss] Scalability?
</A></li>
        <LI>Next message: <A HREF="007149.html">[rabbitmq-discuss] Scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7148">[ date ]</a>
              <a href="thread.html#7148">[ thread ]</a>
              <a href="subject.html#7148">[ subject ]</a>
              <a href="author.html#7148">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wayne, (and Mathew below please)

If you send me your code for the pub's &amp; sub's, I will test it on one of 
our machines here.  I'm on the road this weekend, but will have access 
to a multi core 64 bit Ubuntu 10.04 with RabbitMQ 1.72, 4gig ram, 
lots-o-disk, etc. to test on Sunday evening.

Also, can you paint the complete picture of what you're doing - based 
upon what I've read so far, you've got a couple of producers, they're 
publishing, and then you've got a couple of subscribers dumping to 
Cassandra.  Is that correct?

When you say 1000 messages below, is that per second?

(I'm easily pushing ~20,000,000 messages a day with RabbitMQ and nada 
problema and that's nothing compared to other peeps out there so I'm 
sure that we can find something here)

Mathew - I'm going to test with the latest rabbitmq server as is on Ubu 
10.04 - if I need to rebuild with this new persistor, can you send me 
some pointers please (I usually build rabbitmq from source anyway, so 
maybe I've already got one laying around some where, but I want to make 
sure)

On 5/7/2010 3:23 PM, Wayne Van Den Handel wrote:
&gt;<i> I tried the high water mark setting and it now prevents too much 
</I>&gt;<i> memory from being used (barely) but as my test continued it eventually 
</I>&gt;<i> had a hard crash for another reason. I was hitting it with 2 producers 
</I>&gt;<i> throttled to 1000 messages each to a separate queue and 5 consumers. 
</I>&gt;<i> There was always 1000 messages each in the 2 queues and after 15 
</I>&gt;<i> minutes one of the producers crashed with an error (from the logs) 
</I>&gt;<i> {amqp_error,not_found,&quot;no queue 'xxx' in vhost '/'&quot;, queue.declare'}. 
</I>&gt;<i> I figured this was a timeout or something as the queue did exist and 
</I>&gt;<i> was being emptied by 3 different consumers actively.
</I>&gt;<i>
</I>&gt;<i> 5 seconds later the entire process died with an error (from the logs) 
</I>&gt;<i> &quot;exception on TCP connection ... connection_closed_abruptly&quot; and then 
</I>&gt;<i> &quot;closing TCP connection&quot;.
</I>&gt;<i>
</I>&gt;<i> I am new to queuing but frankly I don't know what to do. My Experience 
</I>&gt;<i> with this and other MQ products is less than compelling. Does this 
</I>&gt;<i> take a ton of tweaking to get stable? How do people manage to push 
</I>&gt;<i> 500k messages a day?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Wayne
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthew Sackman wrote:
</I>&gt;&gt;<i> Hi Wayne,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, May 07, 2010 at 07:48:54AM -0400, Wayne Van Den Handel wrote:
</I>&gt;&gt;<i>    
</I>&gt;&gt;&gt;<i> I will test the basic consume, thanks for the tip. The machine I am running
</I>&gt;&gt;&gt;<i> is a single socket 4 core with 4 gigs ram but there are other things running
</I>&gt;&gt;&gt;<i> and taking up memory. Is there a gc interval that can be set to get memory
</I>&gt;&gt;&gt;<i> back sooner? As I add messages and remove them I can see the exact memory
</I>&gt;&gt;&gt;<i> taken with the admin tool and it keeps going up. It seems the rate at which
</I>&gt;&gt;&gt;<i> I add to the queue exceeds the ability the clear memory. Basically even
</I>&gt;&gt;&gt;<i> though there is little in the queue at any time the memory use keeps going
</I>&gt;&gt;&gt;<i> up.
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rabbit assumes it gets the whole machine's memory to itself. If that's
</I>&gt;&gt;<i> not the case then you need to reduce the memory high watermark from 0.4
</I>&gt;&gt;<i> to some much lower figure - say, 0.1.
</I>&gt;&gt;<i> <A HREF="Seehttp://www.rabbitmq.com/extensions.html#memsup">Seehttp://www.rabbitmq.com/extensions.html#memsup</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;&gt;<i> At this point I am ready to give up until they harden the persister to
</I>&gt;&gt;&gt;<i> go to disk as I assume the persister is the problem.
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yup. The new persister currently requires you build from source, but it
</I>&gt;&gt;<i> is actively being QA'd and great progress has been made getting it into
</I>&gt;&gt;<i> default. We've gone from about 100 hunks difference a couple of weeks
</I>&gt;&gt;<i> ago to now about 13 - so things are very much moving in this direction.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In the mean time, many people are already using the new persister, which
</I>&gt;&gt;<i> is on branch &quot;bug21673&quot; and if you're comfortable compiling from source
</I>&gt;&gt;<i> and using some code which has not yet completed our QA process, then we
</I>&gt;&gt;<i> would encourage you to use it, with the understanding that there may
</I>&gt;&gt;<i> still be bugs in it. Further battle testing is always welcome and should
</I>&gt;&gt;<i> you come across any bugs, any bug reports you make are very gratefully
</I>&gt;&gt;<i> received.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthew
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>    
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100507/6d9ef7b1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100507/6d9ef7b1/attachment.htm</A> 
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007147.html">[rabbitmq-discuss] Scalability?
</A></li>
	<LI>Next message: <A HREF="007149.html">[rabbitmq-discuss] Scalability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7148">[ date ]</a>
              <a href="thread.html#7148">[ thread ]</a>
              <a href="subject.html#7148">[ subject ]</a>
              <a href="author.html#7148">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
