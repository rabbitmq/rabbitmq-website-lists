<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] detecting publish failure across restart
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20detecting%20publish%20failure%20across%20restart&In-Reply-To=28712608.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007415.html">
   <LINK REL="Next"  HREF="007419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] detecting publish failure across restart</H1>
    <B>David Wragg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20detecting%20publish%20failure%20across%20restart&In-Reply-To=28712608.post%40talk.nabble.com"
       TITLE="[rabbitmq-discuss] detecting publish failure across restart">david at rabbitmq.com
       </A><BR>
    <I>Mon May 31 14:21:57 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007415.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
        <LI>Next message: <A HREF="007419.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7418">[ date ]</a>
              <a href="thread.html#7418">[ thread ]</a>
              <a href="subject.html#7418">[ subject ]</a>
              <a href="author.html#7418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jesse,

&quot;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jesse at wavemarket.com</A>&quot; &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jesse at wavemarket.com</A>&gt; writes:
&gt;<i> I consistently see that the Java client sends some messages that do not
</I>&gt;<i> cause an exception and that do not make into the queue. I have a registered
</I>&gt;<i> ReturnListener, but it does not record any messages being returned.
</I>&gt;<i>
</I>&gt;<i> I understand that publishing a message is asynchronous, but surely there
</I>&gt;<i> must be a way to discover that message was not successfully published. What
</I>&gt;<i> am I missing?
</I>
This is almost certainly due to the issue that AMQP's basic.publish has
no corresponding response from the server to the client (at least, not
in the normal case).  Once a client has written the basic.publish
command otyo to the socket, it has done all it can.  So when you restart
RabbitMQ, the client has no way to know which publishes have been
recieved and processed by the server, and which are merely in
transmission (i.e. in the operating system's TCP socket buffer on the
client of server).

This lack of publish acks is often noted as a significant omission from
AMQP.

The workaroud is to use the transaction support in AMQP: Start a
transaction (with Channel.txSelect), do some publishes on the channel,
and then commit the transaction (with Channel.txCommit).  If the commit
completes successfully, you know that the publishes have taken place on
the server.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007415.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
	<LI>Next message: <A HREF="007419.html">[rabbitmq-discuss] detecting publish failure across restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7418">[ date ]</a>
              <a href="thread.html#7418">[ thread ]</a>
              <a href="subject.html#7418">[ subject ]</a>
              <a href="author.html#7418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
