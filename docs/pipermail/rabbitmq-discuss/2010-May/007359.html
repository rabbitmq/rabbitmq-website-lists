<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ failover and message loss
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20failover%20and%20message%20loss&In-Reply-To=49A7BA114AAC6A48B9C44CB06B7B987E0A4AC1D4%40HYDSVWIN004X.ivycomptech.partygaming.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007358.html">
   <LINK REL="Next"  HREF="007360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ failover and message loss</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20failover%20and%20message%20loss&In-Reply-To=49A7BA114AAC6A48B9C44CB06B7B987E0A4AC1D4%40HYDSVWIN004X.ivycomptech.partygaming.local"
       TITLE="[rabbitmq-discuss] RabbitMQ failover and message loss">matthew at rabbitmq.com
       </A><BR>
    <I>Fri May 21 15:50:26 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007358.html">[rabbitmq-discuss] RabbitMQ failover and message loss
</A></li>
        <LI>Next message: <A HREF="007360.html">[rabbitmq-discuss] RabbitMQ failover and message loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7359">[ date ]</a>
              <a href="thread.html#7359">[ thread ]</a>
              <a href="subject.html#7359">[ subject ]</a>
              <a href="author.html#7359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, May 21, 2010 at 06:55:57PM +0530, Radha Krishnan D wrote:
&gt;<i> I have 2 brokers clustered with each other.  They are load balanced by
</I>&gt;<i> having a HA proxy before them.
</I>
Ok, that's not a usual setup. If you actually have the two rabbit nodes
clustered together then you should have no need for the load balancer -
all clients can connect to either node and still reach every resource in
the broker.

&gt;<i> Now both P1 and C1 get connected to B2 and the test continues till we
</I>&gt;<i> stop all three.
</I>&gt;<i> 
</I>&gt;<i> Now, during the failover time we find message losses.
</I>&gt;<i> 
</I>&gt;<i> Is it expected  or can we make sure that no message gets lost.
</I>
That is expected. Queues are located on the node of the connection which
created the queue. When the node goes down, you'll lose that queue. When
your clients (re)connect to the broker and reach the other node, they
are recreating the queues and other resources, but are creating fresh,
empty queues at that point.

If you need to be able to withstand node failures then currently your
best bet is to use the Pacemaker Active/Passive guide at:
<A HREF="http://www.rabbitmq.com/pacemaker.html">http://www.rabbitmq.com/pacemaker.html</A>
You will need to publish all messages persistent to durable queues. You
should not need the load balancer and pacemaker will correctly ensure
that the two nodes are not both up at the same time.

&gt;<i> Also, when will be  channel.setReturnListener  called ? 
</I>
Well, you set it yourself. The ReturnListener is invoked as soon as any
Basic.Return method is read off the socket.

&gt;<i> Will it be called when the message does not reach the queue from the
</I>&gt;<i> exchange or when the message does reach the consumer from the queue ?
</I>
This is the difference between immediate and mandatory. Mandatory says
&quot;blow up if the msg doesn't make it to a queue&quot;. Immediate says &quot;blow up
if the msg doesn't make it through a queue to a consumer&quot;.

&gt;<i> In the clustered mode, exchanges are global across rabbitmq nodes .. are
</I>&gt;<i> the queues also global ?
</I>
They are visible globally within the cluster, but they are located in a
node.

Matthew

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007358.html">[rabbitmq-discuss] RabbitMQ failover and message loss
</A></li>
	<LI>Next message: <A HREF="007360.html">[rabbitmq-discuss] RabbitMQ failover and message loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7359">[ date ]</a>
              <a href="thread.html#7359">[ thread ]</a>
              <a href="subject.html#7359">[ subject ]</a>
              <a href="author.html#7359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
