From michael.laing at nytimes.com  Sat Mar  1 16:22:15 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sat, 1 Mar 2014 11:22:15 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
Message-ID: <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>

Our volumes are quite variable on the shovels, representing a high overall
degree of variability in our message volumes.

Just looking over the last 24 hours, shovel volume ranged from 25/sec to
2,500/sec on our Oregon core cluster.

Best,

Michael


On Fri, Feb 28, 2014 at 1:14 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Michael,
>
> On Fri, Feb 28, 2014 at 12:45 PM, Laing, Michael
> <michael.laing at nytimes.com> wrote:
> > So I turned to shovels for more simplicity and control at the expense of
> > more difficult configuration.
>
> Yes, it is quite a low level tool, but I guess sometimes your
> requirements are intricate enough to need to reach down to the lower
> layer.
>
> > Some of our core clusters support the 'retail' layer of instances that
> > gateway to clients (candles?). We are introducing federation into one of
> > these communication links because we want the propagation of client
> bindings
> > from the gateway instance to the core - an excellent feature of
> federation
> > and an important refinement for us.
>
> Using federation to implement an AMQP gateway seems like a common
> pattern. One wonders why it didn't go into the AMQP spec ....
>
> > Initially I had thought that the 'new' federation replaced the 'old'
> shovel,
> > but this is not true - each tool has its place although their
> capabilities
> > overlap.
> >
> > With easier configuration in 3.3, the lowly shovel may get its due!
>
> It's interesting to see that the shovel still lives on, despite it
> being quite an agricultural component. What sort of message volumes
> are you guys processing with this, BTW?
>
> Thanks for being so detailed about your experiences, it's much appreciated.
>
> Cheers,
>
> Ben
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/7d5454ad/attachment.html>

From mcintoshj at gmail.com  Sat Mar  1 17:21:35 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Sat, 1 Mar 2014 11:21:35 -0600
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
Message-ID: <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>

On our systems, we've seen consistent 400/sec on some queues. During a
heavy data load roughly 2500/sec per queue (these are short lived usually).
 Usually at that point flow control kicks in as our consumers can't quite
keep up.  We use x-consistent-hashes to get around network latency and
shovel each queue in a hash.  SO publishers publish to a fanout queue with
a random routing key, which is bound to an x-consistent-hash exchange bound
to 8 queues.  Each of the 8 queues is shoveled independently with a 1500
prefetch.  We've not been able to overload this mechanism easily - the
drive IO is typically our limiting factor.  Or the consumers as stated on
the remote side.  And that's because we're doing persistent messages,
publisher confirms, and a whole lot of checks to make sure we don't ever
lose anything.

Jason


On Sat, Mar 1, 2014 at 10:22 AM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> Our volumes are quite variable on the shovels, representing a high overall
> degree of variability in our message volumes.
>
> Just looking over the last 24 hours, shovel volume ranged from 25/sec to
> 2,500/sec on our Oregon core cluster.
>
> Best,
>
> Michael
>
>
> On Fri, Feb 28, 2014 at 1:14 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
>> Michael,
>>
>> On Fri, Feb 28, 2014 at 12:45 PM, Laing, Michael
>> <michael.laing at nytimes.com> wrote:
>> > So I turned to shovels for more simplicity and control at the expense of
>> > more difficult configuration.
>>
>> Yes, it is quite a low level tool, but I guess sometimes your
>> requirements are intricate enough to need to reach down to the lower
>> layer.
>>
>> > Some of our core clusters support the 'retail' layer of instances that
>> > gateway to clients (candles?). We are introducing federation into one of
>> > these communication links because we want the propagation of client
>> bindings
>> > from the gateway instance to the core - an excellent feature of
>> federation
>> > and an important refinement for us.
>>
>> Using federation to implement an AMQP gateway seems like a common
>> pattern. One wonders why it didn't go into the AMQP spec ....
>>
>> > Initially I had thought that the 'new' federation replaced the 'old'
>> shovel,
>> > but this is not true - each tool has its place although their
>> capabilities
>> > overlap.
>> >
>> > With easier configuration in 3.3, the lowly shovel may get its due!
>>
>> It's interesting to see that the shovel still lives on, despite it
>> being quite an agricultural component. What sort of message volumes
>> are you guys processing with this, BTW?
>>
>> Thanks for being so detailed about your experiences, it's much
>> appreciated.
>>
>> Cheers,
>>
>> Ben
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/48dbf3c4/attachment.html>

From michael.laing at nytimes.com  Sat Mar  1 18:00:36 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sat, 1 Mar 2014 13:00:36 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
Message-ID: <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>

Interesting. We don't use persistent messages. In fact the proxy clusters,
which stand between our internal clients and the core clusters, explicitly
remove persistence in case our clients 'forget'. We rely on replication
instead; our persistence requirements are 'outsourced' to a global
Cassandra cluster. So no disk IO hence no IO wait - our primo defense
against network partitions in AWS/EC2, and a nice performance boost.

Although principles play a part too: idempotency - when in doubt,
reconnect/resend/resubscribe; tolerate replicas. And we try to
realistically engineer for 5 9's of reliability or more, not 100%, as we
can decompose that target into realistic actions/costs.

ml


On Sat, Mar 1, 2014 at 12:21 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> On our systems, we've seen consistent 400/sec on some queues. During a
> heavy data load roughly 2500/sec per queue (these are short lived usually).
>  Usually at that point flow control kicks in as our consumers can't quite
> keep up.  We use x-consistent-hashes to get around network latency and
> shovel each queue in a hash.  SO publishers publish to a fanout queue with
> a random routing key, which is bound to an x-consistent-hash exchange bound
> to 8 queues.  Each of the 8 queues is shoveled independently with a 1500
> prefetch.  We've not been able to overload this mechanism easily - the
> drive IO is typically our limiting factor.  Or the consumers as stated on
> the remote side.  And that's because we're doing persistent messages,
> publisher confirms, and a whole lot of checks to make sure we don't ever
> lose anything.
>
> Jason
>
>
> On Sat, Mar 1, 2014 at 10:22 AM, Laing, Michael <michael.laing at nytimes.com
> > wrote:
>
>> Our volumes are quite variable on the shovels, representing a high
>> overall degree of variability in our message volumes.
>>
>> Just looking over the last 24 hours, shovel volume ranged from 25/sec to
>> 2,500/sec on our Oregon core cluster.
>>
>> Best,
>>
>> Michael
>>
>>
>> On Fri, Feb 28, 2014 at 1:14 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>
>>> Michael,
>>>
>>> On Fri, Feb 28, 2014 at 12:45 PM, Laing, Michael
>>> <michael.laing at nytimes.com> wrote:
>>> > So I turned to shovels for more simplicity and control at the expense
>>> of
>>> > more difficult configuration.
>>>
>>> Yes, it is quite a low level tool, but I guess sometimes your
>>> requirements are intricate enough to need to reach down to the lower
>>> layer.
>>>
>>> > Some of our core clusters support the 'retail' layer of instances that
>>> > gateway to clients (candles?). We are introducing federation into one
>>> of
>>> > these communication links because we want the propagation of client
>>> bindings
>>> > from the gateway instance to the core - an excellent feature of
>>> federation
>>> > and an important refinement for us.
>>>
>>> Using federation to implement an AMQP gateway seems like a common
>>> pattern. One wonders why it didn't go into the AMQP spec ....
>>>
>>> > Initially I had thought that the 'new' federation replaced the 'old'
>>> shovel,
>>> > but this is not true - each tool has its place although their
>>> capabilities
>>> > overlap.
>>> >
>>> > With easier configuration in 3.3, the lowly shovel may get its due!
>>>
>>> It's interesting to see that the shovel still lives on, despite it
>>> being quite an agricultural component. What sort of message volumes
>>> are you guys processing with this, BTW?
>>>
>>> Thanks for being so detailed about your experiences, it's much
>>> appreciated.
>>>
>>> Cheers,
>>>
>>> Ben
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/7c9414af/attachment.html>

From mchl.flks at gmail.com  Sat Mar  1 19:04:06 2014
From: mchl.flks at gmail.com (Michael Flaks)
Date: Sat, 1 Mar 2014 11:04:06 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
Message-ID: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>

Greetings. 

My error code is certainly short one: 

$ sudo rabbitmq-server start
ERROR: epmd error for host "127": badarg (unknown POSIX error)


In startup_log I get this: 

ERROR: epmd error for host "127": address (cannot connect to host/port)

 
Recently I start it on Ubuntu 12.04 virtual machine. Everything is up to 
date. Any ideas what to do? 
Will be glad for any help. Thanks.  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/7e480a3d/attachment.html>

From arunrao.seattle at gmail.com  Sat Mar  1 19:13:49 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Sat, 1 Mar 2014 11:13:49 -0800
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
In-Reply-To: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
References: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
Message-ID: <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>

1. Is this node part of a cluster? Otherwise, do a netstat and check if
there is any process listening on 4369 (number) or epmd string
2. can you telnet <other_node_ip_in_the_cluster> 4369

Thanks!


On Sat, Mar 1, 2014 at 11:04 AM, Michael Flaks <mchl.flks at gmail.com> wrote:

> Greetings.
>
> My error code is certainly short one:
>
> $ sudo rabbitmq-server start
> ERROR: epmd error for host "127": badarg (unknown POSIX error)
>
>
> In startup_log I get this:
>
> ERROR: epmd error for host "127": address (cannot connect to host/port)
>
>
> Recently I start it on Ubuntu 12.04 virtual machine. Everything is up to
> date. Any ideas what to do?
> Will be glad for any help. Thanks.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/570736f3/attachment.html>

From humg.thongit at gmail.com  Sat Mar  1 19:22:51 2014
From: humg.thongit at gmail.com (=?UTF-8?B?VHLhuqduIMSQ4bupYyBUaMO0bmc=?=)
Date: Sun, 2 Mar 2014 02:22:51 +0700
Subject: [rabbitmq-discuss] Monitoring application manager RabbitMQ
 server with .NET
In-Reply-To: <8B6A5B14-0E8D-49E5-971E-A288347A1420@rabbitmq.com>
References: <CAAriO7HNaqkO6uuiU=T6WRsHgZyE_zGj0Hz-00f72Mm5u1CSCQ@mail.gmail.com>
 <CAMcAHLWvoKyyjJg1zfZ5-XCYnD4==qjUDBRvPaiOTu7TmvFHUw@mail.gmail.com>
 <CAAc6ZR9C4DRubNLsyM1fJVF7DTdEN=z8XJ0NfxqJcSyaXesrWQ@mail.gmail.com>
 <CAAriO7FF2KK_NDF_POfWfDLNvch=JJ-W4iAPXvKW6QbZjrYs5Q@mail.gmail.com>
 <8B6A5B14-0E8D-49E5-971E-A288347A1420@rabbitmq.com>
Message-ID: <CAAriO7F8gd7DBaMU_Zmqw0cCsKwhuwyKsToNUwja0JGvbQyeJA@mail.gmail.com>

What is API in EasyNetQ?s client when i want to building application
display:

1. Total queue.
2. Total current message existing in a queue.
3. Total message into queue and dequeue.

Thanks you.


On 28 February 2014 02:02, Michael Klishin <mklishin at gopivotal.com> wrote:

>
> On 27 Feb 2014, at 22:37, Tr?n ??c Th?ng <humg.thongit at gmail.com> wrote:
>
> > I am can using RabbitMQ .NET client to do building application monitor
> RabbitMQ server?
> >
> > */ Monitor
> >               - Total queue
> >               - Total message in a queue
> >               - Get content message in queue
> >
> > Thank you.
>
> You can do #2 and #3 via AMQP but #3 will change message ordering:
>
>  * Response to Channel#QueueDeclare will contain (ready) message count
>  * Fetch queue head with Channel#BasicGet and requeue it. Note that this
> can change order of messages in the queue.
>
> In general, #2 and #3 should be done over AMQP, so using RabbitMQ .NET
> client.
>
> Number of queues can only be retrieved over HTTP API, e.g. using
> EasyNetQ?s client for it.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
-------------------------------------------------------------------------------------------------

*Tran Duc Thong*
Software engineering
Mobile: 0989 452 004
Email: humg.thongit at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140302/fffacae0/attachment.html>

From mchl.flks at gmail.com  Sat Mar  1 21:08:18 2014
From: mchl.flks at gmail.com (=?UTF-8?B?0JzQuNGI0LAg0KTQu9Cw0LrRgQ==?=)
Date: Sat, 1 Mar 2014 23:08:18 +0200
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
In-Reply-To: <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>
References: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
 <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>
Message-ID: <CACdrKmF7Ehx97wAA428k6yxmgE3j5mOLbLpE7MxeSNmhJV-LPw@mail.gmail.com>

Thank you for replying!

Everything is located on a localhost on one virtual machine. I'm trying to
start install-reedit.sh<https://github.com/reddit/reddit/blob/master/install-reddit.sh>,
to be specific.
And I tried the following:

$ epmd -debug
$ epmd: Sat Mar  1 22:57:34 2014: epmd running - daemon = 0
$ epmd: Sat Mar  1 22:57:34 2014: there is already a epmd running at port
4369


Also this:

$ netstat -lnptu | grep 4369

$ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
LISTEN      -

$ netstat -lnptu | grep epmd
$ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
LISTEN      1600/epmd

Telnet connects to 127.0.0.1 through this port freely.


On 1 March 2014 21:13, Arun Rao <arunrao.seattle at gmail.com> wrote:

> 1. Is this node part of a cluster? Otherwise, do a netstat and check if
> there is any process listening on 4369 (number) or epmd string
> 2. can you telnet <other_node_ip_in_the_cluster> 4369
>
> Thanks!
>
>
> On Sat, Mar 1, 2014 at 11:04 AM, Michael Flaks <mchl.flks at gmail.com>wrote:
>
>> Greetings.
>>
>> My error code is certainly short one:
>>
>> $ sudo rabbitmq-server start
>> ERROR: epmd error for host "127": badarg (unknown POSIX error)
>>
>>
>> In startup_log I get this:
>>
>> ERROR: epmd error for host "127": address (cannot connect to host/port)
>>
>>
>> Recently I start it on Ubuntu 12.04 virtual machine. Everything is up to
>> date. Any ideas what to do?
>> Will be glad for any help. Thanks.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/0a9dd489/attachment.html>

From humg.thongit at gmail.com  Sat Mar  1 22:01:24 2014
From: humg.thongit at gmail.com (=?UTF-8?Q?Tr=E1=BA=A7n_=C4=90=E1=BB=A9c_Th=C3=B4ng?=)
Date: Sat, 1 Mar 2014 14:01:24 -0800 (PST)
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
Message-ID: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>

Hi all.

I am try config mirrored-queue in rabbitmq but fail.

I am config clustering with 2 node (rabbitm at node1, rabbit at node2).

Now i am create a queue in rabbit at node1 with the name "q_node1"

<https://lh5.googleusercontent.com/-wxo0cFLVpF4/UxJX_fA9U8I/AAAAAAAAAQc/nIm_COb5V50/s1600/Untitled.png>
and it display in rabbit at node2.

When stop rabbit at node1 them the queue q_node1 in the node rabbit at node2 is 
not found.

How to config mirrored-queue in rabbit at node2.

Pls help me, step by step.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/f1d18d70/attachment.html>

From videlalvaro at gmail.com  Sat Mar  1 22:08:17 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 1 Mar 2014 23:08:17 +0100
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
Message-ID: <CAMcAHLXG4k7-KQ8hoPr0WiV_p=CyF_yMmTqzJzqEpm3C6Kxmsg@mail.gmail.com>

Hi,

Did you read the docs?

http://www.rabbitmq.com/ha.html

Specifically this section: http://www.rabbitmq.com/ha.html#genesis

Regards,

Alvaro


On Sat, Mar 1, 2014 at 11:01 PM, Tr?n ??c Th?ng <humg.thongit at gmail.com>wrote:

> Hi all.
>
> I am try config mirrored-queue in rabbitmq but fail.
>
> I am config clustering with 2 node (rabbitm at node1, rabbit at node2).
>
> Now i am create a queue in rabbit at node1 with the name "q_node1"
>
>
> <https://lh5.googleusercontent.com/-wxo0cFLVpF4/UxJX_fA9U8I/AAAAAAAAAQc/nIm_COb5V50/s1600/Untitled.png>
> and it display in rabbit at node2.
>
> When stop rabbit at node1 them the queue q_node1 in the node rabbit at node2 is
> not found.
>
> How to config mirrored-queue in rabbit at node2.
>
> Pls help me, step by step.
>
> Thank you.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/250944dc/attachment.html>

From humg.thongit at gmail.com  Sat Mar  1 22:35:38 2014
From: humg.thongit at gmail.com (=?UTF-8?Q?Tr=E1=BA=A7n_=C4=90=E1=BB=A9c_Th=C3=B4ng?=)
Date: Sat, 1 Mar 2014 14:35:38 -0800 (PST)
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
Message-ID: <d03888a1-060c-4f72-9e27-a780f45298d3@googlegroups.com>

I am read tutorial here http://www.rabbitmq.com/ha.html

My config here

<https://lh4.googleusercontent.com/-aCVFkSk1akA/UxJgbF2R_eI/AAAAAAAAAQs/l-O_Wt4nqHU/s1600/Untitled_1.png>

But is not woking mirrored-queue.

You can remote teamviewer to help me.

Your sky: humg.thongit

Thanks you.

On Sunday, 2 March 2014 05:01:24 UTC+7, Tr?n ??c Th?ng wrote:
>
> Hi all.
>
> I am try config mirrored-queue in rabbitmq but fail.
>
> I am config clustering with 2 node (rabbitm at node1, rabbit at node2).
>
> Now i am create a queue in rabbit at node1 with the name "q_node1"
>
>
> <https://lh5.googleusercontent.com/-wxo0cFLVpF4/UxJX_fA9U8I/AAAAAAAAAQc/nIm_COb5V50/s1600/Untitled.png>
> and it display in rabbit at node2.
>
> When stop rabbit at node1 them the queue q_node1 in the node rabbit at node2 is 
> not found.
>
> How to config mirrored-queue in rabbit at node2.
>
> Pls help me, step by step.
>
> Thank you.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/0f874b64/attachment.html>

From 0x6e6562 at gmail.com  Sat Mar  1 23:21:30 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 1 Mar 2014 23:21:30 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
Message-ID: <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>

On Sat, Mar 1, 2014 at 6:00 PM, Laing, Michael
<michael.laing at nytimes.com> wrote:
> We rely on replication
> instead; our persistence requirements are 'outsourced' to a global Cassandra
> cluster.

Interesting. So you're using Rabbit for event notification rather than
reliable(*) transfer of state?

(*) For some value of reliable.

From arunrao.seattle at gmail.com  Sun Mar  2 00:05:40 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Sat, 1 Mar 2014 16:05:40 -0800
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
In-Reply-To: <CACdrKmF7Ehx97wAA428k6yxmgE3j5mOLbLpE7MxeSNmhJV-LPw@mail.gmail.com>
References: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
 <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>
 <CACdrKmF7Ehx97wAA428k6yxmgE3j5mOLbLpE7MxeSNmhJV-LPw@mail.gmail.com>
Message-ID: <CAEJg2GC_S0AjMzCTPPV+LuXzfMt6GxgTq0KzcWYnS5NkR0rGKg@mail.gmail.com>

can you type hostname in your command line and provide the result?

Thanks!


On Sat, Mar 1, 2014 at 1:08 PM, ???? ????? <mchl.flks at gmail.com> wrote:

> Thank you for replying!
>
> Everything is located on a localhost on one virtual machine. I'm trying to
> start install-reedit.sh<https://github.com/reddit/reddit/blob/master/install-reddit.sh>,
> to be specific.
> And I tried the following:
>
> $ epmd -debug
> $ epmd: Sat Mar  1 22:57:34 2014: epmd running - daemon = 0
> $ epmd: Sat Mar  1 22:57:34 2014: there is already a epmd running at port
> 4369
>
>
> Also this:
>
> $ netstat -lnptu | grep 4369
>
> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
> LISTEN      -
>
> $ netstat -lnptu | grep epmd
> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
> LISTEN      1600/epmd
>
> Telnet connects to 127.0.0.1 through this port freely.
>
>
> On 1 March 2014 21:13, Arun Rao <arunrao.seattle at gmail.com> wrote:
>
>> 1. Is this node part of a cluster? Otherwise, do a netstat and check if
>> there is any process listening on 4369 (number) or epmd string
>> 2. can you telnet <other_node_ip_in_the_cluster> 4369
>>
>> Thanks!
>>
>>
>> On Sat, Mar 1, 2014 at 11:04 AM, Michael Flaks <mchl.flks at gmail.com>wrote:
>>
>>> Greetings.
>>>
>>> My error code is certainly short one:
>>>
>>> $ sudo rabbitmq-server start
>>> ERROR: epmd error for host "127": badarg (unknown POSIX error)
>>>
>>>
>>> In startup_log I get this:
>>>
>>> ERROR: epmd error for host "127": address (cannot connect to host/port)
>>>
>>>
>>> Recently I start it on Ubuntu 12.04 virtual machine. Everything is up to
>>> date. Any ideas what to do?
>>> Will be glad for any help. Thanks.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/2fe4013d/attachment.html>

From mklishin at gopivotal.com  Sun Mar  2 02:56:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 2 Mar 2014 06:56:08 +0400
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <d03888a1-060c-4f72-9e27-a780f45298d3@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
 <d03888a1-060c-4f72-9e27-a780f45298d3@googlegroups.com>
Message-ID: <69EAD58C-F9F5-416B-BECD-FA2158A71EA7@rabbitmq.com>


On 2 Mar 2014, at 02:35, Tr?n ??c Th?ng <humg.thongit at gmail.com> wrote:

> But is not woking mirrored-queue.

Can you be more specific? If queue names are matched by the patterns
in the policies, mirroring should be enabled. In management UI you will see
a list of nodes for HA queues (master and mirrors).

MK

Software Engineer, Pivotal/RabbitMQ



From michael.laing at nytimes.com  Sun Mar  2 03:21:31 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sat, 1 Mar 2014 22:21:31 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
 <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
Message-ID: <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>

Persistence might increase reliability when you plan to restart nodes and
need to regain state. We don't do that.

We have clusters of 3 nodes across independent zones - forming an AWS
region - and run with 3 regions, i.e. nine nodes in the core, replicating
the processing of important messages across these core clusters. We have
several other ancillary clusters for clients, proxies, etc., also in
multiple regions.

We target queue lengths of zero and are close most of the time. Anything
else stands out like a black spot on a white sheet.

So we never restart nodes that die. Just sync in new ones. Actually we have
not yet had any core nodes die in production.

Our Cassandra cluster of 18 nodes, 6 per region, synchronizes globally in
less than 1 sec, and persists all of our message traffic in multiple useful
inversions. We use a replication factor of 3 per region so every message
has nine copies; important ones have many more due to message replication.
We push and pull a lot from this cache.

Our instances are ridiculously small and inexpensive to run. We rely on
this global, headless, mutually supporting rabbit army for our reliability,
paired with a small Cassandra horde.

ml





On Sat, Mar 1, 2014 at 6:21 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> On Sat, Mar 1, 2014 at 6:00 PM, Laing, Michael
> <michael.laing at nytimes.com> wrote:
> > We rely on replication
> > instead; our persistence requirements are 'outsourced' to a global
> Cassandra
> > cluster.
>
> Interesting. So you're using Rabbit for event notification rather than
> reliable(*) transfer of state?
>
> (*) For some value of reliable.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/80f5b69b/attachment.html>

From humg.thongit at gmail.com  Sun Mar  2 03:22:30 2014
From: humg.thongit at gmail.com (=?UTF-8?Q?Tr=E1=BA=A7n_=C4=90=E1=BB=A9c_Th=C3=B4ng?=)
Date: Sat, 1 Mar 2014 19:22:30 -0800 (PST)
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
Message-ID: <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>

Some picture for my rabbitmq server

*List Node*

<https://lh6.googleusercontent.com/-H-M_3zdHhj0/UxKjXhphEsI/AAAAAAAAARA/rLk8YrN4unc/s1600/2014-03-01>
*Policies config*

<https://lh3.googleusercontent.com/-MQOe8oHwoYU/UxKjtkOaS6I/AAAAAAAAARE/7RIt7LcRaPk/s1600/policies.png>
*List Queue*

<https://lh6.googleusercontent.com/-sDYmtPbSigc/UxKj1KVPXhI/AAAAAAAAARM/bPtE9qq7nrc/s1600/queue.png>
*Add Queue*

<https://lh4.googleusercontent.com/-AcRyTTBn4X8/UxKj7FaFdNI/AAAAAAAAARU/r6OyOgfGDSg/s1600/add_qu%C3%AAu.png>


On Sunday, 2 March 2014 05:01:24 UTC+7, Tr?n ??c Th?ng wrote:
>
> Hi all.
>
> I am try config mirrored-queue in rabbitmq but fail.
>
> I am config clustering with 2 node (rabbitm at node1, rabbit at node2).
>
> Now i am create a queue in rabbit at node1 with the name "q_node1"
>
>
> <https://lh5.googleusercontent.com/-wxo0cFLVpF4/UxJX_fA9U8I/AAAAAAAAAQc/nIm_COb5V50/s1600/Untitled.png>
> and it display in rabbit at node2.
>
> When stop rabbit at node1 them the queue q_node1 in the node rabbit at node2 is 
> not found.
>
> How to config mirrored-queue in rabbit at node2.
>
> Pls help me, step by step.
>
> Thank you.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/466f3872/attachment.html>

From arunrao.seattle at gmail.com  Sun Mar  2 04:00:10 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Sat, 1 Mar 2014 20:00:10 -0800
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
 <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>
Message-ID: <CAEJg2GAR9vYZZU=jjKCwNAHkF0Jf-s0=Tfmm8jpE_XfDuTeEyA@mail.gmail.com>

Your policy pattern did not match any queue name. Please apply a policy
with the pattern = .*

.* applies to all matches.

Thanks!


On Sat, Mar 1, 2014 at 7:22 PM, Tr?n ??c Th?ng <humg.thongit at gmail.com>wrote:

> Some picture for my rabbitmq server
>
> *List Node*
>
>
> <https://lh6.googleusercontent.com/-H-M_3zdHhj0/UxKjXhphEsI/AAAAAAAAARA/rLk8YrN4unc/s1600/2014-03-01>
> *Policies config*
>
>
> <https://lh3.googleusercontent.com/-MQOe8oHwoYU/UxKjtkOaS6I/AAAAAAAAARE/7RIt7LcRaPk/s1600/policies.png>
> *List Queue*
>
>
> <https://lh6.googleusercontent.com/-sDYmtPbSigc/UxKj1KVPXhI/AAAAAAAAARM/bPtE9qq7nrc/s1600/queue.png>
> *Add Queue*
>
>
> <https://lh4.googleusercontent.com/-AcRyTTBn4X8/UxKj7FaFdNI/AAAAAAAAARU/r6OyOgfGDSg/s1600/add_qu%C3%AAu.png>
>
>
> On Sunday, 2 March 2014 05:01:24 UTC+7, Tr?n ??c Th?ng wrote:
>
>> Hi all.
>>
>> I am try config mirrored-queue in rabbitmq but fail.
>>
>> I am config clustering with 2 node (rabbitm at node1, rabbit at node2).
>>
>> Now i am create a queue in rabbit at node1 with the name "q_node1"
>>
>>
>> <https://lh5.googleusercontent.com/-wxo0cFLVpF4/UxJX_fA9U8I/AAAAAAAAAQc/nIm_COb5V50/s1600/Untitled.png>
>> and it display in rabbit at node2.
>>
>> When stop rabbit at node1 them the queue q_node1 in the node rabbit at node2is not found.
>>
>> How to config mirrored-queue in rabbit at node2.
>>
>> Pls help me, step by step.
>>
>> Thank you.
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140301/df5f2841/attachment.html>

From mchl.flks at gmail.com  Sun Mar  2 10:12:21 2014
From: mchl.flks at gmail.com (=?UTF-8?B?0JzQuNGI0LAg0KTQu9Cw0LrRgQ==?=)
Date: Sun, 2 Mar 2014 12:12:21 +0200
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
In-Reply-To: <CAEJg2GC_S0AjMzCTPPV+LuXzfMt6GxgTq0KzcWYnS5NkR0rGKg@mail.gmail.com>
References: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
 <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>
 <CACdrKmF7Ehx97wAA428k6yxmgE3j5mOLbLpE7MxeSNmhJV-LPw@mail.gmail.com>
 <CAEJg2GC_S0AjMzCTPPV+LuXzfMt6GxgTq0KzcWYnS5NkR0rGKg@mail.gmail.com>
Message-ID: <CACdrKmGMS5fn=bh_+_zRZ5DR=-KzQnkivPk7j4jbk7pruyjG4w@mail.gmail.com>

Sure. It is:

$ hostname
127.0.0.1 localhost


Thank you for help.


On 2 March 2014 02:05, Arun Rao <arunrao.seattle at gmail.com> wrote:

> can you type hostname in your command line and provide the result?
>
> Thanks!
>
>
> On Sat, Mar 1, 2014 at 1:08 PM, ???? ????? <mchl.flks at gmail.com> wrote:
>
>> Thank you for replying!
>>
>> Everything is located on a localhost on one virtual machine. I'm trying
>> to start install-reedit.sh<https://github.com/reddit/reddit/blob/master/install-reddit.sh>,
>> to be specific.
>> And I tried the following:
>>
>> $ epmd -debug
>> $ epmd: Sat Mar  1 22:57:34 2014: epmd running - daemon = 0
>> $ epmd: Sat Mar  1 22:57:34 2014: there is already a epmd running at port
>> 4369
>>
>>
>> Also this:
>>
>> $ netstat -lnptu | grep 4369
>>
>> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
>> LISTEN      -
>>
>> $ netstat -lnptu | grep epmd
>> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
>> LISTEN      1600/epmd
>>
>> Telnet connects to 127.0.0.1 through this port freely.
>>
>>
>> On 1 March 2014 21:13, Arun Rao <arunrao.seattle at gmail.com> wrote:
>>
>>> 1. Is this node part of a cluster? Otherwise, do a netstat and check if
>>> there is any process listening on 4369 (number) or epmd string
>>> 2. can you telnet <other_node_ip_in_the_cluster> 4369
>>>
>>> Thanks!
>>>
>>>
>>> On Sat, Mar 1, 2014 at 11:04 AM, Michael Flaks <mchl.flks at gmail.com>wrote:
>>>
>>>> Greetings.
>>>>
>>>> My error code is certainly short one:
>>>>
>>>> $ sudo rabbitmq-server start
>>>> ERROR: epmd error for host "127": badarg (unknown POSIX error)
>>>>
>>>>
>>>> In startup_log I get this:
>>>>
>>>> ERROR: epmd error for host "127": address (cannot connect to host/port)
>>>>
>>>>
>>>> Recently I start it on Ubuntu 12.04 virtual machine. Everything is up
>>>> to date. Any ideas what to do?
>>>> Will be glad for any help. Thanks.
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140302/842be7db/attachment.html>

From mklishin at gopivotal.com  Sun Mar  2 10:23:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 2 Mar 2014 14:23:39 +0400
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
 <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>
Message-ID: <F12C8C59-F489-4605-B8B3-F3D4E43235A4@rabbitmq.com>


On 2 Mar 2014, at 07:22, Tr?n ??c Th?ng <humg.thongit at gmail.com> wrote:

> Some picture for my rabbitmq server

Your policies specify that nodes with names matching ^ha.* and ^two.*
should be mirrored. Queues ?q_node1?, ?q_node2? and ?aaa? do not match
either pattern. So they are not mirrored.

MK

Software Engineer, Pivotal/RabbitMQ



From humg.thongit at gmail.com  Sun Mar  2 11:45:38 2014
From: humg.thongit at gmail.com (=?UTF-8?B?VHLhuqduIMSQ4bupYyBUaMO0bmc=?=)
Date: Sun, 2 Mar 2014 18:45:38 +0700
Subject: [rabbitmq-discuss] How to config rabbitmqctl mirrored-queue
In-Reply-To: <F12C8C59-F489-4605-B8B3-F3D4E43235A4@rabbitmq.com>
References: <43ea07e9-1605-4e8b-983d-f96daba10b80@googlegroups.com>
 <4d29b0de-e756-4a31-b556-a612af7fa2ef@googlegroups.com>
 <F12C8C59-F489-4605-B8B3-F3D4E43235A4@rabbitmq.com>
Message-ID: <CAAriO7EoW617uFPcaVMjkRqwPtrX69W+qbwcODsgYkbMAGz_3g@mail.gmail.com>

Oh, thanks you.

I am stupid! :(


On 2 March 2014 17:23, Michael Klishin <mklishin at gopivotal.com> wrote:

>
> On 2 Mar 2014, at 07:22, Tr?n ??c Th?ng <humg.thongit at gmail.com> wrote:
>
> > Some picture for my rabbitmq server
>
> Your policies specify that nodes with names matching ^ha.* and ^two.*
> should be mirrored. Queues ?q_node1?, ?q_node2? and ?aaa? do not match
> either pattern. So they are not mirrored.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>


-- 
-------------------------------------------------------------------------------------------------

*Tran Duc Thong*
Software engineering
Mobile: 0989 452 004
Email: humg.thongit at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140302/d13a53b9/attachment.html>

From arunrao.seattle at gmail.com  Sun Mar  2 15:12:11 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Sun, 2 Mar 2014 07:12:11 -0800
Subject: [rabbitmq-discuss] RabbitMQ failed to start: epmd error for host
In-Reply-To: <CACdrKmGMS5fn=bh_+_zRZ5DR=-KzQnkivPk7j4jbk7pruyjG4w@mail.gmail.com>
References: <8b99d06f-9d88-41e5-9856-99010ce41a92@googlegroups.com>
 <CAEJg2GCLEBKWteViwHXj=hvMV8jEHqwY+F-DGM7eh30XAWrzJQ@mail.gmail.com>
 <CACdrKmF7Ehx97wAA428k6yxmgE3j5mOLbLpE7MxeSNmhJV-LPw@mail.gmail.com>
 <CAEJg2GC_S0AjMzCTPPV+LuXzfMt6GxgTq0KzcWYnS5NkR0rGKg@mail.gmail.com>
 <CACdrKmGMS5fn=bh_+_zRZ5DR=-KzQnkivPk7j4jbk7pruyjG4w@mail.gmail.com>
Message-ID: <CAEJg2GConvuCZXPCTrwiZW_+598K40UdiGaN=ecjBX0dD0gJuA@mail.gmail.com>

Your hosts file and hostname file seems to have gotten mixed up. Can you
run:

sudo hostname <tempFQDNhostname>

Then start rabbitmq-server?

Please note: this hostname setting will be gone once you reboot the VM or
physical machine.


On Sun, Mar 2, 2014 at 2:12 AM, ???? ????? <mchl.flks at gmail.com> wrote:

> Sure. It is:
>
> $ hostname
> 127.0.0.1 localhost
>
>
> Thank you for help.
>
>
> On 2 March 2014 02:05, Arun Rao <arunrao.seattle at gmail.com> wrote:
>
>> can you type hostname in your command line and provide the result?
>>
>> Thanks!
>>
>>
>> On Sat, Mar 1, 2014 at 1:08 PM, ???? ????? <mchl.flks at gmail.com> wrote:
>>
>>> Thank you for replying!
>>>
>>> Everything is located on a localhost on one virtual machine. I'm trying
>>> to start install-reedit.sh<https://github.com/reddit/reddit/blob/master/install-reddit.sh>,
>>> to be specific.
>>> And I tried the following:
>>>
>>> $ epmd -debug
>>> $ epmd: Sat Mar  1 22:57:34 2014: epmd running - daemon = 0
>>> $ epmd: Sat Mar  1 22:57:34 2014: there is already a epmd running at
>>> port 4369
>>>
>>>
>>> Also this:
>>>
>>> $ netstat -lnptu | grep 4369
>>>
>>> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
>>> LISTEN      -
>>>
>>> $ netstat -lnptu | grep epmd
>>> $ tcp        0      0 0.0.0.0:4369            0.0.0.0:*
>>> LISTEN      1600/epmd
>>>
>>> Telnet connects to 127.0.0.1 through this port freely.
>>>
>>>
>>> On 1 March 2014 21:13, Arun Rao <arunrao.seattle at gmail.com> wrote:
>>>
>>>> 1. Is this node part of a cluster? Otherwise, do a netstat and check if
>>>> there is any process listening on 4369 (number) or epmd string
>>>> 2. can you telnet <other_node_ip_in_the_cluster> 4369
>>>>
>>>> Thanks!
>>>>
>>>>
>>>> On Sat, Mar 1, 2014 at 11:04 AM, Michael Flaks <mchl.flks at gmail.com>wrote:
>>>>
>>>>> Greetings.
>>>>>
>>>>> My error code is certainly short one:
>>>>>
>>>>> $ sudo rabbitmq-server start
>>>>> ERROR: epmd error for host "127": badarg (unknown POSIX error)
>>>>>
>>>>>
>>>>> In startup_log I get this:
>>>>>
>>>>> ERROR: epmd error for host "127": address (cannot connect to host/port)
>>>>>
>>>>>
>>>>> Recently I start it on Ubuntu 12.04 virtual machine. Everything is up
>>>>> to date. Any ideas what to do?
>>>>> Will be glad for any help. Thanks.
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140302/a051f270/attachment.html>

From joey.jiaojg at gmail.com  Mon Mar  3 02:19:14 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 3 Mar 2014 10:19:14 +0800
Subject: [rabbitmq-discuss] Federation log
In-Reply-To: <530F248F.3060206@rabbitmq.com>
References: <CAKOmCvo1enN83dDjqUp5-YoWY3H=NLRzBE+3w6KR64JnuG6Msw@mail.gmail.com>
 <530F248F.3060206@rabbitmq.com>
Message-ID: <CAKOmCvq8r6p0CzUY5nQutopnAuod9N5WDZ-qMvvENZYjk30YCA@mail.gmail.com>

Hi Simon,
I noted there is a default catolog inside rabbit_log, like

info(Fmt)          -> log(default, info,    Fmt).
So will that make sense to use default catalog, same as connection in
rabbitmq.config?




2014-02-27 19:42 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 26/02/14 09:22, Joey Jiao wrote:
>
>> Hi Simon,
>> I think Federation doesn't obey log_levels setting.
>>
>
> You are right. The 'connection' category is used for inbound connections
> only.
>
>
>  As even I setting log_levels to warning, Federation still log info level
>> to log file.
>> Can you prompt me how to fix by myself first as I created very big log
>> size?
>>
>
> It can't be configured at the moment. I'll file a bug for more
> configurability here.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/58371a22/attachment.html>

From cfautsch at goodgamestudios.com  Mon Mar  3 08:18:06 2014
From: cfautsch at goodgamestudios.com (Claire Fautsch)
Date: Mon, 3 Mar 2014 09:18:06 +0100
Subject: [rabbitmq-discuss] Blocking Queue - Close connection by client
Message-ID: <CAK+mrqrER6DwPdZ_VA5D1yHryCHtc_7RzRsqZcHfM=OPbnX=_w@mail.gmail.com>

Hi,

we have following issue with blocking queues:

Once the memory watermark is reached, the connection from the client gets
blocked by the RabbitMQ server and it is no longer possible to publish
messages.

If this happens, we are for some time still able to publish  messages,
however they remain in the socket's write buffer and are not actually
published until the connection is un-blocked again. Once this buffer is
full, publishing blocks completely.

After some research we found out, that with a newer version of the official
Java client, it is possible to use blocked connection notifications to
react on this situation.

Our prefered reaction would be to close the connection, and re-connect to
another broker. Here however comes the problem: It is not possible to close
the connection to the RabbitMQ, as the method to do so, involves a flush on
the socket before the socket is closed and this is blocked as well.

Is there any possibility for a force-closed on the client side? Or is the
only possibility to open a new connection without closing the old one, and
"let it die"?

Re-writing the SocketFrameHandler would of course also be a  possibility,
but one we would (if possible) like to avoid. (see also discussion here :
https://github.com/rabbitmq/rabbitmq-java-client/issues/11)


Additionally, when we see blocking connections occurring, we frequently see
following stack trace in our logs, where we are not absolutely sure where
it comes from, or rather why it occurs

com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.io.EOFException

at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)

at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:37)

at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:349)

at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:569)

at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:501)

...

Caused by: java.io.EOFException

at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:494)at
java.io.DataInputStream.readUnsignedByte(Unknown Source)

at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)

at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)

at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)


For information, we are currently using Java client,
com.rabbitmq:amqp-client version 3.1.4

and com.zanox.lib.rabbiteasy version:rabbiteasy-core version 1.2.0, for the
connection handling (SingleConnectionFactory) and publishing.

Thanks in advance for any hint or ideas.

Regards

Claire
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/0218e162/attachment.html>

From mklishin at gopivotal.com  Mon Mar  3 09:04:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 3 Mar 2014 13:04:10 +0400
Subject: [rabbitmq-discuss] Blocking Queue - Close connection by client
In-Reply-To: <CAK+mrqrER6DwPdZ_VA5D1yHryCHtc_7RzRsqZcHfM=OPbnX=_w@mail.gmail.com>
References: <CAK+mrqrER6DwPdZ_VA5D1yHryCHtc_7RzRsqZcHfM=OPbnX=_w@mail.gmail.com>
Message-ID: <F6595621-945B-4AFD-8CD1-A5A682373C80@rabbitmq.com>


On 3 Mar 2014, at 12:18, Claire Fautsch <cfautsch at goodgamestudios.com> wrote:

> After some research we found out, that with a newer version of the official Java client, it is possible to use blocked connection notifications to react on this situation.  
> 
> Our prefered reaction would be to close the connection, and re-connect to another broker. Here however comes the problem: It is not possible to close the connection to the RabbitMQ, as the method to do so, involves a flush on the socket before the socket is closed and this is blocked as well.
> 
> Is there any possibility for a force-closed on the client side? Or is the only possibility to open a new connection without closing the old one, and ?let it die??

Connection#abort is the same as Connection#close but ignores IOExceptions (EOFExceptions included).

This is just a workaround, though. Adding more consumer capacity to avoid frequently blocked connections
would be a better idea.

See also https://www.rabbitmq.com/blog/2014/01/23/preventing-unbounded-buffers-with-rabbitmq/


> Re-writing the SocketFrameHandler would of course also be a  possibility, but one we would (if possible) like to avoid. (see also discussion here : https://github.com/rabbitmq/rabbitmq-java-client/issues/11)

So far the conclusion is that it will involve fairly significant changes because it?d be necessary to switch to NIO.

> Additionally, when we see blocking connections occurring, we frequently see following stack trace in our logs, where we are not absolutely sure where it comes from, or rather why it occurs
> 
> com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.io.EOFException
> at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
> at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:37)
> at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:349)
> at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:569)
> at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:501)

You can inspect the cause exception?s trace (ShutdownSignalException#getCause).

MK

Software Engineer, Pivotal/RabbitMQ



From fancyerii at gmail.com  Mon Mar  3 09:52:10 2014
From: fancyerii at gmail.com (Li Li)
Date: Mon, 3 Mar 2014 17:52:10 +0800
Subject: [rabbitmq-discuss] can rabbitmq(amqp) do this for me?
Message-ID: <CAFAd71WCRRtV9LbhsafT_tdjQkt6jKAe-Z1fFb-zQtUe6NSVfw@mail.gmail.com>

hi all,
    I want to use something like a message queue to implement a
distributed system. there are one producer and many consumers to
balance the load. messages will be randomed dispatched to all the
consumers. if one consumer receive a message, it will process this
message. but sometimes this particular consumer will be unable to
process this message, it can 'refuse' this message and other consumers
can process this one?

From grzegorz.gebura at gmail.com  Mon Mar  3 09:06:31 2014
From: grzegorz.gebura at gmail.com (=?UTF-8?Q?Grzegorz_G=C4=99bura?=)
Date: Mon, 3 Mar 2014 01:06:31 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with security using STOMP
Message-ID: <5e82800f-f9d4-450c-953f-a98bbc0f5072@googlegroups.com>

Hello everyone,

I try to prepare some simple model for sending messages to web browser 
using rabbitMQ. I want to use only one exchange with many queues, which 
will be created by user connecting by STOMP (exclusive and auto-delete 
queues). Queues are bound by random token as routing key and user have to 
know this token to read current queue.
I have two problems:
1) user can get login and password and create his own connection and 
subscribe to my exchange with # routing key and read all messages. Is there 
any possibility to disallow subscribing with # routing key (maybe by 
determining user permissions)? I want to use only one user with restricted 
permissions (only reading defined exchange and creating auto-deleted, 
exclusive queues).
I don't want to create exchanges per user (this will solve my problem), 
because I will have to create and manage users and exchanges by HTTP API.
2) user can subscribe many queues so he can create million of queues and 
crush my rabbit server. Can I handle that by limiting queues per connection 
or exchange?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/0ff2c8b8/attachment.html>

From grzegorz.gebura at gmail.com  Mon Mar  3 09:10:11 2014
From: grzegorz.gebura at gmail.com (=?UTF-8?Q?Grzegorz_G=C4=99bura?=)
Date: Mon, 3 Mar 2014 01:10:11 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP user access control
Message-ID: <1e650abd-deb5-46ac-bca8-db9356137d19@googlegroups.com>

Hello everyone,

I try to prepare some simple model for sending messages to web browser 
using rabbitMQ. I want to use only one exchange with many queues, which 
will be created by user connecting by STOMP (exclusive and auto-delete 
queues). Queues are bound by random token as routing key and user have to 
know this token to read current queue.
I have two problems:
1) user can get login and password and create his own connection and 
subscribe to my exchange with # routing key and read all messages. Is there 
any possibility to disallow subscribing with # routing key (maybe by 
determining user permissions)? I want to use only one user with restricted 
permissions (only reading defined exchange and creating auto-deleted, 
exclusive queues).
I don't want to create exchanges per user (this will solve my problem), 
because I will have to create and manage users and exchanges by HTTP API.
2) user can subscribe many queues so he can create million of queues and 
crush my rabbit server. Can I handle that by limiting queues per connection 
or exchange?

Is this model really possible?
Thanks for any suggestions.

Regards, Greg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/6f8d0b30/attachment.html>

From srinath.c at gmail.com  Mon Mar  3 09:59:35 2014
From: srinath.c at gmail.com (Srinath C)
Date: Mon, 3 Mar 2014 15:29:35 +0530
Subject: [rabbitmq-discuss] can rabbitmq(amqp) do this for me?
In-Reply-To: <CAFAd71WCRRtV9LbhsafT_tdjQkt6jKAe-Z1fFb-zQtUe6NSVfw@mail.gmail.com>
References: <CAFAd71WCRRtV9LbhsafT_tdjQkt6jKAe-Z1fFb-zQtUe6NSVfw@mail.gmail.com>
Message-ID: <CAHhx-G+0nJ+aGT6nOFpezwSUAtAiubfy+w5N8hYfCSzqX8X1Cw@mail.gmail.com>

This tutorial is what you want -
http://www.rabbitmq.com/tutorials/tutorial-two-java.html


On Mon, Mar 3, 2014 at 3:22 PM, Li Li <fancyerii at gmail.com> wrote:

> hi all,
>     I want to use something like a message queue to implement a
> distributed system. there are one producer and many consumers to
> balance the load. messages will be randomed dispatched to all the
> consumers. if one consumer receive a message, it will process this
> message. but sometimes this particular consumer will be unable to
> process this message, it can 'refuse' this message and other consumers
> can process this one?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/678e7647/attachment.html>

From michael.s.klishin at gmail.com  Mon Mar  3 10:00:41 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Mar 2014 14:00:41 +0400
Subject: [rabbitmq-discuss] can rabbitmq(amqp) do this for me?
In-Reply-To: <CAFAd71WCRRtV9LbhsafT_tdjQkt6jKAe-Z1fFb-zQtUe6NSVfw@mail.gmail.com>
References: <CAFAd71WCRRtV9LbhsafT_tdjQkt6jKAe-Z1fFb-zQtUe6NSVfw@mail.gmail.com>
Message-ID: <CAE3HoVQf17hxm0_4-WyBQNV8j-qU_NsfuP3uQQ8H+Pnrv3kXTA@mail.gmail.com>

2014-03-03 13:52 GMT+04:00 Li Li <fancyerii at gmail.com>:

>     I want to use something like a message queue to implement a
> distributed system. there are one producer and many consumers to
> balance the load. messages will be randomed dispatched to all the
> consumers. if one consumer receive a message, it will process this
> message. but sometimes this particular consumer will be unable to
> process this message, it can 'refuse' this message and other consumers
> can process this one?
>

There is a couple of ways to do it:

 * Use a single queue per consumer (straightforward, not scalable with
large message volumes) and basic.reject. This will give you round-robin
distribution between consumers.

See tutorial 2:
http://www.rabbitmq.com/getstarted.html if this sounds appropriate for your
case.

 * Use a queue per consumer, (mostly) evenly distribute messages between
them using
x-random or x-consistent-hash exchanges:

https://github.com/jbrisbin/random-exchange
https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange

(the latter ships with recent RabbitMQ versions but need to be enabled
using rabbitmq-plugins).

In this case to refuse processing a message, consumers will have to
republish them
to the exchange. This in turn requires more careful error handling logic in
your consumers.

The latter approach is much more scalable.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/fbb27319/attachment.html>

From michael.s.klishin at gmail.com  Mon Mar  3 10:03:11 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Mar 2014 14:03:11 +0400
Subject: [rabbitmq-discuss] Problem with security using STOMP
In-Reply-To: <5e82800f-f9d4-450c-953f-a98bbc0f5072@googlegroups.com>
References: <5e82800f-f9d4-450c-953f-a98bbc0f5072@googlegroups.com>
Message-ID: <CAE3HoVR0XUOV-xudV5EvMHLwpyqZOSA=ceUzC2xQF5JGDiMd1w@mail.gmail.com>

2014-03-03 13:06 GMT+04:00 Grzegorz G?bura <grzegorz.gebura at gmail.com>:

> 1) user can get login and password and create his own connection and
> subscribe to my exchange with # routing key and read all messages. Is there
> any possibility to disallow subscribing with # routing key (maybe by
> determining user permissions)? I want to use only one user with restricted
> permissions (only reading defined exchange and creating auto-deleted,
> exclusive queues).
> I don't want to create exchanges per user (this will solve my problem),
> because I will have to create and manage users and exchanges by HTTP API.
>

See http://www.rabbitmq.com/access-control.html


> 2) user can subscribe many queues so he can create million of queues and
> crush my rabbit server. Can I handle that by limiting queues per connection
> or exchange?
>

There is no such limit. Channels/queues/exchanges can be monitored over
HTTP API (which is what hosted RabbitMQ
solutions use), which also allows you to forcefully close connections:

http://www.rabbitmq.com/management.html
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_3/priv/www/api/index.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/a37bf117/attachment.html>

From aijie09004121 at 163.com  Mon Mar  3 10:19:54 2014
From: aijie09004121 at 163.com (aijie09004121)
Date: Mon, 3 Mar 2014 18:19:54 +0800 (CST)
Subject: [rabbitmq-discuss] rabbitmq saw deaths of mirrors
Message-ID: <7ab5301d.1803e.1448774fa17.Coremail.aijie09004121@163.com>

Hello:
When I send more than 10000 messages to the rabbitmq-cluster(two disc,on ram)  ,I saw these logs 'rabbitmq saw deaths of mirrors'.I don't know why it happens.But when I slow the speed of sending messages,it was successful. I want to know the reason.Hope to receive answers soon.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/637b8c9c/attachment.html>

From mklishin at gopivotal.com  Mon Mar  3 10:40:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 3 Mar 2014 14:40:14 +0400
Subject: [rabbitmq-discuss] rabbitmq saw deaths of mirrors
In-Reply-To: <7ab5301d.1803e.1448774fa17.Coremail.aijie09004121@163.com>
References: <7ab5301d.1803e.1448774fa17.Coremail.aijie09004121@163.com>
Message-ID: <8634B54E-87CB-4183-ABA8-E8BC29CC2833@rabbitmq.com>

On 3 Mar 2014, at 14:19, aijie09004121 <aijie09004121 at 163.com> wrote:

> Hello:
> 	When I send more than 10000 messages to the rabbitmq-cluster(two disc,on ram)  ,I saw these logs 'rabbitmq saw deaths of mirrors'.

What version are you running? It sounds like a bug that was fixed in one of the
recent releases.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Mon Mar  3 12:03:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 3 Mar 2014 16:03:29 +0400
Subject: [rabbitmq-discuss] Connections loses its only channel,
	websocket doesn't close
In-Reply-To: <CAPH5wFqBnKsX3Jn95iMn4htfEMVvaQjVSWZ+AZK1baM7CXN5Bw@mail.gmail.com>
References: <CAPH5wFrV3Rt5Ehnt0iMx+O+VCMcQF2MuFFT--Xpf-bPEGNs8og@mail.gmail.com>
 <959756A0-8DE5-4D3B-9C52-D048F33A9C1E@rabbitmq.com>
 <CAPH5wFqBnKsX3Jn95iMn4htfEMVvaQjVSWZ+AZK1baM7CXN5Bw@mail.gmail.com>
Message-ID: <CE5F3E9F-7DED-476D-A3B5-50491F43B2AF@rabbitmq.com>

On 25 Feb 2014, at 11:21, Nikita Tsukanov <keks9n at gmail.com> wrote:

> vhost "bugcheck" access rights for user "guest":
> 
> Configure: .* 
> Write: ^none$
> Read: .*
> 
> Script:
> 
> <html>
> <head>
> 
> 
> <script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>
> <script src="stomp.js"></script>
> <script>
> 
>     var ws = new SockJS('http://127.0.0.1:15674/stomp');
>     var client = Stomp.over(ws);
>     var on_connect = function() {
>         console.log('connected');
>         client.send('/topic/test', {"content-type":"text/plain"}, "LALALA");
>     };
>     var on_error =  function() {
>         console.log('error');
>     };
>     client.connect('guest', 'guest', on_connect, on_error, 'bugcheck');
>     function send()
>     {
>         client.send('/topic/test', {"content-type":"text/plain"}, "LALALA");
>         return false;
>     }
> </script>
> </head>
> <body><a href="javascript:send();"</body>
> </html>

Some investigation results I have so far:

 * STOMP 1.1 spec does not require servers to close network connection after
sending an ERROR command: http://stomp.github.io/stomp-specification-1.1.html#ERROR

 * STOMP 1.2 spec does: http://stomp.github.io/stomp-specification-1.2.html#ERROR


and stomp.js uses 1.1 by default:
https://github.com/jmesnil/stomp-websocket/blob/master/lib/stomp.js#L447

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Mon Mar  3 12:17:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Mar 2014 12:17:14 +0000
Subject: [rabbitmq-discuss] Federation log
In-Reply-To: <CAKOmCvq8r6p0CzUY5nQutopnAuod9N5WDZ-qMvvENZYjk30YCA@mail.gmail.com>
References: <CAKOmCvo1enN83dDjqUp5-YoWY3H=NLRzBE+3w6KR64JnuG6Msw@mail.gmail.com>
 <530F248F.3060206@rabbitmq.com>
 <CAKOmCvq8r6p0CzUY5nQutopnAuod9N5WDZ-qMvvENZYjk30YCA@mail.gmail.com>
Message-ID: <531472CA.3070900@rabbitmq.com>

On 03/03/2014 2:19AM, Joey Jiao wrote:
> Hi Simon,
> I noted there is a default catolog inside rabbit_log, like
>
> info(Fmt) -> log(default, info, Fmt).
> So will that make sense to use default catalog, same as connection in
> rabbitmq.config?

Well, if you reduce the log level for 'default' you'll be silencing 
everything (apart from connections...). Up to you, but I wouldn't do it 
myself.

The next feature release will introduce a 'federation' log category.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Mar  3 12:26:36 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Mar 2014 12:26:36 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
Message-ID: <531474FC.5060309@rabbitmq.com>

On 28/02/2014 6:14PM, Ben Hood wrote:
> Using federation to implement an AMQP gateway seems like a common
> pattern. One wonders why it didn't go into the AMQP spec ....

I dunno, I think federation is really quite specific (I don't think 
there are any other brokers which do it in the same way as RabbitMQ) - I 
can see the spec authors not wanting to predict how people will want to 
federate.

>> Initially I had thought that the 'new' federation replaced the 'old' shovel,
>> but this is not true - each tool has its place although their capabilities
>> overlap.
>>
>> With easier configuration in 3.3, the lowly shovel may get its due!
>
> It's interesting to see that the shovel still lives on, despite it
> being quite an agricultural component.

I think the concept ("I just want to move the damn messages!") makes a 
lot of sense.

If I were creating RabbitMQ from scratch, I might rename the shovel to 
something like "point-to-point federation" to make it a bit clearer that 
it complements federation rather than being replaced by it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Mar  3 12:28:29 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Mar 2014 12:28:29 +0000
Subject: [rabbitmq-discuss] Autoheal failure
In-Reply-To: <CACLE7ixyRMh0apHYs9ms_jo0cAH05H0XcQpjsux8dmnxepHY5g@mail.gmail.com>
References: <CACLE7izH6AP7A8VJLuAzqpOje822vYokZM7amy=HOHRGLYFA3A@mail.gmail.com>	<52F9F824.1010801@rabbitmq.com>
 <CACLE7ixyRMh0apHYs9ms_jo0cAH05H0XcQpjsux8dmnxepHY5g@mail.gmail.com>
Message-ID: <5314756D.4050901@rabbitmq.com>

On 11/02/2014 5:30PM, Matt Pietrek wrote:
> As for the prior Autoheal activity, here's a sanitized version of what
> I've got by grepping for "Autoheal", with a little bit of extra context
> (-C 10). Let me know if you need something else in particular.

Just to keep the list up to date: I was able to get to the bottom of 
this, and a fix will be in 3.2.4.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Mon Mar  3 12:37:17 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 3 Mar 2014 16:37:17 +0400
Subject: [rabbitmq-discuss] Bringing down Nodes in a cluster
In-Reply-To: <CALDntb9H9Gd=usbRkDw-hROfu9X7d9aAs9kRjohhh415pErYNQ@mail.gmail.com>
References: <CALDntb9H9Gd=usbRkDw-hROfu9X7d9aAs9kRjohhh415pErYNQ@mail.gmail.com>
Message-ID: <8DDBDBD6-384C-489A-B950-43E50072D112@rabbitmq.com>

On 28 Feb 2014, at 12:27, Patrick Long <pat at munkiisoft.com> wrote:

> So I can stop the node by using stop_app or I can stop the RabbitMQ service on that node. Is one better that the other?

Stop the service. stop_app does not stop the VM, which may be necessary with some upgrades
(e.g. you also want to upgrade the Erlang VM).

Use stop_app when resetting nodes, as described in ?Breaking up a cluster? [1].

> When Ops want to update a machine that is a Node in a 3 node RabbitMQ cluster what is the recommended approach?
> 
> Is it to stop the service on one node, run Windows Update etc etc then bring that node back. Once that node is confirmed move to next node always ensuring there is at least one synchronised slave? 

See ?Breaking up a cluster? in [1].

Removing nodes from the cluster and bringing them back one by one is a good
strategy.

HTH.

1. http://www.rabbitmq.com/clustering.html

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Mon Mar  3 12:47:34 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Mar 2014 12:47:34 +0000
Subject: [rabbitmq-discuss] |Spam| MQ Cluster Replication Traffic
	Questions
In-Reply-To: <095101cf33f4$d1476e70$73d64b50$@euphoriaaudio.com>
References: <095101cf33f4$d1476e70$73d64b50$@euphoriaaudio.com>
Message-ID: <531479E6.4010804@rabbitmq.com>

On 27/02/2014 7:47PM, Chris Larsen wrote:
> Despite the cross-over we were seeing network partition alerts with
> version 3.2.2. We saw NIC reset errors (Intel NICs) and just upgraded
> the drivers to fend off that problem and tried some buffer tuning. But
> we?re still dropping packets on the cross-over interface so I?m worried
> the partitions may continue. Here are the questions I have:
>
> 1)Is it a bad idea to use a cross-over like this?

It's certainly reasonable to use a separate network interface for 
clustering. But the network needs to be reliable - if you are seeing the 
NIC reset then that's probably not the case :-(

> 2)We?re seeing ~2.5Mbps in / ~10Mbps out on the public eth0 interface
> but ~45Mbps in / ~30Mbps out on the cross-over. Is that kind of
> amplification normal?

Depending on message size / use of mirroring, it could be. Mirroring 
increases the amount of traffic by a constant factor, and messages being 
sent across the cluster are somewhat more decoded than they are as AMQP, 
so can have a higher overhead.

> 3)If it?s ok to use the cross-over, what TCP tuning am I missing?

I'm afraid I can't offer advice on how to make your NIC reliable. But I 
would expect that TCP tuning parameters are not where the problem is 
likely to be.

Ultimately the occasional dropped packet should be fine; TCP should be 
able to recover from that! But if the NIC is resetting then you have a 
bigger problem.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From laptevakristi at gmail.com  Mon Mar  3 11:14:48 2014
From: laptevakristi at gmail.com (=?UTF-8?B?0JrRgNC40YHRgtC40L3QsCDQm9Cw0L/RgtC10LLQsA==?=)
Date: Mon, 3 Mar 2014 03:14:48 -0800 (PST)
Subject: [rabbitmq-discuss] Subscribe queueName in RabbitMQ
Message-ID: <c3904bba-e707-49cb-9b49-28284a37764e@googlegroups.com>

 private int handledMessages;

clusteringMessageBroker.Subscribe(
               clusteringOutputQueueName, ProcessMessage, 
typeof(ClusteringOutputMessage));
Thread.Sleep(380000);
clusteringMessageBroker.Unsubscribe(clusteringOutputQueueName, 
ProcessMessage);

private void ProcessMessage(object message)
        {
            clusteringMessage = (ClusteringOutputMessage)message;
            log.InfoFormat("add message {0}", 
clusteringMessage.UpdatedClusters.Count());
            handledMessages++;
            log.InfoFormat("Consumed {0} messages ", handledMessages);
            log.InfoFormat("ConsumedMessage {0}", handledMessages);

            var cluster = clusteringMessage.UpdatedClusters;
            var updatedClusters = cluster.Select(
                c =>
                new ClusteringOutputMessage.Cluster
                    {
                        Id = c.Id,
                        MainArticleId = c.MainArticleId,
                        ArticlesIds = c.ArticlesIds
                    }).ToList();

            foreach (var updatedCluster in updatedClusters)
            {
                log.InfoFormat("id {0}", updatedCluster.Id);
                log.InfoFormat("mainid {0}", updatedCluster.MainArticleId);
                foreach (var articleId in updatedCluster.ArticlesIds)
                {
                    log.InfoFormat("ArticleId {0}", articleId);
                }
            }
        }

I want to sibscribing clusteringOutputQueueName, but listening to the queue 
happens once in stages, according to several reports, and it turns out that 
the cycle runs several times and can not count the number of clusters.
I want to count updatedCluster.Id and i want to compare 
updatedCluster.ArticlesIds with the known value.
Help me please!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/20dc904c/attachment.html>

From jeff at jefftrout.com  Mon Mar  3 17:31:59 2014
From: jeff at jefftrout.com (Jeff)
Date: Mon, 03 Mar 2014 12:31:59 -0500
Subject: [rabbitmq-discuss] Lingering temporary queues in 3.2.3
Message-ID: <9D5ECADE-65CE-494C-B14E-E3DC0592EACD@jefftrout.com>

So we upgraded to 3.2.3 recently and we noticed a ton of amq.gen queues being created, and they were marked durable and none had consumers and no messages. We?d clear them out and they?d trickle back in.

I was able to track this down to a bug in an application where it sent a message to a queue named ?? (empty string). 
No error frame is returned, and the bad message is just dropped, but that queue remains.

Not sure if this is a bug in the stomp adaptor or elsewhere.  I

Here?s a small script to invoke it.

use Net::Stomp;
use Data::Dumper;

my $stomp = new Net::Stomp({ hostname => "rabbit", port => 61613 });

if(!$stomp->connect({ "login" => "guest", "passcode" => "guest" }))
{
	print "failed to connect\n";
	exit -1;
}
		
	
# reply to should be blank
$stomp->send({ "destination" => "", 
					body => "hi mom" });
	
# you now have an amq.gen queue that is durable sitting around with
# no message and no consumers.# you should now 
	
here?s some output:
root at fs2:~# rabbitmqctl list_queues | grep amq.gen
root at fs2:~# perl phantomq.pl
root at fs2:~# rabbitmqctl list_queues | grep amq.gen
amq.gen-EWgqTaiR-xL8bq_UumaXLg	0
root at fs2:~# curl -s -u indie:indie "http://fs2:15672/api/queues/%2F/amq.gen-EWgqTaiR-xL8bq_UumaXLg"
{"memory":14016,"messages":0,"messages_details":{"rate":0.0},"messages_ready":0,"messages_ready_details":{"rate":0.0},"messages_unacknowledged":0,"messages_unacknowledged_details":{"rate":0.0},"idle_since":"2014-03-03 12:26:37","policy":"ha-all","exclusive_consumer_tag":"","consumers":0,"slave_nodes":["rabbit at fs1"],"synchronised_slave_nodes":["rabbit at fs1"],"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0,"mirror_seen":0,"mirror_senders":0},"status":"running","incoming":[],"deliveries":[],"consumer_details":[],"name":"amq.gen-EWgqTaiR-xL8bq_UumaXLg","vhost":"/","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at fs2"}

--
Jeff Trout <jeff at jefftrout.com>






From clarsen at euphoriaaudio.com  Mon Mar  3 17:37:39 2014
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Mon, 3 Mar 2014 12:37:39 -0500
Subject: [rabbitmq-discuss] |Spam| MQ Cluster Replication Traffic
	Questions
In-Reply-To: <531479E6.4010804@rabbitmq.com>
References: <095101cf33f4$d1476e70$73d64b50$@euphoriaaudio.com>
 <531479E6.4010804@rabbitmq.com>
Message-ID: <01c001cf3707$46638620$d32a9260$@euphoriaaudio.com>

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, March 3, 2014 7:48 A
> > 3)If it's ok to use the cross-over, what TCP tuning am I missing?
> 
> I'm afraid I can't offer advice on how to make your NIC reliable. But I
would
> expect that TCP tuning parameters are not where the problem is likely to
be.
> 
> Ultimately the occasional dropped packet should be fine; TCP should be
able
> to recover from that! But if the NIC is resetting then you have a bigger
> problem.

Thanks Simon. It looks like the driver update fixed our reset issue. We'll
keep playing around tuning to see if we can stop the drops, but since
they're only incrementing every few minutes I'm sure Rabbit is doing
alright.


From michael.s.klishin at gmail.com  Mon Mar  3 18:04:48 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Mar 2014 22:04:48 +0400
Subject: [rabbitmq-discuss] Subscribe queueName in RabbitMQ
In-Reply-To: <c3904bba-e707-49cb-9b49-28284a37764e@googlegroups.com>
References: <c3904bba-e707-49cb-9b49-28284a37764e@googlegroups.com>
Message-ID: <CAE3HoVS3x4EMXhgU+PkzFqCujXO=UYOCEX7RZvDkemjDzU=QFA@mail.gmail.com>

2014-03-03 15:14 GMT+04:00 ???????? ??????? <laptevakristi at gmail.com>:

> clusteringMessageBroker.Subscribe(
>                clusteringOutputQueueName, ProcessMessage,
> typeof(ClusteringOutputMessage));
> Thread.Sleep(380000);
> clusteringMessageBroker.Unsubscribe(clusteringOutputQueueName,
> ProcessMessage);
>

This code seems to be using a wrapper over the .NET client. If I understand
you correctly
you want to consume one message (subscribe and immediately unsubscribe)?
You should
use IModel#BasicGet then.


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/dd4ed21e/attachment.html>

From michael.s.klishin at gmail.com  Mon Mar  3 18:06:40 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 3 Mar 2014 22:06:40 +0400
Subject: [rabbitmq-discuss] Lingering temporary queues in 3.2.3
In-Reply-To: <9D5ECADE-65CE-494C-B14E-E3DC0592EACD@jefftrout.com>
References: <9D5ECADE-65CE-494C-B14E-E3DC0592EACD@jefftrout.com>
Message-ID: <CAE3HoVQ4F9Wc3OWC89DtSAgw6_DUuhCOMq-1nSjfwdOQhiNLFw@mail.gmail.com>

2014-03-03 21:31 GMT+04:00 Jeff <jeff at jefftrout.com>:

> Not sure if this is a bug in the stomp adaptor or elsewhere.  I


Queues are created by STOMP adapter on the fly and in AMQP 0-9-1 semantics,
an empty
string means "server named". Perhaps STOMP adapter should treat such names
as invalid, not sure.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/bda8dcf2/attachment.html>

From mpietrek at skytap.com  Mon Mar  3 19:52:33 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 3 Mar 2014 11:52:33 -0800
Subject: [rabbitmq-discuss] Regex expression to exclude certain queues
 in the "Queue" tab?
In-Reply-To: <52F8A213.5040704@rabbitmq.com>
References: <CACLE7izSUGo-soP=+UULC2GFesG3QXirLZn3VQmSE9wB40XpZQ@mail.gmail.com>
 <52F8A213.5040704@rabbitmq.com>
Message-ID: <CACLE7izVbBGgrA5t6iaQ7upFdH=OcOfk+qV8b7bUK54oxcnn0w@mail.gmail.com>

> Are you sure? Is there a "Regex" checkbox?

No regex checkbox. I must have misunderstood when the regex feature came
into existance.


On Mon, Feb 10, 2014 at 1:55 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/02/2014 19:42, Matt Pietrek wrote:
>
>> I want to set the filter to exclude a set of queues, say... all queues
>> that start with "web-rpc".
>>
>
> Try:
>
> ^(?!web-rpc)(.+)$
>
> This can be generalised:
>
> ^(?!bad-prefix|another-bad-prefix|etc)(.+)$
>
>
>  I'm on 3.2.2, FWIW.
>>
>
> Are you sure? Is there a "Regex" checkbox? Because the regex checkbox is
> only in nightly builds ATM; if you are really running 3.2.2 then you just
> get simple string matching and excluding prefixes is not possible.
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/8855895e/attachment.html>

From jeff at jefftrout.com  Mon Mar  3 19:54:35 2014
From: jeff at jefftrout.com (Jeff)
Date: Mon, 03 Mar 2014 14:54:35 -0500
Subject: [rabbitmq-discuss] Lingering temporary queues in 3.2.3
In-Reply-To: <CAE3HoVQ4F9Wc3OWC89DtSAgw6_DUuhCOMq-1nSjfwdOQhiNLFw@mail.gmail.com>
References: <9D5ECADE-65CE-494C-B14E-E3DC0592EACD@jefftrout.com>
 <CAE3HoVQ4F9Wc3OWC89DtSAgw6_DUuhCOMq-1nSjfwdOQhiNLFw@mail.gmail.com>
Message-ID: <ADE62FEF-DA98-4CBC-809D-C15FEA609E69@jefftrout.com>


On Mar 3, 2014, at 1:06 PM, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 2014-03-03 21:31 GMT+04:00 Jeff <jeff at jefftrout.com>:
> Not sure if this is a bug in the stomp adaptor or elsewhere.  I
> 
> Queues are created by STOMP adapter on the fly and in AMQP 0-9-1 semantics, an empty
> string means "server named". Perhaps STOMP adapter should treat such names as invalid, not sure.
> -- 
> MK
> 


If that is the case (which it looks like), then where did the ?hi mom? message end up? the queue is empty. 

--
Jeff Trout <jeff at jefftrout.com>






From edwardt.tril at gmail.com  Mon Mar  3 20:37:47 2014
From: edwardt.tril at gmail.com (What Name)
Date: Mon, 3 Mar 2014 12:37:47 -0800
Subject: [rabbitmq-discuss] amqp_gen_consumer_spec.hrl missing
	handle_server_cancel in amqp_gen_consumer.erl
Message-ID: <CAKbvJWg3Vhj8SPbVSpyWyC+UOpb2ykeifjtdEDLH5+nqg0q6kg@mail.gmail.com>

the amqp_gen_Consumer added a new method [image: :+1:] %%
handle_server_cancel(Cancel, State) -> ok_error()
%% where
%% Cancel = #'basic.cancel'{}
%% State = state()
%%
%% This callback is invoked by the channel every time a basic.cancel
%% is received from the server.
{handle_server_cancel, 2},

but entry is missing in amqp_gen_consumer_spec.hrl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/ba60f08a/attachment.html>

From sami.taj.omer at gmail.com  Mon Mar  3 21:15:27 2014
From: sami.taj.omer at gmail.com (xenogears)
Date: Mon, 3 Mar 2014 13:15:27 -0800 (PST)
Subject: [rabbitmq-discuss] Retrieving messages asynchronously through
	callbacks
Message-ID: <1393881327662-33829.post@n5.nabble.com>

Hello,

I was wondering if the rabbitmq java client has a way of retrieving messages
asynchronously through callbacks, something like jms':
MessageConsumer.setMessageListener(MessageListener)
http://docs.oracle.com/cd/E17802_01/products/products/jms/javadoc-102a/javax/jms/MessageConsumer.html

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Retrieving-messages-asynchronously-through-callbacks-tp33829.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From patrik.ring at bloglovin.com  Mon Mar  3 21:41:23 2014
From: patrik.ring at bloglovin.com (Patrik Ring)
Date: Mon, 3 Mar 2014 13:41:23 -0800 (PST)
Subject: [rabbitmq-discuss] Federation chokes on load
Message-ID: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>

Hi Rabbitmq-discuss,

We're currently trying to achieve a sync of our rabbit servers between two 
different data centers (one in Europe and one on US East coast). We're 
currently only in need of a one way sync (Europe -> US).

We thought setting up federation seemed like a good tool for this so we set 
it up and it worked like a charm when we were testing it internally with 
only developers. Then when starting to put load on it it just died. Some 
messages come through (but are heavily delayed, as in hours) but they seem 
completely random. We don't have any crazy number of messages being sent, 
it's just about a few 100 messages / second, and they aren't that big 
(<1kb).

We do have quite a few bindings to the exchange we're federating (currently 
trying around 5000 simultaneously).

We have tried with both no-ack and on-confirm but doesn't seem to make a 
difference.

The message aren't routed to the queues on the receiver.

The error log is empty.
The web interface says everything is working
Small number of messages work, and the firewall is not blocking the 
traffic. Shouldn't be a network issue since we're on fairly good 
connections (>gbit) and have good internal networks that work well for 
everything else.

Status:
http://f.cl.ly/items/0p0R3W1m0T2y412X402q/Pasted_Image_2014_33__15_32.png

Config:
http://f.cl.ly/items/182i0C0U2Q453k2L3Z3X/Pasted_Image_2014_33__15_40.png

We might be using the wrong tool, in which case I'd be happy to know more, 
or we're just missing something. In which case I'd be really happy for some 
pointers and some help.

----------
Thanks
/Patrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140303/b43375a9/attachment.html>

From mklishin at gopivotal.com  Tue Mar  4 02:53:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 4 Mar 2014 06:53:00 +0400
Subject: [rabbitmq-discuss] Retrieving messages asynchronously through
	callbacks
In-Reply-To: <1393881327662-33829.post@n5.nabble.com>
References: <1393881327662-33829.post@n5.nabble.com>
Message-ID: <66666394-2C4C-445F-AE6E-3206424C23AC@rabbitmq.com>


On 4 Mar 2014, at 01:15, xenogears <sami.taj.omer at gmail.com> wrote:

> I was wondering if the rabbitmq java client has a way of retrieving messages
> asynchronously through callbacks, something like jms':
> MessageConsumer.setMessageListener(MessageListener)
> http://docs.oracle.com/cd/E17802_01/products/products/jms/javadoc-102a/javax/jms/MessageConsumer.html

See

http://www.rabbitmq.com/getstarted.html
?Retrieving messages by subscription? in http://www.rabbitmq.com/api-guide.html

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Tue Mar  4 08:47:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Mar 2014 08:47:16 +0000
Subject: [rabbitmq-discuss] amqp_gen_consumer_spec.hrl missing
 handle_server_cancel in amqp_gen_consumer.erl
In-Reply-To: <CAKbvJWg3Vhj8SPbVSpyWyC+UOpb2ykeifjtdEDLH5+nqg0q6kg@mail.gmail.com>
References: <CAKbvJWg3Vhj8SPbVSpyWyC+UOpb2ykeifjtdEDLH5+nqg0q6kg@mail.gmail.com>
Message-ID: <53159314.4030905@rabbitmq.com>

On 03/03/2014 20:37, What Name wrote:
> the amqp_gen_Consumer added a new method <snip> but entry is missing in amqp_gen_consumer_spec.hrl

Ah, thanks for the catch. Fixed.

Cheers, Simon

From Shashank.Lothe at techmahindra.com  Tue Mar  4 09:15:07 2014
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Tue, 4 Mar 2014 09:15:07 +0000
Subject: [rabbitmq-discuss] Broker shutdown_error
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C991CC41@BSDMSATMBX001.mahindrasatyam.ad>

Hi Michael,

The logs given were from SASL. I used sample publisher code example provided with the rabbitmq-c package. I published in a loop.

Using system manager, I haven't faced any problem but wanted to check if rabbitmqctl stop_app is having some problem.

Thanks and Regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/58bbe47b/attachment.html>

From simon at rabbitmq.com  Tue Mar  4 13:05:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Mar 2014 13:05:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 released
Message-ID: <5315CF88.7030306@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.2.4

This release fixes a number of bugs in 3.2.3 and earlier versions. See 
the release notes at:

http://www.rabbitmq.com/release-notes/README-3.2.4.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                       The RabbitMQ Team
                       (http://www.rabbitmq.com)



From mikeb at squaremobius.net  Tue Mar  4 14:47:44 2014
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Tue, 4 Mar 2014 14:47:44 +0000
Subject: [rabbitmq-discuss] Garbage collection of queues and exchanges
Message-ID: <CAMZ8XChku3GxndZ68ACS2oYVd5SPe0xdFkzf6eKreFS3FEyhaQ@mail.gmail.com>

In the Node.JS module rabbit.js[1], the main abstractions are various
kinds of socket (which are Node.JS streams[2]) that publish or
(sometimes and) consume to and from exchanges and queues hosted in
RabbitMQ. The sockets, like AMQP connections, are expected to be
fairly long-lived, and more so the server objects to which they refer,
since they may be mentioned by a number of sockets with overlapping
lifetimes.

For example, a socket might connect to "events", which implicitly
creates an exchange called "events", and sends everything written to
the socket, to that exchange. Simple stuff. Here is the snag: when
there are no longer sockets connected to "events", I want the exchange
"events" to go away.

If those sockets are consuming from private queues bound to "events",
I can make those queues exclusive, or mark them as auto-delete, or
give them a TTL. But if a socket is *publishing* to "events", there's
no relationship between the socket and the exchange, so there's
nothing that happens to signal that the exchange is no longer being
used. This applies equally to sending to queues, and in fact in the
case of sending to queues, rules out the use of auto-delete etc for
consumers of those queues.

I would think this is a problem with AMQP in general. I wonder, aloud
in a public forum, if there are any tactics people have come up with
to get around it.

-Michael

[1] https://github.com/squaremo/rabbit.js
[2] http://nodejs.org/api/stream.html

From cwstorm at gmail.com  Tue Mar  4 14:57:17 2014
From: cwstorm at gmail.com (cw storm)
Date: Tue, 4 Mar 2014 09:57:17 -0500
Subject: [rabbitmq-discuss] java.net.SocketException: Connection reset
Message-ID: <CAETr1H8HBmUQ_amgA45-Xb0iFExFfCifsxk4gnh5M2-x5kwg9w@mail.gmail.com>

For some odd reason, we get the error in the callback service
"handleShutdownSignal" from the rabbit server, java.net.SocketException:
Connection reset.  This is a consistent behavior occuring every interval of
25min.  Has anyone seen this before and who's the culprit?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/b579d657/attachment.html>

From pat at munkiisoft.com  Tue Mar  4 14:58:55 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Tue, 4 Mar 2014 14:58:55 +0000 (UTC)
Subject: [rabbitmq-discuss] Bringing down Nodes in a cluster
References: <CALDntb9H9Gd=usbRkDw-hROfu9X7d9aAs9kRjohhh415pErYNQ@mail.gmail.com>
 <8DDBDBD6-384C-489A-B950-43E50072D112@rabbitmq.com>
Message-ID: <loom.20140304T155645-712@post.gmane.org>

Michael Klishin <mklishin at ...> writes:

> 
> On 28 Feb 2014, at 12:27, Patrick Long <pat at ...> wrote:
> 
> > So I can stop the node by using stop_app or I can stop the RabbitMQ 
service on that node. Is one better that the other?
> 
> Stop the service. stop_app does not stop the VM, which may be necessary 
with some upgrades
> (e.g. you also want to upgrade the Erlang VM).
> 
> Use stop_app when resetting nodes, as described in ?Breaking up a cluster? 
[1].
> 
> > When Ops want to update a machine that is a Node in a 3 node RabbitMQ 
cluster what is the recommended approach?
> > 
> > Is it to stop the service on one node, run Windows Update etc etc then 
bring that node back. Once that node is
> confirmed move to next node always ensuring there is at least one 
synchronised slave? 
> 
> See ?Breaking up a cluster? in [1].
> 
> Removing nodes from the cluster and bringing them back one by one is a 
good
> strategy.
> 
> HTH.
> 
> 1. http://www.rabbitmq.com/clustering.html
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 
What is the benefit to breaking up the cluster rather than simply stop_app 
then stop the service, patching and rebooting? 

Is it to stop the cluster trying to find the downed node?

Thanks

pat




From simon at rabbitmq.com  Tue Mar  4 17:56:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Mar 2014 17:56:38 +0000
Subject: [rabbitmq-discuss] Federation chokes on load
In-Reply-To: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
References: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
Message-ID: <531613D6.5030401@rabbitmq.com>

Hi Patrik.

On 03/03/14 21:41, Patrik Ring wrote:
> Some messages come through (but are heavily delayed, as in hours) but
> they seem completely random.

That's definitely not right!

First of all, could you send the output of "rabbitmqctl report" for each 
broker?

Also, which version of RabbitMQ are you using?

Secondly, you might want to investigate whether the underlying 
infrastructure used by federation is wired up correctly. There should be 
a queue for each (exchange, downstream) pairing declared in the upstream 
broker (called "federation: [exchange] -> [node]"). It should be bound 
(once) to an internal exchange with a similar name. That internal 
exchange should be bound to the upstream exchange with all the bindings 
that are in use downstream.

Does it look like that is happening? Is the infrastructure queue seeing 
the message rates you would expect?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From cwstorm at gmail.com  Tue Mar  4 18:22:19 2014
From: cwstorm at gmail.com (cw storm)
Date: Tue, 4 Mar 2014 13:22:19 -0500
Subject: [rabbitmq-discuss] java.net.SocketException: Connection reset
In-Reply-To: <CAETr1H8HBmUQ_amgA45-Xb0iFExFfCifsxk4gnh5M2-x5kwg9w@mail.gmail.com>
References: <CAETr1H8HBmUQ_amgA45-Xb0iFExFfCifsxk4gnh5M2-x5kwg9w@mail.gmail.com>
Message-ID: <CAETr1H_v_Co79TWL-TCLi5=hc8SjFYCGr+=CRq0N8p2R0G+OaQ@mail.gmail.com>

Not sure why this would have an impact but we've set the heartbeat rate
from 10secs to 25secs.  In doing this, the connections/channels for the
other server are not being reset by rabbit now.  The conn/channels have
been up for more than an hour whereas before, it was being reset almost at
25min.  Very odd.


On Tue, Mar 4, 2014 at 9:57 AM, cw storm <cwstorm at gmail.com> wrote:

> For some odd reason, we get the error in the callback service
> "handleShutdownSignal" from the rabbit server, java.net.SocketException:
> Connection reset.  This is a consistent behavior occuring every interval of
> 25min.  Has anyone seen this before and who's the culprit?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/84a21f30/attachment.html>

From mklishin at gopivotal.com  Tue Mar  4 19:07:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 4 Mar 2014 23:07:12 +0400
Subject: [rabbitmq-discuss] java.net.SocketException: Connection reset
In-Reply-To: <CAETr1H_v_Co79TWL-TCLi5=hc8SjFYCGr+=CRq0N8p2R0G+OaQ@mail.gmail.com>
References: <CAETr1H8HBmUQ_amgA45-Xb0iFExFfCifsxk4gnh5M2-x5kwg9w@mail.gmail.com>
 <CAETr1H_v_Co79TWL-TCLi5=hc8SjFYCGr+=CRq0N8p2R0G+OaQ@mail.gmail.com>
Message-ID: <FA270897-C5AE-4922-8FFA-31B1019E7D91@rabbitmq.com>


On 4 Mar 2014, at 22:22, cw storm <cwstorm at gmail.com> wrote:

> Not sure why this would have an impact but we've set the heartbeat rate from 10secs to 25secs.  In doing this, the connections/channels for the other server are not being reset by rabbit now.  The conn/channels have been up for more than an hour whereas before, it was being reset almost at 25min.  Very odd.

Very likely a firewall somewhere gets in the way.

MK

Software Engineer, Pivotal/RabbitMQ



From mcintoshj at gmail.com  Tue Mar  4 19:21:33 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 4 Mar 2014 13:21:33 -0600
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <531474FC.5060309@rabbitmq.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
Message-ID: <CAD6m6fFkgd6u4CB7WpyPn0yRnpa-TyJvdZ_DXsp8gULOsAmSfg@mail.gmail.com>

The big thing for us was it was a push vs. pull mechanism.  In a
distributed system, where we have a lot of nodes talking to an enterprise,
it's much more efficient to have the nodes shovel to the enterprise than to
have to have the enterprise have to know about every server connected to
it.

Jason


On Mon, Mar 3, 2014 at 6:26 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 28/02/2014 6:14PM, Ben Hood wrote:
>
>> Using federation to implement an AMQP gateway seems like a common
>> pattern. One wonders why it didn't go into the AMQP spec ....
>>
>
> I dunno, I think federation is really quite specific (I don't think there
> are any other brokers which do it in the same way as RabbitMQ) - I can see
> the spec authors not wanting to predict how people will want to federate.
>
>
>  Initially I had thought that the 'new' federation replaced the 'old'
>>> shovel,
>>> but this is not true - each tool has its place although their
>>> capabilities
>>> overlap.
>>>
>>> With easier configuration in 3.3, the lowly shovel may get its due!
>>>
>>
>> It's interesting to see that the shovel still lives on, despite it
>> being quite an agricultural component.
>>
>
> I think the concept ("I just want to move the damn messages!") makes a lot
> of sense.
>
> If I were creating RabbitMQ from scratch, I might rename the shovel to
> something like "point-to-point federation" to make it a bit clearer that it
> complements federation rather than being replaced by it.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/f0423323/attachment.html>

From michael.laing at nytimes.com  Tue Mar  4 19:38:24 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 4 Mar 2014 14:38:24 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAD6m6fFkgd6u4CB7WpyPn0yRnpa-TyJvdZ_DXsp8gULOsAmSfg@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
 <CAD6m6fFkgd6u4CB7WpyPn0yRnpa-TyJvdZ_DXsp8gULOsAmSfg@mail.gmail.com>
Message-ID: <CAKgmDnHBDT+qOG-iVYFSBo_13MMvCmei_T-eo0B3hkNESBmQAw@mail.gmail.com>

Actually shovels can be configured to push or pull - we use them both ways.

Our proxies are passive (no shovels) with well-known addresses - we use
shovels to push and pull to them from both sides.

Our retail layer autoscales but the wholesale layer has known addresses -
we run shovels in the retail instances, some pushing and some pulling.

Soon we will be using serf gossiping for topology/address/role discovery in
nyt?a?rik, and the need for known addresses will diminish greatly.

ml


On Tue, Mar 4, 2014 at 2:21 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> The big thing for us was it was a push vs. pull mechanism.  In a
> distributed system, where we have a lot of nodes talking to an enterprise,
> it's much more efficient to have the nodes shovel to the enterprise than to
> have to have the enterprise have to know about every server connected to
> it.
>
> Jason
>
>
> On Mon, Mar 3, 2014 at 6:26 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 28/02/2014 6:14PM, Ben Hood wrote:
>>
>>> Using federation to implement an AMQP gateway seems like a common
>>> pattern. One wonders why it didn't go into the AMQP spec ....
>>>
>>
>> I dunno, I think federation is really quite specific (I don't think there
>> are any other brokers which do it in the same way as RabbitMQ) - I can see
>> the spec authors not wanting to predict how people will want to federate.
>>
>>
>>  Initially I had thought that the 'new' federation replaced the 'old'
>>>> shovel,
>>>> but this is not true - each tool has its place although their
>>>> capabilities
>>>> overlap.
>>>>
>>>> With easier configuration in 3.3, the lowly shovel may get its due!
>>>>
>>>
>>> It's interesting to see that the shovel still lives on, despite it
>>> being quite an agricultural component.
>>>
>>
>> I think the concept ("I just want to move the damn messages!") makes a
>> lot of sense.
>>
>> If I were creating RabbitMQ from scratch, I might rename the shovel to
>> something like "point-to-point federation" to make it a bit clearer that it
>> complements federation rather than being replaced by it.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/ca667bc9/attachment.html>

From mcintoshj at gmail.com  Tue Mar  4 19:42:10 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 4 Mar 2014 13:42:10 -0600
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAKgmDnHBDT+qOG-iVYFSBo_13MMvCmei_T-eo0B3hkNESBmQAw@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
 <CAD6m6fFkgd6u4CB7WpyPn0yRnpa-TyJvdZ_DXsp8gULOsAmSfg@mail.gmail.com>
 <CAKgmDnHBDT+qOG-iVYFSBo_13MMvCmei_T-eo0B3hkNESBmQAw@mail.gmail.com>
Message-ID: <CAD6m6fE12VuwS7kJywr1m+Gv1Ao5aztR6tr9LkAgmGXV7B2Jkw@mail.gmail.com>

Well, true shovels can push or pull.  One thing though is I don't think
federation can do a push - or did I miss that?

Jason


On Tue, Mar 4, 2014 at 1:38 PM, Laing, Michael <michael.laing at nytimes.com>wrote:

> Actually shovels can be configured to push or pull - we use them both ways.
>
> Our proxies are passive (no shovels) with well-known addresses - we use
> shovels to push and pull to them from both sides.
>
> Our retail layer autoscales but the wholesale layer has known addresses -
> we run shovels in the retail instances, some pushing and some pulling.
>
> Soon we will be using serf gossiping for topology/address/role discovery
> in nyt?a?rik, and the need for known addresses will diminish greatly.
>
> ml
>
>
> On Tue, Mar 4, 2014 at 2:21 PM, Jason McIntosh <mcintoshj at gmail.com>wrote:
>
>> The big thing for us was it was a push vs. pull mechanism.  In a
>> distributed system, where we have a lot of nodes talking to an enterprise,
>> it's much more efficient to have the nodes shovel to the enterprise than to
>> have to have the enterprise have to know about every server connected to
>> it.
>>
>> Jason
>>
>>
>> On Mon, Mar 3, 2014 at 6:26 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>>
>>> On 28/02/2014 6:14PM, Ben Hood wrote:
>>>
>>>> Using federation to implement an AMQP gateway seems like a common
>>>> pattern. One wonders why it didn't go into the AMQP spec ....
>>>>
>>>
>>> I dunno, I think federation is really quite specific (I don't think
>>> there are any other brokers which do it in the same way as RabbitMQ) - I
>>> can see the spec authors not wanting to predict how people will want to
>>> federate.
>>>
>>>
>>>  Initially I had thought that the 'new' federation replaced the 'old'
>>>>> shovel,
>>>>> but this is not true - each tool has its place although their
>>>>> capabilities
>>>>> overlap.
>>>>>
>>>>> With easier configuration in 3.3, the lowly shovel may get its due!
>>>>>
>>>>
>>>> It's interesting to see that the shovel still lives on, despite it
>>>> being quite an agricultural component.
>>>>
>>>
>>> I think the concept ("I just want to move the damn messages!") makes a
>>> lot of sense.
>>>
>>> If I were creating RabbitMQ from scratch, I might rename the shovel to
>>> something like "point-to-point federation" to make it a bit clearer that it
>>> complements federation rather than being replaced by it.
>>>
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, Pivotal
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Jason McIntosh
>> https://github.com/jasonmcintosh/
>> 573-424-7612
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/5d1cdc63/attachment.html>

From mikeb at squaremobius.net  Tue Mar  4 20:30:43 2014
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Tue, 4 Mar 2014 20:30:43 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <531474FC.5060309@rabbitmq.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
Message-ID: <CAMZ8XCgXMLbd=QMMDQcu1xbAPHuv1Zkxc1_t2PxKw-__z6iPTw@mail.gmail.com>

On 3 March 2014 12:26, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 28/02/2014 6:14PM, Ben Hood wrote:
>>
>> Using federation to implement an AMQP gateway seems like a common
>> pattern. One wonders why it didn't go into the AMQP spec ....
>
>
> I dunno, I think federation is really quite specific (I don't think there
> are any other brokers which do it in the same way as RabbitMQ) [...]

It is a lot like OpenAMQ's subscriber federation:
http://www.openamq.org/doc:user-3-advanced#toc68

From michael.laing at nytimes.com  Tue Mar  4 20:47:33 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 4 Mar 2014 15:47:33 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAD6m6fE12VuwS7kJywr1m+Gv1Ao5aztR6tr9LkAgmGXV7B2Jkw@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
 <CAD6m6fFkgd6u4CB7WpyPn0yRnpa-TyJvdZ_DXsp8gULOsAmSfg@mail.gmail.com>
 <CAKgmDnHBDT+qOG-iVYFSBo_13MMvCmei_T-eo0B3hkNESBmQAw@mail.gmail.com>
 <CAD6m6fE12VuwS7kJywr1m+Gv1Ao5aztR6tr9LkAgmGXV7B2Jkw@mail.gmail.com>
Message-ID: <CAKgmDnF_G4Znqs=DO68EwOTE7Z2opx6TQMTktS=dhnonDihc2g@mail.gmail.com>

I'm a little out of date on federation, but yes, since you configure by
providing 'upstreams' I think it is basically a pull, although there seem
to be agents on both ends, unlike the simple shovel.


On Tue, Mar 4, 2014 at 2:42 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Well, true shovels can push or pull.  One thing though is I don't think
> federation can do a push - or did I miss that?
>
> Jason
>
>
> On Tue, Mar 4, 2014 at 1:38 PM, Laing, Michael <michael.laing at nytimes.com>wrote:
>
>> Actually shovels can be configured to push or pull - we use them both
>> ways.
>>
>> Our proxies are passive (no shovels) with well-known addresses - we use
>> shovels to push and pull to them from both sides.
>>
>> Our retail layer autoscales but the wholesale layer has known addresses -
>> we run shovels in the retail instances, some pushing and some pulling.
>>
>> Soon we will be using serf gossiping for topology/address/role discovery
>> in nyt?a?rik, and the need for known addresses will diminish greatly.
>>
>> ml
>>
>>
>> On Tue, Mar 4, 2014 at 2:21 PM, Jason McIntosh <mcintoshj at gmail.com>wrote:
>>
>>> The big thing for us was it was a push vs. pull mechanism.  In a
>>> distributed system, where we have a lot of nodes talking to an enterprise,
>>> it's much more efficient to have the nodes shovel to the enterprise than to
>>> have to have the enterprise have to know about every server connected to
>>> it.
>>>
>>> Jason
>>>
>>>
>>> On Mon, Mar 3, 2014 at 6:26 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>>>
>>>> On 28/02/2014 6:14PM, Ben Hood wrote:
>>>>
>>>>> Using federation to implement an AMQP gateway seems like a common
>>>>> pattern. One wonders why it didn't go into the AMQP spec ....
>>>>>
>>>>
>>>> I dunno, I think federation is really quite specific (I don't think
>>>> there are any other brokers which do it in the same way as RabbitMQ) - I
>>>> can see the spec authors not wanting to predict how people will want to
>>>> federate.
>>>>
>>>>
>>>>  Initially I had thought that the 'new' federation replaced the 'old'
>>>>>> shovel,
>>>>>> but this is not true - each tool has its place although their
>>>>>> capabilities
>>>>>> overlap.
>>>>>>
>>>>>> With easier configuration in 3.3, the lowly shovel may get its due!
>>>>>>
>>>>>
>>>>> It's interesting to see that the shovel still lives on, despite it
>>>>> being quite an agricultural component.
>>>>>
>>>>
>>>> I think the concept ("I just want to move the damn messages!") makes a
>>>> lot of sense.
>>>>
>>>> If I were creating RabbitMQ from scratch, I might rename the shovel to
>>>> something like "point-to-point federation" to make it a bit clearer that it
>>>> complements federation rather than being replaced by it.
>>>>
>>>>
>>>> Cheers, Simon
>>>>
>>>> --
>>>> Simon MacMullen
>>>> RabbitMQ, Pivotal
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>>
>>> --
>>> Jason McIntosh
>>> https://github.com/jasonmcintosh/
>>> 573-424-7612
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/dec8fd77/attachment.html>

From patrik.ring at bloglovin.com  Tue Mar  4 22:06:35 2014
From: patrik.ring at bloglovin.com (Patrik Ring)
Date: Tue, 4 Mar 2014 17:06:35 -0500
Subject: [rabbitmq-discuss] Federation chokes on load
In-Reply-To: <531613D6.5030401@rabbitmq.com>
References: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
 <531613D6.5030401@rabbitmq.com>
Message-ID: <CAP0RBZUmGLeB_jAgn=c_72+4HU6WioaBA8QfiOkpVrD=YvSsnw@mail.gmail.com>

Rabbit version in use is: RabbitMQ 3.2.1, Erlang R14B04

rabbitmqctl report on
upstream: http://pastebin.com/PNqTziGk
"slave" server: http://pastebin.com/4L6JFsiW

*I have this in the exchanges list on the upstream:*

 federation: users -> rabbit at rabbit3.c.rabbit-magic.internal
B<http://rabbit1:15672/#/exchanges/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal%20B>
x-federation-upstream ha-all D AD I Args


And this i the queues list:

 federation: users ->
rabbit at rabbit3.c.rabbit-magic.internal<http://rabbit1:15672/#/queues/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal>
rabbit at util1 +1  Exp D Args
*For the slave:*

*Nothing.* Except on channels, where I find this:

 <rabbit at rabbit3.3.237.0>
(1)<http://162.222.179.163:15672/#/channels/%3Crabbit%40rabbit3.3.237.0%3E%20(1)>federation


Feel like we might be on to something?

How do I set this up?



As a side note: The queues and exchanges on the upstream might still be
there since when we tried making it run both ways, not sure about this. We
do however have the federation status on the SLAVE, and according to that
it's up and running.


Best regards
Patrik Ring

Co-founder and CTO of Bloglovin.com
patrik.ring at bloglovin.com
+46 730 59 78 14
+1 347 859 7999


On Tue, Mar 4, 2014 at 12:56 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Patrik.
>
> On 03/03/14 21:41, Patrik Ring wrote:
>
>> Some messages come through (but are heavily delayed, as in hours) but
>> they seem completely random.
>>
>
> That's definitely not right!
>
> First of all, could you send the output of "rabbitmqctl report" for each
> broker?
>
> Also, which version of RabbitMQ are you using?
>
> Secondly, you might want to investigate whether the underlying
> infrastructure used by federation is wired up correctly. There should be a
> queue for each (exchange, downstream) pairing declared in the upstream
> broker (called "federation: [exchange] -> [node]"). It should be bound
> (once) to an internal exchange with a similar name. That internal exchange
> should be bound to the upstream exchange with all the bindings that are in
> use downstream.
>
> Does it look like that is happening? Is the infrastructure queue seeing
> the message rates you would expect?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/53213e5a/attachment.html>

From jonathan.s.oliver42 at gmail.com  Wed Mar  5 02:43:57 2014
From: jonathan.s.oliver42 at gmail.com (Jonathan Oliver)
Date: Tue, 4 Mar 2014 18:43:57 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ .NET Client Can Hang with SSL
	Connections
In-Reply-To: <7419510d-2658-46b0-9015-952ae8dafa2f@googlegroups.com>
References: <7419510d-2658-46b0-9015-952ae8dafa2f@googlegroups.com>
Message-ID: <dea2bee4-65a5-4160-9dfe-fbf12d0aaa62@googlegroups.com>

Awesome guys! Thanks for the fix:
http://www.rabbitmq.com/release-notes/README-3.2.4.txt
http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/49cfdfd34e15


On Sunday, February 16, 2014 11:33:13 AM UTC-7, Jonathan Oliver wrote:
>
> During periods of degraded WAN performance and availability, e.g. lost 
> packets, increased latency, etc. the .NET RabbitMQ connection is destroyed 
> according to the requested heartbeat and works as intended.  Our client is 
> observes this and then attempts to reconnect periodically until a 
> connection is re-established with the broker.  We've noticed however, that 
> sometimes these reconnection attempts hang *indefinitely/forever* despite 
> a configured RequestedConnectionTimeout value of 30 seconds.
>
> After months of seeing this problem every few weeks because of various 
> network hiccups, we were finally able to capture a snapshot and then 
> perform an inspection of the memory dump using WinDbg.  Here's the stack 
> trace (which uses the production RabbitMQ .NET client v3.2.1):
>
> 000000001adde530 000007fef77ad01a 
> System.Net.Sockets.Socket.Receive(Byte[], Int32, Int32, 
> System.Net.Sockets.SocketFlags, System.Net.Sockets.SocketError ByRef)
> 000000001adde5d0 000007fef77ace88 
> System.Net.Sockets.NetworkStream.Read(Byte[], Int32, Int32)
> 000000001adde650 000007fef777294c 
> System.Net.FixedSizeReader.ReadPacket(Byte[], Int32, Int32)
> 000000001adde6a0 000007fef77d3803 
> System.Net.Security.SslState.StartReceiveBlob(Byte[], 
> System.Net.AsyncProtocolRequest)
> 000000001adde6e0 000007fef77d1f09 
> System.Net.Security.SslState.StartSendBlob(Byte[], Int32, 
> System.Net.AsyncProtocolRequest)
> 000000001adde760 000007fef77d3d26 
> System.Net.Security.SslState.ProcessReceivedBlob(Byte[], Int32, 
> System.Net.AsyncProtocolRequest)
> 000000001adde7d0 000007fef77d3816 
> System.Net.Security.SslState.StartReceiveBlob(Byte[], 
> System.Net.AsyncProtocolRequest)
> 000000001adde810 000007fef77d1f09 
> System.Net.Security.SslState.StartSendBlob(Byte[], Int32, 
> System.Net.AsyncProtocolRequest)
> 000000001adde890 000007fef77d1b85 
> System.Net.Security.SslState.ForceAuthentication(Boolean, Byte[], 
> System.Net.AsyncProtocolRequest)
> 000000001adde900 000007fef77d1856 
> System.Net.Security.SslState.ProcessAuthentication(System.Net.LazyAsyncResult)
>
> *RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(RabbitMQ.Client.AmqpTcpEndpoint, 
> ObtainSocket, Int32)*
> 000000001addea00 000007fe9a28c5e1 
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(RabbitMQ.Client.AmqpTcpEndpoint, 
> ObtainSocket, Int32)
> 000000001addea50 000007fe9a28c245 
> RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32, 
> System.Collections.Generic.IDictionary`2<RabbitMQ.Client.AmqpTcpEndpoint,Int32>, 
> System.Collections.Generic.IDictionary`2<RabbitMQ.Client.AmqpTcpEndpoint,System.Exception>, 
> RabbitMQ.Client.AmqpTcpEndpoint[] ByRef, RabbitMQ.Client.AmqpTcpEndpoint)
> 000000001addeb50 000007fe9a28c05f 
> RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32, 
> System.Collections.Generic.IDictionary`2<RabbitMQ.Client.AmqpTcpEndpoint,Int32>, 
> System.Collections.Generic.IDictionary`2<RabbitMQ.Client.AmqpTcpEndpoint,System.Exception>, 
> RabbitMQ.Client.AmqpTcpEndpoint[])
> 000000001addebe0 000007fe9a28bf51 
> RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32)
> 000000001addec70 000007fe9a28bd6f *** ERROR: Module load completed but 
> symbols could not be loaded for Accounting.UsageHost.dll
>
> If you follow the stack trace through the .NET client source code, you'll 
> notice that a few of the methods are missing.  These have been optimized 
> away by the compiler when using a "Release" build.
>
> I have highlighted exactly where the problem is above and if you follow 
> the source code, you'll find the problem right here:
> *http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/e399c21792d7/projects/client/RabbitMQ.Client/src/client/api/SslHelper.cs#l97 
> <http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/e399c21792d7/projects/client/RabbitMQ.Client/src/client/api/SslHelper.cs#l97>*
>
> The problem is that there is *no timeout* value configured for SSL 
> connections.  This means that the SSL connection attempt will hang 
> indefinitely.  And since the connection doesn't exist yet, there's no way 
> for any kind of heartbeat thread to tear things down.
>
> The .NET docs also state that the default read/write timeout is set to 
> Infinite by default<http://msdn.microsoft.com/en-us/library/system.net.security.sslstream.readtimeout(v=vs.110).aspx>
> .
>
> The simple fix is as follows:
> sslStream.ReadTimeout = connectionTimeout;
> sslStream.WriteTimeout=connectionTimout;
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140304/e199715e/attachment.html>

From 0x6e6562 at gmail.com  Wed Mar  5 06:32:57 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 5 Mar 2014 06:32:57 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
 <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
 <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>
Message-ID: <CAB-G1jgHu0aqqqkJLgzx-WPEw5j65H+T2+JAuu5UOnBQbg_sXA@mail.gmail.com>

On Sun, Mar 2, 2014 at 3:21 AM, Laing, Michael
<michael.laing at nytimes.com> wrote:
> Persistence might increase reliability when you plan to restart nodes and
> need to regain state. We don't do that.

Are you referring to Rabbit nodes heres? Reading further into your
description, it looks like the application state is maintained by
Cassandra replication.

> We target queue lengths of zero and are close most of the time. Anything
> else stands out like a black spot on a white sheet.

How do you achieve this steady state? Have you calibrated your app in
some fashion? Or do you apply flow control?

> So we never restart nodes that die. Just sync in new ones. Actually we have
> not yet had any core nodes die in production.

Again - you're talking about Rabbit nodes right?

> Our instances are ridiculously small and inexpensive to run. We rely on this
> global, headless, mutually supporting rabbit army for our reliability,
> paired with a small Cassandra horde.

Seems like a simple yet effective approach given the scale you're targeting.

From 0x6e6562 at gmail.com  Wed Mar  5 06:40:19 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 5 Mar 2014 06:40:19 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <531474FC.5060309@rabbitmq.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <531474FC.5060309@rabbitmq.com>
Message-ID: <CAB-G1jhqPG5-MpU63r4uiD+4sGGHjQP-ZhD_WEbKGxHEpoNQmA@mail.gmail.com>

On Mon, Mar 3, 2014 at 12:26 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> I dunno, I think federation is really quite specific (I don't think there
> are any other brokers which do it in the same way as RabbitMQ) - I can see
> the spec authors not wanting to predict how people will want to federate.

Fair point.

> I think the concept ("I just want to move the damn messages!") makes a lot
> of sense.
>
> If I were creating RabbitMQ from scratch, I might rename the shovel to
> something like "point-to-point federation" to make it a bit clearer that it
> complements federation rather than being replaced by it.

IIRC the grown up name for the shovel was going to be AMQP relay, but
for some reason that naming never happened.

From iamarun.shankar at gmail.com  Wed Mar  5 05:25:35 2014
From: iamarun.shankar at gmail.com (Arun Shankar)
Date: Wed, 5 Mar 2014 10:55:35 +0530
Subject: [rabbitmq-discuss] Message priority in RabbitMQ
Message-ID: <CALv3avAakhay5fsb66P4h1PPKOcSTjCJOqTqogLDROq9eZzG+Q@mail.gmail.com>

Hi All,



Does RabbitMQ supports message priority? I have a requirement where
messages with high priority are to be executed first before the messages
with low priority sitting in front of the queue.



If message priority is not available, can someone please suggest me a
better solution using RabbitMQ to achieve this?



Thanks in Advance,

Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/0fc66b49/attachment.html>

From mklishin at gopivotal.com  Wed Mar  5 07:39:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 5 Mar 2014 11:39:12 +0400
Subject: [rabbitmq-discuss] Message priority in RabbitMQ
In-Reply-To: <CALv3avAakhay5fsb66P4h1PPKOcSTjCJOqTqogLDROq9eZzG+Q@mail.gmail.com>
References: <CALv3avAakhay5fsb66P4h1PPKOcSTjCJOqTqogLDROq9eZzG+Q@mail.gmail.com>
Message-ID: <12902FA7-C809-4016-9AA0-0F3F4F666EA7@rabbitmq.com>


On 5 Mar 2014, at 09:25, Arun Shankar <iamarun.shankar at gmail.com> wrote:

> Does RabbitMQ supports message priority? I have a requirement where messages with high priority are to be executed first before the messages with low priority sitting in front of the queue.

No.

> If message priority is not available, can someone please suggest me a better solution using RabbitMQ to achieve this?

You can use two queues (?low? and ?high? priorities), consume from both of them and store them in a local
(in memory) collection that provides the ordering semantics you need, then process them off the collection.

If your requirement were ?low priority messages should not block high priority messages from being processed?, simply
using 2 queues and 2 (sets of) consumers may be sufficient in practice.

HTH.

MK

Software Engineer, Pivotal/RabbitMQ



From wangjunbo924 at gmail.com  Wed Mar  5 10:32:57 2014
From: wangjunbo924 at gmail.com (Junius Wang)
Date: Wed, 5 Mar 2014 18:32:57 +0800
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 fails to start if management
	plugin enabled
Message-ID: <001201cf385e$49e74bd0$ddb5e370$@gmail.com>

Hi,

I tried the latest release 3.2.4.  The initial start succeeded after
installed. However, as long as I enabled the management plugin(by
"rabbitmq_plugins enable rabbitmq_management") ,RabbitMQ cannot start
anymore.  I'm CentOS 6.4 with erlong R14B04(erts-5.8.5).   What's the
matter?

 

Before the plugin enabled, RabbitMQ is runing:

[root at rabbit4 rabbitmq]# sudo rabbitmqctl status

Status of node rabbit at rabbit4 ...

[{pid,28255},

{running_applications,[{rabbit,"RabbitMQ","3.2.4"},

                        {os_mon,"CPO  CXC 138 46","2.2.7"},

                        {xmerl,"XML parser","1.2.10"},

                        {mnesia,"MNESIA  CXC 138 12","4.5"},

                        {sasl,"SASL  CXC 138 11","2.1.10"},

                        {stdlib,"ERTS  CXC 138 10","1.17.5"},

                        {kernel,"ERTS  CXC 138 10","2.14.5"}]},

{os,{unix,linux}},

{erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
[async-threads:30] [kernel-poll:true]\n"},

{memory,[{total,27470168},

          {connection_procs,2648},

          {queue_procs,5296},

          {plugins,0},

          {other_proc,9321128},

          {mnesia,58928},

          {mgmt_db,0},

          {msg_index,21112},

          {other_ets,775152},

          {binary,6256},

          {code,14561678},

          {atom,1360113},

          {other_system,1357857}]},

{vm_memory_high_watermark,0.4},

{vm_memory_limit,247676928},

{disk_free_limit,50000000},

{disk_free,5879087104},

{file_descriptors,[{total_limit,924},

                    {total_used,3},

                    {sockets_limit,829},

                    {sockets_used,1}]},

{processes,[{limit,1048576},{used,124}]},

{run_queue,0},

{uptime,16}]

...done.

 

 

After it's enabled. RabbitMQ fails to start:

[root at rabbit4 rabbitmq]# cat /var/log/rabbitmq/startup_log

 

              RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.

  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/

  ##  ##

  ##########  Logs: /var/log/rabbitmq/rabbit at rabbit4.log

  ######  ##        /var/log/rabbitmq/rabbit at rabbit4-sasl.log

  ##########

              Starting broker...

 

BOOT FAILED

===========

 

Error description:

   {could_not_start,rabbitmq_management,

       {{shutdown,

            {failed_to_start_child,rabbit_mgmt_sup,

                {'EXIT',

                    {{shutdown,

                         [{{badmatch,[]},

                           [{mirrored_supervisor,child,2},

                            {mirrored_supervisor,with_exit_handler,2},

                            {mirrored_supervisor,check_start,4},

                            {mnesia_tm,apply_fun,3},

                            {mnesia_tm,execute_transaction,5},

                            {rabbit_misc,

                                '-execute_mnesia_transaction/1-fun-0-',1},

                            {worker_pool_worker,handle_call,3},

                            {gen_server2,handle_msg,2}]}]},

                     {gen_server2,call,

                         [<0.353.0>,{init,<0.351.0>},infinity]}}}}},

        {rabbit_mgmt_app,start,[normal,[]]}}}

 

Log files (may contain more information):

   /var/log/rabbitmq/rabbit at rabbit4.log

   /var/log/rabbitmq/rabbit at rabbit4-sasl.log

 

{"init terminating in
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbitmq_management,{{
shutdown,{failed_to_start_child,rabbit_mgmt_sup,{'EXIT',{{shutdown,[{{badmat
ch,[]},[{mirrored_supervisor,child,2},{mirrored_supervisor,with_exit_handler
,2},{mirrored_supervisor,check_start,4},{mnesia_tm,apply_fun,3},{mnesia_tm,e
xecute_transaction,5},{rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1}
,{worker_pool_worker,handle_call,3},{gen_server2,handle_msg,2}]}]},{gen_serv
er2,call,[<0.353.0>,{init,<0.351.0>},infinity]}}}}},{rabbit_mgmt_app,start,[
normal,[]]}}}}}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/4541ee1a/attachment.html>

From simon at rabbitmq.com  Wed Mar  5 12:05:25 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Mar 2014 12:05:25 +0000
Subject: [rabbitmq-discuss] Federation chokes on load
In-Reply-To: <CAP0RBZUmGLeB_jAgn=c_72+4HU6WioaBA8QfiOkpVrD=YvSsnw@mail.gmail.com>
References: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
 <531613D6.5030401@rabbitmq.com>
 <CAP0RBZUmGLeB_jAgn=c_72+4HU6WioaBA8QfiOkpVrD=YvSsnw@mail.gmail.com>
Message-ID: <53171305.4030606@rabbitmq.com>

Hi Patrik, thanks.

So this looks like federation is configured correctly and should be 
working normally. The downstream exchange only has a single binding to a 
single queue, with routing key "user.2". Are messages being published 
upstream with that key?

Cheers, Simon

On 04/03/14 22:06, Patrik Ring wrote:
> Rabbit version in use is: RabbitMQ 3.2.1, Erlang R14B04
>
> rabbitmqctl report on
> upstream: http://pastebin.com/PNqTziGk
> "slave" server: http://pastebin.com/4L6JFsiW
>
> *I have this in the exchanges list on the upstream:*
>
> federation: users -> rabbit at rabbit3.c.rabbit-magic.internal B
> <http://rabbit1:15672/#/exchanges/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal%20B>
> 	x-federation-upstream	ha-all	D AD I Args
>
>
> And this i the queues list:
>
> federation: users -> rabbit at rabbit3.c.rabbit-magic.internal
> <http://rabbit1:15672/#/queues/%2F/federation%3A%20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal>
> 	rabbit at util1 +1 		Exp D Args
>
>
> *For the slave:*
> *
> *
> *Nothing.* Except on channels, where I find this:
>
> <rabbit at rabbit3.3.237.0> (1)
> <http://162.222.179.163:15672/#/channels/%3Crabbit%40rabbit3.3.237.0%3E%20(1)>
> federation
>
>
> Feel like we might be on to something?
>
> How do I set this up?
>
>
>
> As a side note: The queues and exchanges on the upstream might still be
> there since when we tried making it run both ways, not sure about this.
> We do however have the federation status on the SLAVE, and according to
> that it's up and running.
>
>
> Best regards
> Patrik Ring
>
> Co-founder and CTO of Bloglovin.com
> patrik.ring at bloglovin.com <mailto:patrik.ring at bloglovin.com>
> +46 730 59 78 14
> +1 347 859 7999
>
>
> On Tue, Mar 4, 2014 at 12:56 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi Patrik.
>
>     On 03/03/14 21:41, Patrik Ring wrote:
>
>         Some messages come through (but are heavily delayed, as in
>         hours) but
>         they seem completely random.
>
>
>     That's definitely not right!
>
>     First of all, could you send the output of "rabbitmqctl report" for
>     each broker?
>
>     Also, which version of RabbitMQ are you using?
>
>     Secondly, you might want to investigate whether the underlying
>     infrastructure used by federation is wired up correctly. There
>     should be a queue for each (exchange, downstream) pairing declared
>     in the upstream broker (called "federation: [exchange] -> [node]").
>     It should be bound (once) to an internal exchange with a similar
>     name. That internal exchange should be bound to the upstream
>     exchange with all the bindings that are in use downstream.
>
>     Does it look like that is happening? Is the infrastructure queue
>     seeing the message rates you would expect?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mikeb at squaremobius.net  Wed Mar  5 12:31:01 2014
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Wed, 5 Mar 2014 12:31:01 +0000
Subject: [rabbitmq-discuss] RABBITMQ_BASE
Message-ID: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>

This documentation http://www.rabbitmq.com/relocate.html implies that
running, e.g.,
$ RABBITMQ_BASE=`pwd` rabbitmq-server &
will instruct RabbitMQ to put its database and log files in the
current directory. But when I do this, RabbitMQ just puts its log
files where it normally does.

It's a (recent) homebrew install, so perhaps the formula is doing
something tricksy.

-Michael

From michael.laing at nytimes.com  Wed Mar  5 12:51:40 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 5 Mar 2014 07:51:40 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAB-G1jgHu0aqqqkJLgzx-WPEw5j65H+T2+JAuu5UOnBQbg_sXA@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
 <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
 <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>
 <CAB-G1jgHu0aqqqkJLgzx-WPEw5j65H+T2+JAuu5UOnBQbg_sXA@mail.gmail.com>
Message-ID: <CAKgmDnENnUTVE+zB5sN7O2N2sOPzV9L+bz-11k01zV8euzvx9A@mail.gmail.com>

On Wed, Mar 5, 2014 at 1:32 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> On Sun, Mar 2, 2014 at 3:21 AM, Laing, Michael
> <michael.laing at nytimes.com> wrote:
> > Persistence might increase reliability when you plan to restart nodes and
> > need to regain state. We don't do that.
>
> Are you referring to Rabbit nodes heres? Reading further into your
> description, it looks like the application state is maintained by
> Cassandra replication.
>

Yes. Rabbit nodes.


>
> > We target queue lengths of zero and are close most of the time. Anything
> > else stands out like a black spot on a white sheet.
>
> How do you achieve this steady state? Have you calibrated your app in
> some fashion? Or do you apply flow control?
>

Some of our fabrik apps apply flow control. For example, we apply flow
control to the ingress of 'silver' service messages so that 'gold' service
takes precedence.

Since our services are fully parallelized, if a bottleneck appears, we add
more workers to that stage, distributed across the rabbit cluster. For
example, our 'cache_pull' service has 9 workers in each core pipeline.

I think SEDA is a good inspiration for this kind of design - Cassandra is
organized internally this way - nyt?a?rik is SEDA writ large with bigger
chunks. Here's a SEDA link from the originator:
http://matt-welsh.blogspot.com/2010/07/retrospective-on-seda.html


>
> > So we never restart nodes that die. Just sync in new ones. Actually we
> have
> > not yet had any core nodes die in production.
>
> Again - you're talking about Rabbit nodes right?
>

Yup.


>
> > Our instances are ridiculously small and inexpensive to run. We rely on
> this
> > global, headless, mutually supporting rabbit army for our reliability,
> > paired with a small Cassandra horde.
>
> Seems like a simple yet effective approach given the scale you're
> targeting.
>

Actually I think it will work for anyone that wants a global, reliable,
public-facing bi-directional messaging platform that will scale up when it
needs, down when it doesn't, and is presented as a standard service to
internal customers. We're the ham in the sandwich - and much more reliable
than the bread slices.

The back-end is 'pluggable' - couchbase might be an alternate choice. We've
used riak and dynamodb but chose Cassandra because multi-datacenter
facilities are available and free to use plus we have folks who can jump
into any Java issues (not me).


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/0bd855c5/attachment.html>

From videlalvaro at gmail.com  Wed Mar  5 13:06:14 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 5 Mar 2014 14:06:14 +0100
Subject: [rabbitmq-discuss] RABBITMQ_BASE
In-Reply-To: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
References: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
Message-ID: <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>

Homebrew uses the standalone Mac release behind the scenes, so I don't
think this applies, since you would have to relocate the whole install
folder.

On Wednesday, March 5, 2014, Michael Bridgen <mikeb at squaremobius.net> wrote:

> This documentation http://www.rabbitmq.com/relocate.html implies that
> running, e.g.,
> $ RABBITMQ_BASE=`pwd` rabbitmq-server &
> will instruct RabbitMQ to put its database and log files in the
> current directory. But when I do this, RabbitMQ just puts its log
> files where it normally does.
>
> It's a (recent) homebrew install, so perhaps the formula is doing
> something tricksy.
>
> -Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com <javascript:;>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/6bb5f4f4/attachment.html>

From dev440 at gmail.com  Wed Mar  5 13:26:08 2014
From: dev440 at gmail.com (chetan dev)
Date: Wed, 5 Mar 2014 18:56:08 +0530
Subject: [rabbitmq-discuss] Closing RabbitMq Blocked Connection
Message-ID: <CAB0ZxM6h3kT8LP+Fs2fQ8xncdJqx0vT_P-pKz26yhy9+sWA1mA@mail.gmail.com>

Hi,

Can someone please tell me the way to close blocked connection.
I am using rabbitmq 3.0.0

Thanks

-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/f70a3f77/attachment.html>

From mikeb at squaremobius.net  Wed Mar  5 13:43:48 2014
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Wed, 5 Mar 2014 13:43:48 +0000
Subject: [rabbitmq-discuss] RABBITMQ_BASE
In-Reply-To: <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>
References: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
 <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>
Message-ID: <CAMZ8XCi_nPyo5qLvOh23wtfOTALpKMurQgGjXt5mniozrzsOXg@mail.gmail.com>

On 5 March 2014 13:06, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Homebrew uses the standalone Mac release behind the scenes, so I don't think
> this applies, since you would have to relocate the whole install folder.

What doesn't apply? RABBITMQ_LOG_BASE and RABBITMQ_MNESIA_BASE *do*
work in the expected way (something I perhaps ought to have
mentioned).


> On Wednesday, March 5, 2014, Michael Bridgen <mikeb at squaremobius.net> wrote:
>>
>> This documentation http://www.rabbitmq.com/relocate.html implies that
>> running, e.g.,
>> $ RABBITMQ_BASE=`pwd` rabbitmq-server &
>> will instruct RabbitMQ to put its database and log files in the
>> current directory. But when I do this, RabbitMQ just puts its log
>> files where it normally does.
>>
>> It's a (recent) homebrew install, so perhaps the formula is doing
>> something tricksy.
>>
>> -Michael
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Rohit.Patle at techmahindra.com  Wed Mar  5 14:03:02 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Wed, 5 Mar 2014 14:03:02 +0000
Subject: [rabbitmq-discuss] [rabbitmq-c] minimal network bandwidth
	requirement to API execute
Message-ID: <27E054594442884E9A46DBCF9AE7408165139E@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

I am producing this latency by using tc (transmission control) tool in Ubuntu. In this case the API amqp_login is getting failed to execute with exception at listener. Here I would like to know that what is the Signal that library is producing in such case?

As you suggested We tried to close the socket connection in case of rabbitmq-server is down, But while doing this the amqp_connection_close() API gets failed to execute with exception and returns some Signal to kernel from library.

Can you please let me know what is the Signal that library is producing in this kind scenarios?

Thanks & Regards,
Rohit

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/62a189e6/attachment.html>

From patrik.ring at bloglovin.com  Wed Mar  5 14:48:28 2014
From: patrik.ring at bloglovin.com (Patrik Ring)
Date: Wed, 5 Mar 2014 09:48:28 -0500
Subject: [rabbitmq-discuss] Federation chokes on load
In-Reply-To: <53171305.4030606@rabbitmq.com>
References: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
 <531613D6.5030401@rabbitmq.com>
 <CAP0RBZUmGLeB_jAgn=c_72+4HU6WioaBA8QfiOkpVrD=YvSsnw@mail.gmail.com>
 <53171305.4030606@rabbitmq.com>
Message-ID: <CAP0RBZXTgWzi5QpNf-F6WeCGzN61zw5A_DP+2PnyQKjU2GovFw@mail.gmail.com>

Yes. With only that binding, things are working and I can see the message
in test-receive-users queue. The problems start when I start adding
bindings and messages. We have had it working with a few bindings (5-10
approx) but when we start putting load on it (5000 bindings approx) it
seems to just die.

Best regards
Patrik Ring

Co-founder and CTO of Bloglovin.com
patrik.ring at bloglovin.com
+46 730 59 78 14
+1 347 859 7999


On Wed, Mar 5, 2014 at 7:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Patrik, thanks.
>
> So this looks like federation is configured correctly and should be
> working normally. The downstream exchange only has a single binding to a
> single queue, with routing key "user.2". Are messages being published
> upstream with that key?
>
> Cheers, Simon
>
>
> On 04/03/14 22:06, Patrik Ring wrote:
>
>> Rabbit version in use is: RabbitMQ 3.2.1, Erlang R14B04
>>
>> rabbitmqctl report on
>> upstream: http://pastebin.com/PNqTziGk
>> "slave" server: http://pastebin.com/4L6JFsiW
>>
>> *I have this in the exchanges list on the upstream:*
>>
>>
>> federation: users -> rabbit at rabbit3.c.rabbit-magic.internal B
>> <http://rabbit1:15672/#/exchanges/%2F/federation%3A%
>> 20users%20-%3E%20rabbit%40rabbit3.c.rabbit-magic.internal%20B>
>>
>>         x-federation-upstream   ha-all  D AD I Args
>>
>>
>> And this i the queues list:
>>
>> federation: users -> rabbit at rabbit3.c.rabbit-magic.internal
>> <http://rabbit1:15672/#/queues/%2F/federation%3A%20users%20-%3E%20rabbit%
>> 40rabbit3.c.rabbit-magic.internal>
>>
>>         rabbit at util1 +1                 Exp D Args
>>
>>
>> *For the slave:*
>> *
>> *
>> *Nothing.* Except on channels, where I find this:
>>
>> <rabbit at rabbit3.3.237.0> (1)
>> <http://162.222.179.163:15672/#/channels/%3Crabbit%
>> 40rabbit3.3.237.0%3E%20(1)>
>>
>> federation
>>
>>
>> Feel like we might be on to something?
>>
>> How do I set this up?
>>
>>
>>
>> As a side note: The queues and exchanges on the upstream might still be
>> there since when we tried making it run both ways, not sure about this.
>> We do however have the federation status on the SLAVE, and according to
>> that it's up and running.
>>
>>
>> Best regards
>> Patrik Ring
>>
>> Co-founder and CTO of Bloglovin.com
>> patrik.ring at bloglovin.com <mailto:patrik.ring at bloglovin.com>
>>
>> +46 730 59 78 14
>> +1 347 859 7999
>>
>>
>> On Tue, Mar 4, 2014 at 12:56 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi Patrik.
>>
>>     On 03/03/14 21:41, Patrik Ring wrote:
>>
>>         Some messages come through (but are heavily delayed, as in
>>         hours) but
>>         they seem completely random.
>>
>>
>>     That's definitely not right!
>>
>>     First of all, could you send the output of "rabbitmqctl report" for
>>     each broker?
>>
>>     Also, which version of RabbitMQ are you using?
>>
>>     Secondly, you might want to investigate whether the underlying
>>     infrastructure used by federation is wired up correctly. There
>>     should be a queue for each (exchange, downstream) pairing declared
>>     in the upstream broker (called "federation: [exchange] -> [node]").
>>     It should be bound (once) to an internal exchange with a similar
>>     name. That internal exchange should be bound to the upstream
>>     exchange with all the bindings that are in use downstream.
>>
>>     Does it look like that is happening? Is the infrastructure queue
>>     seeing the message rates you would expect?
>>
>>     Cheers, Simon
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, Pivotal
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/0a895fbc/attachment.html>

From simon at rabbitmq.com  Wed Mar  5 15:28:02 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Mar 2014 15:28:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 fails to start if management
 plugin enabled
In-Reply-To: <001201cf385e$49e74bd0$ddb5e370$@gmail.com>
References: <001201cf385e$49e74bd0$ddb5e370$@gmail.com>
Message-ID: <53174282.7070903@rabbitmq.com>

Is this in a cluster?
What does /var/log/rabbitmq/rabbit at rabbit4-sasl.log show?

Cheers, Simon

On 05/03/14 10:32, Junius Wang wrote:
> Hi,
>
> I tried the latest release 3.2.4.  The initial start succeeded after
> installed. However, as long as I enabled the management plugin(by
> ?rabbitmq_plugins enable rabbitmq_management?) ,RabbitMQ cannot start
> anymore.  I?m CentOS 6.4 with erlong R14B04(erts-5.8.5).   What?s the
> matter?
>
> Before the plugin enabled, RabbitMQ is runing:
>
> [root at rabbit4 rabbitmq]# sudo rabbitmqctl status
>
> Status of node rabbit at rabbit4 ...
>
> [{pid,28255},
>
> {running_applications,[{rabbit,"RabbitMQ","3.2.4"},
>
>                          {os_mon,"CPO  CXC 138 46","2.2.7"},
>
>                          {xmerl,"XML parser","1.2.10"},
>
>                          {mnesia,"MNESIA  CXC 138 12","4.5"},
>
>                          {sasl,"SASL  CXC 138 11","2.1.10"},
>
>                          {stdlib,"ERTS  CXC 138 10","1.17.5"},
>
>                          {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>
> {os,{unix,linux}},
>
> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
> [async-threads:30] [kernel-poll:true]\n"},
>
> {memory,[{total,27470168},
>
>            {connection_procs,2648},
>
>            {queue_procs,5296},
>
>            {plugins,0},
>
>            {other_proc,9321128},
>
>            {mnesia,58928},
>
>            {mgmt_db,0},
>
>            {msg_index,21112},
>
>            {other_ets,775152},
>
>            {binary,6256},
>
>            {code,14561678},
>
>            {atom,1360113},
>
>            {other_system,1357857}]},
>
> {vm_memory_high_watermark,0.4},
>
> {vm_memory_limit,247676928},
>
> {disk_free_limit,50000000},
>
> {disk_free,5879087104},
>
> {file_descriptors,[{total_limit,924},
>
>                      {total_used,3},
>
>                      {sockets_limit,829},
>
>                      {sockets_used,1}]},
>
> {processes,[{limit,1048576},{used,124}]},
>
> {run_queue,0},
>
> {uptime,16}]
>
> ...done.
>
> After it?s enabled. RabbitMQ fails to start:
>
> [root at rabbit4 rabbitmq]# cat /var/log/rabbitmq/startup_log
>
>                RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
>
>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>
>    ##  ##
>
>    ##########  Logs: /var/log/rabbitmq/rabbit at rabbit4.log
>
>    ######  ##        /var/log/rabbitmq/rabbit at rabbit4-sasl.log
>
>    ##########
>
>                Starting broker...
>
> BOOT FAILED
>
> ===========
>
> Error description:
>
>     {could_not_start,rabbitmq_management,
>
>         {{shutdown,
>
>              {failed_to_start_child,rabbit_mgmt_sup,
>
>                  {'EXIT',
>
>                      {{shutdown,
>
>                           [{{badmatch,[]},
>
>                             [{mirrored_supervisor,child,2},
>
>                              {mirrored_supervisor,with_exit_handler,2},
>
>                              {mirrored_supervisor,check_start,4},
>
>                              {mnesia_tm,apply_fun,3},
>
>                              {mnesia_tm,execute_transaction,5},
>
>                              {rabbit_misc,
>
>                                  '-execute_mnesia_transaction/1-fun-0-',1},
>
>                              {worker_pool_worker,handle_call,3},
>
>                              {gen_server2,handle_msg,2}]}]},
>
>                       {gen_server2,call,
>
>                           [<0.353.0>,{init,<0.351.0>},infinity]}}}}},
>
>          {rabbit_mgmt_app,start,[normal,[]]}}}
>
> Log files (may contain more information):
>
>     /var/log/rabbitmq/rabbit at rabbit4.log
>
>     /var/log/rabbitmq/rabbit at rabbit4-sasl.log
>
> {"init terminating in
> do_boot",{rabbit,failure_during_boot,{could_not_start,rabbitmq_management,{{shutdown,{failed_to_start_child,rabbit_mgmt_sup,{'EXIT',{{shutdown,[{{badmatch,[]},[{mirrored_supervisor,child,2},{mirrored_supervisor,with_exit_handler,2},{mirrored_supervisor,check_start,4},{mnesia_tm,apply_fun,3},{mnesia_tm,execute_transaction,5},{rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},{worker_pool_worker,handle_call,3},{gen_server2,handle_msg,2}]}]},{gen_server2,call,[<0.353.0>,{init,<0.351.0>},infinity]}}}}},{rabbit_mgmt_app,start,[normal,[]]}}}}}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From 0x6e6562 at gmail.com  Wed Mar  5 15:54:44 2014
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 5 Mar 2014 15:54:44 +0000
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAKgmDnENnUTVE+zB5sN7O2N2sOPzV9L+bz-11k01zV8euzvx9A@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
 <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
 <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>
 <CAB-G1jgHu0aqqqkJLgzx-WPEw5j65H+T2+JAuu5UOnBQbg_sXA@mail.gmail.com>
 <CAKgmDnENnUTVE+zB5sN7O2N2sOPzV9L+bz-11k01zV8euzvx9A@mail.gmail.com>
Message-ID: <CAB-G1jjstauthCu21hGR=CpYuA=VDPpumL6++8b7M-vLDaqKrA@mail.gmail.com>

On Wed, Mar 5, 2014 at 12:51 PM, Laing, Michael
<michael.laing at nytimes.com> wrote:
> Some of our fabrik apps apply flow control. For example, we apply flow
> control to the ingress of 'silver' service messages so that 'gold' service
> takes precedence.

How do you apply flow control in your infrastructure?

From rdgsdavid at gmail.com  Wed Mar  5 17:18:14 2014
From: rdgsdavid at gmail.com (David Rodrigues)
Date: Wed, 5 Mar 2014 18:18:14 +0100
Subject: [rabbitmq-discuss] Problems with the {cluster_partition_handling,
	pause_minority} option
Message-ID: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>

Dear RabbitMQ Community,

I'm having some problems with the {cluster_partition_handling,
pause_minority} option and I would like to share with you my doubts.

First, the architecture. I'm running RabbitMQ 3.2.4 (Erlang R14A) on 3
nodes (rabbitmq at rabbitmq-test01, rabbitmq at rabbitmq-test02 and
rabbitmq at rabbitmq-test03) on a virtualized platform - quite similar to
EC2.  And because of that I have, from time to time, connectivity issues -
I know, that's bad ;)

Digging into the doc I have found that the best way to handle the problem
is using the pause_minority option -
https://www.rabbitmq.com/partitions.html.

But from time to time my nodes get disconnected from each other and do not
recover automatically. Hopefully I have managed to reproduce the problem.
Here are the steps.

THE CONFIGURATION FILE
***********************************************************

My configuration file is quite simple:

%% -*- mode: erlang -*-
[
 {rabbit,
  [
   {auth_mechanisms, ['PLAIN', 'AMQPLAIN']},
   {default_vhost,       <<"/">>},
   {default_user,        <<"admin">>},
   {default_pass,        <<"admin">>},
   {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
   {default_user_tags, [administrator]},
   {cluster_partition_handling, pause_minority},
   {cluster_nodes, {['rabbitmq at rabbitmq-test01', 'rabbitmq at rabbitmq-test02',
'rabbitmq at rabbitmq-test03'], disc}}
  ]},
 {kernel, []},
 {rabbitmq_management, []},
 {rabbitmq_management_agent, []},
 {rabbitmq_shovel,
  [{shovels, []}
  ]},
 {rabbitmq_stomp, []},
 {rabbitmq_mqtt, []},
 {rabbitmq_amqp1_0, []},
 {rabbitmq_auth_backend_ldap, []}
].

Has you can see, the {cluster_partition_handling, pause_minority} option is
there.

PAUSE_MINORITY WORKING
***********************************************************

When the network outage is long enough, the option works perfectly.

To simulate a connection problem on rabbitmq-test03 I run:

iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
rabbitmq-test01 -j DROP
iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
rabbitmq-test02 -j DROP

Then wait long enough for the following messages to appear in the logs of
rabbitmq-test03 (approximately 180 seconds):

=ERROR REPORT==== 5-Mar-2014::16:51:02 ===
** Node 'rabbitmq at rabbitmq-test02' not responding **
** Removing (timedout) connection **
=ERROR REPORT==== 5-Mar-2014::16:51:02 ===
** Node 'rabbitmq at rabbitmq-test01' not responding **
** Removing (timedout) connection **
=INFO REPORT==== 5-Mar-2014::16:51:02 ===
rabbit on node 'rabbitmq at rabbitmq-test02' down
=WARNING REPORT==== 5-Mar-2014::16:51:30 ===
Cluster minority status detected - awaiting recovery
=INFO REPORT==== 5-Mar-2014::16:51:30 ===
rabbit on node 'rabbitmq at rabbitmq-test01' down
=INFO REPORT==== 5-Mar-2014::16:51:30 ===
Stopping RabbitMQ
=INFO REPORT==== 5-Mar-2014::16:51:30 ===
stopped TCP Listener on [::]:5672
=WARNING REPORT==== 5-Mar-2014::16:51:58 ===
Cluster minority status detected - awaiting recovery

When flushing the rules (iptables -F) the connectivity is reestablished and
the cluster works perfectly.

In the logs:

=INFO REPORT==== 5-Mar-2014::16:52:58 ===
started TCP Listener on [::]:5672
=INFO REPORT==== 5-Mar-2014::16:52:58 ===
rabbit on node 'rabbitmq at rabbitmq-test01' up
=INFO REPORT==== 5-Mar-2014::16:52:58 ===
rabbit on node 'rabbitmq at rabbitmq-test02' up

Finally the cluster status :

Cluster status of node 'rabbitmq at rabbitmq-test03' ...
[{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
                'rabbitmq at rabbitmq-test03']}]},
 {running_nodes,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
                 'rabbitmq at rabbitmq-test03']},
 {partitions,[]}]
...done.

So far, so good. The option works flawlessly.

PAUSE_MINORITY NOT WORKING
***********************************************************

Life is not so bright when the network partition is not long enough.

On rabbitmq-test03 I will run my iptables commands again:

iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
rabbitmq-test01 -j DROP
iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
rabbitmq-test02 -j DROP

However this time I'll only wait 60 seconds before flushing my rules with
iptables -F.

And that's the result in rabbitmq-test03 logs:

=INFO REPORT==== 5-Mar-2014::16:55:00 ===
rabbit on node 'rabbitmq at rabbitmq-test02' down
=ERROR REPORT==== 5-Mar-2014::16:55:00 ===
Mnesia('rabbitmq at rabbitmq-test03'): ** ERROR ** mnesia_event got
{inconsistent_database, running_partitioned_network,
'rabbitmq at rabbitmq-test02'}
=INFO REPORT==== 5-Mar-2014::16:55:00 ===
rabbit on node 'rabbitmq at rabbitmq-test01' down
=INFO REPORT==== 5-Mar-2014::16:55:00 ===
Statistics database started.
=INFO REPORT==== 5-Mar-2014::16:55:00 ===
Statistics database started.

Again, the result is quiet ugly on rabbitmq-test01:

=ERROR REPORT==== 5-Mar-2014::16:55:00 ===
** Node 'rabbitmq at rabbitmq-test03' not responding **
** Removing (timedout) connection **
=INFO REPORT==== 5-Mar-2014::16:55:00 ===
rabbit on node 'rabbitmq at rabbitmq-test03' down
=INFO REPORT==== 5-Mar-2014::16:55:01 ===
global: Name conflict terminating {rabbit_mgmt_db,<2669.1582.0>}

Finally my cluster status:

Cluster status of node 'rabbitmq at rabbitmq-test03' ...
[{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
                'rabbitmq at rabbitmq-test03']}]},
 {running_nodes,['rabbitmq at rabbitmq-test03']},
 {partitions,[{'rabbitmq at rabbitmq-test03',['rabbitmq at rabbitmq-test02']}]}]
...done.

That's it. Even with the pause_minority option my cluster was disintegrated.

SYNOPSIS
***********************************************************

In short, if the network outage is long enough everything goes according to
the plan and the cluster works perfectly once the connectivity is
reestablished. However if the network outage has a intermediate duration
(not too short, not too long) the pause_minority option seems not to work.

Are you aware of this problem? Is there any solution to cope with this
particular situation?

Thanks,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/bbd1951d/attachment.html>

From michael.laing at nytimes.com  Wed Mar  5 17:18:27 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 5 Mar 2014 12:18:27 -0500
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAB-G1jjstauthCu21hGR=CpYuA=VDPpumL6++8b7M-vLDaqKrA@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAKgmDnG0Cp+U7_y50HXwmV88-x1wWNcLpPvA+gWFs4vYqdv+4w@mail.gmail.com>
 <530F6CDD.4080006@rabbitmq.com>
 <CAKgmDnG1+M7B9wWfcbUXQb5bnw5YbA5BS4EvcH7g-OsfnN_MUg@mail.gmail.com>
 <CAB-G1ji-XxRSYiC2PiUN_a9ajaC7i6aXnmjW-mrsQ+kVQj8TSA@mail.gmail.com>
 <CAKgmDnHj1jy+gqhWTGkVYVS+=zDV0WRPdWCvOuceyqE5YziKUg@mail.gmail.com>
 <CAB-G1jgr5+Miw0nLKn7dgunXJhFEVzg4CO7-j0iL2F22p0gYjg@mail.gmail.com>
 <CAKgmDnHFBCY7CfwazwuBajbAp95iSXCJeJG-tXruoFYppNaQRQ@mail.gmail.com>
 <CAD6m6fEt=qy0EgoR3u89Zny19mA=uWRkE0Rni7=k5QTkU_aVrQ@mail.gmail.com>
 <CAKgmDnEimbvPhqzjwZSLchZXXKjJkfpVgw3_SAe1=rGUdHnmrg@mail.gmail.com>
 <CAB-G1jjFNnBPMCvyrchU2xf3RjEG_WFbmiMCgThUQEO7ND1jtQ@mail.gmail.com>
 <CAKgmDnFFbEpvSfFd_yAC6zuUy0=TvwgDZ6gEjn2L3oFpOETAmg@mail.gmail.com>
 <CAB-G1jgHu0aqqqkJLgzx-WPEw5j65H+T2+JAuu5UOnBQbg_sXA@mail.gmail.com>
 <CAKgmDnENnUTVE+zB5sN7O2N2sOPzV9L+bz-11k01zV8euzvx9A@mail.gmail.com>
 <CAB-G1jjstauthCu21hGR=CpYuA=VDPpumL6++8b7M-vLDaqKrA@mail.gmail.com>
Message-ID: <CAKgmDnFZsS=n0tnJ6kwwrGCHzDzZqqLCRnd1VWRq3GP-uE9U+Q@mail.gmail.com>

Basically, we delay the ack by adding a timeout/callback to the event loop
after processing a message from the 'silver' queue. The delay reflects the
desired rate. Crude but it works. We use pika w the libev adapter I wrote.

BTW re node restart: we do restart our Cassandra nodes if they fail. They
discover and automatically sync up w the other Cassandra nodes. This has
happened in production. We also do rolling restarts of the production
Cassandra cluster to upgrade to new versions.


On Wed, Mar 5, 2014 at 10:54 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> On Wed, Mar 5, 2014 at 12:51 PM, Laing, Michael
> <michael.laing at nytimes.com> wrote:
> > Some of our fabrik apps apply flow control. For example, we apply flow
> > control to the ingress of 'silver' service messages so that 'gold'
> service
> > takes precedence.
>
> How do you apply flow control in your infrastructure?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/32ce5cd6/attachment.html>

From jwjjj1983 at gmail.com  Wed Mar  5 18:12:07 2014
From: jwjjj1983 at gmail.com (Wei Jin)
Date: Wed, 5 Mar 2014 10:12:07 -0800
Subject: [rabbitmq-discuss] Can rabbitmq broker federate to Azure service
	bus?
Message-ID: <CAE09Ej9cJR0GGi_2-5V9zSwwidGWkmWfW2kSMiCbfR6cxkEzgg@mail.gmail.com>

We need post some messages to Azure Service Bus supporting amqp1.0 and
figure it would be nice (in case Azure service bus is down) to post
messages to the local broker first and then let the broker propagate
messages to Azure. Is it possible with rabbitmq federation?

Thanks,

Wei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/f672b7a2/attachment.html>

From jamesa at conversocial.com  Wed Mar  5 18:22:52 2014
From: jamesa at conversocial.com (James Andres)
Date: Wed, 5 Mar 2014 10:22:52 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server sending unexpected FIN/ACK
Message-ID: <fe8a236c-0748-4fa3-8cf2-6b8f5bda8559@googlegroups.com>

Hello,

I have a 3 node rabbit 3.2.3 cluster which is working great most of the 
time. Occasionally, however, our clients (Pika 0.9.13 / 0.9.14p1) receive 
an abrupt TCP level disconnect. These FIN/ACK's generally happen between 
start / start-ok or the first tune / tune-ok. There are no messages in the 
rabbitmq server logs around the time of the tcp FIN/ACK.

An sketch of one of our failing connections with any large gaps in timing 
highlighted:

   later ... CLIENT -> SERVER says SYN...
   later ... SERVER -> CLIENT says SYN/ACK
   later ... CLIENT -> SERVER says ACK
   later ... CLIENT -> SERVER says AMQP,Protocol-Header 9-1
   later ... SERVER -> CLIENT says ACK
   later ... SERVER -> CLIENT says Connection.Start
   later ... CLIENT -> SERVER says ACK
8s later ... CLIENT -> SERVER says Connection.Start-Ok
   later ... SERVER -> CLIENT says Connection.Tune
   later ... CLIENT -> SERVER says ACK
2s later ... SERVER -> CLIENT says FIN,ACK
   later ... CLIENT -> SERVER says ACK
   later ... CLIENT -> SERVER says Connection.Tune-Ok
   later ... SERVER -> CLIENT says RST
   later ... CLIENT -> SERVER says Connection.Open
   later ... SERVER -> CLIENT says RST

Does anyone know of a good place to start debugging this? Are there 
relevant timeouts I should be aware of?

Much appreciated,

- James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/d542be5f/attachment.html>

From arunrao.seattle at gmail.com  Wed Mar  5 19:22:25 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Wed, 5 Mar 2014 11:22:25 -0800
Subject: [rabbitmq-discuss] Polling Average message size in a queue
Message-ID: <CAEJg2GCmLdrztdBuQj=HU9Vj+sQBf=iLDv6z_dkdDYZm3E7K5g@mail.gmail.com>

Hello -

I am interested in monitoring the average size of messages flowing through
a queue. I could use the API to get messages with requeue set to true, so
that I have the output of a message to determine size. Unfortunately, this
method is not effective when consumers are consuming faster than producers.

The other option is to write a java program with higher consumer priority
which connects intermittently to the queue and requeues the messages after
I determine the size.

Any other ideas/suggestions that I missed?

Thanks!
-arun.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/3da34739/attachment.html>

From matthias at rabbitmq.com  Wed Mar  5 19:33:16 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Mar 2014 19:33:16 +0000
Subject: [rabbitmq-discuss] Polling Average message size in a queue
In-Reply-To: <CAEJg2GCmLdrztdBuQj=HU9Vj+sQBf=iLDv6z_dkdDYZm3E7K5g@mail.gmail.com>
References: <CAEJg2GCmLdrztdBuQj=HU9Vj+sQBf=iLDv6z_dkdDYZm3E7K5g@mail.gmail.com>
Message-ID: <53177BFC.9050909@rabbitmq.com>

On 05/03/14 19:22, Arun Rao wrote:
> I am interested in monitoring the average size of messages flowing
> through a queue. I could use the API to get messages with requeue set to
> true, so that I have the output of a message to determine size.
> Unfortunately, this method is not effective when consumers are consuming
> faster than producers.
>
> The other option is to write a java program with higher consumer
> priority which connects intermittently to the queue and requeues the
> messages after I determine the size.
>
> Any other ideas/suggestions that I missed?

Set up a second queue with exactly the same bindings as the first, and 
let your average-size-calculating program consume & ack messages in that.

Matthias.


From arunrao.seattle at gmail.com  Wed Mar  5 19:45:03 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Wed, 5 Mar 2014 11:45:03 -0800
Subject: [rabbitmq-discuss] Polling Average message size in a queue
In-Reply-To: <53177BFC.9050909@rabbitmq.com>
References: <CAEJg2GCmLdrztdBuQj=HU9Vj+sQBf=iLDv6z_dkdDYZm3E7K5g@mail.gmail.com>
 <53177BFC.9050909@rabbitmq.com>
Message-ID: <CAEJg2GA6mZ=LNOwm6FaHfP0XDKus5HgLBFGV-K2TH6OrbyadRw@mail.gmail.com>

Thanks Matthias! That is a brilliant idea and I can setup queue length
limit on the second queue as per the requirement.

Thanks!
-arun.


On Wed, Mar 5, 2014 at 11:33 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 05/03/14 19:22, Arun Rao wrote:
>
>> I am interested in monitoring the average size of messages flowing
>> through a queue. I could use the API to get messages with requeue set to
>> true, so that I have the output of a message to determine size.
>> Unfortunately, this method is not effective when consumers are consuming
>> faster than producers.
>>
>> The other option is to write a java program with higher consumer
>> priority which connects intermittently to the queue and requeues the
>> messages after I determine the size.
>>
>> Any other ideas/suggestions that I missed?
>>
>
> Set up a second queue with exactly the same bindings as the first, and let
> your average-size-calculating program consume & ack messages in that.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/62b30089/attachment.html>

From gavinmroy at gmail.com  Wed Mar  5 20:04:36 2014
From: gavinmroy at gmail.com (Gavin M. Roy)
Date: Wed, 5 Mar 2014 15:04:36 -0500
Subject: [rabbitmq-discuss] RabbitMQ server sending unexpected FIN/ACK
In-Reply-To: <fe8a236c-0748-4fa3-8cf2-6b8f5bda8559@googlegroups.com>
References: <fe8a236c-0748-4fa3-8cf2-6b8f5bda8559@googlegroups.com>
Message-ID: <CAPnH5konALB1Q5_JfXMACJ_e_Ym_9s+G-EJY=eNqTvQqdBW3Zw@mail.gmail.com>

Are you using BlockingConnection? My guess is you're not responding to a
heartbeat request and RabbitMQ is disconnecting you.


On Wed, Mar 5, 2014 at 1:22 PM, James Andres <jamesa at conversocial.com>wrote:

> Hello,
>
> I have a 3 node rabbit 3.2.3 cluster which is working great most of the
> time. Occasionally, however, our clients (Pika 0.9.13 / 0.9.14p1) receive
> an abrupt TCP level disconnect. These FIN/ACK's generally happen between
> start / start-ok or the first tune / tune-ok. There are no messages in the
> rabbitmq server logs around the time of the tcp FIN/ACK.
>
> An sketch of one of our failing connections with any large gaps in timing
> highlighted:
>
>    later ... CLIENT -> SERVER says SYN...
>    later ... SERVER -> CLIENT says SYN/ACK
>    later ... CLIENT -> SERVER says ACK
>    later ... CLIENT -> SERVER says AMQP,Protocol-Header 9-1
>    later ... SERVER -> CLIENT says ACK
>    later ... SERVER -> CLIENT says Connection.Start
>    later ... CLIENT -> SERVER says ACK
> 8s later ... CLIENT -> SERVER says Connection.Start-Ok
>    later ... SERVER -> CLIENT says Connection.Tune
>    later ... CLIENT -> SERVER says ACK
> 2s later ... SERVER -> CLIENT says FIN,ACK
>    later ... CLIENT -> SERVER says ACK
>    later ... CLIENT -> SERVER says Connection.Tune-Ok
>    later ... SERVER -> CLIENT says RST
>    later ... CLIENT -> SERVER says Connection.Open
>    later ... SERVER -> CLIENT says RST
>
> Does anyone know of a good place to start debugging this? Are there
> relevant timeouts I should be aware of?
>
> Much appreciated,
>
> - James
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/3926abcd/attachment.html>

From ryankbrown at gmail.com  Wed Mar  5 22:24:03 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Wed, 5 Mar 2014 15:24:03 -0700
Subject: [rabbitmq-discuss] Confirm publish confirms?
Message-ID: <CAChGYf-zdmdP_jdgC7qrszN9UxdikctgNdEDMk03HsXdLySOvA@mail.gmail.com>

Is there a way to configure RabbitMQ to, say, log that it has completed a
confirmed publish? I am testing an implementation where my client performs
a publish/confirm but I am wondering if there is a way to confirm that my
publishes were actually written to disk by Rabbit? It may sound like I'm
being distrustful but, it's more that I'm distrustful of my implementation.

Thanks in advance.

Ryan

-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/d357ce97/attachment.html>

From videlalvaro at gmail.com  Wed Mar  5 23:09:18 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 6 Mar 2014 00:09:18 +0100
Subject: [rabbitmq-discuss] RABBITMQ_BASE
In-Reply-To: <CAMZ8XCi_nPyo5qLvOh23wtfOTALpKMurQgGjXt5mniozrzsOXg@mail.gmail.com>
References: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
 <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>
 <CAMZ8XCi_nPyo5qLvOh23wtfOTALpKMurQgGjXt5mniozrzsOXg@mail.gmail.com>
Message-ID: <CAMcAHLUeSNe2hDuXys4XPZCvoXsHs-XWRMeMQ5E0cTap=t9DWg@mail.gmail.com>

The standalone mac release is based on the generic-unix version, which
according to this page: http://www.rabbitmq.com/relocate.html doesn't
use the RABBITMQ_BASE env variable

On Wed, Mar 5, 2014 at 2:43 PM, Michael Bridgen <mikeb at squaremobius.net> wrote:
> On 5 March 2014 13:06, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Homebrew uses the standalone Mac release behind the scenes, so I don't think
>> this applies, since you would have to relocate the whole install folder.
>
> What doesn't apply? RABBITMQ_LOG_BASE and RABBITMQ_MNESIA_BASE *do*
> work in the expected way (something I perhaps ought to have
> mentioned).
>
>
>> On Wednesday, March 5, 2014, Michael Bridgen <mikeb at squaremobius.net> wrote:
>>>
>>> This documentation http://www.rabbitmq.com/relocate.html implies that
>>> running, e.g.,
>>> $ RABBITMQ_BASE=`pwd` rabbitmq-server &
>>> will instruct RabbitMQ to put its database and log files in the
>>> current directory. But when I do this, RabbitMQ just puts its log
>>> files where it normally does.
>>>
>>> It's a (recent) homebrew install, so perhaps the formula is doing
>>> something tricksy.
>>>
>>> -Michael
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wangjunbo924 at gmail.com  Thu Mar  6 01:37:25 2014
From: wangjunbo924 at gmail.com (Junius Wang)
Date: Thu, 6 Mar 2014 09:37:25 +0800
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 fails to start if management
	plugin enabled
In-Reply-To: <53174282.7070903@rabbitmq.com>
References: <001201cf385e$49e74bd0$ddb5e370$@gmail.com>
 <53174282.7070903@rabbitmq.com>
Message-ID: <012a01cf38dc$a3a42d40$eaec87c0$@gmail.com>

No, not in a cluster.  Sasl log tells:


=SUPERVISOR REPORT==== 5-Mar-2014::10:31:09 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     {shutdown,
                     [{{badmatch,[]},
                       [{mirrored_supervisor,child,2},
                        {mirrored_supervisor,with_exit_handler,2},
                        {mirrored_supervisor,check_start,4},
                        {mnesia_tm,apply_fun,3},
                        {mnesia_tm,execute_transaction,5},
 
{rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
                        {worker_pool_worker,handle_call,3},
                        {gen_server2,handle_msg,2}]}]}
     Offender:   [{pid,<0.353.0>},
                  {name,mirroring},
                  {mfargs,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           #Fun<rabbit_misc.execute_mnesia_transaction.1>,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 5-Mar-2014::10:31:09 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.353.0>},
                  {name,mirroring},
                  {mfargs,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           #Fun<rabbit_misc.execute_mnesia_transaction.1>,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 5-Mar-2014::10:31:09 ===
     Supervisor: {local,rabbit_mgmt_sup_sup}
     Context:    start_error
     Reason:     {'EXIT',
                     {{shutdown,
                          [{{badmatch,[]},
                            [{mirrored_supervisor,child,2},
                             {mirrored_supervisor,with_exit_handler,2},
                             {mirrored_supervisor,check_start,4},
                             {mnesia_tm,apply_fun,3},
                             {mnesia_tm,execute_transaction,5},
                             {rabbit_misc,
                                 '-execute_mnesia_transaction/1-fun-0-',1},
                             {worker_pool_worker,handle_call,3},
                             {gen_server2,handle_msg,2}]}]},
                      {gen_server2,call,
                          [<0.353.0>,{init,<0.351.0>},infinity]}}}
     Offender:   [{pid,undefined},
                  {name,rabbit_mgmt_sup},
                  {mfargs,{rabbit_mgmt_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,supervisor}]


=CRASH REPORT==== 5-Mar-2014::10:31:09 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.314.0>
    registered_name: []
    exception exit: {{shutdown,
                      {failed_to_start_child,rabbit_mgmt_sup,
                       {'EXIT',
                        {{shutdown,
                          [{{badmatch,[]},
                            [{mirrored_supervisor,child,2},
                             {mirrored_supervisor,with_exit_handler,2},
                             {mirrored_supervisor,check_start,4},
                             {mnesia_tm,apply_fun,3},
                             {mnesia_tm,execute_transaction,5},
                             {rabbit_misc,
                              '-execute_mnesia_transaction/1-fun-0-',1},
                             {worker_pool_worker,handle_call,3},
                             {gen_server2,handle_msg,2}]}]},
                         {gen_server2,call,
                          [<0.353.0>,{init,<0.351.0>},infinity]}}}}},
                     {rabbit_mgmt_app,start,[normal,[]]}}
      in function  application_master:init/4
    ancestors: [<0.313.0>]
    messages: [{'EXIT',<0.315.0>,normal}]
    links: [<0.313.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 24
    reductions: 109
  neighbours:





-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, March 05, 2014 11:28 PM
To: Discussions about RabbitMQ; Junius Wang
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.2.4 fails to start if management
plugin enabled

Is this in a cluster?
What does /var/log/rabbitmq/rabbit at rabbit4-sasl.log show?

Cheers, Simon

On 05/03/14 10:32, Junius Wang wrote:
> Hi,
>
> I tried the latest release 3.2.4.  The initial start succeeded after 
> installed. However, as long as I enabled the management plugin(by 
> "rabbitmq_plugins enable rabbitmq_management") ,RabbitMQ cannot start
> anymore.  I'm CentOS 6.4 with erlong R14B04(erts-5.8.5).   What's the
> matter?
>
> Before the plugin enabled, RabbitMQ is runing:
>
> [root at rabbit4 rabbitmq]# sudo rabbitmqctl status
>
> Status of node rabbit at rabbit4 ...
>
> [{pid,28255},
>
> {running_applications,[{rabbit,"RabbitMQ","3.2.4"},
>
>                          {os_mon,"CPO  CXC 138 46","2.2.7"},
>
>                          {xmerl,"XML parser","1.2.10"},
>
>                          {mnesia,"MNESIA  CXC 138 12","4.5"},
>
>                          {sasl,"SASL  CXC 138 11","2.1.10"},
>
>                          {stdlib,"ERTS  CXC 138 10","1.17.5"},
>
>                          {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>
> {os,{unix,linux}},
>
> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] 
> [async-threads:30] [kernel-poll:true]\n"},
>
> {memory,[{total,27470168},
>
>            {connection_procs,2648},
>
>            {queue_procs,5296},
>
>            {plugins,0},
>
>            {other_proc,9321128},
>
>            {mnesia,58928},
>
>            {mgmt_db,0},
>
>            {msg_index,21112},
>
>            {other_ets,775152},
>
>            {binary,6256},
>
>            {code,14561678},
>
>            {atom,1360113},
>
>            {other_system,1357857}]},
>
> {vm_memory_high_watermark,0.4},
>
> {vm_memory_limit,247676928},
>
> {disk_free_limit,50000000},
>
> {disk_free,5879087104},
>
> {file_descriptors,[{total_limit,924},
>
>                      {total_used,3},
>
>                      {sockets_limit,829},
>
>                      {sockets_used,1}]},
>
> {processes,[{limit,1048576},{used,124}]},
>
> {run_queue,0},
>
> {uptime,16}]
>
> ...done.
>
> After it's enabled. RabbitMQ fails to start:
>
> [root at rabbit4 rabbitmq]# cat /var/log/rabbitmq/startup_log
>
>                RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
>
>    ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>
>    ##  ##
>
>    ##########  Logs: /var/log/rabbitmq/rabbit at rabbit4.log
>
>    ######  ##        /var/log/rabbitmq/rabbit at rabbit4-sasl.log
>
>    ##########
>
>                Starting broker...
>
> BOOT FAILED
>
> ===========
>
> Error description:
>
>     {could_not_start,rabbitmq_management,
>
>         {{shutdown,
>
>              {failed_to_start_child,rabbit_mgmt_sup,
>
>                  {'EXIT',
>
>                      {{shutdown,
>
>                           [{{badmatch,[]},
>
>                             [{mirrored_supervisor,child,2},
>
>                              
> {mirrored_supervisor,with_exit_handler,2},
>
>                              {mirrored_supervisor,check_start,4},
>
>                              {mnesia_tm,apply_fun,3},
>
>                              {mnesia_tm,execute_transaction,5},
>
>                              {rabbit_misc,
>
>                                  
> '-execute_mnesia_transaction/1-fun-0-',1},
>
>                              {worker_pool_worker,handle_call,3},
>
>                              {gen_server2,handle_msg,2}]}]},
>
>                       {gen_server2,call,
>
>                           [<0.353.0>,{init,<0.351.0>},infinity]}}}}},
>
>          {rabbit_mgmt_app,start,[normal,[]]}}}
>
> Log files (may contain more information):
>
>     /var/log/rabbitmq/rabbit at rabbit4.log
>
>     /var/log/rabbitmq/rabbit at rabbit4-sasl.log
>
> {"init terminating in
> do_boot",{rabbit,failure_during_boot,{could_not_start,rabbitmq_managem
> ent,{{shutdown,{failed_to_start_child,rabbit_mgmt_sup,{'EXIT',{{shutdo
> wn,[{{badmatch,[]},[{mirrored_supervisor,child,2},{mirrored_supervisor
> ,with_exit_handler,2},{mirrored_supervisor,check_start,4},{mnesia_tm,a
> pply_fun,3},{mnesia_tm,execute_transaction,5},{rabbit_misc,'-execute_m
> nesia_transaction/1-fun-0-',1},{worker_pool_worker,handle_call,3},{gen
> _server2,handle_msg,2}]}]},{gen_server2,call,[<0.353.0>,{init,<0.351.0
> >},infinity]}}}}},{rabbit_mgmt_app,start,[normal,[]]}}}}}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, Pivotal


From mklishin at gopivotal.com  Thu Mar  6 04:54:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 6 Mar 2014 08:54:01 +0400
Subject: [rabbitmq-discuss] Confirm publish confirms?
In-Reply-To: <CAChGYf-zdmdP_jdgC7qrszN9UxdikctgNdEDMk03HsXdLySOvA@mail.gmail.com>
References: <CAChGYf-zdmdP_jdgC7qrszN9UxdikctgNdEDMk03HsXdLySOvA@mail.gmail.com>
Message-ID: <671DC5DC-0E28-4F1D-881D-D5B6D27BF1DE@rabbitmq.com>

On 6 Mar 2014, at 02:24, Ryan Brown <ryankbrown at gmail.com> wrote:

> I am wondering if there is a way to confirm that my publishes were actually written to disk by Rabbit

See When will messages be confirmed? in [1].

1. http://www.rabbitmq.com/confirms.html

MK

Software Engineer, Pivotal/RabbitMQ



From dev440 at gmail.com  Thu Mar  6 05:58:49 2014
From: dev440 at gmail.com (chetan dev)
Date: Thu, 6 Mar 2014 11:28:49 +0530
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
Message-ID: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>

Hi,

How can I increase the maximum limit of socket descriptors available for
rabbitmq ?


Thanks



-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/e71c9e20/attachment.html>

From mklishin at gopivotal.com  Thu Mar  6 06:08:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 6 Mar 2014 10:08:39 +0400
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
Message-ID: <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>

On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:

> How can I increase the maximum limit of socket descriptors available for 
> rabbitmq ?

See Changing the limit in [1] or [2].

1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/
2. http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux

MK

Software Engineer, Pivotal/RabbitMQ



From dev440 at gmail.com  Thu Mar  6 07:29:31 2014
From: dev440 at gmail.com (chetan dev)
Date: Thu, 6 Mar 2014 12:59:31 +0530
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
Message-ID: <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>

Hi,

Thanks for those links, but i am using windows and i didn't find relevant
information about windows socket descriptor limits.

Thanks

On Thu, Mar 6, 2014 at 11:38 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:
>
> > How can I increase the maximum limit of socket descriptors available for
> > rabbitmq ?
>
> See Changing the limit in [1] or [2].
>
> 1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/
> 2.
> http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/e25ab365/attachment.html>

From jkuch at gopivotal.com  Thu Mar  6 07:38:11 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Wed, 5 Mar 2014 23:38:11 -0800
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
Message-ID: <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>

This is off the top of my head, but I have a vaguely recalled fear that for
many Windows apps the limitation on file descriptors ends up coming not
from the Windows OS, but from the msvcrt library which had some asinine per
process limit of something like 1024 or 2048, without, IIRC, any humane way
to work around it.

I could be misremembering, or the situation may have improved since this
was the case.



On Wed, Mar 5, 2014 at 11:29 PM, chetan dev <dev440 at gmail.com> wrote:

> Hi,
>
> Thanks for those links, but i am using windows and i didn't find relevant
> information about windows socket descriptor limits.
>
> Thanks
>
> On Thu, Mar 6, 2014 at 11:38 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>> On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:
>>
>> > How can I increase the maximum limit of socket descriptors available for
>> > rabbitmq ?
>>
>> See Changing the limit in [1] or [2].
>>
>> 1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/<https://urldefense.proofpoint.com/v1/url?u=http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=16bdcc6e20b751f4b1e337528f30540d59309c416ef3f2af3187fd7da77cfefe>
>> 2.
>> http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux<https://urldefense.proofpoint.com/v1/url?u=http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=07ba0fcb7a1d0b741b91fa1343456add53a3d7399ae5d42a77f851de23478513>
>>
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3>
>>
>
>
>
> --
> Cheten  Dev
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
>
> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140305/7e039018/attachment.html>

From simon at rabbitmq.com  Thu Mar  6 09:58:33 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Mar 2014 09:58:33 +0000
Subject: [rabbitmq-discuss] Can rabbitmq broker federate to Azure
 service bus?
In-Reply-To: <CAE09Ej9cJR0GGi_2-5V9zSwwidGWkmWfW2kSMiCbfR6cxkEzgg@mail.gmail.com>
References: <CAE09Ej9cJR0GGi_2-5V9zSwwidGWkmWfW2kSMiCbfR6cxkEzgg@mail.gmail.com>
Message-ID: <531846C9.30002@rabbitmq.com>

On 05/03/14 18:12, Wei Jin wrote:
> We need post some messages to Azure Service Bus supporting amqp1.0 and
> figure it would be nice (in case Azure service bus is down) to post
> messages to the local broker first and then let the broker propagate
> messages to Azure. Is it possible with rabbitmq federation?

I'm afraid not - RabbitMQ federation runs over AMQP 0-9-1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From hkraemer at anynines.com  Thu Mar  6 10:21:55 2014
From: hkraemer at anynines.com (=?ISO-8859-15?Q?Heiko_Kr=E4mer?=)
Date: Thu, 06 Mar 2014 11:21:55 +0100
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
Message-ID: <53184C43.5010000@anynines.com>

Hi guys,

I've a strange problem in case HA queues.

Environment:
* RabbitMQ 3.2.3-1 (Ubuntu 12.04)
* 4 node cluster  (2x RAM, 2x Disc)
* HA-Queues, durable false
* Management plugins activated

Problem description:
I've more then 200 queues in my vhost and all works fine expect for one.
I don't see this queue via
     rabbitmqctl list_queues

but i see on the webinterface (management plugin) this queue is stored
on one Ram node. I can't sync this queue, I can't get informations about
this queue i see only on the panel '? ? ?'.
If i try to delete this queue via CLI => stuck
If i try to sync this queue via CLI => stuck
if i try to get messages via CLI => stuck

In addition on this node where the queue is present (what the web
interface shows) can't be stopped (service rabbitmq-server stop)



What i tried:
* via CLI the commands above
* kill erlang processes on this node, kill rabbitmq-server delete,
delete this node from cluster, delete mnesia home dir, start clean, add
to cluster again and resync without success

I don't see anything in the logfiles:
* No errors in sasl log
* No errors in shutdown logs


The only one what i see is:

=ERROR REPORT==== 5-Mar-2014::16:07:29 ===
webmachine error: path="/api/queues/%2F/lbaas_process_on_host_agent"
"Unauthorized"

=ERROR REPORT==== 6-Mar-2014::10:17:27 ===
Discarding message
{'$gen_call',{<0.786.0>,#Ref<0.0.0.6238>},force_event_refresh} from
<0.786.0> to <0.309.0> in an old incarnation (1) of this node (2)


but that's impossible, the user has admin privileges and all permissions:

xxxx    .*    .*    .*

on the right vhost.


Do anyone have a hint ? I need to delete this queue without to build a
complete new cluster. Is that possible ?



Cheers and thanks
Heiko


-- 
anynines.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/b9630ad4/attachment.sig>

From michael.s.klishin at gmail.com  Thu Mar  6 11:13:38 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Mar 2014 15:13:38 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.5.0 is released
Message-ID: <CAE3HoVRQSnycvvo9DdAZJT70MOV_24dDK3sUOLUnUYUekNwD7Q@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure client for RabbitMQ.

Release notes:
http://blog.clojurewerkz.org/blog/2014/03/06/langohr-2-dot-5-0-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/131b6848/attachment.html>

From mikeb at squaremobius.net  Thu Mar  6 12:40:23 2014
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Thu, 6 Mar 2014 12:40:23 +0000
Subject: [rabbitmq-discuss] RABBITMQ_BASE
In-Reply-To: <CAMcAHLUeSNe2hDuXys4XPZCvoXsHs-XWRMeMQ5E0cTap=t9DWg@mail.gmail.com>
References: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
 <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>
 <CAMZ8XCi_nPyo5qLvOh23wtfOTALpKMurQgGjXt5mniozrzsOXg@mail.gmail.com>
 <CAMcAHLUeSNe2hDuXys4XPZCvoXsHs-XWRMeMQ5E0cTap=t9DWg@mail.gmail.com>
Message-ID: <CAMZ8XCjwYWBREXeOnqnPzAs1793wRDoxC=eeGR36XpoFByn79g@mail.gmail.com>

On 5 March 2014 23:09, Alvaro Videla <videlalvaro at gmail.com> wrote:
> The standalone mac release is based on the generic-unix version, which
> according to this page: http://www.rabbitmq.com/relocate.html doesn't
> use the RABBITMQ_BASE env variable

Oh I see, yes my mistake, I didn't read down far enough. Still, I
reckon it'd be worth either making RABBITMQ_BASE work for
other-than-Windows, since it's rather useful; or at least marking it
as an exception rather than the general case, in the documentation.

-Michael

> On Wed, Mar 5, 2014 at 2:43 PM, Michael Bridgen <mikeb at squaremobius.net> wrote:
>> On 5 March 2014 13:06, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Homebrew uses the standalone Mac release behind the scenes, so I don't think
>>> this applies, since you would have to relocate the whole install folder.
>>
>> What doesn't apply? RABBITMQ_LOG_BASE and RABBITMQ_MNESIA_BASE *do*
>> work in the expected way (something I perhaps ought to have
>> mentioned).
>>
>>
>>> On Wednesday, March 5, 2014, Michael Bridgen <mikeb at squaremobius.net> wrote:
>>>>
>>>> This documentation http://www.rabbitmq.com/relocate.html implies that
>>>> running, e.g.,
>>>> $ RABBITMQ_BASE=`pwd` rabbitmq-server &
>>>> will instruct RabbitMQ to put its database and log files in the
>>>> current directory. But when I do this, RabbitMQ just puts its log
>>>> files where it normally does.
>>>>
>>>> It's a (recent) homebrew install, so perhaps the formula is doing
>>>> something tricksy.
>>>>
>>>> -Michael
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Punit.Jain at emc.com  Thu Mar  6 13:59:31 2014
From: Punit.Jain at emc.com (Jain, Punit)
Date: Thu, 6 Mar 2014 08:59:31 -0500
Subject: [rabbitmq-discuss] Stopping rabbitmq-server: FAILED
In-Reply-To: <CALsYvrzQo_jwas3C5Jgp0qDLGUD7J+OXw6R7G54cHoufZMtN5Q@mail.gmail.com>
References: <DB14E94115BBC84E8960C12C176D0676017A274F95@MX25A.corp.emc.com>
 <CALsYvrzQo_jwas3C5Jgp0qDLGUD7J+OXw6R7G54cHoufZMtN5Q@mail.gmail.com>
Message-ID: <DB14E94115BBC84E8960C12C176D06760231517188@MX25A.corp.emc.com>

In this case "service rabbitmq-server stop" failed with the exit status 2, but, in actual, rabbitmq-server was stopped fine. I verified it by checking processes and the broker's status. "rabbitmq-server stop" is a part of an RPM scriptlet, which does the configuration for RabbitMQ, and it failed due to this error during an upgrade.

Could you please explain the meaning of the return code '2'? We are planning to put a mitigation to avoid some of these types of errors. Also, is there any other return code we should check? It would be best if we could know all the possible return code and their meaning.

Thanks,
Punit

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Christian Rohling
Sent: Sunday, February 16, 2014 4:07 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Stopping rabbitmq-server: FAILED

I think the most likely cause of this is not having permissions for the rabbitmq process in the directory it wants to read/write it's PID to.

-Christian

On Sat, Feb 15, 2014 at 10:27 AM, Jain, Punit <Punit.Jain at emc.com<mailto:Punit.Jain at emc.com>> wrote:
Hi All,
I am using RabbitMQ version 3.1.3 on SuSE. I got following error while trying to stop rabbitmq-server:
Stopping rabbitmq-server: FAILED - check /var/log/rabbitmq/shutdown_log, _err

/var/log/rabbitmq/shutdown_err:
Error: {'EXIT',{error,{could_not_read_pid,{error,enoent}}}}

What could be the reason for this?

Thanks,
Punit

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/c660c341/attachment.html>

From Rohit.Patle at techmahindra.com  Thu Mar  6 13:59:08 2014
From: Rohit.Patle at techmahindra.com (Rohit Patle)
Date: Thu, 6 Mar 2014 13:59:08 +0000
Subject: [rabbitmq-discuss] [rabbitmq-c] minimal network bandwidth
	requirement to API execute
Message-ID: <27E054594442884E9A46DBCF9AE74081651486@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

Request you to please spread some light on my earlier mail.

In continuation to our observation, It looks like the sequence on API's for SSL connection establishment is blocking. Could you please let us know what is the duration of time it hangs for? Also while amqp_login fail the API return "AMQP_RESPONSE_LIBRARY_EXCEPTION". Here I would like to know is this the case of segmentation fault/violation in library?


Regards,
Rohit





________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/1c18a938/attachment.html>

From pat at munkiisoft.com  Thu Mar  6 14:45:10 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Thu, 6 Mar 2014 14:45:10 +0000
Subject: [rabbitmq-discuss] Unknown delivery tag 1
Message-ID: <CALDntb9iPU+fUOZggCzMYtnQAJPEi=qFFeQ0DD5kSSZ97Q3PDg@mail.gmail.com>

I am seeing this error from time to time,

connection <0.11943.63>, channel 2 - soft error:
{amqp_error,precondition_failed,"unknown delivery tag 1",'basic.ack'}

I know that we have to execute BasicAck against the same channel  that did
the BasicGet and we are fairly comfortable that is what we are doing.

Are there other reasons for seeing this error ?

Pat

-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/801e8106/attachment.html>

From simon at rabbitmq.com  Thu Mar  6 14:47:07 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Mar 2014 14:47:07 +0000
Subject: [rabbitmq-discuss] Unknown delivery tag 1
In-Reply-To: <CALDntb9iPU+fUOZggCzMYtnQAJPEi=qFFeQ0DD5kSSZ97Q3PDg@mail.gmail.com>
References: <CALDntb9iPU+fUOZggCzMYtnQAJPEi=qFFeQ0DD5kSSZ97Q3PDg@mail.gmail.com>
Message-ID: <53188A6B.90406@rabbitmq.com>

On 06/03/14 14:45, Patrick Long wrote:
> Are there other reasons for seeing this error ?

By far the most common reason for this error is acking the same message 
twice.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From akmartin at gmail.com  Thu Mar  6 14:55:28 2014
From: akmartin at gmail.com (Andy Martin)
Date: Thu, 6 Mar 2014 06:55:28 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
Message-ID: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>

I have a two-node autoheal cluster. Yesterday I came in to find out that 
neither server in the cluster was seeing the other, but there was no 
message about a partition having occurred. Today I came in to find one of 
the servers down. I can't find anything in the logs that would indicate why 
this is happening. What should I be looking for in the logs?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/70818a83/attachment.html>

From mcintoshj at gmail.com  Thu Mar  6 14:59:17 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 6 Mar 2014 08:59:17 -0600
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
 <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>
Message-ID: <CAD6m6fHd_OEmCrh596ZcoBfsm7x44UMZgxY3JXBmicP-dFB-Eg@mail.gmail.com>

Hrmm, at that point would an upgrade/rebuild of erlang fix it?

Jason


On Thu, Mar 6, 2014 at 1:38 AM, Jerry Kuch <jkuch at gopivotal.com> wrote:

> This is off the top of my head, but I have a vaguely recalled fear that
> for many Windows apps the limitation on file descriptors ends up coming not
> from the Windows OS, but from the msvcrt library which had some asinine per
> process limit of something like 1024 or 2048, without, IIRC, any humane way
> to work around it.
>
> I could be misremembering, or the situation may have improved since this
> was the case.
>
>
>
> On Wed, Mar 5, 2014 at 11:29 PM, chetan dev <dev440 at gmail.com> wrote:
>
>> Hi,
>>
>> Thanks for those links, but i am using windows and i didn't find relevant
>> information about windows socket descriptor limits.
>>
>> Thanks
>>
>> On Thu, Mar 6, 2014 at 11:38 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>
>>> On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:
>>>
>>> > How can I increase the maximum limit of socket descriptors available
>>> for
>>> > rabbitmq ?
>>>
>>> See Changing the limit in [1] or [2].
>>>
>>> 1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/<https://urldefense.proofpoint.com/v1/url?u=http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=16bdcc6e20b751f4b1e337528f30540d59309c416ef3f2af3187fd7da77cfefe>
>>> 2.
>>> http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux<https://urldefense.proofpoint.com/v1/url?u=http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=07ba0fcb7a1d0b741b91fa1343456add53a3d7399ae5d42a77f851de23478513>
>>>
>>>
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3>
>>>
>>
>>
>>
>> --
>> Cheten  Dev
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>>
>> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/6807d862/attachment.html>

From cwstorm at gmail.com  Thu Mar  6 14:59:24 2014
From: cwstorm at gmail.com (cw storm)
Date: Thu, 6 Mar 2014 09:59:24 -0500
Subject: [rabbitmq-discuss] Unknown delivery tag 1
In-Reply-To: <53188A6B.90406@rabbitmq.com>
References: <CALDntb9iPU+fUOZggCzMYtnQAJPEi=qFFeQ0DD5kSSZ97Q3PDg@mail.gmail.com>
 <53188A6B.90406@rabbitmq.com>
Message-ID: <CAETr1H_Jr=5ZMtdTDp=O8T9JFL4SqdkJKEK8Q67U88AG7CGO9g@mail.gmail.com>

Patrick,

I'm all too familiar with this error.  At least for me, it was my java
client code.  What happen was that the consumer subscription service was
ack on the wrong channel.  You must be sure that each consumer subscription
is on its own thread and that your source code is not being overridden from
another subscription initalization.  For me, whatever was the last consumer
subscription service being register was being use by all.


On Thu, Mar 6, 2014 at 9:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/03/14 14:45, Patrick Long wrote:
>
>> Are there other reasons for seeing this error ?
>>
>
> By far the most common reason for this error is acking the same message
> twice.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/aad0451f/attachment.html>

From akmartin at gmail.com  Thu Mar  6 15:04:14 2014
From: akmartin at gmail.com (Andy Martin)
Date: Thu, 6 Mar 2014 07:04:14 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
In-Reply-To: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>
References: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>
Message-ID: <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>

=ERROR REPORT==== 6-Mar-2014::09:59:33 ===
** Generic server <0.298.0> terminating
** Last message in was pre_hibernate
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,
                          
 <<"SUBSCRIBER_PACE_PORTFOLIO_BOSAPPDEVSMC001_7E6F5793-2230-4704-9B63-CCEAF4FC5F38">>},
                          false,false,none,
                          [{<<"x-expires">>,signedint,600000}],
                          <0.298.0>,[],[],
                          [{vhost,<<"/">>},
                           {name,<<"HA">>},
                           {pattern,<<"^SUBSCRIBER_">>},
                           {'apply-to',<<"queues">>},
                           {definition,
                            [{<<"ha-mode">>,<<"all">>},
                             {<<"ha-sync-mode">>,<<"automatic">>}]},
                           {priority,0}],
                          [{<0.299.0>,<0.298.0>}],
                          []},
                         none,true,rabbit_mirror_queue_master,
                         {state,
                          {resource,<<"/">>,queue,
                          
 <<"SUBSCRIBER_PACE_PORTFOLIO_BOSAPPDEVSMC001_7E6F5793-2230-4704-9B63-CCEAF4FC5F38">>},
                          <0.299.0>,<0.19972.36>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           381,
                           {0,nil},
                           {0,nil},
                           {qistate,
                            
"c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/queues/6WOGOU8HI3AF43KE7Y8YAHG2G",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,65536,
                            #Fun<rabbit_variable_queue.2.81334491>,
                            {0,nil}},
                           {undefined,
                            {client_msstate,msg_store_transient,
                             <<215,212,149,239,187,145,76,128,128,7,227,249,
                               174,103,162,200>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,294982,
                              
"c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                            
 "c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/msg_store_transient",
                             <0.241.0>,299079,290885,303176,307273}},
                           false,0,0,0,infinity,0,0,0,0,0,
                           {rates,
                            {{1394,98997,711100},0},
                            {{1394,98997,711100},0},
                            0.0,0.0,
                            {1394,117373,529281}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1394,98997,711100},0},
                            {{1394,98997,711100},0},
                            0.0,0.0,
                            {1394,117373,529281}}},
                          {dict,0,16,16,8,80,48,
                          
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {set,0,16,16,8,80,48,
                          
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {queue,
                          [{<0.19777.36>,
                            {consumer,<<"amq.ctag-k8a2E1BDwyCVG2ncSPsbnA">>,
                             true,[]}}],
                          [],1},
                         600000,undefined,#Ref<0.0.31.217038>,undefined,
                         {state,fine,5000,#Ref<0.0.31.217039>},
                         {0,nil},
                         undefined,undefined,undefined,
                         {state,
                          {dict,0,16,16,8,80,48,
                          
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          delegate},
                         undefined,undefined,undefined,3,running}
** Reason for termination == 
** {{badmatch,{error,not_found}},
    [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
     {rabbit_mirror_queue_master,delete_and_terminate,2,[]},
     {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
     {rabbit_amqqueue_process,terminate_shutdown,2,[]},
     {gen_server2,terminate,3,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
** In 'terminate' callback with reason ==
** {{badmatch,{error,not_found}},
    [{rabbit_amqqueue_process,i,2,[]},
     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
     {rabbit_amqqueue_process,emit_stats,2,[]},
     {rabbit_event,if_enabled,3,[]},
     {rabbit_amqqueue_process,handle_pre_hibernate,1,[]},
     {gen_server2,pre_hibernate,1,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]


On Thursday, March 6, 2014 9:55:28 AM UTC-5, Andy Martin wrote:
>
> I have a two-node autoheal cluster. Yesterday I came in to find out that 
> neither server in the cluster was seeing the other, but there was no 
> message about a partition having occurred. Today I came in to find one of 
> the servers down. I can't find anything in the logs that would indicate why 
> this is happening. What should I be looking for in the logs?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/d795b773/attachment.html>

From simon at rabbitmq.com  Thu Mar  6 15:05:44 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Mar 2014 15:05:44 +0000
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
Message-ID: <53188EC8.1040004@rabbitmq.com>

On 06/03/14 07:29, chetan dev wrote:
> Thanks for those links, but i am using windows and i didn't find
> relevant information about windows socket descriptor limits.

Windows doesn't really have a limit. Therefore Erlang enforces one. You 
can increase it by setting the environment variable ERL_MAX_PORTS.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From akmartin at gmail.com  Thu Mar  6 15:06:18 2014
From: akmartin at gmail.com (Andy Martin)
Date: Thu, 6 Mar 2014 07:06:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
In-Reply-To: <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>
References: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>
 <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>
Message-ID: <ac6d9ada-c6de-4230-bad5-35c79f0b0f0e@googlegroups.com>

[{rabbit, [{vm_memory_high_watermark, 0.8}, {cluster_partition_handling , 
autoheal}]}].


On Thursday, March 6, 2014 10:04:14 AM UTC-5, Andy Martin wrote:
>
> =ERROR REPORT==== 6-Mar-2014::09:59:33 ===
> ** Generic server <0.298.0> terminating
> ** Last message in was pre_hibernate
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,
>                           
>  <<"SUBSCRIBER_PACE_PORTFOLIO_BOSAPPDEVSMC001_7E6F5793-2230-4704-9B63-CCEAF4FC5F38">>},
>                           false,false,none,
>                           [{<<"x-expires">>,signedint,600000}],
>                           <0.298.0>,[],[],
>                           [{vhost,<<"/">>},
>                            {name,<<"HA">>},
>                            {pattern,<<"^SUBSCRIBER_">>},
>                            {'apply-to',<<"queues">>},
>                            {definition,
>                             [{<<"ha-mode">>,<<"all">>},
>                              {<<"ha-sync-mode">>,<<"automatic">>}]},
>                            {priority,0}],
>                           [{<0.299.0>,<0.298.0>}],
>                           []},
>                          none,true,rabbit_mirror_queue_master,
>                          {state,
>                           {resource,<<"/">>,queue,
>                           
>  <<"SUBSCRIBER_PACE_PORTFOLIO_BOSAPPDEVSMC001_7E6F5793-2230-4704-9B63-CCEAF4FC5F38">>},
>                           <0.299.0>,<0.19972.36>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            381,
>                            {0,nil},
>                            {0,nil},
>                            {qistate,
>                             
> "c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/queues/6WOGOU8HI3AF43KE7Y8YAHG2G",
>                             {{dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,65536,
>                             #Fun<rabbit_variable_queue.2.81334491>,
>                             {0,nil}},
>                            {undefined,
>                             {client_msstate,msg_store_transient,
>                             
>  <<215,212,149,239,187,145,76,128,128,7,227,249,
>                                174,103,162,200>>,
>                              {dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,294982,
>                               
> "c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>                             
>  "c:/Users/admin-amartin/AppData/Roaming/RabbitMQ/db/rabbit at MARRISDEVFAB201-mnesia/msg_store_transient",
>                              <0.241.0>,299079,290885,303176,307273}},
>                            false,0,0,0,infinity,0,0,0,0,0,
>                            {rates,
>                             {{1394,98997,711100},0},
>                             {{1394,98997,711100},0},
>                             0.0,0.0,
>                             {1394,117373,529281}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1394,98997,711100},0},
>                             {{1394,98997,711100},0},
>                             0.0,0.0,
>                             {1394,117373,529281}}},
>                           {dict,0,16,16,8,80,48,
>                           
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           [],
>                           {set,0,16,16,8,80,48,
>                           
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {queue,
>                           [{<0.19777.36>,
>                             
> {consumer,<<"amq.ctag-k8a2E1BDwyCVG2ncSPsbnA">>,
>                              true,[]}}],
>                           [],1},
>                          600000,undefined,#Ref<0.0.31.217038>,undefined,
>                          {state,fine,5000,#Ref<0.0.31.217039>},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {state,
>                           {dict,0,16,16,8,80,48,
>                           
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           delegate},
>                          undefined,undefined,undefined,3,running}
> ** Reason for termination == 
> ** {{badmatch,{error,not_found}},
>     [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
>      {rabbit_mirror_queue_master,delete_and_terminate,2,[]},
>      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
>      {rabbit_amqqueue_process,terminate_shutdown,2,[]},
>      {gen_server2,terminate,3,[]},
>      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
> ** In 'terminate' callback with reason ==
> ** {{badmatch,{error,not_found}},
>     [{rabbit_amqqueue_process,i,2,[]},
>      {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>      {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>      {rabbit_amqqueue_process,emit_stats,2,[]},
>      {rabbit_event,if_enabled,3,[]},
>      {rabbit_amqqueue_process,handle_pre_hibernate,1,[]},
>      {gen_server2,pre_hibernate,1,[]},
>      {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]
>
>
> On Thursday, March 6, 2014 9:55:28 AM UTC-5, Andy Martin wrote:
>>
>> I have a two-node autoheal cluster. Yesterday I came in to find out that 
>> neither server in the cluster was seeing the other, but there was no 
>> message about a partition having occurred. Today I came in to find one of 
>> the servers down. I can't find anything in the logs that would indicate why 
>> this is happening. What should I be looking for in the logs?
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/70d98356/attachment.html>

From simon at rabbitmq.com  Thu Mar  6 15:19:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Mar 2014 15:19:30 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
In-Reply-To: <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>
References: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>
 <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>
Message-ID: <53189202.4030400@rabbitmq.com>

On 06/03/14 15:04, Andy Martin wrote:
> ** {{badmatch,{error,not_found}},
>      [{rabbit_amqqueue_process,i,2,[]},
>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>       {rabbit_amqqueue_process,emit_stats,2,[]},

That's the exact stack trace of a bug we fixed in 3.2.1. Are you 
completely sure that both nodes are running 3.2.2?

> I have a two-node autoheal cluster. Yesterday I came in to find out
> that neither server in the cluster was seeing the other, but there
> was no message about a partition having occurred.

You will only be notified about the partition once the servers can see 
each other again - until that happens, A thinks B is down, and B thinks 
A is down; they have no way to know it's a partition.

> Today I came in to
> find one of the servers down. I can't find anything in the logs that
> would indicate why this is happening. What should I be looking for in
> the logs?

"Down" as in the Erlang VM had exited, or "down" as in the Erlang VM was 
still running but the RabbitMQ application had stopped?

If the former, then it can't be anything to do with autoheal since that 
doesn't attempt to stop the node completely. You might want to look for 
"Halting Erlang VM" in the logs; that would imply the broker was shut 
down deliberately. If that's not there then please post the logs 
somewhere with an indication of when you became aware the server was down.

If the latter, it's possible that you ran into one of the bugs we fixed 
in 3.2.4, where an attempt at autoheal can get stuck. There should still 
be messages about autoheal in the logs in that case though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From akmartin at gmail.com  Thu Mar  6 15:47:12 2014
From: akmartin at gmail.com (Andy Martin)
Date: Thu, 6 Mar 2014 10:47:12 -0500
Subject: [rabbitmq-discuss] RabbitMQ 3.2.2 cluster shutting down
In-Reply-To: <53189202.4030400@rabbitmq.com>
References: <f9e2ef3b-f5af-4456-926e-e8d3ad09a37e@googlegroups.com>
 <e9ac8082-14aa-4211-bf2e-09c85879bc9d@googlegroups.com>
 <53189202.4030400@rabbitmq.com>
Message-ID: <CAKRHTke3kCzOJ_jGFAbSomT=hK7wtAPv6svKTSebp6eiPN3zGA@mail.gmail.com>

Thanks for your quick response.

"Down" as in the Erlang VM had exited, or "down" as in the Erlang VM was
> still running but the RabbitMQ application had stopped?


That's a good question. I didn't even check. I only looked at it from
Windows services and restarted from there.  But both nodes are definitely
running 3.2.2.

I don't see anything about autoheal in the logs. The first log I sent was
from the node that went down, right at the time I lost connection to that
node. This is from the other node in the cluster. So a partition definitely
occurred, but there's nothing about autohealing. Maybe I should upgrade to
3.2.4 and see if it happens again?


=ERROR REPORT==== 6-Mar-2014::09:49:24 ===
AMQP connection <0.63.92> (running), channel 0 - error:
{amqp_error,connection_forced,
            "broker forced connection closure with reason 'shutdown'",none}

=INFO REPORT==== 6-Mar-2014::09:49:24 ===
Halting Erlang VM

=ERROR REPORT==== 6-Mar-2014::09:49:30 ===
Mnesia(rabbit at BOSRISDEVFAB201): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, rabbit at MARRISDEVFAB201
}


Thanks,
Andy


On Thu, Mar 6, 2014 at 10:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/03/14 15:04, Andy Martin wrote:
>
>> ** {{badmatch,{error,not_found}},
>>      [{rabbit_amqqueue_process,i,2,[]},
>>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>>       {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},
>>       {rabbit_amqqueue_process,emit_stats,2,[]},
>>
>
> That's the exact stack trace of a bug we fixed in 3.2.1. Are you
> completely sure that both nodes are running 3.2.2?
>
>  I have a two-node autoheal cluster. Yesterday I came in to find out
>> that neither server in the cluster was seeing the other, but there
>> was no message about a partition having occurred.
>>
>
> You will only be notified about the partition once the servers can see
> each other again - until that happens, A thinks B is down, and B thinks A
> is down; they have no way to know it's a partition.
>
>  Today I came in to
>> find one of the servers down. I can't find anything in the logs that
>> would indicate why this is happening. What should I be looking for in
>> the logs?
>>
>
> "Down" as in the Erlang VM had exited, or "down" as in the Erlang VM was
> still running but the RabbitMQ application had stopped?
>
> If the former, then it can't be anything to do with autoheal since that
> doesn't attempt to stop the node completely. You might want to look for
> "Halting Erlang VM" in the logs; that would imply the broker was shut down
> deliberately. If that's not there then please post the logs somewhere with
> an indication of when you became aware the server was down.
>
> If the latter, it's possible that you ran into one of the bugs we fixed in
> 3.2.4, where an attempt at autoheal can get stuck. There should still be
> messages about autoheal in the logs in that case though.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/35687f35/attachment.html>

From ron.cordell at gmail.com  Thu Mar  6 16:49:06 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Thu, 6 Mar 2014 08:49:06 -0800
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CAD6m6fHd_OEmCrh596ZcoBfsm7x44UMZgxY3JXBmicP-dFB-Eg@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
 <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>
 <CAD6m6fHd_OEmCrh596ZcoBfsm7x44UMZgxY3JXBmicP-dFB-Eg@mail.gmail.com>
Message-ID: <37FBD842-13CE-4115-B007-586413EEB5D8@gmail.com>

Doesn't the erlang parameter environment variable +Q 65536 set the socket descriptor limit? I'm not at a place I can look, that's what we use on windows to increase that. 

Sent from my iPhone

> On Mar 6, 2014, at 6:59 AM, Jason McIntosh <mcintoshj at gmail.com> wrote:
> 
> Hrmm, at that point would an upgrade/rebuild of erlang fix it?  
> 
> Jason
> 
> 
>> On Thu, Mar 6, 2014 at 1:38 AM, Jerry Kuch <jkuch at gopivotal.com> wrote:
>> This is off the top of my head, but I have a vaguely recalled fear that for many Windows apps the limitation on file descriptors ends up coming not from the Windows OS, but from the msvcrt library which had some asinine per process limit of something like 1024 or 2048, without, IIRC, any humane way to work around it.
>> 
>> I could be misremembering, or the situation may have improved since this was the case.
>> 
>> 
>> 
>>> On Wed, Mar 5, 2014 at 11:29 PM, chetan dev <dev440 at gmail.com> wrote:
>>> Hi,
>>> 
>>> Thanks for those links, but i am using windows and i didn't find relevant information about windows socket descriptor limits.
>>> 
>>> Thanks
>>> 
>>>> On Thu, Mar 6, 2014 at 11:38 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
>>>> On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:
>>>> 
>>>> > How can I increase the maximum limit of socket descriptors available for
>>>> > rabbitmq ?
>>>> 
>>>> See Changing the limit in [1] or [2].
>>>> 
>>>> 1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/
>>>> 2. http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux
>>>> 
>>>> 
>>>> MK
>>>> 
>>>> Software Engineer, Pivotal/RabbitMQ
>>>> 
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>>> 
>>> -- 
>>> Cheten  Dev 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> -- 
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/af660c32/attachment.html>

From ron.cordell at gmail.com  Thu Mar  6 17:41:22 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Thu, 6 Mar 2014 09:41:22 -0800
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <37FBD842-13CE-4115-B007-586413EEB5D8@gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
 <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>
 <CAD6m6fHd_OEmCrh596ZcoBfsm7x44UMZgxY3JXBmicP-dFB-Eg@mail.gmail.com>
 <37FBD842-13CE-4115-B007-586413EEB5D8@gmail.com>
Message-ID: <CAFtA53z+ujyd6TcwFm3r0cy9Xn=E5_zTxn3-ZYztp91o4J7OYQ@mail.gmail.com>

Sorry about that - I was thinking file descriptors
(RABBITMQ_SERVER_ERL_ARGS=+Q 65536), not socket descriptors.

Cheers,

-ronc


On Thu, Mar 6, 2014 at 8:49 AM, Ron Cordell <ron.cordell at gmail.com> wrote:

> Doesn't the erlang parameter environment variable +Q 65536 set the socket
> descriptor limit? I'm not at a place I can look, that's what we use on
> windows to increase that.
>
> Sent from my iPhone
>
> On Mar 6, 2014, at 6:59 AM, Jason McIntosh <mcintoshj at gmail.com> wrote:
>
> Hrmm, at that point would an upgrade/rebuild of erlang fix it?
>
> Jason
>
>
> On Thu, Mar 6, 2014 at 1:38 AM, Jerry Kuch <jkuch at gopivotal.com> wrote:
>
>> This is off the top of my head, but I have a vaguely recalled fear that
>> for many Windows apps the limitation on file descriptors ends up coming not
>> from the Windows OS, but from the msvcrt library which had some asinine per
>> process limit of something like 1024 or 2048, without, IIRC, any humane way
>> to work around it.
>>
>> I could be misremembering, or the situation may have improved since this
>> was the case.
>>
>>
>>
>> On Wed, Mar 5, 2014 at 11:29 PM, chetan dev <dev440 at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> Thanks for those links, but i am using windows and i didn't find
>>> relevant information about windows socket descriptor limits.
>>>
>>> Thanks
>>>
>>> On Thu, Mar 6, 2014 at 11:38 AM, Michael Klishin <mklishin at gopivotal.com
>>> > wrote:
>>>
>>>> On 6 Mar 2014, at 09:58, chetan dev <dev440 at gmail.com> wrote:
>>>>
>>>> > How can I increase the maximum limit of socket descriptors available
>>>> for
>>>> > rabbitmq ?
>>>>
>>>> See Changing the limit in [1] or [2].
>>>>
>>>> 1. http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/<https://urldefense.proofpoint.com/v1/url?u=http://docs.basho.com/riak/latest/ops/tuning/open-files-limit/&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=16bdcc6e20b751f4b1e337528f30540d59309c416ef3f2af3187fd7da77cfefe>
>>>> 2.
>>>> http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux<https://urldefense.proofpoint.com/v1/url?u=http://stackoverflow.com/questions/34588/how-do-i-change-the-number-of-open-files-limit-in-linux&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=07ba0fcb7a1d0b741b91fa1343456add53a3d7399ae5d42a77f851de23478513>
>>>>
>>>>
>>>> MK
>>>>
>>>> Software Engineer, Pivotal/RabbitMQ
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3>
>>>>
>>>
>>>
>>>
>>> --
>>> Cheten  Dev
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>>
>>> https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&m=QyQvdU3km%2BSRWG3AwJCxz0Cwwr53KqnRT5QDQWjc0Kw%3D%0A&s=ed266cd8de18ad3d4d5f51c7e512a13b6c8ba613dcc2c9e315891306a6fd5ad3
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/f8b39234/attachment.html>

From sami.taj.omer at gmail.com  Fri Mar  7 00:44:52 2014
From: sami.taj.omer at gmail.com (xenogears)
Date: Thu, 6 Mar 2014 16:44:52 -0800 (PST)
Subject: [rabbitmq-discuss] Retrieving messages asynchronously through
	callbacks
In-Reply-To: <66666394-2C4C-445F-AE6E-3206424C23AC@rabbitmq.com>
References: <1393881327662-33829.post@n5.nabble.com>
 <66666394-2C4C-445F-AE6E-3206424C23AC@rabbitmq.com>
Message-ID: <1394153092085-33897.post@n5.nabble.com>

Thanks!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Retrieving-messages-asynchronously-through-callbacks-tp33829p33897.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bill_huang at trend.com.tw  Fri Mar  7 04:02:40 2014
From: bill_huang at trend.com.tw (Bill_Huang)
Date: Thu, 6 Mar 2014 20:02:40 -0800 (PST)
Subject: [rabbitmq-discuss] Queued messages chart History
In-Reply-To: <528F3423.5090005@rabbitmq.com>
References: <5546970e-fc81-4206-b810-e09422ec0db0@googlegroups.com>
 <528F3423.5090005@rabbitmq.com>
Message-ID: <1394164960515-33898.post@n5.nabble.com>

Hello,
Following the topic, I would like to know how to monitor the history more
than "Last Day".

I have add this for "Last Week" but there is no such UI can be selected:
[
  {rabbitmq_management, [{sample_retention_policies,
                          [{global,   [{60, 5}, {3600, 60}, {86400, 1200},
{604800, 3600}]},
                           {basic,    [{60, 5}, {3600, 60}, {86400, 1200},
{604800, 3600}]},
                           {detailed, [{60, 5}, {3600, 60}, {86400, 1200},
{604800, 3600}]}]}
                        ]}
].

Then, I try to use "rabbitmqadmin" in command line but does not know how to
get the history data after several trying.

Does anyone solve this or can provide me any suggestion?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queued-messages-chart-History-tp31561p33898.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From monish.unni at gmail.com  Fri Mar  7 07:00:52 2014
From: monish.unni at gmail.com (cogitate)
Date: Thu, 6 Mar 2014 23:00:52 -0800 (PST)
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
Message-ID: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>

hi Mathias R et al:
  i have a rabbitmq broker setup behind a load-balancer. for reply-queues 
from the client, i use exclusive and auto-delete queues. these reply-queues 
are created when the webapp is booted. they are held in a pool of 
clients(threads) that maybe borrowed by any publisher to wait for replies 
to simulate RPC semantics. once done with the call the client is returned 
back to the pool, which again maybe used by some other publisher.

once in a while, the auto-delete and exclusive reply-queue is deleted. 
there are no errors in rabbitmq broker except a WARNING REPORT that has 
high correlation to the time when the queue disappeared 

=WARNING REPORT==== 6-Mar-2014::15:35:33 ===
closing AMQP connection <0.13020.5> (load_balancer_ip:21303 -> broker_ip:5672):
connection_closed_abruptly
it seems this maybe just a "liveness" check from load_balancer, because i find lots of these in the logs.


is it possible at all that auto-delete, exclusive reply-queues can get 
swept by load-balancer closing  tcp connection with following amqp shutdown?

thank you for your attention,
-cogitate

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/54c026ae/attachment.html>

From alan.antonuk at gmail.com  Fri Mar  7 07:50:45 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 6 Mar 2014 23:50:45 -0800
Subject: [rabbitmq-discuss] [rabbitmq-c] minimal network bandwidth
 requirement to API execute
In-Reply-To: <27E054594442884E9A46DBCF9AE7408165139E@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE7408165139E@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJbrPDaQ2kNudXDS4T89SezpjWXf+dn-9RXcm92MpchBA@mail.gmail.com>

On Wed, Mar 5, 2014 at 6:03 AM, Rohit Patle <Rohit.Patle at techmahindra.com>wrote:

>  Hi Alan,
>
> I am producing this latency by using tc (transmission control) tool in
> Ubuntu. In this case the API amqp_login is getting failed to execute with
> exception at listener. Here I would like to know that what is the Signal
> that library is producing in such case?
>

I'm not sure what you mean by 'exception' here? The possible return values
from amqp_login are documented here:
https://github.com/alanxz/rabbitmq-c/blob/b7c3f97acf25cd0e8644be46f0a9a5f7ece2e33d/librabbitmq/amqp.h#L1705,
amqp exceptions are covered in the documentation . FYI: the library does
not explicitly use unix signals.

>
> As you suggested We tried to close the socket connection in case of
> rabbitmq-server is down, But while doing this the amqp_connection_close()
> API gets failed to execute with exception and returns some Signal to kernel
> from library.
>
> Can you please let me know what is the Signal that library is producing in
> this kind scenarios?
>

Again - I'm not sure what you mean by signal. Could you clarify what you're
trying to ask here?

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/7071d5b2/attachment.html>

From alan.antonuk at gmail.com  Fri Mar  7 08:00:15 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 7 Mar 2014 00:00:15 -0800
Subject: [rabbitmq-discuss] [rabbitmq-c] minimal network bandwidth
 requirement to API execute
In-Reply-To: <27E054594442884E9A46DBCF9AE74081651486@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081651486@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJpYEsgniQ=smo2Dfxn8h7HLPu1jUye3XujoOoSHDQ1AQ@mail.gmail.com>

On Thu, Mar 6, 2014 at 5:59 AM, Rohit Patle <Rohit.Patle at techmahindra.com>wrote:
>
>
> In continuation to our observation, It looks like the sequence on API's
> for SSL connection establishment is blocking. Could you please let us know
> what is the duration of time it hangs for?
>

By connection establishment I assume you mean amqp_socket_open() on a
socket you create with amqp_ssl_socket_new() ? The timeout for opening a
TCP/IP socket to the broker is dependent on your operating-system (you'd
need to look at the documentation for what the timeout is for opening a
tcp/ip socket). The OpenSSL layer operates on top of this TCP/IP socket,
and a certain amount of reading and writing to the socket must occur after
the socket is opened for the TLS socket is considered open - each of these
operations has a timeout associated with it.

Short answer: I cannot give you a good answer for this.

Also while amqp_login fail the API return
> "AMQP_RESPONSE_LIBRARY_EXCEPTION". Here I would like to know is this the
> case of segmentation fault/violation in library?
>

If the amqp_login() function returns an AMQP_RESPONSE_LIBRARY_EXCEPTION,
this does not mean that a segmentation fault has occurred in the library.
It usually means that some other error has occurred and that you should
check the library_error member of the amqp_rpc_reply_t struct and compare
it against the values in amqp_status_enum to determine what went wrong.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/1e9e1d77/attachment.html>

From mklishin at gopivotal.com  Fri Mar  7 08:28:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 7 Mar 2014 12:28:51 +0400
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
Message-ID: <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>


On 7 Mar 2014, at 11:00, cogitate <monish.unni at gmail.com> wrote:

> is it possible at all that auto-delete, exclusive reply-queues can get swept by load-balancer closing  tcp connection with following amqp shutdown?

An exclusive queue is deleted when the connection that declared it
is closed (or lost).

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Fri Mar  7 11:19:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 11:19:28 +0000
Subject: [rabbitmq-discuss] Queued messages chart History
In-Reply-To: <1394164960515-33898.post@n5.nabble.com>
References: <5546970e-fc81-4206-b810-e09422ec0db0@googlegroups.com>
 <528F3423.5090005@rabbitmq.com> <1394164960515-33898.post@n5.nabble.com>
Message-ID: <5319AB40.50603@rabbitmq.com>

On 07/03/2014 4:02AM, Bill_Huang wrote:
> Hello,
> Following the topic, I would like to know how to monitor the history more
> than "Last Day".
>
> I have add this for "Last Week" but there is no such UI can be selected:

Yeah, I'm afraid that configuration item only controls what the database 
stores and hence the HTTP API will return. The web UI is hard coded at 
the moment.

If you are prepared to patch it, you could look at the variable 
CHART_PERIODS in priv/www/js/global.js in the rabbitmq-management source 
code. If you don't want to set up a development environment to build the 
plugin from scratch then you can just find the management plugin .ez 
file, unpack it (it's a zip), edit that file and repack it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar  7 11:22:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 11:22:37 +0000
Subject: [rabbitmq-discuss] RABBITMQ_BASE
In-Reply-To: <CAMZ8XCjwYWBREXeOnqnPzAs1793wRDoxC=eeGR36XpoFByn79g@mail.gmail.com>
References: <CAMZ8XCj+0H+Pz+xehPB0=V=J+52hSnjgGkiM47w-sjzjuzsFOg@mail.gmail.com>
 <CAMcAHLX1CiHsrS_=yfTOcbNuqPVbN7pDmot5ev6HCUAW7r5h5Q@mail.gmail.com>
 <CAMZ8XCi_nPyo5qLvOh23wtfOTALpKMurQgGjXt5mniozrzsOXg@mail.gmail.com>
 <CAMcAHLUeSNe2hDuXys4XPZCvoXsHs-XWRMeMQ5E0cTap=t9DWg@mail.gmail.com>
 <CAMZ8XCjwYWBREXeOnqnPzAs1793wRDoxC=eeGR36XpoFByn79g@mail.gmail.com>
Message-ID: <5319ABFD.1000701@rabbitmq.com>

On 06/03/2014 12:40PM, Michael Bridgen wrote:
> Still, I
> reckon it'd be worth either making RABBITMQ_BASE work for
> other-than-Windows, since it's rather useful; or at least marking it
> as an exception rather than the general case, in the documentation.

Yeah, no idea why it's like that. Lost in the mists of time I guess. 
Still, I've filed a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar  7 11:44:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 11:44:31 +0000
Subject: [rabbitmq-discuss] How to Increase Socket Descriptor Limit
In-Reply-To: <CAFtA53z+ujyd6TcwFm3r0cy9Xn=E5_zTxn3-ZYztp91o4J7OYQ@mail.gmail.com>
References: <CAB0ZxM6thZdfU_LvRZFE+ui_6eeiy8QFoMsRQyOVTf-bktKeCg@mail.gmail.com>
 <EA0A7EDB-106F-4DD4-951F-D7EB50D72BBB@rabbitmq.com>
 <CAB0ZxM5hO9aHxCsXsWuefGpFvPaeLWk2_6UFAy3foPNzmCcGLw@mail.gmail.com>
 <CANOx8NmB2svo+xEGY9_QG7dMLPLZdhBPfqABCccRsXBhMpayxw@mail.gmail.com>
 <CAD6m6fHd_OEmCrh596ZcoBfsm7x44UMZgxY3JXBmicP-dFB-Eg@mail.gmail.com>
 <37FBD842-13CE-4115-B007-586413EEB5D8@gmail.com>
 <CAFtA53z+ujyd6TcwFm3r0cy9Xn=E5_zTxn3-ZYztp91o4J7OYQ@mail.gmail.com>
Message-ID: <5319B11F.2010007@rabbitmq.com>

On 06/03/2014 5:41PM, Ron Cordell wrote:
> Sorry about that - I was thinking file descriptors
> (RABBITMQ_SERVER_ERL_ARGS=+Q 65536), not socket descriptors.

They are both the same thing and have the same limiting factor (on 
Windows, ERL_MAX_PORTS or +Q).

We report them separately so that you can see how many sockets you could 
open, for the number of files that are currently in use.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Fri Mar  7 11:50:48 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Mar 2014 11:50:48 +0000
Subject: [rabbitmq-discuss] Can rabbitmq broker federate to Azure
 service bus?
In-Reply-To: <531846C9.30002@rabbitmq.com>
References: <CAE09Ej9cJR0GGi_2-5V9zSwwidGWkmWfW2kSMiCbfR6cxkEzgg@mail.gmail.com>
 <531846C9.30002@rabbitmq.com>
Message-ID: <5319B298.9070700@rabbitmq.com>

On 06/03/14 09:58, Simon MacMullen wrote:
> On 05/03/14 18:12, Wei Jin wrote:
>> We need post some messages to Azure Service Bus supporting amqp1.0 and
>> figure it would be nice (in case Azure service bus is down) to post
>> messages to the local broker first and then let the broker propagate
>> messages to Azure. Is it possible with rabbitmq federation?
>
> I'm afraid not - RabbitMQ federation runs over AMQP 0-9-1.

Also note that in RabbitMQ's federation, downstreams connect to 
upstreams, so you'd actually have to get Azure to connect to RabbitMQ.

An approach that could work is to build an AMQP 1.0 mini shovel/relay; 
an agent that resides on the local broker machines, consumes messages 
from the local broker's queues, and publishes them to Azure.

Matthias.

From simon at rabbitmq.com  Fri Mar  7 15:20:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 15:20:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ Auth AMQP/Http
In-Reply-To: <1594046405.23307.1394181613501.open-xchange@app01.ox.hosteurope.de>
References: <1594046405.23307.1394181613501.open-xchange@app01.ox.hosteurope.de>
Message-ID: <5319E3C8.5040401@rabbitmq.com>

On 07/03/2014 8:40AM, Gerrit Grote wrote:
> Hi Simon,
> while searching for a way to authenticate users with RabbitMQ, I found
> you repositories at GitHub.
> The HTTP and AMQP Auth plugins seem to be good, but I personally don't
> like the HTTP approach, because I think its too much overhead and maybe
> the performance is worse with it.
> You AMQP Auth plugin has its latest commit 3 years ago... Is it sill
> working with latest versions of RabbitMQ?

I've brought it up to date just now.

Having said that, its performance may or may not be any better than the 
HTTP plugin.

> Do you know any other plugin, maybe one that queries a database to
> authenticate the users?

The LDAP plugin that ships with RabbitMQ, if LDAP counts as a database. 
That has the advantage of being rather more actively maintained.

It would certainly be possible to write a SQL based plugin. I don't 
really have time to do that right now, but (CCing the mailing list) if 
anyone is interested in writing a simple plugin, that might be an 
interesting and not too hard project.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From monish.unni at gmail.com  Fri Mar  7 15:37:06 2014
From: monish.unni at gmail.com (Monish Unni)
Date: Fri, 7 Mar 2014 07:37:06 -0800
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
 <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
Message-ID: <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>

michael i know that, yes, and the earth revolves and rotates, somehow
i know that too.

the question is specific!
when the JVM starts there are say 10 auto-delete, exclusive
reply-queues. there's traffic on it or no traffic(idle).
eitherways these 10 (AD,EX) queues hang around till the JVM dies,
because the connection is kept alive.

every once in a while i see one or 2 of them suddenly disappear. i
have never seen anything like this before.
thus the question,  is it possible that a liveness connection from a
load-balancer can coz sweeps of queues.
(shouldn't be, coz the loadbalancer uses a different connection).
but i don't know enough....




On Fri, Mar 7, 2014 at 12:28 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
>
> On 7 Mar 2014, at 11:00, cogitate <monish.unni at gmail.com> wrote:
>
>> is it possible at all that auto-delete, exclusive reply-queues can get swept by load-balancer closing  tcp connection with following amqp shutdown?
>
> An exclusive queue is deleted when the connection that declared it
> is closed (or lost).
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>



-- 
-- Sent from my toaster

From j.b.davis at accenturefederal.com  Fri Mar  7 15:53:42 2014
From: j.b.davis at accenturefederal.com (j.b.davis at accenturefederal.com)
Date: Fri, 7 Mar 2014 15:53:42 +0000
Subject: [rabbitmq-discuss] Compile error for Rabbit RPC server - RabbitMQ
	version 3.2.4
Message-ID: <73A220CB8C20B64EBE3CC8F7788EAB4119315FCF@AFSMAILMB003.us.accenturefederal.com>

I'm trying to compile the RPC server example for Java found on https://www.rabbitmq.com/tutorials/tutorial-six-java.html   (using the Netbeans IDE) and getting this error:


C:\Users\j.b.davis\Documents\NetBeansProjects\BunnyRPCserver\src\bunnyrpcserver\BunnyRPCserver.java:82: error: cannot find symbol
                BasicProperties replyProps = new BasicProperties.Builder()
  symbol:   class Builder
  location: interface BasicProperties

my source = :

/*
* To change this license header, choose License Headers in Project Properties.
* To change this template file, choose Tools | Templates
* and open the template in the editor.
*/

package bunnyrpcserver;

/**
*
* @author j.b.davis
*/

import com.rabbitmq.client.BasicProperties;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.ConsumerCancelledException;
import com.rabbitmq.client.QueueingConsumer;
import com.rabbitmq.client.ShutdownSignalException;

import java.io.IOException;

import java.util.logging.Level;
import java.util.logging.Logger;


public class BunnyRPCserver
{

    /**
     * @param args the command line arguments
     */

    private static final String RPC_QUEUE_NAME = "rpc_queue";

    public static void main(String[] args)
    {

        try
        {
            ConnectionFactory factory = new ConnectionFactory();
            factory.setHost("localhost");

            Connection connection = factory.newConnection();
            Channel channel = connection.createChannel();

            channel.queueDeclare(RPC_QUEUE_NAME, false, false, false, null);

            channel.basicQos(1);

            QueueingConsumer consumer = new QueueingConsumer(channel);
            channel.basicConsume(RPC_QUEUE_NAME, false, consumer);

            System.out.println(" [x] Awaiting RPC requests");

            while (true)
            {
                QueueingConsumer.Delivery delivery = null;

                try
                {
                    delivery = consumer.nextDelivery();
                }
                catch (InterruptedException ex)
                {
                    Logger.getLogger(BunnyRPCserver.class.getName()).log(
                        Level.SEVERE, null, ex);
                }
                catch (ShutdownSignalException ex)
                {
                    Logger.getLogger(BunnyRPCserver.class.getName()).log(
                        Level.SEVERE, null, ex);
                }
                catch (ConsumerCancelledException ex)
                {
                    Logger.getLogger(BunnyRPCserver.class.getName()).log(
                        Level.SEVERE, null, ex);
                }

                BasicProperties props = delivery.getProperties();
                BasicProperties replyProps = new BasicProperties.Builder()
                    .correlationId(props.getCorrelationId()).build();

                String message = new String(delivery.getBody());
                int n = Integer.parseInt(message);

                System.out.println(" [.] fib(" + message + ")");

                String response = null;

                try
                {
                    response = "" + fib(n);
                }
                catch (Exception ex)
                {
                    Logger.getLogger(BunnyRPCserver.class.getName()).log(
                        Level.SEVERE, null, ex);
                }

                channel.basicPublish("", props.getReplyTo(), replyProps,
                    response.getBytes());

                channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
                    false);
            }

        }
        catch (IOException ex)
        {
            Logger.getLogger(BunnyRPCserver.class.getName()).log(Level.SEVERE,
               null, ex);
        }
    }

    private static int fib(int n) throws Exception
    {

        if (n == 0)
            return (0);

        if (n == 1)
            return (1);

        return (fib(n - 1) + fib(n - 2));
    }


}


I must be doing something wrong, but what??





John Davis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/07a81960/attachment.html>

From simon at rabbitmq.com  Fri Mar  7 15:59:04 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 15:59:04 +0000
Subject: [rabbitmq-discuss] Compile error for Rabbit RPC server -
 RabbitMQ version 3.2.4
In-Reply-To: <73A220CB8C20B64EBE3CC8F7788EAB4119315FCF@AFSMAILMB003.us.accenturefederal.com>
References: <73A220CB8C20B64EBE3CC8F7788EAB4119315FCF@AFSMAILMB003.us.accenturefederal.com>
Message-ID: <5319ECC8.4090405@rabbitmq.com>

On 07/03/2014 3:53PM, j.b.davis at accenturefederal.com wrote:
>                  BasicProperties replyProps = new BasicProperties.Builder()
>
>    symbol:   class Builder
>

I think you need to import com.rabbitmq.client.AMQP.BasicProperties, not 
com.rabbitmq.client.BasicProperties. ~scowls at API~

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Fri Mar  7 16:04:11 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 7 Mar 2014 20:04:11 +0400
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
 <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
 <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
Message-ID: <CAE3HoVR6L2kDK5DL8-bnY-WQR8i-nXZ9bmSZQEN_3cB8xf2zZw@mail.gmail.com>

2014-03-07 19:37 GMT+04:00 Monish Unni <monish.unni at gmail.com>:

> every once in a while i see one or 2 of them suddenly disappear. i
> have never seen anything like this before.
> thus the question,  is it possible that a liveness connection from a
> load-balancer can coz sweeps of queues.
> (shouldn't be, coz the loadbalancer uses a different connection).
>

I am not sure what "liveness connection" means but if your load balancer
decides
a TCP connection to RabbitMQ is stale and closes it, exclusive queues
declared on it
will be deleted.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/5ad629ac/attachment.html>

From dmitry.andrianov at alertme.com  Fri Mar  7 17:16:10 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Fri, 07 Mar 2014 17:16:10 +0000
Subject: [rabbitmq-discuss] OOM kill
Message-ID: <5319FEDA.4040201@alertme.com>

Hello.
We are trying to load-test RabbitMQ server in different configurations 
on Amazon EC2 node.
Most of our tests end with Linux OOM killer intervening and killing Rabbit.
That is something I cannot really understand especially given that it is 
reproducible even with vm_memory_high_watermark set to 0.2 and no other 
processes running on that box.
So if someone could shed some light onto that issue it would help a lot.

Below the status response not long before the process was killed:

  {os,{unix,linux}},
  {erlang_version,
      "Erlang R15B01 (erts-5.9.1) [source] [64-bit] [async-threads:30] 
[kernel-poll:true]\n"},
  {memory,
      [{total,1984625336},
       {connection_procs,1235761240},
       {queue_procs,142935728},
       {plugins,-44730984},
       {other_proc,34065132},
       {mnesia,32001976},
       {mgmt_db,233149752},
       {msg_index,13545296},
       {other_ets,49861192},
       {binary,148478688},
       {code,20404184},
       {atom,793505},
       {other_system,118359627}]},
  {vm_memory_high_watermark,0.2},
  {vm_memory_limit,804643635},
  {disk_free_limit,50000000},
  {disk_free,1843380224},
  {file_descriptors,
      [{total_limit,64900},
       {total_used,11681},
       {sockets_limit,58408},
       {sockets_used,11677}]},
  {processes,[{limit,1048576},{used,198557}]},
  {run_queue,6},
  {uptime,575}]

Couple of strange things there are:

1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How 
is that possible? https://www.rabbitmq.com/memory.html says that erlang 
process can take twice the configured size so I expected that but it is 
definitely more than twice.

2. {plugins,-44730984} - how this one is possible?

And just in cast it is needed, below is /proc/X/status

VmPeak:     2267580 kB
VmSize:     2110952 kB
VmLck:           0 kB
VmHWM:     2096276 kB
VmRSS:     2020848 kB
VmData:     2075168 kB
VmStk:          88 kB
VmExe:        1604 kB
VmLib:        4848 kB
VmPTE:        4304 kB
Threads:    31


Thanks in advance!






This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mcintoshj at gmail.com  Fri Mar  7 17:43:47 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 7 Mar 2014 11:43:47 -0600
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <5319FEDA.4040201@alertme.com>
References: <5319FEDA.4040201@alertme.com>
Message-ID: <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>

As I recall, the memory limit doesn't prevent rabbit from using more
memory, it's the point at which it stops accepting new connections.  It
would still allow existing connections to flood the system:
Memory-Based Flow Control

The RabbitMQ server detects the total amount of RAM installed in the
computer on startup and when rabbitmqctl set_vm_memory_high_watermark
*fraction* is executed. By default, when the RabbitMQ server uses above 40%
of the installed RAM, it raises a memory alarm and *blocks all connections.
*Once the memory alarm has cleared (e.g. due to the server paging messages
to disk or delivering them to clients) normal service resumes.


No clue about the plugins memory.
Jason


On Fri, Mar 7, 2014 at 11:16 AM, Dmitry Andrianov <
dmitry.andrianov at alertme.com> wrote:

> Hello.
> We are trying to load-test RabbitMQ server in different configurations on
> Amazon EC2 node.
> Most of our tests end with Linux OOM killer intervening and killing Rabbit.
> That is something I cannot really understand especially given that it is
> reproducible even with vm_memory_high_watermark set to 0.2 and no other
> processes running on that box.
> So if someone could shed some light onto that issue it would help a lot.
>
> Below the status response not long before the process was killed:
>
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R15B01 (erts-5.9.1) [source] [64-bit] [async-threads:30]
> [kernel-poll:true]\n"},
>  {memory,
>      [{total,1984625336},
>       {connection_procs,1235761240},
>       {queue_procs,142935728},
>       {plugins,-44730984},
>       {other_proc,34065132},
>       {mnesia,32001976},
>       {mgmt_db,233149752},
>       {msg_index,13545296},
>       {other_ets,49861192},
>       {binary,148478688},
>       {code,20404184},
>       {atom,793505},
>       {other_system,118359627}]},
>  {vm_memory_high_watermark,0.2},
>  {vm_memory_limit,804643635},
>  {disk_free_limit,50000000},
>  {disk_free,1843380224},
>  {file_descriptors,
>      [{total_limit,64900},
>       {total_used,11681},
>       {sockets_limit,58408},
>       {sockets_used,11677}]},
>  {processes,[{limit,1048576},{used,198557}]},
>  {run_queue,6},
>  {uptime,575}]
>
> Couple of strange things there are:
>
> 1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How is
> that possible? https://www.rabbitmq.com/memory.html says that erlang
> process can take twice the configured size so I expected that but it is
> definitely more than twice.
>
> 2. {plugins,-44730984} - how this one is possible?
>
> And just in cast it is needed, below is /proc/X/status
>
> VmPeak:     2267580 kB
> VmSize:     2110952 kB
> VmLck:           0 kB
> VmHWM:     2096276 kB
> VmRSS:     2020848 kB
> VmData:     2075168 kB
> VmStk:          88 kB
> VmExe:        1604 kB
> VmLib:        4848 kB
> VmPTE:        4304 kB
> Threads:    31
>
>
> Thanks in advance!
>
>
>
>
>
>
> This email is for the use of the intended recipient(s) only.
> If you have received this email in error, please notify the sender
> immediately and then delete it.
> If you are not the intended recipient, you must not use, disclose or
> distribute this email without the
> author's prior permission. AlertMe.com Ltd. is not responsible for any
> personal views expressed
> in this message or any attachments that are those of the individual sender.
>
> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
> Registered in England, Company number 578 2908, VAT registration number GB
> 895 9914 42.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/6a06d623/attachment.html>

From simon at rabbitmq.com  Fri Mar  7 17:45:06 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 17:45:06 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <5319FEDA.4040201@alertme.com>
References: <5319FEDA.4040201@alertme.com>
Message-ID: <531A05A2.6020606@rabbitmq.com>

On 07/03/2014 5:16PM, Dmitry Andrianov wrote:
> Hello.

Hi.

> We are trying to load-test RabbitMQ server in different configurations
> on Amazon EC2 node.
> Most of our tests end with Linux OOM killer intervening and killing Rabbit.
> That is something I cannot really understand especially given that it is
> reproducible even with vm_memory_high_watermark set to 0.2 and no other
> processes running on that box.
> So if someone could shed some light onto that issue it would help a lot.
>
> Below the status response not long before the process was killed:

<snip>

> Couple of strange things there are:
>
> 1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How
> is that possible? https://www.rabbitmq.com/memory.html says that erlang
> process can take twice the configured size so I expected that but it is
> definitely more than twice.

The only ways RabbitMQ has of preventing memory use from increasing are 
to do with messages - when the memory alarm goes off it will stop 
accepting new messages, and before that point it will start trying to 
reduce memory use by paging messages out to disc.

Normally, messages are the biggest user of memory in RabbitMQ, so this 
approach works OK.

However, your test ends up causing RabbitMQ to end up using the majority 
of its memory in connection processes - you have 11k connections open, 
at about 120kB each.

We don't prevent RabbitMQ from accepting new connections when the memory 
alarm goes off since our main worry is messages - and those connections 
could be intending to consume messages and thus reduce memory pressure.

So I guess you might want to reduce the ulimit, so that RabbitMQ runs 
out of file descriptors before it runs out of memory (when it runs out 
of FDs it *will* stop accepting network connections gracefully).

> 2. {plugins,-44730984} - how this one is possible?

That's a good question!

That value is calculated from (memory used by all plugins including 
management) - (memory used by the management database). So somehow the 
memory counter managed to determine that "all plugins" used less memory 
than just the management plugin. I'll look into that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mcintoshj at gmail.com  Fri Mar  7 17:46:32 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 7 Mar 2014 11:46:32 -0600
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <CAE3HoVR6L2kDK5DL8-bnY-WQR8i-nXZ9bmSZQEN_3cB8xf2zZw@mail.gmail.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
 <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
 <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
 <CAE3HoVR6L2kDK5DL8-bnY-WQR8i-nXZ9bmSZQEN_3cB8xf2zZw@mail.gmail.com>
Message-ID: <CAD6m6fG6e_9SwP14fAWvfr6-Lc8Jhy8Q-P+PCHxTgvbaUFq54A@mail.gmail.com>

Is the cleanup of queues on the connection or channel?  If it's channel I'd
guess a channel close someplace.  If it's connection based though, wouldn't
all the queues go away, not just two?

Jason


On Fri, Mar 7, 2014 at 10:04 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2014-03-07 19:37 GMT+04:00 Monish Unni <monish.unni at gmail.com>:
>
> every once in a while i see one or 2 of them suddenly disappear. i
>> have never seen anything like this before.
>> thus the question,  is it possible that a liveness connection from a
>> load-balancer can coz sweeps of queues.
>> (shouldn't be, coz the loadbalancer uses a different connection).
>>
>
> I am not sure what "liveness connection" means but if your load balancer
> decides
> a TCP connection to RabbitMQ is stale and closes it, exclusive queues
> declared on it
> will be deleted.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/707ead1b/attachment.html>

From michael.s.klishin at gmail.com  Fri Mar  7 17:46:58 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 7 Mar 2014 21:46:58 +0400
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
Message-ID: <CAE3HoVST+zusStq1bd4GvCqtZ36Zf-jKfxfx3PYXfFf2hjB+Ag@mail.gmail.com>

2014-03-07 21:43 GMT+04:00 Jason McIntosh <mcintoshj at gmail.com>:

> As I recall, the memory limit doesn't prevent rabbit from using more
> memory, it's the point at which it stops accepting new connections


Only crossing the file descriptor limit will cause connections to be
refused.
Existing connections that publish messages will be blocked (by not reading
from their sockets).

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/d31ccb75/attachment.html>

From mcintoshj at gmail.com  Fri Mar  7 17:48:24 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 7 Mar 2014 11:48:24 -0600
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531A05A2.6020606@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
	<531A05A2.6020606@rabbitmq.com>
Message-ID: <CAD6m6fHV7AgcSp406UckUj2hYjXdJtG=+Xgu9ni7dYBde-sNmw@mail.gmail.com>

Simon:

Is it messages or connections that it blocks?  I thought it would block new
connections but still allow existing connections to publish messages?  At
what point does rabbit start paging to disk on the messages?  Is that at
50% of the vm memory threshold?

Jason


On Fri, Mar 7, 2014 at 11:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/03/2014 5:16PM, Dmitry Andrianov wrote:
>
>> Hello.
>>
>
> Hi.
>
>
>  We are trying to load-test RabbitMQ server in different configurations
>> on Amazon EC2 node.
>> Most of our tests end with Linux OOM killer intervening and killing
>> Rabbit.
>> That is something I cannot really understand especially given that it is
>> reproducible even with vm_memory_high_watermark set to 0.2 and no other
>> processes running on that box.
>> So if someone could shed some light onto that issue it would help a lot.
>>
>> Below the status response not long before the process was killed:
>>
>
> <snip>
>
>
>  Couple of strange things there are:
>>
>> 1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How
>> is that possible? https://www.rabbitmq.com/memory.html says that erlang
>> process can take twice the configured size so I expected that but it is
>> definitely more than twice.
>>
>
> The only ways RabbitMQ has of preventing memory use from increasing are to
> do with messages - when the memory alarm goes off it will stop accepting
> new messages, and before that point it will start trying to reduce memory
> use by paging messages out to disc.
>
> Normally, messages are the biggest user of memory in RabbitMQ, so this
> approach works OK.
>
> However, your test ends up causing RabbitMQ to end up using the majority
> of its memory in connection processes - you have 11k connections open, at
> about 120kB each.
>
> We don't prevent RabbitMQ from accepting new connections when the memory
> alarm goes off since our main worry is messages - and those connections
> could be intending to consume messages and thus reduce memory pressure.
>
> So I guess you might want to reduce the ulimit, so that RabbitMQ runs out
> of file descriptors before it runs out of memory (when it runs out of FDs
> it *will* stop accepting network connections gracefully).
>
>
>  2. {plugins,-44730984} - how this one is possible?
>>
>
> That's a good question!
>
> That value is calculated from (memory used by all plugins including
> management) - (memory used by the management database). So somehow the
> memory counter managed to determine that "all plugins" used less memory
> than just the management plugin. I'll look into that.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/f70924e5/attachment.html>

From simon at rabbitmq.com  Fri Mar  7 17:49:10 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 17:49:10 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
Message-ID: <531A0696.7050203@rabbitmq.com>

On 07/03/2014 5:43PM, Jason McIntosh wrote:
> As I recall, the memory limit doesn't prevent rabbit from using more
> memory, it's the point at which it stops accepting new connections.  It
> would still allow existing connections to flood the system:

It's the other way round.

"Block connections" means "prevent existing and new connections from 
publishing", *not* "refuse to accept new connections".

Because, as noted in my other mail, you could be establishing a 
connection to consume messages - and we don't want to discourage that!

But as Dmitry is finding out, memory use can still increase for other 
reasons.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Fri Mar  7 17:51:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 7 Mar 2014 21:51:04 +0400
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <CAD6m6fG6e_9SwP14fAWvfr6-Lc8Jhy8Q-P+PCHxTgvbaUFq54A@mail.gmail.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
 <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
 <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
 <CAE3HoVR6L2kDK5DL8-bnY-WQR8i-nXZ9bmSZQEN_3cB8xf2zZw@mail.gmail.com>
 <CAD6m6fG6e_9SwP14fAWvfr6-Lc8Jhy8Q-P+PCHxTgvbaUFq54A@mail.gmail.com>
Message-ID: <CE06DB03-238B-4DC4-B0CB-7C989860BA86@rabbitmq.com>


On 7 Mar 2014, at 21:46, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Is the cleanup of queues on the connection or channel?  If it's channel I'd guess a channel close someplace.  If it's connection based though, wouldn't all the queues go away, not just two?

Connection.

There can be multiple connections creating the queues.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Fri Mar  7 17:56:39 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 17:56:39 +0000
Subject: [rabbitmq-discuss] exclusive auto delete queue disappears
In-Reply-To: <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
References: <660ddb62-e560-43a2-a96b-fc1156522c8c@googlegroups.com>
 <F3F4B39A-243A-431D-B182-6C499F711B5A@rabbitmq.com>
 <CAPwx=WMKOxJmL4tMmgn7E7zgEY=8tXg8OvVEFfX2iF01yZfi+A@mail.gmail.com>
Message-ID: <531A0857.8020703@rabbitmq.com>

On 07/03/2014 3:37PM, Monish Unni wrote:
> eitherways these 10 (AD,EX) queues hang around till the JVM dies,
> because the connection is kept alive.

That's what exclusive means. auto-delete means that the queue will go 
once it returns to 0 consumers (i.e. once it has a consumer and then 
loses it again). The connection does not need to close. Could that be 
what you're seeing?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar  7 18:04:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Mar 2014 18:04:14 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <CAD6m6fHV7AgcSp406UckUj2hYjXdJtG=+Xgu9ni7dYBde-sNmw@mail.gmail.com>
References: <5319FEDA.4040201@alertme.com>	<531A05A2.6020606@rabbitmq.com>
 <CAD6m6fHV7AgcSp406UckUj2hYjXdJtG=+Xgu9ni7dYBde-sNmw@mail.gmail.com>
Message-ID: <531A0A1E.6010406@rabbitmq.com>

On 07/03/2014 5:48PM, Jason McIntosh wrote:
> Simon:
>
> Is it messages or connections that it blocks?

It blocks connections from publishing new messages.

> I thought it would block
> new connections but still allow existing connections to publish
> messages?

No, that happens when you run out of file descriptors.

>  At what point does rabbit start paging to disk on the
> messages?  Is that at 50% of the vm memory threshold?

By default yes, see http://www.rabbitmq.com/memory.html#memsup-paging

It used to be hard coded at 20% in older versions.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From grussell at gopivotal.com  Fri Mar  7 18:53:09 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 7 Mar 2014 13:53:09 -0500
Subject: [rabbitmq-discuss] Spring AMQP 1.3.0 Release Candidate
Message-ID: <CADtU9_uZOvYgPFdjAxooSeL1iZuNZE81of=nvFEETgKJdVWEaQ@mail.gmail.com>

The release candidate is now available...

https://spring.io/blog/2014/03/07/spring-amqp-1-3-0-release-candidate-available


GA will follow in a couple of weeks, barring no big issues.


Enjoy!


Gary Russell
Spring AMQP Lead
Pivotal Inc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/2832ffa9/attachment.html>

From joneholland at gmail.com  Sat Mar  8 00:21:08 2014
From: joneholland at gmail.com (Jonathan Holland)
Date: Fri, 7 Mar 2014 16:21:08 -0800
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
Message-ID: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>

We have a scenario where we want to use queue mirroring in a cluster, but
have the queues auto-delete when the last consumer disconnects.

When we have a mirrored policy enabled, and the queue is not exclusive or
autodelete, then I see it properly mirroring to a slave node.

When we enable exclusive and autodelete, the queue no longer mirrors.

Is there a specific way this should be configured, or is this not supported?

--Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/e0d66288/attachment.html>

From joneholland at gmail.com  Sat Mar  8 00:30:37 2014
From: joneholland at gmail.com (Jonathan Holland)
Date: Fri, 7 Mar 2014 16:30:37 -0800
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
In-Reply-To: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
References: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
Message-ID: <CAPZS+nkjmGgaPM5MdruvLYTzTFXyrQTzjUDERfHYOLwoCij_kQ@mail.gmail.com>

After doing a bit more reading, I'm thinking having Exclusive=True is
preventing mirroring, so I'd just like to confirm that AutoDelete=True will
have the semantics we are looking for.

--Jon



On Fri, Mar 7, 2014 at 4:21 PM, Jonathan Holland <joneholland at gmail.com>wrote:

> We have a scenario where we want to use queue mirroring in a cluster, but
> have the queues auto-delete when the last consumer disconnects.
>
> When we have a mirrored policy enabled, and the queue is not exclusive or
> autodelete, then I see it properly mirroring to a slave node.
>
> When we enable exclusive and autodelete, the queue no longer mirrors.
>
> Is there a specific way this should be configured, or is this not
> supported?
>
> --Jon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/505bfd5e/attachment.html>

From dmitry.andrianov at alertme.com  Sat Mar  8 11:17:40 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 11:17:40 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531A05A2.6020606@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com> <531A05A2.6020606@rabbitmq.com>
Message-ID: <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>

Thanks very much for the explanation, Simon.

When you say Rabbit will gracefully stop accepting connections when ulimit is reached, are you talking about some action explicitly done by Rabbit itself when it sees limit approaching or is everything done by the OS?
If Rabbit does something - doesn't it make sense to do the same when memory is running low?

i will of course follow your advice and play with ulimit but it does not feel very reliable - even if I find ulimit value which works in that specific test case, it may stop working when message size changes.

Regarding plugin memory - it worth mentioning that we have couple of custom plugins including a custom authentication backend. Can these be the root cause? Is there anything that needs to be explicitly done by the plugin developer to make sure the memory is accounted correctly?

Thank you.

> On 7 Mar 2014, at 17:45, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 07/03/2014 5:16PM, Dmitry Andrianov wrote:
>> Hello.
> 
> Hi.
> 
>> We are trying to load-test RabbitMQ server in different configurations
>> on Amazon EC2 node.
>> Most of our tests end with Linux OOM killer intervening and killing Rabbit.
>> That is something I cannot really understand especially given that it is
>> reproducible even with vm_memory_high_watermark set to 0.2 and no other
>> processes running on that box.
>> So if someone could shed some light onto that issue it would help a lot.
>> 
>> Below the status response not long before the process was killed:
> 
> <snip>
> 
>> Couple of strange things there are:
>> 
>> 1. {vm_memory_limit,804643635} but still memory {total,1984625336}. How
>> is that possible? https://www.rabbitmq.com/memory.html says that erlang
>> process can take twice the configured size so I expected that but it is
>> definitely more than twice.
> 
> The only ways RabbitMQ has of preventing memory use from increasing are to do with messages - when the memory alarm goes off it will stop accepting new messages, and before that point it will start trying to reduce memory use by paging messages out to disc.
> 
> Normally, messages are the biggest user of memory in RabbitMQ, so this approach works OK.
> 
> However, your test ends up causing RabbitMQ to end up using the majority of its memory in connection processes - you have 11k connections open, at about 120kB each.
> 
> We don't prevent RabbitMQ from accepting new connections when the memory alarm goes off since our main worry is messages - and those connections could be intending to consume messages and thus reduce memory pressure.
> 
> So I guess you might want to reduce the ulimit, so that RabbitMQ runs out of file descriptors before it runs out of memory (when it runs out of FDs it *will* stop accepting network connections gracefully).
> 
>> 2. {plugins,-44730984} - how this one is possible?
> 
> That's a good question!
> 
> That value is calculated from (memory used by all plugins including management) - (memory used by the management database). So somehow the memory counter managed to determine that "all plugins" used less memory than just the management plugin. I'll look into that.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Sat Mar  8 12:13:12 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 8 Mar 2014 16:13:12 +0400
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>
References: <5319FEDA.4040201@alertme.com> <531A05A2.6020606@rabbitmq.com>
 <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>
Message-ID: <7258B33B-94F3-4A0C-9474-AFDEC9235663@rabbitmq.com>

On 8 Mar 2014, at 15:17, Dmitry Andrianov <dmitry.andrianov at alertme.com> wrote:

> If Rabbit does something - doesn't it make sense to do the same when memory is running low?

New connections can be consuming messages, not just publishing. It makes sense to let
consumers drain messages. Publishing connection will be blocked as soon as RabbitMQ receives a basic.publish
frame on it.

MK

Software Engineer, Pivotal/RabbitMQ



From dmitry.andrianov at alertme.com  Sat Mar  8 12:18:22 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 12:18:22 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531A0696.7050203@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
Message-ID: <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>

Oh, it is the bit I keep forgetting about - the fact you want to continue accepting connections to let consumers in.

But that means that is possible to DOS any internet facing Rabbit...

Are there any mechanisms in RabbitMQ to listen on two ports or network addresses at the same time while being able to set independent connection limits on these?
It would allow to limit number of clients coming from Internet while still be able to accept consumers from trusted servers.

Cheers


> On 7 Mar 2014, at 17:49, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 07/03/2014 5:43PM, Jason McIntosh wrote:
>> As I recall, the memory limit doesn't prevent rabbit from using more
>> memory, it's the point at which it stops accepting new connections.  It
>> would still allow existing connections to flood the system:
> 
> It's the other way round.
> 
> "Block connections" means "prevent existing and new connections from publishing", *not* "refuse to accept new connections".
> 
> Because, as noted in my other mail, you could be establishing a connection to consume messages - and we don't want to discourage that!
> 
> But as Dmitry is finding out, memory use can still increase for other reasons.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From stammailbox at gmail.com  Sat Mar  8 12:22:46 2014
From: stammailbox at gmail.com (rails)
Date: Sat, 8 Mar 2014 14:22:46 +0200
Subject: [rabbitmq-discuss] How to join two rabbitmq nodes on EC2?
Message-ID: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>

I have two Ubuntu instances in the EC2 and I want to cluster them.

One ip will be refered as - X (the "net addr" ifconfig displayed IP) and
its public ip will be reffered as PX.
the other ip is Y and its public is Y.

So now I did the following on both machines.

   1. installed the latest rabbbitmq.
   2. installed the management plugin.
   3. opened the port for 5672 (rabbit) and 15672(management plugin)
   4. connected to rabbit with my test app.
   5. connected to the ui.

So now for the cluster. I did the following commands

on X

rabbitmqctl cluster_status

got the node name which was 'rabbit at ip-X' (where X is the inner IP) on Y

rabbitmqctl stop_app
rabbitmqctl join_cluster --ram rabbit at ip-X

I got

"The nodes provided are either offline or not running"

Obviously this is the private ip, so the other instance cant connect. How
do I tell the second instance where the first is located?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140308/311cc7c2/attachment.html>

From matthias at rabbitmq.com  Sat Mar  8 13:04:56 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 13:04:56 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
Message-ID: <531B1578.7080706@rabbitmq.com>

On 08/03/14 12:18, Dmitry Andrianov wrote:
> But that means that is possible to DOS any internet facing Rabbit...

It is one of *several* ways to DOS a rabbit. Creating lots of 
exchanges/bindings/queues is another one, for example.

> Are there any mechanisms in RabbitMQ to listen on two ports or
> network addresses at the same time

Yes. See tcp_listeners in 
https://www.rabbitmq.com/configure.html#config-items.

> while being able to set independent connection limits on these?

No, but firewalls should be able to do that.

Regards,

Matthias.

From dmitry.andrianov at alertme.com  Sat Mar  8 14:54:08 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 14:54:08 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531B1578.7080706@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
Message-ID: <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>

Well, creation of exchanges and queues we can at least control with some auth plugin so we can try protecting from these types of DOS. However with connections there seem to be no way to solve it. If no ulimit is used - we are susceptible to that OOM DOS. And if we set ulimit, it is still possible to DOS us - Rabbit won't die but won't accept connections from consumers either.

I will look into limiting connections by the means if OS or Amazon ELB but it feels like that kind of DOS protection should be part of Rabbit itself.

Cheers

> On 8 Mar 2014, at 13:04, Matthias Radestock <matthias at rabbitmq.com> wrote:
> 
>> On 08/03/14 12:18, Dmitry Andrianov wrote:
>> But that means that is possible to DOS any internet facing Rabbit...
> 
> It is one of *several* ways to DOS a rabbit. Creating lots of exchanges/bindings/queues is another one, for example.
> 
>> Are there any mechanisms in RabbitMQ to listen on two ports or
>> network addresses at the same time
> 
> Yes. See tcp_listeners in https://www.rabbitmq.com/configure.html#config-items.
> 
>> while being able to set independent connection limits on these?
> 
> No, but firewalls should be able to do that.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Sat Mar  8 15:00:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 8 Mar 2014 19:00:35 +0400
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
Message-ID: <6CB32945-769D-4C68-A823-80B7485F5370@rabbitmq.com>


On 8 Mar 2014, at 18:54, Dmitry Andrianov <dmitry.andrianov at alertme.com> wrote:

> Well, creation of exchanges and queues we can at least control with some auth plugin so we can try protecting from these types of DOS. However with connections there seem to be no way to solve it. If no ulimit is used - we are susceptible to that OOM DOS. And if we set ulimit, it is still possible to DOS us - Rabbit won't die but won't accept connections from consumers either.
> 
> I will look into limiting connections by the means if OS or Amazon ELB but it feels like that kind of DOS protection should be part of Rabbit itself.

Services such as CloudAMQP monitor connections/channels/queues/etc over HTTP API and force close
those that use too many resources.

One can argue that you can DOS any service, e.g. MySQL, exposed to the public Internet, by flooding it with writes.
Some form of connection monitoring will likely be necessary anyway.

MK

Software Engineer, Pivotal/RabbitMQ



From matthias at rabbitmq.com  Sat Mar  8 15:24:45 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 15:24:45 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
Message-ID: <531B363D.1010403@rabbitmq.com>

On 08/03/14 14:54, Dmitry Andrianov wrote:
> If no ulimit is used - we are susceptible to that OOM DOS. And if we
> set ulimit, it is still possible to DOS us - Rabbit won't die but
> won't accept connections from consumers either.
>
> it feels like that kind of DOS protection should be part of Rabbit
> itself.

I am curious what you propose rabbit should be doing here.

The ulimit does bound the overall connection-related memory use, since 
there is an upper bound on how much memory can be associated with each 
connection (most of which, incidentally, tends to be socket buffer 
space, so reducing that is advisable for high-connection-count 
configurations).

Any ulimit (and there is always one, though it may be very high) means 
that when it is reached then no more connections can be accepted. There 
is no way around that.

Matthias.

From dmitry.andrianov at alertme.com  Sat Mar  8 16:16:47 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 16:16:47 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <6CB32945-769D-4C68-A823-80B7485F5370@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <6CB32945-769D-4C68-A823-80B7485F5370@rabbitmq.com>
Message-ID: <C4395A60-D158-4895-9D10-95A5F5A9B7C6@alertme.com>

MySQL or any other SQL is almost never exposed to the internet - most of the time clients use some RESTful HTTP API or something similar. Because of that there is usually no need to protect database from DOS attacks.

Internet facing services usually have some sort of protection - it is true for all major HTTP servers, SMTP and others.

To be honest, I am not sure if Rabbit was designed to be internet facing or it was created to be used only in a trusted environment. I just assumed it is ok to put it into public internet because of other people doing so.

I will check CloudAMQP out.

Thanks!


> On 8 Mar 2014, at 15:00, Michael Klishin <mklishin at gopivotal.com> wrote:
> 
> 
>> On 8 Mar 2014, at 18:54, Dmitry Andrianov <dmitry.andrianov at alertme.com> wrote:
>> 
>> Well, creation of exchanges and queues we can at least control with some auth plugin so we can try protecting from these types of DOS. However with connections there seem to be no way to solve it. If no ulimit is used - we are susceptible to that OOM DOS. And if we set ulimit, it is still possible to DOS us - Rabbit won't die but won't accept connections from consumers either.
>> 
>> I will look into limiting connections by the means if OS or Amazon ELB but it feels like that kind of DOS protection should be part of Rabbit itself.
> 
> Services such as CloudAMQP monitor connections/channels/queues/etc over HTTP API and force close
> those that use too many resources.
> 
> One can argue that you can DOS any service, e.g. MySQL, exposed to the public Internet, by flooding it with writes.
> Some form of connection monitoring will likely be necessary anyway.
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Sat Mar  8 16:19:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 8 Mar 2014 20:19:37 +0400
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <C4395A60-D158-4895-9D10-95A5F5A9B7C6@alertme.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <6CB32945-769D-4C68-A823-80B7485F5370@rabbitmq.com>
 <C4395A60-D158-4895-9D10-95A5F5A9B7C6@alertme.com>
Message-ID: <BC238A2A-BD50-4307-B194-5D30866E2F1E@rabbitmq.com>


On 8 Mar 2014, at 20:16, Dmitry Andrianov <dmitry.andrianov at alertme.com> wrote:

> To be honest, I am not sure if Rabbit was designed to be internet facing

It was not. Financial institutions rarely like exposing their infrastructure to
the public ;)

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sat Mar  8 16:26:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 8 Mar 2014 20:26:38 +0400
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <BC238A2A-BD50-4307-B194-5D30866E2F1E@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <6CB32945-769D-4C68-A823-80B7485F5370@rabbitmq.com>
 <C4395A60-D158-4895-9D10-95A5F5A9B7C6@alertme.com>
 <BC238A2A-BD50-4307-B194-5D30866E2F1E@rabbitmq.com>
Message-ID: <C30EA7F3-3D0D-41A0-BB33-E43621424CE1@gopivotal.com>


On 8 Mar 2014, at 20:19, Michael Klishin <mklishin at gopivotal.com> wrote:

> It was not. Financial institutions rarely like exposing their infrastructure to
> the public ;)

That said, because you can monitor a lot of things over HTTP API and force close connections,
it is easier to protect a Rabbit cluster from rogue connections than many other infrastructure tools.

--
MK

Software Engineer, Pivotal/RabbitMQ



From dmitry.andrianov at alertme.com  Sat Mar  8 16:38:14 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 16:38:14 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531B363D.1010403@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <531B363D.1010403@rabbitmq.com>
Message-ID: <4A58A51C-74AC-4D06-8582-55C459769344@alertme.com>

Matthias,
I am not sure myself what I am actually proposing )
I just know that server process dying completely is a very bad thing to happen.

Ulimit can prevent it from happening but at the cost of not accepting consumers when it is reached.
Not sure if the use case I am trying is very common or it is specific to us but the idea is to have many clients (mostly producing) in the internet while a few consumers on the server side. With such layout we should protect Rabbit from dying because of too many clients but at the same time we must let consumers from the neighbour servers connect.

So if I was able to extend Rabbit, I would be thinking of adding something like a limiting policy to every tcp listener. So for internal port (inaccessible from internet) I would not set any limits while on the ssl listener (accessible from the internet) I would configure a limiting policy either with fixed limit (say 10k connections) or memory-based policy (start limiting connections when memory is low).

Something like that.
But from Michael's words I understand that it is not something you need yourself or think is needed by the community because it is not how Rabbit is supposed to be used.

Cheers

> On 8 Mar 2014, at 15:24, Matthias Radestock <matthias at rabbitmq.com> wrote:
> 
> Matthias
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From matthias at rabbitmq.com  Sat Mar  8 17:08:47 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 17:08:47 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <4A58A51C-74AC-4D06-8582-55C459769344@alertme.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <531B363D.1010403@rabbitmq.com>
 <4A58A51C-74AC-4D06-8582-55C459769344@alertme.com>
Message-ID: <531B4E9F.3060307@rabbitmq.com>

On 08/03/14 16:38, Dmitry Andrianov wrote:
> I just know that server process dying completely is a very bad thing
> to happen.

Indeed. but note that in your case the server didn't die off its own 
accord; it was bumped off by the OOM killer.

With ulimits, channel limits and buffer sizes configured carefully, and 
restrictions in place for exchange/binding/queue creation, you can 
certainly prevent rabbit from breaching memory limits.

> So if I was able to extend Rabbit, I would be thinking of adding
> something like a limiting policy to every tcp listener. So for
> internal port (inaccessible from internet) I would not set any limits
> while on the ssl listener (accessible from the internet) I would
> configure a limiting policy either with fixed limit (say 10k
> connections) or memory-based policy (start limiting connections when
> memory is low).

Right. This is achievable with common firewall products.

> Something like that. But from Michael's words I understand that it is
> not something you need yourself or think is needed by the community
> because it is not how Rabbit is supposed to be used.

We are in fact quite keen to improve rabbit to make it more bullet 
proof. We have long-standing bugs open in our tracker for the issues you 
raised. But any solution we come up with must a) cover a broad spectrum 
of use cases, b) not be easily handled by off-the-shelf companion 
products like firewalls.

Regards,

Matthias

From matthias at rabbitmq.com  Sat Mar  8 18:38:39 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 18:38:39 +0000
Subject: [rabbitmq-discuss] How to join two rabbitmq nodes on EC2?
In-Reply-To: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>
References: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>
Message-ID: <531B63AF.4040605@rabbitmq.com>

On 08/03/14 12:22, rails wrote:
> I have two Ubuntu instances in the EC2 and I want to cluster them.
>[...]
> So now I did the following on both machines.
>  [...]
>  3. opened the port for 5672 (rabbit) and 15672(management plugin)

That is not enough. See https://www.rabbitmq.com/clustering.html#firewall

Matthias.

From matthias at rabbitmq.com  Sat Mar  8 19:07:13 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 19:07:13 +0000
Subject: [rabbitmq-discuss] Broker shutdown_error
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C991CC41@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C991CC41@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <531B6A61.8030401@rabbitmq.com>

On 04/03/14 09:15, Lothe Shashank wrote:
> Using system manager, I haven't faced any problem but wanted to check if
> rabbitmqctl stop_app is having some problem.

The most likely cause is that some queue got wedged. That of course 
should not happen. If this is reproducible, please run

rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <- 
processes(), begin {_, L} = process_info(P, message_queue_len), L > 0 end].'

when it happens and post the output here.

Matthias.

From matthias at rabbitmq.com  Sat Mar  8 19:12:57 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 19:12:57 +0000
Subject: [rabbitmq-discuss] Closing RabbitMq Blocked Connection
In-Reply-To: <CAB0ZxM6h3kT8LP+Fs2fQ8xncdJqx0vT_P-pKz26yhy9+sWA1mA@mail.gmail.com>
References: <CAB0ZxM6h3kT8LP+Fs2fQ8xncdJqx0vT_P-pKz26yhy9+sWA1mA@mail.gmail.com>
Message-ID: <531B6BB9.5000706@rabbitmq.com>

On 05/03/14 13:26, chetan dev wrote:
> Can someone please tell me the way to close blocked connection.
> I am using rabbitmq 3.0.0

You can find out what connections are blocked via rabbitmqctl, 
rabbitmqadmin or the management API. And you can close any given 
connection - blocked or unblocked - via the same routes...

rabbitmqctl: 
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#close_connection

rabbitmqadmin: http://www.rabbitmq.com/management-cli.html

management API: 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_4/priv/www/api/index.html 
(DELETE on /api/connections/<name>)

Matthias.

From dmitry.andrianov at alertme.com  Sat Mar  8 19:19:43 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Sat, 8 Mar 2014 19:19:43 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531B4E9F.3060307@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com>
 <CAD6m6fET+kP2cS0KxHr4iqCA3fRUfCw-McedAOcET-fy+mdrVQ@mail.gmail.com>
 <531A0696.7050203@rabbitmq.com>
 <FBDD8767-EED1-4783-8DFD-FB703E8052A0@alertme.com>
 <531B1578.7080706@rabbitmq.com>
 <A9CA689F-C04C-43C4-9C5F-E08E4522A685@alertme.com>
 <531B363D.1010403@rabbitmq.com>
 <4A58A51C-74AC-4D06-8582-55C459769344@alertme.com>
 <531B4E9F.3060307@rabbitmq.com>
Message-ID: <1D910F8A-718A-49E2-BCE4-7E934F307AC9@alertme.com>

I understand.

However only fixed limit policy can be easily implemented by 3rd party firewall. Only Rabbit itself can implement free-memory based policies when it stops accepting connection when memory drops below a threshold. (Well, firewall can of course poll Rabbit status regularly and change its behaviour based on current memory consumption but it does not look very reliable and also introduces a delay so won't be able to react on a sudden spike of connections)

Cheers

> On 8 Mar 2014, at 17:08, Matthias Radestock <matthias at rabbitmq.com> wrote:
> 
>> On 08/03/14 16:38, Dmitry Andrianov wrote:
>> I just know that server process dying completely is a very bad thing
>> to happen.
> 
> Indeed. but note that in your case the server didn't die off its own accord; it was bumped off by the OOM killer.
> 
> With ulimits, channel limits and buffer sizes configured carefully, and restrictions in place for exchange/binding/queue creation, you can certainly prevent rabbit from breaching memory limits.
> 
>> So if I was able to extend Rabbit, I would be thinking of adding
>> something like a limiting policy to every tcp listener. So for
>> internal port (inaccessible from internet) I would not set any limits
>> while on the ssl listener (accessible from the internet) I would
>> configure a limiting policy either with fixed limit (say 10k
>> connections) or memory-based policy (start limiting connections when
>> memory is low).
> 
> Right. This is achievable with common firewall products.
> 
>> Something like that. But from Michael's words I understand that it is
>> not something you need yourself or think is needed by the community
>> because it is not how Rabbit is supposed to be used.
> 
> We are in fact quite keen to improve rabbit to make it more bullet proof. We have long-standing bugs open in our tracker for the issues you raised. But any solution we come up with must a) cover a broad spectrum of use cases, b) not be easily handled by off-the-shelf companion products like firewalls.
> 
> Regards,
> 
> Matthias
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From matthias at rabbitmq.com  Sat Mar  8 19:33:28 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 19:33:28 +0000
Subject: [rabbitmq-discuss] Federation chokes on load
In-Reply-To: <CAP0RBZXTgWzi5QpNf-F6WeCGzN61zw5A_DP+2PnyQKjU2GovFw@mail.gmail.com>
References: <473755ed-4741-45d6-91d2-39c7ea9d567c@googlegroups.com>
 <531613D6.5030401@rabbitmq.com>
 <CAP0RBZUmGLeB_jAgn=c_72+4HU6WioaBA8QfiOkpVrD=YvSsnw@mail.gmail.com>
 <53171305.4030606@rabbitmq.com>
 <CAP0RBZXTgWzi5QpNf-F6WeCGzN61zw5A_DP+2PnyQKjU2GovFw@mail.gmail.com>
Message-ID: <531B7088.8080807@rabbitmq.com>

Patrick,

On 05/03/14 14:48, Patrik Ring wrote:
> Yes. With only that binding, things are working and I can see the
> message in test-receive-users queue. The problems start when I start
> adding bindings and messages. We have had it working with a few bindings
> (5-10 approx) but when we start putting load on it (5000 bindings
> approx) it seems to just die.

I believe Simon was hoping you'd post a 'rabbitmqctl report' from when 
the system is misbehaving, not when everything is functioning correctly.

Matthias.

From matthias at rabbitmq.com  Sat Mar  8 19:38:53 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 19:38:53 +0000
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
In-Reply-To: <53184C43.5010000@anynines.com>
References: <53184C43.5010000@anynines.com>
Message-ID: <531B71CD.7040003@rabbitmq.com>

Heiko,

On 06/03/14 10:21, Heiko Kr?mer wrote:
> Problem description:
> I've more then 200 queues in my vhost and all works fine expect for one.

Looks like this queue somehow got stuck. Which of course shouldn't happen.

Please run

rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <- 
processes(), begin {_, L} = process_info(P, message_queue_len), L > 0 end].'

against the node on which the queue is residing and post the output here.


Regards,

Matthias.

From dev440 at gmail.com  Sat Mar  8 19:51:11 2014
From: dev440 at gmail.com (chetan dev)
Date: Sun, 9 Mar 2014 01:21:11 +0530
Subject: [rabbitmq-discuss] Closing RabbitMq Blocked Connection
In-Reply-To: <531B6BB9.5000706@rabbitmq.com>
References: <CAB0ZxM6h3kT8LP+Fs2fQ8xncdJqx0vT_P-pKz26yhy9+sWA1mA@mail.gmail.com>
 <531B6BB9.5000706@rabbitmq.com>
Message-ID: <CAB0ZxM6gwHELP96ANmpCVPq0OLbcL7oCiwk7WDq4dBZvJOT-4Q@mail.gmail.com>

Hi,

Why don't Connection.close() and Model.close() work while closing the
connection from client side once detected blocked?

Thanks


On Sun, Mar 9, 2014 at 12:42 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 05/03/14 13:26, chetan dev wrote:
>
>> Can someone please tell me the way to close blocked connection.
>> I am using rabbitmq 3.0.0
>>
>
> You can find out what connections are blocked via rabbitmqctl,
> rabbitmqadmin or the management API. And you can close any given connection
> - blocked or unblocked - via the same routes...
>
> rabbitmqctl: http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#close_
> connection
>
> rabbitmqadmin: http://www.rabbitmq.com/management-cli.html
>
> management API: http://hg.rabbitmq.com/rabbitmq-management/raw-file/
> rabbitmq_v3_2_4/priv/www/api/index.html (DELETE on
> /api/connections/<name>)
>
> Matthias.
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/4abf8b83/attachment.html>

From matthias at rabbitmq.com  Sat Mar  8 19:55:30 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 19:55:30 +0000
Subject: [rabbitmq-discuss] Closing RabbitMq Blocked Connection
In-Reply-To: <CAB0ZxM6gwHELP96ANmpCVPq0OLbcL7oCiwk7WDq4dBZvJOT-4Q@mail.gmail.com>
References: <CAB0ZxM6h3kT8LP+Fs2fQ8xncdJqx0vT_P-pKz26yhy9+sWA1mA@mail.gmail.com>	<531B6BB9.5000706@rabbitmq.com>
 <CAB0ZxM6gwHELP96ANmpCVPq0OLbcL7oCiwk7WDq4dBZvJOT-4Q@mail.gmail.com>
Message-ID: <531B75B2.2020300@rabbitmq.com>

On 08/03/14 19:51, chetan dev wrote:
> Why don't Connection.close() and Model.close() work while closing the
> connection from client side once detected blocked?

Connection.close() is a synchronous operation. It performs a protocol 
level handshake and ensures that all commands/publishes sent on the 
connection have reached the server.

Wben a connection is blocked, rabbit isn't reading from the connection 
(that's what blocking means), so therefore cannot respond to the close 
requests from the client.

Matthias.

From matthias at rabbitmq.com  Sat Mar  8 22:12:28 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 08 Mar 2014 22:12:28 +0000
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
In-Reply-To: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
References: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
Message-ID: <531B95CC.1090500@rabbitmq.com>

Jon,

On 08/03/14 00:21, Jonathan Holland wrote:
> We have a scenario where we want to use queue mirroring in a cluster,
> but have the queues auto-delete when the last consumer disconnects.
>
> When we have a mirrored policy enabled, and the queue is not exclusive
> or autodelete, then I see it properly mirroring to a slave node.
>
> When we enable exclusive and autodelete, the queue no longer mirrors.

What do you mean by "no longer mirrors"?

You are aware of the semantics of exclusive and auto-delete, right?

https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive

"Exclusive queues are deleted when that connection [which created the 
queue] closes"

https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.auto-delete

"the queue is deleted when all consumers have finished using it. The 
last consumer can be cancelled either explicitly or because its channel 
is closed"

Both exclusive and auto-delete are entirely orthogonal to mirroring, 
though obviously when a node is failing, then all the connections to 
that node vanish, which in turn triggers the deletion of exclusive 
queues created by those connections, and  deletion of auto-delete queues 
where all consumers were connected to that node.

So usage of these flags in conjunction with mirroring is rarely a 
sensible combination since the same event that triggers fail-over to a 
mirrored queue's slave, i.e. the failure of a node, would usually also 
trigger the deletion of the queue.

Queues with a TTL (http://www.rabbitmq.com/ttl.html#queue-ttl) are an 
alternative to auto-delete queues. They can tolerate network and client 
failures, and, when mirrored, node failures.


Regards,

Matthias.

From joneholland at gmail.com  Sun Mar  9 00:01:32 2014
From: joneholland at gmail.com (Jonathan Holland)
Date: Sat, 8 Mar 2014 16:01:32 -0800
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
In-Reply-To: <531B95CC.1090500@rabbitmq.com>
References: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
 <531B95CC.1090500@rabbitmq.com>
Message-ID: <3A065BD4-F87A-497B-8432-4562A0EDB382@gmail.com>

Hi Matthias,

That makes sense, I was thinking for some reason that if queues were not mirrored, a message published by a channel on the other node would not arrive, but I think it would. 

Since our use case requires a temporary queue for each consumer, we don't need mirroring, just a cluster for fault tolerance. A node failure would cause the clients to reconnect and end up on the healthy node with new queues. There would be message loss, but that's ok in our usecase. 

Let me know if there is any holes in my understanding. 

Jon


> On Mar 8, 2014, at 2:12 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:
> 
> Jon,
> 
>> On 08/03/14 00:21, Jonathan Holland wrote:
>> We have a scenario where we want to use queue mirroring in a cluster,
>> but have the queues auto-delete when the last consumer disconnects.
>> 
>> When we have a mirrored policy enabled, and the queue is not exclusive
>> or autodelete, then I see it properly mirroring to a slave node.
>> 
>> When we enable exclusive and autodelete, the queue no longer mirrors.
> 
> What do you mean by "no longer mirrors"?
> 
> You are aware of the semantics of exclusive and auto-delete, right?
> 
> https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
> 
> "Exclusive queues are deleted when that connection [which created the queue] closes"
> 
> https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.auto-delete
> 
> "the queue is deleted when all consumers have finished using it. The last consumer can be cancelled either explicitly or because its channel is closed"
> 
> Both exclusive and auto-delete are entirely orthogonal to mirroring, though obviously when a node is failing, then all the connections to that node vanish, which in turn triggers the deletion of exclusive queues created by those connections, and  deletion of auto-delete queues where all consumers were connected to that node.
> 
> So usage of these flags in conjunction with mirroring is rarely a sensible combination since the same event that triggers fail-over to a mirrored queue's slave, i.e. the failure of a node, would usually also trigger the deletion of the queue.
> 
> Queues with a TTL (http://www.rabbitmq.com/ttl.html#queue-ttl) are an alternative to auto-delete queues. They can tolerate network and client failures, and, when mirrored, node failures.
> 
> 
> Regards,
> 
> Matthias.

From matthias at rabbitmq.com  Sun Mar  9 08:08:58 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 09 Mar 2014 08:08:58 +0000
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
In-Reply-To: <3A065BD4-F87A-497B-8432-4562A0EDB382@gmail.com>
References: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
 <531B95CC.1090500@rabbitmq.com>
 <3A065BD4-F87A-497B-8432-4562A0EDB382@gmail.com>
Message-ID: <531C219A.8000401@rabbitmq.com>

Jon,

On 09/03/14 00:01, Jonathan Holland wrote:
> I was thinking for some reason that if queues were not mirrored, a
> message published by a channel on the other node would not arrive,
> but I think it would.

Yes, indeed it would.

It is a common misunderstanding that mirroring is required in order for
clients to interact with the same queues when connecting to different
nodes in a cluster.

I *think* the second paragraph in 
https://www.rabbitmq.com/clustering.html makes it pretty clear that is 
not the case, but let us know if you have any suggestions on how to 
improve the wording there or elsewhere.

> Since our use case requires a temporary queue for each consumer, we
> don't need mirroring, just a cluster for fault tolerance. A node
> failure would cause the clients to reconnect and end up on the
> healthy node with new queues. There would be message loss, but
> that's ok in our usecase.

Yep, that is a fairly typical setup.

Matthias.

From sharathciddu at gmail.com  Thu Mar  6 20:02:15 2014
From: sharathciddu at gmail.com (Sharath)
Date: Thu, 6 Mar 2014 12:02:15 -0800 (PST)
Subject: [rabbitmq-discuss] Number of messages in a queue
Message-ID: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>

I am implementing a system where jobs are submitted to the RabbitMQ based 
'work queue' and the workers pick the jobs. 

However when the number of jobs in the queue are more than a certain 
number, I want to stop accepting any job submissions. I was wondering if 
there is any way using which we can get the number of messages/jobs in the 
queue and could you let me know the complexity of that call.

One idea is to using queue declare with passive as true, but I am not sure 
if this is the most optimal way to do it.

-Sharath
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/d7905092/attachment.html>

From mehmet at mehmetince.net  Thu Mar  6 22:09:10 2014
From: mehmet at mehmetince.net (Mehmet Dursun Ince)
Date: Thu, 6 Mar 2014 14:09:10 -0800 (PST)
Subject: [rabbitmq-discuss] Getting RPC response from multiple rpc server
Message-ID: <804e1f4e-73f0-4d6a-bcfb-b7301a2694ab@googlegroups.com>

Hi all

I've been trying to do that getting response from multiple rpc server for 
one message. I solved send a broadcast RPC message via *fanout* exchange. 
Each rpc server gets message. 

For instance;
when client send "1" only rpc_server.py returns. That's OKAY.
when client send "2" only rpc_server2.py returns. That's OKAY too.
But when client send "n" only first server returns. But i want to get 
response from both rpc server. i coded both server to send response for "n"

i cant figure out that how can i solve my issue so i attached my source 
code and screenshot.

i'm looking for some advice and tips from someone who tried to get message 
like me.

PS: if i'm sending this message to wrong mailing list. i'm sorry.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/3b83db57/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rpc_client.py
Type: text/x-python
Size: 1744 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/3b83db57/attachment.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rpc_server.py
Type: text/x-python
Size: 1260 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/3b83db57/attachment-0001.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rpc_server2.py
Type: text/x-python
Size: 1260 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/3b83db57/attachment-0002.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot from 2014-03-07 00:01:31.png
Type: image/png
Size: 210715 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/3b83db57/attachment.png>

From mariusz.wojcik at hotmail.co.uk  Thu Mar  6 23:56:24 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Thu, 6 Mar 2014 15:56:24 -0800 (PST)
Subject: [rabbitmq-discuss] New PowerShell cmdlets for managing RabbitMQ
Message-ID: <9f1bd6da-d553-44c3-b81d-f6664f0fad79@googlegroups.com>

Hi all,

   The new tool for managing RabbitMQ server(s) using PowerShell is 
available at https://github.com/mariuszwojcik/RabbitMQTools. It is free 
under MIT licence.
   Current version allows to 

   - view server overview
   - Opened connections and channels
   - View cluster nodes
   - get/add/remove virtual hosts
   - get/add/remove exchanges
   - get/add/remove queues
   - view messages in the queue. 

It works with local as well as remote server. 

Let me know what you think about it, and/or what features you would like to 
be added.

Cheers,

Mariusz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140306/00530a20/attachment.html>

From warrior2031 at gmail.com  Fri Mar  7 08:02:29 2014
From: warrior2031 at gmail.com (=?UTF-8?B?0JzQuNGF0LDQuNC7INCU0L7RgNC+0L3QuNC9?=)
Date: Fri, 7 Mar 2014 00:02:29 -0800 (PST)
Subject: [rabbitmq-discuss] Connection closed problem with python pika
Message-ID: <af618212-0725-434e-877b-3221b55661f9@googlegroups.com>

The details are in this post.

http://stackoverflow.com/questions/22192909/connection-closed-in-rabbitmq-for-some-reason-after-some-time
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/07e8c2f4/attachment.html>

From giovanni.foiani at gmail.com  Fri Mar  7 14:58:02 2014
From: giovanni.foiani at gmail.com (Giovanni Foiani)
Date: Fri, 7 Mar 2014 06:58:02 -0800 (PST)
Subject: [rabbitmq-discuss] Runtime change file descriptor and socket
	descriptios number
Message-ID: <f92b1016-f7d8-4434-9e64-2a623040c230@googlegroups.com>

Hi everybody, this is my first message on this mailing list.

I'd like to know if is possible to change file descriptors and socket 
descriptors number without restarting rabbitmq server?

Thanks

Giovanni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/60b5bbe3/attachment.html>

From giovanni.foiani at gmail.com  Fri Mar  7 16:32:48 2014
From: giovanni.foiani at gmail.com (Giovanni Foiani)
Date: Fri, 7 Mar 2014 08:32:48 -0800 (PST)
Subject: [rabbitmq-discuss] Reject persistent messages on a specific queue
Message-ID: <f16f1c78-b4fb-468f-b49b-13ce1575c8cc@googlegroups.com>

Hi everybody,

I'd like to know if is possible to force a queue to accept only non 
persistent messages and reject persistent ones.
I'm asking this because I read that persistent messages reduce RabbitMQ 
performace and I want to prevent clients to persist messages on specific 
queues.

Thanks,

Giovanni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140307/8c4dba85/attachment.html>

From royrusso at gmail.com  Sat Mar  8 15:07:39 2014
From: royrusso at gmail.com (Roy Russo)
Date: Sat, 8 Mar 2014 07:07:39 -0800 (PST)
Subject: [rabbitmq-discuss] Homebrew install = 404
Message-ID: <3f15a9df-bcb0-4e63-a422-d546e9a29248@googlegroups.com>

Hello,

I am receiving a 404 on the latest homebrew install, and it seems to be try 
to fetch an older version of rabbitmq.

loki:~ royrusso$ brew install rabbitmq

*==>** Downloading 
http://www.rabbitmq.com/releases/rabbitmq-server/v3.2.3/rabbitmq-server-mac-standalone-3.2.3.tar.gz*

curl: (22) The requested URL returned error: 404 Not Found

Error: Failed to download resource "rabbitmq"

Download failed: 
http://www.rabbitmq.com/releases/rabbitmq-server/v3.2.3/rabbitmq-server-mac-standalone-3.2.3.tar.gz

Thoughts?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140308/dfb0f126/attachment.html>

From davidr at spindance.com  Sat Mar  8 19:41:22 2014
From: davidr at spindance.com (David Rodriguez)
Date: Sat, 8 Mar 2014 11:41:22 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Cluster
Message-ID: <14d37968-6f1b-440c-9df6-04285be005fd@googlegroups.com>

Alright I am banging my head against the wall on this.  I am trying to 
configure a rabbitmq cluster with 3 nodes using RabbitMQ 3.2.3 .  I have 
verified that the cookies match on all of the server but I am still getting 
the following message when I try to cluster one node to another.  Error: 
{cannot_discover_cluster,"The nodes provided are either offline or not 
running"}  I verified that the epmd port is open and I also set the 
following parameter {kernel, [{inet_dist_listen_min, 
9100},{inet_dist_listen_max, 9105}]} and I have opened those ports on the 
firewall also.  All of the rabbitmq logs show no errors.  I am running 
CentOS 6.5.  Any ideas?  I have looked at various posts about this and have 
tried the suggestions and still nothing.  I can telnet amongst the nodes 
using their dns name to port 4369 .  I have checked another working cluster 
that we have and my configs appear to be the same.  

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140308/38168fdf/attachment.html>

From matthias at rabbitmq.com  Sun Mar  9 08:52:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 09 Mar 2014 08:52:31 +0000
Subject: [rabbitmq-discuss] Number of messages in a queue
In-Reply-To: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
References: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
Message-ID: <531C2BCF.1060305@rabbitmq.com>

On 06/03/14 20:02, Sharath wrote:
> I was wondering if there is any way [to] get the number of
> messages/jobs in the queue [...]
>
> One idea is to using queue declare with passive as true, but I am not
> sure if this is the most optimal way to do it.

It is.

Matthias.

From mklishin at gopivotal.com  Sun Mar  9 08:46:10 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 12:46:10 +0400
Subject: [rabbitmq-discuss] Number of messages in a queue
In-Reply-To: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
References: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
Message-ID: <B70BBCAA-DE4C-48D1-A21B-1748D4C9BB95@rabbitmq.com>


On 7 Mar 2014, at 00:02, Sharath <sharathciddu at gmail.com> wrote:

> One idea is to using queue declare with passive as true, but I am not sure if this is the most optimal way to do it.

It is. It?s not an expensive operation.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Mar  9 08:52:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 12:52:44 +0400
Subject: [rabbitmq-discuss] Connection closed problem with python pika
In-Reply-To: <af618212-0725-434e-877b-3221b55661f9@googlegroups.com>
References: <af618212-0725-434e-877b-3221b55661f9@googlegroups.com>
Message-ID: <71D5756B-07D3-44D0-AC4E-016AEA4FAA07@rabbitmq.com>

On 7 Mar 2014, at 12:02, ?????? ??????? <warrior2031 at gmail.com> wrote:

> The details are in this post.
> 
> http://stackoverflow.com/questions/22192909/connection-closed-in-rabbitmq-for-some-reason-after-some-time

Relevant log line: {heartbeat_timeout,running}.

Something prevents BlockingConnection from sending heartbeats, so RabbitMQ considers your client unreachable or dead. You have 3 options:

 * Avoid the blocking behaviour
 * Increase heartbeat interval
 * Try alternative connection implementations, e.g. Tornado.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Mar  9 08:55:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 12:55:07 +0400
Subject: [rabbitmq-discuss] Runtime change file descriptor and socket
	descriptios number
In-Reply-To: <f92b1016-f7d8-4434-9e64-2a623040c230@googlegroups.com>
References: <f92b1016-f7d8-4434-9e64-2a623040c230@googlegroups.com>
Message-ID: <0187134F-7D43-4078-B330-F2F8DB79EB7E@rabbitmq.com>

On 7 Mar 2014, at 18:58, Giovanni Foiani <giovanni.foiani at gmail.com> wrote:

> I'd like to know if is possible to change file descriptors and socket descriptors number without restarting rabbitmq server?

No, ulimit settings will only have effect after program restart.

MK

Software Engineer, Pivotal/RabbitMQ



From matthias at rabbitmq.com  Sun Mar  9 08:58:14 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 09 Mar 2014 08:58:14 +0000
Subject: [rabbitmq-discuss] Reject persistent messages on a specific
	queue
In-Reply-To: <f16f1c78-b4fb-468f-b49b-13ce1575c8cc@googlegroups.com>
References: <f16f1c78-b4fb-468f-b49b-13ce1575c8cc@googlegroups.com>
Message-ID: <531C2D26.3090400@rabbitmq.com>

Giovanni,

On 07/03/14 16:32, Giovanni Foiani wrote:
> I'd like to know if is possible to force a queue to accept only non
> persistent messages and reject persistent ones.
> I'm asking this because I read that persistent messages reduce RabbitMQ
> performace and I want to prevent clients to persist messages on specific
> queues.

Please read 
https://www.rabbitmq.com/tutorials/amqp-concepts.html#queue-durability, 
which explains that messages are only persisted if they are marked as 
such *and the queue is declared as 'durable'*. So simply declare the 
queue(s) as non-durable, though this does mean they need re-creating 
after a broker restart.

Matthias.

From mklishin at gopivotal.com  Sun Mar  9 08:56:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 12:56:51 +0400
Subject: [rabbitmq-discuss] Reject persistent messages on a specific
	queue
In-Reply-To: <f16f1c78-b4fb-468f-b49b-13ce1575c8cc@googlegroups.com>
References: <f16f1c78-b4fb-468f-b49b-13ce1575c8cc@googlegroups.com>
Message-ID: <8E1E841B-87BA-4DD4-BE2B-3571D2ED2125@rabbitmq.com>


On 7 Mar 2014, at 20:32, Giovanni Foiani <giovanni.foiani at gmail.com> wrote:

> I'd like to know if is possible to force a queue to accept only non persistent messages and reject persistent ones.

No.

> I'm asking this because I read that persistent messages reduce RabbitMQ performace and I want to prevent clients to persist messages on specific queues.

You?ll have to enforce this in your clients.

I?d recommend running some benchmarks before you decide to not use persistent messages.
The difference may be not significant enough for your workload or not as important as preserving
messages between node restarts.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Mar  9 08:58:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 12:58:18 +0400
Subject: [rabbitmq-discuss] Homebrew install = 404
In-Reply-To: <3f15a9df-bcb0-4e63-a422-d546e9a29248@googlegroups.com>
References: <3f15a9df-bcb0-4e63-a422-d546e9a29248@googlegroups.com>
Message-ID: <4475B5AF-C784-4036-B970-52DB7FABB1C7@rabbitmq.com>

On 8 Mar 2014, at 19:07, Roy Russo <royrusso at gmail.com> wrote:

> loki:~ royrusso$ brew install rabbitmq
> 
> ==> Downloading http://www.rabbitmq.com/releases/rabbitmq-server/v3.2.3/rabbitmq-server-mac-standalone-3.2.3.tar.gz
> 
> curl: (22) The requested URL returned error: 404 Not Found
> 
> Error: Failed to download resource "rabbitmq"
> 
> Download failed: http://www.rabbitmq.com/releases/rabbitmq-server/v3.2.3/rabbitmq-server-mac-standalone-3.2.3.tar.gz

The same URL works for 3.2.4, while older archives should be accessible, too,
the Homebrew formula needs to be updated to use 3.2.4.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Mar  9 09:09:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 13:09:23 +0400
Subject: [rabbitmq-discuss] Homebrew install = 404
In-Reply-To: <4475B5AF-C784-4036-B970-52DB7FABB1C7@rabbitmq.com>
References: <3f15a9df-bcb0-4e63-a422-d546e9a29248@googlegroups.com>
 <4475B5AF-C784-4036-B970-52DB7FABB1C7@rabbitmq.com>
Message-ID: <F2DEA717-C346-4B12-B9EB-3FF56066026C@gopivotal.com>

On 9 Mar 2014, at 12:58, Michael Klishin <mklishin at gopivotal.com> wrote:

> the Homebrew formula needs to be updated to use 3.2.4.

And it was less than a day ago:
https://github.com/Homebrew/homebrew/commit/3fbcdd0e3434bd9dd59a2e1b14b9e7cef3b14bef
--
MK

Software Engineer, Pivotal/RabbitMQ


From stammailbox at gmail.com  Sun Mar  9 09:13:44 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 9 Mar 2014 11:13:44 +0200
Subject: [rabbitmq-discuss] How to join two rabbitmq nodes on EC2?
In-Reply-To: <531B63AF.4040605@rabbitmq.com>
References: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>
 <531B63AF.4040605@rabbitmq.com>
Message-ID: <CAJ2-VrkXnJExqVO0Z_-SP-D69E__KFQr9vok+zw+yj=k01+RUg@mail.gmail.com>

Thanks. The problem remains.
I saw this section but I thought I wasn't suppose to configure the firewall
since I had a telnet to the remote.
but when recorded tcp when running the join cluster command and watched in
wireshark. I saw the following (no ack. )

http://i.imgur.com/PLezLvQ.png

[image: Inline image 2]


so I closed the firewall using
       sudo ufw disable
(just for the tests) and I re-typed
       sudo rabbitmqctl join_cluster --ram rabbit at ip-XX
and the connection was created - but terminated by the remote rabbit
here :
http://i.imgur.com/dxJLNfH.png

[image: Inline image 3]


and the message is still
"The nodes provided are either offline or not running"

(the remote rabbit app is definitely running)



On Sat, Mar 8, 2014 at 8:38 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 08/03/14 12:22, rails wrote:
>
>> I have two Ubuntu instances in the EC2 and I want to cluster them.
>> [...]
>>
>> So now I did the following on both machines.
>>  [...]
>>  3. opened the port for 5672 (rabbit) and 15672(management plugin)
>>
>
> That is not enough. See https://www.rabbitmq.com/clustering.html#firewall
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/2dd0b77c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 22115 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/2dd0b77c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 43149 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/2dd0b77c/attachment-0001.png>

From matthias at rabbitmq.com  Sun Mar  9 09:18:36 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 09 Mar 2014 09:18:36 +0000
Subject: [rabbitmq-discuss] How to join two rabbitmq nodes on EC2?
In-Reply-To: <CAJ2-VrkXnJExqVO0Z_-SP-D69E__KFQr9vok+zw+yj=k01+RUg@mail.gmail.com>
References: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>	<531B63AF.4040605@rabbitmq.com>
 <CAJ2-VrkXnJExqVO0Z_-SP-D69E__KFQr9vok+zw+yj=k01+RUg@mail.gmail.com>
Message-ID: <531C31EC.2020001@rabbitmq.com>

On 09/03/14 09:13, rails wrote:
> Thanks. The problem remains.
> the connection was created - but terminated by the remote rabbit

cookies? See https://www.rabbitmq.com/clustering.html#setup

Matthias.


From daniel at redbite.com  Sun Mar  9 09:45:12 2014
From: daniel at redbite.com (Daniel McGreal)
Date: Sun, 9 Mar 2014 09:45:12 +0000
Subject: [rabbitmq-discuss] Number of messages in a queue
In-Reply-To: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
References: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
Message-ID: <2C68D28D-C4BF-48C1-9017-536FF9F859F7@redbite.com>

http://www.rabbitmq.com/maxlength.html ?
I assume clients get a basic.reject from this.

On 6 Mar 2014, at 20:02, Sharath <sharathciddu at gmail.com> wrote:

> I am implementing a system where jobs are submitted to the RabbitMQ based 'work queue' and the workers pick the jobs. 
> 
> However when the number of jobs in the queue are more than a certain number, I want to stop accepting any job submissions. I was wondering if there is any way using which we can get the number of messages/jobs in the queue and could you let me know the complexity of that call.
> 
> One idea is to using queue declare with passive as true, but I am not sure if this is the most optimal way to do it.
> 
> -Sharath
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/a97eabac/attachment.html>

From matthias at rabbitmq.com  Sun Mar  9 10:00:45 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 09 Mar 2014 10:00:45 +0000
Subject: [rabbitmq-discuss] Number of messages in a queue
In-Reply-To: <2C68D28D-C4BF-48C1-9017-536FF9F859F7@redbite.com>
References: <9d2000f1-df58-4d22-af0f-d16ed3147e68@googlegroups.com>
 <2C68D28D-C4BF-48C1-9017-536FF9F859F7@redbite.com>
Message-ID: <531C3BCD.106@rabbitmq.com>

On 09/03/14 09:45, Daniel McGreal wrote:
> http://www.rabbitmq.com/maxlength.html ?
> I assume clients get a basic.reject from this.

No.

As that very link explains...
<quote>
Messages will be dropped or dead-lettered from the front of the queue to 
make room for new messages once the limit is reached.
</quote>

Matthias.

From royrusso at gmail.com  Sun Mar  9 14:41:04 2014
From: royrusso at gmail.com (Roy Russo)
Date: Sun, 9 Mar 2014 10:41:04 -0400
Subject: [rabbitmq-discuss] Homebrew install = 404
In-Reply-To: <F2DEA717-C346-4B12-B9EB-3FF56066026C@gopivotal.com>
References: <3f15a9df-bcb0-4e63-a422-d546e9a29248@googlegroups.com>
 <4475B5AF-C784-4036-B970-52DB7FABB1C7@rabbitmq.com>
 <F2DEA717-C346-4B12-B9EB-3FF56066026C@gopivotal.com>
Message-ID: <CANTOpgtHUppfx6a1FJixD2Tz9Kz1=NWt98=1xmJsiRZ8eEjRyg@mail.gmail.com>

Hi Michael,

Works now. Thanks!


On Sun, Mar 9, 2014 at 5:09 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 9 Mar 2014, at 12:58, Michael Klishin <mklishin at gopivotal.com> wrote:
>
> > the Homebrew formula needs to be updated to use 3.2.4.
>
> And it was less than a day ago:
>
> https://github.com/Homebrew/homebrew/commit/3fbcdd0e3434bd9dd59a2e1b14b9e7cef3b14bef
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>


-- 
Regards,
Roy Russo
404.453.9596
http://www.linkedin.com/in/royrusso
https://github.com/royrusso
http://www.royrusso.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/748e4b7b/attachment.html>

From stammailbox at gmail.com  Sun Mar  9 15:06:27 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 9 Mar 2014 17:06:27 +0200
Subject: [rabbitmq-discuss] How to join two rabbitmq nodes on EC2?
In-Reply-To: <531C31EC.2020001@rabbitmq.com>
References: <CAJ2-Vrm+PaSZnzaBkyxLaXfX34=QWGq-eJMwpt65jfBvvyFRGA@mail.gmail.com>
 <531B63AF.4040605@rabbitmq.com>
 <CAJ2-VrkXnJExqVO0Z_-SP-D69E__KFQr9vok+zw+yj=k01+RUg@mail.gmail.com>
 <531C31EC.2020001@rabbitmq.com>
Message-ID: <CAJ2-Vrm4LcEhbKB2dd6ERL=kS2wKtdu5Z3SdMrUMxgfuObHhxg@mail.gmail.com>

Nope,
(btw : I really did read this page before trying to configure.)
At the beginning I copied the cookie between the remote.
Then I even tried just to copy the string inside.
I restarted both remote ec2 computers many times (shutdown -r )
I still get

"The nodes provided are either offline or not running"

In addition I looked in the log "rabbit at ip-XX-XX-XX-XX.log" and under the
section
=INFO REPORT==== 9-Mar-2014::14:49:58 ===

I see the same cookie hash.

Any other idea?


On Sun, Mar 9, 2014 at 11:18 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 09/03/14 09:13, rails wrote:
>
>> Thanks. The problem remains.
>>
>> the connection was created - but terminated by the remote rabbit
>>
>
> cookies? See https://www.rabbitmq.com/clustering.html#setup
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/fe6805b5/attachment.html>

From stammailbox at gmail.com  Sun Mar  9 16:34:40 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 9 Mar 2014 18:34:40 +0200
Subject: [rabbitmq-discuss] Should multithreaded application use single or
	multi channels
Message-ID: <CAJ2-Vr=gsWcS_oQrM6mmjmpGytB=b2KrQMj7mw=uEweMnji1jg@mail.gmail.com>

My app has multiple threads that publish messages to a single RabbitMQ
cluster.
Reading the rabbit docs<https://www.rabbitmq.com/tutorials/amqp-concepts.html>:
i read the following:

For applications that use multiple threads/processes for processing, it is
very common to open a new channel per thread/process and not share channels
between them.

And I understand that instead of opening multiple connection (expensive)
it is better to open multiple channels.

But why not use a single channel to all threads?
What are the benefits of using multiple channels over a single channel?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/20a747c6/attachment.html>

From mklishin at gopivotal.com  Sun Mar  9 16:38:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 9 Mar 2014 20:38:49 +0400
Subject: [rabbitmq-discuss] Should multithreaded application use single
	or multi channels
In-Reply-To: <CAJ2-Vr=gsWcS_oQrM6mmjmpGytB=b2KrQMj7mw=uEweMnji1jg@mail.gmail.com>
References: <CAJ2-Vr=gsWcS_oQrM6mmjmpGytB=b2KrQMj7mw=uEweMnji1jg@mail.gmail.com>
Message-ID: <B41B4E3E-F0FB-4623-B15C-776793FD35A3@rabbitmq.com>


On 9 Mar 2014, at 20:34, rails <stammailbox at gmail.com> wrote:

> And I understand that instead of opening multiple connection (expensive)
> it is better to open multiple channels.

This is correct.

> But why not use a single channel to all threads?
> What are the benefits of using multiple channels over a single channel?

Because it is not safe to do so, in particular when you publish messages.
You will get incorrect frame interleaving when publishing from multiple threads
on a shared channel.

MK

Software Engineer, Pivotal/RabbitMQ



From jaishreegn at gmail.com  Sun Mar  9 16:51:05 2014
From: jaishreegn at gmail.com (Jayashree)
Date: Sun, 9 Mar 2014 10:51:05 -0600
Subject: [rabbitmq-discuss] RabbitMQ Cluster
In-Reply-To: <14d37968-6f1b-440c-9df6-04285be005fd@googlegroups.com>
References: <14d37968-6f1b-440c-9df6-04285be005fd@googlegroups.com>
Message-ID: <2F8D94FA-9D8F-4384-B2A6-62F45CF2F547@gmail.com>

The rabbitmq cluster I build are on Ubuntu. But if for nothing.. Here is what I would make sure are available for rabbitmq to cluster.
1. /etc/hosts must be edited to include host names and ip's of nodes you are trying to form cluster
2. Ensure .erlang.cookie is same on all nodes 
(This will be a random auto generated string when rabbitmq is installed) so edit it to have a common erang cookie across nodes
3. Edit rabbitmq config file to have the cluster nodes
4. Once you have the above steps done
Delete amnesia folder( this May or may not be required)
Restart service
Stop_app
Reset
Start_app

This should mostly work. As I have seen the exact error you have before and those steps mostly work.
You will find the steps in the rabbitmq cluster documentation page too.
Hope that helps! 

Jayashree

> On Mar 8, 2014, at 12:41 PM, David Rodriguez <davidr at spindance.com> wrote:
> 
> Alright I am banging my head against the wall on this.  I am trying to configure a rabbitmq cluster with 3 nodes using RabbitMQ 3.2.3 .  I have verified that the cookies match on all of the server but I am still getting the following message when I try to cluster one node to another.  Error: {cannot_discover_cluster,"The nodes provided are either offline or not running"}  I verified that the epmd port is open and I also set the following parameter {kernel, [{inet_dist_listen_min, 9100},{inet_dist_listen_max, 9105}]} and I have opened those ports on the firewall also.  All of the rabbitmq logs show no errors.  I am running CentOS 6.5.  Any ideas?  I have looked at various posts about this and have tried the suggestions and still nothing.  I can telnet amongst the nodes using their dns name to port 4369 .  I have checked another working cluster that we have and my configs appear to be the same.  
> 
> David
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sharathciddu at gmail.com  Sun Mar  9 18:14:17 2014
From: sharathciddu at gmail.com (Sharath)
Date: Sun, 9 Mar 2014 11:14:17 -0700 (PDT)
Subject: [rabbitmq-discuss] No response from RabbitMQ using queue_declare
	after 65511 responses
Message-ID: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>

Hi,

I am using the following code to test how fast queue_declare works.
After a while there are no responses back from the rabbitmq server 
(Precisely 65511). The rabbitmq server is working fine. 
What would the reason be behind this. I am attaching the code I am using to 
test it. Replace the server name appropriately.

I am sending around 1 request per millisecond.

var amqp = require('amqp');

var connection = amqp.createConnection({
host: 'xxxxxxxxx',
port: 5672,
login: 'guest',
password: 'xxxxxx',
vhost: '/'
});

// Wait for connection to become established.
connection.on('ready', function() {
console.log("Connection ready");
setInterval(checkSize, 1);
});

connection.on('error', function() {
console.log("Connection error");
});

var count = 0;
var callsMade = 0;
var callsResponseReceived = 0;

function checkSize() {
var time = (new Date()).getTime();
count++;
callsMade++;
console.log("Calls made",callsMade);
connection.queue('hippocrates', {
passive: true
}, function(a, b, c) {
callsResponseReceived++;
console.log("Calls response obtained",callsResponseReceived);
console.log("Times", (Utilities.getCurrentTime() - time), b, c, count);
});
}




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/0f0491f9/attachment.html>

From michael.s.klishin at gmail.com  Sun Mar  9 18:23:39 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 9 Mar 2014 22:23:39 +0400
Subject: [rabbitmq-discuss] No response from RabbitMQ using
 queue_declare after 65511 responses
In-Reply-To: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
References: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
Message-ID: <CAE3HoVTXSYmMHWJw_V-=A6xCVoQGMT=U57vh5F_qmzpiCO6oFg@mail.gmail.com>

2014-03-09 22:14 GMT+04:00 Sharath <sharathciddu at gmail.com>:

> I am using the following code to test how fast queue_declare works.
> After a while there are no responses back from the rabbitmq server
> (Precisely 65511). The rabbitmq server is working fine.
> What would the reason be behind this. I am attaching the code I am using
> to test it. Replace the server name appropriately.
>

What client do you use?


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/23c8566a/attachment.html>

From michael.s.klishin at gmail.com  Sun Mar  9 18:24:21 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 9 Mar 2014 22:24:21 +0400
Subject: [rabbitmq-discuss] No response from RabbitMQ using
 queue_declare after 65511 responses
In-Reply-To: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
References: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
Message-ID: <CAE3HoVSq9qqiFq8=BUYHgOV3-NbvEjmwKvcAzM+R40bAj1JBpw@mail.gmail.com>

2014-03-09 22:14 GMT+04:00 Sharath <sharathciddu at gmail.com>:

> I am using the following code to test how fast queue_declare works.
> After a while there are no responses back from the rabbitmq server
> (Precisely 65511). The rabbitmq server is working fine.
> What would the reason be behind this. I am attaching the code I am using
> to test it. Replace the server name appropriately.
>

What client do you use?


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/93d7b57a/attachment.html>

From marianogabriel at hotmail.com  Sun Mar  9 18:33:16 2014
From: marianogabriel at hotmail.com (mlabarinas)
Date: Sun, 9 Mar 2014 11:33:16 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ HA master/slave performance
Message-ID: <1394389996113-33979.post@n5.nabble.com>

Hi

I have a cluster with 5 nodes and sixty queues with HA enable with this
configuration:

ha-mode: exactly
ha-params: 3

each queue is on 3 nodes of my cluster. I recently had an accident with my
cluster (for network problems) and when my cluster came back to life all the
queue had taken the same master. I want to know if is better in terms of
performance have the queues distributed in different masters (I guess so)
instead of having them all on the same. I understand that the master
performs many tasks more than slaves.

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-HA-master-slave-performance-tp33979.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From sharathciddu at gmail.com  Sun Mar  9 18:42:21 2014
From: sharathciddu at gmail.com (Sharath Ciddu)
Date: Sun, 9 Mar 2014 11:42:21 -0700
Subject: [rabbitmq-discuss] No response from RabbitMQ using
 queue_declare after 65511 responses
In-Reply-To: <CAE3HoVSq9qqiFq8=BUYHgOV3-NbvEjmwKvcAzM+R40bAj1JBpw@mail.gmail.com>
References: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
 <CAE3HoVSq9qqiFq8=BUYHgOV3-NbvEjmwKvcAzM+R40bAj1JBpw@mail.gmail.com>
Message-ID: <CAEQ7=LK=ST481dMhhfmZYfq8XTS6Tyd_aYv6N1wijB=ZydOfbQ@mail.gmail.com>

Michael,

Thanks for your response.
I use amqp (https://github.com/postwait/node-amqp) in node.js

Sharath


On Sun, Mar 9, 2014 at 11:24 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2014-03-09 22:14 GMT+04:00 Sharath <sharathciddu at gmail.com>:
>
>> I am using the following code to test how fast queue_declare works.
>> After a while there are no responses back from the rabbitmq server
>> (Precisely 65511). The rabbitmq server is working fine.
>> What would the reason be behind this. I am attaching the code I am using
>> to test it. Replace the server name appropriately.
>>
>
> What client do you use?
>
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/a1488496/attachment.html>

From michael.s.klishin at gmail.com  Sun Mar  9 19:30:55 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 9 Mar 2014 23:30:55 +0400
Subject: [rabbitmq-discuss] No response from RabbitMQ using
 queue_declare after 65511 responses
In-Reply-To: <CAEQ7=LK=ST481dMhhfmZYfq8XTS6Tyd_aYv6N1wijB=ZydOfbQ@mail.gmail.com>
References: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
 <CAE3HoVSq9qqiFq8=BUYHgOV3-NbvEjmwKvcAzM+R40bAj1JBpw@mail.gmail.com>
 <CAEQ7=LK=ST481dMhhfmZYfq8XTS6Tyd_aYv6N1wijB=ZydOfbQ@mail.gmail.com>
Message-ID: <CAE3HoVTsV+iO-rL-7SG8REAOMAe5J-VxXS_HQ5jp-iua-Wo70w@mail.gmail.com>

2014-03-09 22:42 GMT+04:00 Sharath Ciddu <sharathciddu at gmail.com>:

> Thanks for your response.
> I use amqp (https://github.com/postwait/node-amqp) in node.js


I can't reproduce this issue using 2 clients (Bunny and Langohr).
Both create 131072 queues happily on a 3 year old machine.

So this is likely a client or environment-specific problem.
By the way, node-amqp is not actively maintained and is not recommended.
Use amqp.node [1].

1. https://github.com/squaremo/amqp.node/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/187b6ede/attachment.html>

From michael.s.klishin at gmail.com  Sun Mar  9 19:33:13 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 9 Mar 2014 23:33:13 +0400
Subject: [rabbitmq-discuss] RabbitMQ HA master/slave performance
In-Reply-To: <1394389996113-33979.post@n5.nabble.com>
References: <1394389996113-33979.post@n5.nabble.com>
Message-ID: <CAE3HoVQEGLHLHMk1DFC=6SuSS+aJA7NFOwwz6HMnNW6QcE=VAw@mail.gmail.com>

2014-03-09 22:33 GMT+04:00 mlabarinas <marianogabriel at hotmail.com>:

> I want to know if is better in terms of
> performance have the queues distributed in different masters
>

It is a good idea to have queue masters to be more evenly distributed
across nodes. As far as performance goes, what matters is what node
takes published messages and what node has the consumers for the queue(s)
the message is routed to. In other words, you want to achieve data locality
more than equal queue masters distribution.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/e6968f30/attachment.html>

From marianogabriel at hotmail.com  Sun Mar  9 19:49:53 2014
From: marianogabriel at hotmail.com (mlabarinas)
Date: Sun, 9 Mar 2014 12:49:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ HA master/slave performance
In-Reply-To: <CAE3HoVQEGLHLHMk1DFC=6SuSS+aJA7NFOwwz6HMnNW6QcE=VAw@mail.gmail.com>
References: <1394389996113-33979.post@n5.nabble.com>
 <CAE3HoVQEGLHLHMk1DFC=6SuSS+aJA7NFOwwz6HMnNW6QcE=VAw@mail.gmail.com>
Message-ID: <1394394593821-33983.post@n5.nabble.com>

First thanks for your answer.

But this is something that I don't control. Would I have to set my producers
to produce to a node (master maybe) and my consumers to consume in others
(slaves maybe)?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-HA-master-slave-performance-tp33979p33983.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Sun Mar  9 20:08:52 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 10 Mar 2014 00:08:52 +0400
Subject: [rabbitmq-discuss] RabbitMQ HA master/slave performance
In-Reply-To: <1394394593821-33983.post@n5.nabble.com>
References: <1394389996113-33979.post@n5.nabble.com>
 <CAE3HoVQEGLHLHMk1DFC=6SuSS+aJA7NFOwwz6HMnNW6QcE=VAw@mail.gmail.com>
 <1394394593821-33983.post@n5.nabble.com>
Message-ID: <CAE3HoVQQe6DfVmkf_jG0BAuPVprcHVhatsszA_0JQnNP_E3fcw@mail.gmail.com>

2014-03-09 23:49 GMT+04:00 mlabarinas <marianogabriel at hotmail.com>:

> But this is something that I don't control. Would I have to set my
> producers
> to produce to a node (master maybe) and my consumers to consume in others
> (slaves maybe)?
>

Best data locality is when you publish and consume from the master.

Some set up load balancers and make their clients connect to it.
This makes queue masters distribution more even and, in general, improves
data locality.

There are also projects that use HTTP API to discover queue masters and make
consumers connect to their respective nodes.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/eab9fd13/attachment.html>

From sharathciddu at gmail.com  Sun Mar  9 20:34:09 2014
From: sharathciddu at gmail.com (Sharath Ciddu)
Date: Sun, 9 Mar 2014 13:34:09 -0700
Subject: [rabbitmq-discuss] No response from RabbitMQ using
 queue_declare after 65511 responses
In-Reply-To: <CAE3HoVTsV+iO-rL-7SG8REAOMAe5J-VxXS_HQ5jp-iua-Wo70w@mail.gmail.com>
References: <b05b4a75-fa2a-4716-8d0b-9413387b4e03@googlegroups.com>
 <CAE3HoVSq9qqiFq8=BUYHgOV3-NbvEjmwKvcAzM+R40bAj1JBpw@mail.gmail.com>
 <CAEQ7=LK=ST481dMhhfmZYfq8XTS6Tyd_aYv6N1wijB=ZydOfbQ@mail.gmail.com>
 <CAE3HoVTsV+iO-rL-7SG8REAOMAe5J-VxXS_HQ5jp-iua-Wo70w@mail.gmail.com>
Message-ID: <CAEQ7=L+NpwKnD417XxGjkUZAr2oRc-JkEHtccVy3YgaCC7K4hg@mail.gmail.com>

Michael,

Thank you. I will try the amqp.node and see if that helps

Sharath


On Sun, Mar 9, 2014 at 12:30 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2014-03-09 22:42 GMT+04:00 Sharath Ciddu <sharathciddu at gmail.com>:
>
> Thanks for your response.
>> I use amqp (https://github.com/postwait/node-amqp) in node.js
>
>
> I can't reproduce this issue using 2 clients (Bunny and Langohr).
> Both create 131072 queues happily on a 3 year old machine.
>
> So this is likely a client or environment-specific problem.
> By the way, node-amqp is not actively maintained and is not recommended.
> Use amqp.node [1].
>
> 1. https://github.com/squaremo/amqp.node/
>  --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140309/458221e0/attachment.html>

From marianogabriel at hotmail.com  Sun Mar  9 22:04:04 2014
From: marianogabriel at hotmail.com (mlabarinas)
Date: Sun, 9 Mar 2014 15:04:04 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ HA master/slave performance
In-Reply-To: <CAE3HoVQQe6DfVmkf_jG0BAuPVprcHVhatsszA_0JQnNP_E3fcw@mail.gmail.com>
References: <1394389996113-33979.post@n5.nabble.com>
 <CAE3HoVQEGLHLHMk1DFC=6SuSS+aJA7NFOwwz6HMnNW6QcE=VAw@mail.gmail.com>
 <1394394593821-33983.post@n5.nabble.com>
 <CAE3HoVQQe6DfVmkf_jG0BAuPVprcHVhatsszA_0JQnNP_E3fcw@mail.gmail.com>
Message-ID: <1394402644284-33986.post@n5.nabble.com>

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-HA-master-slave-performance-tp33979p33986.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From joey.jiaojg at gmail.com  Mon Mar 10 08:03:32 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 10 Mar 2014 16:03:32 +0800
Subject: [rabbitmq-discuss] No need to log {amqp_error,
	not_found} during federation exchange.delete
Message-ID: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>

Hi,

=ERROR REPORT==== 7-Mar-2014::12:49:24 ===
connection , channel 2 - soft error:
{amqp_error,not_found,
"no exchange 'federation: amq.fanout ->
rabbit at baitweb-bd0001-lnx.qualcomm.com A' in vhost '/'",
'exchange.delete'}

I saw many ERROR of above one, I think
rabbit_federation_exchange_link:delete_upstream_exchange is the
contributor. I don't think it's necessary to log the federation exchange
delete error. Instead, we might can add a exchange_exist check before call
it?


-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/b79592f2/attachment.html>

From hkraemer at anynines.com  Mon Mar 10 08:54:16 2014
From: hkraemer at anynines.com (=?ISO-8859-1?Q?Heiko_Kr=E4mer?=)
Date: Mon, 10 Mar 2014 09:54:16 +0100
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
In-Reply-To: <531B71CD.7040003@rabbitmq.com>
References: <53184C43.5010000@anynines.com> <531B71CD.7040003@rabbitmq.com>
Message-ID: <531D7DB8.8000708@anynines.com>

Hi Matthias,

thanks for your answer!


From the node where the queue is present (according to the webinterface):
rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <-
processes(), begin {_, L} = process_info(P, message_queue_len), L > 0
end].'
[]
...done.


other node:

rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <-
processes(), begin {_, L} = process_info(P, message_queue_len), L > 0 end].'
Error: {badarg,[{erlang,process_info,[<4946.31251.352>,current_stacktrace]},
                {erl_eval,do_apply,5},
                {erl_eval,expr_list,6},
                {erl_eval,expr,5},
                {erl_eval,eval_lc1,6},
                {erl_eval,eval_generate,7},
                {erl_eval,eval_lc,6},
                {rpc,'-handle_call_call/6-fun-0-',5}]}



On the webinterface i can see the queue is 'Active' but they don't have
any consumers. I thought maybe is the webinterface db not working
correctly would have this an effect of the complete cluster because i
can't delete or whatever with this queue.


Cheers and thanks again.

Heiko



Am 08.03.2014 20:38, schrieb Matthias Radestock:
> rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <-
> processes(), begin {_, L} = process_info(P, message_queue_len), L > 0
> end].' 


-- 
anynines.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/b87d27b0/attachment.sig>

From mklishin at gopivotal.com  Mon Mar 10 08:58:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 10 Mar 2014 12:58:30 +0400
Subject: [rabbitmq-discuss] No need to log {amqp_error,
	not_found} during federation exchange.delete
In-Reply-To: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>
References: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>
Message-ID: <400C004B-1FF5-4939-BDCF-B8A236B8380E@rabbitmq.com>


On 10 Mar 2014, at 12:03, Joey Jiao <joey.jiaojg at gmail.com> wrote:

> =ERROR REPORT==== 7-Mar-2014::12:49:24 ===
> connection , channel 2 - soft error:
> {amqp_error,not_found,
> "no exchange 'federation: amq.fanout -> rabbit at baitweb-bd0001-lnx.qualcomm.com A' in vhost '/'",
> 'exchange.delete'}
> 
> I saw many ERROR of above one, I think rabbit_federation_exchange_link:delete_upstream_exchange is the contributor. I don't think it's necessary to log the federation exchange delete error. Instead, we might can add a exchange_exist check before call it?

As of RabbitMQ 3.2, exchange.delete is idempotent (there will be no error when you try to delete an exchange that does not exist).

Please upgrade.

MK

Software Engineer, Pivotal/RabbitMQ



From joey.jiaojg at gmail.com  Mon Mar 10 09:09:45 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 10 Mar 2014 17:09:45 +0800
Subject: [rabbitmq-discuss] No need to log {amqp_error,
 not_found} during federation exchange.delete
In-Reply-To: <400C004B-1FF5-4939-BDCF-B8A236B8380E@rabbitmq.com>
References: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>
 <400C004B-1FF5-4939-BDCF-B8A236B8380E@rabbitmq.com>
Message-ID: <CAKOmCvooWj-VmY3ve6-fpUbpupK5hZTjknggiWU0kUuZBVQbkQ@mail.gmail.com>

Thanks


2014-03-10 16:58 GMT+08:00 Michael Klishin <mklishin at gopivotal.com>:

>
> On 10 Mar 2014, at 12:03, Joey Jiao <joey.jiaojg at gmail.com> wrote:
>
> > =ERROR REPORT==== 7-Mar-2014::12:49:24 ===
> > connection , channel 2 - soft error:
> > {amqp_error,not_found,
> > "no exchange 'federation: amq.fanout ->
> rabbit at baitweb-bd0001-lnx.qualcomm.com A' in vhost '/'",
> > 'exchange.delete'}
> >
> > I saw many ERROR of above one, I think
> rabbit_federation_exchange_link:delete_upstream_exchange is the
> contributor. I don't think it's necessary to log the federation exchange
> delete error. Instead, we might can add a exchange_exist check before call
> it?
>
> As of RabbitMQ 3.2, exchange.delete is idempotent (there will be no error
> when you try to delete an exchange that does not exist).
>
> Please upgrade.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>


-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/995dc0b7/attachment.html>

From joey.jiaojg at gmail.com  Mon Mar 10 09:10:47 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Mon, 10 Mar 2014 17:10:47 +0800
Subject: [rabbitmq-discuss] No need to log {amqp_error,
 not_found} during federation exchange.delete
In-Reply-To: <CAKOmCvooWj-VmY3ve6-fpUbpupK5hZTjknggiWU0kUuZBVQbkQ@mail.gmail.com>
References: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>
 <400C004B-1FF5-4939-BDCF-B8A236B8380E@rabbitmq.com>
 <CAKOmCvooWj-VmY3ve6-fpUbpupK5hZTjknggiWU0kUuZBVQbkQ@mail.gmail.com>
Message-ID: <CAKOmCvr=cC6C4dd7SHYUWYKxY-B=RM8nQu4fDj0BnixW3-Lq9g@mail.gmail.com>

And does it mean the same for this error?

=ERROR REPORT==== 7-Mar-2014::12:49:16 ===
closing AMQP connection <0.31839.227> (baitweb-bd:41257 -> baitweb-sh:5672):
{inet_error,etimedout}


2014-03-10 17:09 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:

> Thanks
>
>
> 2014-03-10 16:58 GMT+08:00 Michael Klishin <mklishin at gopivotal.com>:
>
>
>> On 10 Mar 2014, at 12:03, Joey Jiao <joey.jiaojg at gmail.com> wrote:
>>
>> > =ERROR REPORT==== 7-Mar-2014::12:49:24 ===
>> > connection , channel 2 - soft error:
>> > {amqp_error,not_found,
>> > "no exchange 'federation: amq.fanout ->
>> rabbit at baitweb-bd0001-lnx.qualcomm.com A' in vhost '/'",
>> > 'exchange.delete'}
>> >
>> > I saw many ERROR of above one, I think
>> rabbit_federation_exchange_link:delete_upstream_exchange is the
>> contributor. I don't think it's necessary to log the federation exchange
>> delete error. Instead, we might can add a exchange_exist check before call
>> it?
>>
>> As of RabbitMQ 3.2, exchange.delete is idempotent (there will be no error
>> when you try to delete an exchange that does not exist).
>>
>> Please upgrade.
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>>
>
>
> --
> -Joey Jiao
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/f072b454/attachment.html>

From simon at rabbitmq.com  Mon Mar 10 09:47:18 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 09:47:18 +0000
Subject: [rabbitmq-discuss] No need to log {amqp_error,
 not_found} during federation exchange.delete
In-Reply-To: <CAKOmCvr=cC6C4dd7SHYUWYKxY-B=RM8nQu4fDj0BnixW3-Lq9g@mail.gmail.com>
References: <CAKOmCvrmoLKkKXCk4yP8k8k7C+=H9OTxTLKq_CLmuCKGYww4AQ@mail.gmail.com>
 <400C004B-1FF5-4939-BDCF-B8A236B8380E@rabbitmq.com>
 <CAKOmCvooWj-VmY3ve6-fpUbpupK5hZTjknggiWU0kUuZBVQbkQ@mail.gmail.com>
 <CAKOmCvr=cC6C4dd7SHYUWYKxY-B=RM8nQu4fDj0BnixW3-Lq9g@mail.gmail.com>
Message-ID: <531D8A26.30607@rabbitmq.com>

On 10/03/2014 09:10, Joey Jiao wrote:
> And does it mean the same for this error?
>
> =ERROR REPORT==== 7-Mar-2014::12:49:16 ===
> closing AMQP connection <0.31839.227> (baitweb-bd:41257 -> baitweb-sh:5672):
> {inet_error,etimedout}

No, that meanas there was a timeout at the TCP level.

Cheers, Simon

From simon at rabbitmq.com  Mon Mar 10 09:54:19 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 09:54:19 +0000
Subject: [rabbitmq-discuss] Exclusive queues and mirroring
In-Reply-To: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
References: <CAPZS+nk+Ve78ef4AspmhUSCACrD-geHNxYb+Y6R4Cb+hH2YEwA@mail.gmail.com>
Message-ID: <531D8BCB.6060306@rabbitmq.com>

On 08/03/2014 00:21, Jonathan Holland wrote:
> When we enable exclusive and autodelete, the queue no longer mirrors.

Since nobody else mentioned this in in thread: when you mark a queue as 
exclusive, we disable mirroring (and durability) as of 3.2.0. This is 
because when the queue's node goes down the connection will be closed 
anyway, so we have to delete the queue. Therefore there's no point in it 
being durable or mirrored.

As previously mentioned in the thread though, I think you were looking 
for autodelete semantics. And maybe didn't need miroring at all :-)

Cheers, Simon

From dmitry.andrianov at alertme.com  Mon Mar 10 10:00:58 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 10 Mar 2014 10:00:58 +0000
Subject: [rabbitmq-discuss] debug logging
Message-ID: <531D8D5A.9050907@alertme.com>

Hello.
What is the correct way of logging some debug information in the 
RabbitMQ server / plugins?
At the moment I am using rabbit_log:info but I would like to lower level 
a bit so it won't get logged on production machines.
I tried rabbit_log:debug and it compiled ok but at runtime it produces 
{error,undef,... error.

Thanks
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From videlalvaro at gmail.com  Mon Mar 10 10:29:48 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 10 Mar 2014 11:29:48 +0100
Subject: [rabbitmq-discuss] Getting RPC response from multiple rpc server
In-Reply-To: <804e1f4e-73f0-4d6a-bcfb-b7301a2694ab@googlegroups.com>
References: <804e1f4e-73f0-4d6a-bcfb-b7301a2694ab@googlegroups.com>
Message-ID: <CAMcAHLXptVOCdzLVbw4kQo3xNCti=qy97p1GyG1gifddh6esag@mail.gmail.com>

Hi,

The problem seems to be in your rpc_client.py file.

In the line that says "while self.response is None:"

As soon as you get a reply, that will evaluate to True and then you
will miss the other reply.

If you are expecting more than one reply from the RPC server, then you
should keep the correlation ids in some sort of array/list/map.
Whatever is used in Python. Then you would match the correlation_id on
the incoming messages, with the correlation ids kept in the array.

Regards,

Alvaro





On Thu, Mar 6, 2014 at 11:09 PM, Mehmet Dursun Ince
<mehmet at mehmetince.net> wrote:
> Hi all
>
> I've been trying to do that getting response from multiple rpc server for
> one message. I solved send a broadcast RPC message via fanout exchange. Each
> rpc server gets message.
>
> For instance;
> when client send "1" only rpc_server.py returns. That's OKAY.
> when client send "2" only rpc_server2.py returns. That's OKAY too.
> But when client send "n" only first server returns. But i want to get
> response from both rpc server. i coded both server to send response for "n"
>
> i cant figure out that how can i solve my issue so i attached my source code
> and screenshot.
>
> i'm looking for some advice and tips from someone who tried to get message
> like me.
>
> PS: if i'm sending this message to wrong mailing list. i'm sorry.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.s.klishin at gmail.com  Mon Mar 10 10:33:50 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 10 Mar 2014 14:33:50 +0400
Subject: [rabbitmq-discuss] debug logging
In-Reply-To: <531D8D5A.9050907@alertme.com>
References: <531D8D5A.9050907@alertme.com>
Message-ID: <CAE3HoVRD3wHF4mkJydSiQLcks9HpWAZ=4VRD1XYchMKuCxg9nw@mail.gmail.com>

2014-03-10 14:00 GMT+04:00 Dmitry Andrianov <dmitry.andrianov at alertme.com>:

> What is the correct way of logging some debug information in the RabbitMQ
> server / plugins?
> At the moment I am using rabbit_log:info but I would like to lower level a
> bit so it won't get logged on production machines.
> I tried rabbit_log:debug and it compiled ok but at runtime it produces
> {error,undef,... error.
>

rabbit_log only has info, warning, and error.

RabbitMQ logging is not currently very configurable,
see log_levels in https://www.rabbitmq.com/configure.html.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/7966ddec/attachment.html>

From videlalvaro at gmail.com  Mon Mar 10 10:58:14 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 10 Mar 2014 11:58:14 +0100
Subject: [rabbitmq-discuss] New PowerShell cmdlets for managing RabbitMQ
In-Reply-To: <9f1bd6da-d553-44c3-b81d-f6664f0fad79@googlegroups.com>
References: <9f1bd6da-d553-44c3-b81d-f6664f0fad79@googlegroups.com>
Message-ID: <CAMcAHLWgnQAEB7X5jJ7LJPm_FGDAK_kJ5-4sTaNEQw_9fGjnGQ@mail.gmail.com>

Great. I've added your tool to this page: http://www.rabbitmq.com/devtools.html

-Alvaro

On Fri, Mar 7, 2014 at 12:56 AM, Mariusz Wojcik
<mariusz.wojcik at hotmail.co.uk> wrote:
> Hi all,
>
>    The new tool for managing RabbitMQ server(s) using PowerShell is
> available at https://github.com/mariuszwojcik/RabbitMQTools. It is free
> under MIT licence.
>    Current version allows to
>
> view server overview
> Opened connections and channels
> View cluster nodes
> get/add/remove virtual hosts
> get/add/remove exchanges
> get/add/remove queues
> view messages in the queue.
>
> It works with local as well as remote server.
>
>
> Let me know what you think about it, and/or what features you would like to
> be added.
>
> Cheers,
>
> Mariusz
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Mon Mar 10 11:00:52 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 11:00:52 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>
References: <5319FEDA.4040201@alertme.com> <531A05A2.6020606@rabbitmq.com>
 <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>
Message-ID: <531D9B64.3020308@rabbitmq.com>

On 08/03/2014 11:17AM, Dmitry Andrianov wrote:
> When you say Rabbit will gracefully stop accepting connections when
> ulimit is reached, are you talking about some action explicitly done
> by Rabbit itself when it sees limit approaching or is everything done
> by the OS?

It's dome by RabbitMQ explicitly - since FDs are shared across sockets 
and files we don't want to hit the OS FD limit in the middle of a file 
operation, so we stop accepting new connections before that happens.

> If Rabbit does something - doesn't it make sense to do the same when
> memory is running low?

Again, as mentioned, if we did that and memory had filled up with 
messages we might hit a situation where progress is impossible - the 
broker is full of messages but clients can't connect to consume them.

> i will of course follow your advice and play with ulimit but it does
> not feel very reliable - even if I find ulimit value which works in
> that specific test case, it may stop working when message size
> changes.

Well, the memory alarm system is agnostic to how many messages are in 
the broker and what proportion of available memory they use. You just 
need to set your ulimit low enough that you can't cause the memory limit 
to be breached purely with connections.

> Regarding plugin memory - it worth mentioning that we have couple of
> custom plugins including a custom authentication backend. Can these
> be the root cause? Is there anything that needs to be explicitly done
> by the plugin developer to make sure the memory is accounted
> correctly?

There shouldn't be, no. But thanks for that information; I will be 
investigating this today and it might prove useful.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Shashank.Lothe at techmahindra.com  Mon Mar 10 11:45:45 2014
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Mon, 10 Mar 2014 11:45:45 +0000
Subject: [rabbitmq-discuss] rabbitmq-c APIs hanging during network down
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C991D14B@BSDMSATMBX001.mahindrasatyam.ad>

Hi,

I am using rabbitmq-c v0.4.1. I have tested behaviour of amqp_simple_wait_frame_noblock() and amqp_basic_publish() API. When these APIs are in execution and suddenly if the network connection is lost (router switch off), these APIs hangs. I would request to raise this as a bug in the library.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/06706d0a/attachment.html>

From wowon01 at gmail.com  Mon Mar 10 11:46:53 2014
From: wowon01 at gmail.com (Bino Oetomo)
Date: Mon, 10 Mar 2014 04:46:53 -0700 (PDT)
Subject: [rabbitmq-discuss] trying to porting to openwrt
Message-ID: <1dda830b-e86c-4bc2-84eb-e55087e6f6ea@googlegroups.com>

Dear All ...

I'm trying to run rabbitmq on RouterBoard with OpenWrt.

My step is :
1. Try to build rabbitmq , wit5h some flag adjustmen per 
http://wiki.openwrt.org/doc/devel/crosscompile 
2.  download a copy of RabbitMQ for generic linux from 
https://www.rabbitmq.com/releases/rabbitmq-server/v3.2.4/rabbitmq-server-generic-unix-3.2.4.tar.gz 
, extract it to another directory .. and replace it content with results 
from step #1
3. scp -r the directory to my openwrt router. ---> /root/rbmq01.

4. at the openwrt router , try to run :
cd /root/rbmq01
./sbin/rabbitmq-server

Got some error :
Slogan: Kernel pid terminated (application_controller) 
({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Error 
when reading /root/.erlang.c

I post generated crash dump at http://pastebin.com/KNTXE8wS

Kindly please give me any enlightenment on how to fix this.

Sincerely
-bino-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/86c3b571/attachment.html>

From simon at rabbitmq.com  Mon Mar 10 12:18:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 12:18:24 +0000
Subject: [rabbitmq-discuss] OOM kill
In-Reply-To: <531D9B64.3020308@rabbitmq.com>
References: <5319FEDA.4040201@alertme.com> <531A05A2.6020606@rabbitmq.com>
 <AB272810-DDAD-4D3A-8201-D8DFC2652F7D@alertme.com>
 <531D9B64.3020308@rabbitmq.com>
Message-ID: <531DAD90.9090706@rabbitmq.com>

On 10/03/2014 11:00AM, Simon MacMullen wrote:
>> Regarding plugin memory - it worth mentioning that we have couple of
>> custom plugins including a custom authentication backend. Can these
>> be the root cause? Is there anything that needs to be explicitly done
>> by the plugin developer to make sure the memory is accounted
>> correctly?
>
> There shouldn't be, no. But thanks for that information; I will be
> investigating this today and it might prove useful.

Actually this was just a bug, which is now fixed. Thank you for pointing 
it out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Mar 10 12:23:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 12:23:27 +0000
Subject: [rabbitmq-discuss] trying to porting to openwrt
In-Reply-To: <1dda830b-e86c-4bc2-84eb-e55087e6f6ea@googlegroups.com>
References: <1dda830b-e86c-4bc2-84eb-e55087e6f6ea@googlegroups.com>
Message-ID: <531DAEBF.7080102@rabbitmq.com>

On 10/03/2014 11:46AM, Bino Oetomo wrote:
> I'm trying to run rabbitmq on RouterBoard with OpenWrt.
>
> My step is :
> 1. Try to build rabbitmq , wit5h some flag adjustmen per
> http://wiki.openwrt.org/doc/devel/crosscompile
> 2.  download a copy of RabbitMQ for generic linux from
> https://www.rabbitmq.com/releases/rabbitmq-server/v3.2.4/rabbitmq-server-generic-unix-3.2.4.tar.gz
> , extract it to another directory .. and replace it content with results
> from step #1

RabbitMQ contains no native code; it's all platform-independent 
bytecode. So you should not need to do anything special, the generic 
unix package should just work. (That's why it doesn't mention an 
architecture!)

> "Error  when reading /root/.erlang.c

Normally Erlang apps will attempt to read ~/.erlang.cookie at startup. I 
am assuming this error message has been truncated.

Are you running RabbitMQ as root? Does it have permission to read this 
file? Could $HOME be set incorrectly?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Mon Mar 10 12:32:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 10 Mar 2014 16:32:01 +0400
Subject: [rabbitmq-discuss] Lingering temporary queues in 3.2.3
In-Reply-To: <ADE62FEF-DA98-4CBC-809D-C15FEA609E69@jefftrout.com>
References: <9D5ECADE-65CE-494C-B14E-E3DC0592EACD@jefftrout.com>
 <CAE3HoVQ4F9Wc3OWC89DtSAgw6_DUuhCOMq-1nSjfwdOQhiNLFw@mail.gmail.com>
 <ADE62FEF-DA98-4CBC-809D-C15FEA609E69@jefftrout.com>
Message-ID: <E59976EA-3551-41E3-BF01-3CC8EDEFE6C0@rabbitmq.com>


On 3 Mar 2014, at 23:54, Jeff <jeff at jefftrout.com> wrote:

> If that is the case (which it looks like), then where did the ?hi mom? message end up? the queue is empty. 

I?d need to investigate this but my guess is that RabbitMQ STOMP plugin assumes queue names
are not empty and publishes the message with routing key = ??, which goes nowhere.

Either way, the right thing to do would be to reject publishes to queues named ?? in the STOMP plugin.

MK

Software Engineer, Pivotal/RabbitMQ



From iain.hull at workday.com  Mon Mar 10 12:55:48 2014
From: iain.hull at workday.com (Iain Hull)
Date: Mon, 10 Mar 2014 12:55:48 +0000
Subject: [rabbitmq-discuss] Fwd: Sensitive data in the RabbitMQ log files
In-Reply-To: <CANum3oUgbnRhPnO-LjQXCvSKAPySSdOtx=V_Gohzm-_VJAxgOA@mail.gmail.com>
References: <CANum3oUgbnRhPnO-LjQXCvSKAPySSdOtx=V_Gohzm-_VJAxgOA@mail.gmail.com>
Message-ID: <CANum3oXJxWWCZb2HbHvF_omWQMyKARVTPg9r=n0ysj3gT_XGSw@mail.gmail.com>

Hi,

I would like to know if the rabbitmq log files could contain sensitive data.

In our deployment we regard the names of queues and exchanges as sensitive,
so could these appear in the standard rabbitmq logs?

Also could rabbitmq usernames appear in the sasl log?

Thanks,
Iain.

-- 
Iain Hull
Senior Software Engineer
iain.hull.workday (Skype)
iain.hull at workday.com

<http://www.workday.com/signature-rising-eu>



-- 
Iain Hull
Senior Software Engineer
iain.hull.workday (Skype)
iain.hull at workday.com

<http://www.workday.com/signature-rising-eu>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/942481ba/attachment.html>

From simon at rabbitmq.com  Mon Mar 10 14:56:13 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 14:56:13 +0000
Subject: [rabbitmq-discuss] Fwd: Sensitive data in the RabbitMQ log files
In-Reply-To: <CANum3oXJxWWCZb2HbHvF_omWQMyKARVTPg9r=n0ysj3gT_XGSw@mail.gmail.com>
References: <CANum3oUgbnRhPnO-LjQXCvSKAPySSdOtx=V_Gohzm-_VJAxgOA@mail.gmail.com>
 <CANum3oXJxWWCZb2HbHvF_omWQMyKARVTPg9r=n0ysj3gT_XGSw@mail.gmail.com>
Message-ID: <531DD28D.2070407@rabbitmq.com>

On 10/03/2014 12:55PM, Iain Hull wrote:
> I would like to know if the rabbitmq log files could contain sensitive data.
>
> In our deployment we regard the names of queues and exchanges as
> sensitive, so could these appear in the standard rabbitmq logs?

Under those definitions then yes, names of queues and exchanges can 
certainly appear in the logs. For example, just declare a queue with 
durable=true and then attempt to redeclare it with durable=false; you'll 
get an error logged containing the name of the queue.

> Also could rabbitmq usernames appear in the sasl log?

The sasl log is a log for misbehaving processes. ("sasl" is this: 
http://www.erlang.org/doc/apps/sasl/ not this: 
http://tools.ietf.org/html/rfc4422). As such it could contain data from 
any process that crashed - including usernames and even passwords if you 
are unlucky.

You should really treat access to the log files as privileged in the 
same way as access to the server OS process.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From stammailbox at gmail.com  Mon Mar 10 15:40:02 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 10 Mar 2014 17:40:02 +0200
Subject: [rabbitmq-discuss] Configuring cluster rabbitMQ on EC2
Message-ID: <CAJ2-Vr=s03NfU2hOhfnox2woh5UJovAfXq4O5Tpp8-2TNT2FUg@mail.gmail.com>

Hi,
I followed closely the rabbitmq clustering
documentation<https://www.rabbitmq.com/clustering.html>on the site but
failed for a full day to generate a cluster on EC2.
I frequently got "The nodes provided are either offline or not running"
(Though I had a telnet and my cookie was the same).

Eventually I solved it by recording the TCP communication (upon
join_cluster command) and reading it )



I saw that after the triple handshake when the first node connects to the
second,
a packet contains a new port is transferred

http://i.imgur.com/FN7r2as.png


So, I really don't know what it is but I tried to open it in my security
group (the firewall is down anyhow, but I need to update the port in EC2
Security Group)
and finally after a lot of trials it worked.


My questions :
1. What is this port.
2. Is it a random port? How do I set it so I can control it?
3. Was I missing it in the clustering
guide<https://www.rabbitmq.com/clustering.html>?
It is kinda important. I couldnt find any document related to the rabbitmq
clustering and this port.


4. I did find some stuff regarding clustering erlang.
<http://www.erlang.org/faq/how_do_i.html#id55090>and it mentioned
setting inet_dist_listen_min and inet_dist_listen_max. Is this it?
5. I need to set  it using

application:set_env(kernel, inet_dist_listen_min, 9100).
application:set_env(kernel, inet_dist_listen_max, 9105).

How do I run configure this lines?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/deab98b6/attachment.html>

From aapte at zynga.com  Mon Mar 10 15:43:42 2014
From: aapte at zynga.com (Ajinkya Apte)
Date: Mon, 10 Mar 2014 15:43:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ: Different consumer technique
Message-ID: <0CD7AABA-5369-4763-9C26-FDD568679A47@zynga.com>

(First time user of RabbitMQ)
Hey,
Technique:
Rather than writing a standalone PHP consumer script that keeps consuming the queue, I was planning on writing a batch get and quit PHP script. All that script does is get a batch of 10 from the queue, if the batch isn't available the script immediately exits. If available, it processes the batch and quits. I use a python script to make multiple calls to my 'Get Batch script' and make use of apache workers to do the work rather than making the php standalone script do the work. 

Questions:
1. Firstly, do you see a reason why I should not think about consuming the queue this way?
2. (I am using the amq php lib) How can I do a batch get and exit if the batch is not present. With what I have learnt seems like I can set the qos to my batch count and use batch_consume for this. But if the batch is not available the script seems to wait till the batch is available. Is there a way I can timeout? 
3. Do you have any usage recommendation for me?
4. Any plans of having basic.get_batch?

AJ

Sent from my iPhone


From christian.riesen at liip.ch  Mon Mar 10 13:53:58 2014
From: christian.riesen at liip.ch (Christian Riesen)
Date: Mon, 10 Mar 2014 14:53:58 +0100
Subject: [rabbitmq-discuss] Managing consumers (PHP, Symfony2, Capifony)
Message-ID: <CAAxb4heKUKOGO84ie0NLUGXMG34jrHBf_iN5LAxT9CNZtuNbMQ@mail.gmail.com>

Hello everyone

I'm using RabbitMQ over
https://github.com/videlalvaro/RabbitMqBundlewithin the Symfony2 PHP
framework, which in turn uses
https://github.com/videlalvaro/php-amqplib of course.

I have imports to run that do a lot of traffic for about 3 hours per day
and the rest of the day do nothing. RabbitMQ is used to parallelize the
imports (raw data dumped in, processed data is written into storage).

The goal is to have 5 consumers start and in case one dies, automatically
restarted, but always only 5 of them running at the same time. They all run
the same queue and exchange, though that could be different in the future.

I was thinking of using a cronjob that checks every 5 minutes if something
is in the queue (still looking how to see that properly). If there is, it
checks if consumers are running and enough of them, and if not start them
since there are some needed. I'd use the idle timeout feature of the bundle
to shut down the consumers again if there is nothing to do anymore.

We use capifony to deploy our application. Capifony deploys to a folder
like /dir/release/1/ and /dir/release/2/ then sets a symlink from
/dir/current/ to the actual release directory 1 or 2. So the cronjob idea
works well as it would switch to the current deployed version if I point it
to the consumer in the "current" directory. Now I look for a bit a more in
depth way to do this, as I want the workers of the old version stopped when
I deploy. With the cronjob they would start on their own in the right
version of course. The setup runs on a Linux box, so anything I can use on
there would be highly helpful.

To make everything a bit more interesting, I need a sort of locking system.
The queue is one, but multiple producers can fill it up. Then I have to
wait until all the parts in the queue are finished before I can start a
second set of import tasks (that relies on data from the first set). My
current approach was to just monitor the queue and wait for it to empty.
Once the system sees it empty (not 100% sure how to see that yet with the
present tools) it would start the next batch of imports.

This setup I described is not how it has to be, but just my current path of
thinking on how to do it. I'd appreciate alternatives on how to do it. Any
pointers and posts that could help me with one or multiple of these topics
are much appreciated.

Greetings,
Christian Riesen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/0a8a5376/attachment.html>

From mcintoshj at gmail.com  Mon Mar 10 16:15:44 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 10 Mar 2014 11:15:44 -0500
Subject: [rabbitmq-discuss] RabbitMQ: Different consumer technique
In-Reply-To: <0CD7AABA-5369-4763-9C26-FDD568679A47@zynga.com>
References: <0CD7AABA-5369-4763-9C26-FDD568679A47@zynga.com>
Message-ID: <CAD6m6fEHibKKY=CsJ_i2AviOxCQy7gZPXCJ=KE32Are6_ze7WA@mail.gmail.com>

Seems like a lot of heavy lifting for a consumer process.  If you use the
alternative where rabbit pushes changes to your consumer (instead of
basic_get), then rabbit will push new messages as they come in to your
consumer, and the consumer will be idle otherwise using minimal resources.
 For "basic.get_batch" - that's exactly what the prefetch count does on
consumers - get 10 messages at once and process them.  Is there some
particularly need to wrap it in all the extra layers?
Jason


On Mon, Mar 10, 2014 at 10:43 AM, Ajinkya Apte <aapte at zynga.com> wrote:

> (First time user of RabbitMQ)
> Hey,
> Technique:
> Rather than writing a standalone PHP consumer script that keeps consuming
> the queue, I was planning on writing a batch get and quit PHP script. All
> that script does is get a batch of 10 from the queue, if the batch isn't
> available the script immediately exits. If available, it processes the
> batch and quits. I use a python script to make multiple calls to my 'Get
> Batch script' and make use of apache workers to do the work rather than
> making the php standalone script do the work.
>
> Questions:
> 1. Firstly, do you see a reason why I should not think about consuming the
> queue this way?
> 2. (I am using the amq php lib) How can I do a batch get and exit if the
> batch is not present. With what I have learnt seems like I can set the qos
> to my batch count and use batch_consume for this. But if the batch is not
> available the script seems to wait till the batch is available. Is there a
> way I can timeout?
> 3. Do you have any usage recommendation for me?
> 4. Any plans of having basic.get_batch?
>
> AJ
>
> Sent from my iPhone
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/5150b332/attachment.html>

From simon at rabbitmq.com  Mon Mar 10 16:16:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Mar 2014 16:16:57 +0000
Subject: [rabbitmq-discuss] Configuring cluster rabbitMQ on EC2
In-Reply-To: <CAJ2-Vr=s03NfU2hOhfnox2woh5UJovAfXq4O5Tpp8-2TNT2FUg@mail.gmail.com>
References: <CAJ2-Vr=s03NfU2hOhfnox2woh5UJovAfXq4O5Tpp8-2TNT2FUg@mail.gmail.com>
Message-ID: <531DE579.9000102@rabbitmq.com>

On 10/03/2014 3:40PM, rails wrote:
> My questions :
> 1. What is this port.
> 2. Is it a random port? How do I set it so I can control it?
> 3. Was I missing it in the clustering guide
> <https://www.rabbitmq.com/clustering.html>? It is kinda important. I
> couldnt find any document related to the rabbitmq clustering and this port.

See "Firewalled nodes": https://www.rabbitmq.com/clustering.html#firewall

> 4. I did find some stuff regarding clustering erlang.
> <http://www.erlang.org/faq/how_do_i.html#id55090>and it mentioned
> setting inet_dist_listen_min and inet_dist_listen_max. Is this it?
> 5. I need to set  it using
>
> application:set_env(kernel, inet_dist_listen_min, 9100).
> application:set_env(kernel, inet_dist_listen_max, 9105).

Yes, that's the same thing as documented above.

> How do I run configure this lines?
> Thanks.

See the link above.

Really this should be easier though :(

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From videlalvaro at gmail.com  Mon Mar 10 16:26:41 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 10 Mar 2014 17:26:41 +0100
Subject: [rabbitmq-discuss] Managing consumers (PHP, Symfony2, Capifony)
In-Reply-To: <CAAxb4heKUKOGO84ie0NLUGXMG34jrHBf_iN5LAxT9CNZtuNbMQ@mail.gmail.com>
References: <CAAxb4heKUKOGO84ie0NLUGXMG34jrHBf_iN5LAxT9CNZtuNbMQ@mail.gmail.com>
Message-ID: <CAMcAHLUce4EVtcYa06j3YB-0_bnahCeghLzvuwdfKq3ng2SVVQ@mail.gmail.com>

Hi,

Others might comment on this, but so far I've seen that people use the
bundle together with supervisord: http://supervisord.org/

About start publishing once a set of tasks has been completed, your
publisher could listen on a queue X, and when one of your workers
consume the last message, it could publish a "done" message back in
the queue X. That way, your producer would know that it can continue
sending the new set of tasks.

About knowing the number of messages in the queue:  you can do that by
sending a passive queue declare, or by using the HTTP management API.

Regards,

Alvaro

On Mon, Mar 10, 2014 at 2:53 PM, Christian Riesen
<christian.riesen at liip.ch> wrote:
> Hello everyone
>
> I'm using RabbitMQ over https://github.com/videlalvaro/RabbitMqBundle within
> the Symfony2 PHP framework, which in turn uses
> https://github.com/videlalvaro/php-amqplib of course.
>
> I have imports to run that do a lot of traffic for about 3 hours per day and
> the rest of the day do nothing. RabbitMQ is used to parallelize the imports
> (raw data dumped in, processed data is written into storage).
>
> The goal is to have 5 consumers start and in case one dies, automatically
> restarted, but always only 5 of them running at the same time. They all run
> the same queue and exchange, though that could be different in the future.
>
> I was thinking of using a cronjob that checks every 5 minutes if something
> is in the queue (still looking how to see that properly). If there is, it
> checks if consumers are running and enough of them, and if not start them
> since there are some needed. I'd use the idle timeout feature of the bundle
> to shut down the consumers again if there is nothing to do anymore.
>
> We use capifony to deploy our application. Capifony deploys to a folder like
> /dir/release/1/ and /dir/release/2/ then sets a symlink from /dir/current/
> to the actual release directory 1 or 2. So the cronjob idea works well as it
> would switch to the current deployed version if I point it to the consumer
> in the "current" directory. Now I look for a bit a more in depth way to do
> this, as I want the workers of the old version stopped when I deploy. With
> the cronjob they would start on their own in the right version of course.
> The setup runs on a Linux box, so anything I can use on there would be
> highly helpful.
>
> To make everything a bit more interesting, I need a sort of locking system.
> The queue is one, but multiple producers can fill it up. Then I have to wait
> until all the parts in the queue are finished before I can start a second
> set of import tasks (that relies on data from the first set). My current
> approach was to just monitor the queue and wait for it to empty. Once the
> system sees it empty (not 100% sure how to see that yet with the present
> tools) it would start the next batch of imports.
>
> This setup I described is not how it has to be, but just my current path of
> thinking on how to do it. I'd appreciate alternatives on how to do it. Any
> pointers and posts that could help me with one or multiple of these topics
> are much appreciated.
>
> Greetings,
> Christian Riesen
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aapte at zynga.com  Mon Mar 10 17:15:30 2014
From: aapte at zynga.com (Ajinkya Apte)
Date: Mon, 10 Mar 2014 17:15:30 +0000
Subject: [rabbitmq-discuss] RabbitMQ: Different consumer technique
In-Reply-To: <CAD6m6fEHibKKY=CsJ_i2AviOxCQy7gZPXCJ=KE32Are6_ze7WA@mail.gmail.com>
Message-ID: <CF434128.10F44%aapte@zynga.com>

Yeh I thought about it a little more and just using the technique where the server pushes changes to the consumer makes most sense here. Thanks for the quick reply Jason.

AJ

From: Jason McIntosh <mcintoshj at gmail.com<mailto:mcintoshj at gmail.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Monday, March 10, 2014 9:15 AM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] RabbitMQ: Different consumer technique

Seems like a lot of heavy lifting for a consumer process.  If you use the alternative where rabbit pushes changes to your consumer (instead of basic_get), then rabbit will push new messages as they come in to your consumer, and the consumer will be idle otherwise using minimal resources.  For "basic.get_batch" - that's exactly what the prefetch count does on consumers - get 10 messages at once and process them.  Is there some particularly need to wrap it in all the extra layers?
Jason


On Mon, Mar 10, 2014 at 10:43 AM, Ajinkya Apte <aapte at zynga.com<mailto:aapte at zynga.com>> wrote:
(First time user of RabbitMQ)
Hey,
Technique:
Rather than writing a standalone PHP consumer script that keeps consuming the queue, I was planning on writing a batch get and quit PHP script. All that script does is get a batch of 10 from the queue, if the batch isn't available the script immediately exits. If available, it processes the batch and quits. I use a python script to make multiple calls to my 'Get Batch script' and make use of apache workers to do the work rather than making the php standalone script do the work.

Questions:
1. Firstly, do you see a reason why I should not think about consuming the queue this way?
2. (I am using the amq php lib) How can I do a batch get and exit if the batch is not present. With what I have learnt seems like I can set the qos to my batch count and use batch_consume for this. But if the batch is not available the script seems to wait till the batch is available. Is there a way I can timeout?
3. Do you have any usage recommendation for me?
4. Any plans of having basic.get_batch?

AJ

Sent from my iPhone

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/46c69ccb/attachment.html>

From mariusz.wojcik at hotmail.co.uk  Mon Mar 10 20:40:41 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Mon, 10 Mar 2014 13:40:41 -0700 (PDT)
Subject: [rabbitmq-discuss] New PowerShell cmdlets for managing RabbitMQ
In-Reply-To: <CAMcAHLWgnQAEB7X5jJ7LJPm_FGDAK_kJ5-4sTaNEQw_9fGjnGQ@mail.gmail.com>
References: <9f1bd6da-d553-44c3-b81d-f6664f0fad79@googlegroups.com>
 <CAMcAHLWgnQAEB7X5jJ7LJPm_FGDAK_kJ5-4sTaNEQw_9fGjnGQ@mail.gmail.com>
Message-ID: <23631a34-b870-4cee-8703-b946c096909b@googlegroups.com>

Thanks Alvaro, much appreciated.

Mariusz

On Monday, 10 March 2014 10:58:14 UTC, Alvaro Videla wrote:
>
> Great. I've added your tool to this page: 
> http://www.rabbitmq.com/devtools.html 
>
> -Alvaro 
>
> On Fri, Mar 7, 2014 at 12:56 AM, Mariusz Wojcik 
> <mariusz... at hotmail.co.uk <javascript:>> wrote: 
> > Hi all, 
> > 
> >    The new tool for managing RabbitMQ server(s) using PowerShell is 
> > available at https://github.com/mariuszwojcik/RabbitMQTools. It is free 
> > under MIT licence. 
> >    Current version allows to 
> > 
> > view server overview 
> > Opened connections and channels 
> > View cluster nodes 
> > get/add/remove virtual hosts 
> > get/add/remove exchanges 
> > get/add/remove queues 
> > view messages in the queue. 
> > 
> > It works with local as well as remote server. 
> > 
> > 
> > Let me know what you think about it, and/or what features you would like 
> to 
> > be added. 
> > 
> > Cheers, 
> > 
> > Mariusz 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140310/6b85fbab/attachment.html>

From matthias at rabbitmq.com  Mon Mar 10 21:41:30 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Mar 2014 21:41:30 +0000
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
In-Reply-To: <531D7DB8.8000708@anynines.com>
References: <53184C43.5010000@anynines.com> <531B71CD.7040003@rabbitmq.com>
 <531D7DB8.8000708@anynines.com>
Message-ID: <531E318A.8090206@rabbitmq.com>

On 10/03/14 08:54, Heiko Kr?mer wrote:
> rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <-
> processes(), begin {_, L} = process_info(P, message_queue_len), L > 0 end].'
> Error: {badarg,[{erlang,process_info,[<4946.31251.352>,current_stacktrace]},
>                  {erl_eval,do_apply,5},
>                  {erl_eval,expr_list,6},
>                  {erl_eval,expr,5},
>                  {erl_eval,eval_lc1,6},
>                  {erl_eval,eval_generate,7},
>                  {erl_eval,eval_lc,6},
>                  {rpc,'-handle_call_call/6-fun-0-',5}]}

Your Erlang is too old for my little debug script :(

Matthias.

From rcross at amsl.com  Mon Mar 10 23:53:31 2014
From: rcross at amsl.com (Ryan Cross)
Date: Mon, 10 Mar 2014 16:53:31 -0700
Subject: [rabbitmq-discuss] CPU usage on idle server
Message-ID: <0761BF85-0FF4-4DF5-A488-A0C71B4B6431@amsl.com>

Hi,

I have a 2.8.7 rabbitmq instance running on a backup server, processing no messages.  The bean.smp process consistently uses on average 5% CPU (ranging from 4-35%) according to top.  Is this expected for a service that is not processing any messages?

Thanks,
Ryan

From michael.s.klishin at gmail.com  Tue Mar 11 06:46:51 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 11 Mar 2014 10:46:51 +0400
Subject: [rabbitmq-discuss] ANN Langohr 2.7.1 is released
Message-ID: <CAE3HoVSr1oLDWYm6_mg3fWJUF6HKkPV3u-aw3DJPgKCZ9Dyi6w@mail.gmail.com>

Langohr [1] is a small, feature complete Clojure client for RabbitMQ.

Release notes:
http://blog.clojurewerkz.org/blog/2014/03/11/langohr-2-dot-7-1-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/86c84973/attachment.html>

From hkraemer at anynines.com  Tue Mar 11 07:10:01 2014
From: hkraemer at anynines.com (=?ISO-8859-1?Q?Heiko_Kr=E4mer?=)
Date: Tue, 11 Mar 2014 08:10:01 +0100
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
In-Reply-To: <531E318A.8090206@rabbitmq.com>
References: <53184C43.5010000@anynines.com> <531B71CD.7040003@rabbitmq.com>
 <531D7DB8.8000708@anynines.com> <531E318A.8090206@rabbitmq.com>
Message-ID: <531EB6C9.8070604@anynines.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10.03.2014 22:41, Matthias Radestock wrote:
> On 10/03/14 08:54, Heiko Kr?mer wrote:
>> rabbitmqctl eval '[{P, process_info(P, current_stacktrace)} || P <-
>> processes(), begin {_, L} = process_info(P, message_queue_len), L > 0
end].'
>> Error:
{badarg,[{erlang,process_info,[<4946.31251.352>,current_stacktrace]},
>>                  {erl_eval,do_apply,5},
>>                  {erl_eval,expr_list,6},
>>                  {erl_eval,expr,5},
>>                  {erl_eval,eval_lc1,6},
>>                  {erl_eval,eval_generate,7},
>>                  {erl_eval,eval_lc,6},
>>                  {rpc,'-handle_call_call/6-fun-0-',5}]}
>
> Your Erlang is too old for my little debug script :(
>
> Matthias.
>

Hi Matthias,

too old ? :(


Package: erlang-base                  
State: installed
Automatically installed: yes
Version: 1:14.b.4-dfsg-1ubuntu1


Cheers
Heiko

- -- 
anynines.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJTHrbJAAoJELxFogM4ixOFmzgH/A72ckdVhdfeL5xZqH9mHBLM
nSVQJg9qRZxoq/E6MwxiIoiS0WJ8H6u0i0ltg8+L/t+SunTz+j023AicXnqsy39h
8fcF8ima/J/zcWWIXjJ8IwbH9h1KNReMoaVAkrNq+AQThafxSNW3U+Ri5cRzQFmD
NTDpy1hosAHMnuGvk/m46aO4Y3q8uqE0MLjErCJGzOU8KvCglXl25X/zC59kUy3u
URWBVd8nCEUVC5PWHqJOizDMGj1sn07tIPA+iPpFpY/8gcwPbh5h4C6zeDLvSDM8
xKv4bM/mjMtBR4NbnKrvV/q1/YGwtYBbBy3HBPMtJofGJdeMWPPgio0biRA5Jq8=
=Bm89
-----END PGP SIGNATURE-----


From matthias at rabbitmq.com  Tue Mar 11 07:34:38 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Mar 2014 07:34:38 +0000
Subject: [rabbitmq-discuss] Stale/Stuck queue on cluster
In-Reply-To: <531EB6C9.8070604@anynines.com>
References: <53184C43.5010000@anynines.com> <531B71CD.7040003@rabbitmq.com>
 <531D7DB8.8000708@anynines.com> <531E318A.8090206@rabbitmq.com>
 <531EB6C9.8070604@anynines.com>
Message-ID: <531EBC8E.6010504@rabbitmq.com>

On 11/03/14 07:10, Heiko Kr?mer wrote:
> too old ? :(
>
>
> Package: erlang-base
> State: installed
> Automatically installed: yes
> Version: 1:14.b.4-dfsg-1ubuntu1

R14B-4 is fine for running rabbit (as per 
http://www.rabbitmq.com/which-erlang.html), but unfortunately the debug 
script I posted depends on functionality that only became available in R15.

Erlang is easy to upgrade; simply add the erlang-solutions repo to your 
installation, as per 
https://www.erlang-solutions.com/downloads/download-erlang-otp#tabs-ubuntu

Matthias.

From simon at rabbitmq.com  Tue Mar 11 08:59:15 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Mar 2014 08:59:15 +0000
Subject: [rabbitmq-discuss] CPU usage on idle server
In-Reply-To: <0761BF85-0FF4-4DF5-A488-A0C71B4B6431@amsl.com>
References: <0761BF85-0FF4-4DF5-A488-A0C71B4B6431@amsl.com>
Message-ID: <531ED063.2000808@rabbitmq.com>

On 10/03/2014 23:53, Ryan Cross wrote:
> I have a 2.8.7 rabbitmq instance running on a backup server,
> processing no messages.  The bean.smp process consistently uses on
> average 5% CPU (ranging from 4-35%) according to top.  Is this
> expected for a service that is not processing any messages?

No.

There have been bugs fixed since 2.8.7 that could describe what you're 
seeing - in particular if you have a lot of queues on the server, there 
was a bug fixed in 3.0.2 where queues would sometimes stay awake and 
emiting stats even when they had nothing to do.

If you have mgmt installed you should be able to see this because not 
all queues would be described as "idle".

Anyway, 2.8.7 is really quite old now, so an upgrade is likely to be 
worth it. There have been a lot of bugs fixed since then!

Cheers, Simon

From dev440 at gmail.com  Tue Mar 11 11:04:20 2014
From: dev440 at gmail.com (chetan dev)
Date: Tue, 11 Mar 2014 16:34:20 +0530
Subject: [rabbitmq-discuss] Broker Unreachable Exception after Establishing
	certain number of connection
Message-ID: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>

Hi,


Why RabbitMq Client rejects further connections and gives brokerunreachable
exception after establishing certain number of connections(480 approx).
There is no connection blockage (enough ram memory and socket descriptors
are available)

Thanks


-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/7fcfca32/attachment.html>

From videlalvaro at gmail.com  Tue Mar 11 11:08:18 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 11 Mar 2014 12:08:18 +0100
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
Message-ID: <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>

Hi,

What client are you using?

Have you checked the RabbitMQ logs?

Are you sure RabbitMQ is picking the right amount of socket descriptors?

Regards,

Alvaro

On Tue, Mar 11, 2014 at 12:04 PM, chetan dev <dev440 at gmail.com> wrote:
> Hi,
>
>
> Why RabbitMq Client rejects further connections and gives brokerunreachable
> exception after establishing certain number of connections(480 approx).
> There is no connection blockage (enough ram memory and socket descriptors
> are available)
>
> Thanks
>
>
> --
> Cheten  Dev
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From dev440 at gmail.com  Tue Mar 11 11:30:52 2014
From: dev440 at gmail.com (chetan dev)
Date: Tue, 11 Mar 2014 17:00:52 +0530
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
Message-ID: <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>

Hi,
I am using .net client .
I have attached the logs and the screenshot of management ui

Thanks




[image: Inline image 1]


On Tue, Mar 11, 2014 at 4:38 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> What client are you using?
>
> Have you checked the RabbitMQ logs?
>
> Are you sure RabbitMQ is picking the right amount of socket descriptors?
>
> Regards,
>
> Alvaro
>
> On Tue, Mar 11, 2014 at 12:04 PM, chetan dev <dev440 at gmail.com> wrote:
> > Hi,
> >
> >
> > Why RabbitMq Client rejects further connections and gives
> brokerunreachable
> > exception after establishing certain number of connections(480 approx).
> > There is no connection blockage (enough ram memory and socket descriptors
> > are available)
> >
> > Thanks
> >
> >
> > --
> > Cheten  Dev
> >
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/64c93151/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screen shot.png
Type: image/png
Size: 26170 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/64c93151/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at USER145.log
Type: application/octet-stream
Size: 172696 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/64c93151/attachment.obj>

From videlalvaro at gmail.com  Tue Mar 11 11:45:33 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 11 Mar 2014 12:45:33 +0100
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
Message-ID: <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>

The "handle.exe missing" message that you see under File descriptors seems
to be related to this problem:
http://rabbitmq.1065348.n5.nabble.com/nightly-2-8-7-31107-Admin-GUI-install-handle-from-sysinternals-td23216.html#a23218


On Tue, Mar 11, 2014 at 12:30 PM, chetan dev <dev440 at gmail.com> wrote:

>
> Hi,
> I am using .net client .
> I have attached the logs and the screenshot of management ui
>
> Thanks
>
>
>
>
> [image: Inline image 1]
>
>
> On Tue, Mar 11, 2014 at 4:38 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> Hi,
>>
>> What client are you using?
>>
>> Have you checked the RabbitMQ logs?
>>
>> Are you sure RabbitMQ is picking the right amount of socket descriptors?
>>
>> Regards,
>>
>> Alvaro
>>
>> On Tue, Mar 11, 2014 at 12:04 PM, chetan dev <dev440 at gmail.com> wrote:
>> > Hi,
>> >
>> >
>> > Why RabbitMq Client rejects further connections and gives
>> brokerunreachable
>> > exception after establishing certain number of connections(480 approx).
>> > There is no connection blockage (enough ram memory and socket
>> descriptors
>> > are available)
>> >
>> > Thanks
>> >
>> >
>> > --
>> > Cheten  Dev
>> >
>> >
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/c2c09558/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screen shot.png
Type: image/png
Size: 26170 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/c2c09558/attachment.png>

From thanhpv at vega.com.vn  Tue Mar 11 11:35:37 2014
From: thanhpv at vega.com.vn (Thanh Pham Van)
Date: Tue, 11 Mar 2014 04:35:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection
	not working?
In-Reply-To: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
References: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
Message-ID: <fa4ba709-cf14-4c12-be68-1b3a7f30c1f6@googlegroups.com>

i met the same problem, but i can't find the way to  fix this. Please show 
me more detail.

rgds

On Saturday, March 2, 2013 12:04:50 AM UTC+7, Kelly Elias wrote:
>
> I have a class that connects to RabbitMQ like this: (C# code)
>
> private static ConnectionFactory factory;
> private static IConnection connection;
> private static IModel model;
> private static EventingBasicConsumer consumer;
>
> ...
>
>
> factory = new ConnectionFactory {HostName = address};
> factory.RequestedHeartbeat = 30;
> connection = factory.CreateConnection();
>
> connection.ConnectionShutdown += connection_ConnectionShutdown;
>
> model = connection.CreateModel();
>
> lock (model)
> {
>     model.ExchangeDeclare(EXCHANGE_NAME, "topic");
>     queueName = model.QueueDeclare();
>     consumer = new EventingBasicConsumer();
>     consumer.Received += consumer_Received;
>     model.BasicConsume(queueName, true, consumer);
> }
>
> It all works fine. If I unplug my network connection and wait that 30 
> seconds for the heartbeat the code will realize it's no longer connected 
> and attempt to reconnect by running the code above again. I don't get any 
> errors, but after the re-connection I never get a message from RabbitMQ.
>
> I've tried to dispose the objects I'm using but if I try with the 
> connection it hangs and never returns.
>
> Any ideas what I can try?
>
>
> I'm using server version 2.4.1
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/7206855b/attachment.html>

From thanhpv at vega.com.vn  Tue Mar 11 11:35:37 2014
From: thanhpv at vega.com.vn (Thanh Pham Van)
Date: Tue, 11 Mar 2014 04:35:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection
	not working?
In-Reply-To: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
References: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
Message-ID: <fa4ba709-cf14-4c12-be68-1b3a7f30c1f6@googlegroups.com>

i met the same problem, but i can't find the way to  fix this. Please show 
me more detail.

rgds

On Saturday, March 2, 2013 12:04:50 AM UTC+7, Kelly Elias wrote:
>
> I have a class that connects to RabbitMQ like this: (C# code)
>
> private static ConnectionFactory factory;
> private static IConnection connection;
> private static IModel model;
> private static EventingBasicConsumer consumer;
>
> ...
>
>
> factory = new ConnectionFactory {HostName = address};
> factory.RequestedHeartbeat = 30;
> connection = factory.CreateConnection();
>
> connection.ConnectionShutdown += connection_ConnectionShutdown;
>
> model = connection.CreateModel();
>
> lock (model)
> {
>     model.ExchangeDeclare(EXCHANGE_NAME, "topic");
>     queueName = model.QueueDeclare();
>     consumer = new EventingBasicConsumer();
>     consumer.Received += consumer_Received;
>     model.BasicConsume(queueName, true, consumer);
> }
>
> It all works fine. If I unplug my network connection and wait that 30 
> seconds for the heartbeat the code will realize it's no longer connected 
> and attempt to reconnect by running the code above again. I don't get any 
> errors, but after the re-connection I never get a message from RabbitMQ.
>
> I've tried to dispose the objects I'm using but if I try with the 
> connection it hangs and never returns.
>
> Any ideas what I can try?
>
>
> I'm using server version 2.4.1
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/7206855b/attachment-0001.html>

From mklishin at gopivotal.com  Tue Mar 11 12:34:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 11 Mar 2014 16:34:43 +0400
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection
	not working?
In-Reply-To: <fa4ba709-cf14-4c12-be68-1b3a7f30c1f6@googlegroups.com>
References: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
 <fa4ba709-cf14-4c12-be68-1b3a7f30c1f6@googlegroups.com>
Message-ID: <9F529A1C-92A8-4997-AF9B-A5801E6C6DF5@rabbitmq.com>


On 11 Mar 2014, at 15:35, Thanh Pham Van <thanhpv at vega.com.vn> wrote:

> i met the same problem, but i can't find the way to  fix this. Please show me more detail.

Handle shutdown events and reconnect, then re-create your channels and (if needed)
exchanges/queues/bindings.

MK

Software Engineer, Pivotal/RabbitMQ



From dev440 at gmail.com  Tue Mar 11 12:44:12 2014
From: dev440 at gmail.com (chetan dev)
Date: Tue, 11 Mar 2014 18:14:12 +0530
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
Message-ID: <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>

Hi,

There are enough file descriptors available.
i have run the test again and here is the screenshot of management ui.

[image: Inline image 1]

 Thanks


On Tue, Mar 11, 2014 at 5:15 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> The "handle.exe missing" message that you see under File descriptors seems
> to be related to this problem:
> http://rabbitmq.1065348.n5.nabble.com/nightly-2-8-7-31107-Admin-GUI-install-handle-from-sysinternals-td23216.html#a23218
>
>
> On Tue, Mar 11, 2014 at 12:30 PM, chetan dev <dev440 at gmail.com> wrote:
>
>>
>> Hi,
>> I am using .net client .
>> I have attached the logs and the screenshot of management ui
>>
>> Thanks
>>
>>
>>
>>
>> [image: Inline image 1]
>>
>>
>> On Tue, Mar 11, 2014 at 4:38 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>>
>>> Hi,
>>>
>>> What client are you using?
>>>
>>> Have you checked the RabbitMQ logs?
>>>
>>> Are you sure RabbitMQ is picking the right amount of socket descriptors?
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>> On Tue, Mar 11, 2014 at 12:04 PM, chetan dev <dev440 at gmail.com> wrote:
>>> > Hi,
>>> >
>>> >
>>> > Why RabbitMq Client rejects further connections and gives
>>> brokerunreachable
>>> > exception after establishing certain number of connections(480 approx).
>>> > There is no connection blockage (enough ram memory and socket
>>> descriptors
>>> > are available)
>>> >
>>> > Thanks
>>> >
>>> >
>>> > --
>>> > Cheten  Dev
>>> >
>>> >
>>> >
>>> >
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Cheten  Dev
>>
>> B.Tech Final Year
>> Dept. of Electrical Engg.
>> IIT Delhi, New Delhi
>> ph 8527333215
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/8bdd3694/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screen shot.png
Type: image/png
Size: 26170 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/8bdd3694/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screen shot.png
Type: image/png
Size: 20636 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/8bdd3694/attachment-0001.png>

From mklishin at gopivotal.com  Tue Mar 11 13:21:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 11 Mar 2014 17:21:48 +0400
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
	Establishing certain number of connection
In-Reply-To: <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
Message-ID: <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>


On 11 Mar 2014, at 16:44, chetan dev <dev440 at gmail.com> wrote:

> There are enough file descriptors available. 
> i have run the test again and here is the screenshot of management ui.

I?ve recently investigated a similar issue which boiled down to concurrency
hazards in the program. Can you be sharing connections between threads,
creating them lazily or something of that nature?

Also, are you sure you need over 480 connections from a program? Perhaps 1 connection
and 480 channels will do?

MK

Software Engineer, Pivotal/RabbitMQ



From dev440 at gmail.com  Tue Mar 11 13:54:33 2014
From: dev440 at gmail.com (chetan dev)
Date: Tue, 11 Mar 2014 19:24:33 +0530
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
Message-ID: <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>

Hi,

No, I am not sharing any connection between threads
I usually  open a connection when activity is done i close it along with
the channel.
I was wondering what would happen if i don't close the connection , so I
ran the test .


Thanks





On Tue, Mar 11, 2014 at 6:51 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 11 Mar 2014, at 16:44, chetan dev <dev440 at gmail.com> wrote:
>
> > There are enough file descriptors available.
> > i have run the test again and here is the screenshot of management ui.
>
> I've recently investigated a similar issue which boiled down to concurrency
> hazards in the program. Can you be sharing connections between threads,
> creating them lazily or something of that nature?
>
> Also, are you sure you need over 480 connections from a program? Perhaps 1
> connection
> and 480 channels will do?
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/4c2b46db/attachment.html>

From mcintoshj at gmail.com  Tue Mar 11 16:41:48 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 11 Mar 2014 11:41:48 -0500
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
Message-ID: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>

This may be a 3.0.4-1 issue (or erlang esl-erlang-R15B03-2.x86_64) and I
just may need to upgrade rabbit but I thought I'd see if anyone had seen
this before.  This is on oracle enterprise linux 6.2.

A few days after a software raid filesystem check (may or not be related,
only thing I can see that's common), on three separate servers, rabbit just
completely hung.  I couldn't even do an LSOF on any file system.  The port
was still responsive, but the rabbit process itself was completely hung.
 CPU use jumped up to 25% on the beam process and just stayed there...  I
killed all the rabbit processes and tried to restart them.  There was
nothing in the logs and the startup failed.  I killed everything again,
including the EPMD process and then rabbit was finally able to start.
 With-in a few moments though the beam hung again - I see a few connections
show in the logs and then the process is non-responsive.

I'm GUESSING this is an OS level issue, and I'd swear I've seen this
before.  I've had to do a full restart of the server to get things back to
a decent state.  Anyone have any advice/ideas?

Jason

-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/cb26a65a/attachment.html>

From alan.antonuk at gmail.com  Tue Mar 11 16:43:59 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 11 Mar 2014 09:43:59 -0700
Subject: [rabbitmq-discuss]  rabbitmq-c APIs hanging during network down
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C991D14B@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C991D14B@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJm_fT3qee8vpgJC4r4FaQck=vm5Ct7nMwDcTEHwaiRSQ@mail.gmail.com>

You can add an issue to the bug tracker here:

https://github.com/alanxz/rabbitmq-c/issues/new

Please include steps, environment, and code to reproduce what you're
seeing. (I have not been able to reproduce that behavior you're seeing).

An aside: take a look at how other rabbitmq clients handle having the
router shutoff. Given we use the same underlying OS APIs I would not be
surprised to see a similar behavior.

-Alan



On Mon, Mar 10, 2014 at 4:45 AM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi,
>
> I am using rabbitmq-c v0.4.1. I have tested behaviour of
> amqp_simple_wait_frame_noblock() and amqp_basic_publish() API. When these
> APIs are in execution and suddenly if the network connection is lost
> (router switch off), these APIs hangs. I would request to raise this as a
> bug in the library.
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/71d6fce5/attachment.html>

From michael.s.klishin at gmail.com  Tue Mar 11 18:39:56 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 11 Mar 2014 22:39:56 +0400
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
 <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
Message-ID: <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>

2014-03-11 17:54 GMT+04:00 chetan dev <dev440 at gmail.com>:

> No, I am not sharing any connection between threads
> I usually  open a connection when activity is done i close it along with
> the channel.
> I was wondering what would happen if i don't close the connection , so I
> ran the test .


Can you post an example program that reproduces the issue?


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/6b5403d0/attachment.html>

From matthias at rabbitmq.com  Tue Mar 11 19:07:59 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Mar 2014 19:07:59 +0000
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
 <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
 <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>
Message-ID: <531F5F0F.5040801@rabbitmq.com>

On 11/03/14 18:39, Michael Klishin wrote:
> 2014-03-11 17:54 GMT+04:00 chetan dev <dev440 at gmail.com
> <mailto:dev440 at gmail.com>>:
>
>     No, I am not sharing any connection between threads
>     I usually  open a connection when activity is done i close it along
>     with the channel.
>     I was wondering what would happen if i don't close the connection ,
>     so I ran the test .
>
>
> Can you post an example program that reproduces the issue?

Also, as Alvaro requested previously, please check the broker logs for 
any errors.

Also, I seem to recall that Windows can impose some restrictions on the 
number of *outbound* connections that can be opened, so it is worth 
checking that when you see the problem whether it is possible to connect 
to the broker from a different machine.

Matthias.


From ryankbrown at gmail.com  Tue Mar 11 22:28:25 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Tue, 11 Mar 2014 16:28:25 -0600
Subject: [rabbitmq-discuss] Per message publish confirms
Message-ID: <CAChGYf8kjSc6bNsA5Q7vQPM83d0A8ikv4FsrKCqqi-gT+qerMQ@mail.gmail.com>

Is it possible to set-up an exchange to not use publish confirms but, if a
given client sends a message that is of higher importance, to specify a
flag to require a publish confirm for that/those messages?

Essentially, I have an application that set-up on exchange with default
global flag for durable messaging. Due to perf issues, we typically have
this set to false. However, we now have a couple clients of our application
that would like to require publish confirms.

Is this even possible? Is there a better practice?

-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/d085d492/attachment.html>

From michael.s.klishin at gmail.com  Tue Mar 11 22:37:20 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 12 Mar 2014 02:37:20 +0400
Subject: [rabbitmq-discuss] Per message publish confirms
In-Reply-To: <CAChGYf8kjSc6bNsA5Q7vQPM83d0A8ikv4FsrKCqqi-gT+qerMQ@mail.gmail.com>
References: <CAChGYf8kjSc6bNsA5Q7vQPM83d0A8ikv4FsrKCqqi-gT+qerMQ@mail.gmail.com>
Message-ID: <CAE3HoVSi1k5SxqBStnxa3UrpQVSD62bi0g8K=ySpBSPMNfUUbw@mail.gmail.com>

2014-03-12 2:28 GMT+04:00 Ryan Brown <ryankbrown at gmail.com>:

> Is it possible to set-up an exchange to not use publish confirms but, if a
> given client sends a message that is of higher importance, to specify a
> flag to require a publish confirm for that/those messages?
>
> Essentially, I have an application that set-up on exchange with default
> global flag for durable messaging. Due to perf issues, we typically have
> this set to false. However, we now have a couple clients of our application
> that would like to require publish confirms.
>

Publisher confirms are per channels.

Use a separate channel that has confirms enabled.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/766f0121/attachment.html>

From ratheesh.ksz at gmail.com  Wed Mar 12 05:54:31 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 11:24:31 +0530
Subject: [rabbitmq-discuss] Beginner Question.
Message-ID: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>

I am going thru some documentation on rabbitmq. I have some questions


Client A ( Running on Machine A )   would like to send a message to
Client B ( running on machin B ). Broker  ( Rabbit Mq server ) is
running on Machine C.

1. So client A using rabbitmq library  makes a connection to Broker C
over tcp/ip and request for xchange and queue. Is my understanding
correct ?

2. If client A crashes, messages reliablility   is guranteed by Broker
C.   Durability will ensure messages are kept during broker restart.
How can we guarantee messages are retained upon a crash ( not a
graceful shutdown ) of a broker.   my use case here :  Suppose I  have
 10 nodes connected on a lan. These nodes need to send messages to
each other. So i need to run broker ( rabbitmq server ) on one node.
I don't have budget to run one node dedicated to broker ; so i will
run some of my applications also on that node. These applications may
crash the broker node ( can make  the node reboot  ).  what is the
solution here ?

3. How is rabbitmq C is  well tested ? or it is in development phase.
I could see a lot of examples on java etc. But in C , it is limited.?


Thanks,
Ratheesh

From mklishin at gopivotal.com  Wed Mar 12 06:05:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 10:05:39 +0400
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
Message-ID: <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>


On 12 Mar 2014, at 09:54, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> 1. So client A using rabbitmq library  makes a connection to Broker C
> over tcp/ip and request for xchange and queue. Is my understanding
> correct ?

Correct. Publishers can choose to only declare an exchange and publish,
with consumers declaring queues and doing the binding they need.

> 
> 2. If client A crashes, messages reliablility   is guranteed by Broker
> C.   Durability will ensure messages are kept during broker restart.
> How can we guarantee messages are retained upon a crash ( not a
> graceful shutdown ) of a broker.
>   my use case here :  Suppose I  have
> 10 nodes connected on a lan. These nodes need to send messages to
> each other. So i need to run broker ( rabbitmq server ) on one node.
> I don't have budget to run one node dedicated to broker ; so i will
> run some of my applications also on that node. These applications may
> crash the broker node ( can make  the node reboot  ).  what is the
> solution here ?

Use durable queues and publish messages as persistent. Make sure your
apps can recover (reconnect, open new channels, possibly re-declare
exchanges/queues/bindings/consumers needed) from RabbitMQ node
restart.

Running RabbitMQ alongside an app is generally fine, just make sure there
is no heavy contention for system resources (CPU, RAM, disk and network I/O)
and that other apps can connect to the node.

> 3. How is rabbitmq C is  well tested ? or it is in development phase.
> I could see a lot of examples on java etc. But in C , it is limited.?

librabbitmq-c has been around for a while. It is much more low level than
the Java client and is not officially supported but maintained by a community member
nonetheless.

MK

Software Engineer, Pivotal/RabbitMQ



From dev440 at gmail.com  Wed Mar 12 06:16:24 2014
From: dev440 at gmail.com (chetan dev)
Date: Wed, 12 Mar 2014 11:46:24 +0530
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <531F5F0F.5040801@rabbitmq.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
 <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
 <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>
 <531F5F0F.5040801@rabbitmq.com>
Message-ID: <CAB0ZxM6=Yvun+W_UbMfzbv7FNx-A5tncmK-3KBTL1oPxQ4A_gQ@mail.gmail.com>

Hi,

I have already attached the logs.
I also think its windows created restriction . When i run another thread of
similar program i am able to connect to broker .

Thanks


On Wed, Mar 12, 2014 at 12:37 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 11/03/14 18:39, Michael Klishin wrote:
>
>> 2014-03-11 17:54 GMT+04:00 chetan dev <dev440 at gmail.com
>> <mailto:dev440 at gmail.com>>:
>>
>>
>>     No, I am not sharing any connection between threads
>>     I usually  open a connection when activity is done i close it along
>>     with the channel.
>>     I was wondering what would happen if i don't close the connection ,
>>     so I ran the test .
>>
>>
>> Can you post an example program that reproduces the issue?
>>
>
> Also, as Alvaro requested previously, please check the broker logs for any
> errors.
>
> Also, I seem to recall that Windows can impose some restrictions on the
> number of *outbound* connections that can be opened, so it is worth
> checking that when you see the problem whether it is possible to connect to
> the broker from a different machine.
>
> Matthias.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/7f27728e/attachment.html>

From thanhpv at vega.com.vn  Wed Mar 12 04:06:50 2014
From: thanhpv at vega.com.vn (Thanh Pham Van)
Date: Wed, 12 Mar 2014 11:06:50 +0700
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection
 not working?
In-Reply-To: <9F529A1C-92A8-4997-AF9B-A5801E6C6DF5@rabbitmq.com>
References: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
 <fa4ba709-cf14-4c12-be68-1b3a7f30c1f6@googlegroups.com>
 <9F529A1C-92A8-4997-AF9B-A5801E6C6DF5@rabbitmq.com>
Message-ID: <CALPCicFThnAM+yZERfJzW7eGT4X9Oe2yAHT5qHZ8wx01wLJqGw@mail.gmail.com>

Thanks a lot for helping me.
I've solved this problem by handling shutdown events.

Thanks & regards,
thanh


On Tue, Mar 11, 2014 at 7:34 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 11 Mar 2014, at 15:35, Thanh Pham Van <thanhpv at vega.com.vn> wrote:
>
> > i met the same problem, but i can't find the way to  fix this. Please
> show me more detail.
>
> Handle shutdown events and reconnect, then re-create your channels and (if
> needed)
> exchanges/queues/bindings.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/af8b07ce/attachment.html>

From lcassa8 at gmail.com  Wed Mar 12 04:41:07 2014
From: lcassa8 at gmail.com (lcassa8 at gmail.com)
Date: Tue, 11 Mar 2014 21:41:07 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ cluster and connection management
Message-ID: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>

Hi,
  I created 3 server cluster of RabbitMQ. As per documentation, RabbitMQ 
client code does not support connection management to the cluster. It only 
connects to one broker at a time. I wanted to find out that in order to 
distribute load what usualy people do for RabbitMQ. Do you use simple Load 
Balacer or write your own code to manage connections, connection pooling 
etc?

Thanks
LCassa.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140311/25abf93d/attachment.html>

From mklishin at gopivotal.com  Wed Mar 12 06:21:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 10:21:05 +0400
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
	Establishing certain number of connection
In-Reply-To: <CAB0ZxM6=Yvun+W_UbMfzbv7FNx-A5tncmK-3KBTL1oPxQ4A_gQ@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
 <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
 <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>
 <531F5F0F.5040801@rabbitmq.com>
 <CAB0ZxM6=Yvun+W_UbMfzbv7FNx-A5tncmK-3KBTL1oPxQ4A_gQ@mail.gmail.com>
Message-ID: <A68FBD8B-4F20-44A0-8331-9BE842AF65D8@rabbitmq.com>

On 12 Mar 2014, at 10:16, chetan dev <dev440 at gmail.com> wrote:

> I have already attached the logs.

The log is full of

=INFO REPORT==== 11-Mar-2014::16:56:58 ===
accepting AMQP connection <0.7054.0> (192.168.1.173:54705 -> 192.168.1.173:5672)

=ERROR REPORT==== 11-Mar-2014::16:56:58 ===
closing AMQP connection <0.6951.0> (192.168.1.173:54670 -> 192.168.1.173:5672):
{handshake_timeout,handshake

which means a TCP connection is established but then clients send no data.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Mar 12 06:28:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 10:28:45 +0400
Subject: [rabbitmq-discuss] RabbitMQ cluster and connection management
In-Reply-To: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>
References: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>
Message-ID: <FC88BFB7-1391-4F14-BA4E-0A2FF13F90D2@rabbitmq.com>


On 12 Mar 2014, at 08:41, lcassa8 at gmail.com wrote:

> I created 3 server cluster of RabbitMQ. As per documentation, RabbitMQ client code does not support connection management to the cluster. It only connects to one broker at a time. I wanted to find out that in order to distribute load what usualy people do for RabbitMQ.

Any strategy that achieves a reasonably even distribution. Picking a random node will
likely be good enough for many environments.

> Do you use simple Load Balacer or write your own code to manage connections, connection pooling etc?

It?s a common strategy to use a load balancer in front of a cluster and make clients connect to it. Note that
you may need more than one load balancer and clients need to be able to connect to the first reachable one.

If you use RabbitMQ Java client, it can connect to the first reachable node from a list.

MK

Software Engineer, Pivotal/RabbitMQ



From matthias at rabbitmq.com  Wed Mar 12 06:36:56 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 12 Mar 2014 06:36:56 +0000
Subject: [rabbitmq-discuss] Per message publish confirms
In-Reply-To: <CAE3HoVSi1k5SxqBStnxa3UrpQVSD62bi0g8K=ySpBSPMNfUUbw@mail.gmail.com>
References: <CAChGYf8kjSc6bNsA5Q7vQPM83d0A8ikv4FsrKCqqi-gT+qerMQ@mail.gmail.com>
 <CAE3HoVSi1k5SxqBStnxa3UrpQVSD62bi0g8K=ySpBSPMNfUUbw@mail.gmail.com>
Message-ID: <53200088.8090607@rabbitmq.com>

On 11/03/14 22:37, Michael Klishin wrote:
>
> 2014-03-12 2:28 GMT+04:00 Ryan Brown <ryankbrown at gmail.com
> <mailto:ryankbrown at gmail.com>>:
>
>     Is it possible to set-up an exchange to not use publish confirms
>     but, if a given client sends a message that is of higher importance,
>     to specify a flag to require a publish confirm for that/those messages?
>
>     Essentially, I have an application that set-up on exchange with
>     default global flag for durable messaging. Due to perf issues, we
>     typically have this set to false. However, we now have a couple
>     clients of our application that would like to require publish confirms.
>
>
> Publisher confirms are per channels.
>
> Use a separate channel that has confirms enabled.

Also note that exchange durability

a) has zero impact on messaging performance - it only affects exchange 
and binding creation/deletion, and

b) has absolutely nothing to do with confirms

Matthias.

From ratheesh.ksz at gmail.com  Wed Mar 12 06:41:03 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 12:11:03 +0530
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
Message-ID: <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>

On Wed, Mar 12, 2014 at 11:35 AM, Michael Klishin
<mklishin at gopivotal.com> wrote:
> Use durable queues and publish messages as persistent. Make sure your
> apps can recover (reconnect, open new channels, possibly re-declare
> exchanges/queues/bindings/consumers needed) from RabbitMQ node
> restart.
>
> Running RabbitMQ alongside an app is generally fine, just make sure there
> is no heavy contention for system resources (CPU, RAM, disk and network I/O)
> and that other apps can connect to the node.

1. Suppose there is process X running along with rabbitMq server. X
causes memory leak and linux oom killer
picks randomly rabiitmq broker  and kills it.

2. Suppose process X  does an ioctl and mess with kernel. And causes
kernel panic. Suppose node restart after panic.

3. Suppose i send  "Kill -9" to rabbitmq broker/


How durable queues achieve  durability of messages in these scenarios-
because these events are asynchronous to rabbit  mq and cannot run  a
graceful shutdown on these cases. ?



>> 3. How is rabbitmq C is  well tested ? or it is in development phase.
>> I could see a lot of examples on java etc. But in C , it is limited.?
>
> librabbitmq-c has been around for a while. It is much more low level than
> the Java client and is not officially supported but maintained by a community member
> nonetheless.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ

Suppose  i want to use rabbit mq for a commercial product  in which
whole code base is on C. what do you suggest ?

From mklishin at gopivotal.com  Wed Mar 12 06:48:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 10:48:53 +0400
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
Message-ID: <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>

On 12 Mar 2014, at 10:41, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> 1. Suppose there is process X running along with rabbitMq server. X
> causes memory leak and linux oom killer
> picks randomly rabiitmq broker  and kills it.
> 
> 2. Suppose process X  does an ioctl and mess with kernel. And causes
> kernel panic. Suppose node restart after panic.
> 
> 3. Suppose i send  "Kill -9" to rabbitmq broker/
> 
> 
> How durable queues achieve  durability of messages in these scenarios-
> because these events are asynchronous to rabbit  mq and cannot run  a
> graceful shutdown on these cases. ?

Messages will be recovered on start. Because RabbitMQ will need to rebuild indexes,
it will take some time if there are many messages.

Also note that there is a short period of time (usually tens of ms) when newly received/routed messages will only
be stored in RAM. Abrupt shutdown at that moment will cause them to be lost.

> Suppose  i want to use rabbit mq for a commercial product  in which
> whole code base is on C. what do you suggest ?

Try librabbitmq-c, if you don?t like it, try MQTT and STOMP C clients. RabbitMQ is multi-protocol:

http://www.rabbitmq.com/mqtt.html
http://www.rabbitmq.com/stomp.html
--
MK

Software Engineer, Pivotal/RabbitMQ


From ratheesh.ksz at gmail.com  Wed Mar 12 07:32:08 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 13:02:08 +0530
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
Message-ID: <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>

On Wed, Mar 12, 2014 at 12:18 PM, Michael Klishin
<mklishin at gopivotal.com> wrote:
> On 12 Mar 2014, at 10:41, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

>
> Also note that there is a short period of time (usually tens of ms) when newly received/routed messages will only
> be stored in RAM. Abrupt shutdown at that moment will cause them to be lost.

So if i do choose "durability" ; i will also  be stored in disk  (
after some time ). This means there is a chance for wear and tear if i
use  flash or hard disk a lot   ( if messages get  queued often )

>> Suppose  i want to use rabbit mq for a commercial product  in which
>> whole code base is on C. what do you suggest ?
>
> Try librabbitmq-c, if you don't like it, try MQTT and STOMP C clients. RabbitMQ is multi-protocol:

which is good and reliable  in these three ? Do you have any data
showing comparison between these. ?



I would like to know about footprint ( both  RAM and harddisk
footprint ) of rabbitmq server  and  the c client libraray  ( any data )  ?
How much  heavy is the code  ? ( any data related to processor cycles ? )

From mklishin at gopivotal.com  Wed Mar 12 08:27:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 12:27:34 +0400
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
Message-ID: <etPan.53201a93.6b8b4567.11695@mercurio.local>

On 12 March 2014 at 11:34:28, ratheesh kannoth (ratheesh.ksz at gmail.com) wrote:
> > So if i do choose "durability" ; i will also be stored in disk (?
> after some time ). This means there is a chance for wear and tear?
> if i
> use flash or hard disk a lot ( if messages get queued often )

?RabbitMQ?s storage subsystem does
not exhibit any unusual I/O patterns and should not cause solid state drives
to wear out any faster than they do with, say, various databases.

>?
> >> Suppose i want to use rabbit mq for a commercial product in which?
> >> whole code base is on C. what do you suggest ?
> >
> > Try librabbitmq-c, if you don't like it, try MQTT and STOMP C?
> clients. RabbitMQ is multi-protocol:
>?
> which is good and reliable in these three ? Do you have any data?
> showing comparison between these. ?

Both MQTT and STOMP are included in RabbitMQ and Pivotal RabbitMQ distributions
and are not considered experimental plugins. Both are officially
supported.
--  
MK  

Software Engineer, Pivotal/RabbitMQ



From ratheesh.ksz at gmail.com  Wed Mar 12 08:37:15 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 14:07:15 +0530
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <etPan.53201a93.6b8b4567.11695@mercurio.local>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
 <etPan.53201a93.6b8b4567.11695@mercurio.local>
Message-ID: <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>

On Wed, Mar 12, 2014 at 1:57 PM, Michael Klishin <mklishin at gopivotal.com> wrote:

>> >> Suppose i want to use rabbit mq for a commercial product in which
> Both MQTT and STOMP are included in RabbitMQ and Pivotal RabbitMQ distributions
> and are not considered experimental plugins. Both are officially
> supported.

I understand that  RabbitMq-C client  should be compiled to create a
dynamic library and can call  library api
from my application.  Is this same with MQTT and STOMP ?. They are
also dynamic libraries ?  and work same as rabbitMq-C client ?

I could see  below  snippet at   https://github.com/alanxz/rabbitmq-c.
"You cannot share a socket, an amqp_connection_state_t, or a channel
between threads using librabbitmq. The librabbitmq library is built
with event-driven, single-threaded applications in mind, and does not
yet cater to any of the requirements of pthreaded applications."
This is case with any other client ...right ?
here  socket is nothing but a channel ,,right ?

http://www.rabbitmq.com/tutorials/amqp-concepts.html  discuss about
clustering ,  and  load balancing using scheduler running on different
CPU.  These are already implemented in Rabbimq. right ?


-Ratheesh



> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>

From mklishin at gopivotal.com  Wed Mar 12 08:44:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 12:44:56 +0400
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
 <etPan.53201a93.6b8b4567.11695@mercurio.local>
 <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>
Message-ID: <etPan.53201ea3.643c9869.11695@mercurio.local>


On 12 March 2014 at 12:39:35, ratheesh kannoth (ratheesh.ksz at gmail.com) wrote:
> > I understand that RabbitMq-C client should be compiled to create  
> a
> dynamic library and can call library api
> from my application. Is this same with MQTT and STOMP ?. They are  
> also dynamic libraries ? and work same as rabbitMq-C client ?

I?m not a C expert but I believe you can compile a static binary
that includes librabbitmq-c or, say, MQTT C client.
?  
>  
> I could see below snippet at https://github.com/alanxz/rabbitmq-c.  
> "You cannot share a socket, an amqp_connection_state_t, or  
> a channel
> between threads using librabbitmq. The librabbitmq library  
> is built
> with event-driven, single-threaded applications in mind,  
> and does not
> yet cater to any of the requirements of pthreaded applications."  
> This is case with any other client ...right ?

Not necessarily: it?s a library design choice.

> http://www.rabbitmq.com/tutorials/amqp-concepts.html  
> discuss about
> clustering , and load balancing using scheduler running on different  
> CPU. These are already implemented in Rabbimq. right ?

I don?t see any mentions of schedulers or multiple CPUs in the article. Load balancing
there means "between consumers on a shared queue?.

Obviously all the features listed in the docs are implemented in RabbitMQ.
While not mentioned in the protocol overview, RabbitMQ happens to run on a runtime
that offers very good multicore scalability as long as you use multiple (say, a few
times more than the # of cores available) queues and not a single giant queue.

HTH.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ratheesh.ksz at gmail.com  Wed Mar 12 08:54:04 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 14:24:04 +0530
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <etPan.53201ea3.643c9869.11695@mercurio.local>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
 <etPan.53201a93.6b8b4567.11695@mercurio.local>
 <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>
 <etPan.53201ea3.643c9869.11695@mercurio.local>
Message-ID: <CAGZFCEEtedTVM0UVbPMh4oxmXCGocc+fbA9WziJsfq_Byd2CWw@mail.gmail.com>

On Wed, Mar 12, 2014 at 2:14 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>
> Not necessarily: it's a library design choice.

http://www.rabbitmq.com/tutorials/amqp-concepts.html  (section
"Channels" ) talks  about  "For applications that use multiple
threads/processes for processing, it is very common to open a new
channel per thread/process and not share channels between them"
I understand your point that  still we can share this channel.
What is the  comparison and difference  between  rabbitMq socket and
connection ?

> I don't see any mentions of schedulers or multiple CPUs in the article. Load balancing
> there means "between consumers on a shared queue".

That  webpage contains below line.
Thirdly, have a strategy to pivot the load to other queues on others
machines if the worst comes to the worst

-Ratheesh

From mklishin at gopivotal.com  Wed Mar 12 09:00:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 13:00:33 +0400
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <CAGZFCEEtedTVM0UVbPMh4oxmXCGocc+fbA9WziJsfq_Byd2CWw@mail.gmail.com>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
 <etPan.53201a93.6b8b4567.11695@mercurio.local>
 <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>
 <etPan.53201ea3.643c9869.11695@mercurio.local>
 <CAGZFCEEtedTVM0UVbPMh4oxmXCGocc+fbA9WziJsfq_Byd2CWw@mail.gmail.com>
Message-ID: <etPan.5320224b.74b0dc51.11695@mercurio.local>

On 12 March 2014 at 12:56:23, ratheesh kannoth (ratheesh.ksz at gmail.com) wrote:
> > http://www.rabbitmq.com/tutorials/amqp-concepts.html  
> (section
> "Channels" ) talks about "For applications that use multiple  
> threads/processes for processing, it is very common to open  
> a new
> channel per thread/process and not share channels between them"  
> I understand your point that still we can share this channel.  
> What is the comparison and difference between rabbitMq socket  
> and
> connection ?

Channel there means AMQP 0-9-1 channel.

AMQP 0-9-1 connection involves a TCP connection, user authentication
and one or more channels over which protocol methods are sent and received.

> That webpage contains below line.
> Thirdly, have a strategy to pivot the load to other queues on others  
> machines if the worst comes to the worst

Right, this is what federated queues are about:
http://www.rabbitmq.com/federated-queues.html

Note that you can also publish messages over one protocol (say, MQTT)
and consume them using another protocol (AMQP 0-9-1 or STOMP). There
are some limitations to this because protocol features don?t necessarily
match but for the proverbial 80% of cases it should work well.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ratheesh.ksz at gmail.com  Wed Mar 12 09:08:16 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Wed, 12 Mar 2014 14:38:16 +0530
Subject: [rabbitmq-discuss] Beginner Question.
In-Reply-To: <etPan.5320224b.74b0dc51.11695@mercurio.local>
References: <CAGZFCEE1P4qEfsdscUS82dqSZ9Xwtt8CFPOk9MzvsyK7oZRCFw@mail.gmail.com>
 <0DDF0B28-BCB0-4B18-9E88-7BF999D7F42E@rabbitmq.com>
 <CAGZFCEGz=D_8US5KCFN7Us7bjHf9y5WzT3do9U3FEA3qw4VRFQ@mail.gmail.com>
 <34EA1F9F-207A-4DCA-ACA2-491FFC139C1E@gopivotal.com>
 <CAGZFCEHA3hPpv8Ut=q+kVN0LxOs4S8RW9sOXemteS6g5Q2TyaQ@mail.gmail.com>
 <CAGZFCEH=0PKMzBFYTW-Su+3JUhtpj2m8mi1Ozkdbab=qYUMBOQ@mail.gmail.com>
 <etPan.53201a93.6b8b4567.11695@mercurio.local>
 <CAGZFCEEgcK48CnS8zcBhaqYd9iqCMkHwtNJ5a-e0xjpcM88fXw@mail.gmail.com>
 <etPan.53201ea3.643c9869.11695@mercurio.local>
 <CAGZFCEEtedTVM0UVbPMh4oxmXCGocc+fbA9WziJsfq_Byd2CWw@mail.gmail.com>
 <etPan.5320224b.74b0dc51.11695@mercurio.local>
Message-ID: <CAGZFCEFLDpiHj+D__VyvsqjXTvqE4DhrWHV9djjwuN0C=xPqoA@mail.gmail.com>

On Wed, Mar 12, 2014 at 2:30 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
> On 12 March 2014 at 12:56:23, ratheesh kannoth (ratheesh.ksz at gmail.com) wrote:
>> > http://www.rabbitmq.com/tutorials/amqp-concepts.html
>> (section
>> "Channels" ) talks about "For applications that use multiple
>> threads/processes for processing, it is very common to open
>> a new
>> channel per thread/process and not share channels between them"
>> I understand your point that still we can share this channel.
>> What is the comparison and difference between rabbitMq socket
>> and
>> connection ?
>
> Channel there means AMQP 0-9-1 channel.
>
> AMQP 0-9-1 connection involves a TCP connection, user authentication
> and one or more channels over which protocol methods are sent and received.
>
>> That webpage contains below line.
>> Thirdly, have a strategy to pivot the load to other queues on others
>> machines if the worst comes to the worst
>
> Right, this is what federated queues are about:
> http://www.rabbitmq.com/federated-queues.html
>
> Note that you can also publish messages over one protocol (say, MQTT)
> and consume them using another protocol (AMQP 0-9-1 or STOMP). There
> are some limitations to this because protocol features don't necessarily
> match but for the proverbial 80% of cases it should work well.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ

What  A reply !!!!!!  Thanks a Ton.

-Ratheesh

From videlalvaro at gmail.com  Wed Mar 12 09:08:22 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 12 Mar 2014 10:08:22 +0100
Subject: [rabbitmq-discuss] Broker Unreachable Exception after
 Establishing certain number of connection
In-Reply-To: <CAB0ZxM6=Yvun+W_UbMfzbv7FNx-A5tncmK-3KBTL1oPxQ4A_gQ@mail.gmail.com>
References: <CAB0ZxM4nhFAqxKoNgsASB0ctRQ6EX7YmZoL4ERS84CQ3MJZOYQ@mail.gmail.com>
 <CAMcAHLWMDCT+kJEKd5aGowc5kdm2rPOJC8xtigABQj+dmD=H2g@mail.gmail.com>
 <CAB0ZxM5yqkr-pTTpct8hRrJskpJTD2TPt0biScPfY8BPp-bEgg@mail.gmail.com>
 <CAMcAHLVzdgthhz0gVCWKueWR0fyeNN5DNFJ0rSCRn1TfFR9atA@mail.gmail.com>
 <CAB0ZxM6jbJehU1KVhGzZNchxOPJHGqhRhkDzywmwZcqMM7Gg-Q@mail.gmail.com>
 <569C42B5-CDDE-43D5-9B2A-4E9262F807C6@rabbitmq.com>
 <CAB0ZxM4pQHq9imrvOwBYF+dFn=1jDRAFJ33s+0Jz=bzE-cAMLw@mail.gmail.com>
 <CAE3HoVRU4+6vU+otskK2kc=QkZ5Y9YFH3VxT2A2D0N+vqMveYQ@mail.gmail.com>
 <531F5F0F.5040801@rabbitmq.com>
 <CAB0ZxM6=Yvun+W_UbMfzbv7FNx-A5tncmK-3KBTL1oPxQ4A_gQ@mail.gmail.com>
Message-ID: <CAMcAHLWGM=Mfnv-Zmeznht3JNMVLscgCjvXFWtwFn-suUE5OQQ@mail.gmail.com>

Hi,

On Wed, Mar 12, 2014 at 7:16 AM, chetan dev <dev440 at gmail.com> wrote:

> I also think its windows created restriction . When i run another thread of
> similar program i am able to connect to broker .

This probably indicates that you should raise the socket descriptor
limit for your program as well.

-Alvaro

From tim at rabbitmq.com  Wed Mar 12 09:39:00 2014
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 12 Mar 2014 09:39:00 +0000
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
Message-ID: <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>


On 11 Mar 2014, at 16:41, Jason McIntosh wrote:

> This may be a 3.0.4-1 issue (or erlang esl-erlang-R15B03-2.x86_64) and I just may need to upgrade rabbit but I thought I'd see if anyone had seen this before.  This is on oracle enterprise linux 6.2.  
> 
> A few days after a software raid filesystem check (may or not be related, only thing I can see that's common), on three separate servers, rabbit just completely hung.  I couldn't even do an LSOF on any file system.  

That sounds like the OS hung not rabbit?

> The port was still responsive, but the rabbit process itself was completely hung.  CPU use jumped up to 25% on the beam process and just stayed there...

25% isn't exactly massive, though if the spike in CPU wasn't associated with an increase in messaging traffic then something could be wrong.

>  I killed all the rabbit processes and tried to restart them.  There was nothing in the logs and the startup failed

How did it fail? Non-zero return code(s) or more?

> I killed everything again, including the EPMD process and then rabbit was finally able to start.  With-in a few moments though the beam hung again - I see a few connections show in the logs and then the process is non-responsive.

How did the beam process hang and in what way did the broker become unresponsive? How are you trying to interact with the broker? Are we talking about rabbitmqctl commands not responding, or something else?

> 
> I'm GUESSING this is an OS level issue, and I'd swear I've seen this before.

I've not heard of this before either. If you can get a rabbit node up and running then we may be able to run some diagnostic commands, depending on whether or not rabbitmqctl commands are working (or not). There are other ways to access a console on a running node too, though they're a bit more involved.

>  I've had to do a full restart of the server to get things back to a decent state.  Anyone have any advice/ideas?
> 

Please clarify what we mean by hung and non-responsive. Also, do you now have the broker running without any of these issues? Can you fire up a standalone (test) node in a VM or some such, run the broker (successfully) on it and re-run the raid check to see if it causes the same problem?

It would be good to get to the bottom of this, though clearly without any logs it's going to be tricky.

Cheers,
Tim


From stammailbox at gmail.com  Wed Mar 12 09:59:12 2014
From: stammailbox at gmail.com (rails)
Date: Wed, 12 Mar 2014 11:59:12 +0200
Subject: [rabbitmq-discuss] Configuring cluster rabbitMQ on EC2
In-Reply-To: <531DE579.9000102@rabbitmq.com>
References: <CAJ2-Vr=s03NfU2hOhfnox2woh5UJovAfXq4O5Tpp8-2TNT2FUg@mail.gmail.com>
 <531DE579.9000102@rabbitmq.com>
Message-ID: <CAJ2-VrkXMLKcn7xUDVwVh-3ez10cuhRjcGYF8K_oYsHRkLH40w@mail.gmail.com>

Thanks,
Just read the docs with the following.

Erlang uses to communicate through by setting the (*undocumented*) kernel
variables 'inet_dist_listen_min' and 'inet_dist_listen_max'

	application:set_env(kernel, inet_dist_listen_min, 9100).
	application:set_env(kernel, inet_dist_listen_max, 9105).


How do I set this params in unix?






On Mon, Mar 10, 2014 at 6:16 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/03/2014 3:40PM, rails wrote:
>
>> My questions :
>> 1. What is this port.
>> 2. Is it a random port? How do I set it so I can control it?
>> 3. Was I missing it in the clustering guide
>> <https://www.rabbitmq.com/clustering.html>? It is kinda important. I
>>
>> couldnt find any document related to the rabbitmq clustering and this
>> port.
>>
>
> See "Firewalled nodes": https://www.rabbitmq.com/clustering.html#firewall
>
>  4. I did find some stuff regarding clustering erlang.
>> <http://www.erlang.org/faq/how_do_i.html#id55090>and it mentioned
>>
>> setting inet_dist_listen_min and inet_dist_listen_max. Is this it?
>> 5. I need to set  it using
>>
>> application:set_env(kernel, inet_dist_listen_min, 9100).
>> application:set_env(kernel, inet_dist_listen_max, 9105).
>>
>
> Yes, that's the same thing as documented above.
>
>
>  How do I run configure this lines?
>> Thanks.
>>
>
> See the link above.
>
> Really this should be easier though :(
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/7afbecb0/attachment.html>

From simon at rabbitmq.com  Wed Mar 12 10:17:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 12 Mar 2014 10:17:57 +0000
Subject: [rabbitmq-discuss] Configuring cluster rabbitMQ on EC2
In-Reply-To: <CAJ2-VrkXMLKcn7xUDVwVh-3ez10cuhRjcGYF8K_oYsHRkLH40w@mail.gmail.com>
References: <CAJ2-Vr=s03NfU2hOhfnox2woh5UJovAfXq4O5Tpp8-2TNT2FUg@mail.gmail.com>	<531DE579.9000102@rabbitmq.com>
 <CAJ2-VrkXMLKcn7xUDVwVh-3ez10cuhRjcGYF8K_oYsHRkLH40w@mail.gmail.com>
Message-ID: <53203455.3080007@rabbitmq.com>

On 12/03/2014 9:59AM, rails wrote:
> How do I set this params in unix?

Through the configuration file:

https://www.rabbitmq.com/configure.html#configuration-file

If you look in the example configuration file which ships with RabbitMQ 
since 3.2.0 or can be seen at 
http://hg.rabbitmq.com/rabbitmq-server/file/2eb28fdd640f/docs/rabbitmq.config.example 
then you will see an example of how to set these parameters.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From warrior2031 at gmail.com  Wed Mar 12 12:31:21 2014
From: warrior2031 at gmail.com (=?UTF-8?B?0JzQuNGF0LDQuNC7INCU0L7RgNC+0L3QuNC9?=)
Date: Wed, 12 Mar 2014 05:31:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't stop/start/restart rabbitmq-server
Message-ID: <4c4c6edd-bc6f-4057-9d77-3d1e8b36a19e@googlegroups.com>

If I invoke rabbitmqctl stop_app/reset/start_app

It just hangs ifinitely.

And if I would invoke sudo reboot machine hangs and can only be rebooted by 
hard reset.

I'm running linux ubuntu 13.10 with rabbitmq 3.1.3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/7226faf2/attachment.html>

From Chris.Nicel at 15below.com  Wed Mar 12 12:45:45 2014
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Wed, 12 Mar 2014 07:45:45 -0500
Subject: [rabbitmq-discuss] Older versions not available in apt repository.
Message-ID: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>

Hi All,

I'm attempting to install a non production cluster for some testing. We are using 3.1.5 but this version doesn't seem to be available from your apt repository @ http://www.rabbitmq.com/debian/dists/testing/main/binary-amd64/ I need to install the same version as we have in production and would prefer to use  our standard approach for installing using apt-get install. I am reasonably sure that I was able to do this previously and install older versions, has something changed at your end? Alternatively, is there another repository I could use which holds older versions?

Cheers

Chris

Chris Nicel
Senior Systems Engineer
15below ltd : 15below Australia pty. ltd.

t:        +44 1273 764230
e:       chris.nicel at 15below.com<mailto:chris.nicel at 15below.com>
w:      15below.com<http://www.15below.com/>
[cid:image001.png at 01CF3DF0.FC57EDA0]       @15below_travel<https://twitter.com/#!/15below_travel>


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/528eeada/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 808 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/528eeada/attachment.png>

From mklishin at gopivotal.com  Wed Mar 12 13:06:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 17:06:02 +0400
Subject: [rabbitmq-discuss] Can't stop/start/restart rabbitmq-server
In-Reply-To: <4c4c6edd-bc6f-4057-9d77-3d1e8b36a19e@googlegroups.com>
References: <4c4c6edd-bc6f-4057-9d77-3d1e8b36a19e@googlegroups.com>
Message-ID: <etPan.53205bd6.3d1b58ba.11695@mercurio.local>

On 12 March 2014 at 16:33:43, ?????? ??????? (warrior2031 at gmail.com) wrote:
> > If I invoke rabbitmqctl stop_app/reset/start_app
>  
> It just hangs ifinitely.
>  
> And if I would invoke sudo reboot machine hangs and can only be  
> rebooted by hard reset.
>  
> I'm running linux ubuntu 13.10 with rabbitmq 3.1.3

Several bugs that could lead to a deadlock on
broker shutdown were fixed since 3.1.3,
e.g. 25404 mentioned in?https://www.rabbitmq.com/release-notes/README-3.2.0.txt.
So please upgrade.

Another reason can be a hostname change. Make sure that the hostname RabbitMQ
uses resolves on the machine itself.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mcintoshj at gmail.com  Wed Mar 12 14:32:42 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 12 Mar 2014 09:32:42 -0500
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
 <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
Message-ID: <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>

I never could get any node up - nothing showed up in the logs for startup,
shutdown, regular and sasl logs.  One interesting thing is on the startup
after killing all the processes (including epmd) it appears to have started
multiple beams instead of the typical one.

By non-responsive, rabbitmqctl shows the node as being down, but I could
telnet to both the management port and the rabbitmq port (which I'm
guessing is the epmd process), but nothing shows in the log files for
rabbit itself, nothing in the sasl logs, no content from the management
port, etc.  The OS was completely responsive - I could get to the shell, do
most commands, though lsof (I think I mentioned this) wouldn't respond in
any timely manner while rabbit server was running.  All the ways I know of
to talk to rabbit and all the os things i know to do were failing and all
the things I know to try and restart it (killing the processes, waiting for
network connections in TIM_WAIT to drain, killing EPMD as well) all failed.

At that point, I recycled each of the servers and they're back to a running
state.  I don't know that I have a box handy but I'll see what I can do to
replicate this.  For some reason I think I've seen this before and it's
something with the OEL 6.2 kernel that Oracle put together, dealing with
disk io flush on a journaled file system.  I'm pretty sure I've seen the
same thing about 6 months ago or so on a completely different set of
servers.

Jason




On Wed, Mar 12, 2014 at 4:39 AM, Tim Watson <tim at rabbitmq.com> wrote:

>
> On 11 Mar 2014, at 16:41, Jason McIntosh wrote:
>
> > This may be a 3.0.4-1 issue (or erlang esl-erlang-R15B03-2.x86_64) and I
> just may need to upgrade rabbit but I thought I'd see if anyone had seen
> this before.  This is on oracle enterprise linux 6.2.
> >
> > A few days after a software raid filesystem check (may or not be
> related, only thing I can see that's common), on three separate servers,
> rabbit just completely hung.  I couldn't even do an LSOF on any file system.
>
> That sounds like the OS hung not rabbit?
>
> > The port was still responsive, but the rabbit process itself was
> completely hung.  CPU use jumped up to 25% on the beam process and just
> stayed there...
>
> 25% isn't exactly massive, though if the spike in CPU wasn't associated
> with an increase in messaging traffic then something could be wrong.
>
> >  I killed all the rabbit processes and tried to restart them.  There was
> nothing in the logs and the startup failed
>
> How did it fail? Non-zero return code(s) or more?
>
> > I killed everything again, including the EPMD process and then rabbit
> was finally able to start.  With-in a few moments though the beam hung
> again - I see a few connections show in the logs and then the process is
> non-responsive.
>
> How did the beam process hang and in what way did the broker become
> unresponsive? How are you trying to interact with the broker? Are we
> talking about rabbitmqctl commands not responding, or something else?
>
> >
> > I'm GUESSING this is an OS level issue, and I'd swear I've seen this
> before.
>
> I've not heard of this before either. If you can get a rabbit node up and
> running then we may be able to run some diagnostic commands, depending on
> whether or not rabbitmqctl commands are working (or not). There are other
> ways to access a console on a running node too, though they're a bit more
> involved.
>
> >  I've had to do a full restart of the server to get things back to a
> decent state.  Anyone have any advice/ideas?
> >
>
> Please clarify what we mean by hung and non-responsive. Also, do you now
> have the broker running without any of these issues? Can you fire up a
> standalone (test) node in a VM or some such, run the broker (successfully)
> on it and re-run the raid check to see if it causes the same problem?
>
> It would be good to get to the bottom of this, though clearly without any
> logs it's going to be tricky.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/e9de56f1/attachment.html>

From pat at munkiisoft.com  Wed Mar 12 15:10:14 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Wed, 12 Mar 2014 15:10:14 +0000
Subject: [rabbitmq-discuss] Binding to amq.rabbitmq.log
Message-ID: <CALDntb9QiBU9GcUa_AFp7nFGn6OfvttxpP6ARnae3MmpUvqyhg@mail.gmail.com>

RMQ 3.2.1
Windows Server 2003

I want to bind a queue to the logs exchange amq.rabbitmq.log.

This looks easy enough but I am not seeing any messages appear in the
queue. I
assume the Binding key should be empty, yes? I am getting entries in the
actual logs file

TIA

Pat






-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/7bd27125/attachment.html>

From videlalvaro at gmail.com  Wed Mar 12 15:16:04 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 12 Mar 2014 16:16:04 +0100
Subject: [rabbitmq-discuss] Binding to amq.rabbitmq.log
In-Reply-To: <CALDntb9QiBU9GcUa_AFp7nFGn6OfvttxpP6ARnae3MmpUvqyhg@mail.gmail.com>
References: <CALDntb9QiBU9GcUa_AFp7nFGn6OfvttxpP6ARnae3MmpUvqyhg@mail.gmail.com>
Message-ID: <CAMcAHLX1z0GZEY9zmm-dfOEJTeyTkobPb_mKL-wMxwT+iDqR4g@mail.gmail.com>

Hi,

That exchange is a topic exchange, so you would have to bind the
queues using the '#' routing key in order to receive every message.

Regards,

-Alvaro

On Wed, Mar 12, 2014 at 4:10 PM, Patrick Long <pat at munkiisoft.com> wrote:
> RMQ 3.2.1
> Windows Server 2003
>
> I want to bind a queue to the logs exchange amq.rabbitmq.log.
>
> This looks easy enough but I am not seeing any messages appear in the queue.
> I
> assume the Binding key should be empty, yes? I am getting entries in the
> actual logs file
>
> TIA
>
> Pat
>
>
>
>
>
>
> --
> Patrick Long - Munkiisoft Ltd
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mklishin at gopivotal.com  Wed Mar 12 15:17:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 19:17:11 +0400
Subject: [rabbitmq-discuss] Binding to amq.rabbitmq.log
In-Reply-To: <CALDntb9QiBU9GcUa_AFp7nFGn6OfvttxpP6ARnae3MmpUvqyhg@mail.gmail.com>
References: <CALDntb9QiBU9GcUa_AFp7nFGn6OfvttxpP6ARnae3MmpUvqyhg@mail.gmail.com>
Message-ID: <3AB2F817-E1B6-483B-8D65-9B4F5937DF8A@rabbitmq.com>


On 12 Mar 2014, at 19:10, Patrick Long <pat at munkiisoft.com> wrote:

> This looks easy enough but I am not seeing any messages appear in the queue. I 
> assume the Binding key should be empty, yes? I am getting entries in the actual logs file

amq.rabbitmq.log is a topic exchange. If you want all messages to be routed to your queue,
bind on ?#?.

MK

Software Engineer, Pivotal/RabbitMQ



From mcintoshj at gmail.com  Wed Mar 12 16:09:46 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 12 Mar 2014 11:09:46 -0500
Subject: [rabbitmq-discuss] RabbitMQ cluster and connection management
In-Reply-To: <FC88BFB7-1391-4F14-BA4E-0A2FF13F90D2@rabbitmq.com>
References: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>
 <FC88BFB7-1391-4F14-BA4E-0A2FF13F90D2@rabbitmq.com>
Message-ID: <CAD6m6fGQ1ipXEZOhEuKmE0gq0z-6u-v_Zdj31RuZ75f6zy7x4g@mail.gmail.com>

haproxy is a common method that you can play with via software, F5 load
balancers for hardware, pretty much any standard balancer will work.  Heck
I'd imagine you could almost use apache httpd and proxy support to do this.
 They just have to be configured correctly and then choose your load
balancing mechanism appropriately, and support a lower level tcp/ip
connection since the AMQP protocol is NOT http (we hit this initially until
networking realized that these aren't short lived simple http connections).
 Though beware, if you use a feature most load balancers have of monitoring
the back end through tcp/ip connects to the port (5672), you'll have a LOT
of messages in your log files where you'll see what are essentially half
opened connections to Rabbit.  This is pretty normal though as the load
balancers aren't trying to really connect, just verify that the port is
still open before rerouting traffic to a different node.

A lot of these kinds of decisions tend to be organization specific.  Does
your organization use physical load balancers everywhere and have good
policies in place to use them, or do most people have software load
balancers, cloud load balancers, etc.

We use F5 LTM's ourselves, with a least open connections algorithm I
believe (might be a round robin though - I don't recall immediately).  It's
worked pretty reliably, once we set the load balancer to not reap
connections until 615 seconds have passed (default heartbeat in rabbit was
600 seconds as I recall).

Jason


On Wed, Mar 12, 2014 at 1:28 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 12 Mar 2014, at 08:41, lcassa8 at gmail.com wrote:
>
> > I created 3 server cluster of RabbitMQ. As per documentation, RabbitMQ
> client code does not support connection management to the cluster. It only
> connects to one broker at a time. I wanted to find out that in order to
> distribute load what usualy people do for RabbitMQ.
>
> Any strategy that achieves a reasonably even distribution. Picking a
> random node will
> likely be good enough for many environments.
>
> > Do you use simple Load Balacer or write your own code to manage
> connections, connection pooling etc?
>
> It's a common strategy to use a load balancer in front of a cluster and
> make clients connect to it. Note that
> you may need more than one load balancer and clients need to be able to
> connect to the first reachable one.
>
> If you use RabbitMQ Java client, it can connect to the first reachable
> node from a list.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/101119eb/attachment.html>

From tim at rabbitmq.com  Wed Mar 12 16:45:13 2014
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 12 Mar 2014 16:45:13 +0000
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
 <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
 <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>
Message-ID: <2B32DAB5-8C1F-4B1B-A340-3315C25766B7@rabbitmq.com>

Hi Jason,

On 12 Mar 2014, at 14:32, Jason McIntosh wrote:

> I never could get any node up - nothing showed up in the logs for startup, shutdown, regular and sasl logs.  One interesting thing is on the startup after killing all the processes (including epmd) it appears to have started multiple beams instead of the typical one.  

Well, if there are rabbit (i.e., beam.smp) processes running, then you _do_ have a node up, though not necessarily responding properly. That's not the same as the program refusing to start though.

> 
> By non-responsive, rabbitmqctl shows the node as being down,

Could this be a file system corruption issue? Have you checked all the usual suspects for when rabbitmqctl won't connect to a node that you know is running, like checking the erlang cookies match?

> but I could telnet to both the management port and the rabbitmq port (which I'm guessing is the epmd process)

I'm not really sure what you mean by "the rabbitmq port", but we could be talking about several things here. (a) the port on which the broker accepts AMQP connections, (b) the port on which the broker accepts distributed erlang connections (which is assigned by epmd) or something else (?) so I'm not really sure what we're saying here. 

> , but nothing shows in the log files for rabbit itself, nothing in the sasl logs, no content from the management port, etc.

Hmn, so you're sure (via ps and/or top) that there are beam.smp processes running, and you can see (via netstat) that the management HTTP port is in use, but there's no response from the HTTP (management) server?

>  The OS was completely responsive - I could get to the shell, do most commands, though lsof (I think I mentioned this) wouldn't respond in any timely manner while rabbit server was running.

That _is_ very strange.

>  All the ways I know of to talk to rabbit and all the os things i know to do were failing and all the things I know to try and restart it (killing the processes, waiting for network connections in TIM_WAIT to drain, killing EPMD as well) all failed.
> 
> At that point, I recycled each of the servers and they're back to a running state.  I don't know that I have a box handy but I'll see what I can do to replicate this.  For some reason I think I've seen this before and it's something with the OEL 6.2 kernel that Oracle put together, dealing with disk io flush on a journaled file system.  I'm pretty sure I've seen the same thing about 6 months ago or so on a completely different set of servers.

Urgh, that sounds horrible. The more info you can provide us with the better. If you can replicate, that would be amazing since we can do the same thing and investigate.

Cheers,
Tim


From mcintoshj at gmail.com  Wed Mar 12 17:23:59 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 12 Mar 2014 12:23:59 -0500
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <2B32DAB5-8C1F-4B1B-A340-3315C25766B7@rabbitmq.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
 <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
 <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>
 <2B32DAB5-8C1F-4B1B-A340-3315C25766B7@rabbitmq.com>
Message-ID: <CAD6m6fEj-3WyaoXbKfmQOWzP3RTLP+y-krk4=T=1vQirhqT2kg@mail.gmail.com>

The last time I saw this I found an article talking about how the OEL
kernels on 6.2 for servers with large amounts of ram had a high buffer
cache situation on the journal before flushing to disk which would cause
long IO times and potentially crash the OS or other processes.  We just saw
this on a completely different server the other morning not running
rabbitmq (all kinds of stuff in the logs about 120 second wait times, ssh
stops responding, have to get into the ilo or vmware console to see these).
 The OS just stopped responding though in these cases, so it might not be
related to the issues I saw on these three servers.  But this is why I
suspect an issue with the kernel and disk IO, particularly since lsof
wasn't working, and seeing the software raid checks in the logs.  Note,
when I DID kill rabbit and epmd, I checked lsof on both the /data partition
where I have the mnesia database, and the /var/log looking for any sign of
a problem, and it did work when rabbit wasn't running.

When I say "refusing to start" the init script never completed and exited
out.  It started the process, and that process never responded (guessing)
or the init script would have finished whatever it does.  I wish I still
had the ps aufx results I took when I saw this - it looked fairly normal
with some things missing.  Here's what we have now:
root      2484  0.0  0.0 108488  1116 ?        S    Mar11   0:00 /bin/sh
/etc/rc3.d/S80rabbitmq-server start
root      2490  0.0  0.0 108216  1444 ?        S    Mar11   0:00  \_
/bin/bash -c ulimit -S -c 0 >/dev/null 2>&1 ; /usr/sbin/rabbitmq-server
root      2493  0.0  0.0 108216  1488 ?        S    Mar11   0:00      \_
/bin/sh /usr/sbin/rabbitmq-server
root      2506  0.0  0.0 163228  2160 ?        S    Mar11   0:00
 \_ su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
rabbitmq  2511  5.9  0.0 3881272 79464 ?       Ssl  Mar11  87:11
   \_ /usr/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true -A30 -P
1048576 -- -root /usr/lib/erlang -progname erl -- -h
rabbitmq  2676  0.0  0.0  10844   540 ?        Ss   Mar11   0:00
       \_ inet_gethost 4
rabbitmq  2677  0.0  0.0  12948   712 ?        S    Mar11   0:00
           \_ inet_gethost 4

When I was having the issues, I saw duplicate of the beam.smp processes
running, and what appeared to be duplicate start commands as well, but no
inet_gethost 4 running.  A netstat showed nothing on 5672 or 15672 neither
listening or connected nor in any other state.

By "telneting to the port" I mean literally I did these:
telnet <server> 5672
telnet <server> 15672
Enter a bunch of garbage in both cases, nothing happens.  At the very least
on the management port, typing "GET /" should have given a response with a
request for authorization or similar.  And yeah before doing this, beam and
the epmd process were running.

Please note these servers are NOT clustered together - they're completely
independent.  They all just failed around the same time (about a four hour
window).  They'd been started about the same time back in August.

Next time I see this I'll try and get an strace on the beam process, see if
I can get some more information.  As said - definitely SOMETHING screwy
here, and the way it behaved felt very much like an OS lock of some sort
someplace, semaphore lock, or something else similar, and I'd guess rabbit
(well, erlang) didn't handle it very well.  And the only thing I found even
remotely suspicious was the md check in the syslog:

Mar  9 03:22:02 mongobdc14p kernel: imklog 4.6.2, log source = /proc/kmsg
started.
Mar  9 03:22:02 mongobdc14p rsyslogd: [origin software="rsyslogd"
swVersion="4.6.2" x-pid="5815" x-info="http://www.rsyslog.com"] (re)start
Mar  9 04:48:19 mongobdc14p kernel: md: md6: data-check done.
Mar  9 04:48:19 mongobdc14p kernel: md: data-check of RAID array md5
Mar  9 04:48:19 mongobdc14p kernel: md: minimum _guaranteed_  speed: 1000
KB/sec/disk.
Mar  9 04:48:19 mongobdc14p kernel: md: using maximum available idle IO
bandwidth (but not more than 200000 KB/sec) for data-check.
Mar  9 04:48:19 mongobdc14p kernel: md: using 128k window, over a total of
104856508 blocks.
Mar  9 04:48:19 mongobdc14p kernel: md: delaying data-check of md0 until
md5 has finished (they share one or more physical units)
Mar  9 04:48:19 mongobdc14p kernel: md: delaying data-check of md1 until
md5 has finished (they share one or more physical units)
Mar  9 05:03:45 mongobdc14p kernel: md: md5: data-check done.
Mar  9 05:03:45 mongobdc14p kernel: md: data-check of RAID array md0
Mar  9 05:03:45 mongobdc14p kernel: md: minimum _guaranteed_  speed: 1000
KB/sec/disk.
Mar  9 05:03:45 mongobdc14p kernel: md: using maximum available idle IO
bandwidth (but not more than 200000 KB/sec) for data-check.
Mar  9 05:03:45 mongobdc14p kernel: md: using 128k window, over a total of
524276 blocks.
Mar  9 05:03:45 mongobdc14p kernel: md: delaying data-check of md1 until
md0 has finished (they share one or more physical units)
Mar  9 05:03:50 mongobdc14p kernel: md: md0: data-check done.
Mar  9 05:03:50 mongobdc14p kernel: md: data-check of RAID array md1
Mar  9 05:03:50 mongobdc14p kernel: md: minimum _guaranteed_  speed: 1000
KB/sec/disk.
Mar  9 05:03:50 mongobdc14p kernel: md: using maximum available idle IO
bandwidth (but not more than 200000 KB/sec) for data-check.
Mar  9 05:03:50 mongobdc14p kernel: md: using 128k window, over a total of
31456188 blocks.
Mar  9 05:08:53 mongobdc14p kernel: md: md1: data-check done.
Mar 10 14:40:01 mongobdc14p auditd[21812]: Audit daemon rotating log files
Mar 11 11:46:46 mongobdc14p init: Failed to spawn splash-manager main
process: unable to open console: Input/output error

(11:46 was when I finally gave up trying to debug and just restarted the
whole server so you can ignore the io error on the splash-manager).  Cron
jobs all were running fine, no problems anyplace that I could actually see.
 Before things stopped responding on the 11th, rabbit used a few more file
descriptors then stopped responding about 10am.  Memory was a bit spiky but
nothing out of the ordinary.  Disk free hadn't changed at all to speak of
(few mb here up and down).

9.1 rabbitmq /usr/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true -A30 -P
1048576 -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq
-- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../ebin -noshell
-noinput -s rabbit boot -sname rabbit at mongobdc14p -boot start_sasl -kernel
inet_default_connect_options [{nodelay,true}] -sasl errlog_type error -sasl
sasl_error_logger false -rabbit error_logger
{file,"/data/rabbitmq/rabbit at mongobdc14p.log"} -rabbit sasl_error_logger
{file,"/data/rabbitmq/rabbit at mongobdc14p-sasl.log"} -rabbit
enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir
"/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../plugins" -rabbit
plugins_expand_dir
"/data/rabbitmq/rabbitmq/mnesia/rabbit at mongobdc14p-plugins-expand" -os_mon
start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false
-mnesia dir "/data/rabbitmq/rabbitmq/mnesia/rabbit at mongobdc14p"
If you'd like, I've got more graphs and data i can share (I had the zabbix
agent running the zabbix-rabbitmq monitoring stuff I wrote on that box),
but I really haven't been able to find anything wrong.  Just the management
API at 10:32 stopped responding, context switches on the kernel suddenly
dropped, it's like everything just suddenly stopped doing anything.

At this point I'd chalk this up to "it's an anomoly that shouldn't require
a whole lot of investigation" kinda situation though so don't worry about
it too heavily.  Or blame Oracle - I like blaming Oracle :)
Jason

On Wed, Mar 12, 2014 at 11:45 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Jason,
>
> On 12 Mar 2014, at 14:32, Jason McIntosh wrote:
>
> > I never could get any node up - nothing showed up in the logs for
> startup, shutdown, regular and sasl logs.  One interesting thing is on the
> startup after killing all the processes (including epmd) it appears to have
> started multiple beams instead of the typical one.
>
> Well, if there are rabbit (i.e., beam.smp) processes running, then you
> _do_ have a node up, though not necessarily responding properly. That's not
> the same as the program refusing to start though.
>
> >
> > By non-responsive, rabbitmqctl shows the node as being down,
>
> Could this be a file system corruption issue? Have you checked all the
> usual suspects for when rabbitmqctl won't connect to a node that you know
> is running, like checking the erlang cookies match?
>
> > but I could telnet to both the management port and the rabbitmq port
> (which I'm guessing is the epmd process)
>
> I'm not really sure what you mean by "the rabbitmq port", but we could be
> talking about several things here. (a) the port on which the broker accepts
> AMQP connections, (b) the port on which the broker accepts distributed
> erlang connections (which is assigned by epmd) or something else (?) so I'm
> not really sure what we're saying here.
>
> > , but nothing shows in the log files for rabbit itself, nothing in the
> sasl logs, no content from the management port, etc.
>
> Hmn, so you're sure (via ps and/or top) that there are beam.smp processes
> running, and you can see (via netstat) that the management HTTP port is in
> use, but there's no response from the HTTP (management) server?
>
> >  The OS was completely responsive - I could get to the shell, do most
> commands, though lsof (I think I mentioned this) wouldn't respond in any
> timely manner while rabbit server was running.
>
> That _is_ very strange.
>
> >  All the ways I know of to talk to rabbit and all the os things i know
> to do were failing and all the things I know to try and restart it (killing
> the processes, waiting for network connections in TIM_WAIT to drain,
> killing EPMD as well) all failed.
> >
> > At that point, I recycled each of the servers and they're back to a
> running state.  I don't know that I have a box handy but I'll see what I
> can do to replicate this.  For some reason I think I've seen this before
> and it's something with the OEL 6.2 kernel that Oracle put together,
> dealing with disk io flush on a journaled file system.  I'm pretty sure
> I've seen the same thing about 6 months ago or so on a completely different
> set of servers.
>
> Urgh, that sounds horrible. The more info you can provide us with the
> better. If you can replicate, that would be amazing since we can do the
> same thing and investigate.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/3f1beb2d/attachment.html>

From mklishin at gopivotal.com  Wed Mar 12 17:36:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 12 Mar 2014 21:36:08 +0400
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <CAD6m6fEj-3WyaoXbKfmQOWzP3RTLP+y-krk4=T=1vQirhqT2kg@mail.gmail.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
 <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
 <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>
 <2B32DAB5-8C1F-4B1B-A340-3315C25766B7@rabbitmq.com>
 <CAD6m6fEj-3WyaoXbKfmQOWzP3RTLP+y-krk4=T=1vQirhqT2kg@mail.gmail.com>
Message-ID: <6CE47C9B-ADD0-4675-A106-247DC6D278D6@rabbitmq.com>


On 12 Mar 2014, at 21:23, Jason McIntosh <mcintoshj at gmail.com> wrote:

> rabbitmq  2676  0.0  0.0  10844   540 ?        Ss   Mar11   0:00                  \_ inet_gethost 4
> rabbitmq  2677  0.0  0.0  12948   712 ?        S    Mar11   0:00                      \_ inet_gethost 4

Jason,

Can you please post your /etc/hosts file (or send it to me off list).

MK

Software Engineer, Pivotal/RabbitMQ



From pk_basu at hotmail.com  Wed Mar 12 18:19:00 2014
From: pk_basu at hotmail.com (pkbasu)
Date: Wed, 12 Mar 2014 11:19:00 -0700 (PDT)
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
Message-ID: <1394648340247-34067.post@n5.nabble.com>

Greetings,

here is the flow of my program -

1. Create a SimpleAmqpClient channel 
2. Consumer1 comes and created queues and bindings. 
3. BasicConsumeMessage is called on the channel, the one which consumes
message for any open consumers
4. We are waiting now for any message to come in.
5. Consumer2 comes and tries to create queue and bindings.
6. Consumer2 hangs since the channel is busy in step 4

How do I make this work? Creating a separate channel for creating queues and
bindings will not work since BasicConsumeMessage works only on consumers
created by its own channel.

Any help is greatly appreciated.

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SimpleAmqpClient-Channel-usage-tp34067.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Wed Mar 12 18:41:14 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 12 Mar 2014 13:41:14 -0500
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
In-Reply-To: <1394648340247-34067.post@n5.nabble.com>
References: <1394648340247-34067.post@n5.nabble.com>
Message-ID: <CAD6m6fHQkkpR95qnOAqSeC7Jdh8q+Uw6BqTysos7VVHMXOXSSw@mail.gmail.com>

If I follow your flow, shouldn't consumer2 create a separate channel for
it's stuff?  As it's unrelated to consumer1?

Jason


On Wed, Mar 12, 2014 at 1:19 PM, pkbasu <pk_basu at hotmail.com> wrote:

> Greetings,
>
> here is the flow of my program -
>
> 1. Create a SimpleAmqpClient channel
> 2. Consumer1 comes and created queues and bindings.
> 3. BasicConsumeMessage is called on the channel, the one which consumes
> message for any open consumers
> 4. We are waiting now for any message to come in.
> 5. Consumer2 comes and tries to create queue and bindings.
> 6. Consumer2 hangs since the channel is busy in step 4
>
> How do I make this work? Creating a separate channel for creating queues
> and
> bindings will not work since BasicConsumeMessage works only on consumers
> created by its own channel.
>
> Any help is greatly appreciated.
>
> Thanks.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/SimpleAmqpClient-Channel-usage-tp34067.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/059cb341/attachment.html>

From pk_basu at hotmail.com  Wed Mar 12 19:04:31 2014
From: pk_basu at hotmail.com (pkbasu)
Date: Wed, 12 Mar 2014 12:04:31 -0700 (PDT)
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
In-Reply-To: <CAD6m6fHQkkpR95qnOAqSeC7Jdh8q+Uw6BqTysos7VVHMXOXSSw@mail.gmail.com>
References: <1394648340247-34067.post@n5.nabble.com>
 <CAD6m6fHQkkpR95qnOAqSeC7Jdh8q+Uw6BqTysos7VVHMXOXSSw@mail.gmail.com>
Message-ID: <1394651071945-34069.post@n5.nabble.com>

SimpleAmqpClient channel has multiple consumer capability in the API itself.
Hence one channel should be able to support multiple consumers. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SimpleAmqpClient-Channel-usage-tp34067p34069.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From robert_parker at volusion.com  Wed Mar 12 21:27:28 2014
From: robert_parker at volusion.com (rparker)
Date: Wed, 12 Mar 2014 14:27:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Inconsistent Shovel Delivery
Message-ID: <1394659648393-34070.post@n5.nabble.com>

We have a simple shovel that takes messages published to a queue on a
rabbitmq cluster by a custom Windows service (using Mass Transit ) and then
shovels these messages across a WAN to a fanout exchange on a remote
rabbitmq cluster that routes to a queue of the same name on that remote
cluster.  Here's the basic config:

  {rabbitmq_shovel,
             [ {shovels, [ {my_shovel,
                    [ {sources,
                        [ {broker, "amqp://" }
                        ]}
                    , {destinations,
                        [ {broker, "amqp://guest:guest at server2:5672"}
                        ]}
                    , {queue, <<"My_Queue">>}
                    , {prefetch_count, 100}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {publish_fields, [ {exchange, <<"My_Exchange">>}]}
                    , {reconnect_delay, 5}
                    ]}
                ]}
    ]}

So, what's happening is that only every other message makes it to the
ultimate queue on the remote cluster.  We originally were addressing the
remote cluster via a load balancer and we thought this was an easy culprit,
but after changing the shovel config to go directly to the master node of
the remote cluster bypassing the LB, the problem still persisted.  We tried
decoupling both clusters and shoveling between two standalone nodes, and the
problem still persisted.  We tried unconfiguring shovel and published
directly to the exchanges/queues on both the local and remote clusters and
the correct number of messages were published.  Its only when shoveling is
used that we are getting an inconsistent number of messages, and when
examining the messages it shows that exactly every other message is making
it to the remote cluster.  No errors are evident in the log file and when I
show a status of the shovel, it shows it as running:

[{my_shovel,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,
                 rabbit at server1,none,[]}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "server2",5672,0,0,5,infinity,none,
                 [#Fun<amqp_uri.7.121371571>,#Fun<amqp_uri.7.121371571>],
                 [],[]}}},
     {{2014,3,12},{15,45,57}}}]
...done.

What on earth would cause this behavior other than some sort of faulty
firewall?  Why would only shovel messages be affected and not directly
published messages?  Is there a way to turn up the verbosity of the
shoveling logging?

RabbitMQ version is 3.2.4 with Erlang R16B03-1

Thanks in advance



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Inconsistent-Shovel-Delivery-tp34070.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From kvandikas at gmail.com  Wed Mar 12 14:57:50 2014
From: kvandikas at gmail.com (costa)
Date: Wed, 12 Mar 2014 07:57:50 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq fine tuning
Message-ID: <4a1eb6f8-58ef-4301-b632-eef670caea86@googlegroups.com>

under heavy load (around 1000 simultaneous requests/sec) I'm having a 
problem starting an amqp_connection (so amqp_connection:start) and I get 
the attached exception. I could appreciate any help with regards to 
troubleshooting this - though I'm fairly sure it is more of a matter of 
fine-tuning so any advice there would be greatly appreciated.

Cheers,

/Costa


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/653c6c79/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: error.log
Type: application/octet-stream
Size: 1553 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/653c6c79/attachment.obj>

From pkbasu at gmail.com  Wed Mar 12 18:10:59 2014
From: pkbasu at gmail.com (pkbasu)
Date: Wed, 12 Mar 2014 11:10:59 -0700 (PDT)
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
Message-ID: <74b20701-200d-4a23-9b55-6587a02cab50@googlegroups.com>

Greetings,

here is the flow of my program -

1. Create a SimpleAmqpClient channel 
2. Consumer1 comes and created queues and bindings. 
3. BasicConsumeMessage is called on the channel, the one which consumes 
message for any open consumers
4. We are waiting now for any message to come in.
5. Consumer2 comes and tries to create queue and bindings.
6. Consumer2 hangs since the channel is busy in step 4

How do I make this work? Creating a separate channel for creating queues 
and bindings will not work since BasicConsumeMessage works only on 
consumers created by its own channel.

Any help is greatly appreciated.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/c9e37eb3/attachment.html>

From Frame at SNHDMAIL.ORG  Wed Mar 12 23:56:56 2014
From: Frame at SNHDMAIL.ORG (Jason Frame)
Date: Wed, 12 Mar 2014 16:56:56 -0700
Subject: [rabbitmq-discuss] Issues getting RabbitMQ running using apt-get
Message-ID: <CF4642A7.BBD4%frame@snhdmail.org>


I have had no luck getting RabbitMQ to run using the apt repository.  I have been working on this for a couple of weeks now.

The server is Ubuntu 12.04 running on Linode, and I have opened up port 5672 on the iptables firewall.


Installation gets this far and then just hangs:


Unpacking rabbitmq-server (from .../rabbitmq-server_3.2.4-1_all.deb) ...

Processing triggers for man-db ...

Processing triggers for ureadahead ...

Setting up rabbitmq-server (3.2.4-1) ...

 * Starting message broker rabbitmq-server



ps aux | grep rabbit shows:

root      1756  0.0  0.0  38952  1648 pts/2    S+   16:44   0:00 sudo apt-get install rabbitmq-server

root      1757  0.1  0.6  85208 50344 pts/2    S+   16:44   0:01 apt-get install rabbitmq-server

root      2071  0.0  0.0  14636  3180 pts/0    Ss+  16:44   0:00 /usr/bin/dpkg --status-fd 63 --configure rabbitmq-server:all

root      2072  0.0  0.0   4408   684 pts/0    S+   16:44   0:00 /bin/sh /var/lib/dpkg/info/rabbitmq-server.postinst configure

root      2078  0.0  0.0   4408   708 pts/0    S+   16:44   0:00 /bin/sh /usr/sbin/invoke-rc.d rabbitmq-server start

root      2094  0.0  0.0   4408   752 pts/0    S+   16:44   0:00 /bin/sh /etc/init.d/rabbitmq-server start

rabbitmq  2146  0.0  0.0   4408   612 ?        S    16:44   0:00 /bin/sh /usr/sbin/rabbitmq-server

root      2147  0.0  0.0   4408   676 pts/0    S+   16:44   0:00 /bin/sh /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid

rabbitmq  2155  0.3  0.3 2236732 31120 ?       Sl   16:44   0:01 /usr/lib/erlang/erts-5.8.5/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../ebin -noshell -noinput -s rabbit boot -sname rabbit at webdb -boot start_sasl -kernel inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners [{"127.0.0.1",5672}] -sasl errlog_type error -sasl sasl_error_logger false -rabbit error_logger {file,"/var/log/rabbitmq/rabbit at webdb.log"} -rabbit sasl_error_logger {file,"/var/log/rabbitmq/rabbit at webdb-sasl.log"} -rabbit enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit plugins_dir "/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins" -rabbit plugins_expand_dir "/var/lib/rabbitmq/mnesia/rabbit at webdb-plugins-expand" -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at webdb"

rabbitmq  2165  0.0  0.0  40812  1380 pts/0    S+   16:44   0:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "wait" "/var/run/rabbitmq/pid"

rabbitmq  2168  0.0  0.0   4408   608 pts/0    S+   16:44   0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "wait" "/var/run/rabbitmq/pid"

rabbitmq  2171  0.0  0.1 181536  9692 pts/0    Sl+  16:44   0:00 /usr/lib/erlang/erts-5.8.5/bin/beam.smp -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl2171 -boot start_clean -s rabbit_control_main -nodename rabbit at webdb -extra wait /var/run/rabbitmq/pid

rabbitmq  2225  0.0  0.0   7388   420 ?        Ss   16:44   0:00 inet_gethost 4

rabbitmq  2258  0.0  0.0   9488   648 ?        S    16:44   0:00 inet_gethost 4

rabbitmq  2272  0.0  0.0   7388   420 ?        Ss   16:44   0:00 inet_gethost 4

rabbitmq  2273  0.0  0.0   9488   628 ?        S    16:44   0:00 inet_gethost 4


/etc/hosts:

$ more /etc/hosts

127.0.0.1       localhost

127.0.0.1       webdb webdb.snhdportal.org

127.0.1.1       li512-122 ubuntu

more /var/log/rabbitmq/startup_log

              RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit at webdb.log
  ######  ##        /var/log/rabbitmq/rabbit at webdb-sasl.log
  ##########
              Starting broker... completed with 0 plugins.


more /var/log/rabbitmq/startup_log

              RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit at webdb.log
  ######  ##        /var/log/rabbitmq/rabbit at webdb-sasl.log
  ##########
              Starting broker... completed with 0 plugins.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/d3952d33/attachment.html>

From jkuch at gopivotal.com  Thu Mar 13 00:05:31 2014
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Wed, 12 Mar 2014 17:05:31 -0700
Subject: [rabbitmq-discuss] Issues getting RabbitMQ running using apt-get
In-Reply-To: <CF4642A7.BBD4%frame@snhdmail.org>
References: <CF4642A7.BBD4%frame@snhdmail.org>
Message-ID: <CANOx8Nm7b+Vh+DsH=hRGrA2OrG3NoYfHEbLVYFcFq3pOPTdV3Q@mail.gmail.com>

So that all looks like you're running?  What is it that you're not seeing?




On Wed, Mar 12, 2014 at 4:56 PM, Jason Frame <Frame at snhdmail.org> wrote:

>
> I have had no luck getting RabbitMQ to run using the apt repository.  I
> have been working on this for a couple of weeks now.
>
> The server is Ubuntu 12.04 running on Linode, and I have opened up port
> 5672 on the iptables firewall.
>
>
> *Installation gets this far and then just hangs:*
>
>
> Unpacking rabbitmq-server (from .../rabbitmq-server_3.2.4-1_all.deb) ...
>
> Processing triggers for man-db ...
>
> Processing triggers for ureadahead ...
>
> Setting up rabbitmq-server (3.2.4-1) ...
>
>  * Starting message broker rabbitmq-server
>
>
> *ps aux | grep rabbit shows:*
>
> root      1756  0.0  0.0  38952  1648 pts/2    S+   16:44   0:00 sudo
> apt-get install rabbitmq-server
>
> root      1757  0.1  0.6  85208 50344 pts/2    S+   16:44   0:01 apt-get
> install rabbitmq-server
>
> root      2071  0.0  0.0  14636  3180 pts/0    Ss+  16:44   0:00
> /usr/bin/dpkg --status-fd 63 --configure rabbitmq-server:all
>
> root      2072  0.0  0.0   4408   684 pts/0    S+   16:44   0:00 /bin/sh
> /var/lib/dpkg/info/rabbitmq-server.postinst configure
>
> root      2078  0.0  0.0   4408   708 pts/0    S+   16:44   0:00 /bin/sh
> /usr/sbin/invoke-rc.d rabbitmq-server start
>
> root      2094  0.0  0.0   4408   752 pts/0    S+   16:44   0:00 /bin/sh
> /etc/init.d/rabbitmq-server start
>
> rabbitmq  2146  0.0  0.0   4408   612 ?        S    16:44   0:00 /bin/sh
> /usr/sbin/rabbitmq-server
>
> root      2147  0.0  0.0   4408   676 pts/0    S+   16:44   0:00 /bin/sh
> /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
>
> rabbitmq  2155  0.3  0.3 2236732 31120 ?       Sl   16:44   0:01
> /usr/lib/erlang/erts-5.8.5/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../ebin -noshell -noinput
> -s rabbit boot -sname rabbit at webdb -boot start_sasl -kernel
> inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners
> [{"127.0.0.1",5672}] -sasl errlog_type error -sasl sasl_error_logger false
> -rabbit error_logger {file,"/var/log/rabbitmq/rabbit at webdb.log"} -rabbit
> sasl_error_logger {file,"/var/log/rabbitmq/rabbit at webdb-sasl.log"}
> -rabbit enabled_plugins_file "/etc/rabbitmq/enabled_plugins" -rabbit
> plugins_dir "/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../plugins"
> -rabbit plugins_expand_dir
> "/var/lib/rabbitmq/mnesia/rabbit at webdb-plugins-expand" -os_mon
> start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false
> -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at webdb"
>
> rabbitmq  2165  0.0  0.0  40812  1380 pts/0    S+   16:44   0:00 su
> rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "wait"
> "/var/run/rabbitmq/pid"
>
> rabbitmq  2168  0.0  0.0   4408   608 pts/0    S+   16:44   0:00 sh -c
> /usr/lib/rabbitmq/bin/rabbitmqctl  "wait" "/var/run/rabbitmq/pid"
>
> rabbitmq  2171  0.0  0.1 181536  9692 pts/0    Sl+  16:44   0:00
> /usr/lib/erlang/erts-5.8.5/bin/beam.smp -- -root /usr/lib/erlang -progname
> erl -- -home /var/lib/rabbitmq -- -pa
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.4/sbin/../ebin -noshell -noinput
> -hidden -sname rabbitmqctl2171 -boot start_clean -s rabbit_control_main
> -nodename rabbit at webdb -extra wait /var/run/rabbitmq/pid
>
> rabbitmq  2225  0.0  0.0   7388   420 ?        Ss   16:44   0:00
> inet_gethost 4
>
> rabbitmq  2258  0.0  0.0   9488   648 ?        S    16:44   0:00
> inet_gethost 4
>
> rabbitmq  2272  0.0  0.0   7388   420 ?        Ss   16:44   0:00
> inet_gethost 4
>
> rabbitmq  2273  0.0  0.0   9488   628 ?        S    16:44   0:00
> inet_gethost 4
>
> */etc/hosts:*
>
> $ more /etc/hosts
>
> 127.0.0.1       localhost
>
> 127.0.0.1       webdb webdb.snhdportal.org
> 127.0.1.1       li512-122 ubuntu
>
> *more /var/log/rabbitmq/startup_log*
>
>               RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
>   ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>   ##  ##
>   ##########  Logs: /var/log/rabbitmq/rabbit at webdb.log
>   ######  ##        /var/log/rabbitmq/rabbit at webdb-sasl.log
>   ##########
>               Starting broker... completed with 0 plugins.
>
>
> *more /var/log/rabbitmq/startup_log*
>
>               RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
>   ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
>   ##  ##
>   ##########  Logs: /var/log/rabbitmq/rabbit at webdb.log
>   ######  ##        /var/log/rabbitmq/rabbit at webdb-sasl.log
>   ##########
>               Starting broker... completed with 0 plugins.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/b2a2f3ed/attachment.html>

From ratheesh.ksz at gmail.com  Thu Mar 13 03:58:54 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Thu, 13 Mar 2014 09:28:54 +0530
Subject: [rabbitmq-discuss] ulimit and cgroup
Message-ID: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>

Suppose i restrict  REZ memory and file size   etc ( system resources
)  using  ulimit and cgroup, what will be the behaviour of rabbitMQ. ?
 Suppose a lot of messages gets queued and writing to disk ; if i have
a limit on the file size. ??

-Ratheesh

From alan.antonuk at gmail.com  Thu Mar 13 04:48:26 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 12 Mar 2014 21:48:26 -0700
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
In-Reply-To: <1394648340247-34067.post@n5.nabble.com>
References: <1394648340247-34067.post@n5.nabble.com>
Message-ID: <CAAt2poLzd2cVNaBsV9Pk-gyPNb0R0URB3tE08nna4HbT5ZjBNA@mail.gmail.com>

If I understand your scenario correctly: you want to create
consumers/queues/bindings, while blocking waiting for a message using
BasicConsumeMessage().

Unfortunately SimpleAmqpClient and the rabbitmq-c library it wraps are
single threaded, and don't support this use-case well. You have one of two
options:

- Create a new SimpleAmqpClient Channel object for each consumer. (Note
that a SimpleAmqpClient Channel object wraps an entire AMQP connection, and
manages AMQP channels internally, yes this was a poorly named).
- Use the timeout parameter on BasicConsumeMessage, and occasionally poll
for a new consumers and create the consumers/queues/bindings as necessary.
- Depending on how your application is setup there's probably a third way.

-Alan



On Wed, Mar 12, 2014 at 11:19 AM, pkbasu <pk_basu at hotmail.com> wrote:

> Greetings,
>
> here is the flow of my program -
>
> 1. Create a SimpleAmqpClient channel
> 2. Consumer1 comes and created queues and bindings.
> 3. BasicConsumeMessage is called on the channel, the one which consumes
> message for any open consumers
> 4. We are waiting now for any message to come in.
> 5. Consumer2 comes and tries to create queue and bindings.
> 6. Consumer2 hangs since the channel is busy in step 4
>
> How do I make this work? Creating a separate channel for creating queues
> and
> bindings will not work since BasicConsumeMessage works only on consumers
> created by its own channel.
>
>



> Any help is greatly appreciated.
>
> Thanks.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/SimpleAmqpClient-Channel-usage-tp34067.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140312/e9138893/attachment.html>

From pk_basu at hotmail.com  Thu Mar 13 06:36:38 2014
From: pk_basu at hotmail.com (pkbasu)
Date: Wed, 12 Mar 2014 23:36:38 -0700 (PDT)
Subject: [rabbitmq-discuss] SimpleAmqpClient Channel usage
In-Reply-To: <CAAt2poLzd2cVNaBsV9Pk-gyPNb0R0URB3tE08nna4HbT5ZjBNA@mail.gmail.com>
References: <1394648340247-34067.post@n5.nabble.com>
 <CAAt2poLzd2cVNaBsV9Pk-gyPNb0R0URB3tE08nna4HbT5ZjBNA@mail.gmail.com>
Message-ID: <1394692598656-34077.post@n5.nabble.com>

Thanks Alan! That answers my question.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SimpleAmqpClient-Channel-usage-tp34067p34077.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Mar 13 08:33:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 13 Mar 2014 12:33:36 +0400
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
Message-ID: <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>

On 13 Mar 2014, at 07:58, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> Suppose i restrict  REZ memory and file size   etc ( system resources
> )  using  ulimit and cgroup, what will be the behaviour of rabbitMQ. ?
> Suppose a lot of messages gets queued and writing to disk ; if i have
> a limit on the file size. ??

It depends on message size but once you cross a certain threshold, RabbitMQ
will try to move messages to disk. There should be no giant files, though, on disk
message store will split them into multiple smaller files (16 MB by default, AFAIR).

There is a fixed (a few dozens of bytes) RAM cost per message until you use a 
custom queue index plugin, such as rabbitmq-toke [1].

If RabbitMQ cannot allocate memory or write to a file, of course, there is little it can do, so be
careful about setting RSS and file size limit. It?s a good idea to adjust RabbitMQ VM high memory watermark
to be lower than the OS limit you use.

1. http://hg.rabbitmq.com/rabbitmq-toke/

MK

Software Engineer, Pivotal/RabbitMQ



From ratheesh.ksz at gmail.com  Thu Mar 13 08:47:22 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Thu, 13 Mar 2014 14:17:22 +0530
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
Message-ID: <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>

On Thu, Mar 13, 2014 at 2:03 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>>
> It depends on message size but once you cross a certain threshold, RabbitMQ
> will try to move messages to disk.
This is the case even if  we don't use durable queues...right ?

> There should be no giant files, though, on disk
> message store will split them into multiple smaller files (16 MB by default, AFAIR).

All these files would be opened and kept. Or will be opened on demand.
Because linux ulimit can set limit on
no of opened files.

> There is a fixed (a few dozens of bytes) RAM cost per message until you use a
> custom queue index plugin, such as rabbitmq-toke [1].

Can you list out other plugins ( and tuning parameters ) through which
i can tune Broker's system resource usage ?

> If RabbitMQ cannot allocate memory or write to a file, of course, there is little it can do, so be
> careful about setting RSS and file size limit.
Will it gracefully shutdown ?  Can you predict the behavior ? it just crash ?

-Ratheesh

From mklishin at gopivotal.com  Thu Mar 13 09:18:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 13 Mar 2014 13:18:23 +0400
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
Message-ID: <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>

On 13 Mar 2014, at 12:47, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> This is the case even if  we don't use durable queues...right ?

This is true for non-persistent messages, too.

> 
>> There should be no giant files, though, on disk
>> message store will split them into multiple smaller files (16 MB by default, AFAIR).
> 
> All these files would be opened and kept. Or will be opened on demand.
> Because linux ulimit can set limit on
> no of opened files.

They are created as needed. However, during compaction (garbage collection
of messages on disk), the number of files may temporarily become up to 2 times greater
than usual.

It is rarely a good idea to set a limit on how many files RabbitMQ (or any other infrastructure service, e.g. PostgreSQL or Cassandra)
can open. Best case scenario it will stop accepting new connections (there will be messages
in the log about this).

In general RabbitMQ tries to reduce the number of file descriptors it uses.

> 
>> There is a fixed (a few dozens of bytes) RAM cost per message until you use a
>> custom queue index plugin, such as rabbitmq-toke [1].
> 
> Can you list out other plugins ( and tuning parameters ) through which
> i can tune Broker's system resource usage ?

http://www.rabbitmq.com/configure.html#configuration-file

> 
>> If RabbitMQ cannot allocate memory or write to a file, of course, there is little it can do, so be
>> careful about setting RSS and file size limit.
> Will it gracefully shutdown ?  Can you predict the behavior ? it just crash ?

If it fails to write to a file, the OS process won?t crash. If VM fails to allocate memory,
it will exit and RabbitMQ will have no chance to shut down.

Graceful shutdown involves disk I/O, too.
--
MK

Software Engineer, Pivotal/RabbitMQ


From matthias at rabbitmq.com  Thu Mar 13 09:25:47 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Mar 2014 09:25:47 +0000
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
 <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
Message-ID: <5321799B.5060205@rabbitmq.com>

On 13/03/14 09:18, Michael Klishin wrote:
> On 13 Mar 2014, at 12:47, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:
>> All these files would be opened and kept. Or will be opened on demand.
>> Because linux ulimit can set limit on
>> no of opened files.
>
> In general RabbitMQ tries to reduce the number of file descriptors it uses.

...and it *does* stick to the ulimit; it is possible to run rabbit with 
just a handful of file descriptors, but this will severely impact 
performance.

Matthias.

From ratheesh.ksz at gmail.com  Thu Mar 13 09:36:29 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Thu, 13 Mar 2014 15:06:29 +0530
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <5321799B.5060205@rabbitmq.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
 <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
 <5321799B.5060205@rabbitmq.com>
Message-ID: <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>

On Thu, Mar 13, 2014 at 2:55 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> ...and it *does* stick to the ulimit; it is possible to run rabbit with just
> a handful of file descriptors, but this will severely impact performance.
Is there a configuration to choose  no of descriptor ? How is this handled ?

On Thu, Mar 13, 2014 at 2:03 PM, Michael Klishin <mklishin at gopivotal.com> wrote
>http://www.rabbitmq.com/configure.html#configuration-file
I saw a paramter  "cluster_nodes" . it mentions about automatic
clustering. So this means, clustering just works between brokers.And
producer and consumer are unaware of chosen broker  and  clustering of
brokers ?. I am just curious here. Because ultimately these
connections are over tcp, and are  initiated from client to server.
Atleast ; there should be an communication  from server to client
saying that :-" hey i am down , please send it to other node" . Is
part is already implemented  by rabbitmq clients ?

 -Ratheesh

From simon at rabbitmq.com  Thu Mar 13 09:40:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 09:40:43 +0000
Subject: [rabbitmq-discuss] Inconsistent Shovel Delivery
In-Reply-To: <1394659648393-34070.post@n5.nabble.com>
References: <1394659648393-34070.post@n5.nabble.com>
Message-ID: <53217D1B.1010506@rabbitmq.com>

On 12/03/2014 21:27, rparker wrote:
> We have a simple shovel that takes messages published to a queue on a
> rabbitmq cluster by a custom Windows service (using Mass Transit ) and then
> shovels these messages across a WAN to a fanout exchange on a remote
> rabbitmq cluster that routes to a queue of the same name on that remote
> cluster.  Here's the basic config:

<snip>

The config looks fine.

> So, what's happening is that only every other message makes it to the
> ultimate queue on the remote cluster.  We originally were addressing the
> remote cluster via a load balancer and we thought this was an easy culprit,
> but after changing the shovel config to go directly to the master node of
> the remote cluster bypassing the LB, the problem still persisted.  We tried
> decoupling both clusters and shoveling between two standalone nodes, and the
> problem still persisted.  We tried unconfiguring shovel and published
> directly to the exchanges/queues on both the local and remote clusters and
> the correct number of messages were published.  Its only when shoveling is
> used that we are getting an inconsistent number of messages, and when
> examining the messages it shows that exactly every other message is making
> it to the remote cluster.  No errors are evident in the log file and when I
> show a status of the shovel, it shows it as running:

<snip>

Which also looks fine.

> What on earth would cause this behavior other than some sort of faulty
> firewall?  Why would only shovel messages be affected and not directly
> published messages?

It is very very hard to believe that the shovel is throwing away every 
other message: there's absolutely nothing in the shovel code that would 
even be able to do that.

Your shovel is in on_confirm mode - that means that messages will only 
get acked to the source broker once the destination broker has accepted 
them. So even if somehow the shovel were losing messages, it would 
manifest as the unacked message count growing forever on the source 
queue. I assume this is not happening!

The fact that you're losing exactly every other message strongly hints 
towards there being a second consumer somewhere, probably on the source 
queue. That could be another shovel, or a client app of yours. That's 
the only thing in RabbitMQ which will distribute messages in a round 
robin fashion like that. So first of all I'd check for a consumer you 
haven't seen. "rabbitmqctl list_consumers" or the queue details page in 
mgmt should help here.

> Is there a way to turn up the verbosity of the
> shoveling logging?

Not in the shovel itself. But you could check what's happening on the 
wire with wireshark, or turn on the tracer 
http://www.rabbitmq.com/firehose.html. Depending on your message volumes 
that could be a lot of extra verbosity though.

Cheers, Simon

From matthias at rabbitmq.com  Thu Mar 13 09:41:16 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Mar 2014 09:41:16 +0000
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
 <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
 <5321799B.5060205@rabbitmq.com>
 <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>
Message-ID: <53217D3C.20609@rabbitmq.com>

On 13/03/14 09:36, ratheesh kannoth wrote:
> On Thu, Mar 13, 2014 at 2:55 PM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> ...and it *does* stick to the ulimit; it is possible to run rabbit with just
>> a handful of file descriptors, but this will severely impact performance.
> Is there a configuration to choose  no of descriptor ? How is this handled ?

Rabbit is aware of the ulimit. So to adjust the max number of file 
descriptors rabbit will use, simply adjust the ulimit.

Matthias.

From simon at rabbitmq.com  Thu Mar 13 10:14:57 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 10:14:57 +0000
Subject: [rabbitmq-discuss] Older versions not available in apt
	repository.
In-Reply-To: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>
References: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>
Message-ID: <53218521.3030703@rabbitmq.com>

On 12/03/2014 12:45, Chris Nicel wrote:
> I?m attempting to install a non production cluster for some testing. We
> are using 3.1.5 but this version doesn?t seem to be available from your
> apt repository @
> http://www.rabbitmq.com/debian/dists/testing/main/binary-amd64/ I need
> to install the same version as we have in production and would prefer to
> use  our standard approach for installing using apt-get install.

I'm afraid that's not possible. The apt repository is build from scratch 
at every release. Yeah, that's not ideal.

> I am
> reasonably sure that I was able to do this previously and install older
> versions, has something changed at your end?

No, that's how it's always been.

> Alternatively, is there
> another repository I could use which holds older versions?

The versions that make it into the Debian repos proper are almost 
identical to the ones we release, but our repo will tend to be a bit 
ahead of Debian.

Alternatively you can download old releases in .deb format from 
http://www.rabbitmq.com/releases/rabbitmq-server/. But of course that's 
no apt repository.

Cheers, Simon

From Chris.Nicel at 15below.com  Thu Mar 13 10:20:58 2014
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 13 Mar 2014 05:20:58 -0500
Subject: [rabbitmq-discuss] Older versions not available in apt
 repository.
In-Reply-To: <53218521.3030703@rabbitmq.com>
References: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>
 <53218521.3030703@rabbitmq.com>
Message-ID: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F9A7@AUSP01VMBX09.collaborationhost.net>

Hi Simon,

Thanks for the info. I guess I must have been lucky the previous times I had used the repository. We'll either build our own PPA or repo and use that instead. If we go down the PPA route, I'll post here to let others know about it.

Cheers

Chris

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 13 March 2014 10:15
To: Discussions about RabbitMQ; Chris Nicel
Subject: Re: [rabbitmq-discuss] Older versions not available in apt repository.

On 12/03/2014 12:45, Chris Nicel wrote:
> I'm attempting to install a non production cluster for some testing.
> We are using 3.1.5 but this version doesn't seem to be available from
> your apt repository @
> http://www.rabbitmq.com/debian/dists/testing/main/binary-amd64/ I need
> to install the same version as we have in production and would prefer
> to use  our standard approach for installing using apt-get install.

I'm afraid that's not possible. The apt repository is build from scratch at every release. Yeah, that's not ideal.

> I am
> reasonably sure that I was able to do this previously and install
> older versions, has something changed at your end?

No, that's how it's always been.

> Alternatively, is there
> another repository I could use which holds older versions?

The versions that make it into the Debian repos proper are almost identical to the ones we release, but our repo will tend to be a bit ahead of Debian.

Alternatively you can download old releases in .deb format from http://www.rabbitmq.com/releases/rabbitmq-server/. But of course that's no apt repository.

Cheers, Simon

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From otnateos at gmail.com  Thu Mar 13 10:40:34 2014
From: otnateos at gmail.com (Johanes Soetanto)
Date: Thu, 13 Mar 2014 21:40:34 +1100
Subject: [rabbitmq-discuss] Older versions not available in apt
	repository.
In-Reply-To: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F9A7@AUSP01VMBX09.collaborationhost.net>
References: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>
 <53218521.3030703@rabbitmq.com>
 <CA9678C0A14EEA4D95D3A54B6FACE91457F408F9A7@AUSP01VMBX09.collaborationhost.net>
Message-ID: <CAHn_Lrx9SiE-fhuf0CPrjHWha7H3VU_+2VWXbMWBM4ttVQpqfw@mail.gmail.com>

On 13/03/2014 9:23 PM, "Chris Nicel" <Chris.Nicel at 15below.com> wrote:
>
> Hi Simon,
>
> Thanks for the info. I guess I must have been lucky the previous times I
had used the repository. We'll either build our own PPA or repo and use
that instead. If we go down the PPA route, I'll post here to let others
know about it.
>
> Cheers
>
> Chris

We encounter similar issue with certain version and we end up downloading
older version from rabbitmq website. The only difference we now automate
installation with something like ansible and set it up to download from
rabbitmq website.

>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 13 March 2014 10:15
> To: Discussions about RabbitMQ; Chris Nicel
> Subject: Re: [rabbitmq-discuss] Older versions not available in apt
repository.
>
> On 12/03/2014 12:45, Chris Nicel wrote:
> > I'm attempting to install a non production cluster for some testing.
> > We are using 3.1.5 but this version doesn't seem to be available from
> > your apt repository @
> > http://www.rabbitmq.com/debian/dists/testing/main/binary-amd64/ I need
> > to install the same version as we have in production and would prefer
> > to use  our standard approach for installing using apt-get install.
>
> I'm afraid that's not possible. The apt repository is build from scratch
at every release. Yeah, that's not ideal.
>
> > I am
> > reasonably sure that I was able to do this previously and install
> > older versions, has something changed at your end?
>
> No, that's how it's always been.
>
> > Alternatively, is there
> > another repository I could use which holds older versions?
>
> The versions that make it into the Debian repos proper are almost
identical to the ones we release, but our repo will tend to be a bit ahead
of Debian.
>
> Alternatively you can download old releases in .deb format from
http://www.rabbitmq.com/releases/rabbitmq-server/. But of course that's no
apt repository.
>
> Cheers, Simon
>
>  15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000,
Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally
privileged and are solely for the use of the intended recipient.  If you
have received this email in error please contact the sender.  Any views or
opinions expressed within this e-mail are solely those of the sender, and
do not necessarily represent those of 15below unless otherwise specifically
stated.  Although 15below has taken every reasonable precaution to ensure
that any attachment to this e-mail has been checked for viruses, it is
strongly recommended that you carry out your own virus check before opening
any attachment, as we cannot accept liability for any damage sustained as a
result of software virus infection.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/867e7713/attachment.html>

From Chris.Nicel at 15below.com  Thu Mar 13 10:51:28 2014
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 13 Mar 2014 05:51:28 -0500
Subject: [rabbitmq-discuss] Older versions not available in
	apt	repository.
In-Reply-To: <CAHn_Lrx9SiE-fhuf0CPrjHWha7H3VU_+2VWXbMWBM4ttVQpqfw@mail.gmail.com>
References: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F773@AUSP01VMBX09.collaborationhost.net>
 <53218521.3030703@rabbitmq.com>
 <CA9678C0A14EEA4D95D3A54B6FACE91457F408F9A7@AUSP01VMBX09.collaborationhost.net>
 <CAHn_Lrx9SiE-fhuf0CPrjHWha7H3VU_+2VWXbMWBM4ttVQpqfw@mail.gmail.com>
Message-ID: <CA9678C0A14EEA4D95D3A54B6FACE91457F408F9B2@AUSP01VMBX09.collaborationhost.net>

Useful info there.

Thanks Johanes.

From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Johanes Soetanto
Sent: 13 March 2014 10:41
To: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] Older versions not available in apt repository.


On 13/03/2014 9:23 PM, "Chris Nicel" <Chris.Nicel at 15below.com<mailto:Chris.Nicel at 15below.com>> wrote:
>
> Hi Simon,
>
> Thanks for the info. I guess I must have been lucky the previous times I had used the repository. We'll either build our own PPA or repo and use that instead. If we go down the PPA route, I'll post here to let others know about it.
>
> Cheers
>
> Chris

We encounter similar issue with certain version and we end up downloading older version from rabbitmq website. The only difference we now automate installation with something like ansible and set it up to download from rabbitmq website.

>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com<mailto:simon at rabbitmq.com>]
> Sent: 13 March 2014 10:15
> To: Discussions about RabbitMQ; Chris Nicel
> Subject: Re: [rabbitmq-discuss] Older versions not available in apt repository.
>
> On 12/03/2014 12:45, Chris Nicel wrote:
> > I'm attempting to install a non production cluster for some testing.
> > We are using 3.1.5 but this version doesn't seem to be available from
> > your apt repository @
> > http://www.rabbitmq.com/debian/dists/testing/main/binary-amd64/ I need
> > to install the same version as we have in production and would prefer
> > to use  our standard approach for installing using apt-get install.
>
> I'm afraid that's not possible. The apt repository is build from scratch at every release. Yeah, that's not ideal.
>
> > I am
> > reasonably sure that I was able to do this previously and install
> > older versions, has something changed at your end?
>
> No, that's how it's always been.
>
> > Alternatively, is there
> > another repository I could use which holds older versions?
>
> The versions that make it into the Debian repos proper are almost identical to the ones we release, but our repo will tend to be a bit ahead of Debian.
>
> Alternatively you can download old releases in .deb format from http://www.rabbitmq.com/releases/rabbitmq-server/. But of course that's no apt repository.
>
> Cheers, Simon
>
>  15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/753fdfd7/attachment.html>

From delda1980 at gmail.com  Thu Mar 13 08:38:39 2014
From: delda1980 at gmail.com (delda1980 at gmail.com)
Date: Thu, 13 Mar 2014 01:38:39 -0700 (PDT)
Subject: [rabbitmq-discuss] How impement a php RabbitMQ recever
Message-ID: <f122ed3d-36b8-4b62-a1f9-f77b2ca3eb03@googlegroups.com>

Hi all,

i use RabbitMQ for my little web site and i have a question for you: how 
implement a recever?
The receiver is a program that must run forever and this is a problem: 
memory leak and other error block the receiver and the queue becomes bigger 
and bigger...
To resolve this problem i have a precess father that creates a child. The 
child is the rabbitmq receiver and, if the child dies, the father creates a 
new child that become the new rabbitmq receiver.

Is this a correct procedure? Have you another model to suggest?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/1b092295/attachment.html>

From videlalvaro at gmail.com  Thu Mar 13 11:53:42 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 13 Mar 2014 12:53:42 +0100
Subject: [rabbitmq-discuss] How impement a php RabbitMQ recever
In-Reply-To: <f122ed3d-36b8-4b62-a1f9-f77b2ca3eb03@googlegroups.com>
References: <f122ed3d-36b8-4b62-a1f9-f77b2ca3eb03@googlegroups.com>
Message-ID: <CAMcAHLVZ8Q6oDzq8R4B-xYW8pXXg=rWZh+SWMW89PJw441nRTQ@mail.gmail.com>

That's common practice, usually people go with http://supervisord.org/
for doing that.

I would still debug the memory leak, the newer PHP versions are much
better when it comes to memory handling. On what version are you on?

-Alvaro

On Thu, Mar 13, 2014 at 9:38 AM,  <delda1980 at gmail.com> wrote:
> Hi all,
>
> i use RabbitMQ for my little web site and i have a question for you: how
> implement a recever?
> The receiver is a program that must run forever and this is a problem:
> memory leak and other error block the receiver and the queue becomes bigger
> and bigger...
> To resolve this problem i have a precess father that creates a child. The
> child is the rabbitmq receiver and, if the child dies, the father creates a
> new child that become the new rabbitmq receiver.
>
> Is this a correct procedure? Have you another model to suggest?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ryankbrown at gmail.com  Thu Mar 13 12:57:54 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Thu, 13 Mar 2014 06:57:54 -0600
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
	client?
Message-ID: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>

I am attempting to modify an existing Erlang codebase that acts as a rest
wrapper around rabbitmq providing some additional business logic. One of
the new requirements is for the client to add a header to their request
specifying if they want to use publish confirms or not. Our current
implementation sets-up an exchange in a gen_server that does not use
publish confirms and re-uses that exchange for all messages. Now I am
trying to set-up a second exchange that does but am struggling.

Does anybody know of an example using publish confirms with Erlang client?
Preferably from within a gen_server I can register as the confirm handler
(self()).

Best,
Ryan


-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/16a47297/attachment.html>

From simon at rabbitmq.com  Thu Mar 13 13:04:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 13:04:37 +0000
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
 client?
In-Reply-To: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>
References: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>
Message-ID: <5321ACE5.5060905@rabbitmq.com>

On 13/03/14 12:57, Ryan Brown wrote:
> I am attempting to modify an existing Erlang codebase that acts as a
> rest wrapper around rabbitmq providing some additional business logic.
> One of the new requirements is for the client to add a header to their
> request specifying if they want to use publish confirms or not. Our
> current implementation sets-up an exchange in a gen_server that does not
> use publish confirms and re-uses that exchange for all messages. Now I
> am trying to set-up a second exchange that does but am struggling.

Note that the question of whether you're using confirms is per-channel, 
not per-exchange.

> Does anybody know of an example using publish confirms with Erlang
> client? Preferably from within a gen_server I can register as the
> confirm handler (self()).

Have a look at the shovel worker and what it does in ack_mode = on_confirm:

http://hg.rabbitmq.com/rabbitmq-shovel/file/4323e6db74c8/src/rabbit_shovel_worker.erl

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ryankbrown at gmail.com  Thu Mar 13 13:16:03 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Thu, 13 Mar 2014 07:16:03 -0600
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
	client?
In-Reply-To: <5321ACE5.5060905@rabbitmq.com>
References: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>
 <5321ACE5.5060905@rabbitmq.com>
Message-ID: <CAChGYf_HQakcmAf_yLrb7nvMCbXx8LT+AzbreA2N4F_F-oGWEQ@mail.gmail.com>

Good clarification Simon. Thank you! I apologize for my confusion.

I will look into the shovel worker. As I mentioned, I am modifying existing
code so, that might be too much of a change in approach. (Whether or not
it's the right approach!)

Thanks again!

Ryan

On Thursday, March 13, 2014, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/03/14 12:57, Ryan Brown wrote:
>
>> I am attempting to modify an existing Erlang codebase that acts as a
>> rest wrapper around rabbitmq providing some additional business logic.
>> One of the new requirements is for the client to add a header to their
>> request specifying if they want to use publish confirms or not. Our
>> current implementation sets-up an exchange in a gen_server that does not
>> use publish confirms and re-uses that exchange for all messages. Now I
>> am trying to set-up a second exchange that does but am struggling.
>>
>
> Note that the question of whether you're using confirms is per-channel,
> not per-exchange.
>
>  Does anybody know of an example using publish confirms with Erlang
>> client? Preferably from within a gen_server I can register as the
>> confirm handler (self()).
>>
>
> Have a look at the shovel worker and what it does in ack_mode = on_confirm:
>
> http://hg.rabbitmq.com/rabbitmq-shovel/file/4323e6db74c8/src/rabbit_
> shovel_worker.erl
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>


-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/0bfe6c4e/attachment.html>

From simon at rabbitmq.com  Thu Mar 13 13:24:29 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 13:24:29 +0000
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
	client?
In-Reply-To: <CAChGYf_HQakcmAf_yLrb7nvMCbXx8LT+AzbreA2N4F_F-oGWEQ@mail.gmail.com>
References: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>	<5321ACE5.5060905@rabbitmq.com>
 <CAChGYf_HQakcmAf_yLrb7nvMCbXx8LT+AzbreA2N4F_F-oGWEQ@mail.gmail.com>
Message-ID: <5321B18D.6050506@rabbitmq.com>

On 13/03/14 13:16, Ryan Brown wrote:
> I will look into the shovel worker. As I mentioned, I am modifying
> existing code so, that might be too much of a change in approach.
> (Whether or not it's the right approach!)

Sorry, I meant "have a look at how the shovel worker works" not "use the 
shovel worker" (which would be crazy) - since it's an example of a 
gen_server using the Erlang client to do confirms.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Mar 13 13:27:30 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 13:27:30 +0000
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
 client?
In-Reply-To: <5321B18D.6050506@rabbitmq.com>
References: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>	<5321ACE5.5060905@rabbitmq.com>
 <CAChGYf_HQakcmAf_yLrb7nvMCbXx8LT+AzbreA2N4F_F-oGWEQ@mail.gmail.com>
 <5321B18D.6050506@rabbitmq.com>
Message-ID: <5321B242.4010307@rabbitmq.com>

On 13/03/14 13:24, Simon MacMullen wrote:
> I meant "have a look at how the shovel worker works"

Also, if you are building a REST service then 
http://hg.rabbitmq.com/rabbitmq-management/file/509122c1b810/src/rabbit_mgmt_wm_exchange_publish.erl 
might prove interesting.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ryankbrown at gmail.com  Thu Mar 13 14:32:49 2014
From: ryankbrown at gmail.com (Ryan Brown)
Date: Thu, 13 Mar 2014 08:32:49 -0600
Subject: [rabbitmq-discuss] Example using publish confirms with Erlang
	client?
In-Reply-To: <5321B242.4010307@rabbitmq.com>
References: <CAChGYf9_7rLJqE=CCp=taYZNi==TnHixcOqEY0U4kTi4bs87pQ@mail.gmail.com>
 <5321ACE5.5060905@rabbitmq.com>
 <CAChGYf_HQakcmAf_yLrb7nvMCbXx8LT+AzbreA2N4F_F-oGWEQ@mail.gmail.com>
 <5321B18D.6050506@rabbitmq.com> <5321B242.4010307@rabbitmq.com>
Message-ID: <CAChGYf_sYnv+nOod9O0RUxKLyCk5r=YOmadDRoCAp5z=oDbzuw@mail.gmail.com>

This is all excellent! Thank you Simon! I will digest this and see if I can
work it out.

Best,

Ryan


On Thu, Mar 13, 2014 at 7:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/03/14 13:24, Simon MacMullen wrote:
>
>> I meant "have a look at how the shovel worker works"
>>
>
> Also, if you are building a REST service then http://hg.rabbitmq.com/
> rabbitmq-management/file/509122c1b810/src/rabbit_mgmt_
> wm_exchange_publish.erl might prove interesting.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-rb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/0372daff/attachment.html>

From mwaisgold at gmail.com  Thu Mar 13 14:41:03 2014
From: mwaisgold at gmail.com (=?ISO-8859-1?Q?Mat=EDas_Waisgold?=)
Date: Thu, 13 Mar 2014 11:41:03 -0300
Subject: [rabbitmq-discuss] Issues with flow control
Message-ID: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>

Hi I'm having a 4 machines rabbit cluster, the average input is about 400
msgs/s and outputs 1000 msgs/s.
I've migrated from 2.7 to the last version and seeing a los of blocked
connections some times with flow control.
But I always se that my memory thresholds and disk space threasholds are
not even close. This was yesterday when I got a loooot of blocked
connections
[image: Im?genes integradas 1]

In the rabbit logs we've only seen open/closed connections but no crash
report.
Is there any way to understand why I get blocked connections?

Saludos!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/f8d73779/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 85312 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/f8d73779/attachment.png>

From Frame at SNHDMAIL.ORG  Thu Mar 13 15:48:12 2014
From: Frame at SNHDMAIL.ORG (Jason Frame)
Date: Thu, 13 Mar 2014 08:48:12 -0700
Subject: [rabbitmq-discuss] Issues getting RabbitMQ running using apt-get
In-Reply-To: <<CF4642A7.BBD4%frame@snhdmail.org>>
Message-ID: <CF47219D.BC02%frame@snhdmail.org>

Jerry,

When the dpkg starts the rabbitmq server, the process hangs with the following output:


Setting up rabbitmq-server (3.2.4-1) ...

 * Starting message broker rabbitmq-server


The processing never continues and the dpkg script never finishes, and the following processes are stuck running:

root      1756  0.0  0.0  38952  1648 pts/2    S+   16:44   0:00 sudo apt-get install rabbitmq-server

root      1757  0.1  0.6  85208 50344 pts/2    S+   16:44   0:01 apt-get install rabbitmq-server

root      2071  0.0  0.0  14636  3180 pts/0    Ss+  16:44   0:00 /usr/bin/dpkg --status-fd 63 --configure rabbitmq-server:all

root      2072  0.0  0.0   4408   684 pts/0    S+   16:44   0:00 /bin/sh /var/lib/dpkg/info/rabbitmq-server.postinst configure


And the rabbitmqctl status returns:

sudo rabbitmqctl status
Status of node rabbit at webdb ...
Error: unable to connect to node rabbit at webdb: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at webdb]

hosts, their running nodes and ports:
- webdb: [{rabbitmqctl2171,36728},{rabbit,40243},{rabbitmqctl18914,34800}]

current node details:
- node name: rabbitmqctl18914 at webdb
- home dir: /var/lib/rabbitmq
- cookie hash: mmM5W9xEazByu9AXfS3V/g==


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/62a58eb1/attachment.html>

From philmar70 at gmail.com  Thu Mar 13 17:07:02 2014
From: philmar70 at gmail.com (Phil Marino)
Date: Thu, 13 Mar 2014 10:07:02 -0700 (PDT)
Subject: [rabbitmq-discuss] System.OutOfMemoryException
Message-ID: <6a7b58d3-2061-4688-a6ab-306e4a0f03bc@googlegroups.com>

 
Hi - we're running RabbitMQ 3.1.3 on Windows Server 2008 R2, using the .Net 
Rabbit client library.
 
We're troubleshooting a distributed transaction problem involving Oracle.  
But when this problem happens, we also see thes from Rabbit:
 
 
2014-03-13 12:27:12,706 [1237] ERROR Services.Messaging.MessageService :: 
(null) > MessageTransaction.Prepared Failed: None of the specified 
endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://localhost:5672, attempts=1
System.OutOfMemoryException: Exception of type 
'System.OutOfMemoryException' was thrown.
   at System.Threading.Thread.StartInternal(IPrincipal principal, 
StackCrawlMark& stackMark)
   at System.Threading.Thread.Start(StackCrawlMark& stackMark)
   at System.Threading.Thread.Start()
   at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory factory, 
Boolean insist, IFrameHandler frameHandler)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory 
factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, 
AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
================================================
Stack trace:
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at 
Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment 
preparingEnlistment) in 
h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line 
208
 
 
 
and
 
2014-03-13 12:27:12,722 [1237] ERROR 
System.ServiceModel.Diagnostics.DiagnosticTrace :: TraceEvent > 
<TraceRecord xmlns="
http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord" 
Severity="Error"><TraceIdentifier>http://msdn.microsoft.com/en-US/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx</TraceIdentifier><Description>Handling 
an 
exception.</Description><AppDomain>/LM/W3SVC/3/ROOT/services.messaging1.0-1-130391077949327736</AppDomain><Exception><ExceptionType>System.Transactions.TransactionAbortedException, 
System.Transactions, Version=4.0.0.0, Culture=neutral, 
PublicKeyToken=b77a5c561934e089</ExceptionType><Message>The transaction has 
aborted.</Message><StackTrace>   at 
System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction 
tx)
   at System.Transactions.CommittableTransaction.Commit()
   at 
System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction 
transaction, Exception 
error)</StackTrace><ExceptionString>System.Transactions.TransactionAbortedException: 
The transaction has aborted. ---&amp;gt; 
RabbitMQ.Client.Exceptions.BrokerUnreachableException: None of the 
specified endpoints were reachable
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at 
Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment 
preparingEnlistment) in 
h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line 
208
   --- End of inner exception stack trace ---
   at 
System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction 
tx)
   at System.Transactions.CommittableTransaction.Commit()
   at 
System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction 
transaction, Exception 
error)</ExceptionString><InnerException><ExceptionType>RabbitMQ.Client.Exceptions.BrokerUnreachableException, 
RabbitMQ.Client, Version=2.8.7.0, Culture=neutral, 
PublicKeyToken=89e7d7c5feba84ce</ExceptionType><Message>None of the 
specified endpoints were reachable</Message><StackTrace>   at 
RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at 
Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment 
preparingEnlistment) in 
h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line 
208</StackTrace><ExceptionString>None of the specified endpoints were 
reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://localhost:5672, attempts=1
System.OutOfMemoryException: Exception of type 
'System.OutOfMemoryException' was thrown.
   at System.Threading.Thread.StartInternal(IPrincipal principal, 
StackCrawlMark&amp;amp; stackMark)
   at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
   at System.Threading.Thread.Start()
   at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory factory, 
Boolean insist, IFrameHandler frameHandler)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory 
factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, 
AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
================================================
Stack trace:
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at 
Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment 
preparingEnlistment) in 
h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line 
208</ExceptionString><DataItems><Data><Key>amqp-0-9://localhost:5672</Key><Value>System.OutOfMemoryException: 
Exception of type 'System.OutOfMemoryException' was thrown.
   at System.Threading.Thread.StartInternal(IPrincipal principal, 
StackCrawlMark&amp;amp; stackMark)
   at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
   at System.Threading.Thread.Start()
   at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory factory, 
Boolean insist, IFrameHandler frameHandler)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory 
factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, 
AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts, AmqpTcpEndpoint 
endpoint)</Value></Data></DataItems></InnerException></Exception></TraceRecord>
 
 
 
I will say that the server appears to have plenty of RAM available.
I'm sure that I don't have enough information to identify what's happening, 
so one question I have is: what else do I need?
 
It looks like we're trying to enlist in an aborted transaction, but I'm not 
sure why the Out Of Memory exception is thrown.  Any suggestions?
 
 
Thanks,
Phil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/5135eab1/attachment.html>

From simon at rabbitmq.com  Thu Mar 13 17:21:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Mar 2014 17:21:40 +0000
Subject: [rabbitmq-discuss] System.OutOfMemoryException
In-Reply-To: <6a7b58d3-2061-4688-a6ab-306e4a0f03bc@googlegroups.com>
References: <6a7b58d3-2061-4688-a6ab-306e4a0f03bc@googlegroups.com>
Message-ID: <5321E924.90908@rabbitmq.com>

I am no .net expert but my guess might be that you have too many threads 
(i.e. possibly too many connections).

Each thread needs to reserve a certain amount of memory in the process 
address space; too many threads (especially on a 32 bit process) can 
exhaust the address space before you come anywhere near running out of 
actual committed memory.

Cheers, Simon

On 13/03/14 17:07, Phil Marino wrote:
> Hi - we're running RabbitMQ 3.1.3 on Windows Server 2008 R2, using the
> .Net Rabbit client library.
> We're troubleshooting a distributed transaction problem involving
> Oracle.  But when this problem happens, we also see thes from Rabbit:
> 2014-03-13 12:27:12,706 [1237] ERROR Services.Messaging.MessageService
> :: (null) > MessageTransaction.Prepared Failed: None of the specified
> endpoints were reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://localhost:5672, attempts=1
> System.OutOfMemoryException: Exception of type
> 'System.OutOfMemoryException' was thrown.
>     at System.Threading.Thread.StartInternal(IPrincipal principal,
> StackCrawlMark& stackMark)
>     at System.Threading.Thread.Start(StackCrawlMark& stackMark)
>     at System.Threading.Thread.Start()
>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirects, IDictionary connectionAttempts, IDictionary
> connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts,
> AmqpTcpEndpoint endpoint)
> ================================================
> Stack trace:
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects)
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
>     at
> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
> preparingEnlistment) in
> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
> 208
> and
> 2014-03-13 12:27:12,722 [1237] ERROR
> System.ServiceModel.Diagnostics.DiagnosticTrace :: TraceEvent >
> <TraceRecord
> xmlns="http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord"
> Severity="Error"><TraceIdentifier>http://msdn.microsoft.com/en-US/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx</TraceIdentifier><Description>Handling
> an
> exception.</Description><AppDomain>/LM/W3SVC/3/ROOT/services.messaging1.0-1-130391077949327736</AppDomain><Exception><ExceptionType>System.Transactions.TransactionAbortedException,
> System.Transactions, Version=4.0.0.0, Culture=neutral,
> PublicKeyToken=b77a5c561934e089</ExceptionType><Message>The transaction
> has aborted.</Message><StackTrace>   at
> System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction tx)
>     at System.Transactions.CommittableTransaction.Commit()
>     at
> System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction
> transaction, Exception
> error)</StackTrace><ExceptionString>System.Transactions.TransactionAbortedException:
> The transaction has aborted. ---&amp;gt;
> RabbitMQ.Client.Exceptions.BrokerUnreachableException: None of the
> specified endpoints were reachable
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects)
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
>     at
> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
> preparingEnlistment) in
> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
> 208
>     --- End of inner exception stack trace ---
>     at
> System.Transactions.TransactionStateAborted.EndCommit(InternalTransaction tx)
>     at System.Transactions.CommittableTransaction.Commit()
>     at
> System.ServiceModel.Dispatcher.TransactionInstanceContextFacet.Complete(Transaction
> transaction, Exception
> error)</ExceptionString><InnerException><ExceptionType>RabbitMQ.Client.Exceptions.BrokerUnreachableException,
> RabbitMQ.Client, Version=2.8.7.0, Culture=neutral,
> PublicKeyToken=89e7d7c5feba84ce</ExceptionType><Message>None of the
> specified endpoints were reachable</Message><StackTrace>   at
> RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
>     at
> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
> preparingEnlistment) in
> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
> 208</StackTrace><ExceptionString>None of the specified endpoints were
> reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://localhost:5672, attempts=1
> System.OutOfMemoryException: Exception of type
> 'System.OutOfMemoryException' was thrown.
>     at System.Threading.Thread.StartInternal(IPrincipal principal,
> StackCrawlMark&amp;amp; stackMark)
>     at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
>     at System.Threading.Thread.Start()
>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirects, IDictionary connectionAttempts, IDictionary
> connectionErrors, AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts,
> AmqpTcpEndpoint endpoint)
> ================================================
> Stack trace:
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects)
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
>     at
> Services.Messaging.MessageService.MessageTransaction.Prepare(PreparingEnlistment
> preparingEnlistment) in
> h:\wbuildda04_agent11\work\b331189cb185f77c\Services.Messaging\MessageService.svc.cs:line
> 208</ExceptionString><DataItems><Data><Key>amqp-0-9://localhost:5672</Key><Value>System.OutOfMemoryException:
> Exception of type 'System.OutOfMemoryException' was thrown.
>     at System.Threading.Thread.StartInternal(IPrincipal principal,
> StackCrawlMark&amp;amp; stackMark)
>     at System.Threading.Thread.Start(StackCrawlMark&amp;amp; stackMark)
>     at System.Threading.Thread.Start()
>     at RabbitMQ.Client.Impl.ConnectionBase.StartMainLoop()
>     at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory
> factory, Boolean insist, IFrameHandler frameHandler)
>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirects, IDictionary connectionAttempts, IDictionary
> connectionErrors, AmqpTcpEndpoint[]&amp;amp; mostRecentKnownHosts,
> AmqpTcpEndpoint
> endpoint)</Value></Data></DataItems></InnerException></Exception></TraceRecord>
> I will say that the server appears to have plenty of RAM available.
> I'm sure that I don't have enough information to identify what's
> happening, so one question I have is: what else do I need?
> It looks like we're trying to enlist in an aborted transaction, but I'm
> not sure why the Out Of Memory exception is thrown.  Any suggestions?
> Thanks,
> Phil
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu Mar 13 17:32:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 13 Mar 2014 21:32:56 +0400
Subject: [rabbitmq-discuss] System.OutOfMemoryException
In-Reply-To: <6a7b58d3-2061-4688-a6ab-306e4a0f03bc@googlegroups.com>
References: <6a7b58d3-2061-4688-a6ab-306e4a0f03bc@googlegroups.com>
Message-ID: <7406287E-9B04-46A6-86D2-2E2E75761259@rabbitmq.com>


On 13 Mar 2014, at 21:07, Phil Marino <philmar70 at gmail.com> wrote:

> 2014-03-13 12:27:12,706 [1237] ERROR Services.Messaging.MessageService :: (null) > MessageTransaction.Prepared Failed: None of the specified endpoints were reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://localhost:5672, attempts=1
> System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.
>    at System.Threading.Thread.StartInternal(IPrincipal principal, StackCrawlMark& stackMark)
>    at System.Threading.Thread.Start(StackCrawlMark& stackMark)
>    at System.Threading.Thread.Start()

Are you creating connections dynamically? Do you ever close them?

Every connection uses at least one thread (for network I/O) and they do
consume RAM.

MK

Software Engineer, Pivotal/RabbitMQ



From riccardi at systran.fr  Thu Mar 13 18:08:16 2014
From: riccardi at systran.fr (Thomas Riccardi)
Date: Thu, 13 Mar 2014 19:08:16 +0100
Subject: [rabbitmq-discuss] Undocumented "original-expiration" value in
	"x-death" array header
Message-ID: <1394734096.3450.214.camel@CLM3X4J.systran.local>

Hi,

When using the dead lettering feature the rabbitmq broker (v3.2.4) adds
a "x-death" array header, and its values are documented here:
http://www.rabbitmq.com/dlx.html

queue, reason, time, exchange and routing-keys.

However, when using per-message TTL (not per-queue message TTL), there
is an additional string value: "original-expiration", which contains the
expiration property of the original message.


This value probably doesn't appear when no expiration was set in the
original message; so there may be other optional properties of the
original message that are forwarded in the x-death array and not
documented either.

The documentation should be updated to include all of this.


Thanks,
Thomas


From a.najafizadeh at gmail.com  Thu Mar 13 18:19:43 2014
From: a.najafizadeh at gmail.com (Ali Najafizadeh)
Date: Thu, 13 Mar 2014 14:19:43 -0400
Subject: [rabbitmq-discuss] RabbitMQ Message Sequence Guarantee
Message-ID: <CAH-rVLBxqneJ1vL=GkQBpCXHHxMAcfXe4RXZOvQehQkke+KD0A@mail.gmail.com>

I have a question about one of my project

So now, let me describe the scenario. I have n number of queues which
subscribed to topic1. Now my question is if I publish 3 messages in
sequence, which are shown as 1, 2 and 3 into broker called Exchange, will
rabbitmq Guarantee the sequence of those messages in all queues?

The only thing that I found was in rabbitmq documentation Message ordering
guarantees [http://www.rabbitmq.com/semantics.html]

which was taking about the following:

Section 4.7 of the AMQP 0-9-1 core specification explains the conditions
under which ordering is guaranteed: messages published in one channel,
passing through one exchange and one queue and one outgoing channel will be
received in the same order that they were sent. RabbitMQ offers stronger
guarantees since release 2.7.0.

So can anyone help me out and point me to the right doc or example that
shows whether it is guaranteed or not?


For more info, here's the full details

http://stackoverflow.com/questions/22387275/rabbitmq-message-sequence-guarantee


Thanks

Ali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/ac16c6aa/attachment.html>

From riccardi at systran.fr  Thu Mar 13 19:31:02 2014
From: riccardi at systran.fr (Thomas Riccardi)
Date: Thu, 13 Mar 2014 20:31:02 +0100
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
Message-ID: <1394739062.3450.224.camel@CLM3X4J.systran.local>

Consumer crash, redelivery and prefetch

Hi,

I'm having issues with consumer crash, redelivery and prefetch:

The messages ack strategy I've chosen is to ack the message only after
the consumer has finished working on the message. I need this because I
cannot aford any lost message, even in case of consumer crash during the
work on the message.

For performance reason my consumer have a non 0 prefetch, so when my
consumer is handling a message (doing some work related to the message),
other messages are pushed to the client so that it has them already
available when it's done working on the previous message.

With this, when a message makes the consumer crash, the handled message
*and* the prefetched ones are re-queued, with the flag "redelivered" ==
1.

I currently have no other choice than rejecting all messages that have
the "redelivered" flag set to true, because I have no way to distinguish
the message that cause the crash from the prefetched ones that did
nothing wrong.
Indeed if I retry to work on a redelivered message, the consumer will
crash again on the poison message, in an infinite loop. However I would
like to not reject the previously prefetched messages since they are
probably OK.
This reasoning also applies to transient crashes that are not
systematically reproduced by the message.


Ideally the solution would be to be able to distinguish the first non
ack'd message from the other ones when the consumer crashes, or
alternatively having two types of ack : one "I'm starting to work on
this message", and a second one "I've finished working on this message".

Otherwise a redelivery count would do the trick (even if it means
working multiple times on a message that did make the consumer crash,
which is not efficient if we know crashes happen mostly systematically).

The redelivery count is a "planned" feature according to
http://www.rabbitmq.com/specification.html, but when will it be really
implemented?
Having a parameter per queue like the TTL to tell a maximum redelivery
count before dead lettering the message would be much helpful in my case
(a RPC above rabbitmq, which is probably not a highly specific and rare
use-case).


Thanks,
Thomas


From michael.s.klishin at gmail.com  Thu Mar 13 19:39:36 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 13 Mar 2014 23:39:36 +0400
Subject: [rabbitmq-discuss] RabbitMQ Message Sequence Guarantee
In-Reply-To: <CAH-rVLBxqneJ1vL=GkQBpCXHHxMAcfXe4RXZOvQehQkke+KD0A@mail.gmail.com>
References: <CAH-rVLBxqneJ1vL=GkQBpCXHHxMAcfXe4RXZOvQehQkke+KD0A@mail.gmail.com>
Message-ID: <CAE3HoVS2rNAHwnsYZ_ArsW0qAczyFKRvKEomWHY4Y-+C6zCE+Q@mail.gmail.com>

2014-03-13 22:19 GMT+04:00 Ali Najafizadeh <a.najafizadeh at gmail.com>:

> Now my question is if I publish 3 messages in sequence, which are shown as
> 1, 2 and 3 into broker called Exchange, will rabbitmq Guarantee the
> sequence of those messages in all queues?


Yes, if the messages are published on the same channel.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/26ef93fa/attachment.html>

From michael.s.klishin at gmail.com  Thu Mar 13 19:42:27 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 13 Mar 2014 23:42:27 +0400
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <1394739062.3450.224.camel@CLM3X4J.systran.local>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
Message-ID: <CAE3HoVTEngN=xqR6-JbNwZaUXwOr0svHgB2HUbQxSP4ZSXAeuw@mail.gmail.com>

2014-03-13 23:31 GMT+04:00 Thomas Riccardi <riccardi at systran.fr>:

> Ideally the solution would be to be able to distinguish the first non
> ack'd message from the other ones when the consumer crashes, or
> alternatively having two types of ack : one "I'm starting to work on
> this message", and a second one "I've finished working on this message".
>

As far as RabbitMQ goes, all messages were delivered and are unacknowledged.


>
> Otherwise a redelivery count would do the trick (even if it means
> working multiple times on a message that did make the consumer crash,
> which is not efficient if we know crashes happen mostly systematically).
>

This is a sensible feature which I'm not sure why Rabbit still does not
have.
Definitely worth investigating.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140313/36df3203/attachment.html>

From michael.justin at gmx.net  Fri Mar 14 07:50:00 2014
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 14 Mar 2014 08:50:00 +0100
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
Message-ID: <lfucap$c8c$1@ger.gmane.org>

Hello,

in the past I have developed a STOMP based RabbitMQ client library for 
Delphi / Free Pascal. Many users are also interested in a native AMQP 
client for these programming languages.

AMQP 0.9.x and 1.0 however seem to be quite complex compared with STOMP. 
I could start with a subset of the AMQP protocol (leaving out optional 
parts of the specification), use existing unit tests for RabbitMQ client 
libraries as a starting point, and test against various AMQP 
implementations.

Maybe there is some testing code available on the web for the automated 
verification of AMQP client standard compliance?

-- 
Michael Justin


From michael.s.klishin at gmail.com  Fri Mar 14 08:13:09 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 14 Mar 2014 12:13:09 +0400
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
In-Reply-To: <lfucap$c8c$1@ger.gmane.org>
References: <lfucap$c8c$1@ger.gmane.org>
Message-ID: <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>

2014-03-14 11:50 GMT+04:00 Michael Justin <michael.justin at gmx.net>:

> AMQP 0.9.x and 1.0 however seem to be quite complex compared with STOMP. I
> could start with a subset of the AMQP protocol (leaving out optional parts
> of the specification), use existing unit tests for RabbitMQ client
> libraries as a starting point, and test against various AMQP
> implementations.
>
> Maybe there is some testing code available on the web for the automated
> verification of AMQP client standard compliance?
>


Nothing that I'm aware of. Use client test suites, primarily RabbitMQ Java
client and Bunny.
Also note that AMQP 1.0 is effectively a completely different protocol from
0.9.1 and there are RabbitMQ extensions to 0.9.1.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/6101c5ff/attachment.html>

From michael.s.klishin at gmail.com  Fri Mar 14 08:14:01 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 14 Mar 2014 12:14:01 +0400
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
In-Reply-To: <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
Message-ID: <CAE3HoVTgAUJYQhCASv5r9QxU_KJj99VDMnvbUe_UGb8OwUbdEQ@mail.gmail.com>

2014-03-14 12:13 GMT+04:00 Michael Klishin <michael.s.klishin at gmail.com>:

> Also note that AMQP 1.0 is effectively a completely different protocol
> from 0.9.1


...and that the number of production users and mature client libraries for
0.9.1 significantly outnumbers
those of 1.0.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/be163d30/attachment.html>

From matthias at rabbitmq.com  Fri Mar 14 08:29:19 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Mar 2014 08:29:19 +0000
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
In-Reply-To: <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
Message-ID: <5322BDDF.4090309@rabbitmq.com>

On 14/03/14 08:13, Michael Klishin wrote:
>
> 2014-03-14 11:50 GMT+04:00 Michael Justin <michael.justin at gmx.net
> <mailto:michael.justin at gmx.net>>:
>
>     AMQP 0.9.x and 1.0 however seem to be quite complex compared with
>     STOMP. I could start with a subset of the AMQP protocol (leaving out
>     optional parts of the specification), use existing unit tests for
>     RabbitMQ client libraries as a starting point, and test against
>     various AMQP implementations.
>
>     Maybe there is some testing code available on the web for the
>     automated verification of AMQP client standard compliance?
>
>
>
> Nothing that I'm aware of. Use client test suites, primarily RabbitMQ
> Java client and Bunny.

The OP is asking how to test a *client* for compliance.

There is no test suite available for AMQP clients. AMQP is a primarily 
client-driven protocol, i.e. stuff happens because the client did 
something. There is no portable way for a test suite to drive a client 
and make it do something since, by definition, clients are written in 
all kinds of different languages, make different choices as to what APIs 
to present to developers, etc

Matthias.

From mklishin at gopivotal.com  Fri Mar 14 08:48:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 14 Mar 2014 12:48:30 +0400
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
	(for developers of client libraries)?
In-Reply-To: <5322BDDF.4090309@rabbitmq.com>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
 <5322BDDF.4090309@rabbitmq.com>
Message-ID: <0302CBCF-834D-4E6C-9AB2-2D6EB258F639@rabbitmq.com>

On 14 Mar 2014, at 12:29, Matthias Radestock <matthias at rabbitmq.com> wrote:

> The OP is asking how to test a *client* for compliance.

My suggestion was to use existing client tests to produce one for the new client.

MK

Software Engineer, Pivotal/RabbitMQ



From michael.justin at gmx.net  Fri Mar 14 09:08:54 2014
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 14 Mar 2014 10:08:54 +0100
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
In-Reply-To: <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
Message-ID: <lfuguo$uf5$1@ger.gmane.org>

Am 14.03.2014 09:13, Michael Klishin wrote:

> Nothing that I'm aware of. Use client test suites, primarily RabbitMQ
> Java client and Bunny.

The RabbitMQ Java client will be a very helpful starting point, many 
thanks for the hint.

I have seen rabbitmq-codegen (http://hg.rabbitmq.com/rabbitmq-codegen), 
is automated code generation used (and recommended) for RabbitMQ client 
side (Java) libraries?

Regards
-- 
Michael Justin


From mklishin at gopivotal.com  Fri Mar 14 09:25:00 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 14 Mar 2014 13:25:00 +0400
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
	(for developers of client libraries)?
In-Reply-To: <lfuguo$uf5$1@ger.gmane.org>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
 <lfuguo$uf5$1@ger.gmane.org>
Message-ID: <ACFD5315-991D-49BD-8BDD-73E29F637731@rabbitmq.com>


On 14 Mar 2014, at 13:08, Michael Justin <michael.justin at gmx.net> wrote:

> I have seen rabbitmq-codegen (http://hg.rabbitmq.com/rabbitmq-codegen), is automated code generation used (and recommended) for RabbitMQ client side (Java) libraries?

It is used by multiple clients (Java, .NET, Erlang, Bunny, amqp gem, and others), directly or indirectly.

Some clients (e.g. Go) choose to do code generation from scratch:
https://github.com/streadway/amqp/tree/master/spec

MK

Software Engineer, Pivotal/RabbitMQ



From sascha.wojewsky at gmail.com  Fri Mar 14 07:49:06 2014
From: sascha.wojewsky at gmail.com (Sascha Wojewsky)
Date: Fri, 14 Mar 2014 00:49:06 -0700 (PDT)
Subject: [rabbitmq-discuss] from zendJobQueue to RabbitMQ - Status Problem
Message-ID: <d3a1800d-8622-4c6b-b65a-b09c3875af4b@googlegroups.com>

Hi,

we've to switch from zendJobQueue to RabbitMQ (publish via php and consume 
via python worker).
I've read the examples and everything looks good, but i've to check for 
running jobs and i don't know how...

In php I've a squence for jobs/messages:
$message = new \PhpAmqpLib\Message\AMQPMessage(json_encode(array(
    'id'    => $jobID,
    'data' => $data,
)));
$message->set('message_id', $jobID);

To check for open messages I've this method:
private function getRabbitMQJobIsFinished($jobID) {
  $result = true;
  $connection = new \PhpAmqpLib\Connection\AMQPConnection(...);
  $channel = $connection->channel();
  $messageData = $channel->basic_get(self::$queue, false);
  while (!empty($messageData)) {
    $messageID = $messageData->get('message_id');
    if ($messageID == $jobID){
      $result = false;
      break;
    }
    $messageData = $channel->basic_get(self::$queue, false);
  }
  return $result;
}

But this didn't work for unacknowledged/work in progress messages.

Is ist possible to solve this problem with RabbitMQ?

Thank you a lot for your help.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/0c3262e4/attachment.html>

From kjnilsson at gmail.com  Fri Mar 14 09:42:14 2014
From: kjnilsson at gmail.com (Karl Nilsson)
Date: Fri, 14 Mar 2014 09:42:14 +0000
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <1394739062.3450.224.camel@CLM3X4J.systran.local>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
Message-ID: <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>

Hi Thomas,

It is a great shame that a mature message broker such as RabbitMQ is so
lacking in sensible poison message handling (or any strategies regarding
redelivery). I raised the issue here a few months ago and was advised the
priority of planned feature [basic / deliver / 01] had been raised but
wasn't given any indication of when it might be delivered.

http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/27733

After that I wrote a blog entry summarising my investigations which
includes some of the suggested workarounds (such as using multiple queues),
none of which I consider adequate.

http://kjnilsson.github.io/blog/2014/01/30/spread-the-poison/

There is an argument for not designing systems where losing a message is a
big deal but I think that is a topic of a different discussion. :)

Cheers
Karl


On 13 March 2014 19:31, Thomas Riccardi <riccardi at systran.fr> wrote:

> Consumer crash, redelivery and prefetch
>
> Hi,
>
> I'm having issues with consumer crash, redelivery and prefetch:
>
> The messages ack strategy I've chosen is to ack the message only after
> the consumer has finished working on the message. I need this because I
> cannot aford any lost message, even in case of consumer crash during the
> work on the message.
>
> For performance reason my consumer have a non 0 prefetch, so when my
> consumer is handling a message (doing some work related to the message),
> other messages are pushed to the client so that it has them already
> available when it's done working on the previous message.
>
> With this, when a message makes the consumer crash, the handled message
> *and* the prefetched ones are re-queued, with the flag "redelivered" ==
> 1.
>
> I currently have no other choice than rejecting all messages that have
> the "redelivered" flag set to true, because I have no way to distinguish
> the message that cause the crash from the prefetched ones that did
> nothing wrong.
> Indeed if I retry to work on a redelivered message, the consumer will
> crash again on the poison message, in an infinite loop. However I would
> like to not reject the previously prefetched messages since they are
> probably OK.
> This reasoning also applies to transient crashes that are not
> systematically reproduced by the message.
>
>
> Ideally the solution would be to be able to distinguish the first non
> ack'd message from the other ones when the consumer crashes, or
> alternatively having two types of ack : one "I'm starting to work on
> this message", and a second one "I've finished working on this message".
>
> Otherwise a redelivery count would do the trick (even if it means
> working multiple times on a message that did make the consumer crash,
> which is not efficient if we know crashes happen mostly systematically).
>
> The redelivery count is a "planned" feature according to
> http://www.rabbitmq.com/specification.html, but when will it be really
> implemented?
> Having a parameter per queue like the TTL to tell a maximum redelivery
> count before dead lettering the message would be much helpful in my case
> (a RPC above rabbitmq, which is probably not a highly specific and rare
> use-case).
>
>
> Thanks,
> Thomas
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
*Karl Nilsson*
twitter: @kjnilsson
blog: coderkarl.wordpress.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/df2237f7/attachment.html>

From videlalvaro at gmail.com  Fri Mar 14 09:48:03 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 14 Mar 2014 10:48:03 +0100
Subject: [rabbitmq-discuss] from zendJobQueue to RabbitMQ - Status
	Problem
In-Reply-To: <d3a1800d-8622-4c6b-b65a-b09c3875af4b@googlegroups.com>
References: <d3a1800d-8622-4c6b-b65a-b09c3875af4b@googlegroups.com>
Message-ID: <CAMcAHLU8Dy-0_F9oztCVKONbiaGWc_6iNdXg7TYHFnjfXWseGA@mail.gmail.com>

Hi,

basic_get is used to get one message at a time, which makes it not optimal.

See the tutorial here on basic_consume:
http://www.rabbitmq.com/tutorials/tutorial-two-php.html there you can
read about message acknowledgments as well.

Regards,

Alvaro

On Fri, Mar 14, 2014 at 8:49 AM, Sascha Wojewsky
<sascha.wojewsky at gmail.com> wrote:
> Hi,
>
> we've to switch from zendJobQueue to RabbitMQ (publish via php and consume
> via python worker).
> I've read the examples and everything looks good, but i've to check for
> running jobs and i don't know how...
>
> In php I've a squence for jobs/messages:
> $message = new \PhpAmqpLib\Message\AMQPMessage(json_encode(array(
>     'id'    => $jobID,
>     'data' => $data,
> )));
> $message->set('message_id', $jobID);
>
> To check for open messages I've this method:
> private function getRabbitMQJobIsFinished($jobID) {
>   $result = true;
>   $connection = new \PhpAmqpLib\Connection\AMQPConnection(...);
>   $channel = $connection->channel();
>   $messageData = $channel->basic_get(self::$queue, false);
>   while (!empty($messageData)) {
>     $messageID = $messageData->get('message_id');
>     if ($messageID == $jobID){
>       $result = false;
>       break;
>     }
>     $messageData = $channel->basic_get(self::$queue, false);
>   }
>   return $result;
> }
>
> But this didn't work for unacknowledged/work in progress messages.
>
> Is ist possible to solve this problem with RabbitMQ?
>
> Thank you a lot for your help.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Fri Mar 14 09:54:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Mar 2014 09:54:01 +0000
Subject: [rabbitmq-discuss] Is there a formal AMQP compliance test suite
 (for developers of client libraries)?
In-Reply-To: <lfuguo$uf5$1@ger.gmane.org>
References: <lfucap$c8c$1@ger.gmane.org>
 <CAE3HoVRRvm2YMmhuwM4MZ_q-Uk3DO0+XH_nAsb3+UsXnpCOnXw@mail.gmail.com>
 <lfuguo$uf5$1@ger.gmane.org>
Message-ID: <5322D1B9.3000808@rabbitmq.com>

On 14/03/2014 9:08AM, Michael Justin wrote:
> is automated code generation used (and recommended) for RabbitMQ client
> side (Java) libraries?

It's very strongly recommended (and not just for Java). Almost all 
clients do codegen. Those that don't tend to end up containing a lot of 
repetitive code that can be quite buggy, difficult to extend etc.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 14 10:03:11 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Mar 2014 10:03:11 +0000
Subject: [rabbitmq-discuss] Undocumented "original-expiration" value in
 "x-death" array header
In-Reply-To: <1394734096.3450.214.camel@CLM3X4J.systran.local>
References: <1394734096.3450.214.camel@CLM3X4J.systran.local>
Message-ID: <5322D3DF.1070405@rabbitmq.com>

On 13/03/2014 6:08PM, Thomas Riccardi wrote:
> This value probably doesn't appear when no expiration was set in the
> original message; so there may be other optional properties of the
> original message that are forwarded in the x-death array and not
> documented either.

There aren't.

> The documentation should be updated to include all of this.

I have added some documentation on original-expiration to 
http://www.rabbitmq.com/dlx.html.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 14 10:06:11 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Mar 2014 10:06:11 +0000
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
Message-ID: <5322D493.1020107@rabbitmq.com>

On 14/03/2014 9:42AM, Karl Nilsson wrote:
> It is a great shame that a mature message broker such as RabbitMQ is so
> lacking in sensible poison message handling (or any strategies regarding
> redelivery).

Agreed.

But there are a great many things we want to do, and only limited time 
to do them in.

I suspect it will happen one day. Sorry I can't be more specific than 
that, but we tend not to plan out a long way in advance.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 14 10:11:58 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Mar 2014 10:11:58 +0000
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
Message-ID: <5322D5EE.8000300@rabbitmq.com>

On 13/03/2014 2:41PM, Mat?as Waisgold wrote:
> Is there any way to understand why I get blocked connections?

Just to be clear here, are we talking about connections that are 
described as 'blocked' in management, or ones that are described as 'flow'?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From videlalvaro at gmail.com  Fri Mar 14 11:44:51 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 14 Mar 2014 12:44:51 +0100
Subject: [rabbitmq-discuss] from zendJobQueue to RabbitMQ - Status
	Problem
In-Reply-To: <CAMcAHLU8Dy-0_F9oztCVKONbiaGWc_6iNdXg7TYHFnjfXWseGA@mail.gmail.com>
References: <d3a1800d-8622-4c6b-b65a-b09c3875af4b@googlegroups.com>
 <CAMcAHLU8Dy-0_F9oztCVKONbiaGWc_6iNdXg7TYHFnjfXWseGA@mail.gmail.com>
Message-ID: <CAMcAHLW6j6a7H27DKQbPNV-H6Z3vDHwB=PSPFZBt0Dqx=co==w@mail.gmail.com>

Hi,

So I completely misread your question.

What do you mean by "check for open messages"?

You want to know the amount of message that are ready to be consumed?
Or the messages that are being processed at the moment by consumers?

Regards,

Alvaro

On Fri, Mar 14, 2014 at 10:48 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> basic_get is used to get one message at a time, which makes it not optimal.
>
> See the tutorial here on basic_consume:
> http://www.rabbitmq.com/tutorials/tutorial-two-php.html there you can
> read about message acknowledgments as well.
>
> Regards,
>
> Alvaro
>
> On Fri, Mar 14, 2014 at 8:49 AM, Sascha Wojewsky
> <sascha.wojewsky at gmail.com> wrote:
>> Hi,
>>
>> we've to switch from zendJobQueue to RabbitMQ (publish via php and consume
>> via python worker).
>> I've read the examples and everything looks good, but i've to check for
>> running jobs and i don't know how...
>>
>> In php I've a squence for jobs/messages:
>> $message = new \PhpAmqpLib\Message\AMQPMessage(json_encode(array(
>>     'id'    => $jobID,
>>     'data' => $data,
>> )));
>> $message->set('message_id', $jobID);
>>
>> To check for open messages I've this method:
>> private function getRabbitMQJobIsFinished($jobID) {
>>   $result = true;
>>   $connection = new \PhpAmqpLib\Connection\AMQPConnection(...);
>>   $channel = $connection->channel();
>>   $messageData = $channel->basic_get(self::$queue, false);
>>   while (!empty($messageData)) {
>>     $messageID = $messageData->get('message_id');
>>     if ($messageID == $jobID){
>>       $result = false;
>>       break;
>>     }
>>     $messageData = $channel->basic_get(self::$queue, false);
>>   }
>>   return $result;
>> }
>>
>> But this didn't work for unacknowledged/work in progress messages.
>>
>> Is ist possible to solve this problem with RabbitMQ?
>>
>> Thank you a lot for your help.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From michael.laing at nytimes.com  Fri Mar 14 12:28:22 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Fri, 14 Mar 2014 08:28:22 -0400
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <5322D493.1020107@rabbitmq.com>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
 <5322D493.1020107@rabbitmq.com>
Message-ID: <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>

It's a good topic.

In our std framework, based on python pika, a service may fail in
processing a message due to an exception being raised - something
unanticipated - the service will have chosen a default action to take in
that case when it was initialized, typically 'reject'. Typically it will
log a warning as well.

We gather rejected messages in a 'reject' exchange and process them enough
(via their headers) to route them back to their originators as well as to
our own 'triage' queue.

Our messages all carry their processing history in their headers: region,
zone, instance, pid, service, timestamp, etc. - again part of the framework.

We also gather and coordinate the logs of all services on all instances.

Additionally we replicate messages and process them in parallel through our
Core clusters in multiple regions.

A truly poison message will fail spectacularly everywhere. We have not
actually encountered one yet in production. We do get them in staging, and
bells go off everywhere.

A failure of infrastructure will be localized to a region, zone, instance,
or supporting service like Cassandra or the AWS control plane. Anticipated
failures are retried. Unanticipated failures result in rejection of that
message replica but other replicas should succeed. We do get these in
production and can immediately tell where failures occurred and take
appropriate action, e.g. shifting load away from failure if it has not yet
taken place automatically.

Of course it would be nice to get more info upon rejection. We compensate
by creating context around rejection and coordinating the context in near
real time across the nyt?a?rik.

ml


On Fri, Mar 14, 2014 at 6:06 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/03/2014 9:42AM, Karl Nilsson wrote:
>
>> It is a great shame that a mature message broker such as RabbitMQ is so
>> lacking in sensible poison message handling (or any strategies regarding
>> redelivery).
>>
>
> Agreed.
>
> But there are a great many things we want to do, and only limited time to
> do them in.
>
> I suspect it will happen one day. Sorry I can't be more specific than
> that, but we tend not to plan out a long way in advance.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/413368ff/attachment.html>

From mwaisgold at gmail.com  Fri Mar 14 13:38:33 2014
From: mwaisgold at gmail.com (=?ISO-8859-1?Q?Mat=EDas_Waisgold?=)
Date: Fri, 14 Mar 2014 10:38:33 -0300
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <5322D5EE.8000300@rabbitmq.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
 <5322D5EE.8000300@rabbitmq.com>
Message-ID: <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>

I've got both. But mostly blocked connections.


2014-03-14 7:11 GMT-03:00 Simon MacMullen <simon at rabbitmq.com>:

> On 13/03/2014 2:41PM, Mat?as Waisgold wrote:
>
>> Is there any way to understand why I get blocked connections?
>>
>
> Just to be clear here, are we talking about connections that are described
> as 'blocked' in management, or ones that are described as 'flow'?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/8a7d24af/attachment.html>

From mklishin at gopivotal.com  Fri Mar 14 13:44:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 14 Mar 2014 17:44:43 +0400
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
 <5322D5EE.8000300@rabbitmq.com>
 <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>
Message-ID: <E6EBB48D-1303-474A-9266-E2A78B052A0E@rabbitmq.com>


On 14 Mar 2014, at 17:38, Mat?as Waisgold <mwaisgold at gmail.com> wrote:

> I've got both. But mostly blocked connections.

What does rabbitmqctl eval 'rabbit_alarm:get_alarms().? output for you?

MK

Software Engineer, Pivotal/RabbitMQ



From yodameng at gmail.com  Fri Mar 14 13:08:00 2014
From: yodameng at gmail.com (Yoda Meng)
Date: Fri, 14 Mar 2014 06:08:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <20110912162233.GK3803@southbank.eng.vmware.com>
References: <d1okl3p.6383de33f76389b01bbc750b959906cb@webmail.vigasis.com>
 <20110912162233.GK3803@southbank.eng.vmware.com>
Message-ID: <3aec6314-e456-47ec-b669-4c0189d8ebb2@googlegroups.com>

Hi Alex.
I follow and read through the thread carefully because I ran into almost 
exactly the same problem when trying to use SSL to authenticate my .NET 
client. Both broker and client sit on the same machine. The only advertised 
working example 
in http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbitmq.html 
does not work for me for some reason. 

So I follow all the suggested route and start up s_server and ran my .net 
client to it as suggested. this is what I got:
openssl s_server -accept 5671 -cert SSLserver/cert.pem -key 
SSLserver/key.pem \
>   -CAfile SSLCA/cacert.pem
Using default temp DH parameters
Using default temp ECDH parameters
ACCEPT
-----BEGIN SSL SESSION PARAMETERS-----
MHUCAQECAgMABAIABQQg2uALybqAbk6tXfkSN/Pypg4kqeosku2CdlyFiQj9gGcE
MI0tXD4TyV/YWyqUB8gTnOc/Scx3hLJYG1dxGbDalzDg/Vz9BOSGBqfkvCYAERLq
CKEGAgRTIvxuogQCAgEspAYEBAEAAAA=
-----END SSL SESSION PARAMETERS-----
Shared ciphers:RC4-SHA:DES-CBC3-SHA:EDH-DSS-DES-CBC3-SHA:RC4-MD5
CIPHER is RC4-SHA
Secure Renegotiation IS supported
AMQP    ERROR
shutting down SSL
CONNECTION CLOSED
ACCEPT

and the .NET errors displays:


None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://MM181938-PC:5671, attempts=1
RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server 
protoc
l negotiation failure: server version unknown-unknown, client version 0-9
   at RabbitMQ.Client.Impl.ConnectionBase.StartAndTune()
   at RabbitMQ.Client.Framing.Impl.v0_9_1.Connection.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory factory, 
Bool
an insist, IFrameHandler frameHandler)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.Connection..ctor(ConnectionFactory fa
tory, Boolean insist, IFrameHandler frameHandler)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(Connect
onFactory factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
maxRedirects,
IDictionary`2 connectionAttempts, IDictionary`2 connectionErrors, 
AmqpTcpEndpoi
t[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
================================================
Stack trace:
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at RabbitSslTest.Program.Start() in c:\Users\meng\Documents\Visual 
Studio 20
2\Projects\testCert\testCert\Program.cs:line 59


please help.
Yours, 
yoda


On Monday, 12 September 2011 12:22:33 UTC-4, Alexandru Scvor?ov wrote:
>
> > As I said before we tried CN=server-PC for our certs
> > and added "server-PC 10.35.110.167" to hosts file on our windows machine.
>
> Ok.
>
> > And when we check we still get "bad gethostbyaddr" from openssl s_server
> > also .net client crashes,
> > and problem continues...
>
> Turns out that's because the client's IP isn't in the server's hosts
> file.  Should be harmless and works fine without that.
>
> The output from s_client is perfectly fine and shows that the .NET can
> connect to the server machine via SSL.
>
> Is there any chance you could try running your .NET program from a 
> different
> machine?  In particular, could you run under Mono on the same machine as
> the broker?
>
> Please reply to this message and don't start a new thread.
>
> Cheers,
> Alex
>
> On Mon, Sep 12, 2011 at 05:25:47PM +0200, Umut Sahin wrote:
> > As I said before we tried CN=server-PC for our certs
> > and added "server-PC 10.35.110.167" to hosts file on our windows machine.
> > 
> > And when we check we still get "bad gethostbyaddr" from openssl s_server
> > also .net client crashes,
> > and problem continues...
> > 
> > Regards,
> > Umut
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq... at lists.rabbitmq.com <javascript:>
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/99f8278e/attachment.html>

From mklishin at gopivotal.com  Fri Mar 14 14:18:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 14 Mar 2014 18:18:56 +0400
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <3aec6314-e456-47ec-b669-4c0189d8ebb2@googlegroups.com>
References: <d1okl3p.6383de33f76389b01bbc750b959906cb@webmail.vigasis.com>
 <20110912162233.GK3803@southbank.eng.vmware.com>
 <3aec6314-e456-47ec-b669-4c0189d8ebb2@googlegroups.com>
Message-ID: <EE8A9331-50ED-4501-A1E0-2CF28BD6446A@rabbitmq.com>


On 14 Mar 2014, at 17:08, Yoda Meng <yodameng at gmail.com> wrote:

> openssl s_server -accept 5671 -cert SSLserver/cert.pem -key SSLserver/key.pem \
> >   -CAfile SSLCA/cacert.pem
> Using default temp DH parameters
> Using default temp ECDH parameters
> ACCEPT
> -----BEGIN SSL SESSION PARAMETERS-----
> MHUCAQECAgMABAIABQQg2uALybqAbk6tXfkSN/Pypg4kqeosku2CdlyFiQj9gGcE
> MI0tXD4TyV/YWyqUB8gTnOc/Scx3hLJYG1dxGbDalzDg/Vz9BOSGBqfkvCYAERLq
> CKEGAgRTIvxuogQCAgEspAYEBAEAAAA=
> -----END SSL SESSION PARAMETERS-----
> Shared ciphers:RC4-SHA:DES-CBC3-SHA:EDH-DSS-DES-CBC3-SHA:RC4-MD5
> CIPHER is RC4-SHA
> Secure Renegotiation IS supported
> AMQP    ERROR
> shutting down SSL
> CONNECTION CLOSED
> ACCEPT
> 
> and the .NET errors displays:
> 
> 
> None of the specified endpoints were reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://MM181938-PC:5671, attempts=1
> RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protoc
> l negotiation failure: server version unknown-unknown, client version 0-9
>    at RabbitMQ.Client.Impl.ConnectionBase.StartAndTune()
>    at RabbitMQ.Client.Framing.Impl.v0_9_1.Connection.Open(Boolean insist)

.NET client complains that the server does not perform AMQP 0.9.1 protocol
negotiation, which is expected if you connect to openssl s_server.

I don?t see any TLS errors in this output.

MK

Software Engineer, Pivotal/RabbitMQ



From mwaisgold at gmail.com  Fri Mar 14 14:51:07 2014
From: mwaisgold at gmail.com (=?ISO-8859-1?Q?Mat=EDas_Waisgold?=)
Date: Fri, 14 Mar 2014 11:51:07 -0300
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <E6EBB48D-1303-474A-9266-E2A78B052A0E@rabbitmq.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
 <5322D5EE.8000300@rabbitmq.com>
 <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>
 <E6EBB48D-1303-474A-9266-E2A78B052A0E@rabbitmq.com>
Message-ID: <CAMaTqYr8CKZ1t5Q-UN4t0gNsWkcK_YMbTaiDbyfLCYfUMi9Orw@mail.gmail.com>

rabbitmqctl eval 'rabbit_alarm:get_alarms().'

[]

...done.


2014-03-14 10:44 GMT-03:00 Michael Klishin <mklishin at gopivotal.com>:

>
> On 14 Mar 2014, at 17:38, Mat?as Waisgold <mwaisgold at gmail.com> wrote:
>
> > I've got both. But mostly blocked connections.
>
> What does rabbitmqctl eval 'rabbit_alarm:get_alarms().' output for you?
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/e06e4d20/attachment.html>

From mklishin at gopivotal.com  Fri Mar 14 15:00:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 14 Mar 2014 19:00:29 +0400
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <CAMaTqYr8CKZ1t5Q-UN4t0gNsWkcK_YMbTaiDbyfLCYfUMi9Orw@mail.gmail.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
 <5322D5EE.8000300@rabbitmq.com>
 <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>
 <E6EBB48D-1303-474A-9266-E2A78B052A0E@rabbitmq.com>
 <CAMaTqYr8CKZ1t5Q-UN4t0gNsWkcK_YMbTaiDbyfLCYfUMi9Orw@mail.gmail.com>
Message-ID: <C551E858-F90F-4352-827B-9007A873B7F5@rabbitmq.com>


On 14 Mar 2014, at 18:51, Mat?as Waisgold <mwaisgold at gmail.com> wrote:

> rabbitmqctl eval 'rabbit_alarm:get_alarms().'
> 
> []
> 
> ...done.
> 

This means that there are no alarms across the cluster. Are your clients are permanently blocked
or it just happens from time to time?

MK

Software Engineer, Pivotal/RabbitMQ



From mwaisgold at gmail.com  Fri Mar 14 15:01:59 2014
From: mwaisgold at gmail.com (=?ISO-8859-1?Q?Mat=EDas_Waisgold?=)
Date: Fri, 14 Mar 2014 12:01:59 -0300
Subject: [rabbitmq-discuss] Issues with flow control
In-Reply-To: <C551E858-F90F-4352-827B-9007A873B7F5@rabbitmq.com>
References: <CAMaTqYrbzrfYrooyiSaCYzyTBBVqWtEBmPJZJkTNmELVxB5x1g@mail.gmail.com>
 <5322D5EE.8000300@rabbitmq.com>
 <CAMaTqYp5gBJg-VDMNWBfHt=PGQeeKjtAE9A-T9Ja0D9MeV6Orw@mail.gmail.com>
 <E6EBB48D-1303-474A-9266-E2A78B052A0E@rabbitmq.com>
 <CAMaTqYr8CKZ1t5Q-UN4t0gNsWkcK_YMbTaiDbyfLCYfUMi9Orw@mail.gmail.com>
 <C551E858-F90F-4352-827B-9007A873B7F5@rabbitmq.com>
Message-ID: <CAMaTqYo-KDafYWB5K3mFE2-vnVSPXfXRwZiNba185npfqDLEDw@mail.gmail.com>

Not permanently but for long terms


2014-03-14 12:00 GMT-03:00 Michael Klishin <mklishin at gopivotal.com>:

>
> On 14 Mar 2014, at 18:51, Mat?as Waisgold <mwaisgold at gmail.com> wrote:
>
> > rabbitmqctl eval 'rabbit_alarm:get_alarms().'
> >
> > []
> >
> > ...done.
> >
>
> This means that there are no alarms across the cluster. Are your clients
> are permanently blocked
> or it just happens from time to time?
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/e22c36c5/attachment.html>

From clarsen at euphoriaaudio.com  Fri Mar 14 18:01:58 2014
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Fri, 14 Mar 2014 14:01:58 -0400
Subject: [rabbitmq-discuss] File Description Exhaustion with Transient
	Messages
Message-ID: <0ef901cf3faf$7e761bd0$7b625370$@euphoriaaudio.com>

Hello again, We had a 3.1.5 node exhaust the 65K FDs allocated to MQ and I'm
wondering what consumes and holds the FDs. I know from the list that each
connection will eat an FD and each queue will consume one or more
descriptors. However at the time of the alarm we only had 8K connections and
5K queues.  That wouldn't account for 65K FDs though. 

 

Lsof shows that there are of 50K handles consumed with references to the
transient message store, e.g. "msg_store_transient/352.rdq". There are about
30M messages queued up and the devs said that most of them are marked for
persistence now (only about 2K unacked). Are these messages responsible for
holding open so many FDs? There isn't any memory or disk space pressure (7GB
of 32GB memory used).  Would disabling acknowledgements help to reduce the
FD usage?

 

Thank you!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140314/b0c8aa5b/attachment.html>

From matthias at rabbitmq.com  Fri Mar 14 18:28:00 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Mar 2014 18:28:00 +0000
Subject: [rabbitmq-discuss] File Description Exhaustion with Transient
 Messages
In-Reply-To: <0ef901cf3faf$7e761bd0$7b625370$@euphoriaaudio.com>
References: <0ef901cf3faf$7e761bd0$7b625370$@euphoriaaudio.com>
Message-ID: <53234A30.3000004@rabbitmq.com>

On 14/03/14 18:01, Chris Larsen wrote:
> We had a 3.1.5 node exhaust the 65K FDs allocated to MQ

Did rabbit actually run out of file descriptors, i.e. did you see any 
corresponding errors in the logs or were unable to establish new 
connections?

> Lsof shows that there are of 50K handles consumed with references to the
> transient message store, e.g. ?msg_store_transient/352.rdq?.

Do you have 50k .rdq files? If so then that 50k handle figure is plausible.

Rabbit will use as many file descriptors a it deems useful for best 
performance. But most of these are "soft" file handles; when more file 
descriptors are needed for, say, accepting connections, then rabbit will 
close some of these soft handles in order to free up handles.

So high file descriptor counts are nothing to worry about, but if you 
see rabbit actually running out of descriptors (as per my first question 
above) then that would indicate a bug somewhere.

Matthias.

From ratheesh.ksz at gmail.com  Sat Mar 15 05:01:46 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Sat, 15 Mar 2014 10:31:46 +0530
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <53217D3C.20609@rabbitmq.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
 <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
 <5321799B.5060205@rabbitmq.com>
 <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>
 <53217D3C.20609@rabbitmq.com>
Message-ID: <CAGZFCEHjTeGWw02v6-3_HSSrhUzOoHru3aJ1dNEiRNTr0TxJng@mail.gmail.com>

On Thu, Mar 13, 2014 at 3:11 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 13/03/14 09:36, ratheesh kannoth wrote:
>>
>> On Thu, Mar 13, 2014 at 2:55 PM, Matthias Radestock
>> <matthias at rabbitmq.com> wrote:
>>>
>>> ...and it *does* stick to the ulimit; it is possible to run rabbit with
>>> just
>>> a handful of file descriptors, but this will severely impact performance.
>>
>> Is there a configuration to choose  no of descriptor ? How is this handled
>> ?
>
>
> Rabbit is aware of the ulimit. So to adjust the max number of file
> descriptors rabbit will use, simply adjust the ulimit.
>
>
> Matthias.


Thanks.  Any comment on my  question on clustering ( in my previous email ) ?


-Ratheesh

From michael.s.klishin at gmail.com  Sat Mar 15 08:30:55 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 15 Mar 2014 12:30:55 +0400
Subject: [rabbitmq-discuss] ulimit and cgroup
In-Reply-To: <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>
References: <CAGZFCEE3AgWsmFuNmm9TeZf4+r=feWmsRXzmNPm1=-df4kksmg@mail.gmail.com>
 <5EF849EC-1094-4ECF-830D-CC51E5E0F43E@rabbitmq.com>
 <CAGZFCEE3pXkeG3rTcZsgfuxE23bm0af5sjTMK8hnPjoyY5PCZA@mail.gmail.com>
 <F964A398-3D7F-40A4-AFDC-64812FB452B9@gopivotal.com>
 <5321799B.5060205@rabbitmq.com>
 <CAGZFCEEphirVmnQdnbGXwdBaSTmiry8bpZAf+1d9riZrJLWphQ@mail.gmail.com>
Message-ID: <CAE3HoVRVjpgeEHY06JA=oAd4p_CX1K8W4DH4EzvLGKJ4W1Ls7Q@mail.gmail.com>

2014-03-13 13:36 GMT+04:00 ratheesh kannoth <ratheesh.ksz at gmail.com>:

> And
> producer and consumer are unaware of chosen broker  and  clustering of
> brokers ?. I am just curious here. Because ultimately these
> connections are over tcp, and are  initiated from client to server.
> Atleast ; there should be an communication  from server to client
> saying that :-" hey i am down , please send it to other node" . Is
> part is already implemented  by rabbitmq clients ?
>

It's a good idea to not mix two completely unrelated questions in the same
thread.

Java client in 3.3 will have automatic recovery + it can use a list of
addresses.

Ruby clients and Langohr [1] have automatic recovery but do support
connection
to a list of nodes. Most of other clients do no support automatic
connection recovery.

Finally, none of the clients internally buffer messages (in RAM or on disk)
for redelivery in case
connection goes down. Projects that build on top of clients may do this
(e.g. Hutch, federation
plugin).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140315/edfa75b9/attachment.html>

From sean at monkeysnatchbanana.com  Sat Mar 15 16:21:22 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Sat, 15 Mar 2014 12:21:22 -0400
Subject: [rabbitmq-discuss] last_blocked_by resource
Message-ID: <CABm-WmfPC=+Ru3+_dWsnNZvP_uDnjnqZQ8uQiWJL_S4AWAcgxA@mail.gmail.com>

Question about connections getting blocked for resource levels.

Simplifying what we have.

I have an exchange "event"

Queue: handle.event is bound the "event" on node 1.

Node 2 of the cluster is over memory water mark.

I have a connection that is connected to Node 3 of the cluster that is
publishing to the "event" exchange. How is it possible for that connection
to end up being blocked for resource reasons?

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140315/f36d71c1/attachment.html>

From matthias at rabbitmq.com  Sat Mar 15 21:35:12 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 15 Mar 2014 21:35:12 +0000
Subject: [rabbitmq-discuss] last_blocked_by resource
In-Reply-To: <CABm-WmfPC=+Ru3+_dWsnNZvP_uDnjnqZQ8uQiWJL_S4AWAcgxA@mail.gmail.com>
References: <CABm-WmfPC=+Ru3+_dWsnNZvP_uDnjnqZQ8uQiWJL_S4AWAcgxA@mail.gmail.com>
Message-ID: <5324C790.1080607@rabbitmq.com>

On 15/03/14 16:21, Sean Allen wrote:
> Question about connections getting blocked for resource levels.
>
> Simplifying what we have.
>
> I have an exchange "event"
>
> Queue: handle.event is bound the "event" on node 1.
>
> Node 2 of the cluster is over memory water mark.
>
> I have a connection that is connected to Node 3 of the cluster that is
> publishing to the "event" exchange. How is it possible for that
> connection to end up being blocked for resource reasons?

RabbitMQ cannot know where future messages published on a connection 
might get routed to. So, in your example, the connection to Node 3 could 
be used to publish messages which end up getting enqueued in queues on 
Node 2. Which would be bad.

The upshot is that a resource alarm on any node blocks publishing 
connections on all nodes.

Matthias.


From ratheesh.ksz at gmail.com  Sun Mar 16 07:43:54 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Sun, 16 Mar 2014 13:13:54 +0530
Subject: [rabbitmq-discuss] Any performance data ?
Message-ID: <CAGZFCEHF97OpbZHP7Mhmkz80SzadGpsE_Ok2=sQtUCh=-PBvRA@mail.gmail.com>

Do you have any data showing how many  msg exchanges  could be done
,within some time interval in any machine ( with some configuration ).

This data is for comparison and proposal of rabbitmq for choosing
middle ware. Any data is truly appreciated ?


-Ratheesh

From mklishin at gopivotal.com  Sun Mar 16 07:52:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 16 Mar 2014 11:52:46 +0400
Subject: [rabbitmq-discuss] Any performance data ?
In-Reply-To: <CAGZFCEHF97OpbZHP7Mhmkz80SzadGpsE_Ok2=sQtUCh=-PBvRA@mail.gmail.com>
References: <CAGZFCEHF97OpbZHP7Mhmkz80SzadGpsE_Ok2=sQtUCh=-PBvRA@mail.gmail.com>
Message-ID: <E09A34B5-7280-45CB-872A-C58D40D965AE@rabbitmq.com>

On 16 Mar 2014, at 11:43, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> Do you have any data showing how many  msg exchanges  could be done
> ,within some time interval in any machine ( with some configuration ).
> 
> This data is for comparison and proposal of rabbitmq for choosing
> middle ware. Any data is truly appreciated ?

It?s a good idea to measure in your own environment instead of relying
on someone else?s data.

See PerfTest http://www.rabbitmq.com/java-tools.html.
Remember that you will get better throughput
with multiple queues (at least as many as you have CPU cores).

MK

Software Engineer, Pivotal/RabbitMQ



From ratheesh.ksz at gmail.com  Sun Mar 16 08:12:49 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Sun, 16 Mar 2014 13:42:49 +0530
Subject: [rabbitmq-discuss] Clustering Questions
Message-ID: <CAGZFCEFiTWOiRjWUobuhuSpDnj_t6EcVBw4VtQFRLsgD5oprMw@mail.gmail.com>

>http://www.rabbitmq.com/configure.html#configuration-file
I saw a paramter  "cluster_nodes" . it mentions about automatic
clustering.

1 ) So here  clustering  refers to clustering of  brokers ...right ?

2) Suppose a producer is sending  messages to consumer thru Broker A.
Suppose Broker A goes down or
too busy. Clustering would help to transfer the flow of messages thru
Broker B, which is part of cluster ?

3)  In question (2),  is producer and consumer has to take any action
, which is informed by server ? or it is explicit ?


4)  in (3) , clients can take action by its own   ?



-Ratheeshr

From stammailbox at gmail.com  Sun Mar 16 09:40:31 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 16 Mar 2014 11:40:31 +0200
Subject: [rabbitmq-discuss] Is there a way to print configuration parameters?
Message-ID: <CAJ2-Vrkv7PMuQJRVk4giGrc-p4KzoPxWVtGQucWq04RjhjeU3A@mail.gmail.com>

I have configured two parameters.

inet_dist_listen_min = X
inet_dist_listen_max = Y

in the config file and I copied it the config file in the place it should
be.
Is there a way to know that either RabbitMQ or ERL receive the right
parameter?

Thanks.

Note: Eventually I did it using a sniffer (saw the TCP port in the packet)
and knew it received it,
but is there a quicker way?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140316/f1d33b38/attachment.html>

From stammailbox at gmail.com  Sun Mar 16 10:36:42 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 16 Mar 2014 12:36:42 +0200
Subject: [rabbitmq-discuss] Connecting two brokers for external and internal
	use
Message-ID: <CAJ2-VrksPOiXfd7enp__4Zh3T5gY4pPAsCdjQLTRW3OqqCpN0w@mail.gmail.com>

In my system I have a RabbitMQ broker used for internal processes.
Now I want to publish the message to some external subscribers.

I want them to register to rout keys and get what they want.
So I thought about creating another clustered Rabbit broker for external
use and have a process that subscribes to all routkeys, gets all of the
messages and publishes them to the new Message Broker.

Questions:
1. Is there a better solution?
2. What if I want to enrich the message for external clients (add/change
message) Is there still a better solution?
3. How do I register to all rout keys with only one of the queues(it is a
direct exchange )?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140316/82d9bcee/attachment.html>

From emile at rabbitmq.com  Sun Mar 16 10:40:28 2014
From: emile at rabbitmq.com (Emile Joubert)
Date: Sun, 16 Mar 2014 10:40:28 +0000
Subject: [rabbitmq-discuss] Is there a way to print configuration
	parameters?
In-Reply-To: <CAJ2-Vrkv7PMuQJRVk4giGrc-p4KzoPxWVtGQucWq04RjhjeU3A@mail.gmail.com>
References: <CAJ2-Vrkv7PMuQJRVk4giGrc-p4KzoPxWVtGQucWq04RjhjeU3A@mail.gmail.com>
Message-ID: <53257F9C.9070506@rabbitmq.com>


Hi,

On 16/03/14 09:40, rails wrote:

> but is there a quicker way?

You can get the broker config with this command:

 rabbitmqctl environment

You can similarly get the Erlang kernel parameters with this command;

 rabbitmqctl eval 'application:get_all_env(kernel).'

This will list all the kernel parameters, regardless of whether the
Erlang VM ever used them. You could also use this command to make sure
the Erlang process is listening on a port in the expected range:

 epmd -names



-Emile



From videlalvaro at gmail.com  Sun Mar 16 16:09:44 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 16 Mar 2014 17:09:44 +0100
Subject: [rabbitmq-discuss] Connecting two brokers for external and
 internal use
In-Reply-To: <CAJ2-VrksPOiXfd7enp__4Zh3T5gY4pPAsCdjQLTRW3OqqCpN0w@mail.gmail.com>
References: <CAJ2-VrksPOiXfd7enp__4Zh3T5gY4pPAsCdjQLTRW3OqqCpN0w@mail.gmail.com>
Message-ID: <CAMcAHLW-wbkysN4jp90QUkgXka0anA0_cBUu6LkU-QZqndG0xQ@mail.gmail.com>

Hi,

You'd probably want to have a look at Federation:
http://rabbitmq.com/federation.html

About enriching messages, that's something the clients have to do.
RabbitMQ won't alter the message content.

Regards,

Alvaro

On Sun, Mar 16, 2014 at 11:36 AM, rails <stammailbox at gmail.com> wrote:
> In my system I have a RabbitMQ broker used for internal processes.
> Now I want to publish the message to some external subscribers.
>
> I want them to register to rout keys and get what they want.
> So I thought about creating another clustered Rabbit broker for external use
> and have a process that subscribes to all routkeys, gets all of the messages
> and publishes them to the new Message Broker.
>
> Questions:
> 1. Is there a better solution?
> 2. What if I want to enrich the message for external clients (add/change
> message) Is there still a better solution?
> 3. How do I register to all rout keys with only one of the queues(it is a
> direct exchange )?
> Thanks.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From janwillem.luiten at gmail.com  Sun Mar 16 22:51:24 2014
From: janwillem.luiten at gmail.com (J.W. Luiten)
Date: Sun, 16 Mar 2014 23:51:24 +0100
Subject: [rabbitmq-discuss] Building a release containing RabbitMQ client
Message-ID: <0C66663D-3A70-401C-A02F-21BFCDF6CDF6@gmail.com>

Hello,

I?m writing a Erlang application that makes use of the rabbitMQ client. I use relx to build the release for my application. I'm having a real struggle building a release.

For development I?ve unzipped amqp_client.ez and rabbit_common.ez into the deps directory. This works fine. But I?ve been struggling
about a day to build a release. Without any luck sofar.

Any hints on how to accomplish this are warmly welcomed.


Kind regards,

Jan Willem Luiten



From stammailbox at gmail.com  Mon Mar 17 07:45:29 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 17 Mar 2014 09:45:29 +0200
Subject: [rabbitmq-discuss] Is there a way to print configuration
	parameters?
In-Reply-To: <53257F9C.9070506@rabbitmq.com>
References: <CAJ2-Vrkv7PMuQJRVk4giGrc-p4KzoPxWVtGQucWq04RjhjeU3A@mail.gmail.com>
 <53257F9C.9070506@rabbitmq.com>
Message-ID: <CAJ2-Vr=mdwWanvY1t-UxBieC0Rqjr+maptLs-roPChBB_FMD+g@mail.gmail.com>

Thanks.
Tested all of them .
This is a great answer


On Sun, Mar 16, 2014 at 12:40 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 16/03/14 09:40, rails wrote:
>
> > but is there a quicker way?
>
> You can get the broker config with this command:
>
>  rabbitmqctl environment
>
> You can similarly get the Erlang kernel parameters with this command;
>
>  rabbitmqctl eval 'application:get_all_env(kernel).'
>
> This will list all the kernel parameters, regardless of whether the
> Erlang VM ever used them. You could also use this command to make sure
> the Erlang process is listening on a port in the expected range:
>
>  epmd -names
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/65a45463/attachment.html>

From matthias at rabbitmq.com  Mon Mar 17 07:48:09 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Mar 2014 07:48:09 +0000
Subject: [rabbitmq-discuss] rabbitmq fine tuning
In-Reply-To: <4a1eb6f8-58ef-4301-b632-eef670caea86@googlegroups.com>
References: <4a1eb6f8-58ef-4301-b632-eef670caea86@googlegroups.com>
Message-ID: <5326A8B9.4080204@rabbitmq.com>

On 12/03/14 14:57, costa wrote:
> under heavy load (around 1000 simultaneous requests/sec) I'm having a
> problem starting an amqp_connection (so amqp_connection:start) and I get
> the attached exception. I could appreciate any help with regards to
> troubleshooting this - though I'm fairly sure it is more of a matter of
> fine-tuning so any advice there would be greatly appreciated.

What does the corresponding server log say? I wonder whether the 
connection handshake timeout gets exceeded due to the client being too 
busy. The server log should tell you.

Matthias.

From matthias at rabbitmq.com  Mon Mar 17 08:09:41 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Mar 2014 08:09:41 +0000
Subject: [rabbitmq-discuss] Stopping rabbitmq-server: FAILED
In-Reply-To: <DB14E94115BBC84E8960C12C176D06760231517188@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D0676017A274F95@MX25A.corp.emc.com>
 <CALsYvrzQo_jwas3C5Jgp0qDLGUD7J+OXw6R7G54cHoufZMtN5Q@mail.gmail.com>
 <DB14E94115BBC84E8960C12C176D06760231517188@MX25A.corp.emc.com>
Message-ID: <5326ADC5.2000600@rabbitmq.com>

Punit,

On 06/03/14 13:59, Jain, Punit wrote:
> In this case ?service rabbitmq-server stop? failed with the exit status
> 2, but, in actual, rabbitmq-server was stopped fine. I verified it by
> checking processes and the broker?s status.

What's happening here is that the server gets told to stop - which it 
evidently does - but because 'rabbitmqctl stop' (which is that 'service 
rabbitmq-server stop' invokes) cannot read the pid file it is unable to 
figure out when the server process has actually terminated.

> Could you please explain the meaning of the return code ?2??  [...]
> Also, is there any other return code we should check? It would be best
> if we could know all the possible return code and their meaning.

2 is returned for all errors except those that indicate incorrect usage 
of rabbitmqctl (e.g. invalid command or arguments), in which case 1 is 
returned.

Matthias.

From aiguo.gu at tekcomms.com  Mon Mar 17 07:52:16 2014
From: aiguo.gu at tekcomms.com (Gu, Aiguo)
Date: Mon, 17 Mar 2014 07:52:16 +0000
Subject: [rabbitmq-discuss] Hello, Security Query
Message-ID: <91F9C6FA5F7F5343B0F41D638C4EBD36404005D2@US-BV-EXM01-P.global.tektronix.net>

Hi All,

                I have installed RabbitMQ Server on Win7, and the RabbitMQ service works fine with privilege account(Local System), if I changed the logon account with non-privilege, the service cannot be started. Could you please confirm the privilege account is necessary for the RabbitMQ service?

Best Regards
Bruce Gu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/f94bacf0/attachment.html>

From stammailbox at gmail.com  Mon Mar 17 08:58:40 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 17 Mar 2014 10:58:40 +0200
Subject: [rabbitmq-discuss] Best practices to manage failovers at the
	publishers side
Message-ID: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>

My main scenario that I want to manage is when the publisher connection is
not active.
Wither for a second or since the cluster is down.

What options does rabbitMQ (client side) have that will help me to manage
this scenario?
1. Can he accumulate the messages ?
2. Can he manage retries?

The second part of the question is regarding managing the failover itself.
 I know that in some databases I can write a connection string as follows

*       Data Source=*myServerAddress;*Failover Partner=*
myMirrorServerAddress;
and if the action fails the client automatically switches to another one in
the same action.

3. What is the best practice to manage failovers at the publishers side?
I have Netflix/eureka installed in my environment and I can get the next
active but does rabbitmq support this scenarios?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/ea20da2a/attachment.html>

From watson.timothy at gmail.com  Mon Mar 17 08:59:14 2014
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 17 Mar 2014 08:59:14 +0000
Subject: [rabbitmq-discuss] Building a release containing RabbitMQ client
In-Reply-To: <0C66663D-3A70-401C-A02F-21BFCDF6CDF6@gmail.com>
References: <0C66663D-3A70-401C-A02F-21BFCDF6CDF6@gmail.com>
Message-ID: <95F28BA5-B2F5-4FF2-994C-987D9DAF1117@rabbitmq.com>

What bit isn't workin for you? Have you got a relx error message or is the release missing content, or the start/init scripts not generated correctly!

On 16 Mar 2014, at 22:51, "J.W. Luiten" <janwillem.luiten at gmail.com> wrote:

> Hello,
> 
> I?m writing a Erlang application that makes use of the rabbitMQ client. I use relx to build the release for my application. I'm having a real struggle building a release.
> 
> For development I?ve unzipped amqp_client.ez and rabbit_common.ez into the deps directory. This works fine. But I?ve been struggling
> about a day to build a release. Without any luck sofar.
> 
> Any hints on how to accomplish this are warmly welcomed.
> 
> 
> Kind regards,
> 
> Jan Willem Luiten
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Mon Mar 17 09:01:17 2014
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 17 Mar 2014 09:01:17 +0000
Subject: [rabbitmq-discuss] Hello, Security Query
In-Reply-To: <91F9C6FA5F7F5343B0F41D638C4EBD36404005D2@US-BV-EXM01-P.global.tektronix.net>
References: <91F9C6FA5F7F5343B0F41D638C4EBD36404005D2@US-BV-EXM01-P.global.tektronix.net>
Message-ID: <969FE5C5-0A75-434E-BE08-A764F25731D9@rabbitmq.com>

Iirc this is true for all windows service management operations, regardless of the service in question. If not, it should be! But yes, it sounds correct that you'd need a privilleged account to start or stop a service.

Cheers,
Tim

On 17 Mar 2014, at 07:52, "Gu, Aiguo" <aiguo.gu at tekcomms.com> wrote:

> Hi All,
>  
>                 I have installed RabbitMQ Server on Win7, and the RabbitMQ service works fine with privilege account(Local System), if I changed the logon account with non-privilege, the service cannot be started. Could you please confirm the privilege account is necessary for the RabbitMQ service?
>  
> Best Regards
> Bruce Gu
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/0a8e7db5/attachment.html>

From matthias at rabbitmq.com  Mon Mar 17 09:32:38 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Mar 2014 09:32:38 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 fails to start if management
 plugin enabled
In-Reply-To: <012a01cf38dc$a3a42d40$eaec87c0$@gmail.com>
References: <001201cf385e$49e74bd0$ddb5e370$@gmail.com>
 <53174282.7070903@rabbitmq.com> <012a01cf38dc$a3a42d40$eaec87c0$@gmail.com>
Message-ID: <5326C136.6060204@rabbitmq.com>

On 06/03/14 01:37, Junius Wang wrote:
> No, not in a cluster.  Sasl log tells: [...]

We still haven't been able to reproduce this, and staring at the code 
hasn't helped either.

Is the sasl log you posted the *entire* log or were there more entries 
prior to the ones you posted?

Matthias.

From Shashank.Lothe at techmahindra.com  Mon Mar 17 10:45:55 2014
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Mon, 17 Mar 2014 10:45:55 +0000
Subject: [rabbitmq-discuss] rabbitmq-c APIs hanging during network down
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C992DCF2@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

Thanks for your reply. As expected by you these kind of APIs must be hanging in other amqp clients as well. I have tested php APIs using php-amqp library and noticed the same hanging behaviour.

What could be the possible way out for these situations? Issue is raised in github for tracking.

regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/d8f62e49/attachment.html>

From sean at monkeysnatchbanana.com  Mon Mar 17 11:46:27 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Mon, 17 Mar 2014 07:46:27 -0400
Subject: [rabbitmq-discuss] last_blocked_by resource
In-Reply-To: <5324C790.1080607@rabbitmq.com>
References: <CABm-WmfPC=+Ru3+_dWsnNZvP_uDnjnqZQ8uQiWJL_S4AWAcgxA@mail.gmail.com>
 <5324C790.1080607@rabbitmq.com>
Message-ID: <CABm-WmefxaMiD3wpdyEOomWEwEg5RwyUZaqyF7=ZF0=CzNMh1A@mail.gmail.com>

On Sat, Mar 15, 2014 at 5:35 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/03/14 16:21, Sean Allen wrote:
>
>> Question about connections getting blocked for resource levels.
>>
>> Simplifying what we have.
>>
>> I have an exchange "event"
>>
>> Queue: handle.event is bound the "event" on node 1.
>>
>> Node 2 of the cluster is over memory water mark.
>>
>> I have a connection that is connected to Node 3 of the cluster that is
>> publishing to the "event" exchange. How is it possible for that
>> connection to end up being blocked for resource reasons?
>>
>
> RabbitMQ cannot know where future messages published on a connection might
> get routed to. So, in your example, the connection to Node 3 could be used
> to publish messages which end up getting enqueued in queues on Node 2.
> Which would be bad.
>
> The upshot is that a resource alarm on any node blocks publishing
> connections on all nodes.



Does that apply when an exchange is federated?

If I have cluster A and cluster B

and messages are published to an exchange in cluster A and is in turn
federated to cluster B

does an alarm in cluster A prevent cluster B from getting said message?
does an alarm in cluster B prevent cluster A from getting said message?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/5ce7dacf/attachment.html>

From matthias at rabbitmq.com  Mon Mar 17 11:48:41 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Mar 2014 11:48:41 +0000
Subject: [rabbitmq-discuss] last_blocked_by resource
In-Reply-To: <CABm-WmefxaMiD3wpdyEOomWEwEg5RwyUZaqyF7=ZF0=CzNMh1A@mail.gmail.com>
References: <CABm-WmfPC=+Ru3+_dWsnNZvP_uDnjnqZQ8uQiWJL_S4AWAcgxA@mail.gmail.com>	<5324C790.1080607@rabbitmq.com>
 <CABm-WmefxaMiD3wpdyEOomWEwEg5RwyUZaqyF7=ZF0=CzNMh1A@mail.gmail.com>
Message-ID: <5326E119.5060801@rabbitmq.com>

On 17/03/14 11:46, Sean Allen wrote:
> Does that apply when an exchange is federated?

No. Alarms propagate throughout a cluster, not a federation.

Matthias.

From pat at munkiisoft.com  Mon Mar 17 11:50:44 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Mon, 17 Mar 2014 11:50:44 +0000
Subject: [rabbitmq-discuss] Broken 3 node cluster
Message-ID: <CALDntb_mnqfNuLuUdkZGArYf1JO16PrnKoc0UjUTzeD3Ow-bcw@mail.gmail.com>

RABBITMQ 3.2.1 on Windows Server 2003


Came into work this morning to find a suspected Network partition on a 3
node cluster

Node 3 and Node 2 said Node 1 was down

Node 1 said 2 and 3 were down

Tried stop_app on Node 1 but it hung stop_app on Nodes 2 and 3 were fine.

All 3 nodes hang on start_app

Tried restarting Windows service. Nodes 2 and 3 come back and are clustered

Node 1 will not start. In the end I removed all contents of the db
directory. Not it starts up.

I want to rejoin the cluster but it says it is already a member although
cluster_status says otherwise.

I have tried forget_cluster_node from one of the running nodes but that
hangs

Anyone any ideas?


Thanks




-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/bd666ec0/attachment.html>

From alan.antonuk at gmail.com  Mon Mar 17 15:05:32 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 17 Mar 2014 08:05:32 -0700
Subject: [rabbitmq-discuss] rabbitmq-c APIs hanging during network down
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C992DCF2@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C992DCF2@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poK18uY+RNtfpVYmZt-gg-81F_2YTzauQ9Ksq9V=s3EnQQ@mail.gmail.com>

On Mon, Mar 17, 2014 at 3:45 AM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi Alan,
>
> Thanks for your reply. As expected by you these kind of APIs must be
> hanging in other amqp clients as well. I have tested php APIs using
> php-amqp library and noticed the same hanging behaviour.
>

php-amqp is a wrapper around the rabbitmq-c library, and thus not really a
good comparison. You should try it with the Java or .NET clients.

>
> What could be the possible way out for these situations? Issue is raised
> in github for tracking.
>

Enable heartbeats on the client. You can do this by passing a value greater
than 0 to amqp_login(). A default used by the Java client is 600 second, or
10 minutes. It can be set lower than this if necessary. Note that
rabbitmq-c only has partial support for heartbeats: it has nothing in the
background servicing heartbeat events, so it is necessary to have your code
call into the library (or be blocked on a call into the library) more
frequently than the heartbeat interval specified.

More information about heartbeats can be found:
https://www.rabbitmq.com/reliability.html#connection-failures

>
> regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/a88ee0d8/attachment.html>

From janwillem.luiten at gmail.com  Mon Mar 17 15:36:27 2014
From: janwillem.luiten at gmail.com (J.W. Luiten)
Date: Mon, 17 Mar 2014 16:36:27 +0100
Subject: [rabbitmq-discuss] Building a release containing RabbitMQ
Message-ID: <C0FD2A4D-A240-43F1-ABA8-DEDA02DC0F60@gmail.com>

I managed to get it fixed and integrated in the build process. I wrote a small make file and copied the .app.src file.

I noticed that RabbitMQ depends on the Erlang library xmerl while this is not registered in the application descriptor supplied fro rabbitmq.

Kind regards,

Jan Willem Luiten


> What bit isn't workin for you? Have you got a relx error message or is the release missing content, or the start/init scripts not generated correctly!
> 


From videlalvaro at gmail.com  Mon Mar 17 15:48:10 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 17 Mar 2014 16:48:10 +0100
Subject: [rabbitmq-discuss] Building a release containing RabbitMQ
In-Reply-To: <C0FD2A4D-A240-43F1-ABA8-DEDA02DC0F60@gmail.com>
References: <C0FD2A4D-A240-43F1-ABA8-DEDA02DC0F60@gmail.com>
Message-ID: <CAMcAHLU0r=7q1q4RwZ5ZJjAVufA_55kZVqh2FRW-T0ctETdyRA@mail.gmail.com>

Hi,

Do you mean this
http://hg.rabbitmq.com/rabbitmq-server/file/fc452df284c5/ebin/rabbit_app.in#l13
? or where?

Regards,

Alvaro

On Mon, Mar 17, 2014 at 4:36 PM, J.W. Luiten <janwillem.luiten at gmail.com> wrote:
> I managed to get it fixed and integrated in the build process. I wrote a small make file and copied the .app.src file.
>
> I noticed that RabbitMQ depends on the Erlang library xmerl while this is not registered in the application descriptor supplied fro rabbitmq.
>
> Kind regards,
>
> Jan Willem Luiten
>
>
>> What bit isn't workin for you? Have you got a relx error message or is the release missing content, or the start/init scripts not generated correctly!
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mcintoshj at gmail.com  Mon Mar 17 16:22:00 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 17 Mar 2014 11:22:00 -0500
Subject: [rabbitmq-discuss] Odd behavior where server stops responding
In-Reply-To: <CAD6m6fHOAgyq=UViuZffL6zoEArFJR3pt-98TkLnK4bmX6u+yQ@mail.gmail.com>
References: <CAD6m6fELssrE4ZW8fe_86qv57bWX37e50SFTJ=Ua=eQ3Lg1D9w@mail.gmail.com>
 <2292C621-BB78-4491-89D0-75137BD7BF23@rabbitmq.com>
 <CAD6m6fFrizO5c2WAyxqn07ujYfrKHzcRhkBWiL0M=0=--LbHqA@mail.gmail.com>
 <2B32DAB5-8C1F-4B1B-A340-3315C25766B7@rabbitmq.com>
 <CAD6m6fEj-3WyaoXbKfmQOWzP3RTLP+y-krk4=T=1vQirhqT2kg@mail.gmail.com>
 <6CE47C9B-ADD0-4675-A106-247DC6D278D6@rabbitmq.com>
 <CAD6m6fEC8dT23r4Q+UfcT2-SQxv0vfkF1nis5FN_oazhk+GeDA@mail.gmail.com>
 <0FC57FE7-9DA0-48F0-9368-2B4FC02B1303@gopivotal.com>
 <CAD6m6fHOAgyq=UViuZffL6zoEArFJR3pt-98TkLnK4bmX6u+yQ@mail.gmail.com>
Message-ID: <CAD6m6fE7AJELEcYa45rk6M=Tvj90W7yWh_O422xswBp=nyiUOw@mail.gmail.com>

SO we finally figured out the issue.  Apparently there's a rather nasty bug
in the 2.6.32 kernels:
https://bugs.launchpad.net/ubuntu/+source/linux/+bug/805341
http://www.novell.com/support/kb/doc.php?id=7009834
https://www.ibm.com/developerworks/community/blogs/anthonyv/entry/208_day_reboot_bug3?lang=en

These are just a few of the sites listing the problem and upgrade notes.
 The behavior on this for us was really kinda random.  We've had some
systems just completely freeze, the OS being totally hung.  Other systems
seem to manage to make it past the limit by a day or two then die.  In the
case of the servers I mentioned, only the Rabbit process itself hung.  But
the one consistent thing we discovered was that all the servers having an
issue had an uptime right around 208 days - we missed this on our initial
investigation.  SO If anyone is running CentOS 6.2, upgrade!

Jason


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/d16adf2b/attachment.html>

From ron.cordell at gmail.com  Mon Mar 17 16:58:17 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Mon, 17 Mar 2014 09:58:17 -0700
Subject: [rabbitmq-discuss] Broken 3 node cluster
In-Reply-To: <CALDntb_mnqfNuLuUdkZGArYf1JO16PrnKoc0UjUTzeD3Ow-bcw@mail.gmail.com>
References: <CALDntb_mnqfNuLuUdkZGArYf1JO16PrnKoc0UjUTzeD3Ow-bcw@mail.gmail.com>
Message-ID: <CAFtA53xDY04i4NwprFZztNJb4bWVKrYnMrF_Jm4RNnRxVVUwhA@mail.gmail.com>

Hi,

We experienced almost exactly similar symptoms when we first started
working with RabbitMQ clusters. We checked everything - network, switches,
load balancer, application code. The cluster was always unstable in the way
that you describe. We brought Pivotal Labs in to do some deep dives to see
if they could help - from what they told us we weren't doing anything
incorrectly. We tried various combinations of RabbitMQ releases and Erlang
releases as well.

We put together a Linux-based cluster and never had a problem with it.
Solid as a rock and significantly more throughput. We put our Windows
cluster in a non-load balanced, two node active/passive type of
configuration. Most of our queues are mirrored/highly available and there
are a couple hundred of them. We need to be assured that we wouldn't lose
messages, so we came up with this "limp mode" to get us into production at
low message volumes until we could solidify our ops teams around Linux. We
are now replacing the Windows "clusters" with real 3-node, load balanced
Linux clusters. All of our performance testing has shown them to be
completely solid. No weird cluster node states or anything like that.

This is not a "Linux us better than Windows" diatribe. We have been a
completely Windows shop until now and we decided to incur the cost of
operationalizing Linux in our infrastructure because RabbitMQ is a key
component. Our measurements and observations told us that if we want to run
a high throughput, stable, Rabbit cluster with mostly mirrored queues it
would have to be on Linux.

-Ron


On Mon, Mar 17, 2014 at 4:50 AM, Patrick Long <pat at munkiisoft.com> wrote:

> RABBITMQ 3.2.1 on Windows Server 2003
>
>
> Came into work this morning to find a suspected Network partition on a 3
> node cluster
>
> Node 3 and Node 2 said Node 1 was down
>
> Node 1 said 2 and 3 were down
>
> Tried stop_app on Node 1 but it hung stop_app on Nodes 2 and 3 were fine.
>
> All 3 nodes hang on start_app
>
> Tried restarting Windows service. Nodes 2 and 3 come back and are clustered
>
> Node 1 will not start. In the end I removed all contents of the db
> directory. Not it starts up.
>
> I want to rejoin the cluster but it says it is already a member although
> cluster_status says otherwise.
>
> I have tried forget_cluster_node from one of the running nodes but that
> hangs
>
> Anyone any ideas?
>
>
> Thanks
>
>
>
>
> --
> Patrick Long - Munkiisoft Ltd
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/a78a3b8b/attachment.html>

From hristo.Ivanov at internovusbg.com  Mon Mar 17 12:22:57 2014
From: hristo.Ivanov at internovusbg.com (Hristo Ivanov)
Date: Mon, 17 Mar 2014 12:22:57 +0000
Subject: [rabbitmq-discuss] Bugs in RabbitMQ WCF Library
Message-ID: <44B0A86B894B4140A44E29028AC304BD1DB16077@mailbulg.Bforex.Local>

Hello folks,

I have some problems with the WCF binding library which I got advice from IRC to share here:

1)      The Client does not send to the server (fill up the queue and then quit), even in one-way communication manner. Instead, it waits for confirmation;

2)      I cannot start multiple server worker processes on the same queue, which greatly limits the number of instances (to one) of running server processes;

3)      All communication is lost when either the client or the server dies, even in one-way communication.

Microsoft's Message Queue WCF service does not have this limitation. It could be used only for one-way communication only, though, and therefore does not fit all the use cases we have.

I think the problems  above are related to not having durable queues - the WCF binding always creates temporary queues. I have been given the advice of communicating directly with the queue on IRC. I guess the only available option to us is to create another binding, which could support:

*         One-way communication (fire-and-forget), using durable queues;

*         Multiple worker processes (self-hosted WCF), using the same durable queues;

*         Possible duplex and/or direct communication without the need for both parties to be online at the same time.

Do you have any insight on how this would be possible with the current driver? I guess, if it requires minor changes, it shouldn't be very hard to achieve, provided that the broker can create multitude of reply queues and a single request queue.

Best,
Hristo Ivanov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/2af24a5d/attachment.html>

From dmitry.andrianov at alertme.com  Mon Mar 17 18:15:41 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Mon, 17 Mar 2014 18:15:41 +0000
Subject: [rabbitmq-discuss] absolute message counts
Message-ID: <53273BCD.9030009@alertme.com>

Hello.
Is there a way to get absolute message counters (instead of rates) from 
RabbitMQ?
I am thinking of creating a script which takes that value every minute 
and saves into some sort of time series database.

It is very easy to derive rates from absolute values but it is tricky to 
do the opposite...

(I would need number of messages published on an exchange, and delivered 
from a queue to consumers)

Thanks


This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mcintoshj at gmail.com  Mon Mar 17 18:27:39 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 17 Mar 2014 13:27:39 -0500
Subject: [rabbitmq-discuss] absolute message counts
In-Reply-To: <53273BCD.9030009@alertme.com>
References: <53273BCD.9030009@alertme.com>
Message-ID: <CAD6m6fFtF_2vPu+moW25crF8LBbyEyArK=hdKSuseBuiJTQuiQ@mail.gmail.com>

The way I've been looking to do it is using the seq_id on the backing queue
stats via the management API.  Though not ideal, it gives you a current
number that you can do a delta on.  There's a few other fields in there
that might provide this information as well.

Jason


On Mon, Mar 17, 2014 at 1:15 PM, Dmitry Andrianov <
dmitry.andrianov at alertme.com> wrote:

> Hello.
> Is there a way to get absolute message counters (instead of rates) from
> RabbitMQ?
> I am thinking of creating a script which takes that value every minute and
> saves into some sort of time series database.
>
> It is very easy to derive rates from absolute values but it is tricky to
> do the opposite...
>
> (I would need number of messages published on an exchange, and delivered
> from a queue to consumers)
>
> Thanks
>
>
> This email is for the use of the intended recipient(s) only.
> If you have received this email in error, please notify the sender
> immediately and then delete it.
> If you are not the intended recipient, you must not use, disclose or
> distribute this email without the
> author's prior permission. AlertMe.com Ltd. is not responsible for any
> personal views expressed
> in this message or any attachments that are those of the individual sender.
>
> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
> Registered in England, Company number 578 2908, VAT registration number GB
> 895 9914 42.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/986835f8/attachment.html>

From riccardi at systran.fr  Mon Mar 17 18:47:01 2014
From: riccardi at systran.fr (Thomas Riccardi)
Date: Mon, 17 Mar 2014 19:47:01 +0100
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
 <5322D493.1020107@rabbitmq.com>
 <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>
Message-ID: <1395082021.3450.332.camel@CLM3X4J.systran.local>

Thanks for the replies all, so we are not alone with this feature
request.


On ven., 2014-03-14 at 08:28 -0400, Laing, Michael wrote: 
> It's a good topic. 
> 
> 
> In our std framework, based on python pika, a service may fail in
> processing a message due to an exception being raised - something
> unanticipated - the service will have chosen a default action to take
> in that case when it was initialized, typically 'reject'. Typically it
> will log a warning as well.
> 
> 
> We gather rejected messages in a 'reject' exchange and process them
> enough (via their headers) to route them back to their originators as
> well as to our own 'triage' queue.
> 

This dead-lettering back to the originator using a headers dead-letter
exchange is a really useful pattern for RPC over RabbitMQ, I was
surprised to not find any mention of this in the readings or ML on the
subject.

(Alas it requires duplicating the "replyTo" information (one time in the
amqp standard message property, and a second time in a non standard
header, as there is no RabbitMQ exchange routing on the "replyTo"
property), or not using the standard "replyTo" at all.)

> 
> Our messages all carry their processing history in their headers:
> region, zone, instance, pid, service, timestamp, etc. - again part of
> the framework.
> 
> 
> We also gather and coordinate the logs of all services on all
> instances.
> 
> 
> Additionally we replicate messages and process them in parallel
> through our Core clusters in multiple regions.
> 
> 
> A truly poison message will fail spectacularly everywhere. We have not
> actually encountered one yet in production. We do get them in staging,
> and bells go off everywhere.
> 
> 
> A failure of infrastructure will be localized to a region, zone,
> instance, or supporting service like Cassandra or the AWS control
> plane. Anticipated failures are retried. Unanticipated failures result
> in rejection of that message replica but other replicas should
> succeed. We do get these in production and can immediately tell where
> failures occurred and take appropriate action, e.g. shifting load away
> from failure if it has not yet taken place automatically.
> 
> 
> Of course it would be nice to get more info upon rejection. We
> compensate by creating context around rejection and coordinating the
> context in near real time across the nyt?a?rik.
> 

I think we will go with manual re-queueing (in the same queue) of
redelivered messages with a custom "redelivery-count" header manually
incremented, instead of currently just rejecting them.
Then, upon receiving a non-redelivered message, we reject it or not
according to the custom "redelivery-count" header.

It's a variation of the re-queueing to a "probably poison" second queue
technique mentioned earlier in this thread. Indeed I don't see why we
need a second queue when we can just modify a header and re-queue.

The only drawback is that we modify the message, which is avoided as
much as possible on the broker, but we are not on the broker so we can
do that without any issue.


Cheers,
Thomas 


From sean at monkeysnatchbanana.com  Mon Mar 17 21:08:55 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Mon, 17 Mar 2014 17:08:55 -0400
Subject: [rabbitmq-discuss] Per Connection Throttling
Message-ID: <CABm-WmfaC0zgPTZHd-8o+Wn-ib55rZLf3obyJRTi6Ng2F9gtLQ@mail.gmail.com>

Post a really large number of messages to an exchange and not get throttled
with per connection throttling. What possible strategies do I have to deal
with this?

Batching into larger messages is possible but creates issues elsewhere.

Would posting to the same exchange with different routing keys that go to
are bound to different queues both on the same node and on different nodes
help?

For some idea, we would be generating at least 500k to 1 million messages a
second for some extended period of time before it dies down occasionally
and then picks back up again.

Any advice is appreciated. Thanks.

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/c219fc18/attachment.html>

From michael.laing at nytimes.com  Mon Mar 17 21:35:24 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 17 Mar 2014 17:35:24 -0400
Subject: [rabbitmq-discuss] Per Connection Throttling
In-Reply-To: <CABm-WmfaC0zgPTZHd-8o+Wn-ib55rZLf3obyJRTi6Ng2F9gtLQ@mail.gmail.com>
References: <CABm-WmfaC0zgPTZHd-8o+Wn-ib55rZLf3obyJRTi6Ng2F9gtLQ@mail.gmail.com>
Message-ID: <CAKgmDnGUSJxxZ8rVW5sc-g+g=yHmdiUxhAUfaq5m2v6A4UKrpA@mail.gmail.com>

We are preparing now to reach those rates but will do so running lots of
rabbits in parallel in an autoscaling layer to lower the per rabbit msg
rate and buffering requirements.

We persist directly to Cassandra from each rabbit and continue the
processing chain from there.

ml


On Mon, Mar 17, 2014 at 5:08 PM, Sean Allen <sean at monkeysnatchbanana.com>wrote:

> Post a really large number of messages to an exchange and not get
> throttled with per connection throttling. What possible strategies do I
> have to deal with this?
>
> Batching into larger messages is possible but creates issues elsewhere.
>
> Would posting to the same exchange with different routing keys that go to
> are bound to different queues both on the same node and on different nodes
> help?
>
> For some idea, we would be generating at least 500k to 1 million messages
> a second for some extended period of time before it dies down occasionally
> and then picks back up again.
>
> Any advice is appreciated. Thanks.
>
> --
>
> Ce n'est pas une signature
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140317/74ea15b2/attachment.html>

From matthias at rabbitmq.com  Tue Mar 18 08:15:06 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 18 Mar 2014 08:15:06 +0000
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <1395082021.3450.332.camel@CLM3X4J.systran.local>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
 <5322D493.1020107@rabbitmq.com>
 <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>
 <1395082021.3450.332.camel@CLM3X4J.systran.local>
Message-ID: <5328008A.6090107@rabbitmq.com>

On 17/03/14 18:47, Thomas Riccardi wrote:
> I think we will go with manual re-queueing (in the same queue) of
> redelivered messages with a custom "redelivery-count" header manually
> incremented, instead of currently just rejecting them.

That's certainly a viable approach. There are two notable differences 
compared to using reject:

- rejecting re-queues messages in place whereas re-publishing enqueues 
at the back

- extra logic is required to prevent message loss, i.e. depending the 
guarantees required by the application you may want to re-publish in 
confirm mode and wait for confirmation before acknowledging the original 
message.

Matthias.

From mklishin at gopivotal.com  Tue Mar 18 08:30:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 18 Mar 2014 12:30:53 +0400
Subject: [rabbitmq-discuss] Clustering Questions
In-Reply-To: <CAGZFCEFiTWOiRjWUobuhuSpDnj_t6EcVBw4VtQFRLsgD5oprMw@mail.gmail.com>
References: <CAGZFCEFiTWOiRjWUobuhuSpDnj_t6EcVBw4VtQFRLsgD5oprMw@mail.gmail.com>
Message-ID: <B92F94AD-4CCB-4C7E-981A-DB09FF74D2F5@rabbitmq.com>


On 16 Mar 2014, at 12:12, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

>> http://www.rabbitmq.com/configure.html#configuration-file
> I saw a paramter  "cluster_nodes" . it mentions about automatic
> clustering.
> 
> 1 ) So here  clustering  refers to clustering of  brokers ...right ?

Yes, RabbitMQ nodes.

> 
> 2) Suppose a producer is sending  messages to consumer thru Broker A.
> Suppose Broker A goes down or
> too busy. Clustering would help to transfer the flow of messages thru
> Broker B, which is part of cluster ?

Cluster nodes transfer published messages to queue masters, which then
replicate them to queue mirrors (if any). If a node goes down, publishers
should reconnect to a different one. Queues that had masters on the unavailable
node will elect a new master automatically, consumers from those queues will
receive notifications via basic.cancel.

> 
> 3)  In question (2),  is producer and consumer has to take any action
> , which is informed by server ? or it is explicit ?

Clients that were connected to the unreachable node will see network connectivity
errors of some kind. Whether clients have a way to recover and how exactly it
works depends on your client.


MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Mar 18 08:35:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 18 Mar 2014 12:35:18 +0400
Subject: [rabbitmq-discuss] Best practices to manage failovers at the
	publishers side
In-Reply-To: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
References: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
Message-ID: <30F23F5B-4385-4FDD-A120-797448BB30C5@rabbitmq.com>


On 17 Mar 2014, at 12:58, rails <stammailbox at gmail.com> wrote:

> What options does rabbitMQ (client side) have that will help me to manage this scenario?
> 1. Can he accumulate the messages ? 

It?s possible but since the outage can last for minutes or hours, your client risks
running out of RAM.

> 2. Can he manage retries? 

You can attempt to reconnect and it will help with short outages. You really should try to
reconnect to a different cluster node.

> 
> The second part of the question is regarding managing the failover itself. 
>  I know that in some databases I can write a connection string as follows 
> 
>        Data Source=myServerAddress;Failover Partner=myMirrorServerAddress;
> and if the action fails the client automatically switches to another one in the same action.

RabbitMQ Java and .NET clients can use a list of addresses when connecting. The first
reachable node will be used. Many other clients don?t have this feature but it?s pretty
easy to imitate.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Mar 18 08:37:53 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 18 Mar 2014 12:37:53 +0400
Subject: [rabbitmq-discuss] Best practices to manage failovers at the
	publishers side
In-Reply-To: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
References: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
Message-ID: <FDB47CF6-3132-4ADD-946C-609FB84FBB01@rabbitmq.com>


On 17 Mar 2014, at 12:58, rails <stammailbox at gmail.com> wrote:

> 3. What is the best practice to manage failovers at the publishers side?

Keep a write-ahead log (WAL) of messages on disk if you can.
This will help you avoid message loss if publisher itself crashes.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Tue Mar 18 09:31:04 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 09:31:04 +0000
Subject: [rabbitmq-discuss] Per Connection Throttling
In-Reply-To: <CABm-WmfaC0zgPTZHd-8o+Wn-ib55rZLf3obyJRTi6Ng2F9gtLQ@mail.gmail.com>
References: <CABm-WmfaC0zgPTZHd-8o+Wn-ib55rZLf3obyJRTi6Ng2F9gtLQ@mail.gmail.com>
Message-ID: <53281258.8000909@rabbitmq.com>

On 17/03/2014 21:08, Sean Allen wrote:
> Would posting to the same exchange with different routing keys that go
> to are bound to different queues both on the same node and on different
> nodes help?

Yes. Exchanges are just routing logic; they don't need to be factored 
into load calculations. Queues on the other hand are stateful and a 
single queue can only use one CPU core - so splitting the load among 
queues is valuable.

You would (obviously) also want to split the connections across nodes. 
And it certainly helps to have as much locality as possible (i.e. 
publishing to and consuming from queues on the same node).

Cheers, Simon

From simon at rabbitmq.com  Tue Mar 18 09:39:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 09:39:17 +0000
Subject: [rabbitmq-discuss] absolute message counts
In-Reply-To: <CAD6m6fFtF_2vPu+moW25crF8LBbyEyArK=hdKSuseBuiJTQuiQ@mail.gmail.com>
References: <53273BCD.9030009@alertme.com>
 <CAD6m6fFtF_2vPu+moW25crF8LBbyEyArK=hdKSuseBuiJTQuiQ@mail.gmail.com>
Message-ID: <53281445.4040307@rabbitmq.com>

On 17/03/2014 18:27, Jason McIntosh wrote:
> There's a few other fields
> in there that might provide this information as well.

Yes, look at <thing>.message_stats, where <thing> is exchange, channel, 
queue or overview. This will include (e.g.) 'publish_details' which will 
be derived from the absolute counter, and 'publish', which will be the 
absolute counter itself.

You should be aware that these stats are held in memory by the 
management DB, and so can reset if the DB fails over or is restarted. 
(And before 3.1 they were not monotonic at all.) The seq_id Jason 
mentioned is persistent, but less fine grained.

Cheers, Simon


From simon at rabbitmq.com  Tue Mar 18 09:42:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 09:42:27 +0000
Subject: [rabbitmq-discuss] Bugs in RabbitMQ WCF Library
In-Reply-To: <44B0A86B894B4140A44E29028AC304BD1DB16077@mailbulg.Bforex.Local>
References: <44B0A86B894B4140A44E29028AC304BD1DB16077@mailbulg.Bforex.Local>
Message-ID: <53281503.8060603@rabbitmq.com>

Yeah, the WCF binding has quite a few limitations and unfortunately we 
don't really have the resources to develop it further. If someone from 
the community wants to pick it up and run with it (or indeed start 
again) then they would be very welcome to.

Cheers, Simon

On 17/03/2014 12:22, Hristo Ivanov wrote:
> Hello folks,
>
> I have some problems with the WCF binding library which I got advice
> from IRC to share here:
>
> 1)The Client does not send to the server (fill up the queue and then
> quit), even in one-way communication manner. Instead, it waits for
> confirmation;
>
> 2)I cannot start multiple server worker processes on the same queue,
> which greatly limits the number of instances (to one) of running server
> processes;
>
> 3)All communication is lost when either the client or the server dies,
> even in one-way communication.
>
> Microsoft?s Message Queue WCF service does not have this limitation. It
> could be used only for one-way communication only, though, and therefore
> does not fit all the use cases we have.
>
> I think the problems  above are related to not having durable queues ?
> the WCF binding always creates temporary queues. I have been given the
> advice of communicating directly with the queue on IRC. I guess the only
> available option to us is to create another binding, which could support:
>
> ?One-way communication (fire-and-forget), using durable queues;
>
> ?Multiple worker processes (self-hosted WCF), using the same durable queues;
>
> ?Possible duplex and/or direct communication without the need for both
> parties to be online at the same time.
>
> Do you have any insight on how this would be possible with the current
> driver? I guess, if it requires minor changes, it shouldn?t be very hard
> to achieve, provided that the broker can create multitude of reply
> queues and a single request queue.
>
> Best,
>
> Hristo Ivanov
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue Mar 18 09:54:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 09:54:27 +0000
Subject: [rabbitmq-discuss] Problems with the
 {cluster_partition_handling, pause_minority} option
In-Reply-To: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>
References: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>
Message-ID: <532817D3.2080901@rabbitmq.com>

Hi. Just to let you know that this has not been forgotten about. I have 
reproduced the problem you describe and am investigating it. The key 
factor seems to be (at a TCP level) that A realises it is disconnected 
from B but not vice versa. Therefore (at an Erlang level) the partition 
is not detected.

It's not specifically to do with pause_minority mode.

I'll post more information when I have it.

Cheers, Simon

On 05/03/2014 17:18, David Rodrigues wrote:
> Dear RabbitMQ Community,
>
> I'm having some problems with the {cluster_partition_handling,
> pause_minority} option and I would like to share with you my doubts.
>
> First, the architecture. I'm running RabbitMQ 3.2.4 (Erlang R14A) on 3
> nodes (rabbitmq at rabbitmq-test01, rabbitmq at rabbitmq-test02 and
> rabbitmq at rabbitmq-test03) on a virtualized platform - quite similar to
> EC2.  And because of that I have, from time to time, connectivity issues
> ? I know, that's bad ;)
>
> Digging into the doc I have found that the best way to handle the
> problem is using the pause_minority option -
> https://www.rabbitmq.com/partitions.html.
>
> But from time to time my nodes get disconnected from each other and do
> not recover automatically. Hopefully I have managed to reproduce the
> problem. Here are the steps.
>
> THE CONFIGURATION FILE
> ***********************************************************
>
> My configuration file is quite simple:
>
> %% -*- mode: erlang -*-
> [
>   {rabbit,
>    [
>     {auth_mechanisms, ['PLAIN', 'AMQPLAIN']},
>     {default_vhost,       <<"/">>},
>     {default_user,        <<"admin">>},
>     {default_pass,        <<"admin">>},
>     {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
>     {default_user_tags, [administrator]},
>     {cluster_partition_handling, pause_minority},
>     {cluster_nodes, {['rabbitmq at rabbitmq-test01',
> 'rabbitmq at rabbitmq-test02', 'rabbitmq at rabbitmq-test03'], disc}}
>    ]},
>   {kernel, []},
>   {rabbitmq_management, []},
>   {rabbitmq_management_agent, []},
>   {rabbitmq_shovel,
>    [{shovels, []}
>    ]},
>   {rabbitmq_stomp, []},
>   {rabbitmq_mqtt, []},
>   {rabbitmq_amqp1_0, []},
>   {rabbitmq_auth_backend_ldap, []}
> ].
>
> Has you can see, the {cluster_partition_handling, pause_minority} option
> is there.
>
> PAUSE_MINORITY WORKING
> ***********************************************************
>
> When the network outage is long enough, the option works perfectly.
>
> To simulate a connection problem on rabbitmq-test03 I run:
>
> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
> rabbitmq-test01 -j DROP
> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
> rabbitmq-test02 -j DROP
>
> Then wait long enough for the following messages to appear in the logs
> of rabbitmq-test03 (approximately 180 seconds):
>
> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
> ** Node 'rabbitmq at rabbitmq-test02' not responding **
> ** Removing (timedout) connection **
> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
> ** Node 'rabbitmq at rabbitmq-test01' not responding **
> ** Removing (timedout) connection **
> =INFO REPORT==== 5-Mar-2014::16:51:02 ===
> rabbit on node 'rabbitmq at rabbitmq-test02' down
> =WARNING REPORT==== 5-Mar-2014::16:51:30 ===
> Cluster minority status detected - awaiting recovery
> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
> rabbit on node 'rabbitmq at rabbitmq-test01' down
> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
> Stopping RabbitMQ
> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
> stopped TCP Listener on [::]:5672
> =WARNING REPORT==== 5-Mar-2014::16:51:58 ===
> Cluster minority status detected - awaiting recovery
>
> When flushing the rules (iptables -F) the connectivity is reestablished
> and the cluster works perfectly.
>
> In the logs:
>
> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
> started TCP Listener on [::]:5672
> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
> rabbit on node 'rabbitmq at rabbitmq-test01' up
> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
> rabbit on node 'rabbitmq at rabbitmq-test02' up
>
> Finally the cluster status :
>
> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>                  'rabbitmq at rabbitmq-test03']}]},
>   {running_nodes,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>                   'rabbitmq at rabbitmq-test03']},
>   {partitions,[]}]
> ...done.
>
> So far, so good. The option works flawlessly.
>
> PAUSE_MINORITY NOT WORKING
> ***********************************************************
>
> Life is not so bright when the network partition is not long enough.
>
> On rabbitmq-test03 I will run my iptables commands again:
>
> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
> rabbitmq-test01 -j DROP
> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
> rabbitmq-test02 -j DROP
>
> However this time I'll only wait 60 seconds before flushing my rules
> with iptables -F.
>
> And that's the result in rabbitmq-test03 logs:
>
> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
> rabbit on node 'rabbitmq at rabbitmq-test02' down
> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
> Mnesia('rabbitmq at rabbitmq-test03'): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> 'rabbitmq at rabbitmq-test02'}
> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
> rabbit on node 'rabbitmq at rabbitmq-test01' down
> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
> Statistics database started.
> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
> Statistics database started.
>
> Again, the result is quiet ugly on rabbitmq-test01:
>
> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
> ** Node 'rabbitmq at rabbitmq-test03' not responding **
> ** Removing (timedout) connection **
> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
> rabbit on node 'rabbitmq at rabbitmq-test03' down
> =INFO REPORT==== 5-Mar-2014::16:55:01 ===
> global: Name conflict terminating {rabbit_mgmt_db,<2669.1582.0>}
>
> Finally my cluster status:
>
> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>                  'rabbitmq at rabbitmq-test03']}]},
>   {running_nodes,['rabbitmq at rabbitmq-test03']},
>   {partitions,[{'rabbitmq at rabbitmq-test03',['rabbitmq at rabbitmq-test02']}]}]
> ...done.
>
> That's it. Even with the pause_minority option my cluster was disintegrated.
>
> SYNOPSIS
> ***********************************************************
>
> In short, if the network outage is long enough everything goes according
> to the plan and the cluster works perfectly once the connectivity is
> reestablished. However if the network outage has a intermediate duration
> (not too short, not too long) the pause_minority option seems not to work.
>
> Are you aware of this problem? Is there any solution to cope with this
> particular situation?
>
> Thanks,
> David
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From oskar at vergic.com  Tue Mar 18 12:41:38 2014
From: oskar at vergic.com (Oskar Liljeblad)
Date: Tue, 18 Mar 2014 12:41:38 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 crashes - std_alloc: Cannot
 allocate 1125562100111744 bytes of memory (of type "arg_reg")
Message-ID: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>

Hello!

We are running a single node RabbitMQ 3.2.4 setup with an issue: Several times during the day, the RabbitMQ crashes.
The crashes seem to occur during high load (e.g. when >=100000 messages are processed in a short period of time).
The generated erl_crash.dump always has the same error:

Slogan: std_alloc: Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg").

OS: Debian GNU/Linux wheezy/jessie, amd64
Erlang: R16B03-1 (HIPE enabled)

How can we troubleshoot this error?

Regards,

Oskar Liljeblad (oskar at vergic.com<mailto:oskar at vergic.com>)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140318/2f22e641/attachment.html>

From riccardi at systran.fr  Tue Mar 18 13:52:22 2014
From: riccardi at systran.fr (Thomas Riccardi)
Date: Tue, 18 Mar 2014 14:52:22 +0100
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <5328008A.6090107@rabbitmq.com>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>
 <5322D493.1020107@rabbitmq.com>
 <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>
 <1395082021.3450.332.camel@CLM3X4J.systran.local>
 <5328008A.6090107@rabbitmq.com>
Message-ID: <1395150742.3450.340.camel@CLM3X4J.systran.local>


On mar., 2014-03-18 at 08:15 +0000, Matthias Radestock wrote: 
> On 17/03/14 18:47, Thomas Riccardi wrote:
> > I think we will go with manual re-queueing (in the same queue) of
> > redelivered messages with a custom "redelivery-count" header manually
> > incremented, instead of currently just rejecting them.
> 
> That's certainly a viable approach. There are two notable differences 
> compared to using reject:
> 
> - rejecting re-queues messages in place whereas re-publishing enqueues 
> at the back

What about re-queueing and TTL? Is the timer still running from the
original queueing time? Or is it reset like a re-publishing?
Is there a difference between per-message TTL and per-queue message TTL
in this case?

> 
> - extra logic is required to prevent message loss, i.e. depending the 
> guarantees required by the application you may want to re-publish in 
> confirm mode and wait for confirmation before acknowledging the original 
> message.

Indeed, but this question should already have been raised and answered
(by confirm mode if needed) when publishing the original message.


Thanks for additional details.



From matthias at rabbitmq.com  Tue Mar 18 13:52:45 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 18 Mar 2014 13:52:45 +0000
Subject: [rabbitmq-discuss] Consumer crash, redelivery and prefetch
In-Reply-To: <1395150742.3450.340.camel@CLM3X4J.systran.local>
References: <1394739062.3450.224.camel@CLM3X4J.systran.local>	
 <CAHC35TBU=bOs=8cG0ZJ0N0-aTLG271BZUGiywpOyeJf-OqyVsg@mail.gmail.com>	
 <5322D493.1020107@rabbitmq.com>	
 <CAKgmDnEttQUqB=4uCKKPcqa_LNdheYUhxutXcZWSbHAj4eNJZA@mail.gmail.com>	
 <1395082021.3450.332.camel@CLM3X4J.systran.local>	
 <5328008A.6090107@rabbitmq.com>
 <1395150742.3450.340.camel@CLM3X4J.systran.local>
Message-ID: <53284FAD.8050504@rabbitmq.com>

On 18/03/14 13:52, Thomas Riccardi wrote:
> What about re-queueing and TTL? Is the timer still running from the
> original queueing time? Or is it reset like a re-publishing?

 From http://www.rabbitmq.com/ttl.html#per-queue-message-ttl
<quote>
The original expiry time of a message is preserved if it is requeued
</quote

So yes, that's another difference.

> Is there a difference between per-message TTL and per-queue message TTL
> in this case?

No.

Matthias.

From sdh at conix.com  Tue Mar 18 15:12:13 2014
From: sdh at conix.com (S. Doug Hunt)
Date: Tue, 18 Mar 2014 11:12:13 -0400
Subject: [rabbitmq-discuss] RabbitMQ C# client
Message-ID: <002801cf42bc$718d1530$54a73f90$@conix.com>

Ran into an interesting issue with the client.

 

The scenario is this:

 

We create a queue when a review operator first opens a unit of work.   Other
operators can open the same unit of work, but obviously we do not want to
add items to the queue from the database for subsequent operators.    So -
the first thing we do is use the QueueDeclarePassive(queuename) method in a
try-catch.

 

So - for the first operator fails with the error that the queue was not
found.   We then attempt to use the QueueDeclare method to create the queue,
however it then fails with the same error.

 

I suspect that the QueueDeclarePassive method may have set the passive bit -
and the client is not resetting it after failing so that the subsequent call
also is acting like a passive call.   

 

We do have a work around - which is to reset our model object - but would be
nice if the client handled this, either by re-implementing the QueueDeclare
with the passive bit, allowing us to set it - or by making the public
QueueDeclare method force the bit to false.

 

S. Douglas Hunt | Software Engineer

 

Voice  (734) 461-1420 | Fax (305) 675-2448

 <http://www.conix.com/> CONIX Systems, Inc

 

Safeguarding Payments

 

This message is intended for the use of the individual or entity to which it
is addressed, and may contain information that constitutes a copyright,
patent, trade secret or confidential information of CONIX Systems, Inc., or
is otherwise privileged, confidential, or exempt from disclosure under
applicable law.  If the reader of this message is not the intended
recipient, you are hereby notified that the dissemination, distribution, or
copying of this communication is strictly prohibited.  If you have received
this communication in error, please notify us immediately by electronic mail
and delete the original message and destroy any hard copies made thereof.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140318/a2e6da29/attachment.html>

From simon at rabbitmq.com  Tue Mar 18 15:40:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 15:40:38 +0000
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <002801cf42bc$718d1530$54a73f90$@conix.com>
References: <002801cf42bc$718d1530$54a73f90$@conix.com>
Message-ID: <532868F6.4030104@rabbitmq.com>

On 18/03/14 15:12, S. Doug Hunt wrote:
> We create a queue when a review operator first opens a unit of work.
> Other operators can open the same unit of work, but obviously we do not
> want to add items to the queue from the database for subsequent
> operators.    So ? the first thing we do is use the
> QueueDeclarePassive(queuename) method in a try-catch.
>
> So ? for the first operator fails with the error that the queue was not
> found.   We then attempt to use the QueueDeclare method to create the
> queue, however it then fails with the same error.

Exactly the same error? What error message are you getting, precisely?

> I suspect that the QueueDeclarePassive method may have set the passive
> bit ? and the client is not resetting it after failing so that the
> subsequent call also is acting like a passive call.

The passive bit is not stored in the model object; it's a parameter of 
the individual calls to QueueDeclare.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Tue Mar 18 15:57:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 18 Mar 2014 19:57:31 +0400
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <002801cf42bc$718d1530$54a73f90$@conix.com>
References: <002801cf42bc$718d1530$54a73f90$@conix.com>
Message-ID: <3F63C8FD-BE75-4B0A-AE64-C1355F601EE5@rabbitmq.com>


On 18 Mar 2014, at 19:12, S. Doug Hunt <sdh at conix.com> wrote:

> We create a queue when a review operator first opens a unit of work.   Other operators can open the same unit of work, but obviously we do not want to add items to the queue from the database for subsequent operators.    So ? the first thing we do is use the QueueDeclarePassive(queuename) method in a try-catch.
>  
> So ? for the first operator fails with the error that the queue was not found.   We then attempt to use the QueueDeclare method to create the queue, however it then fails with the same error.

When QueueDeclarePassive fails, a channel exception is thrown and it closes
the channel. The error you get subsequently is almost certainly for an attempt to use
a closed channel.

?resetting? the model likely involves creating a new IModel (channel) instance which
opens a brand new channel.

MK

Software Engineer, Pivotal/RabbitMQ



From sdh at conix.com  Tue Mar 18 17:44:20 2014
From: sdh at conix.com (S. Doug Hunt)
Date: Tue, 18 Mar 2014 13:44:20 -0400
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <532868F6.4030104@rabbitmq.com>
References: <002801cf42bc$718d1530$54a73f90$@conix.com>
 <532868F6.4030104@rabbitmq.com>
Message-ID: <000401cf42d1$b1735f00$145a1d00$@conix.com>

{"The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=404, text=\"NOT_FOUND - no queue 'DupeQ' in vhost '/'\", classId=50,
methodId=10, cause="}

The above exception is encountered by both the QueueDeclarePassive method -
then the following  QueueDeclare.

Here's test code:

  try
                {
                    channel.QueueDeclarePassive("DupeQ");
                }
                catch (Exception ex)
                {
                    var errmsg = ex.Message;
                    dupeQExists = false;
                }

                if (dupeQExists)
                {
                    channel.QueueDelete("DupeQ");
                }

                try
                {
                    channel.QueueDeclare("DupeQ", false, false, false,
null);
                }
                catch (Exception ex)
                {
                    var errmsg = ex.Message;
                }


Since the QueueDeclare seems to issue the same message - I'm thinking that
possibly the passive bit is still set from the prior passive call.

S. Douglas Hunt | Software Engineer

Voice? (734) 461-1420 | Fax (305) 675-2448
CONIX Systems, Inc

Safeguarding Payments

This message is intended for the use of the individual or entity to which it
is addressed, and may contain information that constitutes a copyright,
patent, trade secret or confidential information of CONIX Systems, Inc., or
is otherwise privileged, confidential, or exempt from disclosure under
applicable law.? If the reader of this message is not the intended
recipient, you are hereby notified that the dissemination, distribution, or
copying of this communication is strictly prohibited.? If you have received
this communication in error, please notify us immediately by electronic mail
and delete the original message and destroy any hard copies made thereof.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, March 18, 2014 11:41 AM
To: Discussions about RabbitMQ; S. Doug Hunt
Subject: Re: [rabbitmq-discuss] RabbitMQ C# client

On 18/03/14 15:12, S. Doug Hunt wrote:
> We create a queue when a review operator first opens a unit of work.
> Other operators can open the same unit of work, but obviously we do 
> not want to add items to the queue from the database for subsequent
> operators.    So ? the first thing we do is use the
> QueueDeclarePassive(queuename) method in a try-catch.
>
> So ? for the first operator fails with the error that the queue was not
> found.   We then attempt to use the QueueDeclare method to create the
> queue, however it then fails with the same error.

Exactly the same error? What error message are you getting, precisely?

> I suspect that the QueueDeclarePassive method may have set the passive 
> bit ? and the client is not resetting it after failing so that the 
> subsequent call also is acting like a passive call.

The passive bit is not stored in the model object; it's a parameter of the
individual calls to QueueDeclare.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal


From simon at rabbitmq.com  Tue Mar 18 17:48:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Mar 2014 17:48:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <000401cf42d1$b1735f00$145a1d00$@conix.com>
References: <002801cf42bc$718d1530$54a73f90$@conix.com>
 <532868F6.4030104@rabbitmq.com> <000401cf42d1$b1735f00$145a1d00$@conix.com>
Message-ID: <532886E1.1000005@rabbitmq.com>

On 18/03/14 17:44, S. Doug Hunt wrote:
> The above exception is encountered by both the QueueDeclarePassive method -
> then the following  QueueDeclare.

In your code you are catching "Exception". I bet the QueueDeclare() is 
throwing an AlreadyClosedException - which has the same Reason as the 
original exception, but is really telling you that the channel has 
already closed so you can't do anything else with it (as Michael pointed 
out).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From justinbiddle at gmail.com  Tue Mar 18 17:31:49 2014
From: justinbiddle at gmail.com (Justin Biddle)
Date: Tue, 18 Mar 2014 10:31:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Heartbeat timeout
Message-ID: <6c1a5e57-74e9-417c-82e5-2baaa3028f71@googlegroups.com>



Hi,

 

I was wondering if there was anyone who could help with an error I get when 
running rabbit.

 

The error is as follows

 

{AMQP close-reason, initiated by Library, code=0, text="End of stream", 
classId=0, methodId=0, cause=System.IO.EndOfStreamException: Heartbeat 
missing with heartbeat == 600 seconds}

 

We are running the .net rabbit client and this error causes the 
HandleModelShutdown event to run.

 

As far as I can tell we?re running a pretty standard setup for the consumer.

 

The consumer extracts csv files from the database. In most cases this works 
fine however with large files that take a long time to extact this 
eventually happens. It usually occurs around 30 minutes although this 
varies even if extracting the same file each time.

 

I have tried adjusting the timeout and heartbeat settings but to no avail.

 

Any suggestions would be greatly appreciated.

 

Cheers

 

Justin Biddle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140318/804d0e05/attachment.html>

From mcintoshj at gmail.com  Wed Mar 19 04:05:35 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 18 Mar 2014 23:05:35 -0500
Subject: [rabbitmq-discuss] Heartbeat timeout
In-Reply-To: <6c1a5e57-74e9-417c-82e5-2baaa3028f71@googlegroups.com>
References: <6c1a5e57-74e9-417c-82e5-2baaa3028f71@googlegroups.com>
Message-ID: <CAD6m6fGA1mpu4+52ZpZTfi4Byq2WcX_JCd40eVXQ4DPgJ0tUTg@mail.gmail.com>

It sounds (if I understand your process right) like you're client is
shutting things down as it hasn't received a heartbeat response back from
the server.  Which at a guess could be something in the middle closing
things down.  This is just a wild guess - try changing your heartbeat to
like 30 seconds (I'm assuming the .net client supports this).  I'd also be
careful about thread blocking issues as well.  Just a few guesses - and
nothing else, there's always tcpdump and ethereal :)

Jason


On Tue, Mar 18, 2014 at 12:31 PM, Justin Biddle <justinbiddle at gmail.com>wrote:

> Hi,
>
>
>
> I was wondering if there was anyone who could help with an error I get
> when running rabbit.
>
>
>
> The error is as follows
>
>
>
> {AMQP close-reason, initiated by Library, code=0, text="End of stream",
> classId=0, methodId=0, cause=System.IO.EndOfStreamException: Heartbeat
> missing with heartbeat == 600 seconds}
>
>
>
> We are running the .net rabbit client and this error causes the
> HandleModelShutdown event to run.
>
>
>
> As far as I can tell we're running a pretty standard setup for the
> consumer.
>
>
>
> The consumer extracts csv files from the database. In most cases this
> works fine however with large files that take a long time to extact this
> eventually happens. It usually occurs around 30 minutes although this
> varies even if extracting the same file each time.
>
>
>
> I have tried adjusting the timeout and heartbeat settings but to no avail.
>
>
>
> Any suggestions would be greatly appreciated.
>
>
>
> Cheers
>
>
>
> Justin Biddle
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140318/8008d179/attachment.html>

From matthias at rabbitmq.com  Wed Mar 19 06:21:55 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 06:21:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 crashes - std_alloc: Cannot
 allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
Message-ID: <53293783.8050601@rabbitmq.com>

Oskar,

On 18/03/14 12:41, Oskar Liljeblad wrote:
> We are running a single node RabbitMQ 3.2.4 setup with an issue: Several
> times during the day, the RabbitMQ crashes.
>
> The crashes seem to occur during high load (e.g. when >=100000 messages
> are processed in a short period of time).
>
> The generated erl_crash.dump always has the same error:
>
> Slogan: std_alloc: Cannot allocate 1125562100111744 bytes of memory (of
> type "arg_reg").
>
> OS: Debian GNU/Linux wheezy/jessie, amd64
>
> Erlang: R16B03-1 (HIPE enabled)
>
> How can we troubleshoot this error?

You asked the same question back in September: 
http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-5-crash-Cannot-allocate-1124815738393216-bytes-of-memory-of-type-quot-arg-reg-quot-td29326.html

No new data has come to light since then to help us debug this.

Is there anything noteworthy in RabbitMQ's log files?


Regards,

Matthias.

From mklishin at gopivotal.com  Wed Mar 19 06:44:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 19 Mar 2014 10:44:50 +0400
Subject: [rabbitmq-discuss] Heartbeat timeout
In-Reply-To: <CAD6m6fGA1mpu4+52ZpZTfi4Byq2WcX_JCd40eVXQ4DPgJ0tUTg@mail.gmail.com>
References: <6c1a5e57-74e9-417c-82e5-2baaa3028f71@googlegroups.com>
 <CAD6m6fGA1mpu4+52ZpZTfi4Byq2WcX_JCd40eVXQ4DPgJ0tUTg@mail.gmail.com>
Message-ID: <27D60B83-0500-407F-A527-0BC3F6CCA71F@rabbitmq.com>


On 19 Mar 2014, at 08:05, Jason McIntosh <mcintoshj at gmail.com> wrote:

> I'd also be careful about thread blocking issues as well.  Just a few guesses - and nothing else, there's always tcpdump and ethereal :)

It?s at least not trivial to block network I/O thread in the .NET client, so this
scenario is unlikely.

MK

Software Engineer, Pivotal/RabbitMQ



From oskar at vergic.com  Wed Mar 19 07:13:58 2014
From: oskar at vergic.com (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 07:13:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 crashes - std_alloc: Cannot
 allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <53293783.8050601@rabbitmq.com>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
Message-ID: <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>

Hi!
That was in a different cluster, and we solved that problem by not mirroring some queues (!).
The new crashes occur on a standalone node. Just need to know how to enable debugging.
I'm not familiar with Erlang debugging in general, but if you'd tell me to run rabbitmq-server in gdb, recompile etc I'd probably know what to do.

Regards,
Oskar

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Wednesday, March 19, 2014 07:22
To: Discussions about RabbitMQ
Cc: Oskar Liljeblad
Subject: Re: [rabbitmq-discuss] RabbitMQ 3.2.4 crashes - std_alloc: Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")

Oskar,

On 18/03/14 12:41, Oskar Liljeblad wrote:
> We are running a single node RabbitMQ 3.2.4 setup with an issue: Several
> times during the day, the RabbitMQ crashes.
>
> The crashes seem to occur during high load (e.g. when >=100000 messages
> are processed in a short period of time).
>
> The generated erl_crash.dump always has the same error:
>
> Slogan: std_alloc: Cannot allocate 1125562100111744 bytes of memory (of
> type "arg_reg").
>
> OS: Debian GNU/Linux wheezy/jessie, amd64
>
> Erlang: R16B03-1 (HIPE enabled)
>
> How can we troubleshoot this error?

You asked the same question back in September: 
http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-1-5-crash-Cannot-allocate-1124815738393216-bytes-of-memory-of-type-quot-arg-reg-quot-td29326.html

No new data has come to light since then to help us debug this.

Is there anything noteworthy in RabbitMQ's log files?


Regards,

Matthias.

From mklishin at gopivotal.com  Wed Mar 19 07:21:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 19 Mar 2014 11:21:45 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.1.5 is released
Message-ID: <85134D19-A128-4CBE-BAF2-BFAB561B6729@rabbitmq.com>

Bunny [1] is a Ruby RabbitMQ client that focuses on ease of use.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/03/19/bunny-1-dot-1-5-is-released/

1. http://rubybunny.info

MK

Software Engineer, Pivotal/RabbitMQ



From matthias at rabbitmq.com  Wed Mar 19 07:22:42 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 07:22:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4 crashes - std_alloc: Cannot
 allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
Message-ID: <532945C2.4010404@rabbitmq.com>

Oskar,

On 19/03/14 07:13, Oskar Liljeblad wrote:
> Hi! That was in a different cluster, and we solved that problem by
> not mirroring some queues (!). The new crashes occur on a standalone
> node. Just need to know how to enable debugging. I'm not familiar
> with Erlang debugging in general, but if you'd tell me to run
> rabbitmq-server in gdb, recompile etc I'd probably know what to do.

The error likely occurs *while* rabbit is trying to write some debug 
information. In other words, something went wrong, rabbit tries to write 
debug info, and it's the writing of the debug info that then produces 
the error you are seeing.

So there are two problems here: 1) the one that caused the debug 
information to be written, 2) the one that causes the writing of the 
debug information to produce an error.

You didn't answer my question whether there was anything noteworthy in 
the logs. I am hoping that might help identify (1).

Matthias

From oskar at osk.mine.nu  Wed Mar 19 08:08:51 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 09:08:51 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
Message-ID: <20140319080851.GA5145@osk.mine.nu>

> On 19/03/14 07:13, Oskar Liljeblad wrote:
> > Hi! That was in a different cluster, and we solved that problem by
> > not mirroring some queues (!). The new crashes occur on a standalone
> > node. Just need to know how to enable debugging. I'm not familiar
> > with Erlang debugging in general, but if you'd tell me to run
> > rabbitmq-server in gdb, recompile etc I'd probably know what to do.
> 
> The error likely occurs *while* rabbit is trying to write some debug 
> information. In other words, something went wrong, rabbit tries to write 
> debug info, and it's the writing of the debug info that then produces 
> the error you are seeing.
> 
> So there are two problems here: 1) the one that caused the debug 
> information to be written, 2) the one that causes the writing of the 
> debug information to produce an error.
> 
> You didn't answer my question whether there was anything noteworthy in 
> the logs. I am hoping that might help identify (1).

I have parsed and checked the logs, and there is no interesting message
prior to crash. The only messages I see are 'accepting AMQP connection'
and 'closing AMQP connection' messages prior to the crashes.

Regards,

Oskar

From oskar at osk.mine.nu  Wed Mar 19 08:28:27 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 09:28:27 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319080851.GA5145@osk.mine.nu>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
Message-ID: <20140319082827.GA7803@osk.mine.nu>

On Wednesday, March 19, 2014 at 09:51, Oskar Liljeblad wrote:
> > The error likely occurs *while* rabbit is trying to write some debug 
> > information. In other words, something went wrong, rabbit tries to write 
> > debug info, and it's the writing of the debug info that then produces 
> > the error you are seeing.
> > 
> > So there are two problems here: 1) the one that caused the debug 
> > information to be written, 2) the one that causes the writing of the 
> > debug information to produce an error.
> > 
> > You didn't answer my question whether there was anything noteworthy in 
> > the logs. I am hoping that might help identify (1).
> 
> I have parsed and checked the logs, and there is no interesting message
> prior to crash. The only messages I see are 'accepting AMQP connection'
> and 'closing AMQP connection' messages prior to the crashes.

Btw, I found a number of errors like the following one in rabbit@*-sasl.log:

=SUPERVISOR REPORT==== 18-Mar-2014::21:08:44 ===
     Supervisor: {<0.21116.20>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{nb_children,1},
                  {name,channel_sup},
                  {mfargs,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

Not sure if they are important or not.

Regards,

Oskar

From matthias at rabbitmq.com  Wed Mar 19 08:35:44 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 08:35:44 +0000
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319082827.GA7803@osk.mine.nu>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu> <20140319082827.GA7803@osk.mine.nu>
Message-ID: <532956E0.7060909@rabbitmq.com>

On 19/03/14 08:28, Oskar Liljeblad wrote:
> Btw, I found a number of errors like the following one in rabbit@*-sasl.log:
>
> =SUPERVISOR REPORT==== 18-Mar-2014::21:08:44 ===
>       Supervisor: {<0.21116.20>,
>                                             rabbit_channel_sup_sup}
>       Context:    shutdown_error
>       Reason:     shutdown
>       Offender:   [{nb_children,1},
>                    {name,channel_sup},
>                    {mfargs,{rabbit_channel_sup,start_link,[]}},
>                    {restart_type,temporary},
>                    {shutdown,infinity},
>                    {child_type,supervisor}]
>
> Not sure if they are important or not.

Those are harmless. Are there any other errors in the SASL log?

Matthias.


From oskar at osk.mine.nu  Wed Mar 19 08:40:19 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 09:40:19 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <532956E0.7060909@rabbitmq.com>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
 <20140319082827.GA7803@osk.mine.nu> <532956E0.7060909@rabbitmq.com>
Message-ID: <20140319084019.GA8390@osk.mine.nu>

On Wednesday, March 19, 2014 at 08:44, Matthias Radestock wrote:
> >=SUPERVISOR REPORT==== 18-Mar-2014::21:08:44 ===
> >      Supervisor: {<0.21116.20>,
> >                                            rabbit_channel_sup_sup}
> >      Context:    shutdown_error
> >      Reason:     shutdown
> >      Offender:   [{nb_children,1},
> >                   {name,channel_sup},
> >                   {mfargs,{rabbit_channel_sup,start_link,[]}},
> >                   {restart_type,temporary},
> >                   {shutdown,infinity},
> >                   {child_type,supervisor}]
> >
> >Not sure if they are important or not.
> 
> Those are harmless. Are there any other errors in the SASL log?

No, that's the only type of message there is in the SASL log.

Regards,

Oskar

From aiguo.gu at tekcomms.com  Wed Mar 19 07:30:44 2014
From: aiguo.gu at tekcomms.com (Gu,Aiguo)
Date: Wed, 19 Mar 2014 00:30:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Hello, Security Query
In-Reply-To: <969FE5C5-0A75-434E-BE08-A764F25731D9@rabbitmq.com>
References: <91F9C6FA5F7F5343B0F41D638C4EBD36404005D2@US-BV-EXM01-P.global.tektronix.net>
 <969FE5C5-0A75-434E-BE08-A764F25731D9@rabbitmq.com>
Message-ID: <1395214244143-34191.post@n5.nabble.com>

Can RabbitMQ service be installed with "normal" account (e.g. local user
account or domain account) and work as usual with such account? 
In our production environment LocalSystem is not allowed to run service as
it's too highly-privileged, therefore we have to run the service with
ordinary account. Is it possible to run RabbitMQ service this way?




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Hello-Security-Query-tp34148p34191.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Mar 19 10:00:15 2014
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Mar 2014 10:00:15 +0000
Subject: [rabbitmq-discuss] Hello, Security Query
In-Reply-To: <1395214244143-34191.post@n5.nabble.com>
References: <91F9C6FA5F7F5343B0F41D638C4EBD36404005D2@US-BV-EXM01-P.global.tektronix.net>
 <969FE5C5-0A75-434E-BE08-A764F25731D9@rabbitmq.com>
 <1395214244143-34191.post@n5.nabble.com>
Message-ID: <5D88E15D-5504-4961-8767-132B4D4CAEA8@rabbitmq.com>

I don't really know about running services as a "normal" user account, but since we run via the erlsrv program, which is itself a windows service, you should be able to change the "Run As" using the services applet. I can't remember if there are limitations to that, since I've not used it for quite a while. Since a degree of privilege is required to run an application that communicates with the outside world, you might wish to consider using Windows' built in "Network Services" account, if your policy permits.

Cheers,
Tim

On 19 Mar 2014, at 07:30, Gu,Aiguo wrote:

> Can RabbitMQ service be installed with "normal" account (e.g. local user
> account or domain account) and work as usual with such account? 
> In our production environment LocalSystem is not allowed to run service as
> it's too highly-privileged, therefore we have to run the service with
> ordinary account. Is it possible to run RabbitMQ service this way?
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Hello-Security-Query-tp34148p34191.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From oskar at osk.mine.nu  Wed Mar 19 10:04:49 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 11:04:49 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319084019.GA8390@osk.mine.nu>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
 <20140319082827.GA7803@osk.mine.nu> <532956E0.7060909@rabbitmq.com>
 <20140319084019.GA8390@osk.mine.nu>
Message-ID: <20140319100449.GA13276@osk.mine.nu>

On Wednesday, March 19, 2014 at 09:19, Oskar Liljeblad wrote:
> > >=SUPERVISOR REPORT==== 18-Mar-2014::21:08:44 ===
> > >      Supervisor: {<0.21116.20>,
> > >                                            rabbit_channel_sup_sup}
> > >      Context:    shutdown_error
> > >      Reason:     shutdown
> > >      Offender:   [{nb_children,1},
> > >                   {name,channel_sup},
> > >                   {mfargs,{rabbit_channel_sup,start_link,[]}},
> > >                   {restart_type,temporary},
> > >                   {shutdown,infinity},
> > >                   {child_type,supervisor}]
> > >
> > >Not sure if they are important or not.
> > 
> > Those are harmless. Are there any other errors in the SASL log?
> 
> No, that's the only type of message there is in the SASL log.

By the way, I followed up on the previous conversation.
I have now done the following:

Added  ulimit -c unlimited  to the rabbitmq-server init.d script.
Added  SERVER_START_ARGS="-kernel error_logger silent +d"  to
/etc/rabbitmq/rabbitmq-env.conf.

I hope that is all that is needed to get an erlang core dump.
I will let you know what happens during the next crash!

Regards,

Oskar

From matthias at rabbitmq.com  Wed Mar 19 10:08:06 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 10:08:06 +0000
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319100449.GA13276@osk.mine.nu>
References: <9dd70c63d6f84446bf12955f4dc701aa@AM3PR06MB337.eurprd06.prod.outlook.com>
 <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu> <20140319082827.GA7803@osk.mine.nu>
 <532956E0.7060909@rabbitmq.com> <20140319084019.GA8390@osk.mine.nu>
 <20140319100449.GA13276@osk.mine.nu>
Message-ID: <53296C86.5090809@rabbitmq.com>

On 19/03/14 10:04, Oskar Liljeblad wrote:
> By the way, I followed up on the previous conversation.
> I have now done the following:
>
> Added  ulimit -c unlimited  to the rabbitmq-server init.d script.
> Added  SERVER_START_ARGS="-kernel error_logger silent +d"  to
> /etc/rabbitmq/rabbitmq-env.conf.
>
> I hope that is all that is needed to get an erlang core dump.
> I will let you know what happens during the next crash!

That won't get you a core dump. It will simply prevent the error from 
being logged.

Getting a core dump out of erlang would unlikely prove useful.

Matthias.


From oskar at osk.mine.nu  Wed Mar 19 10:11:15 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 11:11:15 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <53296C86.5090809@rabbitmq.com>
References: <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
 <20140319082827.GA7803@osk.mine.nu> <532956E0.7060909@rabbitmq.com>
 <20140319084019.GA8390@osk.mine.nu>
 <20140319100449.GA13276@osk.mine.nu>
 <53296C86.5090809@rabbitmq.com>
Message-ID: <20140319101115.GA13674@osk.mine.nu>

On Wednesday, March 19, 2014 at 10:06, Matthias Radestock wrote:
> >By the way, I followed up on the previous conversation.
> >I have now done the following:
> >
> >Added  ulimit -c unlimited  to the rabbitmq-server init.d script.
> >Added  SERVER_START_ARGS="-kernel error_logger silent +d"  to
> >/etc/rabbitmq/rabbitmq-env.conf.
> >
> >I hope that is all that is needed to get an erlang core dump.
> >I will let you know what happens during the next crash!
> 
> That won't get you a core dump. It will simply prevent the error from being
> logged.
> 
> Getting a core dump out of erlang would unlikely prove useful.

The changes above was what Emile suggested some time ago (for the other
cluster crashes).

Isn't it the Erlang runtime that crashes?

How do you suggest to troubleshoot this error?

Regards,

Oskar

From oskar at osk.mine.nu  Wed Mar 19 10:23:24 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Wed, 19 Mar 2014 11:23:24 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319101115.GA13674@osk.mine.nu>
References: <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
 <20140319082827.GA7803@osk.mine.nu> <532956E0.7060909@rabbitmq.com>
 <20140319084019.GA8390@osk.mine.nu>
 <20140319100449.GA13276@osk.mine.nu>
 <53296C86.5090809@rabbitmq.com>
 <20140319101115.GA13674@osk.mine.nu>
Message-ID: <20140319102324.GA14451@osk.mine.nu>

On Wednesday, March 19, 2014 at 11:15, Oskar Liljeblad wrote:
> > >By the way, I followed up on the previous conversation.
> > >I have now done the following:
> > >
> > >Added  ulimit -c unlimited  to the rabbitmq-server init.d script.
> > >Added  SERVER_START_ARGS="-kernel error_logger silent +d"  to
> > >/etc/rabbitmq/rabbitmq-env.conf.
> > >
> > >I hope that is all that is needed to get an erlang core dump.
> > >I will let you know what happens during the next crash!
> > 
> > That won't get you a core dump. It will simply prevent the error from being
> > logged.
> > 
> > Getting a core dump out of erlang would unlikely prove useful.
> 
> The changes above was what Emile suggested some time ago (for the other
> cluster crashes).
> 
> Isn't it the Erlang runtime that crashes?
> 
> How do you suggest to troubleshoot this error?

By the way (#2), I'm seeing this logged during crashes:

kernel: [27189492.819522] beam[3863] general protection ip:483f27 sp:7fffd0af52a0 error:0 in beam[400000+1c8000]

Regards,

Oskar

From matthias at rabbitmq.com  Wed Mar 19 10:43:15 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 10:43:15 +0000
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <20140319101115.GA13674@osk.mine.nu>
References: <53293783.8050601@rabbitmq.com>
 <e6ed20b188484c03af4cf3d930659ce5@AM3PR06MB337.eurprd06.prod.outlook.com>
 <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu> <20140319082827.GA7803@osk.mine.nu>
 <532956E0.7060909@rabbitmq.com> <20140319084019.GA8390@osk.mine.nu>
 <20140319100449.GA13276@osk.mine.nu> <53296C86.5090809@rabbitmq.com>
 <20140319101115.GA13674@osk.mine.nu>
Message-ID: <532974C3.3050709@rabbitmq.com>

On 19/03/14 10:11, Oskar Liljeblad wrote:
> The changes above was what Emile suggested some time ago (for the other
> cluster crashes).

Yes, but, as I said, the changes will prevent the logging of the error, 
which in turn prevents the crash. So it will fix your problem, but 
leaves us none the wiser as to the error itself.

To repeat myself... there are two problems here: 1) some error occurs in 
rabbit, 2) the logging of the error causes a crash. By disabling logging 
we prevent the crash in (2) but at the expense of not being able to see 
the causing error (i.e. (1)) at all.

> Isn't it the Erlang runtime that crashes?

yes, but the error is likely caused by Erlang library code, not the 
runtime itself.

> How do you suggest to troubleshoot this error?

I've filed a bug to try to prevent the crash while still logging 
something. That might allow us to identify (1) but will be of no use to 
track down (2), and w/o this being easily reproducible the Erlang/OTP 
folks are unlikely to take an interest.

Matthias.

From spicoflorin at gmail.com  Wed Mar 19 12:46:43 2014
From: spicoflorin at gmail.com (Spico Florin)
Date: Wed, 19 Mar 2014 14:46:43 +0200
Subject: [rabbitmq-discuss] RabbitMQ Web-Stomp Plugin securing the
	connection to the message broke
Message-ID: <CAOy42Cvsnka_BOMffNmVpKTuVwO8sz==6KzVmLDDN-ajL-rPtw@mail.gmail.com>

Hello!
In the page describing RabbitMQ Web-Stomp Plugin (
http://www.rabbitmq.com/web-stomp.html), I found the following code to
connect to the RabbitMQ via Web-Stomp Plugin:

    var on_connect = function() {
        console.log('connected');
    };
    var on_error =  function() {
        console.log('error');
    };
    client.connect('guest', 'guest', on_connect, on_error, '/');

I would like to use this approach in an an application that will be
installed on production mode.
Unfortunately, the code:


 client.connect('guest', 'guest', on_connect, on_error, '/');

is node acceptable for the security point of view. Therefore, can you
please provide me
the right solution on how to handle the connection in a secured way (i.e.
by not providing plain credentials in the
in JS or html).
I look forward for your answers.
Thank you.
 Regards,
  Florin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/647719f4/attachment.html>

From steve.flitcroft at ivendi.com  Wed Mar 19 11:04:48 2014
From: steve.flitcroft at ivendi.com (Steve Flitcroft)
Date: Wed, 19 Mar 2014 04:04:48 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq webstomp ha-mode
Message-ID: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>

Having trouble getting the queues that are created via sockjs & webstomp 
being replicated across nodes.

I have a policy set for any queues that start with amq to be replicated.

You can see this here

http://gyazo.com/b0e3fbac0d1a1d0baabc25c5f43499f0

the amq.gen queue created by webstomp does not replicate to the other node, 
the queue I created called amqsteve does.

The policy is

http://gyazo.com/2ab0f414a83a529e3142d30988d003fe

The result of this is that any non websocket browsers have to be routed to 
exactly the same node otherwise they get a 404 on the xhr_send method and 
lose connection. I can fix this by routing all non socket browsers to one 
node but this defeats the point of a cluster and load balancing. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/e7e29c50/attachment.html>

From steve.flitcroft at ivendi.com  Wed Mar 19 12:29:00 2014
From: steve.flitcroft at ivendi.com (Steve Flitcroft)
Date: Wed, 19 Mar 2014 05:29:00 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq webstomp ha-mode
In-Reply-To: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
References: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
Message-ID: <0ee9078f-c7c2-4bbb-be3b-2b14d0d34d3a@googlegroups.com>

I believe this is because webstomp creates exclusive queues which do not 
get replicated regardless of policy. The issue is this means any non socket 
client has to poll the exact node where their queue is located.

On Wednesday, 19 March 2014 11:04:48 UTC, Steve Flitcroft wrote:
>
> Having trouble getting the queues that are created via sockjs & webstomp 
> being replicated across nodes.
>
> I have a policy set for any queues that start with amq to be replicated.
>
> You can see this here
>
> http://gyazo.com/b0e3fbac0d1a1d0baabc25c5f43499f0
>
> the amq.gen queue created by webstomp does not replicate to the other 
> node, the queue I created called amqsteve does.
>
> The policy is
>
> http://gyazo.com/2ab0f414a83a529e3142d30988d003fe
>
> The result of this is that any non websocket browsers have to be routed to 
> exactly the same node otherwise they get a 404 on the xhr_send method and 
> lose connection. I can fix this by routing all non socket browsers to one 
> node but this defeats the point of a cluster and load balancing. 
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/86f02152/attachment.html>

From simon at rabbitmq.com  Wed Mar 19 13:14:51 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Mar 2014 13:14:51 +0000
Subject: [rabbitmq-discuss] rabbitmq webstomp ha-mode
In-Reply-To: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
References: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
Message-ID: <5329984B.9040608@rabbitmq.com>

On 19/03/14 11:04, Steve Flitcroft wrote:
> Having trouble getting the queues that are created via sockjs & webstomp
> being replicated across nodes.
>
> I have a policy set for any queues that start with amq to be replicated.
>
> You can see this here
>
> http://gyazo.com/b0e3fbac0d1a1d0baabc25c5f43499f0
>
> the amq.gen queue created by webstomp does not replicate to the other
> node, the queue I created called amqsteve does.

The amq.gen queue is declared as exclusive. From 
http://www.rabbitmq.com/ha.html:

   Exclusive queues will be deleted when the connection that declared
   them is closed. For this reason, it is not useful for an exclusive
   queue to be mirrored (or durable for that matter) since when the node
   hosting it goes down, the connection will close and the queue will
   need to be deleted anyway.

   For this reason, exclusive queues are never mirrored (even if they
   match a policy stating that they should be). They are also never
   durable (even if declared as such).

> The result of this is that any non websocket browsers have to be routed
> to exactly the same node otherwise they get a 404 on the xhr_send method
> and lose connection.

Uh, that's not the case; you can connect to any node to publish to a 
non-mirrored queue, it just gets routed inside the cluster.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From reineke at apt-solutions.de  Wed Mar 19 13:53:02 2014
From: reineke at apt-solutions.de (Tom Reineke)
Date: Wed, 19 Mar 2014 13:53:02 +0000
Subject: [rabbitmq-discuss] rabbitMQ in cloudbees
Message-ID: <3362CF7800DADA45BA467DBEB733CD89665CED69@MX01.owis.de>

Hi,

I'm using the rabbitMQ-integration in cloudbees and I have a very specific question concerning the use of rabbitMQ from many tomcat instances (when only one instance, I don't have these issues). 
I'm getting the following stacktrace:

[http-8929-5] ERROR de.MailUtil - An error occured while trying to queue an email: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue 'foo' in vhost 'bar' refused for user 'bar', class-id=50, method-id=10), null, ""} 
at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67) 
at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33) 
at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343) 
at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216) 
at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118) 
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:768) 
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:61) 
... 
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue 'foo' in vhost 'bar' refused for user 'bar', class-id=50, method-id=10), null, ""} 
at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:474) 
at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:315) 
at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144) 
at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91) 
at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:551)

This seems to have something to do with ACL violation (https://jira.spring.io/browse/AMQP-66)

The relevant code for this error (the rest of the code is all as described in http://www.rabbitmq.com/tutorials/tutorial-two-java.html) is like this:

connection is declared as a static variable and then:

consumerChannel = connection.createChannel(); 
consumerChannel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null); 
...

prodChannel = connection.createChannel(); 
prodChannel.queueDeclare(MAIL_QUEUE_NAME, true, false, false, null);

This last line causes the error. 
Can you help me there?

Best regards
Tom

From mklishin at gopivotal.com  Wed Mar 19 14:06:42 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 19 Mar 2014 18:06:42 +0400
Subject: [rabbitmq-discuss] rabbitMQ in cloudbees
In-Reply-To: <3362CF7800DADA45BA467DBEB733CD89665CED69@MX01.owis.de>
References: <3362CF7800DADA45BA467DBEB733CD89665CED69@MX01.owis.de>
Message-ID: <BD53B268-F403-4D6D-BA79-EC2A39C24F9D@rabbitmq.com>


On 19 Mar 2014, at 17:53, Tom Reineke <reineke at apt-solutions.de> wrote:

> [http-8929-5] ERROR de.MailUtil - An error occured while trying to queue an email: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue 'foo' in vhost 'bar' refused for user 'bar', class-id=50, method-id=10), null, ""} 

The user has no permissions for vhost ?bar? or it does not cover queue ?foo?.

See http://www.rabbitmq.com/access-control.html

MK

Software Engineer, Pivotal/RabbitMQ



From reineke at apt-solutions.de  Wed Mar 19 14:20:47 2014
From: reineke at apt-solutions.de (Tom Reineke)
Date: Wed, 19 Mar 2014 14:20:47 +0000
Subject: [rabbitmq-discuss] rabbitMQ in cloudbees
In-Reply-To: <BD53B268-F403-4D6D-BA79-EC2A39C24F9D@rabbitmq.com>
References: <3362CF7800DADA45BA467DBEB733CD89665CED69@MX01.owis.de>
 <BD53B268-F403-4D6D-BA79-EC2A39C24F9D@rabbitmq.com>
Message-ID: <3362CF7800DADA45BA467DBEB733CD89665CEDAC@MX01.owis.de>

Thanks for the quick response. I've read through this article before but see how this really helps me. I must add that up to this point I didn't have much user configuration to do, except providing the connection URL containing user and password for the rabbitMQ server. I don't seem to have much configuration options on https://api.cloudamqp.com/sso/cloudbees/console either. Could you provide further help please?

Regards
Tom

-----Urspr?ngliche Nachricht-----
Von: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von Michael Klishin
Gesendet: Mittwoch, 19. M?rz 2014 15:07
An: Discussions about RabbitMQ
Betreff: Re: [rabbitmq-discuss] rabbitMQ in cloudbees


On 19 Mar 2014, at 17:53, Tom Reineke <reineke at apt-solutions.de> wrote:

> [http-8929-5] ERROR de.MailUtil - An error occured while trying to queue an email: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue 'foo' in vhost 'bar' refused for user 'bar', class-id=50, method-id=10), null, ""} 

The user has no permissions for vhost 'bar' or it does not cover queue 'foo'.

See http://www.rabbitmq.com/access-control.html

MK

Software Engineer, Pivotal/RabbitMQ


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mklishin at gopivotal.com  Wed Mar 19 14:23:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 19 Mar 2014 18:23:09 +0400
Subject: [rabbitmq-discuss] rabbitMQ in cloudbees
In-Reply-To: <3362CF7800DADA45BA467DBEB733CD89665CEDAC@MX01.owis.de>
References: <3362CF7800DADA45BA467DBEB733CD89665CED69@MX01.owis.de>
 <BD53B268-F403-4D6D-BA79-EC2A39C24F9D@rabbitmq.com>
 <3362CF7800DADA45BA467DBEB733CD89665CEDAC@MX01.owis.de>
Message-ID: <0EF791A2-0066-4CD2-A722-87EE4B7BEB27@rabbitmq.com>


On 19 Mar 2014, at 18:20, Tom Reineke <reineke at apt-solutions.de> wrote:

> Thanks for the quick response. I've read through this article before but see how this really helps me. I must add that up to this point I didn't have much user configuration to do, except providing the connection URL containing user and password for the rabbitMQ server. I don't seem to have much configuration options on https://api.cloudamqp.com/sso/cloudbees/console either. Could you provide further help please?

You have likely misspelt vhost or user name. Contact CloudAMQP support if that?s not the case.

MK

Software Engineer, Pivotal/RabbitMQ



From rdgsdavid at gmail.com  Wed Mar 19 14:58:30 2014
From: rdgsdavid at gmail.com (David Rodrigues)
Date: Wed, 19 Mar 2014 15:58:30 +0100
Subject: [rabbitmq-discuss] Problems with the
 {cluster_partition_handling, pause_minority} option
In-Reply-To: <532817D3.2080901@rabbitmq.com>
References: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>
 <532817D3.2080901@rabbitmq.com>
Message-ID: <CAL1hc3U96A5-zFGJte-idg2r9tooZHVvJsCC2VfMDK4EUdsM4g@mail.gmail.com>

Hi,

Great ! Thank you Simon.

David


On Tue, Mar 18, 2014 at 10:54 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Hi. Just to let you know that this has not been forgotten about. I have
> reproduced the problem you describe and am investigating it. The key factor
> seems to be (at a TCP level) that A realises it is disconnected from B but
> not vice versa. Therefore (at an Erlang level) the partition is not
> detected.
>
> It's not specifically to do with pause_minority mode.
>
> I'll post more information when I have it.
>
> Cheers, Simon
>
>
> On 05/03/2014 17:18, David Rodrigues wrote:
>
>> Dear RabbitMQ Community,
>>
>> I'm having some problems with the {cluster_partition_handling,
>> pause_minority} option and I would like to share with you my doubts.
>>
>> First, the architecture. I'm running RabbitMQ 3.2.4 (Erlang R14A) on 3
>> nodes (rabbitmq at rabbitmq-test01, rabbitmq at rabbitmq-test02 and
>> rabbitmq at rabbitmq-test03) on a virtualized platform - quite similar to
>> EC2.  And because of that I have, from time to time, connectivity issues
>> - I know, that's bad ;)
>>
>> Digging into the doc I have found that the best way to handle the
>> problem is using the pause_minority option -
>> https://www.rabbitmq.com/partitions.html.
>>
>> But from time to time my nodes get disconnected from each other and do
>> not recover automatically. Hopefully I have managed to reproduce the
>> problem. Here are the steps.
>>
>> THE CONFIGURATION FILE
>> ***********************************************************
>>
>> My configuration file is quite simple:
>>
>> %% -*- mode: erlang -*-
>> [
>>   {rabbit,
>>    [
>>     {auth_mechanisms, ['PLAIN', 'AMQPLAIN']},
>>     {default_vhost,       <<"/">>},
>>     {default_user,        <<"admin">>},
>>     {default_pass,        <<"admin">>},
>>     {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
>>     {default_user_tags, [administrator]},
>>     {cluster_partition_handling, pause_minority},
>>     {cluster_nodes, {['rabbitmq at rabbitmq-test01',
>> 'rabbitmq at rabbitmq-test02', 'rabbitmq at rabbitmq-test03'], disc}}
>>    ]},
>>   {kernel, []},
>>   {rabbitmq_management, []},
>>   {rabbitmq_management_agent, []},
>>   {rabbitmq_shovel,
>>    [{shovels, []}
>>    ]},
>>   {rabbitmq_stomp, []},
>>   {rabbitmq_mqtt, []},
>>   {rabbitmq_amqp1_0, []},
>>   {rabbitmq_auth_backend_ldap, []}
>> ].
>>
>> Has you can see, the {cluster_partition_handling, pause_minority} option
>> is there.
>>
>> PAUSE_MINORITY WORKING
>> ***********************************************************
>>
>> When the network outage is long enough, the option works perfectly.
>>
>> To simulate a connection problem on rabbitmq-test03 I run:
>>
>> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test01 -j DROP
>> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test02 -j DROP
>>
>> Then wait long enough for the following messages to appear in the logs
>> of rabbitmq-test03 (approximately 180 seconds):
>>
>> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
>> ** Node 'rabbitmq at rabbitmq-test02' not responding **
>> ** Removing (timedout) connection **
>> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
>> ** Node 'rabbitmq at rabbitmq-test01' not responding **
>> ** Removing (timedout) connection **
>> =INFO REPORT==== 5-Mar-2014::16:51:02 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' down
>> =WARNING REPORT==== 5-Mar-2014::16:51:30 ===
>> Cluster minority status detected - awaiting recovery
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' down
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> Stopping RabbitMQ
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> stopped TCP Listener on [::]:5672
>> =WARNING REPORT==== 5-Mar-2014::16:51:58 ===
>> Cluster minority status detected - awaiting recovery
>>
>> When flushing the rules (iptables -F) the connectivity is reestablished
>> and the cluster works perfectly.
>>
>> In the logs:
>>
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> started TCP Listener on [::]:5672
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' up
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' up
>>
>> Finally the cluster status :
>>
>> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
>> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                  'rabbitmq at rabbitmq-test03']}]},
>>   {running_nodes,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                   'rabbitmq at rabbitmq-test03']},
>>   {partitions,[]}]
>> ...done.
>>
>> So far, so good. The option works flawlessly.
>>
>> PAUSE_MINORITY NOT WORKING
>> ***********************************************************
>>
>> Life is not so bright when the network partition is not long enough.
>>
>> On rabbitmq-test03 I will run my iptables commands again:
>>
>> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test01 -j DROP
>> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test02 -j DROP
>>
>> However this time I'll only wait 60 seconds before flushing my rules
>> with iptables -F.
>>
>> And that's the result in rabbitmq-test03 logs:
>>
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' down
>> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
>> Mnesia('rabbitmq at rabbitmq-test03'): ** ERROR ** mnesia_event got
>> {inconsistent_database, running_partitioned_network,
>> 'rabbitmq at rabbitmq-test02'}
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' down
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> Statistics database started.
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> Statistics database started.
>>
>> Again, the result is quiet ugly on rabbitmq-test01:
>>
>> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
>> ** Node 'rabbitmq at rabbitmq-test03' not responding **
>> ** Removing (timedout) connection **
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test03' down
>> =INFO REPORT==== 5-Mar-2014::16:55:01 ===
>> global: Name conflict terminating {rabbit_mgmt_db,<2669.1582.0>}
>>
>> Finally my cluster status:
>>
>> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
>> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                  'rabbitmq at rabbitmq-test03']}]},
>>   {running_nodes,['rabbitmq at rabbitmq-test03']},
>>   {partitions,[{'rabbitmq at rabbitmq-test03',['rabbitmq@
>> rabbitmq-test02']}]}]
>> ...done.
>>
>> That's it. Even with the pause_minority option my cluster was
>> disintegrated.
>>
>> SYNOPSIS
>> ***********************************************************
>>
>> In short, if the network outage is long enough everything goes according
>> to the plan and the cluster works perfectly once the connectivity is
>> reestablished. However if the network outage has a intermediate duration
>> (not too short, not too long) the pause_minority option seems not to work.
>>
>> Are you aware of this problem? Is there any solution to cope with this
>> particular situation?
>>
>> Thanks,
>> David
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/01cfb970/attachment.html>

From cwstorm at gmail.com  Wed Mar 19 15:03:26 2014
From: cwstorm at gmail.com (cw storm)
Date: Wed, 19 Mar 2014 11:03:26 -0400
Subject: [rabbitmq-discuss] AMQP closed connection error
Message-ID: <CAETr1H-sdtX07EUsPxVt6B+nrHZhRpWEAO752OyGZC7jdQCcTw@mail.gmail.com>

We got the below error as of yesterday.  Not sure what to make of it.  Have
anyone seen this before and what could be done to prevent this from
happening in the future?  When this occur, our consumer service register to
the queue were lost.  We would like to enhance our process if possible to
avoid the below.  Again, this doesn't happen very often (knock on wood).

=ERROR REPORT==== 18-Mar-2014::06:12:44 ===

closing AMQP connection <0.11800.5> (172.31.234.15:49490 ->
172.31.234.100:5672):

{handshake_timeout,frame_header}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/445524c4/attachment.html>

From matthias at rabbitmq.com  Wed Mar 19 15:18:21 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Mar 2014 15:18:21 +0000
Subject: [rabbitmq-discuss] AMQP closed connection error
In-Reply-To: <CAETr1H-sdtX07EUsPxVt6B+nrHZhRpWEAO752OyGZC7jdQCcTw@mail.gmail.com>
References: <CAETr1H-sdtX07EUsPxVt6B+nrHZhRpWEAO752OyGZC7jdQCcTw@mail.gmail.com>
Message-ID: <5329B53D.20403@rabbitmq.com>

On 19/03/14 15:03, cw storm wrote:
> {handshake_timeout,frame_header}
 >
 > [...]
 >
> Have anyone seen this before?

http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=search_page&node=2&query=handshake_timeout+frame_header&days=0


From ron.cordell at gmail.com  Wed Mar 19 16:27:59 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Wed, 19 Mar 2014 09:27:59 -0700
Subject: [rabbitmq-discuss] Rabbit slowing down on accepting messages
Message-ID: <CAFtA53xLxNQtC3mVO79+pCLoq7bk1QJhtU=C4+B_vcDfg88CUw@mail.gmail.com>

Hi,

During our performance testing yesterday we saw some interesting behavior.
The setup is:

RabbitMQ x 3 nodes, clustered, behind a load balancer, running on Linux,
Erlang 16B03, Rabbit 3.2.3. RabbitMQ nodes running on VMWare ESX 4.5

What we observed was a run in the morning publishing and consuming a
sustained rate of 140K messages/hour across 150 mirrored queues (good).
The application was shut down, all connections to Rabbit were observed to
drop to 0.
An hour or two passes while the team does other things.
The application was brought back up, connections re-established, and
another test run kicked off.
This time the max sustained rate is about 65K messages/hour (bad). The
reason was narrowed down to Rabbit not accepting published messages any
faster than that.
Disk I/O was checked - we're on a very fast SAN and there was no issue.
Load balancer was checked, it's not preventing the issue.
Finally, the RabbitMQ nodes were stopped and restarted and another test run
was made, and suddenly we are back up to 140K messages/hour.
The logs show no memory alarms or flow control messages - in fact the logs
are "clean".

Any suggestions on places to look to see what the underlying issue might be?

In real life I don't expect to start and stop applications, so this may or
may not be a concern, but we are very curious about the observed behavior.

Cheers,

Ron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/c53afac5/attachment.html>

From simon at rabbitmq.com  Wed Mar 19 17:24:42 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Mar 2014 17:24:42 +0000
Subject: [rabbitmq-discuss] Rabbit slowing down on accepting messages
In-Reply-To: <CAFtA53xLxNQtC3mVO79+pCLoq7bk1QJhtU=C4+B_vcDfg88CUw@mail.gmail.com>
References: <CAFtA53xLxNQtC3mVO79+pCLoq7bk1QJhtU=C4+B_vcDfg88CUw@mail.gmail.com>
Message-ID: <5329D2DA.2040102@rabbitmq.com>

On 19/03/14 16:27, Ron Cordell wrote:
> Any suggestions on places to look to see what the underlying issue might be?

The good news is that performance bottlenecks will get easier to 
diagnose in 3.3.0. The bad news is it's not out yet.

140kmsg/h is only 40msg/s - so you should not have any difficulty 
hitting that even on modest hardware. I assume the messages were 
persistent as well as mirrored, but unless the messages were both very 
large and persistent you should not have a problem there.

Was anything on the broker looking busy (CPU, disk?) Did any of the 
connections show a status of "flow"?

If the answer to those questions is "no" then could you be publishing 
(effectively) synchronously? Do you use mandatory publishing, publish 
inside transactions, or use confirms in a non-streaming way (i.e. 
publish, wait for confirm, repeat)?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From steve.flitcroft at ivendi.com  Wed Mar 19 13:39:59 2014
From: steve.flitcroft at ivendi.com (steve.flitcroft at ivendi.com)
Date: Wed, 19 Mar 2014 13:39:59 +0000
Subject: [rabbitmq-discuss] rabbitmq webstomp ha-mode
In-Reply-To: <5329984B.9040608@rabbitmq.com>
References: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
 <5329984B.9040608@rabbitmq.com>
Message-ID: <61B528C1-5488-4BAF-BA5B-9E8A19062D08@ivendi.com>

Hi Simon,

Non web socket clients (ie9, stock android, old ios/safari etc) always lost connection. As soon as I restrict the clients without a web socket upgrade hdr to goto the same rmq node then they stay connected.  I can prove this very easily in my current setup with clients connecting to the rmq cluster via haproxy.

Cheers



On 19 Mar 2014, at 13:14, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 19/03/14 11:04, Steve Flitcroft wrote:
>> Having trouble getting the queues that are created via sockjs & webstomp
>> being replicated across nodes.
>> 
>> I have a policy set for any queues that start with amq to be replicated.
>> 
>> You can see this here
>> 
>> http://gyazo.com/b0e3fbac0d1a1d0baabc25c5f43499f0
>> 
>> the amq.gen queue created by webstomp does not replicate to the other
>> node, the queue I created called amqsteve does.
> 
> The amq.gen queue is declared as exclusive. From http://www.rabbitmq.com/ha.html:
> 
>  Exclusive queues will be deleted when the connection that declared
>  them is closed. For this reason, it is not useful for an exclusive
>  queue to be mirrored (or durable for that matter) since when the node
>  hosting it goes down, the connection will close and the queue will
>  need to be deleted anyway.
> 
>  For this reason, exclusive queues are never mirrored (even if they
>  match a policy stating that they should be). They are also never
>  durable (even if declared as such).
> 
>> The result of this is that any non websocket browsers have to be routed
>> to exactly the same node otherwise they get a 404 on the xhr_send method
>> and lose connection.
> 
> Uh, that's not the case; you can connect to any node to publish to a non-mirrored queue, it just gets routed inside the cluster.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal


From ron.cordell at gmail.com  Wed Mar 19 17:51:14 2014
From: ron.cordell at gmail.com (Ron Cordell)
Date: Wed, 19 Mar 2014 10:51:14 -0700
Subject: [rabbitmq-discuss] Rabbit slowing down on accepting messages
In-Reply-To: <5329D2DA.2040102@rabbitmq.com>
References: <CAFtA53xLxNQtC3mVO79+pCLoq7bk1QJhtU=C4+B_vcDfg88CUw@mail.gmail.com>
 <5329D2DA.2040102@rabbitmq.com>
Message-ID: <CAFtA53yKKGBsdr8BH_9Jfije=M8hJUdUHS=QvpNx8ZQVoz-N-Q@mail.gmail.com>

The queues are durable/mirrored; there are ~150 of them involved per
message.

The "140K msgs/hr" value means that a producer places a message on the
inbound queue. The application (consumers of this queue) processes the
messages using an asynchronous state machine that uses AMQP as a means of
pushing data to the next state of the processor (publishes/consumes). For
each state there are 2-3 queues such as process, retry, and error; there
are many states per message type. There are 6 application instances
connecting to the Rabbit cluster to process these messages. As a message
flows through the various states its metadata will flow through these
various queues until the processing activity is completed. We use
MassTransit and the .Net C# Rabbit driver on the application side which
implements this behavior. I mention/describe this to be as complete as
possible as we're not testing a single produce/consume type of scenario -
it's more complex as there are several processing states each
publishing/consuming to many different exchanges/queues.

CPU looked fine, Disk is fine, no latency observed - we're on a SAN capably
of 20K IOPs peak and we're not anywhere close to that.

Publishing is done in the MassTransit implementation using the .Net C#
driver, but it publishes then spawns another thread to wait for the ACK. So
the main processing keeps going, but if there is an exceptional return it
is handled elsewhere/asynchronously.

I did confirm that the entire Erlang process was stopped and restarted on
the Rabbit nodes; we will recreate the issue and try just stopping the app
and restarting. The VM's were not restarted nor were they migrated between
test runs.

Cheers,

Ron


On Wed, Mar 19, 2014 at 10:24 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 19/03/14 16:27, Ron Cordell wrote:
>
>> Any suggestions on places to look to see what the underlying issue might
>> be?
>>
>
> The good news is that performance bottlenecks will get easier to diagnose
> in 3.3.0. The bad news is it's not out yet.
>
> 140kmsg/h is only 40msg/s - so you should not have any difficulty hitting
> that even on modest hardware. I assume the messages were persistent as well
> as mirrored, but unless the messages were both very large and persistent
> you should not have a problem there.
>
> Was anything on the broker looking busy (CPU, disk?) Did any of the
> connections show a status of "flow"?
>
> If the answer to those questions is "no" then could you be publishing
> (effectively) synchronously? Do you use mandatory publishing, publish
> inside transactions, or use confirms in a non-streaming way (i.e. publish,
> wait for confirm, repeat)?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140319/1fa7e642/attachment.html>

From mklishin at gopivotal.com  Thu Mar 20 07:55:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 20 Mar 2014 11:55:08 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.1.7 is released
Message-ID: <E3713E18-B937-437E-9167-589B38690C91@rabbitmq.com>

Bunny [1] is a Ruby RabbitMQ client focusing on ease of use.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/03/20/bunny-1-dot-1-7-is-released/

1. http://rubybunny.info

MK

Software Engineer, Pivotal/RabbitMQ



From stammailbox at gmail.com  Thu Mar 20 09:50:35 2014
From: stammailbox at gmail.com (rails)
Date: Thu, 20 Mar 2014 11:50:35 +0200
Subject: [rabbitmq-discuss] Fwd: Best practices to manage failovers at the
	publishers side
In-Reply-To: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
References: <CAJ2-Vr=U+6ypgi2M9hhAb3z=DffL2p-SP_g+fLHgzWxHOtQ48g@mail.gmail.com>
Message-ID: <CAJ2-VrnbkOZUnfvBYAPYq6r4X+6v50aBH_3UqVoTJ_xc96EBkg@mail.gmail.com>

My main scenario that I want to manage is when the publisher connection is
not active.
Wither for a second or since the cluster is down.

What options does rabbitMQ (client side) have that will help me to manage
this scenario?
1. Can he accumulate the messages ?
2. Can he manage retries?

The second part of the question is regarding managing the failover itself.
 I know that in some databases I can write a connection string as follows

*       Data Source=*myServerAddress;*Failover Partner=*
myMirrorServerAddress;
and if the action fails the client automatically switches to another one in
the same action.

3. What is the best practice to manage failovers at the publishers side?
I have Netflix/eureka installed in my environment and I can get the next
active but does rabbitmq support this scenarios?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/bcaa3098/attachment.html>

From geoffrey.samper at gmail.com  Thu Mar 20 09:41:22 2014
From: geoffrey.samper at gmail.com (Geoffrey Samper)
Date: Thu, 20 Mar 2014 02:41:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Network partitioning
Message-ID: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>

Hi, 


We have a cluster with 3 nodes (Rabbit 1, Rabbit 3, rabbit 4). Sometimes we 
have problems of network partitioning. Over the day everything runs fine 
but at night 3AM and 4AM arround we expierence network partitioning. Most 
of the time between 3 and 1. What strange is the log of rabbit 1 is 
contains  "Generic server <0.263.0> terminating in the log". 

Can anyone help me with this issue. The logs are below


RABBIT 04

===========

INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.PageDeletedConsumer' in vhost 'A105'): Master 
<rabbit at P04.1.264.0> saw deaths of mirrors <rabbit at P01.3.264.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p14' in vhost 'A105'): Master 
<rabbit at P04.1.262.0> saw deaths of mirrors <rabbit at P01.3.262.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.MNT_grbhstmntp01' in vhost 'A105'): Master 
<rabbit at P04.1.292.0> saw deaths of mirrors <rabbit at P01.3.292.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p05' in vhost 'A105'): Slave 
<rabbit at P04.1.24486.0> saw deaths of mirrors <rabbit at P01.3.30101.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p09' in vhost 'A105'): Master 
<rabbit at P04.1.24669.0> saw deaths of mirrors <rabbit at P01.3.30387.0>

Rabbit 03
=====================
=INFO REPORT==== 20-Mar-2014::03:41:27 ===
rabbit on node rabbit at P01 down

=ERROR REPORT==== 20-Mar-2014::03:41:27 ===
Mnesia(rabbit at P03): ** ERROR ** mnesia_event got {inconsistent_database, 
running_partitioned_network, rabbit at P01}

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p21' in vhost 'A105'): Slave 
<rabbit at P03.2.278.0> saw deaths of mirrors <rabbit at P01.3.275.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p22' in vhost 'A105'): Slave 
<rabbit at P03.2.270.0> saw deaths of mirrors <rabbit at P01.3.268.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===

Mirrored-queue (queue 'ha.PageDeletedConsumer' in vhost 'A105.001'): Slave 
<rabbit at P03.2.276.0> saw deaths of mirrors <rabbit at P01.3.274.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p04' in vhost 'A105.001'): Slave 
<rabbit at P03.2.274.0> saw deaths of mirrors <rabbit at P01.3.271.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.MNT_grbhstmntp02' in vhost 'A105'): Slave 
<rabbit at P03.2.282.0> saw deaths of mirrors <rabbit at P01.3.280.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p03' in vhost 'A105.001'): Slave 
<rabbit at P03.2.280.0> saw deaths of mirrors <rabbit at P01.3.278.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.MNT_grbhstmntp01' in vhost 'A105.001'): Slave 
<rabbit at P03.2.286.0> saw deaths of mirrors <rabbit at P01.3.284.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.services_p20' in vhost 'A105.001'): Slave 
<rabbit at P03.2.272.0> saw deaths of mirrors <rabbit at P01.3.270.0>

=INFO REPORT==== 20-Mar-2014::03:41:27 ===
Mirrored-queue (queue 'ha.PageDeleteConsumer' in vhost 'A105.001'): Slave 
<rabbit at P03.2.284.0> saw deaths of mirrors <rabbit at P01.3.282.0>

Rabbit 01
===================================

=INFO REPORT==== 20-Mar-2014::03:41:14 ===
rabbit on node rabbit at P03 down

=ERROR REPORT==== 20-Mar-2014::03:41:15 ===
Mnesia(rabbit at P01): ** ERROR ** mnesia_event got {inconsistent_database, 
running_partitioned_network, rabbit at P03}


=ERROR REPORT==== 20-Mar-2014::03:41:15 ===

** Generic server <0.263.0> terminating

** Last message in was {'DOWN',#Ref<0.0.0.1692>,process,<4625.265.0>,

                               noconnection}

** When Server state == {state,

                            {31,<0.263.0>},

                            {{28,<4625.265.0>},#Ref<0.0.0.1692>},

                            {{25,<5158.263.0>},#Ref<0.0.0.1693>},

                            {resource,<<"A105">>,queue,

                                <<"ha.services_p14">>},

                            rabbit_mirror_queue_slave,

                            {32,

                             [{{25,<5158.263.0>},

                               {view_member,

                                   {25,<5158.263.0>},

                                   [],

                                   {31,<0.263.0>},

                                   {28,<4625.265.0>}}},

                              {{28,<4625.265.0>},

                               {view_member,

                                   {28,<4625.265.0>},

                                   [],

                                   {25,<5158.263.0>},

                                   {31,<0.263.0>}}},

                              {{31,<0.263.0>},

                               {view_member,

                                   {31,<0.263.0>},

                                   [],

                                   {28,<4625.265.0>},

                                   {25,<5158.263.0>}}}]},

                            0,

                            [{{25,<5158.263.0>},{member,{[],[]},6,6}},

                             {{28,<4625.265.0>},{member,{[],[]},1,1}},

                             {{31,<0.263.0>},{member,{[],[]},0,0}}],

                            [<0.262.0>],

                            {[],[]},

                            [],0,undefined,

                            #Fun<rabbit_misc.execute_mnesia_transaction.1>}

** Reason for termination == 

** {function_clause,[{orddict,fetch,

                              [{31,<0.263.0>},[]],

                              [{file,"orddict.erl"},{line,72}]},

                     {gm,check_neighbours,1,[]},

                     {gm,handle_info,2,[]},

                     {gen_server2,handle_msg,2,[]},

                    
 {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
=INFO REPORT==== 20-Mar-2014::03:41:15 ===

Mirrored-queue (queue 'ha.MNT_Pages_grbhstmntp01' in vhost 'A105'): Slave 
<rabbit at P01.3.289.0> saw deaths of mirrors <rabbit at P01.3.289.0>

=INFO REPORT==== 20-Mar-2014::03:41:15 ===
Mirrored-queue (queue 'ha.services_p17' in vhost 'A105'): Slave 
<rabbit at P01.3.266.0> saw deaths of mirrors <rabbit at P03.2.268.0>

=INFO REPORT==== 20-Mar-2014::03:41:15 ===
Mirrored-queue (queue 'ha.services_p06' in vhost 'A105'): Slave 
<rabbit at P01.3.30366.0> saw deaths of mirrors <rabbit at P03.2.21958.0>

=INFO REPORT==== 20-Mar-2014::03:41:15 ===
Mirrored-queue (queue 'ha.services_p06' in vhost 'A105'): Promoting slave 
<rabbit at P01.3.30366.0> to master

=INFO REPORT==== 20-Mar-2014::03:41:16 ===
Mirrored-queue (queue 'ha.ElasticSearchConsumer' in vhost 'A105.001'): 
Slave <rabbit at P01.3.286.0> saw deaths of mirrors <rabbit at P03.2.288.0> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/e13d3687/attachment.html>

From aapte at zynga.com  Thu Mar 20 18:11:36 2014
From: aapte at zynga.com (Ajinkya Apte)
Date: Thu, 20 Mar 2014 18:11:36 +0000
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <CAJ2-VrnbkOZUnfvBYAPYq6r4X+6v50aBH_3UqVoTJ_xc96EBkg@mail.gmail.com>
Message-ID: <CF50BAC9.11688%aapte@zynga.com>

Hey guys,
I want to delay the processing of some data coming into a queue. The data has delayTime associated with it.

What I want to do?

  1.  Data is coming in with a delayTime associated with it.
  2.  Some data can come with the delayTime=5 mintes from now, some data with delayTime=10 and so on. This delayTime can be anything.
  3.  I want to delay the processing of this data.

Questions?

  1.  From the documentation seems like using message TTL won't be the way to go, right?
  2.  Will I have to use the 'Dead Letter Exchanges' concept along with multiple retry queues having different timeouts?
  3.  Any other suggestions?

Please let me know.
Thanks,

AJ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/cdd7a7be/attachment.html>

From videlalvaro at gmail.com  Thu Mar 20 18:34:24 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 20 Mar 2014 19:34:24 +0100
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <CF50BAC9.11688%aapte@zynga.com>
References: <CAJ2-VrnbkOZUnfvBYAPYq6r4X+6v50aBH_3UqVoTJ_xc96EBkg@mail.gmail.com>
 <CF50BAC9.11688%aapte@zynga.com>
Message-ID: <CAMcAHLUF5ae51HkVNXZuMV=bmPUMKizOCHN8RFQgySHqK_XJgw@mail.gmail.com>

Hi,

On Thu, Mar 20, 2014 at 7:11 PM, Ajinkya Apte <aapte at zynga.com> wrote:
> Will I have to use the 'Dead Letter Exchanges' concept along with multiple
> retry queues having different timeouts?

This is what people usually do with RabbitMQ.

Regards,

Alvaro

From michael.laing at nytimes.com  Thu Mar 20 18:36:47 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Thu, 20 Mar 2014 14:36:47 -0400
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <CF50BAC9.11688%aapte@zynga.com>
References: <CAJ2-VrnbkOZUnfvBYAPYq6r4X+6v50aBH_3UqVoTJ_xc96EBkg@mail.gmail.com>
 <CF50BAC9.11688%aapte@zynga.com>
Message-ID: <CAKgmDnHR+sm=NRe6GMr4jCenABeVuEH0AB_VKctAguovnC_MDA@mail.gmail.com>

We currently use TTLs and Dead Letter Exchanges to accomplish this.

An app we call Route looks at messages and either:

   1. sends them to an exchange called Distribute, or
   2. declares a queue with a name reflecting the embargo datetime and a
   DLX of Distribute and sends the message to it with a TTL calculated to
   release at that datetime.

This works fine. You can dynamically set a policy to delete the queue.

Probably we will move away from this in the next few months simply because
we wish to persist as little as possible in rabbitmq. But it is quite
simple and functional.

ml


On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte <aapte at zynga.com> wrote:

>  Hey guys,
> I want to delay the processing of some data coming into a queue. The data
> has delayTime associated with it.
>
>  What I want to do?
>
>    1. Data is coming in with a delayTime associated with it.
>    2. Some data can come with the delayTime=5 mintes from now, some data
>    with delayTime=10 and so on. This delayTime can be anything.
>    3. I want to delay the processing of this data.
>
>
>  Questions?
>
>    1. From the documentation seems like using message TTL won't be the
>    way to go, right?
>    2. Will I have to use the 'Dead Letter Exchanges' concept along with
>    multiple retry queues having different timeouts?
>    3. Any other suggestions?
>
>
>  Please let me know.
> Thanks,
>
>  AJ
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/56598095/attachment.html>

From cwstorm at gmail.com  Thu Mar 20 19:38:50 2014
From: cwstorm at gmail.com (cw storm)
Date: Thu, 20 Mar 2014 15:38:50 -0400
Subject: [rabbitmq-discuss] Age of message
Message-ID: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>

Is it possible to get the age of the message from the queue?  I want to get
a total count of message that are x old.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/9262f964/attachment.html>

From cwstorm at gmail.com  Thu Mar 20 19:49:03 2014
From: cwstorm at gmail.com (cw storm)
Date: Thu, 20 Mar 2014 15:49:03 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
Message-ID: <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>

We want to get an alert when messages haven't been ack since the time it
arrived in the queue.


On Thu, Mar 20, 2014 at 3:38 PM, cw storm <cwstorm at gmail.com> wrote:

> Is it possible to get the age of the message from the queue?  I want to
> get a total count of message that are x old.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/c1651798/attachment.html>

From videlalvaro at gmail.com  Thu Mar 20 19:54:58 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 20 Mar 2014 20:54:58 +0100
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
Message-ID: <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>

On Thu, Mar 20, 2014 at 8:49 PM, cw storm <cwstorm at gmail.com> wrote:
> We want to get an alert when messages haven't been ack since the time it
> arrived in the queue.

I don't think RabbitMQ could give you that functionality. In any case,
have you looked into TTLs? http://www.rabbitmq.com/ttl.html

From cwstorm at gmail.com  Thu Mar 20 20:07:48 2014
From: cwstorm at gmail.com (cw storm)
Date: Thu, 20 Mar 2014 16:07:48 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
Message-ID: <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>

TTL applies to expiring the message.  I don't want to set an expiration on
the message.  What we're trying to do is report on stale messages.  Trying
to find a reasonable design or approach on this topic.  Interested in how
everyone does it.


On Thu, Mar 20, 2014 at 3:54 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> On Thu, Mar 20, 2014 at 8:49 PM, cw storm <cwstorm at gmail.com> wrote:
> > We want to get an alert when messages haven't been ack since the time it
> > arrived in the queue.
>
> I don't think RabbitMQ could give you that functionality. In any case,
> have you looked into TTLs? http://www.rabbitmq.com/ttl.html
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/93ec0a5d/attachment.html>

From videlalvaro at gmail.com  Thu Mar 20 20:24:03 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 20 Mar 2014 21:24:03 +0100
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
Message-ID: <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>

If you are not going to process the staled messages, then if they have
TTL set, they will be dead lettered, by setting up a queue on that
dead letter exchange, you could then report on those "staled"
messages.

RabbitMQ doesn't support browsing a queue and selecting message with
certain age.

On Thu, Mar 20, 2014 at 9:07 PM, cw storm <cwstorm at gmail.com> wrote:
> TTL applies to expiring the message.  I don't want to set an expiration on
> the message.  What we're trying to do is report on stale messages.  Trying
> to find a reasonable design or approach on this topic.  Interested in how
> everyone does it.
>
>
> On Thu, Mar 20, 2014 at 3:54 PM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>>
>> On Thu, Mar 20, 2014 at 8:49 PM, cw storm <cwstorm at gmail.com> wrote:
>> > We want to get an alert when messages haven't been ack since the time it
>> > arrived in the queue.
>>
>> I don't think RabbitMQ could give you that functionality. In any case,
>> have you looked into TTLs? http://www.rabbitmq.com/ttl.html
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From cwstorm at gmail.com  Thu Mar 20 20:49:49 2014
From: cwstorm at gmail.com (cw storm)
Date: Thu, 20 Mar 2014 16:49:49 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
Message-ID: <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>

I guess the client could include a timestamp during the publish and put it
in a header attribute.  The consumer can use that information and match
that against the current date time.

You see, there could be an issue with the client not setting the
acknowledge flag so that the message can be remove from the queue.  What
happens is that all other messages are back up until that one message is
acknowledge by the client.  At that time, anything can happen with the
environment.  The client server could be unavailable or that some other
components is working overtime which prevent the consumer service to
complete processing it correctly.  If everything goes well, then the last
step is to set that flag and the message will either be acknowledge or
rejected.  If rejected, it'll go back to the ready state and will process
again until it's acknowledge.  So, I'm trying to come up with a good
approach on reporting "stale" messages. I could get the total messages
waiting in the queue and if it's greater than say 100, then send an alert.
 But during runtime, one could get 1k messages in a queue and it just take
time to process so it's not really "stale".  But I guess this would be good
for now so that support person can phyiscially monitor it.


On Thu, Mar 20, 2014 at 4:24 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> If you are not going to process the staled messages, then if they have
> TTL set, they will be dead lettered, by setting up a queue on that
> dead letter exchange, you could then report on those "staled"
> messages.
>
> RabbitMQ doesn't support browsing a queue and selecting message with
> certain age.
>
> On Thu, Mar 20, 2014 at 9:07 PM, cw storm <cwstorm at gmail.com> wrote:
> > TTL applies to expiring the message.  I don't want to set an expiration
> on
> > the message.  What we're trying to do is report on stale messages.
>  Trying
> > to find a reasonable design or approach on this topic.  Interested in how
> > everyone does it.
> >
> >
> > On Thu, Mar 20, 2014 at 3:54 PM, Alvaro Videla <videlalvaro at gmail.com>
> > wrote:
> >>
> >> On Thu, Mar 20, 2014 at 8:49 PM, cw storm <cwstorm at gmail.com> wrote:
> >> > We want to get an alert when messages haven't been ack since the time
> it
> >> > arrived in the queue.
> >>
> >> I don't think RabbitMQ could give you that functionality. In any case,
> >> have you looked into TTLs? http://www.rabbitmq.com/ttl.html
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/9ea696ce/attachment.html>

From matthias at rabbitmq.com  Thu Mar 20 21:30:10 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 20 Mar 2014 21:30:10 +0000
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>
References: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>
Message-ID: <532B5DE2.4000905@rabbitmq.com>

On 20/03/14 09:41, Geoffrey Samper wrote:
> We have a cluster with 3 nodes (Rabbit 1, Rabbit 3, rabbit 4).
> Sometimes we have problems of network partitioning. Over the day
> everything runs fine but at night 3AM and 4AM arround we expierence
> network partitioning. Most of the time between 3 and 1. What strange
> is the log of rabbit 1 is contains  "Generic server <0.263.0>
> terminating in the log".

What RabbitMQ version are you running?

Matthias.

From mklishin at gopivotal.com  Fri Mar 21 01:28:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 21 Mar 2014 05:28:45 +0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
Message-ID: <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>


On 21 Mar 2014, at 00:49, cw storm <cwstorm at gmail.com> wrote:

> I guess the client could include a timestamp during the publish and put it in a header attribute.  The consumer can use that information and match that against the current date time.

There is a message property called ?timestamp?. Note that publishers and consumers then should synchronise
their clocks using NTP or similar.

MK

Software Engineer, Pivotal/RabbitMQ



From ratheesh.ksz at gmail.com  Fri Mar 21 04:10:46 2014
From: ratheesh.ksz at gmail.com (ratheesh kannoth)
Date: Fri, 21 Mar 2014 09:40:46 +0530
Subject: [rabbitmq-discuss] Distributed RabbitMq
Message-ID: <CAGZFCEE0HGR5idW2WN8EYYbW2PnD8Z3NsR+L=KOW=hEhaJBXaw@mail.gmail.com>

1)  In distributed Rabbit, is there any need to run  Broker ?   if
yes ,  where we need to run it ?

                if no,  who is responsible for queuing and storing of
messages ?



2)  In distributed  RabbitMq, we can send  messages from subscriber to
consumer directly ?


-Ratheesh

From mklishin at gopivotal.com  Fri Mar 21 06:02:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 21 Mar 2014 10:02:06 +0400
Subject: [rabbitmq-discuss] Distributed RabbitMq
In-Reply-To: <CAGZFCEE0HGR5idW2WN8EYYbW2PnD8Z3NsR+L=KOW=hEhaJBXaw@mail.gmail.com>
References: <CAGZFCEE0HGR5idW2WN8EYYbW2PnD8Z3NsR+L=KOW=hEhaJBXaw@mail.gmail.com>
Message-ID: <5B346DB3-648C-4E60-AA5B-0C46AFA88E06@rabbitmq.com>


On 21 Mar 2014, at 08:10, ratheesh kannoth <ratheesh.ksz at gmail.com> wrote:

> 1)  In distributed Rabbit, is there any need to run  Broker ?   if
> yes ,  where we need to run it ?
> 
>                if no,  who is responsible for queuing and storing of
> messages ?

If you use clustering, a cluster is formed by 2 or more RabbitMQ nodes.
Federation and shovel plugins connect 2 or more RabbitMQ nodes or clusters.

> 2)  In distributed  RabbitMq, we can send  messages from subscriber to
> consumer directly ?

Messages are published to and consumed from RabbitMQ nodes. If your publisher
and consumer are connected to the same node, you get the best inter-cluster
data locality but otherwise, you can publish to and consume from any node
and RabbitMQ will pass messages to the ?right? node under the hood.

See http://www.rabbitmq.com/distributed.html

MK

Software Engineer, Pivotal/RabbitMQ



From john.butler at quantumretail.com  Thu Mar 20 18:26:40 2014
From: john.butler at quantumretail.com (John Butler)
Date: Thu, 20 Mar 2014 13:26:40 -0500
Subject: [rabbitmq-discuss] RabbitMQ heartbeat configuration
Message-ID: <CAMN=c_jO2s=aXNb2G5e8GYbO_hGS989P=GLtyOT4P-zR08RG6w@mail.gmail.com>

Hello,

I have a question regarding enabling RabbitMQ heartbeats on a Windows OS
environment.

RabbitMQ version:
** amqp_client-2.8.6*
** mochiweb-2.3.1-rmq2.8.6-gitd541e9a*
** rabbitmq_management-2.8.6*
** rabbitmq_management_agent-2.8.6*

>From what I have found in my research, enabling RabbitMQ heartbeats is done
via the rabbitmq.conf file.  However, I found the statement below on
https://www.rabbitmq.com/configure.html:

"If rabbitmq-env.conf doesn't exist, it can be created manually in the
default location only. It is not used on Windows systems."

I also found documentation that states otherwise.  At this point, I'm
curious if heartbeats can be enabled in RabbitMQ on a Windows environment?

Thanks,
JB
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140320/906975aa/attachment.html>

From oskar at osk.mine.nu  Fri Mar 21 08:44:08 2014
From: oskar at osk.mine.nu (Oskar Liljeblad)
Date: Fri, 21 Mar 2014 09:44:08 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ 3.2.4 crashes - std_alloc:
 Cannot allocate 1125562100111744 bytes of memory (of type "arg_reg")
In-Reply-To: <532974C3.3050709@rabbitmq.com>
References: <532945C2.4010404@rabbitmq.com>
 <4cd96ee1535e4103bd89c5775263adad@AM3PR06MB337.eurprd06.prod.outlook.com>
 <20140319080851.GA5145@osk.mine.nu>
 <20140319082827.GA7803@osk.mine.nu> <532956E0.7060909@rabbitmq.com>
 <20140319084019.GA8390@osk.mine.nu>
 <20140319100449.GA13276@osk.mine.nu>
 <53296C86.5090809@rabbitmq.com>
 <20140319101115.GA13674@osk.mine.nu>
 <532974C3.3050709@rabbitmq.com>
Message-ID: <20140321084408.GA18225@osk.mine.nu>

On Wednesday, March 19, 2014 at 10:15, Matthias Radestock wrote:
> >The changes above was what Emile suggested some time ago (for the other
> >cluster crashes).
> 
> Yes, but, as I said, the changes will prevent the logging of the error,
> which in turn prevents the crash. So it will fix your problem, but leaves us
> none the wiser as to the error itself.
> 
> To repeat myself... there are two problems here: 1) some error occurs in
> rabbit, 2) the logging of the error causes a crash. By disabling logging we
> prevent the crash in (2) but at the expense of not being able to see the
> causing error (i.e. (1)) at all.
> 
> >Isn't it the Erlang runtime that crashes?
> 
> yes, but the error is likely caused by Erlang library code, not the runtime
> itself.
> 
> >How do you suggest to troubleshoot this error?
> 
> I've filed a bug to try to prevent the crash while still logging something.
> That might allow us to identify (1) but will be of no use to track down (2),
> and w/o this being easily reproducible the Erlang/OTP folks are unlikely to
> take an interest.

FYI, disabling HIPE seems to have done magic.
I would like to debug Erlang HIPE but it seems Debian does not provide
debugging symbols for the HIPE version.

Regards,

Oskar

From tim at rabbitmq.com  Fri Mar 21 10:03:58 2014
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 21 Mar 2014 10:03:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ heartbeat configuration
In-Reply-To: <CAMN=c_jO2s=aXNb2G5e8GYbO_hGS989P=GLtyOT4P-zR08RG6w@mail.gmail.com>
References: <CAMN=c_jO2s=aXNb2G5e8GYbO_hGS989P=GLtyOT4P-zR08RG6w@mail.gmail.com>
Message-ID: <031AF7E4-59D5-4E96-823B-BA1B4C82C523@rabbitmq.com>

The heartbeat configuration isn't stored in rabbitmq-env.conf, it is stored in the other configuration file, which on windows is located in %APPDATA%\RabbitMQ. That configuration controls the heartbeat interval that the server will "suggest" to the client on establishing a connection. The client can decide to ignore this, enabling heartbeats using whatever interval it likes or disabling them completely. The client API for managing heartbeats will depend on the client library and language being used.

Cheers,
Tim

On 20 Mar 2014, at 18:26, John Butler wrote:

> Hello,
> 
> I have a question regarding enabling RabbitMQ heartbeats on a Windows OS environment.
> 
> RabbitMQ version:
> * amqp_client-2.8.6
> * mochiweb-2.3.1-rmq2.8.6-gitd541e9a
> * rabbitmq_management-2.8.6
> * rabbitmq_management_agent-2.8.6 
> 
> From what I have found in my research, enabling RabbitMQ heartbeats is done via the rabbitmq.conf file.  However, I found the statement below on https://www.rabbitmq.com/configure.html:
> 
> "If rabbitmq-env.conf doesn't exist, it can be created manually in the default location only. It is not used on Windows systems."
> 
> I also found documentation that states otherwise.  At this point, I'm curious if heartbeats can be enabled in RabbitMQ on a Windows environment?
> 
> Thanks, 
> JB
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/d18ccc0e/attachment.html>

From matthias at rabbitmq.com  Fri Mar 21 10:08:56 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Mar 2014 10:08:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ heartbeat configuration
In-Reply-To: <031AF7E4-59D5-4E96-823B-BA1B4C82C523@rabbitmq.com>
References: <CAMN=c_jO2s=aXNb2G5e8GYbO_hGS989P=GLtyOT4P-zR08RG6w@mail.gmail.com>
 <031AF7E4-59D5-4E96-823B-BA1B4C82C523@rabbitmq.com>
Message-ID: <532C0FB8.5010005@rabbitmq.com>

On 21/03/14 10:03, Tim Watson wrote:
> The heartbeat configuration isn't stored in rabbitmq-env.conf, it is
> stored in the other configuration file, which on windows is located in
> %APPDATA%\RabbitMQ.

"other configuration file" = rabbitmq.config (see 
https://www.rabbitmq.com/configure.html#configuration-file), in 
particular the heartbeat value.

Note however that the OP is running 2.8.6 which is ancient and pre-dates 
the introduction of server-side configurable heartbeat intervals. -> upgrade

Matthias.

From aapte at zynga.com  Fri Mar 21 10:22:04 2014
From: aapte at zynga.com (Ajinkya Apte)
Date: Fri, 21 Mar 2014 10:22:04 +0000
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <CAKgmDnHR+sm=NRe6GMr4jCenABeVuEH0AB_VKctAguovnC_MDA@mail.gmail.com>
Message-ID: <CF51C071.11880%aapte@zynga.com>

Thanks for the reply.  So the only problem I see with what I want to do and with whats available in RabbitMQ is I will have to time slice and create multiple queues.
For example:
One queue with a timeout of 5 min, the other 10 min. Then according to the delay time just put incoming data into the proper queue.
The down side I can see is that new data that will be thrown in a queue with say a 10 min timeout, will be theoretically processed anywhere between 1-10 mins. I cannot kinda guarantee that the data will be handled only after 10 mins.

Does this make sense to you?

Do you create a new queue per request coming in, depending on a the delay?

AJ

From: <Laing>, Michael <michael.laing at nytimes.com<mailto:michael.laing at nytimes.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Thursday, March 20, 2014 6:36 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] : Delayed processing of data

We currently use TTLs and Dead Letter Exchanges to accomplish this.

An app we call Route looks at messages and either:

  1.  sends them to an exchange called Distribute, or
  2.  declares a queue with a name reflecting the embargo datetime and a DLX of Distribute and sends the message to it with a TTL calculated to release at that datetime.

This works fine. You can dynamically set a policy to delete the queue.

Probably we will move away from this in the next few months simply because we wish to persist as little as possible in rabbitmq. But it is quite simple and functional.

ml


On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte <aapte at zynga.com<mailto:aapte at zynga.com>> wrote:
Hey guys,
I want to delay the processing of some data coming into a queue. The data has delayTime associated with it.

What I want to do?

  1.  Data is coming in with a delayTime associated with it.
  2.  Some data can come with the delayTime=5 mintes from now, some data with delayTime=10 and so on. This delayTime can be anything.
  3.  I want to delay the processing of this data.

Questions?

  1.  From the documentation seems like using message TTL won't be the way to go, right?
  2.  Will I have to use the 'Dead Letter Exchanges' concept along with multiple retry queues having different timeouts?
  3.  Any other suggestions?

Please let me know.
Thanks,

AJ

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/7e57c1e7/attachment.html>

From daniel at redbite.com  Fri Mar 21 10:49:53 2014
From: daniel at redbite.com (Daniel McGreal)
Date: Fri, 21 Mar 2014 10:49:53 +0000
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <CF51C071.11880%aapte@zynga.com>
References: <CF51C071.11880%aapte@zynga.com>
Message-ID: <63A661D0-304E-48C8-B3EC-F93683ECD920@redbite.com>

I'm not familiar with all aspect of the process, but couldn't you set a TTL on the message, not the queue?
http://www.rabbitmq.com/ttl.html#per-message-ttl
With no consumers on this queue it ends up in ultimately it will be dead lettered to an exchange/queue/consumer setup where your actual processing happens, i.e. there was at least the specified delay in processing customisable per message?

On 21 Mar 2014, at 10:22, Ajinkya Apte wrote:

> Thanks for the reply.  So the only problem I see with what I want to do and with whats available in RabbitMQ is I will have to time slice and create multiple queues. 
> For example:
> One queue with a timeout of 5 min, the other 10 min. Then according to the delay time just put incoming data into the proper queue.
> The down side I can see is that new data that will be thrown in a queue with say a 10 min timeout, will be theoretically processed anywhere between 1-10 mins. I cannot kinda guarantee that the data will be handled only after 10 mins.
> 
> Does this make sense to you?
> 
> Do you create a new queue per request coming in, depending on a the delay?
> 
> AJ
> 
> From: <Laing>, Michael <michael.laing at nytimes.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Thursday, March 20, 2014 6:36 PM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] : Delayed processing of data
> 
> We currently use TTLs and Dead Letter Exchanges to accomplish this.
> 
> An app we call Route looks at messages and either:
> sends them to an exchange called Distribute, or
> declares a queue with a name reflecting the embargo datetime and a DLX of Distribute and sends the message to it with a TTL calculated to release at that datetime.
> This works fine. You can dynamically set a policy to delete the queue.
> 
> Probably we will move away from this in the next few months simply because we wish to persist as little as possible in rabbitmq. But it is quite simple and functional.
> 
> ml
> 
> 
> On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte <aapte at zynga.com> wrote:
>> Hey guys,
>> I want to delay the processing of some data coming into a queue. The data has delayTime associated with it.
>> 
>> What I want to do?
>> Data is coming in with a delayTime associated with it. 
>> Some data can come with the delayTime=5 mintes from now, some data with delayTime=10 and so on. This delayTime can be anything.
>> I want to delay the processing of this data.
>> 
>> Questions?
>> From the documentation seems like using message TTL won't be the way to go, right? 
>> Will I have to use the 'Dead Letter Exchanges' concept along with multiple retry queues having different timeouts?
>> Any other suggestions?
>> 
>> Please let me know.
>> Thanks,
>> 
>> AJ
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/aa0ba9f3/attachment.html>

From daniel at redbite.com  Fri Mar 21 10:57:21 2014
From: daniel at redbite.com (Daniel McGreal)
Date: Fri, 21 Mar 2014 10:57:21 +0000
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <63A661D0-304E-48C8-B3EC-F93683ECD920@redbite.com>
References: <CF51C071.11880%aapte@zynga.com>
 <63A661D0-304E-48C8-B3EC-F93683ECD920@redbite.com>
Message-ID: <776D523E-AA62-4898-9D63-F3467BF929A5@redbite.com>

Ah, I see the problem in the Caveats.

On 21 Mar 2014, at 10:49, Daniel McGreal wrote:

> I'm not familiar with all aspect of the process, but couldn't you set a TTL on the message, not the queue?
> http://www.rabbitmq.com/ttl.html#per-message-ttl
> With no consumers on this queue it ends up in ultimately it will be dead lettered to an exchange/queue/consumer setup where your actual processing happens, i.e. there was at least the specified delay in processing customisable per message?
> 
> On 21 Mar 2014, at 10:22, Ajinkya Apte wrote:
> 
>> Thanks for the reply.  So the only problem I see with what I want to do and with whats available in RabbitMQ is I will have to time slice and create multiple queues. 
>> For example:
>> One queue with a timeout of 5 min, the other 10 min. Then according to the delay time just put incoming data into the proper queue.
>> The down side I can see is that new data that will be thrown in a queue with say a 10 min timeout, will be theoretically processed anywhere between 1-10 mins. I cannot kinda guarantee that the data will be handled only after 10 mins.
>> 
>> Does this make sense to you?
>> 
>> Do you create a new queue per request coming in, depending on a the delay?
>> 
>> AJ
>> 
>> From: <Laing>, Michael <michael.laing at nytimes.com>
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Date: Thursday, March 20, 2014 6:36 PM
>> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] : Delayed processing of data
>> 
>> We currently use TTLs and Dead Letter Exchanges to accomplish this.
>> 
>> An app we call Route looks at messages and either:
>> sends them to an exchange called Distribute, or
>> declares a queue with a name reflecting the embargo datetime and a DLX of Distribute and sends the message to it with a TTL calculated to release at that datetime.
>> This works fine. You can dynamically set a policy to delete the queue.
>> 
>> Probably we will move away from this in the next few months simply because we wish to persist as little as possible in rabbitmq. But it is quite simple and functional.
>> 
>> ml
>> 
>> 
>> On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte <aapte at zynga.com> wrote:
>>> Hey guys,
>>> I want to delay the processing of some data coming into a queue. The data has delayTime associated with it.
>>> 
>>> What I want to do?
>>> Data is coming in with a delayTime associated with it. 
>>> Some data can come with the delayTime=5 mintes from now, some data with delayTime=10 and so on. This delayTime can be anything.
>>> I want to delay the processing of this data.
>>> 
>>> Questions?
>>> From the documentation seems like using message TTL won't be the way to go, right? 
>>> Will I have to use the 'Dead Letter Exchanges' concept along with multiple retry queues having different timeouts?
>>> Any other suggestions?
>>> 
>>> Please let me know.
>>> Thanks,
>>> 
>>> AJ
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/22772fd0/attachment.html>

From cwstorm at gmail.com  Fri Mar 21 12:32:39 2014
From: cwstorm at gmail.com (cw storm)
Date: Fri, 21 Mar 2014 08:32:39 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
Message-ID: <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>

Thanks MK.  Is the below client to perform the synchronization easier?

http://support.ntp.org/bin/view/Support/JavaSntpClient


On Thu, Mar 20, 2014 at 9:28 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 21 Mar 2014, at 00:49, cw storm <cwstorm at gmail.com> wrote:
>
> > I guess the client could include a timestamp during the publish and put
> it in a header attribute.  The consumer can use that information and match
> that against the current date time.
>
> There is a message property called "timestamp". Note that publishers and
> consumers then should synchronise
> their clocks using NTP or similar.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/b0cd9c5e/attachment.html>

From mklishin at gopivotal.com  Fri Mar 21 12:39:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 21 Mar 2014 16:39:01 +0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
Message-ID: <F3E601D4-0551-464F-9766-D1B51F4F57A4@rabbitmq.com>


On 21 Mar 2014, at 16:32, cw storm <cwstorm at gmail.com> wrote:

> Is the below client to perform the synchronization easier?

Your *app* should not perform time synchronisation. NTP daemon should, in concert
with OS and a pool of NTP servers worldwide.

See http://en.wikipedia.org/wiki/Network_Time_Protocol.


MK

Software Engineer, Pivotal/RabbitMQ



From cwstorm at gmail.com  Fri Mar 21 12:41:37 2014
From: cwstorm at gmail.com (cw storm)
Date: Fri, 21 Mar 2014 08:41:37 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
Message-ID: <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>

I also found, http://commons.apache.org/proper/commons-net/download_net.cgi


On Fri, Mar 21, 2014 at 8:32 AM, cw storm <cwstorm at gmail.com> wrote:

> Thanks MK.  Is the below client to perform the synchronization easier?
>
> http://support.ntp.org/bin/view/Support/JavaSntpClient
>
>
> On Thu, Mar 20, 2014 at 9:28 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>>
>> On 21 Mar 2014, at 00:49, cw storm <cwstorm at gmail.com> wrote:
>>
>> > I guess the client could include a timestamp during the publish and put
>> it in a header attribute.  The consumer can use that information and match
>> that against the current date time.
>>
>> There is a message property called "timestamp". Note that publishers and
>> consumers then should synchronise
>> their clocks using NTP or similar.
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/b7dc96c2/attachment.html>

From cwstorm at gmail.com  Fri Mar 21 12:46:46 2014
From: cwstorm at gmail.com (cw storm)
Date: Fri, 21 Mar 2014 08:46:46 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
Message-ID: <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>

MK,

So you're saying that the OS has to sync with the NTP server.  Once that's
confirm, then the message property of "timestamp" can be use to compare to
the local time on the client server, right?


On Fri, Mar 21, 2014 at 8:41 AM, cw storm <cwstorm at gmail.com> wrote:

> I also found,
> http://commons.apache.org/proper/commons-net/download_net.cgi
>
>
> On Fri, Mar 21, 2014 at 8:32 AM, cw storm <cwstorm at gmail.com> wrote:
>
>> Thanks MK.  Is the below client to perform the synchronization easier?
>>
>> http://support.ntp.org/bin/view/Support/JavaSntpClient
>>
>>
>> On Thu, Mar 20, 2014 at 9:28 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>
>>>
>>> On 21 Mar 2014, at 00:49, cw storm <cwstorm at gmail.com> wrote:
>>>
>>> > I guess the client could include a timestamp during the publish and
>>> put it in a header attribute.  The consumer can use that information and
>>> match that against the current date time.
>>>
>>> There is a message property called "timestamp". Note that publishers and
>>> consumers then should synchronise
>>> their clocks using NTP or similar.
>>>
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/1c907298/attachment.html>

From cwstorm at gmail.com  Fri Mar 21 12:48:54 2014
From: cwstorm at gmail.com (cw storm)
Date: Fri, 21 Mar 2014 08:48:54 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
Message-ID: <CAETr1H9YcOy6EvbrXS-LEqLztQK2TJkqKkR=wsXCV7hoC=xx_w@mail.gmail.com>

Our requirement does not have to be very accurate in terms of the date
time.  Just as long as we have a date time to capture and compare that data
time with the local time on the client server during the consumption
process.


On Fri, Mar 21, 2014 at 8:46 AM, cw storm <cwstorm at gmail.com> wrote:

> MK,
>
> So you're saying that the OS has to sync with the NTP server.  Once that's
> confirm, then the message property of "timestamp" can be use to compare to
> the local time on the client server, right?
>
>
> On Fri, Mar 21, 2014 at 8:41 AM, cw storm <cwstorm at gmail.com> wrote:
>
>> I also found,
>> http://commons.apache.org/proper/commons-net/download_net.cgi
>>
>>
>> On Fri, Mar 21, 2014 at 8:32 AM, cw storm <cwstorm at gmail.com> wrote:
>>
>>> Thanks MK.  Is the below client to perform the synchronization easier?
>>>
>>> http://support.ntp.org/bin/view/Support/JavaSntpClient
>>>
>>>
>>> On Thu, Mar 20, 2014 at 9:28 PM, Michael Klishin <mklishin at gopivotal.com
>>> > wrote:
>>>
>>>>
>>>> On 21 Mar 2014, at 00:49, cw storm <cwstorm at gmail.com> wrote:
>>>>
>>>> > I guess the client could include a timestamp during the publish and
>>>> put it in a header attribute.  The consumer can use that information and
>>>> match that against the current date time.
>>>>
>>>> There is a message property called "timestamp". Note that publishers
>>>> and consumers then should synchronise
>>>> their clocks using NTP or similar.
>>>>
>>>> MK
>>>>
>>>> Software Engineer, Pivotal/RabbitMQ
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/7b27eaae/attachment.html>

From mklishin at gopivotal.com  Fri Mar 21 12:51:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 21 Mar 2014 16:51:48 +0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
Message-ID: <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>


On 21 Mar 2014, at 16:46, cw storm <cwstorm at gmail.com> wrote:

> So you're saying that the OS has to sync with the NTP server.  Once that's confirm, then the message property of "timestamp" can be use to compare to the local time on the client server, right?

After that you still can get inaccurate times from some machines but the possibility
of that is greatly reduced. Syncing over NTP happens periodically. For a lot of apps,
syncing once every few hours is good enough.

MK

Software Engineer, Pivotal/RabbitMQ



From joshua__lim at hotmail.com  Fri Mar 21 12:52:51 2014
From: joshua__lim at hotmail.com (joshua__lim)
Date: Fri, 21 Mar 2014 05:52:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Error during WebSocket handshake: Sent non-empty
 'Sec-WebSocket-Protocol' header but no response was received
Message-ID: <1395406371281-34248.post@n5.nabble.com>

Hi,

I was trying to use Jeff Mesnil's webworker example
(https://github.com/jmesnil/stomp-websocket/tree/master/example/webworker)
for the STOMP Over WebSocket to connect to RabbitMQ's SOCKJS server but
encountered an error:

WebSocket connection to 'ws://localhost:15674/stomp/websocket' failed: Error
during WebSocket handshake: Sent non-empty 'Sec-WebSocket-Protocol' header
but no response was received :8080/stomp.js:374

Line 374 is "ws = new klass(url, protocols);".

I've copied stomp.js to http://pastebin.com/td6nuhSX

Any advice will be much appreciated.

Rgds,
Joshua



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-during-WebSocket-handshake-Sent-non-empty-Sec-WebSocket-Protocol-header-but-no-response-was-red-tp34248.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pat at munkiisoft.com  Fri Mar 21 14:58:51 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Fri, 21 Mar 2014 14:58:51 +0000
Subject: [rabbitmq-discuss] Rejecting messages if incorrect build number
Message-ID: <CALDntb93eJCwoYHWMMVDWkhCOXQ9sBnZbRT+UFoaWJHxtMR76w@mail.gmail.com>

When we move from one major release to another we would like to be able to
consume the old messages from the work queue using the previous version of
the application whilst allowing new messages to be written to the same
queue.

This situation would only occur for a couple of hours after a release.

If we had the buildNumber as a property in a message in theory v2 consumers
could check that the message.buildversion equalled v2 rather than v1

When it did not it the consumer could call Basic.Reject. Perhaps this is
not quite what the AMQP spec intended for the use of Basic.Reject but it
seems like a practical use.

What do others think?

Thanks



-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/c23c1bd4/attachment.html>

From simon at rabbitmq.com  Fri Mar 21 15:14:42 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Mar 2014 15:14:42 +0000
Subject: [rabbitmq-discuss] Rejecting messages if incorrect build number
In-Reply-To: <CALDntb93eJCwoYHWMMVDWkhCOXQ9sBnZbRT+UFoaWJHxtMR76w@mail.gmail.com>
References: <CALDntb93eJCwoYHWMMVDWkhCOXQ9sBnZbRT+UFoaWJHxtMR76w@mail.gmail.com>
Message-ID: <532C5762.3060604@rabbitmq.com>

On 21/03/2014 2:58PM, Patrick Long wrote:
> When it did not it the consumer could call Basic.Reject. Perhaps this is
> not quite what the AMQP spec intended for the use of Basic.Reject but it
> seems like a practical use.
>
> What do others think?

Seems perfectly reasonable as long as your intention is to discard v1 
messages rather than send them to v1 consumers.

(The spec says "The client MUST NOT use [basic.reject] as a means of 
selecting messages to process" but I think they had the latter type of 
scenario in mind.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From pat at munkiisoft.com  Fri Mar 21 15:25:59 2014
From: pat at munkiisoft.com (Patrick Long)
Date: Fri, 21 Mar 2014 15:25:59 +0000
Subject: [rabbitmq-discuss] Rejecting messages if incorrect build number
In-Reply-To: <532C5762.3060604@rabbitmq.com>
References: <CALDntb93eJCwoYHWMMVDWkhCOXQ9sBnZbRT+UFoaWJHxtMR76w@mail.gmail.com>
 <532C5762.3060604@rabbitmq.com>
Message-ID: <CALDntb8ov4icD0rMgHB=cN33Jg+Gj6xWgj+UpB=1BgLwg8WPQw@mail.gmail.com>

That was exactly my intention :-)

We current have the build number in the Queue Name. I guess we are going to
have to stick with that.


On 21 March 2014 15:14, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/03/2014 2:58PM, Patrick Long wrote:
>
>> When it did not it the consumer could call Basic.Reject. Perhaps this is
>> not quite what the AMQP spec intended for the use of Basic.Reject but it
>> seems like a practical use.
>>
>> What do others think?
>>
>
> Seems perfectly reasonable as long as your intention is to discard v1
> messages rather than send them to v1 consumers.
>
> (The spec says "The client MUST NOT use [basic.reject] as a means of
> selecting messages to process" but I think they had the latter type of
> scenario in mind.)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/f73e9ce6/attachment.html>

From simon at rabbitmq.com  Fri Mar 21 15:30:20 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Mar 2014 15:30:20 +0000
Subject: [rabbitmq-discuss] Rejecting messages if incorrect build number
In-Reply-To: <CALDntb8ov4icD0rMgHB=cN33Jg+Gj6xWgj+UpB=1BgLwg8WPQw@mail.gmail.com>
References: <CALDntb93eJCwoYHWMMVDWkhCOXQ9sBnZbRT+UFoaWJHxtMR76w@mail.gmail.com>	<532C5762.3060604@rabbitmq.com>
 <CALDntb8ov4icD0rMgHB=cN33Jg+Gj6xWgj+UpB=1BgLwg8WPQw@mail.gmail.com>
Message-ID: <532C5B0C.2050303@rabbitmq.com>

On 21/03/2014 3:25PM, Patrick Long wrote:
> That was exactly my intention :-)

For v1 consumers to get v1 messages?

In that case, you could have v2 consumers basic.reject{requeue=false} 
but define a DLX on the queue that republishes a message to another 
queue with v1 consumers on it.

Mind you, I'm not sure if that is any simpler than just having separate 
queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From dannybeutler at gmail.com  Fri Mar 21 16:25:18 2014
From: dannybeutler at gmail.com (Danny Beutler)
Date: Fri, 21 Mar 2014 10:25:18 -0600
Subject: [rabbitmq-discuss] Federation vs Shovel
Message-ID: <CABpu9Yf6v3VVvevQi7=ogt_iRBbozwCY-JWKB8KhopzKk65ToA@mail.gmail.com>

Hello,
I am trying to decide between using Shovel or Federation. Our use case is
as follows:
We have two datacenters: east coast and west coast in the US. We have two
clustered rabbitmq nodes in each site. We have messages which are published
at each site which need to be reliably consumed at both sites. For example,
a message published to exchange A at Site A will need to be consumed at
both site A and site B. The messages, exchanges, and queues involved need
to be durable, mirrored, etc. in order to ensure reliable delivery of each
and every message.

Initially, I had leaned toward the shovel plugin for a couple of reasons.
1) The documentation for shovel seems for straightforward. Using Shovel, I
know what happens to the messages in transit because they follow the same
message flow as "normal" messages. The plan is to have a fanout exchange at
each site which publishes to both a queue for local consumption and a queue
that is then shoveled across the WAN to an exchange than points to just the
queue for local consumption and vice versa.
Using Federation, I am not fully aware of what would happen. Say I have a
fanout exchange configured at Site A. A queue at Site A connects to this
queue for local consumption of the messages. Site B then attaches to the
exchange via federation. My understanding is that there is then an upstream
queue created. If Site B then goes offline, what happens to the messages
published to the fanout exchange in Site A. Will the messages sit in the
upstream queue until both the queue and the remote are available to fanout
messages to?

2) Shovel has "More Control" according to the documentation.

My questions are: Am I missing the boat? Would Federation be much more
simple to setup? Would Federation even work in this scenario?

In addition: I would like to configure this whole thing via Puppet. I know
how to do it in the rabbitmq config for shovel but wouldn't this require a
restart when configuration changes are made? Also, would the federation
configuration methods via the API lend itself to more simple Puppetization
through simple API calls for Federation setup?

Thanks,
Danny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/35558020/attachment.html>

From matthias at rabbitmq.com  Fri Mar 21 17:17:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Mar 2014 17:17:31 +0000
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <CANaCqSACTL-1KfgmrqRKiKG_pPB=-wo5k90Hzmqa5s+_iUuOOg@mail.gmail.com>
References: <96bb27bb-58bc-4db6-99f2-abaaacd02f63@googlegroups.com>
 <532B5DE2.4000905@rabbitmq.com>
 <CANaCqSACTL-1KfgmrqRKiKG_pPB=-wo5k90Hzmqa5s+_iUuOOg@mail.gmail.com>
Message-ID: <532C742B.3090307@rabbitmq.com>

On 21/03/14 05:54, Geoffrey Samper wrote:
> Here the version:
>
> RabbitMQ 3.2.4
> x64
> ,  on windows 2008 r2

Cheers.

We have seen that error before but were unable to reproduce it and 
secretly hoping it may have gone away in recent releases. Apparently not :(

Matthias.

From matthias at rabbitmq.com  Fri Mar 21 18:54:33 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Mar 2014 18:54:33 +0000
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <3842659288621435092@unknownmsgid>
References: <3842659288621435092@unknownmsgid>
Message-ID: <532C8AE9.7050203@rabbitmq.com>

On 21/03/14 18:45, Geoffrey Samper wrote:
> Is because runs on windows

There is some anecdotal evidence that partitions are more likely in 
Windows-based rabbit clusters. Avoiding partitions would likely prevent 
hitting the error, but the error itself is not os-specific.

Matthias.

From stammailbox at gmail.com  Fri Mar 21 19:55:12 2014
From: stammailbox at gmail.com (rails)
Date: Fri, 21 Mar 2014 21:55:12 +0200
Subject: [rabbitmq-discuss] Using java threadlocal for channels
Message-ID: <CAJ2-Vr=_DQg_DUHjCH+hHWY7XtcXYanpOisG2UXeP=PKkPOmcQ@mail.gmail.com>

In my system I receive http request to my web server and therefore a new
thread is opened for every process.
Now, I understand that I would better open a channel for each thread.
So I use java Threadlocal for channel.

Will this slow me down?
Is there a better way than opening a channel (and closing it for each http
request)?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/0c325b61/attachment.html>

From mklishin at gopivotal.com  Sat Mar 22 07:55:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 22 Mar 2014 11:55:30 +0400
Subject: [rabbitmq-discuss] Using java threadlocal for channels
In-Reply-To: <CAJ2-Vr=_DQg_DUHjCH+hHWY7XtcXYanpOisG2UXeP=PKkPOmcQ@mail.gmail.com>
References: <CAJ2-Vr=_DQg_DUHjCH+hHWY7XtcXYanpOisG2UXeP=PKkPOmcQ@mail.gmail.com>
Message-ID: <E210B782-425E-4414-893F-BDA602D07185@rabbitmq.com>


On 21 Mar 2014, at 23:55, rails <stammailbox at gmail.com> wrote:

> Now, I understand that I would better open a channel for each thread. 
> So I use java Threadlocal for channel.
> 
> Will this slow me down?
> Is there a better way than opening a channel (and closing it for each http request)?

Clearly opening and closing a channel per request can?t be more efficient.

The question is whether the threads are long lived (e.g. you use a thread pool
such as an ExecutionService). If so, then using thread local storage for channels
should work fine. You may want to check if the channel is still open before publishing on it
and if not, open a new one.

MK

Software Engineer, Pivotal/RabbitMQ



From mariusz.wojcik at hotmail.co.uk  Sat Mar 22 07:59:22 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Sat, 22 Mar 2014 00:59:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ cluster and connection management
In-Reply-To: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>
References: <58a6d699-2d0b-48ba-bf4a-763cf3067d21@googlegroups.com>
Message-ID: <f165e19c-ef0e-466d-b85a-61aa013c3d38@googlegroups.com>

Hi LCassa,

    Have a look at Federated Queues: 
http://www.rabbitmq.com/federated-queues.html
    It allows you to publish/consume messages from any queue in federation, 
although there might be some delay in messages delivery between queues.

    You can find more about Federation Plugin at: 
https://www.rabbitmq.com/federation.html

Cheers,

Mariusz

On Wednesday, 12 March 2014 04:41:07 UTC, lca... at gmail.com wrote:
>
> Hi,
>   I created 3 server cluster of RabbitMQ. As per documentation, RabbitMQ 
> client code does not support connection management to the cluster. It only 
> connects to one broker at a time. I wanted to find out that in order to 
> distribute load what usualy people do for RabbitMQ. Do you use simple Load 
> Balacer or write your own code to manage connections, connection pooling 
> etc?
>
> Thanks
> LCassa.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/61faa78d/attachment.html>

From matthias at rabbitmq.com  Sat Mar 22 08:10:57 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 22 Mar 2014 08:10:57 +0000
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <CANaCqSBFZFJ7mpoFnDgwqrZFc3XirhY5gDW3bxyvZQnvad+VfA@mail.gmail.com>
References: <3842659288621435092@unknownmsgid> <532C8AE9.7050203@rabbitmq.com>
 <CANaCqSBFZFJ7mpoFnDgwqrZFc3XirhY5gDW3bxyvZQnvad+VfA@mail.gmail.com>
Message-ID: <532D4591.1010501@rabbitmq.com>

On 22/03/14 06:02, Geoffrey Samper wrote:
> After disablingquiescing. The problem did not occure this night. If the
> cluster keep running the next couple of days then i can concluded that
> this was a problem and then I will send you the details about how we
> took backups.
> Is this alright?

Certain aspects of virtualisation, such as snapshotting and, apparently, 
quiescing, can cause VMs to effectively stall for a while, which in turn 
would likely be seen as a partitioning event by Erlang. This isn't 
surprising, so I don't think there is much for us to investigate here.


Matthias.

From geoffrey.samper at gmail.com  Fri Mar 21 18:45:30 2014
From: geoffrey.samper at gmail.com (Geoffrey Samper)
Date: Fri, 21 Mar 2014 11:45:30 -0700
Subject: [rabbitmq-discuss] Network partitioning
Message-ID: <3842659288621435092@unknownmsgid>

Is because runs on windows

Sent from my Windows Phone
From: Matthias Radestock
Sent: 21/03/2014 18:17
To: Geoffrey Samper
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Network partitioning
On 21/03/14 05:54, Geoffrey Samper wrote:
> Here the version:
>
> RabbitMQ 3.2.4
> x64
> ,  on windows 2008 r2

Cheers.

We have seen that error before but were unable to reproduce it and
secretly hoping it may have gone away in recent releases. Apparently not :(

Matthias.

From geoffrey.samper at gmail.com  Fri Mar 21 19:48:52 2014
From: geoffrey.samper at gmail.com (Geoffrey Samper)
Date: Fri, 21 Mar 2014 20:48:52 +0100
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <532C8AE9.7050203@rabbitmq.com>
References: <3842659288621435092@unknownmsgid> <532C8AE9.7050203@rabbitmq.com>
Message-ID: <CANaCqSAaA5cg-HAf6Kp4qY4WQ8W_ssAL4VK3VD4Td14HCf81Zw@mail.gmail.com>

Hi,

The rabbit server is a vm running on vmware esx. A couple of minutes before
we say that a vmware snapshot was taken. I currently don't know the details
but tonight we disabled quiescing on our servers. I keep you informed if we
have the crash tonight


On Fri, Mar 21, 2014 at 7:54 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 21/03/14 18:45, Geoffrey Samper wrote:
>
>> Is because runs on windows
>>
>
> There is some anecdotal evidence that partitions are more likely in
> Windows-based rabbit clusters. Avoiding partitions would likely prevent
> hitting the error, but the error itself is not os-specific.
>
> Matthias.
>



-- 
Geoffrey Samper
M: +32 473 954 715
E: geoffrey.samper at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140321/7c70f553/attachment.html>

From geoffrey.samper at gmail.com  Sat Mar 22 06:02:23 2014
From: geoffrey.samper at gmail.com (Geoffrey Samper)
Date: Sat, 22 Mar 2014 07:02:23 +0100
Subject: [rabbitmq-discuss] Network partitioning
In-Reply-To: <532C8AE9.7050203@rabbitmq.com>
References: <3842659288621435092@unknownmsgid> <532C8AE9.7050203@rabbitmq.com>
Message-ID: <CANaCqSBFZFJ7mpoFnDgwqrZFc3XirhY5gDW3bxyvZQnvad+VfA@mail.gmail.com>

Hi Matthias,

After disabling quiescing. The problem did not occure this night. If the
cluster keep running the next couple of days then i can concluded that this
was a problem and then I will send you the details about how we took
backups.
Is this alright?



On Fri, Mar 21, 2014 at 7:54 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 21/03/14 18:45, Geoffrey Samper wrote:
>
>> Is because runs on windows
>>
>
> There is some anecdotal evidence that partitions are more likely in
> Windows-based rabbit clusters. Avoiding partitions would likely prevent
> hitting the error, but the error itself is not os-specific.
>
> Matthias.
>



-- 
Geoffrey Samper
M: +32 473 954 715
E: geoffrey.samper at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/97aee58a/attachment.html>

From tigerwhal3 at gmail.com  Sat Mar 22 23:33:52 2014
From: tigerwhal3 at gmail.com (Adam Smith)
Date: Sat, 22 Mar 2014 18:33:52 -0500
Subject: [rabbitmq-discuss] Writing custom exchange type plugin
Message-ID: <CA+ag_wsaJ9PrmvoVaNQAA0nOTXRyF6tF4bbWwdLWWSiowcGECQ@mail.gmail.com>

Hi,
  I want to write a custom exchange type plugin to accomplish the following:

1. My application publishes messages to a custom exchange CUST in vhost
MYAPP
2. The custom exchange plugin in turn publishes the same message to
        a. exchange X in vhost CL1
        b. exchange X in vhost CL2
        .....
The number of CLx vhosts can vary at different points in the application's
lifetime. Any pointers on how/whether it can done would be greatly
appreciated.

Thanks,
Venkat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/a3d01d5a/attachment.html>

From michael.laing at nytimes.com  Sun Mar 23 00:48:43 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sat, 22 Mar 2014 20:48:43 -0400
Subject: [rabbitmq-discuss] : Delayed processing of data
In-Reply-To: <776D523E-AA62-4898-9D63-F3467BF929A5@redbite.com>
References: <CF51C071.11880%aapte@zynga.com>
 <63A661D0-304E-48C8-B3EC-F93683ECD920@redbite.com>
 <776D523E-AA62-4898-9D63-F3467BF929A5@redbite.com>
Message-ID: <CAKgmDnHYH+2Yi=rotT1qFmt_SboLhTOKTVC9iL50sE9UjoKSDQ@mail.gmail.com>

You can try this:

Lets say you can work on 1 minute boundaries - that's what we do.

When you have a message you want to delay to exchange E, calculate: 1) the
datetime DT to the minute at which you want it released; 2) the
corresponding number of milliseconds MS from now.

Declare a queue QDT with a name incorporating DT and a dead letter exchange
of E. If there is already a queue with that name and exact parameters it's
OK - queue declarations are idempotent so you will neither get a redundant
queue nor will you get an error if it already exists.

Publish your message to queue QDT with an expiry of MS.

At DT (or close enough) the message expirations will take effect and the
messages will be released in queued order to exchange E.

You can use a policy to delete queue QDT.

Hope that helps!

ml


On Fri, Mar 21, 2014 at 6:57 AM, Daniel McGreal <daniel at redbite.com> wrote:

> Ah, I see the problem in the Caveats<http://www.rabbitmq.com/ttl.html#per-message-ttl-caveats>
> .
>
> On 21 Mar 2014, at 10:49, Daniel McGreal wrote:
>
> I'm not familiar with all aspect of the process, but couldn't you set a
> TTL on the message, not the queue?
> http://www.rabbitmq.com/ttl.html#per-message-ttl
> With no consumers on this queue it ends up in ultimately it will be dead
> lettered to an exchange/queue/consumer setup where your actual processing
> happens, i.e. there was at least the specified delay in processing
> customisable per message?
>
> On 21 Mar 2014, at 10:22, Ajinkya Apte wrote:
>
>  Thanks for the reply.  So the only problem I see with what I want to do
> and with whats available in RabbitMQ is I will have to time slice and
> create multiple queues.
> For example:
> One queue with a timeout of 5 min, the other 10 min. Then according to the
> delay time just put incoming data into the proper queue.
> The down side I can see is that new data that will be thrown in a queue
> with say a 10 min timeout, will be theoretically processed anywhere between
> 1-10 mins. I cannot kinda guarantee that the data will be handled only
> after 10 mins.
>
>  Does this make sense to you?
>
>  Do you create a new queue per request coming in, depending on a the
> delay?
>
>  AJ
>
>   From: <Laing>, Michael <michael.laing at nytimes.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Thursday, March 20, 2014 6:36 PM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] : Delayed processing of data
>
>   We currently use TTLs and Dead Letter Exchanges to accomplish this.
>
>  An app we call Route looks at messages and either:
>
>    1. sends them to an exchange called Distribute, or
>    2. declares a queue with a name reflecting the embargo datetime and a
>    DLX of Distribute and sends the message to it with a TTL calculated to
>    release at that datetime.
>
> This works fine. You can dynamically set a policy to delete the queue.
>
>  Probably we will move away from this in the next few months simply
> because we wish to persist as little as possible in rabbitmq. But it is
> quite simple and functional.
>
>  ml
>
>
> On Thu, Mar 20, 2014 at 2:11 PM, Ajinkya Apte <aapte at zynga.com> wrote:
>
>>  Hey guys,
>> I want to delay the processing of some data coming into a queue. The data
>> has delayTime associated with it.
>>
>>  What I want to do?
>>
>>    1. Data is coming in with a delayTime associated with it.
>>    2. Some data can come with the delayTime=5 mintes from now, some data
>>    with delayTime=10 and so on. This delayTime can be anything.
>>    3. I want to delay the processing of this data.
>>
>>
>>  Questions?
>>
>>    1. From the documentation seems like using message TTL won't be the
>>    way to go, right?
>>    2. Will I have to use the 'Dead Letter Exchanges' concept along with
>>    multiple retry queues having different timeouts?
>>    3. Any other suggestions?
>>
>>
>>  Please let me know.
>> Thanks,
>>
>>  AJ
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>    _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140322/dedf69ed/attachment.html>

From simon at rabbitmq.com  Sun Mar 23 11:08:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 23 Mar 2014 11:08:40 +0000
Subject: [rabbitmq-discuss] Federation vs Shovel
In-Reply-To: <CABpu9Yf6v3VVvevQi7=ogt_iRBbozwCY-JWKB8KhopzKk65ToA@mail.gmail.com>
References: <CABpu9Yf6v3VVvevQi7=ogt_iRBbozwCY-JWKB8KhopzKk65ToA@mail.gmail.com>
Message-ID: <532EC0B8.9030705@rabbitmq.com>

On 21/03/2014 16:25, Danny Beutler wrote:
> Using Federation, I am not fully aware of what would happen. Say I have
> a fanout exchange configured at Site A. A queue at Site A connects to
> this queue for local consumption of the messages. Site B then attaches
> to the exchange via federation. My understanding is that there is then
> an upstream queue created.

Yes.

> If Site B then goes offline, what happens to
> the messages published to the fanout exchange in Site A. Will the
> messages sit in the upstream queue until both the queue and the remote
> are available to fanout messages to?

They will sit in the upstream queue until site B comes back, then be 
republished there.

> 2) Shovel has "More Control" according to the documentation.

"More control" is a bit vague, but I am not quite sure how to improve 
it. It means that shovel is a lower-level tool; you're responsible for 
the wiring and it's a bit more YAFIYGI.

> My questions are: Am I missing the boat? Would Federation be much more
> simple to setup? Would Federation even work in this scenario?

Really it's up to you. Where exchange federation would win in this 
scenario is if you want to ensure that only messages which are actually 
needed at site B (because there's an appropriately bound queue) get sent 
there - federation is aware of which bindings exist, shovel isn't.

> In addition: I would like to configure this whole thing via Puppet. I
> know how to do it in the rabbitmq config for shovel but wouldn't this
> require a restart when configuration changes are made?

Yes.

> Also, would the
> federation configuration methods via the API lend itself to more simple
> Puppetization through simple API calls for Federation setup?

Quite possibly.

The next release of RabbitMQ (3.3.0) will give you the option of 
configuring the shovel in a similar way to federation, via mgmt/ctl 
calls with changes applied immediately (see 
http://next.rabbitmq.com/shovel-dynamic.html).

I don't know if that makes your choice harder ;-)

Cheers, Simon


From doroninbal1 at gmail.com  Sun Mar 23 11:48:23 2014
From: doroninbal1 at gmail.com (inbal doron)
Date: Sun, 23 Mar 2014 13:48:23 +0200
Subject: [rabbitmq-discuss] rabbitmq crash
Message-ID: <CANPo+3WLFODiFGxeBbG22UXVLQ_hAH+MSbp2nyTg8gh9Q_3v2A@mail.gmail.com>

Hi,

We have a rabbitmq clustered server running on 64 bit windows server 2008
machines.

Most of the time everything works great but once in a few days the rabbitmq
server crashes and needs to be restarted (restart of rabbitmq, not of the
entire machine).

after the restart all is well for a few more days.

following is the sasl log.

The log refers to the disk monitor, but it doesn't seem like the machine
ran out of space and after the restart everything works.

Any guidance will be much appreciated.

Thank you

Inbal

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.235.0>

registered_name: rabbit_disk_monitor

exception exit: {function_clause,

[{

lists,last,[[]],[{file,"lists.erl"},{line,213}]},

{

rabbit_disk_monitor,parse_free_win32,1,[]},

{

rabbit_disk_monitor,internal_update,1,[]},

{

rabbit_disk_monitor,handle_info,2,[]},

{

gen_server,handle_msg,5,

[{

file,"gen_server.erl"},{line,604}]},

{

proc_lib,init_p_do_apply,3,

[{

file,"proc_lib.erl"},{line,239}]}]}

in function gen_server:terminate/6 (gen_server.erl, line 744)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 1651431857

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: child_terminated

Reason: {function_clause,

[{

lists,last,[[]],[{file,"lists.erl"},{line,213}]},

{

rabbit_disk_monitor,parse_free_win32,1,[]},

{

rabbit_disk_monitor,internal_update,1,[]},

{

rabbit_disk_monitor,handle_info,2,[]},

{

gen_server,handle_msg,5,

[{

file,"gen_server.erl"},{line,604}]},

{

proc_lib,init_p_do_apply,3,

[{

file,"proc_lib.erl"},{line,239}]}]}

Offender: [{pid,<0.235.0>},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27823.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,<0.235.0>},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27825.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27827.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27829.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: [{'$gen_call',{<0.290.0>,#Ref<0.0.481.26304>},

get_disk_free_limit}]

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 1598

stack_size: 27

reductions: 720

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_mgmt_external_stats:init/1

pid: <0.290.0>

registered_name: rabbit_mgmt_external_stats

exception exit: {unsupported_platform,

{

gen_server,call,

[

rabbit_disk_monitor,get_disk_free_limit,

infinity]}}

in function gen_server:terminate/6 (gen_server.erl, line 744)

ancestors: [rabbit_mgmt_agent_sup,<0.288.0>]

messages: []

links: [<0.289.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 10958

stack_size: 27

reductions: 3931613731

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_mgmt_agent_sup}

Context: child_terminated

Reason: {unsupported_platform,

{

gen_server,call,

[

rabbit_disk_monitor,get_disk_free_limit,infinity]}}

Offender: [{pid,<0.290.0>},

{

name,rabbit_mgmt_external_stats},

{

mfargs,{rabbit_mgmt_external_stats,start_link,[]}},

{

restart_type,permanent},

{

shutdown,5000},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27831.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27834.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27836.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27838.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27840.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

CRASH REPORT==== 12-Mar-2014::19:00:38 ===

crasher:

initial call: rabbit_disk_monitor:init/1

pid: <0.27842.0>

registered_name: []

exception exit: unsupported_platform

in function gen_server:init_it/6 (gen_server.erl, line 320)

ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.157.0>]

messages: []

links: [<0.233.0>,<0.234.0>]

dictionary: []

trap_exit: false

status: running

heap_size: 987

stack_size: 27

reductions: 717

neighbours:

=

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: start_error

Reason: unsupported_platform

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]

 =

SUPERVISOR REPORT==== 12-Mar-2014::19:00:38 ===

Supervisor: {local,rabbit_disk_monitor_sup}

Context: shutdown

Reason: reached_max_restart_intensity

Offender: [{pid,{restarting,<0.235.0>}},

{

name,rabbit_disk_monitor},

{

mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},

{

restart_type,transient},

{

shutdown,4294967295},

{

child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140323/86160b15/attachment.html>

From stammailbox at gmail.com  Sun Mar 23 12:01:37 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 23 Mar 2014 14:01:37 +0200
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CAJ2-VrmgnM25cA0SkwThZzJY6qQmE023H=zen9LZSLSSikvm4w@mail.gmail.com>

Hi,
I want to design a rabbit client framework to my project using Rabbitmq
Java client.
My goals it to set default behaviour for other team members using Rabbit.

Rabbit In Action eBook (chapter 6 "Writing code that survive failures")
recommends the following
1. wrap all code in try catch
2. wrap all in while true

something like this

   while tru:
     try:
       conn_broker = pika.BlockingConnection(conn_params)
       channel = conn_broker.channel()
       channel.exchange_declare( exchang
        .....
     except Exception, e:
       traceback.print_exc()

Now, in parallel I understand another goal should be to hold one connection
to the server and multiple channels per thread and client.

Questions :
When exception occurs, will I need to check if connection is still open and
close it?
What if other consumer who uses it is alive and receiving? wouldn't it kill
it too?
Is it recomendded to open multiple connections?


Is there somewhere another design for this situation?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140323/6eedded4/attachment.html>

From stammailbox at gmail.com  Sun Mar 23 12:05:55 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 23 Mar 2014 14:05:55 +0200
Subject: [rabbitmq-discuss] rabbitmq consumer - Writing code that survive
	failures
Message-ID: <CAJ2-Vr=GmUzA+S_WGUXCqrG99HnCisnDPZrbJthKPA6bsK6wnw@mail.gmail.com>

Hi,
I want to design a rabbit client framework to my project using Rabbitmq
Java client.
My goals it to set default behaviour for other team members using Rabbit.

Rabbit In Action eBook (chapter 6 "Writing code that survive failures")
recommends the following
1. wrap all code in try catch
2. wrap all in while true

something like this

   while tru:
     try:
       conn_broker = pika.BlockingConnection(conn_params)
       channel = conn_broker.channel()
       channel.exchange_declare( exchang
        .....
     except Exception, e:
       traceback.print_exc()

Now, in parallel I understand another goal should be to hold one connection
to the server and multiple channels per thread and client.

Questions :
When exception occurs, will I need to check if connection is still open and
close it?
What if other consumer who uses it is alive and receiving? wouldn't it kill
it too?
Is it recomendded to open multiple connections?


Is there somewhere another design for this situation?
Thanks.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140323/107e76f4/attachment.html>

From matthias at rabbitmq.com  Sun Mar 23 12:10:27 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 23 Mar 2014 12:10:27 +0000
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <CANPo+3WLFODiFGxeBbG22UXVLQ_hAH+MSbp2nyTg8gh9Q_3v2A@mail.gmail.com>
References: <CANPo+3WLFODiFGxeBbG22UXVLQ_hAH+MSbp2nyTg8gh9Q_3v2A@mail.gmail.com>
Message-ID: <532ECF33.9060303@rabbitmq.com>

Inbal,

On 23/03/14 11:48, inbal doron wrote:
> We have a rabbitmq clustered server running on 64 bit windows server
> 2008 machines.

What version of RabbitMQ are you running?

> Most of the time everything works great but once in a few days the
> rabbitmq server crashes and needs to be restarted (restart of rabbitmq,
> not of the entire machine).
>
> after the restart all is well for a few more days.
>
> following is the sasl log.
>
> The log refers to the disk monitor, but it doesn't seem like the machine
> ran out of space and after the restart everything works.

The disk monitor runs

   dir /-C /W "<mnesia-dir>"

and the error indicates that this was returning nothing, which is rather 
strange, especially since it evidently is not happening all the time.

Is your RABBITMQ_MNESIA_DIR (usually that is under 
%APPDATA%\RabbitMQ\rabbitmq\db) living on some strange volume, e.g. a SAN?

Regards,

Matthias.

From mklishin at gopivotal.com  Sun Mar 23 12:22:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 23 Mar 2014 16:22:08 +0400
Subject: [rabbitmq-discuss] rabbitmq consumer - Writing code that
 survive failures
In-Reply-To: <CAJ2-Vr=GmUzA+S_WGUXCqrG99HnCisnDPZrbJthKPA6bsK6wnw@mail.gmail.com>
References: <CAJ2-Vr=GmUzA+S_WGUXCqrG99HnCisnDPZrbJthKPA6bsK6wnw@mail.gmail.com>
Message-ID: <etPan.532ed20b.327b23c6.11ee1@mercurio.local>

On 23 March 2014 at 16:08:14, rails (stammailbox at gmail.com) wrote:
> > When exception occurs, will I need to check if connection is  
> still open and close it?

What kind of exception? After a network failure your consumer will get
a shutdown notification [1].

Consumers need to be recovered after connection & channel recovery.

> What if other consumer who uses it is alive and receiving? wouldn't  
> it kill it too?

An uncaught exception in one consumer does not affect other consumers
as long as it does not cause their channel to be closed.

> Is it recomendded to open multiple connections?

As far as recovery goes, the process is the same, so there is no benefit.

RabbitMQ Java client master (future 3.3.0 release) supports automatic
recovery with one limitation: messages published during connection
outage are not enqueued internally and thus won?t be redelivered later.

Also, see Lyra [2].

1.?http://www.rabbitmq.com/api-guide.html#shutdown
2.?https://github.com/jhalterman/lyra?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From doroninbal1 at gmail.com  Sun Mar 23 12:34:48 2014
From: doroninbal1 at gmail.com (inbal doron)
Date: Sun, 23 Mar 2014 14:34:48 +0200
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <532ECF33.9060303@rabbitmq.com>
References: <CANPo+3WLFODiFGxeBbG22UXVLQ_hAH+MSbp2nyTg8gh9Q_3v2A@mail.gmail.com>
 <532ECF33.9060303@rabbitmq.com>
Message-ID: <CANPo+3UbaJ8_vMHhvRApKhKpJLbqA_wf1gvHANB-85dKuzyg0g@mail.gmail.com>

Hi Matthias,

Thanks for the quick response.

I am running version 3.1.5 of rabbitmq (erlang version: r16b02).

the mnesia dir in the os volume which is ssd raid 1.

have you encountered any problems working with ssd?

Thank you

Inbal


2014-03-23 14:10 GMT+02:00 Matthias Radestock <matthias at rabbitmq.com>:

> Inbal,
>
>
> On 23/03/14 11:48, inbal doron wrote:
>
>> We have a rabbitmq clustered server running on 64 bit windows server
>> 2008 machines.
>>
>
> What version of RabbitMQ are you running?
>
>
>  Most of the time everything works great but once in a few days the
>> rabbitmq server crashes and needs to be restarted (restart of rabbitmq,
>> not of the entire machine).
>>
>> after the restart all is well for a few more days.
>>
>> following is the sasl log.
>>
>> The log refers to the disk monitor, but it doesn't seem like the machine
>> ran out of space and after the restart everything works.
>>
>
> The disk monitor runs
>
>   dir /-C /W "<mnesia-dir>"
>
> and the error indicates that this was returning nothing, which is rather
> strange, especially since it evidently is not happening all the time.
>
> Is your RABBITMQ_MNESIA_DIR (usually that is under
> %APPDATA%\RabbitMQ\rabbitmq\db) living on some strange volume, e.g. a SAN?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140323/7110df11/attachment.html>

From chris.friesen at windriver.com  Mon Mar 24 01:39:41 2014
From: chris.friesen at windriver.com (Chris Friesen)
Date: Sun, 23 Mar 2014 19:39:41 -0600
Subject: [rabbitmq-discuss] debugging lost queue on rabbit server switchover
Message-ID: <532F8CDD.5060809@windriver.com>

Hi,

I'm looking for some help with debugging what seems to be a rabbit 
server issue.

I've got a rabbit server being used for OpenStack, and it's set up in a 
active-standby config using pacemaker.

Yesterday we had some guys doing testing by triggering a controlled 
switchover from active to standby and back, multiple times.

One of our other servers started showing some odd behaviour, and when we 
dug into it the problem seemed to be that the queue that it thought it 
was using didn't seem to exist on the rabbit server anymore.

# The message trace of the RPC request shows the required reply queue of 
the following.

reply_5e65eb22a7bd4bd98a5bc6b7c354fa5b



21:16:02.279850 00:1e:67:51:57:09 > 00:1e:67:54:aa:39, ethertype IPv4 
(0x0800), length 678: (tos 0x0, ttl 64, id 21886, offset 0, flags [DF], 
proto TCP (6), length 664)
     192.168.204.194.47946 > 192.168.204.2.5672: Flags [P.], cksum 
0x1ca1 (incorrect -> 0xcadb), seq 33263:33875, ack 2765, win 123, 
options [nop,nop,TS val 72448895 ecr 74959841], length 612
      0x0000:  4500 0298 557e 4000 4006 c8cb c0a8 ccc2  E...U~@. at .......
      0x0010:  c0a8 cc02 bb4a 1628 dd1a 91e2 01f0 e9ef  .....J.(........
      0x0020:  8018 007b 1ca1 0000 0101 080a 0451 7b7f  ...{.........Q{.
      0x0030:  0477 cbe1 0300 0100 0002 5c7b 226f 736c  .w........\{"osl
      0x0040:  6f2e 6d65 7373 6167 6522 3a20 227b 5c22  o.message":."{\"
      0x0050:  5f63 6f6e 7465 7874 5f72 6f6c 6573 5c22  _context_roles\"
      0x0060:  3a20 5b5c 2261 646d 696e 5c22 5d2c 205c  :.[\"admin\"],.\
      0x0070:  225f 6d73 675f 6964 5c22 3a20 5c22 6532  "_msg_id\":.\"e2
      0x0080:  6135 3465 6630 6466 3334 3436 3132 6133  a54ef0df344612a3
      0x0090:  3363 3464 6431 6231 6334 3238 3164 5c22  3c4dd1b1c4281d\"
      0x00a0:  2c20 5c22 5f63 6f6e 7465 7874 5f72 6561  ,.\"_context_rea
      0x00b0:  645f 6465 6c65 7465 645c 223a 205c 226e  d_deleted\":.\"n
      0x00c0:  6f5c 222c 205c 225f 7265 706c 795f 715c  o\",.\"_reply_q\
      0x00d0:  223a 205c 2272 6570 6c79 5f35 6536 3565  ":.\"reply_5e65e
      0x00e0:  6232 3261 3762 6434 6264 3938 6135 6263  b22a7bd4bd98a5bc
      0x00f0:  3662 3763 3335 3466 6135 625c 222c 205c  6b7c354fa5b\",.\



However, rabbitmq does not have any information for this queue



rabbitmqadmin -H 192.168.204.2 list queues name
| reply_09e9cf08bfd84f8f903b527080ac28fc                           |
| reply_1d7e7b12580e46109c5a01e54b5cfbbf                           |
| reply_215c6a00191f480daafa9daa18949700                           |
| reply_22f18026daad41219463ce64fae3d33f                           |
| reply_2d2486e8b9264f8a98086ec59ddb24a8                           |
| reply_2fc4fac0fa3d4345a2bd9d6313694a97                           |
| reply_3022cb2f5cae45de897fac4a6bf6ac45                           |
| reply_33636e6f24bd429a8f91776b493c8c8f                           |
| reply_42fd8c79cb3440c4b35134b973dba709                           |
| reply_484bf7df103a44a6ba0860198eb642e8                           |
| reply_515d88f6ebdc4c3cb1e46064b900cd56                           |
| reply_63f15fb7c91d4bd7b6803e85fd61788a                           |
| reply_6716118331874dc4a5aa65b001546647                           |
| reply_67382c459e4849c28d80a02a4c9e3086                           |
| reply_690f93f4379d49a9bedef3a872b02f5b                           |
| reply_6b665fbbd5c3487f9d829e4f461c1ab3                           |
| reply_6c9aa49582f347d28fa3c928a71083e9                           |
| reply_6f4dcbf71d864038872177514633387f                           |
| reply_81f3d1b37c7e4cdfb064c8b28321e4c1                           |
| reply_84391d9200b34b64bede108723decb13                           |
| reply_9536e8be4ca4440ea894486814b60f6d                           |
| reply_96ab63f2ba0a4fe69adabbd70e974dfb                           |
| reply_9ebe0711815a4808951f78b2a1b2cd10                           |
| reply_b18ed1503d7943ed90390ddd2392244a                           |
| reply_ba6a767f92554a6ab9cc532d77d50d33                           |
| reply_be244933bfba4ec58b922c549f2ebdc8                           |
| reply_be79b68595394fb886bfc2109a925c5c                           |
| reply_e6cc599265e240f0a95164c6ecf48989                           |
| reply_ef1dbac27378427584820be544080fd1                           |


What's the best way for me to figure out how it got into this state?


Thanks,
Chris

From mklishin at gopivotal.com  Mon Mar 24 04:21:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 08:21:11 +0400
Subject: [rabbitmq-discuss] debugging lost queue on rabbit server
 switchover
In-Reply-To: <532F8CDD.5060809@windriver.com>
References: <532F8CDD.5060809@windriver.com>
Message-ID: <etPan.532fb2d4.6b8b4567.2b36@mercurio.local>

On 24 March 2014 at 05:41:00, Chris Friesen (chris.friesen at windriver.com) wrote:
> > What's the best way for me to figure out how it got into this state?  

First make sure the queue was declared as durable.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From chris.friesen at windriver.com  Mon Mar 24 05:44:14 2014
From: chris.friesen at windriver.com (Chris Friesen)
Date: Sun, 23 Mar 2014 23:44:14 -0600
Subject: [rabbitmq-discuss] debugging lost queue on rabbit server
	switchover
In-Reply-To: <etPan.532fb2d4.6b8b4567.2b36@mercurio.local>
References: <532F8CDD.5060809@windriver.com>
 <etPan.532fb2d4.6b8b4567.2b36@mercurio.local>
Message-ID: <532FC62E.4020104@windriver.com>

On 03/23/2014 10:21 PM, Michael Klishin wrote:
> On 24 March 2014 at 05:41:00, Chris Friesen (chris.friesen at windriver.com) wrote:
>>> What's the best way for me to figure out how it got into this state?
>
> First make sure the queue was declared as durable.

Good point. :)

Since posting the original question I've been looking at the running 
system and at the code and it certainly looks like the queue was not 
declared durable, in which case a switchover could certainly explain the 
loss of the queue.

I'll keep digging on the assumption that this is likely what happened.

Chris

From stammailbox at gmail.com  Mon Mar 24 10:11:22 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 24 Mar 2014 12:11:22 +0200
Subject: [rabbitmq-discuss] Why does management plugin displays 4
 connections for each single connection creation?
Message-ID: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>

Why does management plugin displays 4 connections for each single
connection creation?

       com.rabbitmq.client.ConnectionFactory.newConnection();

as follows

http://i.imgur.com/vCWBwvD.png
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/eca9d2a7/attachment.html>

From mklishin at gopivotal.com  Mon Mar 24 10:15:04 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 14:15:04 +0400
Subject: [rabbitmq-discuss] Why does management plugin displays 4
 connections for each single connection creation?
In-Reply-To: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>
References: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>
Message-ID: <etPan.533005c1.643c9869.2b36@mercurio.local>

On 24 March 2014 at 14:13:42, rails (stammailbox at gmail.com) wrote:
> > Why does management plugin displays 4 connections for each  
> single connection creation?
>  
> com.rabbitmq.client.ConnectionFactory.newConnection();  
>  
> as follows
>  
> http://i.imgur.com/vCWBwvD.png
>  

Those are 4 different connections. You can see they have different
client ports.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Mar 24 10:53:29 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Mar 2014 10:53:29 +0000
Subject: [rabbitmq-discuss] Writing custom exchange type plugin
In-Reply-To: <CA+ag_wsaJ9PrmvoVaNQAA0nOTXRyF6tF4bbWwdLWWSiowcGECQ@mail.gmail.com>
References: <CA+ag_wsaJ9PrmvoVaNQAA0nOTXRyF6tF4bbWwdLWWSiowcGECQ@mail.gmail.com>
Message-ID: <53300EA9.8040509@rabbitmq.com>

On 22/03/2014 11:33PM, Adam Smith wrote:
> Hi,
>    I want to write a custom exchange type plugin to accomplish the
> following:
>
> 1. My application publishes messages to a custom exchange CUST in vhost
> MYAPP
> 2. The custom exchange plugin in turn publishes the same message to
>          a. exchange X in vhost CL1
>          b. exchange X in vhost CL2
>          .....
> The number of CLx vhosts can vary at different points in the
> application's lifetime. Any pointers on how/whether it can done would be
> greatly appreciated.

It can be done, since rabbit_exchange_type:route/2 returns a list of 
#resource{}s for the queue names to route to - and each #resource{} 
contains a virtual host. So you could mess with virtual hosts according 
to whatever logic you want in that function.

However (and it's quite a big however), RabbitMQ (and AMQP) are 
definitely not designed to work like that. Each virtual host is supposed 
to be a self-contained universe, so by routing across virtual hosts you 
are breaking the rules.

Some issues you will experience (I won't guarantee that this is a 
complete list):

1) You won't be allowed to establish a cross-vhost binding, so you'll 
have to determine how cross-vhost routing works in practice without 
reference to bindings.

2) The permissions system won't take any account of any cross-vhost 
routing you do.

3) Message rates in the management plugin might be garbled.

4) Future changes to the broker might break this completely (for 
example, if we ever move to per-vhost message stores). No such changes 
are currently on our radar though.

So this is very much "at your own risk". Virtual hosts are *designed* to 
keep things completely separate, so if you want to route messages 
between them then maybe your design should be rethought.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From stammailbox at gmail.com  Mon Mar 24 12:10:50 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 24 Mar 2014 14:10:50 +0200
Subject: [rabbitmq-discuss] Why does management plugin displays 4
 connections for each single connection creation?
In-Reply-To: <etPan.533005c1.643c9869.2b36@mercurio.local>
References: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>
 <etPan.533005c1.643c9869.2b36@mercurio.local>
Message-ID: <CAJ2-VrmjD-Bm2qFB1rh3a5vmE8+6yfV=zo0=WRgTOcWx-dWNQA@mail.gmail.com>

Thanks.
I know that they are on four different port.

I am trying to limit the number of connection each server opens.
And in order to study it better I was wondering why each connection opens 4
connections.

Thanks.




On Mon, Mar 24, 2014 at 12:15 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 24 March 2014 at 14:13:42, rails (stammailbox at gmail.com) wrote:
> > > Why does management plugin displays 4 connections for each
> > single connection creation?
> >
> > com.rabbitmq.client.ConnectionFactory.newConnection();
> >
> > as follows
> >
> > http://i.imgur.com/vCWBwvD.png
> >
>
> Those are 4 different connections. You can see they have different
> client ports.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/17249825/attachment.html>

From mklishin at gopivotal.com  Mon Mar 24 12:27:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 16:27:54 +0400
Subject: [rabbitmq-discuss] Why does management plugin displays 4
 connections for each single connection creation?
In-Reply-To: <CAJ2-VrmjD-Bm2qFB1rh3a5vmE8+6yfV=zo0=WRgTOcWx-dWNQA@mail.gmail.com>
References: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>
 <etPan.533005c1.643c9869.2b36@mercurio.local>
 <CAJ2-VrmjD-Bm2qFB1rh3a5vmE8+6yfV=zo0=WRgTOcWx-dWNQA@mail.gmail.com>
Message-ID: <etPan.533024e6.238e1f29.2b36@mercurio.local>



On 24 March 2014 at 16:13:09, rails (stammailbox at gmail.com) wrote:
> > I am trying to limit the number of connection each server opens.  
> And in order to study it better I was wondering why each connection  
> opens 4 connections.

Every RabbitMQ connection uses just one TCP connection and displayed once
in the UI. Your code either creates a connection 4 times (very likely given that
the client ports are sequential) or you leak connections.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Mar 24 12:28:52 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Mar 2014 12:28:52 +0000
Subject: [rabbitmq-discuss] Why does management plugin displays 4
 connections for each single connection creation?
In-Reply-To: <CAJ2-VrmjD-Bm2qFB1rh3a5vmE8+6yfV=zo0=WRgTOcWx-dWNQA@mail.gmail.com>
References: <CAJ2-Vrnuf9hPDRycZ_kK6G4S-ELPuc_8-NLyqvg1ET2df9TnCw@mail.gmail.com>
 <etPan.533005c1.643c9869.2b36@mercurio.local>
 <CAJ2-VrmjD-Bm2qFB1rh3a5vmE8+6yfV=zo0=WRgTOcWx-dWNQA@mail.gmail.com>
Message-ID: <53302504.5050800@rabbitmq.com>

On 24/03/2014 12:10PM, rails wrote:
> I was wondering why each connection opens 4 connections.

I promise, that's not something the clients or server do. Check your own 
code.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal

From matburton at gmail.com  Mon Mar 24 12:03:19 2014
From: matburton at gmail.com (Mat Burton)
Date: Mon, 24 Mar 2014 05:03:19 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ windows service says it's started when
	it isn't ready
Message-ID: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>

I'm using RabbitMQ 3.2.1, Erlang R16B02

The issue described in the subject causes problems for other services which 
depend on RabbitMQ

For instance if I have windows service X which has a dependency configured 
for the RabbitMQ windows service then when I start X the RabbitMQ service 
will be started first

However the RabbitMQ service reports that it's started before it's ready to 
accept connections

Hence when service X tries to start it finds it cannot connect to RabbitMQ

This is mostly a problem when the machine is restarted as the services 
which depend on RabbitMQ may fail to start

Is this a bug in RabbitMQ's windows service? Is there any way to allow 
dependencies to work?

Any other suggestion also welcome, although I really want to avoid the 
equivalent of sleeps

Thanks,
Mat B
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/82851310/attachment.html>

From cwstorm at gmail.com  Mon Mar 24 15:31:52 2014
From: cwstorm at gmail.com (cw storm)
Date: Mon, 24 Mar 2014 11:31:52 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
Message-ID: <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>

MK,

In order to use the timestamp of the message property, don't you have to
issue the "*setTimestamp
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)>"
to populate it? If so, isn't **setTimestamp
<http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)>
deprecated?*


On Fri, Mar 21, 2014 at 8:51 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 21 Mar 2014, at 16:46, cw storm <cwstorm at gmail.com> wrote:
>
> > So you're saying that the OS has to sync with the NTP server.  Once
> that's confirm, then the message property of "timestamp" can be use to
> compare to the local time on the client server, right?
>
> After that you still can get inaccurate times from some machines but the
> possibility
> of that is greatly reduced. Syncing over NTP happens periodically. For a
> lot of apps,
> syncing once every few hours is good enough.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/86f83d4c/attachment.html>

From matthias at rabbitmq.com  Mon Mar 24 15:38:31 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 24 Mar 2014 15:38:31 +0000
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
 <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
Message-ID: <53305177.6040604@rabbitmq.com>

On 24/03/14 15:31, cw storm wrote:
> In order to use the timestamp of the message property, don't you have to
> issue the "*setTimestamp
> <http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)>"
> to populate it? If so, isn't **setTimestamp
> <http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)> deprecated?*

You are meant to use the Builder classes, as described in 
http://www.rabbitmq.com/api-guide.html#classoverview

Matthias.

From mklishin at gopivotal.com  Mon Mar 24 15:44:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 19:44:30 +0400
Subject: [rabbitmq-discuss] RabbitMQ windows service says it's started
 when it isn't ready
In-Reply-To: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>
References: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>
Message-ID: <etPan.533052f9.12200854.2b36@mercurio.local>

?On 24 March 2014 at 19:32:51, Mat Burton (matburton at gmail.com) wrote:
> > Is this a bug in RabbitMQ's windows service? Is there any way  
> to allow dependencies to work?
>  
> Any other suggestion also welcome, although I really want to  
> avoid the equivalent of sleeps

Make them try to reconnect periodically.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From rtrlists at googlemail.com  Mon Mar 24 15:50:44 2014
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 24 Mar 2014 15:50:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ windows service says it's started
 when it isn't ready
In-Reply-To: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>
References: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>
Message-ID: <CAH+xwdDgo5AB5m0sSpNPi9479CdijXOBbhf3F0wBWLrRgbo7vw@mail.gmail.com>

Hi Mat,

this is a consequence of how the Windows Service is started. The erlsrv.exe
reports back to Windows when Erlang has been started. But this in no way
means that the application running in the Erlang VM has also finished
starting.

Incidentally, this is the way a lot of systems start up. JBoss startup has
the exact same issue. Although calling it an issue is debatable :-)

Two ways forward are: 1. Application level interface that allows you to
query if your system is up and open for business. 2. Put sleeps into the
startup sequence, which appears to be a common remedy, unfortunately. 3.
Ignore errors on startup and retry until stable.

Hope this helps,
Robby
 I'm using RabbitMQ 3.2.1, Erlang R16B02

The issue described in the subject causes problems for other services which
depend on RabbitMQ

For instance if I have windows service X which has a dependency configured
for the RabbitMQ windows service then when I start X the RabbitMQ service
will be started first

However the RabbitMQ service reports that it's started before it's ready to
accept connections

Hence when service X tries to start it finds it cannot connect to RabbitMQ

This is mostly a problem when the machine is restarted as the services
which depend on RabbitMQ may fail to start

Is this a bug in RabbitMQ's windows service? Is there any way to allow
dependencies to work?

Any other suggestion also welcome, although I really want to avoid the
equivalent of sleeps

Thanks,
Mat B

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/d7c01c86/attachment.html>

From matthias at rabbitmq.com  Mon Mar 24 16:17:43 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 24 Mar 2014 16:17:43 +0000
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <CANPo+3UbaJ8_vMHhvRApKhKpJLbqA_wf1gvHANB-85dKuzyg0g@mail.gmail.com>
References: <CANPo+3WLFODiFGxeBbG22UXVLQ_hAH+MSbp2nyTg8gh9Q_3v2A@mail.gmail.com>	<532ECF33.9060303@rabbitmq.com>
 <CANPo+3UbaJ8_vMHhvRApKhKpJLbqA_wf1gvHANB-85dKuzyg0g@mail.gmail.com>
Message-ID: <53305AA7.90503@rabbitmq.com>

On 23/03/14 12:34, inbal doron wrote:
> I am running version 3.1.5 of rabbitmq (erlang version: r16b02).
> the mnesia dir in the os volume which is ssd raid 1.
> have you encountered any problems working with ssd?

There should be no issues with SSDs. In fact rabbit loves them.

I've found a bug to look into this. We could make the rabbit code more 
defensive here, but I'd quite like to understand what would cause an 
intermittent failure of running 'dir'.

Matthias.

From matthias at rabbitmq.com  Mon Mar 24 16:30:05 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 24 Mar 2014 16:30:05 +0000
Subject: [rabbitmq-discuss] rabbitmq webstomp ha-mode
In-Reply-To: <61B528C1-5488-4BAF-BA5B-9E8A19062D08@ivendi.com>
References: <0c15f16a-e56c-436d-ba1b-fc8473bd4a6b@googlegroups.com>
 <5329984B.9040608@rabbitmq.com>
 <61B528C1-5488-4BAF-BA5B-9E8A19062D08@ivendi.com>
Message-ID: <53305D8D.5050402@rabbitmq.com>

On 19/03/14 13:39, steve.flitcroft at ivendi.com wrote:
> Non web socket clients (ie9, stock android, old ios/safari etc)
> always lost connection. As soon as I restrict the clients without a
> web socket upgrade hdr to goto the same rmq node then they stay
> connected.  I can prove this very easily in my current setup with
> clients connecting to the rmq cluster via haproxy.

As Simon said, the amq.gen* queue is declared as exclusive. That means 
it will only be accessible on the connection that created it (and will 
be deleted when that connection terminates). Clients that "roam" between 
nodes are not going to be able to maintain a subscription to such a queue.

Matthias.

From matthias at rabbitmq.com  Mon Mar 24 17:03:07 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 24 Mar 2014 17:03:07 +0000
Subject: [rabbitmq-discuss] Issues getting RabbitMQ running using apt-get
In-Reply-To: <CF47219D.BC02%frame@snhdmail.org>
References: <CF47219D.BC02%frame@snhdmail.org>
Message-ID: <5330654B.1060108@rabbitmq.com>

On 13/03/14 15:48, Jason Frame wrote:
> When the dpkg starts the rabbitmq server, the process hangs with the
>  following output:
>
> Setting up rabbitmq-server (3.2.4-1) ...
>
> * Starting message broker rabbitmq-server
>
>
> The processing never continues and the dpkg script never finishes,

I know you posted the startup_log before, but is there anything in the 
other log files, i.e. startup_err and rabbit at webdb.log and 
rabbit at webdb-sasl.log?

 From the 'ps' output it looks like it may be stuck in dns resolution, 
which suggests that something isn't quite right with your name 
resolution setup.

It may also be worth upgrading Erlang - you are running R14B04, which is 
2.5 years old.

Matthias.

From cwstorm at gmail.com  Mon Mar 24 17:08:50 2014
From: cwstorm at gmail.com (cw storm)
Date: Mon, 24 Mar 2014 13:08:50 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <53305177.6040604@rabbitmq.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
 <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
 <53305177.6040604@rabbitmq.com>
Message-ID: <CAETr1H-2F1RYqQia1WgYTdqaRw9x9brFxCpHat2CmfM46TxtAw@mail.gmail.com>

So, something like props.Timestamp = DateTime.Now

However, during the consumption process, is it easy enough to compare the
timestamp value?  I'm guessing that's why you mentioned that the client
local server needs to be in sync with the NTP, right?


On Mon, Mar 24, 2014 at 11:38 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 24/03/14 15:31, cw storm wrote:
>
>> In order to use the timestamp of the message property, don't you have to
>> issue the "*setTimestamp
>> <http://www.rabbitmq.com/releases/rabbitmq-java-client/
>> v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/
>> client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)>"
>> to populate it? If so, isn't **setTimestamp
>> <http://www.rabbitmq.com/releases/rabbitmq-java-client/
>> v3.1.3/rabbitmq-java-client-javadoc-3.1.3/com/rabbitmq/
>> client/AMQP.BasicProperties.html#setTimestamp(java.util.Date)>
>> deprecated?*
>>
>
> You are meant to use the Builder classes, as described in
> http://www.rabbitmq.com/api-guide.html#classoverview
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/07152722/attachment.html>

From mklishin at gopivotal.com  Mon Mar 24 17:19:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 21:19:50 +0400
Subject: [rabbitmq-discuss] RabbitMQ Web-Stomp Plugin securing the
 connection to the message broke
In-Reply-To: <CAOy42Cvsnka_BOMffNmVpKTuVwO8sz==6KzVmLDDN-ajL-rPtw@mail.gmail.com>
References: <CAOy42Cvsnka_BOMffNmVpKTuVwO8sz==6KzVmLDDN-ajL-rPtw@mail.gmail.com>
Message-ID: <etPan.53306952.216231b.2b36@mercurio.local>

?On 19 March 2014 at 16:49:03, Spico Florin (spicoflorin at gmail.com) wrote:
> > I would like to use this approach in an an application that will  
> be installed on production mode.
> Unfortunately, the code:
>  
>  
> client.connect('guest', 'guest', on_connect, on_error,  
> '/');
>  
> is node acceptable for the security point of view. Therefore,  
> can you please provide me
> the right solution on how to han

Fetch credentials from the server over HTTPS
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Mar 24 17:22:20 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 24 Mar 2014 21:22:20 +0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H-2F1RYqQia1WgYTdqaRw9x9brFxCpHat2CmfM46TxtAw@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
 <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
 <53305177.6040604@rabbitmq.com>
 <CAETr1H-2F1RYqQia1WgYTdqaRw9x9brFxCpHat2CmfM46TxtAw@mail.gmail.com>
Message-ID: <etPan.533069e6.1190cde7.2b36@mercurio.local>

?On 24 March 2014 at 21:11:12, cw storm (cwstorm at gmail.com) wrote:
> > However, during the consumption process, is it easy enough  
> to compare the timestamp value?

About as easy as comparing two dates.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matburton at gmail.com  Mon Mar 24 20:23:56 2014
From: matburton at gmail.com (Mat Burton)
Date: Mon, 24 Mar 2014 20:23:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ windows service says it's started
 when it isn't ready
In-Reply-To: <CAH+xwdDgo5AB5m0sSpNPi9479CdijXOBbhf3F0wBWLrRgbo7vw@mail.gmail.com>
References: <da158788-6238-4055-94f4-d0afe7bbbcbb@googlegroups.com>
 <CAH+xwdDgo5AB5m0sSpNPi9479CdijXOBbhf3F0wBWLrRgbo7vw@mail.gmail.com>
Message-ID: <CAD4N5E_=wFjWzd+Q3NWY49GyDSc97UGj-Z_3OPzD=k1L=EkxdQ@mail.gmail.com>

Hey Rob,

Thanks for the quick response

We use our message bus to report diagnostic data which means option 3 isn't
really an option.
We wouldn't know when a service somewhere was started but dead in the water
until our monitoring system noticed a lack of activity later.
Worse we could miss real error reports etc because we'd have no where to
send them if we started without a stable connection.

I guess we'll have to use option 2 and leave our services in a starting
state until they manage to connect to RabbitMQ.
I believe a service can request an additional minute of starting time
upfront, which should be sufficient in most cases.

Many thanks,
Mat B


On 24 March 2014 15:50, Robert Raschke <rtrlists at googlemail.com> wrote:

> Hi Mat,
>
> this is a consequence of how the Windows Service is started. The
> erlsrv.exe reports back to Windows when Erlang has been started. But this
> in no way means that the application running in the Erlang VM has also
> finished starting.
>
> Incidentally, this is the way a lot of systems start up. JBoss startup has
> the exact same issue. Although calling it an issue is debatable :-)
>
> Two ways forward are: 1. Application level interface that allows you to
> query if your system is up and open for business. 2. Put sleeps into the
> startup sequence, which appears to be a common remedy, unfortunately. 3.
> Ignore errors on startup and retry until stable.
>
> Hope this helps,
> Robby
>  I'm using RabbitMQ 3.2.1, Erlang R16B02
>
> The issue described in the subject causes problems for other services
> which depend on RabbitMQ
>
> For instance if I have windows service X which has a dependency configured
> for the RabbitMQ windows service then when I start X the RabbitMQ service
> will be started first
>
> However the RabbitMQ service reports that it's started before it's ready
> to accept connections
>
> Hence when service X tries to start it finds it cannot connect to RabbitMQ
>
> This is mostly a problem when the machine is restarted as the services
> which depend on RabbitMQ may fail to start
>
> Is this a bug in RabbitMQ's windows service? Is there any way to allow
> dependencies to work?
>
> Any other suggestion also welcome, although I really want to avoid the
> equivalent of sleeps
>
> Thanks,
> Mat B
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/91520b8d/attachment.html>

From srikanthtns at gmail.com  Tue Mar 25 00:15:18 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Mon, 24 Mar 2014 17:15:18 -0700
Subject: [rabbitmq-discuss] Stomp connections ending suddenly
Message-ID: <CAOU_jKBna9GpKUfdCrNARatD=1+p0TYNXAdj1EVJjPWmay2pnQ@mail.gmail.com>

Hi , we are using rabbitmq version 2.3.1 along with mcollective framework
for orchestrating infrastructure services. we noticed today all of the
stomp connections dropped down from 8000 to 30 nodes
I saw these messages logged for over 2 mins dropping all connections .
After a while the connections re-established after an hour . Can we know
what the parameter settings to be done to improvise the performance of
rabbitmq on this ? also we are having like around 8000+ nodes connected to
stomp connector plugin on port 6163

Thanks
Srikanth

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.23655.763> from 10.231.241.133:43756

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.28257.711> from 10.231.242.215:38022

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.9779.735> from 10.233.243.89:54196

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.30332.763> from 10.233.245.240:51954

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.31601.715> from 10.233.244.53:33291

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.19379.749> from 10.210.97.65:36081

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
ending STOMP connection <0.18112.1184> from 140.84.21.214:50319

=INFO REPORT==== 24-Mar-2014::03:51:40 ===
accepted TCP connection on 140.84.21.213:6163 from 140.84.21.214:50320

=WARNING REPORT==== 24-Mar-2014::03:51:40 ===
Mnesia(rabbit at adsmv0010): ** WARNING ** Mnesia is overloaded: {dump_log,

 write_threshold}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/f2b69263/attachment.html>

From arunrao.seattle at gmail.com  Tue Mar 25 05:56:48 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Mon, 24 Mar 2014 22:56:48 -0700
Subject: [rabbitmq-discuss] Queue Failover and restore
Message-ID: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>

Hi guys -

I have 4 nodes with 4 queues on each node. HA policy is set to exactly 2
nodes, so I have exactly one mirror.

When a node fails, 4 queues on this node get distributed to the other 3
nodes.

After I bring the failed node backup, this failed node now only has mirrors
and no queues now live on this failed node. How can I push queues to this
failed node without deleting the queue and recreating it?

Even after restarting the entire cluster, I dont seem to get my original
setup back.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/b64d1d2b/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 06:39:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 10:39:07 +0400
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
Message-ID: <etPan.533124a7.6b8b4567.ed0@mercurio.local>

On 25 March 2014 at 09:59:06, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > I have 4 nodes with 4 queues on each node. HA policy is set to exactly  
> 2 nodes, so I have exactly one mirror.
>  
> When a node fails, 4 queues on this node get distributed to the  
> other 3 nodes.
>  
> After I bring the failed node backup, this failed node now only  
> has mirrors and no queues now live on this failed node. How can  
> I push queues to this failed node without deleting the queue and  
> recreating it?
>  
> Even after restarting the entire cluster, I dont seem to get my  
> original setup back.

You can?t . Why do you need the queues to be on a specific node?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Tue Mar 25 06:47:02 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Mon, 24 Mar 2014 23:47:02 -0700
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <etPan.533124a7.6b8b4567.ed0@mercurio.local>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
Message-ID: <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>

I am under the impression I get more throughput having 16 queues living on
4 different nodes compared to 16 queues living on 3 nodes. This difference
becomes noticeable when the number of messages ready picked up are
significantly higher? This actually goes back to making queues local and
providing more hardware. Am i mistaken?


On Mon, Mar 24, 2014 at 11:39 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 25 March 2014 at 09:59:06, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > > I have 4 nodes with 4 queues on each node. HA policy is set to exactly
> > 2 nodes, so I have exactly one mirror.
> >
> > When a node fails, 4 queues on this node get distributed to the
> > other 3 nodes.
> >
> > After I bring the failed node backup, this failed node now only
> > has mirrors and no queues now live on this failed node. How can
> > I push queues to this failed node without deleting the queue and
> > recreating it?
> >
> > Even after restarting the entire cluster, I dont seem to get my
> > original setup back.
>
> You can't . Why do you need the queues to be on a specific node?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140324/c0974a8e/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 06:52:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 10:52:55 +0400
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
Message-ID: <etPan.533127e2.643c9869.ed0@mercurio.local>

On 25 March 2014 at 10:49:26, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > I am under the impression I get more throughput having 16 queues  
> living on 4 different nodes compared to 16 queues living on 3 nodes.  
> This difference becomes noticeable when the number of messages  
> ready picked up are significantly higher? This actually goes  
> back to making queues local and providing more hardware. Am i  
> mistaken?

This is partially true. What matters is publisher and consumer locality.
For maximum throughput you want to avoid intra-cluster traffic.

In an HA setup, your clients need to reconnect to another node, so likely
you won?t get in a situation when most clients are connected to a single node.

If that?s not good enough, you can use HTTP API to find what node hosts master
for the queue in question and connect there.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Tue Mar 25 07:06:14 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Tue, 25 Mar 2014 00:06:14 -0700
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <etPan.533127e2.643c9869.ed0@mercurio.local>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
Message-ID: <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>

Hi Michael -

Thanks for your quick response, as always!

I am already monitoring node column in HTTP API for queues. I get to know
when there is a node failure and I see the queue distribution on nodes as a
pie chart.

After I bring the node back up, I cannot help redistribute queues evenly
again. I am processing several hundred Gigabytes of data per day. CPU Usage
on nodes where queues live and delivery rates are directly related to
number of messages remaining in my queues, that is why I want to
redistribute the queues back again.

(Please note: I have enough consumers to listen on all nodes.)

Please advise if this would make sense to provide an option via rabbitmqctl
or rabbitmqadmin or via management UI?

Thanks for your help!


On Mon, Mar 24, 2014 at 11:52 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 25 March 2014 at 10:49:26, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > > I am under the impression I get more throughput having 16 queues
> > living on 4 different nodes compared to 16 queues living on 3 nodes.
> > This difference becomes noticeable when the number of messages
> > ready picked up are significantly higher? This actually goes
> > back to making queues local and providing more hardware. Am i
> > mistaken?
>
> This is partially true. What matters is publisher and consumer locality.
> For maximum throughput you want to avoid intra-cluster traffic.
>
> In an HA setup, your clients need to reconnect to another node, so likely
> you won't get in a situation when most clients are connected to a single
> node.
>
> If that's not good enough, you can use HTTP API to find what node hosts
> master
> for the queue in question and connect there.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/ad8bd609/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 07:12:40 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 11:12:40 +0400
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
 <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
Message-ID: <etPan.53312c82.74b0dc51.ed0@mercurio.local>

On 25 March 2014 at 11:08:37, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > Please advise if this would make sense to provide an option via  
> rabbitmqctl or rabbitmqadmin or via management UI?

An option to pin queues to nodes?

In the specific case of 2 nodes per queue, you can try
ha-mode ?nodes?:

http://www.rabbitmq.com/ha.html

In the general case, however, I?m not sure how much complexity
queue pinning would entail. But I agree that for pushing 100s of GBs
or TBs of data, this kind of locality is very desirable.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Tue Mar 25 07:17:20 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Tue, 25 Mar 2014 00:17:20 -0700
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <etPan.53312c82.74b0dc51.ed0@mercurio.local>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
 <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
 <etPan.53312c82.74b0dc51.ed0@mercurio.local>
Message-ID: <CAEJg2GBvrQ0MjCAN0LD0PfNpE9e9ofH9Zc8iCtqi3ZHq8FmLFg@mail.gmail.com>

Unfortunately, pinning "mirror" queues to nodes have the same problem :( I
cannot bring back my queues to original nodes.

Thanks!


On Tue, Mar 25, 2014 at 12:12 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 25 March 2014 at 11:08:37, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > > Please advise if this would make sense to provide an option via
> > rabbitmqctl or rabbitmqadmin or via management UI?
>
> An option to pin queues to nodes?
>
> In the specific case of 2 nodes per queue, you can try
> ha-mode "nodes":
>
> http://www.rabbitmq.com/ha.html
>
> In the general case, however, I'm not sure how much complexity
> queue pinning would entail. But I agree that for pushing 100s of GBs
> or TBs of data, this kind of locality is very desirable.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/22f9f656/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 07:21:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 11:21:24 +0400
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <CAEJg2GBvrQ0MjCAN0LD0PfNpE9e9ofH9Zc8iCtqi3ZHq8FmLFg@mail.gmail.com>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
 <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
 <etPan.53312c82.74b0dc51.ed0@mercurio.local>
 <CAEJg2GBvrQ0MjCAN0LD0PfNpE9e9ofH9Zc8iCtqi3ZHq8FmLFg@mail.gmail.com>
Message-ID: <etPan.53312e91.2ae8944a.ed0@mercurio.local>

On 25 March 2014 at 11:19:41, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > Unfortunately, pinning "mirror" queues to nodes have the same  
> problem :( I cannot bring back my queues to original nodes.

Yes but now you know what nodes master can be on, so if A is down,
connect to B. This slightly simplifies reconnection logic in the client.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From arunrao.seattle at gmail.com  Tue Mar 25 07:31:07 2014
From: arunrao.seattle at gmail.com (Arun Rao)
Date: Tue, 25 Mar 2014 00:31:07 -0700
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <etPan.53312e91.2ae8944a.ed0@mercurio.local>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
 <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
 <etPan.53312c82.74b0dc51.ed0@mercurio.local>
 <CAEJg2GBvrQ0MjCAN0LD0PfNpE9e9ofH9Zc8iCtqi3ZHq8FmLFg@mail.gmail.com>
 <etPan.53312e91.2ae8944a.ed0@mercurio.local>
Message-ID: <CAEJg2GBukhwgondHQztZx0SNc-rKnWWkH_z+HKV0_17zDJbHyA@mail.gmail.com>

I dont have any issues with this or otherwise in terms of reconnection
logic. I just get my cluster processing power evenly distributed on all
nodes. Per day, when I process 300 Gigs of data on a 4 node cluster. These
300 Gigs are split as 75 gigs per node and process messages accordingly. If
there is a node failure, this increases to 100 Gigs per node. This is a
substantial increase during peak periods.

My only option now is to stop all the nodes from taking traffic, delete the
queues and apply HA again.

Thanks!


On Tue, Mar 25, 2014 at 12:21 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 25 March 2014 at 11:19:41, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > > Unfortunately, pinning "mirror" queues to nodes have the same
> > problem :( I cannot bring back my queues to original nodes.
>
> Yes but now you know what nodes master can be on, so if A is down,
> connect to B. This slightly simplifies reconnection logic in the client.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/eb092edb/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 07:57:45 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 11:57:45 +0400
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <CAEJg2GBukhwgondHQztZx0SNc-rKnWWkH_z+HKV0_17zDJbHyA@mail.gmail.com>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
 <CAEJg2GB_vN_peXo3KbhW7KjpeKVXUoWpbkfzRd_yyCEpwHj67Q@mail.gmail.com>
 <etPan.533127e2.643c9869.ed0@mercurio.local>
 <CAEJg2GDBBg5=gfMU7RxFMvggKABUKtUhCAYZPzU__qQ1JvTE_Q@mail.gmail.com>
 <etPan.53312c82.74b0dc51.ed0@mercurio.local>
 <CAEJg2GBvrQ0MjCAN0LD0PfNpE9e9ofH9Zc8iCtqi3ZHq8FmLFg@mail.gmail.com>
 <etPan.53312e91.2ae8944a.ed0@mercurio.local>
 <CAEJg2GBukhwgondHQztZx0SNc-rKnWWkH_z+HKV0_17zDJbHyA@mail.gmail.com>
Message-ID: <etPan.53313716.238e1f29.ed0@mercurio.local>



On 25 March 2014 at 11:33:27, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > These 300 Gigs are split as 75 gigs per node and process messages  
> accordingly. If there is a node failure, this increases to 100  
> Gigs per node. This is a substantial increase during peak periods.  

Understandable.

> My only option now is to stop all the nodes from taking traffic,  
> delete the queues and apply HA again.

Have you considered sticking a proxy in front of the cluster?
It may be quite effective (and HAproxy supports several load balancing
modes, including ?least connected? and client IP hashing).

This would still require clients to reconnect after node recovery
but sounds a lot less intrusive than shutting down the entire system.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Tue Mar 25 00:11:42 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Tue, 25 Mar 2014 00:11:42 +0000
Subject: [rabbitmq-discuss] Federation/Connection issues
Message-ID: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>

Hi all,

Our Rabbit had a bit of an accident this weekend - the 3.2.1 cluster accidentally got rebooted all at once.  When MNESIA went down on the second node, it crashed so hard it dropped the disk.  That said, we had the JSON backups on the other two boxes, neither of which wanted to start without the master, so I decided rather than fight them I'd just pull the backup and rebuild the cluster.  When I rebuilt the cluster it came back up on 3.2.4, the latest build, I restored and everything seemed fine.  At first.

By the next morning the master node of the cluster had 1,020,000 erlang processes running (approximately - the actual number was slightly higher) and was deep in the red.  Federation wasn't working, and so we made the call to cleanly shutdown the cluster and bring it back.  Attempting to run rabbitmqctl on the node with the erlang processes resulted in erl_crash dumps, and it had to be rebooted.  Another node took over the master spot, and that was when we noticed the issue.

Federation is spinning up internal connections left, right and center.  It had spawn 56,000 connection on the node that failed overnight.  We tried to rebuild the cluster, but as soon as we loaded the backup it was the same thing - connections started spawning, even when it was isolated from the network and any true outside connections.  We tried rebuilding it back to 3.2.1, and then 3.2.0, we tried old backups from November and October of last year, we tried restoring backups from our Dev and Stage environments.  All spawn these connection issues.

Finally, we disabled the federation plugin and restarted Rabbit.  The connections stopped.  We then tried reenabling the plugin and restarting again.  In 3.2.1, the connections skyrocket again.  In 3.2.4, they climb, but much, much more slowly - a few dozen connections a minute as opposed to hundreds or thousands.

I've attached the output of rabbitmqctl report from one of our nodes while the processes were climbing.  We've currently disabled federation in prod, but we're looking for a better solution.  Ideas?

Thank you very much,
Kale Ganann
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/b41d5fcc/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report.zip
Type: application/x-zip-compressed
Size: 783348 bytes
Desc: report.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/b41d5fcc/attachment-0001.bin>

From mklishin at gopivotal.com  Tue Mar 25 08:54:40 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 12:54:40 +0400
Subject: [rabbitmq-discuss] Federation/Connection issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
Message-ID: <etPan.5331446c.3d1b58ba.ed0@mercurio.local>

?On 25 March 2014 at 12:46:20, Ganann, Kale (kganann at kroll.com) wrote:
> > I?ve attached the output of rabbitmqctl report from one of our  
> nodes while the processes were climbing. We?ve currently disabled  
> federation in prod, but we?re looking for a better solution.  
> Ideas?

Can you please look at log files to see if there are any error
messages, stack traces, etc. There likely will be something.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Mar 25 08:55:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 12:55:01 +0400
Subject: [rabbitmq-discuss] Federation/Connection issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
Message-ID: <etPan.53314482.2eb141f2.ed0@mercurio.local>

?On 25 March 2014 at 12:46:20, Ganann, Kale (kganann at kroll.com) wrote:
> > When MNESIA went down on the second node, it crashed so hard it  
> dropped the disk.

Sorry, what specifically do you mean by ?dropped the disk??
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From dmcintyre at gopivotal.com  Tue Mar 25 09:50:30 2014
From: dmcintyre at gopivotal.com (Duncan McIntyre)
Date: Tue, 25 Mar 2014 09:50:30 +0000
Subject: [rabbitmq-discuss] Queue Failover and restore
In-Reply-To: <etPan.533124a7.6b8b4567.ed0@mercurio.local>
References: <CAEJg2GCqDZr9+kq3U4jCBTbH1VE=pFYbJvMz-EisC5zWsje1zA@mail.gmail.com>
 <etPan.533124a7.6b8b4567.ed0@mercurio.local>
Message-ID: <CAAaVn2AU4NuMNtOwHdHZoceZ2AK8Bg-523mnc5YDZpiUGG5Qdg@mail.gmail.com>

You could use ha-mode nodes to move it to the node you want to be the
master, then change the policy to replicate it again. The disadvantage
being that you risk losing the queue if the master fails before the queue
has been replicated again.

Or, you could use ha-mode nodes to move it around pairs of nodes in the
cluster, until eventually the master was on the node you wanted, and it
will have been replicated at all times.


---
Duncan


On Tue, Mar 25, 2014 at 6:39 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 25 March 2014 at 09:59:06, Arun Rao (arunrao.seattle at gmail.com) wrote:
> > > I have 4 nodes with 4 queues on each node. HA policy is set to exactly
> > 2 nodes, so I have exactly one mirror.
> >
> > When a node fails, 4 queues on this node get distributed to the
> > other 3 nodes.
> >
> > After I bring the failed node backup, this failed node now only
> > has mirrors and no queues now live on this failed node. How can
> > I push queues to this failed node without deleting the queue and
> > recreating it?
> >
> > Even after restarting the entire cluster, I dont seem to get my
> > original setup back.
>
> You can't . Why do you need the queues to be on a specific node?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/653744e2/attachment.html>

From michael.laing at nytimes.com  Tue Mar 25 10:12:16 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 25 Mar 2014 06:12:16 -0400
Subject: [rabbitmq-discuss] Writing custom exchange type plugin
In-Reply-To: <53300EA9.8040509@rabbitmq.com>
References: <CA+ag_wsaJ9PrmvoVaNQAA0nOTXRyF6tF4bbWwdLWWSiowcGECQ@mail.gmail.com>
 <53300EA9.8040509@rabbitmq.com>
Message-ID: <CAKgmDnGwT6evwWbokWLbQ_CYTKdBj_6pmmtN7ewnW64iUhPV-w@mail.gmail.com>

We implement our nyt?a?rik system as a collection of vhost nodes. The
vhosts are named according to a set of rules: role, region, product,
organization, environment (dev, stage, production), etc.

The vhosts are multiply connected via shovels and federation.

The mapping of vhosts to hosts varies. For example, in production we
usually run 1 vhost per host spread across many regions/zones in the cloud.
For dev, I can run the exact same configuration on my mac using a single
cluster with vhosts representing all the roles, regions, etc.

The point with regard to the OP is that you can architect using multiple
vhosts, and there can be benefits, as we realize. But you should consider
the separation Simon referred to as a virtue, using it to maintain a
flexible and reliable arrangement of loosely coupled strong components.

Best regards,

Michael


On Mon, Mar 24, 2014 at 6:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 22/03/2014 11:33PM, Adam Smith wrote:
>
>> Hi,
>>    I want to write a custom exchange type plugin to accomplish the
>> following:
>>
>> 1. My application publishes messages to a custom exchange CUST in vhost
>> MYAPP
>> 2. The custom exchange plugin in turn publishes the same message to
>>          a. exchange X in vhost CL1
>>          b. exchange X in vhost CL2
>>          .....
>> The number of CLx vhosts can vary at different points in the
>> application's lifetime. Any pointers on how/whether it can done would be
>> greatly appreciated.
>>
>
> It can be done, since rabbit_exchange_type:route/2 returns a list of
> #resource{}s for the queue names to route to - and each #resource{}
> contains a virtual host. So you could mess with virtual hosts according to
> whatever logic you want in that function.
>
> However (and it's quite a big however), RabbitMQ (and AMQP) are definitely
> not designed to work like that. Each virtual host is supposed to be a
> self-contained universe, so by routing across virtual hosts you are
> breaking the rules.
>
> Some issues you will experience (I won't guarantee that this is a complete
> list):
>
> 1) You won't be allowed to establish a cross-vhost binding, so you'll have
> to determine how cross-vhost routing works in practice without reference to
> bindings.
>
> 2) The permissions system won't take any account of any cross-vhost
> routing you do.
>
> 3) Message rates in the management plugin might be garbled.
>
> 4) Future changes to the broker might break this completely (for example,
> if we ever move to per-vhost message stores). No such changes are currently
> on our radar though.
>
> So this is very much "at your own risk". Virtual hosts are *designed* to
> keep things completely separate, so if you want to route messages between
> them then maybe your design should be rethought.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/82c230d3/attachment.html>

From jarmo.myllyvirta at flashnode.com  Tue Mar 25 13:08:20 2014
From: jarmo.myllyvirta at flashnode.com (Jarmo Myllyvirta)
Date: Tue, 25 Mar 2014 15:08:20 +0200
Subject: [rabbitmq-discuss] Nested consuming and publishing
Message-ID: <AE8DB48BD9B74DEEBD1A8586672B1F9C@pc>

Hi,
I have a consumer that I would want do the following:
- Consume message from queue Q1
- Ack the message to the Q1 and publish it another queue Q2
- Then I want to to process the message and ack it to also the queue Q2 (if process was ok). On error message would stay in Q2.
Is it possible do that all in one consumer?
This way I could handle errors better in the message process phase. 
I?m using php-amqplib as client.
Cheers,
Jarmo M.
Flashnode
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/f36f0bec/attachment.html>

From mklishin at gopivotal.com  Tue Mar 25 13:11:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 17:11:19 +0400
Subject: [rabbitmq-discuss] Nested consuming and publishing
In-Reply-To: <AE8DB48BD9B74DEEBD1A8586672B1F9C@pc>
References: <AE8DB48BD9B74DEEBD1A8586672B1F9C@pc>
Message-ID: <etPan.53318090.79e2a9e3.ed0@mercurio.local>

On 25 March 2014 at 17:09:33, Jarmo Myllyvirta (jarmo.myllyvirta at flashnode.com) wrote:
> > - Consume message from queue Q1
> - Ack the message to the Q1 and publish it another queue Q2
> - Then I want to to process the message and ack it to also the queue  
> Q2 (if process was ok). On error message would stay in Q2.
> Is it possible do that all in one consumer??
> This way I could handle errors better in the message process phase.  

You can consume using the same consumer from multiple queues.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Mar 25 13:12:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 17:12:25 +0400
Subject: [rabbitmq-discuss] Nested consuming and publishing
In-Reply-To: <AE8DB48BD9B74DEEBD1A8586672B1F9C@pc>
References: <AE8DB48BD9B74DEEBD1A8586672B1F9C@pc>
Message-ID: <etPan.533180d4.515f007c.ed0@mercurio.local>

?On 25 March 2014 at 17:09:33, Jarmo Myllyvirta (jarmo.myllyvirta at flashnode.com) wrote:
> > You can consume using the same consumer from multiple queues.  

It?s worth pointing out that delivery tags (and thus acks, nacks, etc) are
scoped per channel, not per queue or consumer.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Mar 25 13:41:42 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Mar 2014 13:41:42 +0000
Subject: [rabbitmq-discuss] Stomp connections ending suddenly
In-Reply-To: <CAOU_jKBna9GpKUfdCrNARatD=1+p0TYNXAdj1EVJjPWmay2pnQ@mail.gmail.com>
References: <CAOU_jKBna9GpKUfdCrNARatD=1+p0TYNXAdj1EVJjPWmay2pnQ@mail.gmail.com>
Message-ID: <53318796.1020407@rabbitmq.com>

On 25/03/2014 00:15, srikanth tns wrote:
> Hi , we are using rabbitmq version 2.3.1

That's a really old version - lots of bugs have been fixed since then. 
In particular the "Mnesia is overloaded" warning should no longer be 
seen. I strongly recommend an upgrade.

Cheers, Simon


From cwstorm at gmail.com  Tue Mar 25 16:00:45 2014
From: cwstorm at gmail.com (cw storm)
Date: Tue, 25 Mar 2014 12:00:45 -0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <etPan.533069e6.1190cde7.2b36@mercurio.local>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
 <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
 <53305177.6040604@rabbitmq.com>
 <CAETr1H-2F1RYqQia1WgYTdqaRw9x9brFxCpHat2CmfM46TxtAw@mail.gmail.com>
 <etPan.533069e6.1190cde7.2b36@mercurio.local>
Message-ID: <CAETr1H_E7Zn6QODbo3_9QYy5_oto0Ognd7TqgDhSgb3zaLPqeA@mail.gmail.com>

MK,

Is it safe to compare whatever value in the timestamp property since it's
store as a 64-bit time format? or do I have to painly go through converting
it to an actual date time and comparing it?  I'm leaning toward the former.


On Mon, Mar 24, 2014 at 1:22 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>  On 24 March 2014 at 21:11:12, cw storm (cwstorm at gmail.com) wrote:
> > > However, during the consumption process, is it easy enough
> > to compare the timestamp value?
>
> About as easy as comparing two dates.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/82e3a4a9/attachment.html>

From behrk2 at gmail.com  Tue Mar 25 17:49:49 2014
From: behrk2 at gmail.com (Kevin Behr)
Date: Tue, 25 Mar 2014 13:49:49 -0400
Subject: [rabbitmq-discuss] RabbitMQ join_cluster error
Message-ID: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>

Hello,

I am trying to cluster a slave node (rabbit2) with a master node (rabbit1)
in RabbitMQ. I am receiving the following error from the
join_clustercommand, though. I don't know Erlang, so I am having
trouble determining
the cause. Any ideas as to what the error is, or how to fix it?

Both nodes can talk to each other via ping, and I have ensured that the
.erlang.cookie for each node is the same.

root at rabbit2:~# rabbitmqctl stop_app
root at rabbit2:~# rabbitmqctl join_cluster rabbit at rabbit1
Clustering node 'rabbit at rabbit2' with 'rabbit at rabbit1' ...
Error: {{case_clause,
            {{error,
                 {aborted,
                     {function_clause,
                         [{mnesia_schema,cs2list,
                              [{cstruct,schema,set,[],
                                   ['rabbit at rabbit1'],
                                   [],0,read_write,false,[],[],false,schema,
                                   [table,cstruct],
                                   [],[],[],
                                   {{1395,763528,28278},
                                    'rabbit at rabbit1'},
                                   {{2,0},[]}}]},
                          {mnesia_schema,do_merge_schema,1},
                          {mnesia_tm,apply_fun,3},
                          {mnesia_tm,execute_transaction,5},
                          {mnesia_schema,schema_coordinator,3}]}}},
             ['rabbit at rabbit1']}},
        [{rabbit_mnesia,change_extra_db_nodes,2},
         {rabbit_mnesia,init_db,3},
         {rabbit_mnesia,init_db_and_upgrade,3},
         {rabbit_mnesia,init_db_with_mnesia,4},
         {rabbit_mnesia,join_cluster,2},
         {rpc,'-handle_call_call/6-fun-0-',5}]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/68586f30/attachment.html>

From srikanthtns at gmail.com  Tue Mar 25 18:01:50 2014
From: srikanthtns at gmail.com (srikanth tns)
Date: Tue, 25 Mar 2014 11:01:50 -0700
Subject: [rabbitmq-discuss] Stomp connections ending suddenly
In-Reply-To: <53318796.1020407@rabbitmq.com>
References: <CAOU_jKBna9GpKUfdCrNARatD=1+p0TYNXAdj1EVJjPWmay2pnQ@mail.gmail.com>
 <53318796.1020407@rabbitmq.com>
Message-ID: <CAOU_jKB7E7zwBqv05JQq+RORT9Ym7Bf9_ikuhKpR2nsuvSM6XA@mail.gmail.com>

What is the latest stable version of Rabbitmq/Erlang to be used for
Production ? we have 8000+ nodes connecting to a single broker running on
Linux OS.
Also do we have a recommendation of tuning parameters to be done for
Rabbitmq/Erlang in Production ?

Thanks
Srikanth


On Tue, Mar 25, 2014 at 6:41 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/03/2014 00:15, srikanth tns wrote:
>
>> Hi , we are using rabbitmq version 2.3.1
>>
>
> That's a really old version - lots of bugs have been fixed since then. In
> particular the "Mnesia is overloaded" warning should no longer be seen. I
> strongly recommend an upgrade.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/464d8f1b/attachment.html>

From simon at rabbitmq.com  Tue Mar 25 18:08:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Mar 2014 18:08:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ join_cluster error
In-Reply-To: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>
References: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>
Message-ID: <5331C60C.5060006@rabbitmq.com>

That looks like the nodes of the cluster are running different Erlang 
versions. They should all be on the same version.

That said, I thought we'd converted that to a more intelligible error 
message (it could hardly be less). Which version of RabbitMQ are you 
running?

Cheers, Simon

On 25/03/2014 17:49, Kevin Behr wrote:
> Hello,
>
> I am trying to cluster a slave node (rabbit2) with a master node
> (rabbit1) in RabbitMQ. I am receiving the following error from the
> |join_cluster| command, though. I don't know Erlang, so I am having
> trouble determining the cause. Any ideas as to what the error is, or how
> to fix it?
>
> Both nodes can talk to each other via ping, and I have ensured that the
> .erlang.cookie for each node is the same.
>
> |root at rabbit2:~# rabbitmqctl stop_app
> root at rabbit2:~# rabbitmqctl join_cluster rabbit at rabbit1
> Clustering node 'rabbit at rabbit2' with 'rabbit at rabbit1' ...
> Error: {{case_clause,
>              {{error,
>                   {aborted,
>                       {function_clause,
>                           [{mnesia_schema,cs2list,
>                                [{cstruct,schema,set,[],
>                                     ['rabbit at rabbit1'],
>                                     [],0,read_write,false,[],[],false,schema,
>                                     [table,cstruct],
>                                     [],[],[],
>                                     {{1395,763528,28278},
>                                      'rabbit at rabbit1'},
>                                     {{2,0},[]}}]},
>                            {mnesia_schema,do_merge_schema,1},
>                            {mnesia_tm,apply_fun,3},
>                            {mnesia_tm,execute_transaction,5},
>                            {mnesia_schema,schema_coordinator,3}]}}},
>               ['rabbit at rabbit1']}},
>          [{rabbit_mnesia,change_extra_db_nodes,2},
>           {rabbit_mnesia,init_db,3},
>           {rabbit_mnesia,init_db_and_upgrade,3},
>           {rabbit_mnesia,init_db_with_mnesia,4},
>           {rabbit_mnesia,join_cluster,2},
>           {rpc,'-handle_call_call/6-fun-0-',5}]}|
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From mklishin at gopivotal.com  Tue Mar 25 18:34:42 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 25 Mar 2014 22:34:42 +0400
Subject: [rabbitmq-discuss] Age of message
In-Reply-To: <CAETr1H_E7Zn6QODbo3_9QYy5_oto0Ognd7TqgDhSgb3zaLPqeA@mail.gmail.com>
References: <CAETr1H9o-Ef5F78Fyksw=WFHAdETg8NYs4uheH0Gc2DpvZ6DPw@mail.gmail.com>
 <CAETr1H_tk4j67cggCzxQ9oEP3omKcdnof_NtP0jspmhU8D_sgA@mail.gmail.com>
 <CAMcAHLWwgsRpUqHyO1C1PNLpKoDc-kaOr3Q-Yj3X3tVFmCMoOg@mail.gmail.com>
 <CAETr1H94Qxh445QGb1hOGyH9NAHQDpozpKh3cgKyBae-fwxoRg@mail.gmail.com>
 <CAMcAHLXBUXfm7gGVxHUki-=inwtzWeuQCdQbN71zhH+WfPVuRw@mail.gmail.com>
 <CAETr1H-j1qvQxxfNmCexwcjkEa3NYKDftW6asTqNU2zhzo55vA@mail.gmail.com>
 <CD260799-F68C-4AC1-85F0-5FD4FD718C82@rabbitmq.com>
 <CAETr1H9=bySH+eaatTaE-LVYE=UMO0ULunEx-6RKgGnLv_F2fg@mail.gmail.com>
 <CAETr1H_p3sRpPzfqJDpg6VnMwg-o_u8JD3Qckr-21vOn4OVchQ@mail.gmail.com>
 <CAETr1H_v_Rwmx=HOy0aUe1+0XPJKrjZBec5wCndZK1a4xDxDBw@mail.gmail.com>
 <93BF3A45-4038-42C0-9EC3-E794DA9B8E50@rabbitmq.com>
 <CAETr1H_DKG8wn_V_ABgpbmViwXyzu4hNmjETk3HvLR2YnVMhCw@mail.gmail.com>
 <53305177.6040604@rabbitmq.com>
 <CAETr1H-2F1RYqQia1WgYTdqaRw9x9brFxCpHat2CmfM46TxtAw@mail.gmail.com>
 <etPan.533069e6.1190cde7.2b36@mercurio.local>
 <CAETr1H_E7Zn6QODbo3_9QYy5_oto0Ognd7TqgDhSgb3zaLPqeA@mail.gmail.com>
Message-ID: <etPan.5331cc5f.12200854.ed0@mercurio.local>

?On 25 March 2014 at 20:03:09, cw storm (cwstorm at gmail.com) wrote:
> > Is it safe to compare whatever value in the timestamp property  
> since it's store as a 64-bit time format?

I don?t see how it can be unsafe, barring the aforementioned
clock synchronisation issue.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From behrk2 at gmail.com  Tue Mar 25 18:38:45 2014
From: behrk2 at gmail.com (Kevin Behr)
Date: Tue, 25 Mar 2014 14:38:45 -0400
Subject: [rabbitmq-discuss] RabbitMQ join_cluster error
In-Reply-To: <5331C60C.5060006@rabbitmq.com>
References: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>
 <5331C60C.5060006@rabbitmq.com>
Message-ID: <CAC_yGUTOOs=grdsz-DpXx4z8woeMD5Pbam4nQmp8JOcCzg3JtA@mail.gmail.com>

Hi Simon,

I am running the latest version of RabbitMQ: {rabbit,"RabbitMQ","3.2.4"}

You're right about the Erlang versions (see below).  It's weird - I had
initially dismissed this possibility because I installed RabbitMQ on two
brand new Amazon EC2 server instances within one minute of each other
today, using the same installation method.  I don't know why one would
differ from the other.

I am running Ubuntu 12.04 (64-bit).  I just tried completely removing
RabbitMQ and all of its dependencies on each server instance and
re-installing (according to the instructions here:
http://www.rabbitmq.com/install-debian.html), and the Erlang version
mismatch remains!

How do I update R14B04 to R16B01?

*rabbit1:*
{erlang_version,
     "Erlang R16B01 (erts-5.10.2) [source] [64-bit] [async-threads:30]
[kernel-poll:true]\n"}

*rabbit2:*
{erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
[async-threads:30] [kernel-poll:true]\n"}




On Tue, Mar 25, 2014 at 2:08 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> That looks like the nodes of the cluster are running different Erlang
> versions. They should all be on the same version.
>
> That said, I thought we'd converted that to a more intelligible error
> message (it could hardly be less). Which version of RabbitMQ are you
> running?
>
> Cheers, Simon
>
>
> On 25/03/2014 17:49, Kevin Behr wrote:
>
>> Hello,
>>
>> I am trying to cluster a slave node (rabbit2) with a master node
>> (rabbit1) in RabbitMQ. I am receiving the following error from the
>> |join_cluster| command, though. I don't know Erlang, so I am having
>> trouble determining the cause. Any ideas as to what the error is, or how
>> to fix it?
>>
>> Both nodes can talk to each other via ping, and I have ensured that the
>> .erlang.cookie for each node is the same.
>>
>> |root at rabbit2:~# rabbitmqctl stop_app
>> root at rabbit2:~# rabbitmqctl join_cluster rabbit at rabbit1
>> Clustering node 'rabbit at rabbit2' with 'rabbit at rabbit1' ...
>> Error: {{case_clause,
>>              {{error,
>>                   {aborted,
>>                       {function_clause,
>>                           [{mnesia_schema,cs2list,
>>                                [{cstruct,schema,set,[],
>>                                     ['rabbit at rabbit1'],
>>                                     [],0,read_write,false,[],[],
>> false,schema,
>>                                     [table,cstruct],
>>                                     [],[],[],
>>                                     {{1395,763528,28278},
>>                                      'rabbit at rabbit1'},
>>                                     {{2,0},[]}}]},
>>                            {mnesia_schema,do_merge_schema,1},
>>                            {mnesia_tm,apply_fun,3},
>>                            {mnesia_tm,execute_transaction,5},
>>                            {mnesia_schema,schema_coordinator,3}]}}},
>>               ['rabbit at rabbit1']}},
>>          [{rabbit_mnesia,change_extra_db_nodes,2},
>>           {rabbit_mnesia,init_db,3},
>>           {rabbit_mnesia,init_db_and_upgrade,3},
>>           {rabbit_mnesia,init_db_with_mnesia,4},
>>           {rabbit_mnesia,join_cluster,2},
>>           {rpc,'-handle_call_call/6-fun-0-',5}]}|
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140325/c8ba1190/attachment.html>

From joey.jiaojg at gmail.com  Wed Mar 26 08:01:37 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Wed, 26 Mar 2014 16:01:37 +0800
Subject: [rabbitmq-discuss] flow control shortcut
Message-ID: <CAKOmCvqRdU==JCznD=G1qRh6Yg+SvgwopG33pR+bFH4FWZQM=g@mail.gmail.com>

Hi,
Is there a flow control shortcut to block all connections or all pub
connections or all consume connections?
And is it safe to reboot machine or restart rabbitmq service at any time?

-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/05da8f04/attachment.html>

From mklishin at gopivotal.com  Wed Mar 26 08:07:40 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 12:07:40 +0400
Subject: [rabbitmq-discuss] flow control shortcut
In-Reply-To: <CAKOmCvqRdU==JCznD=G1qRh6Yg+SvgwopG33pR+bFH4FWZQM=g@mail.gmail.com>
References: <CAKOmCvqRdU==JCznD=G1qRh6Yg+SvgwopG33pR+bFH4FWZQM=g@mail.gmail.com>
Message-ID: <etPan.53328ae5.6b8b4567.afcf@mercurio.local>

On 26 March 2014 at 12:04:16, Joey Jiao (joey.jiaojg at gmail.com) wrote:
> > Is there a flow control shortcut to block all connections or  
> all pub connections or all consume connections?

Set vm_high_memory_watermark to a really low value (e.g. 0.0000001),
then as soon as a connection attempts to publish, it will be blocked.

Consumers cannot be blocked.

> And is it safe to reboot machine or restart rabbitmq service at  
> any time?

You can lose data that was in memory but not yet on disk.

Cleanly shutdown RabbitMQ before rebooting. Clients will be forcefully
disconnected (using connection.close).

You can also close connections using HTTP API [1].

GET /api/connections to get names, then
DELETE /api/connections/{name} for every connection there is.

1.?http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_4/priv/www/api/index.html?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Wed Mar 26 08:14:19 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Mar 2014 08:14:19 +0000
Subject: [rabbitmq-discuss] flow control shortcut
In-Reply-To: <etPan.53328ae5.6b8b4567.afcf@mercurio.local>
References: <CAKOmCvqRdU==JCznD=G1qRh6Yg+SvgwopG33pR+bFH4FWZQM=g@mail.gmail.com>
 <etPan.53328ae5.6b8b4567.afcf@mercurio.local>
Message-ID: <53328C5B.6050404@rabbitmq.com>

On 26/03/14 08:07, Michael Klishin wrote:
> You can also close connections using HTTP API

...and with 'rabbitmqctl close_connection ...'. 
(http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#close_connection)


Matthias.


From simon at rabbitmq.com  Wed Mar 26 09:34:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Mar 2014 09:34:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ join_cluster error
In-Reply-To: <CAC_yGUTOOs=grdsz-DpXx4z8woeMD5Pbam4nQmp8JOcCzg3JtA@mail.gmail.com>
References: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>
 <5331C60C.5060006@rabbitmq.com>
 <CAC_yGUTOOs=grdsz-DpXx4z8woeMD5Pbam4nQmp8JOcCzg3JtA@mail.gmail.com>
Message-ID: <53329F20.20103@rabbitmq.com>

On 25/03/2014 18:38, Kevin Behr wrote:
> I am running the latest version of RabbitMQ: {rabbit,"RabbitMQ","3.2.4"}

Huh. OK, I'll look into making that error less obscure then.

> I am running Ubuntu 12.04 (64-bit).  I just tried completely removing
> RabbitMQ and all of its dependencies on each server instance and
> re-installing (according to the instructions here:
> http://www.rabbitmq.com/install-debian.html), and the Erlang version
> mismatch remains!
>
> How do I update R14B04 to R16B01?

Hmm, according to packages.ubuntu.com Ubuntu 12.04 should package R14B04 
rather than R16B01. So either rabbit1 is not running 12.04 (is it 
running 13.10?) or you have installed from a PPA.

"sudo apt-cache policy erlang" should help you figure out what's going on.

Cheers, Simon


From simon at rabbitmq.com  Wed Mar 26 09:35:39 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Mar 2014 09:35:39 +0000
Subject: [rabbitmq-discuss] Stomp connections ending suddenly
In-Reply-To: <CAOU_jKB7E7zwBqv05JQq+RORT9Ym7Bf9_ikuhKpR2nsuvSM6XA@mail.gmail.com>
References: <CAOU_jKBna9GpKUfdCrNARatD=1+p0TYNXAdj1EVJjPWmay2pnQ@mail.gmail.com>	<53318796.1020407@rabbitmq.com>
 <CAOU_jKB7E7zwBqv05JQq+RORT9Ym7Bf9_ikuhKpR2nsuvSM6XA@mail.gmail.com>
Message-ID: <53329F6B.2040408@rabbitmq.com>

On 25/03/2014 18:01, srikanth tns wrote:
> What is the latest stable version of Rabbitmq/Erlang to be used for
> Production ?

3.2.4

> we have 8000+ nodes connecting to a single broker running
> on Linux OS.
> Also do we have a recommendation of tuning parameters to be done for
> Rabbitmq/Erlang in Production ?

To a large extent that depends on what you are trying to do, although we 
do try to make things work well out of the box.

Cheers, Simon


From behrk2 at gmail.com  Wed Mar 26 11:52:34 2014
From: behrk2 at gmail.com (Kevin Behr)
Date: Wed, 26 Mar 2014 07:52:34 -0400
Subject: [rabbitmq-discuss] RabbitMQ join_cluster error
In-Reply-To: <53329F20.20103@rabbitmq.com>
References: <CAC_yGURR3fG3PbgbXNSmyhrLQTMppHQmCWcJMt3AmDHdkVQ=og@mail.gmail.com>
 <5331C60C.5060006@rabbitmq.com>
 <CAC_yGUTOOs=grdsz-DpXx4z8woeMD5Pbam4nQmp8JOcCzg3JtA@mail.gmail.com>
 <53329F20.20103@rabbitmq.com>
Message-ID: <CAC_yGUTcsAjXFLKTuW52aUzq55yDNEZ+gXEp6EEpCnFXeoW5mw@mail.gmail.com>

You're right, rabbit1 was running Ubuntu 13.10.  My mistake.  After
aligning the OS versions, then the Erlang versions matched as expected.  I
am now able to set up the cluster successfully.

Thanks for your help!

Kevin


On Wed, Mar 26, 2014 at 5:34 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/03/2014 18:38, Kevin Behr wrote:
>
>> I am running the latest version of RabbitMQ: {rabbit,"RabbitMQ","3.2.4"}
>>
>
> Huh. OK, I'll look into making that error less obscure then.
>
>
>  I am running Ubuntu 12.04 (64-bit).  I just tried completely removing
>> RabbitMQ and all of its dependencies on each server instance and
>> re-installing (according to the instructions here:
>> http://www.rabbitmq.com/install-debian.html), and the Erlang version
>> mismatch remains!
>>
>> How do I update R14B04 to R16B01?
>>
>
> Hmm, according to packages.ubuntu.com Ubuntu 12.04 should package R14B04
> rather than R16B01. So either rabbit1 is not running 12.04 (is it running
> 13.10?) or you have installed from a PPA.
>
> "sudo apt-cache policy erlang" should help you figure out what's going on.
>
> Cheers, Simon
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/85c6e906/attachment.html>

From matburton at gmail.com  Wed Mar 26 12:49:21 2014
From: matburton at gmail.com (Mat Burton)
Date: Wed, 26 Mar 2014 05:49:21 -0700 (PDT)
Subject: [rabbitmq-discuss] HELP: Replication vs RabbitMQ persistence in
 production environment
In-Reply-To: <6d883efa-22de-4b2e-8f00-b9bfa4880e1e@googlegroups.com>
References: <6d883efa-22de-4b2e-8f00-b9bfa4880e1e@googlegroups.com>
Message-ID: <6e465254-1c9a-425e-9ef3-60bd81314e72@googlegroups.com>

Hey Nikolay,

Where I work we've opted to put a RabbitMQ broker on each physical machine 
in our live environment.
These brokers have a single exchange and queue both called "local.outgoing" 
(i.e. there's a single message stream)

There is then a central RabbitMQ broker with shovels configured to fetch 
messages from each machine.
The central RabbitMQ broker is where all the routing to queues takes place.

This means that:

   - It's unlikely that the local RabbitMQ broker instance is unreachable
   - Messages are queued at the local RabbitMQ broker if there are network 
   problems until they're resolved
   - Apps don't have to maintain state (unless they need to for another 
   reason)
   - Apps are dumb, they just raise events (messages) but don't know who 
   cares and who they should send messages to, it's one big stream
   - We can upgrade, restart, re-configure the central RabbitMQ broker as 
   required without down-time or message loss

This is just a case study ;-) it may not match you're requirements
Mat B

On Saturday, 15 March 2014 16:18:49 UTC, Nikolay Maximov wrote:
>
> Hi,
>
> Please share you experience in architecture setup. Current application 
> setup built as local SQL database filled in realtime with rate as fast as 1 
> transaction per 10 seconds. There are a few tables to replicate - one from 
> point of sale transaction and another with image. This is 2-tier scheme 
> with collecting data from 15-40 nodes (points of sale). Data then 
> replicated to 2nd level with SymmetricDS software. We want to move to MQ 
> architecture and I want to ask wether this is good solution? I found no 
> information on how to protect RabbitMQ from node failures or network down 
> problems. Current solution store data in node's MySQL database until 
> network is up and them SymmetricDS detects difference to be sent to upper 
> layer.
>
> Any help is appreciated. Thank you in advance.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/34d57dc9/attachment.html>

From kgk at dataverse.gr  Wed Mar 26 14:06:50 2014
From: kgk at dataverse.gr (Kostas)
Date: Wed, 26 Mar 2014 16:06:50 +0200
Subject: [rabbitmq-discuss] Service stops automatically,
	when web management console is activated
Message-ID: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>

Hello.

 

I have the following problem.

When I enable the management plugin, the RabbitMQ service seems to stop by
itself (crashes?).

I didn't find any logs in Windows Event Viewer.

 

I have found a similar problem reported here:

http://rabbitmq.1065348.n5.nabble.com/installation-problem-service-stops-aut
omatically-web-management-console-missing-td29229.html

I did try removing the mnesia folder in %APPDATA%\RabbitMQ\db but nothing
has changed.

Note that I didn't have any older version of RabbitMQ installed before.

I am not sure what version I have exactly, but it was installed only some
months ago.

 

I don't know if this is some issue with Python.

Is there any log for what happened to the service?

 

Thanks in advance for any help. J

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/408a2e31/attachment.html>

From mklishin at gopivotal.com  Wed Mar 26 14:05:15 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 18:05:15 +0400
Subject: [rabbitmq-discuss] Service stops automatically,
 when web management console is activated
In-Reply-To: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>
References: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>
Message-ID: <etPan.5332deb6.643c9869.afcf@mercurio.local>

On 26 March 2014 at 18:01:00, Kostas (kgk at dataverse.gr) wrote:
> > Is there any log for what happened to the service?

What is in RabbitMQ log files?

(you can find log locations for Windows on [1]).

1.?http://www.rabbitmq.com/relocate.html?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From kgk at dataverse.gr  Wed Mar 26 14:28:22 2014
From: kgk at dataverse.gr (Kostas)
Date: Wed, 26 Mar 2014 16:28:22 +0200
Subject: [rabbitmq-discuss] Service stops automatically,
	when web management console is activated
In-Reply-To: <etPan.5332deb6.643c9869.afcf@mercurio.local>
References: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>
 <etPan.5332deb6.643c9869.afcf@mercurio.local>
Message-ID: <00cf01cf48ff$a59c2d90$f0d488b0$@dataverse.gr>

Found it. Here is the log.

The reason seems to be ?could_not_start_listener?.

I guess ?eaddrinuse? means address in use.

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

msg_store_transient: using rabbit_msg_store_ets_index to provide index

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

msg_store_persistent: using rabbit_msg_store_ets_index to provide index

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

started TCP Listener on [::]:5672

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

started TCP Listener on 0.0.0.0:5672

 

=ERROR REPORT==== 26-Mar-2014::16:23:04 ===

** Generic server rabbit_web_dispatch_registry terminating 

** Last message in was {add,rabbit_mgmt,

                            [{port,15672}],

                            #Fun<rabbit_web_dispatch.1.31447083>,

                            #Fun<rabbit_mgmt_app.2.5043001>,

                            {[],"RabbitMQ Management"}}

** When Server state == undefined

** Reason for termination == 

** {could_not_start_listener,[{port,15672}],eaddrinuse}

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

stopped TCP Listener on 0.0.0.0:5672

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

stopped TCP Listener on [::]:5672

 

=INFO REPORT==== 26-Mar-2014::16:23:04 ===

Error description:

   {could_not_start,rabbitmq_management,

                    {could_not_start_listener,[{port,15672}],eaddrinuse}}

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/6b22eeca/attachment.html>

From mklishin at gopivotal.com  Wed Mar 26 14:24:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 18:24:34 +0400
Subject: [rabbitmq-discuss] Service stops automatically,
 when web management console is activated
In-Reply-To: <00cf01cf48ff$a59c2d90$f0d488b0$@dataverse.gr>
References: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>
 <etPan.5332deb6.643c9869.afcf@mercurio.local>
 <00cf01cf48ff$a59c2d90$f0d488b0$@dataverse.gr>
Message-ID: <etPan.5332e33d.74b0dc51.afcf@mercurio.local>

On 26 March 2014 at 18:22:35, Kostas (kgk at dataverse.gr) wrote:
> ** Reason for termination ==
> ** {could_not_start_listener,[{port,15672(tel://port,15672)}],eaddrinuse}  

Port 15672 is used by another process.

RabbitMQ mgmt plugin can be configured to use a different port,
see ?Configuring the HTTP listener? on [1] and [2].

1.?http://www.rabbitmq.com/management.html
2.?http://www.rabbitmq.com/configure.html?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Wed Mar 26 14:25:14 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Wed, 26 Mar 2014 14:25:14 +0000
Subject: [rabbitmq-discuss] Federation/Connection issues
In-Reply-To: <etPan.53314482.2eb141f2.ed0@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
 <etPan.53314482.2eb141f2.ed0@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2282082@usbpx2pmxmbx12>

The disk corrupted and when you powered on the VM it went to the Ubuntu recovery screen.

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Tuesday, March 25, 2014 3:55 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Federation/Connection issues

?On 25 March 2014 at 12:46:20, Ganann, Kale (kganann at kroll.com) wrote:
> > When MNESIA went down on the second node, it crashed so hard it  
> dropped the disk.

Sorry, what specifically do you mean by ?dropped the disk??
--  
MK  

Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.

From KGanann at kroll.com  Wed Mar 26 14:29:32 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Wed, 26 Mar 2014 14:29:32 +0000
Subject: [rabbitmq-discuss] Federation/Connection issues
In-Reply-To: <etPan.5331446c.3d1b58ba.ed0@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
 <etPan.5331446c.3d1b58ba.ed0@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA228208B@usbpx2pmxmbx12>

We see some errors related to users that were deleted in the past (user_does_not_exist).  It appears there were some artifacts in our config from when we changed our fed routing structure to prevent duplicate messages.  Some of our engineers removed those artifacts, but now when we load all the existing federation exchanges (although showing green for their upstreams) don't work unless we set up a new queue with the same routing key in the bindings.  I'm checking the logs to see if we have any new errors related to this.  I've attached some of the errors for you perusal, if I find new ones I'll send those up as well.


=ERROR REPORT==== 24-Mar-2014::09:54:58 ===
** Generic server <0.6301.0> terminating
 ** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                         {{upstream,
                           [<<"amqp://shared_federation:shared_federation at localhost:5672/fed">>],
                            <<"e.fed.topic.tofed">>,<<"e.fed.topic.tofed">>,
                           1000,2,1,none,none,false,'on-confirm',none,
                           <<"datamartStage_to_fed">>},
                           {upstream_params,
                           <<"amqp://shared_federation:shared_federation at localhost:5672/fed">>,
                           {amqp_params_network,<<"shared_federation">>,
                             <<"shared_federation">>,<<"fed">>,"localhost",
                            5672,0,0,0,infinity,none,
                            [#Fun<amqp_uri.7.121371571>,
                              #Fun<amqp_uri.7.121371571>],
                            [],[]},
                           {exchange,
                            {resource,<<"fed">>,exchange,
                              <<"e.fed.topic.tofed">>},
                            topic,true,false,false,[],
                            [{federation,[]}],
                            [{vhost,<<"datamartStage">>},
                              {name,<<"federation enabled">>},
                             {pattern,<<"(^|.*\\.)fed($|\\..*)">>},
                             {'apply-to',<<"exchanges">>},
                              {definition,
                              [{<<"federation-upstream-set">>,<<"all">>}]},
                             {priority,60}],
                            {[],[rabbit_federation_exchange]}},
                            <<"amqp://localhost:5672/fed">>,
                           [{<<"uri">>,longstr,
                             <<"amqp://localhost:5672/fed">>},
                             {<<"virtual_host">>,longstr,<<"fed">>},
                            {<<"exchange">>,longstr,<<"e.fed.topic.tofed">>}]},
                           {resource,<<"datamartStage">>,exchange,
                           <<"e.fed.topic.tofed">>}}}
** Reason for termination ==
** {error,user_does_not_exist}

=ERROR REPORT==== 24-Mar-2014::09:54:58 ===
** Generic server <0.6310.0> terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                         {{upstream,
                            [<<"amqp://shared_federation:shared_federation at localhost:5672/fed">>],
                           <<"e.fed.topic">>,<<"e.fed.topic">>,1000,2,1,none,
                            none,false,'on-confirm',none,
                           <<"datamartStage_to_fed">>},
                          {upstream_params,
                           <<"amqp://shared_federation:shared_federation at localhost:5672/fed">>,
                            {amqp_params_network,<<"shared_federation">>,
                            <<"shared_federation">>,<<"fed">>,"localhost",
                             5672,0,0,0,infinity,none,
                            [#Fun<amqp_uri.7.121371571>,
                             #Fun<amqp_uri.7.121371571>],
                            [],[]},
                            {exchange,
                            {resource,<<"fed">>,exchange,<<"e.fed.topic">>},
                            topic,true,false,false,[],
                             [{federation,[]}],
                            [{vhost,<<"datamartStage">>},
                             {name,<<"federation enabled">>},
                             {pattern,<<"(^|.*\\.)fed($|\\..*)">>},
                              {'apply-to',<<"exchanges">>},
                             {definition,
                              [{<<"federation-upstream-set">>,<<"all">>}]},
                              {priority,60}],
                            {[],[rabbit_federation_exchange]}},
                           <<"amqp://localhost:5672/fed">>,
                           [{<<"uri">>,longstr,
                              <<"amqp://localhost:5672/fed">>},
                            {<<"virtual_host">>,longstr,<<"fed">>},
                            {<<"exchange">>,longstr,<<"e.fed.topic">>}]},
                           {resource,<<"datamartStage">>,exchange,
                           <<"e.fed.topic">>}}}
** Reason for termination ==
** {error,user_does_not_exist

Thanks,
Kale


-----Original Message-----
From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Tuesday, March 25, 2014 3:55 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Federation/Connection issues

?On 25 March 2014 at 12:46:20, Ganann, Kale (kganann at kroll.com) wrote:
> > I?ve attached the output of rabbitmqctl report from one of our
> nodes while the processes were climbing. We?ve currently disabled 
> federation in prod, but we?re looking for a better solution.
> Ideas?

Can you please look at log files to see if there are any error messages, stack traces, etc. There likely will be something.
--
MK  

Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.

From mklishin at gopivotal.com  Wed Mar 26 14:30:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 18:30:34 +0400
Subject: [rabbitmq-discuss] Federation/Connection issues
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2282082@usbpx2pmxmbx12>
References: <6DB033025329784B9280ABD9516177FCA227FB19@usbpx2pmxmbx12>
 <etPan.53314482.2eb141f2.ed0@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2282082@usbpx2pmxmbx12>
Message-ID: <etPan.5332e4a5.2ae8944a.afcf@mercurio.local>

?On 26 March 2014 at 18:26:53, Ganann, Kale (kganann at kroll.com) wrote:
> > The disk corrupted and when you powered on the VM it went to the  
> Ubuntu recovery screen.

Sorry but I?ve some doubts RabbitMQ or Mnesia was the root cause.
It sounds like the disk corrupted and that in turned caused
Mnesia corruption/termination.

However, lots and lots of federation connections can be an unrelated
issue. Is there anything in RabbitMQ log files? (see [1] if you don?t know
where to find them).

1.?http://www.rabbitmq.com/relocate.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From ravindrapandey1982 at gmail.com  Wed Mar 26 14:38:46 2014
From: ravindrapandey1982 at gmail.com (Ravi Pandey)
Date: Wed, 26 Mar 2014 20:08:46 +0530
Subject: [rabbitmq-discuss] How to deal with rest queues
Message-ID: <CAPCD91k7amuxEOm-MiORzy4b2MctFB20oyT1VZF9b02ZYvcnuQ@mail.gmail.com>

Hi I am working on RabbitMQ integration. I have a problem to deal with
queues - If Q1 is processing and it is taking time then how can i process
another queue in between?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/e7a205ba/attachment.html>

From mklishin at gopivotal.com  Wed Mar 26 14:43:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 18:43:39 +0400
Subject: [rabbitmq-discuss] How to deal with rest queues
In-Reply-To: <CAPCD91k7amuxEOm-MiORzy4b2MctFB20oyT1VZF9b02ZYvcnuQ@mail.gmail.com>
References: <CAPCD91k7amuxEOm-MiORzy4b2MctFB20oyT1VZF9b02ZYvcnuQ@mail.gmail.com>
Message-ID: <etPan.5332e7b3.238e1f29.afcf@mercurio.local>

On 26 March 2014 at 18:41:16, Ravi Pandey (ravindrapandey1982 at gmail.com) wrote:
> > I have a problem to deal with queues - If Q1 is processing and it  
> is taking time then how can i process another queue in between?  

Consumers perform processing, not queues. A queue can be shared by multiple
consumers, residing on the same or separate machines, so often if you have
a long queue you can scale the number of consumers to speed up overall throughput.

Take a look at protocol concepts if something isn?t clear:
http://www.rabbitmq.com/tutorials/amqp-concepts.html

Apologies if I misunderstood your question.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From kgk at dataverse.gr  Wed Mar 26 15:20:03 2014
From: kgk at dataverse.gr (Kostas)
Date: Wed, 26 Mar 2014 17:20:03 +0200
Subject: [rabbitmq-discuss] Service stops automatically,
	when web management console is activated
In-Reply-To: <etPan.5332e33d.74b0dc51.afcf@mercurio.local>
References: <00c401cf48fc$a33212c0$e9963840$@dataverse.gr>
 <etPan.5332deb6.643c9869.afcf@mercurio.local>
 <00cf01cf48ff$a59c2d90$f0d488b0$@dataverse.gr>
 <etPan.5332e33d.74b0dc51.afcf@mercurio.local>
Message-ID: <00f801cf4906$dd87ce10$98976a30$@dataverse.gr>

Hello again.

 

I've put the provided example config file (rabbitmq.config.example) in %APPDATA%\RabbitMQ\rabbitmq.config.

I've modified this part:

 

{rabbitmq_management,

  [{listener, [{port, 777}]}]

},

 

I?ve re-installed the service.

 

But now, when I start the service it crashes (Windows report an error) and there are no log messages in the 2 log files (%APPDATA%\RabbitMQ\log\) nor in Windows Event Viewer.

Am I missing something?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140326/2bc9a4c3/attachment.html>

From bernie at step.polymtl.ca  Wed Mar 26 16:42:39 2014
From: bernie at step.polymtl.ca (Bertrand Guay-Paquet)
Date: Wed, 26 Mar 2014 12:42:39 -0400
Subject: [rabbitmq-discuss] Connection and channel resource management in
	servlet
Message-ID: <5333037F.5020806@step.polymtl.ca>

Hello,

I'm a new RabbitMQ user and I'm struggling to understand how to properly 
manage the client resources. My usage scenario is a java web application 
(servlet) which publishes messages to some queues for asynchronous 
operations (send email, generate thumbnails, etc.) A java client daemon 
consumes these messages via consumers subscribed to queues. I imagine 
this is a pretty typical usage scenario, but I haven't been able to find 
how to manage the associated RabbitMQ resources properly.

My current understanding and questions:
1) I don't see a need to have more than 1 Connection instance in either 
the servlet or the client. This connection should be created on 
application or servlet startup and closed on shutdown. Are there 
pitfalls with long-lived connections or is this all handled by RabbitMQ 
(keep-alive)?

2) How should I handle broken Connections to the broker? If a new one 
must be created, do all the channels need to be reopened as well?

3) It seems like it would be bad practice to create a new channel each 
time a web request wants to publish a message. Should I pool them? Share 
a single one? Use ThreadLocals? Is there a problem if they're never 
closed (the connection would be on shutdown though)? The java client api 
documentation states that channels *should* be closed but that it's not 
necessary.

4) My tests seem to show that when a subscribed consumer throws an 
exception in handleDelivery(), it consumes the rest of its buffered 
messages and is then terminated. Does that mean I should never throw 
from handleDelivery()? Or should I monitor currently active consumers 
and restart the failed ones?

Thank you very much for any guidance.

Regards,
Bertrand

From mklishin at gopivotal.com  Wed Mar 26 18:24:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 26 Mar 2014 22:24:13 +0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <5333037F.5020806@step.polymtl.ca>
References: <5333037F.5020806@step.polymtl.ca>
Message-ID: <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>



On 26 March 2014 at 20:44:04, Bertrand Guay-Paquet (bernie at step.polymtl.ca) wrote:
> > My current understanding and questions:
> 1) I don't see a need to have more than 1 Connection instance in  
> either
> the servlet or the client. This connection should be created  
> on
> application or servlet startup and closed on shutdown. Are there  
> pitfalls with long-lived connections or is this all handled  
> by RabbitMQ
> (keep-alive)?

RabbitMQ connections are supposed to be long-lived. Set heartbeat interval
to a lower value (say, 60 seconds) if you have a firewall between clients
and RabbitMQ.

>  
> 2) How should I handle broken Connections to the broker? If a new  
> one
> must be created, do all the channels need to be reopened as well?

If a connection fails, it needs to be reopened, as do all the channels
on it. Some clients support automatic recovery from TCP connection
failures. Java client will offer this feature in the upcoming 3.3.0 release.
?  
>  
> 3) It seems like it would be bad practice to create a new channel  
> each
> time a web request wants to publish a message. Should I pool them?  
> Share
> a single one? Use ThreadLocals? Is there a problem if they're  
> never
> closed (the connection would be on shutdown though)? The java  
> client api
> documentation states that channels *should* be closed but that  
> it's not
> necessary.

Opening a channel is a network round trip. So is closing a channel. If that?s acceptable to you,
opening and closing a channel per request is fine. Channels should not be shared
across threads.

For Web apps, a single connection and channel is usually sufficient, although
in Java and .NET you need to understand how your framework dispatches requests
in order to avoid concurrent publishes on a shared channel. Thread locals
should work OK, especially if you can pre-initialise all channels.?

>  
> 4) My tests seem to show that when a subscribed consumer throws  
> an
> exception in handleDelivery(), it consumes the rest of its buffered  
> messages and is then terminated.

That?s not correct. You likely use automatic acknowledgements and/or a
QueueingConsumer which accumulates all deliveries locally in a java.util.concurrent
queue.

See tutorial 2:
http://www.rabbitmq.com/tutorials/tutorial-two-java.html

> Does that mean I should never  
> throw
> from handleDelivery()? Or should I monitor currently active  
> consumers
> and restart the failed ones?

Unhandled exceptions will be delegated to ExceptionHandler which
is configured per channel. If you use manual acknowledgements,
throwing exceptions in handleDelivery without acking or rejecting
a delivery is not a very good idea: RabbitMQ will think that the
delivery is still being processed, and will keep the message around.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Wed Mar 26 19:57:00 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 26 Mar 2014 20:57:00 +0100
Subject: [rabbitmq-discuss] ANN new release for Recent History Exchange
Message-ID: <CAMcAHLU7iu=-tiwxukkikiOKWtESL1p4Z9B0kW8KBcaW+HSeyw@mail.gmail.com>

Hi,

There's a new release for the Recent History Exchange Plugin, with
configuration for the history length via exchange arguments, and a new
header for messages that could tell the plugin to not cache certain
messages.

See more on the README:
https://github.com/videlalvaro/rabbitmq-recent-history-exchange

Also we provide binary release inside the binaries folder.

Regards,

Alvaro

From lepolac at gmail.com  Wed Mar 26 15:12:37 2014
From: lepolac at gmail.com (lepolac)
Date: Wed, 26 Mar 2014 08:12:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Transactions and duplicate
Message-ID: <1395846757681-34344.post@n5.nabble.com>

Hello,

When using transactions on the consumer side, I noticed duplicates when a
node is failing.
This occurs when the node the consumer is connected to fails, or if the
master fails.
It occurs both when catching the consumer cancellation exception and
reconnecting directly, or using a simpler client and restarting it.
I used a tx channel with basic.get and no autoack, I manually ack() and
commit() every message.

Whilst I can understand redelivery/dups when using asynchronous ways of
consuming, I fail to see why it happens when using synchronous calls.

I can reproduce this everytime, I always get one message redelivered, even
if the commit() called return.
I noticed that when throttling the consumer (let's say one message consumed
every 100ms), I don't get dups.

So, is the commit() call really synchronous ?
Generally, what would be the best way to avoid duplicates ? I tried
basicAck() without transactions and got the same results, I get dups.

I'm using 3.2.4 and the java client.
There's about 1ms latency between rabbit nodes and my client.

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Transactions-and-duplicate-tp34344.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From james.eddy at us.thalesgroup.com  Wed Mar 26 23:44:04 2014
From: james.eddy at us.thalesgroup.com (James Eddu)
Date: Wed, 26 Mar 2014 23:44:04 +0000 (UTC)
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
	node we see a very slow dequeue of messages
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org> <52A7343D.4020003@rabbitmq.com>
 <loom.20131227T191248-958@post.gmane.org> <52CA7A64.3080102@rabbitmq.com>
 <loom.20140220T010144-922@post.gmane.org> <5305DCB4.5060903@rabbitmq.com>
Message-ID: <loom.20140327T004155-966@post.gmane.org>

Simon MacMullen <simon at ...> writes:

> 
> On 20/02/14 00:05, James Eddu wrote:
> > Do you have a bug tracking number for this that I can keep my eye out for it
> > in Mercurial?
> 
> It's 25921. Nothing has happened yet though.
> 
> Cheers, Simon
> 


Hi Simon,

I did test the RMQ from this branch here (bug25921)
http://hg.rabbitmq.com/rabbitmq-server/rev/0afd7955a109 . But it did not
seem to improve the original issue. Is this the complete fix, or is there
possible other bug reports that where spawned from this one?

Thanks,
James



From joey.jiaojg at gmail.com  Thu Mar 27 05:26:10 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Thu, 27 Mar 2014 13:26:10 +0800
Subject: [rabbitmq-discuss] Looks like www.rabbitmq.com is down
Message-ID: <CAKOmCvq46sdeFdRRHXvJaaZTQPZ6AspiqkK-cXZvcA40MKC2ZQ@mail.gmail.com>

-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/128280ec/attachment.html>

From jeremy at fluxlabs.net  Thu Mar 27 05:50:35 2014
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Thu, 27 Mar 2014 05:50:35 +0000
Subject: [rabbitmq-discuss] Looks like www.rabbitmq.com is down
In-Reply-To: <CAKOmCvq46sdeFdRRHXvJaaZTQPZ6AspiqkK-cXZvcA40MKC2ZQ@mail.gmail.com>
References: <CAKOmCvq46sdeFdRRHXvJaaZTQPZ6AspiqkK-cXZvcA40MKC2ZQ@mail.gmail.com>
Message-ID: <DCD7AEA7-C317-4AD4-8FF6-4E9B8D0904D8@fluxlabs.net>

Just you .. seems up for me.

--
Jeremy McSpadden
Flux Labs | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x501 | Cell : 850-890-2543 | Fax : 850-254-2955

On Mar 27, 2014, at 12:26 AM, Joey Jiao <joey.jiaojg at gmail.com<mailto:joey.jiaojg at gmail.com>> wrote:



--
-Joey Jiao
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/4f0027d7/attachment.html>

From mklishin at gopivotal.com  Thu Mar 27 06:23:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 27 Mar 2014 10:23:52 +0400
Subject: [rabbitmq-discuss] Looks like www.rabbitmq.com is down
In-Reply-To: <DCD7AEA7-C317-4AD4-8FF6-4E9B8D0904D8@fluxlabs.net>
References: <CAKOmCvq46sdeFdRRHXvJaaZTQPZ6AspiqkK-cXZvcA40MKC2ZQ@mail.gmail.com>
 <DCD7AEA7-C317-4AD4-8FF6-4E9B8D0904D8@fluxlabs.net>
Message-ID: <etPan.5333c413.6b8b4567.cd3@mercurio.local>

On 27 March 2014 at 09:52:02, Jeremy McSpadden (jeremy at fluxlabs.net) wrote:
> > Just you .. seems up for me.

It was down at about midnight GMT .
-- 
MK 

Software Engineer, Pivotal/RabbitMQ

From kamil at kieliszczyk.net  Thu Mar 27 06:22:17 2014
From: kamil at kieliszczyk.net (Kamil Kieliszczyk)
Date: Thu, 27 Mar 2014 07:22:17 +0100
Subject: [rabbitmq-discuss] Looks like www.rabbitmq.com is down
In-Reply-To: <DCD7AEA7-C317-4AD4-8FF6-4E9B8D0904D8@fluxlabs.net>
References: <CAKOmCvq46sdeFdRRHXvJaaZTQPZ6AspiqkK-cXZvcA40MKC2ZQ@mail.gmail.com>
 <DCD7AEA7-C317-4AD4-8FF6-4E9B8D0904D8@fluxlabs.net>
Message-ID: <5333C399.3000500@kieliszczyk.net>

You can always check if it is just you using 
http://www.downforeveryoneorjustme.com/ or something similar.


On 03/27/2014 06:50 AM, Jeremy McSpadden wrote:
> Just you .. seems up for me.
>
> --
> Jeremy McSpadden
> Flux Labs | http://www.fluxlabs.net <http://www.fluxlabs.net/> | 
> Endless Solutions
> Office : 850-250-5590x501 | Cell : 850-890-2543 | Fax : 850-254-2955
>
> On Mar 27, 2014, at 12:26 AM, Joey Jiao <joey.jiaojg at gmail.com 
> <mailto:joey.jiaojg at gmail.com>> wrote:
>
>
>
> -- 
> -Joey Jiao
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com 
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/db675bfb/attachment.html>

From mklishin at gopivotal.com  Thu Mar 27 08:29:51 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 27 Mar 2014 12:29:51 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.1.8 is released
Message-ID: <etPan.5333e19c.643c9869.cd3@mercurio.local>

Bunny [1] is a Ruby RabbitMQ client that focuses on ease of use.?

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/03/27/bunny-1-dot-1-8-is-released/

1. http://rubybunny.info
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From PDEJAEGHERE at beckman.com  Thu Mar 27 11:05:17 2014
From: PDEJAEGHERE at beckman.com (De Jaeghere, Patrice PDJ)
Date: Thu, 27 Mar 2014 11:05:17 +0000
Subject: [rabbitmq-discuss] Possibilities of RabbitMq pluggin
Message-ID: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>

Hello,
We are using Rabbitmq for a distributed architecture project  and we have 2 needs:


1)                  We need an atomic function that verifies if an echange exists, creates it if it doesn't exist but return false if it exists.  Can we implement this function with a RabbitMQ pluggin in erlang and can we call this function with the dotnet driver (or extension?)



2)                  Other need:  When a queue has not anymore consumers ,  and if this queue is not persistent , is-it  possible to develop a RabbitMQ pluggin which moves all messages of this queue in a dead-letter queue just before its deletion.

For us, the idea is to have an optimized implementation without to have to use a distributed mutex  or a centralized service (to lock the verification and creation )  for the first need and an external agent for the second need .

If somebody has a good background of rabbitmq pluggin , thanks you to tell us if it's possible.




Please be advised that this email may contain confidential 
information.  If you are not the intended recipient, please notify us 
by email by replying to the sender and delete this message.  The 
sender disclaims that the content of this email constitutes an offer 
to enter into, or the acceptance of, any agreement; provided that the 
foregoing does not invalidate the binding effect of any digital or 
other electronic reproduction of a manual signature that is included 
in any attachment.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/49276c74/attachment.html>

From mklishin at gopivotal.com  Thu Mar 27 11:19:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 27 Mar 2014 15:19:26 +0400
Subject: [rabbitmq-discuss] Possibilities of RabbitMq pluggin
In-Reply-To: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>
References: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>
Message-ID: <etPan.5334095a.74b0dc51.cd3@mercurio.local>

On 27 March 2014 at 15:06:42, De Jaeghere, Patrice PDJ (pdejaeghere at beckman.com) wrote:
> >
> 1) We need an atomic function that verifies if an echange exists,  
> creates it if it doesn?t exist but return false if it exists. Can  
> we implement this function with a RabbitMQ pluggin in erlang  
> and can we call this function with the dotnet driver (or extension?)  

You don?t need a plugin to do this. Create a temporary channel (model in .NET
client) and use ExchangeDeclarePassive. If it raises an exception (RabbitMQ.Exceptions.OperationInterruptedException), the exchange does not exist,
otherwise it does.
Then use Model#ExchangeDeclare to declare it (if needed).

This is not atomic in the sense that it requires multiple requests but as long
as different apps/clients agree on exchange attributes, it is completely safe
to re-declare an exchange or use the above technique.?

> 2) Other need: When a queue has not anymore consumers , and if this  
> queue is not persistent , is-it possible to develop a RabbitMQ  
> pluggin which moves all messages of this queue in a dead-letter  
> queue just before its deletion.

This currently requires a plugin. If messages were dead-lettered
when a queue is deleted (e.g. because it was auto-deleted and the last consumer
disconnects), it would also be possible without a plugin, but that?s not the case.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Mar 27 11:23:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 27 Mar 2014 15:23:23 +0400
Subject: [rabbitmq-discuss] Possibilities of RabbitMq pluggin
In-Reply-To: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>
References: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>
Message-ID: <etPan.53340a47.2ae8944a.cd3@mercurio.local>

?On 27 March 2014 at 15:06:42, De Jaeghere, Patrice PDJ (pdejaeghere at beckman.com) wrote:
> > 2) Other need: When a queue has not anymore consumers , and if  
> this queue is not persistent , is-it possible to develop a RabbitMQ  
> pluggin which moves all messages of this queue in a dead-letter  
> queue just before its deletion.

The following might work: a separate app/thread/etc could check the number of
consumers on a queue and purge it, then all messages in the ready state
should be dead-lettered. To check a number of consumers on queue, declare it
(e.g. as passive) and check the returned value, QueueDeclareOk#ConsumerCount.

Also see [1].

1.?http://rabbitmq.com/dlx.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Mar 27 11:27:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Mar 2014 11:27:24 +0000
Subject: [rabbitmq-discuss] Possibilities of RabbitMq pluggin
In-Reply-To: <etPan.5334095a.74b0dc51.cd3@mercurio.local>
References: <8CF7D816ECB99F478FE167295F10FDDCC4E49D@DHREUSVXM04.danaher.org>
 <etPan.5334095a.74b0dc51.cd3@mercurio.local>
Message-ID: <53340B1C.10203@rabbitmq.com>

On 27/03/14 11:19, Michael Klishin wrote:
> This currently requires a plugin. If messages were dead-lettered
> when a queue is deleted (e.g. because it was auto-deleted and the last consumer
> disconnects), it would also be possible without a plugin, but that?s not the case.

One reason why we haven't done this yet is that it's actually quite hard 
to do it properly (it could take a long time; what happens if the server 
restarts while it's happening, what about HA failover, and so on).

It's on the radar for a future release, FWIW.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From grussell at gopivotal.com  Thu Mar 27 14:24:32 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 27 Mar 2014 10:24:32 -0400
Subject: [rabbitmq-discuss] uninterruptibleGet() in basicCancel (Java Client)
Message-ID: <CADtU9_ugw_iq7x90-X3uOtOBfkO8d6gLtZC2enGp6oCFCJemDQ@mail.gmail.com>

Hi guys,

Is this a known (or fixed) issue...

https://jira.spring.io/browse/AMQP-386  ?

It looks like the java client is blocked in basicCancel() waiting for a
reply.

Based on the line numbers, it looks like he's using the default (old)
version of the client (2.8.4) pulled in by the old version of Spring AMQP
he's using (1.1.3).

Thanks

Gary
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/531cc93c/attachment.html>

From mklishin at gopivotal.com  Thu Mar 27 14:31:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 27 Mar 2014 18:31:23 +0400
Subject: [rabbitmq-discuss] uninterruptibleGet() in basicCancel (Java
 Client)
In-Reply-To: <CADtU9_ugw_iq7x90-X3uOtOBfkO8d6gLtZC2enGp6oCFCJemDQ@mail.gmail.com>
References: <CADtU9_ugw_iq7x90-X3uOtOBfkO8d6gLtZC2enGp6oCFCJemDQ@mail.gmail.com>
Message-ID: <etPan.53343654.6b8b4567.d27e@mercurio.local>

On 27 March 2014 at 18:25:39, Gary Russell (grussell at gopivotal.com) wrote:
> > Is this a known (or fixed) issue...
>  
> https://jira.spring.io/browse/AMQP-386 ?

Yes:?https://bugzilla.rabbitmq.com/show_bug.cgi?id=25708

>  
> It looks like the java client is blocked in basicCancel() waiting  
> for a reply.
>  
> Based on the line numbers, it looks like he's using the default  
> (old) version of the client (2.8.4) pulled in by the old version  
> of Spring AMQP he's using (1.1.3).

The issue was that when you invoke a blocking operation (e.g. basic.consume or queue.declare)
from a basic.cancel handler, continuations deadlocked.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From grussell at gopivotal.com  Thu Mar 27 14:37:29 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 27 Mar 2014 10:37:29 -0400
Subject: [rabbitmq-discuss] uninterruptibleGet() in basicCancel (Java
	Client)
In-Reply-To: <etPan.53343654.6b8b4567.d27e@mercurio.local>
References: <CADtU9_ugw_iq7x90-X3uOtOBfkO8d6gLtZC2enGp6oCFCJemDQ@mail.gmail.com>
 <etPan.53343654.6b8b4567.d27e@mercurio.local>
Message-ID: <CADtU9_vtce4d2Jfa319Jq+CyzDDfLq6rOwT6HNu97sqJ9w24+A@mail.gmail.com>

Thanks, Michael.


On Thu, Mar 27, 2014 at 10:31 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 27 March 2014 at 18:25:39, Gary Russell (grussell at gopivotal.com) wrote:
> > > Is this a known (or fixed) issue...
> >
> > https://jira.spring.io/browse/AMQP-386 ?
>
> Yes: https://bugzilla.rabbitmq.com/show_bug.cgi?id=25708
>
> >
> > It looks like the java client is blocked in basicCancel() waiting
> > for a reply.
> >
> > Based on the line numbers, it looks like he's using the default
> > (old) version of the client (2.8.4) pulled in by the old version
> > of Spring AMQP he's using (1.1.3).
>
> The issue was that when you invoke a blocking operation (e.g.
> basic.consume or queue.declare)
> from a basic.cancel handler, continuations deadlocked.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/58eae0a3/attachment.html>

From matthias at rabbitmq.com  Thu Mar 27 14:57:06 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Mar 2014 14:57:06 +0000
Subject: [rabbitmq-discuss] uninterruptibleGet() in basicCancel (Java
 Client)
In-Reply-To: <etPan.53343654.6b8b4567.d27e@mercurio.local>
References: <CADtU9_ugw_iq7x90-X3uOtOBfkO8d6gLtZC2enGp6oCFCJemDQ@mail.gmail.com>
 <etPan.53343654.6b8b4567.d27e@mercurio.local>
Message-ID: <53343C42.7020503@rabbitmq.com>

On 27/03/14 14:31, Michael Klishin wrote:
> On 27 March 2014 at 18:25:39, Gary Russell (grussell at gopivotal.com) wrote:
>>> Is this a known (or fixed) issue...
>>
>> https://jira.spring.io/browse/AMQP-386 ?
>
> Yes: https://bugzilla.rabbitmq.com/show_bug.cgi?id=25708

i.e. fixed in 3.2.0, as per the release notes 
(http://www.rabbitmq.com/release-notes/README-3.2.0.txt):

25708 prevent deadlock when calling blocking operations in handleCancel
       (since 1.0.0)

Matthias.

From simon at rabbitmq.com  Thu Mar 27 17:33:56 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Mar 2014 17:33:56 +0000
Subject: [rabbitmq-discuss] When rabbitmq is clustered with one other
 node we see a very slow dequeue of messages
In-Reply-To: <loom.20140327T004155-966@post.gmane.org>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org> <52A7343D.4020003@rabbitmq.com>
 <loom.20131227T191248-958@post.gmane.org> <52CA7A64.3080102@rabbitmq.com>
 <loom.20140220T010144-922@post.gmane.org> <5305DCB4.5060903@rabbitmq.com>
 <loom.20140327T004155-966@post.gmane.org>
Message-ID: <53346104.60302@rabbitmq.com>

On 26/03/14 23:44, James Eddu wrote:
> I did test the RMQ from this branch here (bug25921)
> http://hg.rabbitmq.com/rabbitmq-server/rev/0afd7955a109  . But it did not
> seem to improve the original issue. Is this the complete fix, or is there
> possible other bug reports that where spawned from this one?

No, that's not considered finished yet.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Michel.Grenier at ssc-spc.gc.ca  Thu Mar 27 17:36:34 2014
From: Michel.Grenier at ssc-spc.gc.ca (Grenier,Michel [CMC])
Date: Thu, 27 Mar 2014 13:36:34 -0400
Subject: [rabbitmq-discuss] pika having 2 connections opened a consumer and
	a producer
In-Reply-To: <53346104.60302@rabbitmq.com>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org> <52A7343D.4020003@rabbitmq.com>
 <loom.20131227T191248-958@post.gmane.org> <52CA7A64.3080102@rabbitmq.com>
 <loom.20140220T010144-922@post.gmane.org> <5305DCB4.5060903@rabbitmq.com>
 <loom.20140327T004155-966@post.gmane.org> <53346104.60302@rabbitmq.com>
Message-ID: <7F414B031B795146A3697F7EF8C506679601FF@SQYL07EXMAIL7.quebec.int.ec.gc.ca>

Hi all

     In a python pika  script  is it possible to have 2 co-existing
connections
-	 one consuming from a broker1,   doing something with each
message and
-	 a second connected to broker2,  producing a different message
once the previous is processed.

    Any means to do so ?
    Any easy way to break each  ioloop needed into  mixed event module
calls  under a while loop or
    something better ?

		Michel Grenier
		(514) 421-7204


From simon at rabbitmq.com  Thu Mar 27 17:42:32 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Mar 2014 17:42:32 +0000
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <1395846757681-34344.post@n5.nabble.com>
References: <1395846757681-34344.post@n5.nabble.com>
Message-ID: <53346308.3000100@rabbitmq.com>

Using transactions does not prevent messages from being duplicated I'm 
afraid. The transactions are quite thin, they are not ACID. See 
http://www.rabbitmq.com/semantics.html

Messages that are in flight can always be duplicated when the client or 
server fails.

Cheers, Simon

On 26/03/14 15:12, lepolac wrote:
> Hello,
>
> When using transactions on the consumer side, I noticed duplicates when a
> node is failing.
> This occurs when the node the consumer is connected to fails, or if the
> master fails.
> It occurs both when catching the consumer cancellation exception and
> reconnecting directly, or using a simpler client and restarting it.
> I used a tx channel with basic.get and no autoack, I manually ack() and
> commit() every message.
>
> Whilst I can understand redelivery/dups when using asynchronous ways of
> consuming, I fail to see why it happens when using synchronous calls.
>
> I can reproduce this everytime, I always get one message redelivered, even
> if the commit() called return.
> I noticed that when throttling the consumer (let's say one message consumed
> every 100ms), I don't get dups.
>
> So, is the commit() call really synchronous ?
> Generally, what would be the best way to avoid duplicates ? I tried
> basicAck() without transactions and got the same results, I get dups.
>
> I'm using 3.2.4 and the java client.
> There's about 1ms latency between rabbit nodes and my client.
>
> Thanks
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Transactions-and-duplicate-tp34344.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mpietrek at skytap.com  Thu Mar 27 18:27:59 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 27 Mar 2014 11:27:59 -0700
Subject: [rabbitmq-discuss] Problems with the
 {cluster_partition_handling, pause_minority} option
In-Reply-To: <532817D3.2080901@rabbitmq.com>
References: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>
 <532817D3.2080901@rabbitmq.com>
Message-ID: <CACLE7iyH2d7tchau9M3MUnNbENh1i=jecwohjG08o_Ppy4DLUQ@mail.gmail.com>

Simon,

Based on this:

> he key factor seems to be (at a TCP level) that A realises it is
disconnected from B but not vice versa.

Should we expect a 3.2.5 at some point soon? I ask only because we're about
to upgrade to 3.2.4 in production, but will hold off if there's yet more
autoheal goodness coming.

Matt


On Tue, Mar 18, 2014 at 2:54 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. Just to let you know that this has not been forgotten about. I have
> reproduced the problem you describe and am investigating it. The key factor
> seems to be (at a TCP level) that A realises it is disconnected from B but
> not vice versa. Therefore (at an Erlang level) the partition is not
> detected.
>
> It's not specifically to do with pause_minority mode.
>
> I'll post more information when I have it.
>
> Cheers, Simon
>
>
> On 05/03/2014 17:18, David Rodrigues wrote:
>
>> Dear RabbitMQ Community,
>>
>> I'm having some problems with the {cluster_partition_handling,
>> pause_minority} option and I would like to share with you my doubts.
>>
>> First, the architecture. I'm running RabbitMQ 3.2.4 (Erlang R14A) on 3
>> nodes (rabbitmq at rabbitmq-test01, rabbitmq at rabbitmq-test02 and
>> rabbitmq at rabbitmq-test03) on a virtualized platform - quite similar to
>> EC2.  And because of that I have, from time to time, connectivity issues
>> - I know, that's bad ;)
>>
>> Digging into the doc I have found that the best way to handle the
>> problem is using the pause_minority option -
>> https://www.rabbitmq.com/partitions.html.
>>
>> But from time to time my nodes get disconnected from each other and do
>> not recover automatically. Hopefully I have managed to reproduce the
>> problem. Here are the steps.
>>
>> THE CONFIGURATION FILE
>> ***********************************************************
>>
>> My configuration file is quite simple:
>>
>> %% -*- mode: erlang -*-
>> [
>>   {rabbit,
>>    [
>>     {auth_mechanisms, ['PLAIN', 'AMQPLAIN']},
>>     {default_vhost,       <<"/">>},
>>     {default_user,        <<"admin">>},
>>     {default_pass,        <<"admin">>},
>>     {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
>>     {default_user_tags, [administrator]},
>>     {cluster_partition_handling, pause_minority},
>>     {cluster_nodes, {['rabbitmq at rabbitmq-test01',
>> 'rabbitmq at rabbitmq-test02', 'rabbitmq at rabbitmq-test03'], disc}}
>>    ]},
>>   {kernel, []},
>>   {rabbitmq_management, []},
>>   {rabbitmq_management_agent, []},
>>   {rabbitmq_shovel,
>>    [{shovels, []}
>>    ]},
>>   {rabbitmq_stomp, []},
>>   {rabbitmq_mqtt, []},
>>   {rabbitmq_amqp1_0, []},
>>   {rabbitmq_auth_backend_ldap, []}
>> ].
>>
>> Has you can see, the {cluster_partition_handling, pause_minority} option
>> is there.
>>
>> PAUSE_MINORITY WORKING
>> ***********************************************************
>>
>> When the network outage is long enough, the option works perfectly.
>>
>> To simulate a connection problem on rabbitmq-test03 I run:
>>
>> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test01 -j DROP
>> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test02 -j DROP
>>
>> Then wait long enough for the following messages to appear in the logs
>> of rabbitmq-test03 (approximately 180 seconds):
>>
>> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
>> ** Node 'rabbitmq at rabbitmq-test02' not responding **
>> ** Removing (timedout) connection **
>> =ERROR REPORT==== 5-Mar-2014::16:51:02 ===
>> ** Node 'rabbitmq at rabbitmq-test01' not responding **
>> ** Removing (timedout) connection **
>> =INFO REPORT==== 5-Mar-2014::16:51:02 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' down
>> =WARNING REPORT==== 5-Mar-2014::16:51:30 ===
>> Cluster minority status detected - awaiting recovery
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' down
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> Stopping RabbitMQ
>> =INFO REPORT==== 5-Mar-2014::16:51:30 ===
>> stopped TCP Listener on [::]:5672
>> =WARNING REPORT==== 5-Mar-2014::16:51:58 ===
>> Cluster minority status detected - awaiting recovery
>>
>> When flushing the rules (iptables -F) the connectivity is reestablished
>> and the cluster works perfectly.
>>
>> In the logs:
>>
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> started TCP Listener on [::]:5672
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' up
>> =INFO REPORT==== 5-Mar-2014::16:52:58 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' up
>>
>> Finally the cluster status :
>>
>> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
>> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                  'rabbitmq at rabbitmq-test03']}]},
>>   {running_nodes,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                   'rabbitmq at rabbitmq-test03']},
>>   {partitions,[]}]
>> ...done.
>>
>> So far, so good. The option works flawlessly.
>>
>> PAUSE_MINORITY NOT WORKING
>> ***********************************************************
>>
>> Life is not so bright when the network partition is not long enough.
>>
>> On rabbitmq-test03 I will run my iptables commands again:
>>
>> iptables -A INPUT -s rabbitmq-test01 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test01 -j DROP
>> iptables -A INPUT -s rabbitmq-test02 -j DROP; iptables -A OUTPUT -d
>> rabbitmq-test02 -j DROP
>>
>> However this time I'll only wait 60 seconds before flushing my rules
>> with iptables -F.
>>
>> And that's the result in rabbitmq-test03 logs:
>>
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test02' down
>> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
>> Mnesia('rabbitmq at rabbitmq-test03'): ** ERROR ** mnesia_event got
>> {inconsistent_database, running_partitioned_network,
>> 'rabbitmq at rabbitmq-test02'}
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test01' down
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> Statistics database started.
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> Statistics database started.
>>
>> Again, the result is quiet ugly on rabbitmq-test01:
>>
>> =ERROR REPORT==== 5-Mar-2014::16:55:00 ===
>> ** Node 'rabbitmq at rabbitmq-test03' not responding **
>> ** Removing (timedout) connection **
>> =INFO REPORT==== 5-Mar-2014::16:55:00 ===
>> rabbit on node 'rabbitmq at rabbitmq-test03' down
>> =INFO REPORT==== 5-Mar-2014::16:55:01 ===
>> global: Name conflict terminating {rabbit_mgmt_db,<2669.1582.0>}
>>
>> Finally my cluster status:
>>
>> Cluster status of node 'rabbitmq at rabbitmq-test03' ...
>> [{nodes,[{disc,['rabbitmq at rabbitmq-test01','rabbitmq at rabbitmq-test02',
>>                  'rabbitmq at rabbitmq-test03']}]},
>>   {running_nodes,['rabbitmq at rabbitmq-test03']},
>>   {partitions,[{'rabbitmq at rabbitmq-test03',['rabbitmq@
>> rabbitmq-test02']}]}]
>> ...done.
>>
>> That's it. Even with the pause_minority option my cluster was
>> disintegrated.
>>
>> SYNOPSIS
>> ***********************************************************
>>
>> In short, if the network outage is long enough everything goes according
>> to the plan and the cluster works perfectly once the connectivity is
>> reestablished. However if the network outage has a intermediate duration
>> (not too short, not too long) the pause_minority option seems not to work.
>>
>> Are you aware of this problem? Is there any solution to cope with this
>> particular situation?
>>
>> Thanks,
>> David
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/81f1a067/attachment.html>

From bernie at step.polymtl.ca  Thu Mar 27 19:59:58 2014
From: bernie at step.polymtl.ca (Bertrand Guay-Paquet)
Date: Thu, 27 Mar 2014 15:59:58 -0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
References: <5333037F.5020806@step.polymtl.ca>
 <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
Message-ID: <5334833E.1010508@step.polymtl.ca>

Thank you very much for your reply Michael.

> On 26 March 2014 at 20:44:04, Bertrand Guay-Paquet (bernie at step.polymtl.ca) wrote:
>>> My current understanding and questions:
>> 1) I don't see a need to have more than 1 Connection instance in
>> either
>> the servlet or the client. This connection should be created
>> on
>> application or servlet startup and closed on shutdown. Are there
>> pitfalls with long-lived connections or is this all handled
>> by RabbitMQ
>> (keep-alive)?
> RabbitMQ connections are supposed to be long-lived. Set heartbeat interval
> to a lower value (say, 60 seconds) if you have a firewall between clients
> and RabbitMQ.
I added this bit to my connection factory:
     ConnectionFactory factory = newConnectionFactory();
     factory.setRequestedHeartbeat(60);
     theConnection = factory.newConnection();

>> 2) How should I handle broken Connections to the broker? If a new
>> one
>> must be created, do all the channels need to be reopened as well?
> If a connection fails, it needs to be reopened, as do all the channels
> on it. Some clients support automatic recovery from TCP connection
> failures. Java client will offer this feature in the upcoming 3.3.0 release.
>     
>>   
>> 3) It seems like it would be bad practice to create a new channel
>> each
>> time a web request wants to publish a message. Should I pool them?
>> Share
>> a single one? Use ThreadLocals? Is there a problem if they're
>> never
>> closed (the connection would be on shutdown though)? The java
>> client api
>> documentation states that channels *should* be closed but that
>> it's not
>> necessary.
> Opening a channel is a network round trip. So is closing a channel. If that?s acceptable to you,
> opening and closing a channel per request is fine. Channels should not be shared
> across threads.
>
> For Web apps, a single connection and channel is usually sufficient, although
> in Java and .NET you need to understand how your framework dispatches requests
> in order to avoid concurrent publishes on a shared channel. Thread locals
> should work OK, especially if you can pre-initialise all channels.
I expect the message publishing activity to be low enough in the first 
implementation that I'll create a global synchronized publisher for the 
web app. I could always add more channels later if it becomes a bottleneck.

>
>> 4) My tests seem to show that when a subscribed consumer throws
>> an
>> exception in handleDelivery(), it consumes the rest of its buffered
>> messages and is then terminated.
> That?s not correct. You likely use automatic acknowledgements and/or a
> QueueingConsumer which accumulates all deliveries locally in a java.util.concurrent
> queue.
>
> See tutorial 2:
> http://www.rabbitmq.com/tutorials/tutorial-two-java.html
>
>> Does that mean I should never
>> throw
>> from handleDelivery()? Or should I monitor currently active
>> consumers
>> and restart the failed ones?
> Unhandled exceptions will be delegated to ExceptionHandler which
> is configured per channel. If you use manual acknowledgements,
> throwing exceptions in handleDelivery without acking or rejecting
> a delivery is not a very good idea: RabbitMQ will think that the
> delivery is still being processed, and will keep the message around.
Thanks for the insight. I'll dig into this more. I was using manual acks 
and extending DefaultConsumer so I must have gotten something else wrong.

Regards,
Bertrand

From bernie at step.polymtl.ca  Thu Mar 27 20:05:24 2014
From: bernie at step.polymtl.ca (Bertrand Guay-Paquet)
Date: Thu, 27 Mar 2014 16:05:24 -0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
References: <5333037F.5020806@step.polymtl.ca>
 <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
Message-ID: <53348484.7030403@step.polymtl.ca>

Forgot to mention regarding 4)

4) My tests seem to show that when a subscribed consumer throws an
exception in handleDelivery(), it consumes the rest of its buffered
messages and is then terminated.

This only happens if I don't do this:
channel.basicQos(1);

Setting the prefetch count to 1 makes the consumer shutdown right after 
an exception is thrown.

From Vinay.Nayak at edftrading.com  Thu Mar 27 14:47:07 2014
From: Vinay.Nayak at edftrading.com (Vinay Nayak)
Date: Thu, 27 Mar 2014 14:47:07 +0000
Subject: [rabbitmq-discuss] Client certificate based authentication over SSL
Message-ID: <E6BE019B8D79544680D6A89555B92CA61E43BD52@DCPWAEXCH03.edftrading.com>

Hi there,

We are trying to configure client certificate based authentication over SSL on our rabbitmq server. However we have hit an issue which we are unable to get past.
Can someone please help us figure out the solution?

Our configuration steps are as follows:

1)    Our RabbitMQ version is:

2)    We would like to achieve password-less authentication using client certificate and LDAP authorisation.

3)    For client certificates, we installed a stand-alone microsoft pki certification authority on our windows server 2008 R2 machine

4)    We then issued a client certificate via the certificate manager web portal i.e.

(https://<servername>/certmgr<https://%3cservername%3e/certmgr> -> Request a certificate -> Advanced certificate request -> Create and submit a request to this CA -> Filled in the details (with Client Authentication Certificate option selected)-> Submitted the request -> Approved -> Installed.
            Please note the Name on the certificate was set as username at domain.com<mailto:username at domain.com> (which is the CN for the user name in AD)

5)    We then issued an SSL certificate via the certificate manager web portal i.e. the same steps as above but this time had the "Server Authentication Certificate" selected
Please note the Name on the certificate was set as machine at domain.com<mailto:machine at domain.com>

6)    Downloaded the CA root certificate in .cer format and converted it into .pem using openssl

7)    Downloaded the Server certificate (from step 5) in .pfx format. It was then separated into ServerCertificate.pem and ServerCertificateKey.pem using openssl

8)    Downloaded the Client certificate (from step 4) in .pfx format. It was then separated into Cert.pem/ Key.pem and then combined into ClientCertificate.p12 using openssl

9)    Our rabbitmq config is:

[{rabbit,

            [{auth_backends, [rabbit_auth_backend_ldap]},

            {auth_mechanisms, ['EXTERNAL']},

            {ssl_listeners, [{"0.0.0.0", 5671}]},

            {ssl_options,

                        [{cacertfile,"C:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.2.3/certificates/pem/CARootCertificate.pem"},

        {certfile,"C:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.2.3/certificates/pem/ServerCertificate.pem"},

        {keyfile,"C:/Program Files (x86)/RabbitMQ Server/rabbitmq_server-3.2.3/certificates/key/ServerCertificateKey.key"},

        {verify,verify_peer},

        {fail_if_no_peer_cert,true}]},

            {ssl_cert_login_from, common_name}]

},

{rabbitmq_auth_backend_ldap,

            [

            {servers,               ["xxxxxxx.yyyyy.com"]},

            {dn_lookup_attribute,   "userPrincipalName"},

            {dn_lookup_base,        "DC= yyyyy,DC=com"},

            {use_ssl,               true},

            {port,                  636},

    {log,                   network},

    {vhost_access_query,    {in_group,

                                                                                    "ou=${vhost}-users,ou=computers,dc= yyyyy,dc=com"}},

            {resource_access_query,

                        {for,

                                    [{permission, configure, {in_group, "cn=domain users,dc= yyyyy,dc=com"}},

                                    {permission, write,

              {for, [{resource, queue,    {in_group, "cn=domain users,dc= yyyyy,dc=com"}},

                                                            {resource, exchange, {constant, true}}]}},

             {permission, read,

              {for, [{resource, exchange, {in_group, "cn=domain users,dc= yyyyy,dc=com"}},

                     {resource, queue,    {constant, true}}]}}

            ]

                        }},

            {tag_queries,           [{administrator, {constant, true}},

                                                                                    {management,    {constant, true}}]}

   ]}].

10)  Our client code is:

            cf.Ssl.ServerName = <CN Name of the server certificate i.e. machine at domain.com<mailto:machine at domain.com>>

           cf.Ssl.CertPath = @"C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.2.3\certificates\p12\ClientCertificate.p12";

            cf.Ssl.CertPassphrase = "rabbitmq";

            cf.Ssl.Enabled = true;

            cf.Ssl.AcceptablePolicyErrors = System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch |

            System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors|

            System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable;

11)  And following is our log:

=INFO REPORT==== 27-Mar-2014::14:35:23 ===

accepting AMQP connection <0.322.0> (a.b.c.d:2935 -> a.b.c.d:5671)



=INFO REPORT==== 27-Mar-2014::14:35:23 ===

LDAP CHECK: passwordless login for username at domain.com<mailto:username at domain.com>



=ERROR REPORT==== 27-Mar-2014::14:35:26 ===

closing AMQP connection <0.322.0> (a.b.c.d:2935 -> a.b.c.d:5671):

{handshake_error,starting,0,

    {exit,as_user_no_password,'connection.start_ok',

        [{rabbit_auth_backend_ldap,creds,2,[]},

         {rabbit_auth_backend_ldap,check_user_login,2,[]},

         {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},

         {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},

         {rabbit_reader,auth_phase,2,[]},

         {rabbit_reader,handle_method0,3,[]},

         {rabbit_reader,handle_input,3,[]},

         {rabbit_reader,recvloop,2,[]}]}}



And the .net error is "Possibly caused by authentication failure"


Regards,
Vinay

________________________________
This e-mail may contain information that is confidential, privileged or otherwise protected from disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute it by any means. Please delete it and any attachments and notify the sender that you have received it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a solicitation to buy or sell any commodities, financial risk management products, or other physical or financial product or service, an official confirmation of any transaction, or an official statement of EDF Trading Limited, EDF Trading Markets Limited, EDF Trading North America, LLC, or any of the EDF Group family of companies. Any views or opinions presented are solely those of the author and do not necessarily represent those of the foregoing entities. EDF Trading Markets Limited is authorised and regulated by the Financial Conduct Authority. VAT number: GB 735 5479 07. EDF Trading Markets Limited and EDF Trading North America, LLC are members of the EDF Group of companies. EDF Trading Markets Limited maintains its registered office at 80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL. A Company registered in England No. 4255974. EDF Trading North America, LLC is headquartered in the United States at 4700 W. Sam Houston Pkwy., Suite 250, Houston, TX 77041

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/bb0fa4e9/attachment.html>

From virus.vinay at gmail.com  Thu Mar 27 14:56:56 2014
From: virus.vinay at gmail.com (Vinay Nayak)
Date: Thu, 27 Mar 2014 07:56:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Client certificate based authentication over SSL
Message-ID: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>



Hi there,


 We are trying to configure client certificate based authentication over 
SSL on our rabbitmq server. However we have hit an issue which we are 
unable to get past.


Can someone please help us figure out the solution?


Our configuration steps are as follows:


1)    Our RabbitMQ version is: 3.2.3 ErLang R16B03-1

2) We would like to achieve password-less authentication using client 
certificate and LDAP authorisation.

3) For client certificates, we installed a stand-alone microsoft pki 
certification authority on our windows server 2008 R2 machine

4) We then issued a client certificate via the certificate manager web 
portal i.e.

(https://<servername>/certmgr -> Request a certificate -> Advanced 
certificate request -> Create and submit a request to this CA -> Filled in 
the details (with Client Authentication Certificate option selected)-> 
Submitted the request -> Approved -> Installed.

Please note the Name on the certificate was set as username at domain.com 
(which is the CN for the user name in AD)

5) We then issued an SSL certificate via the certificate manager web portal 
i.e. the same steps as above but this time had the ?Server Authentication 
Certificate? selected

Please note the Name on the certificate was set as machine at domain.com

6) Downloaded the CA root certificate in .cer format and converted it into 
.pem using openssl

7) Downloaded the Server certificate (from step 5) in .pfx format. It was 
then separated into ServerCertificate.pem and ServerCertificateKey.pem 
using openssl

8) Downloaded the Client certificate (from step 4) in .pfx format. It was 
then separated into Cert.pem/ Key.pem and then combined into 
ClientCertificate.p12 using openssl

9) Our rabbitmq config is:


[{rabbit,


            [{auth_backends, [rabbit_auth_backend_ldap]},


            {auth_mechanisms, ['EXTERNAL']},


            {ssl_listeners, [{"0.0.0.0", 5671}]},


            {ssl_options,


                        [{cacertfile,"C:/Program Files (x86)/RabbitMQ 
Server/rabbitmq_server-3.2.3/certificates/pem/CARootCertificate.pem"},


        {certfile,"C:/Program Files (x86)/RabbitMQ 
Server/rabbitmq_server-3.2.3/certificates/pem/ServerCertificate.pem"},


        {keyfile,"C:/Program Files (x86)/RabbitMQ 
Server/rabbitmq_server-3.2.3/certificates/key/ServerCertificateKey.key"},


        {verify,verify_peer},


        {fail_if_no_peer_cert,true}]},


            {ssl_cert_login_from, common_name}]


},


{rabbitmq_auth_backend_ldap,


            [


            {servers,               ["xxxxxxx.yyyyy.com"]},


            {dn_lookup_attribute,   "userPrincipalName"},


            {dn_lookup_base,        "DC= yyyyy,DC=com"},


            {use_ssl,               true},


            {port,                  636},


    {log,                   network},


    {vhost_access_query,    {in_group,


                                                                            
        "ou=${vhost}-users,ou=computers,dc= yyyyy,dc=com"}},


            {resource_access_query,


                        {for,


                                    [{permission, configure, {in_group, 
"cn=domain users,dc= yyyyy,dc=com"}},


                                    {permission, write,


              {for, [{resource, queue,    {in_group, "cn=domain users,dc= 
yyyyy,dc=com"}},


                                                            {resource, 
exchange, {constant, true}}]}},


             {permission, read,


              {for, [{resource, exchange, {in_group, "cn=domain users,dc= 
yyyyy,dc=com"}},


                     {resource, queue,    {constant, true}}]}}


            ]


                        }},


            {tag_queries,           [{administrator, {constant, true}},


                                                                            
        {management,    {constant, true}}]}


   ]}].


10) Our client code is:

            cf.Ssl.ServerName = <CN Name of the server certificate i.e. 
machine at domain.com>

            cf.Ssl.CertPath = @"C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.2.3\certificates\p12\ClientCertificate.p12";

            cf.Ssl.CertPassphrase = "rabbitmq";

            cf.Ssl.Enabled = true;

            cf.Ssl.AcceptablePolicyErrors = 
System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch |

            
System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors|

            
System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable;


11) And following is our log:


=INFO REPORT==== 27-Mar-2014::14:35:23 ===


accepting AMQP connection <0.322.0> (a.b.c.d:2935 -> a.b.c.d:5671)


 


=INFO REPORT==== 27-Mar-2014::14:35:23 ===


LDAP CHECK: passwordless login for username at domain.com


 


=ERROR REPORT==== 27-Mar-2014::14:35:26 ===


closing AMQP connection <0.322.0> (a.b.c.d:2935 -> a.b.c.d:5671):


{handshake_error,starting,0,


    {exit,as_user_no_password,'connection.start_ok',


        [{rabbit_auth_backend_ldap,creds,2,[]},


         {rabbit_auth_backend_ldap,check_user_login,2,[]},


         {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},


         {lists,foldl,3,[{file,"lists.erl"},{line,1248}]},


         {rabbit_reader,auth_phase,2,[]},


         {rabbit_reader,handle_method0,3,[]},


         {rabbit_reader,handle_input,3,[]},


         {rabbit_reader,recvloop,2,[]}]}}


 


And the .net error is ?Possibly caused by authentication failure?


 


Regards,


Vinay


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/5362c523/attachment.html>

From andra.dinu at erlang-solutions.com  Thu Mar 27 15:46:57 2014
From: andra.dinu at erlang-solutions.com (Andra Dinu)
Date: Thu, 27 Mar 2014 08:46:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang User Conference 9-10 June: 70% of
 speakers now up, Keynote speakers announced
Message-ID: <b9923f38-f7c3-44f6-96ea-1c1e1716ae21@googlegroups.com>

Join us in Stockholm for over 50 talks on open-source applications, 
products and case studies. The keynotes will be delivered by Stuart Bailey, 
CTO of Infoblox and to Katie Miller, OpenShift Developer Advocate and 
Co-founder of the Lambda Ladies. 

70% of the speakers are already up on the website, including:
O'Reilly author Bruce Tate, Co-designer of Haskell and QuickCheck John 
Hughes, Manager of the Erlang / OTP Dev Team at Ericsson Kenneth Lundin, Klarna's 
chief scientist Erik Stenman, Rakuten lead technologist Yosuke Hara, 
Feuerlabs Co-founder and Developer Advocate Ulf Wiger and many more:  

Early Bird rates end on 9 May.
http://www.erlang-factory.com/conference/EUC2014/

Also check out the 3-day training courses on 11-13 June: Erlang Express, 
OTP Express, Elixir, Coweboy Express and Test Driven Development. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/ff705756/attachment.html>

From lepolac at gmail.com  Thu Mar 27 19:05:18 2014
From: lepolac at gmail.com (lepolac)
Date: Thu, 27 Mar 2014 12:05:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <53346308.3000100@rabbitmq.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com>
Message-ID: <1395947118215-34367.post@n5.nabble.com>

Thanks for your reply.

But in the case of a commit() call that has returned, and assuming it is
synchronous and waits for the broker's tx-ok before returning, the message
shouldn't be in flight anymore right ?

I'm not talking about a crash during a commit(), in which case I understand
there's absolutely no guarantee whatsoever.

However, if the broker fails after my commit() call has returned, to me this
sounds like the transaction I submitted has been performed.

The doc reads "On the consuming side, the acknowledgements are
transactional,"
If the ack is transactional, then how can the client get a duplicate ?
If the client calls basicAck(), then commit(), what happens exactly ?

I understand rabbitmq transactions aren't pure XA ones and that I should
expect thinner guarantees, but just trying to understand the behavior here.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Transactions-and-duplicate-tp34344p34367.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Mar 27 21:09:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Mar 2014 21:09:27 +0000
Subject: [rabbitmq-discuss] Client certificate based authentication over
 SSL
In-Reply-To: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>
References: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>
Message-ID: <53349387.2070506@rabbitmq.com>

On 27/03/2014 14:56, Vinay Nayak wrote:
>      {exit,as_user_no_password,'connection.start_ok',

So I think this ("as_user_no_password") is the least clear error message 
I have ever perpetrated. It's getting made clearer in the next release.

What it's trying to say is:

"You have (successfully) authenticated a user without giving a password 
(using client certs instead). However, the 'other_bind' configuration 
item is set to 'as_user' which means that when I want to go to the LDAP 
server for authorisation queries, I should bind to it with the user's 
credentials. But I only know how to do that with the user's password. 
Which I don't have."

It's not made any clearer by the fact that 'as_user' is the default 
value for 'other_bind'.

So you must set 'other_bind' to 'anon' (bind anonymously for authZ 
queries), or {"someuser", "somepassword"} (bind with those creds for authZ).

Cheers, Simon


From aaron at agoragames.com  Thu Mar 27 21:10:30 2014
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 27 Mar 2014 17:10:30 -0400
Subject: [rabbitmq-discuss] haigha 0.7.0
Message-ID: <CAHiEoM6+ZfALPacxu6ysELEgj-jOJWXe0BFfRyU1UsKfr5t_4Q@mail.gmail.com>

It's been awhile since I posted about a haigha release, but today's 0.7.0
one is fairly big. Recent versions have progressively added support for
both synchronous and asynchronous modes, and with 0.7.0, synchronous usage
over an asynchronous transport, such as gevent, has been added. This gives
developers the ability to write simple application logic and exception
handling while keeping the ability to use all the power of greenlets
(threads coming soon). I would have made this a 1.0 release, but the
documentation needs a major overhaul.

-Aaron

-- 
Aaron Westendorf
Lead Engineer | Agora Games
aaron at agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/b0951f28/attachment.html>

From simon at rabbitmq.com  Thu Mar 27 21:14:15 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Mar 2014 21:14:15 +0000
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <1395947118215-34367.post@n5.nabble.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com> <1395947118215-34367.post@n5.nabble.com>
Message-ID: <533494A7.3030209@rabbitmq.com>

On 27/03/2014 19:05, lepolac wrote:
> But in the case of a commit() call that has returned, and assuming it is
> synchronous and waits for the broker's tx-ok before returning, the message
> shouldn't be in flight anymore right ?

Right.

But if you are consuming (it was not very clear from your original mail 
whether you were using basic.consume or basic.get) then subsequent 
messages can be duplicated.

i.e. it's not the messages you have acked that are the problem, it's the 
ones you haven't.

Cheers, Simon


From matthias at rabbitmq.com  Thu Mar 27 21:49:29 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Mar 2014 21:49:29 +0000
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <533494A7.3030209@rabbitmq.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com> <1395947118215-34367.post@n5.nabble.com>
 <533494A7.3030209@rabbitmq.com>
Message-ID: <53349CE9.2040205@rabbitmq.com>

On 27/03/14 21:14, Simon MacMullen wrote:
  > But if you are consuming (it was not very clear from your original mail
> whether you were using basic.consume or basic.get) then subsequent
> messages can be duplicated.

The OP said "I used a tx channel with basic.get and no autoack, I 
manually ack() and commit() every message."

Unlike publishes, acks do not have a corresponding confirmation. Not in 
the protocol, and, more importantly, not internally within the server. 
In a transaction context, the receipt of a commit-ok by a client 
therefore only indicates that the server has seen the acks, not that it 
has processed them, let alone persisted the information to disk.

We may want to make that clear in http://www.rabbitmq.com/semantics.html#tx

Duplicates are unavoidable in general, i.e. even if the tx guarantees 
were stronger there would still be plenty of failure scenarios that 
result in duplicates. Apps need to be able to cope with that.

Matthias.

From mpietrek at skytap.com  Thu Mar 27 22:15:11 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 27 Mar 2014 15:15:11 -0700
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
	then a terminal state
Message-ID: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>

Because we're sometimes just mean to our software, I wrote a torture test
to see how RabbitMQ's Autoheal deal with repeated partitions.

In a nutshell, we start with two brokers (3.2.4) in a cluster. I run my
test which uses "iptables" to knock out the link between the two brokers
and then restore things.

It does this break/fix continuously in a loop. The time between partitions,
and the time inside partitions is configurable.

Using 60 seconds between inducing a partition, and 60 seconds in a
partitioned state, I expect that this might be messy - The brokers try to
autoheal, and then everything falls apart. However, I'd expect that once I
stop my torture and return things back to "normal", that an autoheal will
eventually succeed and the brokers will be happily clustered again.

This isn't what happens. Instead, the two brokers essentially ignore each
other. Even after waiting for 10+ minutes. I can see each broker, but they
each think the other is missing.

Here's a filtered view of the logs, grepping for
"Autoheal|Starting|Stopping|Partitions|Winner|Loser":

rabbit at mq2.log: Autoheal request sent to rabbit at mq1

rabbit at mq2.log: Autoheal: I am the winner, waiting for [rabbit at mq1] to stop

rabbit at mq2.log: Autoheal: I am the winner, waiting additionally for
[rabbit at mq1] to stop

rabbit at mq1.log: Autoheal request sent to rabbit at mq1

rabbit at mq1.log: Autoheal request received from rabbit at mq1

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq2

rabbit at mq1.log:  * Losers:     [rabbit at mq1]

rabbit at mq1.log: Autoheal request received from rabbit at mq2

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq2

rabbit at mq1.log:  * Losers:     [rabbit at mq1]

rabbit at mq1.log: Autoheal: we were selected to restart; winner is rabbit at mq2

rabbit at mq1.log: Stopping RabbitMQ

rabbit at mq2.log: Autoheal: aborting - rabbit at mq1 went down

rabbit at mq2.log: Autoheal request sent to rabbit at mq1

rabbit at mq2.log: Autoheal: we were selected to restart; winner is rabbit at mq1

rabbit at mq2.log: Stopping RabbitMQ

rabbit at mq1.log: Autoheal: aborting - rabbit at mq2 went down

rabbit at mq1.log: Autoheal request sent to rabbit at mq1

rabbit at mq1.log: Autoheal request received from rabbit at mq2

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq1

rabbit at mq1.log:  * Losers:     [rabbit at mq2]

rabbit at mq1.log: Autoheal request received from rabbit at mq1

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq1

rabbit at mq1.log:  * Losers:     [rabbit at mq2]

rabbit at mq1.log: Autoheal: I am the winner, waiting for [rabbit at mq2] to stop

rabbit at mq1.log: Autoheal: I am the winner, waiting additionally for
[rabbit at mq2] to stop

rabbit at mq2.log: Autoheal: aborting - rabbit at mq1 went down

rabbit at mq2.log: Autoheal request sent to rabbit at mq1

rabbit at mq2.log: Autoheal: we were selected to restart; winner is rabbit at mq1

rabbit at mq1.log: Autoheal: aborting - rabbit at mq2 went down

rabbit at mq1.log: Autoheal request sent to rabbit at mq1

rabbit at mq1.log: Autoheal request received from rabbit at mq2

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq1

rabbit at mq1.log:  * Losers:     [rabbit at mq2]

rabbit at mq1.log: Autoheal request received from rabbit at mq1

rabbit at mq1.log: Autoheal decision

rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]

rabbit at mq1.log:  * Winner:     rabbit at mq1

rabbit at mq1.log:  * Losers:     [rabbit at mq2]

rabbit at mq1.log: Autoheal: I am the winner, waiting for [rabbit at mq2] to stop

rabbit at mq1.log: Autoheal: I am the winner, waiting additionally for
[rabbit at mq2] to stop

# And nothing else beyond this, even after waiting for 10+ minutes.

I don't ever see the "Stopping RabbitMQ" that I've seen in other Autoheal
circumstances.

I can send more complete logs, but wanted to see if this is a known issue
or expected behavior first.


Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/7cf00395/attachment.html>

From mklishin at gopivotal.com  Fri Mar 28 03:23:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 28 Mar 2014 07:23:54 +0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <53348484.7030403@step.polymtl.ca>
References: <5333037F.5020806@step.polymtl.ca>
 <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
 <53348484.7030403@step.polymtl.ca>
Message-ID: <etPan.5334eb69.6b8b4567.113f7@mercurio.local>

On 28 March 2014 at 00:06:51, Bertrand Guay-Paquet (bernie at step.polymtl.ca) wrote:
> > This only happens if I don't do this:
> channel.basicQos(1);

Default basic.qos value is ?unlimited?, so all messages are delivered
as fast as RabbitMQ can send them.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Anita.Yip at RealPage.com  Fri Mar 28 03:45:03 2014
From: Anita.Yip at RealPage.com (Anita Yip)
Date: Fri, 28 Mar 2014 03:45:03 +0000
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
	taking almost a minute
Message-ID: <CF5A3F8C.23504%anita.yip@realpage.com>

I have a spring amqp based application where the consumer is taking very long time to send acknowledgement. In RabbitMq management plugin, I see it in Unacknowledged state for almost a whole minute.I am currently testing this code by publishing only one message. But my prefetch count and transaction size are a 50 and 30 respectively. Could this be any reason for the issue?

My consumer has heavy processing. But since it is in auto acknowledge mode, I believe, the message will be acknowledged immediately after the consumer receives it and before it start processing the message. Is this assumption wrong?

Thanks,
Anita


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/7a2ba7e3/attachment.html>

From grussell at gopivotal.com  Fri Mar 28 03:53:28 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 27 Mar 2014 23:53:28 -0400
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CF5A3F8C.23504%anita.yip@realpage.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
Message-ID: <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>

Yes; that assumption is wrong; in Spring-AMQP, ack mode AUTO means the
container will automatically ack the message on completion. NONE is the
equivalent of rabbit auto-ack.

Be aware that this can cause OOM issues with spring-AMQP versions prior to
1.3.0, if the consumers can't keep up with the workload because the broker
will keep pumping messages to the client.

Gary


On Thu, Mar 27, 2014 at 11:45 PM, Anita Yip <Anita.Yip at realpage.com> wrote:

>   I have a spring amqp based application where the consumer is taking
> very long time to send acknowledgement. In RabbitMq management plugin, I
> see it in Unacknowledged state for almost a whole minute.I am currently
> testing this code by publishing only one message. But my prefetch count and
> transaction size are a 50 and 30 respectively. Could this be any reason for
> the issue?
>
>  My consumer has heavy processing. But since it is in auto acknowledge
> mode, I believe, the message will be acknowledged immediately after the
> consumer receives it and before it start processing the message. Is this
> assumption wrong?
>
>  Thanks,
> Anita
>
>
>
> ------------------------------
>
> This message is intended only for the use of the individual(s) or entity
> to which it is addressed and may contain information that is privileged,
> confidential, and/or proprietary to RealPage and its affiliated companies.
> If the reader of this message is not the intended recipient, you are hereby
> notified that any dissemination, distribution, forwarding or copying of
> this communication is prohibited without the express permission of the
> sender. If you have received this communication in error, please notify the
> sender immediately and delete the original message.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/a1f13d67/attachment.html>

From Anita.Yip at RealPage.com  Fri Mar 28 04:01:41 2014
From: Anita.Yip at RealPage.com (Anita Yip)
Date: Fri, 28 Mar 2014 04:01:41 +0000
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
Message-ID: <CF5A433E.2350E%anita.yip@realpage.com>

Thanks for the quick response. That is exactly what I am facing right now. Will try the ack mode to None. Thank you.

From: Gary Russell <grussell at gopivotal.com<mailto:grussell at gopivotal.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Thursday, March 27, 2014 8:53 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer taking almost a minute

Yes; that assumption is wrong; in Spring-AMQP, ack mode AUTO means the container will automatically ack the message on completion. NONE is the equivalent of rabbit auto-ack.

Be aware that this can cause OOM issues with spring-AMQP versions prior to 1.3.0, if the consumers can't keep up with the workload because the broker will keep pumping messages to the client.

Gary


On Thu, Mar 27, 2014 at 11:45 PM, Anita Yip <Anita.Yip at realpage.com<mailto:Anita.Yip at realpage.com>> wrote:
I have a spring amqp based application where the consumer is taking very long time to send acknowledgement. In RabbitMq management plugin, I see it in Unacknowledged state for almost a whole minute.I am currently testing this code by publishing only one message. But my prefetch count and transaction size are a 50 and 30 respectively. Could this be any reason for the issue?

My consumer has heavy processing. But since it is in auto acknowledge mode, I believe, the message will be acknowledged immediately after the consumer receives it and before it start processing the message. Is this assumption wrong?

Thanks,
Anita


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/4ddc4651/attachment.html>

From Anita.Yip at RealPage.com  Fri Mar 28 06:05:10 2014
From: Anita.Yip at RealPage.com (Anita Yip)
Date: Fri, 28 Mar 2014 06:05:10 +0000
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CF5A433E.2350E%anita.yip@realpage.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
Message-ID: <CF5A5F97.23546%anita.yip@realpage.com>

When I set acknowledge to none in spring configuration file, in the rabbit management UI, under Queues --> message rates chart, I see all the messages falling under "Deliver (noack)". Doesn't this mean that RabbitMq is not expecting/processing any acknowledgements from the consumer?

From: Anita Yip <Anita.Yip at RealPage.com<mailto:Anita.Yip at RealPage.com>>
Date: Thursday, March 27, 2014 9:06 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer taking almost a minute

Thanks for the quick response. That is exactly what I am facing right now. Will try the ack mode to None. Thank you.

From: Gary Russell <grussell at gopivotal.com<mailto:grussell at gopivotal.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Thursday, March 27, 2014 8:53 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer taking almost a minute

Yes; that assumption is wrong; in Spring-AMQP, ack mode AUTO means the container will automatically ack the message on completion. NONE is the equivalent of rabbit auto-ack.

Be aware that this can cause OOM issues with spring-AMQP versions prior to 1.3.0, if the consumers can't keep up with the workload because the broker will keep pumping messages to the client.

Gary


On Thu, Mar 27, 2014 at 11:45 PM, Anita Yip <Anita.Yip at realpage.com<mailto:Anita.Yip at realpage.com>> wrote:
I have a spring amqp based application where the consumer is taking very long time to send acknowledgement. In RabbitMq management plugin, I see it in Unacknowledged state for almost a whole minute.I am currently testing this code by publishing only one message. But my prefetch count and transaction size are a 50 and 30 respectively. Could this be any reason for the issue?

My consumer has heavy processing. But since it is in auto acknowledge mode, I believe, the message will be acknowledged immediately after the consumer receives it and before it start processing the message. Is this assumption wrong?

Thanks,
Anita


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/cd52134b/attachment.html>

From mklishin at gopivotal.com  Fri Mar 28 07:06:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 28 Mar 2014 11:06:14 +0400
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CF5A5F97.23546%anita.yip@realpage.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
 <CF5A5F97.23546%anita.yip@realpage.com>
Message-ID: <etPan.53351f7f.643c9869.113f7@mercurio.local>

On 28 March 2014 at 10:06:21, Anita Yip (anita.yip at realpage.com) wrote:
> > I see all the messages falling under "Deliver (noack)". Doesn't  
> this mean that RabbitMq is not expecting/processing any acknowledgements  
> from the consumer?

Correct. A message is then considered to be processed ?as soon as RabbitMQ
sends it out.
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From Petr.Gotthard at Honeywell.com  Fri Mar 28 08:37:22 2014
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 28 Mar 2014 08:37:22 +0000
Subject: [rabbitmq-discuss] badmatch when unbinding queue in web management
Message-ID: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>

Hello,
There is a strange queue in our RabbitMQ 3.2.2 (Erlang R16B01):

1) Web management says "Consumers: 1" in the Details section, but then "...no consumers..." in the Consumers section.

2) When I do "Delete / Purge" nothing happens. The Web management stops responding and no error appears in the log file.

3) When I try to unbind this queue nothing happens too, but there is a badmatch in the rabbitmq.log

=ERROR REPORT==== 28-Mar-2014::08:46:40 ===
** Generic server <0.7525.75> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.unbind',0,<<"efb.ok-3">>,<<"update">>,
                                   <<"aircraft.OK-3">>,
                                   [{<<"x-ground-bind">>,bool,true},
                                    {<<"x-ground-cos">>,long,3},
                                    {<<"x-ground-exchange">>,longstr,
                                     <<"update">>},
                                    {<<"x-reference">>,longstr,
                                     <<"Ground bind">>},
                                    {<<"x-result-x">>,longstr,
                                     <<"efb.ok-3">>}]},
                               none,noflow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.7520.75>,
                            <0.7520.75>,<0.7518.75>,
                            <<"<rabbit at ground.3.7518.75>">>,
                            {lstate,<0.7526.75>,false,false},
                            none,1,
                            {[],[]},
                            {user,<<"swim">>,
                                [administrator,impersonator],
                                rabbit_auth_backend_internal,
                                {internal_user,<<"swim">>,
                                    <<139,60,61,83,54,226,9,72,9,158,69,131,
                                      112,210,248,0,214,125,108,114>>,
                                    [administrator,impersonator]}},
                            <<"pavel">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {state,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},
                                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                erlang},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.7515.75>,
                            {state,fine,5000,#Ref<0.0.124.120869>},
                            false,1,
                            {{0,nil},{0,nil}},
                            [],
                            [{<<"publisher_confirms">>,bool,true},
                             {<<"exchange_exchange_bindings">>,bool,true},
                             {<<"basic.nack">>,bool,true},
                             {<<"consumer_cancel_notify">>,bool,true},
                             {<<"connection.blocked">>,bool,true},
                             {<<"authentication_failure_close">>,bool,true}],
                            {exchange,
                                {resource,<<"pavel">>,exchange,
                                    <<"amq.rabbitmq.trace">>},
                                topic,true,false,false,[],undefined,undefined,
                                {[],[]}}}
** Reason for termination ==
** {{error,{{badmatch,{error,[{root,none}],["aircraft","OK-3"]}},
            [{rabbit_exchange_type_topic,follow_down_get_path,2,[]},
             {rabbit_exchange_type_topic,'-remove_bindings/3-lc$^1/1-1-',1,[]},
             {rabbit_exchange_type_topic,remove_bindings,3,[]},
             {rabbit_binding,x_callback,4,[]},
             {rabbit_binding,'-process_deletions/1-fun-0-',2,[]},
             {dict,map_bucket,2,[{file,"dict.erl"},{line,460}]},
             {dict,map_bkt_list,2,[{file,"dict.erl"},{line,456}]},
             {dict,map_bkt_list,2,[{file,"dict.erl"},{line,456}]}]}},
    [{rabbit_misc,execute_mnesia_transaction,1,[]},
    {rabbit_misc,execute_mnesia_tx_with_tail,1,[]},
     {rabbit_channel,binding_action,9,[]},
     {rabbit_channel,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}


Do you have any idea what could be wrong?

Thanks,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/2e382600/attachment.html>

From tim at rabbitmq.com  Fri Mar 28 10:03:21 2014
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 28 Mar 2014 10:03:21 +0000
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
	then a terminal state
In-Reply-To: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
Message-ID: <8C01FDCB-ABFF-40E9-BB4B-D23D37F3790F@rabbitmq.com>

I don't suppose you can post the code that you're using to trigger this can you?

Cheers,
Tim

On 27 Mar 2014, at 22:15, Matt Pietrek wrote:

> Because we're sometimes just mean to our software, I wrote a torture test to see how RabbitMQ's Autoheal deal with repeated partitions.
> 
> In a nutshell, we start with two brokers (3.2.4) in a cluster. I run my test which uses "iptables" to knock out the link between the two brokers and then restore things.
> 
> It does this break/fix continuously in a loop. The time between partitions, and the time inside partitions is configurable.
> 
> Using 60 seconds between inducing a partition, and 60 seconds in a partitioned state, I expect that this might be messy - The brokers try to autoheal, and then everything falls apart. However, I'd expect that once I stop my torture and return things back to "normal", that an autoheal will eventually succeed and the brokers will be happily clustered again.
> 
> This isn't what happens. Instead, the two brokers essentially ignore each other. Even after waiting for 10+ minutes. I can see each broker, but they each think the other is missing.
> 
> Here's a filtered view of the logs, grepping for "Autoheal|Starting|Stopping|Partitions|Winner|Loser":
> 
> rabbit at mq2.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq2.log: Autoheal: I am the winner, waiting for [rabbit at mq1] to stop
> 
> rabbit at mq2.log: Autoheal: I am the winner, waiting additionally for [rabbit at mq1] to stop
> 
> rabbit at mq1.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq1
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq2
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq1]
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq2
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq2
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq1]
> 
> rabbit at mq1.log: Autoheal: we were selected to restart; winner is rabbit at mq2
> 
> rabbit at mq1.log: Stopping RabbitMQ
> 
> rabbit at mq2.log: Autoheal: aborting - rabbit at mq1 went down
> 
> rabbit at mq2.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq2.log: Autoheal: we were selected to restart; winner is rabbit at mq1
> 
> rabbit at mq2.log: Stopping RabbitMQ
> 
> rabbit at mq1.log: Autoheal: aborting - rabbit at mq2 went down
> 
> rabbit at mq1.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq2
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq1
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq2]
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq1
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq1
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq2]
> 
> rabbit at mq1.log: Autoheal: I am the winner, waiting for [rabbit at mq2] to stop
> 
> rabbit at mq1.log: Autoheal: I am the winner, waiting additionally for [rabbit at mq2] to stop
> 
> rabbit at mq2.log: Autoheal: aborting - rabbit at mq1 went down
> 
> rabbit at mq2.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq2.log: Autoheal: we were selected to restart; winner is rabbit at mq1
> 
> rabbit at mq1.log: Autoheal: aborting - rabbit at mq2 went down
> 
> rabbit at mq1.log: Autoheal request sent to rabbit at mq1
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq2
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq1
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq2]
> 
> rabbit at mq1.log: Autoheal request received from rabbit at mq1
> 
> rabbit at mq1.log: Autoheal decision
> 
> rabbit at mq1.log:  * Partitions: [[rabbit at mq1],[rabbit at mq2]]
> 
> rabbit at mq1.log:  * Winner:     rabbit at mq1
> 
> rabbit at mq1.log:  * Losers:     [rabbit at mq2]
> 
> rabbit at mq1.log: Autoheal: I am the winner, waiting for [rabbit at mq2] to stop
> 
> 
> rabbit at mq1.log: Autoheal: I am the winner, waiting additionally for [rabbit at mq2] to stop
> 
> # And nothing else beyond this, even after waiting for 10+ minutes.
> 
> I don't ever see the "Stopping RabbitMQ" that I've seen in other Autoheal circumstances.
> 
> I can send more complete logs, but wanted to see if this is a known issue or expected behavior first.
> 
> 
> 
> Matt
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/b1831d33/attachment.html>

From simon at rabbitmq.com  Fri Mar 28 10:19:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Mar 2014 10:19:38 +0000
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
 then a terminal state
In-Reply-To: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
Message-ID: <53354CBA.3040701@rabbitmq.com>

On 27/03/14 22:15, Matt Pietrek wrote:
> In a nutshell, we start with two brokers (3.2.4) in a cluster. I run my
> test which uses "iptables" to knock out the link between the two brokers
> and then restore things.

There are a couple more autoheal bugs which have been fixed but not made 
it into a release yet. Could you try the same test with a nightly build?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 28 10:25:01 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Mar 2014 10:25:01 +0000
Subject: [rabbitmq-discuss] badmatch when unbinding queue in web
	management
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>
Message-ID: <53354DFD.9040603@rabbitmq.com>

On 28/03/14 08:37, Gotthard, Petr wrote:
> Do you have any idea what could be wrong?

Yes, there's a bug in topic exchanges which is seen when they have 
multiple bindings which have identical source, destination and routing 
key but differ in arguments.

This bug was introduced in 2.4.0 with fast topic routing, and has been 
fixed in hg but has not made it into a release yet - it will be fixed in 
3.3.0 when that comes out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From matthias at rabbitmq.com  Fri Mar 28 10:28:40 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Mar 2014 10:28:40 +0000
Subject: [rabbitmq-discuss] badmatch when unbinding queue in web
	management
In-Reply-To: <53354DFD.9040603@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>
 <53354DFD.9040603@rabbitmq.com>
Message-ID: <53354ED8.6000702@rabbitmq.com>

On 28/03/14 10:25, Simon MacMullen wrote:
> This bug was introduced in 2.4.0 with fast topic routing, and has been
> fixed in hg but has not made it into a release yet - it will be fixed in
> 3.3.0 when that comes out.

...and meanwhile you could try the nightly build.

Matthias.


From Petr.Gotthard at Honeywell.com  Fri Mar 28 11:36:51 2014
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 28 Mar 2014 11:36:51 +0000
Subject: [rabbitmq-discuss] badmatch when unbinding queue in web
 management
In-Reply-To: <53354DFD.9040603@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>
 <53354DFD.9040603@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D3FC64FDD@FR44EX3005.global.ds.honeywell.com>

I'm not sure this is the case; we don't have multiple identical bindings with different arguments.


In the meantime we discovered the scenario that causes the web unbinds to fail:
 -- client creates a binding with some parameters
 -- clients unbinds with different parameters (which will fail) and disconnects immediately

It seems that if I disconnect before the failed unbind is fully processed, the queue is left in some strange state. In this state the queue remains "active" forever and cannot be deleted.
Even the standard broker shutdown doesn't work and it is necessary to kill the broker by brute force (-9). After the broker is restarted, the queue can be deleted without any troubles. It almost looks as a way to cripple the broker using a standard AMQP client (a possible DOS attack?).

On the other hand, if there is some wait/sleep between the wrong unbind and the disconnection, everything works fine. This makes me believe there is some race condition in the "wrong unbind-disconnect" scenario.


Petr

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 28. b?ezna 2014 11:25
To: Discussions about RabbitMQ
Cc: Gotthard, Petr
Subject: Re: [rabbitmq-discuss] badmatch when unbinding queue in web management

On 28/03/14 08:37, Gotthard, Petr wrote:
> Do you have any idea what could be wrong?

Yes, there's a bug in topic exchanges which is seen when they have 
multiple bindings which have identical source, destination and routing 
key but differ in arguments.

This bug was introduced in 2.4.0 with fast topic routing, and has been 
fixed in hg but has not made it into a release yet - it will be fixed in 
3.3.0 when that comes out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 28 11:55:00 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Mar 2014 11:55:00 +0000
Subject: [rabbitmq-discuss] Client certificate based authentication over
 SSL
In-Reply-To: <499D01F7-44F7-45EC-998A-23FFB7AC0773@gmail.com>
References: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>
 <53349387.2070506@rabbitmq.com>
 <499D01F7-44F7-45EC-998A-23FFB7AC0773@gmail.com>
Message-ID: <53356314.6040201@rabbitmq.com>

On 28/03/14 11:46, Primary wrote:
> Thank you for your response.
> We have made a bit of a progress but are still struggling with a few things. Can you please give us some pointers:

Sure.

> 1) We tried using {other_bind, anon} but that still failed even though our AD allows anonymous access. Following is an extract of the log:
> {handandshake_error,starting,0,
>      {exit,
>          {error,operationsError},
>          'connection.start_ok',

"operationsError" is coming from the LDAP server. Unfortunately, that's 
all the detail it's giving out. From a quick google search it sounds 
like AD can return this error when the user is able to bind but not 
perform searches.

> 2) We used a {username, password} tuple to bind to the AD. Though
> this is not an ideal approach, we were able to bind to AD and
> authorise our certificate user. Isn't there a way to use the
> certificate itself to bind to AD rather giving a username, password
> in clear text?

I don't think so. While some LDAP servers support authentication via 
client certificate, the RabbitMQ LDAP plugin doesn't.

In 3.3.0 you will be able to specify a client certificate for the 
connection to the LDAP server - but only for one certificate for the 
RabbitMQ server, not passing through the user's certificate.

And of course it's not possible to pass through the user's certificate, 
since we only have the user's public key, which is not enough to 
impersonate the user.

> 3) Once this was done we had to then "create the certificate user
> with no password" in RabbitMQ admin and grant access to the virtual
> host via the admin. We want to get away with this i.e. having to
> maintain users outside the AD. Is there no way we can achieve this
> without having to create a user in RabbitMQ admin?

You don't need to create users in RabbitMQ's internal database, no.

Have you perhaps set the auth_backends to [rabbit_auth_backend_ldap, 
rabbit_auth_backend_internal]? You could be seeing the user failing to 
authenticate with LDAP and then successfully authenticating with the 
internal database.

> 4) This last bit is related to authorising access to the user. We are
> able to write, read and create queues if our resource access query is
> {constant, true}. To grant access based on AD groups we changed the
> query to

> {permission, write,
>  {for, [{resource, queue, {constant, true}},
>         {resource, exchange, {in_group, "cn=<Group Name>,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com"}}]}}
>
> However this does not work. The group does exist and the certificate
> user is a member of that group. We even tried giving a full group path
> without any success.

Well, that's for exchanges not queues, right?

> Following is an extract from our log:
>
> LDAP network traffic: search reply = {ok,
>                                       {'LDAPMessage',2,
>                                                       {searchResDone,           {'LDAPResult',noSuchObject,"DC=domain,DC=com",
> [48,48,48,48,50,48,56,68,58,32,                                                  78,97,109,101,69,114,114,58,32,68,83,73,68,45,48,51,49,48,48,                                                    50,48,65,44,32,112,114,111,98,108,101,109,32,50,48,48,49,32,                                                     40,78,79,95,79,66,74,69,67,84,41,44,32,100,97,116,97,32,48,44,                                                   32,98,101,115,116,32,109,97,116,
> 99,104,32,111,102,58,10,9,39,68,                                                            67,61,101,100,102,116,114,97,100,105,110,103,44,68,67,61,99,111,109,39,10,0],

That's the LDAP server returning noSuchObject. Are you absolutely sure 
you got the group DN right?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Mar 28 12:44:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Mar 2014 12:44:46 +0000
Subject: [rabbitmq-discuss] Problems with the
 {cluster_partition_handling, pause_minority} option
In-Reply-To: <CACLE7iyH2d7tchau9M3MUnNbENh1i=jecwohjG08o_Ppy4DLUQ@mail.gmail.com>
References: <CAL1hc3Xst83Cd7pRuvpqWxBY_QrHiw3z9jKYxZ3At6JLU9BaSg@mail.gmail.com>
 <532817D3.2080901@rabbitmq.com>
 <CACLE7iyH2d7tchau9M3MUnNbENh1i=jecwohjG08o_Ppy4DLUQ@mail.gmail.com>
Message-ID: <53356EBE.8090407@rabbitmq.com>

On 27/03/14 18:27, Matt Pietrek wrote:
> Simon,
>
> Based on this:
>
>  > he key factor seems to be (at a TCP level) that A realises it is
> disconnected from B but not vice versa.
>
> Should we expect a 3.2.5 at some point soon? I ask only because we're
> about to upgrade to 3.2.4 in production, but will hold off if there's
> yet more autoheal goodness coming.

There is (very unlikely to be) a 3.2.5.

3.3.0 is likely to be quite soon, and will feature some more autoheal 
fixes (as mentioned in my other mail).

But note that we still haven't done yet anything about this sort of 
asymmetrical disconnect.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From grussell at gopivotal.com  Fri Mar 28 15:03:08 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 28 Mar 2014 11:03:08 -0400
Subject: [rabbitmq-discuss] Spring-AMQP 1.3.0 Released
Message-ID: <CADtU9_s9aZ2ZQk6Hn6Quu2yZx+C0rFd82GmV9sf_Hmni9k+1TA@mail.gmail.com>

Lots of new features...

https://spring.io/blog/2014/03/28/spring-amqp-1-3-0-released
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/d6066fe7/attachment.html>

From james.eddy at us.thalesgroup.com  Fri Mar 28 18:34:19 2014
From: james.eddy at us.thalesgroup.com (James Eddy)
Date: Fri, 28 Mar 2014 18:34:19 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?Autoheal_torture_test_-_Initial_succ?=
	=?utf-8?q?ess=2C=09then_a_terminal_state?=
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
Message-ID: <loom.20140328T193005-238@post.gmane.org>

Hi Matt,

I've experienced some issues with autoheal as well (see thread 28127), when
you tested with ipdates did your test use REJECT or DROP? I've always had
the most issues with DROP (simulating an abrupt network outage). With reject
I haven't seen any issues.

Thanks,
James Eddy



From Anita.Yip at RealPage.com  Fri Mar 28 20:49:58 2014
From: Anita.Yip at RealPage.com (Anita Yip)
Date: Fri, 28 Mar 2014 20:49:58 +0000
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <etPan.53351f7f.643c9869.113f7@mercurio.local>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
 <CF5A5F97.23546%anita.yip@realpage.com>
 <etPan.53351f7f.643c9869.113f7@mercurio.local>
Message-ID: <CF5B2F78.236FF%anita.yip@realpage.com>

Does that mean no explicit acknowledgement is sent by consumer? What if
the message is lost before it reaches the consumer? When will the message
be removed from the queue in this case?



On 3/28/14 12:06 AM, "Michael Klishin" <mklishin at gopivotal.com> wrote:

>On 28 March 2014 at 10:06:21, Anita Yip (anita.yip at realpage.com) wrote:
>> > I see all the messages falling under "Deliver (noack)". Doesn't
>> this mean that RabbitMq is not expecting/processing any
>>acknowledgements
>> from the consumer?
>
>Correct. A message is then considered to be processed  as soon as RabbitMQ
>sends it out.
>--
>MK
>
>Software Engineer, Pivotal/RabbitMQ
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.

From grussell at gopivotal.com  Fri Mar 28 20:56:55 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 28 Mar 2014 16:56:55 -0400
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CF5B2F78.236FF%anita.yip@realpage.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
 <CF5A5F97.23546%anita.yip@realpage.com>
 <etPan.53351f7f.643c9869.113f7@mercurio.local>
 <CF5B2F78.236FF%anita.yip@realpage.com>
Message-ID: <CADtU9_v=jG_xRyAr93YHfwb-_0ZWn6xTBJqRqEMZKJCEsWjASQ@mail.gmail.com>

Your requirements seem to be a little unusual - you want the consumer to
ack as soon as you get the message but before the processing completes.

What if your consumer dies right after it acks - you'll still lose the
message in that case.

If you don't care about that situation, simply hand off the task to another
thread in your listener and the container will ack the message right after
the handoff (with ackmode AUTO).

What is the objection to it being "unacked" until the consumer completes
the work?

Gary


On Fri, Mar 28, 2014 at 4:49 PM, Anita Yip <Anita.Yip at realpage.com> wrote:

> Does that mean no explicit acknowledgement is sent by consumer? What if
> the message is lost before it reaches the consumer? When will the message
> be removed from the queue in this case?
>
>
>
> On 3/28/14 12:06 AM, "Michael Klishin" <mklishin at gopivotal.com> wrote:
>
> >On 28 March 2014 at 10:06:21, Anita Yip (anita.yip at realpage.com) wrote:
> >> > I see all the messages falling under "Deliver (noack)". Doesn't
> >> this mean that RabbitMq is not expecting/processing any
> >>acknowledgements
> >> from the consumer?
> >
> >Correct. A message is then considered to be processed  as soon as RabbitMQ
> >sends it out.
> >--
> >MK
> >
> >Software Engineer, Pivotal/RabbitMQ
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-discuss at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ________________________________
>
> This message is intended only for the use of the individual(s) or entity
> to which it is addressed and may contain information that is privileged,
> confidential, and/or proprietary to RealPage and its affiliated companies.
> If the reader of this message is not the intended recipient, you are hereby
> notified that any dissemination, distribution, forwarding or copying of
> this communication is prohibited without the express permission of the
> sender. If you have received this communication in error, please notify the
> sender immediately and delete the original message.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/a3bd6ee0/attachment.html>

From mpietrek at skytap.com  Fri Mar 28 21:00:48 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 28 Mar 2014 14:00:48 -0700
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
 then a terminal state
In-Reply-To: <53354CBA.3040701@rabbitmq.com>
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
 <53354CBA.3040701@rabbitmq.com>
Message-ID: <CACLE7ixiq-eMt8K32uiKFDVh-tmN_J0zYUYTZbdFttfD+xPFXQ@mail.gmail.com>

Thanks Simon.

Assuming the nightly build has a .deb package, I can give it a go.

Is there a particular build I should grab?

Matt


On Fri, Mar 28, 2014 at 3:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 27/03/14 22:15, Matt Pietrek wrote:
>
>> In a nutshell, we start with two brokers (3.2.4) in a cluster. I run my
>> test which uses "iptables" to knock out the link between the two brokers
>> and then restore things.
>>
>
> There are a couple more autoheal bugs which have been fixed but not made
> it into a release yet. Could you try the same test with a nightly build?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/ee3075ec/attachment.html>

From mpietrek at skytap.com  Fri Mar 28 21:02:22 2014
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 28 Mar 2014 14:02:22 -0700
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
 then a terminal state
In-Reply-To: <loom.20140328T193005-238@post.gmane.org>
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
 <loom.20140328T193005-238@post.gmane.org>
Message-ID: <CACLE7ixSgdbvsC+1kTsUbg+NiniNyriYCxyb_G9gQ0EsC=hV=A@mail.gmail.com>

James,

I'm using DROP, like this:

# 192.168.78.16 is the IP address of a target node (not the current node)
that we want to drop connectivity to
sudo iptables -I INPUT 1 -i eth0 -p tcp -s 192.168.78.16 -j DROP
sudo iptables -I OUTPUT 1 -o eth0 -p tcp -d 192.168.78.16 -j DROP


On Fri, Mar 28, 2014 at 11:34 AM, James Eddy
<james.eddy at us.thalesgroup.com>wrote:

> Hi Matt,
>
> I've experienced some issues with autoheal as well (see thread 28127), when
> you tested with ipdates did your test use REJECT or DROP? I've always had
> the most issues with DROP (simulating an abrupt network outage). With
> reject
> I haven't seen any issues.
>
> Thanks,
> James Eddy
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/77814f40/attachment.html>

From Anita.Yip at RealPage.com  Fri Mar 28 21:09:05 2014
From: Anita.Yip at RealPage.com (Anita Yip)
Date: Fri, 28 Mar 2014 21:09:05 +0000
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CADtU9_v=jG_xRyAr93YHfwb-_0ZWn6xTBJqRqEMZKJCEsWjASQ@mail.gmail.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
 <CF5A5F97.23546%anita.yip@realpage.com>
 <etPan.53351f7f.643c9869.113f7@mercurio.local>
 <CF5B2F78.236FF%anita.yip@realpage.com>
 <CADtU9_v=jG_xRyAr93YHfwb-_0ZWn6xTBJqRqEMZKJCEsWjASQ@mail.gmail.com>
Message-ID: <CF5B3359.2370D%anita.yip@realpage.com>

The only problem is my consumer has heavy processing, and the messages are hanging in the queue, the queue size keep growing thus finally resulting in Out of Memory error.

From: Gary Russell <grussell at gopivotal.com<mailto:grussell at gopivotal.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Friday, March 28, 2014 1:56 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer taking almost a minute

Your requirements seem to be a little unusual - you want the consumer to ack as soon as you get the message but before the processing completes.

What if your consumer dies right after it acks - you'll still lose the message in that case.

If you don't care about that situation, simply hand off the task to another thread in your listener and the container will ack the message right after the handoff (with ackmode AUTO).

What is the objection to it being "unacked" until the consumer completes the work?

Gary


On Fri, Mar 28, 2014 at 4:49 PM, Anita Yip <Anita.Yip at realpage.com<mailto:Anita.Yip at realpage.com>> wrote:
Does that mean no explicit acknowledgement is sent by consumer? What if
the message is lost before it reaches the consumer? When will the message
be removed from the queue in this case?



On 3/28/14 12:06 AM, "Michael Klishin" <mklishin at gopivotal.com<mailto:mklishin at gopivotal.com>> wrote:

>On 28 March 2014 at 10:06:21, Anita Yip (anita.yip at realpage.com<mailto:anita.yip at realpage.com>) wrote:
>> > I see all the messages falling under "Deliver (noack)". Doesn't
>> this mean that RabbitMq is not expecting/processing any
>>acknowledgements
>> from the consumer?
>
>Correct. A message is then considered to be processed  as soon as RabbitMQ
>sends it out.
>--
>MK
>
>Software Engineer, Pivotal/RabbitMQ
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


________________________________

This message is intended only for the use of the individual(s) or entity to which it is addressed and may contain information that is privileged, confidential, and/or proprietary to RealPage and its affiliated companies. If the reader of this message is not the intended recipient, you are hereby notified that any dissemination, distribution, forwarding or copying of this communication is prohibited without the express permission of the sender. If you have received this communication in error, please notify the sender immediately and delete the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/7af3cc9b/attachment.html>

From grussell at gopivotal.com  Fri Mar 28 21:16:16 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 28 Mar 2014 17:16:16 -0400
Subject: [rabbitmq-discuss] Spring amqp - auto acknowledge from consumer
 taking almost a minute
In-Reply-To: <CF5B3359.2370D%anita.yip@realpage.com>
References: <CF5A3F8C.23504%anita.yip@realpage.com>
 <CADtU9_vaQS0szGCXaa8OTsa_3LFKhh1y7jqEnnfFuicWSVBhVg@mail.gmail.com>
 <CF5A433E.2350E%anita.yip@realpage.com>
 <CF5A5F97.23546%anita.yip@realpage.com>
 <etPan.53351f7f.643c9869.113f7@mercurio.local>
 <CF5B2F78.236FF%anita.yip@realpage.com>
 <CADtU9_v=jG_xRyAr93YHfwb-_0ZWn6xTBJqRqEMZKJCEsWjASQ@mail.gmail.com>
 <CF5B3359.2370D%anita.yip@realpage.com>
Message-ID: <CADtU9_sR1A2kEog6L3J07h9S7EyavzqtNOdM9hMPu8VM9PXKzw@mail.gmail.com>

If your consumer(s) can't keep up with the workload, things are eventually
going to queue up somewhere; you are just moving the problem somewhere else.

Do you have enough resources to run multiple consumers?

Set concurrentConsumers=n to increase the number of consumers in the
listener container.


On Fri, Mar 28, 2014 at 5:09 PM, Anita Yip <Anita.Yip at realpage.com> wrote:

>   The only problem is my consumer has heavy processing, and the messages
> are hanging in the queue, the queue size keep growing thus finally
> resulting in Out of Memory error.
>
>   From: Gary Russell <grussell at gopivotal.com>
> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Date: Friday, March 28, 2014 1:56 PM
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] Spring amqp - auto acknowledge from
> consumer taking almost a minute
>
>   Your requirements seem to be a little unusual - you want the consumer
> to ack as soon as you get the message but before the processing completes.
>
>  What if your consumer dies right after it acks - you'll still lose the
> message in that case.
>
>  If you don't care about that situation, simply hand off the task to
> another thread in your listener and the container will ack the message
> right after the handoff (with ackmode AUTO).
>
>  What is the objection to it being "unacked" until the consumer completes
> the work?
>
>  Gary
>
>
> On Fri, Mar 28, 2014 at 4:49 PM, Anita Yip <Anita.Yip at realpage.com> wrote:
>
>> Does that mean no explicit acknowledgement is sent by consumer? What if
>> the message is lost before it reaches the consumer? When will the message
>> be removed from the queue in this case?
>>
>>
>>
>> On 3/28/14 12:06 AM, "Michael Klishin" <mklishin at gopivotal.com> wrote:
>>
>> >On 28 March 2014 at 10:06:21, Anita Yip (anita.yip at realpage.com) wrote:
>> >> > I see all the messages falling under "Deliver (noack)". Doesn't
>> >> this mean that RabbitMq is not expecting/processing any
>> >>acknowledgements
>> >> from the consumer?
>> >
>> >Correct. A message is then considered to be processed  as soon as
>> RabbitMQ
>> >sends it out.
>> >--
>> >MK
>> >
>> >Software Engineer, Pivotal/RabbitMQ
>> >_______________________________________________
>> >rabbitmq-discuss mailing list
>> >rabbitmq-discuss at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> ________________________________
>>
>> This message is intended only for the use of the individual(s) or entity
>> to which it is addressed and may contain information that is privileged,
>> confidential, and/or proprietary to RealPage and its affiliated companies.
>> If the reader of this message is not the intended recipient, you are hereby
>> notified that any dissemination, distribution, forwarding or copying of
>> this communication is prohibited without the express permission of the
>> sender. If you have received this communication in error, please notify the
>> sender immediately and delete the original message.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> ------------------------------
>
> This message is intended only for the use of the individual(s) or entity
> to which it is addressed and may contain information that is privileged,
> confidential, and/or proprietary to RealPage and its affiliated companies.
> If the reader of this message is not the intended recipient, you are hereby
> notified that any dissemination, distribution, forwarding or copying of
> this communication is prohibited without the express permission of the
> sender. If you have received this communication in error, please notify the
> sender immediately and delete the original message.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/aaa1c54b/attachment.html>

From matthias at rabbitmq.com  Fri Mar 28 22:47:53 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Mar 2014 22:47:53 +0000
Subject: [rabbitmq-discuss] Autoheal torture test - Initial success,
 then a terminal state
In-Reply-To: <CACLE7ixiq-eMt8K32uiKFDVh-tmN_J0zYUYTZbdFttfD+xPFXQ@mail.gmail.com>
References: <CACLE7iy1OGxzOW1gEYACr99S_3-buyN7xaatfUVxFMGAD4B8kQ@mail.gmail.com>
 <53354CBA.3040701@rabbitmq.com>
 <CACLE7ixiq-eMt8K32uiKFDVh-tmN_J0zYUYTZbdFttfD+xPFXQ@mail.gmail.com>
Message-ID: <5335FC19.6050802@rabbitmq.com>

On 28/03/14 21:00, Matt Pietrek wrote:
> Assuming the nightly build has a .deb package, I can give it a go.

Sure does. http://www.rabbitmq.com/nightly-builds.html. There's even a 
debian repo for it.

> Is there a particular build I should grab?

The most recent.

Matthias.


From ranjitiyer at gmail.com  Fri Mar 28 23:43:41 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Fri, 28 Mar 2014 16:43:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ SSL and Erlang SSL
Message-ID: <1396050220968-34403.post@n5.nabble.com>

Group,

I managed to configure SSL in RabbitMQ and I can establish SSL connections
between an AMQP client and RabbitMQ server.

My question is that in a multi-node scenario, are RabbitMQ nodes
automatically talking with each other over SSL as well? Or do I need to
configure SSL at the Erlang level as a separate step?

Thanks,
Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-SSL-and-Erlang-SSL-tp34403.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Sat Mar 29 10:39:48 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 29 Mar 2014 14:39:48 +0400
Subject: [rabbitmq-discuss] RabbitMQ SSL and Erlang SSL
In-Reply-To: <1396050220968-34403.post@n5.nabble.com>
References: <1396050220968-34403.post@n5.nabble.com>
Message-ID: <etPan.5336a30f.74b0dc51.113f7@mercurio.local>

?On 29 March 2014 at 03:44:48, ranjitiyer (ranjitiyer at gmail.com) wrote:
> > My question is that in a multi-node scenario, are RabbitMQ nodes  
> automatically talking with each other over SSL as well? Or do  
> I need to
> configure SSL at the Erlang level as a separate step?

Yes:?http://www.erlang.org/doc/apps/ssl/ssl_distribution.html
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From hackeron at gmail.com  Sun Mar 30 11:32:52 2014
From: hackeron at gmail.com (Roman Gaufman)
Date: Sun, 30 Mar 2014 11:32:52 +0100
Subject: [rabbitmq-discuss] Rabbitmq.com is down
Message-ID: <CAAs9BZPc8XGL2EVe=Vk_=6D8-Dtm5U9dQM_y-R3Fntjbv0jQbw@mail.gmail.com>

http://www.downforeveryoneorjustme.com/rabbitmq.com reports it is down and
I'm not able to apt-get install the rabbitmq package :(

Any ETA for when it will be back?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/b80a2af3/attachment.html>

From videlalvaro at gmail.com  Sun Mar 30 12:48:38 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 30 Mar 2014 13:48:38 +0200
Subject: [rabbitmq-discuss] Rabbitmq.com is down
In-Reply-To: <CAAs9BZPc8XGL2EVe=Vk_=6D8-Dtm5U9dQM_y-R3Fntjbv0jQbw@mail.gmail.com>
References: <CAAs9BZPc8XGL2EVe=Vk_=6D8-Dtm5U9dQM_y-R3Fntjbv0jQbw@mail.gmail.com>
Message-ID: <CAMcAHLXx66zjF3egnU+uJp7gn21sVn4prmKMJzUouy7nyr5nPg@mail.gmail.com>

I've just opened a ticket in our support system. Thanks for letting us know.

On Sun, Mar 30, 2014 at 12:32 PM, Roman Gaufman <hackeron at gmail.com> wrote:
> http://www.downforeveryoneorjustme.com/rabbitmq.com reports it is down and
> I'm not able to apt-get install the rabbitmq package :(
>
> Any ETA for when it will be back?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From stammailbox at gmail.com  Sun Mar 30 13:30:43 2014
From: stammailbox at gmail.com (rails)
Date: Sun, 30 Mar 2014 15:30:43 +0300
Subject: [rabbitmq-discuss] Is there a way to subscribe to all messages in a
	topic exchange
Message-ID: <CAJ2-Vrk_Jzqe41ykXXM2pVVPX16ZHO0qsNdtZ8NM6gKxszq_2Q@mail.gmail.com>

My exchange is direct.
Can I bind a queue that will get all messages from the queue (as # in topic
exchange)?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/0af7076f/attachment.html>

From videlalvaro at gmail.com  Sun Mar 30 13:49:18 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 30 Mar 2014 14:49:18 +0200
Subject: [rabbitmq-discuss] Is there a way to subscribe to all messages
 in a topic exchange
In-Reply-To: <CAJ2-Vrk_Jzqe41ykXXM2pVVPX16ZHO0qsNdtZ8NM6gKxszq_2Q@mail.gmail.com>
References: <CAJ2-Vrk_Jzqe41ykXXM2pVVPX16ZHO0qsNdtZ8NM6gKxszq_2Q@mail.gmail.com>
Message-ID: <CAMcAHLVJCni9WN2uejOpi1GBd8=mRGQtAZLDM=hjOi54gBYL3A@mail.gmail.com>

Hi,

On Sun, Mar 30, 2014 at 2:30 PM, rails <stammailbox at gmail.com> wrote:
> My exchange is direct.
> Can I bind a queue that will get all messages from the queue (as # in topic
> exchange)?

No, a queue will get the messages with a routing key that matches the
binding key.

If you need that kind of functionality then use a fanout exchange.

From videlalvaro at gmail.com  Sun Mar 30 16:55:55 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 30 Mar 2014 17:55:55 +0200
Subject: [rabbitmq-discuss] Rabbitmq.com is down
In-Reply-To: <CAMcAHLXx66zjF3egnU+uJp7gn21sVn4prmKMJzUouy7nyr5nPg@mail.gmail.com>
References: <CAAs9BZPc8XGL2EVe=Vk_=6D8-Dtm5U9dQM_y-R3Fntjbv0jQbw@mail.gmail.com>
 <CAMcAHLXx66zjF3egnU+uJp7gn21sVn4prmKMJzUouy7nyr5nPg@mail.gmail.com>
Message-ID: <CAMcAHLX-_b2+jUDaixW6pgEL0MEgUZGFOQi=OCHJpYQRgzFChA@mail.gmail.com>

And the website is back up. Thanks for reporting it.

On Sun, Mar 30, 2014 at 1:48 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> I've just opened a ticket in our support system. Thanks for letting us know.
>
> On Sun, Mar 30, 2014 at 12:32 PM, Roman Gaufman <hackeron at gmail.com> wrote:
>> http://www.downforeveryoneorjustme.com/rabbitmq.com reports it is down and
>> I'm not able to apt-get install the rabbitmq package :(
>>
>> Any ETA for when it will be back?
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From simon at rabbitmq.com  Sun Mar 30 19:58:32 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 30 Mar 2014 19:58:32 +0100
Subject: [rabbitmq-discuss] Is there a way to subscribe to all messages
 in a topic exchange
In-Reply-To: <CAMcAHLVJCni9WN2uejOpi1GBd8=mRGQtAZLDM=hjOi54gBYL3A@mail.gmail.com>
References: <CAJ2-Vrk_Jzqe41ykXXM2pVVPX16ZHO0qsNdtZ8NM6gKxszq_2Q@mail.gmail.com>
 <CAMcAHLVJCni9WN2uejOpi1GBd8=mRGQtAZLDM=hjOi54gBYL3A@mail.gmail.com>
Message-ID: <53386958.7070104@rabbitmq.com>

On 30/03/2014 1:49PM, Alvaro Videla wrote:
> On Sun, Mar 30, 2014 at 2:30 PM, rails <stammailbox at gmail.com> wrote:
>> My exchange is direct.
>> Can I bind a queue that will get all messages from the queue (as # in topic
>> exchange)?
>
> No, a queue will get the messages with a routing key that matches the
> binding key.
>
> If you need that kind of functionality then use a fanout exchange.

Note that you can use e2e bindings to combine a fanout and direct 
exchange. Declare one of each, bind the fanout as source and the direct 
as destination, and publish to the fanout. You can then bind queues to 
the fanout to get everything, or the direct to get those with a certain 
routing key.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Sun Mar 30 20:17:09 2014
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 30 Mar 2014 23:17:09 +0400
Subject: [rabbitmq-discuss] pika having 2 connections opened a consumer
 and a producer
In-Reply-To: <7F414B031B795146A3697F7EF8C506679601FF@SQYL07EXMAIL7.quebec.int.ec.gc.ca>
References: <083E352F62C9974389AD0F9F875EA238179D94A4F6@THSONEA03CMS03P.ONE-03.GRP>
 <529F14D9.8060203@rabbitmq.com>
 <083E352F62C9974389AD0F9F875EA238179D94AB3C@THSONEA03CMS03P.ONE-03.GRP>
 <loom.20131206T020729-16@post.gmane.org>
 <loom.20131206T221755-465@post.gmane.org>
 <52A7343D.4020003@rabbitmq.com> <loom.20131227T191248-958@post.gmane.org>
 <52CA7A64.3080102@rabbitmq.com> <loom.20140220T010144-922@post.gmane.org>
 <5305DCB4.5060903@rabbitmq.com> <loom.20140327T004155-966@post.gmane.org>
 <53346104.60302@rabbitmq.com>
 <7F414B031B795146A3697F7EF8C506679601FF@SQYL07EXMAIL7.quebec.int.ec.gc.ca>
Message-ID: <CAE3HoVS_U9KLKTmiTg=LNZhgnRCpmoT5uPQGSQdB-zaB2QOK2g@mail.gmail.com>

2014-03-27 21:36 GMT+04:00 Grenier,Michel [CMC] <
Michel.Grenier at ssc-spc.gc.ca>:

>      In a python pika  script  is it possible to have 2 co-existing
> connections
> -        one consuming from a broker1,   doing something with each
> message and
> -        a second connected to broker2,  producing a different message
> once the previous is processed.
>
>     Any means to do so ?
>

It should be possible (and quite straightforward) to create two connections
and use them concurrently.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/b25a8ef9/attachment.html>

From fred at dushin.net  Sun Mar 30 21:29:32 2014
From: fred at dushin.net (Dushin Fred)
Date: Sun, 30 Mar 2014 16:29:32 -0400
Subject: [rabbitmq-discuss] rabbitmq-c and SimpleAmqpClient SSL
	authentication
Message-ID: <EDD01DAC-FEF5-435F-A80D-C39E5D043DFD@dushin.net>

Hi Folks,

I have run into two issues with the (admittedly unsupported) rabbitmq-c and SimpleAmqpClient libraries.  (I realize I am hijacking the RabbtiMQ mailing list for this topic, but I am guessing the Pivotal folks don't mind, because this should result in an improvement of the overall RabbitMQ ecosystem.)

The first issue is with the SimpleAmqpClient library.  It appears that there is no knob in the Channel::CreateSecureChannel operation to disable hostname verification of the RabbitMQ server.  There is a knob in the rabbitmq-c API (amqp_ssl_socket_set_verify), but you need a socket to call it, and the only reasonable place to do that is in the Channel constructor.  I am including a patch off the github 2.3 tag for doing just that, though for some reason I did not track down, I could not get boost::make_shared take my new constructor signature, so I just used the shared_ptr constructor in the raw.  That may not fit the current model, but it seems harmless for testing.

> Note.  The reason we should allow disabling hostname verification is that there are tightly constrained deployments in which it is unreasonable to expect the RabbitMQ server certificate to correspond with the hostname of the machine on which the server is deployed.  Besides, I would argue that hostname verification is really targeted at e-commerce scenarios -- if you look at the history, it really came out of HTTP, where users needed some mechanism over the relatively weak trust model implemented in Web Browsers.  (Who ever takes the time to scour their operating systems trust store, anyway?)

The second issue has to do with client certificate authentication and the use of the EXTERNAL authentication mechanism.  I have been unable to get my C++ clients to authenticate and authorize using the rabbitmq-auth-mechanism-ssl plugin to a RabbitMQ server which is configured to support the EXTERNAL authentication mechanism.  (I can get an Erlang client to authorize to the same server and using the same client certificates, so I am confident it is not a server-side configuration issue.)

If I look at the rabbitmq-c code, I see that the C client library and API only seems to support the PLAIN SASL method.  For example, see the sasl_response definition at [1].

I would assume we'd need to add something similar, in order to support the EXTERNAL SASL mechanism.  (It looks to be supported in the Java APIs, as well, looking at the Javadoc [2]).  If so, would I need to start here to nail down the command protocol for EXTERNAL?  (I am guessing reverse engineering one of the supported client libraries would be the way forward here.)  Any pointers to docs on the EXTERNAL mechanism (at least WRT SSL client auth) or existing code would be greatly appreciated.

Thanks,

-Fred

[1] https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp_socket.c
[2] http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.2.4/rabbitmq-java-client-javadoc-3.2.4/com/rabbitmq/client/DefaultSaslConfig.html#EXTERNAL
[3] http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.connection

encl.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: patch.diff
Type: application/octet-stream
Size: 2541 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/080e29fc/attachment.obj>

From alan.antonuk at gmail.com  Mon Mar 31 01:46:14 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 30 Mar 2014 17:46:14 -0700
Subject: [rabbitmq-discuss] rabbitmq-c and SimpleAmqpClient SSL
	authentication
In-Reply-To: <EDD01DAC-FEF5-435F-A80D-C39E5D043DFD@dushin.net>
References: <EDD01DAC-FEF5-435F-A80D-C39E5D043DFD@dushin.net>
Message-ID: <CAAt2po+6rN=3LvAm1=tv+Mc9j=+ixaHZNo3-VQ1UoD60K9q-Fw@mail.gmail.com>

Fred;


On Sun, Mar 30, 2014 at 1:29 PM, Dushin Fred <fred at dushin.net> wrote:

> Hi Folks,
>
> I have run into two issues with the (admittedly unsupported) rabbitmq-c
> and SimpleAmqpClient libraries.  (I realize I am hijacking the RabbtiMQ
> mailing list for this topic, but I am guessing the Pivotal folks don't
> mind, because this should result in an improvement of the overall RabbitMQ
> ecosystem.)
>

Currently this mailing list is the best place to have discussions
concerning these two libraries.

>
> The first issue is with the SimpleAmqpClient library.  It appears that
> there is no knob in the Channel::CreateSecureChannel operation to disable
> hostname verification of the RabbitMQ server.  There is a knob in the
> rabbitmq-c API (amqp_ssl_socket_set_verify), but you need a socket to call
> it, and the only reasonable place to do that is in the Channel constructor.
>  I am including a patch off the github 2.3 tag for doing just that, though
> for some reason I did not track down, I could not get boost::make_shared
> take my new constructor signature, so I just used the shared_ptr
> constructor in the raw.  That may not fit the current model, but it seems
> harmless for testing.
>

This is probably what you want:
https://github.com/alanxz/SimpleAmqpClient/pull/85. In the future feel free
to open a pull-request against the library on github. The error you were
seeing with boost::make_shared most likely had to do its limit of 10
arguments.

>
>
> If I look at the rabbitmq-c code, I see that the C client library and API
> only seems to support the PLAIN SASL method.


That is correct. I'm open to adding support for additional SASL mechanisms
to rabbitmq-c. If the implementation of the SASL mechanism is anything more
than trivial (e.g., PLAIN really is dead-simple), rabbitmq-c should
probably link in a thoroughly tested external library (like cyrus-SASL).
Given use of these alternate SASL mechanisms appears to be very low, any
external library dependancies should remain optional. I can provide some
other hints to get started adding this to rabbitmq-c if you so desire.


>  Any pointers to docs on the EXTERNAL mechanism (at least WRT SSL client
> auth) or existing code would be greatly appreciated.
>

The RFC for SASL includes a pretty good description of how the SASL
EXTERNAL method should operate:
http://tools.ietf.org/html/rfc4422#appendix-A (it actually looks pretty
simple to implement).


-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/00673981/attachment.html>

From jhalterman at gmail.com  Mon Mar 31 05:56:27 2014
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Sun, 30 Mar 2014 21:56:27 -0700
Subject: [rabbitmq-discuss] Advice on where to reset connection and
	channel
In-Reply-To: <CAETr1H_mee56RoaKYA7ceppb6j7GRoPbCe5yLOUfzX8ys_-0eg@mail.gmail.com>
References: <CAETr1H_mee56RoaKYA7ceppb6j7GRoPbCe5yLOUfzX8ys_-0eg@mail.gmail.com>
Message-ID: <CA+es_-zRA0Qfat3mpqrm0f+MaHUos2_Ly8EhcWSiQ5mEOaZ7Gw@mail.gmail.com>

Hi Phil,

Late response, but you might check out Lyra - A RabbitMQ client designed to
handle every failure scenario that could reasonably occur via flexible
recovery/retry policies:

https://github.com/jhalterman/lyra

Handled scenarios:

https://github.com/jhalterman/lyra/wiki/Failure-Scenarios

Cheers,
Jonathan


On Sat, Feb 15, 2014 at 9:09 PM, cw storm <cwstorm at gmail.com> wrote:

> I'm interested in knowing how everyone uses the connection listener
> "ShutDownListener" and the consumer callback "handleShutDownSignal".  Both
> of these will be executed in an event a connection was close or a restart
> of the broker server.  I don't think I would want to include the function
> to re-establish the connection/channel in both of the handlers.  So, where
> would I perform the re-connect logic.  Maybe I should just pick one.
>
> Also, another consumer callback name "handleCancel".  This will only be
> invoke when an unexpected cancellation by the broker.  That would also mean
> I would have to reconsume from the other node by creating another
> connection/channel.  I assume this does not get invoke during a restart of
> the broker or a force close connection.  That would only apply to the two
> that I mentioned, right?
>
> -Phil
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/923b7349/attachment.html>

From alan.antonuk at gmail.com  Mon Mar 31 06:31:31 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 30 Mar 2014 22:31:31 -0700
Subject: [rabbitmq-discuss] rabbitmq-c and SimpleAmqpClient SSL
	authentication
In-Reply-To: <CAAt2po+6rN=3LvAm1=tv+Mc9j=+ixaHZNo3-VQ1UoD60K9q-Fw@mail.gmail.com>
References: <EDD01DAC-FEF5-435F-A80D-C39E5D043DFD@dushin.net>
 <CAAt2po+6rN=3LvAm1=tv+Mc9j=+ixaHZNo3-VQ1UoD60K9q-Fw@mail.gmail.com>
Message-ID: <CAAt2poKbkXs7RxAugJ4Qd1FY0GTOhQXr4skLNxXXLT5vgJtsQQ@mail.gmail.com>

I haven't tried it out yet, but here's a PR adding the EXTERNAL SASL
mechanism to rabbitmq-c.

https://github.com/alanxz/rabbitmq-c/pull/179

Feel free to try it out and let me know how it works.

-Alan


On Sun, Mar 30, 2014 at 5:46 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> Fred;
>
>
> On Sun, Mar 30, 2014 at 1:29 PM, Dushin Fred <fred at dushin.net> wrote:
>
>> Hi Folks,
>>
>> I have run into two issues with the (admittedly unsupported) rabbitmq-c
>> and SimpleAmqpClient libraries.  (I realize I am hijacking the RabbtiMQ
>> mailing list for this topic, but I am guessing the Pivotal folks don't
>> mind, because this should result in an improvement of the overall RabbitMQ
>> ecosystem.)
>>
>
> Currently this mailing list is the best place to have discussions
> concerning these two libraries.
>
>>
>> The first issue is with the SimpleAmqpClient library.  It appears that
>> there is no knob in the Channel::CreateSecureChannel operation to disable
>> hostname verification of the RabbitMQ server.  There is a knob in the
>> rabbitmq-c API (amqp_ssl_socket_set_verify), but you need a socket to call
>> it, and the only reasonable place to do that is in the Channel constructor.
>>  I am including a patch off the github 2.3 tag for doing just that, though
>> for some reason I did not track down, I could not get boost::make_shared
>> take my new constructor signature, so I just used the shared_ptr
>> constructor in the raw.  That may not fit the current model, but it seems
>> harmless for testing.
>>
>
> This is probably what you want:
> https://github.com/alanxz/SimpleAmqpClient/pull/85. In the future feel
> free to open a pull-request against the library on github. The error you
> were seeing with boost::make_shared most likely had to do its limit of 10
> arguments.
>
>>
>>
>> If I look at the rabbitmq-c code, I see that the C client library and API
>> only seems to support the PLAIN SASL method.
>
>
> That is correct. I'm open to adding support for additional SASL mechanisms
> to rabbitmq-c. If the implementation of the SASL mechanism is anything more
> than trivial (e.g., PLAIN really is dead-simple), rabbitmq-c should
> probably link in a thoroughly tested external library (like cyrus-SASL).
> Given use of these alternate SASL mechanisms appears to be very low, any
> external library dependancies should remain optional. I can provide some
> other hints to get started adding this to rabbitmq-c if you so desire.
>
>
>>  Any pointers to docs on the EXTERNAL mechanism (at least WRT SSL client
>> auth) or existing code would be greatly appreciated.
>>
>
> The RFC for SASL includes a pretty good description of how the SASL
> EXTERNAL method should operate:
> http://tools.ietf.org/html/rfc4422#appendix-A (it actually looks pretty
> simple to implement).
>
>
> -Alan
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/3824c76b/attachment.html>

From stammailbox at gmail.com  Mon Mar 31 09:12:41 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 11:12:41 +0300
Subject: [rabbitmq-discuss] How and when to archive messages by clients
Message-ID: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>

I couldn't find docs about archiving the routed messages
What are the benefits?
When is it recommended?
Is it supported by the client?
And which client support it (c++/java/.net)?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/572d32fa/attachment.html>

From lepolac at gmail.com  Thu Mar 27 21:46:31 2014
From: lepolac at gmail.com (lepolac)
Date: Thu, 27 Mar 2014 14:46:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <533494A7.3030209@rabbitmq.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com> <1395947118215-34367.post@n5.nabble.com>
 <533494A7.3030209@rabbitmq.com>
Message-ID: <1395956791715-34376.post@n5.nabble.com>

What if I have a prefetch value of 1 ?

Let's say

basic.get
basicack
commit() (the call returns)

then the node we're connected to crashes, or the master node crashes, I get
a duplicate.
Not duplicate only in terms of messages being tagged as _redelivered (which
makes sense for those that were in-flight), but duplicate as in that the
client already ack'ed and commit on those messages.

I'm sure I'm missing something here...



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Transactions-and-duplicate-tp34344p34376.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lepolac at gmail.com  Thu Mar 27 23:53:55 2014
From: lepolac at gmail.com (lepolac)
Date: Thu, 27 Mar 2014 16:53:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <53349CE9.2040205@rabbitmq.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com> <1395947118215-34367.post@n5.nabble.com>
 <533494A7.3030209@rabbitmq.com> <53349CE9.2040205@rabbitmq.com>
Message-ID: <1395964435049-34379.post@n5.nabble.com>

Hi,

Thanks for clearing it up !
And yeah, you definitely want to make it crystal clear in the doc somewhere
:)





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Transactions-and-duplicate-tp34344p34379.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mike.eklund at gmail.com  Fri Mar 28 01:08:43 2014
From: mike.eklund at gmail.com (Michael Eklund)
Date: Thu, 27 Mar 2014 18:08:43 -0700 (PDT)
Subject: [rabbitmq-discuss] SSL SHA256 issues
Message-ID: <c9a24a75-3b8f-4d53-a95a-b157a30323f9@googlegroups.com>

If I create certs following the example here<https://www.rabbitmq.com/ssl.html>with default_md = sha1, everything works fine. If I change it to default_md 
= sha256, it no longer works.  Not sure if this is a rabbitmq, or erlang 
issue, as I am new to both.

status is :

Status of node 'rabbit at hsv-testvm' ...
[{pid,24886},
 {running_applications,
     [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","3.2.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.2.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.2.4"},
      {rabbit,"RabbitMQ","3.2.4"},
      {ssl,"Erlang/OTP SSL application","4.1.6"},
      {public_key,"Public key infrastructure","0.13"},
      {crypto,"CRYPTO version 2","2.0.4"},
      {asn1,"The Erlang ASN1 compiler version 1.6.18","1.6.18"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.2.4"},
      {webmachine,"webmachine","1.10.3-rmq3.2.4-gite9359c7"},
      {mochiweb,"MochiMedia Web Server","2.7.0-rmq3.2.4-git680dba8"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,36051240},
      {connection_procs,42160},
      {queue_procs,61832},
      {plugins,430896},
      {other_proc,9398000},
      {mnesia,77504},
      {mgmt_db,76504},
      {msg_index,34880},
      {other_ets,1175576},
      {binary,1351520},
      {code,19660284},
      {atom,1780369},
      {other_system,1961715}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,5037924352},
 {disk_free_limit,50000000},
 {disk_free,8727261184},
 {file_descriptors,
    
 [{total_limit,924},{total_used,7},{sockets_limit,829},{sockets_used,5}]},
 {processes,[{limit,1048576},{used,242}]},
 {run_queue,0},
 {uptime,1094}]

config is:

% This file managed by Puppet
% Template Path: rabbitmq/templates/rabbitmq.config
[
  {rabbit, [

    {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"/tmp/testca/cacert.pem"},
                    {certfile,"/tmp/server/cert.pem"},
                    {keyfile,"/tmp/server/key.pem"},
                    {verify,verify_none},
                    {fail_if_no_peer_cert,false}]},
    {default_user, <<"guest">>},
    {default_pass, <<"guest">>}
  ]},
  {kernel, [

  ]}
,
% Configure the Stomp Plugin listening port
  {rabbitmq_stomp, [
    {tcp_listeners, [61613]}
,
    {ssl_listeners, [61614]}
  ]}
].
% EOF

Any help would be gladly accepted.

Regards,

Mike E.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140327/f6e46408/attachment.html>

From virus.vinay at gmail.com  Fri Mar 28 11:46:42 2014
From: virus.vinay at gmail.com (Primary)
Date: Fri, 28 Mar 2014 11:46:42 +0000
Subject: [rabbitmq-discuss] Client certificate based authentication over
	SSL
In-Reply-To: <53349387.2070506@rabbitmq.com>
References: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>
 <53349387.2070506@rabbitmq.com>
Message-ID: <499D01F7-44F7-45EC-998A-23FFB7AC0773@gmail.com>

Hi Simon,
 
Thank you for your response.
We have made a bit of a progress but are still struggling with a few things. Can you please give us some pointers:
1) We tried using {other_bind, anon} but that still failed even though our AD allows anonymous access. Following is an extract of the log:
{handandshake_error,starting,0,
    {exit,
        {error,operationsError},
        'connection.start_ok',
2) We used a {username, password} tuple to bind to the AD. Though this is not an ideal approach, we were able to bind to AD and authorise our certificate user. Isn't there a way to use the certificate itself to bind to AD rather giving a username, password in clear text?
3) Once this was done we had to then "create the certificate user with no password" in RabbitMQ admin and grant access to the virtual host via the admin. We want to get away with this i.e. having to maintain users outside the AD. Is there no way we can achieve this without having to create a user in RabbitMQ admin?
4) This last bit is related to authorising access to the user. We are able to write, read and create queues if our resource access query is {constant, true}. To grant access based on AD groups we changed the query to
{permission, write,
                                                {for, [{resource, queue, {constant, true}},                                                           {resource, exchange, {in_group, "cn=<Group Name>,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com"}}]}}
 
However this does not work. The group does exist and the certificate user is a member of that group. We even tried giving a full group path without any success.
 
Following is an extract from our log:
 
LDAP network traffic: search reply = {ok,
                                     {'LDAPMessage',2,
                                                     {searchResDone,           {'LDAPResult',noSuchObject,"DC=domain,DC=com",
[48,48,48,48,50,48,56,68,58,32,                                                  78,97,109,101,69,114,114,58,32,68,83,73,68,45,48,51,49,48,48,                                                    50,48,65,44,32,112,114,111,98,108,101,109,32,50,48,48,49,32,                                                     40,78,79,95,79,66,74,69,67,84,41,44,32,100,97,116,97,32,48,44,                                                   32,98,101,115,116,32,109,97,116,
99,104,32,111,102,58,10,9,39,68,                                                            67,61,101,100,102,116,114,97,100,105,110,103,44,68,67,61,99,111,109,39,10,0],
asn1_NOVALUE}}, asn1_NOVALUE}}
=INFO REPORT==== 28-Mar-2014::11:29:43 ===
LDAP evaluated in_group for "cn=Group,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com": {error,
noSuchObject}
 
Regards,
Vinay

> On 27 Mar 2014, at 21:09, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 27/03/2014 14:56, Vinay Nayak wrote:
>>     {exit,as_user_no_password,'connection.start_ok',
> 
> So I think this ("as_user_no_password") is the least clear error message I have ever perpetrated. It's getting made clearer in the next release.
> 
> What it's trying to say is:
> 
> "You have (successfully) authenticated a user without giving a password (using client certs instead). However, the 'other_bind' configuration item is set to 'as_user' which means that when I want to go to the LDAP server for authorisation queries, I should bind to it with the user's credentials. But I only know how to do that with the user's password. Which I don't have."
> 
> It's not made any clearer by the fact that 'as_user' is the default value for 'other_bind'.
> 
> So you must set 'other_bind' to 'anon' (bind anonymously for authZ queries), or {"someuser", "somepassword"} (bind with those creds for authZ).
> 
> Cheers, Simon
> 

From smbrown3706 at gmail.com  Fri Mar 28 15:52:17 2014
From: smbrown3706 at gmail.com (Sean Brown)
Date: Fri, 28 Mar 2014 11:52:17 -0400
Subject: [rabbitmq-discuss]  Draft of C++ rabbitMq API
Message-ID: <CAJ_dYMEp-8W2WZb0h9E4oZqGra7Qu1dw+p1VrGOZL92Bej7zoQ@mail.gmail.com>

I was wondering if you noticed any memory leaks associated with Queue and
Exchange declares? The AMQP connection object itself doesn't leak, but
whenever I do connection->createExchange() or connection->createQueue() I
always get a memory leak. Even if I don't use the objects, there's always
the same memory leaks per Exchange or Queue created.

--Sean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/016eb9ac/attachment.html>

From virus.vinay at gmail.com  Fri Mar 28 16:19:50 2014
From: virus.vinay at gmail.com (Primary)
Date: Fri, 28 Mar 2014 16:19:50 +0000
Subject: [rabbitmq-discuss] Client certificate based authentication over
	SSL
In-Reply-To: <53356314.6040201@rabbitmq.com>
References: <2aa3c027-69af-401e-adc2-9dbd23a86cff@googlegroups.com>
 <53349387.2070506@rabbitmq.com>
 <499D01F7-44F7-45EC-998A-23FFB7AC0773@gmail.com>
 <53356314.6040201@rabbitmq.com>
Message-ID: <D28E41B1-2EFC-4F3E-9777-956C7D5959B0@gmail.com>

Simon,
Mate,
1)    About the AD anonymous bind, we will check the ldap log for the bind and search results
2)    You are right about the users certificate being incomplete. Enhancements in 3.3.0 are encouraging as anything is better than a password in clear text.
3)    and 4) Am combining both the issues as the resolution was the same. We had an in_group query on the v_host query which was incorrect. The log wasn?t clear enough or maybe we were daft to start blaming it on authorisation.
Though we did not have backend_internal in our configuration, creating a ?certificate user with no password? and granting the user access to the virtual host seemed to fix the issue (weird).
However the problem was actually with the AD group path. In our absolute path to the AD group we got the units (OUs) in the wrong order. A quick dsquery on the group name gave us the right AD group absolute path.
Once we fixed the paths in our config and removed the user, it worked like a charm.
Infact we went ahead and secured our management portal using certificates.
 
Thanks a lot for your help mate. I??ll try and blog as much as I can (and remember) to help someone save time.
We are onto clustering and availability now. Hope that goes well. Thanks again.
Regards,
Vinay

> On 28 Mar 2014, at 11:55, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 28/03/14 11:46, Primary wrote:
>> Thank you for your response.
>> We have made a bit of a progress but are still struggling with a few things. Can you please give us some pointers:
> 
> Sure.
> 
>> 1) We tried using {other_bind, anon} but that still failed even though our AD allows anonymous access. Following is an extract of the log:
>> {handandshake_error,starting,0,
>>     {exit,
>>         {error,operationsError},
>>         'connection.start_ok',
> 
> "operationsError" is coming from the LDAP server. Unfortunately, that's all the detail it's giving out. From a quick google search it sounds like AD can return this error when the user is able to bind but not perform searches.
> 
>> 2) We used a {username, password} tuple to bind to the AD. Though
>> this is not an ideal approach, we were able to bind to AD and
>> authorise our certificate user. Isn't there a way to use the
>> certificate itself to bind to AD rather giving a username, password
>> in clear text?
> 
> I don't think so. While some LDAP servers support authentication via client certificate, the RabbitMQ LDAP plugin doesn't.
> 
> In 3.3.0 you will be able to specify a client certificate for the connection to the LDAP server - but only for one certificate for the RabbitMQ server, not passing through the user's certificate.
> 
> And of course it's not possible to pass through the user's certificate, since we only have the user's public key, which is not enough to impersonate the user.
> 
>> 3) Once this was done we had to then "create the certificate user
>> with no password" in RabbitMQ admin and grant access to the virtual
>> host via the admin. We want to get away with this i.e. having to
>> maintain users outside the AD. Is there no way we can achieve this
>> without having to create a user in RabbitMQ admin?
> 
> You don't need to create users in RabbitMQ's internal database, no.
> 
> Have you perhaps set the auth_backends to [rabbit_auth_backend_ldap, rabbit_auth_backend_internal]? You could be seeing the user failing to authenticate with LDAP and then successfully authenticating with the internal database.
> 
>> 4) This last bit is related to authorising access to the user. We are
>> able to write, read and create queues if our resource access query is
>> {constant, true}. To grant access based on AD groups we changed the
>> query to
> 
>> {permission, write,
>> {for, [{resource, queue, {constant, true}},
>>        {resource, exchange, {in_group, "cn=<Group Name>,ou=XXX,ou=Exchange,ou=Distribution Lists,dc=domain,dc=com"}}]}}
>> 
>> However this does not work. The group does exist and the certificate
>> user is a member of that group. We even tried giving a full group path
>> without any success.
> 
> Well, that's for exchanges not queues, right?
> 
>> Following is an extract from our log:
>> 
>> LDAP network traffic: search reply = {ok,
>>                                      {'LDAPMessage',2,
>>                                                      {searchResDone,           {'LDAPResult',noSuchObject,"DC=domain,DC=com",
>> [48,48,48,48,50,48,56,68,58,32,                                                  78,97,109,101,69,114,114,58,32,68,83,73,68,45,48,51,49,48,48,                                                    50,48,65,44,32,112,114,111,98,108,101,109,32,50,48,48,49,32,                                                     40,78,79,95,79,66,74,69,67,84,41,44,32,100,97,116,97,32,48,44,                                                   32,98,101,115,116,32,109,97,116,
>> 99,104,32,111,102,58,10,9,39,68,                                                            67,61,101,100,102,116,114,97,100,105,110,103,44,68,67,61,99,111,109,39,10,0],
> 
> That's the LDAP server returning noSuchObject. Are you absolutely sure you got the group DN right?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140328/db6f2567/attachment.html>

From leitao.otavio at gmail.com  Mon Mar 31 00:48:28 2014
From: leitao.otavio at gmail.com (=?UTF-8?Q?Ot=C3=A1vio_Leit=C3=A3o?=)
Date: Sun, 30 Mar 2014 16:48:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Custom load balancing among consumers?
Message-ID: <eedcbded-4e50-4f9b-8227-17d3f3653e69@googlegroups.com>

Hello,

I'm looking for a way of customizing the load balancing strategy used to 
deliver messages from queues to consumers. Is there a way of doing this?

In my case, I have messages with a "type" attribute and I want to deliver 
messages based on this attribute. For example, if I have a queue with the 
following messages (in order):

#1: msg-type1
#2: msg-type1
#3: msg-type2
#4: msg-type3
#5: msg-type2

I want them to be delivered and processed in the following order:
#1: msg-type1
#3: msg-type2
#4: msg-type3
#2: msg-type1
#5: msg-type2

I'ts a round-robin strategy among message "type" attribute. 

Does anyone have a solution for that?

Thanks in advance.

Ot?vio.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140330/2ad2f2e8/attachment.html>

From mklishin at gopivotal.com  Mon Mar 31 09:16:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 31 Mar 2014 12:16:57 +0400
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
Message-ID: <etPan.53392494.625558ec.61f@mercurio.local>

On 31 March 2014 at 12:15:01, rails (stammailbox at gmail.com) wrote:
> > I couldn't find docs about archiving the routed messages
> What are the benefits?

It?s up to app developers.

> When is it recommended?
> Is it supported by the client?
> And which client support it (c++/java/.net)?

You can replicate a message stream flowing into an exchange with an exchange-to-exchange binding
and route messages to a (group of) queue(s) you use for archiving.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Mar 31 09:22:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Mar 2014 09:22:43 +0100
Subject: [rabbitmq-discuss] SSL SHA256 issues
In-Reply-To: <c9a24a75-3b8f-4d53-a95a-b157a30323f9@googlegroups.com>
References: <c9a24a75-3b8f-4d53-a95a-b157a30323f9@googlegroups.com>
Message-ID: <533925D3.6040706@rabbitmq.com>

On 28/03/2014 01:08, Michael Eklund wrote:
> If I change it to default_md = sha256, it no longer works.

We can't help very much diagnosing problems without an error message or 
description of what doesn't work.

Cheers, Simon

From simon at rabbitmq.com  Mon Mar 31 09:29:09 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Mar 2014 09:29:09 +0100
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <etPan.53392494.625558ec.61f@mercurio.local>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
Message-ID: <53392755.7090801@rabbitmq.com>

On 31/03/2014 09:16, Michael Klishin wrote:
> You can replicate a message stream flowing into an exchange with an exchange-to-exchange binding
> and route messages to a (group of) queue(s) you use for archiving.

Or use http://www.rabbitmq.com/firehose.html

Cheers, Simon

From mklishin at gopivotal.com  Mon Mar 31 09:40:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 31 Mar 2014 12:40:52 +0400
Subject: [rabbitmq-discuss] Custom load balancing among consumers?
In-Reply-To: <eedcbded-4e50-4f9b-8227-17d3f3653e69@googlegroups.com>
References: <eedcbded-4e50-4f9b-8227-17d3f3653e69@googlegroups.com>
Message-ID: <etPan.53392a2f.46e87ccd.61f@mercurio.local>

On 31 March 2014 at 12:26:59, Ot?vio Leit?o (leitao.otavio at gmail.com) wrote:
> > I'ts a round-robin strategy among message "type" attribute.  
>  
> Does anyone have a solution for that?

Do you need strict ordering or messages or messages of type2, 3, ? to not block
processing of type1? If the latter, use multiple queues, one per type.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From matthias at rabbitmq.com  Mon Mar 31 10:17:05 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 31 Mar 2014 10:17:05 +0100
Subject: [rabbitmq-discuss] Transactions and duplicate
In-Reply-To: <1395964435049-34379.post@n5.nabble.com>
References: <1395846757681-34344.post@n5.nabble.com>
 <53346308.3000100@rabbitmq.com> <1395947118215-34367.post@n5.nabble.com>
 <533494A7.3030209@rabbitmq.com> <53349CE9.2040205@rabbitmq.com>
 <1395964435049-34379.post@n5.nabble.com>
Message-ID: <53393291.9000200@rabbitmq.com>

On 27/03/14 23:53, lepolac wrote:
> Thanks for clearing it up !
> And yeah, you definitely want to make it crystal clear in the doc somewhere
> :)

Done. See last paragraph in http://www.rabbitmq.com/semantics.html#tx

Matthias.

From matthias at rabbitmq.com  Mon Mar 31 12:04:38 2014
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 31 Mar 2014 12:04:38 +0100
Subject: [rabbitmq-discuss] badmatch when unbinding queue in web
	management
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D3FC64FDD@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D3FC64E9F@FR44EX3005.global.ds.honeywell.com>
 <53354DFD.9040603@rabbitmq.com>
 <F9E85480F62349458DF67CE8BA000D8D3FC64FDD@FR44EX3005.global.ds.honeywell.com>
Message-ID: <53394BC6.7060909@rabbitmq.com>

Petr,

On 28/03/14 11:36, Gotthard, Petr wrote:
> I'm not sure this is the case; we don't have multiple identical
> bindings with different arguments.
>
>
> In the meantime we discovered the scenario that causes the web
> unbinds to fail: -- client creates a binding with some parameters --
> clients unbinds with different parameters (which will fail) and
> disconnects immediately

We've had no joy reproducing this.

If this is easily reproducible for you, would you mind grabbing a 
nightly build and repeating your experiment?

Matthias.

From stammailbox at gmail.com  Mon Mar 31 13:38:27 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 15:38:27 +0300
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <53392755.7090801@rabbitmq.com>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
 <53392755.7090801@rabbitmq.com>
Message-ID: <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>

Oh,
I must have not explained myself well.
I was referring to sending gzipped messages to save traffic throughput.



On Mon, Mar 31, 2014 at 11:29 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 31/03/2014 09:16, Michael Klishin wrote:
>
>> You can replicate a message stream flowing into an exchange with an
>> exchange-to-exchange binding
>> and route messages to a (group of) queue(s) you use for archiving.
>>
>
> Or use http://www.rabbitmq.com/firehose.html
>
> Cheers, Simon
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/11325500/attachment.html>

From mklishin at gopivotal.com  Mon Mar 31 13:42:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 31 Mar 2014 16:42:55 +0400
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
 <53392755.7090801@rabbitmq.com>
 <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>
Message-ID: <etPan.533962ec.7545e146.61f@mercurio.local>

On 31 March 2014 at 16:40:45, rails (stammailbox at gmail.com) wrote:
> > I was referring to sending gzipped messages to save traffic  
> throughput.

Compression trades off CPU time for reduced traffic/disk space.

Only a benchmark with your actual payloads can tell if it?s
worth it for your case. Compression of very small messages almost always
does not make sense.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From cfautsch at goodgamestudios.com  Mon Mar 31 13:49:52 2014
From: cfautsch at goodgamestudios.com (Claire Fautsch)
Date: Mon, 31 Mar 2014 14:49:52 +0200
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>
 <530F2996.1090605@rabbitmq.com>
 <CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>
 <530F3006.9050501@rabbitmq.com>
 <CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>
 <530F3BEC.2080206@rabbitmq.com>
 <CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
Message-ID: <CAK+mrqraGs21ou-fLLXzyAA3_gzxj=fgwgn6MXR5enS_39o6UA@mail.gmail.com>

Dear all,

As promised after some time, here my feedback: We changed the prefetch
count on our shovels to 1000. Since then we observe that our Shovels are
running not nececesarrily faster (not expected) but for sure much more
stable.

Two observations we made:
- If no prefetch count is set, and we have a lot of "unacked" Messages,
which are currently residing inside the shovel, a connection loss from the
shovel to the destination broker, can cause the whole source broker to
crash (and all messages are lost if not persisted)
- It seems that messages in "unacked" State in the Source queue cannot be
paged to disk in case of high memory usage.

Thanks again for your advice!

Cheers,
Claire


2014-02-27 16:25 GMT+01:00 Claire Fautsch <cfautsch at goodgamestudios.com>:

> Great, Thanks for your valuable comments.
>
> We will for sure try this out, and I will provide some feedback on the
> outcome.
>
> Cheers,
> Claire
>
>
> 2014-02-27 14:21 GMT+01:00 Simon MacMullen <simon at rabbitmq.com>:
>
>> On 27/02/14 12:50, Jason McIntosh wrote:
>>
>>> SO I HIGHLY recommend setting a prefetch that's not unlimited if
>>> you're doing WAN replication,
>>>
>>
>> So do I. Maybe we should change the default. Hmm.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/294e3483/attachment.html>

From simon at rabbitmq.com  Mon Mar 31 14:00:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Mar 2014 14:00:24 +0100
Subject: [rabbitmq-discuss] Unexaplainable behaviour with shovel plugin.
In-Reply-To: <CAK+mrqraGs21ou-fLLXzyAA3_gzxj=fgwgn6MXR5enS_39o6UA@mail.gmail.com>
References: <CAK+mrqodJ2AXwsywejtxUHJtgtFy6KgdkY2GZbsLEc242etwRg@mail.gmail.com>	<530F2996.1090605@rabbitmq.com>	<CAK+mrqoXbz=LwOGB7URXDH+0GseewDy=zNaRFz094yrg8yEe7w@mail.gmail.com>	<530F3006.9050501@rabbitmq.com>	<CAD6m6fHCq_my_QUPTsYNO4Rj+nJNkQcLpSDVCoqX_xNiujQmrg@mail.gmail.com>	<530F3BEC.2080206@rabbitmq.com>	<CAK+mrqrVxbEiWwk-OeyomfEhHeS7qW7H5dwdH=+s9jRbCqbgNA@mail.gmail.com>
 <CAK+mrqraGs21ou-fLLXzyAA3_gzxj=fgwgn6MXR5enS_39o6UA@mail.gmail.com>
Message-ID: <533966E8.4050400@rabbitmq.com>

On 31/03/2014 1:49PM, Claire Fautsch wrote:
> As promised after some time, here my feedback: We changed the prefetch
> count on our shovels to 1000. Since then we observe that our Shovels are
> running not nececesarrily faster (not expected) but for sure much more
> stable.

Thanks for the feedback!

For reference, the next release will change the default prefetch to 1000.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From stammailbox at gmail.com  Mon Mar 31 14:09:15 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 16:09:15 +0300
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <etPan.533962ec.7545e146.61f@mercurio.local>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
 <53392755.7090801@rabbitmq.com>
 <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>
 <etPan.533962ec.7545e146.61f@mercurio.local>
Message-ID: <CAJ2-VrknAwecNDq-Vix8zWiyeSN98fipaWe9k7BypnqdhhQwGw@mail.gmail.com>

Just..
How do I do it with the rabbit clients?
Thanks.


On Mon, Mar 31, 2014 at 3:42 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 31 March 2014 at 16:40:45, rails (stammailbox at gmail.com) wrote:
> > > I was referring to sending gzipped messages to save traffic
> > throughput.
>
> Compression trades off CPU time for reduced traffic/disk space.
>
> Only a benchmark with your actual payloads can tell if it's
> worth it for your case. Compression of very small messages almost always
> does not make sense.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/6d84e5d7/attachment.html>

From mklishin at gopivotal.com  Mon Mar 31 14:14:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 31 Mar 2014 17:14:02 +0400
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <CAJ2-VrknAwecNDq-Vix8zWiyeSN98fipaWe9k7BypnqdhhQwGw@mail.gmail.com>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
 <53392755.7090801@rabbitmq.com>
 <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>
 <etPan.533962ec.7545e146.61f@mercurio.local>
 <CAJ2-VrknAwecNDq-Vix8zWiyeSN98fipaWe9k7BypnqdhhQwGw@mail.gmail.com>
Message-ID: <etPan.53396a35.5bd062c2.61f@mercurio.local>

On 31 March 2014 at 17:11:37, rails (stammailbox at gmail.com) wrote:
> > How do I do it with the rabbit clients?

RabbitMQ clients treat payloads as bags of bytes (or opaque strings).

Use whatever compression mechanism you want and maybe set
content-type and content-encoding delivery properties accordingly.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From stammailbox at gmail.com  Mon Mar 31 15:18:00 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 17:18:00 +0300
Subject: [rabbitmq-discuss] How and when to archive messages by clients
In-Reply-To: <etPan.53396a35.5bd062c2.61f@mercurio.local>
References: <CAJ2-Vr=h_FcMg_=hQ-urE5nOD2mSNPXzRZymPGDda7Hp=g-mfQ@mail.gmail.com>
 <etPan.53392494.625558ec.61f@mercurio.local>
 <53392755.7090801@rabbitmq.com>
 <CAJ2-Vrm6KcZhUN7Chg5h3G1rPM+-tsGRCWp4OUMgUT1ciOiK0w@mail.gmail.com>
 <etPan.533962ec.7545e146.61f@mercurio.local>
 <CAJ2-VrknAwecNDq-Vix8zWiyeSN98fipaWe9k7BypnqdhhQwGw@mail.gmail.com>
 <etPan.53396a35.5bd062c2.61f@mercurio.local>
Message-ID: <CAJ2-Vrk3PDOLVyXFxE_0jKzJ7O5VWvBmEEkvdKGw1DLEHObSEQ@mail.gmail.com>

Got it.
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/c425f9b0/attachment.html>

From stammailbox at gmail.com  Mon Mar 31 15:21:37 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 17:21:37 +0300
Subject: [rabbitmq-discuss] How to bind two exchanges without routing key
Message-ID: <CAJ2-VrnyARCbLCuv0MBOAx7V54-h3ycPbBRA2gXoi_OOZJH7XA@mail.gmail.com>

I need to listen to all messages going through my rabbit server.
I was offered in this forum to bind another exchange and move all the
messages to it
So I found ExchangeBind()
problem:
1. https://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
a. This page lacks the full explanation.
b. Due to a bug The picture do not apear.
2. I want to move all the messages to the other exchange and in the method
I have to define a routing key
3. How Can I configure this state in files (so in a new rabbit instance it
will be loaded before the first client runs.)
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/2709315c/attachment.html>

From breischl at gmail.com  Mon Mar 31 15:49:53 2014
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 31 Mar 2014 07:49:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
Message-ID: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>

I'm looking at using queues with the *exclusive* option for distributing 
configuration updates in my application. However, I'm worried that using 
the *exclusive* option makes the queue unreliable in the event of transient 
network problems. My thinking is that if the connection drops, then the 
queue is deleted along with any messages in it. My consumer will also be 
disconnected for some period of time while it reconnects and declares a new 
queue & bindings, during which time any new messages will not be delivered. 
Is that correct? If so, it seems like *exclusive* queues should not be used 
for messages you don't want to lose?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/aaaadd0b/attachment.html>

From breischl at gmail.com  Mon Mar 31 16:00:37 2014
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 31 Mar 2014 08:00:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Custom load balancing among consumers?
In-Reply-To: <eedcbded-4e50-4f9b-8227-17d3f3653e69@googlegroups.com>
References: <eedcbded-4e50-4f9b-8227-17d3f3653e69@googlegroups.com>
Message-ID: <f616bc5c-467f-4b08-9c4a-b91a4aef652c@googlegroups.com>

You might be able to implement this on the client side using a different 
queue for each message type, and having the clients implement the 
round-robin themselves. 

So what would happen if you got a bunch of type1 messages and no type2's? 
Do all of the types have to go to the same consumer? 

On Sunday, March 30, 2014 5:48:28 PM UTC-6, Ot?vio Leit?o wrote:
>
> Hello,
>
> I'm looking for a way of customizing the load balancing strategy used to 
> deliver messages from queues to consumers. Is there a way of doing this?
>
> In my case, I have messages with a "type" attribute and I want to deliver 
> messages based on this attribute. For example, if I have a queue with the 
> following messages (in order):
>
> #1: msg-type1
> #2: msg-type1
> #3: msg-type2
> #4: msg-type3
> #5: msg-type2
>
> I want them to be delivered and processed in the following order:
> #1: msg-type1
> #3: msg-type2
> #4: msg-type3
> #2: msg-type1
> #5: msg-type2
>
> I'ts a round-robin strategy among message "type" attribute. 
>
> Does anyone have a solution for that?
>
> Thanks in advance.
>
> Ot?vio.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/6cc78a6a/attachment.html>

From videlalvaro at gmail.com  Mon Mar 31 16:02:17 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 31 Mar 2014 17:02:17 +0200
Subject: [rabbitmq-discuss] How to bind two exchanges without routing key
In-Reply-To: <CAJ2-VrnyARCbLCuv0MBOAx7V54-h3ycPbBRA2gXoi_OOZJH7XA@mail.gmail.com>
References: <CAJ2-VrnyARCbLCuv0MBOAx7V54-h3ycPbBRA2gXoi_OOZJH7XA@mail.gmail.com>
Message-ID: <CAMcAHLX2XUtsr6kUfaPc6Vus4tVQfTD3hq55-XOyEMV3YWiMbg@mail.gmail.com>

Hi,

I've fixed the blog post so the graphics are displayed:
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

To bind to an exchange with an empty routing key you can do:
ch.exchangeBind("source", "destination", "");

See exchangeBind here:
http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.2.4/rabbitmq-java-client-javadoc-3.2.4/

About loading exchange definitions at startup, see this:
http://www.rabbitmq.com/management.html#load-definitions

Regards,

Alvaro

On Mon, Mar 31, 2014 at 4:21 PM, rails <stammailbox at gmail.com> wrote:
> I need to listen to all messages going through my rabbit server.
> I was offered in this forum to bind another exchange and move all the
> messages to it
> So I found ExchangeBind()
> problem:
> 1. https://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
> a. This page lacks the full explanation.
> b. Due to a bug The picture do not apear.
> 2. I want to move all the messages to the other exchange and in the method I
> have to define a routing key
> 3. How Can I configure this state in files (so in a new rabbit instance it
> will be loaded before the first client runs.)
> Thanks.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Mon Mar 31 16:06:55 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 31 Mar 2014 17:06:55 +0200
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
In-Reply-To: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
References: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
Message-ID: <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>

Hi,

Why do you need the queue to be exclusive? Perhaps you want exclusive
consumers? http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive

Regards,

Alvaro

On Mon, Mar 31, 2014 at 4:49 PM, Brian Reischl <breischl at gmail.com> wrote:
> I'm looking at using queues with the exclusive option for distributing
> configuration updates in my application. However, I'm worried that using the
> exclusive option makes the queue unreliable in the event of transient
> network problems. My thinking is that if the connection drops, then the
> queue is deleted along with any messages in it. My consumer will also be
> disconnected for some period of time while it reconnects and declares a new
> queue & bindings, during which time any new messages will not be delivered.
> Is that correct? If so, it seems like exclusive queues should not be used
> for messages you don't want to lose?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From breischl at gmail.com  Mon Mar 31 16:15:33 2014
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 31 Mar 2014 08:15:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
In-Reply-To: <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>
References: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
 <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>
Message-ID: <5efebe94-f7aa-4de9-b4b0-a068520b005f@googlegroups.com>

Mostly for convenience. I wanted to use anonymous (autonamed) queues, but 
not have to worry about cleaning them up later. *Auto-delete* might also 
fit the bill, but seems to have the same problems as *exclusive* as far as 
I can tell. I'm also just curious if I'm right about the behavior of *exclusive, 
*because if so it seems like a feature that should be used only rarely and 
very carefully. 

I'm thinking I might instead implement a naming scheme for the consumers, 
and use the *x-expires* argument to have the queues clean themselves up 
after perhaps 1 hour or so. 

On Monday, March 31, 2014 9:06:55 AM UTC-6, Alvaro Videla wrote:
>
> Hi, 
>
> Why do you need the queue to be exclusive? Perhaps you want exclusive 
> consumers? 
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive 
>
> Regards, 
>
> Alvaro 
>
> On Mon, Mar 31, 2014 at 4:49 PM, Brian Reischl <brei... at gmail.com<javascript:>> 
> wrote: 
> > I'm looking at using queues with the exclusive option for distributing 
> > configuration updates in my application. However, I'm worried that using 
> the 
> > exclusive option makes the queue unreliable in the event of transient 
> > network problems. My thinking is that if the connection drops, then the 
> > queue is deleted along with any messages in it. My consumer will also be 
> > disconnected for some period of time while it reconnects and declares a 
> new 
> > queue & bindings, during which time any new messages will not be 
> delivered. 
> > Is that correct? If so, it seems like exclusive queues should not be 
> used 
> > for messages you don't want to lose? 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > rabbitmq... at lists.rabbitmq.com <javascript:> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> > 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/aaa0edc7/attachment.html>

From videlalvaro at gmail.com  Mon Mar 31 16:23:55 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 31 Mar 2014 17:23:55 +0200
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
In-Reply-To: <5efebe94-f7aa-4de9-b4b0-a068520b005f@googlegroups.com>
References: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
 <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>
 <5efebe94-f7aa-4de9-b4b0-a068520b005f@googlegroups.com>
Message-ID: <CAMcAHLVK+gJE82zPQuw2awG+XiQw7Y6Lx3kXaqxDTqMJe8ENVw@mail.gmail.com>

Hi,

On Mon, Mar 31, 2014 at 5:15 PM, Brian Reischl <breischl at gmail.com> wrote:
> I'm thinking I might instead implement a naming scheme for the consumers,
> and use the x-expires argument to have the queues clean themselves up after
> perhaps 1 hour or so.

I was about to suggest the expires feature.

From stammailbox at gmail.com  Mon Mar 31 16:45:23 2014
From: stammailbox at gmail.com (rails)
Date: Mon, 31 Mar 2014 18:45:23 +0300
Subject: [rabbitmq-discuss] How to bind two exchanges without routing key
In-Reply-To: <CAMcAHLX2XUtsr6kUfaPc6Vus4tVQfTD3hq55-XOyEMV3YWiMbg@mail.gmail.com>
References: <CAJ2-VrnyARCbLCuv0MBOAx7V54-h3ycPbBRA2gXoi_OOZJH7XA@mail.gmail.com>
 <CAMcAHLX2XUtsr6kUfaPc6Vus4tVQfTD3hq55-XOyEMV3YWiMbg@mail.gmail.com>
Message-ID: <CAJ2-VrnMpoOpLP770sWJWLGgNQxWdtc2Qt6xnvRNBbv0Jm11Dg@mail.gmail.com>

Hi Alvaro.
Thanks for the quick fix

BTW: Going over your book helped me a lot in planning my pub sub system.
Thanks. :-)


On Mon, Mar 31, 2014 at 6:02 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> I've fixed the blog post so the graphics are displayed:
> http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
>
> To bind to an exchange with an empty routing key you can do:
> ch.exchangeBind("source", "destination", "");
>
> See exchangeBind here:
>
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.2.4/rabbitmq-java-client-javadoc-3.2.4/
>
> About loading exchange definitions at startup, see this:
> http://www.rabbitmq.com/management.html#load-definitions
>
> Regards,
>
> Alvaro
>
> On Mon, Mar 31, 2014 at 4:21 PM, rails <stammailbox at gmail.com> wrote:
> > I need to listen to all messages going through my rabbit server.
> > I was offered in this forum to bind another exchange and move all the
> > messages to it
> > So I found ExchangeBind()
> > problem:
> > 1.
> https://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
> > a. This page lacks the full explanation.
> > b. Due to a bug The picture do not apear.
> > 2. I want to move all the messages to the other exchange and in the
> method I
> > have to define a routing key
> > 3. How Can I configure this state in files (so in a new rabbit instance
> it
> > will be loaded before the first client runs.)
> > Thanks.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/38b63786/attachment.html>

From bernie at step.polymtl.ca  Mon Mar 31 16:59:01 2014
From: bernie at step.polymtl.ca (Bertrand Guay-Paquet)
Date: Mon, 31 Mar 2014 11:59:01 -0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
References: <5333037F.5020806@step.polymtl.ca>
 <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
Message-ID: <533990C5.9060509@step.polymtl.ca>

Hello,
>> Does that mean I should never
>> throw
>> from handleDelivery()? Or should I monitor currently active
>> consumers
>> and restart the failed ones?
> Unhandled exceptions will be delegated to ExceptionHandler which
> is configured per channel. If you use manual acknowledgements,
> throwing exceptions in handleDelivery without acking or rejecting
> a delivery is not a very good idea: RabbitMQ will think that the
> delivery is still being processed, and will keep the message around.
If there is a problem with the consumer's channel which, for example, 
causes the consumer to throw an IOException when acking the message, 
what happens to the message? Is it automatically delivered to the next 
available consumer? I don't see how the consumer with a broken channel 
could cleanly recover from this situation.. I'm handling other types of 
exceptions by rejecting invalid messages to avoid this situation where 
possible.

Regards,
Bertrand

From alan.antonuk at gmail.com  Mon Mar 31 17:57:03 2014
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 31 Mar 2014 16:57:03 +0000
Subject: [rabbitmq-discuss]  Draft of C++ rabbitMq API
References: <CAJ_dYMEp-8W2WZb0h9E4oZqGra7Qu1dw+p1VrGOZL92Bej7zoQ@mail.gmail.com>
Message-ID: <CAAt2poJi=Vg_ZZdgG32Ynz+n5v8+HThanMiCWBJjWbKJZaR4+A@mail.gmail.com>

Which C++ client are you using? (There is more than one out there...)

On Mon Mar 31 2014 at 1:21:18 AM, Sean Brown <smbrown3706 at gmail.com> wrote:

> I was wondering if you noticed any memory leaks associated with Queue and
> Exchange declares? The AMQP connection object itself doesn't leak, but
> whenever I do connection->createExchange() or connection->createQueue() I
> always get a memory leak. Even if I don't use the objects, there's always
> the same memory leaks per Exchange or Queue created.
>
> --Sean
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/a6d73dbc/attachment.html>

From mklishin at gopivotal.com  Mon Mar 31 19:32:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 31 Mar 2014 22:32:09 +0400
Subject: [rabbitmq-discuss] Connection and channel resource management
 in servlet
In-Reply-To: <533990C5.9060509@step.polymtl.ca>
References: <5333037F.5020806@step.polymtl.ca>
 <etPan.53331b6a.3d1b58ba.afcf@mercurio.local>
 <533990C5.9060509@step.polymtl.ca>
Message-ID: <etPan.5339b4c3.6b8b4567.5b41@mercurio.local>

On 31 March 2014 at 20:00:36, Bertrand Guay-Paquet (bernie at step.polymtl.ca) wrote:
> > If there is a problem with the consumer's channel which, for  
> example,
> causes the consumer to throw an IOException when acking the message,  
> what happens to the message? Is it automatically delivered to  
> the next
> available consumer?

Unacknowledged messages on a channel that is closed will be requeued.?
Channels are closed due to a channel-level error in the protocol, not unhandled
exceptions in a consumer method.?
--  
MK  

Software Engineer, Pivotal/RabbitMQ

From sergey at openbridge.com  Mon Mar 31 19:42:07 2014
From: sergey at openbridge.com (Sergey Dobrovolskiy)
Date: Mon, 31 Mar 2014 11:42:07 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.2.4  keeps crashing
Message-ID: <fdb07918-baea-4cba-b39a-d3bc7a1c28b1@googlegroups.com>

Hi everybody,

We updated a cluster from 3.2.3 because it had some bug that caused 
mirrored queue disappear. And now we have another issue. RabbitMQ clusters 
nodes keeps crashing. We've tried to setup different queues (HA, non HA) 
was playing around with messages (DISCK, RAM).
But still the same: One of two nodes goes down very often. 

that's the result from sasl log:

 =CRASH REPORT==== 28-Mar-2014::21:50:58 ===
  crasher:
    initial call: mnesia_subscr:init/1
    pid: <0.812.0>
    registered_name: mnesia_subscr
    exception exit: killed
      in function  gen_server:terminate/6 (gen_server.erl, line 744)
    ancestors: [mnesia_kernel_sup,mnesia_sup,<0.807.0>]
    messages: []
    links: []
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 233
    stack_size: 27
    reductions: 199
  neighbours:

=CRASH REPORT==== 28-Mar-2014::21:50:58 ===
  crasher:
    initial call: mnesia_monitor:init/1
    pid: <0.811.0>
    registered_name: mnesia_monitor
    exception exit: killed
      in function  gen_server:terminate/6 (gen_server.erl, line 744)
    ancestors: [mnesia_kernel_sup,mnesia_sup,<0.807.0>]
    messages: []
    links: [<7148.62.0>,<0.828.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2586
    stack_size: 27
    reductions: 2614
  neighbours:

=CRASH REPORT==== 28-Mar-2014::21:50:58 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.806.0>
    registered_name: []
    exception exit: {{shutdown,
                         {failed_to_start_child,mnesia_kernel_sup,killed}},
                     {mnesia_sup,start,[normal,[]]}}
      in function  application_master:init/4 (application_master.erl, line 
133)
    ancestors: [<0.805.0>]
    messages: [{'EXIT',<0.807.0>,normal}]
    links: [<0.805.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 376
    stack_size: 27
    reductions: 114
  neighbours:

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/5f43447f/attachment.html>

From ranjitiyer at gmail.com  Mon Mar 31 20:14:15 2014
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Mon, 31 Mar 2014 12:14:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ SSL and Erlang SSL
In-Reply-To: <etPan.5336a30f.74b0dc51.113f7@mercurio.local>
References: <1396050220968-34403.post@n5.nabble.com>
 <etPan.5336a30f.74b0dc51.113f7@mercurio.local>
Message-ID: <1396293255637-34447.post@n5.nabble.com>

Thanks. Would be good if RabbitMQ could address these issues (in addition to
embedded Erlang). That would hugely simplify the kind of effort I am going
through for including RabbitMQ in a COTS product.

Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-SSL-and-Erlang-SSL-tp34403p34447.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From idallas456 at gmail.com  Mon Mar 31 21:29:41 2014
From: idallas456 at gmail.com (Ian Dallas)
Date: Mon, 31 Mar 2014 14:29:41 -0600
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
In-Reply-To: <CAMcAHLVK+gJE82zPQuw2awG+XiQw7Y6Lx3kXaqxDTqMJe8ENVw@mail.gmail.com>
References: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
 <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>
 <5efebe94-f7aa-4de9-b4b0-a068520b005f@googlegroups.com>
 <CAMcAHLVK+gJE82zPQuw2awG+XiQw7Y6Lx3kXaqxDTqMJe8ENVw@mail.gmail.com>
Message-ID: <CAEm-HbLdYWp1TKfdXXr8Hx1SJziNGOnbPuqfKL+KM_S4uojPzg@mail.gmail.com>

What about an exclusive consumer option? What is your use cases?

Ian Dallas

On Mon, Mar 31, 2014 at 9:23 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> On Mon, Mar 31, 2014 at 5:15 PM, Brian Reischl <breischl at gmail.com> wrote:
> > I'm thinking I might instead implement a naming scheme for the consumers,
> > and use the x-expires argument to have the queues clean themselves up
> after
> > perhaps 1 hour or so.
>
> I was about to suggest the expires feature.
>
> --
> You received this message because you are subscribed to the Google Groups
> "rabbitmq-discuss" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to rabbitmq-discuss+unsubscribe at googlegroups.com.
> To post to this group, send email to rabbitmq-discuss at googlegroups.com.
> Visit this group at http://groups.google.com/group/rabbitmq-discuss.
> For more options, visit https://groups.google.com/d/optout.
>



-- 
Ian Dallas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/7a44dc0b/attachment.html>

From breischl at gmail.com  Mon Mar 31 21:34:45 2014
From: breischl at gmail.com (Brian Reischl)
Date: Mon, 31 Mar 2014 13:34:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Reliable delivery via exclusive queues
In-Reply-To: <CAEm-HbLdYWp1TKfdXXr8Hx1SJziNGOnbPuqfKL+KM_S4uojPzg@mail.gmail.com>
References: <40bf9352-08ee-4545-8750-ffa3b55a9aab@googlegroups.com>
 <CAMcAHLUpezDpeTSFNfrvBo9XiFv+bEnT4vh1ysrD0AV-EzRotg@mail.gmail.com>
 <5efebe94-f7aa-4de9-b4b0-a068520b005f@googlegroups.com>
 <CAMcAHLVK+gJE82zPQuw2awG+XiQw7Y6Lx3kXaqxDTqMJe8ENVw@mail.gmail.com>
 <CAEm-HbLdYWp1TKfdXXr8Hx1SJziNGOnbPuqfKL+KM_S4uojPzg@mail.gmail.com>
Message-ID: <7449fbe4-a3b9-4ab8-8a52-556dc4ebe0d1@googlegroups.com>

I want to distribute a configuration update to all the active nodes in my 
system. So I think what I want is actually the opposite of exclusive 
consumer.  

On Monday, March 31, 2014 2:29:41 PM UTC-6, Ian Dallas wrote:
>
> What about an exclusive consumer option? What is your use cases?
>
> Ian Dallas
>
> On Mon, Mar 31, 2014 at 9:23 AM, Alvaro Videla <videl... at gmail.com<javascript:>
> > wrote:
>
>> Hi,
>>
>> On Mon, Mar 31, 2014 at 5:15 PM, Brian Reischl <brei... at gmail.com<javascript:>> 
>> wrote:
>> > I'm thinking I might instead implement a naming scheme for the 
>> consumers,
>> > and use the x-expires argument to have the queues clean themselves up 
>> after
>> > perhaps 1 hour or so.
>>
>> I was about to suggest the expires feature.
>>
>> --
>> You received this message because you are subscribed to the Google Groups 
>> "rabbitmq-discuss" group.
>> To unsubscribe from this group and stop receiving emails from it, send an 
>> email to rabbitmq-discu... at googlegroups.com <javascript:>.
>> To post to this group, send email to rabbitmq... at googlegroups.com<javascript:>
>> .
>> Visit this group at http://groups.google.com/group/rabbitmq-discuss.
>> For more options, visit https://groups.google.com/d/optout.
>>
>
>
>
> -- 
> Ian Dallas
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140331/350dee53/attachment.html>

