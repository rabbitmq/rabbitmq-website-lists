<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Pathology
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Cluster%20Pathology&In-Reply-To=368574aa0902121131lde019ew18858506d4241493%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003006.html">
   <LINK REL="Next"  HREF="003012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Pathology</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Cluster%20Pathology&In-Reply-To=368574aa0902121131lde019ew18858506d4241493%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Cluster Pathology">0x6e6562 at gmail.com
       </A><BR>
    <I>Fri Feb 13 10:26:00 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003006.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
        <LI>Next message: <A HREF="003012.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3010">[ date ]</a>
              <a href="thread.html#3010">[ thread ]</a>
              <a href="subject.html#3010">[ subject ]</a>
              <a href="author.html#3010">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Drew,

On Thu, Feb 12, 2009 at 7:31 PM, Drew Smathers &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">drew.smathers at gmail.com</A>&gt; wrote:
&gt;<i> Steps to reproduce:
</I>&gt;<i>
</I>&gt;<i> 1. run publisher and consumer against one node to ensure queue is created there:
</I>&gt;<i>
</I>&gt;<i>  $ python publisher.py hostB 5
</I>&gt;<i>  $ python consumer.py hostB # CTL-C after receiving 5 messages
</I>&gt;<i>
</I>&gt;<i> 2. run publisher/consumer against other node - hostA
</I>&gt;<i>
</I>&gt;<i>  $ python publisher.py hostA 20
</I>&gt;<i>  $ python consumer.py hostA
</I>&gt;<i>
</I>&gt;<i> 3. Before publisher from step 2 has finished, bring down rabbitmq on hostB
</I>&gt;<i>
</I>&gt;<i>  hostB $ rabbitmqctl stop
</I>&gt;<i>
</I>&gt;<i> 4. After publisher from step 2 has finished, restart consumer:
</I>&gt;<i>
</I>&gt;<i>  $ python consumer.py hostA
</I>&gt;<i>
</I>&gt;<i> Notice messages delivered after hostB was brought down were not delivered.
</I>
Yes, this is the behaviour I would expect as well. As indicated
previously (on this thread and the other related one) this is because
the queue to which both consumers are subscribed was initially
declared on node B. Because there is

a) no automatic failover, just recovery;
b) no propagation of the queue removal event to each consumer (the
spec compliancy issue);

the queue is taken down and the guy consuming via node A will be none
the wiser. Any subsequent messages published to that queue will be
treated as unroutable and hence will be discarded. To recover from
this situation, you would need to restart node B and restart the
consumer on node A.

Obviously it would be nice to have better handling for this kind of
thing, which will probably happen at some stage.

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003006.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
	<LI>Next message: <A HREF="003012.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3010">[ date ]</a>
              <a href="thread.html#3010">[ thread ]</a>
              <a href="subject.html#3010">[ subject ]</a>
              <a href="author.html#3010">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
