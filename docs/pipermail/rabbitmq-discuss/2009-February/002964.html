<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Pathology
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Cluster%20Pathology&In-Reply-To=3b949f090902091229r372a78ci84ed70b5fa5f2b68%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002950.html">
   <LINK REL="Next"  HREF="002965.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Pathology</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Cluster%20Pathology&In-Reply-To=3b949f090902091229r372a78ci84ed70b5fa5f2b68%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Cluster Pathology">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Wed Feb 11 01:39:08 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002950.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
        <LI>Next message: <A HREF="002965.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2964">[ date ]</a>
              <a href="thread.html#2964">[ thread ]</a>
              <a href="subject.html#2964">[ subject ]</a>
              <a href="author.html#2964">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jason,

Jason J. W. Williams wrote:
&gt;<i> 
</I>&gt;<i> Setup A:
</I>&gt;<i> 
</I>&gt;<i> * Consumer 1 attached to MQ node A and creates queue and binding.
</I>&gt;<i> * Consumer 2 attaches to MQ node B and creates queue and binding (same
</I>&gt;<i> as Consumer 1 and therefore no-op'd).
</I>&gt;<i> * Producer 1 attaches to MQ node B (it also creates queue and binding
</I>&gt;<i> same as Consumer 1...no-op'd) and publishes messages. Connection to MQ
</I>&gt;<i> node B is persistent.
</I>&gt;<i> * Consumer 1 dies.
</I>&gt;<i> * MQ node A dies. Queues are not recreated on node B, and produced
</I>&gt;<i> messages are black holed. Queues are not re-created because Consumer 2
</I>&gt;<i> and Producer 1 are not notified by node B to reconnect or any other
</I>&gt;<i> error (therefore their reconnect/recreate queue code never gets
</I>&gt;<i> triggered).
</I>
Have you tried restoring node A? When it went down, it might have had some messages in the 
queue. And since contents of queues are not replicated, nobody knows about this fact 
except for node A itself.

When you restore it, maybe rabbit will magically detect that a queue has now been 
re-declared on another node and will migrate unconsumed messages there? Or not...


&gt;<i> Setup B:
</I>&gt;<i> 
</I>&gt;<i> * Same as Setup A except:
</I>&gt;<i> * Producer 1 attaches to MQ node A.
</I>&gt;<i> * MQ node A and Consumer 1 fail. Producer 1 reconnects to node B and
</I>&gt;<i> recreates queues and bindings. Messages Producer 1 publishes are
</I>&gt;<i> placed in the recreated queue. However, Consumer 2 never is handed
</I>&gt;<i> messages by node B (which it has been persistently attached to) after
</I>&gt;<i> the recreation of the queue.
</I>Maybe because consumer 2 is still attached to a queue that is on a node that is down? I 
suspect that when you create a binding by name, rabbit resolves the name string to its 
internal locator for a specific queue, which in this case is on node A which is down? I 
would guess that if you restart the consumer it will attach to newly created queue.

But again, the question will remain how one can get messages from an old queue named &quot;foo&quot; 
when a new queue &quot;foo&quot; now exists on another node.


- Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002950.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
	<LI>Next message: <A HREF="002965.html">[rabbitmq-discuss] Cluster Pathology
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2964">[ date ]</a>
              <a href="thread.html#2964">[ thread ]</a>
              <a href="subject.html#2964">[ subject ]</a>
              <a href="author.html#2964">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
