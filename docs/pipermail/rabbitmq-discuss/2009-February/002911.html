<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20memory%20usage&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002910.html">
   <LINK REL="Next"  HREF="002930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] memory usage</H1>
    <B>Philip Stubbings</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20memory%20usage&In-Reply-To="
       TITLE="[rabbitmq-discuss] memory usage">phil at parasec.net
       </A><BR>
    <I>Thu Feb  5 15:16:17 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002910.html">[rabbitmq-discuss] STOMP adapter tagged for v1.5.0, v1.5.1
</A></li>
        <LI>Next message: <A HREF="002930.html">[rabbitmq-discuss] memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2911">[ date ]</a>
              <a href="thread.html#2911">[ thread ]</a>
              <a href="subject.html#2911">[ subject ]</a>
              <a href="author.html#2911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I have set up Rabbit 1.5.1 running as a single node. During testing, I
notice that memory use is extremely high. More specifically, if I push
1 million messages to a queue and later consume them (with
acknowledgment) memory usage remains very high (in excess of 3G). I can
verify that all consumed messages where acknowledged and that the queue
is empty. Why does the process still require 3G of memory even after 24
hours of inactivity? 

The only way to reduce the memory footprint is to restart rabbitmq.,
However this is not an option for me.

The second problem I have encountered is during, and immediately after
pushing 1 million messages to rabbitmq. If I try to connect a consumer
whilst messages are being produced, I get the following error on the
consumer side:

(connection error; reason:
{#method&lt;connection.close&gt;(reply-code=541,reply-text=INTERNAL_ERROR,class-id=0,method-id=0),null,&quot;&quot;})

While, on the rabbit server:
=ERROR REPORT==== 5-Feb-2009::12:43:57 ===
connection &lt;0.3155.0&gt; (running), channel 1 - error:
{timeout,{gen_server,call,[rabbit_persister,serial]}}
=WARNING REPORT==== 5-Feb-2009::12:43:57 ===
Non-AMQP exit reason
'{timeout,{gen_server,call,[rabbit_persister,serial]}}'

And also, during and just after the 1 million messages have been
produced (with no consumers connected) I get the following error while
trying to examine the queue status:

../rabbitmq-server-1.5.1/scripts/rabbitmqctl list_queues -p /
Listing queues ...
Error: {badrpc,
           {'EXIT',
	        {timeout,
			{gen_server,call,[&lt;4472.2308.0&gt;,{info,[name,messages]}]}}}}


Any ideas? 
Thanks,
Phil








</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002910.html">[rabbitmq-discuss] STOMP adapter tagged for v1.5.0, v1.5.1
</A></li>
	<LI>Next message: <A HREF="002930.html">[rabbitmq-discuss] memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2911">[ date ]</a>
              <a href="thread.html#2911">[ thread ]</a>
              <a href="subject.html#2911">[ subject ]</a>
              <a href="author.html#2911">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
