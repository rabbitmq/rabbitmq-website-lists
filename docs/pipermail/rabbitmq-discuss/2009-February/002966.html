<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20memory%20usage&In-Reply-To=1E48C342-D18C-472F-9EDE-C29CD695FA62%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002963.html">
   <LINK REL="Next"  HREF="003052.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] memory usage</H1>
    <B>Valentino Volonghi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20memory%20usage&In-Reply-To=1E48C342-D18C-472F-9EDE-C29CD695FA62%40gmail.com"
       TITLE="[rabbitmq-discuss] memory usage">dialtone at gmail.com
       </A><BR>
    <I>Wed Feb 11 02:31:53 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002963.html">[rabbitmq-discuss] memory usage
</A></li>
        <LI>Next message: <A HREF="003052.html">[rabbitmq-discuss] memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2966">[ date ]</a>
              <a href="thread.html#2966">[ thread ]</a>
              <a href="subject.html#2966">[ subject ]</a>
              <a href="author.html#2966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Feb 10, 2009, at 5:11 PM, Valentino Volonghi wrote:
&gt;<i> I'm now repeating the test again with more monitoring over requests  
</I>&gt;<i> done and the size
</I>&gt;<i> of the logs.
</I>

One thing that I can reproduce 100% of the time:

If I run tsung with some requests to be done and a 0.000625 inter  
arrival
time (1600 req/sec) and my system is behind nginx 0.6.35 configured as
the bottom of the email.

The central rabbitmq raises this error:

      Supervisor: {local,rabbit_amqqueue_sup}
      Context:    child_terminated
      Reason:     {timeout,
                      {gen_server,call,
                          [rabbit_persister,
                           {commit_transaction,
                               {{{1,&lt;0.245.0&gt;},160},
                                {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,
                                    &lt;&lt;&quot;log_endpoint&quot;&gt;&gt;}}}]}}
      Offender:   [{pid,&lt;0.212.0&gt;},
                   {name,rabbit_amqqueue},
                   {mfa,
                       {rabbit_amqqueue_process,start_link,
                           [{amqqueue,
                                 
{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;log_endpoint&quot;&gt;&gt;},
                                true,false,[],none}]}},
                   {restart_type,temporary},
                   {shutdown,brutal_kill},
                   {child_type,worker}]

I suppose it's because it doesn't get enough CPU time again... maybe  
this
is also the reason why it stops sending messages, because being unable
to receive them it doesn't deliver. Once this happens the frontend  
rabbitmq
for some reason jumps to 2.5GB of memory used and keeps delivering like
nothing happened, it also remains at 2.5GB even if its log files  
remain very
low in size.

# nginx.conf

worker_processes  1;

events {
     worker_connections  26000;
}

http {
     include       mime.types;
     default_type  application/octet-stream;
     access_log  logs/access.log  main;

     sendfile        on;
     keepalive_timeout  65;
     tcp_nopush	on;
     tcp_nodelay on;

     server {
         listen       80;
         server_name  localhost;
	
	location / {
		proxy_pass	<A HREF="http://127.0.0.1:8000/;">http://127.0.0.1:8000/;</A>
		proxy_redirect  off;

		proxy_set_header Host	$host;
		proxy_set_header X-Forwarded-For  $remote_addr;

		proxy_connect_timeout	90;
		proxy_send_timeout	90;
		proxy_read_timeout	90;
	
		proxy_buffer_size	4k;
		proxy_buffers		4 32k;
	}
     }
}


- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>
<A HREF="http://www.adroll.com">http://www.adroll.com</A>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkmSOJkACgkQ9Llz28widGVoYwCghrR6kG2HbzYh9+j8336wnIM7
Dq8AoMyQrh6Q1JHyvvkrWJ8xDT2QiA02
=fuTi
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002963.html">[rabbitmq-discuss] memory usage
</A></li>
	<LI>Next message: <A HREF="003052.html">[rabbitmq-discuss] memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2966">[ date ]</a>
              <a href="thread.html#2966">[ thread ]</a>
              <a href="subject.html#2966">[ subject ]</a>
              <a href="author.html#2966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
