<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] getting started, broker runs;	can't get status
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20getting%20started%2C%20broker%20runs%3B%0A%09can%27t%20get%20status&In-Reply-To=498898B4.6020702%40cohesiveft.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002863.html">
   <LINK REL="Next"  HREF="002879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] getting started, broker runs;	can't get status</H1>
    <B>Doug Barth</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20getting%20started%2C%20broker%20runs%3B%0A%09can%27t%20get%20status&In-Reply-To=498898B4.6020702%40cohesiveft.com"
       TITLE="[rabbitmq-discuss] getting started, broker runs;	can't get status">dougbarth at gmail.com
       </A><BR>
    <I>Tue Feb  3 19:44:03 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002863.html">[rabbitmq-discuss] getting started, broker runs;	can't get status
</A></li>
        <LI>Next message: <A HREF="002879.html">[rabbitmq-discuss] getting started, broker runs;	can't get status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2864">[ date ]</a>
              <a href="thread.html#2864">[ thread ]</a>
              <a href="subject.html#2864">[ subject ]</a>
              <a href="author.html#2864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 3, 1:19&#160;pm, Dmitriy Samovskiy
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dmitriy.samovs... at cohesiveft.com</A>&gt; wrote:
&gt;<i> We did net_adm:localhost() to see the local host name that erlang sees. It was an FQDN
</I>&gt;<i> (a.example.com). In /etc/hosts however, a.example.com resolved to an Internet-facing IP on
</I>&gt;<i> ISP's frontend, not to a private IP of the local box. With tcpdump, we observed SYN
</I>&gt;<i> packets in response to net_adm:names() call going out to the network to ISP's IP address,
</I>&gt;<i> instead of going locally to our epmd.
</I>&gt;<i>
</I>&gt;<i> Once we changed /etc/hosts and put something like &quot;127.0.0.1 a.example.com&quot; there,
</I>&gt;<i> net_adm:names() started working and erlang is happy now.
</I>
Hey Dmitriy,

Thanks again for the help.

Once we had a working configuration, we did a bit more digging to
fully understand how this issue was caused. I thought it would be
worth sharing what we believe was the root cause.

Our new machines have two NICs with separate IP addresses for each.
One one NIC has a publicly addressable IP, the other has a private IP
meant for server management traffic. When the erlang process was
attempting to contact the epmd process, it was using the private IP
interface to connect to the public IP interface. It did this because
the hostname for that box resolved to the public IP. The epmd-bound
traffic was stopped by the firewall for the public IP interface.
Modifying the hosts file to resolve the machine's hostname to
127.0.0.1 avoided the firewall and fixed the issue. Alternatively,
changing the hosts file to use the private IP address also fixed the
issue, since that traffic avoids the firewall as well because the
originating and destination addresses are identical.

In theory, I think another fix for this issue would be to instruct
Erlang to use the public IP address when generating outbound traffic.
Unfortunately, I do not know how to control that setting to test this
theory. Is there are startup flag that could be set?

--
Doug Barth


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002863.html">[rabbitmq-discuss] getting started, broker runs;	can't get status
</A></li>
	<LI>Next message: <A HREF="002879.html">[rabbitmq-discuss] getting started, broker runs;	can't get status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2864">[ date ]</a>
              <a href="thread.html#2864">[ thread ]</a>
              <a href="subject.html#2864">[ subject ]</a>
              <a href="author.html#2864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
