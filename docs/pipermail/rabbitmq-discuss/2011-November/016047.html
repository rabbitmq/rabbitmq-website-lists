<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Message durability and partition tolerence
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20durability%20and%20partition%20tolerence&In-Reply-To=%3C2159662.547.1320769605606.JavaMail.geo-discussion-forums%40prog16%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016312.html">
   <LINK REL="Next"  HREF="016211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Message durability and partition tolerence</H1>
    <B>Jonathan Oliver</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20durability%20and%20partition%20tolerence&In-Reply-To=%3C2159662.547.1320769605606.JavaMail.geo-discussion-forums%40prog16%3E"
       TITLE="[rabbitmq-discuss] Message durability and partition tolerence">jonathan.s.oliver42 at gmail.com
       </A><BR>
    <I>Tue Nov  8 16:26:45 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016312.html">[rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
</A></li>
        <LI>Next message: <A HREF="016211.html">[rabbitmq-discuss] Message durability and partition tolerence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16047">[ date ]</a>
              <a href="thread.html#16047">[ thread ]</a>
              <a href="subject.html#16047">[ subject ]</a>
              <a href="author.html#16047">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Since the introduction of better clustering support and message queue 
failover in v2.6, my company is starting to consider moving to RabbitMQ. 
 But we had a few questions about the roadmap.

We are looking to ensure that a message is only considered received by an 
exchange from a producing app when at least two physical instances of 
Rabbit acknowledge the receipt of the message--similar to Riak's method. 
 Furthermore, we are looking to ensure that a message is considered 
consumed (ack'd) when when at least one physical instance receives the ack, 
which may result in a message being delivered more than once.  Essentially, 
we'd like to propose a configuration where Rabbit can fall on the AP side 
of CAP instead of the CA side.

I should mention that we're fully aware that the above scenario may cause a 
message to be pushed to consumers more than once and how messages may get 
out of order.  In general, however, these concepts are very much a part of 
message queuing system guarantees--that of *at-least-once* delivery where 
order is not strictly guaranteed.  If we needed *at-most-once* delivery and 
strict ordering, we'd use RPC.  In many regards, this is similar to the 
Amazon SQS architecture with a few key differences--one of the most 
important being stateful connections and &quot;push&quot; capabilities between the 
server and connected consumers which is where Amazon's SQS offering falls 
apart--that and message size restrictions.

I can see that many systems really want to ensure at-most-once delivery (or 
close to it) and how the requirement to re-order messages makes things 
difficult, but by relaxing the constraints (at least in some 
configurations), it enables so much more.  For example, if an instance of 
Rabbit goes offline under the current HA configuration, when it rejoins the 
cluster the queues are wiped clean.  Yuck.  So much for guaranteed 
delivery.  While under some kind of partition-tolerant configuration, the 
queues wouldn't need to be cleaned.  Instead, the consuming application 
would be responsible for message idempotency.

At the same time, I realize that you guys might be bumping against 
restrictions in the AMQP standard, for example multiple consumers receiving 
copies of the message where one consumer ack's the message, while another 
nack's the message.  But that's something where the messaging system can't 
determine the proper course of action without knowing the business context. 
 In that case, I would imaging it should present that nack back to the 
producer as it currently does.

The bottom line in my question and proposal really has to do with message 
loss.  If the idea is to *not lose messages*, I can see a 
partition-tolerant configuration bringing a lot to the table and where the 
consuming application must be resilient to duplicate messages and ordering, 
thus freeing up RabbitMQ from having to worry so much about that.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111108/08c1f831/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111108/08c1f831/attachment.htm</A>&gt;
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016312.html">[rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
</A></li>
	<LI>Next message: <A HREF="016211.html">[rabbitmq-discuss] Message durability and partition tolerence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16047">[ date ]</a>
              <a href="thread.html#16047">[ thread ]</a>
              <a href="subject.html#16047">[ subject ]</a>
              <a href="author.html#16047">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
