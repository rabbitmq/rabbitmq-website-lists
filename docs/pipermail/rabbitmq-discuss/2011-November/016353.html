<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel messages get lost or stay unacknowledged.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20messages%20get%20lost%20or%20stay%20unacknowledged.&In-Reply-To=%3C14498961.743.1321609401734.JavaMail.geo-discussion-forums%40yqcm23%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016354.html">
   <LINK REL="Next"  HREF="016355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel messages get lost or stay unacknowledged.</H1>
    <B>Jelle Smet</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20messages%20get%20lost%20or%20stay%20unacknowledged.&In-Reply-To=%3C14498961.743.1321609401734.JavaMail.geo-discussion-forums%40yqcm23%3E"
       TITLE="[rabbitmq-discuss] Shovel messages get lost or stay unacknowledged.">smetj.net at gmail.com
       </A><BR>
    <I>Fri Nov 18 09:43:21 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016354.html">[rabbitmq-discuss] Some simple problems about Clustering
</A></li>
        <LI>Next message: <A HREF="016355.html">[rabbitmq-discuss] Shovel messages get lost or stay	unacknowledged.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16353">[ date ]</a>
              <a href="thread.html#16353">[ thread ]</a>
              <a href="subject.html#16353">[ subject ]</a>
              <a href="author.html#16353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Sorry for double posting, but I wanted to start a new thread on this topic 
as the previous one&lt;<A HREF="https://groups.google.com/forum/#!topic/rabbitmq-discuss/7grvcHWvp3s/discussion">https://groups.google.com/forum/#!topic/rabbitmq-discuss/7grvcHWvp3s/discussion</A>&gt;had multiple angles covering multiple cases.

I'm having issues with the Shovel plugin, which currently makes my work 
with RabbitMQ difficult.
My goal is to get the content of a queue to a queue of a remote broker.

Here's a recap:

   - All RabbitMQ instances run the latest stable version 2.7.0 (the 
   problem also occurred with 2.6.1)
   - Messages which should be shoveled to a remote broker stay 
   unacknowledged in the queue which Shovel is using as a source.
   - Restarting RabbitMQ on that moment isn't possible.  Killing is 
   required, often having to issue &quot;epmd -kill&quot;
   - When I restart RabbitMQ which has the Shovel plugin, all messages get 
   delivered correctly.

By default I use ack_mode with value &quot;on_confirm&quot;.  When I change this into 
&quot;no_ack&quot; and I run into the above situation all messages get lost.

I must say occasional network interruptions, or occasional packetloss is a 
fact.  But not to that extent it should be a problem. Besides that, it 
doesn't explain that restarting Rabbit, makes all messages arrive correctly 
all of a sudden.

Here's my complete Shovel configuration (I replaced hostnames &amp; queue 
names):

[{rabbitmq_shovel,
  [{shovels,
    [
     {scan_orders_amsterdam,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server01&quot;}]},">amqp://server01&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server01&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_gent,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server02&quot;}]},">amqp://server02&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server02&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_lebanon,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server03&quot;}]},">amqp://server03&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server03&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_pune,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server04&quot;}]},">amqp://server04&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server04&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_lodz,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server05&quot;}]},">amqp://server05&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server05&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]}
     ]
   }]
}].

The problem I would like to get solved is that my messages just arrive on 
their destination, without having to restart Rabbit frequently.
Any pointers, work-arounds, fixes, tips are welcome.

Cheers,

Jelle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111118/376fc0dd/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111118/376fc0dd/attachment.htm</A>&gt;
</PRE>




































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016354.html">[rabbitmq-discuss] Some simple problems about Clustering
</A></li>
	<LI>Next message: <A HREF="016355.html">[rabbitmq-discuss] Shovel messages get lost or stay	unacknowledged.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16353">[ date ]</a>
              <a href="thread.html#16353">[ thread ]</a>
              <a href="subject.html#16353">[ subject ]</a>
              <a href="author.html#16353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
