<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ mirrored queues and node failure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20mirrored%20queues%20and%20node%20failure&In-Reply-To=%3C9DA88CB8-7F53-420F-8F40-9707F971BC1C%40mhtx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016348.html">
   <LINK REL="Next"  HREF="016376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ mirrored queues and node failure</H1>
    <B>Major Hayden</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20mirrored%20queues%20and%20node%20failure&In-Reply-To=%3C9DA88CB8-7F53-420F-8F40-9707F971BC1C%40mhtx.net%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ mirrored queues and node failure">major at mhtx.net
       </A><BR>
    <I>Fri Nov 18 14:31:52 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016348.html">[rabbitmq-discuss] RabbitMQ mirrored queues and node failure
</A></li>
        <LI>Next message: <A HREF="016376.html">[rabbitmq-discuss] RabbitMQ mirrored queues and node failure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16364">[ date ]</a>
              <a href="thread.html#16364">[ thread ]</a>
              <a href="subject.html#16364">[ subject ]</a>
              <a href="author.html#16364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm still a bit confused on some of the operations behind the scenes with mirrored queues.  The documentation states:

  &quot;All actions other than publishes go only to the master, 
  and the master then broadcasts the effect of the actions 
  to the slaves.&quot;

This makes it sounds like publishes go to the slaves and everything else goes to the master.  This confuses me because the documentation also states:

  &quot;... slaves apply the operations that occur to the master 
  in exactly the same order&quot;

The statements seem contradictory.  The first statement makes it seem like publishes go to slaves, but wouldn't publishes need to go to the master (and be replicated to the slaves)?

My goal is to place a load balancer in front of the cluster running mirrored queues and I'm unsure where to direct the traffic.

--
Major Hayden
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">major at mhtx.net</A>

On Nov 16, 2011, at 3:55 PM, Matthias Radestock wrote:

&gt;<i> On 16/11/11 21:44, Major Hayden wrote:
</I>&gt;&gt;<i> 1) Does C come back up with the 10 messages that it had on it before
</I>&gt;&gt;<i> it failed?
</I>&gt;&gt;<i> 2) What happens to those 10 stale, old messages that node C had on it
</I>&gt;&gt;<i> before it failed (that were already picked up from nodes A and B by
</I>&gt;&gt;<i> consumers)?
</I>&gt;<i> 
</I>&gt;<i> From <A HREF="http://www.rabbitmq.com/ha.html#start-stop">http://www.rabbitmq.com/ha.html#start-stop</A>
</I>&gt;<i> 
</I>&gt;<i> &lt;quote&gt;
</I>&gt;<i> when a slave rejoins a mirrored-queue, it throws away any durable local
</I>&gt;<i> contents it already has and starts empty. It's behaviour is at this
</I>&gt;<i> point the same as if it were a new node joining the cluster.
</I>&gt;<i> &lt;/quote&gt;
</I>&gt;<i> 
</I>&gt;<i> Btw, ...
</I>&gt;<i> 
</I>&gt;&gt;<i> While repairs are being made to C's rack, consumers still talk to
</I>&gt;&gt;<i> nodes A and B to pick up and drop off messages.  Let's say the queues
</I>&gt;&gt;<i> on A and B are reduced to zero several times while C is offline and
</I>&gt;&gt;<i> then C comes back online.
</I>&gt;<i> 
</I>&gt;<i> I think you may have misunderstood the master/slave behaviour of mirrored queues. From <A HREF="http://www.rabbitmq.com/ha.html#behaviour">http://www.rabbitmq.com/ha.html#behaviour</A>
</I>&gt;<i> 
</I>&gt;<i> &lt;quote&gt;
</I>&gt;<i> All actions other than publishes go only to the master, and the master then broadcasts the effect of the actions to the slaves. Thus clients consuming from a mirrored queue are in fact consuming from the master.
</I>&gt;<i> &lt;/quote&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I>
</PRE>

















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016348.html">[rabbitmq-discuss] RabbitMQ mirrored queues and node failure
</A></li>
	<LI>Next message: <A HREF="016376.html">[rabbitmq-discuss] RabbitMQ mirrored queues and node failure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16364">[ date ]</a>
              <a href="thread.html#16364">[ thread ]</a>
              <a href="subject.html#16364">[ subject ]</a>
              <a href="author.html#16364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
