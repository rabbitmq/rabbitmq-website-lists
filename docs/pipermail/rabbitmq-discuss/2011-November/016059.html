<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channel error handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20error%20handling&In-Reply-To=%3C20111109013323.GC4293%40southbank.Home%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016036.html">
   <LINK REL="Next"  HREF="016031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channel error handling</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20error%20handling&In-Reply-To=%3C20111109013323.GC4293%40southbank.Home%3E"
       TITLE="[rabbitmq-discuss] Channel error handling">alexandru at rabbitmq.com
       </A><BR>
    <I>Wed Nov  9 01:33:23 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016036.html">[rabbitmq-discuss] Channel error handling
</A></li>
        <LI>Next message: <A HREF="016031.html">[rabbitmq-discuss] STOMP performance problems at &gt; 1200 messages/s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16059">[ date ]</a>
              <a href="thread.html#16059">[ thread ]</a>
              <a href="subject.html#16059">[ subject ]</a>
              <a href="author.html#16059">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jesse,

&gt;<i> I find that when I do a
</I>&gt;<i> basicPublish and something goes wrong with communicating the message to
</I>&gt;<i> RabbitMQ, I do not get told anything (in this case I was setting a UserID
</I>&gt;<i> that did not match the logged-in id). 
</I>
That's the expected behaviour, unfortunately.

The trouble is that AMQP publishes are asynchronous, so basicPublish in
the client returns immediately after sending the message to the server
(because it has nothing to wait for).  So, if the server closes the
channel as a result of the publish, you'll only find out about it on the
next method.

&gt;<i> However that
</I>&gt;<i> error will often be in a completely different part of the code, so the
</I>&gt;<i> stack trace is basically useless.  Is there something I should call after I
</I>&gt;<i> do a publish to verify that the message went through correctly?
</I>
If it's for debugging purposes, you could just add a queueDeclarePassive
after the publish; that'll trigger the exception.

If not, you should be prepared to handle it.  In a long chain of
publishes, you should use something like publisher confirms, and resend
messages that were not confirmed before the channel died (for whatever
reason).

  <A HREF="http://www.rabbitmq.com/extensions.html#confirms">http://www.rabbitmq.com/extensions.html#confirms</A>

If you don't care about performance (i.e. if the throughput of these
messages is very small), set the channel into tx mode, and do a
tx.commit after each publish.

Also, why does the error pop up in a &quot;completely different part of the
code&quot;?  Channels are very cheap; there's no need to reuse channels for
different tasks.

Hope this helps.

Cheers,
Alex

On Mon, Nov 07, 2011 at 02:05:14PM -0800, Jesse C wrote:
&gt;<i> Hey,
</I>&gt;<i> 
</I>&gt;<i> So I'm working on writing a program using the Java client and I'm not sure
</I>&gt;<i> the best way to handle channel errors.  I find that when I do a
</I>&gt;<i> basicPublish and something goes wrong with communicating the message to
</I>&gt;<i> RabbitMQ, I do not get told anything (in this case I was setting a UserID
</I>&gt;<i> that did not match the logged-in id).  The next time I attempt to access
</I>&gt;<i> the channel, I get an error that relates to what went wrong.  However that
</I>&gt;<i> error will often be in a completely different part of the code, so the
</I>&gt;<i> stack trace is basically useless.  Is there something I should call after I
</I>&gt;<i> do a publish to verify that the message went through correctly?
</I>&gt;<i> 
</I>&gt;<i> thanks,
</I>&gt;<i> 
</I>&gt;<i> jesse c
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016036.html">[rabbitmq-discuss] Channel error handling
</A></li>
	<LI>Next message: <A HREF="016031.html">[rabbitmq-discuss] STOMP performance problems at &gt; 1200 messages/s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16059">[ date ]</a>
              <a href="thread.html#16059">[ thread ]</a>
              <a href="subject.html#16059">[ subject ]</a>
              <a href="author.html#16059">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
