<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Acknowledged Messages Requeued
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Acknowledged%20Messages%20Requeued&In-Reply-To=%3C4EBD4913.6030405%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016181.html">
   <LINK REL="Next"  HREF="016183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Acknowledged Messages Requeued</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Acknowledged%20Messages%20Requeued&In-Reply-To=%3C4EBD4913.6030405%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Acknowledged Messages Requeued">emile at rabbitmq.com
       </A><BR>
    <I>Fri Nov 11 16:10:59 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016181.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
        <LI>Next message: <A HREF="016183.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16182">[ date ]</a>
              <a href="thread.html#16182">[ thread ]</a>
              <a href="subject.html#16182">[ subject ]</a>
              <a href="author.html#16182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ben,

On 11/11/11 15:12, Ben Lewis wrote:
&gt;<i> I have got a direct exchange feeding a durable queue, if I load say
</I>&gt;<i> 50,000 messages onto the queue and then start a consumer to work through
</I>&gt;<i> those item's.
</I>&gt;<i> 
</I>&gt;<i> My consumer creates the connection, then creates the model (I'm using
</I>&gt;<i> .NET) and sets the Qos prefetch count to 1, then calls BasicGet,
</I>&gt;<i> processes the message, sends an ack (BasicAck), then enumerates until
</I>&gt;<i> BasicGet returns null. Finally disposing the model and closing the
</I>&gt;<i> connection.
</I>
You don't need to set QoS if you retrieve messages synchronously
(BasicGet). QoS makes sense with BasicConsume. That is not the cause of
your trouble though.

&gt;<i> If I restart the host I have the RabbitMQ broker running on (Windows)
</I>&gt;<i> after processing and ack'ing 40,000 messages while my consumer is
</I>&gt;<i> working through the remaining items, when the RabbitMQ broker comes back
</I>&gt;<i> online the 40,000 messages are redelivered (even though they were
</I>&gt;<i> acknowledged).
</I>&gt;<i> 
</I>&gt;<i> Is this supposed to happen?
</I>
No. Acknowledged messages are forgotten about by the broker, so you
should not be seeing them again. What is the output of

rabbitmqctl list_queues name messages_ready messages_unacknowledged

before and after the restart? Is it possible that you are somehow not
acknowledging the messages? Do you get the same result if you use the
noAck flag of BasicGet?

If you are using transactions and failing to commit the transaction then
you could see apparently acknowledged message reappearing - is that a
possibility?

&gt;<i> If this is by design, any suggestions or advice on how I can minimise
</I>&gt;<i> the number of redelivered messages if the broker dies/restarts?
</I>
If you don't care about persisting messages then you can publish the
messages in non-persistent mode (set the delivery mode in the basic
properties to 1).


-Emile
</PRE>




















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016181.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
	<LI>Next message: <A HREF="016183.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16182">[ date ]</a>
              <a href="thread.html#16182">[ thread ]</a>
              <a href="subject.html#16182">[ subject ]</a>
              <a href="author.html#16182">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
