<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Priority Queue Implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Priority%20Queue%20Implementation&In-Reply-To=%3C20111111133804.GA3730%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016122.html">
   <LINK REL="Next"  HREF="016127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Priority Queue Implementation</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Priority%20Queue%20Implementation&In-Reply-To=%3C20111111133804.GA3730%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Priority Queue Implementation">matthew at rabbitmq.com
       </A><BR>
    <I>Fri Nov 11 13:38:04 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016122.html">[rabbitmq-discuss] Priority Queue Implementation
</A></li>
        <LI>Next message: <A HREF="016127.html">[rabbitmq-discuss] Breaking API changes in JAva API 2.7.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16170">[ date ]</a>
              <a href="thread.html#16170">[ thread ]</a>
              <a href="subject.html#16170">[ subject ]</a>
              <a href="author.html#16170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Thu, Nov 10, 2011 at 01:14:21PM +0100, Alvaro Videla wrote:
&gt;<i> I just wanted to bring to your attention this priority queue implementation
</I>&gt;<i> in Erlang that somehow compares itself against RabbitMQ and Riak
</I>&gt;<i> implementations.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://github.com/okeuday/pqueue/">https://github.com/okeuday/pqueue/</A>
</I>&gt;<i> 
</I>&gt;<i> More info in Russian Here:
</I>&gt;<i> <A HREF="http://erlanger.ru//page/1886/ochered-s-prioritetom">http://erlanger.ru//page/1886/ochered-s-prioritetom</A>
</I>
In general, beware of large constant overheads. For simple use cases,
it's often the case that a less-efficient but simpler algorithm is
faster.

Our priority_queue is not intended to be a general purpose priority
queue that performs brilliantly for billions of items with uniformly
distributed random priorities. It's intended for use with a very small
number of priorities (we never use it with more than ten), and very
heavily skewed use to one particular priority (normally 0).

I've not analysed it, but my instinct is that a priority queue built
from a 2,3-fingertree will have better theoretical characteristics than
the pqueue2 linked above simply because it avoids the possibility of a
heavily skewed unbalanced tree forming. However, having implemented such
a thing myself (
<A HREF="http://hg.rabbitmq.com/erlang-data-structures/file/default/finger_tree/src/">http://hg.rabbitmq.com/erlang-data-structures/file/default/finger_tree/src/</A>
) I know that in reality it doesn't perform brilliantly because it tends
to produce quite a lot of garbage and intermediate structures and whilst
its theoretical characteristics are vastly better than our
priority_queue.erl module, for our use case, it performs worse (not to
mention being the proverbial hammer to crack a nut).

I note from the wikipedia page for skew heaps:
&quot;In contrast with binary heaps, there are no structural constraints, so
there is no guarantee that the height of the tree is logarithmic.&quot;

This suggests that pqueue2:in is not even guaranteed O(log_2(N)).
priority_queue:in will be O(M/2) where M is the number of priorities
(the actual insert to the sub-queue will be amortized O(1)). The
2,3-finger_tree as a priority queue is amortized O(1) for insert and
O(log_2(N)) for out. That said, except in rather extreme use cases, I'd
expect pqueue2 and priority_queue to beat it.

I'd be curious to see what the benchmark tests were that Michael Truog
used. I suspect they'd have been rather random and wide ranging in
nature.

Thanks for the heads up though - always interesting stuff.


Matthew
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016122.html">[rabbitmq-discuss] Priority Queue Implementation
</A></li>
	<LI>Next message: <A HREF="016127.html">[rabbitmq-discuss] Breaking API changes in JAva API 2.7.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16170">[ date ]</a>
              <a href="thread.html#16170">[ thread ]</a>
              <a href="subject.html#16170">[ subject ]</a>
              <a href="author.html#16170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
