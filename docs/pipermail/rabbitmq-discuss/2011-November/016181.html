<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Acknowledged Messages Requeued
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Acknowledged%20Messages%20Requeued&In-Reply-To=%3CCAHQ1f1X%2Bt9TETRt0YveordZC2%3DHhCOscDNPgAZ54LetyXJQx7A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016171.html">
   <LINK REL="Next"  HREF="016182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Acknowledged Messages Requeued</H1>
    <B>Ben Lewis</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Acknowledged%20Messages%20Requeued&In-Reply-To=%3CCAHQ1f1X%2Bt9TETRt0YveordZC2%3DHhCOscDNPgAZ54LetyXJQx7A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Acknowledged Messages Requeued">stuckinwigan at gmail.com
       </A><BR>
    <I>Fri Nov 11 15:12:27 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016171.html">[rabbitmq-discuss] Breaking API changes in JAva API 2.7.0
</A></li>
        <LI>Next message: <A HREF="016182.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16181">[ date ]</a>
              <a href="thread.html#16181">[ thread ]</a>
              <a href="subject.html#16181">[ subject ]</a>
              <a href="author.html#16181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

I'm new to the concepts of AMQP and RabbitMQ and was wondering if someone
may be able to point me in the right direction or offer some advice.

I have got a direct exchange feeding a durable queue, if I load say 50,000
messages onto the queue and then start a consumer to work through those
item's.

My consumer creates the connection, then creates the model (I'm using .NET)
and sets the Qos prefetch count to 1, then calls BasicGet, processes the
message, sends an ack (BasicAck), then enumerates until BasicGet returns
null. Finally disposing the model and closing the connection.

If I restart the host I have the RabbitMQ broker running on (Windows) after
processing and ack'ing 40,000 messages while my consumer is working through
the remaining items, when the RabbitMQ broker comes back online the 40,000
messages are redelivered (even though they were acknowledged).

Is this supposed to happen? I would anticipate a number of them being
requeued if the broker was shutdown abruptly (i.e. loss of power) as it may
not have been written to disk at that stage, but a graceful restart I
thought it may flush any uncommitted changes to disk.

If this is by design, any suggestions or advice on how I can minimise the
number of redelivered messages if the broker dies/restarts?

Thanks in advance,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111111/7022b742/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111111/7022b742/attachment.htm</A>&gt;
</PRE>




















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016171.html">[rabbitmq-discuss] Breaking API changes in JAva API 2.7.0
</A></li>
	<LI>Next message: <A HREF="016182.html">[rabbitmq-discuss] Acknowledged Messages Requeued
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16181">[ date ]</a>
              <a href="thread.html#16181">[ thread ]</a>
              <a href="subject.html#16181">[ subject ]</a>
              <a href="author.html#16181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
