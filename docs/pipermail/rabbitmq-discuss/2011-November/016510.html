<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Messages disappearing from queues when clustered brokers are restarted.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20disappearing%20from%20queues%20when%0A%20clustered%20brokers%20are%20restarted.&In-Reply-To=%3C4ECD2659.6050806%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016509.html">
   <LINK REL="Next"  HREF="016512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Messages disappearing from queues when clustered brokers are restarted.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20disappearing%20from%20queues%20when%0A%20clustered%20brokers%20are%20restarted.&In-Reply-To=%3C4ECD2659.6050806%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Messages disappearing from queues when clustered brokers are restarted.">simon at rabbitmq.com
       </A><BR>
    <I>Wed Nov 23 16:59:05 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016509.html">[rabbitmq-discuss] Messages disappearing from queues when clustered	brokers are restarted.
</A></li>
        <LI>Next message: <A HREF="016512.html">[rabbitmq-discuss] Exchange disappear
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16510">[ date ]</a>
              <a href="thread.html#16510">[ thread ]</a>
              <a href="subject.html#16510">[ subject ]</a>
              <a href="author.html#16510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/11/11 16:44, Andreas Lundberg wrote:
&gt;<i> Is there any way to prevent this kind of message loss, and why does it
</I>&gt;<i> happen?
</I>
When you initially stop broker A, all the queues switch over to B as the 
master.

When you then start A again, all the queues get a new slave on A.

It's important to understand that these slaves initially start up 
without messages in them. They can't just pick up where they left off, 
as A might have been down for an arbitrary period of time and doesn't 
know what's happened.

These slaves are thus said to be &quot;unsynchronised&quot;. You can see whether 
slaves are synchronised or not in rabbitmqctl and the management plugin.

New messages published to the queues will go to all slaves including the 
new ones. When the last old message is consumed/acked from the new 
master, the new slave will be considered synchronised again.

But I suspect you're restarting B before this happens. Then the 
unsynchronised slave on A becomes the new master, and messages are lost.

In the future we'd like to add the ability for new slaves to eagerly 
synchronise, but it hasn't happened yet and it's quite a big task.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016509.html">[rabbitmq-discuss] Messages disappearing from queues when clustered	brokers are restarted.
</A></li>
	<LI>Next message: <A HREF="016512.html">[rabbitmq-discuss] Exchange disappear
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16510">[ date ]</a>
              <a href="thread.html#16510">[ thread ]</a>
              <a href="subject.html#16510">[ subject ]</a>
              <a href="author.html#16510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
