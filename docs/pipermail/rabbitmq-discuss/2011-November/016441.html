<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] active/active message persistence problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20message%20persistence%20problem&In-Reply-To=%3CBLU149-W37D5B8D2E7ED64C4714CC6ABC80%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016440.html">
   <LINK REL="Next"  HREF="016442.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] active/active message persistence problem</H1>
    <B>Jeffrey Chen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20message%20persistence%20problem&In-Reply-To=%3CBLU149-W37D5B8D2E7ED64C4714CC6ABC80%40phx.gbl%3E"
       TITLE="[rabbitmq-discuss] active/active message persistence problem">cpthk at hotmail.com
       </A><BR>
    <I>Tue Nov 22 06:37:14 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016440.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
        <LI>Next message: <A HREF="016442.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16441">[ date ]</a>
              <a href="thread.html#16441">[ thread ]</a>
              <a href="subject.html#16441">[ subject ]</a>
              <a href="author.html#16441">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello Cameron:



To resolve any confusion, let me make a table to clarify. I DO have &quot;x-ha-policy&quot; set to &quot;all&quot;



  Steps    |   vm1                                       |        vm2

  ------------------------------------------------------------------------------

  1.         |  started (10 msg, disk, master)   |  started (10 msg, disk)

  2.         |  stop                                         |  started (10 msg, disk, became master)

  3.         |  started (10 msg, disk, slave)      |  started (10 msg, disk, master)

  4.         |  started (0 msg, disk, master)     | stop



Noticed that in my step 4, when I stop my VM2, the message in VM1 
immediately disappear. You are right, each step has interval of about 10
 seconds, I didn't wait very long to stop the new master. You mentioned 
that I have to I have to wait until the queues are synchronized. How 
long is that waiting? Is there a command that I could find out if they 
finished the synchronization? Like rabbitmqctl command or anything? Or 
any way to force synchronize right now. I am only testing 10 messages, 
it shouldn't take that long.



Thanks for your help.



Jeffrey.

&gt;<i> From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cameron.davison at gmail.com</A>
</I>&gt;<i> Date: Mon, 21 Nov 2011 23:46:24 -0600
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] active/active message persistence problem
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cpthk at hotmail.com</A>
</I>&gt;<i> CC: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> 
</I>&gt;<i> What order are you restarting the nodes? Any rabbitmq server that
</I>&gt;<i> connects to a cluster will start its queue fresh and begin replicating
</I>&gt;<i> from the master. You should wait and make sure that all the queues are
</I>&gt;<i> synchronized before you shut down the master, or new master. Old
</I>&gt;<i> messages are not read from nodes that connect to the cluster because
</I>&gt;<i> the assumption is that the queue will go to 0 soon and then the old
</I>&gt;<i> messages will not matter so only the new messages will be important.
</I>&gt;<i> Also, you should make sure that the &quot;x-ha-policy&quot; is set to &quot;all&quot; or
</I>&gt;<i> to the &quot;nodes&quot; that you would like the queue to be mirrored to.
</I>&gt;<i> 
</I>&gt;<i> Cameron
</I>&gt;<i> 
</I>&gt;<i> On Mon, Nov 21, 2011 at 7:14 PM, Jeffrey Chen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cpthk at hotmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hi RabbitMQ community:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am encounter this problem about message persistence. Here is my case, I
</I>&gt;<i> &gt; have 2 server nodes with active/active setup, both are persisted to DISK.
</I>&gt;<i> &gt; The queue declarations are defined as durable.
</I>&gt;<i> &gt; This is what I got when doing:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # rabbitmqctl cluster_status
</I>&gt;<i> &gt; Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at aaron-vm177</A>' ...
</I>&gt;<i> &gt; [{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm1</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm2</A>']}]},
</I>&gt;<i> &gt;  {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm1</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm2</A>']}]
</I>&gt;<i> &gt; ...done.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # rabbitmqctl list_queues
</I>&gt;<i> &gt; Listing queues ...
</I>&gt;<i> &gt; test    10
</I>&gt;<i> &gt; ...done.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My vm1 is currently master node. When I stop RabbitMQ service in vm1, and
</I>&gt;<i> &gt; start it back up. I check my messages in the queue, the messages are still
</I>&gt;<i> &gt; there. This time when I stop RabbitMQ service in vm2. The messages will be
</I>&gt;<i> &gt; gone. It seems like when I restart both server nodes, the data will be lost.
</I>&gt;<i> &gt; Does anyone know the reason? Is there any way to work around this?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My goal is that any server nodes down, and when I bring it back up, no data
</I>&gt;<i> &gt; will be lost.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jeffrey.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I> 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111121/807ca663/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111121/807ca663/attachment.htm</A>&gt;
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016440.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
	<LI>Next message: <A HREF="016442.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16441">[ date ]</a>
              <a href="thread.html#16441">[ thread ]</a>
              <a href="subject.html#16441">[ subject ]</a>
              <a href="author.html#16441">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
