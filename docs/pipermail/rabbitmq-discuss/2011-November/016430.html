<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Memory Usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Memory%20Usage&In-Reply-To=%3C4ECAC578.3070202%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016429.html">
   <LINK REL="Next"  HREF="016432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Memory Usage</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Memory%20Usage&In-Reply-To=%3C4ECAC578.3070202%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster Memory Usage">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Nov 21 21:41:12 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016429.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
        <LI>Next message: <A HREF="016432.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16430">[ date ]</a>
              <a href="thread.html#16430">[ thread ]</a>
              <a href="subject.html#16430">[ subject ]</a>
              <a href="author.html#16430">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Travis,

On 21/11/11 21:11, Travis wrote:
&gt;&gt;<i> How many messages were in the queue at the time?
</I>&gt;<i>
</I>&gt;<i> The queue was sitting at about 10 thousand messages.
</I>
Have you ever seen the excessive memory use when there were no / very 
few messages in the queue?

Also, what CPU usage do you see when memory use is excessive? On the 
slave you are probably never going to be able to utilise much more than 
one core, since there is only one queue and no connections. So if CPU 
usage is getting near maxing out one core then the system will be 
operating at the limit.

&gt;&gt;<i> Also, what memory limit does rabbit report in its log?
</I>&gt;<i>
</I>&gt;<i> Memory limit set to 2408MB.
</I>&gt;<i>
</I>&gt;<i> We have the vm_memory_high_watermark set to 10%.  The system has 24GB
</I>&gt;<i> of memory.
</I>
The reason I was asking for what gets reported in the logs is just to 
make sure the settings have taken effect.

&gt;&gt;<i> You mentioned that publishers use 'confirms'. Do they wait for confirmation
</I>&gt;&gt;<i> after every message, after some batch of messages, or do they let confirms
</I>&gt;&gt;<i> stream in completely independently?
</I>&gt;<i>
</I>&gt;<i> We're shoveling from remote rabbitmqs into the cluster.  The shovels have a
</I>&gt;<i> prefetch of 1000.  They are set to confirm.  So I presume that the answer to
</I>&gt;<i> your questions depends on how the shovel works.
</I>
The shovel simply converts confirms from the destination to acks on the 
source. So in your setup, due to the prefetch on the source, publishing 
will pause if there are 1000 confirms pending.


Regards,

Matthias.
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016429.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
	<LI>Next message: <A HREF="016432.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16430">[ date ]</a>
              <a href="thread.html#16430">[ thread ]</a>
              <a href="subject.html#16430">[ subject ]</a>
              <a href="author.html#16430">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
