<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Shovel Connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C33495078.665.1321537186592.JavaMail.geo-discussion-forums%40yqni5%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016496.html">
   <LINK REL="Next"  HREF="016393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Shovel Connections</H1>
    <B>Jelle Smet</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C33495078.665.1321537186592.JavaMail.geo-discussion-forums%40yqni5%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Shovel Connections">smetj.net at gmail.com
       </A><BR>
    <I>Thu Nov 17 13:39:46 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016496.html">[rabbitmq-discuss] performance with thousands of auto_delete queues
</A></li>
        <LI>Next message: <A HREF="016393.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16333">[ date ]</a>
              <a href="thread.html#16333">[ thread ]</a>
              <a href="subject.html#16333">[ subject ]</a>
              <a href="author.html#16333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alexandru,

I still have the same issue going on.  Here's a recap:


   - I have upgraded to the latest stable (2.7.0) Rabbmitmq on all nodes.
   - Messages which should be shoveled to a remote broker stay 
   unacknowledged in the queue which Shovel is using as a source.
   - Restarting RabbitMQ on that moment isn't possible.  Killing is 
   required, often having to issue &quot;epmd -kill&quot;
   - When restarting RabbitMQ containing Shovel after that all messages are 
   shoveled correctly to their destination.
   - ack_mode has value &quot;on_confirm&quot;, when changing this to &quot;no_ack&quot; all 
   messages get lost.

I must say that it's possible that small network interruptions happen, or 
occasional packetloss occurs... but that doesn't explain that restarting 
Rabbit, makes all messages arrive.

Here's my complete Shovel configuration (I replaced hostnames &amp; queue 
names):

[{rabbitmq_shovel,
  [{shovels,
    [
     {scan_orders_amsterdam,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server01&quot;}]},">amqp://server01&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server01&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_gent,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server02&quot;}]},">amqp://server02&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server02&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_lebanon,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server03&quot;}]},">amqp://server03&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server03&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_pune,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server04&quot;}]},">amqp://server04&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server04&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]},
     {scan_orders_lodz,
      [{sources,      [{broker,&quot;<A HREF="amqp://localhost&quot;}]},">amqp://localhost&quot;}]},</A>
       {destinations, [{broker, &quot;<A HREF="amqp://server05&quot;}]},">amqp://server05&quot;}]},</A>
       {queue, &lt;&lt;&quot;messages_server05&quot;&gt;&gt;},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, &lt;&lt;&quot;&quot;&gt;&gt;},
                         {routing_key, &lt;&lt;&quot;assignments&quot;&gt;&gt;}]},
       {reconnect_delay, 5}
      ]}
     ]
   }]
}].


Any idea how to troubleshoot this?

Cheers,

Jelle



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111117/0008f429/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111117/0008f429/attachment.htm</A>&gt;
</PRE>







































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016496.html">[rabbitmq-discuss] performance with thousands of auto_delete queues
</A></li>
	<LI>Next message: <A HREF="016393.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16333">[ date ]</a>
              <a href="thread.html#16333">[ thread ]</a>
              <a href="subject.html#16333">[ subject ]</a>
              <a href="author.html#16333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
