<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Single%20vs.%20Multiple%20Queue%20Topology%0A%09Performance&In-Reply-To=%3Cad5e0299-1a5f-4973-b626-2b139e5fdb19%40u12g2000vbx.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015992.html">
   <LINK REL="Next"  HREF="015993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance</H1>
    <B>Ilya Volodarsky</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Single%20vs.%20Multiple%20Queue%20Topology%0A%09Performance&In-Reply-To=%3Cad5e0299-1a5f-4973-b626-2b139e5fdb19%40u12g2000vbx.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance">ilya at segment.io
       </A><BR>
    <I>Sat Nov  5 02:25:17 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015992.html">[rabbitmq-discuss] Single vs. Multiple Queue	Topology	Performance
</A></li>
        <LI>Next message: <A HREF="015993.html">[rabbitmq-discuss] Complaint on lack of easy stand-alone GUI tool	to examine RabbitMQ queues/topics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15996">[ date ]</a>
              <a href="thread.html#15996">[ thread ]</a>
              <a href="subject.html#15996">[ subject ]</a>
              <a href="author.html#15996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Jerry! Your answers were very thorough and helpful. I'll build
it with one queue, and compare it to the other alternative if the load
testing shows its necessary. Thanks again!

On Nov 4, 3:22&#160;pm, Jerry Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jer... at vmware.com</A>&gt; wrote:
&gt;<i> Hi, Ilya...
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks for your very detailed answer. Regarding availability and
</I>&gt;<i> &gt; durability, I definitely plan to use the active/active mirror queue
</I>&gt;<i> &gt; approach on the queue. We hope to have the broker be in a &quot;good&quot;
</I>&gt;<i> &gt; steady state, in that we'll have enough consumers to empty the queue
</I>&gt;<i> &gt; at hopefully the same rate as they come in. The queue is mostly there
</I>&gt;<i> &gt; so that we can upgrade the consumers without losing any of the tasks,
</I>&gt;<i> &gt; and in case there is a strong spike in traffic, Rabbit can buffer the
</I>&gt;<i> &gt; messages for a few seconds.
</I>&gt;<i>
</I>&gt;<i> Rabbit will likely be happier sweating under a burden from consumers
</I>&gt;<i> that have failed or become overwhelmed themselves for much longer than
</I>&gt;<i> a seconds, subject to available memory, then disk space, then CPU
</I>&gt;<i> cycles on the broker system, so your design as proposed should be in
</I>&gt;<i> good shape in this respect.
</I>&gt;<i>
</I>&gt;<i> &gt; I have a follow up question if you don't mind:
</I>&gt;<i>
</I>&gt;<i> Absolutely! :-)
</I>&gt;<i>
</I>&gt;<i> &gt; You said &quot;it shouldn't be a bottleneck unless your production rate
</I>&gt;<i> &gt; really overwhelms what a single queue process can handle&quot;. If there a
</I>&gt;<i> &gt; process per queue, aren't we losing the advantages of multiple cores
</I>&gt;<i> &gt; helping in the dequeuing to consumers? Wouldn't that be the advantage
</I>&gt;<i> &gt; of having multiple queues?
</I>&gt;<i>
</I>&gt;<i> Apologies... my language was imprecise... By &quot;single 'process' per
</I>&gt;<i> queue&quot; I meant &quot;single *Erlang process*,&quot; not &quot;single full-on, heavy-weight
</I>&gt;<i> OS process.&quot;
</I>&gt;<i>
</I>&gt;<i> Each queue in Rabbit is implemented as its own Erlang process. &#160;An
</I>&gt;<i> Erlang process is really much more like a very lightweight, &quot;green
</I>&gt;<i> thread,&quot; than it is the OS process that I probably sounded like I was
</I>&gt;<i> referring to.
</I>&gt;<i>
</I>&gt;<i> Indeed an &quot;Erlang process&quot; is much lighter weight than an OS thread
</I>&gt;<i> or JVM thread (which is backed by an OS thread on all the widely
</I>&gt;<i> used JVM implementations today anyway). &#160;Ericsson's choice of the word
</I>&gt;<i> 'process' in this context is probably unfortunate. &#160;My apologies if I
</I>&gt;<i> raised alarm bells by using the word without carefully drawing the
</I>&gt;<i> distinction.
</I>&gt;<i>
</I>&gt;<i> To give you an idea of how much more lightweight an Erlang process is
</I>&gt;<i> than an OS or Java thread, Erlang applications that have hundreds of
</I>&gt;<i> thousands or more &quot;Erlang processes&quot; running within them are not at
</I>&gt;<i> all outlandish or exotic in their scale today. &#160;A contemporary JVM
</I>&gt;<i> running with half a million java.lang.Thread's alive in it is another
</I>&gt;<i> story (memory requirements alone, counting the managed and native stacks,
</I>&gt;<i> may have sent you packing as you allocated them in the first place, on
</I>&gt;<i> all but the most monstrously powerful hardware).
</I>&gt;<i>
</I>&gt;<i> &gt; The point about premature optimization is well taken, I think it would
</I>&gt;<i> &gt; be ideal to have a single queue. Just trying to figure out if that
</I>&gt;<i> &gt; puts us at a massive disadvantage since this queue could potentially
</I>&gt;<i> &gt; get big at times. Thanks very much!
</I>&gt;<i>
</I>&gt;<i> The size of the queue in terms of the number of messages waiting on it
</I>&gt;<i> will ultimately be determined by how much disk space there is to back
</I>&gt;<i> the queue if Rabbit comes under memory pressure due to un-ACK-ed
</I>&gt;<i> messages and has to start using its internal paging mechanism to move
</I>&gt;<i> them to disk and free up working memory (see our documentation on
</I>&gt;<i> &quot;memory-based flow control&quot; for details if you're curious).
</I>&gt;<i>
</I>&gt;<i> If you run into scaling limits with a single queue they're likely to
</I>&gt;<i> arise from there only being so many cycles/sec available on the
</I>&gt;<i> core(s) the queue process is scheduled on before anything else. &#160;If
</I>&gt;<i> you really did have straight line throughput hammering a single queue
</I>&gt;<i> that so overwhelmed the lifting capacity of a single core, then you'd
</I>&gt;<i> want to consider throwing more queues at the process and spreading
</I>&gt;<i> load across them since then you could rely on Erlang's scheduler to
</I>&gt;<i> spread your work across more physical cores. &#160;Building out your
</I>&gt;<i> application starting with a simple queueing topology, and then load
</I>&gt;<i> testing to see if you hit that scenario, will tell you when or whether
</I>&gt;<i> you need to get more exotic in your design.
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Jerry
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015992.html">[rabbitmq-discuss] Single vs. Multiple Queue	Topology	Performance
</A></li>
	<LI>Next message: <A HREF="015993.html">[rabbitmq-discuss] Complaint on lack of easy stand-alone GUI tool	to examine RabbitMQ queues/topics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15996">[ date ]</a>
              <a href="thread.html#15996">[ thread ]</a>
              <a href="subject.html#15996">[ subject ]</a>
              <a href="author.html#15996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
