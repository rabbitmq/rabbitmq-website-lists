<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Stuck waiting for frame during amqp_basic_qos?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stuck%20waiting%20for%20frame%20during%20amqp_basic_qos%3F&In-Reply-To=%3CCADDD582.284C5%25pdezwart%40rubiconproject.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016051.html">
   <LINK REL="Next"  HREF="016041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Stuck waiting for frame during amqp_basic_qos?</H1>
    <B>Pieter de Zwart</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stuck%20waiting%20for%20frame%20during%20amqp_basic_qos%3F&In-Reply-To=%3CCADDD582.284C5%25pdezwart%40rubiconproject.com%3E"
       TITLE="[rabbitmq-discuss] Stuck waiting for frame during amqp_basic_qos?">pdezwart at rubiconproject.com
       </A><BR>
    <I>Tue Nov  8 02:35:50 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016051.html">[rabbitmq-discuss] STOMP performance problems at &gt; 1200	messages/s
</A></li>
        <LI>Next message: <A HREF="016041.html">[rabbitmq-discuss] Stuck waiting for frame during	amqp_basic_qos?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16033">[ date ]</a>
              <a href="thread.html#16033">[ thread ]</a>
              <a href="subject.html#16033">[ subject ]</a>
              <a href="author.html#16033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey everyone,

I am doing something wrong, and I could use some help.  I maintain/develop the PHP extension that interfaces with RabbitMQ via the rabbitmq-c library. We have implemented all of the low level calls, but have also added some helpful wrappers to let poor PHP users not have to deal with all the complexity of the protocol. One of these wrapper methods is AMQPQueue::getMessages(). Unfortunately, I have built a bug I don&#8217;t know how to squash.
During the second call to the AMQPQueue::getMessages() function within a loop (reusing connection and channel), the process get stuck in busy wait. In the attached file on line 37, we call amqp_basic_qos() to prevent any prefetching by the server. That call goes through the following stack in rabbitmq-c:

librabbitmq/amqp_framing.c:1999: amqp_basic_qos
librabbitmq/amqp_socket.c:356: amqp_simple_rpc_decoded
librabbitmq/amqp_socket.c:264: amqp_simple_rpc
librabbitmq/amqp_socket.c:157: wait_frame_inner

And then it gets stuck in that while(1) loop. This is where I am a n00b. I was wondering if someone would be so kind as to review the attached code to see if there is anything obviously stupid I am doing before I go into writing an example in C to highlight my stupidity.

Any help would be much appreciated.

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/d61b24cb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/d61b24cb/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_getmessages.c
Type: application/octet-stream
Size: 8021 bytes
Desc: amqp_getmessages.c
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/d61b24cb/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/d61b24cb/attachment.obj</A>&gt;
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016051.html">[rabbitmq-discuss] STOMP performance problems at &gt; 1200	messages/s
</A></li>
	<LI>Next message: <A HREF="016041.html">[rabbitmq-discuss] Stuck waiting for frame during	amqp_basic_qos?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16033">[ date ]</a>
              <a href="thread.html#16033">[ thread ]</a>
              <a href="subject.html#16033">[ subject ]</a>
              <a href="author.html#16033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
