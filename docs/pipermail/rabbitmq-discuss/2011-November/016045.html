<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Performance issue over time in a consumer using	basic qos (mirrored queues)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20issue%20over%20time%20in%20a%20consumer%20using%0A%09basic%20qos%20%28mirrored%20queues%29&In-Reply-To=%3CCALrPf14YXFg3PmvQ8-c2vgsxkxLiLXR4syCJtRhDXEh3njCwTQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016102.html">
   <LINK REL="Next"  HREF="016093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Performance issue over time in a consumer using	basic qos (mirrored queues)</H1>
    <B>Tarjei Romtveit</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20issue%20over%20time%20in%20a%20consumer%20using%0A%09basic%20qos%20%28mirrored%20queues%29&In-Reply-To=%3CCALrPf14YXFg3PmvQ8-c2vgsxkxLiLXR4syCJtRhDXEh3njCwTQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Performance issue over time in a consumer using	basic qos (mirrored queues)">tarjei.romtveit at integrasco.no
       </A><BR>
    <I>Tue Nov  8 14:11:32 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016102.html">[rabbitmq-discuss] Stuck waiting for frame during amqp_basic_qos?
</A></li>
        <LI>Next message: <A HREF="016093.html">[rabbitmq-discuss] Performance issue over time in a consumer using	basic qos (mirrored queues)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16045">[ date ]</a>
              <a href="thread.html#16045">[ thread ]</a>
              <a href="subject.html#16045">[ subject ]</a>
              <a href="author.html#16045">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After reading some posts on the list it seems like many problems with
performance is nothing new. We are currently reorganizing a cluster
consisting of a myriad of jetty instances to a rabbitmq and a message
driven system. The current component we are moving is shortly a staging
system for a relative slow consumer process..

 Our use-case:.

1. We have currently a small stream of relatively large messages, that
varies in size. (1600 bytes -&gt; 5000 bytes )
2. The incoming rate varies form 0 -&gt; 58 per/s in our current test queues.
3. We have currently two brokers in a cluster
4. The queues are set up in mirrored (We can not lose any messages),
durable and non-exclusive.
5. We use Publisher Confirms/Consumer Cancellation in the client
implementations in Java
6. We use prefetch-count as a basic QOS parameter. We have  tested with: 1,
10 , 15, 25
7. We ack per (deliveryTag % prefetch-count == 0)  to minimize acking.
8. The client can nack a message but it is seldom happening (every 1
million message maybe)

Problem:
Over time we see a larger performance decrease in consuming the messages
from the broker. The consumer is deadly fast in the start. 1-2 ms per
message. Then the retrieval gradually decreases to 25-26 ms per message.
The velocity of the speed decrease is varying by the prefetch size. When
increasing the prefetch count to the time before it reaches 25ms is
exponentially increasing. Up to 12 hours. If we re-initiate the connection
it seem to recover and everything seem OK.

Versions:

Java client: 2.5.1
Broker: 2.5.1 (ubuntu build)

Regards


-- 
Tarjei Romtveit
Data Management Director
Integrasco A/S
Mobile: +47 990 20 074
Address: Hasseldalen 3, N-4878 Grimstad, Norway
www.integrasco.com // twitter.com/integrasco // facebook.com/integrasco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111108/1d5655be/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111108/1d5655be/attachment.htm</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016102.html">[rabbitmq-discuss] Stuck waiting for frame during amqp_basic_qos?
</A></li>
	<LI>Next message: <A HREF="016093.html">[rabbitmq-discuss] Performance issue over time in a consumer using	basic qos (mirrored queues)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16045">[ date ]</a>
              <a href="thread.html#16045">[ thread ]</a>
              <a href="subject.html#16045">[ subject ]</a>
              <a href="author.html#16045">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
