<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Single%20vs.%20Multiple%20Queue%20Topology%0A%09Performance&In-Reply-To=%3C1f97b647-2bd9-4c87-b00c-404eedc67e7c%40StrongMad.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015988.html">
   <LINK REL="Next"  HREF="015991.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Single%20vs.%20Multiple%20Queue%20Topology%0A%09Performance&In-Reply-To=%3C1f97b647-2bd9-4c87-b00c-404eedc67e7c%40StrongMad.local%3E"
       TITLE="[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance">jerryk at vmware.com
       </A><BR>
    <I>Fri Nov  4 16:52:11 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015988.html">[rabbitmq-discuss] Single vs. Multiple Queue Topology Performance
</A></li>
        <LI>Next message: <A HREF="015991.html">[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15989">[ date ]</a>
              <a href="thread.html#15989">[ thread ]</a>
              <a href="subject.html#15989">[ subject ]</a>
              <a href="author.html#15989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Ilya...

It really depends on what you see as the likely &quot;steady state&quot; Rabbit will 
exist in, given your workload.  A good rule of thumb is that &quot;a happy Rabbit
is an empty Rabbit,&quot; i.e. the broker is happiest when consumers are pulling 
messages out of it at a rate reasonably well matched to the rate at which 
producers are pumping things into it (although of course the broker has 
mechanisms for coping with imbalances).

With respect to using one big queue for all of your work items vs separating
things into multiple queues, there are maybe a couple of things to think 
about:

First, you can add multiple consumers to a single queue.  Should you find
that your customers are producing jobs at the front end of your web site
at a higher than anticipated rate, you can always add more back end workers
to consume those jobs from the queue and parallelize their processing (assuming
of course the back end tasks are parallelizable).  If you somehow reach the 
maximum throughput that a single queue can provide, then you could consider 
adding additional queues and spraying your tasks across them.

The second issue to consider is that of availability.  Unless you're using the
new active/active HA system that debuted in Rabbit 2.6.x, each queue's contents
exist only on a single Rabbit node.  Thus, if that node becomes unavailable that
queue's messages are unavailable until it comes back up.  In this case though, 
the solution is probably not to come up with a complex multi-queue solution in
your application but instead to use Rabbit's HA features, either the old style
active/passive HA (where shared storage stands behind each active/passive pair)
or the new active/active HA (where you can specify that a queue be replicated
on multiple nodes in a cluster, as well as how many replicas you want).

So bottom line:  because you can put many consumers on a single queue, it
shouldn't be a bottleneck unless your production rate really overwhelms
what a single queue process can handle.  If you're worried about availability,
using a built-in Rabbit HA feature is probably the way to go and will save you
having to re-implement that in your application.  Finally, if you are going to 
use multiple queues and aren't in the situation of being forced to do so 
by straight-line throughput limitations, introduce new queues based on the logical
structure of your app and its semantics for handling tasks, rather than as
a possibly premature performance optimization.

Does that make sense?  Please feel free to continue the discussion if there
are still things you're wondering about...

Best regards,
Jerry 



----- Original Message -----
From: &quot;Ilya Volodarsky&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ilya at segment.io</A>&gt;
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Sent: Friday, November 4, 2011 8:52:42 AM
Subject: [rabbitmq-discuss] Single vs. Multiple Queue Topology Performance

Hi,

We have an high rate API that has three possible tasks. Web servers
will receive the client's tasks, validate the input, and queue them in
Rabbit. Then, a service will later dequeue these tasks and process
them. I was wondering if putting all these messages into one queue has
any performance or durability repercussions. An alternative is to
separate the tasks into multiple queues based on the client API key,
or on the API verb. Is there any preferred method, or does it not
matter?
Thanks,

Ilya
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015988.html">[rabbitmq-discuss] Single vs. Multiple Queue Topology Performance
</A></li>
	<LI>Next message: <A HREF="015991.html">[rabbitmq-discuss] Single vs. Multiple Queue Topology	Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15989">[ date ]</a>
              <a href="thread.html#15989">[ thread ]</a>
              <a href="subject.html#15989">[ subject ]</a>
              <a href="author.html#15989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
