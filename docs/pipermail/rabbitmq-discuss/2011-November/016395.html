<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Memory Usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Memory%20Usage&In-Reply-To=%3C6250190793052131212%40unknownmsgid%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016392.html">
   <LINK REL="Next"  HREF="016396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Memory Usage</H1>
    <B>Cameron Davison</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Memory%20Usage&In-Reply-To=%3C6250190793052131212%40unknownmsgid%3E"
       TITLE="[rabbitmq-discuss] Cluster Memory Usage">cameron.davison at gmail.com
       </A><BR>
    <I>Sun Nov 20 16:27:27 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016392.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
        <LI>Next message: <A HREF="016396.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16395">[ date ]</a>
              <a href="thread.html#16395">[ thread ]</a>
              <a href="subject.html#16395">[ subject ]</a>
              <a href="author.html#16395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

On Nov 20, 2011, at 7:34 AM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> Cameron,
</I>&gt;<i>
</I>&gt;<i> On 16/11/11 20:06, Cameron Davison wrote:
</I>&gt;&gt;<i> I have a cluster of 2 rabbitmq on 2 machines in the same datacenter.
</I>&gt;&gt;<i> I am sending messages to them at a rate of about 250 message a second
</I>&gt;&gt;<i> each message is about 2k in size on average. The software is able to
</I>&gt;&gt;<i> read them back out at about the same rate. Sometime slower usually
</I>&gt;&gt;<i> faster, which is why I am using a message queue. [...] There are
</I>&gt;&gt;<i> about 10 publishers channels/connections, and about 30 consumer
</I>&gt;&gt;<i> channels/connections. The prefetch is set to 1000 for each channel
</I>&gt;&gt;<i> of the consumers. [...] The cluster is using mirrored queue and
</I>&gt;&gt;<i> confirmations on the writes as well as batch acking on the consumes.
</I>&gt;<i>
</I>&gt;<i> Do all the queue masters reside on the same machine? Or perhaps there is just one queue (in which case the answer obviously is 'yes').
</I>There is only one queue.
&gt;<i>
</I>&gt;<i> Also, what machine do the publishers and consumers connect to?
</I>All of the publishers and consumers connect to the master. We set them
to connect to the first one available, but since we restarted them in
order to get the memory to go once or twice they all ended up
connected to the master.
&gt;<i>
</I>&gt;<i> Are the queues durable and the messages persistent?
</I>Both persistent and durable. I set both in the cluster to be durable
since we have only one queue and did not expect to make anymore.
Seemed like it would not cause extra work to save the queue to disk. I
am using persistent and high available mirrored queues because I
really don't want to lose messages.
&gt;<i>
</I>&gt;&gt;<i> The master rabbitmq is reporting a memory usage by the erlang
</I>&gt;&gt;<i> processer of about 200MB and the slave rabbitmq is reporting around
</I>&gt;&gt;<i> 800MB but sometimes jumps back and forth between 400MB and 900MB
</I>&gt;&gt;<i> rapidly. Is there any reason that the memory usage is so different
</I>&gt;&gt;<i> between the master and the slave.
</I>&gt;<i>
</I>&gt;<i> The workload of the master and slave are quite different, so a difference in the memory profile is not surprising.
</I>&gt;<i>
</I>&gt;<i> Inspecting the memory details of the nodes with 'rabbitmqctl status', or with the management plug-in, might shed some light on where the memory is going.
</I>&gt;<i>
</I>It looks like all the memory is being used by the erlang processes.
Even though the slave has less then a fourth the processes and double
the memory.
&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I></PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016392.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
	<LI>Next message: <A HREF="016396.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16395">[ date ]</a>
              <a href="thread.html#16395">[ thread ]</a>
              <a href="subject.html#16395">[ subject ]</a>
              <a href="author.html#16395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
