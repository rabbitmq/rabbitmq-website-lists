<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%09connection&In-Reply-To=%3CCAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK%2BS7%3DNki6yjw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016225.html">
   <LINK REL="Next"  HREF="016345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection</H1>
    <B>Benjamin Bennett</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%09connection&In-Reply-To=%3CCAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK%2BS7%3DNki6yjw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection">benbennett at gmail.com
       </A><BR>
    <I>Mon Nov 14 23:21:01 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016225.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
</A></li>
        <LI>Next message: <A HREF="016345.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16230">[ date ]</a>
              <a href="thread.html#16230">[ thread ]</a>
              <a href="subject.html#16230">[ subject ]</a>
              <a href="author.html#16230">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am using the spring amqp lib and it is doing the connection closing when
the spring context is closed. I do not think it has a property to inject
the hack. Also if you know any of the spring amqp devs. Having you telling
them to check to make sure it is doing the way you have described will have
much more authority than me.

I will probably hack the spring amqp lib for now
On Nov 14, 2011 12:32 PM, &quot;Simon MacMullen&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 14/11/11 16:15, Benjamin Bennett wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Here is report from  rabbitmqctrl report
</I>&gt;&gt;<i> <A HREF="http://pastebin.com/MSwv82C3">http://pastebin.com/MSwv82C3</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ah, thank you. After some poking, that genuinely looks like a server bug.
</I>&gt;<i> Damn.
</I>&gt;<i>
</I>&gt;<i> In order for it to happen you need the last channel close / close_ok to
</I>&gt;<i> overlap with the connection close / close_ok. With the Java client you have
</I>&gt;<i> to invoke Channel.close() and Connection.close() from different threads to
</I>&gt;<i> get this to happen, and still be unlucky.
</I>&gt;<i>
</I>&gt;<i> You should be allowed to do this, but right now it's racy.
</I>&gt;<i>
</I>&gt;<i> &gt; I was going to attempt to put a timeout on the connection close method
</I>&gt;<i> &gt; but that really would be a hack.
</I>&gt;<i>
</I>&gt;<i> Indeed! Other slightly less hacky workarounds until we get this fixed:
</I>&gt;<i>
</I>&gt;<i> * Invoke Channel.close() and Connection.close() from the same thread, or
</I>&gt;<i> otherwise ensure they don't overlap.
</I>&gt;<i>
</I>&gt;<i> * Don't invoke Channel.close() if you know you're going to invoke
</I>&gt;<i> Connection.close() anyway.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111114/f6a2d5e6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111114/f6a2d5e6/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016225.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
</A></li>
	<LI>Next message: <A HREF="016345.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16230">[ date ]</a>
              <a href="thread.html#16230">[ thread ]</a>
              <a href="subject.html#16230">[ subject ]</a>
              <a href="author.html#16230">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
