<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Messages disappearing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20disappearing&In-Reply-To=%3CF3E9C1826A037A4A84F4D58424D54D7B02E19DA6%40AMSPRD0302MB111.eurprd03.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016365.html">
   <LINK REL="Next"  HREF="016307.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Messages disappearing</H1>
    <B>Nick Pateman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20disappearing&In-Reply-To=%3CF3E9C1826A037A4A84F4D58424D54D7B02E19DA6%40AMSPRD0302MB111.eurprd03.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] Messages disappearing">nick.pateman at certivox.com
       </A><BR>
    <I>Fri Nov 18 15:13:55 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016365.html">[rabbitmq-discuss] Messages disappearing
</A></li>
        <LI>Next message: <A HREF="016307.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16366">[ date ]</a>
              <a href="thread.html#16366">[ thread ]</a>
              <a href="subject.html#16366">[ subject ]</a>
              <a href="author.html#16366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Awesome! You're a star, it's working great now thanks a million for your time.

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Valentin BERNARD
Sent: 18 November 2011 14:41
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Messages disappearing

Hi,

You probably shouldn't call basic_consume on your message sending application. If I understand correctly, you're consuming on the queue you're sending messages to - so they just come back at you, and since you have no code to handle them they get lost.

Try removing the following lines:
   amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 0, 0, amqp_empty_table);
   die_on_amqp_error(amqp_get_rpc_reply(conn),
                 &quot;Consuming&quot;);

Cheers,

Valentin.


On 18 nov, 14:35, Nick Pateman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">nick.pate... at certivox.com</A>&gt; wrote:
&gt;<i> Hey Simon,
</I>&gt;<i>
</I>&gt;<i> I do have message receipt code but I'm not actually running it yet, it's in a completely separate application I'm developing and It's definitely not loaded yet. &#160;The code for my message sending application, which is the only one that I am currently running at the moment is....
</I>&gt;<i>
</I>&gt;<i> #include &lt;sys/types.h&gt;
</I>&gt;<i> #include &lt;sys/stat.h&gt;
</I>&gt;<i> #include &lt;stdio.h&gt;
</I>&gt;<i> #include &lt;stdlib.h&gt;
</I>&gt;<i> #include &lt;fcntl.h&gt;
</I>&gt;<i> #include &lt;errno.h&gt;
</I>&gt;<i> #include &lt;unistd.h&gt;
</I>&gt;<i> #include &lt;syslog.h&gt;
</I>&gt;<i> #include &lt;string.h&gt;
</I>&gt;<i> #include &lt;assert.h&gt;
</I>&gt;<i> #include &lt;signal.h&gt;
</I>&gt;<i> #include &lt;stdint.h&gt;
</I>&gt;<i> #include &lt;amqp.h&gt;
</I>&gt;<i> #include &lt;amqp_framing.h&gt;
</I>&gt;<i> #include &lt;assert.h&gt;
</I>&gt;<i> #include &lt;sys/time.h&gt;
</I>&gt;<i> #include &lt;unistd.h&gt;
</I>&gt;<i>
</I>&gt;<i> #define SUMMARY_EVERY_US 1000000
</I>&gt;<i>
</I>&gt;<i> const amqp_bytes_t amqp_empty_bytes = { 0, NULL }; const amqp_table_t 
</I>&gt;<i> amqp_empty_table = { 0, NULL };
</I>&gt;<i>
</I>&gt;<i> uint64_t now_microseconds(void)
</I>&gt;<i> {
</I>&gt;<i> &#160; struct timeval tv;
</I>&gt;<i> &#160; gettimeofday(&amp;tv, NULL);
</I>&gt;<i> &#160; return (uint64_t) tv.tv_sec * 1000000 + (uint64_t) tv.tv_usec;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> void microsleep(int usec)
</I>&gt;<i> {
</I>&gt;<i> &#160; usleep(usec);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> void die_on_error(int x, char const *context) {
</I>&gt;<i> &#160; if (x &lt; 0) {
</I>&gt;<i> &#160; &#160; char *errstr = amqp_error_string(-x);
</I>&gt;<i> &#160; &#160; fprintf(stderr, &quot;%s: %s\n&quot;, context, errstr);
</I>&gt;<i> &#160; &#160; free(errstr);
</I>&gt;<i> &#160; &#160; exit(1);
</I>&gt;<i> &#160; }
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> void die_on_amqp_error(amqp_rpc_reply_t x, char const *context) {
</I>&gt;<i> &#160; switch (x.reply_type) {
</I>&gt;<i> &#160; &#160; case AMQP_RESPONSE_NORMAL:
</I>&gt;<i> &#160; &#160; &#160; return;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; case AMQP_RESPONSE_NONE:
</I>&gt;<i> &#160; &#160; &#160; fprintf(stderr, &quot;%s: missing RPC reply type!\n&quot;, context);
</I>&gt;<i> &#160; &#160; &#160; break;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; case AMQP_RESPONSE_LIBRARY_EXCEPTION:
</I>&gt;<i> &#160; &#160; &#160; fprintf(stderr, &quot;%s: %s\n&quot;, context, 
</I>&gt;<i> amqp_error_string(x.library_error));
</I>&gt;<i> &#160; &#160; &#160; break;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; case AMQP_RESPONSE_SERVER_EXCEPTION:
</I>&gt;<i> &#160; &#160; &#160; switch (x.reply.id) {
</I>&gt;<i> &#160; &#160; &#160; &#160; case AMQP_CONNECTION_CLOSE_METHOD: {
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; amqp_connection_close_t *m = (amqp_connection_close_t *) 
</I>&gt;<i> x.reply.decoded;
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; fprintf(stderr, &quot;%s: server connection error %d, message: 
</I>&gt;<i> %.*s\n&quot;,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; context,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; m-&gt;reply_code,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (int) m-&gt;reply_text.len, (char *) 
</I>&gt;<i> m-&gt;reply_text.bytes);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; break; &#160;FILE* pFilFile = fopen(&quot;cekencapsulatereq.js&quot;, &quot;r&quot;);
</I>&gt;<i> &#160; &#160; &#160; &#160; }
</I>&gt;<i> &#160; &#160; &#160; &#160; case AMQP_CHANNEL_CLOSE_METHOD: {
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; amqp_channel_close_t *m = (amqp_channel_close_t *) 
</I>&gt;<i> x.reply.decoded;
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; fprintf(stderr, &quot;%s: server channel error %d, message: 
</I>&gt;<i> %.*s\n&quot;,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; context,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; m-&gt;reply_code,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (int) m-&gt;reply_text.len, (char *) 
</I>&gt;<i> m-&gt;reply_text.bytes);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; break;
</I>&gt;<i> &#160; &#160; &#160; &#160; }
</I>&gt;<i> &#160; &#160; &#160; &#160; default:
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; fprintf(stderr, &quot;%s: unknown server error, method id 
</I>&gt;<i> 0x%08X\n&quot;, context, x.reply.id);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; break;
</I>&gt;<i> &#160; &#160; &#160; }
</I>&gt;<i> &#160; &#160; &#160; break;
</I>&gt;<i> &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; exit(1);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> static void dump_row(long count, int numinrow, int *chs) {
</I>&gt;<i> &#160; int i;
</I>&gt;<i>
</I>&gt;<i> &#160; printf(&quot;%08lX:&quot;, count - numinrow);
</I>&gt;<i>
</I>&gt;<i> &#160; if (numinrow &gt; 0) {
</I>&gt;<i> &#160; &#160; for (i = 0; i &lt; numinrow; i++) {
</I>&gt;<i> &#160; &#160; &#160; if (i == 8)
</I>&gt;<i> &#160; &#160; &#160; &#160; printf(&quot; :&quot;);
</I>&gt;<i> &#160; &#160; &#160; printf(&quot; %02X&quot;, chs[i]);
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i> &#160; &#160; for (i = numinrow; i &lt; 16; i++) {
</I>&gt;<i> &#160; &#160; &#160; if (i == 8)
</I>&gt;<i> &#160; &#160; &#160; &#160; printf(&quot; :&quot;);
</I>&gt;<i> &#160; &#160; &#160; printf(&quot; &#160; &quot;);
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i> &#160; &#160; printf(&quot; &#160;&quot;);
</I>&gt;<i> &#160; &#160; for (i = 0; i &lt; numinrow; i++) {
</I>&gt;<i> &#160; &#160; &#160; if (isprint(chs[i]))
</I>&gt;<i> &#160; &#160; &#160; &#160; printf(&quot;%c&quot;, chs[i]);
</I>&gt;<i> &#160; &#160; &#160; else
</I>&gt;<i> &#160; &#160; &#160; &#160; printf(&quot;.&quot;);
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i> &#160; }
</I>&gt;<i> &#160; printf(&quot;\n&quot;);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> static int rows_eq(int *a, int *b) {
</I>&gt;<i> &#160; int i;
</I>&gt;<i>
</I>&gt;<i> &#160; for (i=0; i&lt;16; i++)
</I>&gt;<i> &#160; &#160; if (a[i] != b[i])
</I>&gt;<i> &#160; &#160; &#160; return 0;
</I>&gt;<i>
</I>&gt;<i> &#160; return 1;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> void amqp_dump(void const *buffer, size_t len) {
</I>&gt;<i> &#160; unsigned char *buf = (unsigned char *) buffer;
</I>&gt;<i> &#160; long count = 0;
</I>&gt;<i> &#160; int numinrow = 0;
</I>&gt;<i> &#160; int chs[16];
</I>&gt;<i> &#160; int oldchs[16];
</I>&gt;<i> &#160; int showed_dots = 0;
</I>&gt;<i> &#160; int i;
</I>&gt;<i>
</I>&gt;<i> &#160; for (i = 0; i &lt; len; i++) {
</I>&gt;<i> &#160; &#160; int ch = buf[i];
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; if (numinrow == 16) {
</I>&gt;<i> &#160; &#160; &#160; int i;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; if (rows_eq(oldchs, chs)) {
</I>&gt;<i> &#160; &#160; &#160; &#160; if (!showed_dots) {
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; showed_dots = 1;
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; printf(&quot; &#160; &#160; &#160; &#160; &#160;.. .. .. .. .. .. .. .. : .. .. .. .. .. 
</I>&gt;<i> .. .. ..\n&quot;);
</I>&gt;<i> &#160; &#160; &#160; &#160; }
</I>&gt;<i> &#160; &#160; &#160; } else {
</I>&gt;<i> &#160; &#160; &#160; &#160; showed_dots = 0;
</I>&gt;<i> &#160; &#160; &#160; &#160; dump_row(count, numinrow, chs);
</I>&gt;<i> &#160; &#160; &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; for (i=0; i&lt;16; i++)
</I>&gt;<i> &#160; &#160; &#160; &#160; oldchs[i] = chs[i];
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; numinrow = 0;
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; count++;
</I>&gt;<i> &#160; &#160; chs[numinrow++] = ch;
</I>&gt;<i> &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; dump_row(count, numinrow, chs);
</I>&gt;<i>
</I>&gt;<i> &#160; if (numinrow != 0)
</I>&gt;<i> &#160; &#160; printf(&quot;%08lX:\n&quot;, count);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> /*********************************************************************
</I>&gt;<i> *****
</I>&gt;<i> &#160; &#160; Function: main
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; Description:
</I>&gt;<i> &#160; &#160; &#160; &#160; The c standard 'main' entry point function.
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; Returns:
</I>&gt;<i> &#160; &#160; &#160; &#160; returns integer which is passed back to the parent process 
</I>&gt;<i> **********************************************************************
</I>&gt;<i> ****/
</I>&gt;<i> int main(int argc, char *argv[]) {
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; char const *hostname;
</I>&gt;<i> &#160; &#160; int port;
</I>&gt;<i> &#160; &#160; char const *exchange;
</I>&gt;<i> &#160; &#160; char const *bindingkey;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; int sockfd;
</I>&gt;<i> &#160; &#160; amqp_connection_state_t conn;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; amqp_bytes_t queuename = amqp_cstring_bytes(&quot;testing&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; hostname = &quot;localhost&quot;;
</I>&gt;<i> &#160; &#160; port = 5672;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; conn = amqp_new_connection();
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; die_on_error(sockfd = amqp_open_socket(hostname, port),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Opening socket&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; amqp_set_sockfd(conn, sockfd);
</I>&gt;<i> &#160; &#160; die_on_amqp_error(amqp_login(conn, &quot;/&quot;, 0, 131072, 0, 
</I>&gt;<i> AMQP_SASL_METHOD_PLAIN, &quot;guest&quot;, &quot;guest&quot;),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Logging in&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; amqp_channel_open(conn, 1);
</I>&gt;<i> &#160; &#160; die_on_amqp_error(amqp_get_rpc_reply(conn),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Opening channel&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; amqp_basic_consume(conn, 1, queuename, amqp_empty_bytes, 0, 0, 0, 
</I>&gt;<i> amqp_empty_table);
</I>&gt;<i> &#160; &#160; die_on_amqp_error(amqp_get_rpc_reply(conn),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Consuming&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; //****************************************************
</I>&gt;<i> &#160; &#160; // TODO: Insert core of your message queueing code here
</I>&gt;<i> &#160; &#160; //****************************************************
</I>&gt;<i> &#160; &#160; send_batch(conn, (char*)queuename.bytes, 10, 1000);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; //****************************************************
</I>&gt;<i> &#160; &#160; // TODO: Free any allocated resources before exiting
</I>&gt;<i> &#160; &#160; //****************************************************
</I>&gt;<i> &#160; &#160; die_on_amqp_error(amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Closing channel&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; die_on_amqp_error(amqp_connection_close(conn, AMQP_REPLY_SUCCESS),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Closing connection&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; die_on_error(amqp_destroy_connection(conn),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Ending connection&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; exit(0);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> void send_batch(amqp_connection_state_t conn,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;char const *queue_name,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;int rate_limit,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;int message_count) {
</I>&gt;<i> &#160; uint64_t start_time = now_microseconds();
</I>&gt;<i> &#160; int i;
</I>&gt;<i> &#160; int sent = 0;
</I>&gt;<i> &#160; int previous_sent = 0;
</I>&gt;<i> &#160; uint64_t previous_report_time = start_time;
</I>&gt;<i> &#160; uint64_t next_summary_time = start_time + SUMMARY_EVERY_US;
</I>&gt;<i>
</I>&gt;<i> &#160; for (i = 0; i &lt; message_count; i++) {
</I>&gt;<i> &#160; &#160; uint64_t now = now_microseconds();
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; amqp_basic_properties_t props;
</I>&gt;<i> &#160; &#160; props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG | 
</I>&gt;<i> AMQP_BASIC_DELIVERY_MODE_FLAG;
</I>&gt;<i> &#160; &#160; props.content_type = amqp_cstring_bytes(&quot;text/plain&quot;);
</I>&gt;<i> &#160; &#160; props.delivery_mode = 2; /* persistent delivery mode */
</I>&gt;<i> &#160; &#160; die_on_error(amqp_basic_publish(conn,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 1,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; amqp_cstring_bytes(&quot;&quot;),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; amqp_cstring_bytes(queue_name),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &amp;props,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; amqp_cstring_bytes(&quot;Hello world!&quot;)),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &quot;Publishing&quot;);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; sent++;
</I>&gt;<i> &#160; &#160; if (now &gt; next_summary_time) {
</I>&gt;<i> &#160; &#160; &#160; int countOverInterval = sent - previous_sent;
</I>&gt;<i> &#160; &#160; &#160; double intervalRate = countOverInterval / ((now - 
</I>&gt;<i> previous_report_time) / 1000000.0);
</I>&gt;<i> &#160; &#160; &#160; printf(&quot;%d ms: Sent %d - %d since last report (%d Hz)\n&quot;,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160;(int)(now - start_time) / 1000, sent, countOverInterval, 
</I>&gt;<i> (int) intervalRate);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; previous_sent = sent;
</I>&gt;<i> &#160; &#160; &#160; previous_report_time = now;
</I>&gt;<i> &#160; &#160; &#160; next_summary_time += SUMMARY_EVERY_US;
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; while (((i * 1000000.0) / (now - start_time)) &gt; rate_limit) {
</I>&gt;<i> &#160; &#160; &#160; microsleep(20 &#160;FILE* pFilFile = fopen(&quot;cekencapsulatereq.js&quot;, 
</I>&gt;<i> &quot;r&quot;);00);
</I>&gt;<i> &#160; &#160; &#160; now = now_microseconds();
</I>&gt;<i> &#160; &#160; }
</I>&gt;<i> &#160; }
</I>&gt;<i>
</I>&gt;<i> &#160; {
</I>&gt;<i> &#160; &#160; uint64_t stop_time = now_microseconds();
</I>&gt;<i> &#160; &#160; int total_delta = stop_time - start_time;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; printf(&quot;PRODUCER - Message count: %d\n&quot;, message_count);
</I>&gt;<i> &#160; &#160; printf(&quot;Total time, milliseconds: %d\n&quot;, total_delta / 1000);
</I>&gt;<i> &#160; &#160; printf(&quot;Overall messages-per-second: %g\n&quot;, (message_count / 
</I>&gt;<i> (total_delta / 1000000.0)));
</I>&gt;<i> &#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-boun... at lists.rabbitmq.com</A> 
</I>&gt;<i> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-boun... at lists.rabbitmq.com</A>] On Behalf Of 
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> Sent: 17 November 2011 15:44
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Messages disappearing
</I>&gt;<i>
</I>&gt;<i> On 17/11/11 15:38, Nick Pateman wrote:
</I>&gt;<i> &gt; I've set no_ack to 0 in my amq_basic_consume call and the messages 
</I>&gt;<i> &gt; are now appearing in the queue but as unacknowledged.
</I>&gt;<i>
</I>&gt;<i> So all this sounds like the messages are being sent to your application:
</I>&gt;<i>
</I>&gt;<i> no_ack = 1 -&gt; messages are sent to your app, RabbitMQ forgets about them immediately.
</I>&gt;<i>
</I>&gt;<i> no_ack = 0 -&gt; messages are sent to your app, RabbitMQ treats them as unacknowledged until you ack.
</I>&gt;<i>
</I>&gt;<i> The source code you posted doesn't show any code that actually handles received message frames - you do have some right?
</I>&gt;<i>
</I>&gt;<i> Can you post your whole source somewhere? It's quite difficult to tell what is going on looking at fragments.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/
</I>&gt;<i> mailman/listinfo/rabbitmq-discuss
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/
</I>&gt;<i> mailman/listinfo/rabbitmq-discuss
</I>_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>


</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016365.html">[rabbitmq-discuss] Messages disappearing
</A></li>
	<LI>Next message: <A HREF="016307.html">[rabbitmq-discuss] Cluster Memory Usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16366">[ date ]</a>
              <a href="thread.html#16366">[ thread ]</a>
              <a href="subject.html#16366">[ subject ]</a>
              <a href="author.html#16366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
