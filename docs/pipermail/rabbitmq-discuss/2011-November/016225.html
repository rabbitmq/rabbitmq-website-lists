<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%20connection&In-Reply-To=%3C4EC15EA2.4010507%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016218.html">
   <LINK REL="Next"  HREF="016230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%20connection&In-Reply-To=%3C4EC15EA2.4010507%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection">simon at rabbitmq.com
       </A><BR>
    <I>Mon Nov 14 18:32:02 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016218.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
        <LI>Next message: <A HREF="016230.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16225">[ date ]</a>
              <a href="thread.html#16225">[ thread ]</a>
              <a href="subject.html#16225">[ subject ]</a>
              <a href="author.html#16225">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/11/11 16:15, Benjamin Bennett wrote:
&gt;<i> Here is report from  rabbitmqctrl report
</I>&gt;<i> <A HREF="http://pastebin.com/MSwv82C3">http://pastebin.com/MSwv82C3</A>
</I>
Ah, thank you. After some poking, that genuinely looks like a server 
bug. Damn.

In order for it to happen you need the last channel close / close_ok to 
overlap with the connection close / close_ok. With the Java client you 
have to invoke Channel.close() and Connection.close() from different 
threads to get this to happen, and still be unlucky.

You should be allowed to do this, but right now it's racy.

 &gt; I was going to attempt to put a timeout on the connection close method
 &gt; but that really would be a hack.

Indeed! Other slightly less hacky workarounds until we get this fixed:

* Invoke Channel.close() and Connection.close() from the same thread, or 
otherwise ensure they don't overlap.

* Don't invoke Channel.close() if you know you're going to invoke 
Connection.close() anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016218.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
	<LI>Next message: <A HREF="016230.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16225">[ date ]</a>
              <a href="thread.html#16225">[ thread ]</a>
              <a href="subject.html#16225">[ subject ]</a>
              <a href="author.html#16225">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
