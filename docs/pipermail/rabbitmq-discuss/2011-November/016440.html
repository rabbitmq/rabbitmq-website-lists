<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] active/active message persistence problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20message%20persistence%20problem&In-Reply-To=%3CCAGWz9vUbQ00kM3yJPOe68pWgG_BL6H1oL%3DfQe4FUu4d4Rj0b3w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016436.html">
   <LINK REL="Next"  HREF="016441.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] active/active message persistence problem</H1>
    <B>Cameron Davison</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20message%20persistence%20problem&In-Reply-To=%3CCAGWz9vUbQ00kM3yJPOe68pWgG_BL6H1oL%3DfQe4FUu4d4Rj0b3w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] active/active message persistence problem">cameron.davison at gmail.com
       </A><BR>
    <I>Tue Nov 22 05:46:24 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016436.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
        <LI>Next message: <A HREF="016441.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16440">[ date ]</a>
              <a href="thread.html#16440">[ thread ]</a>
              <a href="subject.html#16440">[ subject ]</a>
              <a href="author.html#16440">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What order are you restarting the nodes? Any rabbitmq server that
connects to a cluster will start its queue fresh and begin replicating
from the master. You should wait and make sure that all the queues are
synchronized before you shut down the master, or new master. Old
messages are not read from nodes that connect to the cluster because
the assumption is that the queue will go to 0 soon and then the old
messages will not matter so only the new messages will be important.
Also, you should make sure that the &quot;x-ha-policy&quot; is set to &quot;all&quot; or
to the &quot;nodes&quot; that you would like the queue to be mirrored to.

Cameron

On Mon, Nov 21, 2011 at 7:14 PM, Jeffrey Chen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cpthk at hotmail.com</A>&gt; wrote:
&gt;<i> Hi RabbitMQ community:
</I>&gt;<i>
</I>&gt;<i> I am encounter this problem about message persistence. Here is my case, I
</I>&gt;<i> have 2 server nodes with active/active setup, both are persisted to DISK.
</I>&gt;<i> The queue declarations are defined as durable.
</I>&gt;<i> This is what I got when doing:
</I>&gt;<i>
</I>&gt;<i> # rabbitmqctl cluster_status
</I>&gt;<i> Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at aaron-vm177</A>' ...
</I>&gt;<i> [{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm1</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm2</A>']}]},
</I>&gt;<i> &#160;{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm1</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm2</A>']}]
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i> # rabbitmqctl list_queues
</I>&gt;<i> Listing queues ...
</I>&gt;<i> test &#160;&#160; 10
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My vm1 is currently master node. When I stop RabbitMQ service in vm1, and
</I>&gt;<i> start it back up. I check my messages in the queue, the messages are still
</I>&gt;<i> there. This time when I stop RabbitMQ service in vm2. The messages will be
</I>&gt;<i> gone. It seems like when I restart both server nodes, the data will be lost.
</I>&gt;<i> Does anyone know the reason? Is there any way to work around this?
</I>&gt;<i>
</I>&gt;<i> My goal is that any server nodes down, and when I bring it back up, no data
</I>&gt;<i> will be lost.
</I>&gt;<i>
</I>&gt;<i> Jeffrey.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016436.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
	<LI>Next message: <A HREF="016441.html">[rabbitmq-discuss] active/active message persistence problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16440">[ date ]</a>
              <a href="thread.html#16440">[ thread ]</a>
              <a href="subject.html#16440">[ subject ]</a>
              <a href="author.html#16440">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
