<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA - missing or incompletely replicated	queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20missing%20or%20incompletely%20replicated%0A%09queues&In-Reply-To=%3CCAGn3ETFXWmD6ZaGMKUBV5ZNjnaceOLEBqNb78-S62ZOrpU9Yug%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016029.html">
   <LINK REL="Next"  HREF="016032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA - missing or incompletely replicated	queues</H1>
    <B>Ashley Brown</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20missing%20or%20incompletely%20replicated%0A%09queues&In-Reply-To=%3CCAGn3ETFXWmD6ZaGMKUBV5ZNjnaceOLEBqNb78-S62ZOrpU9Yug%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] HA - missing or incompletely replicated	queues">ashley at spider.io
       </A><BR>
    <I>Mon Nov  7 23:46:26 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016029.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
        <LI>Next message: <A HREF="016032.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16030">[ date ]</a>
              <a href="thread.html#16030">[ thread ]</a>
              <a href="subject.html#16030">[ subject ]</a>
              <a href="author.html#16030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Could you describe accurately what your tests are so that we can try and
</I>&gt;<i> reproduce?
</I>&gt;<i>
</I>&gt;<i>
</I>I'm afraid the tests are of the system overall, and I haven't been able to
produce a minimal test case so far. This evening's test involved dropping
backed up messages into the queues quickly, while draining them slowly.
Effectively:

5 HA queues, replicated to all nodes. 3 nodes in the cluster, 15GB
machines, high water mark at 5.9GB.

Start producers and consumers, consumers running slowly, allowing queues to
build to 500k.

Stop producers and consumers, delete queues. Deletions take a long time.
Although I've also seen this with no-HA queues - it can take tens of
minutes to delete a queue with 250k+ messages in.

Previously we've had queues in a steady state, with approximately 25,000
unacked messages (they take several minutes to process, aren't acked until
complete). Then kill some nodes off, forcing the messages to be requeued
and replayed on the slaves. It all gets out of sync after that.

I might be able to give you a better test case once we've pushed our non-HA
release out and I have a bit more time.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/66fdcfcd/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/66fdcfcd/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016029.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
	<LI>Next message: <A HREF="016032.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16030">[ date ]</a>
              <a href="thread.html#16030">[ thread ]</a>
              <a href="subject.html#16030">[ subject ]</a>
              <a href="author.html#16030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
