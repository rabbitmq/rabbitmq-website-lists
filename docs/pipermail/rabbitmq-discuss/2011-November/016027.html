<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA - missing or incompletely replicated	queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20missing%20or%20incompletely%20replicated%0A%09queues&In-Reply-To=%3CCAGn3ETE%3Dbp9%2BpjM%3DqEEA%3D5EKRWun_rY7LUA5tZjb8f9E3Ad7Pw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016021.html">
   <LINK REL="Next"  HREF="016029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA - missing or incompletely replicated	queues</H1>
    <B>Ashley Brown</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20missing%20or%20incompletely%20replicated%0A%09queues&In-Reply-To=%3CCAGn3ETE%3Dbp9%2BpjM%3DqEEA%3D5EKRWun_rY7LUA5tZjb8f9E3Ad7Pw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] HA - missing or incompletely replicated	queues">ashley at spider.io
       </A><BR>
    <I>Mon Nov  7 22:29:36 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016021.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
        <LI>Next message: <A HREF="016029.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16027">[ date ]</a>
              <a href="thread.html#16027">[ thread ]</a>
              <a href="subject.html#16027">[ subject ]</a>
              <a href="author.html#16027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Trying to check if this is a plugin
</I>&gt;<i> &gt; bug with list_queues (list_queues name slave_pids
</I>&gt;<i> synchronised_slave_pids),
</I>&gt;<i> &gt; I can't get the cluster to list them at all, it just sits there (for the
</I>&gt;<i> &gt; last 15 minutes).
</I>&gt;<i>
</I>&gt;<i> Curious. Are any of the nodes hammering CPU or disk? Were any of the
</I>&gt;<i> queues particularly long before shutdown?
</I>

Have got a similar problem running tests this evening, although this time
*without* any shutdowns (3 nodes all running fine since full restart). I've
had some queues get fairly long (1/2 million messages or so, 3 of them),
due to broken consumers. The management interface stopped updating message
counts as CPU use hit the roof. I was testing so decided to delete the
queues and start again. I stopped the producers and consumers running, so
the queues were in a steady state and CPU came down. Deleting most queues
worked fine, apart from the last one. The management interface just hangs
(Chrome offers to kill the page), whether I try to delete or purge the
queue. As can be seen below, beam processes are hogging two of the cores on
the 'master' for this queue:

<A HREF="http://www.evernote.com/shard/s53/sh/1ba2b59b-913f-4a00-bf3a-03067c0a1f29/faa3fc9c1b250b10b5d8491c367aa991">http://www.evernote.com/shard/s53/sh/1ba2b59b-913f-4a00-bf3a-03067c0a1f29/faa3fc9c1b250b10b5d8491c367aa991</A>

Beam processes are also hogging one core on the slave nodes.

The logs show all three nodes are switching between being clear of the
watermark and over it, every few minutes.

Watermark is 5.9GB, management interface shows the slaves &lt; 2GB, the master
on 4.4GB. (Log snippet at the end of the email).


=INFO REPORT==== 7-Nov-2011::22:20:01 ===
vm_memory_high_watermark set. Memory used:6970525768 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:20:01 ===
    alarm_handler: {set,{{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>},
                         []}}

=INFO REPORT==== 7-Nov-2011::22:20:03 ===
vm_memory_high_watermark clear. Memory used:5018976928 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:20:03 ===
    alarm_handler: {clear,{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>}}

=INFO REPORT==== 7-Nov-2011::22:22:00 ===
vm_memory_high_watermark set. Memory used:6583230408 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:22:00 ===
    alarm_handler: {set,{{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>},
                         []}}

=INFO REPORT==== 7-Nov-2011::22:22:02 ===
vm_memory_high_watermark clear. Memory used:5025939688 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:22:02 ===
    alarm_handler: {clear,{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>}}

=INFO REPORT==== 7-Nov-2011::22:24:50 ===
vm_memory_high_watermark set. Memory used:6587145104 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:24:50 ===
    alarm_handler: {set,{{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>},
                         []}}

=INFO REPORT==== 7-Nov-2011::22:24:51 ===
vm_memory_high_watermark clear. Memory used:5029821304 allowed:6296176230

=INFO REPORT==== 7-Nov-2011::22:24:51 ===
    alarm_handler: {clear,{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,clusterrabbit at hermes02</A>}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/aa7896ef/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111107/aa7896ef/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016021.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
	<LI>Next message: <A HREF="016029.html">[rabbitmq-discuss] HA - missing or incompletely replicated	queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16027">[ date ]</a>
              <a href="thread.html#16027">[ thread ]</a>
              <a href="subject.html#16027">[ subject ]</a>
              <a href="author.html#16027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
