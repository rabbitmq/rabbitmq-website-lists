<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3C20111104153821.GA31860%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015951.html">
   <LINK REL="Next"  HREF="015990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3C20111104153821.GA31860%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large">matthew at rabbitmq.com
       </A><BR>
    <I>Fri Nov  4 15:38:22 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015951.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
        <LI>Next message: <A HREF="015990.html">[rabbitmq-discuss] Publisher Confirms stop occurring when	Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15986">[ date ]</a>
              <a href="thread.html#15986">[ thread ]</a>
              <a href="subject.html#15986">[ subject ]</a>
              <a href="author.html#15986">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Cameron,

On Wed, Nov 02, 2011 at 12:10:21AM -0500, Cameron Davison wrote:
&gt;<i> Thank you for the reply. Do y'all have a bug tracker that I would be
</I>&gt;<i> able to watch so that I can know when y'all address this issue?
</I>
We do have a bug tracker but alas it's not public because we all like to
curse and scream at each other and generally feel that making it public
would preclude us from doing that, which would be bad for morale.

&gt;<i> Do you
</I>&gt;<i> know if this same thing would be even worse for a mirrored queue
</I>&gt;<i> rabbit mq cluster?
</I>
I don't think this bug will affect mirrored queues in a worse way than
non-mirrored queues...

&gt;<i> I am seeing a lot of degradation in write
</I>&gt;<i> throughput while reading when doing mirrored queue cluster. All I
</I>&gt;<i> really want is high availability such that if one server crashed the
</I>&gt;<i> slave in the cluster will become the master and allow for continued
</I>&gt;<i> throughput. Is this the correct way to that?
</I>
Yes - you are doing things the right way. Mirrored queues are much
slower than non-mirrored queues due to the additional work that has to
be done. You should probably expect to see about a ten-fold decrease in
performance.

<A HREF="http://old.nabble.com/Mirror-queues-and-poor-write-performance-td32727693.html">http://old.nabble.com/Mirror-queues-and-poor-write-performance-td32727693.html</A>
reports that I can get a little over 2kHz on a single mirrored queue
with one consumer keeping the queue empty.

But the bug that you've identified will certainly affect mirrored queues
as well as non-mirrored queues.

One thing you could try is on the consumer:
1. Try a fairly healthy qos prefetch size N (eg N=100)
2. Only ack every N/2 (eg 50) msgs but turn on the &quot;multiple&quot; flag in
the ack.

The effect of these changes will be to reduce the consumer-related
messages that the queue has to deal with, and so will hopefully allow
the queue to process the publishes faster (and issue the confirms).

If you're able to try these changes, I'd be interested in what
improvements (if any) they achieve for you.

Best wishes,

Matthew
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015951.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
	<LI>Next message: <A HREF="015990.html">[rabbitmq-discuss] Publisher Confirms stop occurring when	Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15986">[ date ]</a>
              <a href="thread.html#15986">[ thread ]</a>
              <a href="subject.html#15986">[ subject ]</a>
              <a href="author.html#15986">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
