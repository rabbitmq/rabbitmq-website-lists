<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3C20111101063139.GA3240%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015936.html">
   <LINK REL="Next"  HREF="015951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3C20111101063139.GA3240%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Nov  1 06:31:39 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015936.html">[rabbitmq-discuss] PossibleAuthenticationFailureError
</A></li>
        <LI>Next message: <A HREF="015951.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15930">[ date ]</a>
              <a href="thread.html#15930">[ thread ]</a>
              <a href="subject.html#15930">[ subject ]</a>
              <a href="author.html#15930">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Cameron,

Thanks for the detailed report.

Your report has prompted us to think carefully about your test, and we
can see how the broker can end up behave this way. This is not desired
behaviour of the broker and thus does constitute a bug. There is no
work-around.

What is happening is that your publisher is waiting for the broker to
send the confirms back to it. For this to happen, internally, the queues
have to send some messages to themselves. These messages are being
starved out because Rabbit prioritises getting rid of messages. Thus the
queue's desire to drive the consumer prevents the queue from processing
internal messages that would lead the queue to issue the confirms back
up, via the channel and out to the client.

At a minimum, we need to adjust some message priorities internally. But
the actual fix may turn out to be bigger than that. Given current
timings, I wouldn't expect a fix for this to be in the next release, but
in the one after that.

Best wishes,

Matthew
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015936.html">[rabbitmq-discuss] PossibleAuthenticationFailureError
</A></li>
	<LI>Next message: <A HREF="015951.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15930">[ date ]</a>
              <a href="thread.html#15930">[ thread ]</a>
              <a href="subject.html#15930">[ subject ]</a>
              <a href="author.html#15930">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
