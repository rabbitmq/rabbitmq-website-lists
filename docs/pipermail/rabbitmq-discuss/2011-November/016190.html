<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%09connection&In-Reply-To=%3CCAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016163.html">
   <LINK REL="Next"  HREF="016191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection</H1>
    <B>Benjamin Bennett</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%09connection&In-Reply-To=%3CCAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection">benbennett at gmail.com
       </A><BR>
    <I>Sun Nov 13 20:50:20 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016163.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
        <LI>Next message: <A HREF="016191.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16190">[ date ]</a>
              <a href="thread.html#16190">[ thread ]</a>
              <a href="subject.html#16190">[ subject ]</a>
              <a href="author.html#16190">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is the stacktrace from the running test cases. I just ran the
test cases 4 times without a hang on the same vm , then last 3 times
it hangs.

The tests hang for 20 minutes then the junit run kills the jvm for
timeout exception.

In the rabbitmq log it is just says the connection abruptly close at
the same time of the junit runner killed the unit tests.

I was going to attempt to put a timeout on the connection close method
but that really would be a hack.


The stacktrace is exactly the same as this one
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014789.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014789.html</A>
.
<A HREF="http://pastebin.com/u1Z0Qyrr">http://pastebin.com/u1Z0Qyrr</A>

Also before the test cases are run I reinstall rabbitmq , delete all
vhosts and recreate them . So there should not be any memory issues .

The only thread that is in the RUNNABLE state is at the beginning of
the the stacktrace. I realize this is causing the hang but I don't
understand why no reply is getting through from rabbit.

at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.read(SocketInputStream.java:129)

Searching the interwebs points to the remote server not responding.
<A HREF="http://javaeesupportpatterns.blogspot.com/2011/04/javanetsocketinputstreamsocketread0.html">http://javaeesupportpatterns.blogspot.com/2011/04/javanetsocketinputstreamsocketread0.html</A>

I can hook up wireshark next to try to diagnose the problem , but I
thought tracer class would be sufficient.



On Fri, Nov 11, 2011 at 7:05 AM, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>&gt; wrote:
&gt;<i> Hi Benjamin,
</I>&gt;<i>
</I>&gt;<i> After investigation of our code, I'm now no longer convinced that
</I>&gt;<i> your hangs occur because we haven't trapped the EOFException
</I>&gt;<i> correctly. &#160;We ought to be handling it properly.
</I>&gt;<i>
</I>&gt;<i> I cannot reproduce this problem here, yet.
</I>&gt;<i>
</I>&gt;<i> Could you please do some more investigation for us? &#160;What would
</I>&gt;<i> be helpful is for you to take a java stack dump (use jstack) when
</I>&gt;<i> the hang occurs.
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;jstack -l &lt;pid&gt;
</I>&gt;<i>
</I>&gt;<i> ought to be sufficient, with &lt;pid&gt; the process number of the client JVM.
</I>&gt;<i>
</I>&gt;<i> That will help us to find out what is hung where.
</I>&gt;<i> (It would be most helpful if you could do this on the
</I>&gt;<i> latest release -- RabbitMQ 2.7.0, but an older one is fine.)
</I>&gt;<i>
</I>&gt;<i> Steve Powell
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
</I>&gt;<i> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
</I>&gt;<i>
</I>&gt;<i> On 3 Nov 2011, at 21:40, Benjamin Bennett wrote:
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-November/015980.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-November/015980.html</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016163.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
	<LI>Next message: <A HREF="016191.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of	connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16190">[ date ]</a>
              <a href="thread.html#16190">[ thread ]</a>
              <a href="subject.html#16190">[ subject ]</a>
              <a href="author.html#16190">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
