<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Shovel Connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C4EC9085B.7000009%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016333.html">
   <LINK REL="Next"  HREF="016408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Shovel Connections</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C4EC9085B.7000009%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Shovel Connections">matthias at rabbitmq.com
       </A><BR>
    <I>Sun Nov 20 14:02:03 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016333.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
        <LI>Next message: <A HREF="016408.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16393">[ date ]</a>
              <a href="thread.html#16393">[ thread ]</a>
              <a href="subject.html#16393">[ subject ]</a>
              <a href="author.html#16393">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jelle,

On 17/11/11 13:39, Jelle Smet wrote:
&gt;<i> I still have the same issue going on. Here's a recap:
</I>&gt;<i>
</I>&gt;<i> * I have upgraded to the latest stable (2.7.0) Rabbmitmq on all
</I>&gt;<i> nodes.
</I>&gt;<i> * Messages which should be shoveled to a remote broker stay
</I>&gt;<i> unacknowledged in the queue which Shovel is using as a source.
</I>&gt;<i> * When restarting RabbitMQ containing Shovel after that all messages
</I>&gt;<i> are shoveled correctly to their destination.
</I>&gt;<i> * ack_mode has value &quot;on_confirm&quot;, when changing this to &quot;no_ack&quot; all
</I>&gt;<i> messages get lost.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I must say that it's possible that small network interruptions
</I>&gt;<i> happen, or occasional packetloss occurs... but that doesn't explain
</I>&gt;<i> that restarting Rabbit, makes all messages arrive.
</I>
All the above observations are consistent with the network connection
having gone stale, i.e. there has been a network interruption but the
shovel hasn't noticed that yet. Depending on your OS / network setup it
can take hours for that to happen.

Try configuring heartbeats for the connections, which will allow rabbit
to detect this situation much more promptly. See the shovel readme for
how to do that.

&gt;<i> Here's my complete Shovel configuration
</I>
This looks ok except I'd suggest that you use &quot;<A HREF="amqp://&quot;">amqp://&quot;</A> instead of
&quot;<A HREF="amqp://localhost&quot;.">amqp://localhost&quot;.</A> That way the much more efficient direct connection
is used, which also eliminates any possible network-related issues for
that hop.

&gt;<i> * Restarting RabbitMQ on that moment isn't possible.
</I>
That certainly shouldn't happen. Does 'rabbitmqctl report' work when 
rabbit is in that state? (NB: try running this *before* you attempt to 
stop rabbit).

&gt;<i> Killing is  required, often having to issue &quot;epmd -kill&quot;
</I>
epmd should have nothing to do with this. And killing epmd does not kill 
rabbit. Indeed epmd should refuse to stop if rabbit on that node is 
still running.

Regards,

Matthias.
</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016333.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
	<LI>Next message: <A HREF="016408.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16393">[ date ]</a>
              <a href="thread.html#16393">[ thread ]</a>
              <a href="subject.html#16393">[ subject ]</a>
              <a href="author.html#16393">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
