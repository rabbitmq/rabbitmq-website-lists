<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Failing on restart and recovering queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Failing%20on%20restart%20and%20recovering%20queues&In-Reply-To=%3CCAFAu2w4%3DVgNs5__zGRb_CxPEQyCpZxuaHskkxM8wY7%2BBw4EZWA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016635.html">
   <LINK REL="Next"  HREF="016611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Failing on restart and recovering queues</H1>
    <B>Pierre Payet</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Failing%20on%20restart%20and%20recovering%20queues&In-Reply-To=%3CCAFAu2w4%3DVgNs5__zGRb_CxPEQyCpZxuaHskkxM8wY7%2BBw4EZWA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Failing on restart and recovering queues">amnema at gmail.com
       </A><BR>
    <I>Mon Nov 28 19:20:29 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016635.html">[rabbitmq-discuss] Rabbit Crashing
</A></li>
        <LI>Next message: <A HREF="016611.html">[rabbitmq-discuss] Failing on restart and recovering queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16606">[ date ]</a>
              <a href="thread.html#16606">[ thread ]</a>
              <a href="subject.html#16606">[ subject ]</a>
              <a href="author.html#16606">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am using a persistent queue to store different URL. After a crash of the
Rabbitmq server, I tried to restart it but it get stuck on the step of
recovering the different exchanges, queues and bindings. I have checked in
/msg_store_persistent directory of the node and it seems the data are still
here.

So here little information about my configuration:
I am using Ubuntu 10.04 64-bit and Rabbitmq 2.7.0

Here is a copy of the startup_log :
-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting plugin registry
...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting alarm handler
...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting management agent
...done
starting exchange, queue and binding recovery                         ...


And here is a copy of the crash report on start:
=CRASH REPORT==== 28-Nov-2011::09:09:36 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.155.0&gt;
    registered_name: []
    exception exit: {{badmatch,eof},
                     [{rabbit_queue_index,load_segment,2},
                      {rabbit_queue_index,segment_entries_foldr,3},
                      {rabbit_queue_index,
                          '-queue_index_walker_reader/2-lc$^0/1-0-',4},
                      {rabbit_queue_index,queue_index_walker_reader,2},
                      {worker_pool_worker,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [worker_pool_sup,rabbit_sup,&lt;0.136.0&gt;]
    messages: []
    links: [#Port&lt;0.4788&gt;,&lt;0.151.0&gt;,#Port&lt;0.4724&gt;]
    dictionary: [{{&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at curtiz</A>
/queues/67BZ7QWHYIY1S405V2E0881G9/journal.jif&quot;,
                    fhc_file},
                   {file,1,true}},
                  {{xtype_to_module,topic},rabbit_exchange_type_topic},
                  {{#Ref&lt;0.0.0.556&gt;,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port&lt;0.4724&gt;,15}},
                           0,false,0,infinity,[],true,
                           &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at curtiz</A>
/queues/67BZ7QWHYIY1S405V2E0881G9/journal.jif&quot;,
                           [write,binary,raw,read],
                           [{write_buffer,infinity}],
                           true,true,
                           {1322,500175,181273}}},
                  {worker_pool_worker,true},
                  {{#Ref&lt;0.0.0.79730&gt;,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port&lt;0.4788&gt;,17}},
                           0,false,0,0,[],true,
                           &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at curtiz</A>
/queues/67BZ7QWHYIY1S405V2E0881G9/37.idx&quot;,
                           [{read_ahead,491520},binary,raw,read],
                           [],false,true,
                           {1322,500176,916570}}},
                  {fhc_age_tree,{2,
                                 {{1322,500175,181273},
                                  #Ref&lt;0.0.0.556&gt;,nil,
                                  {{1322,500176,916570},
                                   #Ref&lt;0.0.0.79730&gt;,nil,nil}}}},
                  {{&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at curtiz</A>
/queues/67BZ7QWHYIY1S405V2E0881G9/37.idx&quot;,
                    fhc_file},
                   {file,1,false}}]
    trap_exit: false
    status: running
    heap_size: 514229


And finally the crash report itself:
=SUPERVISOR REPORT==== 23-Nov-2011::17:36:29 ===
     Supervisor: {&lt;0.1220.149&gt;,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,&lt;0.1222.149&gt;},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


Can anyone help me to recover the messages in the queue ?

Payet P
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111128/b72efd90/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111128/b72efd90/attachment.htm</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016635.html">[rabbitmq-discuss] Rabbit Crashing
</A></li>
	<LI>Next message: <A HREF="016611.html">[rabbitmq-discuss] Failing on restart and recovering queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16606">[ date ]</a>
              <a href="thread.html#16606">[ thread ]</a>
              <a href="subject.html#16606">[ subject ]</a>
              <a href="author.html#16606">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
