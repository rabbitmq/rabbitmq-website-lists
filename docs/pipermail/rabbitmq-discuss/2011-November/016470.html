<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20With%20Celery%20Problem%2C%20Error%20541&In-Reply-To=%3C8B2398B7-C209-44B8-9B93-A64EE8E6C935%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016372.html">
   <LINK REL="Next"  HREF="016472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541</H1>
    <B>Ask Solem</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20With%20Celery%20Problem%2C%20Error%20541&In-Reply-To=%3C8B2398B7-C209-44B8-9B93-A64EE8E6C935%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541">ask at rabbitmq.com
       </A><BR>
    <I>Tue Nov 22 16:14:34 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016372.html">[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541
</A></li>
        <LI>Next message: <A HREF="016472.html">[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16470">[ date ]</a>
              <a href="thread.html#16470">[ thread ]</a>
              <a href="subject.html#16470">[ subject ]</a>
              <a href="author.html#16470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 18 Nov 2011, at 18:53, Mike Grouchy wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Okay,
</I>&gt;<i> 
</I>&gt;<i> So I enabled the pool set it to 12 (Seemed like a reasonable number
</I>&gt;<i> for the BROKER_POOL_LIMIT). So I ran the task the first time and it
</I>&gt;<i> seemed like it ran okay. I just got back from lunch and tried to run
</I>&gt;<i> it again to see if maybe enabling the pool fixed the problem, but now
</I>&gt;<i> we seem to have some more datapoints here.
</I>&gt;<i> 
</I>&gt;<i> I have attached the celery log output (from --INFO ) and the rabbitmq.log
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://gist.github.com/81e6f762410e6e4813aa">https://gist.github.com/81e6f762410e6e4813aa</A>
</I>&gt;<i> 
</I>&gt;<i> So it seems like we are running into a too many processes error, but I
</I>&gt;<i> thought the upper bound was around 30K, which I can't imagine I would
</I>&gt;<i> be using (even though, there are around 60k tasks).
</I>&gt;<i> 
</I>&gt;<i> I can't seem to replicate it consistently, which is making it hard to
</I>&gt;<i> narrow down to a specific test case.
</I>

I guess you are running out of erlang processes for the result queues.
The amqp result backend is rather stupid, in that it creates one queue per result.
But this is necessary since the results should be delivered even though
there are no consumers currently waiting for it.

I'd suggest that you either switch to one of the other result backends (redis, database, memcached),

or if you use the results in RPC like calls (the one to retrieve the result
is always the same process as the one that published the task), you could
create your own backend that creates one queue per publisher instead (of course
this will eventually lead to problems too if the number of publishers exceed the process limit).  You could also increase the erlang process limit, the answer how to should be in 
the list archives.
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016372.html">[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541
</A></li>
	<LI>Next message: <A HREF="016472.html">[rabbitmq-discuss] Rabbitmq With Celery Problem, Error 541
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16470">[ date ]</a>
              <a href="thread.html#16470">[ thread ]</a>
              <a href="subject.html#16470">[ subject ]</a>
              <a href="author.html#16470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
