<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] CommandAssembler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20CommandAssembler&In-Reply-To=%3C5D933E69-981D-4588-9478-72658560F29F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016239.html">
   <LINK REL="Next"  HREF="016344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] CommandAssembler</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20CommandAssembler&In-Reply-To=%3C5D933E69-981D-4588-9478-72658560F29F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] CommandAssembler">steve at rabbitmq.com
       </A><BR>
    <I>Thu Nov 17 12:05:54 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016239.html">[rabbitmq-discuss] CommandAssembler
</A></li>
        <LI>Next message: <A HREF="016344.html">[rabbitmq-discuss] CommandAssembler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16328">[ date ]</a>
              <a href="thread.html#16328">[ thread ]</a>
              <a href="subject.html#16328">[ subject ]</a>
              <a href="author.html#16328">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ben,

Yes, it was a conscious decision -- it goes with the concurrency and
thread-safety changes we introduced.  Previously AMQCommand was not thread-safe.
This was partly due to its use of the Assembler inner class, which serially
shared state with the AMQCommand class.  Also, other parts of the implementation
called AMQCommand.Assembler methods.

When re-factoring AMQCommand we extracted CommandAssembler and synchronised on
it.  This allowed us to remove the back reference to AMQCommand from the
assembler, and encapsulate its state. If we expose the object we have problems
with thread-safety and deadlocking again; but I guess exposing the class
wouldn't be a problem.  However, its relationship with the AMQCommand class is
now different, and the use of Assembler is limited entirely to the AMQCommand
class in the new code.

We kept it package private on general principles, and to enforce no leakage into
the public client interface.  In general I am taking the view that the less
visible the internals the harder it is for clients to break them.

Can you explain how you were using Assembler? We would also be interested in how
the com.rabbitmq.client.impl packages are being used in general. As a matter of
long-term intent, the impl classes ought only to be used internally. Though I
know they are pretty well exposed at present.

Thank you for your feedback.
Steve Powell

On 15 Nov 2011, at 12:30, Ben Hood wrote:
&gt;<i> I was wondering whether there was a conscious design choice to reduce
</I>&gt;<i> the visibility of the ported CommandAssembler to default package
</I>&gt;<i> scope?
</I>&gt;<i> 
</I>&gt;<i> We were using the old AMQCommand.Assembler which was public in the
</I>&gt;<i> com.rabbitmq.client.impl namespace.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> Ben
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016239.html">[rabbitmq-discuss] CommandAssembler
</A></li>
	<LI>Next message: <A HREF="016344.html">[rabbitmq-discuss] CommandAssembler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16328">[ date ]</a>
              <a href="thread.html#16328">[ thread ]</a>
              <a href="subject.html#16328">[ subject ]</a>
              <a href="author.html#16328">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
