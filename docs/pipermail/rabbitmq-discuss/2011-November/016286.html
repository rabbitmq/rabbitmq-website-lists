<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer connection closes abruptly after	one message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20connection%20closes%20abruptly%20after%0A%09one%20message&In-Reply-To=%3CCAE3HoVT-QsjETfX1VzrVuOJUwyFURSy9RFbphu2%3DXt8SqjuqdQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016285.html">
   <LINK REL="Next"  HREF="016287.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer connection closes abruptly after	one message</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20connection%20closes%20abruptly%20after%0A%09one%20message&In-Reply-To=%3CCAE3HoVT-QsjETfX1VzrVuOJUwyFURSy9RFbphu2%3DXt8SqjuqdQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Consumer connection closes abruptly after	one message">michael.s.klishin at gmail.com
       </A><BR>
    <I>Wed Nov 16 15:39:08 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016285.html">[rabbitmq-discuss] Consumer connection closes abruptly after one	message
</A></li>
        <LI>Next message: <A HREF="016287.html">[rabbitmq-discuss] Consumer connection closes abruptly after	one message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16286">[ date ]</a>
              <a href="thread.html#16286">[ thread ]</a>
              <a href="subject.html#16286">[ subject ]</a>
              <a href="author.html#16286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2011/11/16 p2w &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tpletch001 at gmail.com</A>&gt;

&gt;<i> I have a rails 3.1 app (using thin server which is Event Machine
</I>&gt;<i> based) using the AMQP gem to connect to two server cluster on EC2. the
</I>&gt;<i> broker is running on ubuntu 11.10 and is version 2.6.1 with erlang
</I>&gt;<i> version 5.8.3.
</I>&gt;<i>
</I>
What application server are you using? If it is something that forks
(Unicorn or Passenger), you need to connect
after that happens. Otherwise only one thread will be inherited (but not
EventMachine's one). This is how fork(2) works, unfortunately.

One more thing you need to do is to set up connection exception handler as
described here:
<A HREF="http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/ErrorHandling.textile">http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/ErrorHandling.textile</A>
-- 
MK

<A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
<A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111116/3a3cda52/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111116/3a3cda52/attachment.htm</A>&gt;
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016285.html">[rabbitmq-discuss] Consumer connection closes abruptly after one	message
</A></li>
	<LI>Next message: <A HREF="016287.html">[rabbitmq-discuss] Consumer connection closes abruptly after	one message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16286">[ date ]</a>
              <a href="thread.html#16286">[ thread ]</a>
              <a href="subject.html#16286">[ subject ]</a>
              <a href="author.html#16286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
