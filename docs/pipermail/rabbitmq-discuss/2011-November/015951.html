<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vXsOczQ2QJAu0oYxyYb-4KByYDLFxynsi7Tg4x1xkrYyA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015930.html">
   <LINK REL="Next"  HREF="015986.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large</H1>
    <B>Cameron Davison</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vXsOczQ2QJAu0oYxyYb-4KByYDLFxynsi7Tg4x1xkrYyA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large">cameron.davison at gmail.com
       </A><BR>
    <I>Wed Nov  2 05:10:21 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015930.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
        <LI>Next message: <A HREF="015986.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15951">[ date ]</a>
              <a href="thread.html#15951">[ thread ]</a>
              <a href="subject.html#15951">[ subject ]</a>
              <a href="author.html#15951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthew,

Thank you for the reply. Do y'all have a bug tracker that I would be
able to watch so that I can know when y'all address this issue? Do you
know if this same thing would be even worse for a mirrored queue
rabbit mq cluster? I am seeing a lot of degradation in write
throughput while reading when doing mirrored queue cluster. All I
really want is high availability such that if one server crashed the
slave in the cluster will become the master and allow for continued
throughput. Is this the correct way to that?

Cameron

On Tue, Nov 1, 2011 at 1:31 AM, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
&gt;<i> Hi Cameron,
</I>&gt;<i>
</I>&gt;<i> Thanks for the detailed report.
</I>&gt;<i>
</I>&gt;<i> Your report has prompted us to think carefully about your test, and we
</I>&gt;<i> can see how the broker can end up behave this way. This is not desired
</I>&gt;<i> behaviour of the broker and thus does constitute a bug. There is no
</I>&gt;<i> work-around.
</I>&gt;<i>
</I>&gt;<i> What is happening is that your publisher is waiting for the broker to
</I>&gt;<i> send the confirms back to it. For this to happen, internally, the queues
</I>&gt;<i> have to send some messages to themselves. These messages are being
</I>&gt;<i> starved out because Rabbit prioritises getting rid of messages. Thus the
</I>&gt;<i> queue's desire to drive the consumer prevents the queue from processing
</I>&gt;<i> internal messages that would lead the queue to issue the confirms back
</I>&gt;<i> up, via the channel and out to the client.
</I>&gt;<i>
</I>&gt;<i> At a minimum, we need to adjust some message priorities internally. But
</I>&gt;<i> the actual fix may turn out to be bigger than that. Given current
</I>&gt;<i> timings, I wouldn't expect a fix for this to be in the next release, but
</I>&gt;<i> in the one after that.
</I>&gt;<i>
</I>&gt;<i> Best wishes,
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015930.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
	<LI>Next message: <A HREF="015986.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15951">[ date ]</a>
              <a href="thread.html#15951">[ thread ]</a>
              <a href="subject.html#15951">[ subject ]</a>
              <a href="author.html#15951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
