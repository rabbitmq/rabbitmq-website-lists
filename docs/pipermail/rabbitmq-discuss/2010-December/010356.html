<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Handling network reliability problems on the publisher side
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handling%20network%20reliability%20problems%20on%20the%0A%20publisher%20side&In-Reply-To=%3C4D063F00.8050300%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010353.html">
   <LINK REL="Next"  HREF="010366.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Handling network reliability problems on the publisher side</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handling%20network%20reliability%20problems%20on%20the%0A%20publisher%20side&In-Reply-To=%3C4D063F00.8050300%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Handling network reliability problems on the publisher side">simon at rabbitmq.com
       </A><BR>
    <I>Mon Dec 13 15:42:56 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010353.html">[rabbitmq-discuss] Handling network reliability problems on the	publisher side
</A></li>
        <LI>Next message: <A HREF="010366.html">[rabbitmq-discuss] Handling network reliability problems on the publisher side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10356">[ date ]</a>
              <a href="thread.html#10356">[ thread ]</a>
              <a href="subject.html#10356">[ subject ]</a>
              <a href="author.html#10356">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/12/10 15:17, Stefan Kaes wrote:
&lt;snip&gt;

&gt;<i> It looks like no programming cleverness on our side can achieve what we
</I>&gt;<i> want: have the publisher block as soon as a message cannot be accepted
</I>&gt;<i> by the intended rabbitmq server, because, as far as we understand the
</I>&gt;<i> amqp protocol, no protocol level acknowledgements are sent which the
</I>&gt;<i> publisher could wait for (and optionally timeout), before sending the
</I>&gt;<i> next message.
</I>&gt;<i>
</I>&gt;<i> This is all fine to achieve high throughput on the publisher side, but
</I>&gt;<i> doesn&#8217;t quite fit our use case. For some messages, we really need to
</I>&gt;<i> make reasonably sure the message has been received by a rabbitmq server,
</I>&gt;<i> before we continue. We could then use timeouts to detect network
</I>&gt;<i> partitioning and buffer messages locally until they can be sent (only if
</I>&gt;<i> none of our three redundant servers can be reached, of course).
</I>
&lt;snip&gt;

&gt;<i>     * is the analysis correct?
</I>
Yes. Publishes are fully async in AMQP.

&gt;<i>     * is the JSON-RPC plugin stable enough to be used in production?
</I>
Interesting question. Our official position is that like all the plugins 
it is &quot;unsupported&quot;. However it's pretty clear that some plugins are 
more supported than others, and JSON-RPC is pretty low down the pecking 
order.

&gt;<i>     * maybe there&#8217;s a better solution available?
</I>
The next release will feature publisher acknowledgements, where Rabbit 
will stream basic.acks back at you (if you ask for that). This sounds 
like exactly what you're looking for.

In the meantime, you could get away with publishing inside a 
transaction. When you commit the transaction, and get commit-ok back, 
you know Rabbit has got the message (and persisted it if it's 
persistent). Unfortunately this imposes a cost per commit - tweak the 
number of publishes per commit to tune performance versus maximum number 
of outstanding messages.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010353.html">[rabbitmq-discuss] Handling network reliability problems on the	publisher side
</A></li>
	<LI>Next message: <A HREF="010366.html">[rabbitmq-discuss] Handling network reliability problems on the publisher side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10356">[ date ]</a>
              <a href="thread.html#10356">[ thread ]</a>
              <a href="subject.html#10356">[ subject ]</a>
              <a href="author.html#10356">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
