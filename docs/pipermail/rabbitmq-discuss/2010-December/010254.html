<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] loadbalancing &amp; failover
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20loadbalancing%20%26%20failover&In-Reply-To=%3CDA5A3E6F-DDF1-416E-BDD4-DC8B6C0BFFEC%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010253.html">
   <LINK REL="Next"  HREF="010256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] loadbalancing &amp; failover</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20loadbalancing%20%26%20failover&In-Reply-To=%3CDA5A3E6F-DDF1-416E-BDD4-DC8B6C0BFFEC%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] loadbalancing &amp; failover">videlalvaro at gmail.com
       </A><BR>
    <I>Tue Dec  7 10:39:37 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010253.html">[rabbitmq-discuss] loadbalancing &amp; failover
</A></li>
        <LI>Next message: <A HREF="010256.html">[rabbitmq-discuss] loadbalancing &amp; failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10254">[ date ]</a>
              <a href="thread.html#10254">[ thread ]</a>
              <a href="subject.html#10254">[ subject ]</a>
              <a href="author.html#10254">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We run a similar setup. 

Regarding the question about all the clients connected to one broker: the problem here is that the queues on the other RabbitMQ won't be drained. 

We have our publishers connecting via the LVS but the consumers are told to specifically connect to one RabbbitMQ or the other to avoid such problem.

Regards,

Alvaro



On Dec 7, 2010, at 6:29 PM, Bruno Thomas wrote:

&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> We have a plateform that uses 2 rabbitmq nodes loadbalanced by a linux
</I>&gt;<i> LVS (ipvsadm) in front. We have ipvsadm configured with persistent
</I>&gt;<i> connections and clients with heartbeat. So far so good.
</I>&gt;<i> 
</I>&gt;<i> After deployment, we generally have half of the clients connected to
</I>&gt;<i> the first node and the other half connected to the second node.
</I>&gt;<i> We tried to stop one node (rabbitmqctl stop_app and start_app). The
</I>&gt;<i> clients are reconnecting rabbitmq cluster, and the LVS sends the
</I>&gt;<i> connections to the node up. So all the clients are connected to the
</I>&gt;<i> second node.
</I>&gt;<i> 
</I>&gt;<i> We have 2 questions :
</I>&gt;<i> 1) when the first node is up, how do you manage to reconnect the
</I>&gt;<i> clients on the two nodes (loadbalancing) ?
</I>&gt;<i> 2) is it a problem if all the clients are connected to one node ?
</I>&gt;<i> 
</I>&gt;<i> Thank you for your anwsers.
</I>&gt;<i> 
</I>&gt;<i> Bruno Thomas
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010253.html">[rabbitmq-discuss] loadbalancing &amp; failover
</A></li>
	<LI>Next message: <A HREF="010256.html">[rabbitmq-discuss] loadbalancing &amp; failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10254">[ date ]</a>
              <a href="thread.html#10254">[ thread ]</a>
              <a href="subject.html#10254">[ subject ]</a>
              <a href="author.html#10254">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
