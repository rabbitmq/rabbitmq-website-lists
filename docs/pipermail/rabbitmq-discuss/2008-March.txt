From 0x6e6562 at gmail.com  Sat Mar  1 00:44:08 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 1 Mar 2008 00:44:08 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<6FD315B0-2A6B-4E44-8C0E-6DBEEDC137A3@gmail.com>
	<C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
Message-ID: <F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>

Michael,

> Of course I don't use java which makes me appreciate you're using  
> AMQP as I'd like to actually use AMQP to get the information :-)


What language are you using BTW?

This was part of the reason to go for async Hessian RPCs over AMQP -  
to remain language neutral.

Ben



From dwischusen at gmail.com  Sat Mar  1 21:55:02 2008
From: dwischusen at gmail.com (Derek Wischusen)
Date: Sat, 1 Mar 2008 16:55:02 -0500
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47C66BFC.4010001@lshift.net>
References: <47A3B5C2.6070100@lshift.net> <15549124.post@talk.nabble.com>
	<47C66BFC.4010001@lshift.net>
Message-ID: <c9e66b9a0803011355qc2b6cf5oaddfd9af6e153aa4@mail.gmail.com>

Hey Tony,

The headers that you have listed probably cover all of the ones that I would
want to see.  I'll add these to the Flex/Flash STOMP client in my next
update.

My only other suggestion/request (which I think you are planning to do)
would be to distribute the STOMP adapter with the main RabbitMQ installer.

Thanks again!

Derek

On Thu, Feb 28, 2008 at 3:08 AM, Tony Garnock-Jones <tonyg at lshift.net>
wrote:

> Hi Derek,
>
> Derek Wischusen wrote:
> > Thank you for creating this adapter.  I just tested it out with the
> > ActionScript (Flash/Flex) Stomp client and everything seemed to work
> quite
> > well.  If anyone is interested, I wrote up a short post about it here:
> > http://flexonrails.net/?p=106.
>
> Awesome post!
>
> > Are you planning on adding any custom AMQP specific extensions to the
> > protocol like ActiveMQ does for JMS (see
> > http://activemq.apache.org/stomp.html)?  It looks like there is already
> one
> > for specifying an exchange. Do you think you might add others?
>
> Yes. I want to keep to the protocol definition as closely as possible,
> but to provide extensions to allow people to use more of the
> AMQP-specific features that are available. You're right about the
> exchange extension. So far, refreshing my memory by looking at the code,
> the extensions are:
>
>  - "virtual-host" and "realm" headers on CONNECT, for exploiting
>    RabbitMQ's implementation of AMQP's authorization features
>  - "exchange" on SEND - if omitted, the default ("") exchange is used
>
> If you have anything in mind you'd like to see added, please let me
> know. I need feedback to decide what direction to take the STOMP adapter
> in.
>
> Regards,
>    Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080301/34fc04ae/attachment.htm 

From dmitriy.samovskiy at cohesiveft.com  Sun Mar  2 22:40:29 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Sun, 02 Mar 2008 16:40:29 -0600
Subject: [rabbitmq-discuss] py-amqplib add-on: non-blocking sockets
Message-ID: <47CB2CDD.3040905@cohesiveft.com>


We put together an add-on for py-amqplib that implements AMQP client with non-blocking
sockets (see NonBlockingConnection class and nbloop() function in nbclient_0_8.py).
nbdemo_receive.py is a demo script, and nbclient.zip includes both nbclient_0_8.py and
nbdemo_receive.py.

There are at least 2 scenarios where non-blocking sockets help, and both are applicable to
consumers:
1) when you want to be able to interrupt consumer's event loop without waiting for a next 
incoming message;
2) when you want to consume messages from multiple brokers (or over multiple connections)
in a single event loop.

I would like to acknowledge Barry Pederson who created py-amqplib library and made it
available to the list (see his original announcement at
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2007-December/000750.html ).

- Dmitriy


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nbclient_0_8.py
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080302/455b87df/attachment.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nbdemo_receive.py
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080302/455b87df/attachment-0001.txt 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: nbclient.zip
Type: application/zip
Size: 4315 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080302/455b87df/attachment.zip 

From chime at mu.dk  Mon Mar  3 10:15:13 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Mon, 3 Mar 2008 11:15:13 +0100
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<6FD315B0-2A6B-4E44-8C0E-6DBEEDC137A3@gmail.com>
	<C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
	<F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>
Message-ID: <FA6C4879-F9DA-4A5D-82AB-7DB2572A9F76@mu.dk>

Ben,

Currently we're using Python.

Yes, I understand and appreciate your use of Hessian to go language  
neutrality. The only reason I have for changing this to something  
human readable is, that it makes it possible for me to use an already  
existing command-line client that is able to send and receive from  
AMQP - and I have this fantasy that most people would have such a  
command-line thingy - and it would be an extremely neat way to do  
almost all communication with the server.

Michael

On Mar 1, 2008, at 1:44 , Ben Hood wrote:

> Michael,
>
>> Of course I don't use java which makes me appreciate you're using
>> AMQP as I'd like to actually use AMQP to get the information :-)
>
>
> What language are you using BTW?
>
> This was part of the reason to go for async Hessian RPCs over AMQP -
> to remain language neutral.
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080303/4ad82085/attachment.bin 

From 0x6e6562 at gmail.com  Mon Mar  3 14:56:48 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 3 Mar 2008 14:56:48 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <FA6C4879-F9DA-4A5D-82AB-7DB2572A9F76@mu.dk>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<6FD315B0-2A6B-4E44-8C0E-6DBEEDC137A3@gmail.com>
	<C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
	<F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>
	<FA6C4879-F9DA-4A5D-82AB-7DB2572A9F76@mu.dk>
Message-ID: <CFA3813A-3341-4A90-83BB-07D2AE7AD890@gmail.com>

Michael,

On 3 Mar 2008, at 10:15, Michael Arnoldus wrote:

> Ben,
>
> Currently we're using Python.
>
> Yes, I understand and appreciate your use of Hessian to go language  
> neutrality. The only reason I have for changing this to something  
> human readable is, that it makes it possible for me to use an  
> already existing command-line client that is able to send and  
> receive from AMQP - and I have this fantasy that most people would  
> have such a command-line thingy - and it would be an extremely neat  
> way to do almost all communication with the server.

I take your point.

Have you considered a layered approach to this problem?

For example:

             
Client                                                                  
Rabbit Server

----------------------------
| Command Line      |
----------------------------
|      CLI Parser          |
----------------------------						  ----------------------------
|  API Method            |						 |     API Invocation     |
----------------------------						  ----------------------------
| Hessian Encoding |    					 | Hessian Decoding |
----------------------------						  ----------------------------
|       AMQP                 | ----------wire--------------> |        
AMQP                 |
----------------------------						  ----------------------------

That way you wouldn't need to write any server-side parsing and  
response generation, and you can piggy back off an already existing  
mechanism.

All you would have to do is create the API definition in Python, but  
this is just copying the Erlang module interface definition to Python.  
All of the marshaling and unmarshaling is done for you.

HTH,

Ben 



From bp at barryp.org  Mon Mar  3 15:46:43 2008
From: bp at barryp.org (Barry Pederson)
Date: Mon, 03 Mar 2008 09:46:43 -0600
Subject: [rabbitmq-discuss] py-amqplib add-on: non-blocking sockets
In-Reply-To: <47CB2CDD.3040905@cohesiveft.com>
References: <47CB2CDD.3040905@cohesiveft.com>
Message-ID: <47CC1D63.3010909@barryp.org>

Dmitriy Samovskiy wrote:
> 
> We put together an add-on for py-amqplib that implements AMQP client 
> with non-blocking
> sockets (see NonBlockingConnection class and nbloop() function in 
> nbclient_0_8.py).
> nbdemo_receive.py is a demo script, and nbclient.zip includes both 
> nbclient_0_8.py and
> nbdemo_receive.py.

Thanks Dmitriy, I've added this to my Mercurial repository 
http://hg.barryp.org/py-amqplib/ and made a couple small tweaks to 
streamline the code a bit.

I'll take a look at factoring out the common code that's in the 
Connection.__init__ and NonBlockingConnection.__init__ methods.

	Barry



From 0x6e6562 at gmail.com  Mon Mar  3 15:53:50 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 3 Mar 2008 15:53:50 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <CFA3813A-3341-4A90-83BB-07D2AE7AD890@gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<6FD315B0-2A6B-4E44-8C0E-6DBEEDC137A3@gmail.com>
	<C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
	<F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>
	<FA6C4879-F9DA-4A5D-82AB-7DB2572A9F76@mu.dk>
	<CFA3813A-3341-4A90-83BB-07D2AE7AD890@gmail.com>
Message-ID: <5445626D-CAAD-4C22-9458-2F28FD8A37FA@gmail.com>

Hi,

Sorry about the last email, my ASCII art wasn't very readable.

Here's an image.

HTH,

Ben

-------------- next part --------------
A non-text attachment was scrubbed...
Name: CLI Layering.png
Type: image/png
Size: 15752 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080303/9276fb35/attachment.png 
-------------- next part --------------


On 3 Mar 2008, at 14:56, Ben Hood wrote:

> Michael,
>
> On 3 Mar 2008, at 10:15, Michael Arnoldus wrote:
>
>> Ben,
>>
>> Currently we're using Python.
>>
>> Yes, I understand and appreciate your use of Hessian to go language  
>> neutrality. The only reason I have for changing this to something  
>> human readable is, that it makes it possible for me to use an  
>> already existing command-line client that is able to send and  
>> receive from AMQP - and I have this fantasy that most people would  
>> have such a command-line thingy - and it would be an extremely neat  
>> way to do almost all communication with the server.
>
> I take your point.
>
> Have you considered a layered approach to this problem?
>
> For example:
>
>            
> Client 
>                                                                   
> Rabbit Server
>
> ----------------------------
> | Command Line      |
> ----------------------------
> |      CLI Parser          |
> ----------------------------						  ----------------------------
> |  API Method            |						 |     API Invocation     |
> ----------------------------						  ----------------------------
> | Hessian Encoding |    					 | Hessian Decoding |
> ----------------------------						  ----------------------------
> |       AMQP                 | ----------wire--------------> |        
> AMQP                 |
> ----------------------------						  ----------------------------
>
> That way you wouldn't need to write any server-side parsing and  
> response generation, and you can piggy back off an already existing  
> mechanism.
>
> All you would have to do is create the API definition in Python, but  
> this is just copying the Erlang module interface definition to  
> Python. All of the marshaling and unmarshaling is done for you.
>
> HTH,
>
> Ben


From chime at mu.dk  Tue Mar  4 11:01:52 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 4 Mar 2008 12:01:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <47C66821.1000104@lshift.net>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
	<47C66821.1000104@lshift.net>
Message-ID: <ABE6A4DB-F818-4118-BBC6-E57E03C7E9CA@mu.dk>

Found the problem.

Among other things we use AMQP/RabbitMQ as a transport for RPC style  
calls. A fast way to implement this was to create a new anonymous  
queue for the expected reply and then send the queue name in the  
'reply to' field. We did and it worked, however we forgot two things:  
1. Destroy the queue after it was used and 2. set the queue to auto- 
delete so if the module actually crashes, the queues gets deleted  
anyway. We have a watch-dog functionality that will ping all our AMQP  
modules, and in case of no reply (over some time) it will kill the  
module and make it restart.

So when we ran out of queues RabbitMQ simply stopped responding,  
causing the watch-dog to kill the AMQP modules, they will restart and  
try again, ....

The result was a heap of clients and a heap of queues.

The fix was 3 things: Set RPC reply queues to auto-delete, destroy  
them actively after use or timeout, modify the watchdog so it wont  
kill anything unless it's actually able to ping itself through AMQP.

Now everything works with a steady queue count.

Thank to Tony for all the help in finding this bug. Your support is  
awesome!!!

Regards,

Michael Arnoldus

On Feb 28, 2008, at 8:52 , Tony Garnock-Jones wrote:

> Hi Michael,
>
> Michael Arnoldus wrote:
>> Yesterday we experienced another problem with RabbitMQ. Possibly  
>> still our own fault, but this time a bit more severe. Suddenly from  
>> out of the blue it was impossible to send a single message through  
>> Rabbit. Even restart of the components connecting to rabbit didn't  
>> help. The erlang process stayed but didn't seem to work. Killing  
>> the beam process helped and everything returned to normal.
>
> This is extremely interesting.
>
> - What architecture are you running on? Is it a Mac?
> - Was the CPU pinned to 100%?
> - Were you able to issue commands at the Erlang prompt in the server?
>
> We are tracking down what we suspect to be a Mac-specific bug in the  
> Erlang runtime that manifests in some corner-cases of socket  
> shutdown - it would be interesting if you have detected the same  
> thing we're chasing. (We are still in the early stages of our  
> investigation - we can't say for sure yet whether it's really a  
> runtime problem.)
>
>> In a log file we had:
>> ERROR    2008-02-26 16:17:32,857   --call got Closed:  
>> Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content =  
>> None
>
> If only the other log files hadn't been stomped on by the broker  
> startup! Your message has prompted us to fix this bad behaviour - we  
> have changed the startup scripts to move existing log files out of  
> the way, keeping the most recent few files.
>
> The INTERNAL_ERROR message is very interesting, because it indicates  
> a real bug in the broker. We don't see it in the case of the Mac bug  
> I mentioned earlier, so you might have found something different.
>
> This is probably the code that ran:
>
> lookup_amqp_exception(Other) ->
>    rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
>    {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.
>
> ... which produces a "Non-AMQP exit reason" message in the log. I'm  
> afraid without that message, we'll have a tough time diagnosing this  
> one.
>
> Regards,
>  Tony

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080304/e520f36a/attachment.bin 

From alexis.richardson at cohesiveft.com  Tue Mar  4 11:42:15 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 4 Mar 2008 11:42:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <ABE6A4DB-F818-4118-BBC6-E57E03C7E9CA@mu.dk>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
	<47C66821.1000104@lshift.net>
	<ABE6A4DB-F818-4118-BBC6-E57E03C7E9CA@mu.dk>
Message-ID: <167204d20803040342r112d4427mb5da373303d4e8f@mail.gmail.com>

Michael

Some of your client code might be useful for creating some of a
management tool.  Might it be separable from your proprietary code,
and sharable in any form?

alexis


On Tue, Mar 4, 2008 at 11:01 AM, Michael Arnoldus <chime at mu.dk> wrote:
> Found the problem.
>
>  Among other things we use AMQP/RabbitMQ as a transport for RPC style
>  calls. A fast way to implement this was to create a new anonymous
>  queue for the expected reply and then send the queue name in the
>  'reply to' field. We did and it worked, however we forgot two things:
>  1. Destroy the queue after it was used and 2. set the queue to auto-
>  delete so if the module actually crashes, the queues gets deleted
>  anyway. We have a watch-dog functionality that will ping all our AMQP
>  modules, and in case of no reply (over some time) it will kill the
>  module and make it restart.
>
>  So when we ran out of queues RabbitMQ simply stopped responding,
>  causing the watch-dog to kill the AMQP modules, they will restart and
>  try again, ....
>
>  The result was a heap of clients and a heap of queues.
>
>  The fix was 3 things: Set RPC reply queues to auto-delete, destroy
>  them actively after use or timeout, modify the watchdog so it wont
>  kill anything unless it's actually able to ping itself through AMQP.
>
>  Now everything works with a steady queue count.
>
>  Thank to Tony for all the help in finding this bug. Your support is
>  awesome!!!
>
>  Regards,
>
>  Michael Arnoldus
>
>
>  On Feb 28, 2008, at 8:52 , Tony Garnock-Jones wrote:
>
>
>
> > Hi Michael,
>  >
>  > Michael Arnoldus wrote:
>  >> Yesterday we experienced another problem with RabbitMQ. Possibly
>  >> still our own fault, but this time a bit more severe. Suddenly from
>  >> out of the blue it was impossible to send a single message through
>  >> Rabbit. Even restart of the components connecting to rabbit didn't
>  >> help. The erlang process stayed but didn't seem to work. Killing
>  >> the beam process helped and everything returned to normal.
>  >
>  > This is extremely interesting.
>  >
>  > - What architecture are you running on? Is it a Mac?
>  > - Was the CPU pinned to 100%?
>  > - Were you able to issue commands at the Erlang prompt in the server?
>  >
>  > We are tracking down what we suspect to be a Mac-specific bug in the
>  > Erlang runtime that manifests in some corner-cases of socket
>  > shutdown - it would be interesting if you have detected the same
>  > thing we're chasing. (We are still in the early stages of our
>  > investigation - we can't say for sure yet whether it's really a
>  > runtime problem.)
>  >
>  >> In a log file we had:
>  >> ERROR    2008-02-26 16:17:32,857   --call got Closed:
>  >> Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content =
>  >> None
>  >
>  > If only the other log files hadn't been stomped on by the broker
>  > startup! Your message has prompted us to fix this bad behaviour - we
>  > have changed the startup scripts to move existing log files out of
>  > the way, keeping the most recent few files.
>  >
>  > The INTERNAL_ERROR message is very interesting, because it indicates
>  > a real bug in the broker. We don't see it in the case of the Mac bug
>  > I mentioned earlier, so you might have found something different.
>  >
>  > This is probably the code that ran:
>  >
>  > lookup_amqp_exception(Other) ->
>  >    rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
>  >    {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.
>  >
>  > ... which produces a "Non-AMQP exit reason" message in the log. I'm
>  > afraid without that message, we'll have a tough time diagnosing this
>  > one.
>  >
>  > Regards,
>  >  Tony
>
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From chime at mu.dk  Tue Mar  4 12:20:55 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 4 Mar 2008 13:20:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <167204d20803040342r112d4427mb5da373303d4e8f@mail.gmail.com>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
	<47C66821.1000104@lshift.net>
	<ABE6A4DB-F818-4118-BBC6-E57E03C7E9CA@mu.dk>
	<167204d20803040342r112d4427mb5da373303d4e8f@mail.gmail.com>
Message-ID: <06FA3CB2-B667-453F-A5FD-4AD34D864F43@mu.dk>

Alexis,

Yes, that might be possible. Not sure what you think would be useful  
though, could you elaborate a bit?

Everything we have done has been done in Python (so far at least) and  
not in erlang - just so you know :-)

Regards,

Michael

On Mar 4, 2008, at 12:42 , Alexis Richardson wrote:

> Michael
>
> Some of your client code might be useful for creating some of a
> management tool.  Might it be separable from your proprietary code,
> and sharable in any form?
>
> alexis
>
>
> On Tue, Mar 4, 2008 at 11:01 AM, Michael Arnoldus <chime at mu.dk> wrote:
>> Found the problem.
>>
>> Among other things we use AMQP/RabbitMQ as a transport for RPC style
>> calls. A fast way to implement this was to create a new anonymous
>> queue for the expected reply and then send the queue name in the
>> 'reply to' field. We did and it worked, however we forgot two things:
>> 1. Destroy the queue after it was used and 2. set the queue to auto-
>> delete so if the module actually crashes, the queues gets deleted
>> anyway. We have a watch-dog functionality that will ping all our AMQP
>> modules, and in case of no reply (over some time) it will kill the
>> module and make it restart.
>>
>> So when we ran out of queues RabbitMQ simply stopped responding,
>> causing the watch-dog to kill the AMQP modules, they will restart and
>> try again, ....
>>
>> The result was a heap of clients and a heap of queues.
>>
>> The fix was 3 things: Set RPC reply queues to auto-delete, destroy
>> them actively after use or timeout, modify the watchdog so it wont
>> kill anything unless it's actually able to ping itself through AMQP.
>>
>> Now everything works with a steady queue count.
>>
>> Thank to Tony for all the help in finding this bug. Your support is
>> awesome!!!
>>
>> Regards,
>>
>> Michael Arnoldus
>>
>>
>> On Feb 28, 2008, at 8:52 , Tony Garnock-Jones wrote:
>>
>>
>>
>>> Hi Michael,
>>>
>>> Michael Arnoldus wrote:
>>>> Yesterday we experienced another problem with RabbitMQ. Possibly
>>>> still our own fault, but this time a bit more severe. Suddenly from
>>>> out of the blue it was impossible to send a single message through
>>>> Rabbit. Even restart of the components connecting to rabbit didn't
>>>> help. The erlang process stayed but didn't seem to work. Killing
>>>> the beam process helped and everything returned to normal.
>>>
>>> This is extremely interesting.
>>>
>>> - What architecture are you running on? Is it a Mac?
>>> - Was the CPU pinned to 100%?
>>> - Were you able to issue commands at the Erlang prompt in the  
>>> server?
>>>
>>> We are tracking down what we suspect to be a Mac-specific bug in the
>>> Erlang runtime that manifests in some corner-cases of socket
>>> shutdown - it would be interesting if you have detected the same
>>> thing we're chasing. (We are still in the early stages of our
>>> investigation - we can't say for sure yet whether it's really a
>>> runtime problem.)
>>>
>>>> In a log file we had:
>>>> ERROR    2008-02-26 16:17:32,857   --call got Closed:
>>>> Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content =
>>>> None
>>>
>>> If only the other log files hadn't been stomped on by the broker
>>> startup! Your message has prompted us to fix this bad behaviour - we
>>> have changed the startup scripts to move existing log files out of
>>> the way, keeping the most recent few files.
>>>
>>> The INTERNAL_ERROR message is very interesting, because it indicates
>>> a real bug in the broker. We don't see it in the case of the Mac bug
>>> I mentioned earlier, so you might have found something different.
>>>
>>> This is probably the code that ran:
>>>
>>> lookup_amqp_exception(Other) ->
>>>   rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
>>>   {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.
>>>
>>> ... which produces a "Non-AMQP exit reason" message in the log. I'm
>>> afraid without that message, we'll have a tough time diagnosing this
>>> one.
>>>
>>> Regards,
>>> Tony
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> -- 
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080304/d970bb10/attachment.bin 

From alexis.richardson at cohesiveft.com  Tue Mar  4 13:39:26 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 4 Mar 2008 13:39:26 +0000
Subject: [rabbitmq-discuss] occasional non-technical email
Message-ID: <167204d20803040539x328b7ff8y5c7ab082493e94d6@mail.gmail.com>

The research team occasionally looks at the bigger picture:
http://www.lshift.net/blog/2008/03/04/rabbit-facts

:-)


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From alexis.richardson at cohesiveft.com  Tue Mar  4 13:41:09 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 4 Mar 2008 13:41:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <06FA3CB2-B667-453F-A5FD-4AD34D864F43@mu.dk>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
	<47C66821.1000104@lshift.net>
	<ABE6A4DB-F818-4118-BBC6-E57E03C7E9CA@mu.dk>
	<167204d20803040342r112d4427mb5da373303d4e8f@mail.gmail.com>
	<06FA3CB2-B667-453F-A5FD-4AD34D864F43@mu.dk>
Message-ID: <167204d20803040541n17394463xcce943aca6f25561@mail.gmail.com>

Michael

Python is perfect.  I was thinking of client use cases for set up,
destroy after time out, etc.  This would be useful for folks like John
I think...

alexis


On Tue, Mar 4, 2008 at 12:20 PM, Michael Arnoldus <chime at mu.dk> wrote:
> Alexis,
>
>  Yes, that might be possible. Not sure what you think would be useful
>  though, could you elaborate a bit?
>
>  Everything we have done has been done in Python (so far at least) and
>  not in erlang - just so you know :-)
>
>  Regards,
>
>  Michael
>
>
>
>  On Mar 4, 2008, at 12:42 , Alexis Richardson wrote:
>
>  > Michael
>  >
>  > Some of your client code might be useful for creating some of a
>  > management tool.  Might it be separable from your proprietary code,
>  > and sharable in any form?
>  >
>  > alexis
>  >
>  >
>  > On Tue, Mar 4, 2008 at 11:01 AM, Michael Arnoldus <chime at mu.dk> wrote:
>  >> Found the problem.
>  >>
>  >> Among other things we use AMQP/RabbitMQ as a transport for RPC style
>  >> calls. A fast way to implement this was to create a new anonymous
>  >> queue for the expected reply and then send the queue name in the
>  >> 'reply to' field. We did and it worked, however we forgot two things:
>  >> 1. Destroy the queue after it was used and 2. set the queue to auto-
>  >> delete so if the module actually crashes, the queues gets deleted
>  >> anyway. We have a watch-dog functionality that will ping all our AMQP
>  >> modules, and in case of no reply (over some time) it will kill the
>  >> module and make it restart.
>  >>
>  >> So when we ran out of queues RabbitMQ simply stopped responding,
>  >> causing the watch-dog to kill the AMQP modules, they will restart and
>  >> try again, ....
>  >>
>  >> The result was a heap of clients and a heap of queues.
>  >>
>  >> The fix was 3 things: Set RPC reply queues to auto-delete, destroy
>  >> them actively after use or timeout, modify the watchdog so it wont
>  >> kill anything unless it's actually able to ping itself through AMQP.
>  >>
>  >> Now everything works with a steady queue count.
>  >>
>  >> Thank to Tony for all the help in finding this bug. Your support is
>  >> awesome!!!
>  >>
>  >> Regards,
>  >>
>  >> Michael Arnoldus
>  >>
>  >>
>  >> On Feb 28, 2008, at 8:52 , Tony Garnock-Jones wrote:
>  >>
>  >>
>  >>
>  >>> Hi Michael,
>  >>>
>  >>> Michael Arnoldus wrote:
>  >>>> Yesterday we experienced another problem with RabbitMQ. Possibly
>  >>>> still our own fault, but this time a bit more severe. Suddenly from
>  >>>> out of the blue it was impossible to send a single message through
>  >>>> Rabbit. Even restart of the components connecting to rabbit didn't
>  >>>> help. The erlang process stayed but didn't seem to work. Killing
>  >>>> the beam process helped and everything returned to normal.
>  >>>
>  >>> This is extremely interesting.
>  >>>
>  >>> - What architecture are you running on? Is it a Mac?
>  >>> - Was the CPU pinned to 100%?
>  >>> - Were you able to issue commands at the Erlang prompt in the
>  >>> server?
>  >>>
>  >>> We are tracking down what we suspect to be a Mac-specific bug in the
>  >>> Erlang runtime that manifests in some corner-cases of socket
>  >>> shutdown - it would be interesting if you have detected the same
>  >>> thing we're chasing. (We are still in the early stages of our
>  >>> investigation - we can't say for sure yet whether it's really a
>  >>> runtime problem.)
>  >>>
>  >>>> In a log file we had:
>  >>>> ERROR    2008-02-26 16:17:32,857   --call got Closed:
>  >>>> Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content =
>  >>>> None
>  >>>
>  >>> If only the other log files hadn't been stomped on by the broker
>  >>> startup! Your message has prompted us to fix this bad behaviour - we
>  >>> have changed the startup scripts to move existing log files out of
>  >>> the way, keeping the most recent few files.
>  >>>
>  >>> The INTERNAL_ERROR message is very interesting, because it indicates
>  >>> a real bug in the broker. We don't see it in the case of the Mac bug
>  >>> I mentioned earlier, so you might have found something different.
>  >>>
>  >>> This is probably the code that ran:
>  >>>
>  >>> lookup_amqp_exception(Other) ->
>  >>>   rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
>  >>>   {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.
>  >>>
>  >>> ... which produces a "Non-AMQP exit reason" message in the log. I'm
>  >>> afraid without that message, we'll have a tough time diagnosing this
>  >>> one.
>  >>>
>  >>> Regards,
>  >>> Tony
>  >>
>  >>
>  >> _______________________________________________
>  >> rabbitmq-discuss mailing list
>  >> rabbitmq-discuss at lists.rabbitmq.com
>  >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >>
>  >>
>  >
>  >
>  >
>  > --
>  > Alexis Richardson
>  > +44 20 7617 7339 (UK)
>  > +44 77 9865 2911 (cell)
>  > +1 650 206 2517 (US)
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From chime at mu.dk  Wed Mar  5 09:19:45 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Wed, 5 Mar 2008 10:19:45 +0100
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <5445626D-CAAD-4C22-9458-2F28FD8A37FA@gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<6FD315B0-2A6B-4E44-8C0E-6DBEEDC137A3@gmail.com>
	<C8DF68D7-CBB5-482A-8E8A-3EFD1CD8254D@mu.dk>
	<F8B802D9-A6D5-4011-BC54-1B043DB9AA83@gmail.com>
	<FA6C4879-F9DA-4A5D-82AB-7DB2572A9F76@mu.dk>
	<CFA3813A-3341-4A90-83BB-07D2AE7AD890@gmail.com>
	<5445626D-CAAD-4C22-9458-2F28FD8A37FA@gmail.com>
Message-ID: <EDA9EBB2-AB42-47A4-892C-42E30028DEB9@mu.dk>

Hi Ben,

No problem - it was actually fairly readable although this is much  
nicer :-)

Yep, I've thought about that and it does make sense. As I quite like  
Hessian that might be the way to go. It wouldn't be to big a problem  
to build into our existing commandline client and it could be part of  
the generic-ish  AMQP framework Alexis has been talking about which we  
maght have the beginnig of.

Michael

On Mar 3, 2008, at 16:53 , Ben Hood wrote:

> Hi,
>
> Sorry about the last email, my ASCII art wasn't very readable.
>
> Here's an image.
>
> HTH,
>
> Ben
>
> <CLI Layering.png>
>
> On 3 Mar 2008, at 14:56, Ben Hood wrote:
>
>> Michael,
>>
>> On 3 Mar 2008, at 10:15, Michael Arnoldus wrote:
>>
>>> Ben,
>>>
>>> Currently we're using Python.
>>>
>>> Yes, I understand and appreciate your use of Hessian to go  
>>> language neutrality. The only reason I have for changing this to  
>>> something human readable is, that it makes it possible for me to  
>>> use an already existing command-line client that is able to send  
>>> and receive from AMQP - and I have this fantasy that most people  
>>> would have such a command-line thingy - and it would be an  
>>> extremely neat way to do almost all communication with the server.
>>
>> I take your point.
>>
>> Have you considered a layered approach to this problem?
>>
>> For example:
>>
>>           
>> Client 
>>                                                                   
>> Rabbit Server
>>
>> ----------------------------
>> | Command Line      |
>> ----------------------------
>> |      CLI Parser          |
>> ----------------------------						  ----------------------------
>> |  API Method            |						 |     API Invocation     |
>> ----------------------------						  ----------------------------
>> | Hessian Encoding |    					 | Hessian Decoding |
>> ----------------------------						  ----------------------------
>> |       AMQP                 | ----------wire-------------->  
>> |       AMQP                 |
>> ----------------------------						  ----------------------------
>>
>> That way you wouldn't need to write any server-side parsing and  
>> response generation, and you can piggy back off an already existing  
>> mechanism.
>>
>> All you would have to do is create the API definition in Python,  
>> but this is just copying the Erlang module interface definition to  
>> Python. All of the marshaling and unmarshaling is done for you.
>>
>> HTH,
>>
>> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080305/9c4fc153/attachment.bin 

From abbaspour_amin at yahoo.com  Fri Mar  7 16:55:11 2008
From: abbaspour_amin at yahoo.com (Amin Abbaspour)
Date: Fri, 7 Mar 2008 08:55:11 -0800 (PST)
Subject: [rabbitmq-discuss] Eralng Client Network Connection Error
Message-ID: <253653.78154.qm@web50603.mail.re2.yahoo.com>

Hi All,

I try to test rabbitmq erlang client. As the documentations says, I run
network test modules and try to connect to a running server (which is the
same version as client recommends). I receive connection error and here is
the log:

----
network_client_test:basic_ack_test...*failed*
::error:{badmatch,
          {error,
              {undef,
                  [{rabbit_framing_channel,
                       finish_reading_method,
                       ['connection.start',<<8,0,...>>]},
                   {amqp_util,decode_method,2},
                   {amqp_network_driver,network_handshake,1},
                   {amqp_network_driver,handshake,2},
                   {amqp_connection,init,1},
                   {gen_server,init_it,...},
                   {proc_lib,...}]}}}
  in function amqp_connection:start/3
  in call from network_client_test:basic_ack_test/0

----

In the server side, I see this log:

----
=INFO REPORT==== 7-Mar-2008::19:57:20 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:45480

=INFO REPORT==== 7-Mar-2008::19:57:20 ===
Connection closed abruptly.

=INFO REPORT==== 7-Mar-2008::19:57:20 ===
closing TCP connection from 127.0.0.1:45480
----

Could you please guide me to fix this problem.

Thanks a lot,
Amin


      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
http://www.yahoo.com/r/hs



From 0x6e6562 at gmail.com  Fri Mar  7 17:29:43 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 7 Mar 2008 17:29:43 +0000
Subject: [rabbitmq-discuss] Eralng Client Network Connection Error
In-Reply-To: <253653.78154.qm@web50603.mail.re2.yahoo.com>
References: <253653.78154.qm@web50603.mail.re2.yahoo.com>
Message-ID: <59BE8923-3549-4C8F-A008-FA18D8EAE8E2@gmail.com>

Amin,

This indicates that the common modules that are provided by the server  
are not on the load path of the client (for example the  
rabbit_framing_channel module).

How are you defining the load path?

BTW, what version of the erlang client are you using? Did you download  
it as a snapshot or did you check it out from the mtn repo?

The reason why I am asking is because  {amqp_util,decode_method,2}  is  
a deprecated method and has long been removed from the current version.

HTH,

Ben

On 7 Mar 2008, at 16:55, Amin Abbaspour wrote:

> Hi All,
>
> I try to test rabbitmq erlang client. As the documentations says, I  
> run
> network test modules and try to connect to a running server (which  
> is the
> same version as client recommends). I receive connection error and  
> here is
> the log:
>
> ----
> network_client_test:basic_ack_test...*failed*
> ::error:{badmatch,
>          {error,
>              {undef,
>                  [{rabbit_framing_channel,
>                       finish_reading_method,
>                       ['connection.start',<<8,0,...>>]},
>                   {amqp_util,decode_method,2},
>                   {amqp_network_driver,network_handshake,1},
>                   {amqp_network_driver,handshake,2},
>                   {amqp_connection,init,1},
>                   {gen_server,init_it,...},
>                   {proc_lib,...}]}}}
>  in function amqp_connection:start/3
>  in call from network_client_test:basic_ack_test/0
>
> ----
>
> In the server side, I see this log:
>
> ----
> =INFO REPORT==== 7-Mar-2008::19:57:20 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:45480
>
> =INFO REPORT==== 7-Mar-2008::19:57:20 ===
> Connection closed abruptly.
>
> =INFO REPORT==== 7-Mar-2008::19:57:20 ===
> closing TCP connection from 127.0.0.1:45480
> ----
>
> Could you please guide me to fix this problem.
>
> Thanks a lot,
> Amin
>
>
>       
> ____________________________________________________________________________________
> Never miss a thing.  Make Yahoo your home page.
> http://www.yahoo.com/r/hs
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From codewalkerjoe at gmail.com  Sat Mar  8 08:01:24 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Sat, 8 Mar 2008 03:01:24 -0500
Subject: [rabbitmq-discuss] suggestions on tools to stress test
	rabbitmq-server
Message-ID: <50ec7a2e0803080001n36681b61i6a805467d49e441a@mail.gmail.com>

What kind of tools do you guys use to stress test RabbitMQ server?

joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080308/85c6daf6/attachment.htm 

From wvanheemstra at xs4all.nl  Sat Mar  8 08:29:10 2008
From: wvanheemstra at xs4all.nl (Willem van Heemstra)
Date: Sat, 8 Mar 2008 08:29:10 +0000
Subject: [rabbitmq-discuss] suggestions on tools to stress test
	rabbitmq-server
In-Reply-To: <50ec7a2e0803080001n36681b61i6a805467d49e441a@mail.gmail.com>
References: <50ec7a2e0803080001n36681b61i6a805467d49e441a@mail.gmail.com>
Message-ID: <617A8B0A-F562-4AF6-B893-08405AF6FFAF@xs4all.nl>

a carrot ;o)

Willem

On 8 Mar 2008, at 08:01, joe lee wrote:

> What kind of tools do you guys use to stress test RabbitMQ server?
>
> joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From alexis.richardson at cohesiveft.com  Sat Mar  8 10:43:52 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 8 Mar 2008 10:43:52 +0000
Subject: [rabbitmq-discuss] suggestions on tools to stress test
	rabbitmq-server
In-Reply-To: <50ec7a2e0803080001n36681b61i6a805467d49e441a@mail.gmail.com>
References: <50ec7a2e0803080001n36681b61i6a805467d49e441a@mail.gmail.com>
Message-ID: <167204d20803080243q69a7df38w999e443d19d7070b@mail.gmail.com>

Joe

We used some of the RabbitMQ clients described in the attached.  These
are ok for many test cases and I recommend that you try them. However
the Java clients can only handle so much work.  When we tested really
heavy loads with Intel a few months ago, we used a C client.

alexis



On Sat, Mar 8, 2008 at 8:01 AM, joe lee <codewalkerjoe at gmail.com> wrote:
> What kind of tools do you guys use to stress test RabbitMQ server?
>
> joe
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ_ SimplePerformanceTests.pdf
Type: application/pdf
Size: 86875 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080308/333e93b3/attachment.pdf 

From alexis.richardson at cohesiveft.com  Sat Mar  8 12:52:44 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 8 Mar 2008 12:52:44 +0000
Subject: [rabbitmq-discuss] some fun work from the Erlang community
Message-ID: <167204d20803080452t1cd4071ai30de8ac53acdddc8@mail.gmail.com>

Hi,

Normally I would prefer this list to be about RabbitMQ, but here is
something from the world of Erlang that I thought was pretty cool:

http://www.rsaccon.com/2008/03/erlang-and-fuse.html

It is about an implementation of FUSE that is written in Erlang.  The
goal of fuserl is a distributed filesystem based on mnesia.  Some use
cases are mentioned.

alexis




-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From abbaspour_amin at yahoo.com  Sun Mar  9 09:19:15 2008
From: abbaspour_amin at yahoo.com (Amin Abbaspour)
Date: Sun, 9 Mar 2008 01:19:15 -0800 (PST)
Subject: [rabbitmq-discuss] Eralng Client Network Connection Error
Message-ID: <935326.60127.qm@web50606.mail.re2.yahoo.com>

Hi All,

I try to test rabbitmq erlang client. As the documentations says, I run 
network test modules and try to connect to a running server (which is the
same version as client recommends). I receive connection error and here is
the log:
 
----
network_client_test:basic_ack_test...*failed*
::error:{badmatch,
          {error,
              {undef,
                  [{rabbit_framing_channel,
                       finish_reading_method,
                       ['connection.start',<<8,0,...>>]},
                   {amqp_util,decode_method,2},
                   {amqp_network_driver,network_handshake,1},
                   {amqp_network_driver,handshake,2},
                   {amqp_connection,init,1},
                   {gen_server,init_it,...},
                   {proc_lib,...}]}}}
  in function amqp_connection:start/3
  in call from network_client_test:basic_ack_test/0

----

In the server side, I see this log:

----
=INFO REPORT==== 7-Mar-2008::19:57:20 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:45480

=INFO REPORT==== 7-Mar-2008::19:57:20 ===
Connection closed abruptly.

=INFO REPORT==== 7-Mar-2008::19:57:20 ===
closing TCP connection from 127.0.0.1:45480
----

Could you please guide me to fix this problem.

Thanks a lot,
Amin



      ____________________________________________________________________________________
Looking for last minute shopping deals?  
Find them fast with Yahoo! Search.  http://tools.search.yahoo.com/newsearch/category.php?category=shopping



From alexis.richardson at cohesiveft.com  Sun Mar  9 09:28:33 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sun, 9 Mar 2008 09:28:33 +0000
Subject: [rabbitmq-discuss] Eralng Client Network Connection Error
In-Reply-To: <935326.60127.qm@web50606.mail.re2.yahoo.com>
References: <935326.60127.qm@web50606.mail.re2.yahoo.com>
Message-ID: <167204d20803090128s35712fc5t50443e6b2ea96204@mail.gmail.com>

Amin

I think Ben Hood answered this - perhaps you did not get his reply
email, so I shall repost it below.  Let us know if this helps!

alexis

---

Amin,

This indicates that the common modules that are provided by the server
are not on the load path of the client (for example the
rabbit_framing_channel module).

How are you defining the load path?

BTW, what version of the erlang client are you using? Did you download
it as a snapshot or did you check it out from the mtn repo?

The reason why I am asking is because  {amqp_util,decode_method,2}  is
a deprecated method and has long been removed from the current version.

HTH,

Ben



On Sun, Mar 9, 2008 at 9:19 AM, Amin Abbaspour <abbaspour_amin at yahoo.com> wrote:
> Hi All,
>
>  I try to test rabbitmq erlang client. As the documentations says, I run
>  network test modules and try to connect to a running server (which is the
>  same version as client recommends). I receive connection error and here is
>  the log:
>
>  ----
>  network_client_test:basic_ack_test...*failed*
>  ::error:{badmatch,
>           {error,
>               {undef,
>                   [{rabbit_framing_channel,
>                        finish_reading_method,
>                        ['connection.start',<<8,0,...>>]},
>                    {amqp_util,decode_method,2},
>                    {amqp_network_driver,network_handshake,1},
>                    {amqp_network_driver,handshake,2},
>                    {amqp_connection,init,1},
>                    {gen_server,init_it,...},
>                    {proc_lib,...}]}}}
>   in function amqp_connection:start/3
>   in call from network_client_test:basic_ack_test/0
>
>  ----
>
>  In the server side, I see this log:
>
>  ----
>  =INFO REPORT==== 7-Mar-2008::19:57:20 ===
>  accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:45480
>
>  =INFO REPORT==== 7-Mar-2008::19:57:20 ===
>  Connection closed abruptly.
>
>  =INFO REPORT==== 7-Mar-2008::19:57:20 ===
>  closing TCP connection from 127.0.0.1:45480
>  ----
>
>  Could you please guide me to fix this problem.
>
>  Thanks a lot,
>  Amin
>
>
>
>       ____________________________________________________________________________________
>  Looking for last minute shopping deals?
>  Find them fast with Yahoo! Search.  http://tools.search.yahoo.com/newsearch/category.php?category=shopping
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From codewalkerjoe at gmail.com  Mon Mar 10 17:06:17 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Mon, 10 Mar 2008 13:06:17 -0400
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
Message-ID: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>

Hi,

I just checked out rabbitmq client, using rabbitmq-server 1.2.0 with
cotton-0.2.3.tar.gz which supports hessian 2.0.

I was following this blog tutorial:
http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.htmland
for whatever reason, rabbitmq-server is not accepting the client
connection.

My rabbitmq-server uses all default values for user "guest" and password
"guest".  I haven't made any changes.  I started the rabbitmq server with
/usr/sbin/rabbitmq-server and aborted the erlang node to stop the rabbitmq
server.  This causes problem during restart.  I get an error such as mnesia
table timeout.  More likely this is occuring during mnesia trying to recover
the tables.

Back to erlang client connection problem:

1> blog_example_1:amqp_lifecycle().
Connection: {<0.190.0>,direct}

=ERROR REPORT==== 9-Mar-2008::21:56:53 ===
** Generic server <0.190.0> terminating
** Last message in was {direct,none,<<>>}
** When Server state == {connection_state,"guest","guest",undefined,
                            undefined,<<"/">>,undefined,undefined,undefined,
                            undefined,undefined,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}
** Reason for termination ==
** {'function not exported',
       [{rabbit_channel,start_link,
            [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
        {amqp_direct_driver,open_channel,3},
        {amqp_connection,handle_start,5},
        {gen_server,handle_msg,5},
        {proc_lib,init_p,5}]}

=CRASH REPORT==== 9-Mar-2008::21:56:53 ===
  crasher:
    pid: <0.190.0>
    registered_name: []
    exception exit: {undef,
                        [{rabbit_channel,start_link,
                             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
                         {amqp_direct_driver,open_channel,3},
                         {amqp_connection,handle_start,5},
                         {gen_server,handle_msg,5},
                         {proc_lib,init_p,5}]}
      in function  gen_server:terminate/6
    initial call: gen:init_it(gen_server,<0.40.0>,<0.40.0>,amqp_connection,
                              [{connection_state,"guest","guest",undefined,
                                   undefined,<<"/">>,undefined,undefined,
                                   undefined,undefined,undefined,
                                   {dict,0,16,16,8,80,48,
                                       {[],[],[],[],[],[],[],[],[],[],[],[],
                                        [],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],
                                         [],[],[],[]}}}},
                               #Fun<amqp_direct_driver.handshake.1>],
                              [])
    ancestors: [<0.40.0>]
    messages: []
    links: [<0.40.0>,<0.191.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 377
    stack_size: 23
    reductions: 451
  neighbours:
    neighbour: [{pid,<0.191.0>},
                  {registered_name,[]},
                  {initial_call,
                      {gen,init_it,
                          [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
                           [{channel_state,1,<0.190.0>,undefined,undefined,
                                #Fun<amqp_direct_driver.do.2>,
                                #Fun<amqp_direct_driver.do.3>,undefined,
                                undefined,false,undefined,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}}}],
                           []]}},
                  {current_function,{gen_server,loop,6}},
                  {ancestors,[<0.190.0>,<0.40.0>]},
                  {messages,[]},
                  {links,[<0.190.0>]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,233},
                  {stack_size,12},
                  {reductions,39}]
    neighbour: [{pid,<0.40.0>},
                  {registered_name,[]},
                  {initial_call,{erlang,apply,2}},
                  {current_function,{gen,wait_resp_mon,3}},
                  {ancestors,[]},
                  {messages,[]},
                  {links,[<0.25.0>,<0.190.0>]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,1597},
                  {stack_size,38},
                  {reductions,1282}]
** exception exit: undef
     in function  rabbit_channel:start_link/4
        called as rabbit_channel:start_link(<0.191.0>,<0.191.0>,<<"guest">>,
                                            <<"/">>)
     in call from amqp_direct_driver:open_channel/3
     in call from amqp_connection:handle_start/5
     in call from gen_server:handle_msg/5
     in call from proc_lib:init_p/5


any help greatly appreciated,
joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080310/69c6005d/attachment.htm 

From 0x6e6562 at gmail.com  Mon Mar 10 17:16:40 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 10 Mar 2008 17:16:40 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
In-Reply-To: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
References: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
Message-ID: <ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>

Hi Joe,

The blog post uses this snapshot version of Rabbit server: http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq_200712231455.tar.gz 
, not the released 1.2.0 version.

In this version, the function start_link in rabbit_channel was  
exported for the first time, as part of client and server refactoring.

This is why you are getting a 'function not exported' error.

I would even suggest downloading the latest published snapshot of the  
server, as this is what the latest version of the client has been  
tested against.

HTH,

Ben


On 10 Mar 2008, at 17:06, joe lee wrote:

> Hi,
>
> I just checked out rabbitmq client, using rabbitmq-server 1.2.0 with  
> cotton-0.2.3.tar.gz which supports hessian 2.0.
>
> I was following this blog tutorial: http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html 
>  and for whatever reason, rabbitmq-server is not accepting the  
> client connection.
>
> My rabbitmq-server uses all default values for user "guest" and  
> password "guest".  I haven't made any changes.  I started the  
> rabbitmq server with /usr/sbin/rabbitmq-server and aborted the  
> erlang node to stop the rabbitmq server.  This causes problem during  
> restart.  I get an error such as mnesia table timeout.  More likely  
> this is occuring during mnesia trying to recover the tables.
>
> Back to erlang client connection problem:
>
> 1> blog_example_1:amqp_lifecycle().
> Connection: {<0.190.0>,direct}
>
> =ERROR REPORT==== 9-Mar-2008::21:56:53 ===
> ** Generic server <0.190.0> terminating
> ** Last message in was {direct,none,<<>>}
> ** When Server state == {connection_state,"guest","guest",undefined,
>                              
> undefined,<<"/">>,undefined,undefined,undefined,
>                             undefined,undefined,
>                             {dict,0,16,16,8,80,48,
>                                 {[],[],[],[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                   [],[]}}}}
> ** Reason for termination ==
> ** {'function not exported',
>        [{rabbit_channel,start_link,
>             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>         {amqp_direct_driver,open_channel,3},
>         {amqp_connection,handle_start,5},
>         {gen_server,handle_msg,5},
>         {proc_lib,init_p,5}]}
>
> =CRASH REPORT==== 9-Mar-2008::21:56:53 ===
>   crasher:
>     pid: <0.190.0>
>     registered_name: []
>     exception exit: {undef,
>                         [{rabbit_channel,start_link,
>                               
> [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>                          {amqp_direct_driver,open_channel,3},
>                          {amqp_connection,handle_start,5},
>                          {gen_server,handle_msg,5},
>                          {proc_lib,init_p,5}]}
>       in function  gen_server:terminate/6
>     initial call:  
> gen:init_it(gen_server,<0.40.0>,<0.40.0>,amqp_connection,
>                                
> [{connection_state,"guest","guest",undefined,
>                                     
> undefined,<<"/">>,undefined,undefined,
>                                    undefined,undefined,undefined,
>                                    {dict,0,16,16,8,80,48,
>                                        {[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                         [],[],[],[]},
>                                        {{[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                          [],[],[],[]}}}},
>                                #Fun<amqp_direct_driver.handshake.1>],
>                               [])
>     ancestors: [<0.40.0>]
>     messages: []
>     links: [<0.40.0>,<0.191.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 377
>     stack_size: 23
>     reductions: 451
>   neighbours:
>     neighbour: [{pid,<0.191.0>},
>                   {registered_name,[]},
>                   {initial_call,
>                       {gen,init_it,
>                            
> [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
>                            [{channel_state, 
> 1,<0.190.0>,undefined,undefined,
>                                 #Fun<amqp_direct_driver.do.2>,
>                                 #Fun<amqp_direct_driver.do. 
> 3>,undefined,
>                                 undefined,false,undefined,
>                                 {dict,0,16,16,8,80,48,
>                                     {[],[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                      [],[],[]},
>                                     {{[],[],[],[],[],[],[],[],[],[], 
> [],[],[],
>                                       [],[],[]}}}}],
>                            []]}},
>                   {current_function,{gen_server,loop,6}},
>                   {ancestors,[<0.190.0>,<0.40.0>]},
>                   {messages,[]},
>                   {links,[<0.190.0>]},
>                   {dictionary,[]},
>                   {trap_exit,false},
>                   {status,waiting},
>                   {heap_size,233},
>                   {stack_size,12},
>                   {reductions,39}]
>     neighbour: [{pid,<0.40.0>},
>                   {registered_name,[]},
>                   {initial_call,{erlang,apply,2}},
>                   {current_function,{gen,wait_resp_mon,3}},
>                   {ancestors,[]},
>                   {messages,[]},
>                   {links,[<0.25.0>,<0.190.0>]},
>                   {dictionary,[]},
>                   {trap_exit,false},
>                   {status,waiting},
>                   {heap_size,1597},
>                   {stack_size,38},
>                   {reductions,1282}]
> ** exception exit: undef
>      in function  rabbit_channel:start_link/4
>         called as  
> rabbit_channel:start_link(<0.191.0>,<0.191.0>,<<"guest">>,
>                                             <<"/">>)
>      in call from amqp_direct_driver:open_channel/3
>      in call from amqp_connection:handle_start/5
>      in call from gen_server:handle_msg/5
>      in call from proc_lib:init_p/5
>
>
> any help greatly appreciated,
> joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080310/931b928c/attachment.htm 

From alexis.richardson at cohesiveft.com  Tue Mar 11 17:39:10 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 11 Mar 2008 17:39:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Scala/Lift
Message-ID: <167204d20803111039ye6cf04fi75f39bfcea2abdbb@mail.gmail.com>

Hi,

Some of you may have seen David and Steve talking about Scala and Lift
on here.  You can use these with RabbitMQ for building web apps that
use messaging.  David is interviewed in InfoQ here:

http://www.infoq.com/news/2008/03/liftweb

alexis


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From codewalkerjoe at gmail.com  Wed Mar 12 02:48:09 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Tue, 11 Mar 2008 22:48:09 -0400
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
In-Reply-To: <ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>
References: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
	<ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>
Message-ID: <50ec7a2e0803111948k36a6421k9e5e7fdd475f8e3d@mail.gmail.com>

Hey Ben,

I went to this url: http://dev.rabbitmq.com/viewmtn/ and not sure which one
to checkout.  Any suggestions?

Joe

On Mon, Mar 10, 2008 at 1:16 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Hi Joe,
>
> The blog post uses this snapshot version of Rabbit server:
> http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq_200712231455.tar.gz,
> not the released 1.2.0 version.
>
> In this version, the function start_link in rabbit_channel was exported
> for the first time, as part of client and server refactoring.
>
> This is why you are getting a 'function not exported' error.
>
> I would even suggest downloading the latest published snapshot of the
> server, as this is what the latest version of the client has been tested
> against.
>
> HTH,
>
> Ben
>
>
> On 10 Mar 2008, at 17:06, joe lee wrote:
>
> Hi,
>
> I just checked out rabbitmq client, using rabbitmq-server 1.2.0 with
> cotton-0.2.3.tar.gz which supports hessian 2.0.
>
> I was following this blog tutorial:
> http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.htmland for whatever reason, rabbitmq-server is not accepting the client
> connection.
>
> My rabbitmq-server uses all default values for user "guest" and password
> "guest".  I haven't made any changes.  I started the rabbitmq server with
> /usr/sbin/rabbitmq-server and aborted the erlang node to stop the rabbitmq
> server.  This causes problem during restart.  I get an error such as mnesia
> table timeout.  More likely this is occuring during mnesia trying to recover
> the tables.
>
> Back to erlang client connection problem:
>
> 1> blog_example_1:amqp_lifecycle().
> Connection: {<0.190.0>,direct}
>
> =ERROR REPORT==== 9-Mar-2008::21:56:53 ===
> ** Generic server <0.190.0> terminating
> ** Last message in was {direct,none,<<>>}
> ** When Server state == {connection_state,"guest","guest",undefined,
>
> undefined,<<"/">>,undefined,undefined,undefined,
>                             undefined,undefined,
>                             {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}}}
> ** Reason for termination ==
> ** {'function not exported',
>        [{rabbit_channel,start_link,
>             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>         {amqp_direct_driver,open_channel,3},
>         {amqp_connection,handle_start,5},
>         {gen_server,handle_msg,5},
>         {proc_lib,init_p,5}]}
>
> =CRASH REPORT==== 9-Mar-2008::21:56:53 ===
>   crasher:
>     pid: <0.190.0>
>     registered_name: []
>     exception exit: {undef,
>                         [{rabbit_channel,start_link,
>                              [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>                          {amqp_direct_driver,open_channel,3},
>                          {amqp_connection,handle_start,5},
>                          {gen_server,handle_msg,5},
>                          {proc_lib,init_p,5}]}
>       in function  gen_server:terminate/6
>     initial call: gen:init_it(gen_server,<0.40.0>,<0.40.0
> >,amqp_connection,
>
> [{connection_state,"guest","guest",undefined,
>                                    undefined,<<"/">>,undefined,undefined,
>                                    undefined,undefined,undefined,
>                                    {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],
>                                         [],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                          [],[],[],[]}}}},
>                                #Fun<amqp_direct_driver.handshake.1>],
>                               [])
>     ancestors: [<0.40.0>]
>     messages: []
>     links: [<0.40.0>,<0.191.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 377
>     stack_size: 23
>     reductions: 451
>   neighbours:
>     neighbour: [{pid,<0.191.0>},
>                   {registered_name,[]},
>                   {initial_call,
>                       {gen,init_it,
>                           [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
>                            [{channel_state,1,<0.190.0
> >,undefined,undefined,
>                                 #Fun<amqp_direct_driver.do.2>,
>                                 #Fun<amqp_direct_driver.do.3>,undefined,
>                                 undefined,false,undefined,
>                                 {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}}}],
>                            []]}},
>                   {current_function,{gen_server,loop,6}},
>                   {ancestors,[<0.190.0>,<0.40.0>]},
>                   {messages,[]},
>                   {links,[<0.190.0>]},
>                   {dictionary,[]},
>                   {trap_exit,false},
>                   {status,waiting},
>                   {heap_size,233},
>                   {stack_size,12},
>                   {reductions,39}]
>     neighbour: [{pid,<0.40.0>},
>                   {registered_name,[]},
>                   {initial_call,{erlang,apply,2}},
>                   {current_function,{gen,wait_resp_mon,3}},
>                   {ancestors,[]},
>                   {messages,[]},
>                   {links,[<0.25.0>,<0.190.0>]},
>                   {dictionary,[]},
>                   {trap_exit,false},
>                   {status,waiting},
>                   {heap_size,1597},
>                   {stack_size,38},
>                   {reductions,1282}]
> ** exception exit: undef
>      in function  rabbit_channel:start_link/4
>         called as rabbit_channel:start_link(<0.191.0>,<0.191.0
> >,<<"guest">>,
>                                             <<"/">>)
>      in call from amqp_direct_driver:open_channel/3
>      in call from amqp_connection:handle_start/5
>      in call from gen_server:handle_msg/5
>      in call from proc_lib:init_p/5
>
>
> any help greatly appreciated,
> joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080311/d5a2b69a/attachment.htm 

From 0x6e6562 at gmail.com  Wed Mar 12 08:09:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 12 Mar 2008 08:09:23 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
In-Reply-To: <50ec7a2e0803111948k36a6421k9e5e7fdd475f8e3d@mail.gmail.com>
References: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
	<ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>
	<50ec7a2e0803111948k36a6421k9e5e7fdd475f8e3d@mail.gmail.com>
Message-ID: <5CAFF67C-6A15-47A1-9BBA-7A31B9979BEA@gmail.com>

Hi Joe,

The version of the client used in the blog can be accessed as a  
tarball via this URL: http://dev.rabbitmq.com/viewmtn/revision/tar/7e281d11727fd3392033eb16facb2a391506d3b1

In general, you can browse the Erlang client branch with this URL: http://dev.rabbitmq.com/viewmtn/branch/changes/com.rabbitmq.erlang-client

You can then use viewmtn to select the latest revision and download it  
as a tarball.

HTH,

Ben

On 12 Mar 2008, at 02:48, joe lee wrote:

> Hey Ben,
>
> I went to this url: http://dev.rabbitmq.com/viewmtn/ and not sure  
> which one to checkout.  Any suggestions?
>
> Joe
>
> On Mon, Mar 10, 2008 at 1:16 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Hi Joe,
>
> The blog post uses this snapshot version of Rabbit server: http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq_200712231455.tar.gz 
> , not the released 1.2.0 version.
>
> In this version, the function start_link in rabbit_channel was  
> exported for the first time, as part of client and server refactoring.
>
> This is why you are getting a 'function not exported' error.
>
> I would even suggest downloading the latest published snapshot of  
> the server, as this is what the latest version of the client has  
> been tested against.
>
> HTH,
>
> Ben
>
>
> On 10 Mar 2008, at 17:06, joe lee wrote:
>
>> Hi,
>>
>> I just checked out rabbitmq client, using rabbitmq-server 1.2.0  
>> with cotton-0.2.3.tar.gz which supports hessian 2.0.
>>
>> I was following this blog tutorial: http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html 
>>  and for whatever reason, rabbitmq-server is not accepting the  
>> client connection.
>>
>> My rabbitmq-server uses all default values for user "guest" and  
>> password "guest".  I haven't made any changes.  I started the  
>> rabbitmq server with /usr/sbin/rabbitmq-server and aborted the  
>> erlang node to stop the rabbitmq server.  This causes problem  
>> during restart.  I get an error such as mnesia table timeout.  More  
>> likely this is occuring during mnesia trying to recover the tables.
>>
>> Back to erlang client connection problem:
>>
>> 1> blog_example_1:amqp_lifecycle().
>> Connection: {<0.190.0>,direct}
>>
>> =ERROR REPORT==== 9-Mar-2008::21:56:53 ===
>> ** Generic server <0.190.0> terminating
>> ** Last message in was {direct,none,<<>>}
>> ** When Server state == {connection_state,"guest","guest",undefined,
>>                              
>> undefined,<<"/">>,undefined,undefined,undefined,
>>                             undefined,undefined,
>>                             {dict,0,16,16,8,80,48,
>>                                 {[],[],[],[],[],[],[],[],[],[],[], 
>> [],[],[],[],
>>                                  []},
>>                                 {{[],[],[],[],[],[],[],[],[],[],[], 
>> [],[],[],
>>                                   [],[]}}}}
>> ** Reason for termination ==
>> ** {'function not exported',
>>        [{rabbit_channel,start_link,
>>             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>>         {amqp_direct_driver,open_channel,3},
>>         {amqp_connection,handle_start,5},
>>         {gen_server,handle_msg,5},
>>         {proc_lib,init_p,5}]}
>>
>> =CRASH REPORT==== 9-Mar-2008::21:56:53 ===
>>   crasher:
>>     pid: <0.190.0>
>>     registered_name: []
>>     exception exit: {undef,
>>                         [{rabbit_channel,start_link,
>>                               
>> [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>>                          {amqp_direct_driver,open_channel,3},
>>                          {amqp_connection,handle_start,5},
>>                          {gen_server,handle_msg,5},
>>                          {proc_lib,init_p,5}]}
>>       in function  gen_server:terminate/6
>>     initial call:  
>> gen:init_it(gen_server,<0.40.0>,<0.40.0>,amqp_connection,
>>                                
>> [{connection_state,"guest","guest",undefined,
>>                                     
>> undefined,<<"/">>,undefined,undefined,
>>                                    undefined,undefined,undefined,
>>                                    {dict,0,16,16,8,80,48,
>>                                        {[],[],[],[],[],[],[],[],[], 
>> [],[],[],
>>                                         [],[],[],[]},
>>                                        {{[],[],[],[],[],[],[],[],[], 
>> [],[],[],
>>                                          [],[],[],[]}}}},
>>                                #Fun<amqp_direct_driver.handshake.1>],
>>                               [])
>>     ancestors: [<0.40.0>]
>>     messages: []
>>     links: [<0.40.0>,<0.191.0>]
>>     dictionary: []
>>     trap_exit: true
>>     status: running
>>     heap_size: 377
>>     stack_size: 23
>>     reductions: 451
>>   neighbours:
>>     neighbour: [{pid,<0.191.0>},
>>                   {registered_name,[]},
>>                   {initial_call,
>>                       {gen,init_it,
>>                            
>> [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
>>                            [{channel_state, 
>> 1,<0.190.0>,undefined,undefined,
>>                                 #Fun<amqp_direct_driver.do.2>,
>>                                 #Fun<amqp_direct_driver.do. 
>> 3>,undefined,
>>                                 undefined,false,undefined,
>>                                 {dict,0,16,16,8,80,48,
>>                                     {[],[],[],[],[],[],[],[],[],[], 
>> [],[],[],
>>                                      [],[],[]},
>>                                     {{[],[],[],[],[],[],[],[],[],[], 
>> [],[],[],
>>                                       [],[],[]}}}}],
>>                            []]}},
>>                   {current_function,{gen_server,loop,6}},
>>                   {ancestors,[<0.190.0>,<0.40.0>]},
>>                   {messages,[]},
>>                   {links,[<0.190.0>]},
>>                   {dictionary,[]},
>>                   {trap_exit,false},
>>                   {status,waiting},
>>                   {heap_size,233},
>>                   {stack_size,12},
>>                   {reductions,39}]
>>     neighbour: [{pid,<0.40.0>},
>>                   {registered_name,[]},
>>                   {initial_call,{erlang,apply,2}},
>>                   {current_function,{gen,wait_resp_mon,3}},
>>                   {ancestors,[]},
>>                   {messages,[]},
>>                   {links,[<0.25.0>,<0.190.0>]},
>>                   {dictionary,[]},
>>                   {trap_exit,false},
>>                   {status,waiting},
>>                   {heap_size,1597},
>>                   {stack_size,38},
>>                   {reductions,1282}]
>> ** exception exit: undef
>>      in function  rabbit_channel:start_link/4
>>         called as  
>> rabbit_channel:start_link(<0.191.0>,<0.191.0>,<<"guest">>,
>>                                             <<"/">>)
>>      in call from amqp_direct_driver:open_channel/3
>>      in call from amqp_connection:handle_start/5
>>      in call from gen_server:handle_msg/5
>>      in call from proc_lib:init_p/5
>>
>>
>> any help greatly appreciated,
>> joe
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080312/c55ffda9/attachment.htm 

From a.abbaspour at gmail.com  Wed Mar 12 09:24:35 2008
From: a.abbaspour at gmail.com (Amin Abbaspour)
Date: Wed, 12 Mar 2008 12:54:35 +0330
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
In-Reply-To: <5CAFF67C-6A15-47A1-9BBA-7A31B9979BEA@gmail.com>
References: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
	<ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>
	<50ec7a2e0803111948k36a6421k9e5e7fdd475f8e3d@mail.gmail.com>
	<5CAFF67C-6A15-47A1-9BBA-7A31B9979BEA@gmail.com>
Message-ID: <1064d1d30803120224h6b8c401aue03643c77d8b66a@mail.gmail.com>

Hi,

With respect to all, but why don't you place an updated version of
snapshot? After all it's supposed to be an snapshot :)

This issues seems to cause many problems esp. for new comers.

Regards,
Amin

On Wed, Mar 12, 2008 at 11:39 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
> Hi Joe,
>
> The version of the client used in the blog can be accessed as a tarball via
> this URL:
> http://dev.rabbitmq.com/viewmtn/revision/tar/7e281d11727fd3392033eb16facb2a391506d3b1
>
> In general, you can browse the Erlang client branch with this URL:
> http://dev.rabbitmq.com/viewmtn/branch/changes/com.rabbitmq.erlang-client
>
> You can then use viewmtn to select the latest revision and download it as a
> tarball.
>
> HTH,
>
> Ben
>
>
>
> On 12 Mar 2008, at 02:48, joe lee wrote:
> Hey Ben,
>
> I went to this url: http://dev.rabbitmq.com/viewmtn/ and not sure which one
> to checkout.  Any suggestions?
>
> Joe
>
> On Mon, Mar 10, 2008 at 1:16 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
> >
> >
> > Hi Joe,
> >
> >
> > The blog post uses this snapshot version of Rabbit server:
> http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq_200712231455.tar.gz, not
> the released 1.2.0 version.
> >
> >
> > In this version, the function start_link in rabbit_channel was exported
> for the first time, as part of client and server refactoring.
> >
> >
> > This is why you are getting a 'function not exported' error.
> >
> >
> > I would even suggest downloading the latest published snapshot of the
> server, as this is what the latest version of the client has been tested
> against.
> >
> >
> > HTH,
> >
> >
> > Ben
> >
> >
> >
> >
> >
> >
> >
> > On 10 Mar 2008, at 17:06, joe lee wrote:
> >
> >
> >
> >
> > Hi,
> >
> > I just checked out rabbitmq client, using rabbitmq-server 1.2.0 with
> cotton-0.2.3.tar.gz which supports hessian 2.0.
> >
> > I was following this blog tutorial:
> http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html
> and for whatever reason, rabbitmq-server is not accepting the client
> connection.
> >
> > My rabbitmq-server uses all default values for user "guest" and password
> "guest".  I haven't made any changes.  I started the rabbitmq server with
> /usr/sbin/rabbitmq-server and aborted the erlang node to stop the rabbitmq
> server.  This causes problem during restart.  I get an error such as mnesia
> table timeout.  More likely this is occuring during mnesia trying to recover
> the tables.
> >
> > Back to erlang client connection problem:
> >
> > 1> blog_example_1:amqp_lifecycle().
> > Connection: {<0.190.0>,direct}
> >
> > =ERROR REPORT==== 9-Mar-2008::21:56:53 ===
> > ** Generic server <0.190.0> terminating
> > ** Last message in was {direct,none,<<>>}
> > ** When Server state == {connection_state,"guest","guest",undefined,
> >
> undefined,<<"/">>,undefined,undefined,undefined,
> >                             undefined,undefined,
> >                             {dict,0,16,16,8,80,48,
> >
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                  []},
> >
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]}}}}
> > ** Reason for termination ==
> > ** {'function not exported',
> >        [{rabbit_channel,start_link,
> >             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
> >         {amqp_direct_driver,open_channel,3},
> >         {amqp_connection,handle_start,5},
> >         {gen_server,handle_msg,5},
> >         {proc_lib,init_p,5}]}
> >
> > =CRASH REPORT==== 9-Mar-2008::21:56:53 ===
> >   crasher:
> >     pid: <0.190.0>
> >     registered_name: []
> >     exception exit: {undef,
> >                         [{rabbit_channel,start_link,
> >                              [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
> >                          {amqp_direct_driver,open_channel,3},
> >                          {amqp_connection,handle_start,5},
> >                          {gen_server,handle_msg,5},
> >                          {proc_lib,init_p,5}]}
> >       in function  gen_server:terminate/6
> >     initial call:
> gen:init_it(gen_server,<0.40.0>,<0.40.0>,amqp_connection,
> >
> [{connection_state,"guest","guest",undefined,
> >                                    undefined,<<"/">>,undefined,undefined,
> >                                    undefined,undefined,undefined,
> >                                    {dict,0,16,16,8,80,48,
> >
> {[],[],[],[],[],[],[],[],[],[],[],[],
> >                                         [],[],[],[]},
> >
> {{[],[],[],[],[],[],[],[],[],[],[],[],
> >                                          [],[],[],[]}}}},
> >                                #Fun<amqp_direct_driver.handshake.1>],
> >                               [])
> >     ancestors: [<0.40.0>]
> >     messages: []
> >     links: [<0.40.0>,<0.191.0>]
> >     dictionary: []
> >     trap_exit: true
> >     status: running
> >     heap_size: 377
> >     stack_size: 23
> >     reductions: 451
> >   neighbours:
> >     neighbour: [{pid,<0.191.0>},
> >                   {registered_name,[]},
> >                   {initial_call,
> >                       {gen,init_it,
> >                           [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
> >
> [{channel_state,1,<0.190.0>,undefined,undefined,
> >                                 #Fun<amqp_direct_driver.do.2>,
> >                                 #Fun<amqp_direct_driver.do.3>,undefined,
> >                                 undefined,false,undefined,
> >                                 {dict,0,16,16,8,80,48,
> >
> {[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                      [],[],[]},
> >
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                       [],[],[]}}}}],
> >                            []]}},
> >                   {current_function,{gen_server,loop,6}},
> >                   {ancestors,[<0.190.0>,<0.40.0>]},
> >                   {messages,[]},
> >                   {links,[<0.190.0>]},
> >                   {dictionary,[]},
> >                   {trap_exit,false},
> >                   {status,waiting},
> >                   {heap_size,233},
> >                   {stack_size,12},
> >                   {reductions,39}]
> >     neighbour: [{pid,<0.40.0>},
> >                   {registered_name,[]},
> >                   {initial_call,{erlang,apply,2}},
> >                   {current_function,{gen,wait_resp_mon,3}},
> >                   {ancestors,[]},
> >                   {messages,[]},
> >                   {links,[<0.25.0>,<0.190.0>]},
> >                   {dictionary,[]},
> >                   {trap_exit,false},
> >                   {status,waiting},
> >                   {heap_size,1597},
> >                   {stack_size,38},
> >                   {reductions,1282}]
> > ** exception exit: undef
> >      in function  rabbit_channel:start_link/4
> >         called as
> rabbit_channel:start_link(<0.191.0>,<0.191.0>,<<"guest">>,
> >                                             <<"/">>)
> >      in call from amqp_direct_driver:open_channel/3
> >      in call from amqp_connection:handle_start/5
> >      in call from gen_server:handle_msg/5
> >      in call from proc_lib:init_p/5
> >
> >
> > any help greatly appreciated,
> > joe
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From Eric.falconnier+rabbitmq at gmail.com  Wed Mar 12 11:07:05 2008
From: Eric.falconnier+rabbitmq at gmail.com (Eric Falconnier)
Date: Wed, 12 Mar 2008 12:07:05 +0100
Subject: [rabbitmq-discuss] Start Error
In-Reply-To: <ca4787b10803120401yc40269bt5390c9d74bb17a60@mail.gmail.com>
References: <ca4787b10803120401yc40269bt5390c9d74bb17a60@mail.gmail.com>
Message-ID: <ca4787b10803120407p38fa515du3640b57335448d39@mail.gmail.com>

Hello,

the rabbitmq server I have installed doesn't start any more. It seems
that the problem is related to the 2 persistent exchanges I use, but I
am a beginner and I don't really know where to start to solve this
issue.

Thank you for your help,

Eric Falconnier



DEBIAN etch - last packet from the rabbitmq.com repository


 =ERROR REPORT==== 12-Mar-2008::11:38:20 ===
 ** Generic server rabbit_gc_persist terminating
 ** Last message in was {load_snapshot,rabbit_persister}
 ** When Server state == {gcstate,63,64,65}
 ** Reason for termination ==
 ** {{badmatch,eof},
    [{rabbit_gc_persist,internal_load_snapshot,2},
     {rabbit_gc_persist,handle_call,3},
     {gen_server,handle_msg,6},
     {proc_lib,init_p,5}]}

 =INFO REPORT==== 12-Mar-2008::11:38:20 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{{badmatch,
                                      {error,
                                          {shutdown,
                                              {child,
                                                  undefined,
                                                  rabbit_persister_sup,
                                                  {rabbit_persister_sup,
                                                      start_link,
                                                      []},
                                                  transient,
                                                  infinity,
                                                  supervisor,
                                                  [rabbit_persister_sup]}}}},
                                  [{rabbit,start_persister,0},
                                   {rabbit,'-start/2-fun-4-',0},
                                   {rabbit,'-start/2-fun-0-',1},
                                   {lists,foreach,2},
                                   {rabbit,start,2},
                                   {application_master,start_it_old,4}]}}}}
    type: temporary

 =ERROR REPORT==== 12-Mar-2008::11:38:20 ===
 ** Generic server rabbit_amqqueue_monitor terminating
 ** Last message in was {'EXIT',<0.118.0>,shutdown}
 ** When Server state == {state,{rabbit_amqqueue,cleanup},
                               {dict,2,
                                     16,
                                     16,
                                     8,
                                     80,
                                     48,
                                     {[],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      [],
                                      []},
                                     {{[],
                                       [],
                                       [],
                                       [],
                                       [[<0.148.0>|#Ref<0.0.0.438>]],
                                       [],
                                       [[<0.150.0>|#Ref<0.0.0.440>]],
                                       [],
                                       [],
                                       [],
                                       [],
                                       [],
                                       [],
                                       [],
                                       [],
                                       []}}}}
 ** Reason for termination ==
 ** {badarg,[{mnesia_tm,return_abort,3},
            {mnesia_tm,restart,9},
            {rabbit_misc,execute_mnesia_transaction,2},
            {rabbit_amqqueue,cleanup,1},
            {lists,foreach,2},
            {rabbit_monitor,terminate,2},
            {gen_server,terminate,6},
            {proc_lib,init_p,5}]}

 =INFO REPORT==== 12-Mar-2008::11:38:20 ===
    application: mnesia
    exited: stopped
    type: temporary

 =INFO REPORT==== 12-Mar-2008::11:38:20 ===
    application: os_mon
    exited: stopped
    type: temporary



From alexis.richardson at cohesiveft.com  Wed Mar 12 11:10:18 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 12 Mar 2008 11:10:18 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client connection issue
In-Reply-To: <1064d1d30803120224h6b8c401aue03643c77d8b66a@mail.gmail.com>
References: <50ec7a2e0803101006y29316795k8e75da2d973930cf@mail.gmail.com>
	<ABE4D1F0-5CA9-44FC-888E-4D191A1B4D16@gmail.com>
	<50ec7a2e0803111948k36a6421k9e5e7fdd475f8e3d@mail.gmail.com>
	<5CAFF67C-6A15-47A1-9BBA-7A31B9979BEA@gmail.com>
	<1064d1d30803120224h6b8c401aue03643c77d8b66a@mail.gmail.com>
Message-ID: <167204d20803120410u1f9d5a4aqd5ac0590c6b8d87@mail.gmail.com>

Amin

You are quite right and this is being addressed currently - we have
been planning some web site changes.  Normal service will resume
shortly.

alexis


On Wed, Mar 12, 2008 at 9:24 AM, Amin Abbaspour <a.abbaspour at gmail.com> wrote:
> Hi,
>
>  With respect to all, but why don't you place an updated version of
>  snapshot? After all it's supposed to be an snapshot :)
>
>  This issues seems to cause many problems esp. for new comers.
>
>  Regards,
>  Amin
>
>
>
>  On Wed, Mar 12, 2008 at 11:39 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
>  >
>  > Hi Joe,
>  >
>  > The version of the client used in the blog can be accessed as a tarball via
>  > this URL:
>  > http://dev.rabbitmq.com/viewmtn/revision/tar/7e281d11727fd3392033eb16facb2a391506d3b1
>  >
>  > In general, you can browse the Erlang client branch with this URL:
>  > http://dev.rabbitmq.com/viewmtn/branch/changes/com.rabbitmq.erlang-client
>  >
>  > You can then use viewmtn to select the latest revision and download it as a
>  > tarball.
>  >
>  > HTH,
>  >
>  > Ben
>  >
>  >
>  >
>  > On 12 Mar 2008, at 02:48, joe lee wrote:
>  > Hey Ben,
>  >
>  > I went to this url: http://dev.rabbitmq.com/viewmtn/ and not sure which one
>  > to checkout.  Any suggestions?
>  >
>  > Joe
>  >
>  > On Mon, Mar 10, 2008 at 1:16 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>  >
>  > >
>  > >
>  > > Hi Joe,
>  > >
>  > >
>  > > The blog post uses this snapshot version of Rabbit server:
>  > http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq_200712231455.tar.gz, not
>  > the released 1.2.0 version.
>  > >
>  > >
>  > > In this version, the function start_link in rabbit_channel was exported
>  > for the first time, as part of client and server refactoring.
>  > >
>  > >
>  > > This is why you are getting a 'function not exported' error.
>  > >
>  > >
>  > > I would even suggest downloading the latest published snapshot of the
>  > server, as this is what the latest version of the client has been tested
>  > against.
>  > >
>  > >
>  > > HTH,
>  > >
>  > >
>  > > Ben
>  > >
>  > >
>  > >
>  > >
>  > >
>  > >
>  > >
>  > > On 10 Mar 2008, at 17:06, joe lee wrote:
>  > >
>  > >
>  > >
>  > >
>  > > Hi,
>  > >
>  > > I just checked out rabbitmq client, using rabbitmq-server 1.2.0 with
>  > cotton-0.2.3.tar.gz which supports hessian 2.0.
>  > >
>  > > I was following this blog tutorial:
>  > http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html
>  > and for whatever reason, rabbitmq-server is not accepting the client
>  > connection.
>  > >
>  > > My rabbitmq-server uses all default values for user "guest" and password
>  > "guest".  I haven't made any changes.  I started the rabbitmq server with
>  > /usr/sbin/rabbitmq-server and aborted the erlang node to stop the rabbitmq
>  > server.  This causes problem during restart.  I get an error such as mnesia
>  > table timeout.  More likely this is occuring during mnesia trying to recover
>  > the tables.
>  > >
>  > > Back to erlang client connection problem:
>  > >
>  > > 1> blog_example_1:amqp_lifecycle().
>  > > Connection: {<0.190.0>,direct}
>  > >
>  > > =ERROR REPORT==== 9-Mar-2008::21:56:53 ===
>  > > ** Generic server <0.190.0> terminating
>  > > ** Last message in was {direct,none,<<>>}
>  > > ** When Server state == {connection_state,"guest","guest",undefined,
>  > >
>  > undefined,<<"/">>,undefined,undefined,undefined,
>  > >                             undefined,undefined,
>  > >                             {dict,0,16,16,8,80,48,
>  > >
>  > {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                  []},
>  > >
>  > {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                   [],[]}}}}
>  > > ** Reason for termination ==
>  > > ** {'function not exported',
>  > >        [{rabbit_channel,start_link,
>  > >             [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>  > >         {amqp_direct_driver,open_channel,3},
>  > >         {amqp_connection,handle_start,5},
>  > >         {gen_server,handle_msg,5},
>  > >         {proc_lib,init_p,5}]}
>  > >
>  > > =CRASH REPORT==== 9-Mar-2008::21:56:53 ===
>  > >   crasher:
>  > >     pid: <0.190.0>
>  > >     registered_name: []
>  > >     exception exit: {undef,
>  > >                         [{rabbit_channel,start_link,
>  > >                              [<0.191.0>,<0.191.0>,<<"guest">>,<<"/">>]},
>  > >                          {amqp_direct_driver,open_channel,3},
>  > >                          {amqp_connection,handle_start,5},
>  > >                          {gen_server,handle_msg,5},
>  > >                          {proc_lib,init_p,5}]}
>  > >       in function  gen_server:terminate/6
>  > >     initial call:
>  > gen:init_it(gen_server,<0.40.0>,<0.40.0>,amqp_connection,
>  > >
>  > [{connection_state,"guest","guest",undefined,
>  > >                                    undefined,<<"/">>,undefined,undefined,
>  > >                                    undefined,undefined,undefined,
>  > >                                    {dict,0,16,16,8,80,48,
>  > >
>  > {[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                         [],[],[],[]},
>  > >
>  > {{[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                          [],[],[],[]}}}},
>  > >                                #Fun<amqp_direct_driver.handshake.1>],
>  > >                               [])
>  > >     ancestors: [<0.40.0>]
>  > >     messages: []
>  > >     links: [<0.40.0>,<0.191.0>]
>  > >     dictionary: []
>  > >     trap_exit: true
>  > >     status: running
>  > >     heap_size: 377
>  > >     stack_size: 23
>  > >     reductions: 451
>  > >   neighbours:
>  > >     neighbour: [{pid,<0.191.0>},
>  > >                   {registered_name,[]},
>  > >                   {initial_call,
>  > >                       {gen,init_it,
>  > >                           [gen_server,<0.190.0>,<0.190.0>,amqp_channel,
>  > >
>  > [{channel_state,1,<0.190.0>,undefined,undefined,
>  > >                                 #Fun<amqp_direct_driver.do.2>,
>  > >                                 #Fun<amqp_direct_driver.do.3>,undefined,
>  > >                                 undefined,false,undefined,
>  > >                                 {dict,0,16,16,8,80,48,
>  > >
>  > {[],[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                      [],[],[]},
>  > >
>  > {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>  > >                                       [],[],[]}}}}],
>  > >                            []]}},
>  > >                   {current_function,{gen_server,loop,6}},
>  > >                   {ancestors,[<0.190.0>,<0.40.0>]},
>  > >                   {messages,[]},
>  > >                   {links,[<0.190.0>]},
>  > >                   {dictionary,[]},
>  > >                   {trap_exit,false},
>  > >                   {status,waiting},
>  > >                   {heap_size,233},
>  > >                   {stack_size,12},
>  > >                   {reductions,39}]
>  > >     neighbour: [{pid,<0.40.0>},
>  > >                   {registered_name,[]},
>  > >                   {initial_call,{erlang,apply,2}},
>  > >                   {current_function,{gen,wait_resp_mon,3}},
>  > >                   {ancestors,[]},
>  > >                   {messages,[]},
>  > >                   {links,[<0.25.0>,<0.190.0>]},
>  > >                   {dictionary,[]},
>  > >                   {trap_exit,false},
>  > >                   {status,waiting},
>  > >                   {heap_size,1597},
>  > >                   {stack_size,38},
>  > >                   {reductions,1282}]
>  > > ** exception exit: undef
>  > >      in function  rabbit_channel:start_link/4
>  > >         called as
>  > rabbit_channel:start_link(<0.191.0>,<0.191.0>,<<"guest">>,
>  > >                                             <<"/">>)
>  > >      in call from amqp_direct_driver:open_channel/3
>  > >      in call from amqp_connection:handle_start/5
>  > >      in call from gen_server:handle_msg/5
>  > >      in call from proc_lib:init_p/5
>  > >
>  > >
>  > > any help greatly appreciated,
>  > > joe
>  > > _______________________________________________
>  > > rabbitmq-discuss mailing list
>  > > rabbitmq-discuss at lists.rabbitmq.com
>  > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  > >
>  > >
>  > > _______________________________________________
>  > > rabbitmq-discuss mailing list
>  > > rabbitmq-discuss at lists.rabbitmq.com
>  > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  > >
>  > >
>  >
>  >
>  >
>  > _______________________________________________
>  >  rabbitmq-discuss mailing list
>  >  rabbitmq-discuss at lists.rabbitmq.com
>  >  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>  >
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From codewalkerjoe at gmail.com  Wed Mar 12 23:06:08 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Wed, 12 Mar 2008 19:06:08 -0400
Subject: [rabbitmq-discuss] rabbitmq mnesia table timeout and
	disk_almost_full alarm activated
Message-ID: <50ec7a2e0803121606h7889f04eidea7a2829486327f@mail.gmail.com>

I am running rabbitmq server snapshot version rabbitmq-200801150657.  I have
500MB of free space in my /home drive and 189MB free on / drive. Have 700MB
of free memory and CPU utilization is less 10%.

I have stopped rabbit app from erl shell.  Then when I restarted erl shell
with the same mnesia dir, I get the following: mnesia table timeout and
disk_almost_full alarm activated.  In addition, application os_mon is
temporarily stopped.

[joe at home src]$ erl -sname rabbit at home -mnesia dir
'"/home/joe/temp/rabbitmq_data"' -boot start_sasl -s rabbit


Erlang (BEAM) emulator version 5.6 [source] [async-threads:0] [hipe]
[kernel-poll:false]


=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.40.0>},
                       {name,alarm_handler},
                       {mfa,{alarm_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,<0.41.0>},
                       {name,overload},
                       {mfa,{overload,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.39.0>},
                       {name,sasl_safe_sup},
                       {mfa,
                           {supervisor,start_link,
                               [{local,sasl_safe_sup},sasl,safe]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,sasl_sup}
             started: [{pid,<0.42.0>},
                       {name,release_handler},
                       {mfa,{release_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
         application: sasl
          started_at: rabbit at home

Eshell V5.6  (abort with ^G)
(rabbit at home)1>
=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,os_mon_sup}
             started: [{pid,<0.54.0>},
                       {name,disksup},
                       {mfa,{disksup,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,os_mon_sup}
             started: [{pid,<0.55.0>},
                       {name,memsup},
                       {mfa,{memsup,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,os_mon_sup}
             started: [{pid,<0.57.0>},
                       {name,cpu_sup},
                       {mfa,{cpu_sup,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
         application: os_mon
          started_at: rabbit at home

=INFO REPORT==== 12-Mar-2008::18:24:47 ===
    alarm_handler: {set,{{disk_almost_full,"/"},[]}}

=INFO REPORT==== 12-Mar-2008::18:24:47 ===
    alarm_handler: {set,{{disk_almost_full,"/home"},[]}}

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.62.0>},
                       {name,timer_server},
                       {mfa,{timer,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,1000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,mnesia_sup}
             started: [{pid,<0.63.0>},
                       {name,mnesia_event},
                       {mfa,{mnesia_sup,start_event,[]}},
                       {restart_type,permanent},
                       {shutdown,30000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.65.0>},
                       {name,mnesia_monitor},
                       {mfa,{mnesia_monitor,start,[]}},
                       {restart_type,permanent},
                       {shutdown,3000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.66.0>},
                       {name,mnesia_subscr},
                       {mfa,{mnesia_subscr,start,[]}},
                       {restart_type,permanent},
                       {shutdown,3000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.67.0>},
                       {name,mnesia_locker},
                       {mfa,{mnesia_locker,start,[]}},
                       {restart_type,permanent},
                       {shutdown,3000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.68.0>},
                       {name,mnesia_recover},
                       {mfa,{mnesia_recover,start,[]}},
                       {restart_type,permanent},
                       {shutdown,180000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.70.0>},
                       {name,dets_sup},
                       {mfa,{dets_sup,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,1000},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.71.0>},
                       {name,dets},
                       {mfa,{dets_server,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.75.0>},
                       {name,disk_log_sup},
                       {mfa,{disk_log_sup,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,1000},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.76.0>},
                       {name,disk_log_server},
                       {mfa,{disk_log_server,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,inet_gethost_native_sup}
             started: [{pid,<0.84.0>},{mfa,{inet_gethost_native,init,[[]]}}]

=PROGRESS REPORT==== 12-Mar-2008::18:24:47 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.83.0>},
                       {name,inet_gethost_native_sup},
                       {mfa,{inet_gethost_native,start_link,[]}},
                       {restart_type,temporary},
                       {shutdown,1000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.69.0>},
                       {name,mnesia_tm},
                       {mfa,{mnesia_tm,start,[]}},
                       {restart_type,permanent},
                       {shutdown,30000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.92.0>},
                       {name,mnesia_checkpoint_sup},
                       {mfa,{mnesia_checkpoint_sup,start,[]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.93.0>},
                       {name,mnesia_snmp_sup},
                       {mfa,{mnesia_snmp_sup,start,[]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.94.0>},
                       {name,mnesia_controller},
                       {mfa,{mnesia_controller,start,[]}},
                       {restart_type,permanent},
                       {shutdown,3000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_kernel_sup}
             started: [{pid,<0.95.0>},
                       {name,mnesia_late_loader},
                       {mfa,{mnesia_late_loader,start,[]}},
                       {restart_type,permanent},
                       {shutdown,3000},
                       {child_type,worker}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
          supervisor: {local,mnesia_sup}
             started: [{pid,<0.64.0>},
                       {name,mnesia_kernel_sup},
                       {mfa,{mnesia_kernel_sup,start,[]}},
                       {restart_type,permanent},
                       {shutdown,infinity},
                       {child_type,supervisor}]

=PROGRESS REPORT==== 12-Mar-2008::18:25:03 ===
         application: mnesia
          started_at: rabbit at home
RabbitMQ 200801150657 (AMQP 8-0)
Copyright (C) 2007 LShift Ltd., Cohesive Financial Technologies LLC., and
Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to tty
SASL logging to tty

starting database             ...
=CRASH REPORT==== 12-Mar-2008::18:25:33 ===
  crasher:
    pid: <0.99.0>
    registered_name: []
    exception exit: {bad_return,
                        {{rabbit,start,[normal,[]]},
                         {'EXIT',
                             {{rabbit_mnesia,init,0},
                              {line,45},
                              match,
                              [{error,
                                   {timeout_waiting_for_tables,
                                       [user,user_vhost,vhost,vhost_realm,
                                        realm,user_realm,

exclusive_realm_visitor,realm_visitor,
                                        rabbit_config,listener,binding,
                                        durable_exchanges,exchange,
                                        durable_queues,amqqueue]}}]}}}}
      in function  application_master:init/4
    initial call: application_master:init(<0.5.0>,<0.98.0>,
                                          {appl_data,rabbit,
                                           [rabbit_amqqueue_monitor,
                                            rabbit_gc_persist,rabbit_gensym,
                                            rabbit_log,rabbit_node_monitor,
                                            rabbit_persister,
                                            rabbit_realm_monitor,rabbit_sup,
                                            rabbit_tcp_client_sup],
                                           undefined,
                                           {rabbit,[]},
                                           [rabbit,buffering_proxy,
                                            rabbit_access_control,
                                            rabbit_amqqueue,
                                            rabbit_amqqueue_process,
                                            rabbit_binary_generator,
                                            rabbit_binary_parser,
                                            rabbit_channel,rabbit_channel0,
                                            rabbit_control,
                                            rabbit_error_logger,
                                            rabbit_exchange,rabbit_framing,
                                            rabbit_framing_channel,
                                            rabbit_gc_persist,rabbit_gensym,
                                            rabbit_heartbeat,rabbit_load,
                                            rabbit_log,rabbit_misc,
                                            rabbit_mnesia,rabbit_monitor,
                                            rabbit_networking,
                                            rabbit_node_monitor,
                                            rabbit_persister,
                                            rabbit_persister_sup,
                                            rabbit_reader,rabbit_realm,
                                            rabbit_router,rabbit_sup,
                                            rabbit_tests,rabbit_ticket,
                                            rabbit_tracer,rabbit_writer,
                                            tcp_acceptor,tcp_acceptor_sup,
                                            tcp_client_sup,tcp_listener,
                                            tcp_listener_sup],
                                           [],infinity,infinity},
                                          normal)
    ancestors: [<0.98.0>]
    messages: [{'EXIT',<0.100.0>,normal}]
    links: [<0.98.0>,<0.5.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 92
  neighbours:

=INFO REPORT==== 12-Mar-2008::18:25:33 ===
    application: rabbit
    exited: {bad_return,
                {{rabbit,start,[normal,[]]},
                 {'EXIT',
                     {{rabbit_mnesia,init,0},
                      {line,45},
                      match,
                      [{error,
                           {timeout_waiting_for_tables,
                               [user,user_vhost,vhost,vhost_realm,realm,
                                user_realm,exclusive_realm_visitor,

realm_visitor,rabbit_config,listener,binding,
                                durable_exchanges,exchange,durable_queues,
                                amqqueue]}}]}}}}
    type: temporary

=INFO REPORT==== 12-Mar-2008::18:25:33 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 12-Mar-2008::18:25:33 ===
    alarm_handler: {clear,{disk_almost_full,"/home"}}

=INFO REPORT==== 12-Mar-2008::18:25:33 ===
    alarm_handler: {clear,{disk_almost_full,"/"}}

=INFO REPORT==== 12-Mar-2008::18:25:33 ===
    application: os_mon
    exited: stopped
    type: temporary
/usr/local/erlang/otp_r12b-0/lib/erlang/lib/os_mon-2.1.3/priv/bin/memsup:
Erlang has closed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080312/1dbb12a6/attachment.htm 

From chime at mu.dk  Thu Mar 13 09:38:16 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 13 Mar 2008 10:38:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
Message-ID: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>

Hi,

We've had a rabbit server running for quite some time (not sure  
precisely how long but between 1 and 2 weeks). This morning we had  
some difficulty connecting to it from the outside and on further  
investigation we found it used constantly between 99.8 and 100.3 %  
CPU. We are using 5.5.5 (11-5 as far as I remember), not compiled with  
SMP, running on Mac OS X 10.5.2. Going into erlang it looks like it  
isn't doing anything. No messages waiting in queues, at at most 30.000  
reductions on any process in 10 sec. Now it is some time ago that I  
have debugged erlang programs, so I'm not sure here, but as far as I  
remember, 30.000 really isn't anything and certainly doesn't explain  
100% CPU utilization. It's not using a lot of memory - and in short  
everything looks quite ok (for me) - if it wasn't because it's hogging  
the CPU.

I've kept it running. I'm sure if I restart erlang everything will  
just run perfectly, but I'd rather use this incident to try to find  
the problem if it's possible. However i'm running out of things to  
try, so any suggestions will be welcome.

BTW - noting beyond the ordinary in rabbit.log and nothing in rabbit- 
sasl.log. Also, we using QPID pythin client so we're conecting in lax  
mode.

If nobody has any other suggestions I'd be inclined to upgrade to the  
latest version of erlang. Does anybody have any experince using this  
with Rabbit?

Regards,

Michael Arnoldus




From matthias at lshift.net  Thu Mar 13 09:49:41 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 13 Mar 2008 09:49:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>
Message-ID: <47D8F8B5.1060708@lshift.net>

Michael,

Michael Arnoldus wrote:
> I've kept it running. I'm sure if I restart erlang everything will  
> just run perfectly, but I'd rather use this incident to try to find  
> the problem if it's possible. However i'm running out of things to  
> try, so any suggestions will be welcome.

Try running strace on the Erlang process, to see whether it's stuck in 
some busy loop making system calls.

> If nobody has any other suggestions I'd be inclined to upgrade to the  
> latest version of erlang. Does anybody have any experince using this  
> with Rabbit?

Several people have been running with R12B in their development 
environments without any problems. It should be fine, but we haven't 
done any thorough testing with it.


Matthias.



From chime at mu.dk  Thu Mar 13 14:17:26 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 13 Mar 2008 15:17:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <47D8F8B5.1060708@lshift.net>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>
	<47D8F8B5.1060708@lshift.net>
Message-ID: <3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>

Matthias,

Thank you for your suggestion. There is no strace on Mac OS X, but I  
did find a way to see what the C-program was doing (see below). Most  
of the threads are just waiting (as expected) but a single one seems  
always to be in some kind of tcp_send_error. I haven't yet found a way  
to see if this infinite loop is in the erlang runtime system or the  
error actually reaches rabbit. Anyway, just a status. I'll try to work  
out what I can - Rabbit is still running :-)

Michael


     1002 Thread_2503
       340 writev$UNIX2003
         340 writev$UNIX2003
       299 kevent
         299 kevent
       257 tcp_inet_drv_output
         197 getpeername$UNIX2003
           197 getpeername$UNIX2003
         42 tcp_send_error
           32 inet_reply_error
             16 error_atom
               8 __tolower
                 8 __tolower
               4 pthread_getspecific
                 4 pthread_getspecific
               3 error_atom
               1 dyld_stub_pthread_getspecific
                 1 dyld_stub_pthread_getspecific
             3 hash_put
               3 hash_put
             3 strlen
               3 strlen
             2 atom_hash
               2 atom_hash
             2 driver_mk_atom
               2 driver_mk_atom
             2 dyld_stub___tolower
               2 dyld_stub___tolower
             1 am_atom_put
               1 am_atom_put
             1 erl_errno_id
               1 erl_errno_id
             1 index_put
               1 index_put
             1 inet_reply_error
           4 inet_reply_error_am
             4 inet_reply_error_am
           4 tcp_send_error
           1 __error
             1 __error
           1 driver_send_term
             1 driver_send_term
         8 tcp_inet_drv_output
         4 cerror
           3 cthread_set_errno_self
             3 __error
               3 __error
           1 cerror
         2 _sysenter_trap
           2 _sysenter_trap
         2 inet_reply_error
           2 inet_reply_error
         1 __error
           1 __error
         1 dyld_stub___error
           1 dyld_stub___error
       18 check_async_ready
         6 __spin_lock
           6 __spin_lock
         5 pthread_mutex_unlock
           5 pthread_mutex_unlock
         4 pthread_mutex_lock
           4 pthread_mutex_lock
         2 check_async_ready
         1 spin_lock
           1 spin_lock
       14 erts_deliver_time
         9 gettimeofday
           9 __gettimeofday
             5 __gettimeofday
             4 __nanotime
               4 __nanotime
         4 erts_deliver_time
         1 __commpage_gettimeofday
           1 __commpage_gettimeofday
       13 erts_time_remaining
         9 gettimeofday
           8 __gettimeofday
             7 __nanotime
               7 __nanotime
             1 __gettimeofday
           1 gettimeofday
         4 erts_time_remaining
       9 erts_poll_wait_kp
         7 erts_poll_wait_kp
         2 kevent
           2 kevent
       8 0x38830014
         3 bcmp
           3 bcmp
         3 hash_put
           3 hash_put
         2 atom_cmp
           2 atom_cmp
       8 cerror
         4 cthread_set_errno_self
           3 cthread_set_errno_self
           1 __error
             1 __error
         3 cerror
         1 dyld_stub___error
           1 dyld_stub___error
       7 sweep_proc_bins
         7 sweep_proc_bins
       6 erl_sys_schedule
         6 erl_sys_schedule
       4 schedule
         4 schedule
       3 erts_check_io_kp
         3 erts_check_io_kp
       2 __error
         2 __error
       2 dyld_stub___error
         2 dyld_stub___error
       2 process_main
         2 process_main
       1 _sysenter_trap
         1 _sysenter_trap
       1 copy_shallow
         1 copy_shallow
       1 copy_struct
         1 copy_struct
       1 db_get_hash
         1 db_get_hash
       1 driver_peekq
         1 driver_peekq
       1 dyld_stub_gettimeofday
         1 dyld_stub_gettimeofday
       1 erts_check_io_interrupt_kp
         1 erts_check_io_interrupt_kp
       1 erts_poll_interrupt_kp
         1 erts_poll_interrupt_kp
       1 free_message_buffer
         1 erts_cleanup_mso
           1 erts_cleanup_mso
       1 tcp_inet_drv_input
         1 tcp_recv
           1 tcp_deliver
             1 deq_async
               1 deq_async_w_tmo
                 1 deq_async_w_tmo
On Mar 13, 2008, at 10:49 , Matthias Radestock wrote:

> Michael,
>
> Michael Arnoldus wrote:
>> I've kept it running. I'm sure if I restart erlang everything will   
>> just run perfectly, but I'd rather use this incident to try to  
>> find  the problem if it's possible. However i'm running out of  
>> things to  try, so any suggestions will be welcome.
>
> Try running strace on the Erlang process, to see whether it's stuck  
> in some busy loop making system calls.
>
>> If nobody has any other suggestions I'd be inclined to upgrade to  
>> the  latest version of erlang. Does anybody have any experince  
>> using this  with Rabbit?
>
> Several people have been running with R12B in their development  
> environments without any problems. It should be fine, but we haven't  
> done any thorough testing with it.
>
>
> Matthias.




From chime at mu.dk  Thu Mar 13 14:35:50 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 13 Mar 2008 15:35:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <47D8F8B5.1060708@lshift.net>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>
	<47D8F8B5.1060708@lshift.net>
Message-ID: <477606D0-9F46-4801-B244-0A236E1ABD1A@mu.dk>

Matthias,

And more info - it seems the error returned is 32 which in errno.h is  
EPIPE.

In the manual page for writev it says:

[EPIPE]            An attempt is made to write to a socket of type  
SOCK_STREAM that is not connected to a peer socket.

Does this make any sense to you at all? Do you have an idea if I  
should continue investigating the erlang runtime system or do you  
think it is something inside Rabbit?

Michael

On Mar 13, 2008, at 10:49 , Matthias Radestock wrote:

> Michael,
>
> Michael Arnoldus wrote:
>> I've kept it running. I'm sure if I restart erlang everything will   
>> just run perfectly, but I'd rather use this incident to try to  
>> find  the problem if it's possible. However i'm running out of  
>> things to  try, so any suggestions will be welcome.
>
> Try running strace on the Erlang process, to see whether it's stuck  
> in some busy loop making system calls.
>
>> If nobody has any other suggestions I'd be inclined to upgrade to  
>> the  latest version of erlang. Does anybody have any experince  
>> using this  with Rabbit?
>
> Several people have been running with R12B in their development  
> environments without any problems. It should be fine, but we haven't  
> done any thorough testing with it.
>
>
> Matthias.




From matthias at lshift.net  Thu Mar 13 15:11:32 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 13 Mar 2008 15:11:32 +0000
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>	<47D8F8B5.1060708@lshift.net>
	<3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>
Message-ID: <47D94424.7090000@lshift.net>

Michael,

Michael Arnoldus wrote:
> Thank you for your suggestion. There is no strace on Mac OS X, but I did 
> find a way to see what the C-program was doing (see below).

I gather there's ktrace and/or dtrace.

> Most of the 
> threads are just waiting (as expected) but a single one seems always to 
> be in some kind of tcp_send_error.

That is interesting. Tony has seen similar symptoms on his MacBook here, 
but so far we have failed to reproduce the problem anywhere else.

Please let us know as much about your system as possible. Exact OS 
version, Erlang/OTP version, RabbitMQ version, number and exact type of 
processors, memory configuration, and anything else you can think of 
that might be relevant.


Matthias.



From chime at mu.dk  Thu Mar 13 15:36:16 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 13 Mar 2008 16:36:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <47D94424.7090000@lshift.net>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>	<47D8F8B5.1060708@lshift.net>
	<3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>
	<47D94424.7090000@lshift.net>
Message-ID: <52716978-7CC4-4BC6-8A30-371475F438C6@mu.dk>

Matthias,

Seen on several Mac's here, but the one where we have the problem  
right now is a Quad-core 2,8 GHz Mac Pro. Also seen on a dual core. 2  
GB Mem. Running Mac OS X 10.5.2 (Leopard). Erlang 11B-5, Rabbit 1.2.0.

I actually have a system running with the problem, so if I can help in  
any way tracing the problem down, let me know.

Yes, Mac OS X has dtrace.

It seems to me like it should be possible to find an possible infinite  
loop on writev error writing to a socket, either in the erlang code or  
the rabbit code (but then again - what do I know :-) Let me know if  
you have any suggestions on where I should start looking.

Michael



On Mar 13, 2008, at 16:11 , Matthias Radestock wrote:

> Michael,
>
> Michael Arnoldus wrote:
>> Thank you for your suggestion. There is no strace on Mac OS X, but  
>> I did find a way to see what the C-program was doing (see below).
>
> I gather there's ktrace and/or dtrace.
>
>> Most of the threads are just waiting (as expected) but a single one  
>> seems always to be in some kind of tcp_send_error.
>
> That is interesting. Tony has seen similar symptoms on his MacBook  
> here, but so far we have failed to reproduce the problem anywhere  
> else.
>
> Please let us know as much about your system as possible. Exact OS  
> version, Erlang/OTP version, RabbitMQ version, number and exact type  
> of processors, memory configuration, and anything else you can think  
> of that might be relevant.
>
>
> Matthias.




From neil.ellis at mangala.co.uk  Thu Mar 13 17:48:13 2008
From: neil.ellis at mangala.co.uk (Neil Ellis)
Date: Thu, 13 Mar 2008 17:48:13 +0000
Subject: [rabbitmq-discuss] NPE in RpcClient
Message-ID: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>

Hi Folks

Not sure if this has already been reported; in version 1.2.0 of lib- 
rabbitmq there is a NPE if the publish() method has been called on  
RpcClient because the temp queue picks it up and attempts to call  
setBody() on the blocker. Trivially chaning blocker.set(body) to have  
a NP check fixes this:

                    if(blocker != null) {                    	
	                    blocker.set(body);
                     }

This was line 150 of RpcClient. I've cc-ed the list for the mule  
transport as it is the mule transport using publish() that caused my  
problem.

Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html 
  and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/ 
  - basically we're combining Newton, Mule and RabbitMQ as an  
illustration of a flexible open-source based messaging system.

Kind regards
Neil

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2431 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080313/63570d0e/attachment.bin 

From ksalasko at gmail.com  Fri Mar 14 02:10:51 2008
From: ksalasko at gmail.com (Kyle Salasko)
Date: Thu, 13 Mar 2008 19:10:51 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ on EC2
Message-ID: <16042914.post@talk.nabble.com>


I'm trying to create a cluster of RabbitMQ nodes on EC2 and I've been running
into some trouble. Using the cluster command succeeds, but the nodes end up
in an inconsistent state. It's easier to give an example than to explain the
results, so I'll post them below.

There are 3 nodes:
Node A calls itself rabbit at domU-12-31-38-00-48-D1
Node B calls itself rabbit at ip-10-251-159-160
Node C calls itself rabbit at domU-12-31-38-00-48-A2.

First I clustered A and B, as disk nodes. This worked fine. Then I tried to
add Node C.

Node A says:
Status of node 'rabbit at domU-12-31-38-00-48-D1' ...
[{running_applications,[{rabbit,"RabbitMQ","1.2.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.3.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.1"},
                        {sasl,"SASL  CXC 138 11","2.1.4"},
                        {stdlib,"ERTS  CXC 138 10","1.14.2"},
                        {kernel,"ERTS  CXC 138 10","2.11.2"}]},
 {nodes,['rabbit at domU-12-31-38-00-48-D1',
         'rabbit at ip-10-251-159-160',
         'rabbit at domU-12-31-38-00-48-A2']},

{running_nodes,['rabbit at ip-10-251-159-160','rabbit at domU-12-31-38-00-48-D1']}]

Node B says:
Status of node 'rabbit at ip-10-251-159-160' ...
[{running_applications,[{rabbit,"RabbitMQ","1.2.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.3.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.1"},
                        {sasl,"SASL  CXC 138 11","2.1.4"},
                        {stdlib,"ERTS  CXC 138 10","1.14.2"},
                        {kernel,"ERTS  CXC 138 10","2.11.2"}]},
 {nodes,['rabbit at domU-12-31-38-00-48-D1',
         'rabbit at ip-10-251-159-160',
         'rabbit at domU-12-31-38-00-48-A2']},
 {running_nodes,['rabbit at domU-12-31-38-00-48-D1',
                 'rabbit at domU-12-31-38-00-48-A2',
                 'rabbit at ip-10-251-159-160']}]

Node C says:
Status of node 'rabbit at domU-12-31-38-00-48-A2' ...
[{running_applications,[{rabbit,"RabbitMQ","1.2.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.3.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.1"},
                        {sasl,"SASL  CXC 138 11","2.1.4"},
                        {stdlib,"ERTS  CXC 138 10","1.14.2"},
                        {kernel,"ERTS  CXC 138 10","2.11.2"}]},
 {nodes,['rabbit at ip-10-251-159-160','rabbit at domU-12-31-38-00-48-A2']},

{running_nodes,['rabbit at ip-10-251-159-160','rabbit at domU-12-31-38-00-48-A2']}]

If I reset A, then cluster it with C and B, I get a situation where A and C
switch: C can see all 3, but thinks A is down, and A can only see itself and
B.

I'm hoping someone has seen a similar problem before and can either point me
to where to look for either pointers on what may be wrong with my EC2 or
RabbitMQ setups. I know port 4369 is open, and the nodes can reach each
other via ping. I've managed to replicate this with additional boxes and
entire new setups.

Thanks for the help.

Kyle Salasko
-- 
View this message in context: http://www.nabble.com/RabbitMQ-on-EC2-tp16042914p16042914.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From ksalasko at gmail.com  Fri Mar 14 05:49:44 2008
From: ksalasko at gmail.com (Kyle Salasko)
Date: Thu, 13 Mar 2008 22:49:44 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ on EC2
In-Reply-To: <16042914.post@talk.nabble.com>
References: <16042914.post@talk.nabble.com>
Message-ID: <16044743.post@talk.nabble.com>


Scratch that, I found a solution. An easy workaround is to find the internal
(inside the NAT) IP address of any nodes with the domU-... hostnames, and
construct the ip-... hostnames from that. For example, Node A from below
might resolve to 10.252.56.111, and by manually running 'hostname
ip-10-252-56-111.ec2.internal', the problems below resolve themselves.

The problem seems to arise from the fact that the machines can resolve the
first three of the following names, but not the fourth.

ip-10-251-159-160.ec2.internal
ip-10-251-159-160
domU-12-31-38-00-48-A2.compute-1.internal
domU-12-31-38-00-48-A2

This probably should be automated in AMI creation, but I thought I'd let
people know in case they run into the same problems.

-- 
View this message in context: http://www.nabble.com/RabbitMQ-on-EC2-tp16042914p16044743.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at cohesiveft.com  Fri Mar 14 20:08:16 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 14 Mar 2008 20:08:16 +0000
Subject: [rabbitmq-discuss] RabbitMQ on EC2
In-Reply-To: <16044743.post@talk.nabble.com>
References: <16042914.post@talk.nabble.com> <16044743.post@talk.nabble.com>
Message-ID: <167204d20803141308o1e13b284p7f66ef700518831a@mail.gmail.com>

Kyle

Thank-you for this.

We've been experimenting with some of these issues in a public way ...
see Dmitriy's post here: http://www.infoq.com/news/2008/02/ec2

Also (apologies for this but) -- http://es.cohesiveft.com/site/rabbitmq

alexis




On Fri, Mar 14, 2008 at 5:49 AM, Kyle Salasko <ksalasko at gmail.com> wrote:
>
>  Scratch that, I found a solution. An easy workaround is to find the internal
>  (inside the NAT) IP address of any nodes with the domU-... hostnames, and
>  construct the ip-... hostnames from that. For example, Node A from below
>  might resolve to 10.252.56.111, and by manually running 'hostname
>  ip-10-252-56-111.ec2.internal', the problems below resolve themselves.
>
>  The problem seems to arise from the fact that the machines can resolve the
>  first three of the following names, but not the fourth.
>
>  ip-10-251-159-160.ec2.internal
>
> ip-10-251-159-160
>  domU-12-31-38-00-48-A2.compute-1.internal
>
> domU-12-31-38-00-48-A2
>
>  This probably should be automated in AMI creation, but I thought I'd let
>  people know in case they run into the same problems.
>
>  --
>  View this message in context: http://www.nabble.com/RabbitMQ-on-EC2-tp16042914p16044743.html
>
>
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From codewalkerjoe at gmail.com  Fri Mar 14 23:44:47 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Fri, 14 Mar 2008 19:44:47 -0400
Subject: [rabbitmq-discuss] erlang client crashing
Message-ID: <50ec7a2e0803141644p16e0c4bk2b77e89b73e0e88a@mail.gmail.com>

I have tried using snapshot version of erlang rabbitmq client and rabbitmq
server, but it has not been a success.

client used: rabbitmq-erlang-client-200803131204.tar.gz
server used: rabbitmq-200712231455

Here is the erl shell output.  Maybe someone out there knows what the
problem is.

(rabbit at home1)1> blog_example_1:amqp_lifecycle().
Connection: {<0.160.0>,direct}
Message received: <<"Hello World">>
** exception exit: {{{amqp_channel,handle_info,2},
                     {line,246},
                     function_clause,
                     [{send_command_and_shutdown,{'channel.close_ok'}},
                      {channel_state,1,<0.160.0>,undefined,<0.162.0>,
                          #Fun<amqp_direct_driver.do.2>,
                          #Fun<amqp_direct_driver.do.3>,
                          {<0.46.0>,#Ref<0.0.0.561>},
                          <<>>,false,undefined,
                          {dict,0,16,16,8,80,48,{[],[],...},{{...}}}}]},
                    {gen_server,call,
                        [<0.161.0>,
                         {call,{'channel.close',200,<<"Goodbye">>,0,0}}]}}
     in function  gen_server:call/2
     in call from blog_example_1:amqp_lifecycle/0
(rabbit at home1)2>
=ERROR REPORT==== 14-Mar-2008::19:18:18 ===
** Generic server <0.161.0> terminating
** Last message in was {send_command_and_shutdown,{'channel.close_ok'}}
** When Server state == {channel_state,1,<0.160.0>,undefined,<0.162.0>,
                            #Fun<amqp_direct_driver.do.2>,
                            #Fun<amqp_direct_driver.do.3>,
                            {<0.46.0>,#Ref<0.0.0.561>},
                            <<>>,false,undefined,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}
** Reason for termination ==
** {{amqp_channel,handle_info,2},
    {line,246},
    function_clause,
    [{send_command_and_shutdown,{'channel.close_ok'}},
     {channel_state,1,<0.160.0>,undefined,<0.162.0>,
                    #Fun<amqp_direct_driver.do.2>,
                    #Fun<amqp_direct_driver.do.3>,
                    {<0.46.0>,#Ref<0.0.0.561>},
                    <<>>,false,undefined,
                    {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                            []}}}}]}

=CRASH REPORT==== 14-Mar-2008::19:18:18 ===
  crasher:
    pid: <0.161.0>
    registered_name: []
    exception exit: {{amqp_channel,handle_info,2},
                     {line,246},
                     function_clause,
                     [{send_command_and_shutdown,{'channel.close_ok'}},
                      {channel_state,1,<0.160.0>,undefined,<0.162.0>,
                          #Fun<amqp_direct_driver.do.2>,
                          #Fun<amqp_direct_driver.do.3>,
                          {<0.46.0>,#Ref<0.0.0.561>},
                          <<>>,false,undefined,
                          {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}}}]}
      in function  gen_server:terminate/6
    initial call: gen:init_it(gen_server,<0.160.0>,<0.160.0>,amqp_channel,
                              [{channel_state,1,<0.160.0>,undefined,
                                   undefined,#Fun<amqp_direct_driver.do.2>,
                                   #Fun<amqp_direct_driver.do.3>,undefined,
                                   undefined,false,undefined,
                                   {dict,0,16,16,8,80,48,
                                       {[],[],[],[],[],[],[],[],[],[],[],[],
                                        [],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],
                                         [],[],[],[]}}}}],
                              [])
    ancestors: [<0.160.0>,<0.46.0>]
    messages: []
    links: [<0.160.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 477
  neighbours:


thank you.
joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080314/45fabc70/attachment.htm 

From matthias at lshift.net  Sat Mar 15 11:03:39 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 15 Mar 2008 11:03:39 +0000
Subject: [rabbitmq-discuss] erlang client crashing
In-Reply-To: <50ec7a2e0803141644p16e0c4bk2b77e89b73e0e88a@mail.gmail.com>
References: <50ec7a2e0803141644p16e0c4bk2b77e89b73e0e88a@mail.gmail.com>
Message-ID: <47DBAD0B.6050805@lshift.net>

Joe,

joe lee wrote:
> I have tried using snapshot version of erlang rabbitmq client and 
> rabbitmq server, but it has not been a success. 
> 
> client used: rabbitmq-erlang-client-200803131204.tar.gz
> server used: rabbitmq-200712231455

Looks like your server version is too old.
http://dev.rabbitmq.com/snapshots/rabbitmq-erlang-client/README says that
<quote>
The Erlang client version rabbitmq-erlang-client-200803131204.tar.gz
will not work with a server older than the version available at
http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq-200803131137.tar.gz
</quote>


Matthias.



From 0x6e6562 at gmail.com  Sat Mar 15 11:32:21 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 15 Mar 2008 11:32:21 +0000
Subject: [rabbitmq-discuss] erlang client crashing
In-Reply-To: <47DBAD0B.6050805@lshift.net>
References: <50ec7a2e0803141644p16e0c4bk2b77e89b73e0e88a@mail.gmail.com>
	<47DBAD0B.6050805@lshift.net>
Message-ID: <AC115713-D34D-4D16-8941-0A6C4B309722@gmail.com>

Joe,

As correctly pointed out by Matthias, you are not using compatible  
versions of the client and server.

The specific versions that are known to work together are indicated in  
the download links in the post ( http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html 
  ).

Furthermore, I have updated that blog post to indicate that the  
example test also works with the latest client and server snapshots,  
i.e.

[server]: http://dev.rabbitmq.com/snapshots/rabbitmq/rabbitmq-200803131137.tar.gz
[client]: http://dev.rabbitmq.com/snapshots/rabbitmq-erlang-client/rabbitmq-erlang-client-200803131204.tar.gz

HTH,

Ben

On 15 Mar 2008, at 11:03, Matthias Radestock wrote:

> Joe,
>
> joe lee wrote:
>> I have tried using snapshot version of erlang rabbitmq client and
>> rabbitmq server, but it has not been a success.
>>
>> client used: rabbitmq-erlang-client-200803131204.tar.gz
>> server used: rabbitmq-200712231455
>
> Looks like your server version is too old.
> http://dev.rabbitmq.com/snapshots/rabbitmq-erlang-client/README says  
> that
> <quote>
> The Erlang client version rabbitmq-erlang-client-200803131204.tar.gz
> will not work with a server older than the version available at
> http://dev.rabbitmq.com/snapshots/rabbitmq/ 
> rabbitmq-200803131137.tar.gz
> </quote>
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080315/1e0831a9/attachment.htm 

From alexis.richardson at cohesiveft.com  Sat Mar 15 12:16:27 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 15 Mar 2008 12:16:27 +0000
Subject: [rabbitmq-discuss] NPE in RpcClient
In-Reply-To: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
References: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
Message-ID: <167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>

Neil

Thank-you very much.  That sounds like a really interesting demo.
Please let us know how you get on.  Also - will you be at MuleCon?  I
am going and would love to show anything you have to folks at the
conference.

alexis


On Thu, Mar 13, 2008 at 5:48 PM, Neil Ellis <neil.ellis at mangala.co.uk> wrote:
> Hi Folks
>
>  Not sure if this has already been reported; in version 1.2.0 of lib-
>  rabbitmq there is a NPE if the publish() method has been called on
>  RpcClient because the temp queue picks it up and attempts to call
>  setBody() on the blocker. Trivially chaning blocker.set(body) to have
>  a NP check fixes this:
>
>                     if(blocker != null) {
>                             blocker.set(body);
>                      }
>
>  This was line 150 of RpcClient. I've cc-ed the list for the mule
>  transport as it is the mule transport using publish() that caused my
>  problem.
>
>  Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html
>   and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/
>   - basically we're combining Newton, Mule and RabbitMQ as an
>  illustration of a flexible open-source based messaging system.
>
>  Kind regards
>  Neil
>
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From alexis.richardson at cohesiveft.com  Sat Mar 15 12:19:29 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 15 Mar 2008 12:19:29 +0000
Subject: [rabbitmq-discuss] great introduction to RabbitMQ for the Ruby
	community
Message-ID: <167204d20803150519xcc741cbrd2aed20909e8cd70@mail.gmail.com>

Hi,

Jonathan Conway has done a great movie introducing RabbitMQ and
getting it up and running with Ruby, using Tony's STOMP adapter.

http://jaikoo.com/2008/3/14/oh-hai-rabbitmq

I strongly recommend it.

alexis



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From neil.ellis at mangala.co.uk  Sat Mar 15 16:22:19 2008
From: neil.ellis at mangala.co.uk (Neil Ellis)
Date: Sat, 15 Mar 2008 16:22:19 +0000
Subject: [rabbitmq-discuss] NPE in RpcClient
In-Reply-To: <167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>
References: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
	<167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>
Message-ID: <1CDF016E-B804-47A2-8CDD-13A1DFD27CD6@mangala.co.uk>

Hi Alexis

No probs.

Alas I don't have the budget for jet-setting :-(

I've been having problems with getting the Mule connector to handle  A- 
 >B->C messages although A->B seems okay. If anyone from the RabbitMQ  
side could give me a little hand on getting it up and running that  
would be fabulous - I'm pretty busy at the moment between this work  
and project:Einstein/deesel ( http://einstein.codecauldron.org / http://deesel.codecauldron.org 
  ) so any help would increase the chances of having a demo ready for  
you.

I've restructured the current demo to show

1 Polller Mule instance reading from an RSS feed.
3-5 Worker Mule instances transforming the feed (at least a notional  
idea of work).
1 Displayer Mule instance displaying the transformed results to the  
screen.

It's a bit noddy but it shows how Newton can distribute a set of Mule  
nodes based upon simple criteria, so on a single Newton instance you  
would have all the Mule instances at the same time on one instance, on  
7 instances you would have 1 poller, 3-5 workers and 1 displayer - and  
in between it scales appropriately. And then shows RabbitMQ as the  
internode protocol. We could easily turn this into a demo of running  
RabbitMQ on a large number of nodes with super-easy deployment and  
failover in the future - that's something to think about.

We could certainly help with providing materials (i.e. slides or user  
guide) and help getting you running the demo before hand - in return  
would you be able to ensure that Paremus/myself get appropriate credit  
at the demo for our part (i.e. powered by Newton and the appropriate  
links)?

Anyway let us know - I'm on Skype most of the time - I think you have  
me as a contact (neilellis).

All the best
Neil


On 15 Mar 2008, at 12:16, Alexis Richardson wrote:

> Neil
>
> Thank-you very much.  That sounds like a really interesting demo.
> Please let us know how you get on.  Also - will you be at MuleCon?  I
> am going and would love to show anything you have to folks at the
> conference.
>
> alexis
>
>
> On Thu, Mar 13, 2008 at 5:48 PM, Neil Ellis  
> <neil.ellis at mangala.co.uk> wrote:
>> Hi Folks
>>
>> Not sure if this has already been reported; in version 1.2.0 of lib-
>> rabbitmq there is a NPE if the publish() method has been called on
>> RpcClient because the temp queue picks it up and attempts to call
>> setBody() on the blocker. Trivially chaning blocker.set(body) to have
>> a NP check fixes this:
>>
>>                    if(blocker != null) {
>>                            blocker.set(body);
>>                     }
>>
>> This was line 150 of RpcClient. I've cc-ed the list for the mule
>> transport as it is the mule transport using publish() that caused my
>> problem.
>>
>> Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html
>>  and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/
>>  - basically we're combining Newton, Mule and RabbitMQ as an
>> illustration of a flexible open-source based messaging system.
>>
>> Kind regards
>> Neil
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> -- 
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2431 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080315/be34eb60/attachment.bin 

From themuleman at gmail.com  Sat Mar 15 18:42:21 2008
From: themuleman at gmail.com (Ross Mason)
Date: Sat, 15 Mar 2008 19:42:21 +0100
Subject: [rabbitmq-discuss] NPE in RpcClient
In-Reply-To: <1CDF016E-B804-47A2-8CDD-13A1DFD27CD6@mangala.co.uk>
References: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
	<167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>
	<1CDF016E-B804-47A2-8CDD-13A1DFD27CD6@mangala.co.uk>
Message-ID: <9F35E728-1C63-41D8-8E61-5A3CD762AD99@gmail.com>

Hi Neil,

This does sound interesting.  There is still a fair way to go on the  
Mule Rabbit Transport, but there are some simple use cases that work.
What is the problem you have with A -> B -> C? is it that the message  
doesn't get to C? If so, Are you trying to perform an RPC call from A?  
(i.e.  RPC from A to get a response from C via B).

BTW Guys, I would like to do a Beta release of the Rabbit Connector  
before MuleCon, but right now I snowed under this weekend.

Cheers,

Ross Mason
CTO, Co-Founder
MuleSource Inc.

http://mulesource.com | http://blog.rossmason.com


On 15 Mar 2008, at 17:22, Neil Ellis wrote:

> Hi Alexis
>
> No probs.
>
> Alas I don't have the budget for jet-setting :-(
>
> I've been having problems with getting the Mule connector to handle   
> A->B->C messages although A->B seems okay. If anyone from the  
> RabbitMQ side could give me a little hand on getting it up and  
> running that would be fabulous - I'm pretty busy at the moment  
> between this work and project:Einstein/deesel ( http://einstein.codecauldron.org 
>  / http://deesel.codecauldron.org ) so any help would increase the  
> chances of having a demo ready for you.
>
> I've restructured the current demo to show
>
> 1 Polller Mule instance reading from an RSS feed.
> 3-5 Worker Mule instances transforming the feed (at least a notional  
> idea of work).
> 1 Displayer Mule instance displaying the transformed results to the  
> screen.
>
> It's a bit noddy but it shows how Newton can distribute a set of  
> Mule nodes based upon simple criteria, so on a single Newton  
> instance you would have all the Mule instances at the same time on  
> one instance, on 7 instances you would have 1 poller, 3-5 workers  
> and 1 displayer - and in between it scales appropriately. And then  
> shows RabbitMQ as the internode protocol. We could easily turn this  
> into a demo of running RabbitMQ on a large number of nodes with  
> super-easy deployment and failover in the future - that's something  
> to think about.
>
> We could certainly help with providing materials (i.e. slides or  
> user guide) and help getting you running the demo before hand - in  
> return would you be able to ensure that Paremus/myself get  
> appropriate credit at the demo for our part (i.e. powered by Newton  
> and the appropriate links)?
>
> Anyway let us know - I'm on Skype most of the time - I think you  
> have me as a contact (neilellis).
>
> All the best
> Neil
>
>
> On 15 Mar 2008, at 12:16, Alexis Richardson wrote:
>
>> Neil
>>
>> Thank-you very much.  That sounds like a really interesting demo.
>> Please let us know how you get on.  Also - will you be at MuleCon?  I
>> am going and would love to show anything you have to folks at the
>> conference.
>>
>> alexis
>>
>>
>> On Thu, Mar 13, 2008 at 5:48 PM, Neil Ellis  
>> <neil.ellis at mangala.co.uk> wrote:
>>> Hi Folks
>>>
>>> Not sure if this has already been reported; in version 1.2.0 of lib-
>>> rabbitmq there is a NPE if the publish() method has been called on
>>> RpcClient because the temp queue picks it up and attempts to call
>>> setBody() on the blocker. Trivially chaning blocker.set(body) to  
>>> have
>>> a NP check fixes this:
>>>
>>>                   if(blocker != null) {
>>>                           blocker.set(body);
>>>                    }
>>>
>>> This was line 150 of RpcClient. I've cc-ed the list for the mule
>>> transport as it is the mule transport using publish() that caused my
>>> problem.
>>>
>>> Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html
>>> and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/
>>> - basically we're combining Newton, Mule and RabbitMQ as an
>>> illustration of a flexible open-source based messaging system.
>>>
>>> Kind regards
>>> Neil
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
>> -- 
>> Alexis Richardson
>> +44 20 7617 7339 (UK)
>> +44 77 9865 2911 (cell)
>> +1 650 206 2517 (US)
>




From neil.ellis at mangala.co.uk  Sat Mar 15 18:49:00 2008
From: neil.ellis at mangala.co.uk (Neil Ellis)
Date: Sat, 15 Mar 2008 18:49:00 +0000
Subject: [rabbitmq-discuss] NPE in RpcClient
In-Reply-To: <848F8FFF-0C9C-4E8A-B9EE-7B0FA226206A@mulesource.com>
References: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
	<167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>
	<1CDF016E-B804-47A2-8CDD-13A1DFD27CD6@mangala.co.uk>
	<848F8FFF-0C9C-4E8A-B9EE-7B0FA226206A@mulesource.com>
Message-ID: <CD144B3E-F57B-4680-B30B-CFB9C052133B@mangala.co.uk>

Hi Ross,

Yeah, guessed you might be busy! I did (bar the NPE mentioned at the  
bottom) get the connector working in sync.

I'm going to be back on this properly tomorrow and will detail  
further. However in summary I'm using async on the connector so it's  
calling the RPCClient.publish() method. When I have one instance call  
another it was working okay, when I introduced a third node so that A  
calls B and B calls C I'm getting connection closed errors when the  
exchange is started (i.e. on startup). I'll reset any local hacks on  
the connector tomorrow and send the stack traces back to this list.

If we could get a fixed release together (presuming it's not my screw  
up!!!!!) between us that would be great as I am working on a Mule 
+RabbitMQ+Newton article and we might be able to squeeze that out  
prior to MuleCon if there is the will.

Kind regards
Neil

On 15 Mar 2008, at 18:35, Ross Mason wrote:

> Hi Neil,
>
> This does sound interesting.  There is still a fair way to go on the  
> Mule Rabbit Transport, but there are some simple use cases that work.
> What is the problem you have with A -> B -> C? is it that the  
> message doesn't get to C? If so, Are you trying to perform an RPC  
> call from A? (i.e.  RPC from A to get a response from C via B).
>
> BTW Guys, I would like to do a Beta release of the Rabbit Connector  
> before MuleCon, but right now I snowed under this weekend.
>
> Cheers,
>
> Ross Mason
> CTO, Co-Founder
> MuleSource Inc.
>
> http://mulesource.com | http://blog.rossmason.com
>
>
>
> On 15 Mar 2008, at 17:22, Neil Ellis wrote:
>
>> Hi Alexis
>>
>> No probs.
>>
>> Alas I don't have the budget for jet-setting :-(
>>
>> I've been having problems with getting the Mule connector to  
>> handle  A->B->C messages although A->B seems okay. If anyone from  
>> the RabbitMQ side could give me a little hand on getting it up and  
>> running that would be fabulous - I'm pretty busy at the moment  
>> between this work and project:Einstein/deesel ( http://einstein.codecauldron.org 
>>  / http://deesel.codecauldron.org ) so any help would increase the  
>> chances of having a demo ready for you.
>>
>> I've restructured the current demo to show
>>
>> 1 Polller Mule instance reading from an RSS feed.
>> 3-5 Worker Mule instances transforming the feed (at least a  
>> notional idea of work).
>> 1 Displayer Mule instance displaying the transformed results to the  
>> screen.
>>
>> It's a bit noddy but it shows how Newton can distribute a set of  
>> Mule nodes based upon simple criteria, so on a single Newton  
>> instance you would have all the Mule instances at the same time on  
>> one instance, on 7 instances you would have 1 poller, 3-5 workers  
>> and 1 displayer - and in between it scales appropriately. And then  
>> shows RabbitMQ as the internode protocol. We could easily turn this  
>> into a demo of running RabbitMQ on a large number of nodes with  
>> super-easy deployment and failover in the future - that's something  
>> to think about.
>>
>> We could certainly help with providing materials (i.e. slides or  
>> user guide) and help getting you running the demo before hand - in  
>> return would you be able to ensure that Paremus/myself get  
>> appropriate credit at the demo for our part (i.e. powered by Newton  
>> and the appropriate links)?
>>
>> Anyway let us know - I'm on Skype most of the time - I think you  
>> have me as a contact (neilellis).
>>
>> All the best
>> Neil
>>
>>
>> On 15 Mar 2008, at 12:16, Alexis Richardson wrote:
>>
>>> Neil
>>>
>>> Thank-you very much.  That sounds like a really interesting demo.
>>> Please let us know how you get on.  Also - will you be at  
>>> MuleCon?  I
>>> am going and would love to show anything you have to folks at the
>>> conference.
>>>
>>> alexis
>>>
>>>
>>> On Thu, Mar 13, 2008 at 5:48 PM, Neil Ellis <neil.ellis at mangala.co.uk 
>>> > wrote:
>>>> Hi Folks
>>>>
>>>> Not sure if this has already been reported; in version 1.2.0 of  
>>>> lib-
>>>> rabbitmq there is a NPE if the publish() method has been called on
>>>> RpcClient because the temp queue picks it up and attempts to call
>>>> setBody() on the blocker. Trivially chaning blocker.set(body) to  
>>>> have
>>>> a NP check fixes this:
>>>>
>>>>               if(blocker != null) {
>>>>                       blocker.set(body);
>>>>                }
>>>>
>>>> This was line 150 of RpcClient. I've cc-ed the list for the mule
>>>> transport as it is the mule transport using publish() that caused  
>>>> my
>>>> problem.
>>>>
>>>> Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html
>>>> and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/
>>>> - basically we're combining Newton, Mule and RabbitMQ as an
>>>> illustration of a flexible open-source based messaging system.
>>>>
>>>> Kind regards
>>>> Neil
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>>
>>>
>>> -- 
>>> Alexis Richardson
>>> +44 20 7617 7339 (UK)
>>> +44 77 9865 2911 (cell)
>>> +1 650 206 2517 (US)
>>
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2431 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080315/76be2d7f/attachment.bin 

From themuleman at gmail.com  Sat Mar 15 19:26:23 2008
From: themuleman at gmail.com (Ross Mason)
Date: Sat, 15 Mar 2008 20:26:23 +0100
Subject: [rabbitmq-discuss] Archives
Message-ID: <94164859-9655-4388-A83D-AD4CAB423BF2@gmail.com>

Hi, Is this list archived somewhere?

Cheers,

Ross Mason
CTO, Co-Founder
MuleSource Inc.

http://mulesource.com | http://blog.rossmason.com








From alexis.richardson at cohesiveft.com  Sat Mar 15 20:25:39 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 15 Mar 2008 20:25:39 +0000
Subject: [rabbitmq-discuss] Archives
In-Reply-To: <94164859-9655-4388-A83D-AD4CAB423BF2@gmail.com>
References: <94164859-9655-4388-A83D-AD4CAB423BF2@gmail.com>
Message-ID: <167204d20803151325r6860b60cha288350f311c44b5@mail.gmail.com>

Ross,

Yes; please see: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/

Cheers

alexis


On Sat, Mar 15, 2008 at 7:26 PM, Ross Mason <themuleman at gmail.com> wrote:
> Hi, Is this list archived somewhere?
>
>  Cheers,
>
>  Ross Mason
>  CTO, Co-Founder
>  MuleSource Inc.
>
>  http://mulesource.com | http://blog.rossmason.com
>
>
>
>
>
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From neil.ellis at mangala.co.uk  Sun Mar 16 00:43:28 2008
From: neil.ellis at mangala.co.uk (Neil Ellis)
Date: Sun, 16 Mar 2008 00:43:28 +0000
Subject: [rabbitmq-discuss] NPE in RpcClient
In-Reply-To: <9F35E728-1C63-41D8-8E61-5A3CD762AD99@gmail.com>
References: <6EBAC3E4-BA7A-49DC-A759-EE54318BEFF4@mangala.co.uk>
	<167204d20803150516h3149c909re5f0e182cdf3ae57@mail.gmail.com>
	<1CDF016E-B804-47A2-8CDD-13A1DFD27CD6@mangala.co.uk>
	<9F35E728-1C63-41D8-8E61-5A3CD762AD99@gmail.com>
Message-ID: <6F41E96A-B5C5-4681-8CB4-B8FBE94F0586@mangala.co.uk>



The mule configs are:


------

   <mule-descriptor name="Poller"  
implementation="org.mule.components.simple.BridgeComponent">

             <inbound-router>
                 <endpoint address="http://newsrss.bbc.co.uk/rss/newsonline_uk_edition/front_page/rss.xml 
"
                           connector="pollingHttp">
                     <properties>
                         <property name="pollingFrequency"  
value="10000"/>
                     </properties>
                 </endpoint>
             </inbound-router>

             <outbound-router>
                 <router  
className="org.mule.routing.outbound.FilteringXmlMessageSplitter">
                     <endpoint address="amqp://news:fanout/?routing_key=news 
" synchronous="false" transformers="DOM2String">
                         <filter expectedType="org.dom4j.Document"
                                  
className="org.mule.routing.filters.PayloadTypeFilter"/>
                     </endpoint>
                     <reply-to address="amqp://result:fanout/? 
routing_key=result"/>
                     <properties>
                         <property name="splitExpression" value="/rss/ 
channel/item"/>
                         <property name="validateSchema" value="false"/>
                     </properties>
                 </router>
             </outbound-router>

         </mule-descriptor>

-----

         <mule-descriptor name="Worker"  
implementation="org.mule.components.simple.PassThroughComponent">
             <inbound-router>
                 <endpoint address="amqp://news:fanout/?queue=news"   
transformers="RSSToHeadline" synchronous="false" />
             </inbound-router>
         </mule-descriptor>

-----

         <mule-descriptor name="SimpleReceiver"  
implementation="org.mule.components.simple.EchoComponent">
             <inbound-router>
                 <endpoint address="amqp://result:fanout/? 
queue=result"/>
             </inbound-router>
             <outbound-router>
                 <router  
className="org.mule.routing.outbound.OutboundPassThroughRouter">
                     <endpoint address="stream://System.out"/>
                 </router>
             </outbound-router>
         </mule-descriptor>

----


The above are on 3 different instances of Mule on the same physical  
machine, the RabbitMQ server is running on a seperate VM. The  
exception is below:

 > [03-16 00:37:00] ERROR DefaultExceptionStrategy  
[RabbitMQ.dispatcher.15]: Caught exception in Exception Strategy:  
Socket closed
java.net.SocketException: Socket closed
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:99)
	at java.net.SocketOutputStream.write(SocketOutputStream.java:115)
	at java.io.DataOutputStream.writeByte(DataOutputStream.java:136)
	at com.rabbitmq.client.impl.Frame.writeTo(Frame.java:189)
	at  
com 
.rabbitmq 
.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:146)
	at  
com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java: 
295)
	at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:175)
	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:370)
	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:351)
	at com.rabbitmq.client.RpcClient.publish(RpcClient.java:163)
	at  
com 
.rabbitmq 
.mule.transport.RabbitDispatcher.doDispatch(RabbitDispatcher.java:78)

I'm taking another look at the code right now to see if I can figure  
out what's going wrong.

Kind regards
Neil
On 15 Mar 2008, at 18:42, Ross Mason wrote:

> Hi Neil,
>
> This does sound interesting.  There is still a fair way to go on the
> Mule Rabbit Transport, but there are some simple use cases that work.
> What is the problem you have with A -> B -> C? is it that the message
> doesn't get to C? If so, Are you trying to perform an RPC call from A?
> (i.e.  RPC from A to get a response from C via B).
>
> BTW Guys, I would like to do a Beta release of the Rabbit Connector
> before MuleCon, but right now I snowed under this weekend.
>
> Cheers,
>
> Ross Mason
> CTO, Co-Founder
> MuleSource Inc.
>
> http://mulesource.com | http://blog.rossmason.com
>
>
> On 15 Mar 2008, at 17:22, Neil Ellis wrote:
>
>> Hi Alexis
>>
>> No probs.
>>
>> Alas I don't have the budget for jet-setting :-(
>>
>> I've been having problems with getting the Mule connector to handle
>> A->B->C messages although A->B seems okay. If anyone from the
>> RabbitMQ side could give me a little hand on getting it up and
>> running that would be fabulous - I'm pretty busy at the moment
>> between this work and project:Einstein/deesel ( http://einstein.codecauldron.org
>> / http://deesel.codecauldron.org ) so any help would increase the
>> chances of having a demo ready for you.
>>
>> I've restructured the current demo to show
>>
>> 1 Polller Mule instance reading from an RSS feed.
>> 3-5 Worker Mule instances transforming the feed (at least a notional
>> idea of work).
>> 1 Displayer Mule instance displaying the transformed results to the
>> screen.
>>
>> It's a bit noddy but it shows how Newton can distribute a set of
>> Mule nodes based upon simple criteria, so on a single Newton
>> instance you would have all the Mule instances at the same time on
>> one instance, on 7 instances you would have 1 poller, 3-5 workers
>> and 1 displayer - and in between it scales appropriately. And then
>> shows RabbitMQ as the internode protocol. We could easily turn this
>> into a demo of running RabbitMQ on a large number of nodes with
>> super-easy deployment and failover in the future - that's something
>> to think about.
>>
>> We could certainly help with providing materials (i.e. slides or
>> user guide) and help getting you running the demo before hand - in
>> return would you be able to ensure that Paremus/myself get
>> appropriate credit at the demo for our part (i.e. powered by Newton
>> and the appropriate links)?
>>
>> Anyway let us know - I'm on Skype most of the time - I think you
>> have me as a contact (neilellis).
>>
>> All the best
>> Neil
>>
>>
>> On 15 Mar 2008, at 12:16, Alexis Richardson wrote:
>>
>>> Neil
>>>
>>> Thank-you very much.  That sounds like a really interesting demo.
>>> Please let us know how you get on.  Also - will you be at  
>>> MuleCon?  I
>>> am going and would love to show anything you have to folks at the
>>> conference.
>>>
>>> alexis
>>>
>>>
>>> On Thu, Mar 13, 2008 at 5:48 PM, Neil Ellis
>>> <neil.ellis at mangala.co.uk> wrote:
>>>> Hi Folks
>>>>
>>>> Not sure if this has already been reported; in version 1.2.0 of  
>>>> lib-
>>>> rabbitmq there is a NPE if the publish() method has been called on
>>>> RpcClient because the temp queue picks it up and attempts to call
>>>> setBody() on the blocker. Trivially chaning blocker.set(body) to
>>>> have
>>>> a NP check fixes this:
>>>>
>>>>                  if(blocker != null) {
>>>>                          blocker.set(body);
>>>>                   }
>>>>
>>>> This was line 150 of RpcClient. I've cc-ed the list for the mule
>>>> transport as it is the mule transport using publish() that caused  
>>>> my
>>>> problem.
>>>>
>>>> Btw. The website for the work I'm doing is http://mule4newton.codecauldron.org/mule4newton-examples/mule4newton-rabbitmq/index.html
>>>> and the src is at http://svn.codecauldron.org/mule4newton/trunk/examples/rabbitmq/
>>>> - basically we're combining Newton, Mule and RabbitMQ as an
>>>> illustration of a flexible open-source based messaging system.
>>>>
>>>> Kind regards
>>>> Neil
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>>
>>>
>>> -- 
>>> Alexis Richardson
>>> +44 20 7617 7339 (UK)
>>> +44 77 9865 2911 (cell)
>>> +1 650 206 2517 (US)
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2431 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080316/6848a4bd/attachment.bin 

From matthias at lshift.net  Sun Mar 16 12:47:08 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 16 Mar 2008 12:47:08 +0000
Subject: [rabbitmq-discuss] Status of HTTP/AJAX Binding
In-Reply-To: <19470512-365A-4C65-AA77-F7F2DB408CC6@gmail.com>
References: <19470512-365A-4C65-AA77-F7F2DB408CC6@gmail.com>
Message-ID: <47DD16CC.4010806@lshift.net>

Marcus,

apologies for taking so long to respond to your query ...

Marcus Cavanaugh wrote:
> I've taken an initial glance at the HTTP AMQP binding; it looks  
> promising. I noted that it is still "experimental". Is anyone actively  
> using it, and/or are there known bugs? Also, is there a certain  
> roadmap for when it might be considered suitable for production use?

The HTTP binding is definitely still experimental. We are looking for 
volunteers to test it and develop it further. Would you be interested? 
The code base is quite compact. It shouldn't take long to identify and 
fix any bugs that may arise, and the RabbitMQ development team would be 
happy to offer assistance where needed.


Matthias.



From matthias at lshift.net  Sun Mar 16 13:06:20 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 16 Mar 2008 13:06:20 +0000
Subject: [rabbitmq-discuss] Start Error
In-Reply-To: <ca4787b10803120407p38fa515du3640b57335448d39@mail.gmail.com>
References: <ca4787b10803120401yc40269bt5390c9d74bb17a60@mail.gmail.com>
	<ca4787b10803120407p38fa515du3640b57335448d39@mail.gmail.com>
Message-ID: <47DD1B4C.306@lshift.net>

Eric,

Eric Falconnier wrote:
> the rabbitmq server I have installed doesn't start any more. It seems
> that the problem is related to the 2 persistent exchanges I use

Your RabbitMQ installation appears to have problems reading the 
snapshot/log file for the persistent message store. Under debian that 
file normally lives at /var/lib/rabbitmq/mnesia/rabbit/persister.LOG. 
Please check that the file exists, is readable and writable by the user 
account under which RabbitMQ gets started (normally 'rabbitmq' under 
Debian), and is non-empty.

If the file isn't too large and your persistent messages do not contain 
any sensitive data then feel free to attach the file.

If you don't mind losing the persistent messages then removing the file 
and restarting RabbitMQ should get you going again.

Re persistent exchanges - these do not affect the persistent message 
store, so I don't think they are the source of the problem.


Regards,

Matthias



From matthias at lshift.net  Sun Mar 16 13:20:15 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 16 Mar 2008 13:20:15 +0000
Subject: [rabbitmq-discuss] rabbitmq mnesia table timeout and
 disk_almost_full alarm activated
In-Reply-To: <50ec7a2e0803121606h7889f04eidea7a2829486327f@mail.gmail.com>
References: <50ec7a2e0803121606h7889f04eidea7a2829486327f@mail.gmail.com>
Message-ID: <47DD1E8F.20409@lshift.net>

Joe,

joe lee wrote:
> I am running rabbitmq server snapshot version rabbitmq-200801150657.  I 
> have 500MB of free space in my /home drive and 189MB free on / drive. 
> Have 700MB of free memory and CPU utilization is less 10%.
> 
> I have stopped rabbit app from erl shell.  Then when I restarted erl 
> shell with the same mnesia dir, I get the following: mnesia table 
> timeout and disk_almost_full alarm activated.  In addition, application 
> os_mon is temporarily stopped.

> [joe at home src]$ erl -sname rabbit at home -mnesia dir 
> '"/home/joe/temp/rabbitmq_data"' -boot start_sasl -s rabbit

That command line isn't quite right. Take a look at the rabbitmq-server 
script. You will notice that they disable the memory and disk alarms, as 
well as turning down the SASL log verbosity.

That doesn't explain the table loading timeouts though. What are the 
contents of your mnesia dir?

Do you get that same error when a) starting RabbitMQ with the supplied 
scripts, b) using RabbitMQ 1.2.0, c) clearing the mnesia dir prior to 
starting RabbitMQ?


Matthias.



From adrian at lshift.net  Mon Mar 17 09:49:31 2008
From: adrian at lshift.net (Adrien Pierard)
Date: Mon, 17 Mar 2008 09:49:31 +0000
Subject: [rabbitmq-discuss] Start Error
In-Reply-To: <47DD1B4C.306@lshift.net>
References: <ca4787b10803120401yc40269bt5390c9d74bb17a60@mail.gmail.com>	<ca4787b10803120407p38fa515du3640b57335448d39@mail.gmail.com>
	<47DD1B4C.306@lshift.net>
Message-ID: <47DE3EAB.40200@lshift.net>

Matthias Radestock wrote:

> If the file isn't too large and your persistent messages do not contain 
> any sensitive data then feel free to attach the file.

I have them.

> If you don't mind losing the persistent messages then removing the file 
> and restarting RabbitMQ should get you going again.

That is what I suggested, and it worked according to him.
I didn't have time to look for a conclusive forensic evidence yet.
> Regards,
> 
> Matthias

Cheers,

Adrian

-- 
 [][][] Adrien Pi?rard     | mob_: +44 (0)78 0418 5351
   [][] Senior Developer   | mail: adrian at lshift.net
 []  [] LShift Ltd         | web_: www.lshift.net

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080317/23d22013/attachment.pgp 

From codewalkerjoe at gmail.com  Mon Mar 17 16:53:23 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Mon, 17 Mar 2008 12:53:23 -0400
Subject: [rabbitmq-discuss] rabbitmq erlang client questions: channel access
	and flags
Message-ID: <50ec7a2e0803170953g6974d866lc77c84493c199054@mail.gmail.com>

Hi All,

I was able to get erlang client and erlang rabbitmq server to work
successfully.  I have few questions about channel access by erlang processes
and certain flags in erlang client example that Ben blogged about.

According RabbitMQ Java Client Documentation:
While a Channel can be used by multiple threads, it's important to ensure
 * that only one thread executes a command at once. Concurrent execution of
 * commands will likely cause an UnexpectedFrameError to be thrown.

If you are using erlang client and that you spawn an erlang process for each
message(concurrently), does it mean you have to create new channel/per
erlang concurrent processes?

In addition, what does the following flags mean?
auto_delete
consumer_tag
no_local
no_ack


thank you.
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080317/70e5a901/attachment.htm 

From codewalkerjoe at gmail.com  Mon Mar 17 17:00:23 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Mon, 17 Mar 2008 13:00:23 -0400
Subject: [rabbitmq-discuss] rabbitmq mnesia table timeout and
	disk_almost_full alarm activated
In-Reply-To: <47DD1E8F.20409@lshift.net>
References: <50ec7a2e0803121606h7889f04eidea7a2829486327f@mail.gmail.com>
	<47DD1E8F.20409@lshift.net>
Message-ID: <50ec7a2e0803171000x22280ea8g482f4100a16e6ef5@mail.gmail.com>

> That doesn't explain the table loading timeouts though. What are the
> contents of your mnesia dir?


I think I had a durable queue and aborted the node.  I restarted the rabbit
application with rabbitmq supplied script, rabbitmq 1.2.0 server and reused
the same mnesia dir.  If I supply a different mnesia dir, it all works fine.

thanks,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080317/96cee247/attachment.htm 

From yhe at usatech.com  Mon Mar 17 17:13:41 2008
From: yhe at usatech.com (Ying He)
Date: Mon, 17 Mar 2008 13:13:41 -0400
Subject: [rabbitmq-discuss] flow control
Message-ID: <DC162902A1CB844CBEF4A6753064B42D03584064@usamal03.usatech.com>

Hi, all,

It seems some features are unimplemented but planed for future release. 

 

Could you give an approximate timeline for when the channel.flow flow
control will be included in the future release. It is the way for the
client to pause and restart receiving messages. 

 

Thank you and I am looking forward to hearing back from you.

 

Best,

Ying

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080317/5da26953/attachment.htm 

From matthias at lshift.net  Mon Mar 17 19:06:04 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 17 Mar 2008 19:06:04 +0000
Subject: [rabbitmq-discuss] flow control
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D03584064@usamal03.usatech.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584064@usamal03.usatech.com>
Message-ID: <47DEC11C.7020001@lshift.net>

Ying,

Ying He wrote:
> Could you give an approximate timeline for when the channel.flow flow 
> control will be included in the future release.

We don't have any firm plans for implementing channel.flow, but if there 
is a high demand for it then it will naturally bubble up our priority list.

> It is the way for the client to pause and restart receiving messages.

One possible alternative is for the client to unsubscribe from all its 
queues to stop the flow of messages and then resubscribe to restart.


Matthias.



From 0x6e6562 at gmail.com  Mon Mar 17 20:15:14 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 17 Mar 2008 20:15:14 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client questions: channel
	access and flags
In-Reply-To: <50ec7a2e0803170953g6974d866lc77c84493c199054@mail.gmail.com>
References: <50ec7a2e0803170953g6974d866lc77c84493c199054@mail.gmail.com>
Message-ID: <7BE9872E-3891-4DFB-9F41-E54420D4A131@gmail.com>

Joe,


On 17 Mar 2008, at 16:53, joe lee wrote:

> Hi All,
>
> I was able to get erlang client and erlang rabbitmq server to work  
> successfully.  I have few questions about channel access by erlang  
> processes and certain flags in erlang client example that Ben  
> blogged about.
>
> According RabbitMQ Java Client Documentation:
> While a Channel can be used by multiple threads, it's important to  
> ensure
>  * that only one thread executes a command at once. Concurrent  
> execution of
>  * commands will likely cause an UnexpectedFrameError to be thrown.
>
> If you are using erlang client and that you spawn an erlang process  
> for each message(concurrently), does it mean you have to create new  
> channel/per erlang concurrent processes?

If I understand you correctly, you have a situation with one AMQP  
channel process and more than one user processes who want to use the  
same channel process.

This is possible albeit in a limited fashion, not because of the  
client side implementation, but because of the nature of the protocol.

Essentially,

1) Asynchronous AMQP methods can be sent concurrently;
2) Synchronous AMQP methods must be sent serially.

This is because there is no way to correlate the top and bottom halves  
of a synchronous invocation other than blocking concurrent access to  
the bottom half.

Concurrent access to a synchronous method is detected and an  
illegal_pending_rpc error is thrown. It may be an improvement on the  
library to include the Pid in the error statement.

Fortunately, those methods that you are most likely to want to use  
concurrently are actually asynchronous, i.e. publish and deliver.

The synchronous methods surround for the most part queue declaration,  
binding and general setup/teardown tasks.

These are the kind of things that you probably would not want or need  
to do concurrently.

Having said that, the exceptions to this are the consume and get  
methods.

In the case of consume methods, you could use the consumer_tag  
supplied by the user process to correlate across synchronous RPC  
halves, but you would have to lock on the tag wrt the amqp_channel (to  
allow it guarantee uniqueness), and which defeats the purpose of  
parallelization to a certain extent.

The same logic would theoretically apply to the get method, except  
that there is no tag in the method record to correlate on.

Hence the client's approach is quite simple: force the serialization  
of the synchronous methods.

User processes wanting to handle this situations more gracefully can  
trap this exit.

Please note that this is due to the protocol as opposed to the  
implementation.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Mar 17 20:50:34 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 17 Mar 2008 20:50:34 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client questions: channel
	access and flags
In-Reply-To: <50ec7a2e0803170953g6974d866lc77c84493c199054@mail.gmail.com>
References: <50ec7a2e0803170953g6974d866lc77c84493c199054@mail.gmail.com>
Message-ID: <99BC29F2-5FC8-4877-8601-0D27E98FAC81@gmail.com>

Joe,

This is taken from the amqp0-8.xml.

On 17 Mar 2008, at 16:53, joe lee wrote:
> In addition, what does the following flags mean?
> auto_delete

auto-delete queue or exchange when unused

>
> consumer_tag

<domain name="consumer tag" type="shortstr">
     consumer tag
     <doc>
       Identifier for the consumer, valid within the current connection.
     </doc>
     <rule implement="MUST">
       The consumer tag is valid only within the channel from which the
       consumer was created. I.e. a client MUST NOT create a consumer in
       one channel and then use it in another.
     </rule>
   </domain>

>
> no_local

<domain name="no local" type="bit">
     do not deliver own messages
     <doc>
     If the no-local field is set the server will not send messages to
     the client that published them.
     </doc>
   </domain>

>
> no_ack

<domain name="no ack" type="bit">
     no acknowledgement needed
     <doc>
       If this field is set the server does not expect acknowledgments
       for messages.  That is, when a message is delivered to the client
       the server automatically and silently acknowledges it on behalf
       of the client.  This functionality increases performance but at
       the cost of reliability.  Messages can get lost if a client dies
       before it can deliver them to the application.
     </doc>
   </domain>

HTH,

Ben



From alexis.richardson at cohesiveft.com  Tue Mar 18 14:32:38 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 18 Mar 2008 14:32:38 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <c9e66b9a0803011355qc2b6cf5oaddfd9af6e153aa4@mail.gmail.com>
References: <47A3B5C2.6070100@lshift.net> <15549124.post@talk.nabble.com>
	<47C66BFC.4010001@lshift.net>
	<c9e66b9a0803011355qc2b6cf5oaddfd9af6e153aa4@mail.gmail.com>
Message-ID: <167204d20803180732n4f64d983w2be6564be6ea36c1@mail.gmail.com>

Derek

You've been written up on InfoQ :-)

http://www.infoq.com/news/2008/03/flex-rabbitmq-stomp

alexis


On Sat, Mar 1, 2008 at 9:55 PM, Derek Wischusen <dwischusen at gmail.com> wrote:
> Hey Tony,
>
> The headers that you have listed probably cover all of the ones that I would
> want to see.  I'll add these to the Flex/Flash STOMP client in my next
> update.
>
> My only other suggestion/request (which I think you are planning to do)
> would be to distribute the STOMP adapter with the main RabbitMQ installer.
>
> Thanks again!
>
> Derek
>
>
>
> On Thu, Feb 28, 2008 at 3:08 AM, Tony Garnock-Jones <tonyg at lshift.net>
> wrote:
> > Hi Derek,
> >
> >
> > Derek Wischusen wrote:
> > > Thank you for creating this adapter.  I just tested it out with the
> > > ActionScript (Flash/Flex) Stomp client and everything seemed to work
> quite
> > > well.  If anyone is interested, I wrote up a short post about it here:
> > > http://flexonrails.net/?p=106.
> >
> > Awesome post!
> >
> >
> > > Are you planning on adding any custom AMQP specific extensions to the
> > > protocol like ActiveMQ does for JMS (see
> > > http://activemq.apache.org/stomp.html)?  It looks like there is already
> one
> > > for specifying an exchange. Do you think you might add others?
> >
> > Yes. I want to keep to the protocol definition as closely as possible,
> > but to provide extensions to allow people to use more of the
> > AMQP-specific features that are available. You're right about the
> > exchange extension. So far, refreshing my memory by looking at the code,
> > the extensions are:
> >
> >  - "virtual-host" and "realm" headers on CONNECT, for exploiting
> >    RabbitMQ's implementation of AMQP's authorization features
> >  - "exchange" on SEND - if omitted, the default ("") exchange is used
> >
> > If you have anything in mind you'd like to see added, please let me
> > know. I need feedback to decide what direction to take the STOMP adapter
> in.
> >
> > Regards,
> >   Tony
> >
> >
>
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From yhe at usatech.com  Tue Mar 18 21:21:45 2008
From: yhe at usatech.com (Ying He)
Date: Tue, 18 Mar 2008 17:21:45 -0400
Subject: [rabbitmq-discuss] outstanding RPC
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D0358405B@usamal03.usatech.com>
References: <47C7FB1B.2060403@lshift.net>
	<DC162902A1CB844CBEF4A6753064B42D0358405B@usamal03.usatech.com>
Message-ID: <DC162902A1CB844CBEF4A6753064B42D03584067@usamal03.usatech.com>

Hi all,

Any idea what might cause the following? 
java.lang.IllegalStateException: Oops, outstanding RPC
	at
com.rabbitmq.client.impl.AMQChannel.enqueueRpc(AMQChannel.java:156)
	at
com.rabbitmq.client.impl.AMQChannel.transmitAndEnqueue(AMQChannel.java:1
64)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:209)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:195)
	at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:124)
	at
com.rabbitmq.client.impl.ChannelN.accessRequest(ChannelN.java:331)
	at
com.rabbitmq.client.impl.ChannelN.accessRequest(ChannelN.java:312)


I appreciate your help. Thanks.

Best,
ying



From matthias at lshift.net  Wed Mar 19 06:22:30 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 19 Mar 2008 06:22:30 +0000
Subject: [rabbitmq-discuss] outstanding RPC
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D03584067@usamal03.usatech.com>
References: <47C7FB1B.2060403@lshift.net>	<DC162902A1CB844CBEF4A6753064B42D0358405B@usamal03.usatech.com>
	<DC162902A1CB844CBEF4A6753064B42D03584067@usamal03.usatech.com>
Message-ID: <47E0B126.4090001@lshift.net>

Ying,

Ying He wrote:
> Any idea what might cause the following? 
> java.lang.IllegalStateException: Oops, outstanding RPC

I suspect you are attempting to concurrently use a single channel from 
multiple threads, which is illegal. See
   http://www.rabbitmq.com/api-guide.html#channel-threads

The exception report and docs should make that more obvious. I have 
filed a bug for that.


Matthias.



From cameron.taggart at gmail.com  Wed Mar 19 07:23:33 2008
From: cameron.taggart at gmail.com (Cameron Taggart)
Date: Wed, 19 Mar 2008 00:23:33 -0700
Subject: [rabbitmq-discuss] Roadmap to 0-10?
Message-ID: <c3606140803190023y5374e55and9c9e9679b2a3a7a@mail.gmail.com>

The roadmap [1] doesn't mention new AMQP versions like the recently
released 0-10.  Are there plans to support it or even 0-9?  I need to
connect to the broker from Java and C clients.  I do not see any
mention of OpenAMQ WireAPI [2] on the interoperability page.  I
imagine they are not interoperable since the WireAPI is for 0-9.  Is
support for newer protocol versions planned for any upcoming release?
Is a 1.3.0 release around the corner?

[1] http://www.rabbitmq.com/roadmap.html
[2] http://www.openamq.org/wireapi.html
[3] http://www.rabbitmq.com/interoperability.html

cheers,
Cameron



From alexis.richardson at cohesiveft.com  Wed Mar 19 08:05:14 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 19 Mar 2008 08:05:14 +0000
Subject: [rabbitmq-discuss] Roadmap to 0-10?
In-Reply-To: <c3606140803190023y5374e55and9c9e9679b2a3a7a@mail.gmail.com>
References: <c3606140803190023y5374e55and9c9e9679b2a3a7a@mail.gmail.com>
Message-ID: <167204d20803190105p10ebc90ep51445675f431202@mail.gmail.com>

Cameron

Good morning :-)

In reverse order ---

3.  Yes, it is in testing at the moment.
2.  We are working with the OpenAMQ team on 0-9 clients.  You can help
us all modify the OpenAMQ C client for 0-8 if you like!
1.  We put a lot of work into 0-10 along with several other members of
the WG, and have an 0-10 design in mind.  However the next release of
RabbitMQ after 1.3 will be an interop release (1.4) around the 0-8/0-9
protocols to consolidate across all current use cases of AMQP.

Please note that in this we are guided by what our users and customers
tell us they want!  You are most welcome to get involved and influence
the direction of the roadmap.

Cheers

alexis


On Wed, Mar 19, 2008 at 7:23 AM, Cameron Taggart
<cameron.taggart at gmail.com> wrote:
> The roadmap [1] doesn't mention new AMQP versions like the recently
>  released 0-10.  Are there plans to support it or even 0-9?  I need to
>  connect to the broker from Java and C clients.  I do not see any
>  mention of OpenAMQ WireAPI [2] on the interoperability page.  I
>  imagine they are not interoperable since the WireAPI is for 0-9.  Is
>  support for newer protocol versions planned for any upcoming release?
>  Is a 1.3.0 release around the corner?
>
>  [1] http://www.rabbitmq.com/roadmap.html
>  [2] http://www.openamq.org/wireapi.html
>  [3] http://www.rabbitmq.com/interoperability.html
>
>  cheers,
>  Cameron
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From michel.polder at quality-it.com  Wed Mar 19 10:15:24 2008
From: michel.polder at quality-it.com (Michel Polder)
Date: Wed, 19 Mar 2008 11:15:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET C# Client
Message-ID: <20080319100950.M77533@quality-it.com>

I'm trying to connect to a OpenAMQ 1.2c4 server with the logtail example
from the RabbitMQ.NET client. The "using (IModel ch = conn.CreateModel())"
line fails with the following exception:

RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was
 interrupted: AMQP close-reason, initiated by Library, code=541, text="Unexpecte
d Exception", classId=0, methodId=0, cause=System.IO.IOException: Unable to read
 data from the transport connection: A connection attempt failed because the con
nected party did not properly respond after a period of time, or established con
nection failed because connected host has failed to respond. ---> System.Net.Soc
kets.SocketException: A connection attempt failed because the connected party di
d not properly respond after a period of time, or established connection failed
because connected host has failed to respond
   at System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset, Int32
size, SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset, Int32
size)
   --- End of inner exception stack trace ---
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset, Int32
size)
   at System.IO.Stream.ReadByte()
   at System.IO.BinaryReader.ReadByte()
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBase header, Byte[] body)
   at RabbitMQ.Client.Framing.Impl.v0_9.Model._Private_AccessRequest(String
realm, Boolean exclusive, Boolean passive, Boolean active, Boolean write,
Boolean read)
   at RabbitMQ.Client.Impl.ModelBase.AccessRequest(String realm, Boolean
exclusive, Boolean passive, Boolean active, Boolean write, Boolean read)
   at RabbitMQ.Client.Impl.ModelBase.AccessRequest(String realm)
   at RabbitMQ.Client.Examples.LogTail.Main(String[] args)

I'm using the following commandline for the logtail example (OpenAMQ server 
runs locally)

logtail 127.0.0.1:5672 PRICES topic PRC.*.*.*.*

Any idea what's going on??



From matthias at lshift.net  Mon Mar 24 18:02:15 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 24 Mar 2008 18:02:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ .NET C# Client
In-Reply-To: <20080319100950.M77533@quality-it.com>
References: <20080319100950.M77533@quality-it.com>
Message-ID: <47E7ECA7.2060807@lshift.net>

Michel,

Michel Polder wrote:
> I'm trying to connect to a OpenAMQ 1.2c4 server with the logtail example
> from the RabbitMQ.NET client. The "using (IModel ch = conn.CreateModel())"
> line fails with the following exception:
> [...]
>    at RabbitMQ.Client.Impl.ModelBase.AccessRequest(String realm)
>    at RabbitMQ.Client.Examples.LogTail.Main(String[] args)

IIRC OpenAMQ does not support the AMQP access class and, furthermore, 
simply closes the socket when it receives an access.request rather than 
reporting an error.

To get around that, suppress the access.request methods with the 
RabbitMQ.Client.ConnectionParameters.AccessRequestConfig property.


Regards,

Matthias.



From matthias at lshift.net  Mon Mar 24 19:07:31 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 24 Mar 2008 19:07:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ .NET C# Client
In-Reply-To: <47E7ECA7.2060807@lshift.net>
References: <20080319100950.M77533@quality-it.com>
	<47E7ECA7.2060807@lshift.net>
Message-ID: <47E7FBF3.6050609@lshift.net>

Michel,

Matthias Radestock wrote:
> To get around that, suppress the access.request methods with the 
> RabbitMQ.Client.ConnectionParameters.AccessRequestConfig property.

You can also achieve the same effect by setting the AMQP_ACCESS_REQUEST 
environment variable to SUPPRESS, which means you can run the program 
unmodified, e.g. with
   export AMQP_ACCESS_REQUEST=SUPPRESS; ./myprogram
(the exact syntax differs depending on your shell, obviously).


Matthias.



From 0x6e6562 at gmail.com  Mon Mar 24 21:21:17 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 24 Mar 2008 21:21:17 +0000
Subject: [rabbitmq-discuss] AS3 library
Message-ID: <651E9386-F207-42D0-824B-030D1504FD57@gmail.com>

Hi all,

I've made a first cut of the AS3 client for AMQP.

This is a complete re-wrtite of the proof-of-concept client discussed  
previously on this list.

The project is hosted on sharesource (http://sharesource.org/project/as3amqp/ 
), the source tree is at http://hg.sharesource.org/as3amqp.

This article describes it's usage: http://hopper.squarespace.com/blog/2008/3/24/as3-amqp-client-first-cut.html 
.

Comments and suggestions are welcome,

Ben



From chime at mu.dk  Tue Mar 25 14:55:10 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 25 Mar 2008 15:55:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <52716978-7CC4-4BC6-8A30-371475F438C6@mu.dk>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>	<47D8F8B5.1060708@lshift.net>
	<3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>
	<47D94424.7090000@lshift.net>
	<52716978-7CC4-4BC6-8A30-371475F438C6@mu.dk>
Message-ID: <63866C0B-1CA6-43C2-B91A-51CEF7E5A8A9@mu.dk>

Matthias (and others)

Could this http://www.nabble.com/Unix-spawn-driver-does-not-close-all-file-descriptors-in-child-process-td15796733.html 
  explain some of the weirdness we have seen on OS X?

Michael

On Mar 13, 2008, at 16:36 , Michael Arnoldus wrote:

> Matthias,
>
> Seen on several Mac's here, but the one where we have the problem  
> right now is a Quad-core 2,8 GHz Mac Pro. Also seen on a dual core.  
> 2 GB Mem. Running Mac OS X 10.5.2 (Leopard). Erlang 11B-5, Rabbit  
> 1.2.0.
>
> I actually have a system running with the problem, so if I can help  
> in any way tracing the problem down, let me know.
>
> Yes, Mac OS X has dtrace.
>
> It seems to me like it should be possible to find an possible  
> infinite loop on writev error writing to a socket, either in the  
> erlang code or the rabbit code (but then again - what do I know :-)  
> Let me know if you have any suggestions on where I should start  
> looking.
>
> Michael
>
>
>
> On Mar 13, 2008, at 16:11 , Matthias Radestock wrote:
>
>> Michael,
>>
>> Michael Arnoldus wrote:
>>> Thank you for your suggestion. There is no strace on Mac OS X, but  
>>> I did find a way to see what the C-program was doing (see below).
>>
>> I gather there's ktrace and/or dtrace.
>>
>>> Most of the threads are just waiting (as expected) but a single  
>>> one seems always to be in some kind of tcp_send_error.
>>
>> That is interesting. Tony has seen similar symptoms on his MacBook  
>> here, but so far we have failed to reproduce the problem anywhere  
>> else.
>>
>> Please let us know as much about your system as possible. Exact OS  
>> version, Erlang/OTP version, RabbitMQ version, number and exact  
>> type of processors, memory configuration, and anything else you can  
>> think of that might be relevant.
>>
>>
>> Matthias.
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080325/99e44bd4/attachment.bin 

From matthias at lshift.net  Tue Mar 25 18:31:28 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 25 Mar 2008 18:31:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <63866C0B-1CA6-43C2-B91A-51CEF7E5A8A9@mu.dk>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>	<47D8F8B5.1060708@lshift.net>	<3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>	<47D94424.7090000@lshift.net>	<52716978-7CC4-4BC6-8A30-371475F438C6@mu.dk>
	<63866C0B-1CA6-43C2-B91A-51CEF7E5A8A9@mu.dk>
Message-ID: <47E94500.6090100@lshift.net>

Michael,

Michael Arnoldus wrote:
> Could this 
> http://www.nabble.com/Unix-spawn-driver-does-not-close-all-file-descriptors-in-child-process-td15796733.html explain 
> some of the weirdness we have seen on OS X?

Possibly, but a) we have only seen the problem on Leopard, and not on 
any earlier versions of Mac OS X, and b) AFAIK rabbit doesn't do any 
spawning.


Matthias.



From chime at mu.dk  Tue Mar 25 20:44:29 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 25 Mar 2008 21:44:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ running at 100% CPU.
In-Reply-To: <47E94500.6090100@lshift.net>
References: <D1C366E4-8FB0-4E33-9E77-27849CE6A3D3@mu.dk>	<47D8F8B5.1060708@lshift.net>	<3DDE342B-052C-4FC9-9596-FE0F88EB8778@mu.dk>	<47D94424.7090000@lshift.net>	<52716978-7CC4-4BC6-8A30-371475F438C6@mu.dk>
	<63866C0B-1CA6-43C2-B91A-51CEF7E5A8A9@mu.dk>
	<47E94500.6090100@lshift.net>
Message-ID: <68E7D8C9-9DD2-42F3-8AB5-677DFB174204@mu.dk>

Oh well - I'll keep searching as it seems to reappear every week.

Thanks for your reply!

Michael

On Mar 25, 2008, at 19:31 , Matthias Radestock wrote:

> Michael,
>
> Michael Arnoldus wrote:
>> Could this http://www.nabble.com/Unix-spawn-driver-does-not-close-all-file-descriptors-in-child-process-td15796733.html 
>>  explain some of the weirdness we have seen on OS X?
>
> Possibly, but a) we have only seen the problem on Leopard, and not  
> on any earlier versions of Mac OS X, and b) AFAIK rabbit doesn't do  
> any spawning.
>
>
> Matthias.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080325/2bcb28c9/attachment.bin 

From alexis.richardson at cohesiveft.com  Wed Mar 26 11:01:47 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 26 Mar 2008 11:01:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ meet-up in San Francisco
Message-ID: <167204d20803260401la2b288bo2257c1e7920fd348@mail.gmail.com>

Hi everyone

I am visiting San Francisco from Friday 28th March, at the end of this
week, until Wednesday April 2nd.  I shall be attending MuleCon on
April 1st and 2nd.

I'd like to invite folks to meet me for a beer on Friday evening.  If
you would like to join me, please get in touch.  Also, if anyone wants
a Rabbit t-shirt let me know your size.  They are black and feature
four jumping Rabbit logos plus the legend 'Go forth and multiply'.
Very stylish.

alexis


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From richard at richardgillingham.com  Thu Mar 27 20:53:10 2008
From: richard at richardgillingham.com (Richard Gillingham)
Date: Thu, 27 Mar 2008 20:53:10 -0000
Subject: [rabbitmq-discuss] OpenAMQP client
Message-ID: <000301c8904c$91a4ccb0$b4ee6610$@com>

Hello All

 

Has anyone tried to use the OpenAMQP C++ binding with Rabbit??

 

I want to bind some Delphi Win32 application servers to a RabbitMQ hub.  I
have the choice of either writing a Delphi AMQP client or getting a C++ (or
even C#) binding going to then bridge in to the Delphi code.

 

Thanks in advance

 

Richard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080327/749d75fd/attachment.htm 

From alexis.richardson at cohesiveft.com  Thu Mar 27 23:12:14 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 27 Mar 2008 23:12:14 +0000
Subject: [rabbitmq-discuss] OpenAMQP client
In-Reply-To: <000301c8904c$91a4ccb0$b4ee6610$@com>
References: <000301c8904c$91a4ccb0$b4ee6610$@com>
Message-ID: <167204d20803271612m5fa60af3l85558fdadacd1654@mail.gmail.com>

Richard

Yes people have tried.  Yes, it works if you are prepared to make just
a few small mods to the client.  No, annoyingly and embarrassingly, an
'out of the box' client is not available as an open source download.
We hope to fix this.  Or, you would be very very welcome indeed, to
help us do so.

OTOH .... you mention C# -- please try our C# client here:
http://www.rabbitmq.com/dotnet.html

alexis


On Thu, Mar 27, 2008 at 8:53 PM, Richard Gillingham
<richard at richardgillingham.com> wrote:
>
>
>
>
> Hello All
>
>
>
> Has anyone tried to use the OpenAMQP C++ binding with Rabbit??
>
>
>
> I want to bind some Delphi Win32 application servers to a RabbitMQ hub.  I
> have the choice of either writing a Delphi AMQP client or getting a C++ (or
> even C#) binding going to then bridge in to the Delphi code.
>
>
>
> Thanks in advance
>
>
>
> Richard
>
> __________ Information from ESET NOD32 Antivirus, version of virus signature
> database 2979 (20080327) __________
>
> The message was checked by ESET NOD32 Antivirus.
>
> http://www.eset.com
>
> _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From billc at inworksol.com  Sun Mar 30 07:00:37 2008
From: billc at inworksol.com (Bill Chikirivao)
Date: Sat, 29 Mar 2008 23:00:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Errors using Windows .NET Client Library
Message-ID: <576289.25874.qm@web806.biz.mail.mud.yahoo.com>

Please can someone help me with an explanation.  I really appreciate any help you can give me.I am getting some errors when I try to run any of the examples that come with the .NET rabbitmq-dotnet-1.2.8025.1832-net-2.0 download.  I am running RabbitMQ server 1.2.0 which comes from the bundles in the windows  complete-rabbitmq-bundle-1.2.0.zip download.  When I run any of the samples I get the following error:

{RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protocol negotiation failure: server version 0-8, transport parameters -1:-1
   at RabbitMQ.Client.Impl.ConnectionBase.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.Connection..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateConnection(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)}

If I make code changes such that I change the protocol to AMQP_0_8 in my app.config file and then set the protocol as Protocols.FromConfiguration("my-protocol");
Then I am able to connect and I don't get the same exception.  Is this the expected behavior?  and further does the RabbitMQ server only support AMQP 0-8?  And if the examples are primarily targeted for RabbitMQ then why have the default to AMQP 0-9 such that you have to explicitly change the protocol to 0-8 when running against RabbitMQ?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080329/7661da2b/attachment.htm 

From matthias at lshift.net  Sun Mar 30 09:17:50 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 30 Mar 2008 09:17:50 +0100
Subject: [rabbitmq-discuss] Errors using Windows .NET Client Library
In-Reply-To: <576289.25874.qm@web806.biz.mail.mud.yahoo.com>
References: <576289.25874.qm@web806.biz.mail.mud.yahoo.com>
Message-ID: <47EF4CAE.5000500@lshift.net>

Bill,

Bill Chikirivao wrote:
> If I make code changes such that I change the protocol to AMQP_0_8 in my 
> app.config file and then set the protocol as 
> Protocols.FromConfiguration("my-protocol");
> Then I am able to connect and I don't get the same exception.  Is this 
> the expected behavior?

Yes, that is the expected behaviour. Note that you can switch protocols 
without changing the code by setting the AMQP_PROTOCOL environment 
variable, e.g. run the examples like this
   AMQP_PROTOCOL=AMQP_0_8 ./bin/ExampleProgram.exe

> and further does the RabbitMQ server only support AMQP 0-8?

Correct. 0-9 support is under development.

> And if the examples are primarily targeted for 
> RabbitMQ then why have the default to AMQP 0-9 such that you have to 
> explicitly change the protocol to 0-8 when running against RabbitMQ?

The .NET client was actually developed with a different broker as the 
primary target. Your point is valid though; we should change the default 
to whatever protocol is supported by the latest version of the RabbitMQ 
broker.

Matthias.



From billc at inworksol.com  Sun Mar 30 10:25:40 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 02:25:40 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client Library Shared Queue Closed Error on
	Subscription When No Msgs in Queue
Message-ID: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>

Please can you help me with the following error.  Using the examples that come with the .NET Cllient Library I have written a small program that creates a subscription and reads any published messages in the queue.  The code works and reads any messages in the queue, however when there are no more messages left to read in the Queue or when you run the program without any messages in the queue (i.e. when the queue is empty) the connection simply closes and throws the following EndOfStreamException:

System.IO.EndOfStreamException: SharedQueue closed
   at RabbitMQ.Util.SharedQueue.EnsureIsOpen()
   at RabbitMQ.Util.SharedQueue.Dequeue()
   at ConsoleApplication2.Program.Main(String[] args) in C:\rabbitmqdotnet\testw
indowsapp\ConsoleApplication2\ConsoleApplication2\Program.cs:line 47

Here is a listing of the source code.  Thanks for all your help.

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using RabbitMQ.Client;
using System.IO;
using RabbitMQ.Client.Content;
using RabbitMQ.Client.Events;
using RabbitMQ.Client.MessagePatterns;
using RabbitMQ.Util;


namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {

            IProtocol protocol = Protocols.FromConfiguration("my-protocol");
            string hostName = "10.10.10.25";
            int portNumber = 5678;
            string exchangeName = "testexchange";
            string queueName = "testqueue";
            string routingKey = "routingkey";
            ConnectionFactory factory = new ConnectionFactory();
            IConnection conn = factory.CreateConnection(protocol, hostName, portNumber);
            IModel channel = conn.CreateModel();
            string realm = "/data";
            ushort ticket = channel.AccessRequest(realm);
            channel.ExchangeDeclare(ticket, exchangeName, ExchangeType.Direct);
            channel.QueueDeclare(ticket, queueName);
            channel.QueueBind(ticket, queueName, exchangeName, routingKey, false, null);

            QueueingBasicConsumer consumer = new QueueingBasicConsumer(channel);
            channel.BasicConsume(ticket, queueName, null, consumer);
            Console.WriteLine("Entering Loop .. Please press Control C to exit");
            while (true)
            {
                try
                {
                    
                    else
                    {
                        RabbitMQ.Client.Events.BasicDeliverEventArgs e2 =
                        (RabbitMQ.Client.Events.BasicDeliverEventArgs)consumer.Queue.Dequeue();
                        IBasicProperties props = e2.BasicProperties;
                        byte[] body = e2.Body;
                        
                        string str = System.Text.Encoding.UTF8.GetString(body);
                        
                        Console.WriteLine(str);
                        channel.BasicAck(e2.DeliveryTag, false);
                    }
                }
                catch (EndOfStreamException ex)
                {
                    // The consumer was removed, either through
                    // channel or connection closure, or through the
                    // action of IModel.BasicCancel().
                    
                    Console.WriteLine(ex.ToString());
                  break;
                }
            }
        }
    }
}







From matthias at lshift.net  Sun Mar 30 12:24:08 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 30 Mar 2008 12:24:08 +0100
Subject: [rabbitmq-discuss] .NET Client Library Shared Queue Closed
 Error on	Subscription When No Msgs in Queue
In-Reply-To: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>
References: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>
Message-ID: <47EF7858.9030000@lshift.net>

Bill,

BillC wrote:
> Please can you help me with the following error.  Using the examples
> that come with the .NET Cllient Library I have written a small
> program that creates a subscription and reads any published messages
> in the queue.  The code works and reads any messages in the queue,
> however when there are no more messages left to read in the Queue or
> when you run the program without any messages in the queue (i.e. when
> the queue is empty) the connection simply closes and throws the
> following EndOfStreamException:
> 
> System.IO.EndOfStreamException: SharedQueue closed at
> RabbitMQ.Util.SharedQueue.EnsureIsOpen() at
> RabbitMQ.Util.SharedQueue.Dequeue() at
> ConsoleApplication2.Program.Main(String[] args) in
> C:\rabbitmqdotnet\testw 
> indowsapp\ConsoleApplication2\ConsoleApplication2\Program.cs:line 47

Your program looks fine; the Dequeue() call should block when there are 
no more messages available.

To track down the problem it would be useful to get a trace of the 
client/server communication with, e.g., the tracer program that ships 
with the RabbitMQ Java client. See 
http://stage.rabbitmq.com/examples.html#tracer


Matthias.



From 0x6e6562 at gmail.com  Sun Mar 30 13:09:44 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 30 Mar 2008 13:09:44 +0100
Subject: [rabbitmq-discuss] .NET Client Library Shared Queue Closed
	Error on	Subscription When No Msgs in Queue
In-Reply-To: <47EF7858.9030000@lshift.net>
References: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>
	<47EF7858.9030000@lshift.net>
Message-ID: <3BAAC64E-F934-44D3-BAEE-C9CC0F7F0653@gmail.com>

Matthias,

> http://stage.rabbitmq.com/examples.html#tracer

Might just be me, but I don't think that this URL is visible externally.

Ben



From matthias at lshift.net  Sun Mar 30 13:36:03 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 30 Mar 2008 13:36:03 +0100
Subject: [rabbitmq-discuss] .NET Client Library Shared Queue
 Closed	Error on	Subscription When No Msgs in Queue
In-Reply-To: <3BAAC64E-F934-44D3-BAEE-C9CC0F7F0653@gmail.com>
References: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>	<47EF7858.9030000@lshift.net>
	<3BAAC64E-F934-44D3-BAEE-C9CC0F7F0653@gmail.com>
Message-ID: <47EF8933.20300@lshift.net>

Ben Hood wrote:
>> http://stage.rabbitmq.com/examples.html#tracer
> 
> Might just be me, but I don't think that this URL is visible externally.

Well spotted. I meant

http://www.rabbitmq.com/examples.html#tracer


Matthias.



From billc at inworksol.com  Sun Mar 30 18:27:55 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 10:27:55 -0700 (PDT)
Subject: [rabbitmq-discuss] How to Use the Java AMQP Protocol
	Capture/Analysis Tool
Message-ID: <913844.22652.qm@web807.biz.mail.mud.yahoo.com>

AMQP Protocol Capture/Analysis Tool
Thanks for all your help and  for your quick responses.  I really appreciate it.  I ran the AMQP Tracer as per the instructions below and Tracer is running as:

C:\downloads\complete-rabbitmq-bundle-1.2.0\librabbitmq-java-1.2.0>runjava com.r
abbitmq.tools.Tracer
Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 5673 localhost 5672

My RabbitMQ is running on my localhost using the default 5672 port.  

Now, I don't have the source code to the Tracer so I don't know what its suppose to do.  Does it log messages to log file when I run my application or should it show the log on the screen.  I have run it and it doesn't seem to be logging any interactions when I run my .net program.  

I used the following instructions to run it:

		  There's a very basic, very simple AMQP protocol analyzer in	  class com.rabbitmq.tools.Tracer. Invoke it with	
	runjava.sh com.rabbitmq.tools.Tracer listenPort connectHost connectPort	
	  
listenPortport to listen for incoming AMQP connections on - defaults to 5673.connectHosthostname to use when making an outbound connection in response to an incoming connection - defaults to localhost.connectPortport number to use when making an outbound connection - defaults to 5672.




From tonyg at lshift.net  Sun Mar 30 18:44:48 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 30 Mar 2008 18:44:48 +0100
Subject: [rabbitmq-discuss] How to Use the Java AMQP
 Protocol	Capture/Analysis Tool
In-Reply-To: <913844.22652.qm@web807.biz.mail.mud.yahoo.com>
References: <913844.22652.qm@web807.biz.mail.mud.yahoo.com>
Message-ID: <47EFD190.8070406@lshift.net>

Hi Bill,

BillC wrote:
> Now, I don't have the source code to the Tracer so I don't know what
> its suppose to do.  Does it log messages to log file when I run my
> application or should it show the log on the screen.  I have run it
> and it doesn't seem to be logging any interactions when I run my .net
> program.

It should print out all activity in both directions when an AMQP client 
connects to it.

You should set things up like this:

   your program -------------> ]- 5673 Tracer -------> ]- 5672 RabbitMQ

so you connect to port 5673, the Tracer does its thing, and opens an 
outbound connection to port 5672. It will then relay all frames sent and 
received, printing them to stdout as it goes.

Regards,
   Tony




From billc at inworksol.com  Sun Mar 30 18:45:33 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 10:45:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Fw: Errors using Windows .NET Client Library
Message-ID: <503518.84230.qm@web803.biz.mail.mud.yahoo.com>

Thanks for all your help.

I tried to run the same program using your remote server "dev.rabbitmq.com" and I still get the same errors as described below:

Please can someone help me with an explanation.  I really appreciate any help you can give me.I am getting some errors when I try to run any of the examples that come with the .NET rabbitmq-dotnet-1.2.8025.1832-net-2.0 download.  I am running RabbitMQ server 1.2.0 which comes from the bundles in the windows  complete-rabbitmq-bundle-1.2.0.zip download.  When I run any of the samples I get the following error:

{RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protocol negotiation failure: server version 0-8, transport parameters -1:-1
   at RabbitMQ.Client.Impl.ConnectionBase.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.Connection..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateConnection(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)}

If I make code changes such that I change the protocol to AMQP_0_8 in my app.config file and then set the protocol as Protocols.FromConfiguration("my-protocol");
Then I am able to connect and I don't get the same exception.  Is this the expected behavior?  and further does the RabbitMQ server only support AMQP 0-8?  And if the examples are primarily targeted for RabbitMQ then why have the default to AMQP 0-9 such that you have to explicitly change the protocol to 0-8 when running against RabbitMQ?





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/e5d28f01/attachment.htm 

From billc at inworksol.com  Sun Mar 30 18:53:59 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 10:53:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Fw: Errors using Windows .NET Client Library
Message-ID: <705677.78244.qm@web808.biz.mail.mud.yahoo.com>

Thanks a lot guys for all your help.  Tony I ran the tool as per your instructions and this is what appears on the screen dump of the Tracer:

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\Development>cd C:\downloads\complete-rabbitmq-bundle-1
.2.0\librabbitmq-java-1.2.0

C:\downloads\complete-rabbitmq-bundle-1.2.0\librabbitmq-java-1.2.0>runjava com.r
abbitmq.tools.Tracer
Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 5673 localhost 5672
conn#0 ch#0 -> {#method<connection.start-ok>(client properties={product=RabbitMQ
, information=Licensed under the MPL.  See http://www.rabbitmq.com/, platform=.N
ET, copyright=Copyright (C) 2007 LShift Ltd., Cohesive Financial Technologies LL
C., and Rabbit Technologies Ltd., version=1.2.8025.1832}, mechanism=PLAIN, respo
nse= guest guest, locale=en_US),null,""}
conn#0 ch#0 <- {#method<connection.start>(version major=8, version minor=0, serv
er properties={product=RabbitMQ, information=Licensed under the MPL.  See http:/
/www.rabbitmq.com/, platform=Erlang/OTP, copyright=Copyright (C) 2007 LShift Ltd
., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd., version=1
.2.0}, mechanisms=PLAIN AMQPLAIN, locales=en_US),null,""}
conn#0 ch#0 -> {#method<connection.tune-ok>(channel max=0, frame max=131072, hea
rtbeat=3),null,""}
conn#0 ch#0 -> {#method<connection.open>(virtual host=/, capabilities=, insist=t
rue),null,""}
conn#0 ch#0 <- {#method<connection.tune>(channel max=0, frame max=131072, heartb
eat=0),null,""}
conn#0 ch#1 -> {#method<channel.open>(out of band=),null,""}
conn#0 ch#0 <- {#method<connection.open-ok>(known hosts=billcmacxp:5672),null,""
}
conn#0 ch#1 -> {#method<access.request>(realm=/data, exclusive=false, passive=tr
ue, active=true, write=true, read=true),null,""}
conn#0 ch#1 <- {#method<channel.open-ok>(),null,""}
conn#0 ch#1 -> {#method<exchange.declare>(ticket=101, exchange=testexchange, typ
e=direct, passive=false, durable=false, auto delete=false, internal=false, nowai
t=false, arguments={}),null,""}
conn#0 ch#1 <- {#method<access.request-ok>(ticket=101),null,""}
conn#0 ch#1 <- {#method<exchange.declare-ok>(),null,""}
conn#0 ch#1 -> {#method<queue.declare>(ticket=101, queue=testqueue, passive=fals
e, durable=false, exclusive=false, auto delete=false, nowait=false, arguments={}
),null,""}
conn#0 ch#1 <- {#method<queue.declare-ok>(queue=testqueue, message count=3, cons
umer count=0),null,""}
conn#0 ch#1 -> {#method<queue.bind>(ticket=101, queue=testqueue, exchange=testex
change, routing key=routingkey, nowait=false, arguments={}),null,""}
conn#0 ch#1 <- {#method<queue.bind-ok>(),null,""}
conn#0 ch#1 -> {#method<basic.consume>(ticket=101, queue=testqueue, consumer tag
=, no local=false, no ack=false, exclusive=false, nowait=false),null,""}
conn#0 ch#1 <- {#method<basic.consume-ok>(consumer tag=amq.ctag13_rabbit at billcma
cxp_20080330164613_),null,""}
conn#0 ch#1 <- {#method<basic.deliver>(consumer tag=amq.ctag13_rabbit at billcmacxp
_20080330164613_, delivery tag=10000, redelivered=false, exchange=testexchange,
routing key=routingkey),#contentHeader<basic>(content type=text/plain, content e
ncoding=null, headers=null, delivery mode=2, priority=null, correlation id=null,
 reply to=null, expiration=null, message id=null, timestamp=null, type=null, use
r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero hello"}
conn#0 ch#1 <- {#method<basic.deliver>(consumer tag=amq.ctag13_rabbit at billcmacxp
_20080330164613_, delivery tag=10001, redelivered=false, exchange=testexchange,
routing key=routingkey),#contentHeader<basic>(content type=text/plain, content e
ncoding=null, headers=null, delivery mode=2, priority=null, correlation id=null,
 reply to=null, expiration=null, message id=null, timestamp=null, type=null, use
r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero hello"}
conn#0 ch#1 <- {#method<basic.deliver>(consumer tag=amq.ctag13_rabbit at billcmacxp
_20080330164613_, delivery tag=10002, redelivered=false, exchange=testexchange,
routing key=routingkey),#contentHeader<basic>(content type=text/plain, content e
ncoding=null, headers=null, delivery mode=2, priority=null, correlation id=null,
 reply to=null, expiration=null, message id=null, timestamp=null, type=null, use
r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero hello"}
conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10000, multiple=false),null,""}
conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10001, multiple=false),null,""}
conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10002, multiple=false),null,""}
java.io.EOFException
        at java.io.DataInputStream.readUnsignedByte(Unknown Source)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:103)
        at com.rabbitmq.tools.Tracer$DirectionHandler.readFrame(Tracer.java:144)

        at com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:152)
        at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:170)
        at java.lang.Thread.run(Unknown Source)





----- Forwarded Message ----
From: Bill Chikirivao <billc at inworksol.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, March 30, 2008 1:00:37 AM
Subject: Errors using Windows .NET Client Library

Please can someone help me with an explanation.  I really appreciate any help you can give me.I am getting some errors when I try to run any of the examples that come with the .NET rabbitmq-dotnet-1.2.8025.1832-net-2.0 download.  I am running RabbitMQ server 1.2.0 which comes from the bundles in the windows  complete-rabbitmq-bundle-1.2.0.zip download.  When I run any of the samples I get the following error:

{RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protocol negotiation failure: server version 0-8, transport parameters -1:-1
   at RabbitMQ.Client.Impl.ConnectionBase.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.Connection..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateConnection(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)}

If I make code changes such that I change the protocol to AMQP_0_8 in my app.config file and then set the protocol as Protocols.FromConfiguration("my-protocol");
Then I am able to connect and I don't get the same exception.  Is this the expected behavior?  and further does the RabbitMQ server only support AMQP 0-8?  And if the examples are primarily targeted for RabbitMQ then why have the default to AMQP 0-9 such that you have to explicitly change the protocol to 0-8 when running against RabbitMQ?





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/7e545070/attachment.htm 

From tonyg at lshift.net  Sun Mar 30 18:54:29 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 30 Mar 2008 18:54:29 +0100
Subject: [rabbitmq-discuss] .NET Client Library Shared Queue Closed
 Error on	Subscription When No Msgs in Queue
In-Reply-To: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>
References: <850384.33382.qm@web805.biz.mail.mud.yahoo.com>
Message-ID: <47EFD3D5.7050908@lshift.net>

Hi Bill,

BillC wrote:
> Please can you help me with the following error. Using the examples
> that come with the .NET Cllient Library I have written a small program
> that creates a subscription and reads any published messages in the
> queue. The code works and reads any messages in the queue, however when
> there are no more messages left to read in the Queue or when you run the
> program without any messages in the queue (i.e. when the queue is empty)
> the connection simply closes and throws the following EndOfStreamException:
> [...]

That's a strange behaviour. I've just compiled your source code (with a 
few minor changes for my .NET installation, and using localhost etc 
instead of your 10.* IP) and tried it, and I can't seem to make it do 
anything besides quietly receive and print messages :-)

Could you provide step-by-step instructions on how to reproduce the 
fault, perhaps?

I've attached the C# file I used to try to reproduce the fault.

Regards,
   Tony

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: BillCTest.cs
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/bb56db5a/attachment.txt 

From tonyg at lshift.net  Sun Mar 30 19:03:07 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 30 Mar 2008 19:03:07 +0100
Subject: [rabbitmq-discuss] Fw: Errors using Windows .NET Client Library
In-Reply-To: <503518.84230.qm@web803.biz.mail.mud.yahoo.com>
References: <503518.84230.qm@web803.biz.mail.mud.yahoo.com>
Message-ID: <47EFD5DB.8010900@lshift.net>

Hi again,

BillC wrote:
> If I make code changes such that I change the protocol to AMQP_0_8 in my 
> app.config file and then set the protocol as 
> Protocols.FromConfiguration("my-protocol");
> Then I am able to connect and I don't get the same exception.  Is this 
> the expected behavior?

Yes, it is, for the current release, anyway. The RabbitMQ .NET client 
library supports

  - stock AMQP 0-9 brokers (and this is the default setting)
  - stock AMQP 0-8 brokers (like RabbitMQ's current release)
  - some of QPid's extensions to the AMQP 0-8 specification

Furthermore, because RabbitMQ is the only broker that implements the 
"access.request" method, there's a way of disabling the use of 
access.request on the client side.

At the time we developed the library, we were commissioned to make it 
work by default against a stock 0-9 broker. Perhaps we should try some 
kind of automatic graceful-downgrade renegotiation instead. Hmm.

> and further does the RabbitMQ server only 
> support AMQP 0-8?

It does, yes. So far!

> And if the examples are primarily targeted for 
> RabbitMQ then why have the default to AMQP 0-9 such that you have to 
> explicitly change the protocol to 0-8 when running against RabbitMQ?

We tried to make the examples broker-neutral - they should work on *any* 
AMQP 0-8 or 0-9 broker. So really I guess we should be looking at ways 
of avoiding the having-to-set-the-protocol-version problem...

Regards,
   Tony




From tonyg at lshift.net  Sun Mar 30 19:10:21 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 30 Mar 2008 19:10:21 +0100
Subject: [rabbitmq-discuss] Fw: Errors using Windows .NET Client Library
In-Reply-To: <705677.78244.qm@web808.biz.mail.mud.yahoo.com>
References: <705677.78244.qm@web808.biz.mail.mud.yahoo.com>
Message-ID: <47EFD78D.50103@lshift.net>

Wow, that's really weird. Everything looks normal up until the 
connection goes away. Neither side is sending any complaint to the other.

Have you checked the RabbitMQ server logs? They will contain lines like:

=INFO REPORT==== 30-Mar-2008::18:51:31 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:52676
=INFO REPORT==== 30-Mar-2008::18:51:31 ===
closing TCP connection from 127.0.0.1:52676

etc etc. Perhaps the server is suffering from some problem it doesn't 
get the opportunity to inform the client about.

Regards,
   Tony

BTW. If you use IRC, I'm in #rabbitmq on freenode.



BillC wrote:
> Thanks a lot guys for all your help.  Tony I ran the tool as per your 
> instructions and this is what appears on the screen dump of the Tracer:
> 
> Microsoft Windows XP [Version 5.1.2600]
> (C) Copyright 1985-2001 Microsoft Corp.
> 
> C:\Documents and Settings\Development>cd 
> C:\downloads\complete-rabbitmq-bundle-1
> .2.0\librabbitmq-java-1.2.0
> 
> C:\downloads\complete-rabbitmq-bundle-1.2.0\librabbitmq-java-1.2.0>runjava 
> com.r
> abbitmq.tools.Tracer
> Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
> Invoked as: Tracer 5673 localhost 5672
> conn#0 ch#0 -> {#method<connection.start-ok>(client 
> properties={product=RabbitMQ
> , information=Licensed under the MPL.  See http://www.rabbitmq.com/, 
> platform=.N
> ET, copyright=Copyright (C) 2007 LShift Ltd., Cohesive Financial 
> Technologies LL
> C., and Rabbit Technologies Ltd., version=1.2.8025.1832}, 
> mechanism=PLAIN, respo
> nse= guest guest, locale=en_US),null,""}
> conn#0 ch#0 <- {#method<connection.start>(version major=8, version 
> minor=0, serv
> er properties={product=RabbitMQ, information=Licensed under the MPL.  
> See http:/
> /www.rabbitmq.com/, platform=Erlang/OTP, copyright=Copyright (C) 2007 
> LShift Ltd
> ., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd., 
> version=1
> .2.0}, mechanisms=PLAIN AMQPLAIN, locales=en_US),null,""}
> conn#0 ch#0 -> {#method<connection.tune-ok>(channel max=0, frame 
> max=131072, hea
> rtbeat=3),null,""}
> conn#0 ch#0 -> {#method<connection.open>(virtual host=/, capabilities=, 
> insist=t
> rue),null,""}
> conn#0 ch#0 <- {#method<connection.tune>(channel max=0, frame 
> max=131072, heartb
> eat=0),null,""}
> conn#0 ch#1 -> {#method<channel.open>(out of band=),null,""}
> conn#0 ch#0 <- {#method<connection.open-ok>(known 
> hosts=billcmacxp:5672),null,""
> }
> conn#0 ch#1 -> {#method<access.request>(realm=/data, exclusive=false, 
> passive=tr
> ue, active=true, write=true, read=true),null,""}
> conn#0 ch#1 <- {#method<channel.open-ok>(),null,""}
> conn#0 ch#1 -> {#method<exchange.declare>(ticket=101, 
> exchange=testexchange, typ
> e=direct, passive=false, durable=false, auto delete=false, 
> internal=false, nowai
> t=false, arguments={}),null,""}
> conn#0 ch#1 <- {#method<access.request-ok>(ticket=101),null,""}
> conn#0 ch#1 <- {#method<exchange.declare-ok>(),null,""}
> conn#0 ch#1 -> {#method<queue.declare>(ticket=101, queue=testqueue, 
> passive=fals
> e, durable=false, exclusive=false, auto delete=false, nowait=false, 
> arguments={}
> ),null,""}
> conn#0 ch#1 <- {#method<queue.declare-ok>(queue=testqueue, message 
> count=3, cons
> umer count=0),null,""}
> conn#0 ch#1 -> {#method<queue.bind>(ticket=101, queue=testqueue, 
> exchange=testex
> change, routing key=routingkey, nowait=false, arguments={}),null,""}
> conn#0 ch#1 <- {#method<queue.bind-ok>(),null,""}
> conn#0 ch#1 -> {#method<basic.consume>(ticket=101, queue=testqueue, 
> consumer tag
> =, no local=false, no ack=false, exclusive=false, nowait=false),null,""}
> conn#0 ch#1 <- {#method<basic.consume-ok>(consumer 
> tag=amq.ctag13_rabbit at billcma
> cxp_20080330164613_),null,""}
> conn#0 ch#1 <- {#method<basic.deliver>(consumer 
> tag=amq.ctag13_rabbit at billcmacxp
> _20080330164613_, delivery tag=10000, redelivered=false, 
> exchange=testexchange,
> routing key=routingkey),#contentHeader<basic>(content type=text/plain, 
> content e
> ncoding=null, headers=null, delivery mode=2, priority=null, correlation 
> id=null,
>  reply to=null, expiration=null, message id=null, timestamp=null, 
> type=null, use
> r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero 
> hello"}
> conn#0 ch#1 <- {#method<basic.deliver>(consumer 
> tag=amq.ctag13_rabbit at billcmacxp
> _20080330164613_, delivery tag=10001, redelivered=false, 
> exchange=testexchange,
> routing key=routingkey),#contentHeader<basic>(content type=text/plain, 
> content e
> ncoding=null, headers=null, delivery mode=2, priority=null, correlation 
> id=null,
>  reply to=null, expiration=null, message id=null, timestamp=null, 
> type=null, use
> r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero 
> hello"}
> conn#0 ch#1 <- {#method<basic.deliver>(consumer 
> tag=amq.ctag13_rabbit at billcmacxp
> _20080330164613_, delivery tag=10002, redelivered=false, 
> exchange=testexchange,
> routing key=routingkey),#contentHeader<basic>(content type=text/plain, 
> content e
> ncoding=null, headers=null, delivery mode=2, priority=null, correlation 
> id=null,
>  reply to=null, expiration=null, message id=null, timestamp=null, 
> type=null, use
> r id=null, app id=null, cluster id=null),"Hello, world! .. hello Vero 
> hello"}
> conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10000, 
> multiple=false),null,""}
> conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10001, 
> multiple=false),null,""}
> conn#0 ch#1 -> {#method<basic.ack>(delivery tag=10002, 
> multiple=false),null,""}
> java.io.EOFException
>         at java.io.DataInputStream.readUnsignedByte(Unknown Source)
>         at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:103)
>         at 
> com.rabbitmq.tools.Tracer$DirectionHandler.readFrame(Tracer.java:144)
> 
>         at 
> com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:152)
>         at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:170)
>         at java.lang.Thread.run(Unknown Source)
> 
> 
> 
> 
> 
> ----- Forwarded Message ----
> From: Bill Chikirivao <billc at inworksol.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Sunday, March 30, 2008 1:00:37 AM
> Subject: Errors using Windows .NET Client Library
> 
> Please can someone help me with an explanation.  I really appreciate any 
> help you can give me.I am getting some errors when I try to run any of 
> the examples that come with the .NET 
> rabbitmq-dotnet-1.2.8025.1832-net-2.0 download.  I am running RabbitMQ 
> server 1.2.0 which comes from the bundles in the windows 
> complete-rabbitmq-bundle-1.2.0.zip 
> <http://www.rabbitmq.com/releases/windows/complete-rabbitmq-bundle-1.2.0.zip> 
> download.  When I run any of the samples I get the following error:
> 
> {RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP 
> server protocol negotiation failure: server version 0-8, transport 
> parameters -1:-1
>    at RabbitMQ.Client.Impl.ConnectionBase.Open(Boolean insist)
>    at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionParameters 
> parameters, Boolean insist, IFrameHandler frameHandler)
>    at 
> RabbitMQ.Client.Framing.Impl.v0_9.Connection..ctor(ConnectionParameters 
> parameters, Boolean insist, IFrameHandler frameHandler)
>    at 
> RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateConnection(ConnectionParameters 
> parameters, Boolean insist, IFrameHandler frameHandler)
>    at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
> maxRedirects, IDictionary connectionAttempts, IDictionary 
> connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, 
> AmqpTcpEndpoint endpoint)}
> 
> If I make code changes such that I change the protocol to AMQP_0_8 in my 
> app.config file and then set the protocol as 
> Protocols.FromConfiguration("my-protocol");
> Then I am able to connect and I don't get the same exception.  Is this 
> the expected behavior?  and further does the RabbitMQ server only 
> support AMQP 0-8?  And if the examples are primarily targeted for 
> RabbitMQ then why have the default to AMQP 0-9 such that you have to 
> explicitly change the protocol to 0-8 when running against RabbitMQ?
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From billc at inworksol.com  Sun Mar 30 19:24:27 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 11:24:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Fwd: Fw: Errors using Windows .NET Client Library
Message-ID: <166102.29618.qm@web805.biz.mail.mud.yahoo.com>


I am using .net 3.5 on VS studio.net 2008 ... could that be the proble.

I will try maybe to down grade to .net 2.0 and see what happens. Sorry
I am on skype if you happen to be on that my id is bchikirivao ... I will 
try to get on IRC tomorrow .. Thanks for all your help.


Wow, that's really weird. Everything looks normal up until the 
connection goes away. Neither side is sending any complaint to the other.

Have you checked the RabbitMQ server logs? They will contain lines like:

=INFO REPORT==== 30-Mar-2008::18:51:31 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:52676
=INFO REPORT==== 30-Mar-2008::18:51:31 ===
closing TCP connection from 127.0.0.1:52676

etc etc. Perhaps the server is suffering from some problem it doesn't 
get the opportunity to inform the client about.


BillC <billc at inworksol.com> wrote: Date: Sun, 30 Mar 2008 10:45:33 -0700 (PDT)
From: BillC <billc at inworksol.com>
CC: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Fw: Errors using Windows .NET Client Library

 Thanks for all your help.

I tried to run the same program using your remote server "dev.rabbitmq.com" and I still get the same errors as described below:

 Please can someone help me with an explanation.  I really appreciate any help you can give me.I am getting some errors when I try to run any of the examples that come with the .NET rabbitmq-dotnet-1.2.8025.1832-net-2.0 download.  I am running RabbitMQ server 1.2.0 which comes from the bundles in the windows  complete-rabbitmq-bundle-1.2.0.zip download.  When I run any of the samples I get the following error:

{RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server protocol negotiation failure: server version 0-8, transport parameters -1:-1
   at RabbitMQ.Client.Impl.ConnectionBase.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at  RabbitMQ.Client.Framing.Impl.v0_9.Connection..ctor(ConnectionParameters  parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateConnection(ConnectionParameters parameters, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)}

If I make code changes such that I change the protocol to AMQP_0_8 in my app.config file and then set the protocol as Protocols.FromConfiguration("my-protocol");
Then I am able to connect and I don't get the same exception.  Is this the expected behavior?  and further does the RabbitMQ server only support AMQP 0-8?  And if the examples are primarily targeted for RabbitMQ then why have the default to AMQP 0-9 such that you have to explicitly change the protocol to 0-8 when running against  RabbitMQ?






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/f28b2db6/attachment.htm 
-------------- next part --------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonyg at lshift.net  Sun Mar 30 19:30:24 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 30 Mar 2008 19:30:24 +0100
Subject: [rabbitmq-discuss] Fwd: Fw: Errors using Windows .NET Client
 Library
In-Reply-To: <166102.29618.qm@web805.biz.mail.mud.yahoo.com>
References: <166102.29618.qm@web805.biz.mail.mud.yahoo.com>
Message-ID: <47EFDC40.2010101@lshift.net>

BillC wrote:
> I am using .net 3.5 on VS studio.net 2008 ... could that be the proble.

It shouldn't be: the system was developed and tested against .NET 1.1 
and 2.0, but the WCF binding was developed on 3.0 and 3.5 (beta), so all 
should be fine on that front.

> I will try maybe to down grade to .net 2.0 and see what happens. Sorry
> I am on skype if you happen to be on that my id is bchikirivao ... I will 
> try to get on IRC tomorrow .. Thanks for all your help.

I've added you on skype, and I'll try to get to IRC tomorrow as well :-)

Please do take a close look at your RabbitMQ server logs, as they often 
can report faults that the protocol doesn't permit informing the 
connected clients directly about.

Regards,
   Tony




From billc at inworksol.com  Sun Mar 30 22:32:46 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 14:32:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Fwd: Fwd: Fw: Errors using Windows .NET Client
	Library
Message-ID: <145000.51059.qm@web803.biz.mail.mud.yahoo.com>

Here is the log on RabbitMQ:

Thanks for your help.  I just cleaned up the old log.  Ran the publish program twice to enque two messages.  Then I ran the subscriber program to deque twice.

I see a lot of abrupt connection closures but no real explanations as to the reason.


=INFO REPORT==== 30-Mar-2008::16:25:40 ===
disk_log: repairing "c:/Documents and Settings/Development/rabbitmq/db/rabbit-mnesia/rabbit_persister.LOG" ...

=INFO REPORT==== 30-Mar-2008::16:25:40 ===
Repaired persister log - 22 recovered, 0 bad

=INFO REPORT==== 30-Mar-2008::16:25:40 ===
Rolling persister log to "c:/Documents and Settings/Development/rabbitmq/db/rabbit-mnesia/rabbit_persister.LOG.previous"

=INFO REPORT==== 30-Mar-2008::16:25:40 ===
started TCP listener on 0.0.0.0:5672

=INFO REPORT==== 30-Mar-2008::16:25:52 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:1670

=INFO REPORT==== 30-Mar-2008::16:25:53 ===
Connection closed abruptly.

=INFO REPORT==== 30-Mar-2008::16:25:53 ===
closing TCP connection from 10.10.10.25:1670

=INFO REPORT==== 30-Mar-2008::16:25:56 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:1671

=INFO REPORT==== 30-Mar-2008::16:25:57 ===
Connection closed abruptly.

=INFO REPORT==== 30-Mar-2008::16:25:57 ===
closing TCP connection from 10.10.10.25:1671

=INFO REPORT==== 30-Mar-2008::16:27:28 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1673

=INFO REPORT==== 30-Mar-2008::16:27:30 ===
Connection closed abruptly.

=INFO REPORT==== 30-Mar-2008::16:27:30 ===
closing TCP connection from 127.0.0.1:1673

=INFO REPORT==== 30-Mar-2008::16:28:23 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1675

=INFO REPORT==== 30-Mar-2008::16:28:25 ===
Connection closed abruptly.

=INFO REPORT==== 30-Mar-2008::16:28:25 ===
closing TCP connection from 127.0.0.1:1675


If I make code changes such that I change the protocol to AMQP_0_8 in my app.config file and then set the protocol as Protocols.FromConfiguration("my-protocol");
Then I am able to connect and I don't get the same exception.  Is this the expected behavior?  and further does the RabbitMQ server only support AMQP 0-8?  And if the examples are primarily targeted for RabbitMQ then why have the default to AMQP 0-9 such that you have to explicitly change the protocol to 0-8 when running against  RabbitMQ?






_______________________________________________
rabbitmq-discuss mailing  list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/53b383c0/attachment.htm 
-------------- next part --------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From billc at inworksol.com  Mon Mar 31 00:18:17 2008
From: billc at inworksol.com (BillC)
Date: Sun, 30 Mar 2008 16:18:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Fwd: Fw: Errors using Windows .NET Client
	Library
In-Reply-To: <47EFDC40.2010101@lshift.net>
Message-ID: <590666.46612.qm@web805.biz.mail.mud.yahoo.com>

I am using the following RabbitMQ dll that came with the download.  Please can you check to see if we are running the same version:

RabbitMQ.Client:

Runtime Version: v2.0.50727
Version:  1.2.8025.1832

I have tried to run the same code on multiple computers and am still getting the same error.  On another computer I installed the older Visual Studio 2005 and still get the same error.  I also ran the program using your dev test machines and still get the same error, so my suspicion is that its either something in my client code or something with the Rabbit.Client dll that I am using.  If it was the server then when I run against your dev servers I wouldn't get the same error, so I think the client socket connection is that one that is disconnecting.

Thanks for all your help.


 BillC wrote:
> I am using .net 3.5 on VS studio.net 2008 ... could that be the proble.

It shouldn't be: the system was developed and tested against .NET 1.1 
and 2.0, but the WCF binding was developed on 3.0 and 3.5 (beta), so all 
should be fine on that front.

> I will try maybe to down grade to .net 2.0 and see what happens. Sorry
> I am on skype if you happen to be on that my id is bchikirivao ... I will 
> try to get on IRC tomorrow .. Thanks for all your help.

I've added you on skype, and I'll try to get to IRC tomorrow as well :-)

Please do take a close look at your RabbitMQ server logs, as they often 
can report faults that the protocol doesn't permit informing the 
connected clients directly about.

Regards,
   Tony


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080330/e77bff4a/attachment.htm 

From matthias at lshift.net  Mon Mar 31 08:53:32 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 31 Mar 2008 08:53:32 +0100
Subject: [rabbitmq-discuss] Fwd: Fwd: Fw: Errors using Windows .NET
 Client Library
In-Reply-To: <145000.51059.qm@web803.biz.mail.mud.yahoo.com>
References: <145000.51059.qm@web803.biz.mail.mud.yahoo.com>
Message-ID: <47F0987C.3050401@lshift.net>

Bill,,

BillC wrote:
> Here is the log on RabbitMQ:
> 
> Thanks for your help.  I just cleaned up the old log.  Ran the publish 
> program twice to enque two messages.  Then I ran the subscriber program 
> to deque twice.
> 
> I see a lot of abrupt connection closures but no real explanations as to 
> the reason.
> 
> 
> =INFO REPORT==== 30-Mar-2008::16:25:40 ===
> disk_log: repairing "c:/Documents and 
> Settings/Development/rabbitmq/db/rabbit-mnesia/rabbit_persister.LOG" ...
> 
> =INFO REPORT==== 30-Mar-2008::16:25:40 ===
> Repaired persister log - 22 recovered, 0 bad

That is an odd error. Do you get it every time you start the broker? How 
are you stopping the broker?

That plus the tracer log you sent previously indicate that your test 
uses persistent messages. There is nothing wrong with that but it may 
explain why you are seeing errors when we don't. Try running your tests 
with transient messages, after clearing out the previously persisted 
messages (stop the broker, remove the persister log file mentioned above 
and then restart the broker).


Matthias.



From billc at inworksol.com  Mon Mar 31 09:56:40 2008
From: billc at inworksol.com (BillC)
Date: Mon, 31 Mar 2008 01:56:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Fwd: Fwd: Fw: Errors using Windows .NET
	Client Library
In-Reply-To: <47F0987C.3050401@lshift.net>
Message-ID: <333375.45845.qm@web804.biz.mail.mud.yahoo.com>

Matthias,
   
  Thanks for your response.  I cleared everything in my Mnesia and Log files and restarted the broker.  I also changed my props.DeliveryMode = 1 to make non persistent messages on basicpublish.   I also ensured that my basicpublisher closes both the channel and connections properly in the basicpublisher code. 
   
  I tried running this code on multiple computers and still get the same problem.  I also ran it against your dev environment hoping that maybe it was a problem with my installed broker but it still did not work.  Earlier today I also took the SimpleSubscriber Java solution and build that sample.  And the Java one just works perfectly without any problems.  I used the same simple publisher and the java simplesubscriber just blocked and received msgs whenever I sent them via the simplepublisher.  So I am thinking probably the one thing left to verify is whether or not we are running the same RabbitMQ.Client DLL file. I sent you the version that I am running, please let me know if we are running the same one.
   
  Here is the sequence of events to explain the attached log file:
   
  1)  Start broker and broker rebuilds fresh cope of both db and log directories after I had deleted the old ones
  2) Run my basicpublisher program twice to publish two simple "hello" msgs
  3) Rum my basicsubscriber program which dequeues the two msgs and immediately throws the EndOfStream Exception and I think in the log results in the "abrupt socket closure".
  4)  I again run my basicsubscriber program and this time there is no msg in the queue so when it tries to deque .. there is nothing ... and it immediately causes another "abrupt socket closure" in log.  Here is the log:
   
  
=INFO REPORT==== 31-Mar-2008::03:29:00 ===
    application: mnesia
    exited: stopped
    type: temporary
  =INFO REPORT==== 31-Mar-2008::03:29:00 ===
Added vhost <<"/">>
  =INFO REPORT==== 31-Mar-2008::03:29:00 ===
Created user <<"guest">>
  =INFO REPORT==== 31-Mar-2008::03:29:00 ===
Rolling persister log to "c:/Documents and Settings/Development/rabbitmq/db/rabbit-mnesia/rabbit_persister.LOG.previous"
  =INFO REPORT==== 31-Mar-2008::03:29:00 ===
started TCP listener on 0.0.0.0:5672
  =INFO REPORT==== 31-Mar-2008::03:30:50 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:2581
  =INFO REPORT==== 31-Mar-2008::03:30:50 ===
closing TCP connection from 10.10.10.25:2581
  =INFO REPORT==== 31-Mar-2008::03:30:53 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:2582
  =INFO REPORT==== 31-Mar-2008::03:30:53 ===
closing TCP connection from 10.10.10.25:2582
  =INFO REPORT==== 31-Mar-2008::03:31:13 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:2583
  =INFO REPORT==== 31-Mar-2008::03:31:14 ===
Connection closed abruptly.
  =INFO REPORT==== 31-Mar-2008::03:31:14 ===
closing TCP connection from 10.10.10.25:2583
  =INFO REPORT==== 31-Mar-2008::03:34:45 ===
accepted TCP connection on 0.0.0.0:5672 from 10.10.10.25:2584
  =INFO REPORT==== 31-Mar-2008::03:34:46 ===
Connection closed abruptly.
  =INFO REPORT==== 31-Mar-2008::03:34:46 ===
closing TCP connection from 10.10.10.25:2584

   
  

Matthias Radestock <matthias at lshift.net> wrote:
  Bill,,

BillC wrote:
> Here is the log on RabbitMQ:
> 
> Thanks for your help. I just cleaned up the old log. Ran the publish 
> program twice to enque two messages. Then I ran the subscriber program 
> to deque twice.
> 
> I see a lot of abrupt connection closures but no real explanations as to 
> the reason.
> 
> 
> =INFO REPORT==== 30-Mar-2008::16:25:40 ===
> disk_log: repairing "c:/Documents and 
> Settings/Development/rabbitmq/db/rabbit-mnesia/rabbit_persister.LOG" ...
> 
> =INFO REPORT==== 30-Mar-2008::16:25:40 ===
> Repaired persister log - 22 recovered, 0 bad

That is an odd error. Do you get it every time you start the broker? How 
are you stopping the broker?

That plus the tracer log you sent previously indicate that your test 
uses persistent messages. There is nothing wrong with that but it may 
explain why you are seeing errors when we don't. Try running your tests 
with transient messages, after clearing out the previously persisted 
messages (stop the broker, remove the persister log file mentioned above 
and then restart the broker).


Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080331/b4ad4bf9/attachment.htm 

From codewalkerjoe at gmail.com  Mon Mar 31 22:05:29 2008
From: codewalkerjoe at gmail.com (joe lee)
Date: Mon, 31 Mar 2008 17:05:29 -0400
Subject: [rabbitmq-discuss] basic public-subscribe model with erlang-client
Message-ID: <50ec7a2e0803311405t593c3d60t79a29b4be8f05da2@mail.gmail.com>

Anyone knows how to do a basic publish (asynchronous method, no syncing with
broker) using erlang-client, either in amqp mode or erlang mode?

I have a queue and need to send message to the queue asynchronously and
consumer will come along and process it.  If you are doing
publish-subscribe, do you define a queue like you do for sysnchronous
method?

thank you,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080331/be1c2ab3/attachment.htm 

From 0x6e6562 at gmail.com  Mon Mar 31 22:33:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 31 Mar 2008 22:33:10 +0100
Subject: [rabbitmq-discuss] basic public-subscribe model with
	erlang-client
In-Reply-To: <50ec7a2e0803311405t593c3d60t79a29b4be8f05da2@mail.gmail.com>
References: <50ec7a2e0803311405t593c3d60t79a29b4be8f05da2@mail.gmail.com>
Message-ID: <D737AE2A-A061-47EB-8CBB-E0B229FAB0CB@gmail.com>

Joe,

On 31 Mar 2008, at 22:05, joe lee wrote:

> Anyone knows how to do a basic publish (asynchronous method, no  
> syncing with broker) using erlang-client, either in amqp mode or  
> erlang mode?

If I understand you correctly, if you want to publish a message, you  
can do the following:

BasicPublish = #'basic.publish'{ticket = Ticket, exchange = X,
                                     routing_key = RoutingKey,
                                     mandatory = Mandatory,
                                     immediate = Immediate},
Content = #content{class_id = 60,
          properties = amqp_util:basic_properties(), %% either 'none',  
or a decoded record/tuple
          properties_bin = 'none', %% either 'none', or an encoded  
properties amqp_util:binary
          %% Note: at most one of properties and properties_bin can be  
'none' at once.
          payload_fragments_rev = [Payload] %% list of binaries, in  
reverse order (!)
         },
amqp_channel:cast(Channel, BasicPublish, Content),

This code is taken from the setup_publish/3 function in the test_util  
module of the Erlang client.

The cast/3 function in amqp_channel sends the message asynchronously  
irrespective of whether you are using the TCP variant or native Erlang  
messaging.

BTW, what do you mean when you say "amqp mode or erlang mode"?

> I have a queue and need to send message to the queue asynchronously  
> and consumer will come along and process it.  If you are doing  
> publish-subscribe, do you define a queue like you do for  
> sysnchronous method?

I'm not quite sure I follow. Which synchronous method are you  
referring to?

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080331/ef3f29c1/attachment.htm 

