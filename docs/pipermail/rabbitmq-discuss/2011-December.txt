From felix.devasia at accenture.com  Thu Dec  1 05:14:14 2011
From: felix.devasia at accenture.com (felix.devasia at accenture.com)
Date: Thu, 1 Dec 2011 10:44:14 +0530
Subject: [rabbitmq-discuss] RabbitMq and REST
In-Reply-To: <32d266e0-4a6e-4f02-8b00-caec7d6dcb04@webern.local>
References: <CAMdQUi_gTeCh1hvt43gO+P7Muvp6EhtNw2KCgA-df4b+TThrmw@mail.gmail.com>
	<32d266e0-4a6e-4f02-8b00-caec7d6dcb04@webern.local>
Message-ID: <58A663FD41E05249BB5047436BD656560AC5C59A7C@INDXM3124.dir.svc.accenture.com>

Thanks ? I will evaluate this.

Felix Devasia
Technology Architecture
Accenture Foundation Platform For Java (AFP-J)<https://collaboration.accenture.com/afpj/>
?:  felix.devasia at accenture.com<mailto:felix.devasia at accenture.com>;
':  +91 80 41862183;?:  +91 9972529300

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mark Fisher
Sent: Thursday, December 01, 2011 1:54 AM
To: Jim Apperly
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMq and REST

On 30 November 2011 17:46, Simon MacMullen <simon at rabbitmq.com<mailto:simon at rabbitmq.com>> wrote:
On 30/11/11 12:22, felix.devasia at accenture.com<mailto:felix.devasia at accenture.com> wrote:
2)or should there be an adapter (ratpack / custom) which can listen to

REST messages and talk to RabbitMq via AMQP?

I'm not aware of anything that's publicly available, although I'd be interested to hear if someone has written such a thing.

I'm not aware of anything that can do this OOTB but, if you're using Java/.Net, you may be able to cobble something together with Spring Integration.
This simple prototype does exactly that: https://github.com/SpringSource/cloudfoundry-samples/tree/master/rabbit-rest

It consists of just web.xml and one other config file under src/main/webapp/WEB-INF

-Mark

Jim

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111201/1b8f0848/attachment.htm>

From jfarrio at gmail.com  Thu Dec  1 06:09:48 2011
From: jfarrio at gmail.com (Shaun Ziyan Xu)
Date: Thu, 1 Dec 2011 14:09:48 +0800
Subject: [rabbitmq-discuss] 2 WCF services on the same queue
Message-ID: <CACbvtX-Gjv7nKp7umvc0CN0190WwDShqBtbcw925fEQ9wnNzsA@mail.gmail.com>

I would like to scaling out my application service and decided to use a
distributed queue to receive the client request, and multiple services
listening on the same queue. I think this is very common pooling-based
pattern.
I'm trying to use RebbitMQ with WCF binding, and when I use one client and
one service to works well. But when I created 2 services I found when the
client invoked, it gave me an exception said the CommunicationObject State
was Fault.

Does anyone here met with the similar problem and any suggestions.

Thanks,
-- 
Shaun Xu (http://about.me/shaunxu/bio)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111201/101402a1/attachment.htm>

From simon at rabbitmq.com  Thu Dec  1 10:05:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Dec 2011 10:05:57 +0000
Subject: [rabbitmq-discuss] Debugging AD
In-Reply-To: <CAL_e=0p-O3DgVfyrrMM7SBZGc+3qwio3zHOBWp4nspAQXL7ftg@mail.gmail.com>
References: <CAB-G1jj513G9QWVSs4HN3X1U+xBL-_8MN50ryTeK0Zcg5sWXeg@mail.gmail.com>
	<4ED5258D.3050000@rabbitmq.com>
	<CAB-G1jge97D02yL+2uuHEOpvKE3_C93BWAO9dTDzFUBdXXi+zg@mail.gmail.com>
	<4ED52A88.7030808@rabbitmq.com> <4ED60914.1010507@rabbitmq.com>
	<CAB-G1jhATsBxXmVE5HKL6Sxh7a2v1ooUZhZoC9MtAjkYanpQJQ@mail.gmail.com>
	<CAB-G1jgN3p=LK9m2sfaFpOOSLv=zBCsGrmTp+nvt5mZR14+ARA@mail.gmail.com>
	<4ED66AE2.4090507@rabbitmq.com>
	<CAL_e=0p-O3DgVfyrrMM7SBZGc+3qwio3zHOBWp4nspAQXL7ftg@mail.gmail.com>
Message-ID: <4ED75185.4070101@rabbitmq.com>

On 30/11/11 18:40, Gavin M. Roy wrote:
> I've been meaning to ask on this subject: is there any level of caching
> of data received back from the LDAP server? I'd like to move to LDAP for
> our infrastructure but am worried about connection rates and throttling
> due to time spent making LDAP requests for the same
> connecting/disconnecting user.

There is caching within RabbitMQ itself, at the channel level. Any 
channel will only check a given permission for a given object once.

There isn't any LDAP-specific caching. In fact at the moment we don't 
even pool LDAP connections.

> Alternatively, does Rabbit check local auth prior to LDAP auth?

If you put rabbit_auth_backend_internal first in the list, yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Dec  1 10:18:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Dec 2011 10:18:11 +0000
Subject: [rabbitmq-discuss] Cluster and nodes shutdown: not_found,
 "no queue 'XXXX' in vhost 'YYY'", 'queue.declare'
In-Reply-To: <CAGObxaS508keDfKW0DSjC+WQsTpBvpJt+gAL4+HtBMyj5k2dgw@mail.gmail.com>
References: <CAGObxaS508keDfKW0DSjC+WQsTpBvpJt+gAL4+HtBMyj5k2dgw@mail.gmail.com>
Message-ID: <4ED75463.9050309@rabbitmq.com>

On 30/11/11 20:18, Tiago Cruz wrote:
> I'm using  rabbitMQ 2.6.1's mirror queue without 'x-ha-policy' (yet!),
> and I just found a weird situation.
>
> I'm using keepalived to exchange IP address from clients, and my queues
> are "Durable=True"

<snip>

If you're not using x-ha-policy, then you are not using mirrored queues. 
By default queues only exist on one node (qwc1 in your case).

> If I shutdown the _qwc2_ everything works as well.
>
> If I shutdown the _qwc1_ the cluster stop to work, and I got this errors
> messages on log:

<snip>

> When the node qwc1 turn back to live, everything works as well.
>
> If, before the shutdown, I delete the queue 'videos' and 'sender',
> everything works as well.
>
> Is the behaviour correct? I thought that everything was still working as
> well even with a crash of one of nodes of cluster :)

The behaviour is as designed. If you declare a queue on a single node, 
and then that node goes down, attempts to redeclare it return not_found. 
The idea is that when the node comes back up we want the queue to still 
be there - so while it is down Rabbit won't just recreate it on one of 
the other nodes, since then when the node does come back up again you 
would have two copies of the same queue.

But it sounds like you want mirrored queues, so use 'x-ha-policy'.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From kenshin.acs at gmail.com  Thu Dec  1 08:10:40 2011
From: kenshin.acs at gmail.com (kenshin)
Date: Thu, 1 Dec 2011 00:10:40 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ support AMQP 1.0 schedule
Message-ID: <2dd010f1-ac37-4a84-9fd6-74f70453836b@q30g2000yqj.googlegroups.com>

Hi:
   Is there a schedule. RabbitMQ support AMQP 1.0 ? Or,Is there a
method RabbtMQ can support negotiating with AMQP 0-10 ? Because our
client publish message by qpid . and default use AMQP 0-10 .

  Hope can get some direction or sugesstion
  Thanks


From emile at rabbitmq.com  Thu Dec  1 11:13:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 01 Dec 2011 11:13:37 +0000
Subject: [rabbitmq-discuss] 2 WCF services on the same queue
In-Reply-To: <CACbvtX-Gjv7nKp7umvc0CN0190WwDShqBtbcw925fEQ9wnNzsA@mail.gmail.com>
References: <CACbvtX-Gjv7nKp7umvc0CN0190WwDShqBtbcw925fEQ9wnNzsA@mail.gmail.com>
Message-ID: <4ED76161.1030205@rabbitmq.com>

On 01/12/11 06:09, Shaun Ziyan Xu wrote:
> I would like to scaling out my application service and decided to use a
> distributed queue to receive the client request, and multiple services
> listening on the same queue. I think this is very common pooling-based
> pattern.
> I'm trying to use RebbitMQ with WCF binding, and when I use one client
> and one service to works well. But when I created 2 services I found
> when the client invoked, it gave me an exception said the
> CommunicationObject State was Fault.


Unfortunately each Service creates a new AMQP binding and a new queue
for requests. Therefore each Service will receive all requests, leading
to the errors you see.

If you want to use WCF then you could create separate endpoints for each
worker and to round-robin at the request stage.

If you do not need to use WCF then use the RabbitMQ .net client directly
and follow the Work Queues and RPC tutorials:
http://www.rabbitmq.com/getstarted.html

You will find C# implementations here:
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet


Regards

Emile


From pavankumar.manikonda at schneider-electric.com  Thu Dec  1 12:00:08 2011
From: pavankumar.manikonda at schneider-electric.com (pavuuu)
Date: Thu, 1 Dec 2011 04:00:08 -0800 (PST)
Subject: [rabbitmq-discuss]  one queue - two consumers with prefetch 100
Message-ID: <32891585.post@talk.nabble.com>


I have two consumers(C1 & C2) with prefetch set to 100 on each of them. Also
both the queues are bound to the same queue on server. Now, say I've sent
1000 messages. Let us name the messages in queue from 1 to 1000, 1 being the
first message published into the queue and 1000 being the last one.

If both the consumers start running at the same time what way messages are
dispatched to the consumer ??

1 - 100 to C1  ----- 101 to 200 to C2 ----- 201 - 300 to C1  ----- 301 to
400 to C2 ------- and so on ??
-- 
View this message in context: http://old.nabble.com/one-queue---two-consumers-with-prefetch-100-tp32891585p32891585.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From vbernard42 at gmail.com  Thu Dec  1 12:47:26 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Thu, 1 Dec 2011 04:47:26 -0800 (PST)
Subject: [rabbitmq-discuss] one queue - two consumers with prefetch 100
In-Reply-To: <32891585.post@talk.nabble.com>
References: <32891585.post@talk.nabble.com>
Message-ID: <029b0365-0430-40e3-a059-9c2279c83e9f@a8g2000yqf.googlegroups.com>

Hi,

RabbitMQ uses round-robin dispatching. You can get more information
here: http://www.rabbitmq.com/tutorials/tutorial-two-java.html

With your example, it would be: 1 to C1, 2 to C2, 3 to C1, 4 to C2,
etc. If one of the worker is busy, and the other one isn't, the
message will be delivered to the worker who isn't busy ? which implies
that a worker may receive several messages in a row.

Cheers,

Valentin.

On 1 d?c, 13:00, pavuuu <pavankumar.maniko... at schneider-electric.com>
wrote:
> I have two consumers(C1 & C2) with prefetch set to 100 on each of them. Also
> both the queues are bound to the same queue on server. Now, say I've sent
> 1000 messages. Let us name the messages in queue from 1 to 1000, 1 being the
> first message published into the queue and 1000 being the last one.
>
> If both the consumers start running at the same time what way messages are
> dispatched to the consumer ??
>
> 1 - 100 to C1 ?----- 101 to 200 to C2 ----- 201 - 300 to C1 ?----- 301 to
> 400 to C2 ------- and so on ??
> --
> View this message in context:http://old.nabble.com/one-queue---two-consumers-with-prefetch-100-tp3...
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Dec  1 13:03:37 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Dec 2011 13:03:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ Clustering
In-Reply-To: <1d3c8608-e6c7-450f-a152-cadb220e5cc1@p16g2000yqd.googlegroups.com>
References: <1d3c8608-e6c7-450f-a152-cadb220e5cc1@p16g2000yqd.googlegroups.com>
Message-ID: <4ED77B29.8080603@rabbitmq.com>

Hi.

Depends what you mean by "scale as expected". In general, mirrored 
queues *do not add scalability* - as all the mirrors have to do the same 
amount of work anyway.

In practice mirrored queues are quite a bit slower than unmirrored ones, 
due to the amount of coordination needed across nodes.

Cheers, Simon

On 27/11/11 02:32, Venkat wrote:
> Good evening.
> Following is our clustering scenario:
> - Using RabbitMQ 2.6.1 with spring amqp 1.0 using RabbitMQ mirrored
> queues
> - We have two nodes on which queue consumers are running: q_c_node1
> and q_c_node2.
> - We have two rabbitmq nodes rmq_node1 and rmq_node2.
> - Using HA Proxy to load balance.
> - When q_c_node1 is started assume that there are two queue consumers
> q_c1 using queue q1 and q_c2 using queue q2 are started. Assume that
> HA Proxy routed the q1 creation to rmq_node1 and q2 creation to
> rmq_node2.
> - When q_c_node2 is started, q_c1 and q_c2 will be pointing to q1 on
> rmq_node1 and q2 on rmq_node2 as q1 and q2 are already created (please
> correct me if I am wrong).
> - Assume that rmq_node1 is down. Since mirrored queues are used, we
> have rmq_node2 as back up. The q_c1 consumer on q_c_node1 and
> q_c_node2 will be pointed to rmq_node2 using HA Proxy and spring-
> amqp's reconnecting mechanism. At this point two queue consumers
> runnning on q_c_node1 and q_c_node2 are using rmq_node2 (as rmq_node1
> is down). If a brand new rabbitmq node rmq_new_node joins the cluster
> (using ha-x-policy-all, therefore this node also is mirrored) will it
> scale as expected?. My concern is, q_c_node1 and q_c_node2 are
> pointing to rmq_node2. Whenever requests go to rmq_new_node I am
> assuming that they will be simply passed on to rmq_node1. How will the
> CPU Utilization and I/O activity will be affected on rmq_node2 and
> rmq_new_node?.
>
> Thanks
> Venkat
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From jfarrio at gmail.com  Thu Dec  1 13:31:17 2011
From: jfarrio at gmail.com (Shaun Xu)
Date: Thu, 1 Dec 2011 21:31:17 +0800
Subject: [rabbitmq-discuss] 2 WCF services on the same queue
In-Reply-To: <4ED76161.1030205@rabbitmq.com>
References: <CACbvtX-Gjv7nKp7umvc0CN0190WwDShqBtbcw925fEQ9wnNzsA@mail.gmail.com>
	<4ED76161.1030205@rabbitmq.com>
Message-ID: <8062A75E-1A1D-4A8F-AC49-8AAE388E40DE@gmail.com>

Thanks Emile. If I do want to use WCF then I need to create endpoints for each service instances and then let the client, or something like routing component to call one of them. Is that correct?

Shaun

Sent from my iPad

? 2011-12-1?19:13?Emile Joubert <emile at rabbitmq.com> ???

> On 01/12/11 06:09, Shaun Ziyan Xu wrote:
>> I would like to scaling out my application service and decided to use a
>> distributed queue to receive the client request, and multiple services
>> listening on the same queue. I think this is very common pooling-based
>> pattern.
>> I'm trying to use RebbitMQ with WCF binding, and when I use one client
>> and one service to works well. But when I created 2 services I found
>> when the client invoked, it gave me an exception said the
>> CommunicationObject State was Fault.
> 
> 
> Unfortunately each Service creates a new AMQP binding and a new queue
> for requests. Therefore each Service will receive all requests, leading
> to the errors you see.
> 
> If you want to use WCF then you could create separate endpoints for each
> worker and to round-robin at the request stage.
> 
> If you do not need to use WCF then use the RabbitMQ .net client directly
> and follow the Work Queues and RPC tutorials:
> http://www.rabbitmq.com/getstarted.html
> 
> You will find C# implementations here:
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet
> 
> 
> Regards
> 
> Emile
> 

From adamrabung at gmail.com  Thu Dec  1 14:25:19 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Thu, 1 Dec 2011 09:25:19 -0500
Subject: [rabbitmq-discuss] Testing lightweight publisher confirms
Message-ID: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>

Hello,
I am trying to test an implementation that uses lightweight publisher
confirms, and I'm wondering how to create conditions for causing
handleNack on my ConfirmListener to be called.  Unrouted messages go
to the ReturnListener.  Killing the server pretty much immediately
kills the underlying Connection/Channel.  I think I am just lacking
creativity today: does anyone have advice on how to simulate server
hiccups?  Secondly, what are the most common causes of
ConfirmListener.handleNack being called, since server connectivity
problems seem to immediately kill the channel?

Thank you,
Adam

From simon at rabbitmq.com  Thu Dec  1 14:29:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Dec 2011 14:29:27 +0000
Subject: [rabbitmq-discuss] Testing lightweight publisher confirms
In-Reply-To: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>
References: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>
Message-ID: <4ED78F47.3030608@rabbitmq.com>

On 01/12/11 14:25, Adam Rabung wrote:
> Secondly, what are the most common causes of
> ConfirmListener.handleNack being called, since server connectivity
> problems seem to immediately kill the channel?

An individual queue process crashing within RabbitMQ. That's the only 
thing that can do it. Obviously this makes it rather difficult to test.

I'm not *entirely* sure I want to introduce "rabbitmqctl crash_queue 
<queuename>", but maybe it's needed...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Dec  1 14:42:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Dec 2011 14:42:39 +0000
Subject: [rabbitmq-discuss] Testing lightweight publisher confirms
In-Reply-To: <4ED78F47.3030608@rabbitmq.com>
References: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>
	<4ED78F47.3030608@rabbitmq.com>
Message-ID: <4ED7925F.1090605@rabbitmq.com>

On 01/12/11 14:29, Simon MacMullen wrote:
> On 01/12/11 14:25, Adam Rabung wrote:
>> Secondly, what are the most common causes of
>> ConfirmListener.handleNack being called, since server connectivity
>> problems seem to immediately kill the channel?
>
> An individual queue process crashing within RabbitMQ. That's the only
> thing that can do it. Obviously this makes it rather difficult to test.

Ah, hang on. One way to "crash" a queue is to have it running on a 
single node in a cluster and take that node down. So:

1) Create a two node cluster, node1 and node2.
2) Create a non-mirrored queue on node1.
3) Start a publisher using confirms on node2, publishing to that queue.
4) Stop node1.

You should see nacks then I think.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From joseph.misiti at gmail.com  Thu Dec  1 15:13:37 2011
From: joseph.misiti at gmail.com (misiti3780)
Date: Thu, 1 Dec 2011 07:13:37 -0800 (PST)
Subject: [rabbitmq-discuss] Question Regarding RabbitMQ Administration
Message-ID: <958fafa2-0775-4736-824a-a3316a630d21@v29g2000yqv.googlegroups.com>

I am running RabbitMQ for doing a lot of asynchronous processing via
Django-Celery in a web app.
I have a couple questions regarding how to monitor this process:

The problem I am seeing is for some reason, my queues are getting
overloaded and then when I try
to purge the queues using rabbitmqadmin, it says it cannot connect. I
am trying to track down the problem
and it looks like there must be an upper bound to the number of
messages a broker can handle but I guess
what I am looking for is

why would rabbitmqadmin return a "cannot connect error"

what is the best way to monitor rabbitmq? rabbitmqctl + rabbitmqadmin
or something else
like munin.

can you provide any open-source examples of monitoring scripts if
possible?

From vbernard42 at gmail.com  Thu Dec  1 16:04:49 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Thu, 1 Dec 2011 08:04:49 -0800 (PST)
Subject: [rabbitmq-discuss] Question Regarding RabbitMQ Administration
In-Reply-To: <958fafa2-0775-4736-824a-a3316a630d21@v29g2000yqv.googlegroups.com>
References: <958fafa2-0775-4736-824a-a3316a630d21@v29g2000yqv.googlegroups.com>
Message-ID: <2077c780-7a22-40de-ba02-3d5e364e3ea4@p16g2000yqd.googlegroups.com>

Hi,

Did you enable the 'rabbitmq_management' plugin? Can you access the
web interface at http://yourserver:55672 ?

Regards,

Valentin.

On 1 d?c, 16:13, misiti3780 <joseph.mis... at gmail.com> wrote:
> I am running RabbitMQ for doing a lot of asynchronous processing via
> Django-Celery in a web app.
> I have a couple questions regarding how to monitor this process:
>
> The problem I am seeing is for some reason, my queues are getting
> overloaded and then when I try
> to purge the queues using rabbitmqadmin, it says it cannot connect. I
> am trying to track down the problem
> and it looks like there must be an upper bound to the number of
> messages a broker can handle but I guess
> what I am looking for is
>
> why would rabbitmqadmin return a "cannot connect error"
>
> what is the best way to monitor rabbitmq? rabbitmqctl + rabbitmqadmin
> or something else
> like munin.
>
> can you provide any open-source examples of monitoring scripts if
> possible?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Thu Dec  1 16:11:52 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 1 Dec 2011 10:11:52 -0600
Subject: [rabbitmq-discuss] RabbitMQ support AMQP 1.0 schedule
In-Reply-To: <2dd010f1-ac37-4a84-9fd6-74f70453836b@q30g2000yqj.googlegroups.com>
References: <2dd010f1-ac37-4a84-9fd6-74f70453836b@q30g2000yqj.googlegroups.com>
Message-ID: <CACOPnvfQ0qJtuh7UYZ803ukCSMNmH7K79+N2ruuZW=WqCASerw@mail.gmail.com>

Kenshin

At the AMQP conference in New York, we demonstrated RabbitMQ
supporting 0-91 and 1-0 together.  Please note that 1-0 is supported
via a plugin which is not ready for production use.  You are welcome
to give it a try!

To your other question, we don't recommend using 0-10 clients with
RabbitMQ.  Have you tried the Rabbit Java client?

alexis


On Thu, Dec 1, 2011 at 2:10 AM, kenshin <kenshin.acs at gmail.com> wrote:
> Hi:
> ? Is there a schedule. RabbitMQ support AMQP 1.0 ? Or,Is there a
> method RabbtMQ can support negotiating with AMQP 0-10 ? Because our
> client publish message by qpid . and default use AMQP 0-10 .
>
> ?Hope can get some direction or sugesstion
> ?Thanks
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brunoac88 at gmail.com  Thu Dec  1 17:03:32 2011
From: brunoac88 at gmail.com (Bruno Carneiro)
Date: Thu, 1 Dec 2011 15:03:32 -0200
Subject: [rabbitmq-discuss] Rabbit RPC Application
Message-ID: <CAGy26MMaHGEFRuKUQZ1n9Tcyom3TEccAKQKBYdu4Gmwv1fbkQg@mail.gmail.com>

Hello Everybody,

I developed a monitoring application using Rabbit and Rabbit RPC plugin.
I'm monitoring events on my HTML pages and sending messages over HTTP.
What my javascript does is for each event, it opens a channel, send a
message and close that channel. This is the snippet:

 function on_open(channel) {
>
>  channel.queueDeclare(exchangeQueue, false, true, false, false)
>
>     .addCallback( function() {
>
>  channel.basicPublish("", exchangeQueue, exchangeMessage, props);
>
>  channel.close();
>
>  });
>
>    }
>
>
>>    function trackEvent(queue, jsonMsg){
>
>  channel = RabbitMQ.openChannel(on_open, {'exchangeQueue': queue,
>> 'exchangeMessage': jsonMsg});
>
>    }
>
>

When I saw the examples I was wondering what is the best practice using
channel in a browser?
Should I open and close it for each message or should I leave it open and
send messages through this channel?

Thank you!

Cheers,

Bruno Carneiro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111201/cd2a5127/attachment.htm>

From 0x6e6562 at gmail.com  Thu Dec  1 17:10:23 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 1 Dec 2011 17:10:23 +0000
Subject: [rabbitmq-discuss] Debugging AD
In-Reply-To: <CAB-G1jgN3p=LK9m2sfaFpOOSLv=zBCsGrmTp+nvt5mZR14+ARA@mail.gmail.com>
References: <CAB-G1jj513G9QWVSs4HN3X1U+xBL-_8MN50ryTeK0Zcg5sWXeg@mail.gmail.com>
	<4ED5258D.3050000@rabbitmq.com>
	<CAB-G1jge97D02yL+2uuHEOpvKE3_C93BWAO9dTDzFUBdXXi+zg@mail.gmail.com>
	<4ED52A88.7030808@rabbitmq.com> <4ED60914.1010507@rabbitmq.com>
	<CAB-G1jhATsBxXmVE5HKL6Sxh7a2v1ooUZhZoC9MtAjkYanpQJQ@mail.gmail.com>
	<CAB-G1jgN3p=LK9m2sfaFpOOSLv=zBCsGrmTp+nvt5mZR14+ARA@mail.gmail.com>
Message-ID: <CAB-G1jiO-ANH=v9NbYW8mzvV=Acke82eOdF9hNVYCgmdRq9zhQ@mail.gmail.com>

On Wed, Nov 30, 2011 at 4:44 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Hi Simon,
>
> So after spinning the underlying LDAP driver on it's own, I was able
> to establish what combination of input parameters was going to work
> with AD:
>
> 1> {_, C} = eldap:open(["172.20.3.21"],[]).
> 2> eldap:simple_bind(C,
> "ben.hood at ACMEDOMAIN","DB/nUcPk?DdF<eCjp?erzpbi[g"BdJL.w;pFrT>tg at KnbCDsi").
> ok
>
> So this boils down to putting
>
> {user_dn_pattern, ? ? ? "${username}@ACMEDOMAIN"},

I've managed to test for group membership in AD using after applying this patch:

iff -r 99212b40d834 src/rabbit_auth_backend_ldap.erl
--- a/src/rabbit_auth_backend_ldap.erl	Wed Nov 09 10:20:24 2011 +0000
+++ b/src/rabbit_auth_backend_ldap.erl	Thu Dec 01 17:03:48 2011 +0000
@@ -119,7 +119,7 @@
     object_exists(DNPattern, Filter, Args, LDAP);

 evaluate({in_group, DNPattern}, Args, #user{impl = UserDN}, LDAP) ->
-    Filter = eldap:'and'([eldap:equalityMatch("objectClass", "groupOfNames"),
+    Filter = eldap:'and'([eldap:equalityMatch("objectClass", "group"),
                           eldap:equalityMatch("member",      UserDN)]),
     object_exists(DNPattern, Filter, Args, LDAP);

However, I think I may have run into a brick wall with the bind with AD.

$ ldapsearch -h 172.20.3..21 -w 'xxx' -b "dc=acme,dc=com" -D
"ACMEDOMAIN\\ben.hood"

will return a whole subtree of results, but for an in_group query to work, e.g.

{resource_access_query,
     {for, [
        {permission, configure, {in_group, "CN=Rabbit
Admins,DC=acme,DC=com" } },
        {permission, configure, {constant, false} }
     ]}
   },

the original bind request will have had to returned the full user DN,
not a list of results.

To get AD to return a single user DN, you can do the following:

$ ldapsearch -h 172.20.3..21 -w 'xxx' -b "dc=acme,dc=com" -D
"ACMEDOMAIN\\ben.hood" '(sAMAccountName=ben.hood)' dn

But with AFAICT with eldap this would require the bind to be followed
by a subsequent query by attribute, like the example in the LDAP
driver shows: https://github.com/etnt/eldap/blob/master/doc/README.example

So I would love to be corrected, but I can't see how AD authentication
can work without post-processing the initial bind call. Has anybody
else had any success with AD where authentication for the bind is
required?

Cheers,

Ben

From bryan.t.burke at gmail.com  Thu Dec  1 21:58:47 2011
From: bryan.t.burke at gmail.com (Bryan Burke)
Date: Thu, 1 Dec 2011 13:58:47 -0800 (PST)
Subject: [rabbitmq-discuss] In-memory Cache or Messages?
Message-ID: <6cc14d03-2bff-44d0-b246-9889c097ca02@b32g2000yqn.googlegroups.com>

I have an application that performs pretty hefty number crunching on
large arrays.  Right now, there is an independent process that reads
the data from disk and caches it in Redis, passing the key to the
worker (basically pointer to data structure).  I'm not rewriting the
task queue with RabbitMQ.  Would it be better to pass these arrays
directly as messages or to stick with a scheme of passing the keys to
the queue and keeping the arrays in the cache?

Thanks in advance for your help!

Bryan

From kenshin.acs at gmail.com  Fri Dec  2 02:16:27 2011
From: kenshin.acs at gmail.com (kenshin)
Date: Fri, 2 Dec 2011 10:16:27 +0800
Subject: [rabbitmq-discuss] RabbitMQ support AMQP 1.0 schedule
In-Reply-To: <CACOPnvfQ0qJtuh7UYZ803ukCSMNmH7K79+N2ruuZW=WqCASerw@mail.gmail.com>
References: <2dd010f1-ac37-4a84-9fd6-74f70453836b@q30g2000yqj.googlegroups.com>
	<CACOPnvfQ0qJtuh7UYZ803ukCSMNmH7K79+N2ruuZW=WqCASerw@mail.gmail.com>
Message-ID: <CANmsRfdDkL+Afgb8xeG4YM6MYQz-CUovDSXdCPRFs6_0Dgqzcg@mail.gmail.com>

Hi Alexis:
    Thank you very much for replying soon.
In my project. The client devices use QPID publish messages.This is no way
to change.because the devices had been sold to many customers.But all our
team members like RabbitMQ rather than QPID.So we decide use RabbitMQ as
broker and i am search the way that RabbitMQ can communicate with QPID.
    I will try the plugin you mentioned. And do you have any other
suggestion?

   Thanks again for you replying.

    kenshin

2011/12/2 Alexis Richardson <alexis at rabbitmq.com>

> Kenshin
>
> At the AMQP conference in New York, we demonstrated RabbitMQ
> supporting 0-91 and 1-0 together.  Please note that 1-0 is supported
> via a plugin which is not ready for production use.  You are welcome
> to give it a try!
>
> To your other question, we don't recommend using 0-10 clients with
> RabbitMQ.  Have you tried the Rabbit Java client?
>
> alexis
>
>
> On Thu, Dec 1, 2011 at 2:10 AM, kenshin <kenshin.acs at gmail.com> wrote:
> > Hi:
> >   Is there a schedule. RabbitMQ support AMQP 1.0 ? Or,Is there a
> > method RabbtMQ can support negotiating with AMQP 0-10 ? Because our
> > client publish message by qpid . and default use AMQP 0-10 .
> >
> >  Hope can get some direction or sugesstion
> >  Thanks
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/40212cc2/attachment.htm>

From alex.gronholm at nextday.fi  Fri Dec  2 11:33:03 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Fri, 2 Dec 2011 03:33:03 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
Message-ID: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>

I've developed an RPC system using RabbitMQ (with different semantics than 
the built-in RPC). I'd like to get the server to send the client some kind 
of a notification if a message it has sent will never be delivered (like if 
the queue which it was routed to was deleted before the message was 
consumed from it). Is there any way to accomplish this? Client side 
timeouts are not good enough either because the request might get processed 
at some point then anyway.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/bd404e14/attachment.htm>

From simon at rabbitmq.com  Fri Dec  2 11:49:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Dec 2011 11:49:39 +0000
Subject: [rabbitmq-discuss] Debugging AD
In-Reply-To: <CAB-G1jiO-ANH=v9NbYW8mzvV=Acke82eOdF9hNVYCgmdRq9zhQ@mail.gmail.com>
References: <CAB-G1jj513G9QWVSs4HN3X1U+xBL-_8MN50ryTeK0Zcg5sWXeg@mail.gmail.com>	<4ED5258D.3050000@rabbitmq.com>	<CAB-G1jge97D02yL+2uuHEOpvKE3_C93BWAO9dTDzFUBdXXi+zg@mail.gmail.com>	<4ED52A88.7030808@rabbitmq.com>	<4ED60914.1010507@rabbitmq.com>	<CAB-G1jhATsBxXmVE5HKL6Sxh7a2v1ooUZhZoC9MtAjkYanpQJQ@mail.gmail.com>	<CAB-G1jgN3p=LK9m2sfaFpOOSLv=zBCsGrmTp+nvt5mZR14+ARA@mail.gmail.com>
	<CAB-G1jiO-ANH=v9NbYW8mzvV=Acke82eOdF9hNVYCgmdRq9zhQ@mail.gmail.com>
Message-ID: <4ED8BB53.1050809@rabbitmq.com>

On 01/12/11 17:10, Ben Hood wrote:
> So I would love to be corrected, but I can't see how AD authentication
> can work without post-processing the initial bind call. Has anybody
> else had any success with AD where authentication for the bind is
> required?

So after some off-list discussion, the issue is that AD allows you to 
bind using a short ID rather than a full name - useful in the case where 
you have too many users to stick them in a single OU, but don't want 
people to have to enter their full DN to log in.

But the LDAP plugin assumes that the name you log in as is your full DN 
(after applying user_dn_pattern). So it would be useful to have an 
optional step to go look up the DN after bind.

I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vbernard42 at gmail.com  Fri Dec  2 12:12:28 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Fri, 2 Dec 2011 04:12:28 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
Message-ID: <06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>

Hi,

If your clients publish messages with the mandatory flag set, they
will get a Basic.Return from the server if the message can't be routed
to a queue. Does that solve your problem?

Java example: http://www.rabbitmq.com/api-guide.html#returning

Cheers,

Valentin.

On 2 d?c, 12:33, Alex Gr?nholm <alex.gronh... at nextday.fi> wrote:
> I've developed an RPC system using RabbitMQ (with different semantics than
> the built-in RPC). I'd like to get the server to send the client some kind
> of a notification if a message it has sent will never be delivered (like if
> the queue which it was routed to was deleted before the message was
> consumed from it). Is there any way to accomplish this? Client side
> timeouts are not good enough either because the request might get processed
> at some point then anyway.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Dec  2 12:20:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Dec 2011 12:20:16 +0000
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
Message-ID: <4ED8C280.9020707@rabbitmq.com>

If on the other hand Alex is interested in learning about messages that 
have been deleted once they've made it to queues then there's currently 
no way to find out about that.

We are currently looking at implementing dead lettering, which might 
help with this.

Cheers, Simon

On 02/12/11 12:12, Valentin BERNARD wrote:
> Hi,
>
> If your clients publish messages with the mandatory flag set, they
> will get a Basic.Return from the server if the message can't be routed
> to a queue. Does that solve your problem?
>
> Java example: http://www.rabbitmq.com/api-guide.html#returning
>
> Cheers,
>
> Valentin.
>
> On 2 d?c, 12:33, Alex Gr?nholm<alex.gronh... at nextday.fi>  wrote:
>> I've developed an RPC system using RabbitMQ (with different semantics than
>> the built-in RPC). I'd like to get the server to send the client some kind
>> of a notification if a message it has sent will never be delivered (like if
>> the queue which it was routed to was deleted before the message was
>> consumed from it). Is there any way to accomplish this? Client side
>> timeouts are not good enough either because the request might get processed
>> at some point then anyway.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alex.gronholm at nextday.fi  Fri Dec  2 12:33:21 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Fri, 2 Dec 2011 04:33:21 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
Message-ID: <1048724.408.1322829201946.JavaMail.geo-discussion-forums@yqiv14>

That only happens if the queue is not there to begin with. If the queue is 
there and it expires, no return message is ever generated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/15098aef/attachment.htm>

From alex.gronholm at nextday.fi  Fri Dec  2 12:36:25 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Fri, 2 Dec 2011 04:36:25 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4ED8C280.9020707@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
	<4ED8C280.9020707@rabbitmq.com>
Message-ID: <19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>

Yes, that is exactly my problem. Seems there is no solution then :(
I want to keep my "rpc" queue alive even when the RPC server software is 
being upgraded so that users will only see a delay in the responses (and no 
lost requests).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/cf049eec/attachment.htm>

From matthias at rabbitmq.com  Fri Dec  2 12:44:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 Dec 2011 12:44:30 +0000
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
Message-ID: <4ED8C82E.1070906@rabbitmq.com>

On 02/12/11 12:36, Alex Gr?nholm wrote:
> I want to keep my "rpc" queue alive even when the RPC server software is
> being upgraded so that users will only see a delay in the responses (and
> no lost requests).

So just make sure the rpc queue stays around during the upgrade.

Matthias.

From alex.gronholm at nextday.fi  Fri Dec  2 14:21:41 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Fri, 2 Dec 2011 06:21:41 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4ED8C82E.1070906@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
Message-ID: <4687248.540.1322835701216.JavaMail.geo-discussion-forums@yqgc13>

That was the plan from the start, but I wanted to cover cases where 
something goes wrong (server starts with rabbitmq but not the rpc server) 
in which case the client would be stuck waiting forever.
But I guess that dead lettering feature will fix that.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/f501417f/attachment.htm>

From steve at rabbitmq.com  Fri Dec  2 14:39:28 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 2 Dec 2011 14:39:28 +0000
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4ED8C82E.1070906@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
Message-ID: <855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>

Dear Alex,

Just to be precise about this: the 'standard' RpcServer uses a passed in queue
or creates its queue as follows:

	queueDeclare()

which is equivalent to:

	queueDeclare("", false, true, true, null)

which creates a non-durable, exclusive, auto-delete queue, named by the broker.

If you want your queue to survive the connection, it mustn't be exclusive to the
connection that creates it.

In order to survive a server failure you would make it durable.

To re-use the same queue later (after upgrade?), you had better name it yourself
(and re-use the name each time).

If the queue should persist after the last consumer (RpcServer?) is cancelled
from the queue, then it should not be auto-delete.

Does this give you the flexibility you require?

I do not know  your situation exactly, but it looks as though you need a named
non-exclusive queue, at the very least.
If you expect each server instance to be solely responsible for the request
queue it serves, then a simple naming scheme will suffice, but you still have to
be careful to have at most one instance of that server running at any one time.

Of course, having more than one server processing requests from a queue is
alright, too; if you are happy with way requests are shared out.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 2 Dec 2011, at 12:44, Matthias Radestock wrote:
> On 02/12/11 12:36, Alex Gr?nholm wrote:
>> I want to keep my "rpc" queue alive even when the RPC server software is
>> being upgraded so that users will only see a delay in the responses (and
>> no lost requests).
> 
> So just make sure the rpc queue stays around during the upgrade.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ask at rabbitmq.com  Fri Dec  2 14:42:27 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 2 Dec 2011 14:42:27 +0000
Subject: [rabbitmq-discuss] Publish on a queue, Wait for Reply on another,
	add time out for the monitor (Select Connection)
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8187B6C43@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8187B6C43@TLMAIL1.Transparent.local>
Message-ID: <AFA084C4-2473-462B-8BA8-236508A141C6@rabbitmq.com>


On 29 Nov 2011, at 21:33, Christopher Lefevre wrote:

> Hello,
> I?m trying to do EXACTLY THIS:
> http://stackoverflow.com/questions/2799731/wait-for-a-single-rabbitmq-message-with-a-timeout
> However I?m using Pika for all of my RabbitMQ communications, and unfortunately the ?Answer? is just ?Fixed? which isn?t really applicable to use in my situation.

The 'fixed' refers to amqplib, it doesn't mention pika.

> 
> For a quick summary, I?m trying to send a message to RabbitMQ, then wait on a reply from the workers on the other side of the RabbitMQ queue on an exclusive queue. I would like to have a timeout setting on the monitor to wait for the message, just in case the server is down, or taking an absurd amount of time.
> 

I don't have much experience using pika, but I'll try
to provide a general answer.

You shouldn't be blocking waiting for a single message
if your program is async.  Instead you should use basic_consume
for every reply you are interested in, with a callback for each.

Something like:

reply_exchange = "replies"

def handle_reply(message):
   reply_id = message.properties

def add_reply_callback(channel, publisher_id, reply_id, callback):
   channel.exchange_declare(reply_exchange)
   channel.queue_declare(publisher_id)
   channel.queue_bind(publisher_id, reply_exchange, reply_id)

   channel.basic_consume(callback, queue=publisher_id)


def send_rpc(message, callback, producer_channel,
       consumer_channel, publisher_id):
   reply_id = uuid()

   add_reply_callback(consumer_channel, publisher_id, reply_id, callback)
   producer_channel.basic_publish(message, properties={
	"reply_to": reply_id})


This assumes you have a 'thread' draining events from the consumer_channel.

If you need to add a timeout on top of this, then the best route
depends on the async framework you are using?






From majek04 at gmail.com  Fri Dec  2 14:45:20 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Dec 2011 14:45:20 +0000
Subject: [rabbitmq-discuss] In-memory Cache or Messages?
In-Reply-To: <6cc14d03-2bff-44d0-b246-9889c097ca02@b32g2000yqn.googlegroups.com>
References: <6cc14d03-2bff-44d0-b246-9889c097ca02@b32g2000yqn.googlegroups.com>
Message-ID: <CABzX+qxh5ks_yvSxH5MypSwtc4PyEu-ObSv+uKyQS0++Y=ntLQ@mail.gmail.com>

On Thu, Dec 1, 2011 at 21:58, Bryan Burke <bryan.t.burke at gmail.com> wrote:
> I have an application that performs pretty hefty number crunching on
> large arrays. ?Right now, there is an independent process that reads
> the data from disk and caches it in Redis, passing the key to the
> worker (basically pointer to data structure). ?I'm not rewriting the
> task queue with RabbitMQ. ?Would it be better to pass these arrays
> directly as messages or to stick with a scheme of passing the keys to
> the queue and keeping the arrays in the cache?

The clear answer is that there is no clear answer!

Do benchmarks. Frankly. If the arrays aren't too big you should be
better off passing them as part of messages. OTOH if your
client is badly written and slow, you may be better off asking Redis
about the data.

But do benchmarks, implement both and measure what behaves better
in your situation.

Marek

From tonygarnockjones+rabbitmq at gmail.com  Fri Dec  2 15:12:15 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 2 Dec 2011 10:12:15 -0500
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4687248.540.1322835701216.JavaMail.geo-discussion-forums@yqgc13>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<4687248.540.1322835701216.JavaMail.geo-discussion-forums@yqgc13>
Message-ID: <CAM8fPiQySXBBbBbjuKjzYLcd_KjoKaF8QoRb7MFdt9E=0VwXyw@mail.gmail.com>

This is where the "mandatory" feature comes in.

1. Declare your queue as durable.
2. Send your RPC requests with "mandatory" flag.

Then:

   - if rabbitmq is down, the RPC client won't be able to connect. Clear.
   - if rabbitmq is up, but the RPC server is down, and noone has created
   the queue yet, then the request will be Basic.Return'd to you. Also clear.
   - if rabbitmq is up, but the RPC server is down, and the queue was
   previously created by somebody, then the request will be enqueued. As long
   as the RPC server returns to service in a timely way, everyone's happy.
   - if rabbitmq is up, and the RPC server is up, normal service ensues.

Regards,
  Tony



On 2 December 2011 09:21, Alex Gr?nholm <alex.gronholm at nextday.fi> wrote:

> That was the plan from the start, but I wanted to cover cases where
> something goes wrong (server starts with rabbitmq but not the rpc server)
> in which case the client would be stuck waiting forever.
> But I guess that dead lettering feature will fix that.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/3395f0ab/attachment.htm>

From sophiewenxizhang at googlemail.com  Fri Dec  2 16:26:01 2011
From: sophiewenxizhang at googlemail.com (TZHA)
Date: Fri, 2 Dec 2011 08:26:01 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c (librabbizmq) works only
	partially.
In-Reply-To: <yrv4ck46kfh9p.fsf@dwragg.eng.vmware.com>
References: <loom.20111128T112008-575@post.gmane.org>
	<yrv4cobvwfn38.fsf@dwragg.eng.vmware.com>
	<abedf3db-60b0-4369-9dce-676629672d02@r28g2000yqj.googlegroups.com>
	<yrv4ck46kfh9p.fsf@dwragg.eng.vmware.com>
Message-ID: <9a957d55-452a-44f4-b65f-fe15fcdcad3d@p2g2000vbj.googlegroups.com>

Thanks for the reply.

I will check it during the next week.



On 28 Nov., 15:33, David Wragg <da... at rabbitmq.com> wrote:
> TZHA <sophiewenxizh... at googlemail.com> writes:
> > The error I got with the latest version ofrabbitmq-cwas:
>
> > "A buffer overrun has occurred in z_rabbitmq_client_consumer.exe which
> > has corrupted the program's internal state. Press Break to debug the
> > program or Continue to terminate the program.
>
> This is because you are trying to use a mingw build of librabbitmq from
> Visual Studio. ?This doesn't work because VS and gcc disagree about x86
> calling conventions. ?As a result, the program crashes is a way that VS
> diagnoses as a buffer overrun.
>
> > I started VS 2010 debugging on a consumer project (c++) which uses the
> >rabbitmq-cc api.
>
> > I guess I finally found out at least the reason for my previous
> > error. ?I used a c++ wrapper (amqpcpp ?- modified) which calls
> > amqp_simple_rpc to implement the consumer, which then caused the error
> > (but runs correctly with DEBUG).
>
> > I modified the code to use amqp_basic_consume (following the
> > consumer.c), the c++ consumer ?application works now.
>
> > However, I still have the buffer overrun problem with the latest
> > version. I used MinGW to build the package. ?Do you whether there is a
> > guide/readme for cmake build?
>
> There are some brief instructions in therabbitmq-cREADME. ?In more
> detail:
>
> Install cmake (from <http://cmake.org/>). ?Then open up a command
> prompt, create a build directory, and from there run cmake with the path
> to therabbitmq-csource directory:
>
> Z:\>cd tmp
>
> Z:\tmp>mkdirrabbitmq-c-build
>
> Z:\tmp>cdrabbitmq-c-build
>
> Z:\tmp\rabbitmq-c-build>cmake ..\rabbitmq-c
> -- Building for: Visual Studio 10
> -- Check for working C compiler using: Visual Studio 10
> -- Check for working C compiler using: Visual Studio 10 -- works
> -- Detecting C compiler ABI info
> -- Detecting C compiler ABI info - done
> -- Found PythonInterp: C:/Python27/python.exe (found version "2.7")
> -- Using amqp_codegen.py in Z:/tmp/rabbitmq-codegen
> -- Configuring done
> -- Generating done
> -- Build files have been written to: Z:/tmp/rabbitmq-c-build
>
> Then open up therabbitmq-c.sln file in VS, and build.
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From 0x6e6562 at gmail.com  Fri Dec  2 17:14:30 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 2 Dec 2011 17:14:30 +0000
Subject: [rabbitmq-discuss] Debugging AD
In-Reply-To: <4ED8BB53.1050809@rabbitmq.com>
References: <CAB-G1jj513G9QWVSs4HN3X1U+xBL-_8MN50ryTeK0Zcg5sWXeg@mail.gmail.com>
	<4ED5258D.3050000@rabbitmq.com>
	<CAB-G1jge97D02yL+2uuHEOpvKE3_C93BWAO9dTDzFUBdXXi+zg@mail.gmail.com>
	<4ED52A88.7030808@rabbitmq.com> <4ED60914.1010507@rabbitmq.com>
	<CAB-G1jhATsBxXmVE5HKL6Sxh7a2v1ooUZhZoC9MtAjkYanpQJQ@mail.gmail.com>
	<CAB-G1jgN3p=LK9m2sfaFpOOSLv=zBCsGrmTp+nvt5mZR14+ARA@mail.gmail.com>
	<CAB-G1jiO-ANH=v9NbYW8mzvV=Acke82eOdF9hNVYCgmdRq9zhQ@mail.gmail.com>
	<4ED8BB53.1050809@rabbitmq.com>
Message-ID: <CAB-G1jgiKjcmE6nCRU5qr1iETu=7LBbcu=UZuvP4xcEQj7bfsQ@mail.gmail.com>

On Fri, Dec 2, 2011 at 11:49 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> So after some off-list discussion, the issue is that AD allows you to bind
> using a short ID rather than a full name - useful in the case where you have
> too many users to stick them in a single OU, but don't want people to have
> to enter their full DN to log in.
>
> But the LDAP plugin assumes that the name you log in as is your full DN
> (after applying user_dn_pattern). So it would be useful to have an optional
> step to go look up the DN after bind.
>
> I'll file a bug.

So it would be cool if this were to land sometime soon. In the
meantime, I have been able to use a workaround of sorts. So by just
letting AD users get the innocuous monitoring role, they can see
everything that is "going on" without be able to do anything like
reading, writing, adding, deleting, binding or purging - it is purely
statistical. All other functions can be executed by users defined in
the internal DB.

Whilst not being as flexible and fully fledged as a full AD solution,
it does add some value right now, because people can use the
management UI as a heads up display, e.g. to see when things get
wedged.

For anybody that is interested, here is the
/etc/rabbitmq/rabbitmq.config I used:

[

 %% Enable SSL support for the Management Web UI
 %% Note that you have to supply the CA cert, the server's cert and
the server's private key yourself

  {rabbitmq_mochiweb,
  [{listeners, [{'*',  [{port,     55670}]},
                {mgmt, [{port,     55672},
                        {ssl,      true},
			{ssl_opts, [{cacertfile, "/path/to/cacert.pem"},
                                    {certfile,   "/path/to/cert.pem"},
                                    {keyfile,    "/path/to/key.pem"}]}
                       ]}
               ]}
  ]},

 %% Enable both the internal user DB and LDAP
 %% Make sure that the internal store has precedence, otherwise
internal users may not be able to use the management UI

 {rabbit, [ {auth_backends, [rabbit_auth_backend_internal,
rabbit_auth_backend_ldap]} ]  },

 %% Configure the connection to AD

 {rabbitmq_auth_backend_ldap,
 [
   %% The main AD server

   {servers,               ["172.20.3.21"]},

   %% This is the user that is logging in using their AD creds.

   {user_dn_pattern,       "${username}@ACMECORP"},

   %% The LDAP plugin in Rabbit 2.7.0 doesn't appear to play as well
as it does with other LDAP implementations,
   %% so the appropriate tickets have been raised at VMWare to get
this fixed for a future version.

   {resource_access_query,
     {for, [ {permission, configure, {constant, false}},
             {permission, read, {constant, false}},
             {permission, write, {constant, false}} ]}
   },

   %% Only allow LDAP users to monitor what is going on

   {tag_queries,           [{monitoring, {constant, true}}]},

   %% Self-explanatory
	
   {use_ssl,               false},
   {port,                  389},
   {log,                   false} ] }
].

From simon at rabbitmq.com  Fri Dec  2 18:11:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 02 Dec 2011 18:11:24 +0000
Subject: [rabbitmq-discuss] Question Regarding RabbitMQ Administration
In-Reply-To: <958fafa2-0775-4736-824a-a3316a630d21@v29g2000yqv.googlegroups.com>
References: <958fafa2-0775-4736-824a-a3316a630d21@v29g2000yqv.googlegroups.com>
Message-ID: <4ED914CC.7010606@rabbitmq.com>

On 01/12/11 15:13, misiti3780 wrote:
> I am running RabbitMQ for doing a lot of asynchronous processing via
> Django-Celery in a web app.
> I have a couple questions regarding how to monitor this process:
>
> The problem I am seeing is for some reason, my queues are getting
> overloaded and then when I try
> to purge the queues using rabbitmqadmin, it says it cannot connect. I
> am trying to track down the problem
> and it looks like there must be an upper bound to the number of
> messages a broker can handle but I guess
> what I am looking for is
>
> why would rabbitmqadmin return a "cannot connect error"

I assume that you are only getting this error when trying to *purge* the 
queue (not list queues or similar).

rabbitmqadmin talks to the management plugin, which in turn gets 
information about the state of rabbit from mnesia and statistics events 
which are emitted by queues, connections and channels. So to list queues 
it does *not* need to contact each queue to query it for stats.

However, to purge a queue it does need to contact that queue. If the 
queue is busy it might have a large mailbox in front of it, in which 
case the request to purge might take a while to get to the front. 
However, I would hope mgmt would not time out. Can you show me the error 
message you're seeing?

> what is the best way to monitor rabbitmq? rabbitmqctl + rabbitmqadmin
> or something else
> like munin.

I would say use something that talks to the management plugin - such as 
rabbitmqadmin. Some of the community-developed scripts do this too. If 
you are worried about queues being overloaded, don't use rabbitmqctl as 
it *does* need to contact every queue for list_queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Mark.Geib at echostar.com  Fri Dec  2 18:15:14 2011
From: Mark.Geib at echostar.com (Geib, Mark)
Date: Fri, 2 Dec 2011 11:15:14 -0700
Subject: [rabbitmq-discuss] unsubscribe
Message-ID: <987F73FF-4950-490E-A9EE-7F45DA843FA2@echostar.com>

unsubscribe

Mark Geib
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com<mailto:mark.geib at echostar.com> / 35-215


?We, the unwilling, led by the unknowing, are doing the impossible for the ungrateful. We have done so much, for so long, with so little, we are now qualified to do anything with nothing.?
? Mother Teresa<http://www.goodreads.com/author/show/838305.Mother_Teresa>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111202/c684f6a3/attachment.htm>

From alexis at rabbitmq.com  Sat Dec  3 03:10:55 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 2 Dec 2011 21:10:55 -0600
Subject: [rabbitmq-discuss] RabbitMQ support AMQP 1.0 schedule
In-Reply-To: <CANmsRfdDkL+Afgb8xeG4YM6MYQz-CUovDSXdCPRFs6_0Dgqzcg@mail.gmail.com>
References: <2dd010f1-ac37-4a84-9fd6-74f70453836b@q30g2000yqj.googlegroups.com>
	<CACOPnvfQ0qJtuh7UYZ803ukCSMNmH7K79+N2ruuZW=WqCASerw@mail.gmail.com>
	<CANmsRfdDkL+Afgb8xeG4YM6MYQz-CUovDSXdCPRFs6_0Dgqzcg@mail.gmail.com>
Message-ID: <CACOPnvcB0+wjAWYvu8L3aBLij1qjvLe0822mLPPOssad5f2hRg@mail.gmail.com>

Kenshin

Perhaps you could set up some sort of relay?  This would involve
writing some code.

alexis



On Thu, Dec 1, 2011 at 8:16 PM, kenshin <kenshin.acs at gmail.com> wrote:
> Hi Alexis:
> ? ??Thank you very much for replying soon.
> In my project. The client devices use QPID publish messages.This is no way
> to change.because the devices had been sold to many customers.But all our
> team members like RabbitMQ rather than QPID.So we decide use RabbitMQ as
> broker and i am search the way that RabbitMQ can communicate with QPID.
> ? ? I will try the?plugin you?mentioned. And do you have any other
> suggestion?
>
> ? ?Thanks again for you replying.
>
> ? ? kenshin
>
>
> 2011/12/2 Alexis Richardson <alexis at rabbitmq.com>
>>
>> Kenshin
>>
>> At the AMQP conference in New York, we demonstrated RabbitMQ
>> supporting 0-91 and 1-0 together. ?Please note that 1-0 is supported
>> via a plugin which is not ready for production use. ?You are welcome
>> to give it a try!
>>
>> To your other question, we don't recommend using 0-10 clients with
>> RabbitMQ. ?Have you tried the Rabbit Java client?
>>
>> alexis
>>
>>
>> On Thu, Dec 1, 2011 at 2:10 AM, kenshin <kenshin.acs at gmail.com> wrote:
>> > Hi:
>> > ? Is there a schedule. RabbitMQ support AMQP 1.0 ? Or,Is there a
>> > method RabbtMQ can support negotiating with AMQP 0-10 ? Because our
>> > client publish message by qpid . and default use AMQP 0-10 .
>> >
>> > ?Hope can get some direction or sugesstion
>> > ?Thanks
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From ekirpichov at gmail.com  Sat Dec  3 05:50:18 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sat, 3 Dec 2011 09:50:18 +0400
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <4E8C330C.5010906@rabbitmq.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
	<4E8C330C.5010906@rabbitmq.com>
Message-ID: <CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>

Hi Emile,

We've observed this issue again.
Unfortunately I don't have any more relevant information to help, except
the identical stacktrace.
The library version is 2.6.0.

The problem is indeed extremely rare, as this is the second time we're
observing it on a several-hundred-machine cluster in months, but the fact
that it crashes the whole program makes its impact rather perceivable.

On Wed, Oct 5, 2011 at 2:35 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Eugene,
>
> On 04/10/11 18:49, Eugene Kirpichov wrote:
> > Hi,
> >
> > SessionManager.AutoCloseConnection can crash with the following
> stacktrace:
>
> Thanks for reporting the problem. I will file a bug to investigate.
> There certainly appears to be a problem there, though I would expect it
> to be an exceedingly rare occurrence. Please let us know if you discover
> any further relevant information.
>
>
> -Emile
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111203/58a85c23/attachment.htm>

From sampo.savolainen at spatineo.com  Sat Dec  3 15:29:14 2011
From: sampo.savolainen at spatineo.com (Sampo Savolainen)
Date: Sat, 3 Dec 2011 17:29:14 +0200
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
	<4EC39721.7000201@rabbitmq.com> <4EC3ABB5.5080602@rabbitmq.com>
	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>
	<4EC3AF7F.3040905@rabbitmq.com>
	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>
	<4EC3B5D3.9040204@rabbitmq.com>
	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>
	<4EC3BDA9.30207@rabbitmq.com>
	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>
	<4EC4F469.70306@rabbitmq.com>
	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>
Message-ID: <CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>

Hi,

I found this bug report:
https://bugs.launchpad.net/ubuntu/+source/gdm/+bug/395281

The person the bug is to assigned to the bug says: "So I think the best
course of action is to fix CK to ignore system users and also fix the
couchdb/rabbitmq init scripts to not use su." (CK = ConsoleKit).

Thoughts? Does the bug contain enough information to work on a fix?


  Sampo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111203/35fb9dab/attachment.htm>

From james.r.carr at gmail.com  Sun Dec  4 13:23:17 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 4 Dec 2011 07:23:17 -0600
Subject: [rabbitmq-discuss] Weirdness viewing a "x-ha-policy: all" queue
Message-ID: <CAJreXKAZ7Z5gY3torf6yxgJxtYHtEsP-oJACPFifR9bY1tueTA@mail.gmail.com>

So last night my company had a planned outage that took down a network
segment that one broker of our cluster resided on.

The good news: message flow was uninterupted. :)

Now for something that strikes me as a curiosity. Since coming back
online a couple queues now have a red +1 next to their name rather
than the usual blue one. I've attached a screenshot for reference.

What does this mean?


Thanks,
James
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ha-management-view.png
Type: image/png
Size: 3302 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/75e12908/attachment.png>

From stammailbox at gmail.com  Sun Dec  4 13:37:59 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Sun, 4 Dec 2011 13:37:59 +0000
Subject: [rabbitmq-discuss] Rabbit management plugin when rabbit runs as a
	service
Message-ID: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>

could it be that when I transfered the rabbit to run as a service it doesnt
load the management plaugin ?
any suggestions?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/a7df8d37/attachment.htm>

From matthias at rabbitmq.com  Sun Dec  4 13:58:03 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 04 Dec 2011 13:58:03 +0000
Subject: [rabbitmq-discuss] Weirdness viewing a "x-ha-policy: all" queue
In-Reply-To: <CAJreXKAZ7Z5gY3torf6yxgJxtYHtEsP-oJACPFifR9bY1tueTA@mail.gmail.com>
References: <CAJreXKAZ7Z5gY3torf6yxgJxtYHtEsP-oJACPFifR9bY1tueTA@mail.gmail.com>
Message-ID: <4EDB7C6B.4060603@rabbitmq.com>

James,

On 04/12/11 13:23, James Carr wrote:
> Since coming back online a couple queues now have a red +1 next to
> their name rather than the usual blue one. I've attached a screenshot
> for reference.
>
> What does this mean?

Unsynchronised slaves. 
http://www.rabbitmq.com/ha.html#unsynchronised-slaves. iirc there is a 
tool tip associated with the displayed number. And it should also tell 
you on the queue details page.

Matthias.

From stammailbox at gmail.com  Sun Dec  4 14:06:23 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Sun, 4 Dec 2011 14:06:23 +0000
Subject: [rabbitmq-discuss] Trying to use a closed RPC channel
Message-ID: <CAJ2-VrnAZ=78Dnud0Nq+sagVUzMku+PSo0SP95gX2c=eD9dSVw@mail.gmail.com>

I moved my application to another network and now I sometimes get an error
"Trying to use a closed RPC channel"
How can I start check whats going wrong?
how do I know what was closed and why ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/5fc41070/attachment.htm>

From stammailbox at gmail.com  Sun Dec  4 14:22:19 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Sun, 4 Dec 2011 14:22:19 +0000
Subject: [rabbitmq-discuss] Fwd: Trying to use a closed RPC channel
In-Reply-To: <CAJ2-VrnAZ=78Dnud0Nq+sagVUzMku+PSo0SP95gX2c=eD9dSVw@mail.gmail.com>
References: <CAJ2-VrnAZ=78Dnud0Nq+sagVUzMku+PSo0SP95gX2c=eD9dSVw@mail.gmail.com>
Message-ID: <CAJ2-Vrmm0rSK+V5iFXAZk7QfE14OF8oFqatmKXTUwkwxzPw6ew@mail.gmail.com>

I want to elaborate a bit more since I have been having this issue for a
oong time:

One java client acts as an appserver. it answers rpc requests of other java
clients - through rabbitmq 2.3.1.
it has one method that runs all the time and connects to itself ever 30
seconds through the rpc .
(meaning that it calls itself through the same jsonrpc mechanism that other
remote client use)

suddenly - I get a closed rpc exception from the remote clients but the
server itself continues to call itself through its own rpc system. Am I
making sense?
So I figured that the rpc channel is closed only at the remote java apps
and not in the java server.
Now...
Any suggestion where do I go from here?
Thank you

---------- Forwarded message ----------
From: Mysurf Mail <stammailbox at gmail.com>
Date: Sun, Dec 4, 2011 at 2:06 PM
Subject: Trying to use a closed RPC channel
To: rabbitmq-discuss at lists.rabbitmq.com


I moved my application to another network and now I sometimes get an error
"Trying to use a closed RPC channel"
How can I start check whats going wrong?
how do I know what was closed and why ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/08ed6a31/attachment.htm>

From Gaurav.Shukla at hcl.com  Sun Dec  4 14:47:37 2011
From: Gaurav.Shukla at hcl.com (Gaurav Shukla)
Date: Sun, 4 Dec 2011 20:17:37 +0530
Subject: [rabbitmq-discuss] HA queue in cluster mode
Message-ID: <8706360947A56E45B1418C635D3659640229C4D9FC17@NDA-HCLT-EVS04.HCLT.CORP.HCL.IN>

I have setup a cluster. Rabbit1@ qdcls1161 and rabbit2@ qdcls1162. Also rabbit1 and 2 are in cluster. Still when I have rabbit 1 down, the cluster seems to be not working. I read about HA queues, but do not know how to configure them and put into use in cluster mode. Can someone please help? Here is the details I am getting.

-bash-3.2$ ./rabbitmqctl list_queues name slave_pids synchronised_slave_pids
Listing queues ...
...done.
-bash-3.2$ ./rabbitmqctl cluster_status
Cluster status of node rabbit1 at qdcls1161 ...
[{nodes,[{disc,[rabbit2 at qdcls1162,rabbit1 at qdcls1161]}]},
 {running_nodes,[rabbit2 at qdcls1162,rabbit1 at qdcls1161]}]
...done.
-bash-3.2$

Gaurav Shukla
Senior Technical Architect -ADCOE
HCL Technologies Ltd.
Plot 1 & 2, Maple Towers, Sector 125, Noida (India)
Mob: +91-9899 89 9189
www.hcltech.com
www.hcl.com<http://www.hcl.com>
[cid:image003.jpg at 01CCB2C1.56CA1BE0]


________________________________
::DISCLAIMER::
-----------------------------------------------------------------------------------------------------------------------

The contents of this e-mail and any attachment(s) are confidential and intended for the named recipient(s) only.
It shall not attach any liability on the originator or HCL or its affiliates. Any views or opinions presented in
this email are solely those of the author and may not necessarily reflect the opinions of HCL or its affiliates.
Any form of reproduction, dissemination, copying, disclosure, modification, distribution and / or publication of
this message without the prior written consent of the author of this e-mail is strictly prohibited. If you have
received this email in error please delete it and notify the sender immediately. Before opening any mail and
attachments please check them for viruses and defect.

-----------------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/3e4e91af/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 3061 bytes
Desc: image003.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/3e4e91af/attachment.jpg>

From michael.s.klishin at gmail.com  Sun Dec  4 16:33:21 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 4 Dec 2011 20:33:21 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.8.4 is released,
	0.9 development starts
Message-ID: <E4225C0D-0D96-4D8B-9E96-0516F72A9F4E@gmail.com>

amqp gem 0.8.4 is released [1]. This is a bug fix release that solves a couple of framing/concurrency issues [2].
All users are encouraged to upgrade.

In addition, this is likely to be the last 0.8.x release. All the ongoing work will happen in master and will result in 0.9.0 release in a couple of months. master right now is identical to the 0.8.x-stable branch and 0.9.0 will be completely backwards compatible but I want to introduce a number of small features that don't fit 0.8.x point releases.

Have a good day.


1. https://rubygems.org/gems/amqp/versions/0.8.4
2. After 2+ weeks of production testing with systems that process hundreds and thousands of messages per second with
multiple channels.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From alex.gronholm at nextday.fi  Mon Dec  5 02:45:20 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sun, 4 Dec 2011 18:45:20 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <CAM8fPiQySXBBbBbjuKjzYLcd_KjoKaF8QoRb7MFdt9E=0VwXyw@mail.gmail.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<4687248.540.1322835701216.JavaMail.geo-discussion-forums@yqgc13>
	<CAM8fPiQySXBBbBbjuKjzYLcd_KjoKaF8QoRb7MFdt9E=0VwXyw@mail.gmail.com>
Message-ID: <23223290.1173.1323053120545.JavaMail.geo-discussion-forums@yqf20>



> if rabbitmq is up, but the RPC server is down, and the queue was 
> previously created by somebody, then the request will be enqueued. As long 
> as the RPC server returns to service in a timely way, everyone's happy.


And if it doesn't? How can I get the request cancelled then? I'm not sure I 
should rely on client generated timestamps. Their clocks could be wrong.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/5de6f0c4/attachment.htm>

From alex.gronholm at nextday.fi  Mon Dec  5 02:48:48 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sun, 4 Dec 2011 18:48:48 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>
Message-ID: <5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>

Dear Steve,

I know how to create queues properly. That was never the issue. The issue 
was that if I created a leased queue, take the consumer offline and leave 
it that way and the queue expires, the client is never notified that the 
message was dropped and it will continue to wait for a response forever. 
That is not how I want it to work. I expect the server to send some return 
message when the queue dies. The mandatory flag does not help since it only 
returns the message if it's not routed to a queue (which it is). But like I 
said before, the dead lettering feature should help with this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111204/6e27b9eb/attachment.htm>

From andrea.rosa at hp.com  Mon Dec  5 09:57:33 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 5 Dec 2011 09:57:33 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
Message-ID: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>

Hi

Here my scenario:
In a pub/consumer situation a consumer creates a queue and binds this queue to a direct exchange with auto-delete flag set to True.
Then start listening to that queue for messages, we have got a timeout and when the timeout expires the consumer stop listening to and delete itself, as results the exchange is correctly deleted.
The publisher before publish a message try to create the exchange.

In this process can happen that the publisher try to publish a message on the exchange after it has been deleted by the consumer, as result I have got some direct exchange on Rabbitmq without a bind, and those exchanges will remain alive forever, I will refer to them as zombie
My questions are:

-          Can you confirm that the publisher after publishing the message close the connection with Rabbitmq?

-          What are risks to have a lot of those zombie exchanges ?

-          There is a way to close zombie exchanges?

To solve the problem I am thinking to publish messages with mandatory flag set and to manage the Basic.return to close the exchange, is it a correct design?

Thanks
--
Andrea Rosa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/7cc21a19/attachment.htm>

From stammailbox at gmail.com  Mon Dec  5 10:13:01 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Mon, 5 Dec 2011 10:13:01 +0000
Subject: [rabbitmq-discuss] using client from different threads
Message-ID: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>

1. Is it ok to use the same channel from different threads?
2. Is it ok to use RPC client from different threads
[I am trying to narrow down on the cause of my problems (usage of close rpc
queue). ]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/e1a46cec/attachment.htm>

From simon at rabbitmq.com  Mon Dec  5 10:43:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 10:43:35 +0000
Subject: [rabbitmq-discuss] Rabbit management plugin when rabbit runs as
 a	service
In-Reply-To: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>
References: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>
Message-ID: <4EDCA057.90407@rabbitmq.com>

On 04/12/11 13:37, Mysurf Mail wrote:
> could it be that when I transfered the rabbit to run as a service it
> doesnt load the management plaugin ?
> any suggestions?

Did you install the service first and then activate the plugin? You need 
to reinstall and restart the service whenever you enable or disable plugins.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Dec  5 10:49:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 10:49:09 +0000
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>	<4EC39721.7000201@rabbitmq.com>	<4EC3ABB5.5080602@rabbitmq.com>	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>	<4EC3AF7F.3040905@rabbitmq.com>	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>	<4EC3B5D3.9040204@rabbitmq.com>	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>	<4EC3BDA9.30207@rabbitmq.com>	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>	<4EC4F469.70306@rabbitmq.com>	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>
	<CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>
Message-ID: <4EDCA1A5.8070102@rabbitmq.com>

On 03/12/11 15:29, Sampo Savolainen wrote:
> The person the bug is to assigned to the bug says: "So I think the best
> course of action is to fix CK to ignore system users

Fine.

> and also fix the couchdb/rabbitmq init scripts to not use su." (CK = ConsoleKit).

Hmm. We use su to run rabbitmq-server as the "rabbitmq" user. Erlang 
doesn't have the ability to setuid, so I'm not sure what the alternative 
is here. I will ask on the lp bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Dec  5 11:18:17 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 11:18:17 +0000
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <4EDCA1A5.8070102@rabbitmq.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>	<4EC39721.7000201@rabbitmq.com>	<4EC3ABB5.5080602@rabbitmq.com>	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>	<4EC3AF7F.3040905@rabbitmq.com>	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>	<4EC3B5D3.9040204@rabbitmq.com>	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>	<4EC3BDA9.30207@rabbitmq.com>	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>	<4EC4F469.70306@rabbitmq.com>	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>	<CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>
	<4EDCA1A5.8070102@rabbitmq.com>
Message-ID: <4EDCA879.4020502@rabbitmq.com>

On 05/12/11 10:49, Simon MacMullen wrote:
> Hmm. We use su to run rabbitmq-server as the "rabbitmq" user. Erlang
> doesn't have the ability to setuid, so I'm not sure what the alternative
> is here. I will ask on the lp bug.

I can't read. The suggested alternative is start-stop-daemon. I've filed 
a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Dec  5 11:26:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 11:26:48 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
Message-ID: <4EDCAA78.3050706@rabbitmq.com>

On 05/12/11 09:57, Rosa, Andrea wrote:
> My questions are:
>
> -Can you confirm that the publisher after publishing the message close
> the connection with Rabbitmq?

Well, that's up to the publisher. I would assume you would close the 
connection.

> -What are risks to have a lot of those zombie exchanges ?

Well, they make your Mnesia database larger than it needs to be, and 
make the output of rabbitmqctl and mgmt unwieldy.

> -There is a way to close zombie exchanges?

You could iterate through them in mgmt.

> To solve the problem I am thinking to publish messages with mandatory
> flag set and to manage the Basic.return to close the exchange, is it a
> correct design?

Umm, you could I suppose. I would take a step back though - why are you 
creating short-lived direct exchanges all the time? What are you trying 
to do that you couldn't do with a single exchange, or with the default 
exchange?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Mon Dec  5 12:04:15 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 5 Dec 2011 12:04:15 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <4EDCAA78.3050706@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
	<4EDCAA78.3050706@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>

Hi Simon


> Well, they make your Mnesia database larger than it needs to be, and
> make the output of rabbitmqctl and mgmt unwieldy.
> 
Ok, thanks

> > -There is a way to close zombie exchanges?
> 
> You could iterate through them in mgmt.

Ok
 
> > To solve the problem I am thinking to publish messages with mandatory
> > flag set and to manage the Basic.return to close the exchange, is it
> a
> > correct design?
> 
> Umm, you could I suppose. I would take a step back though - why are you
> creating short-lived direct exchanges all the time? What are you trying
> to do that you couldn't do with a single exchange, or with the default
> exchange?
Good question, I am implementing a RPC call so the server A ask for a remote call to server B, the server A declare the queue (temp_queueA) bind it to the direct exchange and wait for reply from server B.
Server A send the request, server B gets and execute the request and sends back results using the exchange bound to the temp_queueA queue.

Cheers
--
Andrea

From simon at rabbitmq.com  Mon Dec  5 12:20:04 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 12:20:04 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
	<4EDCAA78.3050706@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>
Message-ID: <4EDCB6F4.9010202@rabbitmq.com>

On 05/12/11 12:04, Rosa, Andrea wrote:
> Good question, I am implementing a RPC call so the server A ask for a
> remote call to server B, the server A declare the queue (temp_queueA)
> bind it to the direct exchange and wait for reply from server B.
> Server A send the request, server B gets and execute the request and
> sends back results using the exchange bound to the temp_queueA
> queue.

So why not have server A declare temp_queueA, have it send that queue's 
name in the reply-to header, then have server B publish the message to 
temp_queueA via the default exchange? That's the usual pattern, it's 
quite a bit simpler, and I don't see what lots of extra exchanges is 
buying you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon Dec  5 12:21:47 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Dec 2011 12:21:47 +0000
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
Message-ID: <A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>

Hi,
Since Rabbitmq 2.7.0 it has been  possible to use a channel from multiple
threads in the Java client, however doing so may block one or other of the
threads if you are using a synchronous command.

Since consumers now run their 'callbacks' on threads separate from the channel
and connection threads, it is now possible to call the channel from within
these callbacks, without deadlocking.  Again, you should understand the
threading implications.

'Using the RpcClient from different threads' is probably a little more tricky.
However, publishes use the channel interface so ought to be OK, although all
RpcClient 'calls' will be serialised, of course.

We are currently looking to enhance the RpcClient/Server code, to make them
more flexible (being able to call several servers from one client, for example)
and re-usable (reducing the interface and making it more basic), building it on
the standard interface, rather than using the implementation classes (as it
does now).  We are, of course, interested in any problems you detect with the
current RpcClient/Server implementations.

Steve Powell  (a christmas bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 5 Dec 2011, at 10:13, Mysurf Mail wrote:

> 1. Is it ok to use the same channel from different threads?
> 2. Is it ok to use RPC client from different threads
> [I am trying to narrow down on the cause of my problems (usage of close rpc queue). ]
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From awilliam at whitemice.org  Mon Dec  5 12:43:56 2011
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Mon, 05 Dec 2011 07:43:56 -0500
Subject: [rabbitmq-discuss] Rabbit management plugin when rabbit runs as
 a service
In-Reply-To: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>
References: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>
Message-ID: <1323089036.2833.33.camel@workstation.wmmi.net>

On Sun, 2011-12-04 at 13:37 +0000, Mysurf Mail wrote:
> could it be that when I transfered the rabbit to run as a service it
> doesnt load the management plaugin ? 

Did you upgrade from 2.6 to 2.7?  I got caught by the need to enable the
plugin in 2.7, where as it ran by default in 2.6.

rabbitmq-plugins enable rabbitmq_management

then restart the Rabbit instance.

<http://www.whitemiceconsulting.com/2011/12/enabling-rabbitmq-management-plugin.html>


From simon at rabbitmq.com  Mon Dec  5 12:46:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 12:46:08 +0000
Subject: [rabbitmq-discuss] Rabbit management plugin when rabbit runs as
 a service
In-Reply-To: <1323089036.2833.33.camel@workstation.wmmi.net>
References: <CAJ2-Vr=xq1_ac921iZ+Y3=XnUGYvEkNKiSnuqb2=dkB=zBYe+Q@mail.gmail.com>
	<1323089036.2833.33.camel@workstation.wmmi.net>
Message-ID: <4EDCBD10.102@rabbitmq.com>

On 05/12/11 12:43, Adam Tauno Williams wrote:
> Did you upgrade from 2.6 to 2.7?  I got caught by the need to enable the
> plugin in 2.7, where as it ran by default in 2.6.

Only if you installed it though! I promise you we did not ship the mgmt 
plugin bundled with 2.6.x...

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From john.doe44210 at gmail.com  Mon Dec  5 13:45:34 2011
From: john.doe44210 at gmail.com (john doe)
Date: Mon, 5 Dec 2011 14:45:34 +0100
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
Message-ID: <CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>

Hello,

@ Mysurf: I asked almost the same questions about two weeks ago ("questions
about RpcClient")

@ Steve: Nice to see that you are working on improving these classes. I
actually had three major issues with RpcClient:
- the lack of interface which made mocking quite difficult for unit testing
(I had to inherit from the class)
- the fact that the routing key is a final attribute of the class (which
makes me create multiple clients when using several routing keys)
- the lack of a "single request / multiple replies" scenario (with a
expected number of replies and a timeout)

John


2011/12/5 Steve Powell <steve at rabbitmq.com>

> Hi,
> Since Rabbitmq 2.7.0 it has been  possible to use a channel from multiple
> threads in the Java client, however doing so may block one or other of the
> threads if you are using a synchronous command.
>
> Since consumers now run their 'callbacks' on threads separate from the
> channel
> and connection threads, it is now possible to call the channel from within
> these callbacks, without deadlocking.  Again, you should understand the
> threading implications.
>
> 'Using the RpcClient from different threads' is probably a little more
> tricky.
> However, publishes use the channel interface so ought to be OK, although
> all
> RpcClient 'calls' will be serialised, of course.
>
> We are currently looking to enhance the RpcClient/Server code, to make them
> more flexible (being able to call several servers from one client, for
> example)
> and re-usable (reducing the interface and making it more basic), building
> it on
> the standard interface, rather than using the implementation classes (as it
> does now).  We are, of course, interested in any problems you detect with
> the
> current RpcClient/Server implementations.
>
> Steve Powell  (a christmas bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 5 Dec 2011, at 10:13, Mysurf Mail wrote:
>
> > 1. Is it ok to use the same channel from different threads?
> > 2. Is it ok to use RPC client from different threads
> > [I am trying to narrow down on the cause of my problems (usage of close
> rpc queue). ]
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/5272c6f2/attachment.htm>

From andrea.rosa at hp.com  Mon Dec  5 13:45:25 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 5 Dec 2011 13:45:25 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <4EDCB6F4.9010202@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
	<4EDCAA78.3050706@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>
	<4EDCB6F4.9010202@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD17D8EBDD@G9W0721.americas.hpqcorp.net>

Hi Simon,

> So why not have server A declare temp_queueA, have it send that queue's
> name in the reply-to header, then have server B publish the message to
> temp_queueA via the default exchange? That's the usual pattern, it's
> quite a bit simpler, and I don't see what lots of extra exchanges is
> buying you.

Unfortunately I didn't participate to the original design of the system so I don't know which is the underlying idea.
We can have a lot of temporary queues (like temp_queueA) and a lot of messages at the same time to have a single exchange (the default one) to deliver those messages could not be a bottleneck ?
So maybe the original idea was to design the RPC using separate exchanges for having more scalability?
I don't know it's just speculation.

Cheers
--
Andrea

From simon at rabbitmq.com  Mon Dec  5 13:48:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Dec 2011 13:48:30 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD17D8EBDD@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
	<4EDCAA78.3050706@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>
	<4EDCB6F4.9010202@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EBDD@G9W0721.americas.hpqcorp.net>
Message-ID: <4EDCCBAE.30201@rabbitmq.com>

On 05/12/11 13:45, Rosa, Andrea wrote:
> Unfortunately I didn't participate to the original design of the
> system so I don't know which is the underlying idea. We can have a
> lot of temporary queues (like temp_queueA) and a lot of messages at
> the same time to have a single exchange (the default one) to deliver
> those messages could not be a bottleneck ? So maybe the original idea
> was to design the RPC using separate exchanges for having more
> scalability? I don't know it's just speculation.

It's possible that's what somebody thought :) But the built-in exchange 
types at least are just routing logic which is executed in the channel, 
there's no process there to be a bottleneck.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Mon Dec  5 13:55:57 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 5 Dec 2011 13:55:57 +0000
Subject: [rabbitmq-discuss] Zombie direct exchanges
In-Reply-To: <4EDCCBAE.30201@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD17D8E9E3@G9W0721.americas.hpqcorp.net>
	<4EDCAA78.3050706@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EB42@G9W0721.americas.hpqcorp.net>
	<4EDCB6F4.9010202@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD17D8EBDD@G9W0721.americas.hpqcorp.net>
	<4EDCCBAE.30201@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD17D8EBFB@G9W0721.americas.hpqcorp.net>

Thanks Simon,

I found this topic really useful for me!
--
Andrea Rosa

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 05 December 2011 13:49
> To: Rosa, Andrea
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Zombie direct exchanges
> 
> On 05/12/11 13:45, Rosa, Andrea wrote:
> > Unfortunately I didn't participate to the original design of the
> > system so I don't know which is the underlying idea. We can have a
> > lot of temporary queues (like temp_queueA) and a lot of messages at
> > the same time to have a single exchange (the default one) to deliver
> > those messages could not be a bottleneck ? So maybe the original idea
> > was to design the RPC using separate exchanges for having more
> > scalability? I don't know it's just speculation.
> 
> It's possible that's what somebody thought :) But the built-in exchange
> types at least are just routing logic which is executed in the channel,
> there's no process there to be a bottleneck.
> 
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware

From emile at rabbitmq.com  Mon Dec  5 13:58:53 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 05 Dec 2011 13:58:53 +0000
Subject: [rabbitmq-discuss] 2 WCF services on the same queue
In-Reply-To: <8062A75E-1A1D-4A8F-AC49-8AAE388E40DE@gmail.com>
References: <CACbvtX-Gjv7nKp7umvc0CN0190WwDShqBtbcw925fEQ9wnNzsA@mail.gmail.com>
	<4ED76161.1030205@rabbitmq.com>
	<8062A75E-1A1D-4A8F-AC49-8AAE388E40DE@gmail.com>
Message-ID: <4EDCCE1D.5020104@rabbitmq.com>

Hi Shaun,

Yes, that is my suggestion. I realise that this is not very natural, but
I don't see any other way when using WCF.


On 01/12/11 13:31, Shaun Xu wrote:
> Thanks Emile. If I do want to use WCF then I need to create endpoints
> for each service instances and then let the client, or something like
> routing component to call one of them. Is that correct?
> 
> Shaun
> 
> Sent from my iPad
> 
> ? 2011-12-1?19:13?Emile Joubert <emile at rabbitmq.com> ???
> 
>> On 01/12/11 06:09, Shaun Ziyan Xu wrote:
>>> I would like to scaling out my application service and decided to
>>> use a distributed queue to receive the client request, and
>>> multiple services listening on the same queue. I think this is
>>> very common pooling-based pattern. I'm trying to use RebbitMQ
>>> with WCF binding, and when I use one client and one service to
>>> works well. But when I created 2 services I found when the client
>>> invoked, it gave me an exception said the CommunicationObject
>>> State was Fault.
>> 
>> 
>> Unfortunately each Service creates a new AMQP binding and a new
>> queue for requests. Therefore each Service will receive all
>> requests, leading to the errors you see.
>> 
>> If you want to use WCF then you could create separate endpoints for
>> each worker and to round-robin at the request stage.
>> 
>> If you do not need to use WCF then use the RabbitMQ .net client
>> directly and follow the Work Queues and RPC tutorials: 
>> http://www.rabbitmq.com/getstarted.html
>> 
>> You will find C# implementations here: 
>> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet


From emile at rabbitmq.com  Mon Dec  5 14:02:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 05 Dec 2011 14:02:28 +0000
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
	<4E8C330C.5010906@rabbitmq.com>
	<CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>
Message-ID: <4EDCCEF4.3070900@rabbitmq.com>


Hi Eugene,

Thanks for the report. We have found and fixed what we believe to be the
cause of this problem. It will be included in the next release.



On 03/12/11 05:50, Eugene Kirpichov wrote:
> Hi Emile,
> 
> We've observed this issue again.
> Unfortunately I don't have any more relevant information to help, except
> the identical stacktrace.
> The library version is 2.6.0.
> 
> The problem is indeed extremely rare, as this is the second time we're
> observing it on a several-hundred-machine cluster in months, but the
> fact that it crashes the whole program makes its impact rather perceivable.
> 
> On Wed, Oct 5, 2011 at 2:35 PM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
> 
>     Hi Eugene,
> 
>     On 04/10/11 18:49, Eugene Kirpichov wrote:
>     > Hi,
>     >
>     > SessionManager.AutoCloseConnection can crash with the following
>     stacktrace:
> 
>     Thanks for reporting the problem. I will file a bug to investigate.
>     There certainly appears to be a problem there, though I would expect it
>     to be an exceedingly rare occurrence. Please let us know if you discover
>     any further relevant information.


From steve at rabbitmq.com  Mon Dec  5 14:53:24 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Dec 2011 14:53:24 +0000
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
	<CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
Message-ID: <2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>

Dear John,

Our work was, in part, prompted by your questions.  Thank you.

I think we will be able to manage two of your three issues.  The 'multiple
replies' scheme is tricky, and we do not intend to try this straight away.
There are many problems with it which could result in an ugly interface.
Is there any reason why a large reply would not be adequate?

Steve 'bun' Powell
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate a look-alike band.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 5 Dec 2011, at 13:45, john doe wrote:

> Hello,
>  
> @ Mysurf: I asked almost the same questions about two weeks ago ("questions about RpcClient")
>  
> @ Steve: Nice to see that you are working on improving these classes. I actually had three major issues with RpcClient:
> - the lack of interface which made mocking quite difficult for unit testing (I had to inherit from the class)
> - the fact that the routing key is a final attribute of the class (which makes me create multiple clients when using several routing keys)
> - the lack of a "single request / multiple replies" scenario (with a expected number of replies and a timeout)
>  
> John


From tonygarnockjones+rabbitmq at gmail.com  Mon Dec  5 15:43:48 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 5 Dec 2011 10:43:48 -0500
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <23223290.1173.1323053120545.JavaMail.geo-discussion-forums@yqf20>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>
	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>
	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<4687248.540.1322835701216.JavaMail.geo-discussion-forums@yqgc13>
	<CAM8fPiQySXBBbBbjuKjzYLcd_KjoKaF8QoRb7MFdt9E=0VwXyw@mail.gmail.com>
	<23223290.1173.1323053120545.JavaMail.geo-discussion-forums@yqf20>
Message-ID: <CAM8fPiSd0XzQTUGxh-GMSWbamoZ+5zQEVGwmjBvH7Vq+Hfp+Mg@mail.gmail.com>

On 4 December 2011 21:45, Alex Gr?nholm <alex.gronholm at nextday.fi> wrote:

> And if it doesn't? How can I get the request cancelled then? I'm not sure
> I should rely on client generated timestamps. Their clocks could be wrong.
>

You could try per-queue message TTLs:
http://www.rabbitmq.com/extensions.html#queue-ttl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/e8246d81/attachment.htm>

From steve at rabbitmq.com  Mon Dec  5 15:56:53 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Dec 2011 15:56:53 +0000
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>
	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>
Message-ID: <A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>

Sorry Alex, I'm sure you do. I'm learning and trying to understand your
situation.

Although it is reasonable to create a "leased" queue (with an 'x-expires'
argument) for replies to Rpc requests (on the grounds that the clients cannot
be replied upon to drain them), I do not think it reasonable to do this for the
server queues unless you can tolerate requests being (quietly) lost.

If you don't want the server queue requests to be 'lost' then don't allow the
queues to expire!

On the other hand your clients apparently wait forever.  Is there a reason I
don't understand why the server queues expire but the clients don't have a
timeout for the responses?

Well, I think I can answer my own question -- please confirm if this is right:

You want requests to either be processed or (reliably) not processed.  You
never want the clients to be in any doubt about whether the request was
processed or not.  So you wait forever in the client.  However, requests that
get discarded never return so the client doesn't know.  So you want expiry to
trigger replies to the clients.  (Per-queue message TTLs also don't return.)

If the server dies there is still the possibility that it did so after pulling
the request from the queue and before posting a reply -- unless the requests are
'transactionally' processed. So it looks like you need the request processing to
be a transaction so that all requests not in the queue (when it expires) have
definitely been processed.

Let's see -- how would we do this without a dead-letter mechanism?  Well, apart
from making the server transactional, it might be useful to have an 'offline'
server that can take over any server's queue when it fails and either deal with
the requests [by issuing an 'offline' response?] or arrange for the server to
be restarted (and/or upgraded).

In one of your original posts: 

> "I want to keep my "rpc" queue alive even when the RPC server software is
> being upgraded so that users will only see a delay in the responses (and no
> lost requests)"

it looks like you could actually schedule a takeover of the 'offline' server
from the RpcServer, and have complete control of the policy for handling
requests in 'dead' server queues.

A dead-letter mechanism would be convenient in this case, because you would not
then have to 'take-over' any queues and the 'offline' server could be run
permanently, without a need to monitor the servers for failure.

Have I understood now?

Steve Powell  (a learning bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 5 Dec 2011, at 02:48, Alex Gr?nholm wrote:

> Dear Steve,
> 
> I know how to create queues properly. That was never the issue. The issue was that if I created a leased queue, take the consumer offline and leave it that way and the queue expires, the client is never notified that the message was dropped and it will continue to wait for a response forever. That is not how I want it to work. I expect the server to send some return message when the queue dies. The mandatory flag does not help since it only returns the message if it's not routed to a queue (which it is). But like I said before, the dead lettering feature should help with this.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon Dec  5 16:32:56 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Dec 2011 16:32:56 +0000
Subject: [rabbitmq-discuss] Fwd: Trying to use a closed RPC channel
In-Reply-To: <CAJ2-Vrmm0rSK+V5iFXAZk7QfE14OF8oFqatmKXTUwkwxzPw6ew@mail.gmail.com>
References: <CAJ2-VrnAZ=78Dnud0Nq+sagVUzMku+PSo0SP95gX2c=eD9dSVw@mail.gmail.com>
	<CAJ2-Vrmm0rSK+V5iFXAZk7QfE14OF8oFqatmKXTUwkwxzPw6ew@mail.gmail.com>
Message-ID: <CE71010A-2EBE-4071-A460-D9CCAE1077AB@rabbitmq.com>

Dear Mysurf,

First of all, rabbitmq 2.3.1 is a bit old now, and any problems you might have
may already be fixed in later releases.  Have you tried rabbitmq 2.7.0?

Secondly, thank you for elaborating but I'm afraid there are too many details
missing for us to be able to determine what might be wrong.

I cannot find any error message in our Java code (at 2.3.1 level or 2.7.0 level)
which looks like: "Trying to use a closed RPC channel". I do see an
EOFException("RpcClient is closed.") -- is that what you mean?
I also see AlreadyClosedException("Attempt to use closed channel") -- maybe
this is the one you see.  Notice that there is no reference to an RPC Channel
-- that's because there isn't one: RPC servers and clients use channels to
talk to the rabbit server, but they are not special nor dedicated channels.

Incidentally, that means that other parts of the program can close them.

If you are getting an exception, at the very least we would like to see the
full stack-trace that came with it, or else it is, I'm afraid, nearly
impossible to help you.

Steve Powell  (a bemused bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 4 Dec 2011, at 14:22, Mysurf Mail wrote:

> I want to elaborate a bit more since I have been having this issue for a 
> oong time:
> 
> One java client acts as an appserver. it answers rpc requests of other java
> clients - through rabbitmq 2.3.1.
> it has one method that runs all the time and connects to itself ever 30
> seconds through the rpc . (meaning that it calls itself through the same
> jsonrpc mechanism that other remote client use)
> 
> suddenly - I get a closed rpc exception from the remote clients but the
> server itself continues to call itself through its own rpc system. Am I
> making sense? So I figured that the rpc channel is closed only at the remote
> java apps and not in the java server. 
> Now...
> Any suggestion where do I go from here? 
> Thank you 
> ---------- Forwarded message ----------
> From: Mysurf Mail <stammailbox at gmail.com>
> Date: Sun, Dec 4, 2011 at 2:06 PM
> Subject: Trying to use a closed RPC channel
> To: rabbitmq-discuss at lists.rabbitmq.com
> 
> I moved my application to another network and now I
> sometimes get an error "Trying to use a closed RPC channel"  
> How can I start check whats going wrong? 
> how do I know what was closed and why ? 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From john.doe44210 at gmail.com  Mon Dec  5 16:38:10 2011
From: john.doe44210 at gmail.com (john doe)
Date: Mon, 5 Dec 2011 17:38:10 +0100
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
	<CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
	<2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>
Message-ID: <CALbPev=mJw7Q6JxLZus6kR5in5UiHvh24D=PqKBggxfud+F4Og@mail.gmail.com>

Dear Steve,

Actually I am dealing with a distributed database (kind of), and I am doing
things like sending the same request to different shards, every shard
processes it and replies to the sender, which will merge results. It is
pretty much like a map reduce job.

I found out that routing offers nice ways for handling this kind of
request/response schemes (for example, I can send one request to one
instance of each shard of my computing grid with only one publish).

So I think you misunderstood my point, it is nothing like concatenating
multiple response messaging, but like a more generic rpc.

John


2011/12/5 Steve Powell <steve at rabbitmq.com>

> Dear John,
>
> Our work was, in part, prompted by your questions.  Thank you.
>
> I think we will be able to manage two of your three issues.  The 'multiple
> replies' scheme is tricky, and we do not intend to try this straight away.
> There are many problems with it which could result in an ugly interface.
> Is there any reason why a large reply would not be adequate?
>
> Steve 'bun' Powell
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate a look-alike band.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
>  On 5 Dec 2011, at 13:45, john doe wrote:
>
> > Hello,
> >
> > @ Mysurf: I asked almost the same questions about two weeks ago
> ("questions about RpcClient")
> >
> > @ Steve: Nice to see that you are working on improving these classes. I
> actually had three major issues with RpcClient:
> > - the lack of interface which made mocking quite difficult for unit
> testing (I had to inherit from the class)
> > - the fact that the routing key is a final attribute of the class (which
> makes me create multiple clients when using several routing keys)
> > - the lack of a "single request / multiple replies" scenario (with a
> expected number of replies and a timeout)
> >
> > John
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/549b370f/attachment.htm>

From steve at rabbitmq.com  Mon Dec  5 17:35:58 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 5 Dec 2011 17:35:58 +0000
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <CALbPev=mJw7Q6JxLZus6kR5in5UiHvh24D=PqKBggxfud+F4Og@mail.gmail.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
	<CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
	<2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>
	<CALbPev=mJw7Q6JxLZus6kR5in5UiHvh24D=PqKBggxfud+F4Og@mail.gmail.com>
Message-ID: <0C6DF4F4-01ED-43BF-87F5-347F8A8F5143@rabbitmq.com>

John,
Thanks for that -- I didn't understand your requirement properly.

I would tackle this by having an intermediate rpcServer which farms out the
requests (acting as a client) (to your shards) -- each of which is a single rpc
-- and accumulates the responses for the ultimate response to the original
request.  The original requestor makes a single request and gets back a single
response.

I now see where the added flexibility requirement in the RpcClient came from.

Of course, with routing doing the 'managing the shards' bit we have a lot of
messages arriving back in the same reply-to queue, so someone has to do the
accumulations, I can see that.  However, it wouldn't be hard to rewrite the
rpcClient for this particular case, provided you can decide how to accumulate in
the face of arbitrary numbers of responses.  The consumer would need to be more
intelligent, but what criteria you use for deciding you've had enough replies
and how to 'package' them up as a single response to the original request is
very application-specific, I think.

I don't see a way around you having to code the accumulation explicitly, unless
you know of a generally accepted multi-response scheme we should adopt?

Steve Powell  (a dazed bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 5 Dec 2011, at 16:38, john doe wrote:
> 
> Dear Steve,
>  
> Actually I am dealing with a distributed database (kind of), and I am doing
> things like sending the same request to different shards, every shard
> processes it and replies to the sender, which will merge results. It is
> pretty much like a map reduce job.
>  
> I found out that routing offers nice ways for handling this kind of
> request/response schemes (for example, I can send one request to one
> instance of each shard of my computing grid with only one publish).
>  
> So I think you misunderstood my point, it is nothing like concatenating
> multiple response messaging, but like a more generic rpc.
>  
> John

From john.doe44210 at gmail.com  Mon Dec  5 18:15:47 2011
From: john.doe44210 at gmail.com (john doe)
Date: Mon, 5 Dec 2011 19:15:47 +0100
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <0C6DF4F4-01ED-43BF-87F5-347F8A8F5143@rabbitmq.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
	<CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
	<2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>
	<CALbPev=mJw7Q6JxLZus6kR5in5UiHvh24D=PqKBggxfud+F4Og@mail.gmail.com>
	<0C6DF4F4-01ED-43BF-87F5-347F8A8F5143@rabbitmq.com>
Message-ID: <CALbPevkPK=CSoAkMgQvqtGF55JdymUWSC6K4WErTagL-=q7Ksg@mail.gmail.com>

>
> The consumer would need to be more
> intelligent, but what criteria you use for deciding you've had enough
> replies
> and how to 'package' them up as a single response to the original request
> is
> very application-specific, I think.
>
In my implementation, this criteria is simply an "expected number of
responses". Here is the prototype of the function I am using (note that a
list of byte arrays is provided, all of them sent to the same
exchange/routing key, so that I can send several tasks to each shard at
once).

Typically, you'll have numberOfExpectedResponse=bodies.size() *
numberOfShards;
*

public* List<*byte*[]> rpcCall(*final* String messageId, *final* String
exchange, final String routingKey, *final* List<byte[]> bodies, *final* *int
* numberOfExpectedResponse, *final* *int* timeout)
This looks a little weird, but it allows me not to manage future and
completion services in the sender.

John

2011/12/5 Steve Powell <steve at rabbitmq.com>

> John,
> Thanks for that -- I didn't understand your requirement properly.
>
> I would tackle this by having an intermediate rpcServer which farms out the
> requests (acting as a client) (to your shards) -- each of which is a
> single rpc
> -- and accumulates the responses for the ultimate response to the original
> request.  The original requestor makes a single request and gets back a
> single
> response.
>
> I now see where the added flexibility requirement in the RpcClient came
> from.
>
> Of course, with routing doing the 'managing the shards' bit we have a lot
> of
> messages arriving back in the same reply-to queue, so someone has to do the
> accumulations, I can see that.  However, it wouldn't be hard to rewrite the
> rpcClient for this particular case, provided you can decide how to
> accumulate in
> the face of arbitrary numbers of responses.  The consumer would need to be
> more
> intelligent, but what criteria you use for deciding you've had enough
> replies
> and how to 'package' them up as a single response to the original request
> is
> very application-specific, I think.
>
> I don't see a way around you having to code the accumulation explicitly,
> unless
> you know of a generally accepted multi-response scheme we should adopt?
>
> Steve Powell  (a dazed bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
>  On 5 Dec 2011, at 16:38, john doe wrote:
> >
> > Dear Steve,
> >
> > Actually I am dealing with a distributed database (kind of), and I am
> doing
> > things like sending the same request to different shards, every shard
> > processes it and replies to the sender, which will merge results. It is
> > pretty much like a map reduce job.
> >
> > I found out that routing offers nice ways for handling this kind of
> > request/response schemes (for example, I can send one request to one
> > instance of each shard of my computing grid with only one publish).
> >
> > So I think you misunderstood my point, it is nothing like concatenating
> > multiple response messaging, but like a more generic rpc.
> >
> > John
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/5f6bf8f7/attachment.htm>

From pdezwart at rubiconproject.com  Mon Dec  5 18:29:56 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 5 Dec 2011 12:29:56 -0600
Subject: [rabbitmq-discuss] Consume stuck at prefectch count limit
Message-ID: <CB024DA4.2BA58%pdezwart@rubiconproject.com>

Hey everyone,

I am having some trouble with the basic.consume method and prefetch. It would seem that when I set a prefect count to X, the consume method will successfully pull in X messages, and then get stuck on the next amqp_simple_wait_frame. I have attached a hacked version of the amqp_consumer example that displays the behavior. I did hack in a local queue name that had enough messages?

Hopefully I am just doing something nonsensical.

Thanks!
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/649ce2c6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_consumer.c
Type: application/octet-stream
Size: 5525 bytes
Desc: amqp_consumer.c
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/649ce2c6/attachment.obj>

From simone.busoli at gmail.com  Mon Dec  5 20:26:12 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 5 Dec 2011 21:26:12 +0100
Subject: [rabbitmq-discuss] Consume stuck at prefectch count limit
In-Reply-To: <CB024DA4.2BA58%pdezwart@rubiconproject.com>
References: <CB024DA4.2BA58%pdezwart@rubiconproject.com>
Message-ID: <CAOn7oW9dZiqb+-kEKz50zE-TebPKCYkckRaDcJurHJBw7ZejLg@mail.gmail.com>

Briefly looking at the code you don't seem to be acking messages.
On Dec 5, 2011 7:31 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com>
wrote:

> Hey everyone,
>
> I am having some trouble with the basic.consume method and prefetch. It
> would seem that when I set a prefect count to X, the consume method will
> successfully pull in X messages, and then get stuck on the next
> amqp_simple_wait_frame. I have attached a hacked version of the
> amqp_consumer example that displays the behavior. I did hack in a local
> queue name that had enough messages?
>
> Hopefully I am just doing something nonsensical.
>
> Thanks!
> Pieter
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/d04dcee8/attachment.htm>

From moseley at hank.org  Tue Dec  6 05:04:46 2011
From: moseley at hank.org (Bill Moseley)
Date: Tue, 6 Dec 2011 10:49:46 +0545
Subject: [rabbitmq-discuss] Using RabbitMQ for desktop-style messaging in a
	web app
Message-ID: <CAKhN_m4nV1moQunUXPpPi9O+mNOMZhC_9JaVuFq7EVMPen1CTA@mail.gmail.com>

We have a lot of background processing that happens in a web app and
investigating ways to message users when a background task is complete.
 I'm wondering if anyone is using RabbitMQ for something like this and can
describe their architecture.

We might have 20K concurrent users "logged in" at any given time.  Some
background tasks are important and the user must be notified, and for those
we use the database.  But, there's a number of other tasks that user can
trigger where it's not critical that the user is notified, but would be
nice to see.  These would be very similar to "you have new mail" in a mail
client, for example.

Questions that have come up is should message queues be session based or
user based -- that is if you log into the web app with two browsers (or on
two machines) would messages be broadcasted to all sessions for a give user
or be session-specific, and how to deal with the non-persistent connections
in web apps.

 Anyone using RabbitMQ for this type of application?

Thanks,

-- 
Bill Moseley
moseley at hank.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/5b6e378c/attachment.htm>

From iain.hull at workday.com  Tue Dec  6 08:35:52 2011
From: iain.hull at workday.com (Iain Hull)
Date: Tue, 6 Dec 2011 02:35:52 -0600
Subject: [rabbitmq-discuss] Socket leak in java client library
In-Reply-To: <89C2D4F0-7A2D-4F9C-9EF9-149DE17046F6@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36704CED46C@34093-C5-EVS1.exchange.rackspace.com>
	<925DDDE9D69E7143B3252E2D4680A36704DFEDE3@34093-C5-EVS1.exchange.rackspace.com>
	<DC16F33E-73F5-4E38-8B21-ED94DF501CAE@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36704DFF3A5@34093-C5-EVS1.exchange.rackspace.com>
	<89C2D4F0-7A2D-4F9C-9EF9-149DE17046F6@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36704F739B1@34093-C5-EVS1.exchange.rackspace.com>

Thanks for the update.  I will probably change my local patch to follow
yours.

Regards,
Iain.

-----Original Message-----
From: Steve Powell [mailto:steve at rabbitmq.com] 
Sent: 30 November 2011 18:11
To: RabbitMQ List
Cc: Iain Hull
Subject: Re: [rabbitmq-discuss] Socket leak in java client library

Dear Iain,

Looking at the newConnection() code in detail, I have chosen not to do
connection cleanup in newConnection() (as in your patch) but in
AMQConnection.start() where (most of) it belongs.   In other words, when
AMQConnection.start() detects a problem, it cleans up any debris
(threads, heartbeat executors and/or sockets) it may have created during
socket setup and connection negotiations before throwing an exception.
This allows us to ignore errors (except for reporting) in the
newConnection loop without leaking resources.

If this passes QA it should appear in the next release, and be
documented in the JavaDoc. These fixes are presently under the bug24597
track.

Steve Powell  (a tired bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 28 Nov 2011, at 20:39, Iain Hull wrote:
>
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-November/01661
2.html


From ekirpichov at gmail.com  Tue Dec  6 09:10:56 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 6 Dec 2011 13:10:56 +0400
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <4EDCCEF4.3070900@rabbitmq.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
	<4E8C330C.5010906@rabbitmq.com>
	<CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>
	<4EDCCEF4.3070900@rabbitmq.com>
Message-ID: <CANVKUrVH9Ma6bpZts_HL=+oVGRQDPuCduENHFaVjao=hWp-hFg@mail.gmail.com>

Hi Emile,
Thanks!
Has the fix been pushed to the git repo? I'd like to compile myself a
version with the fix.

On Mon, Dec 5, 2011 at 6:02 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Eugene,
>
> Thanks for the report. We have found and fixed what we believe to be the
> cause of this problem. It will be included in the next release.
>
>
>
> On 03/12/11 05:50, Eugene Kirpichov wrote:
> > Hi Emile,
> >
> > We've observed this issue again.
> > Unfortunately I don't have any more relevant information to help, except
> > the identical stacktrace.
> > The library version is 2.6.0.
> >
> > The problem is indeed extremely rare, as this is the second time we're
> > observing it on a several-hundred-machine cluster in months, but the
> > fact that it crashes the whole program makes its impact rather
> perceivable.
> >
> > On Wed, Oct 5, 2011 at 2:35 PM, Emile Joubert <emile at rabbitmq.com
> > <mailto:emile at rabbitmq.com>> wrote:
> >
> >     Hi Eugene,
> >
> >     On 04/10/11 18:49, Eugene Kirpichov wrote:
> >     > Hi,
> >     >
> >     > SessionManager.AutoCloseConnection can crash with the following
> >     stacktrace:
> >
> >     Thanks for reporting the problem. I will file a bug to investigate.
> >     There certainly appears to be a problem there, though I would expect
> it
> >     to be an exceedingly rare occurrence. Please let us know if you
> discover
> >     any further relevant information.
>
>


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/7f690c93/attachment.htm>

From matthias at rabbitmq.com  Tue Dec  6 09:18:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 06 Dec 2011 09:18:50 +0000
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <CANVKUrVH9Ma6bpZts_HL=+oVGRQDPuCduENHFaVjao=hWp-hFg@mail.gmail.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>	<4E8C330C.5010906@rabbitmq.com>	<CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>	<4EDCCEF4.3070900@rabbitmq.com>
	<CANVKUrVH9Ma6bpZts_HL=+oVGRQDPuCduENHFaVjao=hWp-hFg@mail.gmail.com>
Message-ID: <4EDDDDFA.7090203@rabbitmq.com>

On 06/12/11 09:10, Eugene Kirpichov wrote:
> Has the fix been pushed to the git repo?

https://github.com/rabbitmq/rabbitmq-dotnet-client/commit/d309982e44f444f957d2995ef59905c9d36a60be


Matthias.

From ekirpichov at gmail.com  Tue Dec  6 09:25:36 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 6 Dec 2011 13:25:36 +0400
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <4EDDDDFA.7090203@rabbitmq.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
	<4E8C330C.5010906@rabbitmq.com>
	<CANVKUrWahPLPAkf=kTtQ7=47cVebM2CK4ggDiyY-9Ugv5SCzRg@mail.gmail.com>
	<4EDCCEF4.3070900@rabbitmq.com>
	<CANVKUrVH9Ma6bpZts_HL=+oVGRQDPuCduENHFaVjao=hWp-hFg@mail.gmail.com>
	<4EDDDDFA.7090203@rabbitmq.com>
Message-ID: <CANVKUrWyqrhq6nG4H5mp7WFU9DQaC=xvduKSnMDeUkH0KQX-5A@mail.gmail.com>

Thanks Matthias!

On Tue, Dec 6, 2011 at 1:18 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 06/12/11 09:10, Eugene Kirpichov wrote:
>
>> Has the fix been pushed to the git repo?
>>
>
> https://github.com/rabbitmq/**rabbitmq-dotnet-client/commit/**
> d309982e44f444f957d2995ef59905**c9d36a60be<https://github.com/rabbitmq/rabbitmq-dotnet-client/commit/d309982e44f444f957d2995ef59905c9d36a60be>
>
>
> Matthias.
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/48c52201/attachment.htm>

From toby.corkindale at strategicdata.com.au  Tue Dec  6 10:24:53 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 06 Dec 2011 21:24:53 +1100
Subject: [rabbitmq-discuss] Interpreting "Processing Error" log message
Message-ID: <4EDDED75.5020408@strategicdata.com.au>

Hi,
I'm getting the dreaded "Processing Error" error frames back from a 
2.7.0 broker.

I'm looking at the rabbitmq log messages, but I'm not sure how to 
interpret them to determine what's wrong. This is what they say (may wrap)
PS. This is going via the STOMP adaptor.
Thanks in advance,
Toby

=ERROR REPORT==== 6-Dec-2011::10:16:20 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {noproc,
                         {gen_server,call,
                          [<0.27.170>,
                           {call,
                            {'basic.publish',0,<<"amq.topic">>,
                             <<"websurvey.adonai.1234">>,false,false},
                            {amqp_msg,
                             {'P_basic',undefined,undefined,
                              [{<<"content-length">>,longstr,<<"2">>},
                               {<<"x-method">>,longstr,<<"deploy">>}],
                              undefined,undefined,undefined,
 
<<"/topic/websurvey.commander.9923">>,undefined,
                              undefined,undefined,undefined,undefined,
                              undefined,undefined},
                             <<"{}">>},
                            <0.17.170>},
                           infinity]}}



From simon at rabbitmq.com  Tue Dec  6 10:56:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Dec 2011 10:56:28 +0000
Subject: [rabbitmq-discuss] Interpreting "Processing Error" log message
In-Reply-To: <4EDDED75.5020408@strategicdata.com.au>
References: <4EDDED75.5020408@strategicdata.com.au>
Message-ID: <4EDDF4DC.30100@rabbitmq.com>

Hi Toby.

That error is saying that the STOMP adaptor tried to publish a message 
into the broker but the channel it was aiming to publish to had died - 
in other words it's a second order problem. Are there other errors 
before it in the log?

Cheers, Simomn

On 06/12/11 10:24, Toby Corkindale wrote:
> Hi,
> I'm getting the dreaded "Processing Error" error frames back from a
> 2.7.0 broker.
>
> I'm looking at the rabbitmq log messages, but I'm not sure how to
> interpret them to determine what's wrong. This is what they say (may wrap)
> PS. This is going via the STOMP adaptor.
> Thanks in advance,
> Toby
>
> =ERROR REPORT==== 6-Dec-2011::10:16:20 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {noproc,
> {gen_server,call,
> [<0.27.170>,
> {call,
> {'basic.publish',0,<<"amq.topic">>,
> <<"websurvey.adonai.1234">>,false,false},
> {amqp_msg,
> {'P_basic',undefined,undefined,
> [{<<"content-length">>,longstr,<<"2">>},
> {<<"x-method">>,longstr,<<"deploy">>}],
> undefined,undefined,undefined,
>
> <<"/topic/websurvey.commander.9923">>,undefined,
> undefined,undefined,undefined,undefined,
> undefined,undefined},
> <<"{}">>},
> <0.17.170>},
> infinity]}}
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From keith at zentrope.com  Tue Dec  6 06:00:41 2011
From: keith at zentrope.com (Keith Irwin)
Date: Mon, 5 Dec 2011 22:00:41 -0800 (PST)
Subject: [rabbitmq-discuss] auto-delete exchange kills connections on
	consumer close?
Message-ID: <23512495.56.1323151241691.JavaMail.geo-discussion-forums@prnx7>

Folks--

I'm using RabbitMQ (2.7.0 all around + java with Clojure) to send small 
little status messages around here and there. It works great for that. 
Because I don't care if these messages get dropped if, say, RabbitMQ goes 
down, or if some client messes up here or there, I want to keep everything 
temporary. When all the clients are stopped, I'm thinking, RabbitMQ should 
be back to its default state.

So, when I use exchangeDeclare, I set auto-delete for the exchange to true. 
Here are my expectations:

 - When there are no more clients consuming or publishing to that 
particular exchange, it'll disappear.

What ACTUALLY happens is that when the first user of that exchange is 
closed (by calling close on a channel), the exchange is deleted, and all 
other users of that exchange get disconnected.

Is this a bug?

Should you always set autoDelete to false if there is ever going to be more 
than one client using an exchange? And isn't there always going to be 
another client using that exchange given there's no point in using an MQ 
system otherwise?

Please, set me straight! ;)

Keith

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111205/57a57701/attachment.htm>

From gabrieladgeg at gmail.com  Tue Dec  6 14:25:06 2011
From: gabrieladgeg at gmail.com (gabriel adgeg)
Date: Tue, 6 Dec 2011 15:25:06 +0100
Subject: [rabbitmq-discuss] pika raise NotImplementedError
Message-ID: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>

Hello,

I am working an a Python program that receives XML-RPC calls from Java
clients, and then create AMQP queues for each client.
To create channel, exchanges and queues, we use pika and SelectConnection.

So I first create and start a SelectConnection, then I create a channel. On
the reception of the on_open_callback of the channel, I try to declare a
queue.
The problem is that about 10% of time, a weird error occurs on the
declaration of the queue :

File "/usr/lib/python2.6/multiprocessing/process.py", line 232, in
_bootstrap
    self.run()
  File "/usr/lib/python2.6/multiprocessing/process.py", line 88, in run
    self._target(*self._args, **self._kwargs)
  File
"/home/adgeg/Sources/svn/TOTEM/Sandbox/TSP-MARGE-Communication/RabbitMQ/RabbitMQTOTEMLibrary/Python/net/totem/gamelogic/creategamelogicserver.py",
line 42, in createGameLogicServer
    state.connection.ioloop.start()
  File
"/home/adgeg/local/bin/pika-0.9.5/pika/adapters/select_connection.py", line
124, in start
    self.poller.start()
  File
"/home/adgeg/local/bin/pika-0.9.5/pika/adapters/select_connection.py", line
374, in start
    self.poll()
  File
"/home/adgeg/local/bin/pika-0.9.5/pika/adapters/select_connection.py", line
388, in poll
    self._handler(events[0][0], events[0][1])
  File "/home/adgeg/local/bin/pika-0.9.5/pika/adapters/base_connection.py",
line 134, in _handle_events
    self._handle_read()
  File "/home/adgeg/local/bin/pika-0.9.5/pika/adapters/base_connection.py",
line 162, in _handle_read
    self._on_data_available(data)
  File "/home/adgeg/local/bin/pika-0.9.5/pika/connection.py", line 599, in
_on_data_available
    self._channels[frame.channel_number].transport.deliver(frame)
  File "/home/adgeg/local/bin/pika-0.9.5/pika/channel.py", line 64, in
deliver
    self.frame_dispatcher.process(frame)
  File "/home/adgeg/local/bin/pika-0.9.5/pika/frame.py", line 202, in
process
    self._handler(frame)
  File "/home/adgeg/local/bin/pika-0.9.5/pika/frame.py", line 220, in
_handle_method_frame
    raise NotImplementedError(frame.method.__class__)
NotImplementedError: <class 'pika.spec.DeclareOk'>

We have already sent you a mail 6 months ago, and someone tell us to change
the pika source code to have a better understanding of this error, and here
is the result :
 File "/home/adgeg/local/bin/pika-0.9.5/pika/frame.py", line 220, in
_handle_method_frame
    raise NotImplementedError(frame.method.__class__)
NotImplementedError: <Method(['frame_type=1', 'channel_number=1',
"method=<Queue.DeclareOk(['queue=michel', 'message_count=0',
'consumer_count=0'])>"])>

I have looked to our source code, and I found that we were using the same
channel in two different threads.
So I create a new channel (with its own SelectConnection) for the second
thread... but the error is still raised.
Curiously, I have found a way to highly reduce appearance frequency of the
error: I accidentally add a call to a system command on the Python source
code on the on_open_callback, just before declaring the queue (rabbitmqctl
list_user_permissions, to check that I have the required permissions to
declare a queue).

And now, it seems that we arrived to an appearance frequency of 3 times on
2000 tries.
So I suppose that without this additional little time period,
the on_open_callback is triggered, but the channel seems not able to
declare a queue.
Do you know some related issues of this kind on SelectConnections?

Thanks a lot,

Gabriel Adgeg

PS : I am using RabbitMQ 2.7.0, Erlang R13B03, Python 2.6.5, pika 0.9.5,
on Ubuntu 10.04.3 LTS. The error also occurs with Erlang R14B04, Python
2.7.2, on Windows XP and Windows 7. And it was already there when we were
using RabbitMQ 2.5.1.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/2099c7db/attachment.htm>

From gmr at myyearbook.com  Tue Dec  6 15:02:58 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 6 Dec 2011 10:02:58 -0500
Subject: [rabbitmq-discuss] pika raise NotImplementedError
In-Reply-To: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>
References: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>
Message-ID: <533AD12F485046118FB6A61F924EAB2C@myyearbook.com>

On Tuesday, December 6, 2011 at 9:25 AM, gabriel adgeg wrote:
> 
> I have looked to our source code, and I found that we were using the same channel in two different threads.
> So I create a new channel (with its own SelectConnection) for the second thread... but the error is still raised.
> 
> 

You should keep the use of pika isolated per thread. IE don't reshare a connection or channel across threads. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/a7d36c62/attachment.htm>

From tqxtqx at gmail.com  Tue Dec  6 15:22:35 2011
From: tqxtqx at gmail.com (tang qingxiong)
Date: Tue, 6 Dec 2011 23:22:35 +0800
Subject: [rabbitmq-discuss]  Need help to interpret performance results
Message-ID: <CANJ_2Y4HsVxevyvoZomLnOUfpQffqdoXJLdWGpX9J4WouCq96w@mail.gmail.com>

Some background. My project is trying to implement rabbitMQ as a
communications protocol as a direct replacement for OpenAMQ as it is
outdated. We are running C++ on windows server 2003 and used the C client
library to implement our solution.

We setup 4 clustered brokers for clients to connect to. We have 20 clients
each publishing data using direct mode to the same exchange with all the
queues listening to the same key.

The idea of the setup is that if 1 client sends out data each of the other
19 will receive the data.

We ran our application and noticed that the queues actually pile up.
I have taken screenshoots of the management console.

http://imageshack.us/f/213/overviewrabbitmq.jpg/

This shows that the ready queue which is increasing overtime and also
publish and deliver.

http://img690.imageshack.us/img690/903/queuesrabbitmq.jpg

This image shows the incoming rate of each client is 12/s and deliver is
30/s.

I am wondering if anyone here knows the reason on the pileup as the
incoming rate is less than the deliver rate. (Assuming the incoming rate is
the rate of receiving and deliver rate is the rate of sending.).

Also is there anyway to further optimize the rate of speeding and receiving
either programmatically or configuration. Our send and receive code is very
similar to the example provided by the Client here

http://hg.rabbitmq.com/rabbitmq-c/file/7cecf64752fd/examples

Thanks!

QX
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/81e1566c/attachment.htm>

From simon at rabbitmq.com  Tue Dec  6 15:38:40 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Dec 2011 15:38:40 +0000
Subject: [rabbitmq-discuss] Need help to interpret performance results
In-Reply-To: <CANJ_2Y4HsVxevyvoZomLnOUfpQffqdoXJLdWGpX9J4WouCq96w@mail.gmail.com>
References: <CANJ_2Y4HsVxevyvoZomLnOUfpQffqdoXJLdWGpX9J4WouCq96w@mail.gmail.com>
Message-ID: <4EDE3700.2050501@rabbitmq.com>

Hi Tang.

On 06/12/11 15:22, tang qingxiong wrote:
> Some background. My project is trying to implement rabbitMQ as a
> communications protocol as a direct replacement for OpenAMQ as it is
> outdated. We are running C++ on windows server 2003 and used the C
> client library to implement our solution.
>
> We setup 4 clustered brokers for clients to connect to. We have 20
> clients each publishing data using direct mode to the same exchange with
> all the queues listening to the same key.
>
> The idea of the setup is that if 1 client sends out data each of the
> other 19 will receive the data.
>
> We ran our application and noticed that the queues actually pile up.
> I have taken screenshoots of the management console.

You *must* enable rabbitmq_management_agent on every node in the cluster 
to be able to trust the figures you see in management - at the moment 
you're only seeing partial message rates; they are not guaranteed to add 
up *at all*.

> http://imageshack.us/f/213/overviewrabbitmq.jpg/
>
> This shows that the ready queue which is increasing overtime and also
> publish and deliver.
>
> http://img690.imageshack.us/img690/903/queuesrabbitmq.jpg
>
> This image shows the incoming rate of each client is 12/s and deliver is
> 30/s.

It's probably not.

> I am wondering if anyone here knows the reason on the pileup as the
> incoming rate is less than the deliver rate.

Even when you get rabbitmq_management_agent installed, there can still 
be small pileups when mgmt shows incoming and deliver being the same, 
since the rates are averages and are not sampled at the exact same 
instant as queue lengths anyway.

But small pileups are not a problem - it is a message *queue* after all :-)

> (Assuming the incoming rate
> is the rate of receiving and deliver rate is the rate of sending.).

Incoming = rate at which messages enter the queue. Deliver = rate at 
which they are consumed.

> Also is there anyway to further optimize the rate of speeding and
> receiving either programmatically or configuration. Our send and receive
> code is very similar to the example provided by the Client here

Well 30 msg/s should be nothing. You shouldn't need to optimise anything 
much.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From agong at umich.edu  Tue Dec  6 15:34:32 2011
From: agong at umich.edu (Abe)
Date: Tue, 6 Dec 2011 15:34:32 +0000 (UTC)
Subject: [rabbitmq-discuss] Can't get rabbitMQ to restart after switching
	machines -- some kind of DB error...?
Message-ID: <loom.20111206T160933-241@post.gmane.org>

I'm running a django/celery app on EC2, with rabbitmq as the broker. The machine
I was using failed, so I fired up another instance. But since switching to the
new machine, I haven't been able to get rabbitmq-server to start up.

Here's the output:


$ sudo rabbitmq-server start
[Rabbit logo and info...]

AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node          : rabbit at ip-10-212-66-181
app descriptor:
  /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : 5+uQ077En5bpvle3HJCQMg==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit

starting internal event notification system                           ...done
starting logging server                                               ...done
starting database                                                     ...Erlang
has closed
{"init terminating in do_boot", {{nocatch, {error,{cannot_start_application,
rabbit, {bad_return, {{rabbit,start,[normal,[]]},{'EXIT',
{{case_clause,{error,{timeout_waiting_for_tables, [rabbit_user,
rabbit_user_permission, rabbit_vhost, rabbit_config, rabbit_listener,
rabbit_durable_route, rabbit_route, rabbit_reverse_route,
rabbit_durable_exchange, rabbit_exchange, rabbit_durable_queue,
rabbit_queue]}}}, [{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
{rabbit,run_boot_step,1}, {rabbit,'-start/2-lc$^0/1-0-',1}, {rabbit,start,2},
{application_master, start_it_old,4}]}}}}}}}, [{init,start_it,1},
{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()





There's also an erlang daemon process running in the background.  I'm not sure
if this is important or not.

$ ps aux | grep rabbit
rabbitmq   714  0.0  0.0   1980   412 ?        S    Dec04   0:01
/usr/lib/erlang/erts-5.7.4/bin/epmd -daemon

Any ideas on how to further diagnose/solve this problem?


Thanks in advance!
- Abe


PS: I posted this question to serverfault before realizing that this might be a
better place to ask it:http://serverfault.com/questions/337982/



From simon at rabbitmq.com  Tue Dec  6 15:57:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Dec 2011 15:57:28 +0000
Subject: [rabbitmq-discuss] Rabbit RPC Application
In-Reply-To: <CAGy26MMaHGEFRuKUQZ1n9Tcyom3TEccAKQKBYdu4Gmwv1fbkQg@mail.gmail.com>
References: <CAGy26MMaHGEFRuKUQZ1n9Tcyom3TEccAKQKBYdu4Gmwv1fbkQg@mail.gmail.com>
Message-ID: <4EDE3B68.6040503@rabbitmq.com>

Hi Bruno.

It probably depends how frequently you expect to publish messages - 
while the comparative overhead of setting up a channel with JSON-RPC is 
lower than with AMQP (just because everything gets translated into 
comparatively expensive HTTP requests anyway), it's still there.

I suspect it won't make a huge difference though.

Cheers, Simon

On 01/12/11 17:03, Bruno Carneiro wrote:
> Hello Everybody,
>
> I developed a monitoring application using Rabbit and Rabbit RPC plugin.
> I'm monitoring events on my HTML pages and sending messages over HTTP.
> What my javascript does is for each event, it opens a channel, send a
> message and close that channel. This is the snippet:
>
>         function on_open(channel) {
>
>         channel.queueDeclare(exchangeQueue, false, true, false, false)
>
>             .addCallback( function() {
>
>         channel.basicPublish("", exchangeQueue, exchangeMessage, props);
>
>         channel.close();
>
>         });
>
>         }
>
>
>         function trackEvent(queue, jsonMsg){
>
>         channel = RabbitMQ.openChannel(on_open, {'exchangeQueue': queue,
>         'exchangeMessage': jsonMsg});
>
>         }
>
>
>
> When I saw the examples I was wondering what is the best practice using
> channel in a browser?
> Should I open and close it for each message or should I leave it open
> and send messages through this channel?
>
> Thank you!
>
> Cheers,
>
> Bruno Carneiro
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From pdezwart at rubiconproject.com  Tue Dec  6 16:16:14 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 6 Dec 2011 10:16:14 -0600
Subject: [rabbitmq-discuss] Consume stuck at prefectch count limit
In-Reply-To: <CAOn7oW9dZiqb+-kEKz50zE-TebPKCYkckRaDcJurHJBw7ZejLg@mail.gmail.com>
Message-ID: <CB037F8A.2BB9F%pdezwart@rubiconproject.com>

I was unaware of a requirement to ack messages up to the prefetch limit before continuing to consume? That seems very odd to me.

Pieter


From: Simone Busoli <simone.busoli at gmail.com<mailto:simone.busoli at gmail.com>>
Date: Mon, 5 Dec 2011 14:26:12 -0600
To: Pieter de Zwart <pdezwart at rubiconproject.com<mailto:pdezwart at rubiconproject.com>>
Cc: RabbitMQ Mailing List <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Consume stuck at prefectch count limit


Briefly looking at the code you don't seem to be acking messages.

On Dec 5, 2011 7:31 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com<mailto:pdezwart at rubiconproject.com>> wrote:
Hey everyone,

I am having some trouble with the basic.consume method and prefetch. It would seem that when I set a prefect count to X, the consume method will successfully pull in X messages, and then get stuck on the next amqp_simple_wait_frame. I have attached a hacked version of the amqp_consumer example that displays the behavior. I did hack in a local queue name that had enough messages?

Hopefully I am just doing something nonsensical.

Thanks!
Pieter

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/764ad6ac/attachment.htm>

From simon at rabbitmq.com  Tue Dec  6 16:23:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 06 Dec 2011 16:23:07 +0000
Subject: [rabbitmq-discuss] Consume stuck at prefectch count limit
In-Reply-To: <CB037F8A.2BB9F%pdezwart@rubiconproject.com>
References: <CB037F8A.2BB9F%pdezwart@rubiconproject.com>
Message-ID: <4EDE416B.8020706@rabbitmq.com>

On 06/12/11 16:16, Pieter de Zwart wrote:
> I was unaware of a requirement to ack messages up to the prefetch limit
> before continuing to consume? That seems very odd to me.

That's exactly what prefetch means - you need to tell the server it can 
send you more messages before it will send you more :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pdezwart at rubiconproject.com  Tue Dec  6 16:29:20 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 6 Dec 2011 10:29:20 -0600
Subject: [rabbitmq-discuss] Consume stuck at prefectch count limit
In-Reply-To: <4EDE416B.8020706@rabbitmq.com>
Message-ID: <CB038291.2BBAD%pdezwart@rubiconproject.com>

Doh. Thanks =)



On 12/6/11 8:23 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 06/12/11 16:16, Pieter de Zwart wrote:
>> I was unaware of a requirement to ack messages up to the prefetch limit
>> before continuing to consume? That seems very odd to me.
>
>That's exactly what prefetch means - you need to tell the server it can
>send you more messages before it will send you more :)
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gabrieladgeg at gmail.com  Tue Dec  6 16:32:05 2011
From: gabrieladgeg at gmail.com (gabriel adgeg)
Date: Tue, 6 Dec 2011 17:32:05 +0100
Subject: [rabbitmq-discuss] pika raise NotImplementedError
In-Reply-To: <533AD12F485046118FB6A61F924EAB2C@myyearbook.com>
References: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>
	<533AD12F485046118FB6A61F924EAB2C@myyearbook.com>
Message-ID: <CAE+5KB2RAyRjK4D-BV-S7M6ibNnyf6sMMmmtC-wcEcUNA40coA@mail.gmail.com>

I am sorry for the misunderstanding, but I think it is exactly what I have
done.
Now, I have 2 threads, and each thread uses its own connection and its own
channel, without any share.
Yet, the error is still raised.

Thanks

2011/12/6 Gavin M. Roy <gmr at myyearbook.com>

> On Tuesday, December 6, 2011 at 9:25 AM, gabriel adgeg wrote:
>
>
> I have looked to our source code, and I found that we were using the same
> channel in two different threads.
> So I create a new channel (with its own SelectConnection) for the second
> thread... but the error is still raised.
>
> You should keep the use of pika isolated per thread. IE don't reshare a
> connection or channel across threads.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/1e23d80e/attachment.htm>

From gmr at myyearbook.com  Tue Dec  6 16:42:35 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 6 Dec 2011 11:42:35 -0500
Subject: [rabbitmq-discuss] pika raise NotImplementedError
In-Reply-To: <CAE+5KB2RAyRjK4D-BV-S7M6ibNnyf6sMMmmtC-wcEcUNA40coA@mail.gmail.com>
References: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>
	<533AD12F485046118FB6A61F924EAB2C@myyearbook.com>
	<CAE+5KB2RAyRjK4D-BV-S7M6ibNnyf6sMMmmtC-wcEcUNA40coA@mail.gmail.com>
Message-ID: <4C9C4E5DD67B4629BB27925DFF555006@myyearbook.com>

If you are able, please create a simple example that demonstrates the error and create an issue to track at: 

http://github.com/pika/pika

I will be better able to help with the example.

Thanks,

Gavin


On Tuesday, December 6, 2011 at 11:32 AM, gabriel adgeg wrote:

> I am sorry for the misunderstanding, but I think it is exactly what I have done.
> Now, I have 2 threads, and each thread uses its own connection and its own channel, without any share.
> Yet, the error is still raised.
> 
> Thanks 
> 
> 2011/12/6 Gavin M. Roy <gmr at myyearbook.com (mailto:gmr at myyearbook.com)>
> > On Tuesday, December 6, 2011 at 9:25 AM, gabriel adgeg wrote:
> > > 
> > > I have looked to our source code, and I found that we were using the same channel in two different threads.
> > > So I create a new channel (with its own SelectConnection) for the second thread... but the error is still raised.
> > > 
> > > 
> > > 
> > 
> > 
> > You should keep the use of pika isolated per thread. IE don't reshare a connection or channel across threads. 
> > 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111206/0e1ca515/attachment.htm>

From alexandru at rabbitmq.com  Tue Dec  6 16:44:21 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 6 Dec 2011 16:44:21 +0000
Subject: [rabbitmq-discuss] Can't get rabbitMQ to restart after
 switching machines -- some kind of DB error...?
In-Reply-To: <loom.20111206T160933-241@post.gmane.org>
References: <loom.20111206T160933-241@post.gmane.org>
Message-ID: <20111206164421.GA4221@southbank>

Hi Abe,

> But since switching to the
> new machine, I haven't been able to get rabbitmq-server to start up.

The database RabbitMQ uses is bound to the machine's hostname, so if you
copied the database dir to another machine, it won't work.  If this is
the case, you have to set up a machine with the same hostname as before
and transfer any outstanding messages to the new machine.  If there's
nothing important in rabbit, you could just clear everything by removing
the RabbitMQ files in /var/lib/rabbitmq.

>   /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app

1.7.2 is a *very* old version of the broker.  You should really upgrade,
as a lot of new features and a lot of bugfixes have gone in since then.

> {"init terminating in do_boot", {{nocatch, {error,{cannot_start_application,
> rabbit, {bad_return, {{rabbit,start,[normal,[]]},{'EXIT',
> {{case_clause,{error,{timeout_waiting_for_tables, [rabbit_user,
> rabbit_user_permission, rabbit_vhost, rabbit_config, rabbit_listener,
> rabbit_durable_route, rabbit_route, rabbit_reverse_route,
> rabbit_durable_exchange, rabbit_exchange, rabbit_durable_queue,
> rabbit_queue]}}}, [{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> {rabbit,run_boot_step,1}, {rabbit,'-start/2-lc$^0/1-0-',1}, {rabbit,start,2},
> {application_master, start_it_old,4}]}}}}}}}, [{init,start_it,1},
> {init,start_em,1}]}}

So, it's timing out waiting for the distributed tables.  I suspect this
is because of the hostname change.  If you had a cluster set up before,
that may also cause this to happen.

> There's also an erlang daemon process running in the background.  I'm not sure
> if this is important or not.
> 
> $ ps aux | grep rabbit
> rabbitmq   714  0.0  0.0   1980   412 ?        S    Dec04   0:01
> /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon

That's perfectly normal.  It starts up with RabbitMQ (and a few other
Erlang apps) and remains running even after they stop.  You can kill it
if you really want to and RabbitMQ isn't running.

Hope this helps.

Cheers,
Alex

On Tue, Dec 06, 2011 at 03:34:32PM +0000, Abe wrote:
> I'm running a django/celery app on EC2, with rabbitmq as the broker. The machine
> I was using failed, so I fired up another instance. But since switching to the
> new machine, I haven't been able to get rabbitmq-server to start up.
> 
> Here's the output:
> 
> 
> $ sudo rabbitmq-server start
> [Rabbit logo and info...]
> 
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> node          : rabbit at ip-10-212-66-181
> app descriptor:
>   /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
> home dir      : /var/lib/rabbitmq
> cookie hash   : 5+uQ077En5bpvle3HJCQMg==
> log           : /var/log/rabbitmq/rabbit.log
> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
> database dir  : /var/lib/rabbitmq/mnesia/rabbit
> 
> starting internal event notification system                           ...done
> starting logging server                                               ...done
> starting database                                                     ...Erlang
> has closed
> {"init terminating in do_boot", {{nocatch, {error,{cannot_start_application,
> rabbit, {bad_return, {{rabbit,start,[normal,[]]},{'EXIT',
> {{case_clause,{error,{timeout_waiting_for_tables, [rabbit_user,
> rabbit_user_permission, rabbit_vhost, rabbit_config, rabbit_listener,
> rabbit_durable_route, rabbit_route, rabbit_reverse_route,
> rabbit_durable_exchange, rabbit_exchange, rabbit_durable_queue,
> rabbit_queue]}}}, [{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> {rabbit,run_boot_step,1}, {rabbit,'-start/2-lc$^0/1-0-',1}, {rabbit,start,2},
> {application_master, start_it_old,4}]}}}}}}}, [{init,start_it,1},
> {init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
> 
> 
> 
> 
> There's also an erlang daemon process running in the background.  I'm not sure
> if this is important or not.
> 
> $ ps aux | grep rabbit
> rabbitmq   714  0.0  0.0   1980   412 ?        S    Dec04   0:01
> /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon
> 
> Any ideas on how to further diagnose/solve this problem?
> 
> 
> Thanks in advance!
> - Abe
> 
> 
> PS: I posted this question to serverfault before realizing that this might be a
> better place to ask it:http://serverfault.com/questions/337982/
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jason.lunz at gmail.com  Tue Dec  6 17:40:09 2011
From: jason.lunz at gmail.com (Jason Lunz)
Date: Tue, 6 Dec 2011 17:40:09 +0000 (UTC)
Subject: [rabbitmq-discuss] why run cpu_sup?
Message-ID: <jblk1p$q3s$1@dough.gmane.org>

It appears from some searching that the rabbitmq startup script has been
invoking start_cpu_sup=true for a long time. But I can't find anywhere
where rabbitmq is using the data it gathers. Perhaps that should be
disabled just to have one less process hanging around?

Jason


From toby.corkindale at strategicdata.com.au  Tue Dec  6 23:18:52 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 07 Dec 2011 10:18:52 +1100
Subject: [rabbitmq-discuss] Interpreting "Processing Error" log message
In-Reply-To: <4EDDF4DC.30100@rabbitmq.com>
References: <4EDDED75.5020408@strategicdata.com.au>
	<4EDDF4DC.30100@rabbitmq.com>
Message-ID: <4EDEA2DC.5070604@strategicdata.com.au>

On 06/12/11 21:56, Simon MacMullen wrote:
> Hi Toby.
>
> That error is saying that the STOMP adaptor tried to publish a message
> into the broker but the channel it was aiming to publish to had died -
> in other words it's a second order problem. Are there other errors
> before it in the log?

Five seconds earlier there was an error:
=ERROR REPORT==== 6-Dec-2011::10:16:15 ===
connection <0.20.170>, channel 1 - error:
{amqp_error,precondition_failed,"unknown delivery tag 2",'basic.ack'}

It didn't look like that has caused the application to fail, but are you 
saying it is probably related?

It's not entirely clear what that error means to me either, other than 
that there was a problem with an ack somewhere. (Which I'll try and 
track down now)


Is there a way to decode these error reports?
As someone who isn't familiar with Erlang, nor the internal source code 
of RMQ, these errors are quite daunting.

Thanks again for your help,
Toby

> On 06/12/11 10:24, Toby Corkindale wrote:
>> Hi,
>> I'm getting the dreaded "Processing Error" error frames back from a
>> 2.7.0 broker.
>>
>> I'm looking at the rabbitmq log messages, but I'm not sure how to
>> interpret them to determine what's wrong. This is what they say (may
>> wrap)
>> PS. This is going via the STOMP adaptor.
>> Thanks in advance,
>> Toby
>>
>> =ERROR REPORT==== 6-Dec-2011::10:16:20 ===
>> STOMP error frame sent:
>> Message: "Processing error"
>> Detail: "Processing error\n"
>> Server private detail: {noproc,
>> {gen_server,call,
>> [<0.27.170>,
>> {call,
>> {'basic.publish',0,<<"amq.topic">>,
>> <<"websurvey.adonai.1234">>,false,false},
>> {amqp_msg,
>> {'P_basic',undefined,undefined,
>> [{<<"content-length">>,longstr,<<"2">>},
>> {<<"x-method">>,longstr,<<"deploy">>}],
>> undefined,undefined,undefined,
>>
>> <<"/topic/websurvey.commander.9923">>,undefined,
>> undefined,undefined,undefined,undefined,
>> undefined,undefined},
>> <<"{}">>},
>> <0.17.170>},
>> infinity]}}
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
.signature

From toby.corkindale at strategicdata.com.au  Tue Dec  6 23:52:41 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 07 Dec 2011 10:52:41 +1100
Subject: [rabbitmq-discuss] Interpreting "Processing Error" log message
In-Reply-To: <4EDEA2DC.5070604@strategicdata.com.au>
References: <4EDDED75.5020408@strategicdata.com.au>
	<4EDDF4DC.30100@rabbitmq.com>
	<4EDEA2DC.5070604@strategicdata.com.au>
Message-ID: <4EDEAAC9.3020904@strategicdata.com.au>

On 07/12/11 10:18, Toby Corkindale wrote:
> On 06/12/11 21:56, Simon MacMullen wrote:
>> Hi Toby.
>>
>> That error is saying that the STOMP adaptor tried to publish a message
>> into the broker but the channel it was aiming to publish to had died -
>> in other words it's a second order problem. Are there other errors
>> before it in the log?
>
> Five seconds earlier there was an error:
> =ERROR REPORT==== 6-Dec-2011::10:16:15 ===
> connection <0.20.170>, channel 1 - error:
> {amqp_error,precondition_failed,"unknown delivery tag 2",'basic.ack'}
>
> It didn't look like that has caused the application to fail, but are you
> saying it is probably related?
>
> It's not entirely clear what that error means to me either, other than
> that there was a problem with an ack somewhere. (Which I'll try and
> track down now)

The error about basic.ack occurs when I'm doing a client acknowledge of 
a message that was received via a /temp-queue/.

Avoiding it solves the current issue.

> Is there a way to decode these error reports?
> As someone who isn't familiar with Erlang, nor the internal source code
> of RMQ, these errors are quite daunting.
>
> Thanks again for your help,
> Toby
>
>> On 06/12/11 10:24, Toby Corkindale wrote:
>>> Hi,
>>> I'm getting the dreaded "Processing Error" error frames back from a
>>> 2.7.0 broker.
>>>
>>> I'm looking at the rabbitmq log messages, but I'm not sure how to
>>> interpret them to determine what's wrong. This is what they say (may
>>> wrap)
>>> PS. This is going via the STOMP adaptor.
>>> Thanks in advance,
>>> Toby
>>>
>>> =ERROR REPORT==== 6-Dec-2011::10:16:20 ===
>>> STOMP error frame sent:
>>> Message: "Processing error"
>>> Detail: "Processing error\n"
>>> Server private detail: {noproc,
>>> {gen_server,call,
>>> [<0.27.170>,
>>> {call,
>>> {'basic.publish',0,<<"amq.topic">>,
>>> <<"websurvey.adonai.1234">>,false,false},
>>> {amqp_msg,
>>> {'P_basic',undefined,undefined,
>>> [{<<"content-length">>,longstr,<<"2">>},
>>> {<<"x-method">>,longstr,<<"deploy">>}],
>>> undefined,undefined,undefined,
>>>
>>> <<"/topic/websurvey.commander.9923">>,undefined,
>>> undefined,undefined,undefined,undefined,
>>> undefined,undefined},
>>> <<"{}">>},
>>> <0.17.170>},
>>> infinity]}}
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>


-- 
.signature

From toby.corkindale at strategicdata.com.au  Wed Dec  7 00:10:12 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 07 Dec 2011 11:10:12 +1100
Subject: [rabbitmq-discuss] Cleaning up temp-queues in long-running processes
Message-ID: <4EDEAEE4.7080301@strategicdata.com.au>

Hi,
If I use the /temp-queue/ methods to create temporary queues, I see that 
they remain in existence until the process disconnects from the RMQ broker.

If you're using these for RPC on a long-running process, you soon have 
huge numbers of queues on the broker.

Is there a way to remove them once you're done?

I tried UNSUBSCRIBE on them, but that didn't seem to work. (I don't have 
a subscription id)

The problem is compounded by the bug with re-using the temp-queues. 
Because you need to use a unique name each time, every RPC call has to 
create a new temp queue, rather than being able to reuse the same call 
for at least the same methods.

ta,
Toby

From toby.corkindale at strategicdata.com.au  Wed Dec  7 00:55:33 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 07 Dec 2011 11:55:33 +1100
Subject: [rabbitmq-discuss] A different Processing error in logs
Message-ID: <4EDEB985.4010404@strategicdata.com.au>

Sorry about posting more of these; as I've said before, these errors are 
quite opaque to me, and I wish I could interpret them unaided.
How do other developers here deal with them? (Or am I just unlucky in 
seeming to hit them often)


This message occurs during message *reception* this time, and only seems 
to occur when there are several pending messages.
It's worth noting that the messages arrive after I've recently 
unsubscribed from a queue - but that was not the queue mentioned in the 
error message.

=ERROR REPORT==== 7-Dec-2011::00:51:03 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {badarg,
                         [{dict,fetch,
                           [<<"T_commander">>,
                            {dict,1,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],
                               [[<<"T_primary-queue">>|
                                 {subscription,
                                  "/topic/websurvey.commander.18680",
 
<0.28312.182>,true,"id='primary-queue'"}]],
                               [],[],[],[],[]}}}]},
                          {rabbit_stomp_processor,ack_action,4},
                          {rabbit_stomp_processor,process_request,3},
                          {gen_server2,handle_msg,2},
                          {proc_lib,init_p_do_apply,3}]}



From toby.corkindale at strategicdata.com.au  Wed Dec  7 01:32:06 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 07 Dec 2011 12:32:06 +1100
Subject: [rabbitmq-discuss] A different Processing error in logs
In-Reply-To: <4EDEB985.4010404@strategicdata.com.au>
References: <4EDEB985.4010404@strategicdata.com.au>
Message-ID: <4EDEC216.6000408@strategicdata.com.au>

On 07/12/11 11:55, Toby Corkindale wrote:
> Sorry about posting more of these; as I've said before, these errors are
> quite opaque to me, and I wish I could interpret them unaided.
> How do other developers here deal with them? (Or am I just unlucky in
> seeming to hit them often)
>
>
> This message occurs during message *reception* this time, and only seems
> to occur when there are several pending messages.
> It's worth noting that the messages arrive after I've recently
> unsubscribed from a queue - but that was not the queue mentioned in the
> error message.

This feels like a RabbitMQ or STOMP bug to me, but here's some more info 
on what causes it to occur so you can decide.

1) Create two queues, with ack=client, subscribe to both, using STOMP.
2) Dump a bunch of messages into first queue.
3) Upon receiving one message, unsubscribe from the first queue only, 
and then ack the message.
4) Note that you still get delivered some more messages from that first 
queue.
5) Attempt to send a client ACK back for one of these messages, which 
seems to work fine.
6) Now attempt to send another message through on the second 
(still-subscribed) queue -- rabbitmq generates the Processing Error.


In my case, I can avoid the error occurring by not sending a client ACK 
back for messages received on a queue which I am no longer subscribed to.

-Toby


> =ERROR REPORT==== 7-Dec-2011::00:51:03 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {badarg,
> [{dict,fetch,
> [<<"T_commander">>,
> {dict,1,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
> {{[],[],[],[],[],[],[],[],[],[],
> [[<<"T_primary-queue">>|
> {subscription,
> "/topic/websurvey.commander.18680",
>
> <0.28312.182>,true,"id='primary-queue'"}]],
> [],[],[],[],[]}}}]},
> {rabbit_stomp_processor,ack_action,4},
> {rabbit_stomp_processor,process_request,3},
> {gen_server2,handle_msg,2},
> {proc_lib,init_p_do_apply,3}]}
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
.signature

From tqxtqx at gmail.com  Wed Dec  7 03:18:26 2011
From: tqxtqx at gmail.com (tang qingxiong)
Date: Wed, 7 Dec 2011 11:18:26 +0800
Subject: [rabbitmq-discuss] Need help to interpret performance results
In-Reply-To: <4EDE3700.2050501@rabbitmq.com>
References: <CANJ_2Y4HsVxevyvoZomLnOUfpQffqdoXJLdWGpX9J4WouCq96w@mail.gmail.com>
	<4EDE3700.2050501@rabbitmq.com>
Message-ID: <CANJ_2Y6ThtjaTWJ50LTn_qeD1LQgws0w6HZJjRdmXFUK-gj7JQ@mail.gmail.com>

Hi,

        I redone the test with the agent enabled on all the nodes.

       This is the results,
overview

http://img805.imageshack.us/img805/2306/overviewrabbitmq1.jpg

queue

http://img522.imageshack.us/img522/4746/queuesrabbitmq1.jpg

I noticed that the messages in 1 queue is increasing despite the fact that
the incoming is still <= get/deliver. The pileup is actually quite
significant as I only managed to last an hour before the broker crashed due
to insufficient memory. one message could be up to 300kb as thats what I
set the frame size to be (I assume that is the message size).

Was wondering if it is a problem with the way I implement the clustering or
code.

my cluster config is as follows
server 1
[
{rabbit,[{vm_memory_high_watermark, 1.0},{frame_max,
0},{cluster_nodes,['rabbit at SERVER1','rabbit at SERVER2']}]}
].
server 2
[
{rabbit,[{vm_memory_high_watermark, 1.0},{frame_max,
0},{cluster_nodes,['rabbit at SERVER2','rabbit at SERVER1']}]}
].
.
.
.
.

server 5
[
{rabbit,[{vm_memory_high_watermark, 1.0},{frame_max,
0},{cluster_nodes,['rabbit at SERVER5','rabbit at SERVER1']}]}
].

Thanks,
Qingxiong
On Tue, Dec 6, 2011 at 11:38 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Tang.
>
>
> On 06/12/11 15:22, tang qingxiong wrote:
>
>> Some background. My project is trying to implement rabbitMQ as a
>> communications protocol as a direct replacement for OpenAMQ as it is
>> outdated. We are running C++ on windows server 2003 and used the C
>> client library to implement our solution.
>>
>> We setup 4 clustered brokers for clients to connect to. We have 20
>> clients each publishing data using direct mode to the same exchange with
>> all the queues listening to the same key.
>>
>> The idea of the setup is that if 1 client sends out data each of the
>> other 19 will receive the data.
>>
>> We ran our application and noticed that the queues actually pile up.
>> I have taken screenshoots of the management console.
>>
>
> You *must* enable rabbitmq_management_agent on every node in the cluster
> to be able to trust the figures you see in management - at the moment
> you're only seeing partial message rates; they are not guaranteed to add up
> *at all*.
>
>
>  http://imageshack.us/f/213/**overviewrabbitmq.jpg/<http://imageshack.us/f/213/overviewrabbitmq.jpg/>
>>
>> This shows that the ready queue which is increasing overtime and also
>> publish and deliver.
>>
>> http://img690.imageshack.us/**img690/903/queuesrabbitmq.jpg<http://img690.imageshack.us/img690/903/queuesrabbitmq.jpg>
>>
>> This image shows the incoming rate of each client is 12/s and deliver is
>> 30/s.
>>
>
> It's probably not.
>
>
>  I am wondering if anyone here knows the reason on the pileup as the
>> incoming rate is less than the deliver rate.
>>
>
> Even when you get rabbitmq_management_agent installed, there can still be
> small pileups when mgmt shows incoming and deliver being the same, since
> the rates are averages and are not sampled at the exact same instant as
> queue lengths anyway.
>
> But small pileups are not a problem - it is a message *queue* after all :-)
>
>
>  (Assuming the incoming rate
>> is the rate of receiving and deliver rate is the rate of sending.).
>>
>
> Incoming = rate at which messages enter the queue. Deliver = rate at which
> they are consumed.
>
>
>  Also is there anyway to further optimize the rate of speeding and
>> receiving either programmatically or configuration. Our send and receive
>> code is very similar to the example provided by the Client here
>>
>
> Well 30 msg/s should be nothing. You shouldn't need to optimise anything
> much.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111207/41154d14/attachment.htm>

From matthias at rabbitmq.com  Wed Dec  7 07:07:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Dec 2011 07:07:44 +0000
Subject: [rabbitmq-discuss] Need help to interpret performance results
In-Reply-To: <CANJ_2Y6ThtjaTWJ50LTn_qeD1LQgws0w6HZJjRdmXFUK-gj7JQ@mail.gmail.com>
References: <CANJ_2Y4HsVxevyvoZomLnOUfpQffqdoXJLdWGpX9J4WouCq96w@mail.gmail.com>	<4EDE3700.2050501@rabbitmq.com>
	<CANJ_2Y6ThtjaTWJ50LTn_qeD1LQgws0w6HZJjRdmXFUK-gj7JQ@mail.gmail.com>
Message-ID: <4EDF10C0.1010900@rabbitmq.com>

On 07/12/11 03:18, tang qingxiong wrote:
> http://img522.imageshack.us/img522/4746/queuesrabbitmq1.jpg
>
> I noticed that the messages in 1 queue is increasing despite the
> fact that the incoming is still <= get/deliver.

Take a look at the details page for that queue. It may contain some
clues as to why you are seeing the above. In particular there should be
some (rather cryptic) information about the backing_queue_status that
contains the queue's internal rate calculations.

> one message could be up to 300kb as thats what I set the frame size
> to be (I assume that is the message size).

No, the frame_max setting controls the size of a single frame; messages 
automatically get fragmented across multiple frames when they exceed 
that size. And note that the frame_max includes the framing overhead. So 
if you set it to exactly your message size you'll actually be short of a 
few octets and the messages get split over two frames.

See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune.frame-max 
for more info.

> Was wondering if it is a problem with the way I implement the
> clustering or code.
>
> my cluster config is as follows server 1 [
> {rabbit,[{vm_memory_high_watermark, 1.0},{frame_max,
> 0},{cluster_nodes,['rabbit at SERVER1','rabbit at SERVER2']}]} ]. server 2
>  [ {rabbit,[{vm_memory_high_watermark, 1.0},{frame_max,
> 0},{cluster_nodes,['rabbit at SERVER2','rabbit at SERVER1']}]} ]. . . . .

Nothing wrong with that except that setting the vm_memory_high_watermark 
to 1.0 is usually a bad idea. That's why your broker ran out of memory 
and crashed rather than paging messages to disk.

See http://www.rabbitmq.com/memory.html for more info.


Matthias.

From gabrieladgeg at gmail.com  Wed Dec  7 10:34:40 2011
From: gabrieladgeg at gmail.com (gabriel adgeg)
Date: Wed, 7 Dec 2011 11:34:40 +0100
Subject: [rabbitmq-discuss] pika raise NotImplementedError
In-Reply-To: <4C9C4E5DD67B4629BB27925DFF555006@myyearbook.com>
References: <CAE+5KB3Xo+o+s_YXMTkhjhswPrLJAagroBB3NYGf-rn1p5uaOg@mail.gmail.com>
	<533AD12F485046118FB6A61F924EAB2C@myyearbook.com>
	<CAE+5KB2RAyRjK4D-BV-S7M6ibNnyf6sMMmmtC-wcEcUNA40coA@mail.gmail.com>
	<4C9C4E5DD67B4629BB27925DFF555006@myyearbook.com>
Message-ID: <CAE+5KB3u4yw8+MNb40f-3YSJYngtkkjy58A=twLmEa17E2wYHw@mail.gmail.com>

Hello Gavin,

I was wrong: contrary to what I thought I was doing, I was still using the
same SelectConnection and the channel in two different threads...
Finally, I have decided to replace the SelectConnection with a
BlockingConnection, and to do all within a single thread.
Now, the error isn't raised anymore.

Thanks a lot,

Gabriel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111207/865c1513/attachment.htm>

From majek04 at gmail.com  Wed Dec  7 10:44:19 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 7 Dec 2011 10:44:19 +0000
Subject: [rabbitmq-discuss] why run cpu_sup?
In-Reply-To: <jblk1p$q3s$1@dough.gmane.org>
References: <jblk1p$q3s$1@dough.gmane.org>
Message-ID: <CABzX+qx=8gWJY_kgL6Eoi30EM1PZdACZ-_N_BSdFRGhg4Bz50A@mail.gmail.com>

On Tue, Dec 6, 2011 at 17:40, Jason Lunz <jason.lunz at gmail.com> wrote:
> It appears from some searching that the rabbitmq startup script has been
> invoking start_cpu_sup=true for a long time. But I can't find anywhere
> where rabbitmq is using the data it gathers. Perhaps that should be
> disabled just to have one less process hanging around?

In rabbitmq 2.0.0 and before it was used to make sure that load is
evenly distributed between nodes in a cluster.

Check out src/rabbit_load.erl in rabbitmq 2.0.0:

local_load() ->
    LoadAvg = case whereis(cpu_sup) of
                  undefined -> unknown;
                  _         -> case cpu_sup:avg1() of
                                   L when is_integer(L) -> L;
                                   {error, timeout}     -> unknown
                               end
              end,
    {{statistics(run_queue), LoadAvg}, node()}.


But this code seems to be removed in 2.2.0 and later, so running
cpu_sup may not be necessary now indeed.

Cheers,
  Marek

From emile at rabbitmq.com  Wed Dec  7 11:47:31 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 07 Dec 2011 11:47:31 +0000
Subject: [rabbitmq-discuss] auto-delete exchange kills connections on
 consumer close?
In-Reply-To: <23512495.56.1323151241691.JavaMail.geo-discussion-forums@prnx7>
References: <23512495.56.1323151241691.JavaMail.geo-discussion-forums@prnx7>
Message-ID: <4EDF5253.4020405@rabbitmq.com>

Hi Keith,

On 06/12/11 06:00, Keith Irwin wrote:
> Folks--
> 
> I'm using RabbitMQ (2.7.0 all around + java with Clojure) to send small
> little status messages around here and there. It works great for that.
> Because I don't care if these messages get dropped if, say, RabbitMQ
> goes down, or if some client messes up here or there, I want to keep
> everything temporary. When all the clients are stopped, I'm thinking,
> RabbitMQ should be back to its default state.
> 
> So, when I use exchangeDeclare, I set auto-delete for the exchange to
> true. Here are my expectations:
> 
>  - When there are no more clients consuming or publishing to that
> particular exchange, it'll disappear.

Your description applies better to queues than exchanges. When the last
client consuming from an auto-delete *queue* unsubscribes, the queue
auto-deletes.

An auto-delete exchange self-destructs when the last binding is removed.
(If you are using exchange-to-exchange bindings then the exchange must
be the source.) The binding might be removed as the result of an
auto-delete queue disappearing, which in turn might happen as the result
of a consumer unsubscribing, but that is incidental.

Remember that consumers don't consume from an exchange directly.

> What ACTUALLY happens is that when the first user of that exchange is
> closed (by calling close on a channel), the exchange is deleted, and all
> other users of that exchange get disconnected.

As described earlier, a subscriber that unsubscribes can cause a cascade
of auto-deletions to occur that removes an exchange. Publishers that
attempt to publish to an absent exchange will then fail. Is this what is
happening?

> Is this a bug?

If my interpretation is correct then no.

> Should you always set autoDelete to false if there is ever going to be
> more than one client using an exchange? And isn't there always going to
> be another client using that exchange given there's no point in using an
> MQ system otherwise?

Don't use auto-delete exchanges if you will have more than one publisher
for that exchange. There are use-cases where an exchange has a single
publisher.

Also consider whether the default exchange is sufficient for your needs.



-Emile

From steve at rabbitmq.com  Wed Dec  7 12:27:28 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 7 Dec 2011 12:27:28 +0000
Subject: [rabbitmq-discuss] A different Processing error in logs
In-Reply-To: <4EDEC216.6000408@strategicdata.com.au>
References: <4EDEB985.4010404@strategicdata.com.au>
	<4EDEC216.6000408@strategicdata.com.au>
Message-ID: <19B8A7C8-B171-4EE4-95CF-E2599F25CAB5@rabbitmq.com>

Dear Toby,

Thank you for that description. I will attempt to reproduce this locally.  At
first glance it appears that the reception of messages after UNSUBSCRIBE is
counter-intuitive, and the interference with the second queue sounds suspicious.

Could we see some of your code, please, or could you break this down into a
series of STOMP frames, so we can see what the parameters are?  A trace of the
STOMP frames would be best of all.

Some questions:

Are the subscriber and sender the same process?
Can you say exactly what type of queue you create/subscribe to?
In 2) is it necessary to SEND more than 2 messages?
In 3) how do you manage the connection when you stop reading it to unsubscribe?
Do you need to unsubscribe before ack to get the problem in 6?
In 6) is the SEND from the same process again?

If possible, a failing code sample would be helpful.

One of the trials I would perform is to try sending on queue 2 after every
interaction with queue 1.  Of course, that may make it necessary to field
messages from the second subscription at the same time.

I'll keep you informed about my progress.

Steve Powell  (a working bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 7 Dec 2011, at 01:32, Toby Corkindale wrote:
> This feels like a RabbitMQ or STOMP bug to me, but here's some more info on
> what causes it to occur so you can decide.
> 
> 1) Create two queues, with ack=client, subscribe to both, using STOMP.
> 2) Dump a bunch of messages into first queue.
> 3) Upon receiving one message, unsubscribe from the first queue only, and
>    then ack the message.
> 4) Note that you still get delivered some more messages from that first
>    queue.
> 5) Attempt to send a client ACK back for one of these messages, which seems
>    to work fine.
> 6) Now attempt to send another message through on the second
>    (still-subscribed) queue -- rabbitmq generates the Processing Error.
> 

From steve at rabbitmq.com  Wed Dec  7 15:07:53 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 7 Dec 2011 15:07:53 +0000
Subject: [rabbitmq-discuss] Cleaning up temp-queues in long-running
	processes
In-Reply-To: <4EDEAEE4.7080301@strategicdata.com.au>
References: <4EDEAEE4.7080301@strategicdata.com.au>
Message-ID: <8C211326-1C28-4F11-993F-CE3336E6D06F@rabbitmq.com>

Toby,
I guess this a STOMP question again. Please correct me if I'm wrong.

I assume you are using /temp-queue/<name> destinations on the reply-to header
on a SEND frame.

You are correct in that a temporary reply-to queue is created 'auto-delete'
with an automatic (hidden) subscription; so the queue will be retained until
the end of the session:  there is no way to remove that subscription (but
see below).

However, the bug that you cannot re-use the reply-to queue is now fixed and
will be in the upcoming release.

We also have a bug 'on the books' that will expose the 'id' of the
hidden subscription, in case the user wishes to UNSUBSCRIBE from it.  I'm
not certain when this will be fixed, however.  Since its main use would be
to work-around the other problem it is not guaranteed to be in the next release.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 7 Dec 2011, at 00:10, Toby Corkindale wrote:

> If I use the /temp-queue/ methods to create temporary queues, I see that
> they remain in existence until the process disconnects from the RMQ broker.
> 
> If you're using these for RPC on a long-running process, you soon have
> huge numbers of queues on the broker.
> 
> Is there a way to remove them once you're done?
> 
> I tried UNSUBSCRIBE on them, but that didn't seem to work. (I don't have
> a subscription id)
> 
> The problem is compounded by the bug with re-using the temp-queues. Because
> you need to use a unique name each time, every RPC call has to create a new
> temp queue, rather than being able to reuse the same call for at least the
> same methods.

From jason.lunz at gmail.com  Wed Dec  7 17:33:43 2011
From: jason.lunz at gmail.com (Jason Lunz)
Date: Wed, 7 Dec 2011 17:33:43 +0000 (UTC)
Subject: [rabbitmq-discuss] why run cpu_sup?
References: <jblk1p$q3s$1@dough.gmane.org>
	<CABzX+qx=8gWJY_kgL6Eoi30EM1PZdACZ-_N_BSdFRGhg4Bz50A@mail.gmail.com>
Message-ID: <jbo81m$dv2$1@dough.gmane.org>

majek04 said:
> In rabbitmq 2.0.0 and before it was used to make sure that load is
> evenly distributed between nodes in a cluster.
>
> Check out src/rabbit_load.erl in rabbitmq 2.0.0:
>
> local_load() ->
>     LoadAvg = case whereis(cpu_sup) of
>                   undefined -> unknown;
>                   _         -> case cpu_sup:avg1() of
>                                    L when is_integer(L) -> L;
>                                    {error, timeout}     -> unknown
>                                end
>               end,
>     {{statistics(run_queue), LoadAvg}, node()}.
>
>
> But this code seems to be removed in 2.2.0 and later, so running
> cpu_sup may not be necessary now indeed.

Ah, you're right. And the only other use of os_mon in current hg is in
get_total_memory(), but only for windows. If not for that, os_mon could
be disabled entirely.

Jason


From michael.s.klishin at gmail.com  Wed Dec  7 19:06:19 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 7 Dec 2011 23:06:19 +0400
Subject: [rabbitmq-discuss] Java client test suite fails on master
Message-ID: <6680B3BD-7258-4580-871F-D79E2C6F7CB9@gmail.com>

I am looking at what has changed between 2.4 and master in the Java client and noticed that at least on master, full RabbitMQ Java client has two failures and this has been the case for over a week now:

https://gist.github.com/34258c271805b0593c7e

I can reproduce it 100% of the time with RabbitMQ 2.7.0 running on localhost, on two machines (OS X and Debian).
Build output does not provide much information about what tests are failing but I will be happy to dig in and give more feedback if this is a problem specific to my environments.

Thank you.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From jerryk at vmware.com  Wed Dec  7 19:13:02 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 7 Dec 2011 11:13:02 -0800 (PST)
Subject: [rabbitmq-discuss] Java client test suite fails on master
In-Reply-To: <6680B3BD-7258-4580-871F-D79E2C6F7CB9@gmail.com>
Message-ID: <cd4696a8-b65e-4527-a072-d9fbaf576a3f@StrongMad.local>

Hi, Michael...  

Can you poke into your build directory for your Java client and snag the output 
from files like:

build/TEST-com.rabbitmq.client.test.functional.FunctionalTests.txt

to see what's actually failing.  I've been seeing a few errors lately when
building from the tips of our Hg repo but assumed they were just slight
divergences between Java client and broker versions...

Jerry

----- Original Message -----
From: "Michael Klishin" <michael.s.klishin at gmail.com>
To: "Rabbit-Mq Discuss-Mailing List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, December 7, 2011 11:06:19 AM
Subject: [rabbitmq-discuss] Java client test suite fails on master

I am looking at what has changed between 2.4 and master in the Java client and noticed that at least on master, full RabbitMQ Java client has two failures and this has been the case for over a week now:

https://gist.github.com/34258c271805b0593c7e

I can reproduce it 100% of the time with RabbitMQ 2.7.0 running on localhost, on two machines (OS X and Debian).
Build output does not provide much information about what tests are failing but I will be happy to dig in and give more feedback if this is a problem specific to my environments.

Thank you.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Wed Dec  7 19:21:53 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 7 Dec 2011 23:21:53 +0400
Subject: [rabbitmq-discuss] Java client test suite fails on master
In-Reply-To: <cd4696a8-b65e-4527-a072-d9fbaf576a3f@StrongMad.local>
References: <cd4696a8-b65e-4527-a072-d9fbaf576a3f@StrongMad.local>
Message-ID: <6DC7C02E-F685-432F-AA67-80E1C9F63C10@gmail.com>

Le 07/dic/2011 ? 23:13, Jerry Kuch a ?crit :

> Can you poke into your build directory for your Java client and snag the output 
> from files like:
> 
> build/TEST-com.rabbitmq.client.test.functional.FunctionalTests.txt

Jerry,

Thank you, here is what I have:
https://gist.github.com/1444204

I cannot immediately tell what 541 reply code is but looks like a broker issue. RabbitMQ log suggests the same:
https://gist.github.com/1444212

Let me know if I can provide more information.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From mradestock at vmware.com  Wed Dec  7 19:29:24 2011
From: mradestock at vmware.com (Matthias Radestock)
Date: Wed, 07 Dec 2011 19:29:24 +0000
Subject: [rabbitmq-discuss] Java client test suite fails on master
In-Reply-To: <6DC7C02E-F685-432F-AA67-80E1C9F63C10@gmail.com>
References: <cd4696a8-b65e-4527-a072-d9fbaf576a3f@StrongMad.local>
	<6DC7C02E-F685-432F-AA67-80E1C9F63C10@gmail.com>
Message-ID: <4EDFBE94.7090008@vmware.com>

Michael,

On 07/12/11 19:21, Michael Klishin wrote:
> Thank you, here is what I have:
> https://gist.github.com/1444204
>
> I cannot immediately tell what 541 reply code is but looks like a broker issue. RabbitMQ log suggests the same:
> https://gist.github.com/1444212

Ah yes. There is a new test for a bug we recently found (and fixed) in 
the server. So you'll need the latest tip-of-default version of the 
server for the tests to pass.

Matthias.

From michael.s.klishin at gmail.com  Wed Dec  7 19:49:40 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 7 Dec 2011 23:49:40 +0400
Subject: [rabbitmq-discuss] Java client test suite fails on master
In-Reply-To: <4EDFBE94.7090008@vmware.com>
References: <cd4696a8-b65e-4527-a072-d9fbaf576a3f@StrongMad.local>
	<6DC7C02E-F685-432F-AA67-80E1C9F63C10@gmail.com>
	<4EDFBE94.7090008@vmware.com>
Message-ID: <92CD399B-2DF3-480B-8636-DC334DB3B112@gmail.com>

Le 07/dic/2011 ? 23:29, Matthias Radestock a ?crit :

> Ah yes. There is a new test for a bug we recently found (and fixed) in the server. So you'll need the latest tip-of-default version of the server for the tests to pass.

I confirm, building tip-of-default rabbitmq server makes Java client tests pass.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From toby.corkindale at strategicdata.com.au  Wed Dec  7 23:44:03 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 08 Dec 2011 10:44:03 +1100
Subject: [rabbitmq-discuss] Cleaning up temp-queues in long-running
	processes
In-Reply-To: <8C211326-1C28-4F11-993F-CE3336E6D06F@rabbitmq.com>
References: <4EDEAEE4.7080301@strategicdata.com.au>
	<8C211326-1C28-4F11-993F-CE3336E6D06F@rabbitmq.com>
Message-ID: <4EDFFA43.90804@strategicdata.com.au>

On 08/12/11 02:07, Steve Powell wrote:
> Toby,
> I guess this a STOMP question again. Please correct me if I'm wrong.

It's STOMP, yes.
I explored using AMQP from Perl, but the only libraries available all 
had issues of one sort or another :(

> I assume you are using /temp-queue/<name>  destinations on the reply-to header
> on a SEND frame.

Correct.

> You are correct in that a temporary reply-to queue is created 'auto-delete'
> with an automatic (hidden) subscription; so the queue will be retained until
> the end of the session:  there is no way to remove that subscription (but
> see below).

OK, thanks for clarifying that.

> However, the bug that you cannot re-use the reply-to queue is now fixed and
> will be in the upcoming release.

Thanks, I'll look forward to it.

Thanks again for your help,
Toby

> We also have a bug 'on the books' that will expose the 'id' of the
> hidden subscription, in case the user wishes to UNSUBSCRIBE from it.  I'm
> not certain when this will be fixed, however.  Since its main use would be
> to work-around the other problem it is not guaranteed to be in the next release.
>
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 7 Dec 2011, at 00:10, Toby Corkindale wrote:
>
>> If I use the /temp-queue/ methods to create temporary queues, I see that
>> they remain in existence until the process disconnects from the RMQ broker.
>>
>> If you're using these for RPC on a long-running process, you soon have
>> huge numbers of queues on the broker.
>>
>> Is there a way to remove them once you're done?
>>
>> I tried UNSUBSCRIBE on them, but that didn't seem to work. (I don't have
>> a subscription id)
>>
>> The problem is compounded by the bug with re-using the temp-queues. Because
>> you need to use a unique name each time, every RPC call has to create a new
>> temp queue, rather than being able to reuse the same call for at least the
>> same methods.


-- 
.signature

From toby.corkindale at strategicdata.com.au  Thu Dec  8 01:09:15 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 08 Dec 2011 12:09:15 +1100
Subject: [rabbitmq-discuss] A different Processing error in logs
In-Reply-To: <19B8A7C8-B171-4EE4-95CF-E2599F25CAB5@rabbitmq.com>
References: <4EDEB985.4010404@strategicdata.com.au>
	<4EDEC216.6000408@strategicdata.com.au>
	<19B8A7C8-B171-4EE4-95CF-E2599F25CAB5@rabbitmq.com>
Message-ID: <4EE00E3B.5090300@strategicdata.com.au>

On 07/12/11 23:27, Steve Powell wrote:
> Dear Toby,
>
> Thank you for that description. I will attempt to reproduce this locally.  At
> first glance it appears that the reception of messages after UNSUBSCRIBE is
> counter-intuitive, and the interference with the second queue sounds suspicious.
>
> Could we see some of your code, please, or could you break this down into a
> series of STOMP frames, so we can see what the parameters are?  A trace of the
> STOMP frames would be best of all.

I've created a stand-alone script that demonstrates the issue occurring; 
it's in Perl, I hope that's OK?
(Edit: Two scripts containing two variants)

> Some questions:
>
> Are the subscriber and sender the same process?

In this demo, I'm subscribing to the queues, then sending a few messages 
to them, then waiting for frames to arrive -- all in the same script. 
However the original issue occurred with a script starting up and 
listening to queues that then received a few messages from another process.

> Can you say exactly what type of queue you create/subscribe to?

The demo is using STOMP queues, "/queue/test1" and "/queue/test2" - so 
fairly ordinary ones.

> In 2) is it necessary to SEND more than 2 messages?

Nah, seems like I can break it with two messages to a single queue even!
1) send to queue
2) send to queue
3) receive from queue, send ack, unsubscribe from queue
4) receive from queue (despite unsub), send ack -- crash

> In 3) how do you manage the connection when you stop reading it to unsubscribe?

In the real world code, it's a shared connection with several 
subscriptions - i'm only subscribing from a single one, so the 
connection stays open.

> Do you need to unsubscribe before ack to get the problem in 6?

Hmm, just checked, and I'm calling the ack *before* the unsubscribe.

> In 6) is the SEND from the same process again?

Doesn't seem to matter.


> If possible, a failing code sample would be helpful.


Two code samples are attached.
"minimal_demo.pl" seems to contain the bare minimum to cause the 
processing error to occur.

The other script is a bit more involved and closer resembles the 
original problem description - it also allows you to play around with 
options and message ordering a bit more.


PS. Despite all the messages I seem to send through to the list about 
one issue or another, I must say that I'm impressed with RabbitMQ, and 
that's it's working nicely with a couple of applications here.

We've learnt to use STOMP /topic/ queues with unique routing keys, 
rather than temp-queues, at least for the time being.
Also we create queues using the management JSON API and then use 
/amq/queue/ queues for certain queues that need more options than STOMP 
allows you to set.

Thanks again,
Toby


> One of the trials I would perform is to try sending on queue 2 after every
> interaction with queue 1.  Of course, that may make it necessary to field
> messages from the second subscription at the same time.
>
> I'll keep you informed about my progress.
>
> Steve Powell  (a working bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 7 Dec 2011, at 01:32, Toby Corkindale wrote:
>> This feels like a RabbitMQ or STOMP bug to me, but here's some more info on
>> what causes it to occur so you can decide.
>>
>> 1) Create two queues, with ack=client, subscribe to both, using STOMP.
>> 2) Dump a bunch of messages into first queue.
>> 3) Upon receiving one message, unsubscribe from the first queue only, and
>>     then ack the message.
>> 4) Note that you still get delivered some more messages from that first
>>     queue.
>> 5) Attempt to send a client ACK back for one of these messages, which seems
>>     to work fine.
>> 6) Now attempt to send another message through on the second
>>     (still-subscribed) queue -- rabbitmq generates the Processing Error.
>>


-- 
.signature
-------------- next part --------------
A non-text attachment was scrubbed...
Name: minimal_demo.pl
Type: application/x-perl
Size: 1214 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111208/c1a2de16/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: more_involved_demo.pl
Type: application/x-perl
Size: 1953 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111208/c1a2de16/attachment-0001.bin>

From mickdelaney at gmail.com  Thu Dec  8 08:11:25 2011
From: mickdelaney at gmail.com (Michael Delaney)
Date: Thu, 8 Dec 2011 00:11:25 -0800 (PST)
Subject: [rabbitmq-discuss] Clustering On EC2
Message-ID: <32642325.2073.1323331885802.JavaMail.geo-discussion-forums@yqfd21>

Hi,

I'm fairly new to rabbitmq, and am currently looking to deploy onto ec2. 
But i've struggled when it comes to networking. 
I'm trying to create a cluster, and on ec2 given the dynamic nature of IP 
addresses using the FQDN's of servers would be 
the most effective way of identifying cluster machines.

But am I right in saying the only solution is to use short names, in effect 
using the hosts file on the actual cluster
machines to identify each other? 

In my naive thinking I would have assumed supporting FQDN's to be straight 
forward, they all resolve to ip's right?
I understand this is an erlang thing not specifically rabbit, but does 
anyone know of a plugin or patch or whatever
that could allow this? 

Or any other successful clustering strategy on ec2?

Thanks. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111208/b6a9222c/attachment.htm>

From matthias at rabbitmq.com  Thu Dec  8 11:14:08 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 08 Dec 2011 11:14:08 +0000
Subject: [rabbitmq-discuss] HA queue in cluster mode
In-Reply-To: <8706360947A56E45B1418C635D3659640229C4D9FC17@NDA-HCLT-EVS04.HCLT.CORP.HCL.IN>
References: <8706360947A56E45B1418C635D3659640229C4D9FC17@NDA-HCLT-EVS04.HCLT.CORP.HCL.IN>
Message-ID: <4EE09C00.2070704@rabbitmq.com>

Guarav,

On 04/12/11 14:47, Gaurav Shukla wrote:
> I have setup a cluster. Rabbit1@ qdcls1161 and rabbit2@ qdcls1162. Also
> rabbit1 and 2 are in cluster. Still when I have rabbit 1 down, the
> cluster seems to be not working.

In what way is it "not working"?

> I read about HA queues, but do not know how to configure them and
> put  into use in cluster mode.

http://www.rabbitmq.com/ha.html#genesis

Regards,

Matthias.

From steve at rabbitmq.com  Thu Dec  8 11:44:07 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 8 Dec 2011 11:44:07 +0000
Subject: [rabbitmq-discuss] using client from different threads
In-Reply-To: <CALbPevkPK=CSoAkMgQvqtGF55JdymUWSC6K4WErTagL-=q7Ksg@mail.gmail.com>
References: <CAJ2-VrkPKXu+vmv6B+ynb0_RhqDzS7s0xbDy4JzvRFOPFBV2Bw@mail.gmail.com>
	<A1EE3FAD-537B-4261-99A4-C4C95FF48734@rabbitmq.com>
	<CALbPevntvgkEwo4=TKwDnk_3O1gkLfS5OBfm7cW6qAsik62zkg@mail.gmail.com>
	<2BED9BD2-55CA-49AE-B40C-967DEC7973F7@rabbitmq.com>
	<CALbPev=mJw7Q6JxLZus6kR5in5UiHvh24D=PqKBggxfud+F4Og@mail.gmail.com>
	<0C6DF4F4-01ED-43BF-87F5-347F8A8F5143@rabbitmq.com>
	<CALbPevkPK=CSoAkMgQvqtGF55JdymUWSC6K4WErTagL-=q7Ksg@mail.gmail.com>
Message-ID: <0809C8D5-36BA-48BA-9F37-48CD0D6796A4@rabbitmq.com>

Dear John,

On 5 Dec 2011, at 18:15, john doe wrote:
> In my implementation, this criteria is simply an "expected number of
> responses".
> . . .
> This looks a little weird, but it allows me not to manage future and
> completion services in the sender.

And I agree; it is weird.  [One point: your caller has to know how many
'shards' there are, and also presumes they all respond properly.]

>> what criteria you use for deciding you've had enough replies
>> and how to 'package' them up as a single response to the original request is
>> very application-specific, I think.

And so it proves.  I can't see us supporting this sort of protocol out of the
box; you should have no difficulty in adding your particular behaviour upon
the primitive RPC, though (once we have enhanced it a bit).

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.


From ask at rabbitmq.com  Thu Dec  8 12:11:29 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 8 Dec 2011 12:11:29 +0000
Subject: [rabbitmq-discuss] Using RabbitMQ for desktop-style messaging
	in a web app
In-Reply-To: <CAKhN_m4nV1moQunUXPpPi9O+mNOMZhC_9JaVuFq7EVMPen1CTA@mail.gmail.com>
References: <CAKhN_m4nV1moQunUXPpPi9O+mNOMZhC_9JaVuFq7EVMPen1CTA@mail.gmail.com>
Message-ID: <7FFE5AC1-969D-4611-875F-9A322D956495@rabbitmq.com>


On 6 Dec 2011, at 05:04, Bill Moseley wrote:

> We have a lot of background processing that happens in a web app and investigating ways to message users when a background task is complete.  I'm wondering if anyone is using RabbitMQ for something like this and can describe their architecture.
> 
> We might have 20K concurrent users "logged in" at any given time.  Some background tasks are important and the user must be notified, and for those we use the database.  But, there's a number of other tasks that user can trigger where it's not critical that the user is notified, but would be nice to see.  These would be very similar to "you have new mail" in a mail client, for example.

As I see it you have two major options,

1) Use reply-to queues and have the clients browser be a consumer,
using something like amqp-js, Comet, websockets or polling.

  This would be rather experimental, hic sunt dracones.

2) Have the background tasks write notifications to the database,
   which the browsers poll using XMLHttpRequests (or Comet/websockets).


Reply queues may not work well in a web context: the browsers/backend
must be actively consuming to receive the messages, and since the web is stateless
and connections are unreliable it may only be suitable if losing a notification
here and then is acceptable.

You can do like Celery's "amqp result backend" and use a unique id for every
background task, and declare one "result" queue for every task: once when
you publish the task, and then later when you start consuming the result.
That way the browsers query the results using the id, and the messages
will be delivered.  The problem with this approach is that you can end
up with a lot of queues, which can be remedied somewhat by using the x-expires
argument to queue_declare.  (also if you have multiple processes
waiting for the same result, it will only be delivered once, if this is a
problem you can republish the result once you receive it, though this may be prone
to race conditions).

I would go for option 2.


> 
> Questions that have come up is should message queues be session based or user based -- that is if you log into the web app with two browsers (or on two machines) would messages be broadcasted to all sessions for a give user or be session-specific, and how to deal with the non-persistent connections in web apps.
> 
>  Anyone using RabbitMQ for this type of application?
> 

From wojciech.durczynski at comarch.com  Thu Dec  8 14:34:24 2011
From: wojciech.durczynski at comarch.com (=?UTF-8?Q?Wojciech_Durczy=C5=84ski?=)
Date: Thu, 8 Dec 2011 06:34:24 -0800 (PST)
Subject: [rabbitmq-discuss] Bug with consistent hash exchange.
Message-ID: <392198.442.1323354864283.JavaMail.geo-discussion-forums@yqjw36>

Hello. 

I encountered bug in consistent-hash-exchange used in exchange-exchange 
routing.
Let's consider following routing:

exchange A of type topic
exchange B of type consistent-hash-exchange
exchange C of type consistent-hash-exchange

binding A -> B with routing key "b.#"
binding A -> C with routing key "c.#"

If there are queues bound to exchanges B and C, everything works as 
expected.

If there aren't queues bound to C, but there are queues bound to B then 
message with routing key "c.x" sent to exchange A is routed to one of the 
B's queues. It should be discarded instead or cause NO-ROUTE or 
NO_CONSUMERS (message flag dependent).

Regards
Wojciech Durczy?ski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111208/8c117216/attachment.htm>

From matthew at rabbitmq.com  Thu Dec  8 15:02:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Dec 2011 15:02:10 +0000
Subject: [rabbitmq-discuss] Bug with consistent hash exchange.
In-Reply-To: <392198.442.1323354864283.JavaMail.geo-discussion-forums@yqjw36>
References: <392198.442.1323354864283.JavaMail.geo-discussion-forums@yqjw36>
Message-ID: <20111208150210.GA19719@rabbitmq.com>

On Thu, Dec 08, 2011 at 06:34:24AM -0800, Wojciech Durczy?ski wrote:
> Let's consider following routing:
> 
> exchange A of type topic
> exchange B of type consistent-hash-exchange
> exchange C of type consistent-hash-exchange
> 
> binding A -> B with routing key "b.#"
> binding A -> C with routing key "c.#"
> 
> If there are queues bound to exchanges B and C, everything works as 
> expected.
> 
> If there aren't queues bound to C, but there are queues bound to B then 
> message with routing key "c.x" sent to exchange A is routed to one of the 
> B's queues. It should be discarded instead or cause NO-ROUTE or 
> NO_CONSUMERS (message flag dependent).

Agreed. I've just knocked up the following test, and you're right. It's
clearly wrong. Sorry about that. I'll get it fixed and it should be in
the next release.

-module(test).
-compile([export_all]).

-include_lib("amqp_client/include/amqp_client.hrl").

test_consistent_hash() ->
    A = <<"A">>, B = <<"B">>, C = <<"C">>, Q = <<"my_queue">>,
    {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
    {ok, Chan} = amqp_connection:open_channel(Conn),
    #'queue.declare_ok' {} = amqp_channel:call(Chan, #'queue.declare'{ queue = Q }),
    #'exchange.declare_ok'{} =
        amqp_channel:call(
          Chan, #'exchange.declare'{ exchange = A, type = <<"topic">> }),
    #'exchange.declare_ok'{} =
        amqp_channel:call(
          Chan, #'exchange.declare'{ exchange = B, type = <<"x-consistent-hash">> }),
    #'exchange.declare_ok'{} =
        amqp_channel:call(
          Chan, #'exchange.declare'{ exchange = C, type = <<"x-consistent-hash">> }),
    #'exchange.bind_ok'{} = amqp_channel:call(
                              Chan, #'exchange.bind'{ source = A, destination = B,
                                                      routing_key = <<"b.#">> }),
    #'exchange.bind_ok'{} = amqp_channel:call(
                              Chan, #'exchange.bind'{ source = A, destination = C,
                                                      routing_key = <<"c.#">> }),
    #'queue.bind_ok'{} = amqp_channel:call(
                           Chan, #'queue.bind'{ queue = Q, exchange = B,
                                                routing_key = <<"10">> }),
    Msg = #amqp_msg { props = #'P_basic'{}, payload = <<"hello">> },
    Publish = #'basic.publish'{ routing_key = <<"c.foo">>, exchange = A },
    amqp_channel:call(Chan, Publish, Msg),
    timer:sleep(1000),
    io:format("~p~n", [amqp_channel:call(Chan, #'queue.declare'{ queue = Q })]),
    amqp_connection:close(Conn).

Matthew

From wojciech.durczynski at comarch.com  Thu Dec  8 15:22:04 2011
From: wojciech.durczynski at comarch.com (=?UTF-8?Q?Wojciech_Durczy=C5=84ski?=)
Date: Thu, 8 Dec 2011 07:22:04 -0800 (PST)
Subject: [rabbitmq-discuss] Bug with consistent hash exchange.
In-Reply-To: <20111208150210.GA19719@rabbitmq.com>
References: <392198.442.1323354864283.JavaMail.geo-discussion-forums@yqjw36>
	<20111208150210.GA19719@rabbitmq.com>
Message-ID: <5010920.495.1323357724447.JavaMail.geo-discussion-forums@vbbeq1>

Could you provide a quick patch for this bug?
I'd be very grateful for 
modified rabbitmq_consistent_hash_exchange-2.7.0.ez file.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111208/37677cf3/attachment.htm>

From matthew at rabbitmq.com  Thu Dec  8 15:28:27 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Dec 2011 15:28:27 +0000
Subject: [rabbitmq-discuss] Bug with consistent hash exchange.
In-Reply-To: <20111208150210.GA19719@rabbitmq.com>
References: <392198.442.1323354864283.JavaMail.geo-discussion-forums@yqjw36>
	<20111208150210.GA19719@rabbitmq.com>
Message-ID: <20111208152827.GB19719@rabbitmq.com>

On Thu, Dec 08, 2011 at 03:02:10PM +0000, Matthew Sackman wrote:
> Agreed. I've just knocked up the following test, and you're right. It's
> clearly wrong. Sorry about that. I'll get it fixed and it should be in
> the next release.

Fixed. The fix is at
http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/rev/5531ff99f00f

If you're happy compiling from source then just
pulling/updating/compiling will do the trick, otherwise, I hear the next
release may not be too long away (though in Rabbit terms, that can be
anything from days to months), so you might prefer to wait for that.

Thanks for the report.

Matthew

From tqxtqx at gmail.com  Fri Dec  9 06:46:19 2011
From: tqxtqx at gmail.com (tang qingxiong)
Date: Fri, 9 Dec 2011 14:46:19 +0800
Subject: [rabbitmq-discuss] Need some help on C++ client receive code
Message-ID: <CANJ_2Y7WhcxmTNG16uPxv8CWFhv8TqB31pV05uupgyC=5yPaLw@mail.gmail.com>

Below is a code snippet of my receiving code

      amqp_frame_t frame;
      amqp_maybe_release_buffers(myConnection);
      int result = amqp_simple_wait_frame(myConnection, &frame);

      if (result < 0)
      {
        return -1;
      }
      if (frame.frame_type != AMQP_FRAME_METHOD)
      {
        return 0;
      }
      if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
      {
        return 0;
      }
      result = amqp_simple_wait_frame(myConnection, &frame);

      if (result < 0)
      {
        return -1;
      }
      if (frame.frame_type != AMQP_FRAME_HEADER)
      {
        abort();
      }
      uint64_t target = frame.payload.properties.body_size;
      uint64_t received = 0;
      while (received < target)
      {
        result = amqp_simple_wait_frame(myConnection, &frame);
        if (result < 0)
        {
          return -1;
        }
        if (frame.frame_type != AMQP_FRAME_BODY)
        {
          abort();
        }
        received += frame.payload.body_fragment.len;
      }

       char* recvBuffer =new char[RABBIT_BUFFER_SIZE];
       memcpy(recvBuffer, frame.payload.body_fragment.bytes,
frame.payload.body_fragment.len);
int framesize =frame.payload.body_fragment.len;


This code is adapted from the C client example and it is running mostly
fine. However after running it on my server for 19 hours, it crashes. After
tracing. it shows that

frame.payload.body_fragment.len is only 23 while received is over 10k. Am I
doing something wrong? The assumption that I made after looking at the code
is that frame is == message. If it is not , how could I received the entire
message before processing?

Regards,
QX
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/34ebf992/attachment.htm>

From vbernard42 at gmail.com  Fri Dec  9 08:52:08 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Fri, 9 Dec 2011 00:52:08 -0800 (PST)
Subject: [rabbitmq-discuss] Need some help on C++ client receive code
In-Reply-To: <CANJ_2Y7WhcxmTNG16uPxv8CWFhv8TqB31pV05uupgyC=5yPaLw@mail.gmail.com>
References: <CANJ_2Y7WhcxmTNG16uPxv8CWFhv8TqB31pV05uupgyC=5yPaLw@mail.gmail.com>
Message-ID: <c71bf1f5-81f6-45cd-82c2-442f177096e4@o9g2000vbc.googlegroups.com>

Hi,

I don't really understand how your code snippet reassembles the
message frames. I think you're only storing the content of the last
received frame here. Here is my receiving code (for frames 3+):

(...)

size_t bodySize = (size_t) frame.payload.properties.body_size;
size_t bodyReceived = 0;
amqp_bytes_t body = amqp_bytes_malloc(bodySize);

/* Frames 3+ : message content */
while (bodyReceived < bodySize) {
    int result = amqp_simple_wait_frame(connection, &frame);
    if (result < 0) {
        // error
    }

    if (frame.frame_type != AMQP_FRAME_BODY) {
        // error
    }

    memcpy((void *)((int)body.bytes + bodyReceived),
        frame.payload.body_fragment.bytes,
        frame.payload.body_fragment.len);
    bodyReceived += frame.payload.body_fragment.len;
}

// body now contains the message content

Hope that helps.

Cheers,

Valentin.

On 9 d?c, 07:46, tang qingxiong <tqx... at gmail.com> wrote:
> Below is a code snippet of my receiving code
>
> ? ? ? amqp_frame_t frame;
> ? ? ? amqp_maybe_release_buffers(myConnection);
> ? ? ? int result = amqp_simple_wait_frame(myConnection, &frame);
>
> ? ? ? if (result < 0)
> ? ? ? {
> ? ? ? ? return -1;
> ? ? ? }
> ? ? ? if (frame.frame_type != AMQP_FRAME_METHOD)
> ? ? ? {
> ? ? ? ? return 0;
> ? ? ? }
> ? ? ? if (frame.payload.method.id != AMQP_BASIC_DELIVER_METHOD)
> ? ? ? {
> ? ? ? ? return 0;
> ? ? ? }
> ? ? ? result = amqp_simple_wait_frame(myConnection, &frame);
>
> ? ? ? if (result < 0)
> ? ? ? {
> ? ? ? ? return -1;
> ? ? ? }
> ? ? ? if (frame.frame_type != AMQP_FRAME_HEADER)
> ? ? ? {
> ? ? ? ? abort();
> ? ? ? }
> ? ? ? uint64_t target = frame.payload.properties.body_size;
> ? ? ? uint64_t received = 0;
> ? ? ? while (received < target)
> ? ? ? {
> ? ? ? ? result = amqp_simple_wait_frame(myConnection, &frame);
> ? ? ? ? if (result < 0)
> ? ? ? ? {
> ? ? ? ? ? return -1;
> ? ? ? ? }
> ? ? ? ? if (frame.frame_type != AMQP_FRAME_BODY)
> ? ? ? ? {
> ? ? ? ? ? abort();
> ? ? ? ? }
> ? ? ? ? received += frame.payload.body_fragment.len;
> ? ? ? }
>
> ? ? ? ?char* recvBuffer =new char[RABBIT_BUFFER_SIZE];
> ? ? ? ?memcpy(recvBuffer, frame.payload.body_fragment.bytes,
> frame.payload.body_fragment.len);
> int framesize =frame.payload.body_fragment.len;
>
> This code is adapted from the C client example and it is running mostly
> fine. However after running it on my server for 19 hours, it crashes. After
> tracing. it shows that
>
> frame.payload.body_fragment.len is only 23 while received is over 10k. Am I
> doing something wrong? The assumption that I made after looking at the code
> is that frame is == message. If it is not , how could I received the entire
> message before processing?
>
> Regards,
> QX
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mwmorrison93 at gmail.com  Fri Dec  9 11:05:48 2011
From: mwmorrison93 at gmail.com (Michael Morrison)
Date: Fri, 9 Dec 2011 03:05:48 -0800
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
Message-ID: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>

Hello, i'm just getting started with RabbitMQ and have been reading through
the tutorials and trying to run the code samples in Python. I've installed
Pika 0.9.5 but when I run the following script, i get the error message
down below at the end of this post complaining that the 'CallbackManager'
object has no attribute 'sanitize': I'm not sure how to go about fixing
this, any help would be greatly appreciated.Thanks in advance for any
responses.

Mike

#!/usr/bin/env python
import pika

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()

channel.queue_declare(queue='hello')

print ' [*] Waiting for messages. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print " [x] Received %r" % (body,)

channel.basic_consume(callback,
                      queue='hello',
                      no_ack=True)

channel.start_consuming()

ERROR RETURNED:
Traceback (most recent call last):
  File "receive.py", line 6, in <module>
    channel = connection.channel()
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py",
line 129, in channel
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py",
line 274, in __init__
  File "build/bdist.linux-i686/egg/pika/channel.py", line 236, in open
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py",
line 254, in send_method
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py",
line 95, in process_data_events
  File "build/bdist.linux-i686/egg/pika/adapters/base_connection.py", line
315, in _handle_read
  File "build/bdist.linux-i686/egg/pika/connection.py", line 701, in
_on_data_available
  File "build/bdist.linux-i686/egg/pika/callback.py", line 161, in process
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py",
line 230, in _on_rpc_complete
AttributeError: 'CallbackManager' object has no attribute 'sanitize'
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/b62b32cb/attachment.htm>

From majek04 at gmail.com  Fri Dec  9 11:16:59 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Dec 2011 11:16:59 +0000
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
Message-ID: <CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>

On Fri, Dec 9, 2011 at 11:05, Michael Morrison <mwmorrison93 at gmail.com> wrote:
> Hello, i'm just getting started with RabbitMQ and have been reading through
> the tutorials and trying to run the code samples in Python. I've installed
> Pika 0.9.5 but when I run the following script, i get the error message down
> below at the end of this post complaining that the 'CallbackManager' object
> has no attribute 'sanitize': I'm not sure how to go about fixing this, any
> help would be greatly appreciated.Thanks in advance for any responses.

Are you absolutely positive that you installed pika 0.9.5?

You might need to install it like that:
   pip install pika==0.9.5

Marek

From mwmorrison93 at gmail.com  Fri Dec  9 11:29:19 2011
From: mwmorrison93 at gmail.com (Michael Morrison)
Date: Fri, 9 Dec 2011 03:29:19 -0800
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
	<CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
Message-ID: <CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>

Hey Marek, I think so but i'm not 100% positive now. I downloaded the pika
gzip (pika-pika-v0.9.5-94-g5e3e91b.tar.gz)  from
http://pypi.python.org/pypi/pika. The link that i'm clicking on
shows pika-0.9.5.tar.gz. Here's the output that's returned after i extract
and run setup.py install...thanks for the quick response! Mike

python setup.py install
running install
running bdist_egg
running egg_info
writing pika.egg-info/PKG-INFO
writing top-level names to pika.egg-info/top_level.txt
writing dependency_links to pika.egg-info/dependency_links.txt
reading manifest file 'pika.egg-info/SOURCES.txt'
writing manifest file 'pika.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-i686/egg
running install_lib
running build_py
creating build/bdist.linux-i686/egg
creating build/bdist.linux-i686/egg/pika
copying build/lib/pika/reconnection_strategies.py ->
build/bdist.linux-i686/egg/pika
copying build/lib/pika/heartbeat.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/connection.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/spec.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/log.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/template.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/object.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/credentials.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/callback.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/utils.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/channel.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/exceptions.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/data.py -> build/bdist.linux-i686/egg/pika
creating build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/tornado_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/asyncore_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/blocking_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/twisted_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/base_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/select_connection.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/adapters/__init__.py ->
build/bdist.linux-i686/egg/pika/adapters
copying build/lib/pika/simplebuffer.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/frame.py -> build/bdist.linux-i686/egg/pika
copying build/lib/pika/__init__.py -> build/bdist.linux-i686/egg/pika
byte-compiling build/bdist.linux-i686/egg/pika/reconnection_strategies.py
to reconnection_strategies.pyc
byte-compiling build/bdist.linux-i686/egg/pika/heartbeat.py to heartbeat.pyc
byte-compiling build/bdist.linux-i686/egg/pika/connection.py to
connection.pyc
byte-compiling build/bdist.linux-i686/egg/pika/spec.py to spec.pyc
byte-compiling build/bdist.linux-i686/egg/pika/log.py to log.pyc
byte-compiling build/bdist.linux-i686/egg/pika/template.py to template.pyc
byte-compiling build/bdist.linux-i686/egg/pika/object.py to object.pyc
byte-compiling build/bdist.linux-i686/egg/pika/credentials.py to
credentials.pyc
byte-compiling build/bdist.linux-i686/egg/pika/callback.py to callback.pyc
byte-compiling build/bdist.linux-i686/egg/pika/utils.py to utils.pyc
byte-compiling build/bdist.linux-i686/egg/pika/channel.py to channel.pyc
byte-compiling build/bdist.linux-i686/egg/pika/exceptions.py to
exceptions.pyc
byte-compiling build/bdist.linux-i686/egg/pika/data.py to data.pyc
byte-compiling
build/bdist.linux-i686/egg/pika/adapters/tornado_connection.py to
tornado_connection.pyc
byte-compiling
build/bdist.linux-i686/egg/pika/adapters/asyncore_connection.py to
asyncore_connection.pyc
byte-compiling
build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py to
blocking_connection.pyc
byte-compiling
build/bdist.linux-i686/egg/pika/adapters/twisted_connection.py to
twisted_connection.pyc
byte-compiling build/bdist.linux-i686/egg/pika/adapters/base_connection.py
to base_connection.pyc
byte-compiling
build/bdist.linux-i686/egg/pika/adapters/select_connection.py to
select_connection.pyc
byte-compiling build/bdist.linux-i686/egg/pika/adapters/__init__.py to
__init__.pyc
byte-compiling build/bdist.linux-i686/egg/pika/simplebuffer.py to
simplebuffer.pyc
byte-compiling build/bdist.linux-i686/egg/pika/frame.py to frame.pyc
byte-compiling build/bdist.linux-i686/egg/pika/__init__.py to __init__.pyc
creating build/bdist.linux-i686/egg/EGG-INFO
copying pika.egg-info/PKG-INFO -> build/bdist.linux-i686/egg/EGG-INFO
copying pika.egg-info/SOURCES.txt -> build/bdist.linux-i686/egg/EGG-INFO
copying pika.egg-info/dependency_links.txt ->
build/bdist.linux-i686/egg/EGG-INFO
copying pika.egg-info/top_level.txt -> build/bdist.linux-i686/egg/EGG-INFO
copying pika.egg-info/zip-safe -> build/bdist.linux-i686/egg/EGG-INFO
creating 'dist/pika-0.9.6_pre0-py2.7.egg' and adding
'build/bdist.linux-i686/egg' to it
removing 'build/bdist.linux-i686/egg' (and everything under it)
Processing pika-0.9.6_pre0-py2.7.egg
Removing /usr/local/lib/python2.7/site-packages/pika-0.9.6_pre0-py2.7.egg
Copying pika-0.9.6_pre0-py2.7.egg to /usr/local/lib/python2.7/site-packages
pika 0.9.6-pre0 is already the active version in easy-install.pth

Installed /usr/local/lib/python2.7/site-packages/pika-0.9.6_pre0-py2.7.egg
Processing dependencies for pika==0.9.6-pre0
Finished processing dependencies for pika==0.9.6-pre0




On Fri, Dec 9, 2011 at 3:16 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Fri, Dec 9, 2011 at 11:05, Michael Morrison <mwmorrison93 at gmail.com>
> wrote:
> > Hello, i'm just getting started with RabbitMQ and have been reading
> through
> > the tutorials and trying to run the code samples in Python. I've
> installed
> > Pika 0.9.5 but when I run the following script, i get the error message
> down
> > below at the end of this post complaining that the 'CallbackManager'
> object
> > has no attribute 'sanitize': I'm not sure how to go about fixing this,
> any
> > help would be greatly appreciated.Thanks in advance for any responses.
>
> Are you absolutely positive that you installed pika 0.9.5?
>
> You might need to install it like that:
>   pip install pika==0.9.5
>
> Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/4992b326/attachment.htm>

From majek04 at gmail.com  Fri Dec  9 11:39:34 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Dec 2011 11:39:34 +0000
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
	<CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
	<CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>
Message-ID: <CABzX+qz7K=smeS0wrxkCeVjQu6rNC+SMq+PR2DQbS+Jtdnk8Tw@mail.gmail.com>

On Fri, Dec 9, 2011 at 11:29, Michael Morrison <mwmorrison93 at gmail.com> wrote:
> Hey Marek, I think so but i'm not 100% positive now. I downloaded the pika
> gzip (pika-pika-v0.9.5-94-g5e3e91b.tar.gz)
> ?from?http://pypi.python.org/pypi/pika. The link that i'm clicking on
> shows?pika-0.9.5.tar.gz. Here's the output that's returned after i extract
> and run setup.py install...thanks for the quick response! Mike
>
> Copying pika-0.9.6_pre0-py2.7.egg to /usr/local/lib/python2.7/site-packages
> pika 0.9.6-pre0 is already the active version in easy-install.pth
>
> Installed /usr/local/lib/python2.7/site-packages/pika-0.9.6_pre0-py2.7.egg
> Processing dependencies for pika==0.9.6-pre0
> Finished processing dependencies for pika==0.9.6-pre0

That looks like pika-0.9.6 :)
Try running:   pip install pika==0.9.5

Marek

From majek04 at gmail.com  Fri Dec  9 11:57:40 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Dec 2011 11:57:40 +0000
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CANGs2ytF9GjBgVgMMuPtaWdn_FRfkqKkgZV42Th_1J-Yz9osjQ@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
	<CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
	<CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>
	<CABzX+qz7K=smeS0wrxkCeVjQu6rNC+SMq+PR2DQbS+Jtdnk8Tw@mail.gmail.com>
	<CANGs2ytF9GjBgVgMMuPtaWdn_FRfkqKkgZV42Th_1J-Yz9osjQ@mail.gmail.com>
Message-ID: <CABzX+qwTvJAW8kWKiXNnK-v=+MdQ3wpxkZgeG9DQtYCubsXnvw@mail.gmail.com>

On Fri, Dec 9, 2011 at 11:48, Michael Morrison <mwmorrison93 at gmail.com> wrote:
> Thanks again, but i went and checked the setup.py file and noticed that it
> was set to install version 0.9.6_pre, i changed the value to 0.9.5 and
> reinstalled. I removed the 0.9.6 packages but i'm still getting the same
> error. Here's the output of the last install that i just ran. Really
> appreciate the help!

Altering the number in `setup.py` won't solve the problem.
You're using pika 0.9.6 and the tutorials are written for pika 0.9.5.

Try running: ? pip install pika==0.9.5

Marek

From majek04 at gmail.com  Fri Dec  9 12:11:01 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Dec 2011 12:11:01 +0000
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CANGs2yu=g2mHr5f8TguyWrJBAmgGnrPEU8SZJ_6KW7aCrq_u-Q@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
	<CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
	<CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>
	<CABzX+qz7K=smeS0wrxkCeVjQu6rNC+SMq+PR2DQbS+Jtdnk8Tw@mail.gmail.com>
	<CANGs2ytF9GjBgVgMMuPtaWdn_FRfkqKkgZV42Th_1J-Yz9osjQ@mail.gmail.com>
	<CABzX+qwTvJAW8kWKiXNnK-v=+MdQ3wpxkZgeG9DQtYCubsXnvw@mail.gmail.com>
	<CANGs2yusXVAR_q2yHN4EGrOYnAWfDZoR-XEyAYjuAjrZF=ecFQ@mail.gmail.com>
	<CANGs2yu=g2mHr5f8TguyWrJBAmgGnrPEU8SZJ_6KW7aCrq_u-Q@mail.gmail.com>
Message-ID: <CABzX+qxyWmquutc76A6y_jE6z5qqmfGS_5hp_4zdf-EtwA3vPA@mail.gmail.com>

On Fri, Dec 9, 2011 at 12:05, Michael Morrison <mwmorrison93 at gmail.com> wrote:
> Nevermind Marek, I see why it doesn't work. Let me ask you i don't have pip
> set up on my machine, how do i find the gzip file with the correct version
> of pika that I need?

I strongly suggest getting pip working. Have you tried running:
  sudo apt-get install python-pip

Or:
  easy_install pip

All this is described in first tutorial:
  http://www.rabbitmq.com/tutorials/tutorial-one-python.html

Installing python dependencies via pip is rather a standard practice
these days, so I strongly suggest trying to get it working.

A link to a tarball is quite easy to find on pypi:
 http://pypi.python.org/pypi/pika

Marek


>
> On Fri, Dec 9, 2011 at 4:02 AM, Michael Morrison <mwmorrison93 at gmail.com>
> wrote:
>>
>> Sorry i don't follow, can you explain to me why it wouldn't work? When I
>> changed the value it did create an egg for 0.9.5 under my
>> ?/usr/local/lib/python2.7/site-packages directory. I removed the 0.9.6_pre
>> egg so i'm pretty sure i'm referencing the correct package now. If i remove
>> the 0.9.5 egg from the site-packages directory i get an error message saying
>> that the pika package could not be found if i replace it then i get the same
>> error message regarding the 'sanitize' attribute. Thanks marek.
>>
>> Mike
>>
>>
>> On Fri, Dec 9, 2011 at 3:57 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>>
>>> On Fri, Dec 9, 2011 at 11:48, Michael Morrison <mwmorrison93 at gmail.com>
>>> wrote:
>>> > Thanks again, but i went and checked the setup.py file and noticed that
>>> > it
>>> > was set to install version 0.9.6_pre, i changed the value to 0.9.5 and
>>> > reinstalled. I removed the 0.9.6 packages but i'm still getting the
>>> > same
>>> > error. Here's the output of the last install that i just ran. Really
>>> > appreciate the help!
>>>
>>> Altering the number in `setup.py` won't solve the problem.
>>> You're using pika 0.9.6 and the tutorials are written for pika 0.9.5.
>>>
>>> Try running: ? pip install pika==0.9.5
>>>
>>> Marek
>>
>>
>

From mwmorrison93 at gmail.com  Fri Dec  9 12:16:48 2011
From: mwmorrison93 at gmail.com (Michael Morrison)
Date: Fri, 9 Dec 2011 04:16:48 -0800
Subject: [rabbitmq-discuss] Errors while running examples from RabbitMQ
	tutorial
In-Reply-To: <CABzX+qxyWmquutc76A6y_jE6z5qqmfGS_5hp_4zdf-EtwA3vPA@mail.gmail.com>
References: <CANGs2ytV+jUm+Ryfyhs9TQHET+RAmvwHs9yD9GeE=s_Fei=4ug@mail.gmail.com>
	<CABzX+qwEGOTZEQuFjqOZS4kpViVVtNLi1D-TkyiROygwfjTnwA@mail.gmail.com>
	<CANGs2ytJOCyjeB4zU5wxKs6Y5k0zHUkxiXER6V1Lm6k+yF3W9g@mail.gmail.com>
	<CABzX+qz7K=smeS0wrxkCeVjQu6rNC+SMq+PR2DQbS+Jtdnk8Tw@mail.gmail.com>
	<CANGs2ytF9GjBgVgMMuPtaWdn_FRfkqKkgZV42Th_1J-Yz9osjQ@mail.gmail.com>
	<CABzX+qwTvJAW8kWKiXNnK-v=+MdQ3wpxkZgeG9DQtYCubsXnvw@mail.gmail.com>
	<CANGs2yusXVAR_q2yHN4EGrOYnAWfDZoR-XEyAYjuAjrZF=ecFQ@mail.gmail.com>
	<CANGs2yu=g2mHr5f8TguyWrJBAmgGnrPEU8SZJ_6KW7aCrq_u-Q@mail.gmail.com>
	<CABzX+qxyWmquutc76A6y_jE6z5qqmfGS_5hp_4zdf-EtwA3vPA@mail.gmail.com>
Message-ID: <CANGs2yu_gaKm+PTBFYX1+qgBi=H3gChWEghY1=eEZpMUM405zw@mail.gmail.com>

Wow! that worked perfectly! Thanks Marek, really appreciate it.

Mike

On Fri, Dec 9, 2011 at 4:11 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Fri, Dec 9, 2011 at 12:05, Michael Morrison <mwmorrison93 at gmail.com>
> wrote:
> > Nevermind Marek, I see why it doesn't work. Let me ask you i don't have
> pip
> > set up on my machine, how do i find the gzip file with the correct
> version
> > of pika that I need?
>
> I strongly suggest getting pip working. Have you tried running:
>  sudo apt-get install python-pip
>
> Or:
>  easy_install pip
>
> All this is described in first tutorial:
>  http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>
> Installing python dependencies via pip is rather a standard practice
> these days, so I strongly suggest trying to get it working.
>
> A link to a tarball is quite easy to find on pypi:
>  http://pypi.python.org/pypi/pika
>
> Marek
>
>
> >
> > On Fri, Dec 9, 2011 at 4:02 AM, Michael Morrison <mwmorrison93 at gmail.com
> >
> > wrote:
> >>
> >> Sorry i don't follow, can you explain to me why it wouldn't work? When I
> >> changed the value it did create an egg for 0.9.5 under my
> >>  /usr/local/lib/python2.7/site-packages directory. I removed the
> 0.9.6_pre
> >> egg so i'm pretty sure i'm referencing the correct package now. If i
> remove
> >> the 0.9.5 egg from the site-packages directory i get an error message
> saying
> >> that the pika package could not be found if i replace it then i get the
> same
> >> error message regarding the 'sanitize' attribute. Thanks marek.
> >>
> >> Mike
> >>
> >>
> >> On Fri, Dec 9, 2011 at 3:57 AM, Marek Majkowski <majek04 at gmail.com>
> wrote:
> >>>
> >>> On Fri, Dec 9, 2011 at 11:48, Michael Morrison <mwmorrison93 at gmail.com
> >
> >>> wrote:
> >>> > Thanks again, but i went and checked the setup.py file and noticed
> that
> >>> > it
> >>> > was set to install version 0.9.6_pre, i changed the value to 0.9.5
> and
> >>> > reinstalled. I removed the 0.9.6 packages but i'm still getting the
> >>> > same
> >>> > error. Here's the output of the last install that i just ran. Really
> >>> > appreciate the help!
> >>>
> >>> Altering the number in `setup.py` won't solve the problem.
> >>> You're using pika 0.9.6 and the tutorials are written for pika 0.9.5.
> >>>
> >>> Try running:   pip install pika==0.9.5
> >>>
> >>> Marek
> >>
> >>
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/3717b517/attachment.htm>

From italoo190 at gmail.com  Fri Dec  9 12:25:52 2011
From: italoo190 at gmail.com (Italo Dias)
Date: Fri, 9 Dec 2011 04:25:52 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq JAVA  listeners or Tracer
Message-ID: <b546a77d-ff27-4790-83ed-5e365fe3ed3b@h5g2000yqk.googlegroups.com>

1 ? Does rabbitmq JAVA has listeners to get information when a queue
is created or ?binded? in an exchange?

2 ? can I use rabbitmq Tracer for this?

From simon at rabbitmq.com  Fri Dec  9 13:06:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Dec 2011 13:06:35 +0000
Subject: [rabbitmq-discuss] rabbitmq JAVA  listeners or Tracer
In-Reply-To: <b546a77d-ff27-4790-83ed-5e365fe3ed3b@h5g2000yqk.googlegroups.com>
References: <b546a77d-ff27-4790-83ed-5e365fe3ed3b@h5g2000yqk.googlegroups.com>
Message-ID: <4EE207DB.5070506@rabbitmq.com>

On 09/12/11 12:25, Italo Dias wrote:
> 1 ? Does rabbitmq JAVA has listeners to get information when a queue
> is created or ?binded? in an exchange?

No.

We have wondered about the possibility of adding this to the broker 
somehow - but whenever the subject comes up we look more closely at the 
use case and determine that it won't work for whatever someone's trying 
to do.

So, what are you trying to do?

> 2 ? can I use rabbitmq Tracer for this?

Meh. Sort of, but remember that the tracer will report AMQP methods - so 
if a client declares a queue the already exists, you'll hear about it. 
If it declares a queue and fails, you'll hear about that too...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From italoo190 at gmail.com  Fri Dec  9 13:18:11 2011
From: italoo190 at gmail.com (Italo Dias)
Date: Fri, 9 Dec 2011 05:18:11 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq JAVA listeners or Tracer
In-Reply-To: <4EE207DB.5070506@rabbitmq.com>
References: <b546a77d-ff27-4790-83ed-5e365fe3ed3b@h5g2000yqk.googlegroups.com>
	<4EE207DB.5070506@rabbitmq.com>
Message-ID: <6ce0bdd9-c536-4350-8c07-63ca4b7311cf@q16g2000yqn.googlegroups.com>

Humm, Ok i think the Tracer will solve my problem.

I searched about a example of Tracer but i dont found it.

you have some code examples?

tks

From james.r.carr at gmail.com  Fri Dec  9 14:41:41 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 9 Dec 2011 08:41:41 -0600
Subject: [rabbitmq-discuss] Outage, brokers refuse to start back up
Message-ID: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>

So our datacenter had a power failure yesterday and the brokers now
REFUSE to start back up. I can send the erl_crash.dump as needed (it
is quite large) but here are the other logs.

Any ideas?

Thanks,
James


Rabbitmq log:

=INFO REPORT==== 9-Dec-2011::08:35:32 ===
Limiting to approx 924 file handles (829 sockets)

=ERROR REPORT==== 9-Dec-2011::08:36:02 ===
FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
             {rabbit_mnesia,check_schema_integrity,0},
             {rabbit_mnesia,ensure_schema_integrity,0},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2}]

=INFO REPORT==== 9-Dec-2011::08:36:03 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent


startup_log:

Activating RabbitMQ plugins ...
11 plugins activated:
* amqp_client-2.6.1
* erlando-2.6.1
* mochiweb-1.3-rmq2.6.1-git9a53dbd
* rabbitmq_federation-2.6.1
* rabbitmq_management-2.6.1
* rabbitmq_management_agent-2.6.1
* rabbitmq_management_visualiser-2.6.1
* rabbitmq_mochiweb-2.6.1
* rabbitmq_shovel-2.6.1
* rabbitmq_shovel_management-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at brokerm02p
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : Mg6GXWPn9Lrj9HC/D14CWA==
log            : /var/log/rabbitmq/rabbit at brokerm02p.log
sasl log       : /var/log/rabbitmq/rabbit at brokerm02p-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at brokerm02p
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database
...BOOT ERROR: FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
             {rabbit_mnesia,check_schema_integrity,0},
             {rabbit_mnesia,ensure_schema_integrity,0},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2}]
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

startup_err:

Erlang has closed

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

From michael.s.klishin at gmail.com  Fri Dec  9 14:43:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 9 Dec 2011 18:43:28 +0400
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ Java
	client
Message-ID: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>

I am investigating how to implement an (opt-in) network failure recovery for Langohr [1] and Hot Bunnies [2] and curious
about how people approach this problem. My main concern is handling shutdown notifications across multiple threads.

I am only trying to solve "the 80%" case for consumer apps right now. We have done it for amqp gem and it works fairly well but it is different from RabbitMQ Java client in many ways and most of apps that use it are single threaded.

So, if you have implemented network failure recovery using the Java client, I would be happy to hear what did and didn't work for you.

1. https://github.com/michaelklishin/langohr
2. https://github.com/ruby-amqp/hot_bunnies

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From Simone.Busoli at ferrari.com  Fri Dec  9 14:50:10 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 9 Dec 2011 14:50:10 +0000
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ
	Javaclient
In-Reply-To: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
References: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>

Hi Michael, I've been working on something similar on a .NET library, and currently what I've been doing is twofold on the publishing and consuming sides.
In either case I subscribe to connection shutdown events and reschedule connections, during this time publishes are enqueued locally and dequeued as soon as the connection comes back. With regards to threading I've found that keeping the library thread safe by enqueueing publishes into an in-memory thread-safe queue which gets emptied by a single thread (on the publisher side) and having a single thread consuming from all the rabbit queues and marshaling the received messages into the application to work quite well, but I'd be interested to know about other approaches as well.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: venerd? 9 dicembre 2011 15:43
To: Rabbit-Mq Discuss-Mailing List
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ Java client

I am investigating how to implement an (opt-in) network failure recovery for Langohr [1] and Hot Bunnies [2] and curious about how people approach this problem. My main concern is handling shutdown notifications across multiple threads.

I am only trying to solve "the 80%" case for consumer apps right now. We have done it for amqp gem and it works fairly well but it is different from RabbitMQ Java client in many ways and most of apps that use it are single threaded.

So, if you have implemented network failure recovery using the Java client, I would be happy to hear what did and didn't work for you.

1. https://github.com/michaelklishin/langohr
2. https://github.com/ruby-amqp/hot_bunnies

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From michael.s.klishin at gmail.com  Fri Dec  9 15:00:03 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 9 Dec 2011 19:00:03 +0400
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ
	Javaclient
In-Reply-To: <88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>
References: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>
Message-ID: <867C44D1-C2B1-4187-B5AE-F97E20D5805B@gmail.com>

Le 09/dic/2011 ? 18:50, Busoli, Simone a ?crit :

> With regards to threading I've found that keeping the library thread safe by enqueueing publishes into an in-memory thread-safe queue which gets emptied by a single thread (on the publisher side) and having a single thread consuming from all the rabbit queues and marshaling the received messages into the application to work quite well,

Simone,

Thank you, this is exactly what I have in mind for publishers. For consumers there is a bunch of questions that need to be answered:

1. Should recovering apps redeclare AMQP entities they use or use passive declares?
2. If I have 3 threads each with its own consumer (on separate channels, of course), how do I go about reopening their channels after AMQP connection is back up?
3. How do I detect that reconnection has succeeded?

So if I understand it correctly, your approach is to have one thread that consumes all messages and then dispatches them to different parts of the application, is my understanding correct?

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From james.r.carr at gmail.com  Fri Dec  9 15:03:56 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 9 Dec 2011 09:03:56 -0600
Subject: [rabbitmq-discuss] Outage, brokers refuse to start back up
In-Reply-To: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>
References: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>
Message-ID: <CAJreXKD1UEG=oGui-QmGP4U5nftaKHW1AE8scfX3=rXAbQ=chw@mail.gmail.com>

Okay, so I backed up our mnesia dir and wiped it clean on both boxes.
Brokers started fine. I then copied the DCD and DCL files back over
and my users, exchanges, and queues were back.

Is there a recommended way to protect against such an outage?

Thanks,
James


On Fri, Dec 9, 2011 at 8:41 AM, James Carr <james.r.carr at gmail.com> wrote:
> So our datacenter had a power failure yesterday and the brokers now
> REFUSE to start back up. I can send the erl_crash.dump as needed (it
> is quite large) but here are the other logs.
>
> Any ideas?
>
> Thanks,
> James
>
>
> Rabbitmq log:
>
> =INFO REPORT==== 9-Dec-2011::08:35:32 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =ERROR REPORT==== 9-Dec-2011::08:36:02 ===
> FAILED
> Reason: {error,
> ? ? ? ? ? ?{timeout_waiting_for_tables,
> ? ? ? ? ? ? ? ?[rabbit_user,rabbit_user_permission,rabbit_vhost,
> ? ? ? ? ? ? ? ? rabbit_durable_route,rabbit_durable_exchange,
> ? ? ? ? ? ? ? ? rabbit_durable_queue]}}
> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
> ? ? ? ? ? ? {rabbit_mnesia,check_schema_integrity,0},
> ? ? ? ? ? ? {rabbit_mnesia,ensure_schema_integrity,0},
> ? ? ? ? ? ? {rabbit_mnesia,init,0},
> ? ? ? ? ? ? {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> ? ? ? ? ? ? {rabbit,run_boot_step,1},
> ? ? ? ? ? ? {rabbit,'-start/2-lc$^0/1-0-',1},
> ? ? ? ? ? ? {rabbit,start,2}]
>
> =INFO REPORT==== 9-Dec-2011::08:36:03 ===
> ? ?application: rabbit
> ? ?exited: {bad_return,{{rabbit,start,[normal,[]]},
> ? ? ? ? ? ? ? ? ? ? ? ? {'EXIT',{rabbit,failure_during_boot}}}}
> ? ?type: permanent
>
>
> startup_log:
>
> Activating RabbitMQ plugins ...
> 11 plugins activated:
> * amqp_client-2.6.1
> * erlando-2.6.1
> * mochiweb-1.3-rmq2.6.1-git9a53dbd
> * rabbitmq_federation-2.6.1
> * rabbitmq_management-2.6.1
> * rabbitmq_management_agent-2.6.1
> * rabbitmq_management_visualiser-2.6.1
> * rabbitmq_mochiweb-2.6.1
> * rabbitmq_shovel-2.6.1
> * rabbitmq_shovel_management-2.6.1
> * webmachine-1.7.0-rmq2.6.1-hg0c4b60a
>
>
> +---+ ? +---+
> | ? | ? | ? |
> | ? | ? | ? |
> | ? | ? | ? |
> | ? +---+ ? +-------+
> | ? ? ? ? ? ? ? ? ? |
> | RabbitMQ ?+---+ ? |
> | ? ? ? ? ? | ? | ? |
> | ? v2.6.1 ?+---+ ? |
> | ? ? ? ? ? ? ? ? ? |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL. ?See http://www.rabbitmq.com/
>
> node ? ? ? ? ? : rabbit at brokerm02p
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
> home dir ? ? ? : /var/lib/rabbitmq
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash ? ?: Mg6GXWPn9Lrj9HC/D14CWA==
> log ? ? ? ? ? ?: /var/log/rabbitmq/rabbit at brokerm02p.log
> sasl log ? ? ? : /var/log/rabbitmq/rabbit at brokerm02p-sasl.log
> database dir ? : /var/lib/rabbitmq/mnesia/rabbit at brokerm02p
> erlang version : 5.8.4
>
> -- rabbit boot start
> starting file handle cache server ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ...done
> starting worker pool ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?...done
> starting database
> ...BOOT ERROR: FAILED
> Reason: {error,
> ? ? ? ? ? ?{timeout_waiting_for_tables,
> ? ? ? ? ? ? ? ?[rabbit_user,rabbit_user_permission,rabbit_vhost,
> ? ? ? ? ? ? ? ? rabbit_durable_route,rabbit_durable_exchange,
> ? ? ? ? ? ? ? ? rabbit_durable_queue]}}
> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
> ? ? ? ? ? ? {rabbit_mnesia,check_schema_integrity,0},
> ? ? ? ? ? ? {rabbit_mnesia,ensure_schema_integrity,0},
> ? ? ? ? ? ? {rabbit_mnesia,init,0},
> ? ? ? ? ? ? {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> ? ? ? ? ? ? {rabbit,run_boot_step,1},
> ? ? ? ? ? ? {rabbit,'-start/2-lc$^0/1-0-',1},
> ? ? ? ? ? ? {rabbit,start,2}]
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
> startup_err:
>
> Erlang has closed
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

From Simone.Busoli at ferrari.com  Fri Dec  9 15:41:41 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 9 Dec 2011 15:41:41 +0000
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ
	Javaclient
In-Reply-To: <867C44D1-C2B1-4187-B5AE-F97E20D5805B@gmail.com>
References: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>
	<867C44D1-C2B1-4187-B5AE-F97E20D5805B@gmail.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520A47EB@GSVCLU04.ges.ferlan.it>

inline

> Simone,
> 
> Thank you, this is exactly what I have in mind for publishers. For consumers
> there is a bunch of questions that need to be answered:
> 
> 1. Should recovering apps redeclare AMQP entities they use or use passive
> declares?

Currently I do, yes, although it somewhat defeats the purpose of durable entities which would fit well here. Currently I'm recreating everything from scratch when the connection goes down, and handle recovery of previous data that consumers may need at the application level. I'm however planning to start considering to use durable entities.

> 2. If I have 3 threads each with its own consumer (on separate channels, of
> course), how do I go about reopening their channels after AMQP connection
> is back up?

I'm dealing with this by having a single channel with one consumer which consumes from all the queues the application needs to read data from. What kind of limitation do you see in keeping it single threaded?

> 3. How do I detect that reconnection has succeeded?

In the .NET client when you Open the connection and no exception is thrown I think you can safely assume that the connection has been established.

> 
> So if I understand it correctly, your approach is to have one thread that
> consumes all messages and then dispatches them to different parts of the
> application, is my understanding correct?

Yes, correct. This entails that your application has to cope with messages being consumed by threads that the application does not know directly (as they belong to the messaging library), but I found it to be easier to do that than to consume from rabbit queues from multiple threads with multiple channels. Oh, I didn't specify it explicitly but I also use one single channel for publishing and one single channel for consuming.

> 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin


_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From simon at rabbitmq.com  Fri Dec  9 15:49:12 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Dec 2011 15:49:12 +0000
Subject: [rabbitmq-discuss] Outage, brokers refuse to start back up
In-Reply-To: <CAJreXKD1UEG=oGui-QmGP4U5nftaKHW1AE8scfX3=rXAbQ=chw@mail.gmail.com>
References: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>
	<CAJreXKD1UEG=oGui-QmGP4U5nftaKHW1AE8scfX3=rXAbQ=chw@mail.gmail.com>
Message-ID: <4EE22DF8.4070407@rabbitmq.com>

When you start a cluster up again after it's entirely shut down, any 
node other than the last one to be shut down will wait at startup for 
the last one to reappear (since the last node to shut down is 
authoritative). If the last node does not reappear in 30s then the error 
message you quote is shown. Did you get the same error on both nodes?

Cheers, Simon

On 09/12/11 15:03, James Carr wrote:
> Okay, so I backed up our mnesia dir and wiped it clean on both boxes.
> Brokers started fine. I then copied the DCD and DCL files back over
> and my users, exchanges, and queues were back.
>
> Is there a recommended way to protect against such an outage?
>
> Thanks,
> James
>
>
> On Fri, Dec 9, 2011 at 8:41 AM, James Carr<james.r.carr at gmail.com>  wrote:
>> So our datacenter had a power failure yesterday and the brokers now
>> REFUSE to start back up. I can send the erl_crash.dump as needed (it
>> is quite large) but here are the other logs.
>>
>> Any ideas?
>>
>> Thanks,
>> James
>>
>>
>> Rabbitmq log:
>>
>> =INFO REPORT==== 9-Dec-2011::08:35:32 ===
>> Limiting to approx 924 file handles (829 sockets)
>>
>> =ERROR REPORT==== 9-Dec-2011::08:36:02 ===
>> FAILED
>> Reason: {error,
>>             {timeout_waiting_for_tables,
>>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
>>                  rabbit_durable_route,rabbit_durable_exchange,
>>                  rabbit_durable_queue]}}
>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>              {rabbit_mnesia,check_schema_integrity,0},
>>              {rabbit_mnesia,ensure_schema_integrity,0},
>>              {rabbit_mnesia,init,0},
>>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>              {rabbit,run_boot_step,1},
>>              {rabbit,'-start/2-lc$^0/1-0-',1},
>>              {rabbit,start,2}]
>>
>> =INFO REPORT==== 9-Dec-2011::08:36:03 ===
>>     application: rabbit
>>     exited: {bad_return,{{rabbit,start,[normal,[]]},
>>                          {'EXIT',{rabbit,failure_during_boot}}}}
>>     type: permanent
>>
>>
>> startup_log:
>>
>> Activating RabbitMQ plugins ...
>> 11 plugins activated:
>> * amqp_client-2.6.1
>> * erlando-2.6.1
>> * mochiweb-1.3-rmq2.6.1-git9a53dbd
>> * rabbitmq_federation-2.6.1
>> * rabbitmq_management-2.6.1
>> * rabbitmq_management_agent-2.6.1
>> * rabbitmq_management_visualiser-2.6.1
>> * rabbitmq_mochiweb-2.6.1
>> * rabbitmq_shovel-2.6.1
>> * rabbitmq_shovel_management-2.6.1
>> * webmachine-1.7.0-rmq2.6.1-hg0c4b60a
>>
>>
>> +---+   +---+
>> |   |   |   |
>> |   |   |   |
>> |   |   |   |
>> |   +---+   +-------+
>> |                   |
>> | RabbitMQ  +---+   |
>> |           |   |   |
>> |   v2.6.1  +---+   |
>> |                   |
>> +-------------------+
>> AMQP 0-9-1 / 0-9 / 0-8
>> Copyright (C) 2007-2011 VMware, Inc.
>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>
>> node           : rabbit at brokerm02p
>> app descriptor :
>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
>> home dir       : /var/lib/rabbitmq
>> config file(s) : /etc/rabbitmq/rabbitmq.config
>> cookie hash    : Mg6GXWPn9Lrj9HC/D14CWA==
>> log            : /var/log/rabbitmq/rabbit at brokerm02p.log
>> sasl log       : /var/log/rabbitmq/rabbit at brokerm02p-sasl.log
>> database dir   : /var/lib/rabbitmq/mnesia/rabbit at brokerm02p
>> erlang version : 5.8.4
>>
>> -- rabbit boot start
>> starting file handle cache server                                     ...done
>> starting worker pool                                                  ...done
>> starting database
>> ...BOOT ERROR: FAILED
>> Reason: {error,
>>             {timeout_waiting_for_tables,
>>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
>>                  rabbit_durable_route,rabbit_durable_exchange,
>>                  rabbit_durable_queue]}}
>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>              {rabbit_mnesia,check_schema_integrity,0},
>>              {rabbit_mnesia,ensure_schema_integrity,0},
>>              {rabbit_mnesia,init,0},
>>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>              {rabbit,run_boot_step,1},
>>              {rabbit,'-start/2-lc$^0/1-0-',1},
>>              {rabbit,start,2}]
>> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>>
>> startup_err:
>>
>> Erlang has closed
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Fri Dec  9 15:54:55 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 9 Dec 2011 09:54:55 -0600
Subject: [rabbitmq-discuss] Outage, brokers refuse to start back up
In-Reply-To: <4EE22DF8.4070407@rabbitmq.com>
References: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>
	<CAJreXKD1UEG=oGui-QmGP4U5nftaKHW1AE8scfX3=rXAbQ=chw@mail.gmail.com>
	<4EE22DF8.4070407@rabbitmq.com>
Message-ID: <CAJreXKBPodhE6sVkzvR5v7+W80Kh6a+i6fuw_vEQsMak5z2qkw@mail.gmail.com>

Yes. I shut both down and whIen trying to restart either the master
node or the other node I got the same error.

On Fri, Dec 9, 2011 at 9:49 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> When you start a cluster up again after it's entirely shut down, any node
> other than the last one to be shut down will wait at startup for the last
> one to reappear (since the last node to shut down is authoritative). If the
> last node does not reappear in 30s then the error message you quote is
> shown. Did you get the same error on both nodes?
>
> Cheers, Simon
>
>
> On 09/12/11 15:03, James Carr wrote:
>>
>> Okay, so I backed up our mnesia dir and wiped it clean on both boxes.
>> Brokers started fine. I then copied the DCD and DCL files back over
>> and my users, exchanges, and queues were back.
>>
>> Is there a recommended way to protect against such an outage?
>>
>> Thanks,
>> James
>>
>>
>> On Fri, Dec 9, 2011 at 8:41 AM, James Carr<james.r.carr at gmail.com> ?wrote:
>>>
>>> So our datacenter had a power failure yesterday and the brokers now
>>> REFUSE to start back up. I can send the erl_crash.dump as needed (it
>>> is quite large) but here are the other logs.
>>>
>>> Any ideas?
>>>
>>> Thanks,
>>> James
>>>
>>>
>>> Rabbitmq log:
>>>
>>> =INFO REPORT==== 9-Dec-2011::08:35:32 ===
>>> Limiting to approx 924 file handles (829 sockets)
>>>
>>> =ERROR REPORT==== 9-Dec-2011::08:36:02 ===
>>> FAILED
>>> Reason: {error,
>>> ? ? ? ? ? ?{timeout_waiting_for_tables,
>>> ? ? ? ? ? ? ? ?[rabbit_user,rabbit_user_permission,rabbit_vhost,
>>> ? ? ? ? ? ? ? ? rabbit_durable_route,rabbit_durable_exchange,
>>> ? ? ? ? ? ? ? ? rabbit_durable_queue]}}
>>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>> ? ? ? ? ? ? {rabbit_mnesia,check_schema_integrity,0},
>>> ? ? ? ? ? ? {rabbit_mnesia,ensure_schema_integrity,0},
>>> ? ? ? ? ? ? {rabbit_mnesia,init,0},
>>> ? ? ? ? ? ? {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>> ? ? ? ? ? ? {rabbit,run_boot_step,1},
>>> ? ? ? ? ? ? {rabbit,'-start/2-lc$^0/1-0-',1},
>>> ? ? ? ? ? ? {rabbit,start,2}]
>>>
>>> =INFO REPORT==== 9-Dec-2011::08:36:03 ===
>>> ? ?application: rabbit
>>> ? ?exited: {bad_return,{{rabbit,start,[normal,[]]},
>>> ? ? ? ? ? ? ? ? ? ? ? ? {'EXIT',{rabbit,failure_during_boot}}}}
>>> ? ?type: permanent
>>>
>>>
>>> startup_log:
>>>
>>> Activating RabbitMQ plugins ...
>>> 11 plugins activated:
>>> * amqp_client-2.6.1
>>> * erlando-2.6.1
>>> * mochiweb-1.3-rmq2.6.1-git9a53dbd
>>> * rabbitmq_federation-2.6.1
>>> * rabbitmq_management-2.6.1
>>> * rabbitmq_management_agent-2.6.1
>>> * rabbitmq_management_visualiser-2.6.1
>>> * rabbitmq_mochiweb-2.6.1
>>> * rabbitmq_shovel-2.6.1
>>> * rabbitmq_shovel_management-2.6.1
>>> * webmachine-1.7.0-rmq2.6.1-hg0c4b60a
>>>
>>>
>>> +---+ ? +---+
>>> | ? | ? | ? |
>>> | ? | ? | ? |
>>> | ? | ? | ? |
>>> | ? +---+ ? +-------+
>>> | ? ? ? ? ? ? ? ? ? |
>>> | RabbitMQ ?+---+ ? |
>>> | ? ? ? ? ? | ? | ? |
>>> | ? v2.6.1 ?+---+ ? |
>>> | ? ? ? ? ? ? ? ? ? |
>>> +-------------------+
>>> AMQP 0-9-1 / 0-9 / 0-8
>>> Copyright (C) 2007-2011 VMware, Inc.
>>> Licensed under the MPL. ?See http://www.rabbitmq.com/
>>>
>>> node ? ? ? ? ? : rabbit at brokerm02p
>>> app descriptor :
>>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
>>> home dir ? ? ? : /var/lib/rabbitmq
>>> config file(s) : /etc/rabbitmq/rabbitmq.config
>>> cookie hash ? ?: Mg6GXWPn9Lrj9HC/D14CWA==
>>> log ? ? ? ? ? ?: /var/log/rabbitmq/rabbit at brokerm02p.log
>>> sasl log ? ? ? : /var/log/rabbitmq/rabbit at brokerm02p-sasl.log
>>> database dir ? : /var/lib/rabbitmq/mnesia/rabbit at brokerm02p
>>> erlang version : 5.8.4
>>>
>>> -- rabbit boot start
>>> starting file handle cache server
>>> ...done
>>> starting worker pool
>>> ?...done
>>> starting database
>>> ...BOOT ERROR: FAILED
>>> Reason: {error,
>>> ? ? ? ? ? ?{timeout_waiting_for_tables,
>>> ? ? ? ? ? ? ? ?[rabbit_user,rabbit_user_permission,rabbit_vhost,
>>> ? ? ? ? ? ? ? ? rabbit_durable_route,rabbit_durable_exchange,
>>> ? ? ? ? ? ? ? ? rabbit_durable_queue]}}
>>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>> ? ? ? ? ? ? {rabbit_mnesia,check_schema_integrity,0},
>>> ? ? ? ? ? ? {rabbit_mnesia,ensure_schema_integrity,0},
>>> ? ? ? ? ? ? {rabbit_mnesia,init,0},
>>> ? ? ? ? ? ? {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>> ? ? ? ? ? ? {rabbit,run_boot_step,1},
>>> ? ? ? ? ? ? {rabbit,'-start/2-lc$^0/1-0-',1},
>>> ? ? ? ? ? ? {rabbit,start,2}]
>>> {"Kernel pid
>>> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>>>
>>> startup_err:
>>>
>>> Erlang has closed
>>>
>>> Crash dump was written to: erl_crash.dump
>>> Kernel pid terminated (application_controller)
>>>
>>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Dec  9 16:08:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Dec 2011 16:08:20 +0000
Subject: [rabbitmq-discuss] rabbitmq JAVA listeners or Tracer
In-Reply-To: <6ce0bdd9-c536-4350-8c07-63ca4b7311cf@q16g2000yqn.googlegroups.com>
References: <b546a77d-ff27-4790-83ed-5e365fe3ed3b@h5g2000yqk.googlegroups.com>	<4EE207DB.5070506@rabbitmq.com>
	<6ce0bdd9-c536-4350-8c07-63ca4b7311cf@q16g2000yqn.googlegroups.com>
Message-ID: <4EE23274.8030700@rabbitmq.com>

On 09/12/11 13:18, Italo Dias wrote:
> Humm, Ok i think the Tracer will solve my problem.
>
> I searched about a example of Tracer but i dont found it.
>
> you have some code examples?

I'm afraid not, but hopefully the com.rabbitmq.tools.Tracer class is 
reasonably self-explanatory.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Fri Dec  9 16:13:22 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 9 Dec 2011 20:13:22 +0400
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ
	Javaclient
In-Reply-To: <88E590DC4586974D825FC82AE798294E520A47EB@GSVCLU04.ges.ferlan.it>
References: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>
	<867C44D1-C2B1-4187-B5AE-F97E20D5805B@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47EB@GSVCLU04.ges.ferlan.it>
Message-ID: <21C3CE1D-7D6C-4656-A602-03D7B3541AA2@gmail.com>

Le 09/dic/2011 ? 19:41, Busoli, Simone a ?crit :

> I'm dealing with this by having a single channel with one consumer which consumes from all the queues the application needs to read data from. What kind of limitation do you see in keeping it single threaded?
> 

I think it's fine for many cases, however, I am designing a solution that library will use and there are definitely problems that can be naturally split into many concurrent tasks.

Currently both Langohr and Hot Bunnies use an executor (basically, submit message handlers to a thread pool) which is single threaded by default but can be swapped with any other. So my thinking is influenced by this scenario, probably too much.

>> 3. How do I detect that reconnection has succeeded?
> 
> In the .NET client when you Open the connection and no exception is thrown I think you can safely assume that the connection has been established.

This is true for the Java client, too. Does this mean that you open all channels in one place in the code? (I find this is a good idea)

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From mattswe at gmail.com  Fri Dec  9 18:37:24 2011
From: mattswe at gmail.com (Matt Sweeney)
Date: Fri, 9 Dec 2011 10:37:24 -0800 (PST)
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <20110530141459.GA4152@wellquite.org>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>
	<20110530141459.GA4152@wellquite.org>
Message-ID: <8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>

I am also having an issue with the maximum number of allowed connections. 
While I can raise the limit, I would like a way to discard connections that 
are no longer used. Is there a method for expiring connections which have 
not been used in a certain amount of time?

Thanks!
Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/e92cd785/attachment.htm>

From fearsome.lucidity at gmail.com  Fri Dec  9 20:33:57 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 9 Dec 2011 12:33:57 -0800
Subject: [rabbitmq-discuss] timeout_waiting_for_tables on node that has not
	changed node name
Message-ID: <CAFDmHdN4aZLWVuSvnU1iLpzamTZSs4KTMLgKU1FSh=w2mgHAXg@mail.gmail.com>

Last night we had to reboot a RabbitMQ node in a 3 node cluster within EC2.
 The node failed to restart with the dreaded timeout_waiting_for_tables
error.

Looking as past discussion on that topic it is clear that the most common
reason for it is a node name change, either because the node name contains
the IP address, the hostname changed, or a new node is being provisioned on
an image with an old mnesia DB with some other nodename.

None of those appears to apply in our current situation.  The node name
does not include the IP address and the node name did not change, as can be
seen in the start up logs.  Just to be sure we set the node name in the
/etc/rabbitmq/rabbitmq-env.conf file and attempted to restart, again
without success.

I enabled mnesia debugging at the trace level and it does not provide any
useful information as to what is causing the timeout.  The cluster has
developed a backlog of persistent messages in two of the queues (about 70K
in total), but from looking at what tables the system complains about it
does not appear those are the tables its trying to sync.  All the other
metadata (users, exchanges, bindings, queues) is of very small size, so 30
seconds should be sufficient time.

While we could wipe the mnesia state from the node, we'd like to find out
why this happens and whether it can be repaired, for future reference.

The start-up log is attached below.

Any ideas?

-----------------
Activating RabbitMQ plugins ...
7 plugins activated:
* amqp_client-2.5.1
* mochiweb-1.3-rmq2.5.1-git9a53dbd
* rabbitmq_management-2.5.1
* rabbitmq_management_agent-2.5.1
* rabbitmq_mochiweb-2.5.1
* rabbitmq_stomp-2.5.1
* webmachine-1.7.0-rmq2.5.1-hg0c4b60a

Mnesia('rabbit at queue-beta1-int'): mnesia_monitor starting: <0.68.0>
Mnesia('rabbit at queue-beta1-int'): Version: "4.4.17"
Mnesia('rabbit at queue-beta1-int'): Env access_module: mnesia
Mnesia('rabbit at queue-beta1-int'): Env auto_repair: true
Mnesia('rabbit at queue-beta1-int'): Env backup_module: mnesia_backup
Mnesia('rabbit at queue-beta1-int'): Env debug: trace
Mnesia('rabbit at queue-beta1-int'): Env dir:
"/var/lib/rabbitmq/mnesia/rabbit at queue-beta1-int"
Mnesia('rabbit at queue-beta1-int'): Env dump_log_load_regulation: false
Mnesia('rabbit at queue-beta1-int'): Env dump_log_time_threshold: 180000
Mnesia('rabbit at queue-beta1-int'): Env dump_log_update_in_place: true
Mnesia('rabbit at queue-beta1-int'): Env dump_log_write_threshold: 1000
Mnesia('rabbit at queue-beta1-int'): Env embedded_mnemosyne: false
Mnesia('rabbit at queue-beta1-int'): Env event_module: mnesia_event
Mnesia('rabbit at queue-beta1-int'): Env extra_db_nodes: []
Mnesia('rabbit at queue-beta1-int'): Env ignore_fallback_at_startup: false
Mnesia('rabbit at queue-beta1-int'): Env fallback_error_function:
{mnesia,lkill}
Mnesia('rabbit at queue-beta1-int'): Env max_wait_for_decision: infinity
Mnesia('rabbit at queue-beta1-int'): Env schema_location: opt_disc
Mnesia('rabbit at queue-beta1-int'): Env core_dir: false
Mnesia('rabbit at queue-beta1-int'): Env pid_sort_order: false
Mnesia('rabbit at queue-beta1-int'): Env no_table_loaders: 2
Mnesia('rabbit at queue-beta1-int'): Env dc_dump_limit: 4
Mnesia('rabbit at queue-beta1-int'): Env send_compressed: 0
Mnesia('rabbit at queue-beta1-int'): Mnesia debug level set to trace
Mnesia('rabbit at queue-beta1-int'): mnesia_subscr starting: <0.69.0>
Mnesia('rabbit at queue-beta1-int'): mnesia_locker starting: <0.70.0>
Mnesia('rabbit at queue-beta1-int'): mnesia_recover starting: <0.71.0>
Mnesia('rabbit at queue-beta1-int'): mnesia_tm starting: <0.72.0>
Mnesia('rabbit at queue-beta1-int'): Schema initiated from: disc
Mnesia('rabbit at queue-beta1-int'): Transaction log dump initiated by
scan_decisions
Mnesia('rabbit at queue-beta1-int'): Transaction log dump initiated by
startup: {needs_dump,0}
Mnesia('rabbit at queue-beta1-int'): Transaction log dump initiated by
startup: already_dumped
Mnesia('rabbit at queue-beta1-int'): Initial dump of log during startup:
[dumped,

 dumped]
Mnesia('rabbit at queue-beta1-int'): mnesia_controller starting: <0.98.0>
Mnesia('rabbit at queue-beta1-int'): mnesia_downs = []
Mnesia('rabbit at queue-beta1-int'): Intend to load tables: []

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.5.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at queue-beta1-int
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : a+Jg2nl357GwYTLG/0y3Lg==
log            : /var/log/rabbitmq/rabbit at queue-beta1-int.log
sasl log       : /var/log/rabbitmq/rabbit at queue-beta1-int-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at queue-beta1-int
erlang version : 5.8.3

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database
...BOOT ERROR: FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_listener,rabbit_durable_route,

 rabbit_semi_durable_route,rabbit_route,rabbit_reverse_route,
                 rabbit_topic_trie_edge,rabbit_topic_trie_binding,
                 rabbit_durable_exchange,rabbit_exchange,
                 rabbit_exchange_serial,rabbit_durable_queue,rabbit_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
             {rabbit_mnesia,check_schema_integrity,0},
             {rabbit_mnesia,ensure_schema_integrity,0},
             {rabbit_mnesia,init_db,3},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1}]
Mnesia('rabbit at queue-beta1-int'): mnesia_controller terminated: shutdown
Mnesia('rabbit at queue-beta1-int'): mnesia_tm terminated: shutdown
Mnesia('rabbit at queue-beta1-int'): mnesia_recover terminated: shutdown
Mnesia('rabbit at queue-beta1-int'): mnesia_locker terminated: shutdown
Mnesia('rabbit at queue-beta1-int'): mnesia_subscr terminated: shutdown
Mnesia('rabbit at queue-beta1-int'): mnesia_monitor terminated: shutdown
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/9dddc4b7/attachment.htm>

From simone.busoli at gmail.com  Fri Dec  9 21:16:11 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 9 Dec 2011 22:16:11 +0100
Subject: [rabbitmq-discuss] Network failures recovery with RabbitMQ
	Javaclient
In-Reply-To: <21C3CE1D-7D6C-4656-A602-03D7B3541AA2@gmail.com>
References: <7FC17019-6D6B-473D-8455-BF4292C806CA@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47AF@GSVCLU04.ges.ferlan.it>
	<867C44D1-C2B1-4187-B5AE-F97E20D5805B@gmail.com>
	<88E590DC4586974D825FC82AE798294E520A47EB@GSVCLU04.ges.ferlan.it>
	<21C3CE1D-7D6C-4656-A602-03D7B3541AA2@gmail.com>
Message-ID: <CAOn7oW-F6vw-w1XHaTRZbOXU1osZk5Zaij5goK7pVcyK73TRrA@mail.gmail.com>

On Fri, Dec 9, 2011 at 17:13, Michael Klishin
<michael.s.klishin at gmail.com>wrote:

> Le 09/dic/2011 ? 19:41, Busoli, Simone a ?crit :
>
> > I'm dealing with this by having a single channel with one consumer which
> consumes from all the queues the application needs to read data from. What
> kind of limitation do you see in keeping it single threaded?
> >
>
> I think it's fine for many cases, however, I am designing a solution that
> library will use and there are definitely problems that can be naturally
> split into many concurrent tasks.
>
> Currently both Langohr and Hot Bunnies use an executor (basically, submit
> message handlers to a thread pool) which is single threaded by default but
> can be swapped with any other. So my thinking is influenced by this
> scenario, probably too much.
>

I'm not familiar with the executor you mention, but with "submit message
handlers to a thread pool" what do you mean exactly? What I mentioned above
is just how the library consumes messages from rabbit, how it marshals them
to the application code is a different matter. Currently I'm doing the
marshaling in the same thread as that which consumes from the rabbit queue,
which has the disadvantage of being as blocking as the application code
which consumes the message, but also the advantage of being able to
intercept exceptions being thrown by the application consuming the message
and thus enable policies to retry the consume, for instance. Anyway I'm not
sure I understand what you specifically refer to and I'be glad if you could
expand as it is something interesting for me too, as I didn't take much
time to look into how other libraries are handling that.


>
> >> 3. How do I detect that reconnection has succeeded?
> >
> > In the .NET client when you Open the connection and no exception is
> thrown I think you can safely assume that the connection has been
> established.
>
> This is true for the Java client, too. Does this mean that you open all
> channels in one place in the code? (I find this is a good idea)
>

I actually have an IPublishingModule and an IComsumingModule, which are
independent of each other. They both subscribe to events fired by a
ReliableConnection class I implemented which takes care of spotting
connection issues and schedule reconnection the broker when it shuts down,
notifying observers about these events. The modules carry out what is
sensible for them in response to connection status events. For instance the
publishing module stops trying to publish and enqueues publishes requested
by the application code (which is thus unaware, to a certain extent, of the
temporary connection failure), and then as soon as the connection is
restored recreates the channel and resumes publishing. On the other hand
the consuming module will just stop receiving and will recreate the amqp
entities when the connection is restored.


>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/92dcad2f/attachment.htm>

From fearsome.lucidity at gmail.com  Fri Dec  9 22:33:47 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 9 Dec 2011 14:33:47 -0800
Subject: [rabbitmq-discuss] timeout_waiting_for_tables on node that has
	not changed node name
In-Reply-To: <CAFDmHdN4aZLWVuSvnU1iLpzamTZSs4KTMLgKU1FSh=w2mgHAXg@mail.gmail.com>
References: <CAFDmHdN4aZLWVuSvnU1iLpzamTZSs4KTMLgKU1FSh=w2mgHAXg@mail.gmail.com>
Message-ID: <CAFDmHdPM2uic5gp6jffh5=iye04RvnacoQHY4pQv2N=ARr76bg@mail.gmail.com>

We figured it out on our own.  The cluster is using short names for node
names.  For some reason the EC2 DHCP client failed to set the domain entry
in resolv.conf, thus the restarted node's mnesia could not communicate with
other nodes.

Yet the errors and logs made no mention of the fact that the node's IP
could not be resolved.  Had such an error been printed the problem could
have been diagnosed and fixed in a couple of minutes.

Can someone please open a trouble ticket to get some sort of error logged
for this cases?

I have to imagine many of the issues reported as timeout_waiting_for_tables
errors are of similar origin.



On Fri, Dec 9, 2011 at 12:33 PM, Elias Levy <fearsome.lucidity at gmail.com>wrote:

> Last night we had to reboot a RabbitMQ node in a 3 node cluster within
> EC2.  The node failed to restart with the
> dreaded timeout_waiting_for_tables error.
>
> Looking as past discussion on that topic it is clear that the most common
> reason for it is a node name change, either because the node name contains
> the IP address, the hostname changed, or a new node is being provisioned on
> an image with an old mnesia DB with some other nodename.
>
> None of those appears to apply in our current situation.  The node name
> does not include the IP address and the node name did not change, as can be
> seen in the start up logs.  Just to be sure we set the node name in the
> /etc/rabbitmq/rabbitmq-env.conf file and attempted to restart, again
> without success.
>
> I enabled mnesia debugging at the trace level and it does not provide any
> useful information as to what is causing the timeout.  The cluster has
> developed a backlog of persistent messages in two of the queues (about 70K
> in total), but from looking at what tables the system complains about it
> does not appear those are the tables its trying to sync.  All the other
> metadata (users, exchanges, bindings, queues) is of very small size, so 30
> seconds should be sufficient time.
>
> While we could wipe the mnesia state from the node, we'd like to find out
> why this happens and whether it can be repaired, for future reference.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/b468af3e/attachment.htm>

From hpk.warrier at gmail.com  Sat Dec 10 17:33:54 2011
From: hpk.warrier at gmail.com (pradeep w)
Date: Sat, 10 Dec 2011 23:03:54 +0530
Subject: [rabbitmq-discuss] redelivering message without loosing order
Message-ID: <CAFwZ77oeu2a_rKB0G73w8CmQGWj=f-Y4doZ=yKNTK-2bb_8ceQ@mail.gmail.com>

Hello

 With the the basic queue based message consumption, I've this scenario ,
where my queue consumer reads message from queue and pass on as response to
remote application client. However as I may not get the message processing
response from client immediately, I'll not like to acknowledge message
while consuming from queue. In the event some issue occurs at the
application client and I need to resend the earlier message, how can i do
it.
In my scenario I also need to take care that the message being re-requested
should follow the order. And I'm not sure whether basicRecover() is the
right way as I feel that it may put the content as the last entry in queue?
For eg: In my case  first message send content which needs to be created
and the second one is update on the first message's content. For some
reason first message processing fails and client is not able to give
reject/acknowldege, the second one may not be requested at all. And when
the application client next connects it will get the second message which
will fail due to business logic [as first one is not available].
I was thinking if it is possible to send the first message again when the
client reconnects before giving the second message. Is it possible? Else
what is the alternative?

thanks
pradeep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111210/36d9b3aa/attachment.htm>

From alex.gronholm at nextday.fi  Sun Dec 11 12:14:37 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sun, 11 Dec 2011 04:14:37 -0800 (PST)
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>
	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>
	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>
Message-ID: <20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>

Sorry for taking this long to respond. I've been otherwise engaged and 
forgot about this conversation.
Thank you for your replies.

If you don't want the server queue requests to be 'lost' then don't allow 
> the
> queues to expire!
>
> On the other hand your clients apparently wait forever.  Is there a reason 
> I
> don't understand why the server queues expire but the clients don't have a
> timeout for the responses?
>
If the upgrade of the server software fails and the developers do nothing, 
the queue expires eventually so that stale requests are dropped and the 
clients will start getting proper error messages informing them of this 
condition.
This is not the ideal solution of course (per-message TTL and return 
notification would be).

You want requests to either be processed or (reliably) not processed.  You
> never want the clients to be in any doubt about whether the request was
> processed or not.  So you wait forever in the client.  However, requests 
> that
> get discarded never return so the client doesn't know.  So you want expiry 
> to
> trigger replies to the clients.  (Per-queue message TTLs also don't 
> return.)


 Sounds about right.

Let's see -- how would we do this without a dead-letter mechanism?  Well, 
> apart
> from making the server transactional, it might be useful to have an 
> 'offline'
> server that can take over any server's queue when it fails and either deal 
> with
> the requests [by issuing an 'offline' response?] or arrange for the server 
> to
> be restarted (and/or upgraded).
>

This seems fairly complicated. I'll have to look into transactions to see 
if they will help in my case.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111211/b385ade6/attachment.htm>

From blalor at bravo5.org  Sun Dec 11 13:11:08 2011
From: blalor at bravo5.org (Brian Lalor)
Date: Sun, 11 Dec 2011 08:11:08 -0500
Subject: [rabbitmq-discuss] 505 UNEXPECTED_FRAME when publishing in a
	consume handler using pika
Message-ID: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>

Good morning, all.  I opened this issue[1] on GitHub for Pika, but I'm not sure if it's a problem with pika or my code.

I'm trying to implement a consumer that also publishes messages using pika 0.9.5 running against RabbitMQ 2.7.0. I've created some sample code[2] that attempts to put a more user-friendly layer on top of the basic event-drivenSelectConnection, but it's still very simple. :-) I'm doing the following:

? connect to the server
? create a channel for subscribing to Exchange A
? create a channel for subscribing to Exchange B
? create a channel for publishing received messages to Exchange C

This will start and run for a short period of time, but eventually all three channels will close abruptly with:

    [505] UNEXPECTED_FRAME - expected content header for class 60, got non content header frame instead

The problem doesn't happen if I don't publish a message, so I that seems to be the key.  Is it illegal to publish a message while in the callback handler for consuming another message?  If so, what's the best way to handle this?  I'm trying to minimize the number of connections I have to make to the server, as that seems to be the point of multiplexing channels over one connection.

Thanks,
Brian

[1]: https://github.com/pika/pika/issues/112
[2]: https://gist.github.com/7f9ebb6455d2677a1b66

From james at 2600hz.com  Sun Dec 11 17:11:54 2011
From: james at 2600hz.com (James Aimonetti)
Date: Sun, 11 Dec 2011 09:11:54 -0800
Subject: [rabbitmq-discuss] Federation help
In-Reply-To: <4ED4BB85.9070501@rabbitmq.com>
References: <4ED12F78.2090501@2600hz.com>, <4ED368E8.7090404@rabbitmq.com>
	<154BCDD1990C6646BF01E722060F790D58A3F856@mbx022-w1-ca-1.exch022.domain.local>
	<4ED4BB85.9070501@rabbitmq.com>
Message-ID: <4EE4E45A.4010909@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Simon,

Not to be a bother or anything, but have you thought more about how to
handle the case where an application won't necessarily know if the
broker is using federation or not, and how the application can properly
declare the exchange?

We unfortunately can't ensure the exchanges are properly declared on
startup, so the application makes a point to declare them on init. If I
can declare it as federated and have the broker kick back an easily
parse-able error indicating to not use the federation exchange type, and
redeclare using the vanilla declaration, that would get me most of the
way there.

Happy holidays,

James


On 11/29/2011 03:01 AM, Simon MacMullen wrote:
> On 28/11/11 19:17, James Aimonetti wrote:
>> My app will be running in environments that aren't necessarily
>> federated, which is why I have my app declaring the exchanges on
>> startup. Do you have recommendations for how to handle this? If
>> federation is not enabled, and i declare the exchange as
>> 'x-federation' with type='direct' in the args, will RabbitMQ know to
>> declare the exchange as direct and not federated?
> 
> Ah, no.
> 
> Probably the best thing to do is require the federation plugin to always
> be installed, and in the non-federated environments declare your
> upstream_set(s) empty. This does require a bit of configuration on the
> non-federated environments though. I'll have a think about whether this
> can be improved.
> 
>> As for the amqp_client/ERL_LIBS issue, I installed via tarball. Not
>> sure why starting up didn't have plugins/ in the code path. I'll
>> check the installed Erlang lib and see if a conflicting version made
>> it in there.
> 
> Thanks.
> 
> Cheers, Simon
> 


- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJO5ORaAAoJENc77s1OYoGgVdIH/1IEHp7dZNQ73BF31tL86Iw3
b507jpGkBajr4l2tizTVyF1j93FRl75bI2WDgSyb52DRXJs4eQcuJy7Csu2olM9l
873T60tHSa0t0ID7PI4xJ55X6YdkL63sf4h6zUgq6jQMCbNl2GA2x6aBLNNA06YE
WqiKoOM2Lyh2p9zPZs63h9zbl4aLdeITESvCzDTh7YiVXXYMeV6mgeYX5by+LonQ
vhc8O8xoGH3cMYzKWDMcuxTFsEe6urMFevEIxIKNWsj7G9s/pH7YgfjoRiQmmkZS
FyFrsK+mcYDsHRB5P/nJtiMc9C34Qp+wdW/y/vAlrtEAmZ4Bj2qYwCCw0Ov7dj8=
=GyBb
-----END PGP SIGNATURE-----

From emile at rabbitmq.com  Mon Dec 12 10:43:22 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Dec 2011 10:43:22 +0000
Subject: [rabbitmq-discuss] redelivering message without loosing order
In-Reply-To: <CAFwZ77oeu2a_rKB0G73w8CmQGWj=f-Y4doZ=yKNTK-2bb_8ceQ@mail.gmail.com>
References: <CAFwZ77oeu2a_rKB0G73w8CmQGWj=f-Y4doZ=yKNTK-2bb_8ceQ@mail.gmail.com>
Message-ID: <4EE5DACA.40704@rabbitmq.com>

Hi Pradeep,

On 10/12/11 17:33, pradeep w wrote:
>  With the the basic queue based message consumption, I've this scenario
> , where my queue consumer reads message from queue and pass on as
> response to remote application client. However as I may not get the
> message processing response from client immediately, I'll not like to
> acknowledge message while consuming from queue. In the event some issue
> occurs at the application client and I need to resend the earlier
> message, how can i do it.

If the order of messages must be maintained then requeue the message.
See http://www.rabbitmq.com/semantics.html#ordering for applicable methods.

If order is not important then you could simply republish the message.

> In my scenario I also need to take care that the message being
> re-requested should follow the order. And I'm not sure whether
> basicRecover() is the right way as I feel that it may put the content as
> the last entry in queue?

basicRecover() is suitable if you need to return all unacknowledged
messages. Queues maintain publication order of requeued messages from
RabbitMQ v2.7.0. If you use an older version than v2.7.0 then
basicRecover() causes messages to be requeued at the back of the queue.

> For eg: In my case  first message send content which needs to be created
> and the second one is update on the first message's content. For some
> reason first message processing fails and client is not able to give
> reject/acknowldege, the second one may not be requested at all. And when
> the application client next connects it will get the second message
> which will fail due to business logic [as first one is not available].
> I was thinking if it is possible to send the first message again when
> the client reconnects before giving the second message. Is it possible?
> Else what is the alternative?

This sounds like a pipeline where processing involves taking a message
off one queue, doing something to it and then publishing it to another
queue. It depends on your application what should happen if processing
fails at any point. Should the whole pipeline stop or can the processing
of other messages proceed?


-Emile

From simon at rabbitmq.com  Mon Dec 12 11:27:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Dec 2011 11:27:54 +0000
Subject: [rabbitmq-discuss] 505 UNEXPECTED_FRAME when publishing in a
 consume handler using pika
In-Reply-To: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>
References: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>
Message-ID: <4EE5E53A.8030400@rabbitmq.com>

I'm not a Pika expert, but that error message is triggered by wrongly 
interleaved frames on a *single* channel - the most likely cause is 
using a single channel from multiple threads in a client where channels 
are not threadsafe (I suspect Pika is such a client).

Cheers, Simon

On 11/12/11 13:11, Brian Lalor wrote:
> Good morning, all.  I opened this issue[1] on GitHub for Pika, but I'm not sure if it's a problem with pika or my code.
>
> I'm trying to implement a consumer that also publishes messages using pika 0.9.5 running against RabbitMQ 2.7.0. I've created some sample code[2] that attempts to put a more user-friendly layer on top of the basic event-drivenSelectConnection, but it's still very simple. :-) I'm doing the following:
>
> ? connect to the server
> ? create a channel for subscribing to Exchange A
> ? create a channel for subscribing to Exchange B
> ? create a channel for publishing received messages to Exchange C
>
> This will start and run for a short period of time, but eventually all three channels will close abruptly with:
>
>      [505] UNEXPECTED_FRAME - expected content header for class 60, got non content header frame instead
>
> The problem doesn't happen if I don't publish a message, so I that seems to be the key.  Is it illegal to publish a message while in the callback handler for consuming another message?  If so, what's the best way to handle this?  I'm trying to minimize the number of connections I have to make to the server, as that seems to be the point of multiplexing channels over one connection.
>
> Thanks,
> Brian
>
> [1]: https://github.com/pika/pika/issues/112
> [2]: https://gist.github.com/7f9ebb6455d2677a1b66
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From blalor at bravo5.org  Mon Dec 12 11:30:16 2011
From: blalor at bravo5.org (Brian Lalor)
Date: Mon, 12 Dec 2011 06:30:16 -0500
Subject: [rabbitmq-discuss] 505 UNEXPECTED_FRAME when publishing in a
	consume handler using pika
In-Reply-To: <4EE5E53A.8030400@rabbitmq.com>
References: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>
	<4EE5E53A.8030400@rabbitmq.com>
Message-ID: <002B2883-F2DB-4F15-9852-7BD6EDFF25EF@bravo5.org>

On Dec 12, 2011, at 6:27 AM, Simon MacMullen wrote:

> I'm not a Pika expert, but that error message is triggered by wrongly interleaved frames on a *single* channel - the most likely cause is using a single channel from multiple threads in a client where channels are not threadsafe (I suspect Pika is such a client).

Thanks, Simon.  Pika is definitely not thread-safe (and the clients I've written to this point have used multiple threads and connections, which feels ugly).  The thing is, all *three* channels close at once.  I suspect a Pika bug?

From simon at rabbitmq.com  Mon Dec 12 11:36:46 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Dec 2011 11:36:46 +0000
Subject: [rabbitmq-discuss] 505 UNEXPECTED_FRAME when publishing in a
 consume handler using pika
In-Reply-To: <002B2883-F2DB-4F15-9852-7BD6EDFF25EF@bravo5.org>
References: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>	<4EE5E53A.8030400@rabbitmq.com>
	<002B2883-F2DB-4F15-9852-7BD6EDFF25EF@bravo5.org>
Message-ID: <4EE5E74E.7000307@rabbitmq.com>

On 12/12/11 11:30, Brian Lalor wrote:
> The thing is, all*three*  channels close at once.

505 UNEXPECTED_FRAME is a "hard" error according to the spec - which 
means that it will trigger closure of the entire connection.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From blalor at bravo5.org  Mon Dec 12 11:59:39 2011
From: blalor at bravo5.org (Brian Lalor)
Date: Mon, 12 Dec 2011 06:59:39 -0500
Subject: [rabbitmq-discuss] 505 UNEXPECTED_FRAME when publishing in a
	consume handler using pika
In-Reply-To: <4EE5E74E.7000307@rabbitmq.com>
References: <32BADB89-5E9C-4AC3-80B6-602E80DBFE7B@bravo5.org>	<4EE5E53A.8030400@rabbitmq.com>
	<002B2883-F2DB-4F15-9852-7BD6EDFF25EF@bravo5.org>
	<4EE5E74E.7000307@rabbitmq.com>
Message-ID: <CB55073A-CABA-4A64-AFD6-EA58AFF2DBA0@bravo5.org>

On Dec 12, 2011, at 6:36 AM, Simon MacMullen wrote:

> On 12/12/11 11:30, Brian Lalor wrote:
>> The thing is, all*three*  channels close at once.
> 
> 505 UNEXPECTED_FRAME is a "hard" error according to the spec - which means that it will trigger closure of the entire connection.

Well, that certainly explains it. :-)

From simon at rabbitmq.com  Mon Dec 12 12:24:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Dec 2011 12:24:18 +0000
Subject: [rabbitmq-discuss] Federation help
In-Reply-To: <4EE4E45A.4010909@2600hz.com>
References: <4ED12F78.2090501@2600hz.com>, <4ED368E8.7090404@rabbitmq.com>
	<154BCDD1990C6646BF01E722060F790D58A3F856@mbx022-w1-ca-1.exch022.domain.local>
	<4ED4BB85.9070501@rabbitmq.com> <4EE4E45A.4010909@2600hz.com>
Message-ID: <4EE5F272.1060700@rabbitmq.com>

You could either

1) Not enable federation on non federated servers. Declare the exchange 
as type x-federation. If the connection closes with 503 COMMAND_INVALID 
back, then reestablish the connection and declare as direct (or whatever).

2) Enable the federation plugin on all nodes, and configure the ones you 
don't want to *really* federate with empty upstream_sets.

I would go for 2) personally.

Cheers, Simon

On 11/12/11 17:11, James Aimonetti wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi Simon,
>
> Not to be a bother or anything, but have you thought more about how to
> handle the case where an application won't necessarily know if the
> broker is using federation or not, and how the application can properly
> declare the exchange?
>
> We unfortunately can't ensure the exchanges are properly declared on
> startup, so the application makes a point to declare them on init. If I
> can declare it as federated and have the broker kick back an easily
> parse-able error indicating to not use the federation exchange type, and
> redeclare using the vanilla declaration, that would get me most of the
> way there.
>
> Happy holidays,
>
> James
>
>
> On 11/29/2011 03:01 AM, Simon MacMullen wrote:
>> On 28/11/11 19:17, James Aimonetti wrote:
>>> My app will be running in environments that aren't necessarily
>>> federated, which is why I have my app declaring the exchanges on
>>> startup. Do you have recommendations for how to handle this? If
>>> federation is not enabled, and i declare the exchange as
>>> 'x-federation' with type='direct' in the args, will RabbitMQ know to
>>> declare the exchange as direct and not federated?
>>
>> Ah, no.
>>
>> Probably the best thing to do is require the federation plugin to always
>> be installed, and in the non-federated environments declare your
>> upstream_set(s) empty. This does require a bit of configuration on the
>> non-federated environments though. I'll have a think about whether this
>> can be improved.
>>
>>> As for the amqp_client/ERL_LIBS issue, I installed via tarball. Not
>>> sure why starting up didn't have plugins/ in the code path. I'll
>>> check the installed Erlang lib and see if a conflicting version made
>>> it in there.
>>
>> Thanks.
>>
>> Cheers, Simon
>>
>
>
> - --
> James Aimonetti
> Distributed Systems Engineer / DJ MC_
>
> 2600hz | http://2600hz.com
> sip:james at 2600hz.com
> tel: 415.886.7905
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iQEcBAEBAgAGBQJO5ORaAAoJENc77s1OYoGgVdIH/1IEHp7dZNQ73BF31tL86Iw3
> b507jpGkBajr4l2tizTVyF1j93FRl75bI2WDgSyb52DRXJs4eQcuJy7Csu2olM9l
> 873T60tHSa0t0ID7PI4xJ55X6YdkL63sf4h6zUgq6jQMCbNl2GA2x6aBLNNA06YE
> WqiKoOM2Lyh2p9zPZs63h9zbl4aLdeITESvCzDTh7YiVXXYMeV6mgeYX5by+LonQ
> vhc8O8xoGH3cMYzKWDMcuxTFsEe6urMFevEIxIKNWsj7G9s/pH7YgfjoRiQmmkZS
> FyFrsK+mcYDsHRB5P/nJtiMc9C34Qp+wdW/y/vAlrtEAmZ4Bj2qYwCCw0Ov7dj8=
> =GyBb
> -----END PGP SIGNATURE-----


-- 
Simon MacMullen
RabbitMQ, VMware

From mikeb at rabbitmq.com  Mon Dec 12 12:58:30 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 12 Dec 2011 12:58:30 +0000
Subject: [rabbitmq-discuss] Clustering On EC2
In-Reply-To: <32642325.2073.1323331885802.JavaMail.geo-discussion-forums@yqfd21>
References: <32642325.2073.1323331885802.JavaMail.geo-discussion-forums@yqfd21>
Message-ID: <4EE5FA76.4050308@rabbitmq.com>

Hi Mick,

> But am I right in saying the only solution is to use short names, in
> effect using the hosts file on the actual cluster
> machines to identify each other?
>
> In my naive thinking I would have assumed supporting FQDN's to be
> straight forward, they all resolve to ip's right?

The main difficulty is simply that Erlang's clustering needs either all 
short names or all "long" names, and its starting arguments discriminate 
between these two situations.

I tried this, locally:

I changed '-sname' to '-name' in the scripts rabbitmq-server and 
rabbitmqctl, then ran two nodes with full names (e.g., 
rabbit at example.com and hare at example.com) using RABBITMQ_NODENAME. These 
happily clustered together and ran the management plugin, through which 
I created a mirrored queue and sent some messages.

This suggests to me that it will work fine with the minimal modification 
to scripts given in the attached patch. A release that supports this may 
be longer in coming.


-Michael
-------------- next part --------------
A non-text attachment was scrubbed...
Name: longnames.patch
Type: text/x-patch
Size: 775 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111212/cd1e1056/attachment.bin>

From mickdelaney at gmail.com  Mon Dec 12 16:23:38 2011
From: mickdelaney at gmail.com (Michael Delaney)
Date: Mon, 12 Dec 2011 08:23:38 -0800 (PST)
Subject: [rabbitmq-discuss] Clustering On EC2
In-Reply-To: <4EE5FA76.4050308@rabbitmq.com>
References: <32642325.2073.1323331885802.JavaMail.geo-discussion-forums@yqfd21>
	<4EE5FA76.4050308@rabbitmq.com>
Message-ID: <13317489.438.1323707018401.JavaMail.geo-discussion-forums@yqf20>

thanks michael,
i'm going to test it tonight
regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111212/879b453e/attachment.htm>

From minaev at gmail.com  Mon Dec 12 16:24:55 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Mon, 12 Dec 2011 19:24:55 +0300
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
Message-ID: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>

Hello,

We use RabbitMQ for about a year now. From time to time I upgraded it
and switched from one server to another. About a month ago the last
such transition took place. I installed new RabbitMQ (2.7) on a new
server and our web application was reconfigured. Quite soon we faced
new problems. After some days of stable work clients could not connect
to RabbitMQ. I could list run rabbitmqctl, list queues, kill
connections, but the server refused attempts to connect. That is, TCP
socket was available and telnet could connect to port 5672, but the
AMQP connection could not be established. There was nothing unusual in
the logs. vm_memory_high_watermark is set to 0.7 and there's still
plenty of free memory.

After a couple of such failures I tried to downgrade to 2.6.1, but the
problem remained. The last time I disabled IPv6, but today we hit the
same trouble again.

I think I must have done something wrong when setting up the
environment, but what could that be?

OS: Ubuntu 10.04 LTS.
16GB RAM.
RabbitMQ 2.6.1
Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
Client: php-amqplib

-- 
With best regards,
Dmitri Minaev

From adamrabung at gmail.com  Mon Dec 12 20:33:42 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 12 Dec 2011 15:33:42 -0500
Subject: [rabbitmq-discuss] Orderly purge of a queue without losing messages
Message-ID: <CAAN_EDoR5y820dR=_Z4SHyaQOEO0DfavBx4BFYmc7kauc8fzGg@mail.gmail.com>

Hello,
I am working on a feature that will allow an admin to perform "bulk
operations" against a single physical queue.  For example, the admin
may want to say "In queue A, Delete all messages with publisher id =
X".  Unfortunately, this system will be dealing with large backlogs,
and the admin will need some means of selectively updating/deleting
these backlogs.  Throttling publishers is not an option for me.

I believe the only way to do this in Rabbit would be to drain the
queue, perform update/delete against matching messages, and re-queue
them.  In addition to being terribly inefficient, this has all kinds
of difficulties: canceling all channels currently listening to the
queue, performing the bulk operation and re-queueing from a single
thread (to preserve order), and then re-connecting all channels.

I am hoping that I am missing something major, and this isn't as bad
as it sounds.  Has anyone had success with this type of operation?

Any pointers much appreciated,
Adam

From DWise at capulaglobal.com  Tue Dec 13 09:24:08 2011
From: DWise at capulaglobal.com (Dan Wise)
Date: Tue, 13 Dec 2011 09:24:08 +0000
Subject: [rabbitmq-discuss] Clustering failure
Message-ID: <CDC4D88A8145494AB11398668CB5793E02D3F9A31E36@EXCHANGE.int.capulaglobal.com>

Hi,

We have been running a dual-node cluster (2.6.1) for some time, with one disk and one ram node. Last night we had a complete power outage, and when the power came back on, the ram node came up first. However it came up with a blank configuration. We were then unable to start the disk node due to a cookie mismatch or some other corruption.

To get the cluster started again we had to stop the ram node, then start the disk node. Once the disk node was back up, the ram node came up with the mirrored configuration.

My question is, is there a way of changing this configuration so that it does not matter which order the nodes come back up after a total outage? Can both nodes be disk nodes (I always assumed not)? We cannot rely on the fact that the disk node will be usable after such a failure.

I am a great fan of RabbitMQ and it would be good to understand these failure scenarios better so we can learn how to handle them in future.

Many thanks,

Dan.




_____________________________________________________________________________________________
This email and any attachments are confidential, for the exclusive  attention of the recipient 
and may also be legally privileged or otherwise protected from disclosure.  No information 
contained herein shall be disclosed to any other person without our written consent unless 
it is clearly publicly available or otherwise specified by us for onward transmission.  
If you received this email in error, please notify the sender by return email or by telephone 
on +44 (0)20 7071 0900; do not duplicate or redistribute it by any means; and delete or 
otherwise destroy all copies whether in electronic or hard copy form. 
 
Any views contained in this email are those of the author and may not reflect those of any 
Capula entity.  We reserve the right to monitor and review all emails within our network to 
ensure compliance with our policies and to protect our business. Emails are not secure and 
are not warranted by us to be free of errors nor of viruses nor of other defects which may
affect a computer system. Anyone who communicates with us by email is taken to accept these 
risks. Unless specifically indicated, this email is not an offer or solicitation to buy or 
sell any investment product. Any information regarding investment products is subject to 
change without notice.     
 
Capula Investment Management LLP is registered in England no. OC313398 and is authorised 
and regulated by the Financial Services Authority.  Capula Investment Services Ltd is 
registered in England no. 05460265. The registered office of both companies is 4th Floor, Reading Bridge House, George Street, Reading,RG1 8LS. The principal place of business of both companies is 
8 Lancelot Place, London SW7 1DR.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111213/2e81e4be/attachment.htm>

From simon at rabbitmq.com  Tue Dec 13 10:38:47 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Dec 2011 10:38:47 +0000
Subject: [rabbitmq-discuss] Clustering failure
In-Reply-To: <CDC4D88A8145494AB11398668CB5793E02D3F9A31E36@EXCHANGE.int.capulaglobal.com>
References: <CDC4D88A8145494AB11398668CB5793E02D3F9A31E36@EXCHANGE.int.capulaglobal.com>
Message-ID: <4EE72B37.3040208@rabbitmq.com>

On 13/12/11 09:24, Dan Wise wrote:
> Can both nodes be disk nodes (I always assumed not)?

Yes, they can. You can have as many disc nodes as you like. However...

 > My question is, is there a way of changing this configuration so that it
 > does not matter which order the nodes come back up after a total outage?

...it can still matter which order the nodes come back. If you shut down 
in an orderly way and A goes down after B, A will need to come back up 
again first (since things maybe have happened in the cluster while B was 
down).

I'm not sure what happens in the event of several nodes simultaneously 
losing power though.

> We cannot rely on
> the fact that the disk node will be usable after such a failure.

Absolutely. You need more than one then :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Dec 13 10:42:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Dec 2011 10:42:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
Message-ID: <4EE72C17.5010109@rabbitmq.com>

Hmm. I can't really say anything from your description - can you post 
the logs somewhere? It's possible that your definition of "nothing 
unusual in the logs" differs from mine.

And when you say that "the server refused attempts to connect", what 
exactly do you mean. You say that a TCP connection *could* be 
established - so does your client hang during AMQP handshaking? 
Disconnect? Something else?

Cheers, Simon

On 12/12/11 16:24, Dmitri Minaev wrote:
> Hello,
>
> We use RabbitMQ for about a year now. From time to time I upgraded it
> and switched from one server to another. About a month ago the last
> such transition took place. I installed new RabbitMQ (2.7) on a new
> server and our web application was reconfigured. Quite soon we faced
> new problems. After some days of stable work clients could not connect
> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
> connections, but the server refused attempts to connect. That is, TCP
> socket was available and telnet could connect to port 5672, but the
> AMQP connection could not be established. There was nothing unusual in
> the logs. vm_memory_high_watermark is set to 0.7 and there's still
> plenty of free memory.
>
> After a couple of such failures I tried to downgrade to 2.6.1, but the
> problem remained. The last time I disabled IPv6, but today we hit the
> same trouble again.
>
> I think I must have done something wrong when setting up the
> environment, but what could that be?
>
> OS: Ubuntu 10.04 LTS.
> 16GB RAM.
> RabbitMQ 2.6.1
> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
> Client: php-amqplib
>


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Dec 13 10:44:44 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 13 Dec 2011 11:44:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EE72C17.5010109@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
Message-ID: <CAMcAHLWVX56K6OLyyD5hYbC0dmFBmi2ormR=4_MBkZH0w2hSLg@mail.gmail.com>

You could also try running some of the demos from the official Java client
to make sure is not a client problem that you have.

On Tue, Dec 13, 2011 at 11:42 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Hmm. I can't really say anything from your description - can you post the
> logs somewhere? It's possible that your definition of "nothing unusual in
> the logs" differs from mine.
>
> And when you say that "the server refused attempts to connect", what
> exactly do you mean. You say that a TCP connection *could* be established -
> so does your client hang during AMQP handshaking? Disconnect? Something
> else?
>
> Cheers, Simon
>
>
> On 12/12/11 16:24, Dmitri Minaev wrote:
>
>> Hello,
>>
>> We use RabbitMQ for about a year now. From time to time I upgraded it
>> and switched from one server to another. About a month ago the last
>> such transition took place. I installed new RabbitMQ (2.7) on a new
>> server and our web application was reconfigured. Quite soon we faced
>> new problems. After some days of stable work clients could not connect
>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>> connections, but the server refused attempts to connect. That is, TCP
>> socket was available and telnet could connect to port 5672, but the
>> AMQP connection could not be established. There was nothing unusual in
>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>> plenty of free memory.
>>
>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>> problem remained. The last time I disabled IPv6, but today we hit the
>> same trouble again.
>>
>> I think I must have done something wrong when setting up the
>> environment, but what could that be?
>>
>> OS: Ubuntu 10.04 LTS.
>> 16GB RAM.
>> RabbitMQ 2.6.1
>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>> Client: php-amqplib
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111213/a1b34777/attachment.htm>

From simon at rabbitmq.com  Tue Dec 13 10:51:14 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Dec 2011 10:51:14 +0000
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>	<20110530141459.GA4152@wellquite.org>
	<8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>
Message-ID: <4EE72E22.5090708@rabbitmq.com>

On 09/12/11 18:37, Matt Sweeney wrote:
> I am also having an issue with the maximum number of allowed
> connections. While I can raise the limit, I would like a way to discard
> connections that are no longer used. Is there a method for expiring
> connections which have not been used in a certain amount of time?

The usual assumption is that clients that do not need to be connected 
will disconnect, the server won't do it for them ;-)

If you wanted to do this you could write some script that pulls down the 
list of connections from mgmt, looks at recv_oct_details.last_event and 
send_oct_details.last_event, and closes connections that have been idle 
for a certain amount of time.

It feels like quite an odd thing to want to do though - what will your 
clients do when they get disconnected? I assume they won't just 
reconnect. And if they know not to reconnect, why couldn't they 
disconnect in the first place?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Dec 13 11:38:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Dec 2011 11:38:50 +0000
Subject: [rabbitmq-discuss] timeout_waiting_for_tables on node that has
 not changed node name
In-Reply-To: <CAFDmHdPM2uic5gp6jffh5=iye04RvnacoQHY4pQv2N=ARr76bg@mail.gmail.com>
References: <CAFDmHdN4aZLWVuSvnU1iLpzamTZSs4KTMLgKU1FSh=w2mgHAXg@mail.gmail.com>
	<CAFDmHdPM2uic5gp6jffh5=iye04RvnacoQHY4pQv2N=ARr76bg@mail.gmail.com>
Message-ID: <4EE7394A.6070504@rabbitmq.com>

Just to be clear, are you saying that resolv.conf lacked a "search" line 
and thus DNS queries for short hostnames did not work? Or something else?

That does look like something we could detect / warn about. Hmm.

Cheers, Simon

On 09/12/11 22:33, Elias Levy wrote:
> We figured it out on our own.  The cluster is using short names for node
> names.  For some reason the EC2 DHCP client failed to set the domain
> entry in resolv.conf, thus the restarted node's mnesia could not
> communicate with other nodes.
>
> Yet the errors and logs made no mention of the fact that the node's IP
> could not be resolved.  Had such an error been printed the problem could
> have been diagnosed and fixed in a couple of minutes.
>
> Can someone please open a trouble ticket to get some sort of error
> logged for this cases?
>
> I have to imagine many of the issues reported
> as timeout_waiting_for_tables errors are of similar origin.
>
>
>
> On Fri, Dec 9, 2011 at 12:33 PM, Elias Levy <fearsome.lucidity at gmail.com
> <mailto:fearsome.lucidity at gmail.com>> wrote:
>
>     Last night we had to reboot a RabbitMQ node in a 3 node cluster
>     within EC2.  The node failed to restart with the
>     dreaded timeout_waiting_for_tables error.
>
>     Looking as past discussion on that topic it is clear that the most
>     common reason for it is a node name change, either because the node
>     name contains the IP address, the hostname changed, or a new node is
>     being provisioned on an image with an old mnesia DB with some other
>     nodename.
>
>     None of those appears to apply in our current situation.  The node
>     name does not include the IP address and the node name did not
>     change, as can be seen in the start up logs.  Just to be sure we set
>     the node name in the /etc/rabbitmq/rabbitmq-env.conf file and
>     attempted to restart, again without success.
>
>     I enabled mnesia debugging at the trace level and it does not
>     provide any useful information as to what is causing the timeout.
>       The cluster has developed a backlog of persistent messages in two
>     of the queues (about 70K in total), but from looking at what tables
>     the system complains about it does not appear those are the tables
>     its trying to sync.  All the other metadata (users, exchanges,
>     bindings, queues) is of very small size, so 30 seconds should be
>     sufficient time.
>
>     While we could wipe the mnesia state from the node, we'd like to
>     find out why this happens and whether it can be repaired, for future
>     reference.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Dec 13 11:57:09 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 13 Dec 2011 11:57:09 +0000
Subject: [rabbitmq-discuss] A different Processing error in logs
In-Reply-To: <4EE00E3B.5090300@strategicdata.com.au>
References: <4EDEB985.4010404@strategicdata.com.au>
	<4EDEC216.6000408@strategicdata.com.au>
	<19B8A7C8-B171-4EE4-95CF-E2599F25CAB5@rabbitmq.com>
	<4EE00E3B.5090300@strategicdata.com.au>
Message-ID: <61410ACA-C434-4F2C-8951-948097B868E2@rabbitmq.com>

Dear Toby,
Sorry for the delay in responding.

After some head-scratching (and references to the STOMP spec) Matthias helped
me to see the obvious:

UNSUBSCRIBE causes us to 'forget' the subscription, so an ACK for any messages
after then will fail. But MESSAGE frames can arrive after an UNSUBSCRIBE, so we
need to remember the information associated with a subscription beyond the
UNSUBSCRIBE.

This is clearly a bug in our STOMP adapter -- thank you for pointing this out.
We are surprised it didn't arise before.  I have raised a bug (24623) to track
this.

It also raises some issues for the re-use of subscription ids. The reason is
that UNSUBSCRIBE/SUBSCRIBE can be followed by a MESSAGE frame arriving, which
has no way of identifying the subscription it is for anymore. I'm intending to
prohibit the re-use of subscription ids on the same session.

The fix will probably not make the next release, which is imminent.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 8 Dec 2011, at 01:09, Toby Corkindale wrote:
> I've created a stand-alone script that demonstrates the issue occurring;
> it's in Perl, I hope that's OK?


From DWise at capulaglobal.com  Tue Dec 13 12:02:10 2011
From: DWise at capulaglobal.com (Dan Wise)
Date: Tue, 13 Dec 2011 12:02:10 +0000
Subject: [rabbitmq-discuss] Clustering failure
In-Reply-To: <4EE72B37.3040208@rabbitmq.com>
References: <CDC4D88A8145494AB11398668CB5793E02D3F9A31E36@EXCHANGE.int.capulaglobal.com>
	<4EE72B37.3040208@rabbitmq.com>
Message-ID: <CDC4D88A8145494AB11398668CB5793E02D3F9A31E3B@EXCHANGE.int.capulaglobal.com>

Many thanks for this Simon. I will try with two disk nodes and test simultaneous failure of both.

Dan.
 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: 13 December 2011 10:39
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Clustering failure

On 13/12/11 09:24, Dan Wise wrote:
> Can both nodes be disk nodes (I always assumed not)?

Yes, they can. You can have as many disc nodes as you like. However...

 > My question is, is there a way of changing this configuration so that it  > does not matter which order the nodes come back up after a total outage?

...it can still matter which order the nodes come back. If you shut down in an orderly way and A goes down after B, A will need to come back up again first (since things maybe have happened in the cluster while B was down).

I'm not sure what happens in the event of several nodes simultaneously losing power though.

> We cannot rely on
> the fact that the disk node will be usable after such a failure.

Absolutely. You need more than one then :)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_____________________________________________________________________________________________
This email and any attachments are confidential, for the exclusive  attention of the recipient 
and may also be legally privileged or otherwise protected from disclosure.  No information 
contained herein shall be disclosed to any other person without our written consent unless 
it is clearly publicly available or otherwise specified by us for onward transmission.  
If you received this email in error, please notify the sender by return email or by telephone 
on +44 (0)20 7071 0900; do not duplicate or redistribute it by any means; and delete or 
otherwise destroy all copies whether in electronic or hard copy form. 
 
Any views contained in this email are those of the author and may not reflect those of any 
Capula entity.  We reserve the right to monitor and review all emails within our network to 
ensure compliance with our policies and to protect our business. Emails are not secure and 
are not warranted by us to be free of errors nor of viruses nor of other defects which may
affect a computer system. Anyone who communicates with us by email is taken to accept these 
risks. Unless specifically indicated, this email is not an offer or solicitation to buy or 
sell any investment product. Any information regarding investment products is subject to 
change without notice.     
 
Capula Investment Management LLP is registered in England no. OC313398 and is authorised 
and regulated by the Financial Services Authority.  Capula Investment Services Ltd is 
registered in England no. 05460265. The registered office of both companies is 4th Floor, Reading Bridge House, George Street, Reading,RG1 8LS. The principal place of business of both companies is 
8 Lancelot Place, London SW7 1DR.


From minaev at gmail.com  Tue Dec 13 14:26:16 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Tue, 13 Dec 2011 18:26:16 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EE72C17.5010109@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
Message-ID: <CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>

Thank you for the reply. Yes, TCP connection could be established, but
not AMQP. We generally use PHP library, but I also tested RabbitMQ
using Python amqplib. In both cases, the client side cannot get the
connection.

Besides the common information messages (starting/closing TCP
connection), there's only one type of messages in the log files:

=WARNING REPORT==== 13-Dec-2011::16:56:51 ===
exception on TCP connection <0.14474.173> from x.x.x.x:xxx
connection_closed_abruptly

But then, again, these messages may be found even during normal
operation, this is why I don't think they're relevant.


On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
> Hmm. I can't really say anything from your description - can you post the
> logs somewhere? It's possible that your definition of "nothing unusual in
> the logs" differs from mine.
>
> And when you say that "the server refused attempts to connect", what exactly
> do you mean. You say that a TCP connection *could* be established - so does
> your client hang during AMQP handshaking? Disconnect? Something else?
>
> Cheers, Simon
>
>
> On 12/12/11 16:24, Dmitri Minaev wrote:
>>
>> Hello,
>>
>> We use RabbitMQ for about a year now. From time to time I upgraded it
>> and switched from one server to another. About a month ago the last
>> such transition took place. I installed new RabbitMQ (2.7) on a new
>> server and our web application was reconfigured. Quite soon we faced
>> new problems. After some days of stable work clients could not connect
>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>> connections, but the server refused attempts to connect. That is, TCP
>> socket was available and telnet could connect to port 5672, but the
>> AMQP connection could not be established. There was nothing unusual in
>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>> plenty of free memory.
>>
>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>> problem remained. The last time I disabled IPv6, but today we hit the
>> same trouble again.
>>
>> I think I must have done something wrong when setting up the
>> environment, but what could that be?
>>
>> OS: Ubuntu 10.04 LTS.
>> 16GB RAM.
>> RabbitMQ 2.6.1
>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>> Client: php-amqplib
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
With best regards,
Dmitri Minaev

From fearsome.lucidity at gmail.com  Tue Dec 13 17:07:32 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 13 Dec 2011 09:07:32 -0800
Subject: [rabbitmq-discuss] timeout_waiting_for_tables on node that has
	not changed node name
Message-ID: <CAFDmHdP46h=NH1ZeM8sywN+Gsh8_+CBh9vi0y3u_FFq4=tmJDg@mail.gmail.com>

On Tue, Dec 13, 2011 at 4:00 AM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

> From: Simon MacMullen <simon at rabbitmq.com>
>
> Just to be clear, are you saying that resolv.conf lacked a "search" line
> and thus DNS queries for short hostnames did not work? Or something else?
>
> That does look like something we could detect / warn about. Hmm.
>

That is exactly correct.  The short hostnames could not be resolved, but
RabbitMQ, Mnesia, and Erlang all failed to generate any sort of warning to
that effect, resulting in a bit of a goose chase trying to figure out why a
perfectly good node was failing to rejoin the cluster after a simple
restart.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111213/9ab45cf2/attachment.htm>

From Massimo.Paladin at cern.ch  Tue Dec 13 17:33:16 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 13 Dec 2011 18:33:16 +0100
Subject: [rabbitmq-discuss] small bug deleting a user from the management
	interface
Message-ID: <CAMOXM2_8wetCa8Ohng1wQ2n0uZcXkNgzdLMZPeddXg24WaFYDg@mail.gmail.com>

Hello,

there is a small bug in the web interface which prevent to delete a user
which contains " (quotation mark) in the username.

It works from rabbitmqctl.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111213/34d0a57e/attachment.htm>

From emile at rabbitmq.com  Tue Dec 13 18:11:40 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 13 Dec 2011 18:11:40 +0000
Subject: [rabbitmq-discuss] Orderly purge of a queue without losing
	messages
In-Reply-To: <CAAN_EDoR5y820dR=_Z4SHyaQOEO0DfavBx4BFYmc7kauc8fzGg@mail.gmail.com>
References: <CAAN_EDoR5y820dR=_Z4SHyaQOEO0DfavBx4BFYmc7kauc8fzGg@mail.gmail.com>
Message-ID: <4EE7955C.1010601@rabbitmq.com>

Hi Adam,

On 12/12/11 20:33, Adam Rabung wrote:
> I am working on a feature that will allow an admin to perform "bulk
> operations" against a single physical queue.  For example, the admin
> may want to say "In queue A, Delete all messages with publisher id =
> X".  Unfortunately, this system will be dealing with large backlogs,
> and the admin will need some means of selectively updating/deleting
> these backlogs.  Throttling publishers is not an option for me.

You could route messages by publisher and empty the relevant queue. If
the intention is to keep the queue length low by discarding
lower-priority messages then you should route messages to different
queues based on priority. This will make it possible to control the
length of the low priority queue, perhaps by using message expiry.

If bulk operations are an important part of your use-case and these
suggestions don't help then you should consider using a database with a
sufficiently expressive query language instead. Databases are much
better at manipulating large amounts of stationary data.


-Emile

From sanjivkumarjha at hotmail.com  Tue Dec 13 15:11:57 2011
From: sanjivkumarjha at hotmail.com (SanjivKumar)
Date: Tue, 13 Dec 2011 07:11:57 -0800 (PST)
Subject: [rabbitmq-discuss]  rabbitmq C client vs. experimental client
Message-ID: <32966491.post@talk.nabble.com>


Why rabbitmq c client is named as experimental client? Can this be used for a
large throughput system?
How reliable is c client?


-- 
View this message in context: http://old.nabble.com/rabbitmq-C-client-vs.-experimental-client-tp32966491p32966491.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gmr at myyearbook.com  Wed Dec 14 00:57:33 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 13 Dec 2011 19:57:33 -0500
Subject: [rabbitmq-discuss] rabbitmq C client vs. experimental client
In-Reply-To: <32966491.post@talk.nabble.com>
References: <32966491.post@talk.nabble.com>
Message-ID: <CAL_e=0r53ju41eupoXXYGd7ufSnJ2x6syFsy5+ji7dvvk==YZg@mail.gmail.com>

I've used it in a high-velocity messaging application in production for
over 12 months without an issue.

Regards,

Gavin

On Tue, Dec 13, 2011 at 10:11 AM, SanjivKumar <sanjivkumarjha at hotmail.com>wrote:

>
> Why rabbitmq c client is named as experimental client? Can this be used
> for a
> large throughput system?
> How reliable is c client?
>
>
> --
> View this message in context:
> http://old.nabble.com/rabbitmq-C-client-vs.-experimental-client-tp32966491p32966491.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111213/b115c869/attachment.htm>

From simon.loewenthal at tele2.com  Wed Dec 14 08:47:19 2011
From: simon.loewenthal at tele2.com (Simon Loewenthal/NL/Tele2)
Date: Wed, 14 Dec 2011 09:47:19 +0100
Subject: [rabbitmq-discuss] Initial cluster set-up questoin
Message-ID: <4EE86297.6090908@tele2.com>

	

Hi,

	I have installed Rabbit & Erlang and followed these instruction
http://www.rabbitmq.com/clustering.html to set-up a two node cluster.
Both nodes are be started, but when node 2 attempts to join node 1 it
fails.

There are no firewalls between each other. Both are on the same vlan and
a /22 subnet.

O/S: RHEL 6.2  Fully patched from RHN.

Node 1:

# rabbitmq-server --detached
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.7.0
* mochiweb-1.3-rmq2.7.0-git
* rabbitmq_management-2.7.0
* rabbitmq_management_agent-2.7.0
* rabbitmq_mochiweb-2.7.0
* webmachine-1.7.0-rmq2.7.0-hg

** Found 0 name clashes in code paths

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.7.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at iuu-app007
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : Fm+somLGFoQYy1H+2FUteQ==
log            : /var/log/rabbitmq/rabbit at iuu-app007.log
sasl log       : /var/log/rabbitmq/rabbit at iuu-app007-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app007
erlang version : 5.8.5

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting statistics event manager
...done
starting logging server
...done
starting plugin registry
...done
starting auth mechanism amqplain
...done
starting auth mechanism cr-demo
...done
starting auth mechanism plain
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting alarm handler
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting management agent
...done
starting exchange, queue and binding recovery
...done
starting mirror queue slave sup
...done
starting adding mirrors to queues
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...done
starting notify cluster nodes
...done
starting direct_client
...done

broker running



# rabbitmqctl cluster_status
Cluster status of node 'rabbit at iuu-app007' ...
[{nodes,[{disc,['rabbit at iuu-app007']}]},{running_nodes,['rabbit at iuu-app007']}]
...done.


Node 2:
# rabbitmq-server --detached
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.7.0
* mochiweb-1.3-rmq2.7.0-git
* rabbitmq_management-2.7.0
* rabbitmq_management_agent-2.7.0
* rabbitmq_mochiweb-2.7.0
* webmachine-1.7.0-rmq2.7.0-hg

** Found 0 name clashes in code paths
[SNIP]
node           : rabbit at iuu-app008
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : VOYILJRa2vmMlRly95DYQw==
log            : /var/log/rabbitmq/rabbit at iuu-app008.log
sasl log       : /var/log/rabbitmq/rabbit at iuu-app008-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app008
erlang version : 5.8.5
[SNIP]
broker running
Erlang has closed

# rabbitmqctl stop_app
Stopping node 'rabbit at iuu-app008' ...
...done.
[root at iuu-app008 ~]# rabbitmqctl reset
Resetting node 'rabbit at iuu-app008' ...
...done.

# rabbitmqctl cluster rabbit at iuu-app007
Clustering node 'rabbit at iuu-app008' with ['rabbit at iuu-app007'] ...
Error:
{no_running_cluster_nodes,['rabbit at iuu-app007'],['rabbit at iuu-app007']}

I have tried the command above with the FQDN and had the same error
returned.


Any ideas where I could look?

Simon.

-- 
Simon Loewenthal/Tele2
GSM: +31 6 2000 5427

******** IMPORTANT NOTICE ********
This e-mail (including any attachments) may contain information
that is confidential or otherwise protected from disclosure and
it is intended only for the addressees. If you are not the intended
recipient, please kindly refrain from copying or distribution.
Other use of information contained in this e-mail (and its attachments)
is frowned upon. If you have received this e-mail in error, kindly
notify us immediately by telephone or e-mail and, if possible, kindly
delete the message (including any attachments) from your system. Of
course, this is not legal advice, nor is it a contract. If it were a
contract, it would have an exchange of value and affirmative agreement
by both parties. If it were legal advice, it should be written by a
lawyer and would have a bill attached.

It ought to be obvious my views in this Email might not represent my
employer's views, & vice-verse. Please note that e-mail messages may
contain computer viruses or other defects. I presume that you understand
the concept of a computer virus, and took reasonable precautions.

From simon.loewenthal at tele2.com  Wed Dec 14 10:12:45 2011
From: simon.loewenthal at tele2.com (Simon Loewenthal/NL/Tele2)
Date: Wed, 14 Dec 2011 11:12:45 +0100
Subject: [rabbitmq-discuss] Initial cluster set-up questoin
In-Reply-To: <4EE86297.6090908@tele2.com>
References: <4EE86297.6090908@tele2.com>
Message-ID: <4EE8769D.7010307@tele2.com>

On 14/12/11 09:47, Simon Loewenthal/NL/Tele2 wrote:
> 	
>
> Hi,
>
> 	I have installed Rabbit & Erlang and followed these instruction
> http://www.rabbitmq.com/clustering.html to set-up a two node cluster.
> Both nodes are be started, but when node 2 attempts to join node 1 it
> fails.
>
> There are no firewalls between each other. Both are on the same vlan and
> a /22 subnet.
>
> O/S: RHEL 6.2  Fully patched from RHN.
>
> Node 1:
>
> # rabbitmq-server --detached
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.7.0
> * mochiweb-1.3-rmq2.7.0-git
> * rabbitmq_management-2.7.0
> * rabbitmq_management_agent-2.7.0
> * rabbitmq_mochiweb-2.7.0
> * webmachine-1.7.0-rmq2.7.0-hg
>
> ** Found 0 name clashes in code paths
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.7.0  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at iuu-app007
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : Fm+somLGFoQYy1H+2FUteQ==
> log            : /var/log/rabbitmq/rabbit at iuu-app007.log
> sasl log       : /var/log/rabbitmq/rabbit at iuu-app007-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app007
> erlang version : 5.8.5
>
> -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
> ...done
> starting database
> ...done
> starting codec correctness check
> ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
> ...done
> starting auth mechanism amqplain
> ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
> ...done
> starting exchange type topic
> ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
> ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting management agent
> ...done
> starting exchange, queue and binding recovery
> ...done
> starting mirror queue slave sup
> ...done
> starting adding mirrors to queues
> ...done
> -- message delivery logic ready
> starting error log relay
> ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
> ...done
>
> broker running
>
>
>
> # rabbitmqctl cluster_status
> Cluster status of node 'rabbit at iuu-app007' ...
> [{nodes,[{disc,['rabbit at iuu-app007']}]},{running_nodes,['rabbit at iuu-app007']}]
> ...done.
>
>
> Node 2:
> # rabbitmq-server --detached
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.7.0
> * mochiweb-1.3-rmq2.7.0-git
> * rabbitmq_management-2.7.0
> * rabbitmq_management_agent-2.7.0
> * rabbitmq_mochiweb-2.7.0
> * webmachine-1.7.0-rmq2.7.0-hg
>
> ** Found 0 name clashes in code paths
> [SNIP]
> node           : rabbit at iuu-app008
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : VOYILJRa2vmMlRly95DYQw==
> log            : /var/log/rabbitmq/rabbit at iuu-app008.log
> sasl log       : /var/log/rabbitmq/rabbit at iuu-app008-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app008
> erlang version : 5.8.5
> [SNIP]
> broker running
> Erlang has closed
>
> # rabbitmqctl stop_app
> Stopping node 'rabbit at iuu-app008' ...
> ...done.
> [root at iuu-app008 ~]# rabbitmqctl reset
> Resetting node 'rabbit at iuu-app008' ...
> ...done.
>
> # rabbitmqctl cluster rabbit at iuu-app007
> Clustering node 'rabbit at iuu-app008' with ['rabbit at iuu-app007'] ...
> Error:
> {no_running_cluster_nodes,['rabbit at iuu-app007'],['rabbit at iuu-app007']}
>
> I have tried the command above with the FQDN and had the same error
> returned.
>
>
> Any ideas where I could look?
>
> Simon.
>
Hi,

    Problem solved by copying the Erlang cookie from Node 1 onto Node 2.
Successfully joined two nodes in a disc cluster.


I createdthe  /etc/rabbitmq/rabbitmq-env.conf with this content:

[{rabbit, [{cluster_nodes, ['rabbit at iuu-app007', 'rabbit at iuu-app008']}]}].

#  rabbitmqctl cluster_status
/etc/rabbitmq/rabbitmq-env.conf: line 1: [{rabbit,: command not found
Cluster status of node 'rabbit at iuu-app008' ...
[{nodes,[{disc,['rabbit at iuu-app008','rabbit at iuu-app007']}]},
 {running_nodes,['rabbit at iuu-app007','rabbit at iuu-app008']}]
...done.

The syntax of the file looks fine to us, and also according to the
documentation. :~(

1) Is the syntax correct?
2) Should the rabbitmq-env.conf be placed on both nodes?

Regards, S.

-- 
Simon Loewenthal/Tele2
GSM: +31 6 2000 5427

******** IMPORTANT NOTICE ********
This e-mail (including any attachments) may contain information 
that is confidential or otherwise protected from disclosure and
it is intended only for the addressees. If you are not the intended
recipient, please kindly refrain from copying or distribution.
Other use of information contained in this e-mail (and its attachments)
is frowned upon. If you have received this e-mail in error, kindly
notify us immediately by telephone or e-mail and, if possible, kindly
delete the message (including any attachments) from your system. Of
course, this is not legal advice, nor is it a contract. If it were a
contract, it would have an exchange of value and affirmative agreement
by both parties. If it were legal advice, it should be written by a
lawyer and would have a bill attached.

It ought to be obvious my views in this Email might not represent my
employer's views, & vice-verse. Please note that e-mail messages may
contain computer viruses or other defects. I presume that you understand
the concept of a computer virus, and took reasonable precautions.


From alexandru at rabbitmq.com  Wed Dec 14 10:31:55 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 14 Dec 2011 10:31:55 +0000
Subject: [rabbitmq-discuss] Initial cluster set-up questoin
In-Reply-To: <4EE8769D.7010307@tele2.com>
References: <4EE86297.6090908@tele2.com>
 <4EE8769D.7010307@tele2.com>
Message-ID: <20111214103155.GC3277@southbank.Home>

> I createdthe  /etc/rabbitmq/rabbitmq-env.conf with this content:
> 
> [{rabbit, [{cluster_nodes, ['rabbit at iuu-app007', 'rabbit at iuu-app008']}]}].
> 
> /etc/rabbitmq/rabbitmq-env.conf: line 1: [{rabbit,: command not found
> Cluster status of node 'rabbit at iuu-app008' ...
> [{nodes,[{disc,['rabbit at iuu-app008','rabbit at iuu-app007']}]},
>  {running_nodes,['rabbit at iuu-app007','rabbit at iuu-app008']}]
> ...done.
> 
> The syntax of the file looks fine to us, and also according to the
> documentation. :~(
> 
> 1) Is the syntax correct?

Yes, but it's in the wrong file.  That should go in
  /etc/rabbitmq/rabbitmq.config

> 2) Should the rabbitmq-env.conf be placed on both nodes?

You should set that parameter in rabbitmq.config on both nodes.

Cheers,
Alex

On Wed, Dec 14, 2011 at 11:12:45AM +0100, Simon Loewenthal/NL/Tele2 wrote:
> On 14/12/11 09:47, Simon Loewenthal/NL/Tele2 wrote:
> > 	
> >
> > Hi,
> >
> > 	I have installed Rabbit & Erlang and followed these instruction
> > http://www.rabbitmq.com/clustering.html to set-up a two node cluster.
> > Both nodes are be started, but when node 2 attempts to join node 1 it
> > fails.
> >
> > There are no firewalls between each other. Both are on the same vlan and
> > a /22 subnet.
> >
> > O/S: RHEL 6.2  Fully patched from RHN.
> >
> > Node 1:
> >
> > # rabbitmq-server --detached
> > Activating RabbitMQ plugins ...
> > 6 plugins activated:
> > * amqp_client-2.7.0
> > * mochiweb-1.3-rmq2.7.0-git
> > * rabbitmq_management-2.7.0
> > * rabbitmq_management_agent-2.7.0
> > * rabbitmq_mochiweb-2.7.0
> > * webmachine-1.7.0-rmq2.7.0-hg
> >
> > ** Found 0 name clashes in code paths
> >
> > +---+   +---+
> > |   |   |   |
> > |   |   |   |
> > |   |   |   |
> > |   +---+   +-------+
> > |                   |
> > | RabbitMQ  +---+   |
> > |           |   |   |
> > |   v2.7.0  +---+   |
> > |                   |
> > +-------------------+
> > AMQP 0-9-1 / 0-9 / 0-8
> > Copyright (C) 2007-2011 VMware, Inc.
> > Licensed under the MPL.  See http://www.rabbitmq.com/
> >
> > node           : rabbit at iuu-app007
> > app descriptor :
> > /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
> > home dir       : /var/lib/rabbitmq
> > config file(s) : (none)
> > cookie hash    : Fm+somLGFoQYy1H+2FUteQ==
> > log            : /var/log/rabbitmq/rabbit at iuu-app007.log
> > sasl log       : /var/log/rabbitmq/rabbit at iuu-app007-sasl.log
> > database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app007
> > erlang version : 5.8.5
> >
> > -- rabbit boot start
> > starting file handle cache server
> > ...done
> > starting worker pool
> > ...done
> > starting database
> > ...done
> > starting codec correctness check
> > ...done
> > -- external infrastructure ready
> > starting statistics event manager
> > ...done
> > starting logging server
> > ...done
> > starting plugin registry
> > ...done
> > starting auth mechanism amqplain
> > ...done
> > starting auth mechanism cr-demo
> > ...done
> > starting auth mechanism plain
> > ...done
> > starting exchange type direct
> > ...done
> > starting exchange type fanout
> > ...done
> > starting exchange type headers
> > ...done
> > starting exchange type topic
> > ...done
> > -- kernel ready
> > starting node monitor
> > ...done
> > starting cluster delegate
> > ...done
> > starting guid generator
> > ...done
> > starting alarm handler
> > ...done
> > starting memory monitor
> > ...done
> > -- core initialized
> > starting empty DB check
> > ...done
> > starting management agent
> > ...done
> > starting exchange, queue and binding recovery
> > ...done
> > starting mirror queue slave sup
> > ...done
> > starting adding mirrors to queues
> > ...done
> > -- message delivery logic ready
> > starting error log relay
> > ...done
> > starting networking
> > ...done
> > starting notify cluster nodes
> > ...done
> > starting direct_client
> > ...done
> >
> > broker running
> >
> >
> >
> > # rabbitmqctl cluster_status
> > Cluster status of node 'rabbit at iuu-app007' ...
> > [{nodes,[{disc,['rabbit at iuu-app007']}]},{running_nodes,['rabbit at iuu-app007']}]
> > ...done.
> >
> >
> > Node 2:
> > # rabbitmq-server --detached
> > Activating RabbitMQ plugins ...
> > 6 plugins activated:
> > * amqp_client-2.7.0
> > * mochiweb-1.3-rmq2.7.0-git
> > * rabbitmq_management-2.7.0
> > * rabbitmq_management_agent-2.7.0
> > * rabbitmq_mochiweb-2.7.0
> > * webmachine-1.7.0-rmq2.7.0-hg
> >
> > ** Found 0 name clashes in code paths
> > [SNIP]
> > node           : rabbit at iuu-app008
> > app descriptor :
> > /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
> > home dir       : /var/lib/rabbitmq
> > config file(s) : (none)
> > cookie hash    : VOYILJRa2vmMlRly95DYQw==
> > log            : /var/log/rabbitmq/rabbit at iuu-app008.log
> > sasl log       : /var/log/rabbitmq/rabbit at iuu-app008-sasl.log
> > database dir   : /var/lib/rabbitmq/mnesia/rabbit at iuu-app008
> > erlang version : 5.8.5
> > [SNIP]
> > broker running
> > Erlang has closed
> >
> > # rabbitmqctl stop_app
> > Stopping node 'rabbit at iuu-app008' ...
> > ...done.
> > [root at iuu-app008 ~]# rabbitmqctl reset
> > Resetting node 'rabbit at iuu-app008' ...
> > ...done.
> >
> > # rabbitmqctl cluster rabbit at iuu-app007
> > Clustering node 'rabbit at iuu-app008' with ['rabbit at iuu-app007'] ...
> > Error:
> > {no_running_cluster_nodes,['rabbit at iuu-app007'],['rabbit at iuu-app007']}
> >
> > I have tried the command above with the FQDN and had the same error
> > returned.
> >
> >
> > Any ideas where I could look?
> >
> > Simon.
> >
> Hi,
> 
>     Problem solved by copying the Erlang cookie from Node 1 onto Node 2.
> Successfully joined two nodes in a disc cluster.
> 
> 
> I createdthe  /etc/rabbitmq/rabbitmq-env.conf with this content:
> 
> [{rabbit, [{cluster_nodes, ['rabbit at iuu-app007', 'rabbit at iuu-app008']}]}].
> 
> #  rabbitmqctl cluster_status
> /etc/rabbitmq/rabbitmq-env.conf: line 1: [{rabbit,: command not found
> Cluster status of node 'rabbit at iuu-app008' ...
> [{nodes,[{disc,['rabbit at iuu-app008','rabbit at iuu-app007']}]},
>  {running_nodes,['rabbit at iuu-app007','rabbit at iuu-app008']}]
> ...done.
> 
> The syntax of the file looks fine to us, and also according to the
> documentation. :~(
> 
> 1) Is the syntax correct?
> 2) Should the rabbitmq-env.conf be placed on both nodes?
> 
> Regards, S.
> 
> -- 
> Simon Loewenthal/Tele2
> GSM: +31 6 2000 5427
> 
> ******** IMPORTANT NOTICE ********
> This e-mail (including any attachments) may contain information 
> that is confidential or otherwise protected from disclosure and
> it is intended only for the addressees. If you are not the intended
> recipient, please kindly refrain from copying or distribution.
> Other use of information contained in this e-mail (and its attachments)
> is frowned upon. If you have received this e-mail in error, kindly
> notify us immediately by telephone or e-mail and, if possible, kindly
> delete the message (including any attachments) from your system. Of
> course, this is not legal advice, nor is it a contract. If it were a
> contract, it would have an exchange of value and affirmative agreement
> by both parties. If it were legal advice, it should be written by a
> lawyer and would have a bill attached.
> 
> It ought to be obvious my views in this Email might not represent my
> employer's views, & vice-verse. Please note that e-mail messages may
> contain computer viruses or other defects. I presume that you understand
> the concept of a computer virus, and took reasonable precautions.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sampo.savolainen at spatineo.com  Wed Dec 14 12:18:40 2011
From: sampo.savolainen at spatineo.com (Sampo Savolainen)
Date: Wed, 14 Dec 2011 14:18:40 +0200
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <4EDCA879.4020502@rabbitmq.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
	<4EC39721.7000201@rabbitmq.com> <4EC3ABB5.5080602@rabbitmq.com>
	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>
	<4EC3AF7F.3040905@rabbitmq.com>
	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>
	<4EC3B5D3.9040204@rabbitmq.com>
	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>
	<4EC3BDA9.30207@rabbitmq.com>
	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>
	<4EC4F469.70306@rabbitmq.com>
	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>
	<CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>
	<4EDCA1A5.8070102@rabbitmq.com> <4EDCA879.4020502@rabbitmq.com>
Message-ID: <CAL8b_0cRyrze=gA-gxQrtRa1+R9g-GONCTyQJn9U6URk86m_yg@mail.gmail.com>

On Mon, Dec 5, 2011 at 1:18 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/12/11 10:49, Simon MacMullen wrote:
>
>> Hmm. We use su to run rabbitmq-server as the "rabbitmq" user. Erlang
>> doesn't have the ability to setuid, so I'm not sure what the alternative
>> is here. I will ask on the lp bug.
>>
>
> I can't read. The suggested alternative is start-stop-daemon. I've filed a
> bug.


Hi Simon,

Is there anything new to report on this front?


 Sampo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/7c48a81e/attachment.htm>

From bill_martin at freenet.de  Wed Dec 14 14:18:08 2011
From: bill_martin at freenet.de (bill_martin at freenet.de)
Date: Wed, 14 Dec 2011 15:18:08 +0100
Subject: [rabbitmq-discuss] Prevent to deliver a message to a certain
	consumer
Message-ID: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/fb7261cb/attachment.htm>

From c_showers at hotmail.com  Wed Dec 14 14:22:49 2011
From: c_showers at hotmail.com (Cory Showers)
Date: Wed, 14 Dec 2011 14:22:49 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
Message-ID: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>


Rabbit team,

I am interested in using RabbitMQ as our messaging broker of choice.  But I am a little concerend with the current AMQP specification.  The ver RabbitMQ supports is 0.9.1.  And since the new 1.0 specification has come out it seems to have changed quite a bit in terms of using the exchanges and bindings.  When RabbitMQ eventually supports ver 1.0 will this break the current api?



 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/7be71d6a/attachment.htm>

From simon at rabbitmq.com  Wed Dec 14 14:43:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 14:43:08 +0000
Subject: [rabbitmq-discuss] Will AMQP 1.0 break current RabbitMQ api
In-Reply-To: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
References: <COL115-W144DCA42965916E85E54C394A20@phx.gbl>
Message-ID: <4EE8B5FC.6020709@rabbitmq.com>

On 14/12/11 14:22, Cory Showers wrote:
> I am interested in using RabbitMQ as our messaging broker of choice. But
> I am a little concerend with the current AMQP specification. The ver
> RabbitMQ supports is 0.9.1. And since the new 1.0 specification has come
> out it seems to have changed quite a bit in terms of using the exchanges
> and bindings. When RabbitMQ eventually supports ver 1.0 will this break
> the current api?

You are right, 1.0 is a very different thing from 0-9-1.

It's not yet clear when (or indeed if) RabbitMQ will support AMQP 1.0. 
But even then we won't be removing 0-9-1 support for a *long* time I 
strongly suspect.

For example: We still support 0-8 because some clients still use it. 
This is despite the fact that 0-8 and 0-9-1 are conceptually very 
similar and really everyone ought to be able to move to 0-9-1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Dec 14 14:47:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 14:47:44 +0000
Subject: [rabbitmq-discuss] small bug deleting a user from the
 management interface
In-Reply-To: <CAMOXM2_8wetCa8Ohng1wQ2n0uZcXkNgzdLMZPeddXg24WaFYDg@mail.gmail.com>
References: <CAMOXM2_8wetCa8Ohng1wQ2n0uZcXkNgzdLMZPeddXg24WaFYDg@mail.gmail.com>
Message-ID: <4EE8B710.7080509@rabbitmq.com>

On 13/12/11 17:33, Massimo Paladin wrote:
> Hello,
>
> there is a small bug in the web interface which prevent to delete a user
> which contains " (quotation mark) in the username.

Ah, thanks for the report. Yes. This appears to apply to all objects, 
not just users.

> It works from rabbitmqctl.

The bug appears to be in the Javascript UI, so rabbitmqadmin works too.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Dec 14 14:48:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 14:48:07 +0000
Subject: [rabbitmq-discuss] timeout_waiting_for_tables on node that has
 not changed node name
In-Reply-To: <CAFDmHdP46h=NH1ZeM8sywN+Gsh8_+CBh9vi0y3u_FFq4=tmJDg@mail.gmail.com>
References: <CAFDmHdP46h=NH1ZeM8sywN+Gsh8_+CBh9vi0y3u_FFq4=tmJDg@mail.gmail.com>
Message-ID: <4EE8B727.1030702@rabbitmq.com>

On 13/12/11 17:07, Elias Levy wrote:
> That is exactly correct.  The short hostnames could not be resolved, but
> RabbitMQ, Mnesia, and Erlang all failed to generate any sort of warning
> to that effect, resulting in a bit of a goose chase trying to figure out
> why a perfectly good node was failing to rejoin the cluster after a
> simple restart.

Yes. I've opened a bug for better diagnostics here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Dec 14 14:48:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 14:48:41 +0000
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0cRyrze=gA-gxQrtRa1+R9g-GONCTyQJn9U6URk86m_yg@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>	<4EC39721.7000201@rabbitmq.com>	<4EC3ABB5.5080602@rabbitmq.com>	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>	<4EC3AF7F.3040905@rabbitmq.com>	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>	<4EC3B5D3.9040204@rabbitmq.com>	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>	<4EC3BDA9.30207@rabbitmq.com>	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>	<4EC4F469.70306@rabbitmq.com>	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>	<CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>	<4EDCA1A5.8070102@rabbitmq.com>	<4EDCA879.4020502@rabbitmq.com>
	<CAL8b_0cRyrze=gA-gxQrtRa1+R9g-GONCTyQJn9U6URk86m_yg@mail.gmail.com>
Message-ID: <4EE8B749.2030006@rabbitmq.com>

On 14/12/11 12:18, Sampo Savolainen wrote:
> Is there anything new to report on this front?

Not really - we've been working on other bugs I'm afraid...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dharrigan at gmail.com  Wed Dec 14 14:49:47 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 14:49:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
Message-ID: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>

Hi,

RabbitMQ 2.7.0 on Debian Testing.
Camel 2.8.3
Camel AMQP 2.8.3 (but pulled down Qpid 0.12 manually and jar included
on classpath).

Booted up a simple Camel context and I'm getting this:

    [java] 14:21:50.566 [mol-router] INFO
[org.apache.qpid.client.state.StateWaiter] [63  ] - New StateWaiter
:AMQState: id = 1 name: CONNECTION_NOT_STARTED:[AMQState: id = 4 name:
CONNECTION_OPEN, AMQState: id = 6 name: CONNECTION_CLOSED]
     [java] 14:21:50.576 [mol-router] INFO
[o.a.q.c.t.SocketTransportConnection     ] [62  ] - Using
SimpleByteBufferAllocator
     [java] 14:21:50.577 [mol-router] INFO
[o.a.q.c.transport.TransportConnection   ] [130 ] - Using Mina NIO
     [java] 14:21:50.577 [mol-router] INFO
[o.a.q.c.t.SocketTransportConnection     ] [76  ] - Attempting
connection to localhost/127.0.0.1:5672
     [java] 14:21:50.585 [mol-router] INFO
[o.a.q.client.protocol.AMQProtocolSession] [398 ] - Setting
ProtocolVersion to :0-91
     [java] 14:21:50.586 [mol-router] INFO
[o.a.q.c.h.ClientMethodDispatcherImpl    ] [99  ] - New Method
Dispatcher:AMQProtocolSession[AMQConnection:
     [java] Host: localhost
     [java] Port: 5672
     [java] Virtual Host:
     [java] Client ID: frodo1323872488113
     [java] Active session count: 0]
     [java] 14:21:50.590 [mol-router] INFO
[org.apache.qpid.client.AMQConnection    ] [475 ] - Connected with
ProtocolHandler Version:0-91
     [java] 14:21:50.591 [mol-router] INFO
[c.c.j.DefaultJmsMessageListenerContainer] [863 ] - Successfully
refreshed JMS Connection
     [java] 14:21:50.591 [mol-router] INFO
[org.apache.qpid.client.AMQSession       ] [537 ] - Created
session:org.apache.qpid.client.AMQSession_0_8 at 23d100f2
     [java] 14:21:50.595 [mol-router] INFO
[org.apache.qpid.client.AMQSession       ] [722 ] - Closing session:
org.apache.qpid.client.AMQSession_0_8 at 23d100f2
     [java] 14:21:50.596 [mol-router] INFO
[o.a.q.c.h.ChannelCloseOkMethodHandler   ] [45  ] - Received
channel-close-ok for channel-id 1

     [java] 14:21:55.597 [mol-router] WARN
[c.c.j.DefaultJmsMessageListenerContainer] [822 ] - Setup of JMS
message listener invoker failed for destination 'banFlushQueue' -
trying to recover. Cause: The new addressing based sytanx is not
supported for AMQP 0-8/0-9 versions

     [java] 14:21:55.599 [mol-router] INFO
[org.apache.qpid.client.AMQConnection    ] [350 ] -
Connection:amqp://guest:********@frodo1323872488113/?brokerlist='tcp://localhost:5672'
     [java] 14:21:55.599 [mol-router] INFO
[o.a.q.client.protocol.AMQProtocolSession] [110 ] - Using
ProtocolVersion for Session:0-10
     [java] 14:21:55.600 [mol-router] INFO
[o.a.q.c.h.ClientMethodDispatcherImpl    ] [99  ] - New Method
Dispatcher:AMQProtocolSession[null]
     [java] 14:21:55.600 [mol-router] INFO
[org.apache.qpid.client.AMQConnection    ] [384 ] - Connecting with
ProtocolHandler Version:0-10
     [java] 14:21:55.602 [mol-router] INFO
[org.apache.qpid.client.AMQConnection    ] [502 ] - Looking up
delegate 'org.apache.qpid.client.AMQConnectionDelegate_9_1' Based on
PE:9-1
     [java] 14:21:55.602 [mol-router] INFO
[o.a.q.client.protocol.AMQProtocolSession] [398 ] - Setting
ProtocolVersion to :0-91
     [java] 14:21:55.602 [mol-router] INFO
[o.a.q.c.h.ClientMethodDispatcherImpl    ] [99  ] - New Method
Dispatcher:AMQProtocolSession[AMQConnection:

I'm watching my client connect to RabbitMQ (using the lovely web
interface) then after 5 seconds the connection is terminated, this
repeats ad-infinitum. The RabbitMQ logs simply report:

=ERROR REPORT==== 14-Dec-2011::14:21:55 ===
exception on TCP connection <0.1141.0> from 127.0.0.1:45985
{bad_version,1,1,0,10}

=INFO REPORT==== 14-Dec-2011::14:21:55 ===
closing TCP connection <0.1141.0> from 127.0.0.1:45985

=INFO REPORT==== 14-Dec-2011::14:21:55 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:45986

=INFO REPORT==== 14-Dec-2011::14:21:55 ===
starting TCP connection <0.1145.0> from 127.0.0.1:45986

=INFO REPORT==== 14-Dec-2011::14:22:00 ===
closing TCP connection <0.1145.0> from 127.0.0.1:45986

I notice the WARN message in the Camel logs re:  Setup of JMS message
listener...

I'm at a loss as here, I'm just learning about RabbitMQ and can't
understand why the connection is failing. Can anyone offer any helpful
insights?

Thank you.

-=david=-

-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From simon at rabbitmq.com  Wed Dec 14 15:02:26 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 15:02:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
Message-ID: <4EE8BA82.2050004@rabbitmq.com>

On 14/12/11 14:49, David Harrigan wrote:
> The RabbitMQ logs simply report:
>
> =ERROR REPORT==== 14-Dec-2011::14:21:55 ===
> exception on TCP connection<0.1141.0>  from 127.0.0.1:45985
> {bad_version,1,1,0,10}

That suggests that the camel client is trying to connect using AMQP 
0-10, which we don't support.

I'm not sure whether it can be made to speak 0-9-1, the logs you posted 
suggest it sometimes thinks it is:

 > [org.apache.qpid.client.AMQConnection    ] [502 ] - Looking up
 > delegate 'org.apache.qpid.client.AMQConnectionDelegate_9_1' Based on
 > PE:9-1

 >       [java] 14:21:55.602 [mol-router] INFO
 > [o.a.q.client.protocol.AMQProtocolSession] [398 ] - Setting
 > ProtocolVersion to :0-91

...but sometimes it thinks it isn't:

 >       [java] 14:21:55.600 [mol-router] INFO
 > [org.apache.qpid.client.AMQConnection    ] [384 ] - Connecting with
 > ProtocolHandler Version:0-10

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vbernard42 at gmail.com  Wed Dec 14 15:05:31 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Wed, 14 Dec 2011 07:05:31 -0800 (PST)
Subject: [rabbitmq-discuss] Prevent to deliver a message to a certain
	consumer
In-Reply-To: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>
References: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>
Message-ID: <2af8fd31-7f6b-4901-af50-4273ba640ece@t16g2000vba.googlegroups.com>

Hi,

I think that would be the "no-local" property of basic.consume, but
RabbitMQ doesn't support it. I can't really see other ways to emulate
that behavior easily...

Cheers,

Valentin.

On 14 d?c, 15:18, bill_mar... at freenet.de wrote:
> Hi,
>
>
>
> I am writing an application which allows users to communicate with each other via RabbitMQ.
>
> Each user-application contains a producer and a receiver to publish or receive messages to/from a direct exchange. Each user can bind to a "chat-room".
>
>
>
> Imagine two users (UserA and UserB). UserA binds to "chatRoom1" and UserB binds to "chatRoom1".
>
> If UserA publishes a message in "chatRoom1" the consumer of the user-application from UserB and the consumer of the user-application from UserA gets the message.
>
>
>
> I want to prevent that a user gets his own messages to reduce network traffic.
>
> Is it possible?
>
>
>
> Thanks in advance for your help!
>
>
>
> Kind regards,
>
> Bill
> ---E-Mail ist da wo du bist!Jetzt mit freenetMail ganz bequem auch unterwegs E-Mails verschicken.
> Am besten gleich informieren unterhttp://mail.freenet.de/mobile-email/index.html
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dharrigan at gmail.com  Wed Dec 14 15:05:45 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 15:05:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <4EE8BA82.2050004@rabbitmq.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<4EE8BA82.2050004@rabbitmq.com>
Message-ID: <CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>

I see,

so if I can force my client to talk using 0-91 then all should be well?

-=david=-

On 14 December 2011 15:02, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 14/12/11 14:49, David Harrigan wrote:
>>
>> The RabbitMQ logs simply report:
>>
>> =ERROR REPORT==== 14-Dec-2011::14:21:55 ===
>> exception on TCP connection<0.1141.0> ?from 127.0.0.1:45985
>> {bad_version,1,1,0,10}
>
>
> That suggests that the camel client is trying to connect using AMQP 0-10,
> which we don't support.
>
> I'm not sure whether it can be made to speak 0-9-1, the logs you posted
> suggest it sometimes thinks it is:
>
>
>> [org.apache.qpid.client.AMQConnection ? ?] [502 ] - Looking up
>> delegate 'org.apache.qpid.client.AMQConnectionDelegate_9_1' Based on
>> PE:9-1
>
>> ? ? ? [java] 14:21:55.602 [mol-router] INFO
>> [o.a.q.client.protocol.AMQProtocolSession] [398 ] - Setting
>> ProtocolVersion to :0-91
>
> ...but sometimes it thinks it isn't:
>
>
>> ? ? ? [java] 14:21:55.600 [mol-router] INFO
>> [org.apache.qpid.client.AMQConnection ? ?] [384 ] - Connecting with
>> ProtocolHandler Version:0-10
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From simon at rabbitmq.com  Wed Dec 14 15:08:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 15:08:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>	<4EE8BA82.2050004@rabbitmq.com>
	<CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>
Message-ID: <4EE8BBE9.10406@rabbitmq.com>

On 14/12/11 15:05, David Harrigan wrote:
> so if I can force my client to talk using 0-91 then all should be well?

I believe so, although I'm not sure how good the 0-9-1 support is in 
recent QPid. Do let us know if you get it working.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dharrigan at gmail.com  Wed Dec 14 15:10:45 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 15:10:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <4EE8BBE9.10406@rabbitmq.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<4EE8BA82.2050004@rabbitmq.com>
	<CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>
	<4EE8BBE9.10406@rabbitmq.com>
Message-ID: <CAKdGheO+J5A7FBVcdW9cc9otPs+5CQhcSVnw+kz2QFFUxCTnrg@mail.gmail.com>

I shall.

Accord to this: http://qpid.apache.org/download.html the 0.12 release
supports 0.9. That's hopeful.

-=david=-

On 14 December 2011 15:08, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 14/12/11 15:05, David Harrigan wrote:
>>
>> so if I can force my client to talk using 0-91 then all should be well?
>
>
> I believe so, although I'm not sure how good the 0-9-1 support is in recent
> QPid. Do let us know if you get it working.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From simon at rabbitmq.com  Wed Dec 14 15:19:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 15:19:33 +0000
Subject: [rabbitmq-discuss] Erlang R15B and RabbitMQ 2.7.0
Message-ID: <4EE8BE85.2050100@rabbitmq.com>

Erlang R15B has been released! Woo! Early Christmas present!

http://erlang.org/pipermail/erlang-questions/2011-December/063154.html

...but for you early adopters out there I should point out a couple of 
known incompatibilities with RabbitMQ 2.7.0:

* rabbitmq-stomp does not work at all
* rabbitmq-auth-backend-ldap cannot use SSL

These will be fixed in 2.7.1 (along with a bunch of other bugs), which 
we will hopefully release soon...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ekirpichov at gmail.com  Wed Dec 14 15:26:51 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 14 Dec 2011 19:26:51 +0400
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)
	database
Message-ID: <CANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA+bUCn_ZJMM-FYUQXng@mail.gmail.com>

Hello,

The following sad story happened on my colleague's computer, which is on
Windows btw.

He had RabbitMQ running, then ran out of hard drive space, cleaned up some
of it, but after that RabbitMQ wouldn't start.

It would hang at "starting exchange, queue and binding recovery
            ...(never writes 'done')"
It didn't eat CPU or disk or anything.
The erl.exe process had a win32sysinfo.exe subprocess.

RabbitMQ started fine after he cleaned the mnesia database directory.

I'm attaching the output of rabbitmqctl start, a bunch of logs, and
rabbitmqctl report.
Looks like the logs have some failing stack traces, so I believe this
should be enough to diagnose the problem.

Is this a known issue that's been fixed in later versions?

Thanks.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.htm>
-------------- next part --------------
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.6.1
* mochiweb-1.3-rmq2.6.1-git9a53dbd
* rabbitmq_management-2.6.1
* rabbitmq_management_agent-2.6.1
* rabbitmq_mochiweb-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at PC-XXXX
app descriptor : c:/Program Files/RabbitMQ Server/rabbitmq_server-2.6.1/sbin/../
ebin/rabbit.app
home dir       : C:\Documents and Settings\xxxx
config file(s) : (none)
cookie hash    : Hhk3jEOtwmGJum0J9RhHuA==
log            : C:/Documents and Settings/xxxx/Application Data/RabbitMQ/l
og/rabbit at PC-XXXX.log
sasl log       : C:/Documents and Settings/xxxx/Application Data/RabbitMQ/l
og/rabbit at PC-XXXX-sasl.log
database dir   : c:/Documents and Settings/xxxx/Application Data/RabbitMQ/d
b/rabbit at PC-XXXX-mnesia
erlang version : 5.8.1.1

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting plugin registry                                              ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism plain                                         ...done
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting management agent                                             ...done
starting exchange, queue and binding recovery                         ...<hangs here>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at PC-XXXX.log
Type: application/octet-stream
Size: 1172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at PC-XXXX.log.1
Type: application/octet-stream
Size: 1171 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at PC-XXXX-sasl.log
Type: application/octet-stream
Size: 3426 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at PC-XXXX-sasl.log.1
Type: application/octet-stream
Size: 3423 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0003.obj>
-------------- next part --------------
Reporting server status on {{2011,12,14},{15,8,12}}

Status of node 'rabbit at PC-XXXX' ...
[{pid,3700},
 {running_applications,
     [{os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.2"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.6.1"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.6.1-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.5"},
      {mnesia,"MNESIA  CXC 138 12","4.4.15"},
      {stdlib,"ERTS  CXC 138 10","1.17.1"},
      {kernel,"ERTS  CXC 138 10","2.14.1"}]},
 {os,{win32,nt}},
 {erlang_version,
     "Erlang R14B (erts-5.8.1.1) [smp:4:4] [rq:4] [async-threads:30]\n"},
 {memory,
     [{total,16613712},
      {processes,5623444},
      {processes_used,5618028},
      {system,10990268},
      {atom,888869},
      {atom_used,860516},
      {binary,155328},
      {code,7981680},
      {ets,621700}]}]

Cluster status of node 'rabbit at PC-XXXX' ...
[{nodes,[{disc,['rabbit at PC-XXXX']}]},
 {running_nodes,['rabbit at PC-XXXX']}]

Application environment of node 'rabbit at PC-XXXX' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:

Consumers on /:

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.

From simon at rabbitmq.com  Wed Dec 14 15:32:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 15:32:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt
 (?)	database
In-Reply-To: <CANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA+bUCn_ZJMM-FYUQXng@mail.gmail.com>
References: <CANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA+bUCn_ZJMM-FYUQXng@mail.gmail.com>
Message-ID: <4EE8C18C.6040607@rabbitmq.com>

On 14/12/11 15:26, Eugene Kirpichov wrote:
> ** When Server state == 2
> ** Reason for termination ==
> ** {{badmatch,eof},
>      [{rabbit_queue_index,load_segment,2},
>       {rabbit_queue_index,'-recover_journal/1-fun-0-',1},
>       {dict,map_bucket,2},
>       {dict,map_bkt_list,2},
>       {dict,map_bkt_list,2},
>       {dict,map_seg_list,2},
>       {dict,map_dict,2},
>       {rabbit_queue_index,segment_map,2}]}

This is fixed on default and will be in 2.7.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ekirpichov at gmail.com  Wed Dec 14 15:39:34 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 14 Dec 2011 19:39:34 +0400
Subject: [rabbitmq-discuss] Erlang R15B and RabbitMQ 2.7.0
In-Reply-To: <4EE8BE85.2050100@rabbitmq.com>
References: <4EE8BE85.2050100@rabbitmq.com>
Message-ID: <CANVKUrX0e_hSC4+gY3TmbKJzj0bk2YHPA10kHJX4b1Q+p+JnaQ@mail.gmail.com>

This is terrific!!! 64-bit Windows at last!!!

On Wed, Dec 14, 2011 at 7:19 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Erlang R15B has been released! Woo! Early Christmas present!
>
> http://erlang.org/pipermail/**erlang-questions/2011-**December/063154.html<http://erlang.org/pipermail/erlang-questions/2011-December/063154.html>
>
> ...but for you early adopters out there I should point out a couple of
> known incompatibilities with RabbitMQ 2.7.0:
>
> * rabbitmq-stomp does not work at all
> * rabbitmq-auth-backend-ldap cannot use SSL
>
> These will be fixed in 2.7.1 (along with a bunch of other bugs), which we
> will hopefully release soon...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/ee08e181/attachment.htm>

From ekirpichov at gmail.com  Wed Dec 14 15:44:54 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 14 Dec 2011 19:44:54 +0400
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt
 (?) database
In-Reply-To: <4EE8C18C.6040607@rabbitmq.com>
References: <CANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA+bUCn_ZJMM-FYUQXng@mail.gmail.com>
	<4EE8C18C.6040607@rabbitmq.com>
Message-ID: <CANVKUrXVj3bo51xTAPoStfBPBGPRQcNc8K00dn7HwCASYu0=Dw@mail.gmail.com>

Thanks!

On Wed, Dec 14, 2011 at 7:32 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/12/11 15:26, Eugene Kirpichov wrote:
>
>> ** When Server state == 2
>> ** Reason for termination ==
>> ** {{badmatch,eof},
>>     [{rabbit_queue_index,load_**segment,2},
>>      {rabbit_queue_index,'-recover_**journal/1-fun-0-',1},
>>      {dict,map_bucket,2},
>>      {dict,map_bkt_list,2},
>>      {dict,map_bkt_list,2},
>>      {dict,map_seg_list,2},
>>      {dict,map_dict,2},
>>      {rabbit_queue_index,segment_**map,2}]}
>>
>
> This is fixed on default and will be in 2.7.1.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/481f1877/attachment.htm>

From simon at rabbitmq.com  Wed Dec 14 17:00:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Dec 2011 17:00:27 +0000
Subject: [rabbitmq-discuss] Prevent to deliver a message to a certain
 consumer
In-Reply-To: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>
References: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>
Message-ID: <4EE8D62B.5000809@rabbitmq.com>

Here is one approach you could use. Let's stick with the idea that 
you're using routing keys for the chat room name. Furthermore each 
client publishes messages with a "user" header set to the user name.

So you have some top level exchange (presumably direct or topic) for 
chat room routing. When a new user comes on line, rather than just 
declaring a queue and binding to that exchange, they:

* Declare a fanout exchange.

* Declare a headers exchange and bind that to the top level exchange. 
The headers exchange should have its alternate-exchange set to point to 
the fanout exchange.

* Declare a "junk" queue, with message TTL 0, and bind this to their 
headers exchange with arguments ["user": <their username>].

* Declare a "message" queue and bind this to the fanout exchange.

So when they publish a message it goes to the headers exchange. This 
routes it to the junk queue where it expires immediately.

When someone else publishes a message it goes to the headers exchange. 
This can't route it, which makes it go to the alternate fanout exchange. 
This then routes it to the message queue.

The key point is the use of alternate-exchange for negation.

It's a tiny bit fiddly though, so an alternate approach would be to 
write your own exchange type.

Cheers, Simon

On 14/12/11 14:18, bill_martin at freenet.de wrote:
> Hi,
>
> I am writing an application which allows users to communicate with each
> other via RabbitMQ.
>
> Each user-application contains a producer and a receiver to publish or
> receive messages to/from a direct exchange. Each user can bind to a
> "chat-room".
>
> Imagine two users (UserA and UserB). UserA binds to "chatRoom1" and
> UserB binds to "chatRoom1".
>
> If UserA publishes a message in "chatRoom1" the consumer of the
> user-application from UserB and the consumer of the user-application
> from UserA gets the message.
>
> I want to prevent that a user gets his own messages to reduce network
> traffic.
>
> Is it possible?
>
> Thanks in advance for your help!
>
> Kind regards,
>
> Bill
>
>
>
> ---
> *E-Mail ist da wo du bist!* Jetzt mit freenetMail ganz bequem auch
> unterwegs E-Mails verschicken.
> Am besten gleich informieren unter
> http://mail.freenet.de/mobile-email/index.html
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Wed Dec 14 17:08:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Dec 2011 17:08:39 +0000
Subject: [rabbitmq-discuss] Prevent to deliver a message to a certain
 consumer
In-Reply-To: <4EE8D62B.5000809@rabbitmq.com>
References: <a452f2de802e99ba0462e12dc2979c7fe5c753be@webmail.freenet.de>
	<4EE8D62B.5000809@rabbitmq.com>
Message-ID: <4EE8D817.9010300@rabbitmq.com>

On 14/12/11 17:00, Simon MacMullen wrote:
> * Declare a "junk" queue, with message TTL 0, and bind this to their
> headers exchange with arguments ["user": <their username>].

Small improvement: you only need one "junk" queue, rather than one per user.

Matthias.

From dharrigan at gmail.com  Wed Dec 14 17:45:13 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 17:45:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheO+J5A7FBVcdW9cc9otPs+5CQhcSVnw+kz2QFFUxCTnrg@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<4EE8BA82.2050004@rabbitmq.com>
	<CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>
	<4EE8BBE9.10406@rabbitmq.com>
	<CAKdGheO+J5A7FBVcdW9cc9otPs+5CQhcSVnw+kz2QFFUxCTnrg@mail.gmail.com>
Message-ID: <CAKdGheO+22qYcyyhAAV2HMMaQHGOh=_=ufdvGE5cxnHfgZP46g@mail.gmail.com>

Hi,

Okay, I managed to convince the AMQP QPID camel client to talk to
RabbitMQ 2.7.0 using protocol 0-91 by doing this:

java -Dqpid.amqp.version=0-91 .......

I'm not getting any error message in my rabbit log to indicate a wrong
protocol. This just leaves two questions:

1. Is it still normal for my client to connect then be disconnected
every 5 seconds?

The answer to this is Yes - it appears that if the spring framework
DefaultMessageListenerContainer cannot recover from an error (see
below) it sleeps for 5 seconds then attempts again. That answers that
one.

2. Is this line normal?

WARN  [c.c.j.DefaultJmsMessageListenerContainer] [822 ] - Setup of JMS
message listener invoker failed for destination 'banFlushQueue' -
trying to recover. Cause: The new addressing based sytanx is not
supported for AMQP 0-8/0-9 versions

No idea what this means - but since it is being thrown it causes the 5
second reconnect attempt.

-=david=-


On 14 December 2011 15:10, David Harrigan <dharrigan at gmail.com> wrote:
> I shall.
>
> Accord to this: http://qpid.apache.org/download.html the 0.12 release
> supports 0.9. That's hopeful.
>
> -=david=-
>
> On 14 December 2011 15:08, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 14/12/11 15:05, David Harrigan wrote:
>>>
>>> so if I can force my client to talk using 0-91 then all should be well?
>>
>>
>> I believe so, although I'm not sure how good the 0-9-1 support is in recent
>> QPid. Do let us know if you get it working.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>
>
>
> --
> I prefer encrypted and signed messages. KeyID: B20A22F9
> Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9
>
> "It is not usually until you've built and used a version of the
> program that you understand the issues well enough to get the design
> right." - Rob Pike, Brian Kernighan.
>
> No trees were harmed in the sending of this message, however, a number
> of electrons were inconvenienced.



-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From dharrigan at gmail.com  Wed Dec 14 18:03:29 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 18:03:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheO+22qYcyyhAAV2HMMaQHGOh=_=ufdvGE5cxnHfgZP46g@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<4EE8BA82.2050004@rabbitmq.com>
	<CAKdGheP1xJ=3pL=Np_wfSg1KRpDjE=aLAoWnmmiGjnm02_ZrSg@mail.gmail.com>
	<4EE8BBE9.10406@rabbitmq.com>
	<CAKdGheO+J5A7FBVcdW9cc9otPs+5CQhcSVnw+kz2QFFUxCTnrg@mail.gmail.com>
	<CAKdGheO+22qYcyyhAAV2HMMaQHGOh=_=ufdvGE5cxnHfgZP46g@mail.gmail.com>
Message-ID: <CAKdGheNyTfeu29Tzz_qJfdL6ch3EyrYigjcHGDupuD9MqpgaaA@mail.gmail.com>

Hi All,

Another update:

I managed to get the QPID client to stop complaining by using this:

java -Dqpid.dest_syntax=BURL -Dqpid.amqp.version=0-9 ....

Right now, RabbitMQ is showing my one client connected and that it is
not reconnecting every 5 seconds. So, that's one hurdle down :-) Now
to see how it responds to messages being dropped into the queue... :-)

-=david=-

On 14 December 2011 17:45, David Harrigan <dharrigan at gmail.com> wrote:
> Hi,
>
> Okay, I managed to convince the AMQP QPID camel client to talk to
> RabbitMQ 2.7.0 using protocol 0-91 by doing this:
>
> java -Dqpid.amqp.version=0-91 .......
>
> I'm not getting any error message in my rabbit log to indicate a wrong
> protocol. This just leaves two questions:
>
> 1. Is it still normal for my client to connect then be disconnected
> every 5 seconds?
>
> The answer to this is Yes - it appears that if the spring framework
> DefaultMessageListenerContainer cannot recover from an error (see
> below) it sleeps for 5 seconds then attempts again. That answers that
> one.
>
> 2. Is this line normal?
>
> WARN ?[c.c.j.DefaultJmsMessageListenerContainer] [822 ] - Setup of JMS
> message listener invoker failed for destination 'banFlushQueue' -
> trying to recover. Cause: The new addressing based sytanx is not
> supported for AMQP 0-8/0-9 versions
>
> No idea what this means - but since it is being thrown it causes the 5
> second reconnect attempt.
>
> -=david=-
>
>
> On 14 December 2011 15:10, David Harrigan <dharrigan at gmail.com> wrote:
>> I shall.
>>
>> Accord to this: http://qpid.apache.org/download.html the 0.12 release
>> supports 0.9. That's hopeful.
>>
>> -=david=-
>>
>> On 14 December 2011 15:08, Simon MacMullen <simon at rabbitmq.com> wrote:
>>> On 14/12/11 15:05, David Harrigan wrote:
>>>>
>>>> so if I can force my client to talk using 0-91 then all should be well?
>>>
>>>
>>> I believe so, although I'm not sure how good the 0-9-1 support is in recent
>>> QPid. Do let us know if you get it working.
>>>
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>
>>
>>
>> --
>> I prefer encrypted and signed messages. KeyID: B20A22F9
>> Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9
>>
>> "It is not usually until you've built and used a version of the
>> program that you understand the issues well enough to get the design
>> right." - Rob Pike, Brian Kernighan.
>>
>> No trees were harmed in the sending of this message, however, a number
>> of electrons were inconvenienced.
>
>
>
> --
> I prefer encrypted and signed messages. KeyID: B20A22F9
> Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9
>
> "It is not usually until you've built and used a version of the
> program that you understand the issues well enough to get the design
> right." - Rob Pike, Brian Kernighan.
>
> No trees were harmed in the sending of this message, however, a number
> of electrons were inconvenienced.



-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From sampo.savolainen at spatineo.com  Wed Dec 14 20:06:20 2011
From: sampo.savolainen at spatineo.com (Sampo Savolainen)
Date: Wed, 14 Dec 2011 22:06:20 +0200
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <4EE8B749.2030006@rabbitmq.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
	<4EC39721.7000201@rabbitmq.com> <4EC3ABB5.5080602@rabbitmq.com>
	<CAL8b_0cWxwUAByo8UU9d8DUwfqe865uaR+oQfUV713M9_sgEMA@mail.gmail.com>
	<4EC3AF7F.3040905@rabbitmq.com>
	<CAL8b_0dTyV5X5u8sUxAkFxTmPFwmG4Mb88OY9mugykfM8MeywQ@mail.gmail.com>
	<4EC3B5D3.9040204@rabbitmq.com>
	<CAL8b_0dvrVNp8Svd9vXaAjFRkrumqaGDxQ92+9sC-VBkBa+mpQ@mail.gmail.com>
	<4EC3BDA9.30207@rabbitmq.com>
	<CAL8b_0faqoLvGEDYo2VN9XSF5kYK69pq-XMas6TiP3-+kB_usg@mail.gmail.com>
	<4EC4F469.70306@rabbitmq.com>
	<CAL8b_0eNz6bw=j7Qfcw02fJ0r_iokXY8z_YRAmhN8=WVPSy=gQ@mail.gmail.com>
	<CAL8b_0c6V36Z0ZcsSiL8VUjVVx1nc0FUTYEQ0R-tgb7HU8ucLA@mail.gmail.com>
	<4EDCA1A5.8070102@rabbitmq.com> <4EDCA879.4020502@rabbitmq.com>
	<CAL8b_0cRyrze=gA-gxQrtRa1+R9g-GONCTyQJn9U6URk86m_yg@mail.gmail.com>
	<4EE8B749.2030006@rabbitmq.com>
Message-ID: <CAL8b_0fDqYzf2FJ3zh_330VRyjmuK-vuP98LnayZSYgkkjyn4A@mail.gmail.com>

On Wed, Dec 14, 2011 at 4:48 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/12/11 12:18, Sampo Savolainen wrote:
>
>> Is there anything new to report on this front?
>>
>
> Not really - we've been working on other bugs I'm afraid...


Understandable. If and when you need testers give me a ping!


 Sampo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/ca50d8eb/attachment.htm>

From alan.antonuk at gmail.com  Wed Dec 14 20:15:41 2011
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 14 Dec 2011 15:15:41 -0500
Subject: [rabbitmq-discuss] rabbitmq-c API improvements for multiple channels
Message-ID: <CAAt2poJqy+pwASwhbChmAbF569w3xHM02sFJwNJ3ZSVKX8MoxA@mail.gmail.com>

I've been working on a c++ wrapper around rabbitmq-c that presents a
"humane" API to the programmer heavily inspired by the Puka project. (see:
https://github.com/alanxz/SimpleAmqpClient).

In developing this library I've run across several limitations of the
rabbitmq-c when working with multiple channels, the biggest issue being:

- There is no way to wait for a list of methods on a channel.
There is amqp_simple_wait_method() - however this suffers from some serious
drawbacks:
+ you can only specify one method to listen for
+ it calls abort() if a different method, or a method on a different
channel is received
A use case for this might be: doing a basic.publish, and you want to want
to wait for a basic.ack or a basic.return on a channel with confirms enabled

The way I got around this in SimpleAmqpClient was to only use
amqp_simple_wait_frame() and maintain queues of amqp_frame_t for each
channel that I have open.

However, this comes with one serious drawback: memory management. Each
decoded frame is allocated in a connection-wide amqp_pool_t.  Because of
this - it is impossible to recycle the pool and release memory unless you
have dealt with all of your pending amqp_frame_t's.  This becomes a problem
in pathological cases where you have two consumers sending simultaneously,
you can get in the situation that even though the client program eventually
deals with every consumed message, memory never gets released, because
there is always at least one frame queued up.

The above demonstrates the second biggest issue with the rabbitmq-c API:
memory management when dealing with multiple channels.  There is no way to
separate out memory allocation on, for example, a per-channel basis (with
the library client keeping track of the memory pools used for example).

Before I go on I'd like to mention one feature that I find useful with the
current API: it is possible to use something like select() before calling
amqp_simple_wait_frame() to setup a timeout while waiting for a consumer,
which is useful when developing single-threaded RPC apps.


So now the interesting part: how could the API be improved?

Some thoughts I've had dealing with the memory management:
1. Create a amqp_simple_wait_frame() variant that as one of the parameters
provides a callback to allocate memory, either something like a malloc()
call, which the client would then be responsible for freeing, or perhaps
something like get_amqp_pool(amqp_frame_t) which allows the client to
return a memory pool which rabbitmq-c would use to allocate memory for that
frame.  The amqp_frame_t would have to have some minimal amount of
information filled in - such as frame type and channel to be useful.

2. amqp_channel_t becomes a struct containing both the the channel_id and a
amqp_pool_t.  The amqp_pool would be used by the library to allocate frames
received on that channel.  The client would then be responsible for calling
amqp_pool_recycle at an appropriate point.

Some thoughts on improving the API to deal with multiple channels:
1. Add the following to the API:
amqp_simple_wait_frame_on_channel - wait for a frame on a specified channel
amqp_simple_wait_methods - wait for multiple methods on a specified
channel. Don't abort() if the wrong method, or channel is received, instead
queue up the frame as is done in amqp_simple_rpc
amqp_frames_enqueued_for_channel to add feature parity with
amqp_frames_enqueued
I started to code this up at one point but abandoned it as it didn't
support the interesting property of being able to use select() to specify a
timeout when calling amqp_simple_wait_frame_on_channel.  At least not
without adding timeout to the rabbitmq-c api, which didn't fit with how the
current rabbitmq-c api. Here's the implementation I came up with before I
abandoned it. I can't guarantee is completely free of bugs.
https://github.com/alanxz/rabbitmq-c/commits/simple_wait_frame/

2. Continue to duck the issue and allow clients to write their own code to
deal with multiple channels (fixing the memory management issue using one
of the above techniques)

3. Something I haven't thought of yet.

So anyone have any thoughts on all of this?

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/58b0c022/attachment.htm>

From james.poole at rsa.com  Wed Dec 14 21:18:46 2011
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Wed, 14 Dec 2011 16:18:46 -0500
Subject: [rabbitmq-discuss] RabbitMQ Windows Service Crash
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9902B@MX36A.corp.emc.com>

I was wondering if someone could point me in the right direction for finding
the reason for a crash with the RabbitMQ Windows Service.  It seem that from
time to time, if the service is restarted, the service will crash and the
process will exit.  

 

I have tried to get the console output as well as the SASL.log (SSL is
enabled), but neither one is pointing me in a direction to troubleshoot.
Also, I have the crash dump, but I'm not sure the proper way to share it to
the mail list.

 

Thanks for any help.

 

-James

 

-------------------------------------------------------------------------

Console Debug Log:

 

 

** Found 0 name clashes in code paths 

 

+---+   +---+

|   |   |   |

|   |   |   |

|   |   |   |

|   +---+   +-------+

|                   |

| RabbitMQ  +---+   |

|           |   |   |

|   v2.7.0  +---+   |

|                   |

+-------------------+

AMQP 0-9-1 / 0-9 / 0-8

Copyright (C) 2007-2011 VMware, Inc.

Licensed under the MPL.  See http://www.rabbitmq.com/

 

node           : rabbit at RABBITSERVER

app descriptor : c:/Program Files/RabbitMQ
Server/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app

home dir       : C:\Windows

config file(s) :
c:/Users/Administrator/AppData/Roaming/RabbitMQ/rabbitmq.config

cookie hash    : WOWJiMjg9O5Hu5yte6LSJA==

log            :
C:/Users/Administrator/AppData/Roaming/RabbitMQ/log/rabbit at RABBITSERVER.log

sasl log       :
C:/Users/Administrator/AppData/Roaming/RabbitMQ/log/rabbit at RABBITSERVER-sasl
.log

database dir   :
c:/Users/Administrator/AppData/Roaming/RabbitMQ/db/rabbit at RABBITSERVER-mnesi
a

erlang version : 5.8.5

 

-- rabbit boot start

starting file handle cache server
...done

starting worker pool
...done

starting database
...done

starting codec correctness check
...done

-- external infrastructure ready

starting statistics event manager
...done

starting logging server
...done

starting plugin registry
...done

starting auth mechanism amqplain
...done

starting auth mechanism cr-demo
...done

starting auth mechanism plain
...done

starting exchange type direct
...done

starting exchange type fanout
...done

starting exchange type headers
...done

starting exchange type topic
...done

-- kernel ready

starting node monitor
...done

starting cluster delegate
...done

starting guid generator
...done

starting alarm handler
...done

starting memory monitor
...done

-- core initialized

starting empty DB check
...done

starting management agent
...done

starting exchange, queue and binding recovery
...done

starting mirror queue slave sup
...done

starting adding mirrors to queues
...done

-- message delivery logic ready

starting error log relay
...done

starting networking
...done

starting notify cluster nodes
...done

starting direct_client
...done

 

broker running

Eshell V5.8.5  (abort with ^G)

(rabbit at RABBITSERVER)1> in message_loop

win32sysinfo:Erlang has closed.{"Kernel pid
terminated",application_controller,"{application_terminated,rabbitmq_managem
ent,shutdown}"}

 

Crash dump was written to:
C:/Users/Administrator/AppData/Roaming/RabbitMQ/erl_crash.dump

Kernel pid terminated (application_controller)
({application_terminated,rabbitmq_management,shutdown})

 

----------------------------------------------------------------------------
-----------------------------------

 

SASL log (not entire log. approx last 100 lines):

 

 

 

 

 

=CRASH REPORT==== 14-Dec-2011::13:16:32 ===

  crasher:

    initial call: rabbit_mgmt_db:init/1

    pid: <0.441.0>

    registered_name: []

    exception exit: {{case_clause,{none}},

                     [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},

                      {rabbit_mgmt_format,amqp_table,1},

                      {rabbit_mgmt_format,format_item,2},

                      {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                      {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                      {rabbit_mgmt_format,format,2},

                      {rabbit_mgmt_db,handle_created,4},

                      {rabbit_mgmt_db,handle_cast,2}]}

      in function  gen_server:terminate/6

    ancestors: [<0.400.0>,rabbit_mgmt_sup,<0.257.0>]

    messages: []

    links: [<0.400.0>]

    dictionary: []

    trap_exit: false

    status: running

    heap_size: 1597

    stack_size: 24

    reductions: 13506

  neighbours:

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {<0.400.0>,mirrored_supervisor}

     Context:    child_terminated

     Reason:     {{case_clause,{none}},

                  [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},

                   {rabbit_mgmt_format,amqp_table,1},

                   {rabbit_mgmt_format,format_item,2},

                   {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                   {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                   {rabbit_mgmt_format,format,2},

                   {rabbit_mgmt_db,handle_created,4},

                   {rabbit_mgmt_db,handle_cast,2}]}

     Offender:   [{pid,<0.441.0>},

                  {name,rabbit_mgmt_db},

                  {mfa,{rabbit_mgmt_db,start_link,[]}},

                  {restart_type,permanent},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=CRASH REPORT==== 14-Dec-2011::13:16:32 ===

  crasher:

    initial call: rabbit_mgmt_db:init/1

    pid: <0.445.0>

    registered_name: []

    exception exit: {{case_clause,{none}},

                     [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},

                      {rabbit_mgmt_format,amqp_table,1},

                      {rabbit_mgmt_format,format_item,2},

                      {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                      {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                      {rabbit_mgmt_format,format,2},

                      {rabbit_mgmt_db,handle_created,4},

                      {rabbit_mgmt_db,handle_cast,2}]}

      in function  gen_server:terminate/6

    ancestors: [<0.400.0>,rabbit_mgmt_sup,<0.257.0>]

   messages: []

    links: [<0.400.0>]

    dictionary: []

    trap_exit: false

    status: running

    heap_size: 1597

    stack_size: 24

    reductions: 13526

  neighbours:

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {<0.400.0>,mirrored_supervisor}

     Context:    child_terminated

     Reason:     {{case_clause,{none}},

                  [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},

                   {rabbit_mgmt_format,amqp_table,1},

                   {rabbit_mgmt_format,format_item,2},

                   {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                   {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},

                   {rabbit_mgmt_format,format,2},

                   {rabbit_mgmt_db,handle_created,4},

                   {rabbit_mgmt_db,handle_cast,2}]}

     Offender:   [{pid,<0.445.0>},

                  {name,rabbit_mgmt_db},

                  {mfa,{rabbit_mgmt_db,start_link,[]}},

                  {restart_type,permanent},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {<0.400.0>,mirrored_supervisor}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.445.0>},

                  {name,rabbit_mgmt_db},

                  {mfa,{rabbit_mgmt_db,start_link,[]}},

                  {restart_type,permanent},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {local,rabbit_mgmt_sup}

     Context:    child_terminated

     Reason:     shutdown

     Offender:   [{pid,<0.401.0>},

                  {name,mirroring},

                  {mfa,

                      {mirrored_supervisor,start_internal,

                          [rabbit_mgmt_sup,

                           [{rabbit_mgmt_db,

                                {rabbit_mgmt_db,start_link,[]},

                                permanent,4294967295,worker,

                                [rabbit_mgmt_db]}]]}},

                  {restart_type,permanent},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {local,rabbit_mgmt_sup}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.401.0>},

                  {name,mirroring},

                  {mfa,

                      {mirrored_supervisor,start_internal,

                          [rabbit_mgmt_sup,

                           [{rabbit_mgmt_db,

                                {rabbit_mgmt_db,start_link,[]},

                                permanent,4294967295,worker,

                                [rabbit_mgmt_db]}]]}},

                  {restart_type,permanent},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=SUPERVISOR REPORT==== 14-Dec-2011::13:16:32 ===

     Supervisor: {<0.233.0>,rabbit_channel_sup_sup}

     Context:    shutdown_error

     Reason:     shutdown

     Offender:   [{pid,<0.320.0>},

                  {name,channel_sup},

                  {mfa,{rabbit_channel_sup,start_link,[]}},

                  {restart_type,temporary},

                  {shutdown,infinity},

                  {child_type,supervisor}]

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/1e8e4050/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/1e8e4050/attachment.bin>

From deckerego at gmail.com  Wed Dec 14 21:57:43 2011
From: deckerego at gmail.com (DeckerEgo)
Date: Wed, 14 Dec 2011 13:57:43 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
Message-ID: <60a46255-ff50-4b54-a7c4-6c19b85b9310@y18g2000yqy.googlegroups.com>

If it helps, I have an alternate Camel component for RabbitMQ
available at:
https://github.com/Bluelock/camel-spring-amqp

Was written with Spring's AMQP framework rather than Qpid, which in
turn uses the RabbitMQ client libraries directly. Might be easier to
get that working.

On Dec 14, 9:49?am, David Harrigan <dharri... at gmail.com> wrote:
> Booted up a simple Camel context and I'm getting this:
> ..snip..
>
> I notice the WARN message in the Camel logs re: ?Setup of JMS message
> listener...
>
> I'm at a loss as here, I'm just learning about RabbitMQ and can't
> understand why the connection is failing. Can anyone offer any helpful
> insights?

From dharrigan at gmail.com  Wed Dec 14 22:00:48 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 14 Dec 2011 22:00:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <60a46255-ff50-4b54-a7c4-6c19b85b9310@y18g2000yqy.googlegroups.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<60a46255-ff50-4b54-a7c4-6c19b85b9310@y18g2000yqy.googlegroups.com>
Message-ID: <CAKdGheMK5Gdu2UiSmzLVbPNEm=Fac97+cAeKx4i6sYyN8Kgr7A@mail.gmail.com>

Hi DeckerEgo,

Yup, came across your component. Very interested in it. Had a problem
downloading it using Ivy from Sonatype - I see you did a recent commit
to your repo to fix a POM issue. For some reason the jar wouldn't
resolve. I'll try again tomorrow.

-=david=-

On 14 December 2011 21:57, DeckerEgo <deckerego at gmail.com> wrote:
> If it helps, I have an alternate Camel component for RabbitMQ
> available at:
> https://github.com/Bluelock/camel-spring-amqp
>
> Was written with Spring's AMQP framework rather than Qpid, which in
> turn uses the RabbitMQ client libraries directly. Might be easier to
> get that working.
>
> On Dec 14, 9:49?am, David Harrigan <dharri... at gmail.com> wrote:
>> Booted up a simple Camel context and I'm getting this:
>> ..snip..
>>
>> I notice the WARN message in the Camel logs re: ?Setup of JMS message
>> listener...
>>
>> I'm at a loss as here, I'm just learning about RabbitMQ and can't
>> understand why the connection is failing. Can anyone offer any helpful
>> insights?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From deckerego at gmail.com  Wed Dec 14 22:09:41 2011
From: deckerego at gmail.com (DeckerEgo)
Date: Wed, 14 Dec 2011 14:09:41 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and Camel not working?
In-Reply-To: <CAKdGheMK5Gdu2UiSmzLVbPNEm=Fac97+cAeKx4i6sYyN8Kgr7A@mail.gmail.com>
References: <CAKdGheMMh2ipsExZSCT_8HQ1h2h7tDx=Kg03YVg46_FkS0MxCw@mail.gmail.com>
	<60a46255-ff50-4b54-a7c4-6c19b85b9310@y18g2000yqy.googlegroups.com>
	<CAKdGheMK5Gdu2UiSmzLVbPNEm=Fac97+cAeKx4i6sYyN8Kgr7A@mail.gmail.com>
Message-ID: <29077d14-b237-4fc8-94e5-525853c9fc64@l19g2000yqc.googlegroups.com>

Indeed, I just pushed a change to the README and to the POMs about 5
minutes ago. If you obtain everything from 1.0-SNAPSHOT you should be
good. I've tested using Maven POMs and Ivy 2 via Grails and things
seem to be flowin' fine now.

If you still have Ivy 2 issues let me know and I'll have 'em fixed
right away.

On Dec 14, 5:00?pm, David Harrigan <dharri... at gmail.com> wrote:
> Hi DeckerEgo,
>
> Yup, came across your component. Very interested in it. Had a problem
> downloading it using Ivy from Sonatype - I see you did a recent commit
> to your repo to fix a POM issue. For some reason the jar wouldn't
> resolve. I'll try again tomorrow.
>
> -=david=-
>
> On 14 December 2011 21:57, DeckerEgo <decker... at gmail.com> wrote:
>
>
>
>
>
>
>
>
>
> > If it helps, I have an alternate Camel component for RabbitMQ
> > available at:
> >https://github.com/Bluelock/camel-spring-amqp
>
> > Was written with Spring's AMQP framework rather than Qpid, which in
> > turn uses the RabbitMQ client libraries directly. Might be easier to
> > get that working.
>
> > On Dec 14, 9:49?am, David Harrigan <dharri... at gmail.com> wrote:
> >> Booted up a simple Camel context and I'm getting this:
> >> ..snip..
>
> >> I notice the WARN message in the Camel logs re: ?Setup of JMS message
> >> listener...
>
> >> I'm at a loss as here, I'm just learning about RabbitMQ and can't
> >> understand why the connection is failing. Can anyone offer any helpful
> >> insights?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> I prefer encrypted and signed messages. KeyID: B20A22F9
> Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9
>
> "It is not usually until you've built and used a version of the
> program that you understand the issues well enough to get the design
> right." - Rob Pike, Brian Kernighan.
>
> No trees were harmed in the sending of this message, however, a number
> of electrons were inconvenienced.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Wed Dec 14 22:57:33 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 14 Dec 2011 15:57:33 -0700
Subject: [rabbitmq-discuss] 2.7.1 release w/ mirrored queue "nodes"
	distribution policy fixes
Message-ID: <CAHZAEpeWNWoozf_QZwwpXTU6kTDi_wKrqR+J83x-UdHp5cn7pw@mail.gmail.com>

When is the 2.7.1 release with the fixes to the mirrored queues
"nodes" distribution policy expected?

-J

From matthew at rabbitmq.com  Wed Dec 14 23:14:41 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 14 Dec 2011 23:14:41 +0000
Subject: [rabbitmq-discuss] 2.7.1 release w/ mirrored queue "nodes"
 distribution policy fixes
In-Reply-To: <CAHZAEpeWNWoozf_QZwwpXTU6kTDi_wKrqR+J83x-UdHp5cn7pw@mail.gmail.com>
References: <CAHZAEpeWNWoozf_QZwwpXTU6kTDi_wKrqR+J83x-UdHp5cn7pw@mail.gmail.com>
Message-ID: <20111214231441.GA5419@wellquite.org>

On Wed, Dec 14, 2011 at 03:57:33PM -0700, Jason J. W. Williams wrote:
> When is the 2.7.1 release with the fixes to the mirrored queues
> "nodes" distribution policy expected?

2.7.1 is expected soon. But 2.7.0 fixed that bug:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111109/116e9fd4/attachment.txt

bug fixes
- could not declare a mirrored queue with a policy of "nodes" and an
  explicit list of node names

Matthew

From walkeraj at gmail.com  Wed Dec 14 23:29:59 2011
From: walkeraj at gmail.com (Andy Walker)
Date: Wed, 14 Dec 2011 18:29:59 -0500
Subject: [rabbitmq-discuss] RabbitMq and POE::Component::Client::AMQP -
	Re-delivery to same client?
Message-ID: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>

So, I am playing around with the POE module in an attempt to get the hang
of using RabbitMQ.  I have written two programs, a producer and a consumer
that operate on a single, persistent queue.  Everything seems to work, save
for one thing:  In order to simulate failure, I have written the consumer
to randomly not ack the messages it receives.  The problem is that the
server does not seem to be re-delivering these messages.  If I kill and
restart the consumer, it receives all of the messages it didn't ack.  If I
leave it running, however, they never seem to be re-sent.  This concerns me
because, if I have five consumers running, and they all kick back a failure
on the same message (unlikely, yes, but possible), what happens to the
message?  Does it stay undelivered forever?  How do I solve this problem?

Code is here:  http://pastie.org/3017289
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/d05faab0/attachment.htm>

From simone.busoli at gmail.com  Wed Dec 14 23:36:10 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 15 Dec 2011 00:36:10 +0100
Subject: [rabbitmq-discuss] RabbitMq and POE::Component::Client::AMQP -
 Re-delivery to same client?
In-Reply-To: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>
References: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>
Message-ID: <CAOn7oW8W+1pHyJsRXnNa4yu-snBq2nAvP6Mk7G_4tJ23DrzNFQ@mail.gmail.com>

Andy, you would have to
recover<http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.recover>the
messages.

On Thu, Dec 15, 2011 at 00:29, Andy Walker <walkeraj at gmail.com> wrote:

> So, I am playing around with the POE module in an attempt to get the hang
> of using RabbitMQ.  I have written two programs, a producer and a consumer
> that operate on a single, persistent queue.  Everything seems to work, save
> for one thing:  In order to simulate failure, I have written the consumer
> to randomly not ack the messages it receives.  The problem is that the
> server does not seem to be re-delivering these messages.  If I kill and
> restart the consumer, it receives all of the messages it didn't ack.  If I
> leave it running, however, they never seem to be re-sent.  This concerns me
> because, if I have five consumers running, and they all kick back a failure
> on the same message (unlikely, yes, but possible), what happens to the
> message?  Does it stay undelivered forever?  How do I solve this problem?
>
> Code is here:  http://pastie.org/3017289
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/d5a4d78a/attachment.htm>

From matthias at rabbitmq.com  Wed Dec 14 23:44:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Dec 2011 23:44:36 +0000
Subject: [rabbitmq-discuss] RabbitMq and POE::Component::Client::AMQP -
 Re-delivery to same client?
In-Reply-To: <CAOn7oW8W+1pHyJsRXnNa4yu-snBq2nAvP6Mk7G_4tJ23DrzNFQ@mail.gmail.com>
References: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>
	<CAOn7oW8W+1pHyJsRXnNa4yu-snBq2nAvP6Mk7G_4tJ23DrzNFQ@mail.gmail.com>
Message-ID: <4EE934E4.8040506@rabbitmq.com>

On 14/12/11 23:36, Simone Busoli wrote:
> Andy, you would have to recover
> <http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.recover> the
> messages.

Be careful with basic.recover. It requeues everything unacked, 
*including any messages that may be in flight from the server to the 
client at the time*.

'basic.reject' or 'basic.nack' are usually more appropriate. They allow 
you to requeue individual messages.

Regards,

Matthias.

From walkeraj at gmail.com  Wed Dec 14 23:48:23 2011
From: walkeraj at gmail.com (Andy Walker)
Date: Wed, 14 Dec 2011 18:48:23 -0500
Subject: [rabbitmq-discuss] RabbitMq and POE::Component::Client::AMQP -
 Re-delivery to same client?
In-Reply-To: <4EE934E4.8040506@rabbitmq.com>
References: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>
	<CAOn7oW8W+1pHyJsRXnNa4yu-snBq2nAvP6Mk7G_4tJ23DrzNFQ@mail.gmail.com>
	<4EE934E4.8040506@rabbitmq.com>
Message-ID: <CADHhT=XwhHtjo+4HUYyiM1pnhDS=v1saMdPcWgVoyM_z71bv6Q@mail.gmail.com>

I see.  Is this something I need to be doing server-side?  Also, can it be
done within the context of this particular framework?

On Wed, Dec 14, 2011 at 6:44 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 14/12/11 23:36, Simone Busoli wrote:
>
>> Andy, you would have to recover
>> <http://www.rabbitmq.com/amqp-**0-9-1-reference.html#basic.**recover<http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.recover>>
>> the
>> messages.
>>
>
> Be careful with basic.recover. It requeues everything unacked, *including
> any messages that may be in flight from the server to the client at the
> time*.
>
> 'basic.reject' or 'basic.nack' are usually more appropriate. They allow
> you to requeue individual messages.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/6d19374e/attachment.htm>

From matthias at rabbitmq.com  Wed Dec 14 23:51:51 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 14 Dec 2011 23:51:51 +0000
Subject: [rabbitmq-discuss] RabbitMq and POE::Component::Client::AMQP -
 Re-delivery to same client?
In-Reply-To: <CADHhT=XwhHtjo+4HUYyiM1pnhDS=v1saMdPcWgVoyM_z71bv6Q@mail.gmail.com>
References: <CADHhT=VuHnZ-7jiiCjOo9bzU3PiLswvwYkJwJB_kiaV4KkpxuA@mail.gmail.com>	<CAOn7oW8W+1pHyJsRXnNa4yu-snBq2nAvP6Mk7G_4tJ23DrzNFQ@mail.gmail.com>	<4EE934E4.8040506@rabbitmq.com>
	<CADHhT=XwhHtjo+4HUYyiM1pnhDS=v1saMdPcWgVoyM_z71bv6Q@mail.gmail.com>
Message-ID: <4EE93697.1020305@rabbitmq.com>

On 14/12/11 23:48, Andy Walker wrote:
> I see.  Is this something I need to be doing server-side?

These are commands issued by the client.

> Also, can it be done within the context of this particular framework?

No idea, but it would be a strange client if it didn't provide an API 
for this.

Matthias.

From simone.busoli at gmail.com  Thu Dec 15 00:15:32 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 15 Dec 2011 01:15:32 +0100
Subject: [rabbitmq-discuss] Reliable "publishing"
Message-ID: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>

Hi, I'm trying to achieve some degree of reliability in publishing of
messages in order to guarantee that a message published by some peer gets
to the broker. I am using two strategies here:

   - wrap access to the channel for publishing so that publishes done by
   the application are first enqueued in a in-memory queue and then published
   to the broker only when it is known to be reachable. I am using the .NET
   client ConnectionShutdown events to figure out whether the broker is
   reachable, and rescheduling connection in case of failure. I have one
   thread emptying the in-memory queue which runs when the connection is
   established and pauses when it is not available
   - use publisher confirms and keeping track of the messages published but
   not acked or nacked by the broker

A couple of questions:

   - Is this a sensible approach? I have looked into how Shovel and
   (briefly) Federation handle publisher confirms when enabled but I didn't
   spot anything being done with unconfirmed messages except for removing them
   as soon as an ack from the broker arrives
   - What should I be doing with unconfirmed messages which have remained
   unconfirmed for some time? The broker is supposed to guarantee that either
   an ack or nack is sent, but what if the peer for any reason doesn't receive
   them for one or more messages? The unconfirmed deliveries will stay in the
   local collection/set/[wherever it makes sense to keep them in memory] and
   you would have to handle them first or then

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/9d6022b2/attachment.htm>

From jasonjwwilliams at gmail.com  Thu Dec 15 00:20:35 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 14 Dec 2011 17:20:35 -0700
Subject: [rabbitmq-discuss] 2.7.1 release w/ mirrored queue "nodes"
 distribution policy fixes
In-Reply-To: <20111214231441.GA5419@wellquite.org>
References: <CAHZAEpeWNWoozf_QZwwpXTU6kTDi_wKrqR+J83x-UdHp5cn7pw@mail.gmail.com>
	<20111214231441.GA5419@wellquite.org>
Message-ID: <CAHZAEpcg3ebud5YxGr=y+dnrREVS7ffqotaETfse6WYgpbtV=w@mail.gmail.com>

Hey Matthew,

> 2.7.1 is expected soon. But 2.7.0 fixed that bug:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111109/116e9fd4/attachment.txt
>
> bug fixes
> - could not declare a mirrored queue with a policy of "nodes" and an
> ?explicit list of node names

That must be why 2.7.0 stuck in my head, just remembered incorrectly
why. :) Thank you.

-J

From mattswe at gmail.com  Thu Dec 15 01:03:30 2011
From: mattswe at gmail.com (Matt Sweeney)
Date: Wed, 14 Dec 2011 17:03:30 -0800 (PST)
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <4EE72E22.5090708@rabbitmq.com>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>	<20110530141459.GA4152@wellquite.org>
	<8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>
	<4EE72E22.5090708@rabbitmq.com>
Message-ID: <23865799.32.1323911010541.JavaMail.geo-discussion-forums@prj1>



> The usual assumption is that clients that do not need to be connected 
> will disconnect, the server won't do it for them ;-)
>

That's how I assumed it worked.. but I seem to be accumulating connections 
at an alarming rate, even after they're no longer in use. Maybe I'm doing 
something wrong with the connections themselves?

I'm using Pika to connect, with code that looks something like this: (the 
"demo_send" portion)
http://pika.github.com/examples.html#id4

and then terminating the connection with `connection.close()`

does anything jump out as wrong with that?









-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/3a46d218/attachment.htm>

From simon at rabbitmq.com  Thu Dec 15 11:30:40 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Dec 2011 11:30:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ Windows Service Crash
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9902B@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9902B@MX36A.corp.emc.com>
Message-ID: <4EE9DA60.4000302@rabbitmq.com>

On 14/12/11 21:18, james.poole at rsa.com wrote:
>      exception exit: {{case_clause,{none}},
>                       [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},
>                        {rabbit_mgmt_format,amqp_table,1},
>                        {rabbit_mgmt_format,format_item,2},
>                        {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},
>                        {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},
>                        {rabbit_mgmt_format,format,2},
>                        {rabbit_mgmt_db,handle_created,4},
>                        {rabbit_mgmt_db,handle_cast,2}]}

Well, this is interesting. I think you've found a bug.

I believe you either have a high rate of connection churn or clients 
that reconnect with no timeout? The only way I can think this could 
happen would require a large number of connections being established the 
instant the server starts up.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.poole at rsa.com  Thu Dec 15 14:07:55 2011
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Thu, 15 Dec 2011 09:07:55 -0500
Subject: [rabbitmq-discuss] RabbitMQ Windows Service Crash
In-Reply-To: <4EE9DA60.4000302@rabbitmq.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9902B@MX36A.corp.emc.com>
	<4EE9DA60.4000302@rabbitmq.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9912C@MX36A.corp.emc.com>

Yeah, that sounds like that would probably be the correct scenario.  I had 7-8 
clients connecting/polling while the service was started/restarted.

Thanks for the feedback, so I don't have to think it's something on my end.

Is there anything I can do to help this get fixed?  If there is a public bug 
tracking system, I can enter it and get the crash dump uploaded.

-James

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon 
MacMullen
Sent: Thursday, December 15, 2011 6:31 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Windows Service Crash

On 14/12/11 21:18, james.poole at rsa.com wrote:
>      exception exit: {{case_clause,{none}},
>                       [{rabbit_mgmt_format,'-amqp_table/1-lc$^0/1-0-',1},
>                        {rabbit_mgmt_format,amqp_table,1},
>                        {rabbit_mgmt_format,format_item,2},
>                        {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},
>                        {rabbit_mgmt_format,'-format/2-lc$^0/1-0-',2},
>                        {rabbit_mgmt_format,format,2},
>                        {rabbit_mgmt_db,handle_created,4},
>                        {rabbit_mgmt_db,handle_cast,2}]}

Well, this is interesting. I think you've found a bug.

I believe you either have a high rate of connection churn or clients
that reconnect with no timeout? The only way I can think this could
happen would require a large number of connections being established the
instant the server starts up.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7172 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/b145cab0/attachment.bin>

From sahmed1020 at gmail.com  Thu Dec 15 19:44:30 2011
From: sahmed1020 at gmail.com (S Ahmed)
Date: Thu, 15 Dec 2011 14:44:30 -0500
Subject: [rabbitmq-discuss] persistent connections into rabbit server
Message-ID: <CAG2rwuMH3jCQqT1+kLNB6mG8YAggaToDVV25AR7kE5rLNPJ=uA@mail.gmail.com>

Should it be a concern if client nodes are connecting into rabbit using
a persistent connection?

At what point would this be an issue?  After 100 persistent connections or
is it more a matter of message traffic?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/41f270e3/attachment.htm>

From simon at rabbitmq.com  Fri Dec 16 10:36:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 10:36:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ Windows Service Crash
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9912C@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707E1F9902B@MX36A.corp.emc.com>
	<4EE9DA60.4000302@rabbitmq.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D707E1F9912C@MX36A.corp.emc.com>
Message-ID: <4EEB1F2C.9060201@rabbitmq.com>

On 15/12/11 14:07, james.poole at rsa.com wrote:
> Is there anything I can do to help this get fixed?  If there is a public bug
> tracking system, I can enter it and get the crash dump uploaded.

The stack trace was enough - this is already fixed in Mercurial. Thanks 
again for the bug report.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From colin.anderson333 at gmail.com  Thu Dec 15 15:12:05 2011
From: colin.anderson333 at gmail.com (cocowalla)
Date: Thu, 15 Dec 2011 07:12:05 -0800 (PST)
Subject: [rabbitmq-discuss] Secure Storage of Durable Messages?
Message-ID: <16849214.501.1323961925981.JavaMail.geo-discussion-forums@vbbeq1>

We can use SSL to secure messages in transit, but are durable messages 
stored securely, or is there a way to configure this?

By 'securely', I mean encrypted and/or cryptographically signed?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/74e58380/attachment.htm>

From Eyal.Post at clarizen.com  Thu Dec 15 20:53:45 2011
From: Eyal.Post at clarizen.com (Eyal Post)
Date: Thu, 15 Dec 2011 20:53:45 +0000
Subject: [rabbitmq-discuss] dotnet client background thread
Message-ID: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>

We have an issue with a .net client application that creates a connection in order to publish message and caches this connection in a variable. The problem is that when the program exits, it gets stuck in memory because there is an AMQP thread that doesn't exit.
I'm not sure how the RabbitMQ threads are created but in .net there is an option to set a thread as a background thread and in this case when the application closes it will not wait for background threads to stop. Is the .net client setting the background threads it creates background? If not, can you change that?
See here for more details: http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx

Eyal Post


______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
For more information please visit http://www.symanteccloud.com
______________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111215/1ccc9674/attachment.htm>

From emile at rabbitmq.com  Fri Dec 16 12:38:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Dec 2011 12:38:28 +0000
Subject: [rabbitmq-discuss] Secure Storage of Durable Messages?
In-Reply-To: <16849214.501.1323961925981.JavaMail.geo-discussion-forums@vbbeq1>
References: <16849214.501.1323961925981.JavaMail.geo-discussion-forums@vbbeq1>
Message-ID: <4EEB3BC4.3040702@rabbitmq.com>

Hi Colin,

On 15/12/11 15:12, cocowalla wrote:
> We can use SSL to secure messages in transit, but are durable messages
> stored securely, or is there a way to configure this?
> 
> By 'securely', I mean encrypted and/or cryptographically signed?

No, messages that get stored on disk are not persisted securely and no
such option is currently available.

You could point $RABBITMQ_MNESIA_BASE at an encrypted filesystem.

Another alternative is to encrypt individual message payloads. Bear in
mind that the rest of the message envelope (including headers if you
didn't encrypt them separately) will still be readable.


-Emile

From simon at rabbitmq.com  Fri Dec 16 13:10:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 13:10:21 +0000
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <23865799.32.1323911010541.JavaMail.geo-discussion-forums@prj1>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>	<20110530141459.GA4152@wellquite.org>	<8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>	<4EE72E22.5090708@rabbitmq.com>
	<23865799.32.1323911010541.JavaMail.geo-discussion-forums@prj1>
Message-ID: <4EEB433D.3060405@rabbitmq.com>

Nothing jumps out as wrong with that but I would still put money on the 
idea that you're doing something wrong. This is really basic stuff for 
Pika; I would find it hard to believe that it's broken.

Are you definitely reaching the connection.close() in your code? Sorry 
if that sounds obvious...

Cheers, Simon

On 15/12/11 01:03, Matt Sweeney wrote:
>
>     The usual assumption is that clients that do not need to be connected
>     will disconnect, the server won't do it for them ;-)
>
>
> That's how I assumed it worked.. but I seem to be accumulating
> connections at an alarming rate, even after they're no longer in use.
> Maybe I'm doing something wrong with the connections themselves?
>
> I'm using Pika to connect, with code that looks something like this:
> (the "demo_send" portion)
> http://pika.github.com/examples.html#id4
>
> and then terminating the connection with `connection.close()`
>
> does anything jump out as wrong with that?




-- 
Simon MacMullen
RabbitMQ, VMware

From colin.anderson333 at gmail.com  Fri Dec 16 13:10:39 2011
From: colin.anderson333 at gmail.com (cocowalla)
Date: Fri, 16 Dec 2011 05:10:39 -0800 (PST)
Subject: [rabbitmq-discuss] Secure Storage of Durable Messages?
In-Reply-To: <4EEB3BC4.3040702@rabbitmq.com>
References: <16849214.501.1323961925981.JavaMail.geo-discussion-forums@vbbeq1>
	<4EEB3BC4.3040702@rabbitmq.com>
Message-ID: <14787487.277.1324041039872.JavaMail.geo-discussion-forums@yqmw40>

This is what I suspected, so I'll probably encrypt the message payload (no 
issue for me about headers not being encrypted)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/c39ab879/attachment.htm>

From simon at rabbitmq.com  Fri Dec 16 13:16:46 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 13:16:46 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
Message-ID: <4EEB44BE.7060304@rabbitmq.com>

Yes, this is a reasonable approach. Shovel / federation both chain acks 
and confirms together, so that one broker or the other is always 
responsible for the message.

As to your second question: the real answer is likely to be specific to 
your application. But messages should not remain unconfirmed 
indefinitely. The only reason your client might not receive a (n)ack for 
any given message would be if the connection goes down.

Cheers, Simon

On 15/12/11 00:15, Simone Busoli wrote:
> Hi, I'm trying to achieve some degree of reliability in publishing of
> messages in order to guarantee that a message published by some peer
> gets to the broker. I am using two strategies here:
>
>     * wrap access to the channel for publishing so that publishes done
>       by the application are first enqueued in a in-memory queue and
>       then published to the broker only when it is known to be
>       reachable. I am using the .NET client ConnectionShutdown events to
>       figure out whether the broker is reachable, and rescheduling
>       connection in case of failure. I have one thread emptying the
>       in-memory queue which runs when the connection is established and
>       pauses when it is not available
>     * use publisher confirms and keeping track of the messages published
>       but not acked or nacked by the broker
>
> A couple of questions:
>
>     * Is this a sensible approach? I have looked into how Shovel and
>       (briefly) Federation handle publisher confirms when enabled but I
>       didn't spot anything being done with unconfirmed messages except
>       for removing them as soon as an ack from the broker arrives
>     * What should I be doing with unconfirmed messages which have
>       remained unconfirmed for some time? The broker is supposed to
>       guarantee that either an ack or nack is sent, but what if the peer
>       for any reason doesn't receive them for one or more messages? The
>       unconfirmed deliveries will stay in the local
>       collection/set/[wherever it makes sense to keep them in memory]
>       and you would have to handle them first or then
>
> Thanks
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Dec 16 13:27:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 13:27:45 +0000
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
Message-ID: <4EEB4751.3010108@rabbitmq.com>

We've had this argument back and forth a bit for both the Java and .NET 
clients. The reason why we've been reluctant to do this is that by 
making connections use daemon / background threads we encourage a 
situation where connections don't get properly closed when your 
application shuts down.

So for example if your application publishes a load of messages and then 
exits, if we used background threads then things would appear to work 
but there would be no guarantee that all the messages would reach the 
broker.

So really the right thing to do is explicitly close connections at shut 
down - then you know that everything you thought the connections were 
doing is actually done.

Cheers, Simon

On 15/12/11 20:53, Eyal Post wrote:
> We have an issue with a .net client application that creates a
> connection in order to publish message and caches this connection in a
> variable. The problem is that when the program exits, it gets stuck in
> memory because there is an AMQP thread that doesn?t exit.
>
> I?m not sure how the RabbitMQ threads are created but in .net there is
> an option to set a thread as a background thread and in this case when
> the application closes it will not wait for background threads to stop.
> Is the .net client setting the background threads it creates background?
> If not, can you change that?
>
> See here for more details:
> http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx
>
> Eyal Post
>
>
> ______________________________________________________________________
> This email has been scanned by the Symantec Email Security.cloud service.
> For more information please visit http://www.symanteccloud.com
> ______________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Dec 16 13:32:47 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 13:32:47 +0000
Subject: [rabbitmq-discuss] persistent connections into rabbit server
In-Reply-To: <CAG2rwuMH3jCQqT1+kLNB6mG8YAggaToDVV25AR7kE5rLNPJ=uA@mail.gmail.com>
References: <CAG2rwuMH3jCQqT1+kLNB6mG8YAggaToDVV25AR7kE5rLNPJ=uA@mail.gmail.com>
Message-ID: <4EEB487F.1080504@rabbitmq.com>

(I assume by "persistent" you mean "long lived" not "stored on disk".)

No, this should not be a problem; AMQP connections are supposed to be 
able to stick around.

The number of simultaneous connections is limited by the number of file 
descriptors available - controlled by ulimit on Unix and the environment 
variable ERL_MAX_PORTS on Windows. So for lots of connections you may 
need to tweak this.

The mgmt plugin will let you know how many file descriptors are in use.

Cheers, Simon

On 15/12/11 19:44, S Ahmed wrote:
> Should it be a concern if client nodes are connecting into rabbit using
> a persistent connection?
>
> At what point would this be an issue?  After 100 persistent connections
> or is it more a matter of message traffic?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Fri Dec 16 14:43:52 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 16 Dec 2011 09:43:52 -0500
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <4EEB4751.3010108@rabbitmq.com>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
	<4EEB4751.3010108@rabbitmq.com>
Message-ID: <CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>

This is a really interesting point. Lots of systems have a "vetoable
shutdown about to happen", "non-vetoable shutdown about to happen",
"non-vetoable shutdown imminent" set of events:

   - Unix traditionally used wall(1)
   - Windows and OS X apps ask you "Save this document before quitting?"
   - OS X on shutdown or restart gives apps a chance to abandon or delay
   the shutdown

Stepping back from the immediate problem, the "real" solution is to have
the JVM and .NET virtual machines grow up and behave like proper systems,
complete with lifecycle events. Then, AMQP connections have a chance to
clean up and disconnect on their own, without special action on the part of
the programmer and without unduly delaying or preventing VM shutdown.

Thinking on it, lifecycle events like these are probably already present in
the .NET world actually. Does anyone know where to look?

Cheers,
  Tony

On 16 December 2011 08:27, Simon MacMullen <simon at rabbitmq.com> wrote:

> We've had this argument back and forth a bit for both the Java and .NET
> clients. The reason why we've been reluctant to do this is that by making
> connections use daemon / background threads we encourage a situation where
> connections don't get properly closed when your application shuts down.
>
> So for example if your application publishes a load of messages and then
> exits, if we used background threads then things would appear to work but
> there would be no guarantee that all the messages would reach the broker.
>
> So really the right thing to do is explicitly close connections at shut
> down - then you know that everything you thought the connections were doing
> is actually done.
>
> Cheers, Simon
>
>
> On 15/12/11 20:53, Eyal Post wrote:
>
>> We have an issue with a .net client application that creates a
>> connection in order to publish message and caches this connection in a
>> variable. The problem is that when the program exits, it gets stuck in
>> memory because there is an AMQP thread that doesn?t exit.
>>
>> I?m not sure how the RabbitMQ threads are created but in .net there is
>> an option to set a thread as a background thread and in this case when
>> the application closes it will not wait for background threads to stop.
>> Is the .net client setting the background threads it creates background?
>> If not, can you change that?
>>
>> See here for more details:
>> http://msdn.microsoft.com/en-**us/library/system.threading.**
>> thread.isbackground.aspx<http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx>
>>
>> Eyal Post
>>
>>
>> ______________________________**______________________________**
>> __________
>> This email has been scanned by the Symantec Email Security.cloud service.
>> For more information please visit http://www.symanteccloud.com
>> ______________________________**______________________________**
>> __________
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/4c491181/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Fri Dec 16 14:52:26 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 16 Dec 2011 09:52:26 -0500
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
	<4EEB4751.3010108@rabbitmq.com>
	<CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
Message-ID: <CAM8fPiS7wYU4wiZOc8yAMNy06Zapb6Uqoc=7x-QxEM=h5uzqnQ@mail.gmail.com>

The ProcessExit event of System.AppDomain.CurrentDomain might be what's
sought here:
http://msdn.microsoft.com/en-us/library/system.appdomain.processexit.aspx


On 16 December 2011 09:43, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> This is a really interesting point. Lots of systems have a "vetoable
> shutdown about to happen", "non-vetoable shutdown about to happen",
> "non-vetoable shutdown imminent" set of events:
>
>    - Unix traditionally used wall(1)
>    - Windows and OS X apps ask you "Save this document before quitting?"
>    - OS X on shutdown or restart gives apps a chance to abandon or delay
>    the shutdown
>
> Stepping back from the immediate problem, the "real" solution is to have
> the JVM and .NET virtual machines grow up and behave like proper systems,
> complete with lifecycle events. Then, AMQP connections have a chance to
> clean up and disconnect on their own, without special action on the part of
> the programmer and without unduly delaying or preventing VM shutdown.
>
> Thinking on it, lifecycle events like these are probably already present
> in the .NET world actually. Does anyone know where to look?
>
> Cheers,
>   Tony
>
> On 16 December 2011 08:27, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> We've had this argument back and forth a bit for both the Java and .NET
>> clients. The reason why we've been reluctant to do this is that by making
>> connections use daemon / background threads we encourage a situation where
>> connections don't get properly closed when your application shuts down.
>>
>> So for example if your application publishes a load of messages and then
>> exits, if we used background threads then things would appear to work but
>> there would be no guarantee that all the messages would reach the broker.
>>
>> So really the right thing to do is explicitly close connections at shut
>> down - then you know that everything you thought the connections were doing
>> is actually done.
>>
>> Cheers, Simon
>>
>>
>> On 15/12/11 20:53, Eyal Post wrote:
>>
>>> We have an issue with a .net client application that creates a
>>> connection in order to publish message and caches this connection in a
>>> variable. The problem is that when the program exits, it gets stuck in
>>> memory because there is an AMQP thread that doesn?t exit.
>>>
>>> I?m not sure how the RabbitMQ threads are created but in .net there is
>>> an option to set a thread as a background thread and in this case when
>>> the application closes it will not wait for background threads to stop.
>>> Is the .net client setting the background threads it creates background?
>>> If not, can you change that?
>>>
>>> See here for more details:
>>> http://msdn.microsoft.com/en-**us/library/system.threading.**
>>> thread.isbackground.aspx<http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx>
>>>
>>> Eyal Post
>>>
>>>
>>> ______________________________**______________________________**
>>> __________
>>> This email has been scanned by the Symantec Email Security.cloud service.
>>> For more information please visit http://www.symanteccloud.com
>>> ______________________________**______________________________**
>>> __________
>>>
>>>
>>>
>>> ______________________________**_________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/975bc69a/attachment.htm>

From blalor at bravo5.org  Fri Dec 16 14:53:04 2011
From: blalor at bravo5.org (Brian Lalor)
Date: Fri, 16 Dec 2011 09:53:04 -0500
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
	<4EEB4751.3010108@rabbitmq.com>
	<CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
Message-ID: <75949974-7046-4F60-94A5-F2FA96800AC6@bravo5.org>

On Dec 16, 2011, at 9:43 AM, Tony Garnock-Jones wrote:

> Stepping back from the immediate problem, the "real" solution is to have the JVM and .NET virtual machines grow up and behave like proper systems, complete with lifecycle events. Then, AMQP connections have a chance to clean up and disconnect on their own, without special action on the part of the programmer and without unduly delaying or preventing VM shutdown.
> 

If you use Spring, you get events like these.  With Spring for Java, you can use the destroy-method attribute of the  <bean />  element to invoke a method when the context is shutting down.  I haven't used Spring with .Net, but I'd be surprised if there weren't a similar mechanism there.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/bf50696b/attachment.htm>

From joeyfitz at gmail.com  Fri Dec 16 15:30:57 2011
From: joeyfitz at gmail.com (joefitzgerald)
Date: Fri, 16 Dec 2011 07:30:57 -0800 (PST)
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <75949974-7046-4F60-94A5-F2FA96800AC6@bravo5.org>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
	<4EEB4751.3010108@rabbitmq.com>
	<CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
	<75949974-7046-4F60-94A5-F2FA96800AC6@bravo5.org>
Message-ID: <25da4861-e46b-4dbf-8de4-bd335557ffe0@b14g2000prn.googlegroups.com>

It's even easier than that if you're using Spring.NET. Any object that
implements IDisposable is disposed automatically by the Spring.NET
container when the container is destroyed. The container is destroyed
when the application shuts down, and I think they use the ProcessExit
event to make that happen.

Reference: http://www.springframework.net/doc-latest/reference/html/objects.html#objects-factory-lifecycle-disposableobject

Cheers,
Joe

On Dec 16, 7:53?am, Brian Lalor <bla... at bravo5.org> wrote:
> On Dec 16, 2011, at 9:43 AM, Tony Garnock-Jones wrote:
>
> > Stepping back from the immediate problem, the "real" solution is to have the JVM and .NET virtual machines grow up and behave like proper systems, complete with lifecycle events. Then, AMQP connections have a chance to clean up and disconnect on their own, without special action on the part of the programmer and without unduly delaying or preventing VM shutdown.
>
> If you use Spring, you get events like these. ?With Spring for Java, you can use the destroy-method attribute of the ?<bean /> ?element to invoke a method when the context is shutting down. ?I haven't used Spring with .Net, but I'd be surprised if there weren't a similar mechanism there.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Dec 16 15:37:04 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 15:37:04 +0000
Subject: [rabbitmq-discuss] Outage, brokers refuse to start back up
In-Reply-To: <CAJreXKBPodhE6sVkzvR5v7+W80Kh6a+i6fuw_vEQsMak5z2qkw@mail.gmail.com>
References: <CAJreXKCsYWZ3H1wU9PqcxhpRHn4ZaWYaiX7g+uBwEZK9vUY_zg@mail.gmail.com>	<CAJreXKD1UEG=oGui-QmGP4U5nftaKHW1AE8scfX3=rXAbQ=chw@mail.gmail.com>	<4EE22DF8.4070407@rabbitmq.com>
	<CAJreXKBPodhE6sVkzvR5v7+W80Kh6a+i6fuw_vEQsMak5z2qkw@mail.gmail.com>
Message-ID: <4EEB65A0.9060202@rabbitmq.com>

Thanks. So timeout_waiting_for_tables can also be triggered by certain 
types of network failure or reconfiguration. We're looking at adding 
better diagnostics for these cases...

Cheers, Simon

On 09/12/11 15:54, James Carr wrote:
> Yes. I shut both down and whIen trying to restart either the master
> node or the other node I got the same error.
>
> On Fri, Dec 9, 2011 at 9:49 AM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> When you start a cluster up again after it's entirely shut down, any node
>> other than the last one to be shut down will wait at startup for the last
>> one to reappear (since the last node to shut down is authoritative). If the
>> last node does not reappear in 30s then the error message you quote is
>> shown. Did you get the same error on both nodes?
>>
>> Cheers, Simon
>>
>>
>> On 09/12/11 15:03, James Carr wrote:
>>>
>>> Okay, so I backed up our mnesia dir and wiped it clean on both boxes.
>>> Brokers started fine. I then copied the DCD and DCL files back over
>>> and my users, exchanges, and queues were back.
>>>
>>> Is there a recommended way to protect against such an outage?
>>>
>>> Thanks,
>>> James
>>>
>>>
>>> On Fri, Dec 9, 2011 at 8:41 AM, James Carr<james.r.carr at gmail.com>    wrote:
>>>>
>>>> So our datacenter had a power failure yesterday and the brokers now
>>>> REFUSE to start back up. I can send the erl_crash.dump as needed (it
>>>> is quite large) but here are the other logs.
>>>>
>>>> Any ideas?
>>>>
>>>> Thanks,
>>>> James
>>>>
>>>>
>>>> Rabbitmq log:
>>>>
>>>> =INFO REPORT==== 9-Dec-2011::08:35:32 ===
>>>> Limiting to approx 924 file handles (829 sockets)
>>>>
>>>> =ERROR REPORT==== 9-Dec-2011::08:36:02 ===
>>>> FAILED
>>>> Reason: {error,
>>>>             {timeout_waiting_for_tables,
>>>>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
>>>>                  rabbit_durable_route,rabbit_durable_exchange,
>>>>                  rabbit_durable_queue]}}
>>>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>>>              {rabbit_mnesia,check_schema_integrity,0},
>>>>              {rabbit_mnesia,ensure_schema_integrity,0},
>>>>              {rabbit_mnesia,init,0},
>>>>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>>>              {rabbit,run_boot_step,1},
>>>>              {rabbit,'-start/2-lc$^0/1-0-',1},
>>>>              {rabbit,start,2}]
>>>>
>>>> =INFO REPORT==== 9-Dec-2011::08:36:03 ===
>>>>     application: rabbit
>>>>     exited: {bad_return,{{rabbit,start,[normal,[]]},
>>>>                          {'EXIT',{rabbit,failure_during_boot}}}}
>>>>     type: permanent
>>>>
>>>>
>>>> startup_log:
>>>>
>>>> Activating RabbitMQ plugins ...
>>>> 11 plugins activated:
>>>> * amqp_client-2.6.1
>>>> * erlando-2.6.1
>>>> * mochiweb-1.3-rmq2.6.1-git9a53dbd
>>>> * rabbitmq_federation-2.6.1
>>>> * rabbitmq_management-2.6.1
>>>> * rabbitmq_management_agent-2.6.1
>>>> * rabbitmq_management_visualiser-2.6.1
>>>> * rabbitmq_mochiweb-2.6.1
>>>> * rabbitmq_shovel-2.6.1
>>>> * rabbitmq_shovel_management-2.6.1
>>>> * webmachine-1.7.0-rmq2.6.1-hg0c4b60a
>>>>
>>>>
>>>> +---+   +---+
>>>> |   |   |   |
>>>> |   |   |   |
>>>> |   |   |   |
>>>> |   +---+   +-------+
>>>> |                   |
>>>> | RabbitMQ  +---+   |
>>>> |           |   |   |
>>>> |   v2.6.1  +---+   |
>>>> |                   |
>>>> +-------------------+
>>>> AMQP 0-9-1 / 0-9 / 0-8
>>>> Copyright (C) 2007-2011 VMware, Inc.
>>>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>>>
>>>> node           : rabbit at brokerm02p
>>>> app descriptor :
>>>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
>>>> home dir       : /var/lib/rabbitmq
>>>> config file(s) : /etc/rabbitmq/rabbitmq.config
>>>> cookie hash    : Mg6GXWPn9Lrj9HC/D14CWA==
>>>> log            : /var/log/rabbitmq/rabbit at brokerm02p.log
>>>> sasl log       : /var/log/rabbitmq/rabbit at brokerm02p-sasl.log
>>>> database dir   : /var/lib/rabbitmq/mnesia/rabbit at brokerm02p
>>>> erlang version : 5.8.4
>>>>
>>>> -- rabbit boot start
>>>> starting file handle cache server
>>>> ...done
>>>> starting worker pool
>>>>   ...done
>>>> starting database
>>>> ...BOOT ERROR: FAILED
>>>> Reason: {error,
>>>>             {timeout_waiting_for_tables,
>>>>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
>>>>                  rabbit_durable_route,rabbit_durable_exchange,
>>>>                  rabbit_durable_queue]}}
>>>> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>>>>              {rabbit_mnesia,check_schema_integrity,0},
>>>>              {rabbit_mnesia,ensure_schema_integrity,0},
>>>>              {rabbit_mnesia,init,0},
>>>>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>>>              {rabbit,run_boot_step,1},
>>>>              {rabbit,'-start/2-lc$^0/1-0-',1},
>>>>              {rabbit,start,2}]
>>>> {"Kernel pid
>>>> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>>>>
>>>> startup_err:
>>>>
>>>> Erlang has closed
>>>>
>>>> Crash dump was written to: erl_crash.dump
>>>> Kernel pid terminated (application_controller)
>>>>
>>>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From joeyfitz at gmail.com  Fri Dec 16 15:39:17 2011
From: joeyfitz at gmail.com (joefitzgerald)
Date: Fri, 16 Dec 2011 07:39:17 -0800 (PST)
Subject: [rabbitmq-discuss] dotnet client background thread
In-Reply-To: <25da4861-e46b-4dbf-8de4-bd335557ffe0@b14g2000prn.googlegroups.com>
References: <B610E299F78D7F40A3AE4208AA89F10D1980524F@ilexc10.corp.projecteam.com>
	<4EEB4751.3010108@rabbitmq.com>
	<CAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og@mail.gmail.com>
	<75949974-7046-4F60-94A5-F2FA96800AC6@bravo5.org>
	<25da4861-e46b-4dbf-8de4-bd335557ffe0@b14g2000prn.googlegroups.com>
Message-ID: <778ca308-df8f-41d1-b9f4-f6f07718c79e@n13g2000prf.googlegroups.com>

I should also note that I am the maintainer of Spring AMQP for .NET
(and as a consequence, the RabbitMQ.Client NuGet package), and we're
closing in on a 1.0.0.0 M2 release. If you're OK living on the semi-
bleeding edge, there are two NuGet packages for Spring AMQP for .NET:

* https://nuget.org/packages/Spring.Messaging.Amqp
* https://nuget.org/packages/Spring.Messaging.Amqp.Rabbit

This should be considered _alpha_, but it's in use in production
environments at clients, and is stable in observed use. 1.0.0.0 will
be released in Q1 2012. Any help (this is an open source project) is
greatly appreciated. The Github repo is here: https://github.com/SpringSource/spring-net-amqp`

Needless to day, we implement IDisposable :) Your connections will be
shut down when the application exits.

Cheers,
Joe

On Dec 16, 8:30?am, joefitzgerald <joeyf... at gmail.com> wrote:
> It's even easier than that if you're using Spring.NET. Any object that
> implements IDisposable is disposed automatically by the Spring.NET
> container when the container is destroyed. The container is destroyed
> when the application shuts down, and I think they use the ProcessExit
> event to make that happen.
>
> Reference:http://www.springframework.net/doc-latest/reference/html/objects.html...
>
> Cheers,
> Joe
>
> On Dec 16, 7:53?am, Brian Lalor <bla... at bravo5.org> wrote:> On Dec 16, 2011, at 9:43 AM, Tony Garnock-Jones wrote:
>
> > > Stepping back from the immediate problem, the "real" solution is to have the JVM and .NET virtual machines grow up and behave like proper systems, complete with lifecycle events. Then, AMQP connections have a chance to clean up and disconnect on their own, without special action on the part of the programmer and without unduly delaying or preventing VM shutdown.
>
> > If you use Spring, you get events like these. ?With Spring for Java, you can use the destroy-method attribute of the ?<bean /> ?element to invoke a method when the context is shutting down. ?I haven't used Spring with .Net, but I'd be surprised if there weren't a similar mechanism there.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ericvillaorts at yahoo.es  Fri Dec 16 16:14:11 2011
From: ericvillaorts at yahoo.es (irineo villanovaorts)
Date: Fri, 16 Dec 2011 16:14:11 +0000 (GMT)
Subject: [rabbitmq-discuss] Enable durables queues
Message-ID: <1324052051.8037.YahooMailNeo@web23903.mail.ird.yahoo.com>

Hi,

I would like to know how can I enable durable queues as default on rabbitmq version 1.7.2.

I have a running HA rabbitmq set it up with heartbeat,pacemaker and drbd but when heartbeat fails, the client lose the queues and it need to be restarted. So I guess if I could enable those queues I will get my problem solved.

Thanks in advance for your help.

Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/6f5f8662/attachment.htm>

From Jim.Langston at compuware.com  Fri Dec 16 16:37:36 2011
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Fri, 16 Dec 2011 16:37:36 +0000
Subject: [rabbitmq-discuss] Backing store location ?
Message-ID: <CB10DDFB.B136%jim.langston@compuware.com>

Hi all,

Hopefully, simple question

I would like to change the location of where the backing store writes to, I
have about 1TB of free disk and would like to point the backing store to it
instead of the root partition. Is there a simple way to do that ? I looked at the
env. variables, but none seem to indicate that would do that directly, just logs, etc.

Thanks,

Jim

The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/56b66758/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CPWRsig_04_11-03-2010.jpg
Type: image/jpeg
Size: 9440 bytes
Desc: CPWRsig_04_11-03-2010.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/56b66758/attachment.jpg>

From mickdelaney at gmail.com  Fri Dec 16 16:47:41 2011
From: mickdelaney at gmail.com (Michael Delaney)
Date: Fri, 16 Dec 2011 08:47:41 -0800 (PST)
Subject: [rabbitmq-discuss] Architectural Choices
Message-ID: <26523130.624.1324054061429.JavaMail.geo-discussion-forums@yqkb10>

I've got a web app on ec2 and I'm introducing async messaging with rabbit. 

My goal is more towards *reliability* than for maximum performance. 
Having said that, what are the implications of the following strategies:

Given: *3 Clustered Web Servers, 2 Clustered App Servers*

The scenario is that I'm publishing events from the web servers, which will 
are subscribed to by services running on the app servers. 

*Option 1*: Run a broker on each in a HA Cluster, sharing the queues 
between web & app servers. 
*Option 2*: Run a dedicated messaging server which all the web & app 
servers connect to 
*Option 3*: Run a broker on either all the web servers or all the app 
servers

At this stage I'm going with Option 1, which I feel is more difficult from 
an operational sense, i.e. managing configuration etc, but should give 
me the most reliable setup. 

Option 2 would probably be easier to get up and running, but I'd need an 
extra server or 2, and if the server goes down (it is the cloud after all)
i'll end up with service down time. 

Option 3 is basically somewhere in between. 

Is there anything else I need to consider?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/5eba4926/attachment.htm>

From simon at rabbitmq.com  Fri Dec 16 16:49:13 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Dec 2011 16:49:13 +0000
Subject: [rabbitmq-discuss] Backing store location ?
In-Reply-To: <CB10DDFB.B136%jim.langston@compuware.com>
References: <CB10DDFB.B136%jim.langston@compuware.com>
Message-ID: <4EEB7689.8000207@rabbitmq.com>

http://www.rabbitmq.com/configure.html#define-environment-variables

- set RABBITMQ_BASE (for DB + logs) or RABBITMQ_MNESIA_BASE (for just 
the db).

(Note that although messages are not held in Mnesia, they do go into the 
directory defined by RABBITMQ_MNESIA_BASE).

Cheers, Simon

On 16/12/11 16:37, Langston, Jim wrote:
> Hi all,
>
> Hopefully, simple question
>
> I would like to change the location of where the backing store writes to, I
> have about 1TB of free disk and would like to point the backing store to it
> instead of the root partition. Is there a simple way to do that ? I
> looked at the
> env. variables, but none seem to indicate that would do that directly,
> just logs, etc.
>
> Thanks,
>
> Jim
>
> The contents of this e-mail are intended for the named addressee only.
> It contains information that may be confidential. Unless you are the
> named addressee or an authorized designee, you may not copy or use it,
> or disclose it to anyone else. If you received it in error please notify
> us immediately and then destroy it.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Dec 16 16:53:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Dec 2011 16:53:07 +0000
Subject: [rabbitmq-discuss] Enable durables queues
In-Reply-To: <1324052051.8037.YahooMailNeo@web23903.mail.ird.yahoo.com>
References: <1324052051.8037.YahooMailNeo@web23903.mail.ird.yahoo.com>
Message-ID: <4EEB7773.6000600@rabbitmq.com>

Hi Eric,

On 16/12/11 16:14, irineo villanovaorts wrote:
> Hi,
> 
> I would like to know how can I enable durable queues as default on
> rabbitmq version 1.7.2.

That's a very old version. You should upgrade.

> I have a running HA rabbitmq set it up with heartbeat,pacemaker and drbd
> but when heartbeat fails, the client lose the queues and it need to be
> restarted. So I guess if I could enable those queues I will get my
> problem solved.

You can declare queues as durable using the "durable" parameter in the
QueueDeclare() method. Also see

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.durable

http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.2/rabbitmq-java-client-javadoc-1.7.2/com/rabbitmq/client/impl/AMQImpl.Queue.Declare.html#durable


-Emile

From adamrabung at gmail.com  Fri Dec 16 22:25:50 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Fri, 16 Dec 2011 17:25:50 -0500
Subject: [rabbitmq-discuss] Connection and Channel lifecycle
Message-ID: <CAAN_EDoRpMVF=dfT71YAKX5ZS2yU0Xn+5RsjzXjy7Ok597wK7A@mail.gmail.com>

Hello,
I've been reading up on this quite a bit, but I'm still unclear about
some general principles of how to use connections and channels
correctly.  For example, say I have a "worker pool" with 40
QueueingConsumers (ie 40 separate channels).  I believe it is
completely fine to keep these channels (and underlying connection(s))
open indefinitely, is this correct?  In this long-running situation,
what is the optimal number of underlying connections for these 40
channels?  I believe from a throughput standpoint, the answer might be
40.  From a resource conservation standpoint, the answer would be 1.
I will have many of these worker pools, so both considerations are
important.  Can someone give pointers on how to balance those two
concerns?

Does anyone use connection or channel pooling?

Any pointers much appreciated,
Adam

PS. Thanks for great answers to all of my crazy questions so far!

From mattswe at gmail.com  Sat Dec 17 04:58:12 2011
From: mattswe at gmail.com (Matt Sweeney)
Date: Fri, 16 Dec 2011 20:58:12 -0800 (PST)
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <4EEB433D.3060405@rabbitmq.com>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>	<20110530141459.GA4152@wellquite.org>	<8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>	<4EE72E22.5090708@rabbitmq.com>
	<23865799.32.1323911010541.JavaMail.geo-discussion-forums@prj1>
	<4EEB433D.3060405@rabbitmq.com>
Message-ID: <7496719.449.1324097892765.JavaMail.geo-discussion-forums@prol32>

I'm almost positive it's something obvious :)

So, closing a connection is as simple as calling `connection.close()`? do I 
have to `channel.close()` as well?

Thanks again,
Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/f5dea734/attachment.htm>

From ari.brandeis.king at gmail.com  Sun Dec 18 05:51:12 2011
From: ari.brandeis.king at gmail.com (Ari King)
Date: Sun, 18 Dec 2011 00:51:12 -0500
Subject: [rabbitmq-discuss] Access Refused
Message-ID: <CAPcS2ai0SNzzELag=24z4Rx4mPBpef3NVtoPfwdR2_vyc2x7TQ@mail.gmail.com>

Hi,

Whenever my application attempts to connect to the RabbitMQ server
access is denied because of invalid credentials (see below).

None of the default configurations have been changed. Does anyone know
what could be wrong?

On the client I've specified the: host (by IP), virtualhost ("/"),
username ("guest") and password ("guest")

I haven't set the RABBITMQ_NODE_IP_ADDRESS; should I set it to the
RabbitMQ server's IP address?

=ERROR REPORT==== 17-Dec-2011::23:00:03 ===
exception on TCP connection <0.320.0> from xxx.xxx.xxx.xxx:xxxxx
{channel0_error,starting,
                {amqp_error,access_refused,
                            "PLAIN login refused: user 'guest' -
invalid credentials",
                            'connection.start_ok'}}

Thanks.

-Ari

From benno at jeamland.net  Mon Dec 19 00:36:49 2011
From: benno at jeamland.net (Benno Rice)
Date: Mon, 19 Dec 2011 11:36:49 +1100
Subject: [rabbitmq-discuss] Diagnosing crashes?
Message-ID: <F2E37F5B-4C67-466D-9A9B-6988A9A816D2@jeamland.net>

Hi guys,

I've got a RabbitMQ instance running on Ubuntu that's suddenly decided to crash about once every 24 hours. How would I go about working out why this is the case?

The system is a Ubuntu 10.04 LTS instance running under VMware. It's fully up to date, and using RabbitMQ from the rabbitmq.com package repo:

% dpkg -l |grep rabbit
ii  rabbitmq-server                     2.7.0-1                           An AMQP server written in Erlang
% dpkg -l |grep erlang-base
ii  erlang-base                         1:13.b.3-dfsg-2ubuntu2.1          Erlang/OTP virtual machine and base applicat

I can't see anything untoward in the rabbitmq log files, but then I'm not entirely sure what to look for, hence the question. Here's a grab from somewhere around one of the restarts:

=INFO REPORT==== 18-Dec-2011::07:17:39 ===
closing TCP connection <0.256.0> from [::1]:51570

=INFO REPORT==== 18-Dec-2011::07:17:42 ===
accepted TCP connection on [::]:5672 from [::1]:54231

=INFO REPORT==== 18-Dec-2011::07:17:42 ===
starting TCP connection <0.443.0> from [::1]:54231

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
Memory limit set to 803MB of 2009MB total.

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 18-Dec-2011::07:22:08 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
accepted TCP connection on [::]:5672 from [::1]:54780

=INFO REPORT==== 18-Dec-2011::07:22:08 ===
starting TCP connection <0.198.0> from [::1]:54780

The sasl log is empty.

If it's an Erlang crash, where would I go hunting for the dumps?

Many thanks,
	Benno.

-- 
Benno Rice
benno at jeamland.net



From matthias at rabbitmq.com  Mon Dec 19 04:22:15 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Dec 2011 04:22:15 +0000
Subject: [rabbitmq-discuss] Diagnosing crashes?
In-Reply-To: <F2E37F5B-4C67-466D-9A9B-6988A9A816D2@jeamland.net>
References: <F2E37F5B-4C67-466D-9A9B-6988A9A816D2@jeamland.net>
Message-ID: <4EEEBBF7.5050708@rabbitmq.com>

Benno,

On 19/12/11 00:36, Benno Rice wrote:
> I've got a RabbitMQ instance running on Ubuntu that's suddenly
> decided to crash about once every 24 hours. How would I go about
> working out why this is the case?
>
> The system is a Ubuntu 10.04 LTS instance running under VMware. It's
> fully up to date, and using RabbitMQ from the rabbitmq.com package
> repo:
>
> % dpkg -l |grep rabbit ii  rabbitmq-server
> 2.7.0-1                           An AMQP server written in Erlang %
> dpkg -l |grep erlang-base ii  erlang-base
> 1:13.b.3-dfsg-2ubuntu2.1          Erlang/OTP virtual machine and base
> applicat

That all looks reasonable.

> I can't see anything untoward in the rabbitmq log files,

Indeed.

> The sasl log is empty.
>
> If it's an Erlang crash, where would I go hunting for the dumps?

I doubt Erlang crashed. Instead I suspect it fell victim to Linux' OOM 
killer. Check the syslogs for clues.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Dec 19 04:53:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Dec 2011 04:53:50 +0000
Subject: [rabbitmq-discuss] Access Refused
In-Reply-To: <CAPcS2ai0SNzzELag=24z4Rx4mPBpef3NVtoPfwdR2_vyc2x7TQ@mail.gmail.com>
References: <CAPcS2ai0SNzzELag=24z4Rx4mPBpef3NVtoPfwdR2_vyc2x7TQ@mail.gmail.com>
Message-ID: <4EEEC35E.8050402@rabbitmq.com>

Ari,

On 18/12/11 05:51, Ari King wrote:
> Whenever my application attempts to connect to the RabbitMQ server
> access is denied because of invalid credentials (see below).

What client library are you using? And what version of rabbit?

> None of the default configurations have been changed.

Are you sure? Check the output of 'rabbitmqctl list_permissions':

$ rabbitmqctl list_permissions
Listing permissions in vhost "/" ...
guest	.*	.*	.*
...done.

Also, ensure that the password is correct:

$ rabbitmqctl change_password guest guest
Changing password for user "guest" ...
...done.

> I haven't set the RABBITMQ_NODE_IP_ADDRESS; should I set it to the
> RabbitMQ server's IP address?

That has no bearing on authentication.

Failing the above, trace the connection with 
http://www.rabbitmq.com/api-guide.html#tracer or wireshark. Here's a 
trace of a successful connection from the former:

1324269930074: <Tracer-1> ch#0 <- 
{#method<connection.start>(version-major=0, version-minor=9, 
server-properties={product=RabbitMQ, information=Licensed under the MPL. 
  See http://www.rabbitmq.com/, platform=Erlang/OTP, 
capabilities={exchange_exchange_bindings=true, 
consumer_cancel_notify=true, basic.nack=true, publisher_confirms=true}, 
copyright=Copyright (C) 2007-2011 VMware, Inc., version=%%VSN%%}, 
mechanisms=PLAIN AMQPLAIN, locales=en_US), null, "[B at 3dfeca64"}
1324269930127: <Tracer-1> ch#0 -> 
{#method<connection.start-ok>(client-properties={product=RabbitMQ, 
information=Licensed under the MPL. See http://www.rabbitmq.com/, 
platform=Java, capabilities={exchange_exchange_bindings=true, 
publisher_confirms=true, basic.nack=true, consumer_cancel_notify=true}, 
copyright=Copyright (C) 2007-2011 VMware, Inc., version=0.0.0}, 
mechanism=PLAIN, response=guestguest, locale=en_US), null, "[B at 3dfeca64"}
1324269930160: <Tracer-1> ch#0 <- 
{#method<connection.tune>(channel-max=0, frame-max=131072, heartbeat=0), 
null, "[B at 3dfeca64"}
1324269930164: <Tracer-1> ch#0 -> 
{#method<connection.tune-ok>(channel-max=0, frame-max=131072, 
heartbeat=0), null, "[B at 3dfeca64"}
1324269930164: <Tracer-1> ch#0 -> 
{#method<connection.open>(virtual-host=/, capabilities=, insist=false), 
null, "[B at 3dfeca64"}
1324269930199: <Tracer-1> ch#0 <- 
{#method<connection.open-ok>(known-hosts=), null, "[B at 3dfeca64"}

(note the "guestguest" credentials in the connection.start-ok and the 
"/" vhost in connection.open).

Regards,

Matthias.

From evkdev at gmail.com  Mon Dec 19 09:07:55 2011
From: evkdev at gmail.com (evkdev at gmail.com)
Date: Mon, 19 Dec 2011 15:07:55 +0600
Subject: [rabbitmq-discuss] RabbitMQ as Windows Service
Message-ID: <F1BBB1B7A67740B08F88B2FF6DF251EA@EvKPC>

Hi! I have a problem with running RabbitMQ as windows service. I have a cluster with 3 nodes and everything works fine if run rabbit with ?rabbitmq-server start ?detached?. I also able to run it as windows service under Administrator account. But after reboot, RabbitMQ service fails to start. 
In Event Log there is an entry: ?RabbitMQ: Erlang machine voluntarily stopped. The service is not restarted as OnFail is set to ignore?. 
In rabbit logs I see this: 
FAILED
Reason: {error,
            {timeout_waiting_for_tables, ....
Whatever I tried ? nothing helps to resolve this issue. If I log in after reboot, and start RabbitMQ service manually ? everything works fine.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/2040e250/attachment.htm>

From orenshome at gmail.com  Mon Dec 19 10:10:25 2011
From: orenshome at gmail.com (Oren Shochat)
Date: Mon, 19 Dec 2011 12:10:25 +0200
Subject: [rabbitmq-discuss] A new Erlang release - R15B
Message-ID: <CAJtNgzyDnAATx1NYmPtGPE8Wic+JSYHk2DK=RxWOpgBAkvePDw@mail.gmail.com>

Supports win64 bit.

When will a RabbitMQ release compiled with this version will be available?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/bffc0e18/attachment.htm>

From orenshome at gmail.com  Mon Dec 19 10:13:13 2011
From: orenshome at gmail.com (Oren Shochat)
Date: Mon, 19 Dec 2011 02:13:13 -0800 (PST)
Subject: [rabbitmq-discuss] New Erlang Release - R15B
Message-ID: <859287dd-a058-47e8-9889-10ecc321b6fe@s5g2000vbj.googlegroups.com>

Supports win64 bit.
When will we have a RabbitMQ window release with this version?

From tonygarnockjones+rabbitmq at gmail.com  Mon Dec 19 14:56:55 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 19 Dec 2011 09:56:55 -0500
Subject: [rabbitmq-discuss] Tasks within Transactions using RabbitMQ
Message-ID: <CAM8fPiRQEwHgUM2-R6ZiMgUTHKx3GMEk+DjY6kZMWAMtjoHzHw@mail.gmail.com>

Hi all,

I've written up a blog post on an approach to getting similar functionality
to Google AppEngine's Transactional Task Queue, using RabbitMQ:

http://www.eighty-twenty.org/index.cgi/tech/rabbitmq/tasks-within-transactions-20111218.html

Here are the opening paragraphs:

In a discussion of moving from Google AppEngine to EC2, a participant
> mentioned that the only "odd" GAE service he made use of was transactional
> task queues, and that there was no direct analogue of this service in other
> queueing systems.
>
> Here's one way of building a transactional task queue using RabbitMQ and
> your favourite SQL database.
>
>    - a table in the database will hold pending tasks
>    - messages going through RabbitMQ will inform workers of the arrival
>    of new tasks
>    - the available tasks will be load-balanced between n workers
>    - a "cleaner" process makes sure all tasks are eventually run and that
>    failed tasks are eventually detected
>
> In this article, I'll spell out the requirements for the system, and
> discuss the details of the database tables, RabbitMQ queues, and daemon
> processes required. I'll then evaluate the solution presented in terms of
> the requirements, and conclude by discussing a few variations on the
> solution that might be worth exploring.
>

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/c814ec6a/attachment.htm>

From steve at rabbitmq.com  Mon Dec 19 16:41:26 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 19 Dec 2011 16:41:26 +0000
Subject: [rabbitmq-discuss] A new Erlang release - R15B
In-Reply-To: <CAJtNgzyDnAATx1NYmPtGPE8Wic+JSYHk2DK=RxWOpgBAkvePDw@mail.gmail.com>
References: <CAJtNgzyDnAATx1NYmPtGPE8Wic+JSYHk2DK=RxWOpgBAkvePDw@mail.gmail.com>
Message-ID: <EE3FC849-F41C-4A76-B28A-A2F4EFFB8257@rabbitmq.com>

On 19 Dec 2011, at 10:10, Oren Shochat wrote:
> [R15B] Supports win64 bit. 
> When will a RabbitMQ release compiled with this version will be available? 

Oren,

Thank you. The very next release is compatible with R15B, but there is, as yet,
no explicit support or build on 64bit Windows Erlang.  I would expect this to
happen in upcoming releases.  However, there should be nothing to stop you
trying it yourself (from the next release's source -- which builds and runs
under R15B) on 64bit Windows and reporting back your experiences here.

We'd be delighted to hear from you.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.


From alan.antonuk at gmail.com  Mon Dec 19 18:02:49 2011
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 19 Dec 2011 13:02:49 -0500
Subject: [rabbitmq-discuss] A new Erlang release - R15B
In-Reply-To: <EE3FC849-F41C-4A76-B28A-A2F4EFFB8257@rabbitmq.com>
References: <CAJtNgzyDnAATx1NYmPtGPE8Wic+JSYHk2DK=RxWOpgBAkvePDw@mail.gmail.com>
	<EE3FC849-F41C-4A76-B28A-A2F4EFFB8257@rabbitmq.com>
Message-ID: <CAAt2poJO5m2JB7kPWzDD5eFnecJDjQxGutjrGJQTSoTQgE0X0w@mail.gmail.com>

I've run Rabbit 2.7.0 under 64-bit Erlang R15B and it passes our test suite
under Win7 (the test suite mostly exercises different error conditions
under the AMQP 0-91 protocol coming from one client - it doesn't do much
with stress testing of multiple clients or any unusual failures like the
disk failing).  I can't comment on how it scales on Win-64 as I use it for
testing of our client code, which appears to work correctly.

-Alan

On Mon, Dec 19, 2011 at 11:41 AM, Steve Powell <steve at rabbitmq.com> wrote:

> On 19 Dec 2011, at 10:10, Oren Shochat wrote:
> > [R15B] Supports win64 bit.
> > When will a RabbitMQ release compiled with this version will be
> available?
>
> Oren,
>
> Thank you. The very next release is compatible with R15B, but there is, as
> yet,
> no explicit support or build on 64bit Windows Erlang.  I would expect this
> to
> happen in upcoming releases.  However, there should be nothing to stop you
> trying it yourself (from the next release's source -- which builds and runs
> under R15B) on 64bit Windows and reporting back your experiences here.
>
> We'd be delighted to hear from you.
>
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/8de7a0c0/attachment.htm>

From mpietrek at skytap.com  Mon Dec 19 21:58:10 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 19 Dec 2011 13:58:10 -0800
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
Message-ID: <CB14F371.23AB4%mpietrek@skytap.com>

We have a production environment where all of our services run in a special,
non-root account an an Ubuntu 10.04 environment. I'm experimenting with how
to make RabbitMQ 2.7 run in this special account, rather than as the
"rabbitmq" user, and not having much luck.

Extensive searching of the mailing list makes me think I'm close, but I
suspect I'm missing something fundamental.
* I believe part of the answer involves explicitly setting the "-cookie"
option in RABBITMQ_SERVER_START_ARGS and RABBITMQ_CTL_ERL_ARGS environment
variables.
* I also suspect that the answer also involves running the "low level"
scripts in /usr/lib/rabbitmq/bin/, rather than the scripts in /usr/sbin/.
* Further, I suspect that some directories may need to have their ownership
and/or attributes changed to something other than "rabbitmq".
So what I'm looking for is a list of what exactly I need to do, both at
launch time, as well as possibly at install time.

FWIW, we need to launch rabbitmq-server ourselves, rather than having it
auto start on boot. I know how to accomplish this, but it might be useful
context when deciding how to approach the above.

Thanks much,

Matt




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/9229b198/attachment.htm>

From videlalvaro at gmail.com  Mon Dec 19 22:15:04 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 19 Dec 2011 23:15:04 +0100
Subject: [rabbitmq-discuss] Issues with RPM installation
Message-ID: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>

Hi,

A friend that uses Rabbit on their systems told me that the following installation instructions always give them a 404:

On http://www.rabbitmq.com/install-rpm.html

The following:

> wget -O /etc/yum.repos.d/epel-erlang.repohttp://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo

Always gives back a 404 when trying to do a yum install

BTW. I have not tried this.

Cheers, 

Alvaro

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/82e0803e/attachment.htm>

From jasonjwwilliams at gmail.com  Mon Dec 19 22:31:34 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 19 Dec 2011 15:31:34 -0700
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <CB14F371.23AB4%mpietrek@skytap.com>
References: <CB14F371.23AB4%mpietrek@skytap.com>
Message-ID: <CAHZAEpcuLbJ8fmo-8inz6Yd6ZEj5GkOwoiTONXjhr5-+WiawyQ@mail.gmail.com>

Hi Matt,

This should do it on Ubuntu:

sudo -H -u <user> /opt/rabbitmq-server/sbin/rabbitmq-server

The Erlang process needs to find the Erlang cookie and will check the
home directory of the executing user. You can also specify the
explicit location of the Erlang cookie in the RabbitMQ arguments, but
we find using the HOME environment simpler.

-J

On Mon, Dec 19, 2011 at 2:58 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
> We have a production environment where all of our services run in a special,
> non-root account an an Ubuntu 10.04 environment.?I'm experimenting with how
> to make RabbitMQ 2.7 run in this special account, rather than as the
> "rabbitmq" user, and not having much luck.
>
> Extensive searching of the mailing list makes me think I'm close, but I
> suspect I'm missing something fundamental.
>
> I believe part of the answer involves explicitly setting the "-cookie"
> option in RABBITMQ_SERVER_START_ARGS and RABBITMQ_CTL_ERL_ARGS environment
> variables.
> I also suspect that the answer also involves running the "low level" scripts
> in /usr/lib/rabbitmq/bin/, rather than the scripts in /usr/sbin/.
> Further, I suspect that some directories may need to have their ownership
> and/or attributes changed to something other than "rabbitmq".
>
> So what I'm looking for is a list of what exactly I need to do, both at
> launch time, as well as possibly at install time.
>
> FWIW, we need to launch rabbitmq-server ourselves, rather than having it
> auto start on boot. I know how to accomplish this, but it might be useful
> context when deciding how to approach the above.
>
> Thanks much,
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Mon Dec 19 22:40:17 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Dec 2011 22:40:17 +0000
Subject: [rabbitmq-discuss] Issues with RPM installation
In-Reply-To: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>
References: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>
Message-ID: <4EEFBD51.8000902@rabbitmq.com>

Alvaro,

On 19/12/11 22:15, Alvaro Videla wrote:
> The following:
>
>> wget -O
>> /etc/yum.repos.d/epel-erlang.repohttp://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
>
> Always gives back a 404 when trying to do a yum install
>
> BTW. I have not tried this.

Any chance of getting hold of a complete transcript of the 'yum install 
erlang'?

Regards,

Matthias.

From mpietrek at skytap.com  Mon Dec 19 22:47:18 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 19 Dec 2011 14:47:18 -0800
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <CAHZAEpcuLbJ8fmo-8inz6Yd6ZEj5GkOwoiTONXjhr5-+WiawyQ@mail.gmail.com>
Message-ID: <CB14FC86.23AD8%mpietrek@skytap.com>

Thanks Jason.

That's helpful, but in my admittedly limited knowledge, I don't believe that
it's as simple as that. In particular I don't understand how handle files
being installed with rabbitmq as the owner.

A little more context that I forgot to mention earlier:
* I need to cluster multiple nodes so explicitly specifying the cookie is
necessary so they're synced. Also, specifying the cookie via an environment
variable is preferred to having an additional cookie file that I need to
copy to multiple machines.
* I need to be able to launch everything from scratch via my own script file
(which will be on all nodes.)
My current thinking is that my startup script will set some RABBITMQ
environment variables (RABBITMQ_CONFIG_FILE, RABBITMQ_SERVER_START_ARGS,
RABBITMQ_CTL_ERL_ARGS,). The script will then directly run rabbit-server in
/usr/lib/rabbitmq/bin. Also, RABBITMQ_CONFIG_FILE will point to the
rabbitmq.config file that I've dropped on all nodes to set up auto
clustering.)

Thanks again,

Matt

On 12/19/11 2:31 PM, "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
wrote:

> Hi Matt,
> 
> This should do it on Ubuntu:
> 
> sudo -H -u <user> /opt/rabbitmq-server/sbin/rabbitmq-server
> 
> The Erlang process needs to find the Erlang cookie and will check the
> home directory of the executing user. You can also specify the
> explicit location of the Erlang cookie in the RabbitMQ arguments, but
> we find using the HOME environment simpler.
> 
> -J
> 
> On Mon, Dec 19, 2011 at 2:58 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>>  We have a production environment where all of our services run in a special,
>>  non-root account an an Ubuntu 10.04 environment. I'm experimenting with how
>>  to make RabbitMQ 2.7 run in this special account, rather than as the
>>  "rabbitmq" user, and not having much luck.
>> 
>>  Extensive searching of the mailing list makes me think I'm close, but I
>>  suspect I'm missing something fundamental.
>> 
>>  I believe part of the answer involves explicitly setting the "-cookie"
>>  option in RABBITMQ_SERVER_START_ARGS and RABBITMQ_CTL_ERL_ARGS environment
>>  variables.
>>  I also suspect that the answer also involves running the "low level" scripts
>>  in /usr/lib/rabbitmq/bin/, rather than the scripts in /usr/sbin/.
>>  Further, I suspect that some directories may need to have their ownership
>>  and/or attributes changed to something other than "rabbitmq".
>> 
>>  So what I'm looking for is a list of what exactly I need to do, both at
>>  launch time, as well as possibly at install time.
>> 
>>  FWIW, we need to launch rabbitmq-server ourselves, rather than having it
>>  auto start on boot. I know how to accomplish this, but it might be useful
>>  context when deciding how to approach the above.
>> 
>>  Thanks much,
>> 
>>  Matt
>> 
>> 
>> 
>>  _______________________________________________
>>  rabbitmq-discuss mailing list
>>  rabbitmq-discuss at lists.rabbitmq.com
>>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/cf348cc8/attachment.htm>

From videlalvaro at gmail.com  Mon Dec 19 22:49:56 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 19 Dec 2011 23:49:56 +0100
Subject: [rabbitmq-discuss] Issues with RPM installation
In-Reply-To: <4EEFBD51.8000902@rabbitmq.com>
References: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>
	<4EEFBD51.8000902@rabbitmq.com>
Message-ID: <C8877149-6F7B-4F01-966B-917C625FC166@gmail.com>

Hi,

This is the error he gets:

http://repos.fedorapeople.org/repos/peter/erlang/epel-6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"

He says that if he uses the normal "epel" repo he can get a relatively new version: R14B-04

-Alvaro

On Dec 19, 2011, at 11:40 PM, Matthias Radestock wrote:

> Alvaro,
> 
> On 19/12/11 22:15, Alvaro Videla wrote:
>> The following:
>> 
>>> wget -O
>>> /etc/yum.repos.d/epel-erlang.repohttp://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo
>> 
>> Always gives back a 404 when trying to do a yum install
>> 
>> BTW. I have not tried this.
> 
> Any chance of getting hold of a complete transcript of the 'yum install erlang'?
> 
> Regards,
> 
> Matthias.

Sent form my Nokia 1100




From matthias at rabbitmq.com  Mon Dec 19 23:20:18 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Dec 2011 23:20:18 +0000
Subject: [rabbitmq-discuss] Issues with RPM installation
In-Reply-To: <C8877149-6F7B-4F01-966B-917C625FC166@gmail.com>
References: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>
	<4EEFBD51.8000902@rabbitmq.com>
	<C8877149-6F7B-4F01-966B-917C625FC166@gmail.com>
Message-ID: <4EEFC6B2.3050808@rabbitmq.com>

Alvaro,

On 19/12/11 22:49, Alvaro Videla wrote:
> This is the error he gets:
>
> http://repos.fedorapeople.org/repos/peter/erlang/epel-6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
>
> He says that if he uses the normal "epel" repo he can get a relatively new version: R14B-04

The instructions he quoted are from the section on RHEL 5 at 
http://www.rabbitmq.com/install-rpm.html. But it looks like he is 
running EPEL 6, which implies he's on RHEL 6. In which case he should 
indeed use the standard EPEL repo, as noted in the "Install the Server" 
section.

Matthias.

From videlalvaro at gmail.com  Mon Dec 19 23:22:43 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 20 Dec 2011 00:22:43 +0100
Subject: [rabbitmq-discuss] Issues with RPM installation
In-Reply-To: <4EEFC6B2.3050808@rabbitmq.com>
References: <980305CB-51C0-4DD2-8EFE-BD3C02B8676A@gmail.com>
	<4EEFBD51.8000902@rabbitmq.com>
	<C8877149-6F7B-4F01-966B-917C625FC166@gmail.com>
	<4EEFC6B2.3050808@rabbitmq.com>
Message-ID: <C7BF7C99-237C-4F5E-97F6-E03EA005C23A@gmail.com>

Thanks,

I forwarded that to him.

-Alvaro

On Dec 20, 2011, at 12:20 AM, Matthias Radestock wrote:

> Alvaro,
> 
> On 19/12/11 22:49, Alvaro Videla wrote:
>> This is the error he gets:
>> 
>> http://repos.fedorapeople.org/repos/peter/erlang/epel-6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
>> 
>> He says that if he uses the normal "epel" repo he can get a relatively new version: R14B-04
> 
> The instructions he quoted are from the section on RHEL 5 at http://www.rabbitmq.com/install-rpm.html. But it looks like he is running EPEL 6, which implies he's on RHEL 6. In which case he should indeed use the standard EPEL repo, as noted in the "Install the Server" section.
> 
> Matthias.

Sent form my Nokia 1100




From jasonjwwilliams at gmail.com  Mon Dec 19 23:53:40 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 19 Dec 2011 16:53:40 -0700
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <CB14FC86.23AD8%mpietrek@skytap.com>
References: <CAHZAEpcuLbJ8fmo-8inz6Yd6ZEj5GkOwoiTONXjhr5-+WiawyQ@mail.gmail.com>
	<CB14FC86.23AD8%mpietrek@skytap.com>
Message-ID: <CAHZAEpcZPXmLfLcZ0nW254BU86+u08kY+TZFYSBQtKxdS37dGQ@mail.gmail.com>

I believe what you're looking for then is this section from the
RabbitMQ clustering guide:

"As an alternative, you can insert the option "-setcookie cookie" in
the erl call in the rabbitmq-server and rabbitmqctl scripts."

http://www.rabbitmq.com/clustering.html

For what it's worth, we create a rabbitmq user on every system (for us
it's in LDAP, but you could write it out to the passwd file) and set
its home directory to /var/lib/rabbitmq. We then write out the
.erlang.cookie file into /var/lib/rabbitmq on every Rabbit node using
Chef (with permissions 0600). We're running Ubuntu 10.04.x LTS.


-J

On Mon, Dec 19, 2011 at 3:47 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
> Thanks Jason.
>
> That's helpful, but in my admittedly limited knowledge, I don't believe that
> it's as simple as that. In particular I don't understand how handle files
> being installed with rabbitmq as the owner.
>
> A little more context that I forgot to mention earlier:
>
> I need to cluster multiple nodes so explicitly specifying the cookie is
> necessary so they're synced. Also, specifying the cookie via an environment
> variable is preferred to having an additional cookie file that I need to
> copy to multiple machines.
> I need to be able to launch everything from scratch via my own script file
> (which will be on all nodes.)
>
> My current thinking is that my startup script will set some RABBITMQ
> environment variables (RABBITMQ_CONFIG_FILE, RABBITMQ_SERVER_START_ARGS,
> RABBITMQ_CTL_ERL_ARGS,). The script will then directly run rabbit-server in
> /usr/lib/rabbitmq/bin. Also,?RABBITMQ_CONFIG_FILE will point to the
> rabbitmq.config file that I've dropped on all nodes to set up auto
> clustering.)
>
> Thanks again,
>
> Matt
>
> On 12/19/11 2:31 PM, "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
> wrote:
>
> Hi Matt,
>
> This should do it on Ubuntu:
>
> sudo -H -u <user> /opt/rabbitmq-server/sbin/rabbitmq-server
>
> The Erlang process needs to find the Erlang cookie and will check the
> home directory of the executing user. You can also specify the
> explicit location of the Erlang cookie in the RabbitMQ arguments, but
> we find using the HOME environment simpler.
>
> -J
>
> On Mon, Dec 19, 2011 at 2:58 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>
> We have a production environment where all of our services run in a special,
> non-root account an an Ubuntu 10.04 environment.?I'm experimenting with how
> to make RabbitMQ 2.7 run in this special account, rather than as the
> "rabbitmq" user, and not having much luck.
>
> Extensive searching of the mailing list makes me think I'm close, but I
> suspect I'm missing something fundamental.
>
> I believe part of the answer involves explicitly setting the "-cookie"
> option in RABBITMQ_SERVER_START_ARGS and RABBITMQ_CTL_ERL_ARGS environment
> variables.
> I also suspect that the answer also involves running the "low level" scripts
> in /usr/lib/rabbitmq/bin/, rather than the scripts in /usr/sbin/.
> Further, I suspect that some directories may need to have their ownership
> and/or attributes changed to something other than "rabbitmq".
>
> So what I'm looking for is a list of what exactly I need to do, both at
> launch time, as well as possibly at install time.
>
> FWIW, we need to launch rabbitmq-server ourselves, rather than having it
> auto start on boot. I know how to accomplish this, but it might be useful
> context when deciding how to approach the above.
>
> Thanks much,
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From keith at zentrope.com  Tue Dec 20 00:12:03 2011
From: keith at zentrope.com (Keith Irwin)
Date: Mon, 19 Dec 2011 16:12:03 -0800
Subject: [rabbitmq-discuss] auto-delete exchange kills connections on
	consumer close?
In-Reply-To: <4EDF5253.4020405@rabbitmq.com>
References: <23512495.56.1323151241691.JavaMail.geo-discussion-forums@prnx7>
	<4EDF5253.4020405@rabbitmq.com>
Message-ID: <ED8BBF3F-78B8-49F6-8EEB-E179630E4A1F@zentrope.com>

Emile--

A belated things for your notes on this topic. Sure enough, the problem was that when I closed down a consumer, the exchange got take down with it. I managed to get things working, so it's all good.

Regards,

Keith

On Dec 7, 2011, at 3:47 AM, Emile Joubert wrote:

> Hi Keith,
> 
> On 06/12/11 06:00, Keith Irwin wrote:
>> Folks--
>> 
>> I'm using RabbitMQ (2.7.0 all around + java with Clojure) to send small
>> little status messages around here and there. It works great for that.
>> Because I don't care if these messages get dropped if, say, RabbitMQ
>> goes down, or if some client messes up here or there, I want to keep
>> everything temporary. When all the clients are stopped, I'm thinking,
>> RabbitMQ should be back to its default state.
>> 
>> So, when I use exchangeDeclare, I set auto-delete for the exchange to
>> true. Here are my expectations:
>> 
>> - When there are no more clients consuming or publishing to that
>> particular exchange, it'll disappear.
> 
> Your description applies better to queues than exchanges. When the last
> client consuming from an auto-delete *queue* unsubscribes, the queue
> auto-deletes.
> 
> An auto-delete exchange self-destructs when the last binding is removed.
> (If you are using exchange-to-exchange bindings then the exchange must
> be the source.) The binding might be removed as the result of an
> auto-delete queue disappearing, which in turn might happen as the result
> of a consumer unsubscribing, but that is incidental.
> 
> Remember that consumers don't consume from an exchange directly.
> 
>> What ACTUALLY happens is that when the first user of that exchange is
>> closed (by calling close on a channel), the exchange is deleted, and all
>> other users of that exchange get disconnected.
> 
> As described earlier, a subscriber that unsubscribes can cause a cascade
> of auto-deletions to occur that removes an exchange. Publishers that
> attempt to publish to an absent exchange will then fail. Is this what is
> happening?
> 
>> Is this a bug?
> 
> If my interpretation is correct then no.
> 
>> Should you always set autoDelete to false if there is ever going to be
>> more than one client using an exchange? And isn't there always going to
>> be another client using that exchange given there's no point in using an
>> MQ system otherwise?
> 
> Don't use auto-delete exchanges if you will have more than one publisher
> for that exchange. There are use-cases where an exchange has a single
> publisher.
> 
> Also consider whether the default exchange is sufficient for your needs.
> 
> 
> 
> -Emile


From aaron at agoragames.com  Tue Dec 20 03:29:09 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 19 Dec 2011 22:29:09 -0500
Subject: [rabbitmq-discuss] TTLs in 2.5.1
Message-ID: <CAHiEoM7Ra=myY2DjF1pQ03PjXZ-RDg_CNZtiMx=SG476Nj-dZw@mail.gmail.com>

We're running Rabbit 2.5.1 in a 2 node cluster and need  to implement
message TTLs to mitigate some pressing problems. If anyone could help
us out with some questions we have that would be most appreciated.

Are they fully supported in this version?
If we're going to enable TTLs, is there a pressing need to upgrade or
can we stay on 2.5.1?
Is there anything special to note about them in a 2.5.1 cluster?
Do we need to turn on client qos, or will rabbit change its consumer
delivery rules on TTL'd messages?
Are there any recommended lower bounds on this value?
What kind of effect should we expect message TTL to have on resource
requirements?
Will this significantly impact the memory footprint specifically?
Anything special about TTL in the case where rabbit is already under
very high load?


Sorry for all the specific questions, we just want to make sure that
if we "do it live" that we'll see the result we're expecting. For the
most part we have memory usage running in the 20-30% of memory alarm
range, but it can climb quickly in cases where we want TTL to work the
hardest for us and we're at thousands of msgs/sec. We're looking at
timeouts in the 5-10sec range or so, maybe as low as 2sec, which could
translate to 10-20k timeouts/sec in worst-case scenarios. We've seen
up to 16 MB/sec disk writes on our rabbit hosts, presumably all from
rabbit queue paging and during said worst-cases, for an idea of the
kind of volume that could back up with something goes awry and we want
messages to die off fast.

thanks,



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From simon at rabbitmq.com  Tue Dec 20 10:53:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Dec 2011 10:53:33 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
Message-ID: <4EF0692D.8020606@rabbitmq.com>

On 16/12/2011 8:05PM, Simone Busoli wrote:
> On Fri, Dec 16, 2011 at 14:16, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     The only reason your client might not receive a (n)ack for any given
>     message would be if the connection goes down
>
>
> Exactly, which if you're looking for some degree of reliable delivery is
> something you should take care of as well, right?
> So what I understand - please correct me if I'm wrong - is that neither
> Shovel nor Federation are doing anything with unconfirmed messages (i.e.
> no acks/nacks), so theoretically some messages may be "lost" because
> even if the upstream broker didn't receive an ack for them and will thus
> store them until they're acked (as the plugin wouldn't send one until it
> has received confirm from the downstream broker), there is however no
> one who will issue a recover to the upstream broker to request a requeue
> of those messages.

Recover is only one way to get unacked messages requeued - the 
connection going down is another.

In fact "recover" can really be understood as "pretend this connection 
went down".

So these messages won't be lost.

It is however possible for messages to get duplicated in these 
circumstances - for messages where the downstream has confirmed but the 
shovel / federation hasn't yet sent on the corresponding ack when the 
connection dies.

Cheers, Simon

From pranny at gmail.com  Tue Dec 20 06:05:10 2011
From: pranny at gmail.com (Pranav Prakash)
Date: Mon, 19 Dec 2011 22:05:10 -0800 (PST)
Subject: [rabbitmq-discuss] Priority Queue with RabbitMQ
Message-ID: <21179877.384.1324361111000.JavaMail.geo-discussion-forums@yqba2>

Hi Folks,

I am planning to use RabbitMQ for our an upcoming project, in email queue 
purposes. So, we have three main types (priorities) of emails that we want 
to send out - 

   - High Priority - Must be send ASAP
   - Medium Priority - Must be send within 12/24 hr window
   - Low Priority - Time of delivery does not matters

There are couple of producer processes, which generate message body (to, 
subject, email message, priority) and then a couple of consumer processes 
using an API call to send emails.

What would be a good approach to fit the priority into this otherwise ideal 
world scenario?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111219/741034b6/attachment.htm>

From steve at rabbitmq.com  Tue Dec 20 11:53:09 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 20 Dec 2011 11:53:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.7.1 is released
Message-ID: <4F27B1EA-2781-4B8F-ADA4-3BE6EC8AE0C5@rabbitmq.com>

The RabbitMQ team is delighted to announce the release of RabbitMQ 2.7.1.

This release includes:

   - fixes to queue recovery and high availability node recovery
   - fixes to the STOMP adapter
   - compatibility with the latest Erlang release R15B
   - some improvements to the management interface
   - general performance and stability improvements and bug fixes

See the attached release notes for more details.

Binary and source distributions of the new release can be found at
http://www.rabbitmq.com/download.html .

As always, we welcome any questions, bug reports, and other feedback on this
release, as well as general suggestions for features and enhancements in future
releases. Mail us on the RabbitMQ discussion list (signup on
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss and then
mail to <rabbitmq-discuss at lists.rabbitmq.com>), or contact us directly by
mailing to <info at rabbitmq.com>.

Regards,
              The RabbitMQ Team
              (http://www.rabbitmq.com)
----
Steve Powell
RabbitMQ, VMware
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.7.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111220/6ed7167f/attachment.txt>

From pranny at gmail.com  Tue Dec 20 16:11:19 2011
From: pranny at gmail.com (Pranav Prakash)
Date: Tue, 20 Dec 2011 08:11:19 -0800 (PST)
Subject: [rabbitmq-discuss] Priority Queue with RabbitMQ
In-Reply-To: <21179877.384.1324361111000.JavaMail.geo-discussion-forums@yqba2>
References: <21179877.384.1324361111000.JavaMail.geo-discussion-forums@yqba2>
Message-ID: <10933760.344.1324397479932.JavaMail.geo-discussion-forums@prht13>

Awesome. This is approx the same as what I was thinking. I am really 
excited about rabbit mq and would come up with more questions :)

Kudos to the team !!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111220/153f1008/attachment.htm>

From Simone.Busoli at ferrari.com  Tue Dec 20 16:19:51 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Tue, 20 Dec 2011 16:19:51 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <4EF0692D.8020606@rabbitmq.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com><4EEB44BE.7060304@rabbitmq.com><CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>

Indeed, the messages are not lost, but at least lost until the connection eventually goes down and then up once again, which does not necessarily happen frequently and not something you would be doing for the purpose of recovering messages which for some reason haven't been (n)acked, right? Therefore I'm wondering whether a mechanism, perhaps an options of the shovel and federation plugins (every x messages, every x seconds, ...), to process messages which have remain unconfirmed for some time should be introduced.

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: marted? 20 dicembre 2011 11:54
> To: Simone Busoli
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Reliable "publishing"
> 
> On 16/12/2011 8:05PM, Simone Busoli wrote:
> > On Fri, Dec 16, 2011 at 14:16, Simon MacMullen <simon at rabbitmq.com
> > <mailto:simon at rabbitmq.com>> wrote:
> >
> >     The only reason your client might not receive a (n)ack for any given
> >     message would be if the connection goes down
> >
> >
> > Exactly, which if you're looking for some degree of reliable delivery
> > is something you should take care of as well, right?
> > So what I understand - please correct me if I'm wrong - is that
> > neither Shovel nor Federation are doing anything with unconfirmed
> messages (i.e.
> > no acks/nacks), so theoretically some messages may be "lost" because
> > even if the upstream broker didn't receive an ack for them and will
> > thus store them until they're acked (as the plugin wouldn't send one
> > until it has received confirm from the downstream broker), there is
> > however no one who will issue a recover to the upstream broker to
> > request a requeue of those messages.
> 
> Recover is only one way to get unacked messages requeued - the connection
> going down is another.
> 
> In fact "recover" can really be understood as "pretend this connection went
> down".
> 
> So these messages won't be lost.
> 
> It is however possible for messages to get duplicated in these circumstances
> - for messages where the downstream has confirmed but the shovel /
> federation hasn't yet sent on the corresponding ack when the connection
> dies.
> 
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From matthias at rabbitmq.com  Tue Dec 20 16:31:14 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 16:31:14 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com><4EEB44BE.7060304@rabbitmq.com><CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
Message-ID: <4EF0B852.8060608@rabbitmq.com>

On 20/12/11 16:19, Busoli, Simone wrote:
> Therefore I'm wondering whether a mechanism, perhaps an options of
> the shovel and federation plugins (every x messages, every x seconds,
> ...), to process messages which have remain unconfirmed for some time
> should be introduced.

The server guarantees that every message requiring confirmation is 
eventually either ack'ed or nack'ed. So I don't see what a timeout would 
accomplish.

Matthias.

From hcoyote at ghostar.org  Tue Dec 20 16:42:22 2011
From: hcoyote at ghostar.org (Travis)
Date: Tue, 20 Dec 2011 10:42:22 -0600
Subject: [rabbitmq-discuss] Memory leak when using shovels?
Message-ID: <CAChq9g0SYyiZEEo_MR-Z9gEr1X_JYx1hUC3JukCUxEJpa6oVww@mail.gmail.com>

Hello,

Are there any known memory leaks when using shovels with 2.6.1?  We're
seeing a slow leak that grows over 6-8 days on a few instances of
rabbitmq that are using the shovel plugin and we're not exactly sure
why.  I'm not sure if this is related to the memory leak we previously
reported a few weeks ago that was fixed in 2.7.1

These instances are handling between 5 and 7 million messages a day.

The shovel config (and rabbit config) we're using is:


{rabbitmq_shovel,
   [{shovels,
     [{engine_my_prod_shovel,
       [{sources,      [{brokers,
["amqp://my-user-prod:rabbitmq-my-prod at localhost/my-prod"]},
                        {declarations,
                           ['queue.declare',
                            {'queue.bind',
                                   [{exchange, <<"my-exchange">>},
                                    {queue,    <<"my-queue">>}]}
                           ]}]},
        {destinations, [{brokers, [

"amqp://my-user-prod:rabbitmq-my-prod at aus-svc3/my-prod?heartbeat=5",

"amqp://my-user-prod:rabbitmq-my-prod at aus-svc4/my-prod?heartbeat=5"
                            ]},
                        {declarations,
                           [{'exchange.declare',
                                   [{exchange, <<"my-exchange">>},
                                    {type, <<"direct">>},
                                    durable]},
                            {'queue.bind',
                                   [{exchange, <<"my-exchange">>},
                                    {queue,    <<"my-queue">>}]}

                           ]}]},
        {queue, <<"my-queue">>},
        {prefetch_count, 1000},
        {ack_mode, on_confirm},
        {publish_properties, [{delivery_mode, 2}]},
        {publish_fields, [{exchange, <<"my-exchange">>},
                          {routing_key, <<"">>}]},
        {reconnect_delay, 5}
       ]}
      ]
    }]
}
].


I have the output of the following if it's helpful (though I won't
email it to the list; it's about 5M)

io:format("~p", [lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()]))]).


Travis
-- 
Travis Campbell
travis at ghostar.org

From matthias at rabbitmq.com  Tue Dec 20 19:20:26 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 19:20:26 +0000
Subject: [rabbitmq-discuss] Memory leak when using shovels?
In-Reply-To: <CAChq9g0SYyiZEEo_MR-Z9gEr1X_JYx1hUC3JukCUxEJpa6oVww@mail.gmail.com>
References: <CAChq9g0SYyiZEEo_MR-Z9gEr1X_JYx1hUC3JukCUxEJpa6oVww@mail.gmail.com>
Message-ID: <4EF0DFFA.4070705@rabbitmq.com>

Travis,

On 20/12/11 16:42, Travis wrote:
> Are there any known memory leaks when using shovels with 2.6.1?

Nope.

> We're seeing a slow leak that grows over 6-8 days on a few instances of
> rabbitmq that are using the shovel plugin and we're not exactly sure
> why.  I'm not sure if this is related to the memory leak we previously
> reported a few weeks ago that was fixed in 2.7.1

Is the shovel publishing to mirrored queues? If so then then it's 
probably the same problem.

> The shovel config (and rabbit config) we're using is:
>
>
> {rabbitmq_shovel,
>     [{shovels,
>       [{engine_my_prod_shovel,
>         [{sources,      [{brokers,
> ["amqp://my-user-prod:rabbitmq-my-prod at localhost/my-prod"]},
>                          {declarations,
>                             ['queue.declare',
>                              {'queue.bind',
>                                     [{exchange,<<"my-exchange">>},
>                                      {queue,<<"my-queue">>}]}
>                             ]}]},
>          {destinations, [{brokers, [
>
> "amqp://my-user-prod:rabbitmq-my-prod at aus-svc3/my-prod?heartbeat=5",
>
> "amqp://my-user-prod:rabbitmq-my-prod at aus-svc4/my-prod?heartbeat=5"
>                              ]},
>                          {declarations,
>                             [{'exchange.declare',
>                                     [{exchange,<<"my-exchange">>},
>                                      {type,<<"direct">>},
>                                      durable]},
>                              {'queue.bind',
>                                     [{exchange,<<"my-exchange">>},
>                                      {queue,<<"my-queue">>}]}
>
>                             ]}]},
>          {queue,<<"my-queue">>},
>          {prefetch_count, 1000},
>          {ack_mode, on_confirm},
>          {publish_properties, [{delivery_mode, 2}]},
>          {publish_fields, [{exchange,<<"my-exchange">>},
>                            {routing_key,<<"">>}]},
>          {reconnect_delay, 5}
>         ]}
>        ]
>      }]
> }
> ].

Two observations:

1) there is a stray 'queue.declare' in the first shovel config. This 
will cause a new queue to be created every time the shovel connection is 
interrupted. You would surely have seen those queues in the management 
UI and rabbitmqctl, so I doubt that's the cause of the leak.

2) Instead of the establishing a connection to 'localhost', specify no 
host at all, e.g.
"amqp://my-user-prod@/my-prod"; that way a more efficient and less fault 
prone direct connection is used instead of a network connection (which 
is also why no password is required).


Regards,

Matthias.

From mpietrek at skytap.com  Tue Dec 20 20:06:14 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 20 Dec 2011 12:06:14 -0800
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <CAHZAEpcZPXmLfLcZ0nW254BU86+u08kY+TZFYSBQtKxdS37dGQ@mail.gmail.com>
Message-ID: <CB16273E.2444D%mpietrek@skytap.com>

As a follow up to this thread, and in case somebody else can learn from my
learning experience, here are the steps that seem to work for me to run
RabbitMQ as a non-root/non-rabbitmq user.

In addition, I needed to set up clustering, management plugins, and make
rabbitmq not autostart at boot. This is using RabbitMQ 2.7 on Ubuntu 10.04.
YMMV. 

If anybody sees any pitfalls with the approach below, please feel free to
holler.

---- SETUP ----
# Do a fresh install
sudo apt-get install -y rabbitmq-server

# Enable management plugin
sudo rabbitmq-plugins enable rabbitmq_management

# Shut down the rabbitmq server
sudo rabbitmqctl stop

# Remove the mnesia directory, which was created as user rabbitmq, not what
we want.
sudo rm -rf /var/lib/rabbitmq/mnesia

# Prevent rabbitmq from auto starting on boot
sudo update-rc.d -f rabbitmq-server remove

# Rename the rabbitmq supplied commands that enforce user==rabbitmq or root
# This prevents innocent people from inadvertently using them. Entirely
optional.
sudo mv /usr/sbin/rabbitmqctl /usr/sbin/rabbitmqctl_dont_use
sudo mv /usr/sbin/rabbitmq-plugins /usr/sbin/rabbitmq-plugins_dont_use
sudo mv /usr/sbin/rabbitmq-server /usr/sbin/rabbitmq-server_dont_use

# Change ownership of all files previously created by RabbitMQ to
desired_user
sudo chown -R desired_user:desired_user /var/lib/rabbitmq
sudo chown -R desired_user: desired_user /var/log/rabbitmq
----


---- Launching as desired_user ----
export RABBITMQ_CONFIG_FILE=/home/desired_user/config/rabbitmq
export RABBITMQ_SERVER_ERL_ARGS="-setcookie rabbit"
export RABBITMQ_CTL_ERL_ARGS="-setcookie rabbit"

# Note that this is not the "normal" rabbitmq-server script in /usr/sbin/
/usr/lib/rabbitmq/bin/rabbitmq-server start
----

Finally, in /home/desired_user/config/rabbitmq.Config:

[
  {rabbit,
    [{cluster_nodes, ['rabbit at play', 'rabbit at play2']}
    ]
  }
].

Matt

On 12/19/11 3:53 PM, "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
wrote:

> I believe what you're looking for then is this section from the
> RabbitMQ clustering guide:
> 
> "As an alternative, you can insert the option "-setcookie cookie" in
> the erl call in the rabbitmq-server and rabbitmqctl scripts."
> 
> http://www.rabbitmq.com/clustering.html
> 
> For what it's worth, we create a rabbitmq user on every system (for us
> it's in LDAP, but you could write it out to the passwd file) and set
> its home directory to /var/lib/rabbitmq. We then write out the
> .erlang.cookie file into /var/lib/rabbitmq on every Rabbit node using
> Chef (with permissions 0600). We're running Ubuntu 10.04.x LTS.
> 
> 
> -J
> 
> On Mon, Dec 19, 2011 at 3:47 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>>  Thanks Jason.
>> 
>>  That's helpful, but in my admittedly limited knowledge, I don't believe that
>>  it's as simple as that. In particular I don't understand how handle files
>>  being installed with rabbitmq as the owner.
>> 
>>  A little more context that I forgot to mention earlier:
>> 
>>  I need to cluster multiple nodes so explicitly specifying the cookie is
>>  necessary so they're synced. Also, specifying the cookie via an environment
>>  variable is preferred to having an additional cookie file that I need to
>>  copy to multiple machines.
>>  I need to be able to launch everything from scratch via my own script file
>>  (which will be on all nodes.)
>> 
>>  My current thinking is that my startup script will set some RABBITMQ
>>  environment variables (RABBITMQ_CONFIG_FILE, RABBITMQ_SERVER_START_ARGS,
>>  RABBITMQ_CTL_ERL_ARGS,). The script will then directly run rabbit-server in
>>  /usr/lib/rabbitmq/bin. Also, RABBITMQ_CONFIG_FILE will point to the
>>  rabbitmq.config file that I've dropped on all nodes to set up auto
>>  clustering.)
>> 
>>  Thanks again,
>> 
>>  Matt
>> 
>>  On 12/19/11 2:31 PM, "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
>>  wrote:
>> 
>>  Hi Matt,
>> 
>>  This should do it on Ubuntu:
>> 
>>  sudo -H -u <user> /opt/rabbitmq-server/sbin/rabbitmq-server
>> 
>>  The Erlang process needs to find the Erlang cookie and will check the
>>  home directory of the executing user. You can also specify the
>>  explicit location of the Erlang cookie in the RabbitMQ arguments, but
>>  we find using the HOME environment simpler.
>> 
>>  -J
>> 
>>  On Mon, Dec 19, 2011 at 2:58 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
>> 
>>  We have a production environment where all of our services run in a special,
>>  non-root account an an Ubuntu 10.04 environment. I'm experimenting with how
>>  to make RabbitMQ 2.7 run in this special account, rather than as the
>>  "rabbitmq" user, and not having much luck.
>> 
>>  Extensive searching of the mailing list makes me think I'm close, but I
>>  suspect I'm missing something fundamental.
>> 
>>  I believe part of the answer involves explicitly setting the "-cookie"
>>  option in RABBITMQ_SERVER_START_ARGS and RABBITMQ_CTL_ERL_ARGS environment
>>  variables.
>>  I also suspect that the answer also involves running the "low level" scripts
>>  in /usr/lib/rabbitmq/bin/, rather than the scripts in /usr/sbin/.
>>  Further, I suspect that some directories may need to have their ownership
>>  and/or attributes changed to something other than "rabbitmq".
>> 
>>  So what I'm looking for is a list of what exactly I need to do, both at
>>  launch time, as well as possibly at install time.
>> 
>>  FWIW, we need to launch rabbitmq-server ourselves, rather than having it
>>  auto start on boot. I know how to accomplish this, but it might be useful
>>  context when deciding how to approach the above.
>> 
>>  Thanks much,
>> 
>>  Matt
>> 
>> 
>> 
>>  _______________________________________________
>>  rabbitmq-discuss mailing list
>>  rabbitmq-discuss at lists.rabbitmq.com
>>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111220/9ba97419/attachment.htm>

From mpietrek at skytap.com  Tue Dec 20 21:04:50 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 20 Dec 2011 13:04:50 -0800
Subject: [rabbitmq-discuss] 404, "NOT_FOUND - no queue 'foo' in vhost '/'"
Message-ID: <CB163872.2448B%mpietrek@skytap.com>

I'm encountering a strange situation that I don't think has been covered by
other threads.

I'm running RabbitMQ 2.7.0 on Ubuntu 10.04 LTS with the stock PIKA 0.9.5
client, and taking advantage of mirrored queues.

My scenario:
* I have two apps that ping-pong messages to each other using two queues (a
pseudo-RPC type of thing.)
* The apps talk to RabbitMQ via a keepalived monitored Virtual IP.
* Before starting the apps, I predeclare both queues.
* In the RabbitMQ management Web UI, I see both nodes and the Queues tab
shows both queues as "HA D", so I believe they're mirrored.
* Start up the two ping-ponging apps, let run for few seconds. Note messages
flowing back and forth.
* Stop the primary node (rabbitmqctl stop)
* Keepalived fails over the Virtual IP
* After a few seconds I see one of the apps resume processing messages as
expected.
* Shortly thereafter the other app gets an exception from
channel.basic_get(), which is the 404 "no queue found" exception.
* I don't believe it's a connection error, as during my queue reads, my
logic catches AMQPConnectionErrors exceptions and retries after a short
wait.
I've looked at my code carefully, and there's no calls to queue_declare
other than the original creation (item 3, above.)

Any thoughts on what could be wrong?

Thanks much,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111220/a94587f5/attachment.htm>

From jruiz at johnruiz.com  Tue Dec 20 22:07:13 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 20 Dec 2011 14:07:13 -0800 (PST)
Subject: [rabbitmq-discuss] x509 Authentication
Message-ID: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>

Have there been any changes since this thread?

https://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3d4c11d3b9a58d3c/5a93c4460ec3e351?lnk=gst&q=+ssl+authentication#5a93c4460ec3e351

Like the original author, I would like to be able to use the DN of the
certificate's subject as the identity of the user connecting to
rabbitmq.

From jruiz at johnruiz.com  Tue Dec 20 22:27:32 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 20 Dec 2011 14:27:32 -0800 (PST)
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
Message-ID: <88de4735-22a7-4024-a07a-e2095342c6a9@z25g2000vbs.googlegroups.com>

Also,  I should mention that I'm going to setup my server to use
auth_mechanism_ssl (even though it uses CN instead of DN).

Will the user name be "CN=John Ruiz" or will the user name be "John
Ruiz"?

On Dec 20, 5:07?pm, John Ruiz <jr... at johnruiz.com> wrote:
> Have there been any changes since this thread?
>
> https://groups.google.com/group/rabbitmq-discuss/browse_thread/thread...
>
> Like the original author, I would like to be able to use the DN of the
> certificate's subject as the identity of the user connecting to
> rabbitmq.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wsmith at tacc.utexas.edu  Tue Dec 20 22:35:14 2011
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Tue, 20 Dec 2011 22:35:14 +0000
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>


I haven't checked back with the developers, but what I ended up doing was hacking the rabbit_auth_mechanism_ssl plugin to do what I want (I should have created a new plugin, but...). I replaced the init() function in rabbit_auth_mechanism_ssl.erl with:

init(Sock) ->
    Username = case rabbit_net:peercert(Sock) of
		   {ok, C} ->
                       DNWithQuotes = lists:flatten(rabbit_ssl:peer_cert_subject(C)),
                       DN = list_to_binary([E || E <- DNWithQuotes, E =/= $"]),
                       rabbit_log:info("  subject: ~p~n", [DN]),
                       case config_sane() of
                           true  -> DN;
                           false -> {refused, "configuration unsafe", []}
                       end;
                   {error, no_peercert} ->
                       {refused, "no peer certificate", []};
                   nossl ->
                       {refused, "not SSL connection", []}
               end,
    #state{username = Username}.

And built the plugin (look at http://www.rabbitmq.com/plugin-development.html, in particular Getting Started).

I was having some issues with quotes in DNs and how erlang does them vs how openssl does them (I'm using openssl to get DN strings from X.509 certificates before calling rabbitmqctl set_permissions). So the code above just removes quotes from DNs when creating user names.

This was with rabbitmq 2.4.1, so I can't guarantee that the modification above works with the current version.


Warren


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of John Ruiz
Sent: Tuesday, December 20, 2011 4:07 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] x509 Authentication

Have there been any changes since this thread?

https://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3d4c11d3b9a58d3c/5a93c4460ec3e351?lnk=gst&q=+ssl+authentication#5a93c4460ec3e351

Like the original author, I would like to be able to use the DN of the
certificate's subject as the identity of the user connecting to
rabbitmq.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Tue Dec 20 22:44:10 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 20 Dec 2011 14:44:10 -0800
Subject: [rabbitmq-discuss] 404,
	"NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <CB163872.2448B%mpietrek@skytap.com>
Message-ID: <CB164E24.24773%mpietrek@skytap.com>

Some additional information I've learned since posting the original, below.

After shutting down the primary node, the queue causing the 404 error has
actually vanished from the broker. Keeping an eye on the Management Web UI,
I literally see it disappear.

In addition, in the rabbit@<nodename>.log, I see a whole bunch of spew,
including many instances of this:

=WARNING REPORT==== 20-Dec-2011::14:09:17 ===
Non-AMQP exit reason '{{{function_clause,
                            [{gb_trees,lookup,
                   
[<<150,83,52,247,194,247,140,35,130,167,168,
                                    35,224,203,183,186>>,
                                  {dict,0,16,16,8,80,48,
                   
{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                       [],[],[]},
                                      {{[],[],[],[],[],[],[],[],[],[],[],[],
                                        [],[],[],[]}}}]},
                             {rabbit_amqqueue_process,
                                 '-confirm_messages/2-fun-0-',2},
                             {lists,foldl,3},
                             {rabbit_amqqueue_process,confirm_messages,2},
                             {rabbit_amqqueue_process,next_state,1},
                             {rabbit_amqqueue_process,noreply,1},
                             {gen_server2,handle_msg,2},
                             {proc_lib,wake_up,3}]},
                        {gen_server2,call,
                            [<0.1298.0>,
                             {basic_get,<0.2542.0>,false},
                             infinity]}},
                       [{gen_server2,call,3},
                        {rabbit_misc,with_exit_handler,2},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,2},
                        {proc_lib,init_p_do_apply,3}]}'

Again, this is a stock 2.7.0 install.

From:  Matt Pietrek <mpietrek at skytap.com>
Date:  Tue, 20 Dec 2011 13:04:50 -0800
To:  <rabbitmq-discuss at lists.rabbitmq.com>
Cc:  Matt Pietrek <mpietrek at skytap.com>
Subject:  404, "NOT_FOUND - no queue 'foo' in vhost '/'"

I'm encountering a strange situation that I don't think has been covered by
other threads.

I'm running RabbitMQ 2.7.0 on Ubuntu 10.04 LTS with the stock PIKA 0.9.5
client, and taking advantage of mirrored queues.

My scenario:
* I have two apps that ping-pong messages to each other using two queues (a
pseudo-RPC type of thing.)
* The apps talk to RabbitMQ via a keepalived monitored Virtual IP.
* Before starting the apps, I predeclare both queues.
* In the RabbitMQ management Web UI, I see both nodes and the Queues tab
shows both queues as "HA D", so I believe they're mirrored.
* Start up the two ping-ponging apps, let run for few seconds. Note messages
flowing back and forth.
* Stop the primary node (rabbitmqctl stop)
* Keepalived fails over the Virtual IP
* After a few seconds I see one of the apps resume processing messages as
expected.
* Shortly thereafter the other app gets an exception from
channel.basic_get(), which is the 404 "no queue found" exception.
* I don't believe it's a connection error, as during my queue reads, my
logic catches AMQPConnectionErrors exceptions and retries after a short
wait.
I've looked at my code carefully, and there's no calls to queue_declare
other than the original creation (item 3, above.)

Any thoughts on what could be wrong?

Thanks much,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111220/b90fc2e5/attachment.htm>

From simone.busoli at gmail.com  Tue Dec 20 23:11:17 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 21 Dec 2011 00:11:17 +0100
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <4EF0B852.8060608@rabbitmq.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
Message-ID: <CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>

Guarantees under which circumstances specifically? I'm thinking about
connection shutdowns, broker crashes, this kind of events. Let me clarify
that I'm just trying to understand, as I'm building a library which
encapsulates this behavior using publisher confirms, and I'm facing the
problem of making sure that all messages reach the destination, and thus
what to do when messages are not (n)acked by the broker, if that can ever
happen.

On Tue, Dec 20, 2011 at 17:31, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 20/12/11 16:19, Busoli, Simone wrote:
>
>> Therefore I'm wondering whether a mechanism, perhaps an options of
>> the shovel and federation plugins (every x messages, every x seconds,
>> ...), to process messages which have remain unconfirmed for some time
>> should be introduced.
>>
>
> The server guarantees that every message requiring confirmation is
> eventually either ack'ed or nack'ed. So I don't see what a timeout would
> accomplish.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/ebf4c2b4/attachment.htm>

From matthias at rabbitmq.com  Tue Dec 20 23:12:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 23:12:27 +0000
Subject: [rabbitmq-discuss] 404,
 "NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <CB164E24.24773%mpietrek@skytap.com>
References: <CB164E24.24773%mpietrek@skytap.com>
Message-ID: <4EF1165B.6040300@rabbitmq.com>

On 20/12/11 22:44, Matt Pietrek wrote:
> In addition, in the rabbit@<nodename>.log, I see a whole bunch of spew,
> including many instances of this:
>
> =WARNING REPORT==== 20-Dec-2011::14:09:17 ===
> Non-AMQP exit reason '{{{function_clause,
> [{gb_trees,lookup,
> [<<150,83,52,247,194,247,140,35,130,167,168,
> 35,224,203,183,186>>,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],[]},
> {{[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],[],[]}}}]},
> {rabbit_amqqueue_process,
> '-confirm_messages/2-fun-0-',2},
> [...]
> Again, this is a stock 2.7.0 install.

The above got fixed in 2.7.1.

Matthias.

From matthias at rabbitmq.com  Tue Dec 20 23:16:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 23:16:19 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
	<CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
Message-ID: <4EF11743.4030502@rabbitmq.com>

On 20/12/11 23:11, Simone Busoli wrote:
> Guarantees under which circumstances specifically? I'm thinking about
> connection shutdowns, broker crashes, this kind of events.

If the broker crashes the connection goes down. You can treat the 
connection going down as a nack for all outstanding publishes.

Matthias.

From simone.busoli at gmail.com  Tue Dec 20 23:20:21 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 21 Dec 2011 00:20:21 +0100
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <4EF11743.4030502@rabbitmq.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
	<CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
	<4EF11743.4030502@rabbitmq.com>
Message-ID: <CAOn7oW-o9Ah7o_CbmpEr2b74WrkcnKaaZFFBb71waWDPNFLNSw@mail.gmail.com>

But as far as I can see this logic is not built into the shovel and
federation plugins, which are thus not doing anything with unconfirmed
messages.

On Wed, Dec 21, 2011 at 00:16, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 20/12/11 23:11, Simone Busoli wrote:
>
>> Guarantees under which circumstances specifically? I'm thinking about
>> connection shutdowns, broker crashes, this kind of events.
>>
>
> If the broker crashes the connection goes down. You can treat the
> connection going down as a nack for all outstanding publishes.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/5807b87c/attachment.htm>

From matthias at rabbitmq.com  Tue Dec 20 23:23:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 23:23:10 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <CAOn7oW-o9Ah7o_CbmpEr2b74WrkcnKaaZFFBb71waWDPNFLNSw@mail.gmail.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
	<CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
	<4EF11743.4030502@rabbitmq.com>
	<CAOn7oW-o9Ah7o_CbmpEr2b74WrkcnKaaZFFBb71waWDPNFLNSw@mail.gmail.com>
Message-ID: <4EF118DE.9080606@rabbitmq.com>

On 20/12/11 23:20, Simone Busoli wrote:
> But as far as I can see this logic is not built into the shovel and
> federation plugins, which are thus not doing anything with unconfirmed
> messages.

iirc shovel and federation close the upstream connection when the 
downstream connection goes down. This causes any unconfirmed (and thus 
unacked) messages to be requeued upstream.

Matthias.

From simone.busoli at gmail.com  Tue Dec 20 23:24:42 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 21 Dec 2011 00:24:42 +0100
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <4EF118DE.9080606@rabbitmq.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
	<CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
	<4EF11743.4030502@rabbitmq.com>
	<CAOn7oW-o9Ah7o_CbmpEr2b74WrkcnKaaZFFBb71waWDPNFLNSw@mail.gmail.com>
	<4EF118DE.9080606@rabbitmq.com>
Message-ID: <CAOn7oW-SPNVamgwude=UXoeT9vfSjS9A=sxrgsuv1F_utgJi0A@mail.gmail.com>

Ok, that is probably the bit I was missing, I will check it out. Thanks for
pointing that out and thanks for your help.

On Wed, Dec 21, 2011 at 00:23, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 20/12/11 23:20, Simone Busoli wrote:
>
>> But as far as I can see this logic is not built into the shovel and
>> federation plugins, which are thus not doing anything with unconfirmed
>> messages.
>>
>
> iirc shovel and federation close the upstream connection when the
> downstream connection goes down. This causes any unconfirmed (and thus
> unacked) messages to be requeued upstream.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/1f2b6f0d/attachment.htm>

From matthias at rabbitmq.com  Tue Dec 20 23:31:08 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Dec 2011 23:31:08 +0000
Subject: [rabbitmq-discuss] Reliable "publishing"
In-Reply-To: <CAOn7oW-SPNVamgwude=UXoeT9vfSjS9A=sxrgsuv1F_utgJi0A@mail.gmail.com>
References: <CAOn7oW8FiHVjM+nrcc=SvcF5k0cErXX9t36jdOkFPDnjxpZk9Q@mail.gmail.com>
	<4EEB44BE.7060304@rabbitmq.com>
	<CAOn7oW-gqSbRmb2BNEWRzc+fSF3+LFKEhFb-FTCUhgdBu8vmsw@mail.gmail.com>
	<4EF0692D.8020606@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E520B87DE@GSVCLU03.ges.ferlan.it>
	<4EF0B852.8060608@rabbitmq.com>
	<CAOn7oW8z+Vmt7sTedDZrebS_RexsebBQo-odouecHs15Q6S+HQ@mail.gmail.com>
	<4EF11743.4030502@rabbitmq.com>
	<CAOn7oW-o9Ah7o_CbmpEr2b74WrkcnKaaZFFBb71waWDPNFLNSw@mail.gmail.com>
	<4EF118DE.9080606@rabbitmq.com>
	<CAOn7oW-SPNVamgwude=UXoeT9vfSjS9A=sxrgsuv1F_utgJi0A@mail.gmail.com>
Message-ID: <4EF11ABC.5020606@rabbitmq.com>

Simone,

On 20/12/11 23:24, Simone Busoli wrote:
> Ok, that is probably the bit I was missing, I will check it out. Thanks
> for pointing that out and thanks for your help.

I have just quickly checked the shovel and it does indeed do what I 
said. See 
http://hg.rabbitmq.com/rabbitmq-shovel/file/default/src/rabbit_shovel_worker.erl, 
in particular:
- the worker links the upstream and downstream connection processes to 
itself
- the worker traps exits
- when getting an exit signal from either connection process it terminates
- on termination it closes all connection processes

...after which the supervisor logic will kick in and eventually restart 
the worker.

Matthias.

From mpietrek at skytap.com  Tue Dec 20 23:58:55 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 20 Dec 2011 15:58:55 -0800
Subject: [rabbitmq-discuss] 404,
	"NOT_FOUND - no queue 'foo' in vhost '/'"
In-Reply-To: <4EF1165B.6040300@rabbitmq.com>
Message-ID: <CB166107.2507D%mpietrek@skytap.com>

Indeed! In my hour or so of testing I just did, 2.7.1 seems much happier,
and appears to handle VIP failover reasonably well in my scenario.

Thanks much!

Matt

On 12/20/11 3:12 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 20/12/11 22:44, Matt Pietrek wrote:
>> In addition, in the rabbit@<nodename>.log, I see a whole bunch of spew,
>> including many instances of this:
>>
>> =WARNING REPORT==== 20-Dec-2011::14:09:17 ===
>> Non-AMQP exit reason '{{{function_clause,
>> [{gb_trees,lookup,
>> [<<150,83,52,247,194,247,140,35,130,167,168,
>> 35,224,203,183,186>>,
>> {dict,0,16,16,8,80,48,
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],
>> [],[],[]},
>> {{[],[],[],[],[],[],[],[],[],[],[],[],
>> [],[],[],[]}}}]},
>> {rabbit_amqqueue_process,
>> '-confirm_messages/2-fun-0-',2},
>> [...]
>> Again, this is a stock 2.7.0 install.
>
>The above got fixed in 2.7.1.
>
>Matthias.



From joeyfitz at gmail.com  Wed Dec 21 04:59:31 2011
From: joeyfitz at gmail.com (joefitzgerald)
Date: Tue, 20 Dec 2011 20:59:31 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 2.7.1 is released
In-Reply-To: <4F27B1EA-2781-4B8F-ADA4-3BE6EC8AE0C5@rabbitmq.com>
References: <4F27B1EA-2781-4B8F-ADA4-3BE6EC8AE0C5@rabbitmq.com>
Message-ID: <e21362aa-e593-4fa9-a920-13158c38c15a@f8g2000prm.googlegroups.com>

The NuGet packages for the RabbitMQ .NET Client have been updated to
2.7.1.

* https://nuget.org/packages/RabbitMQ.Client
* https://nuget.org/packages/RabbitMQ.ServiceModel

Additionally the _alpha_ version of Spring AMQP for .NET has been
updated to depend on the 2.7.1 release of the RabbitMQ.Client package
and the 4.0.5 release of JSON.NET:

* https://nuget.org/packages/Spring.Messaging.Amqp
* https://nuget.org/packages/Spring.Messaging.Amqp.Rabbit

Best Regards,
Joe Fitzgerald

On Dec 20, 4:53?am, Steve Powell <st... at rabbitmq.com> wrote:
> The RabbitMQ team is delighted to announce the release of RabbitMQ 2.7.1.
>
> This release includes:
>
> ? ?- fixes to queue recovery and high availability node recovery
> ? ?- fixes to the STOMP adapter
> ? ?- compatibility with the latest Erlang release R15B
> ? ?- some improvements to the management interface
> ? ?- general performance and stability improvements and bug fixes
>
> See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found athttp://www.rabbitmq.com/download.html.
>
> As always, we welcome any questions, bug reports, and other feedback on this
> release, as well as general suggestions for features and enhancements in future
> releases. Mail us on the RabbitMQ discussion list (signup onhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discussand then
> mail to <rabbitmq-discuss at lists.rabbitmq.com>), or contact us directly by
> mailing to <info at rabbitmq.com>.
>
> Regards,
> ? ? ? ? ? ? ? The RabbitMQ Team
> ? ? ? ? ? ? ? (http://www.rabbitmq.com)
> ----
> Steve Powell
> RabbitMQ, VMware
>
> ?README-2.7.1.txt
> 3KViewDownload
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lionel.cons at cern.ch  Wed Dec 21 07:22:08 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 21 Dec 2011 08:22:08 +0100
Subject: [rabbitmq-discuss] x509 Authentication
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>
	(Warren Smith's message of "Tue, 20 Dec 2011 22:35:14 +0000")
References: <7bd10e4e-0ca5-44b8-988e-6a5693888e6e@z25g2000vbs.googlegroups.com>
	<4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46@EXMBX03.austin.utexas.edu>
Message-ID: <bw71ury1ja7.fsf@mail.cern.ch>

Warren Smith <wsmith at tacc.utexas.edu> writes:
> I haven't checked back with the developers, but what I ended up doing
> was hacking the rabbit_auth_mechanism_ssl plugin to do what I want (I
> should have created a new plugin, but...).

FWIW, we have a similar need here (use DN rather than CN) but we use
STOMP that does not use rabbit_auth_mechanism_ssl. So I ended up
modifying the STOMP plugin to make it work.

It would really be good to improve X.509 authentication in a consistent
way in RabbitMQ. Things I can think of:
 - use common code between AMQP and STOMP
 - use DN rather than CN, maybe via a configurable option
 - standard DN cleanup (such as your quotes removal)

IMHO, the most tricky part is what to do if the connection has both a
valid certificate and a valid name/password.

Cheers,

Lionel Cons

From mh at foldr3.com  Wed Dec 21 10:19:16 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 11:19:16 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4ED4BA64.2060504@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>
	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>
	<4ECD2216.40300@rabbitmq.com> <4ECE53E5.5000002@foldr3.com>
	<4ECE6F72.7020502@rabbitmq.com> <4ED38204.802@foldr3.com>
	<4ED3AEB1.60604@rabbitmq.com> <4ED3E04C.9020508@foldr3.com>
	<4ED4BA64.2060504@rabbitmq.com>
Message-ID: <4EF1B2A4.1050402@foldr3.com>

On 11/29/2011 11:56 AM, Simon MacMullen wrote:
> On 28/11/11 19:26, Muharem Hrnjadovic wrote:
>> Simon, I plan to upgrade that server to ubuntu 11.10 which would give me
>> erlang 14.b.2 out of the box. Would that be good enough?
> 
> Yes, that would be great. Thanks!
Simon,

finally got around to reproducing the situation. After upgrading to
ubuntu 11.10 server and rabbitmq-2.7.1 the latter is using much less
memory (around 3GB). It also does not crash but stays up albeit in
a "wedged" state i.e. it would not accept any further messages.

I see this by calling "celeryctl inspect active" -- it just hangs as
opposed to printing the active celery jobs (and it collects the celery
data by sending/receiving messages).

Just before getting into the stuck state I ran "rabbitmqctl report"
(please see https://bugs.launchpad.net/openquake/+bug/894024/comments/6)
and the RAM usage command ypou kindly supplied (please see
https://bugs.launchpad.net/openquake/+bug/894024/comments/7).

I hope this helps.

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/1673116b/attachment.pgp>

From matthias at rabbitmq.com  Wed Dec 21 11:06:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Dec 2011 11:06:31 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1B2A4.1050402@foldr3.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com>
Message-ID: <4EF1BDB7.6020304@rabbitmq.com>

Muharem,

On 21/12/11 10:19, Muharem Hrnjadovic wrote:
> Just before getting into the stuck state I ran "rabbitmqctl report"
> (please see https://bugs.launchpad.net/openquake/+bug/894024/comments/6)
> and the RAM usage command ypou kindly supplied (please see
> https://bugs.launchpad.net/openquake/+bug/894024/comments/7).

The latter report doesn't show all that much memory being used by the 
top 30 processes.

Btw, as of 2.7.1 you should be able to produce that report with

rabbitmqctl eval
'[{Mem, Pid, process_info(Pid)} || {Mem, Pid} <- 
lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory), Pid} 
|| Pid <- processes()])), 30)].'

(this is tweaked slightly to be more efficient when there are lots of 
processes, which I suspect is the case in your rabbit)

Try doing that *while* it is wedged. And also send us the output of 
'rabbitmqctl report'. Again, while rabbit is wedged.

My hunch is that you probably have many thousands of celery result queue 
processes.

Regards,

Matthias.

From mh at foldr3.com  Wed Dec 21 11:26:23 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 12:26:23 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1BDB7.6020304@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
Message-ID: <4EF1C25F.1060302@foldr3.com>

On 12/21/2011 12:06 PM, Matthias Radestock wrote:
> Muharem,
> 
> On 21/12/11 10:19, Muharem Hrnjadovic wrote:
>> Just before getting into the stuck state I ran "rabbitmqctl report"
>> (please see https://bugs.launchpad.net/openquake/+bug/894024/comments/6)
>> and the RAM usage command ypou kindly supplied (please see
>> https://bugs.launchpad.net/openquake/+bug/894024/comments/7).
> 
> The latter report doesn't show all that much memory being used by the
> top 30 processes.
> 
> Btw, as of 2.7.1 you should be able to produce that report with
> 
> rabbitmqctl eval
> '[{Mem, Pid, process_info(Pid)} || {Mem, Pid} <- lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory), Pid} || Pid <- processes()])), 30)].'
> 
> (this is tweaked slightly to be more efficient when there are lots of
> processes, which I suspect is the case in your rabbit)
Nice.

> Try doing that *while* it is wedged. And also send us the output of
> 'rabbitmqctl report'. Again, while rabbit is wedged.
Please see https://bugs.launchpad.net/openquake/+bug/894024/comments/8
and https://bugs.launchpad.net/openquake/+bug/894024/comments/9
respectively.

> My hunch is that you probably have many thousands of celery result
> queue processes.
Hmm .. I can see that the celery result queues (which are all
auto-delete queues) are deleted after the result has been consumed.
Why would the respective processes still hang around?

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/c11f6669/attachment.pgp>

From matthias at rabbitmq.com  Wed Dec 21 11:44:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Dec 2011 11:44:30 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1C25F.1060302@foldr3.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com>
Message-ID: <4EF1C69E.6050505@rabbitmq.com>

Muharem,

On 21/12/11 11:26, Muharem Hrnjadovic wrote:
> On 12/21/2011 12:06 PM, Matthias Radestock wrote:
>> Try doing that *while* it is wedged. And also send us the output of
>> 'rabbitmqctl report'. Again, while rabbit is wedged.
> Please see https://bugs.launchpad.net/openquake/+bug/894024/comments/8
> and https://bugs.launchpad.net/openquake/+bug/894024/comments/9
> respectively.
>
>> My hunch is that you probably have many thousands of celery result
>> queue processes.
> Hmm .. I can see that the celery result queues (which are all
> auto-delete queues) are deleted after the result has been consumed.
> Why would the respective processes still hang around?

I was wrong. You have more than 47,000 connections! And the same number 
of channels (unsurprisingly). But you "only" have about 16,000 queues.

Congratulations. This is by far the fattest rabbit I've ever seen 
(except those stuffed full of messages).

I have no idea why all these connections, channels and queues are there. 
That's a question for the celery guys.

Regards,

Matthias.

From alexis at rabbitmq.com  Wed Dec 21 11:49:44 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 21 Dec 2011 11:49:44 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1C69E.6050505@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com> <4ECCCE5A.3020909@rabbitmq.com>
	<4ECD0BCB.3090304@foldr3.com> <4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com> <4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com> <4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com> <4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
Message-ID: <CACOPnvfjKY+eTDTULcrcB2EOhw9RApNoEEEDkp+HwW8L9qrubQ@mail.gmail.com>

On Wed, Dec 21, 2011 at 11:44 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>
> I was wrong. You have more than 47,000 connections! And the same number of
> channels (unsurprisingly). But you "only" have about 16,000 queues.
>
> Congratulations. This is by far the fattest rabbit I've ever seen (except
> those stuffed full of messages).

I've seen Rabbits with 100,000s of queues per broker, in social
network / social gaming cases...

There's also the 'cloud management' case but they tend to have more
brokers and fewer queues / broker.

a

From matthias at rabbitmq.com  Wed Dec 21 11:53:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Dec 2011 11:53:58 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1C69E.6050505@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
Message-ID: <4EF1C8D6.4060606@rabbitmq.com>

On 21/12/11 11:44, Matthias Radestock wrote:
> I was wrong. You have more than 47,000 connections! And the same number
> of channels (unsurprisingly). But you "only" have about 16,000 queues.

Btw, while that explains why there are ~3GB of memory taken up by 
processes, it does not explain why rabbit is "wedged" since it looks 
like the memory limit is 60GB. Could it be that you have run out of file 
descriptors? The limits for that are printed at the start of the rabbit log.

Matthias.

From monosodiumg at gmail.com  Wed Dec 21 01:28:40 2011
From: monosodiumg at gmail.com (monosodiumg)
Date: Tue, 20 Dec 2011 17:28:40 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ to the browser - scale question
Message-ID: <b2f00a6e-4af2-4929-a9e0-01b838e29122@u5g2000vbd.googlegroups.com>

My use case is distributing data updates  to user's browsers. Typical
initial load of 5KB and updates of <200B at a rate of 0.5 updates/s. I
have 500 topics and 1M browser clients, with a very uneven sub
profile  e.g. 30% of users subscribing to the same one topic. Most
users subscribe to just one topic. Clients using browsers are a bit
erratic.

I have a few questions:
1. Can RabbitMQ handle that load?
2. What is the roadmap for rabbitmq_jsonrpc_channel?
3. How does RabbitMQ (+jsonrpc plugin) deal with browser clients
failing to disconnect explicitly?
4. What does this mean for thread and socket counts server-side?

From mh at foldr3.com  Wed Dec 21 12:31:09 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 13:31:09 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1C69E.6050505@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
Message-ID: <4EF1D18D.1060407@foldr3.com>

On 12/21/2011 12:44 PM, Matthias Radestock wrote:
> Muharem,
> 
> On 21/12/11 11:26, Muharem Hrnjadovic wrote:
>> On 12/21/2011 12:06 PM, Matthias Radestock wrote:
>>> Try doing that *while* it is wedged. And also send us the output of
>>> 'rabbitmqctl report'. Again, while rabbit is wedged.
>> Please see https://bugs.launchpad.net/openquake/+bug/894024/comments/8
>> and https://bugs.launchpad.net/openquake/+bug/894024/comments/9
>> respectively.
>>
>>> My hunch is that you probably have many thousands of celery result
>>> queue processes.
>> Hmm .. I can see that the celery result queues (which are all
>> auto-delete queues) are deleted after the result has been consumed.
>> Why would the respective processes still hang around?
> 
> I was wrong. You have more than 47,000 connections! And the same
> number of channels (unsurprisingly). But you "only" have about 16,000
> queues.
Wow! That means our celery workers are opening a connection per task and
not closing it. We *do* get stuck after approx. 47,000 tasks.
Thank you very much for looking into this and finding the actual
problem!

> Congratulations. This is by far the fattest rabbit I've ever seen
> (except those stuffed full of messages).
Heh :-)

> I have no idea why all these connections, channels and queues are
> there. That's a question for the celery guys.
Right. Now that you have pointed out the root cause I want to check a
couple of things before involving the celery folks.

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/0234d381/attachment.pgp>

From mh at foldr3.com  Wed Dec 21 12:36:52 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 13:36:52 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1C8D6.4060606@rabbitmq.com>
References: <4ECCCB33.3040803@foldr3.com>	<4ECCCE5A.3020909@rabbitmq.com>	<4ECD0BCB.3090304@foldr3.com>	<4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com>	<4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com>	<4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com>	<4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
	<4EF1C8D6.4060606@rabbitmq.com>
Message-ID: <4EF1D2E4.3050708@foldr3.com>

On 12/21/2011 12:53 PM, Matthias Radestock wrote:
> On 21/12/11 11:44, Matthias Radestock wrote:
>> I was wrong. You have more than 47,000 connections! And the same number
>> of channels (unsurprisingly). But you "only" have about 16,000 queues.
> 
> Btw, while that explains why there are ~3GB of memory taken up by
> processes, it does not explain why rabbit is "wedged" since it looks
> like the memory limit is 60GB. Could it be that you have run out of
> file descriptors? The limits for that are printed at the start of the
> rabbit log.
Matthias, that makes a lot of sense.

    =INFO REPORT==== 21-Dec-2011::07:53:12 ===
    Limiting to approx 52668 file handles (47399 sockets)

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/5475ad61/attachment.pgp>

From mh at foldr3.com  Wed Dec 21 12:42:10 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 13:42:10 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <CACOPnvfjKY+eTDTULcrcB2EOhw9RApNoEEEDkp+HwW8L9qrubQ@mail.gmail.com>
References: <4ECCCB33.3040803@foldr3.com> <4ECCCE5A.3020909@rabbitmq.com>
	<4ECD0BCB.3090304@foldr3.com> <4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com> <4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com> <4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com> <4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
	<CACOPnvfjKY+eTDTULcrcB2EOhw9RApNoEEEDkp+HwW8L9qrubQ@mail.gmail.com>
Message-ID: <4EF1D422.4080802@foldr3.com>

On 12/21/2011 12:49 PM, Alexis Richardson wrote:
> On Wed, Dec 21, 2011 at 11:44 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>>
>> I was wrong. You have more than 47,000 connections! And the same number of
>> channels (unsurprisingly). But you "only" have about 16,000 queues.
>>
>> Congratulations. This is by far the fattest rabbit I've ever seen (except
>> those stuffed full of messages).
> 
> I've seen Rabbits with 100,000s of queues per broker, in social
> network / social gaming cases...
> 
> There's also the 'cloud management' case but they tend to have more
> brokers and fewer queues / broker.
Alexis,

I believe we have a fault in the task function that is run by celery
(i.e. in our code) with the effect that a *new* rabbitmq connection is
opened upon every invocation while the already utilised ones cannot be
"garbage collected" for some reason.

We should never have that many open connections. Looking into this..

Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/df2759f0/attachment.pgp>

From alexis at rabbitmq.com  Wed Dec 21 13:05:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 21 Dec 2011 13:05:32 +0000
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <4EF1D422.4080802@foldr3.com>
References: <4ECCCB33.3040803@foldr3.com> <4ECCCE5A.3020909@rabbitmq.com>
	<4ECD0BCB.3090304@foldr3.com> <4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com> <4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com> <4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com> <4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
	<CACOPnvfjKY+eTDTULcrcB2EOhw9RApNoEEEDkp+HwW8L9qrubQ@mail.gmail.com>
	<4EF1D422.4080802@foldr3.com>
Message-ID: <CACOPnvcw_=3cZJN26LQhtW5OnT7J+14mBGgE00EYEM3nkhhEEQ@mail.gmail.com>

adding Ask to cc..

On Wed, Dec 21, 2011 at 12:42 PM, Muharem Hrnjadovic <mh at foldr3.com> wrote:
> On 12/21/2011 12:49 PM, Alexis Richardson wrote:
>> On Wed, Dec 21, 2011 at 11:44 AM, Matthias Radestock
>> <matthias at rabbitmq.com> wrote:
>>>
>>> I was wrong. You have more than 47,000 connections! And the same number of
>>> channels (unsurprisingly). But you "only" have about 16,000 queues.
>>>
>>> Congratulations. This is by far the fattest rabbit I've ever seen (except
>>> those stuffed full of messages).
>>
>> I've seen Rabbits with 100,000s of queues per broker, in social
>> network / social gaming cases...
>>
>> There's also the 'cloud management' case but they tend to have more
>> brokers and fewer queues / broker.
> Alexis,
>
> I believe we have a fault in the task function that is run by celery
> (i.e. in our code) with the effect that a *new* rabbitmq connection is
> opened upon every invocation while the already utilised ones cannot be
> "garbage collected" for some reason.
>
> We should never have that many open connections. Looking into this..
>
> Best regards/Mit freundlichen Gr??en
>
> --
> Muharem Hrnjadovic <mh at foldr3.com>
> Public key id ? : B2BBFCFC
> Key fingerprint : A5A3 CC67 2B87 D641 103F ?5602 219F 6B60 B2BB FCFC
>

From mh at foldr3.com  Wed Dec 21 14:36:19 2011
From: mh at foldr3.com (Muharem Hrnjadovic)
Date: Wed, 21 Dec 2011 15:36:19 +0100
Subject: [rabbitmq-discuss] rabbitmq-server crashes hard while consuming
 31GB of RAM
In-Reply-To: <CACOPnvcw_=3cZJN26LQhtW5OnT7J+14mBGgE00EYEM3nkhhEEQ@mail.gmail.com>
References: <4ECCCB33.3040803@foldr3.com> <4ECCCE5A.3020909@rabbitmq.com>
	<4ECD0BCB.3090304@foldr3.com> <4ECD2216.40300@rabbitmq.com>
	<4ECE53E5.5000002@foldr3.com> <4ECE6F72.7020502@rabbitmq.com>
	<4ED38204.802@foldr3.com> <4ED3AEB1.60604@rabbitmq.com>
	<4ED3E04C.9020508@foldr3.com> <4ED4BA64.2060504@rabbitmq.com>
	<4EF1B2A4.1050402@foldr3.com> <4EF1BDB7.6020304@rabbitmq.com>
	<4EF1C25F.1060302@foldr3.com> <4EF1C69E.6050505@rabbitmq.com>
	<CACOPnvfjKY+eTDTULcrcB2EOhw9RApNoEEEDkp+HwW8L9qrubQ@mail.gmail.com>
	<4EF1D422.4080802@foldr3.com>
	<CACOPnvcw_=3cZJN26LQhtW5OnT7J+14mBGgE00EYEM3nkhhEEQ@mail.gmail.com>
Message-ID: <4EF1EEE3.3040108@foldr3.com>

On 12/21/2011 02:05 PM, Alexis Richardson wrote:
> adding Ask to cc..
Thank you very much. I have identified the piece of code that was
causing the problem at hand.

This does *not* appear to be a celery issue given what I know at this
point.

> On Wed, Dec 21, 2011 at 12:42 PM, Muharem Hrnjadovic <mh at foldr3.com> wrote:
>> On 12/21/2011 12:49 PM, Alexis Richardson wrote:
>>> On Wed, Dec 21, 2011 at 11:44 AM, Matthias Radestock
>>> <matthias at rabbitmq.com> wrote:
>>>>
>>>> I was wrong. You have more than 47,000 connections! And the same number of
>>>> channels (unsurprisingly). But you "only" have about 16,000 queues.
>>>>
>>>> Congratulations. This is by far the fattest rabbit I've ever seen (except
>>>> those stuffed full of messages).
>>>
>>> I've seen Rabbits with 100,000s of queues per broker, in social
>>> network / social gaming cases...
>>>
>>> There's also the 'cloud management' case but they tend to have more
>>> brokers and fewer queues / broker.
>> Alexis,
>>
>> I believe we have a fault in the task function that is run by celery
>> (i.e. in our code) with the effect that a *new* rabbitmq connection is
>> opened upon every invocation while the already utilised ones cannot be
>> "garbage collected" for some reason.
>>
>> We should never have that many open connections. Looking into this..
>>
>> Best regards/Mit freundlichen Gr??en
>>
>> --
>> Muharem Hrnjadovic <mh at foldr3.com>
>> Public key id   : B2BBFCFC
>> Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC
>>
> 


Best regards/Mit freundlichen Gr??en

-- 
Muharem Hrnjadovic <mh at foldr3.com>
Public key id   : B2BBFCFC
Key fingerprint : A5A3 CC67 2B87 D641 103F  5602 219F 6B60 B2BB FCFC

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 900 bytes
Desc: OpenPGP digital signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/94a1ccbc/attachment.pgp>

From iainemsley at gmail.com  Wed Dec 21 14:59:11 2011
From: iainemsley at gmail.com (Iain Emsley)
Date: Wed, 21 Dec 2011 14:59:11 +0000
Subject: [rabbitmq-discuss] Messaging using both ActiveMQ and RabbitMQ
Message-ID: <CAHrXUcV_w54s1QeWEkuwkHytZus=zqrOKbu--TEjVATkfzUGXw@mail.gmail.com>

I'm fairly new to the area of messaging and am currently trying to sort out
our messaging systems and make them more robust from the experimental
system that we have been working with in the last couple of months. One of
the requirements is to try and standardise the types of message broker
being used whilst retaining the existing flexibility that messaging allows
us.

For the newer systems, I use RabbitMQ with PHP. We have a legacy system
that is Java based and has had Active MQ added to it to interact with the
messaging system that we are developing. Moving this to Rabbit is not
currently an option due the Java system using JMS to send out updates.
Although I've got a STOMP client reading from Active into the PHP system,
I've been looking at the possibility and practicality of getting the
ActiveMQ broker to talk to RabbitMQ.

The messaging sits across three different network areas of the business and
has to communicate across firewalls. I'm trying to get the ActiveMQ broker
to communicate with the RabbitMQ broker using the STOMP adaptor.

I've been experimenting with the STOMP plugin on Rabbit 2.7.0 on Ubuntu
10.10 virtual machine (assume IP of 1.2.3.4) and trying to get it to listen
to an ActiveMQ broker on 1.2.3.5:61618 (Ubuntu 10.10 virtual machine).
Having set up the tcp_listener in rabbitmq.config  as {"1.2.3.5", 61618},
the broker replies with an "eaddrnotavail" as I was trying to get the
Rabbit broker to listen to the port which ActiveMQ is publishing, having
had a PHP STOMP script listening to the same port previously.

Is it possible to configure Rabbit in this way so that I can have
standardise our system onto Rabbit? Or alternatively would I need to write
a bridge to consume from Active and publish to Rabbit? Even then though,
having typed this, I assume that the message would come across in STOMP
rather than be translated into AMQP (unless I did this in the
aforementioned bridge), so I would still need two consumers since we have
AMQP and STOMP messages coming across the network.

Many thanks in advance for any help and advice.

Best,

Iain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/32256f26/attachment.htm>

From iainemsley at gmail.com  Wed Dec 21 15:02:46 2011
From: iainemsley at gmail.com (Iain Emsley)
Date: Wed, 21 Dec 2011 15:02:46 +0000
Subject: [rabbitmq-discuss] Federating distributed RabbitMQ brokers
Message-ID: <CAHrXUcXRm5BuX6XR7u-Bx2w4dpFXgdSrkbKhbTO57BGki99U6Q@mail.gmail.com>

Hi,

Slightly following on from my earlier mail regarding getting ActiveMQ and
RabbitMQ talking to each other, I'm looking at the way that our brokers
operate.

As I'm pushing messages across firewalls, is it considered best practice to
have a central broker and SSL/VPN tunnel to allow the consumer in the
different zones or to have a Rabbit broker in each zone and federate them,
leaving the consumers to listen to messages in their own zone?

With the second option of having a broker in each zone, I assume from my
reading on the plugins site that the RabbitMQ federation plugin would be
the best option into terms of ensuring that messages sent to an
exchange/queue can be transferred to the correct broker  using amqp+ssl? If
I split the traffic across vhosts, can these be  aded to the federation
(i.e. If I want to split up traffic coming from different systems?)

Many thanks for your help and advice.

Best,

Iain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/8792a28e/attachment.htm>

From brendan.g.hay at gmail.com  Wed Dec 21 15:38:41 2011
From: brendan.g.hay at gmail.com (Brendan Hay)
Date: Wed, 21 Dec 2011 16:38:41 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying queues
	or exchanges
Message-ID: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>

Hi all,

I have a problem with the rabbitmq-management plugin where it doesn't display any queue or exchange information.
ie. even the /api calls return an empty list, yet rabbitmqctl list_queues and its' counterparts correctly show queue information.

rabbitmq, management, management-agent, mochiweb all show version 2.7.0
and the erlang version is R14B04

Any ideas?

Thanks,
Brendan


From joeyfitz at gmail.com  Wed Dec 21 15:44:47 2011
From: joeyfitz at gmail.com (joefitzgerald)
Date: Wed, 21 Dec 2011 07:44:47 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying
	queues or exchanges
In-Reply-To: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
References: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
Message-ID: <9bf341a0-8be7-4fd4-b422-ce65ad98528b@e2g2000vbb.googlegroups.com>

Hey Brendan,

Are you running RabbitMQ in Windows? I've noticed a bug where the
Windows installer installs RabbitMQ as a service, but when it is
started, nothing really works. The fix for me was to:

* rabbitmq-service.bat stop
* rabbitmq-service.bat remove
* rabbitmq-service.bat install
* rabbitmq-service.bat start

Hope that helps. I haven't figured out the root cause of it, but I
have definitely seen this for 2.7.0 and 2.7.1 on Windows.

-Joe

On Dec 21, 8:38?am, Brendan Hay <brendan.g.... at gmail.com> wrote:
> Hi all,
>
> I have a problem with the rabbitmq-management plugin where it doesn't display any queue or exchange information.
> ie. even the /api calls return an empty list, yet rabbitmqctl list_queues and its' counterparts correctly show queue information.
>
> rabbitmq, management, management-agent, mochiweb all show version 2.7.0
> and the erlang version is R14B04
>
> Any ideas?
>
> Thanks,
> Brendan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Wed Dec 21 16:50:04 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 21 Dec 2011 16:50:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ as Windows Service
In-Reply-To: <F1BBB1B7A67740B08F88B2FF6DF251EA@EvKPC>
References: <F1BBB1B7A67740B08F88B2FF6DF251EA@EvKPC>
Message-ID: <20111221165004.GG3308@southbank>

Hi,

> FAILED
> Reason: {error,
>             {timeout_waiting_for_tables, ....

That's usually caused by firewall or networking issues (that error means
the node is having trouble contacting the other nodes).

Is the cluster running on a single machine, or on different
machines?  If the latter, could you check that 1) networking works when
RabbitMQ tries to start up at boot and 2) that it can contact the other
nodes?

Cheers,
Alex

On Mon, Dec 19, 2011 at 03:07:55PM +0600, evkdev at gmail.com wrote:
> Hi! I have a problem with running RabbitMQ as windows service. I have a cluster with 3 nodes and everything works fine if run rabbit with ?rabbitmq-server start ?detached?. I also able to run it as windows service under Administrator account. But after reboot, RabbitMQ service fails to start. 
> In Event Log there is an entry: ?RabbitMQ: Erlang machine voluntarily stopped. The service is not restarted as OnFail is set to ignore?. 
> In rabbit logs I see this: 
> FAILED
> Reason: {error,
>             {timeout_waiting_for_tables, ....
> Whatever I tried ? nothing helps to resolve this issue. If I log in after reboot, and start RabbitMQ service manually ? everything works fine.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tonygarnockjones+rabbitmq at gmail.com  Wed Dec 21 18:30:13 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 21 Dec 2011 13:30:13 -0500
Subject: [rabbitmq-discuss] "How do I...?"
Message-ID: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>

Hi all,

What questions should go on a "How do I ... with RabbitMQ?" page on the
Rabbit website?

I'm imagining both basic low-level how-tos as well as higher-level best
practices for achieving a certain result. Essentially describing a few use
cases for messaging in general.

I can think of a few examples to kick things off:

   - How do I prioritize delivery of some messages over others with
   RabbitMQ? (A: Take Doug Barth's
approach<http://dougbarth.github.com/2011/07/01/approximating-priority-with-rabbitmq.html>,
   or some variation of it)
   - How do I queue up tasks for later processing with RabbitMQ? (A: Use
   celery perhaps? Plenty of approaches to roll-your-own too)
   - How do I send email from a RabbitMQ queue?
   - How do I receive messages from HTTP POSTs into a RabbitMQ exchange?
   - How do I push messages to the browser using RabbitMQ?
   - How do I connect to RabbitMQ from iOS devices?

The "Going Further" section of the existing how.html
page<http://www.rabbitmq.com/how.html>has some good things on it. I'm
sure some of the other links on that page
could be presented in more general "How do I...?" terms, too. What else am
I missing?

Cheers,
  Tony

-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/0f0a92ba/attachment.htm>

From alexandru at rabbitmq.com  Wed Dec 21 18:42:42 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 21 Dec 2011 18:42:42 +0000
Subject: [rabbitmq-discuss] Connection and Channel lifecycle
In-Reply-To: <CAAN_EDoRpMVF=dfT71YAKX5ZS2yU0Xn+5RsjzXjy7Ok597wK7A@mail.gmail.com>
References: <CAAN_EDoRpMVF=dfT71YAKX5ZS2yU0Xn+5RsjzXjy7Ok597wK7A@mail.gmail.com>
Message-ID: <20111221184242.GQ3308@southbank>

Hi Adam,

Sorry for the late response.

> For example, say I have a "worker pool" with 40
> QueueingConsumers (ie 40 separate channels).  I believe it is
> completely fine to keep these channels (and underlying connection(s))
> open indefinitely, is this correct? 

It probably is.  Channels don't require a lot of resources to keep
running, on neither the server nor the client side.

> In this long-running situation,
> what is the optimal number of underlying connections for these 40
> channels? 

We did some tests a while ago and we couldn't find much difference in
throughput between running multiple channels on a single connection or on
multiple connections.

Note that connections use up the limited file descriptors, so you
wouldn't be able to run a very large number of connections at the same
time.

I suspect it's better (and easier) to have all the channels running on
the same connection.

Hope this clears things up.

Cheers,
Alex

On Fri, Dec 16, 2011 at 05:25:50PM -0500, Adam Rabung wrote:
> Hello,
> I've been reading up on this quite a bit, but I'm still unclear about
> some general principles of how to use connections and channels
> correctly.  For example, say I have a "worker pool" with 40
> QueueingConsumers (ie 40 separate channels).  I believe it is
> completely fine to keep these channels (and underlying connection(s))
> open indefinitely, is this correct?  In this long-running situation,
> what is the optimal number of underlying connections for these 40
> channels?  I believe from a throughput standpoint, the answer might be
> 40.  From a resource conservation standpoint, the answer would be 1.
> I will have many of these worker pools, so both considerations are
> important.  Can someone give pointers on how to balance those two
> concerns?
> 
> Does anyone use connection or channel pooling?
> 
> Any pointers much appreciated,
> Adam
> 
> PS. Thanks for great answers to all of my crazy questions so far!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From uday.subbarayan at yahoo.com  Wed Dec 21 22:35:58 2011
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Wed, 21 Dec 2011 14:35:58 -0800 (PST)
Subject: [rabbitmq-discuss] Message Formats
Message-ID: <1324506958.9252.YahooMailNeo@web44903.mail.sp1.yahoo.com>

Hi All,
? ? I am looking for the different message formats (binary, text, xml, etc) that Rabbit MQ supports it. I couldn't able to find it on the web. If you know about it or a link, pl pass it on to me. I appreciate your response.

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/3e506688/attachment.htm>

From videlalvaro at gmail.com  Wed Dec 21 22:42:31 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 21 Dec 2011 23:42:31 +0100
Subject: [rabbitmq-discuss] Message Formats
In-Reply-To: <1324506958.9252.YahooMailNeo@web44903.mail.sp1.yahoo.com>
References: <1324506958.9252.YahooMailNeo@web44903.mail.sp1.yahoo.com>
Message-ID: <EA2CE8D3-EDAC-4BA6-A38E-A35A9A310835@gmail.com>

Hi,

RabbitMQ doesn't inspect the content of the messages i.e. it supports all the formats you mention and more.

Regards,

Alvaro

On Dec 21, 2011, at 11:35 PM, Uday Subbarayan wrote:

> Hi All,
>     I am looking for the different message formats (binary, text, xml, etc) that Rabbit MQ supports it. I couldn't able to find it on the web. If you know about it or a link, pl pass it on to me. I appreciate your response.
> 
> Thanks,
> -Uday.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/4cdc1f8f/attachment.htm>

From alexis at rabbitmq.com  Wed Dec 21 23:34:10 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 21 Dec 2011 23:34:10 +0000
Subject: [rabbitmq-discuss] "How do I...?"
In-Reply-To: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
References: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
Message-ID: <CACOPnvdQrKd9Ui8kqHQPZ8aX5wFE7j=CZyyi9xGAYsOhusnP5g@mail.gmail.com>

Tony

Thanks for framing an excellent set of questions.

I believe that some answers are implicit in the How page, but we could
certainly benefit from something along the lines you suggest.  I
believe that, indeed, many items are addressed by content you have
published on the internets.

The two best people to move this along are both on xmas hols, so
please bear with us.

alexis


On Wed, Dec 21, 2011 at 6:30 PM, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
> Hi all,
>
> What questions should go on a "How do I ... with RabbitMQ?" page on the
> Rabbit website?
>
> I'm imagining both basic low-level how-tos as well as higher-level best
> practices for achieving a certain result. Essentially describing a few use
> cases for messaging in general.
>
> I can think of a few examples to kick things off:
>
> How do I prioritize delivery of some messages over others with RabbitMQ? (A:
> Take Doug Barth's approach, or some variation of it)
> How do I queue up tasks for later processing with RabbitMQ? (A: Use celery
> perhaps? Plenty of approaches to roll-your-own too)
> How do I send email from a RabbitMQ queue?
> How do I receive messages from HTTP POSTs into a RabbitMQ exchange?
> How do I push messages to the browser using RabbitMQ?
> How do I connect to RabbitMQ from iOS devices?
>
> The "Going Further" section of the existing how.html page has some good
> things on it. I'm sure some of the other links on that page could be
> presented in more general "How do I...?" terms, too. What else am I missing?
>
> Cheers,
> ? Tony
>
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tonygarnockjones+rabbitmq at gmail.com  Thu Dec 22 00:31:50 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 21 Dec 2011 19:31:50 -0500
Subject: [rabbitmq-discuss] "How do I...?"
In-Reply-To: <CACOPnvdQrKd9Ui8kqHQPZ8aX5wFE7j=CZyyi9xGAYsOhusnP5g@mail.gmail.com>
References: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
	<CACOPnvdQrKd9Ui8kqHQPZ8aX5wFE7j=CZyyi9xGAYsOhusnP5g@mail.gmail.com>
Message-ID: <CAM8fPiS=Uivp-hNF1a=mPKnJ7L3RmEcr89x3d4uJdpiG7TgbYQ@mail.gmail.com>

On 21 December 2011 18:34, Alexis Richardson <alexis at rabbitmq.com> wrote:

> The two best people to move this along are both on xmas hols, so
> please bear with us.
>

Cool. In the meantime, it'd be great to hear more suggestions from others
on the list! (Hint, hint, others on the list!)

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111221/167bf48a/attachment.htm>

From vveludan at gmail.com  Thu Dec 22 02:39:54 2011
From: vveludan at gmail.com (Venkat)
Date: Wed, 21 Dec 2011 18:39:54 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load with
	mirrored queues
Message-ID: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>

Good evening.
We have  a cluster of two RabbitMQ nodes running 2.7.0 version using
mirrored queues.
There are 25 queues all using x-ha-policy = all.
There was a point where one queue had 5000 messages and the other
queue had about 600K messages. Message consumption was slow due to the
business logic using Cassandra was slowing down. At this point
executed rabbitmqctl report command one NodeA. It displayed that node
was down though the node was up. Executed the report command on NodeB,
after there was no response. After some time when executed rabbitmqctl
list_queues command on NodeA some of the queues were not listed. I
just wanted to find running report command when broker is under heavy
load can cause any problem.

Thanks
Venkat

From minaev at gmail.com  Thu Dec 22 06:32:45 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 10:32:45 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
Message-ID: <CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>

Now, I have a hanging Rabbit available for the autopsy.

Running processes (ps ax|grep rabbit):

-------------
29699 ?        Ss     0:00 sh -c
RABBITMQ_PID_FILE=/var/run/rabbitmq/pid /usr/sbin/rabbitmq-server >
         /var/log/rabbitmq/startup_log 2>
/var/log/rabbitmq/startup_err
29702 ?        S      0:00 /bin/sh /usr/sbin/rabbitmq-server
29708 ?        S      0:00 su rabbitmq -s /bin/sh -c
/usr/lib/rabbitmq/bin/rabbitmq-server
29710 ?        S      0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
29711 ?        Sl   4715:59 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W
w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl --
-home /var/lib/rabbitmq -- -noshell -noinput -sname rabbit at dbx
-setcookie riak -boot
/var/lib/rabbitmq/mnesia/rabbit at dbx-plugins-expand/rabbit -config
/etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
[{nodelay,true}] -rabbit tcp_listeners [{"0.0.0.0",5672}] -sasl
errlog_type error -kernel error_logger
{file,"/var/log/rabbitmq/rabbit at dbx.log"} -sasl sasl_error_logger
{file,"/var/log/rabbitmq/rabbit at dbx-sasl.log"} -os_mon start_cpu_sup
true -os_mon start_disksup false -os_mon start_memsup false -mnesia
dir "/var/lib/rabbitmq/mnesia/rabbit at dbx"
-------------

Network sockets are available:
$ sudo netstat -tunlp|grep beam
tcp        0      0 0.0.0.0:5672            0.0.0.0:*
LISTEN      29711/beam.smp
tcp        0      0 0.0.0.0:60040           0.0.0.0:*
LISTEN      29711/beam.smp

$ cat /etc/rabbitmq/rabbitmq.config
[{rabbit, [{vm_memory_high_watermark, 0.7}]},
{rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}].

$ cat /etc/rabbitmq/rabbitmq-env.conf
RABBITMQ_NODE_IP_ADDRESS=0.0.0.0

strace -p 29711 shows that the process is waiting in select():
select(0, NULL, NULL, NULL, NULL


Last lines in rabbit at dbx.log:
---------------------------
=WARNING REPORT==== 22-Dec-2011::09:55:44 ===
exception on TCP connection <0.367.0> from x.x.x.26:43157
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::09:55:44 ===
closing TCP connection <0.367.0> from x.x.x..26:43157

=WARNING REPORT==== 22-Dec-2011::09:55:44 ===
exception on TCP connection <0.379.0> from x.x.x.26:43160
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::09:55:44 ===
closing TCP connection <0.379.0> from x.x.x.26:43160

=WARNING REPORT==== 22-Dec-2011::09:55:44 ===
exception on TCP connection <0.335.0> from x.x.x.26:43154
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::09:55:44 ===
closing TCP connection <0.335.0> from x.x.x.26:43154

=WARNING REPORT==== 22-Dec-2011::09:55:44 ===
exception on TCP connection <0.467.0> from x.x.x.26:43166
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::09:55:44 ===
closing TCP connection <0.467.0> from x.x.x.26:43166
---------------------------

PHP clients cannot connect to RabbitMQ. When I run my test Python
script which uses amqplib.client_0_8, it hangs on
amqp.Connection(host, "guest", "guest", ssl=False)

strace shows the following:

connect(3, {sa_family=AF_INET, sin_port=htons(5672),
sin_addr=inet_addr("127.0.0.1")}, 16) = 0
fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
fcntl(3, F_SETFL, O_RDWR)               = 0
sendto(3, "AMQP\1\1\t\1", 8, 0, NULL, 0) = 8
brk(0x1461000)                          = 0x1461000
recvfrom(3,

Now, I try to connect to the RabbitMQ node using 'erl':
$ erl -sname 'rabbit at dbx'
{error_logger,{{2011,12,22},{10,26,33}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2011,12,22},{10,26,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.68>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,442}],[]]}
{error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at dbx',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2011,12,22},{10,26,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

Is there any other information that might be useful?

On 13 December 2011 18:26, Dmitri Minaev <minaev at gmail.com> wrote:
> Thank you for the reply. Yes, TCP connection could be established, but
> not AMQP. We generally use PHP library, but I also tested RabbitMQ
> using Python amqplib. In both cases, the client side cannot get the
> connection.
>
> Besides the common information messages (starting/closing TCP
> connection), there's only one type of messages in the log files:
>
> =WARNING REPORT==== 13-Dec-2011::16:56:51 ===
> exception on TCP connection <0.14474.173> from x.x.x.x:xxx
> connection_closed_abruptly
>
> But then, again, these messages may be found even during normal
> operation, this is why I don't think they're relevant.
>
>
> On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
>> Hmm. I can't really say anything from your description - can you post the
>> logs somewhere? It's possible that your definition of "nothing unusual in
>> the logs" differs from mine.
>>
>> And when you say that "the server refused attempts to connect", what exactly
>> do you mean. You say that a TCP connection *could* be established - so does
>> your client hang during AMQP handshaking? Disconnect? Something else?
>>
>> Cheers, Simon
>>
>>
>> On 12/12/11 16:24, Dmitri Minaev wrote:
>>>
>>> Hello,
>>>
>>> We use RabbitMQ for about a year now. From time to time I upgraded it
>>> and switched from one server to another. About a month ago the last
>>> such transition took place. I installed new RabbitMQ (2.7) on a new
>>> server and our web application was reconfigured. Quite soon we faced
>>> new problems. After some days of stable work clients could not connect
>>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>>> connections, but the server refused attempts to connect. That is, TCP
>>> socket was available and telnet could connect to port 5672, but the
>>> AMQP connection could not be established. There was nothing unusual in
>>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>>> plenty of free memory.
>>>
>>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>>> problem remained. The last time I disabled IPv6, but today we hit the
>>> same trouble again.
>>>
>>> I think I must have done something wrong when setting up the
>>> environment, but what could that be?
>>>
>>> OS: Ubuntu 10.04 LTS.
>>> 16GB RAM.
>>> RabbitMQ 2.6.1
>>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>>> Client: php-amqplib
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> With best regards,
> Dmitri Minaev



-- 
With best regards,
Dmitri Minaev

From videlalvaro at gmail.com  Thu Dec 22 06:55:28 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 22 Dec 2011 07:55:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
Message-ID: <07AE7779-6B32-4075-AADD-005460180F8E@gmail.com>

Hi,

A small note,

When connecting to a remote Erlang node, in this case the the rabbit node, you have to choose a different node name. 

For example:

erl -sname foo

Once you are on the Erlang REPL then you can try to remotely connect to the rabbit node using net_adm:ping

-Alvaro.

Sent from my iFad

On Dec 22, 2011, at 7:32 AM, Dmitri Minaev <minaev at gmail.com> wrote:

> Now, I have a hanging Rabbit available for the autopsy.
> 
> Running processes (ps ax|grep rabbit):
> 
> -------------
> 29699 ?        Ss     0:00 sh -c
> RABBITMQ_PID_FILE=/var/run/rabbitmq/pid /usr/sbin/rabbitmq-server >
>         /var/log/rabbitmq/startup_log 2>
> /var/log/rabbitmq/startup_err
> 29702 ?        S      0:00 /bin/sh /usr/sbin/rabbitmq-server
> 29708 ?        S      0:00 su rabbitmq -s /bin/sh -c
> /usr/lib/rabbitmq/bin/rabbitmq-server
> 29710 ?        S      0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
> 29711 ?        Sl   4715:59 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W
> w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl --
> -home /var/lib/rabbitmq -- -noshell -noinput -sname rabbit at dbx
> -setcookie riak -boot
> /var/lib/rabbitmq/mnesia/rabbit at dbx-plugins-expand/rabbit -config
> /etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
> [{nodelay,true}] -rabbit tcp_listeners [{"0.0.0.0",5672}] -sasl
> errlog_type error -kernel error_logger
> {file,"/var/log/rabbitmq/rabbit at dbx.log"} -sasl sasl_error_logger
> {file,"/var/log/rabbitmq/rabbit at dbx-sasl.log"} -os_mon start_cpu_sup
> true -os_mon start_disksup false -os_mon start_memsup false -mnesia
> dir "/var/lib/rabbitmq/mnesia/rabbit at dbx"
> -------------
> 
> Network sockets are available:
> $ sudo netstat -tunlp|grep beam
> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
> LISTEN      29711/beam.smp
> tcp        0      0 0.0.0.0:60040           0.0.0.0:*
> LISTEN      29711/beam.smp
> 
> $ cat /etc/rabbitmq/rabbitmq.config
> [{rabbit, [{vm_memory_high_watermark, 0.7}]},
> {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}].
> 
> $ cat /etc/rabbitmq/rabbitmq-env.conf
> RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
> 
> strace -p 29711 shows that the process is waiting in select():
> select(0, NULL, NULL, NULL, NULL
> 
> 
> Last lines in rabbit at dbx.log:
> ---------------------------
> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
> exception on TCP connection <0.367.0> from x.x.x.26:43157
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
> closing TCP connection <0.367.0> from x.x.x..26:43157
> 
> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
> exception on TCP connection <0.379.0> from x.x.x.26:43160
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
> closing TCP connection <0.379.0> from x.x.x.26:43160
> 
> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
> exception on TCP connection <0.335.0> from x.x.x.26:43154
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
> closing TCP connection <0.335.0> from x.x.x.26:43154
> 
> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
> exception on TCP connection <0.467.0> from x.x.x.26:43166
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
> closing TCP connection <0.467.0> from x.x.x.26:43166
> ---------------------------
> 
> PHP clients cannot connect to RabbitMQ. When I run my test Python
> script which uses amqplib.client_0_8, it hangs on
> amqp.Connection(host, "guest", "guest", ssl=False)
> 
> strace shows the following:
> 
> connect(3, {sa_family=AF_INET, sin_port=htons(5672),
> sin_addr=inet_addr("127.0.0.1")}, 16) = 0
> fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
> fcntl(3, F_SETFL, O_RDWR)               = 0
> sendto(3, "AMQP\1\1\t\1", 8, 0, NULL, 0) = 8
> brk(0x1461000)                          = 0x1461000
> recvfrom(3,
> 
> Now, I try to connect to the RabbitMQ node using 'erl':
> $ erl -sname 'rabbit at dbx'
> {error_logger,{{2011,12,22},{10,26,33}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2011,12,22},{10,26,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.68>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,442}],[]]}
> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at dbx',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2011,12,22},{10,26,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> Is there any other information that might be useful?
> 
> On 13 December 2011 18:26, Dmitri Minaev <minaev at gmail.com> wrote:
>> Thank you for the reply. Yes, TCP connection could be established, but
>> not AMQP. We generally use PHP library, but I also tested RabbitMQ
>> using Python amqplib. In both cases, the client side cannot get the
>> connection.
>> 
>> Besides the common information messages (starting/closing TCP
>> connection), there's only one type of messages in the log files:
>> 
>> =WARNING REPORT==== 13-Dec-2011::16:56:51 ===
>> exception on TCP connection <0.14474.173> from x.x.x.x:xxx
>> connection_closed_abruptly
>> 
>> But then, again, these messages may be found even during normal
>> operation, this is why I don't think they're relevant.
>> 
>> 
>> On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
>>> Hmm. I can't really say anything from your description - can you post the
>>> logs somewhere? It's possible that your definition of "nothing unusual in
>>> the logs" differs from mine.
>>> 
>>> And when you say that "the server refused attempts to connect", what exactly
>>> do you mean. You say that a TCP connection *could* be established - so does
>>> your client hang during AMQP handshaking? Disconnect? Something else?
>>> 
>>> Cheers, Simon
>>> 
>>> 
>>> On 12/12/11 16:24, Dmitri Minaev wrote:
>>>> 
>>>> Hello,
>>>> 
>>>> We use RabbitMQ for about a year now. From time to time I upgraded it
>>>> and switched from one server to another. About a month ago the last
>>>> such transition took place. I installed new RabbitMQ (2.7) on a new
>>>> server and our web application was reconfigured. Quite soon we faced
>>>> new problems. After some days of stable work clients could not connect
>>>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>>>> connections, but the server refused attempts to connect. That is, TCP
>>>> socket was available and telnet could connect to port 5672, but the
>>>> AMQP connection could not be established. There was nothing unusual in
>>>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>>>> plenty of free memory.
>>>> 
>>>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>>>> problem remained. The last time I disabled IPv6, but today we hit the
>>>> same trouble again.
>>>> 
>>>> I think I must have done something wrong when setting up the
>>>> environment, but what could that be?
>>>> 
>>>> OS: Ubuntu 10.04 LTS.
>>>> 16GB RAM.
>>>> RabbitMQ 2.6.1
>>>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>>>> Client: php-amqplib
>>>> 
>>> 
>>> 
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> --
>> With best regards,
>> Dmitri Minaev
> 
> 
> 
> -- 
> With best regards,
> Dmitri Minaev
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From minaev at gmail.com  Thu Dec 22 07:05:21 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 11:05:21 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <07AE7779-6B32-4075-AADD-005460180F8E@gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<07AE7779-6B32-4075-AADD-005460180F8E@gmail.com>
Message-ID: <CANTUpDDsKycBQEp5Nd4SBiifWLHLOi6LeC2zBhpoRmo9SW3YTw@mail.gmail.com>

Oh...

$ erl -sname qwer
Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(qwer at dbx)1> net_adm:names().
{ok,[{"rabbit",60040},{"qwer",58043}]}
(qwer at dbx)2> net_adm:ping(rabbit).
pang



On 22 December 2011 10:55, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> A small note,
>
> When connecting to a remote Erlang node, in this case the the rabbit node, you have to choose a different node name.
>
> For example:
>
> erl -sname foo
>
> Once you are on the Erlang REPL then you can try to remotely connect to the rabbit node using net_adm:ping
>
> -Alvaro.
>
> Sent from my iFad
>
> On Dec 22, 2011, at 7:32 AM, Dmitri Minaev <minaev at gmail.com> wrote:
>
>> Now, I have a hanging Rabbit available for the autopsy.
>>
>> Running processes (ps ax|grep rabbit):
>>
>> -------------
>> 29699 ? ? ? ? ?Ss ? ? 0:00 sh -c
>> RABBITMQ_PID_FILE=/var/run/rabbitmq/pid /usr/sbin/rabbitmq-server >
>> ? ? ? ? /var/log/rabbitmq/startup_log 2>
>> /var/log/rabbitmq/startup_err
>> 29702 ? ? ? ? ?S ? ? ?0:00 /bin/sh /usr/sbin/rabbitmq-server
>> 29708 ? ? ? ? ?S ? ? ?0:00 su rabbitmq -s /bin/sh -c
>> /usr/lib/rabbitmq/bin/rabbitmq-server
>> 29710 ? ? ? ? ?S ? ? ?0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
>> 29711 ? ? ? ? ?Sl ? 4715:59 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W
>> w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl --
>> -home /var/lib/rabbitmq -- -noshell -noinput -sname rabbit at dbx
>> -setcookie riak -boot
>> /var/lib/rabbitmq/mnesia/rabbit at dbx-plugins-expand/rabbit -config
>> /etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
>> [{nodelay,true}] -rabbit tcp_listeners [{"0.0.0.0",5672}] -sasl
>> errlog_type error -kernel error_logger
>> {file,"/var/log/rabbitmq/rabbit at dbx.log"} -sasl sasl_error_logger
>> {file,"/var/log/rabbitmq/rabbit at dbx-sasl.log"} -os_mon start_cpu_sup
>> true -os_mon start_disksup false -os_mon start_memsup false -mnesia
>> dir "/var/lib/rabbitmq/mnesia/rabbit at dbx"
>> -------------
>>
>> Network sockets are available:
>> $ sudo netstat -tunlp|grep beam
>> tcp ? ? ? ?0 ? ? ?0 0.0.0.0:5672 ? ? ? ? ? ?0.0.0.0:*
>> LISTEN ? ? ?29711/beam.smp
>> tcp ? ? ? ?0 ? ? ?0 0.0.0.0:60040 ? ? ? ? ? 0.0.0.0:*
>> LISTEN ? ? ?29711/beam.smp
>>
>> $ cat /etc/rabbitmq/rabbitmq.config
>> [{rabbit, [{vm_memory_high_watermark, 0.7}]},
>> {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}].
>>
>> $ cat /etc/rabbitmq/rabbitmq-env.conf
>> RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
>>
>> strace -p 29711 shows that the process is waiting in select():
>> select(0, NULL, NULL, NULL, NULL
>>
>>
>> Last lines in rabbit at dbx.log:
>> ---------------------------
>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>> exception on TCP connection <0.367.0> from x.x.x.26:43157
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>> closing TCP connection <0.367.0> from x.x.x..26:43157
>>
>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>> exception on TCP connection <0.379.0> from x.x.x.26:43160
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>> closing TCP connection <0.379.0> from x.x.x.26:43160
>>
>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>> exception on TCP connection <0.335.0> from x.x.x.26:43154
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>> closing TCP connection <0.335.0> from x.x.x.26:43154
>>
>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>> exception on TCP connection <0.467.0> from x.x.x.26:43166
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>> closing TCP connection <0.467.0> from x.x.x.26:43166
>> ---------------------------
>>
>> PHP clients cannot connect to RabbitMQ. When I run my test Python
>> script which uses amqplib.client_0_8, it hangs on
>> amqp.Connection(host, "guest", "guest", ssl=False)
>>
>> strace shows the following:
>>
>> connect(3, {sa_family=AF_INET, sin_port=htons(5672),
>> sin_addr=inet_addr("127.0.0.1")}, 16) = 0
>> fcntl(3, F_GETFL) ? ? ? ? ? ? ? ? ? ? ? = 0x2 (flags O_RDWR)
>> fcntl(3, F_SETFL, O_RDWR) ? ? ? ? ? ? ? = 0
>> sendto(3, "AMQP\1\1\t\1", 8, 0, NULL, 0) = 8
>> brk(0x1461000) ? ? ? ? ? ? ? ? ? ? ? ? ?= 0x1461000
>> recvfrom(3,
>>
>> Now, I try to connect to the RabbitMQ node using 'erl':
>> $ erl -sname 'rabbit at dbx'
>> {error_logger,{{2011,12,22},{10,26,33}},"Protocol: ~p: register error:
>> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>> {error_logger,{{2011,12,22},{10,26,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.68>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,442}],[]]}
>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at dbx',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>> {error_logger,{{2011,12,22},{10,26,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>
>> Is there any other information that might be useful?
>>
>> On 13 December 2011 18:26, Dmitri Minaev <minaev at gmail.com> wrote:
>>> Thank you for the reply. Yes, TCP connection could be established, but
>>> not AMQP. We generally use PHP library, but I also tested RabbitMQ
>>> using Python amqplib. In both cases, the client side cannot get the
>>> connection.
>>>
>>> Besides the common information messages (starting/closing TCP
>>> connection), there's only one type of messages in the log files:
>>>
>>> =WARNING REPORT==== 13-Dec-2011::16:56:51 ===
>>> exception on TCP connection <0.14474.173> from x.x.x.x:xxx
>>> connection_closed_abruptly
>>>
>>> But then, again, these messages may be found even during normal
>>> operation, this is why I don't think they're relevant.
>>>
>>>
>>> On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>> Hmm. I can't really say anything from your description - can you post the
>>>> logs somewhere? It's possible that your definition of "nothing unusual in
>>>> the logs" differs from mine.
>>>>
>>>> And when you say that "the server refused attempts to connect", what exactly
>>>> do you mean. You say that a TCP connection *could* be established - so does
>>>> your client hang during AMQP handshaking? Disconnect? Something else?
>>>>
>>>> Cheers, Simon
>>>>
>>>>
>>>> On 12/12/11 16:24, Dmitri Minaev wrote:
>>>>>
>>>>> Hello,
>>>>>
>>>>> We use RabbitMQ for about a year now. From time to time I upgraded it
>>>>> and switched from one server to another. About a month ago the last
>>>>> such transition took place. I installed new RabbitMQ (2.7) on a new
>>>>> server and our web application was reconfigured. Quite soon we faced
>>>>> new problems. After some days of stable work clients could not connect
>>>>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>>>>> connections, but the server refused attempts to connect. That is, TCP
>>>>> socket was available and telnet could connect to port 5672, but the
>>>>> AMQP connection could not be established. There was nothing unusual in
>>>>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>>>>> plenty of free memory.
>>>>>
>>>>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>>>>> problem remained. The last time I disabled IPv6, but today we hit the
>>>>> same trouble again.
>>>>>
>>>>> I think I must have done something wrong when setting up the
>>>>> environment, but what could that be?
>>>>>
>>>>> OS: Ubuntu 10.04 LTS.
>>>>> 16GB RAM.
>>>>> RabbitMQ 2.6.1
>>>>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>>>>> Client: php-amqplib
>>>>>
>>>>
>>>>
>>>> --
>>>> Simon MacMullen
>>>> RabbitMQ, VMware
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>>> --
>>> With best regards,
>>> Dmitri Minaev
>>
>>
>>
>> --
>> With best regards,
>> Dmitri Minaev
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
With best regards,
Dmitri Minaev

From videlalvaro at gmail.com  Thu Dec 22 08:35:59 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 22 Dec 2011 09:35:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDDsKycBQEp5Nd4SBiifWLHLOi6LeC2zBhpoRmo9SW3YTw@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<07AE7779-6B32-4075-AADD-005460180F8E@gmail.com>
	<CANTUpDDsKycBQEp5Nd4SBiifWLHLOi6LeC2zBhpoRmo9SW3YTw@mail.gmail.com>
Message-ID: <92BBDBD9-25DB-41DF-84E0-E2F770E17378@gmail.com>

Yes, you might get a pang but make sure the user that started the erl command has the same .erlang.cookie as the user running the RabbitMQ process.

On Dec 22, 2011, at 8:05 AM, Dmitri Minaev wrote:

> Oh...
> 
> $ erl -sname qwer
> Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4]
> [async-threads:0] [hipe] [kernel-poll:false]
> 
> Eshell V5.7.4  (abort with ^G)
> (qwer at dbx)1> net_adm:names().
> {ok,[{"rabbit",60040},{"qwer",58043}]}
> (qwer at dbx)2> net_adm:ping(rabbit).
> pang
> 
> 
> 
> On 22 December 2011 10:55, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi,
>> 
>> A small note,
>> 
>> When connecting to a remote Erlang node, in this case the the rabbit node, you have to choose a different node name.
>> 
>> For example:
>> 
>> erl -sname foo
>> 
>> Once you are on the Erlang REPL then you can try to remotely connect to the rabbit node using net_adm:ping
>> 
>> -Alvaro.
>> 
>> Sent from my iFad
>> 
>> On Dec 22, 2011, at 7:32 AM, Dmitri Minaev <minaev at gmail.com> wrote:
>> 
>>> Now, I have a hanging Rabbit available for the autopsy.
>>> 
>>> Running processes (ps ax|grep rabbit):
>>> 
>>> -------------
>>> 29699 ?        Ss     0:00 sh -c
>>> RABBITMQ_PID_FILE=/var/run/rabbitmq/pid /usr/sbin/rabbitmq-server >
>>>         /var/log/rabbitmq/startup_log 2>
>>> /var/log/rabbitmq/startup_err
>>> 29702 ?        S      0:00 /bin/sh /usr/sbin/rabbitmq-server
>>> 29708 ?        S      0:00 su rabbitmq -s /bin/sh -c
>>> /usr/lib/rabbitmq/bin/rabbitmq-server
>>> 29710 ?        S      0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
>>> 29711 ?        Sl   4715:59 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W
>>> w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl --
>>> -home /var/lib/rabbitmq -- -noshell -noinput -sname rabbit at dbx
>>> -setcookie riak -boot
>>> /var/lib/rabbitmq/mnesia/rabbit at dbx-plugins-expand/rabbit -config
>>> /etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
>>> [{nodelay,true}] -rabbit tcp_listeners [{"0.0.0.0",5672}] -sasl
>>> errlog_type error -kernel error_logger
>>> {file,"/var/log/rabbitmq/rabbit at dbx.log"} -sasl sasl_error_logger
>>> {file,"/var/log/rabbitmq/rabbit at dbx-sasl.log"} -os_mon start_cpu_sup
>>> true -os_mon start_disksup false -os_mon start_memsup false -mnesia
>>> dir "/var/lib/rabbitmq/mnesia/rabbit at dbx"
>>> -------------
>>> 
>>> Network sockets are available:
>>> $ sudo netstat -tunlp|grep beam
>>> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
>>> LISTEN      29711/beam.smp
>>> tcp        0      0 0.0.0.0:60040           0.0.0.0:*
>>> LISTEN      29711/beam.smp
>>> 
>>> $ cat /etc/rabbitmq/rabbitmq.config
>>> [{rabbit, [{vm_memory_high_watermark, 0.7}]},
>>> {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}].
>>> 
>>> $ cat /etc/rabbitmq/rabbitmq-env.conf
>>> RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
>>> 
>>> strace -p 29711 shows that the process is waiting in select():
>>> select(0, NULL, NULL, NULL, NULL
>>> 
>>> 
>>> Last lines in rabbit at dbx.log:
>>> ---------------------------
>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>> exception on TCP connection <0.367.0> from x.x.x.26:43157
>>> connection_closed_abruptly
>>> 
>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>> closing TCP connection <0.367.0> from x.x.x..26:43157
>>> 
>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>> exception on TCP connection <0.379.0> from x.x.x.26:43160
>>> connection_closed_abruptly
>>> 
>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>> closing TCP connection <0.379.0> from x.x.x.26:43160
>>> 
>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>> exception on TCP connection <0.335.0> from x.x.x.26:43154
>>> connection_closed_abruptly
>>> 
>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>> closing TCP connection <0.335.0> from x.x.x.26:43154
>>> 
>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>> exception on TCP connection <0.467.0> from x.x.x.26:43166
>>> connection_closed_abruptly
>>> 
>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>> closing TCP connection <0.467.0> from x.x.x.26:43166
>>> ---------------------------
>>> 
>>> PHP clients cannot connect to RabbitMQ. When I run my test Python
>>> script which uses amqplib.client_0_8, it hangs on
>>> amqp.Connection(host, "guest", "guest", ssl=False)
>>> 
>>> strace shows the following:
>>> 
>>> connect(3, {sa_family=AF_INET, sin_port=htons(5672),
>>> sin_addr=inet_addr("127.0.0.1")}, 16) = 0
>>> fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)
>>> fcntl(3, F_SETFL, O_RDWR)               = 0
>>> sendto(3, "AMQP\1\1\t\1", 8, 0, NULL, 0) = 8
>>> brk(0x1461000)                          = 0x1461000
>>> recvfrom(3,
>>> 
>>> Now, I try to connect to the RabbitMQ node using 'erl':
>>> $ erl -sname 'rabbit at dbx'
>>> {error_logger,{{2011,12,22},{10,26,33}},"Protocol: ~p: register error:
>>> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>> {error_logger,{{2011,12,22},{10,26,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.68>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,442}],[]]}
>>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at dbx',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>> {error_logger,{{2011,12,22},{10,26,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>> 
>>> Crash dump was written to: erl_crash.dump
>>> Kernel pid terminated (application_controller)
>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>> 
>>> Is there any other information that might be useful?
>>> 
>>> On 13 December 2011 18:26, Dmitri Minaev <minaev at gmail.com> wrote:
>>>> Thank you for the reply. Yes, TCP connection could be established, but
>>>> not AMQP. We generally use PHP library, but I also tested RabbitMQ
>>>> using Python amqplib. In both cases, the client side cannot get the
>>>> connection.
>>>> 
>>>> Besides the common information messages (starting/closing TCP
>>>> connection), there's only one type of messages in the log files:
>>>> 
>>>> =WARNING REPORT==== 13-Dec-2011::16:56:51 ===
>>>> exception on TCP connection <0.14474.173> from x.x.x.x:xxx
>>>> connection_closed_abruptly
>>>> 
>>>> But then, again, these messages may be found even during normal
>>>> operation, this is why I don't think they're relevant.
>>>> 
>>>> 
>>>> On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>>> Hmm. I can't really say anything from your description - can you post the
>>>>> logs somewhere? It's possible that your definition of "nothing unusual in
>>>>> the logs" differs from mine.
>>>>> 
>>>>> And when you say that "the server refused attempts to connect", what exactly
>>>>> do you mean. You say that a TCP connection *could* be established - so does
>>>>> your client hang during AMQP handshaking? Disconnect? Something else?
>>>>> 
>>>>> Cheers, Simon
>>>>> 
>>>>> 
>>>>> On 12/12/11 16:24, Dmitri Minaev wrote:
>>>>>> 
>>>>>> Hello,
>>>>>> 
>>>>>> We use RabbitMQ for about a year now. From time to time I upgraded it
>>>>>> and switched from one server to another. About a month ago the last
>>>>>> such transition took place. I installed new RabbitMQ (2.7) on a new
>>>>>> server and our web application was reconfigured. Quite soon we faced
>>>>>> new problems. After some days of stable work clients could not connect
>>>>>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>>>>>> connections, but the server refused attempts to connect. That is, TCP
>>>>>> socket was available and telnet could connect to port 5672, but the
>>>>>> AMQP connection could not be established. There was nothing unusual in
>>>>>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>>>>>> plenty of free memory.
>>>>>> 
>>>>>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>>>>>> problem remained. The last time I disabled IPv6, but today we hit the
>>>>>> same trouble again.
>>>>>> 
>>>>>> I think I must have done something wrong when setting up the
>>>>>> environment, but what could that be?
>>>>>> 
>>>>>> OS: Ubuntu 10.04 LTS.
>>>>>> 16GB RAM.
>>>>>> RabbitMQ 2.6.1
>>>>>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>>>>>> Client: php-amqplib
>>>>>> 
>>>>> 
>>>>> 
>>>>> --
>>>>> Simon MacMullen
>>>>> RabbitMQ, VMware
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>>> 
>>>> --
>>>> With best regards,
>>>> Dmitri Minaev
>>> 
>>> 
>>> 
>>> --
>>> With best regards,
>>> Dmitri Minaev
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> -- 
> With best regards,
> Dmitri Minaev

Sent form my Nokia 1100




From minaev at gmail.com  Thu Dec 22 09:16:29 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 13:16:29 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <92BBDBD9-25DB-41DF-84E0-E2F770E17378@gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<07AE7779-6B32-4075-AADD-005460180F8E@gmail.com>
	<CANTUpDDsKycBQEp5Nd4SBiifWLHLOi6LeC2zBhpoRmo9SW3YTw@mail.gmail.com>
	<92BBDBD9-25DB-41DF-84E0-E2F770E17378@gmail.com>
Message-ID: <CANTUpDCftdyNis27fJp5hi=f0borqVd2Yw8_mwomTfNbsEwing@mail.gmail.com>

Actually, I get the same results whatever cookie I set.


On 22 December 2011 12:35, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Yes, you might get a pang but make sure the user that started the erl command has the same .erlang.cookie as the user running the RabbitMQ process.
>
> On Dec 22, 2011, at 8:05 AM, Dmitri Minaev wrote:
>
>> Oh...
>>
>> $ erl -sname qwer
>> Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4]
>> [async-threads:0] [hipe] [kernel-poll:false]
>>
>> Eshell V5.7.4 ?(abort with ^G)
>> (qwer at dbx)1> net_adm:names().
>> {ok,[{"rabbit",60040},{"qwer",58043}]}
>> (qwer at dbx)2> net_adm:ping(rabbit).
>> pang
>>
>>
>>
>> On 22 December 2011 10:55, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Hi,
>>>
>>> A small note,
>>>
>>> When connecting to a remote Erlang node, in this case the the rabbit node, you have to choose a different node name.
>>>
>>> For example:
>>>
>>> erl -sname foo
>>>
>>> Once you are on the Erlang REPL then you can try to remotely connect to the rabbit node using net_adm:ping
>>>
>>> -Alvaro.
>>>
>>> Sent from my iFad
>>>
>>> On Dec 22, 2011, at 7:32 AM, Dmitri Minaev <minaev at gmail.com> wrote:
>>>
>>>> Now, I have a hanging Rabbit available for the autopsy.
>>>>
>>>> Running processes (ps ax|grep rabbit):
>>>>
>>>> -------------
>>>> 29699 ? ? ? ? ?Ss ? ? 0:00 sh -c
>>>> RABBITMQ_PID_FILE=/var/run/rabbitmq/pid /usr/sbin/rabbitmq-server >
>>>> ? ? ? ? /var/log/rabbitmq/startup_log 2>
>>>> /var/log/rabbitmq/startup_err
>>>> 29702 ? ? ? ? ?S ? ? ?0:00 /bin/sh /usr/sbin/rabbitmq-server
>>>> 29708 ? ? ? ? ?S ? ? ?0:00 su rabbitmq -s /bin/sh -c
>>>> /usr/lib/rabbitmq/bin/rabbitmq-server
>>>> 29710 ? ? ? ? ?S ? ? ?0:00 sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
>>>> 29711 ? ? ? ? ?Sl ? 4715:59 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W
>>>> w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl --
>>>> -home /var/lib/rabbitmq -- -noshell -noinput -sname rabbit at dbx
>>>> -setcookie riak -boot
>>>> /var/lib/rabbitmq/mnesia/rabbit at dbx-plugins-expand/rabbit -config
>>>> /etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
>>>> [{nodelay,true}] -rabbit tcp_listeners [{"0.0.0.0",5672}] -sasl
>>>> errlog_type error -kernel error_logger
>>>> {file,"/var/log/rabbitmq/rabbit at dbx.log"} -sasl sasl_error_logger
>>>> {file,"/var/log/rabbitmq/rabbit at dbx-sasl.log"} -os_mon start_cpu_sup
>>>> true -os_mon start_disksup false -os_mon start_memsup false -mnesia
>>>> dir "/var/lib/rabbitmq/mnesia/rabbit at dbx"
>>>> -------------
>>>>
>>>> Network sockets are available:
>>>> $ sudo netstat -tunlp|grep beam
>>>> tcp ? ? ? ?0 ? ? ?0 0.0.0.0:5672 ? ? ? ? ? ?0.0.0.0:*
>>>> LISTEN ? ? ?29711/beam.smp
>>>> tcp ? ? ? ?0 ? ? ?0 0.0.0.0:60040 ? ? ? ? ? 0.0.0.0:*
>>>> LISTEN ? ? ?29711/beam.smp
>>>>
>>>> $ cat /etc/rabbitmq/rabbitmq.config
>>>> [{rabbit, [{vm_memory_high_watermark, 0.7}]},
>>>> {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}].
>>>>
>>>> $ cat /etc/rabbitmq/rabbitmq-env.conf
>>>> RABBITMQ_NODE_IP_ADDRESS=0.0.0.0
>>>>
>>>> strace -p 29711 shows that the process is waiting in select():
>>>> select(0, NULL, NULL, NULL, NULL
>>>>
>>>>
>>>> Last lines in rabbit at dbx.log:
>>>> ---------------------------
>>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>>> exception on TCP connection <0.367.0> from x.x.x.26:43157
>>>> connection_closed_abruptly
>>>>
>>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>>> closing TCP connection <0.367.0> from x.x.x..26:43157
>>>>
>>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>>> exception on TCP connection <0.379.0> from x.x.x.26:43160
>>>> connection_closed_abruptly
>>>>
>>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>>> closing TCP connection <0.379.0> from x.x.x.26:43160
>>>>
>>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>>> exception on TCP connection <0.335.0> from x.x.x.26:43154
>>>> connection_closed_abruptly
>>>>
>>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>>> closing TCP connection <0.335.0> from x.x.x.26:43154
>>>>
>>>> =WARNING REPORT==== 22-Dec-2011::09:55:44 ===
>>>> exception on TCP connection <0.467.0> from x.x.x.26:43166
>>>> connection_closed_abruptly
>>>>
>>>> =INFO REPORT==== 22-Dec-2011::09:55:44 ===
>>>> closing TCP connection <0.467.0> from x.x.x.26:43166
>>>> ---------------------------
>>>>
>>>> PHP clients cannot connect to RabbitMQ. When I run my test Python
>>>> script which uses amqplib.client_0_8, it hangs on
>>>> amqp.Connection(host, "guest", "guest", ssl=False)
>>>>
>>>> strace shows the following:
>>>>
>>>> connect(3, {sa_family=AF_INET, sin_port=htons(5672),
>>>> sin_addr=inet_addr("127.0.0.1")}, 16) = 0
>>>> fcntl(3, F_GETFL) ? ? ? ? ? ? ? ? ? ? ? = 0x2 (flags O_RDWR)
>>>> fcntl(3, F_SETFL, O_RDWR) ? ? ? ? ? ? ? = 0
>>>> sendto(3, "AMQP\1\1\t\1", 8, 0, NULL, 0) = 8
>>>> brk(0x1461000) ? ? ? ? ? ? ? ? ? ? ? ? ?= 0x1461000
>>>> recvfrom(3,
>>>>
>>>> Now, I try to connect to the RabbitMQ node using 'erl':
>>>> $ erl -sname 'rabbit at dbx'
>>>> {error_logger,{{2011,12,22},{10,26,33}},"Protocol: ~p: register error:
>>>> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>>> {error_logger,{{2011,12,22},{10,26,33}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.68>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,442}],[]]}
>>>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at dbx',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>> {error_logger,{{2011,12,22},{10,26,33}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>> {error_logger,{{2011,12,22},{10,26,33}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>>
>>>> Crash dump was written to: erl_crash.dump
>>>> Kernel pid terminated (application_controller)
>>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>>
>>>> Is there any other information that might be useful?
>>>>
>>>> On 13 December 2011 18:26, Dmitri Minaev <minaev at gmail.com> wrote:
>>>>> Thank you for the reply. Yes, TCP connection could be established, but
>>>>> not AMQP. We generally use PHP library, but I also tested RabbitMQ
>>>>> using Python amqplib. In both cases, the client side cannot get the
>>>>> connection.
>>>>>
>>>>> Besides the common information messages (starting/closing TCP
>>>>> connection), there's only one type of messages in the log files:
>>>>>
>>>>> =WARNING REPORT==== 13-Dec-2011::16:56:51 ===
>>>>> exception on TCP connection <0.14474.173> from x.x.x.x:xxx
>>>>> connection_closed_abruptly
>>>>>
>>>>> But then, again, these messages may be found even during normal
>>>>> operation, this is why I don't think they're relevant.
>>>>>
>>>>>
>>>>> On 13 December 2011 14:42, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>>>> Hmm. I can't really say anything from your description - can you post the
>>>>>> logs somewhere? It's possible that your definition of "nothing unusual in
>>>>>> the logs" differs from mine.
>>>>>>
>>>>>> And when you say that "the server refused attempts to connect", what exactly
>>>>>> do you mean. You say that a TCP connection *could* be established - so does
>>>>>> your client hang during AMQP handshaking? Disconnect? Something else?
>>>>>>
>>>>>> Cheers, Simon
>>>>>>
>>>>>>
>>>>>> On 12/12/11 16:24, Dmitri Minaev wrote:
>>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> We use RabbitMQ for about a year now. From time to time I upgraded it
>>>>>>> and switched from one server to another. About a month ago the last
>>>>>>> such transition took place. I installed new RabbitMQ (2.7) on a new
>>>>>>> server and our web application was reconfigured. Quite soon we faced
>>>>>>> new problems. After some days of stable work clients could not connect
>>>>>>> to RabbitMQ. I could list run rabbitmqctl, list queues, kill
>>>>>>> connections, but the server refused attempts to connect. That is, TCP
>>>>>>> socket was available and telnet could connect to port 5672, but the
>>>>>>> AMQP connection could not be established. There was nothing unusual in
>>>>>>> the logs. vm_memory_high_watermark is set to 0.7 and there's still
>>>>>>> plenty of free memory.
>>>>>>>
>>>>>>> After a couple of such failures I tried to downgrade to 2.6.1, but the
>>>>>>> problem remained. The last time I disabled IPv6, but today we hit the
>>>>>>> same trouble again.
>>>>>>>
>>>>>>> I think I must have done something wrong when setting up the
>>>>>>> environment, but what could that be?
>>>>>>>
>>>>>>> OS: Ubuntu 10.04 LTS.
>>>>>>> 16GB RAM.
>>>>>>> RabbitMQ 2.6.1
>>>>>>> Erlang R13B03 (erts-5.7.4) (package erlang-nox from Ubuntu repository)
>>>>>>> Client: php-amqplib
>>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Simon MacMullen
>>>>>> RabbitMQ, VMware
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> With best regards,
>>>>> Dmitri Minaev
>>>>
>>>>
>>>>
>>>> --
>>>> With best regards,
>>>> Dmitri Minaev
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> With best regards,
>> Dmitri Minaev
>
> Sent form my Nokia 1100
>
>
>



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Thu Dec 22 09:43:08 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 09:43:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
Message-ID: <4EF2FBAC.2010208@rabbitmq.com>

Dmitri,

On 22/12/11 06:32, Dmitri Minaev wrote:
> Now, I have a hanging Rabbit available for the autopsy.

Please send us the output of 'rabbitmqctl report'.

Matthias.

From minaev at gmail.com  Thu Dec 22 10:17:24 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 14:17:24 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EF2FBAC.2010208@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
Message-ID: <CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>

Here it is, in the attached file.

Fifteen minutes ago another RabbitMQ (this time v. 2.7) on another
server also refused to accept connections. I downgraded it to the last
version that worked (if I remember correctly, it is 2.1) and started
again. Let's see if it helps.


On 22 December 2011 13:43, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 22/12/11 06:32, Dmitri Minaev wrote:
>>
>> Now, I have a hanging Rabbit available for the autopsy.
>
>
> Please send us the output of 'rabbitmqctl report'.
>
> Matthias.



-- 
With best regards,
Dmitri Minaev
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report.2011-12-22
Type: application/octet-stream
Size: 30607 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111222/3bd273b9/attachment.obj>

From matthias at rabbitmq.com  Thu Dec 22 10:25:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 10:25:20 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
Message-ID: <4EF30590.9010103@rabbitmq.com>

Dmitri,

On 22/12/11 10:17, Dmitri Minaev wrote:
> Here it is, in the attached file.

All looks fine. What memory and file descriptor limits get reported in 
the rabbit log?

Can you get a connection established when connecting a client from the 
same machine the broker is running on?

Matthias.

From minaev at gmail.com  Thu Dec 22 10:43:34 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 14:43:34 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EF30590.9010103@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
Message-ID: <CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>

During the last startup it was

=INFO REPORT==== 13-Dec-2011::17:16:53 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 13-Dec-2011::17:16:53 ===
Memory limit set to 11252MB.

No, I cannot connect to Rabbit even from the same server. As I said
before, TCP connection to 127.0.0.1 is established, but AMQP
connection is not established.


On 22 December 2011 14:25, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 22/12/11 10:17, Dmitri Minaev wrote:
>>
>> Here it is, in the attached file.
>
>
> All looks fine. What memory and file descriptor limits get reported in the
> rabbit log?
>
> Can you get a connection established when connecting a client from the same
> machine the broker is running on?
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Thu Dec 22 10:50:15 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 10:50:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
Message-ID: <4EF30B67.1070401@rabbitmq.com>

Dmitri,

On 22/12/11 10:43, Dmitri Minaev wrote:
> No, I cannot connect to Rabbit even from the same server. As I said
> before, TCP connection to 127.0.0.1 is established, but AMQP
> connection is not established.

On the broker machine, try

$ telnet localhost 5672

and type in 'AMQPxxxx<return>'

That should result in an output of

AMQP    Connection closed by foreign host.

and a message in the rabbit.log like this:

=ERROR REPORT==== 22-Dec-2011::10:47:09 ===
exception on TCP connection <0.767.0> from [::1]:48915
{bad_version,120,120,120,120}


Do you get the same?

Matthias.

From minaev at gmail.com  Thu Dec 22 10:51:30 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 14:51:30 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
Message-ID: <CANTUpDCs2R_WQ9b3QRszQ-vf7AzgACGb+zJQFfSk1m27wjYnYg@mail.gmail.com>

Here's also a graph of the number of messages in the queues (see
attached file). We have an impression that this situation is caused by
relatively high load. At least, RabbitMQ worked well since 13.12 till
today, 22.12, when message producers were started.


On 22 December 2011 14:43, Dmitri Minaev <minaev at gmail.com> wrote:
> During the last startup it was
>
> =INFO REPORT==== 13-Dec-2011::17:16:53 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 13-Dec-2011::17:16:53 ===
> Memory limit set to 11252MB.
>
> No, I cannot connect to Rabbit even from the same server. As I said
> before, TCP connection to 127.0.0.1 is established, but AMQP
> connection is not established.
>
>
> On 22 December 2011 14:25, Matthias Radestock <matthias at rabbitmq.com> wrote:
>> Dmitri,
>>
>>
>> On 22/12/11 10:17, Dmitri Minaev wrote:
>>>
>>> Here it is, in the attached file.
>>
>>
>> All looks fine. What memory and file descriptor limits get reported in the
>> rabbit log?
>>
>> Can you get a connection established when connecting a client from the same
>> machine the broker is running on?
>>
>> Matthias.
>
>
>
> --
> With best regards,
> Dmitri Minaev



-- 
With best regards,
Dmitri Minaev
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_list_queues-day.png
Type: image/png
Size: 49412 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111222/8dac5e7f/attachment.png>

From minaev at gmail.com  Thu Dec 22 11:02:20 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 15:02:20 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EF30B67.1070401@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
Message-ID: <CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>

No, I get no response from the server and nothing appears in the log.

But some new messages did appear after Rabbit had stopped accepting
connections. They are mostly in the same vein:

=INFO REPORT==== 22-Dec-2011::11:03:55 ===
closing TCP connection <0.431.0> from 212.24.56.22:49702

=WARNING REPORT==== 22-Dec-2011::11:03:55 ===
exception on TCP connection <0.327.0> from 212.24.56.22:49699
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::11:03:55 ===
closing TCP connection <0.327.0> from 212.24.56.22:49699

=WARNING REPORT==== 22-Dec-2011::11:03:55 ===
exception on TCP connection <0.976.0> from 212.24.56.22:49720
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::11:03:55 ===
closing TCP connection <0.976.0> from 212.24.56.22:49720

=WARNING REPORT==== 22-Dec-2011::11:03:55 ===
exception on TCP connection <0.1007.0> from 212.24.56.22:49721
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::11:03:55 ===
closing TCP connection <0.1007.0> from 212.24.56.22:49721

=WARNING REPORT==== 22-Dec-2011::11:03:55 ===
exception on TCP connection <0.1019.0> from 212.24.56.22:49722
connection_closed_abruptly

=INFO REPORT==== 22-Dec-2011::11:03:55 ===
closing TCP connection <0.1019.0> from 212.24.56.22:49722



By the way, here's another graph, number of connections to Rabbit.
Hope it helps.




On 22 December 2011 14:50, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 22/12/11 10:43, Dmitri Minaev wrote:
>>
>> No, I cannot connect to Rabbit even from the same server. As I said
>> before, TCP connection to 127.0.0.1 is established, but AMQP
>> connection is not established.
>
>
> On the broker machine, try
>
> $ telnet localhost 5672
>
> and type in 'AMQPxxxx<return>'
>
> That should result in an output of
>
> AMQP ? ?Connection closed by foreign host.
>
> and a message in the rabbit.log like this:
>
> =ERROR REPORT==== 22-Dec-2011::10:47:09 ===
> exception on TCP connection <0.767.0> from [::1]:48915
> {bad_version,120,120,120,120}
>
>
> Do you get the same?
>
> Matthias.



-- 
With best regards,
Dmitri Minaev
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_connections-day.png
Type: image/png
Size: 20073 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111222/5de3f231/attachment.png>

From matthias at rabbitmq.com  Thu Dec 22 11:09:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 11:09:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
Message-ID: <4EF30FE4.8060100@rabbitmq.com>

On 22/12/11 11:02, Dmitri Minaev wrote:
> No, I get no response from the server and nothing appears in the log.

This is all very mysterious.

Is the rabbit server process busy, cpu-wise?

Matthias.

From minaev at gmail.com  Thu Dec 22 11:30:29 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 15:30:29 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EF30FE4.8060100@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
Message-ID: <CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>

No, it is simply waiting. CPU is idle, RAM is free, swap is unused, IO
is very moderate.

Is there anything I could do using -remsh?


On 22 December 2011 15:09, Matthias Radestock <matthias at rabbitmq.com> wrote:
> On 22/12/11 11:02, Dmitri Minaev wrote:
>>
>> No, I get no response from the server and nothing appears in the log.
>
>
> This is all very mysterious.
>
> Is the rabbit server process busy, cpu-wise?
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Thu Dec 22 11:36:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 11:36:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
Message-ID: <4EF3162A.7040009@rabbitmq.com>

Dmitri,

On 22/12/11 11:30, Dmitri Minaev wrote:
> No, it is simply waiting. CPU is idle, RAM is free, swap is unused, IO
> is very moderate.

I suspect this is a problem with Erlang, somehow causing the tcp/ip 
sub-system to get into a weird state.

I see you are running R13B03, which is two years old. I suggest you 
replace that with Ericsson's latest - R15B - and also run the latest 
rabbit (2.7.1).

Regards,

Matthias.

From minaev at gmail.com  Thu Dec 22 11:41:17 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 22 Dec 2011 15:41:17 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EF3162A.7040009@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
Message-ID: <CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>

Sounds reasonable :). Ok, I will stop the hanging instance now and
upgrade Erlang to the last version. This one just happened to be found
in Ubuntu repository.

Thank you, Matthias, Alvaro, Simon and everyone else!


On 22 December 2011 15:36, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 22/12/11 11:30, Dmitri Minaev wrote:
>>
>> No, it is simply waiting. CPU is idle, RAM is free, swap is unused, IO
>> is very moderate.
>
>
> I suspect this is a problem with Erlang, somehow causing the tcp/ip
> sub-system to get into a weird state.
>
> I see you are running R13B03, which is two years old. I suggest you replace
> that with Ericsson's latest - R15B - and also run the latest rabbit (2.7.1).
>
> Regards,
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From andy.berryman at channeladvisor.com  Thu Dec 22 16:12:55 2011
From: andy.berryman at channeladvisor.com (AndyB)
Date: Thu, 22 Dec 2011 08:12:55 -0800 (PST)
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
Message-ID: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>

http://www.rabbitmq.com/memory.html

I'm running into some problems that I'm hoping that someone here can
help me with.  Let me first state my setup.  I'm running the latest
release of RabbitMQ on CentOS (64bit) in a clustered configuration
with 2 nodes in my Production environment.  In my development
environment I only have 1 node though.  My code is written in C# and
is using the downloaded SDK from the website.  The memory
configuration value is set to 40% as the default.

I ran into a problem in my Production environment a week ago where
work was building up on my queue faster than my consumers were
processing it.  Unfortunately I wasnt able to perform any debugging or
metrics gathering before the system was recycled or the queue was
purged.  I'm still not exactly sure exactly which happened.  But what
I can tell you is that it looked to me like exceptions were occurring
for both the publishers and consumers and nothing was really
happening.  I have since added more consumers and have not had the
problem occur again.  But this obviously has me concerned.

I am currently in the process of trying to reproduce this problem in
my development environment, but I'm running into some confusing
results.  My test case is to run multiple publishers sending messages
over and over as fast as possible while also have a single consumer
processing those messages with a delay.  The goal is to obviously
force messages to pile up in memory on the node to trigger the memory
alert.  Since I have both publishers and consumers connected, I'm
expecting to see the consumers begin to get some sort of exception
saying that they cant submit anymore work while the consumer continues
to process.  But what I'm actually seeing is that the publishers
continue piling on and the consumer continues to process, but the
machine eventually runs out of disk space and crashes.

Is there anyone that can advise me on what I'm doing wrong or help me
figure out what changes I can make?

Thanks
Andy

From rishdev at gmail.com  Thu Dec 22 16:40:01 2011
From: rishdev at gmail.com (Rishi Dev)
Date: Thu, 22 Dec 2011 09:40:01 -0700
Subject: [rabbitmq-discuss] Recommendations for AMQP / RabbitMQ
Message-ID: <CANjYesgF1yuqNtgZOQAQQz9-EQF-kQvtPWq1xStz0Szcmk=DDA@mail.gmail.com>

Friends,

We are close to make a decision for Enterprise Messaging system for our
organization.
We are inclined towards RabbitMQ (AMQP), but our team is little bit
concerned ...

"It seems like there may be a lot of risk with AMQP right now. Do we feel
that the Rabbit MQ product is production grade? "

Can some experts help me and give expert opinions?

Thank you very much.

Rishi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111222/e5ca4601/attachment.htm>

From vveludan at gmail.com  Thu Dec 22 16:52:34 2011
From: vveludan at gmail.com (Venkat)
Date: Thu, 22 Dec 2011 08:52:34 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
Message-ID: <0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>

I saw a post on RabbitMQ 2.7.1 Release. We will be planning to upgrade
to 2.7.1.

Thanks
Venkat

On Dec 21, 9:39?pm, Venkat <vvelu... at gmail.com> wrote:
> Good evening.
> We have ?a cluster of two RabbitMQ nodes running 2.7.0 version using
> mirrored queues.
> There are 25 queues all using x-ha-policy = all.
> There was a point where one queue had 5000 messages and the other
> queue had about 600K messages. Message consumption was slow due to the
> business logic using Cassandra was slowing down. At this point
> executed rabbitmqctl report command one NodeA. It displayed that node
> was down though the node was up. Executed the report command on NodeB,
> after there was no response. After some time when executed rabbitmqctl
> list_queues command on NodeA some of the queues were not listed. I
> just wanted to find running report command when broker is under heavy
> load can cause any problem.
>
> Thanks
> Venkat
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alex.lovelltroy at gmail.com  Thu Dec 22 17:05:14 2011
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Thu, 22 Dec 2011 17:05:14 +0000
Subject: [rabbitmq-discuss] Recommendations for AMQP / RabbitMQ
In-Reply-To: <CANjYesgF1yuqNtgZOQAQQz9-EQF-kQvtPWq1xStz0Szcmk=DDA@mail.gmail.com>
References: <CANjYesgF1yuqNtgZOQAQQz9-EQF-kQvtPWq1xStz0Szcmk=DDA@mail.gmail.com>
Message-ID: <CAMACij6SbTg-1RXgSxEn5+oezNs5NBQLsMwcGB3HPgLtWtFsRA@mail.gmail.com>

The pedantic answer to your question is:

Yes.  My expert opinion is that the RabbitMQ product is production grade.

This mailing list is full of questions like this as well as the
responses from those of us happily using rabbitMQ in production.  If
you can be more specific about the concerns that have been raised or
the metrics you use to guide your production choices, we can probably
be more helpful.

-alex

On Thu, Dec 22, 2011 at 4:40 PM, Rishi Dev <rishdev at gmail.com> wrote:
> Friends,
>
> We are close to make a decision for Enterprise Messaging system for our
> organization.
> We are inclined towards RabbitMQ (AMQP), but our team is little bit
> concerned ...
>
> "It seems like there may be a lot of risk with AMQP right now. Do we feel
> that the Rabbit MQ product is production grade? "
>
> Can some experts help me and give expert opinions?
>
> Thank you very much.
>
> Rishi
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From steve at rabbitmq.com  Thu Dec 22 18:31:33 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 22 Dec 2011 18:31:33 +0000
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
Message-ID: <316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>

Andy,

By the 'lastest release' I presume you mean 2.7.0 (a week ago that would be
true, but now we have released 2.7.1.)

Please can you show us your rabbitmq log after a crash? The test environment
case would be interesting, though the production system is probably
experiencing issues which are of an application nature.

If the consumers were failing (getting exceptions) for some application reason,
and they were responsible for acknowledging the messages, then it is entirely
likely that the messages they failed to process are being re-queued, and the
queue is building up without being drained.  The application exceptions are
therefore very interesting, and you should take care that a consumer should
acknowledge the message WHEN IT HAS BEEN DEALT WITH -- even if that means it
was an error that has been logged/passed on, or whatever.

In the latest release message re-queuing preserves the order (for a single
consumer) so a failing message might reappear in the queue at the head -- this
would cause it to be re-processed more-or-less straight away, and if it is a
message payload logical error of some kind, this is likely to fail again --
and so on.  The previous releases did not try to preserve message order, and
so the failing messages could be overtaken by non-failing ones.  This would not
show up as a bottle-neck during high-load.

I'm interested in your RAM configuration.  It is entirely possible for rabbitmq
to run out of memory even if there is a threshold set.  Continual high
publication rates, especially with new publishers all the time, will not be
blocked entirely even then. This might mean that the test you ran is giving
you misleading information.

When the memory piles up you could also issue a rabbitmqctl report, which
should tell us the general situation.

Steve Powell  (a perplexed bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 22 Dec 2011, at 16:12, AndyB wrote:

> http://www.rabbitmq.com/memory.html
> 
> I'm running into some problems that I'm hoping that someone here can
> help me with.  Let me first state my setup.  I'm running the latest
> release of RabbitMQ on CentOS (64bit) in a clustered configuration
> with 2 nodes in my Production environment.  In my development
> environment I only have 1 node though.  My code is written in C# and
> is using the downloaded SDK from the website.  The memory
> configuration value is set to 40% as the default.
> 
> I ran into a problem in my Production environment a week ago where
> work was building up on my queue faster than my consumers were
> processing it.  Unfortunately I wasnt able to perform any debugging or
> metrics gathering before the system was recycled or the queue was
> purged.  I'm still not exactly sure exactly which happened.  But what
> I can tell you is that it looked to me like exceptions were occurring
> for both the publishers and consumers and nothing was really
> happening.  I have since added more consumers and have not had the
> problem occur again.  But this obviously has me concerned.
> 
> I am currently in the process of trying to reproduce this problem in
> my development environment, but I'm running into some confusing
> results.  My test case is to run multiple publishers sending messages
> over and over as fast as possible while also have a single consumer
> processing those messages with a delay.  The goal is to obviously
> force messages to pile up in memory on the node to trigger the memory
> alert.  Since I have both publishers and consumers connected, I'm
> expecting to see the consumers begin to get some sort of exception
> saying that they cant submit anymore work while the consumer continues
> to process.  But what I'm actually seeing is that the publishers
> continue piling on and the consumer continues to process, but the
> machine eventually runs out of disk space and crashes.
> 
> Is there anyone that can advise me on what I'm doing wrong or help me
> figure out what changes I can make?
> 
> Thanks
> Andy
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Thu Dec 22 18:32:06 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 22 Dec 2011 18:32:06 +0000
Subject: [rabbitmq-discuss] RabbitMQ broker crashing under heavy load
	with mirrored queues
In-Reply-To: <0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
References: <c9ec0fef-dd59-46b8-9712-fb4ce6f26725@d10g2000vbk.googlegroups.com>
	<0f06df5a-0e14-44c7-8689-87fa76cedaaa@m7g2000vbc.googlegroups.com>
Message-ID: <3A6536E5-4791-4CCB-B2B8-72AE073CF66A@rabbitmq.com>

Please let us know if this cures your problem.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 22 Dec 2011, at 16:52, Venkat wrote:

> I saw a post on RabbitMQ 2.7.1 Release. We will be planning to upgrade
> to 2.7.1.
> 
> Thanks
> Venkat
> 
> On Dec 21, 9:39 pm, Venkat <vvelu... at gmail.com> wrote:
>> Good evening.
>> We have  a cluster of two RabbitMQ nodes running 2.7.0 version using
>> mirrored queues.
>> There are 25 queues all using x-ha-policy = all.
>> There was a point where one queue had 5000 messages and the other
>> queue had about 600K messages. Message consumption was slow due to the
>> business logic using Cassandra was slowing down. At this point
>> executed rabbitmqctl report command one NodeA. It displayed that node
>> was down though the node was up. Executed the report command on NodeB,
>> after there was no response. After some time when executed rabbitmqctl
>> list_queues command on NodeA some of the queues were not listed. I
>> just wanted to find running report command when broker is under heavy
>> load can cause any problem.
>> 
>> Thanks
>> Venkat
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Dec 22 19:30:28 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 19:30:28 +0000
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
Message-ID: <4EF38554.10209@rabbitmq.com>

On 22/12/11 16:12, AndyB wrote:
> My test case is to run multiple publishers sending messages
> over and over as fast as possible while also have a single consumer
> processing those messages with a delay.  The goal is to obviously
> force messages to pile up in memory on the node to trigger the memory
> alert.  Since I have both publishers and consumers connected, I'm
> expecting to see the consumers begin to get some sort of exception
> saying that they cant submit anymore work while the consumer continues
> to process.  But what I'm actually seeing is that the publishers
> continue piling on and the consumer continues to process, but the
> machine eventually runs out of disk space and crashes.

Rabbit does not enforce any disk space limits. So if producers keep 
publishing messages, and consumers do not keep up, rabbit will page more 
and more messages to disk and eventually disk space runs out.

Limiting disk space usage, similar to the way rabbit limits ram usage, 
is on our todo list. Though in practice most systems have ample disk 
space and operational monitoring usually detects situations that fill up 
the disk with plenty of time to take remedial action.

Matthias.

From andy.berryman at channeladvisor.com  Thu Dec 22 19:35:44 2011
From: andy.berryman at channeladvisor.com (AndyB)
Date: Thu, 22 Dec 2011 11:35:44 -0800 (PST)
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
Message-ID: <7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>

Thanks for the quick reply guys.  With the help of one of my systems
guys, I think that we have made some progress on this issue.  After
performing further tests with my application and doing some close
monitoring on the server node itself.  We noticed some unexpected
messages being written to disk for the queue which is transient.  That
immediately confused us.  And after some creative google'ing we came
across the following page which helped us a great deal ...
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-October/015793.html.
Given that information and some tweaks to the tests, I was finally
able to reproduce the memory throttling of publishers that I was
expecting to see.  And I think that I have a better understanding now
for the RAM usage and statistics and their tie to the watermark value.

But this gets me to my next concern ... The throttling of the
publishers appears to be a blocking operation from within the
"BasicPublish" method and as best I can tell, I'm not seeing any sort
of timeout.  This indefinite blocking would be pretty bad if it were
to occur in my production environment.  Is there a way that I can
specify some sort of timeout for the blocking operation?  I see an
overload for "BasicPublish" which has boolean params for "immediate"
and "mandatory".  Are either of those meant to help in this situation?

Thanks
Andy

On Dec 22, 1:31?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Andy,
>
> By the 'lastest release' I presume you mean 2.7.0 (a week ago that would be
> true, but now we have released 2.7.1.)
>
> Please can you show us your rabbitmq log after a crash? The test environment
> case would be interesting, though the production system is probably
> experiencing issues which are of an application nature.
>
> If the consumers were failing (getting exceptions) for some application reason,
> and they were responsible for acknowledging the messages, then it is entirely
> likely that the messages they failed to process are being re-queued, and the
> queue is building up without being drained. ?The application exceptions are
> therefore very interesting, and you should take care that a consumer should
> acknowledge the message WHEN IT HAS BEEN DEALT WITH -- even if that means it
> was an error that has been logged/passed on, or whatever.
>
> In the latest release message re-queuing preserves the order (for a single
> consumer) so a failing message might reappear in the queue at the head -- this
> would cause it to be re-processed more-or-less straight away, and if it is a
> message payload logical error of some kind, this is likely to fail again --
> and so on. ?The previous releases did not try to preserve message order, and
> so the failing messages could be overtaken by non-failing ones. ?This would not
> show up as a bottle-neck during high-load.
>
> I'm interested in your RAM configuration. ?It is entirely possible for rabbitmq
> to run out of memory even if there is a threshold set. ?Continual high
> publication rates, especially with new publishers all the time, will not be
> blocked entirely even then. This might mean that the test you ran is giving
> you misleading information.
>
> When the memory piles up you could also issue a rabbitmqctl report, which
> should tell us the general situation.
>
> Steve Powell ?(a perplexed bunny)
> ----------some more definitions from the SPD----------
> avoirdupois (phr.) 'Would you like peas with that?'
> distribute (v.) To denigrate an award ceremony.
> definite (phr.) 'It's hard of hearing, I think.'
> modest (n.) The most mod.
>
> On 22 Dec 2011, at 16:12, AndyB wrote:
>
>
>
>
>
>
>
>
>
> >http://www.rabbitmq.com/memory.html
>
> > I'm running into some problems that I'm hoping that someone here can
> > help me with. ?Let me first state my setup. ?I'm running the latest
> > release of RabbitMQ on CentOS (64bit) in a clustered configuration
> > with 2 nodes in my Production environment. ?In my development
> > environment I only have 1 node though. ?My code is written in C# and
> > is using the downloaded SDK from the website. ?The memory
> > configuration value is set to 40% as the default.
>
> > I ran into a problem in my Production environment a week ago where
> > work was building up on my queue faster than my consumers were
> > processing it. ?Unfortunately I wasnt able to perform any debugging or
> > metrics gathering before the system was recycled or the queue was
> > purged. ?I'm still not exactly sure exactly which happened. ?But what
> > I can tell you is that it looked to me like exceptions were occurring
> > for both the publishers and consumers and nothing was really
> > happening. ?I have since added more consumers and have not had the
> > problem occur again. ?But this obviously has me concerned.
>
> > I am currently in the process of trying to reproduce this problem in
> > my development environment, but I'm running into some confusing
> > results. ?My test case is to run multiple publishers sending messages
> > over and over as fast as possible while also have a single consumer
> > processing those messages with a delay. ?The goal is to obviously
> > force messages to pile up in memory on the node to trigger the memory
> > alert. ?Since I have both publishers and consumers connected, I'm
> > expecting to see the consumers begin to get some sort of exception
> > saying that they cant submit anymore work while the consumer continues
> > to process. ?But what I'm actually seeing is that the publishers
> > continue piling on and the consumer continues to process, but the
> > machine eventually runs out of disk space and crashes.
>
> > Is there anyone that can advise me on what I'm doing wrong or help me
> > figure out what changes I can make?
>
> > Thanks
> > Andy
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu Dec 22 19:48:06 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 19:48:06 +0000
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>
Message-ID: <4EF38976.7060009@rabbitmq.com>

On 22/12/11 19:35, AndyB wrote:
> But this gets me to my next concern ... The throttling of the
> publishers appears to be a blocking operation from within the
> "BasicPublish" method and as best I can tell, I'm not seeing any
> sort of timeout.  This indefinite blocking would be pretty bad if it
> were to occur in my production environment.

It's not going to block indefinitely, since the paging to disk, or the
consumption of messages, will free up space, at which point the
producers are unblocked.

Just think of this situation as being the same as a slow network /
server; it's indistinguishable from that.

> Is there a way that I can specify some sort of timeout for the
> blocking operation?

No.

Matthias.

From andy.berryman at channeladvisor.com  Thu Dec 22 19:53:59 2011
From: andy.berryman at channeladvisor.com (AndyB)
Date: Thu, 22 Dec 2011 11:53:59 -0800 (PST)
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <4EF38976.7060009@rabbitmq.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>
	<4EF38976.7060009@rabbitmq.com>
Message-ID: <3c16f984-d1cb-47ae-849f-e92d81c349e2@y7g2000vbe.googlegroups.com>

In my test case, I have intentionally coded the consumer to never
catch up.  During the process, I saw the publishers get blocked after
the alert, messages were streamed to disk enough to get below the
watermark, and the publishers were unblocked.  Of course they hit the
watermark soon after and the same process happened again.  I'd say
this happened maybe 4 or 5 times and then they just remained in a
blocked state.  I let the test continue running for almost 10 minutes
and they never became unblocked and the watermark alert never seemed
to clear on the server.  So I guess that means that it stopped
streaming the messages to disk or something?  Either way, I'm going to
have to come up with a way to implement something in my code to try to
avoid tying up a thread for an unknown amount of time.  Any ideas?  Is
there a way to subscribe to the watermark event or something?

Andy

On Dec 22, 2:48?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 22/12/11 19:35, AndyB wrote:
>
> > But this gets me to my next concern ... The throttling of the
> > publishers appears to be a blocking operation from within the
> > "BasicPublish" method and as best I can tell, I'm not seeing any
> > sort of timeout. ?This indefinite blocking would be pretty bad if it
> > were to occur in my production environment.
>
> It's not going to block indefinitely, since the paging to disk, or the
> consumption of messages, will free up space, at which point the
> producers are unblocked.
>
> Just think of this situation as being the same as a slow network /
> server; it's indistinguishable from that.
>
> > Is there a way that I can specify some sort of timeout for the
> > blocking operation?
>
> No.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu Dec 22 20:01:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 20:01:54 +0000
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying
 queues or exchanges
In-Reply-To: <9bf341a0-8be7-4fd4-b422-ce65ad98528b@e2g2000vbb.googlegroups.com>
References: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
	<9bf341a0-8be7-4fd4-b422-ce65ad98528b@e2g2000vbb.googlegroups.com>
Message-ID: <4EF38CB2.9060009@rabbitmq.com>

On 21/12/11 15:44, joefitzgerald wrote:
> I've noticed a bug where the Windows installer installs RabbitMQ as a
> service, but when it is started, nothing really works.

Is this reproducible?

> The fix for me was to:
>
> * rabbitmq-service.bat stop
> * rabbitmq-service.bat remove
> * rabbitmq-service.bat install
> * rabbitmq-service.bat start

These, minus the 'remove', are necessary steps when enabling/disabling 
plugins in the RabbitMQ Windows service. See 
http://www.rabbitmq.com/plugins.html#windows-restart

Matthias.

From jasonjwwilliams at gmail.com  Thu Dec 22 20:02:54 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 22 Dec 2011 13:02:54 -0700
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <4EF38976.7060009@rabbitmq.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>
	<4EF38976.7060009@rabbitmq.com>
Message-ID: <CAHZAEpenHT-n-=3Eux4G50JBHLeLfuem6rOogxt0Rb0Mejb8hw@mail.gmail.com>

>> Is there a way that I can specify some sort of timeout for the
>> blocking operation?
>
>
> No.

I think a timeout would be a useful setting on the client side. If
Rabbit backs up enough, you don't want your frontend just appearing to
hang to the frontend's client. At some point it should raise a timeout
exception you can handle and give feedback to the app's client.

-J

From matthias at rabbitmq.com  Thu Dec 22 20:21:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 20:21:36 +0000
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <3c16f984-d1cb-47ae-849f-e92d81c349e2@y7g2000vbe.googlegroups.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>	<4EF38976.7060009@rabbitmq.com>
	<3c16f984-d1cb-47ae-849f-e92d81c349e2@y7g2000vbe.googlegroups.com>
Message-ID: <4EF39150.4010109@rabbitmq.com>

Andy,

On 22/12/11 19:53, AndyB wrote:
> In my test case, I have intentionally coded the consumer to never
> catch up.  During the process, I saw the publishers get blocked
> after the alert, messages were streamed to disk enough to get below
> the watermark, and the publishers were unblocked.  Of course they hit
> the watermark soon after and the same process happened again.  I'd
> say this happened maybe 4 or 5 times and then they just remained in
> a blocked state.  I let the test continue running for almost 10
> minutes and they never became unblocked and the watermark alert never
> seemed to clear on the server.  So I guess that means that it
> stopped streaming the messages to disk or something?

It's possible that you ran into another limit...

Each message has a small memory footprint, even when it has been paged
to disk. So there is an upper bound to how many messages rabbit can hold
on to. When that bound is reached producers will remain blocked until
some messages have been consumed.

There is way around that - changing the message store index module to
one that is operating entirely on disk. See
https://github.com/rabbitmq/rabbitmq-toke. However, I don't know of any
production rabbits that have actually run into this limitation.

> Either way, I'm going to have to come up with a way to implement
> something in my code to try to avoid tying up a thread for an unknown
> amount of time.  Any ideas?

You could perform all the invocations of the AMQP client's publish 
methods from a single, separate thread. It would sit in a loop, pulling 
messages off a bounded buffer / queue (e.g. an ArrayBlockingQueue if 
this was Java; there are presumably similar data structures in C#, and 
worst case you could roll your own) and invoking the publish methods in 
the AMQP client.

The "real" publishing threads simply deposit messages into the buffer / 
queue using an operation with a timeout, e.g. BlockingQueue.offer(E o, 
long timeout, TimeUnit unit).


Matthias.

From matthias at rabbitmq.com  Thu Dec 22 20:25:42 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Dec 2011 20:25:42 +0000
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <CAHZAEpenHT-n-=3Eux4G50JBHLeLfuem6rOogxt0Rb0Mejb8hw@mail.gmail.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>	<4EF38976.7060009@rabbitmq.com>
	<CAHZAEpenHT-n-=3Eux4G50JBHLeLfuem6rOogxt0Rb0Mejb8hw@mail.gmail.com>
Message-ID: <4EF39246.8020403@rabbitmq.com>

On 22/12/11 20:02, Jason J. W. Williams wrote:
> I think a timeout would be a useful setting on the client side. If
> Rabbit backs up enough, you don't want your frontend just appearing to
> hang to the frontend's client. At some point it should raise a timeout
> exception you can handle and give feedback to the app's client.

There's a bug open to address that. Alas it's been open for >1 year and 
is a major piece of work across all our clients. So I doubt we will work 
on it any time soon.

Matthias.

From andy.berryman at channeladvisor.com  Thu Dec 22 20:31:55 2011
From: andy.berryman at channeladvisor.com (AndyB)
Date: Thu, 22 Dec 2011 12:31:55 -0800 (PST)
Subject: [rabbitmq-discuss] Memory Management Concerns / Questions
In-Reply-To: <4EF39246.8020403@rabbitmq.com>
References: <0819d449-03ac-4dc7-8b30-23d39c95e207@n6g2000vbz.googlegroups.com>
	<316AF553-8E56-4F72-8944-DA76471A5396@rabbitmq.com>
	<7b382529-4009-45ca-9e3f-1073ee2d0de7@d10g2000vbk.googlegroups.com>
	<4EF38976.7060009@rabbitmq.com>
	<CAHZAEpenHT-n-=3Eux4G50JBHLeLfuem6rOogxt0Rb0Mejb8hw@mail.gmail.com>
	<4EF39246.8020403@rabbitmq.com>
Message-ID: <769f6ef8-8c90-4d80-9bc9-8779ad0fa0ba@n6g2000vbg.googlegroups.com>

This sounds brutal and exactly what I was afraid of.

Andy

On Dec 22, 3:25?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 22/12/11 20:02, Jason J. W. Williams wrote:
>
> > I think a timeout would be a useful setting on the client side. If
> > Rabbit backs up enough, you don't want your frontend just appearing to
> > hang to the frontend's client. At some point it should raise a timeout
> > exception you can handle and give feedback to the app's client.
>
> There's a bug open to address that. Alas it's been open for >1 year and
> is a major piece of work across all our clients. So I doubt we will work
> on it any time soon.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alex.gronholm at nextday.fi  Fri Dec 23 05:00:33 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Thu, 22 Dec 2011 21:00:33 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to create a user through the management
	HTTP API
Message-ID: <31580502.1529.1324616433753.JavaMail.geo-discussion-forums@yqkb10>

curl -i -u redacted:redacted -H 'content-type:application/json' -XPUT 
-d'{"password": "pass"}' http://localhost:55672/api/users/testuser
HTTP/1.1 400 Bad Request
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Fri, 23 Dec 2011 04:56:55 GMT
Content-Type: application/json
Content-Length: 60

{"error":"bad_request","reason":["not_boolean","undefined"]}

GET type queries work fine. RabbitMQ 2.7.1. What am I doing wrong?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111222/10172687/attachment.htm>

From vbernard42 at gmail.com  Fri Dec 23 08:53:16 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Fri, 23 Dec 2011 00:53:16 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to create a user through the
	management HTTP API
In-Reply-To: <31580502.1529.1324616433753.JavaMail.geo-discussion-forums@yqkb10>
References: <31580502.1529.1324616433753.JavaMail.geo-discussion-forums@yqkb10>
Message-ID: <36e237a0-3a33-49f1-b18d-1c9a7209c54d@p13g2000yqd.googlegroups.com>

Hi,

You need to set the "tags" key in your query. You can leave it empty
if you don't want any tags, e.g. -d'{"password": "pass","tags":""}'

Cheers,

Valentin.

On 23 d?c, 06:00, Alex Gr?nholm <alex.gronh... at nextday.fi> wrote:
> curl -i -u redacted:redacted -H 'content-type:application/json' -XPUT
> -d'{"password": "pass"}'http://localhost:55672/api/users/testuser
> HTTP/1.1 400 Bad Request
> Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
> Date: Fri, 23 Dec 2011 04:56:55 GMT
> Content-Type: application/json
> Content-Length: 60
>
> {"error":"bad_request","reason":["not_boolean","undefined"]}
>
> GET type queries work fine. RabbitMQ 2.7.1. What am I doing wrong?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pkelly at gmail.com  Fri Dec 23 12:31:23 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Fri, 23 Dec 2011 12:31:23 +0000
Subject: [rabbitmq-discuss] mod_shovel vhost names
Message-ID: <CAEWH9M8Jx_iCjsWB56O6XUC_xUSBQXEcBmLQVqoqHabQEmEccA@mail.gmail.com>

Hi

I have been setting up mod_shovel today and am having some problems because
I have my vhosts named with a / e.g. /vhost1 as opposed to vhost1

mod_shovel doesn't seem to like this, and I can't get it to connect to the
vhost with a / in the name.

Are there any tricks to get round this?

Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111223/badd4dea/attachment.htm>

From alex.gronholm at nextday.fi  Fri Dec 23 13:03:34 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Fri, 23 Dec 2011 05:03:34 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to create a user through the
 management HTTP API
In-Reply-To: <36e237a0-3a33-49f1-b18d-1c9a7209c54d@p13g2000yqd.googlegroups.com>
References: <31580502.1529.1324616433753.JavaMail.geo-discussion-forums@yqkb10>
	<36e237a0-3a33-49f1-b18d-1c9a7209c54d@p13g2000yqd.googlegroups.com>
Message-ID: <5086275.29.1324645414436.JavaMail.geo-discussion-forums@yqlp13>

I feel so stupid :) I thought I tried adding the tags key already. But now 
it worked. Thanks :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111223/ac12bf21/attachment.htm>

From matthias at rabbitmq.com  Fri Dec 23 13:40:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Dec 2011 13:40:05 +0000
Subject: [rabbitmq-discuss] mod_shovel vhost names
In-Reply-To: <CAEWH9M8Jx_iCjsWB56O6XUC_xUSBQXEcBmLQVqoqHabQEmEccA@mail.gmail.com>
References: <CAEWH9M8Jx_iCjsWB56O6XUC_xUSBQXEcBmLQVqoqHabQEmEccA@mail.gmail.com>
Message-ID: <4EF484B5.5050301@rabbitmq.com>

Pete,

On 23/12/11 12:31, Pete Kelly wrote:
> I have been setting up mod_shovel today

I am assuming you mean the rabbitmq-shovel plug-in.

> I can't get it to connect to the vhost with a / in the name.
>
> Are there any tricks to get round this?

See http://www.rabbitmq.com/uri-spec.html, in particular the examples at 
the end, which include vhosts containing '/'.

Regards,

Matthias.

From pkelly at gmail.com  Fri Dec 23 13:51:33 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Fri, 23 Dec 2011 13:51:33 +0000
Subject: [rabbitmq-discuss] mod_shovel vhost names
In-Reply-To: <4EF484B5.5050301@rabbitmq.com>
References: <CAEWH9M8Jx_iCjsWB56O6XUC_xUSBQXEcBmLQVqoqHabQEmEccA@mail.gmail.com>
	<4EF484B5.5050301@rabbitmq.com>
Message-ID: <CAEWH9M9r-2PZHTXsyoyrE_S-V5mY-RiHTiTZU-AYAxkRuejt_w@mail.gmail.com>

Hooray, it worked.

Thanks, this has made my Christmas eve-eve :)

Pete

On 23 December 2011 13:40, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Pete,
>
>
> On 23/12/11 12:31, Pete Kelly wrote:
>
>> I have been setting up mod_shovel today
>>
>
> I am assuming you mean the rabbitmq-shovel plug-in.
>
>
>  I can't get it to connect to the vhost with a / in the name.
>>
>> Are there any tricks to get round this?
>>
>
> See http://www.rabbitmq.com/uri-**spec.html<http://www.rabbitmq.com/uri-spec.html>,
> in particular the examples at the end, which include vhosts containing '/'.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111223/e3a167ef/attachment.htm>

From mexxik at gmail.com  Fri Dec 23 15:05:20 2011
From: mexxik at gmail.com (mexxik)
Date: Fri, 23 Dec 2011 07:05:20 -0800 (PST)
Subject: [rabbitmq-discuss]  Building RabbitMQ for AMQP 1.0 (?)
Message-ID: <33029721.post@talk.nabble.com>


Hello!

I know, that AMQP 1.0 is not released yet, and Rabbit's plugin for that
protocol version is very experimental, but still: have anyone tried to build
this plugin?

The description says, that it requires bug23749 of rabbitmq-server and
rabbitmq-codegen, but even after using those branches, I wasn't able to
successfully build the plugin in.

The compiler throws an Error 1:
src/rabbit_amqp1_0_outgoing_link.erl:36: record 'basic.credit' undefined
src/rabbit_amqp1_0_outgoing_link.erl:73: record 'basic.credit_state'
undefined
src/rabbit_amqp1_0_outgoing_link.erl:78: variable 'Available0' is unbound
src/rabbit_amqp1_0_outgoing_link.erl:89: variable 'Count' is unbound
src/rabbit_amqp1_0_outgoing_link.erl:90: variable 'LinkCredit' is unbound
src/rabbit_amqp1_0_outgoing_link.erl:92: variable 'Drain' is unbound
src/rabbit_amqp1_0_outgoing_link.erl:108: record 'basic.credit_ok' undefined
src/rabbit_amqp1_0_outgoing_link.erl:110: record 'basic.credit' undefined
src/rabbit_amqp1_0_outgoing_link.erl:114: variable 'Available' is unbound
src/rabbit_amqp1_0_outgoing_link.erl:32: Warning: variable 'Count' is unused
src/rabbit_amqp1_0_outgoing_link.erl:107: Warning: variable 'CTag' is unused

I "don't speak" Erlang, but looks like something is missing in the
rabbitmq-amqp1.0 plugin source code.

... I am just eager to try AMQP 1.0 now, even in experimental mode. :)

Thanks
Max
-- 
View this message in context: http://old.nabble.com/Building-RabbitMQ-for-AMQP-1.0-%28-%29-tp33029721p33029721.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Sat Dec 24 00:19:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 24 Dec 2011 00:19:27 +0000
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying
 queues	or exchanges
In-Reply-To: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
References: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
Message-ID: <4EF51A8F.8030409@rabbitmq.com>

Brendan,

On 21/12/11 15:38, Brendan Hay wrote:
> I have a problem with the rabbitmq-management plugin where it doesn't
> display any queue or exchange information. ie. even the /api calls
> return an empty list, yet rabbitmqctl list_queues and its'
> counterparts correctly show queue information.
>
> rabbitmq, management, management-agent, mochiweb all show version
> 2.7.0 and the erlang version is R14B04
>
> Any ideas?

Does the overview page work ok? Are there any errors in the logs? Could 
be a permission problem - see 
http://www.rabbitmq.com/management.html#permissions for the permissions 
model employed by the management plug-in.

You may want to upgrade to 2.7.1, which fixed a number of bugs in the 
management plug-in and elsewhere.


Regards,

Matthias.

From mattswe at gmail.com  Sat Dec 24 00:35:30 2011
From: mattswe at gmail.com (Matt Sweeney)
Date: Fri, 23 Dec 2011 16:35:30 -0800 (PST)
Subject: [rabbitmq-discuss] maximum number of amqp connections to a
 rabbitmq broker
In-Reply-To: <7496719.449.1324097892765.JavaMail.geo-discussion-forums@prol32>
References: <BANLkTi=5M8a0PUrmaaWJyTE56BOKMVzBrA@mail.gmail.com>	<20110530141459.GA4152@wellquite.org>	<8327821.982.1323455844440.JavaMail.geo-discussion-forums@prie17>	<4EE72E22.5090708@rabbitmq.com>
	<23865799.32.1323911010541.JavaMail.geo-discussion-forums@prj1>
	<4EEB433D.3060405@rabbitmq.com>
	<7496719.449.1324097892765.JavaMail.geo-discussion-forums@prol32>
Message-ID: <19430576.358.1324686930686.JavaMail.geo-discussion-forums@preg20>

I fixed this by turning on heartbeats!

That way, if a connection is interrupted, the server handles shutting it 
down. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111223/c391cbf9/attachment.htm>

From brendan.g.hay at gmail.com  Sat Dec 24 10:49:45 2011
From: brendan.g.hay at gmail.com (Brendan Hay)
Date: Sat, 24 Dec 2011 11:49:45 +0100
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying
	queues	or exchanges
In-Reply-To: <4EF51A8F.8030409@rabbitmq.com>
References: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
	<4EF51A8F.8030409@rabbitmq.com>
Message-ID: <4ef5ae4a.e4030e0a.7250.ffff9035@mx.google.com>


Overview worked fine, permissions and tags were all set correctly for the user. 
I ended up having to restart rabbit to get the queues/exchanges showing up correctly. 

Thanks,
Brendan

On 24/12/2011, at 1:19 AM, Matthias Radestock wrote:

> Brendan,
> 
> On 21/12/11 15:38, Brendan Hay wrote:
>> I have a problem with the rabbitmq-management plugin where it doesn't
>> display any queue or exchange information. ie. even the /api calls
>> return an empty list, yet rabbitmqctl list_queues and its'
>> counterparts correctly show queue information.
>> 
>> rabbitmq, management, management-agent, mochiweb all show version
>> 2.7.0 and the erlang version is R14B04
>> 
>> Any ideas?
> 
> Does the overview page work ok? Are there any errors in the logs? Could be a permission problem - see http://www.rabbitmq.com/management.html#permissions for the permissions model employed by the management plug-in.
> 
> You may want to upgrade to 2.7.1, which fixed a number of bugs in the management plug-in and elsewhere.
> 
> 
> Regards,
> 
> Matthias.


From matthias at rabbitmq.com  Sat Dec 24 10:59:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 24 Dec 2011 10:59:34 +0000
Subject: [rabbitmq-discuss] rabbitmq-management plugin not displaying
 queues	or exchanges
In-Reply-To: <4ef5ae4a.e4030e0a.7250.ffff9035@mx.google.com>
References: <C941A037-84B0-43C0-87D2-9FB01F7ECC8C@gmail.com>
	<4EF51A8F.8030409@rabbitmq.com>
	<4ef5ae4a.e4030e0a.7250.ffff9035@mx.google.com>
Message-ID: <4EF5B096.1040607@rabbitmq.com>

Brendan,

On 24/12/11 10:49, Brendan Hay wrote:
> Overview worked fine, permissions and tags were all set correctly for the user.
> I ended up having to restart rabbit to get the queues/exchanges showing up correctly.

Glad you got it working. I'd still recommend upgrading to 2.7.1.

Regards,

Matthias

From james.r.carr at gmail.com  Mon Dec 26 00:46:19 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 25 Dec 2011 18:46:19 -0600
Subject: [rabbitmq-discuss] Ideas on Local Buffering when Broker Is Down?
Message-ID: <CAJreXKBCoMaX-Y-vCS=AVu3mxicNWbuYKwgex3oDfs-jnMNf1w@mail.gmail.com>

So one of the things I really have to commit to at work is come up with
some kind of local buffering solution when central brokers are down. This
is one hole in the infrastructure that naysayers use against me at work to
convince other devs to use OracleAQ instead of RabbitMQ and it's been
driving me insane (if not only for the excuse that it is okay when OracleAQ
is down because that means the database is down and the public site is down
anyway)! :)

I originally decided to just use local RabbitMQ brokers on each box that
would be publishing with federated exchanges and while this worked great on
the machines I have influence over the other departments refuse to install
RabbitMQ on their servers because their public web servers are already
strapped to capacity. So I'm pretty much stuck with coming up with some
little framework (I'll probably open source it) that I can have developers
just use in their apps. Before I go this route does something like this
already exist in java? In spring-amqp?

My initial idea is to just implement AmqpTemplate from spring-aqmp and have
it push messages into a local ehcache (or some other local cache) whenever
a connection is broken. I'm open to other ideas or solutions, just need
some fool proof way to handle this situation so I can get people to start
using a more enlightened messaging solution.  :)

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111225/f7b76bb3/attachment.htm>

From simone.busoli at gmail.com  Mon Dec 26 01:09:33 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 26 Dec 2011 02:09:33 +0100
Subject: [rabbitmq-discuss] Ideas on Local Buffering when Broker Is Down?
In-Reply-To: <CAJreXKBCoMaX-Y-vCS=AVu3mxicNWbuYKwgex3oDfs-jnMNf1w@mail.gmail.com>
References: <CAJreXKBCoMaX-Y-vCS=AVu3mxicNWbuYKwgex3oDfs-jnMNf1w@mail.gmail.com>
Message-ID: <CAOn7oW_Kc-2=fpdiuzffobWiHMf30YvQDcuyPEWQtijr5p7pHA@mail.gmail.com>

Hi James, I've had to cope with this scenario as well and while I can't say
that I've handled it in the most effective way (I'm keeping an in-memory
queue which is drained while the connection is up and fills-up while the
connection is down) I'm wondering whether implementing a solution which
assumes the existence of another rabbit-like middleware nearer to the
publisher isn't just moving the problem somewhere else while at the same
time making the whole infrastructure much more complex. Is there really a
"best way" to deal with this kind of failures?
On Dec 26, 2011 1:46 AM, "James Carr" <james.r.carr at gmail.com> wrote:

> So one of the things I really have to commit to at work is come up with
> some kind of local buffering solution when central brokers are down. This
> is one hole in the infrastructure that naysayers use against me at work to
> convince other devs to use OracleAQ instead of RabbitMQ and it's been
> driving me insane (if not only for the excuse that it is okay when OracleAQ
> is down because that means the database is down and the public site is down
> anyway)! :)
>
> I originally decided to just use local RabbitMQ brokers on each box that
> would be publishing with federated exchanges and while this worked great on
> the machines I have influence over the other departments refuse to install
> RabbitMQ on their servers because their public web servers are already
> strapped to capacity. So I'm pretty much stuck with coming up with some
> little framework (I'll probably open source it) that I can have developers
> just use in their apps. Before I go this route does something like this
> already exist in java? In spring-amqp?
>
> My initial idea is to just implement AmqpTemplate from spring-aqmp and
> have it push messages into a local ehcache (or some other local cache)
> whenever a connection is broken. I'm open to other ideas or solutions, just
> need some fool proof way to handle this situation so I can get people to
> start using a more enlightened messaging solution.  :)
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111226/ffb999db/attachment.htm>

From james.r.carr at gmail.com  Mon Dec 26 05:31:21 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 25 Dec 2011 23:31:21 -0600
Subject: [rabbitmq-discuss] correct configuration for large message volume?
Message-ID: <CAJreXKBFoVtYW+mK+msbsLg_r4CV1FUV0vkoL-mShStJAQy7SQ@mail.gmail.com>

Hi All,

I've been doing some experiments with rabbit over the holidays and one
thing that I run into that always bugs me is if I get a queue filled up
with >  1 million messages being published continuously (but not consumed)
on my laptop I usually wind up with rabbitMQ getting into an "odd" state.
By odd I mean:

* management console lists "?" for the number of messages in the queue
* calling rabbitmq-server stop doesn't stop the broker (I wind up having to
do a hard kill -9).
* CPU usage usually sticks around 100% (even long after the producer has
been shut down)
* Memory high watermark is not met (not even close

I'm sure that I'm either doing something stupid or missing "a correct way
to configure things" so I'd like any suggestions on what I could do here.

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111225/53cb1363/attachment.htm>

From matthias at rabbitmq.com  Mon Dec 26 07:22:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Dec 2011 07:22:52 +0000
Subject: [rabbitmq-discuss] correct configuration for large message
	volume?
In-Reply-To: <CAJreXKBFoVtYW+mK+msbsLg_r4CV1FUV0vkoL-mShStJAQy7SQ@mail.gmail.com>
References: <CAJreXKBFoVtYW+mK+msbsLg_r4CV1FUV0vkoL-mShStJAQy7SQ@mail.gmail.com>
Message-ID: <4EF820CC.1020100@rabbitmq.com>

James,

On 26/12/11 05:31, James Carr wrote:
> I've been doing some experiments with rabbit over the holidays and one
> thing that I run into that always bugs me is if I get a queue filled up
> with >  1 million messages being published continuously (but not
> consumed) on my laptop I usually wind up with rabbitMQ getting into an
> "odd" state.

OS?

RabbitMQ version? Make sure it's 2.7.1.

Erlang version? Make sure it's R15B, particularly if you are on Windows.

> By odd I mean:
> * management console lists "?" for the number of messages in the queue

That is strange indeed.

> * calling rabbitmq-server stop doesn't stop the broker (I wind up having
> to do a hard kill -9).

The most likely reason is that the broker is "catching up", i.e. 
processing messages that where hitherto held in internal buffers.

Does 'rabbitmqctl status' still work?

> * CPU usage usually sticks around 100% (even long after the producer has
> been shut down)

Ditto.

> * Memory high watermark is not met (not even close

The HWM is set to 40% of available RAM by default since the broker can 
easily go over that by some margin. Does it actually exceed 100% in your 
case?


Matthias.

From ranmizrachi at gmail.com  Tue Dec 27 14:20:36 2011
From: ranmizrachi at gmail.com (ran mizrachi)
Date: Tue, 27 Dec 2011 16:20:36 +0200
Subject: [rabbitmq-discuss] RabbitMQ Cluster - Please Help !
Message-ID: <CAOQFjYPBZDJwEk4OHepdSoz2=Y_dkrsvnRimuz_XcB6Jge3iUw@mail.gmail.com>

My two nodes cluster in production are breaking with these error messages:

=ERROR REPORT==== 23-Dec-2011::04:21:34 ===
** Node rabbit at rabbitmq02 not responding **
** Removing (timedout) connection **

=INFO REPORT==== 23-Dec-2011::04:21:35 ===
node rabbit at rabbitmq02 lost 'rabbit'

=ERROR REPORT==== 23-Dec-2011::04:21:49 ===
Mnesia(rabbit at rabbitmq01): ** ERROR ** mnesia_event got
{inconsistent_database, running_partitioned_network, rabbit at rabbitmq02}


I tried to simulate the problem by killing the connection between the two
nodes using "tcpkill",
the cluster has disconnected,and surprisingly the two nodes are not trying
to reconnect !

When the cluster breaks, haproxy load balancer still marks both nodes as
active and send request to both of them,
although they are not in a cluster.

My Questions:

1. If the nodes are configured to work as a cluster, when I get a network
failure , why aren't they trying to reconnect after ?

2. How can I identify broken cluster and automatic shutdown one of the
nodes ?
(I have consistency problems when working with the two nodes separately)


Urgent, please help !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111227/3e5bc5ee/attachment.htm>

From jruiz at johnruiz.com  Tue Dec 27 18:16:00 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 27 Dec 2011 10:16:00 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the .NET
	client
Message-ID: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>

Hi All,

I've successfully followed the SSL tutorial and gotten my .NET client
to connect, send, and receive messages over SSL.  See my blog for the
code: http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbitmq.html.

As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
and then re-installed the Windows Service.  Then I re-ran the code I
have listed in my blog -- with the addition of a Console.ReadLine() at
the end of my using statements so I can see the connection details in
the management web app.

I am still connecting as guest.  What do I need to do in order to
connect as the CN of the Subject on my certificate?

Thanks!
~ jR

From asaf at binkfs.com  Mon Dec 26 11:24:43 2011
From: asaf at binkfs.com (asafdav)
Date: Mon, 26 Dec 2011 03:24:43 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmqadmin fails when trying to get message
	from a queue
Message-ID: <627b6699-0bb3-422e-9367-4739fbeb7a59@32g2000yqp.googlegroups.com>

Hi guys, I'm using rabbitmqadmin for unit testing purpose. The scripts
fails when I try to fetch messages from queue.
For example, the following command:
rabbitmqadmin get queue=test requeue=false

returns this error message
*** {u'key_missing': u'encoding'}

In case encoding parameter is provided, for example "rabbitmqadmin get
queue=test requeue=false encoding=base64" the script returns this
message: ERROR: Argument "encoding" not recognised.

I've figured out how to solve this problem, but I don't now where
should I post the patch.
All you have to do is to add encoding as encoding as manadatory
parameter for rabbitmqadmin get command.
I've change line 90
from:
    'get':     {'mandatory': ['queue'],
to:
    'get':     {'mandatory': ['queue', 'encoding'],

Cheers
Asaf

From jruiz at johnruiz.com  Tue Dec 27 21:22:16 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Tue, 27 Dec 2011 13:22:16 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
	.NET client
In-Reply-To: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
Message-ID: <4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>

I have figured it out.  There were two issues.

1. Add the external mechanism factory to your connection factory's
auth mechanisms
    i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
ExternalMechanismFactory() };

2. Configure the server's auth_mechanisms variable in your
rabbitmq.config.
    Here is my complete rabbitmq.config:

[
  {rabbit, [
     {auth_mechanisms,['EXTERNAL']},
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
                    {certfile,"C:/Path/To/Your/cert.pem"},
                    {keyfile,"C:/Path/To/Your/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]}
].

On Dec 27, 1:16?pm, John Ruiz <jr... at johnruiz.com> wrote:
> Hi All,
>
> I've successfully followed the SSL tutorial and gotten my .NET client
> to connect, send, and receive messages over SSL. ?See my blog for the
> code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>
> As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
> and then re-installed the Windows Service. ?Then I re-ran the code I
> have listed in my blog -- with the addition of a Console.ReadLine() at
> the end of my using statements so I can see the connection details in
> the management web app.
>
> I am still connecting as guest. ?What do I need to do in order to
> connect as the CN of the Subject on my certificate?
>
> Thanks!
> ~ jR
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dhaneesh at hifx.co.in  Wed Dec 28 06:58:17 2011
From: dhaneesh at hifx.co.in (Dhaneesh Radhakrishnan)
Date: Wed, 28 Dec 2011 12:28:17 +0530
Subject: [rabbitmq-discuss] Priority Queue
Message-ID: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>

Hi

We are implementing RabbitMQ queues for an application that has
to asynchronously handle a number of jobs

we need to know whether rabbitmq support the priority queue

Any pointers for more information about it would be highly appreciated.

Thanks and Regards
Dhaneesh R
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/f5bec924/attachment.htm>

From pcdinh at gmail.com  Wed Dec 28 07:55:48 2011
From: pcdinh at gmail.com (Dinh)
Date: Wed, 28 Dec 2011 14:55:48 +0700
Subject: [rabbitmq-discuss] Priority Queue
In-Reply-To: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
References: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
Message-ID: <CAAWGy5yv4i7J9erW6qfa0=AMGAzBd+cnw2bLuFSfHO7ADT4Xqg@mail.gmail.com>

I haven't read any document that tells about priority queue support in
RabbitMQ. In my application design, I use separate queue for each priority

On Wed, Dec 28, 2011 at 1:58 PM, Dhaneesh Radhakrishnan <dhaneesh at hifx.co.in
> wrote:

> Hi
>
> We are implementing RabbitMQ queues for an application that has
> to asynchronously handle a number of jobs
>
> we need to know whether rabbitmq support the priority queue
>
> Any pointers for more information about it would be highly appreciated.
>
> Thanks and Regards
> Dhaneesh R
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Spica Framework: http://code.google.com/p/spica
http://www.twitter.com/pcdinh
http://groups.google.com/group/phpvietnam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/8f7b884e/attachment.htm>

From matthew at rabbitmq.com  Wed Dec 28 10:56:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 28 Dec 2011 10:56:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ Cluster - Please Help !
In-Reply-To: <CAOQFjYPBZDJwEk4OHepdSoz2=Y_dkrsvnRimuz_XcB6Jge3iUw@mail.gmail.com>
References: <CAOQFjYPBZDJwEk4OHepdSoz2=Y_dkrsvnRimuz_XcB6Jge3iUw@mail.gmail.com>
Message-ID: <20111228105655.GA2863@rabbitmq.com>

Hi,

On Tue, Dec 27, 2011 at 04:20:36PM +0200, ran mizrachi wrote:
> My two nodes cluster in production are breaking with these error messages:
> 
> =ERROR REPORT==== 23-Dec-2011::04:21:34 ===
> ** Node rabbit at rabbitmq02 not responding **
> ** Removing (timedout) connection **
> 
> =INFO REPORT==== 23-Dec-2011::04:21:35 ===
> node rabbit at rabbitmq02 lost 'rabbit'

Ok, you might like to experiment by increasing the net tick time which
is the period after which erlang assumes the cluster has failed.
Something like SERVER_START_ARGS="-kernel net_ticktime 500" in your
rabbitmq-env.conf file might help.

> I tried to simulate the problem by killing the connection between the two
> nodes using "tcpkill",
> the cluster has disconnected,and surprisingly the two nodes are not trying
> to reconnect !

That's not surprising. Rabbit does not try to heal clusters - at least
not automatically.

The fact that the cluster is breaking up suggests something else is
wrong - a networking issue or some such which is causing packet loss.

> 1. If the nodes are configured to work as a cluster, when I get a network
> failure , why aren't they trying to reconnect after ?

http://en.wikipedia.org/wiki/CAP_theorem
Rabbit does C and A. Not P. Thus a failure of a node is permanent,
without manual intervention.

> 2. How can I identify broken cluster and automatic shutdown one of the
> nodes ?

Ahh well, assume you have a cluster of N nodes, and a network partion
splits them all apart, and now you have N clusters, each of 1 node.
Which cluster is the "right" cluster? In general, this is a very hard
problem - it's not always right to just take the biggest remaining
cluster, even if there is one. It's often very application specific too.
You'd probably be best off looking at things like Pacemaker for this
stuff seeing as it's really built to help solve these sorts of problems
and supports STONITH and other such devices.

Matthew

From matthew at rabbitmq.com  Wed Dec 28 11:02:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 28 Dec 2011 11:02:56 +0000
Subject: [rabbitmq-discuss] Priority Queue
In-Reply-To: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
References: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
Message-ID: <20111228110255.GB2863@rabbitmq.com>

Hi,

On Wed, Dec 28, 2011 at 12:28:17PM +0530, Dhaneesh Radhakrishnan wrote:
> we need to know whether rabbitmq support the priority queue

Nope, we don't support it. There are various ways to simulate it - eg by
using multiple queues, but it's actually quite fiddly to get right -
whilst you can easily route messages of different priorities to
different queues, getting the consumers to receive messages only from
the "highest" priority queue with available msgs is quite tricky -
especially doing it efficiently.

Work/job queuing with priorities is quite a specialist (though not
uncommon) messaging pattern. If you're not doing high message throughput
then you might find just doing basic.gets down each of the queues works
well enough - and then start again once you get a message and process
it.

Matthew

From dawgtool at aol.com  Wed Dec 28 14:22:55 2011
From: dawgtool at aol.com (DawgTool)
Date: Wed, 28 Dec 2011 09:22:55 -0500
Subject: [rabbitmq-discuss] RabbitMQ Stability Issues with large queue -
	2011-12-28
Message-ID: <6FEDEAFD-03B8-4D55-A4D6-D4F4268E715B@aol.com>

RabbitMQ Stability Issues with large queue - 2011-12-28

Hi All,

I posted in the IRC channel a few nights ago, and they suggested that I bring this to the listserv.
Hopefully can get some suggestions on how to keep my servers from crashing.
Thanks,
-- DawgTool

Cluster Info:
Cluster status of node 'dc001 at rmquat-m01' ...
[{nodes,[{disc,['dc001 at rmquat-m04','dc001 at rmquat-m03','dc001 at rmquat-m02',
                'dc001 at rmquat-m01']}]},
 {running_nodes,['dc001 at rmquat-m04','dc001 at rmquat-m03','dc001 at rmquat-m02',
                 'dc001 at rmquat-m01']}]

Config Info:
==> enabled_plugins <==
[rabbitmq_management,rabbitmq_management_agent,rabbitmq_management_visualiser].

==> rabbitmq.config <==
[
  {rabbit,                    [{vm_memory_high_watermark, 0.6},
                               {collect_statistics_interval, 5000},
                               {hipe_compile, true}
                              ]
  },
  {rabbitmq_management,       [ {http_log_dir, "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
  {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
].

==> rabbitmq-env.conf <==
NODENAME=dc001
BASE=/data/rabbitmq/dc001
MNESIA_BASE=/data/rabbitmq/dc001/mnesia
LOG_BASE=/data/rabbitmq/dc001/log
SERVER_START_ARGS="-smp enable"


IRC:
[17:32] <dawgtool> background. doing some testing on 2.7.0 : 4 servers 2vcpu, 8gb ram, 80gb disc.
[17:32] <dawgtool> cluser is setup all disc, currently one exchange durable fanout
[17:33] <dawgtool> one queue also durable bind to the exchange.
[17:33] <dawgtool> i'm pushing about 5M records, payload is ~500bytes each record
[17:34] <dawgtool> rate is about 14k/s (which seems pretty slow)
[17:35] <dawgtool> but my problem is, I'm testing a case where they consumers are busy or unavailable, so the queues would be filling up.
[17:35] <dawgtool> even after slowing the publish rate to about 4k/s the mirrored queue does not complete on any of the clusters nodes other then master.
[17:37] <dawgtool> memory seems to be the biggest issue here, as the servers will grow passed the high water mark, and eventually crash one at a time.
[17:37] <dawgtool> once they are restarted, most servers in the cluster will have about 200k to 300k of messages in their queue
[17:40] <dawgtool> so question is, why is so much memory being consumed (on disk these records are about 5.5GB) RabbitMQ pushes to 7.9 real, 11.9 virtual (swapping).
[17:40] <dawgtool> why is the queue not stopping the publishers (RAM based clusters seem to stop the publisher until it can be spilled to disk)
[17:41] <dawgtool> Why is mirroring unreliable in this test.
[17:41] <dawgtool> ok, i'm done with the backgroud. =)
[17:41] <dawgtool> lol
[17:42] <antares_> having 300K messages in one queue will result in RAM consumption like this
[17:42] <antares_> 30 queues with 10K is a better option
[17:43] <antares_> I can't say for mirroring but my understanding is that mirroring cannot decrease RAM usage
[17:43] <dawgtool> true, i need to make sure I don't loose any records, so disc with mirror
[17:44] <dawgtool> does performance get that bad after 300k message in a queue?
[17:44] <antares_> this kind of questions is better asked on the rabbitmq-discuss (mailing list)
[17:45] <antares_> the exact number will vary but yes, having queues with excessive # of messages that are not consumed will result in more or less this behavior
[17:45] <dawgtool> yea, just joined the mailing list, I can post it there. was hoping someone had a quick answer. =)
[17:45] <antares_> each queue is backed by one Erlang process and Erlang VM GC releases process memory all at once
[17:46] <dawgtool> even with the -smp set to true?
[17:46] <antares_> so having large amount of messages in your queues impedes that
[17:46] <antares_> dawgtool: I doubt that -smp affects GC behavior
[17:46] <dawgtool> hmmm
[17:47] <antares_> in this regard anyway, because there is still no shared heap
[17:47] <antares_> but rabbitmq team members definitely know more than I do
[17:47] <antares_> and they are all on rabbitmq-discuss
[17:48] <dawgtool> ok, I'll give the mailing list a shot.  300k is going to be hard to live under, one of my current systems is  doing server times that a second. =(
[17:49] <dawgtool> which i was hoping to migrate to a more open system, at least parts of it. =(
[17:49] <antares_> dawgtool: total # of messages is not the point
[17:50] <antares_> the point is max # of messages in one queue
[17:50] <antares_> you can have 10K queues and one app consuming messages from them all
[17:50] <antares_> unless ordering is a serious concern for your case, it will work just as well as 1 queue
[17:50] <dawgtool> yea, understand, but some consumers might crash, and I will get a backlog
[17:51] <dawgtool> I need to make sure the MQ system can handle at least a 30 minute outage
[17:51] <antares_> again, you will have the same problem with just 1 queue
[17:51] <antares_> dawgtool: I see. And not lose anything?
[17:51] <dawgtool> right, =(
[17:51] <antares_> rabbitmq queues can have message TTL
[17:52] <dawgtool> yea, I have TTL on metric collection consumers.. usually 6 seconds.
[17:55] <dawgtool> in production, the idea would be to have two exchanges: input.exchange.fanout, metric.exchange.topic bind to input.exchange.fanout. queue.durable.mirror.prod bind to input.exchange.fanout no ttl, several queue.trans.nomirror.metric[1-x] ttl 6sec.
[17:56] <dawgtool> the input.exchange.fanout will have a second and third queue eventually, which is why there are two exchanges.
[17:57] <dawgtool> but the second and third will have a 30min ttl
[18:01] <dawgtool> anyway, thanks for the info.. I'll shot an email out to the listserv and see if I get any bites. =)
[18:01] <dawgtool> thanks again. =)
[18:01] <antares_> dawgtool: no problem



From videlalvaro at gmail.com  Wed Dec 28 14:40:29 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 28 Dec 2011 15:40:29 +0100
Subject: [rabbitmq-discuss] "How do I...?"
In-Reply-To: <CAM8fPiS=Uivp-hNF1a=mPKnJ7L3RmEcr89x3d4uJdpiG7TgbYQ@mail.gmail.com>
References: <CAM8fPiRpnXiqhFX3ach7W_qhf0uqav9EHZ750X3dOrRHUA-qqA@mail.gmail.com>
	<CACOPnvdQrKd9Ui8kqHQPZ8aX5wFE7j=CZyyi9xGAYsOhusnP5g@mail.gmail.com>
	<CAM8fPiS=Uivp-hNF1a=mPKnJ7L3RmEcr89x3d4uJdpiG7TgbYQ@mail.gmail.com>
Message-ID: <B93CA720-5A3A-4B6C-B447-774FF8057894@gmail.com>

Hi,

I think a nice How Do I? would be a "my-rabbit-is-broken-what-am-i-going-to-do report how to".

Maybe that exists somewhere already? anyway?

Usually someone's rabbit starts behaving in unexpected ways and the person brings a report to this list? then Matthias or any of the rabbit guys goes like:

- Can you send in the logs?
- User sends logs? comments he has a Erlang crash dump? "should I send it also?"
- Yes? please attach that as well.
.... some emails in between ....
- Can you please also send the rabbit status?, and run this and that Erlang Command?
- And so on?

So perhaps a TODO list with:

- Architecture description (Which kind of machine? amount of ram? Erlang Version, OS installed, etc, etc,)
- In/egress 
- Message topology? n of queues, n of exchanges, durability, etc etc. (Somethings might be relevant at first? some others only after the diagnose process has begun).
- Result of erlang/rabbitmqctl commands that could bring interesting information for the diagnosis (I've seen a couple posted to this list).
- Logs and files to attach/upload if possible: rabbit logs, erlang crash dump, etc etc.

Of course this doesn't has to be a bureaucratic thing that if someones doesn't follow then he doesn't have a proper error report, but it has to be an easy to find guide on how to gather information in order to diagnose a misbehaving rabbit.

Cheers,

-Alvaro

On Dec 22, 2011, at 1:31 AM, Tony Garnock-Jones wrote:

> On 21 December 2011 18:34, Alexis Richardson <alexis at rabbitmq.com> wrote:
> The two best people to move this along are both on xmas hols, so
> please bear with us.
> 
> Cool. In the meantime, it'd be great to hear more suggestions from others on the list! (Hint, hint, others on the list!)
> 
> Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/a579a326/attachment.htm>

From dharrigan at gmail.com  Wed Dec 28 16:43:51 2011
From: dharrigan at gmail.com (David Harrigan)
Date: Wed, 28 Dec 2011 16:43:51 +0000
Subject: [rabbitmq-discuss] Tutorial on using RabbitMQ with Camel and
	Varnish.
Message-ID: <CAKdGheMJcTdqicdZvuzLn0ofvs=a+s-yRHe6azrTf90JoSH2HA@mail.gmail.com>

Hi Everyone,

Wanted to give a little promo for a tutorial I've put together about
using RabbitMQ in co-operation with Apache Camel to send Ban messages
to Varnish Cache. Maybe someone might find the information useful and
generate ideas on how they might use RabbitMQ.

Here is the link:

http://dharrigan.com/2011/12/28/banning-urls-from-varnish-using-apache-camel-and-rabbitmq-part-1/

Thank you and I hope you enjoy! :-)

-=david=-

-- 
I prefer encrypted and signed messages. KeyID: B20A22F9
Fingerprint: 110A F423 3647 54E2 880F ADAD 1C52 85BF B20A 22F9

"It is not usually until you've built and used a version of the
program that you understand the issues well enough to get the design
right." - Rob Pike, Brian Kernighan.

No trees were harmed in the sending of this message, however, a number
of electrons were inconvenienced.

From srdan at burtcorp.com  Wed Dec 28 17:49:52 2011
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Wed, 28 Dec 2011 18:49:52 +0100
Subject: [rabbitmq-discuss] Performance on ec2
Message-ID: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>

Hi

We've been running rabbitmq for some time now in production and we are generally very happy with the way it's performing. As it happens we're about to start scaling our current mq setup violently, going from today's stable throughput of about 2500 messages per second to roughly 20 times that much, in the first step. Optimally, we wouldn't like to stop until we hit 100 000/s. [*1]

Now. Our servers live in the amazon cloud, our messages are in the order of 800 bytes, we use multiple mq servers in a cluster. At the moment we publish messages as durable, but we are optimally aiming to get them in as high availability with (at least) 4 ec2 instances in two different availability zones.

So... I did some tests. Testing was performed on 
	*my macbook pro 13, (2.7.0 R14B04)
	*2 x1.large instance (2core 8-ish GB) (2.6.1 R14B02 | 2.6.32-309-ec2 #18-Ubuntu SMP) and 
	*2 c1.xlarge (8 cores, 8-ish GB) (2.7.0 R14B02 | 2.6.35.14-103.47.amzn1.x86_64 #1 SMP). 

Here are the graphs. http://goo.gl/z3tgG . Everyone loves graphs. The rabbitmq server versions were 2.6.1 and 2.7.0. 

The loader process would load (publish if you like) 1M messages at about 800 bytes a piece and route it via a direct exchange using one of 360 routing keys to 24 queues. The drainer process would connect to all the 24 queues and drain messages of it with a prefetch of 500, acking every 200th message (with the multiple ack flag set).

The drain rate is what concerns me the most, so I'm going to focus on that.

This is what I got away with:
	* I can only ever hope for a drain rate of 8000 messages per second - when there's no incoming messages.
	* There's no real difference in using durable message or non-durable.
	* On the ec2 instances, I got only a minor speed increase when moving from 2 core machines to 8 core machines.
	* No real difference if drain instance connects to all 24 queues, or to a subset. (i.e. 3 instances connecting to queues 0-7, 8-15, 16-23 respectively)
	* No significant speed improvements from 2.6.1 to 2.7.0
	* Loading at max rate (25k/s) pretty much blocks draining (i got <100/s until the first loading instance had finished (!)) 
	* Serving 8000 messages per second causes 500% cpu load on first mq server. No significant load on drainer instances themselves.

My question is as simple as it is complex: 'Is that it?' What can I do to tweak these numbers? Massively. 



Kind reagards,
Srdan
burtcorp.com

[*1] Yes, we are a highly reasonable and humble bunch.


From tonygarnockjones+rabbitmq at gmail.com  Wed Dec 28 18:45:47 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 28 Dec 2011 13:45:47 -0500
Subject: [rabbitmq-discuss] Priority Queue
In-Reply-To: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
References: <CAG=PQNMr8L+k-Jvi4jReh5xHcUds18+qhPk7qzakYGYvijMaKQ@mail.gmail.com>
Message-ID: <CAM8fPiQw=41JhovNoNHwwsOFREDFDrnpsWrbKhOckr5nd21dmg@mail.gmail.com>

Hi Dhaneesh,

I got most-of-the-way through writing up a blog post describing how to do
this before I found I'd been handily beaten to the punch: Doug Barth's post
at
http://dougbarth.github.com/2011/07/01/approximating-priority-with-rabbitmq.htmldoes
a good job of explaining one solid way of achieving basic message
prioritisation.

The key insight is to *make sure higher-priority messages never get stuck
behind lower-priority messages*. This manifests in a few ways:

   - the creation of multiple queues, avoiding getting stuck behind
   low-priority messages in a single queue
   - the creation of multiple channels (or even connections!), avoiding
   getting stuck behind messages travelling on a single TCP link
   - the creation of multiple in-memory queue objects on the client side,
   avoiding gettings stuck behind messages in a single in-memory queue object
   - careful attention to the approach taken to removing messages from the
   in-memory queues: every time a message is needed, check the
   highest-priority queue first.

Basically, provide ways for messages to overtake each other as required,
and then always check the fast-path first.

Regards,
  Tony


On 28 December 2011 01:58, Dhaneesh Radhakrishnan <dhaneesh at hifx.co.in>wrote:

> Hi
>
> We are implementing RabbitMQ queues for an application that has
> to asynchronously handle a number of jobs
>
> we need to know whether rabbitmq support the priority queue
>
> Any pointers for more information about it would be highly appreciated.
>
> Thanks and Regards
> Dhaneesh R
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/647dfb6f/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Wed Dec 28 18:48:42 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 28 Dec 2011 13:48:42 -0500
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
Message-ID: <CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>

On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:

> My question is as simple as it is complex: 'Is that it?' What can I do to
> tweak these numbers? Massively.
>

Is this a transient-messaging use case (RabbitMQ as router, not relying
particularly on disk storage), or a persistent-messaging use case (where
you die in flames if a single message is dropped), or somewhere in-between?

-- Tony
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/a0004d04/attachment.htm>

From dmitry.maven at gmail.com  Wed Dec 28 19:41:31 2011
From: dmitry.maven at gmail.com (Dmitry Beransky)
Date: Wed, 28 Dec 2011 11:41:31 -0800
Subject: [rabbitmq-discuss] inspecting messages
Message-ID: <CAFcBufOzaCmKBXnz2hkTt3zFQ7GWxCc-cEKrMrZJpWdLWAjaNA@mail.gmail.com>

Hi,

Is there a way to inspect individual messages in a queue for content
either with a tool or via API?


Thanks
Dmitry

From srdan at burtcorp.com  Wed Dec 28 21:05:01 2011
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Wed, 28 Dec 2011 22:05:01 +0100
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
Message-ID: <29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>


On Dec 28, 2011, at 19:48 , Tony Garnock-Jones wrote:

> On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:
> My question is as simple as it is complex: 'Is that it?' What can I do to tweak these numbers? Massively.
> 
> Is this a transient-messaging use case (RabbitMQ as router, not relying particularly on disk storage), or a persistent-messaging use case (where you die in flames if a single message is dropped), or somewhere in-between?

Well, it is transient in so fact that we use it to distribute messages to a large number of workers. In that way it is a router. But it also functions as a buffer. If we for instance update the workers we like to be able to stop and restart them without throwing messages away. 

Each individual message is not that important in itself. And if we loose a larger amount of messages, we can re-queue the affected blocks. We're big on idempotence and can cut ourselves some slack if we need to.

That said, once you get to sending thousands of messages per second and the system goes all fishy on you for an indeterminate length of time, the re-queueing becomes? inconvenient. Inconvenient to the degree that it for most practical purposes stops being an option and you become prepared to 'invest' yourself away from those problems if at all possible.


//S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111228/d8058fe1/attachment.htm>

From dawgtool at aol.com  Wed Dec 28 22:20:20 2011
From: dawgtool at aol.com (DawgTool)
Date: Wed, 28 Dec 2011 17:20:20 -0500
Subject: [rabbitmq-discuss] RabbitMQ Stability Issues with large queue -
	2011-12-28
In-Reply-To: <6FEDEAFD-03B8-4D55-A4D6-D4F4268E715B@aol.com>
References: <6FEDEAFD-03B8-4D55-A4D6-D4F4268E715B@aol.com>
Message-ID: <E89E025C-D8EA-497C-9207-3E547338B0D4@aol.com>

Hi All,

Ran the publisher against a single node (removed the clustering) and was able to grab the report just before crashing.
Here are the details:

==> dc001.log <==
=INFO REPORT==== 28-Dec-2011::17:00:00 ===
vm_memory_high_watermark set. Memory used:8662988728 allowed:5153960755

=INFO REPORT==== 28-Dec-2011::17:00:00 ===
    alarm_handler: {set,{{vm_memory_high_watermark,'dc001 at rmquat-m01'},[]}}

=WARNING REPORT==== 28-Dec-2011::17:00:00 ===
Mnesia('dc001 at rmquat-m01'): ** WARNING ** Mnesia is overloaded: {dump_log, time_threshold}




Reporting server status on {{2011,12,28},{22,6,3}}

Status of node 'dc001 at rmquat-m01' ...
[{pid,13173},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.7.0"},
      {rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
      {rabbit,"RabbitMQ","2.7.0"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,8825539568},
      {processes,4061532008},
      {processes_used,4061085200},
      {system,4764007560},
      {atom,1677993},
      {atom_used,1659957},
      {binary,4448013416},
      {code,16452002},
      {ets,295062344}]},
 {vm_memory_high_watermark,0.5999999999767169},
 {vm_memory_limit,5153960755}]

Cluster status of node 'dc001 at rmquat-m01' ...
[{nodes,[{disc,['dc001 at rmquat-m01']}]},{running_nodes,['dc001 at rmquat-m01']}]

Application environment of node 'dc001 at rmquat-m01' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/data/rabbitmq/dc001/log/dc001.log"}},
 {frame_max,131072},
 {hipe_compile,true},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/data/rabbitmq/dc001/log/dc001-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.6}]

Connections:
pid	address	port	peer_address	peer_port	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	channels
<'dc001 at rmquat-m01'.1.4461.3>	192.168.0.100	5672	192.168.0.97	33792	false				PLAIN					{0,8,0}	guest	/	0	131072	[]	79447230	86718	292	4	0	blocked	1

Channels:
pid	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	messages_uncommitted	acks_uncommitted	prefetch_count	client_flow_blocked
<'dc001 at rmquat-m01'.1.4465.3>	<'dc001 at rmquat-m01'.1.4461.3>	1	guest	/	false	false	0	0	0	0	0	0	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	slave_pids	synchronised_slave_pids	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<'dc001 at rmquat-m01'.1.9112.0>	dc.data:durable:all	true	false	[]						4589172	0	4589172	0	4041816264	[{q1,0}, {q2,0}, {delta,{delta,2667892,1921280,4589172}}, {q3,132544}, {q4,2535348}, {len,4589172}, {pending_acks,0}, {target_ram_count,0}, {ram_msg_count,2535348}, {ram_ack_count,0}, {next_seq_id,4589172}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
dc.data:fanout	fanout	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	dc.data:durable:all	queue	dc.data:durable:all	[]
dc.data:fanout	exchange	dc.data:durable:all	queue		[]

Consumers on /:

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.




On Dec 28, 2011, at 9:22 AM, DawgTool wrote:

> RabbitMQ Stability Issues with large queue - 2011-12-28
> 
> Hi All,
> 
> I posted in the IRC channel a few nights ago, and they suggested that I bring this to the listserv.
> Hopefully can get some suggestions on how to keep my servers from crashing.
> Thanks,
> -- DawgTool
> 
> Cluster Info:
> Cluster status of node 'dc001 at rmquat-m01' ...
> [{nodes,[{disc,['dc001 at rmquat-m04','dc001 at rmquat-m03','dc001 at rmquat-m02',
>                'dc001 at rmquat-m01']}]},
> {running_nodes,['dc001 at rmquat-m04','dc001 at rmquat-m03','dc001 at rmquat-m02',
>                 'dc001 at rmquat-m01']}]
> 
> Config Info:
> ==> enabled_plugins <==
> [rabbitmq_management,rabbitmq_management_agent,rabbitmq_management_visualiser].
> 
> ==> rabbitmq.config <==
> [
>  {rabbit,                    [{vm_memory_high_watermark, 0.6},
>                               {collect_statistics_interval, 5000},
>                               {hipe_compile, true}
>                              ]
>  },
>  {rabbitmq_management,       [ {http_log_dir, "/data/rabbitmq/dc001/rabbit-mgmt"} ] },
>  {rabbitmq_management_agent, [ {force_fine_statistics, true} ] }
> ].
> 
> ==> rabbitmq-env.conf <==
> NODENAME=dc001
> BASE=/data/rabbitmq/dc001
> MNESIA_BASE=/data/rabbitmq/dc001/mnesia
> LOG_BASE=/data/rabbitmq/dc001/log
> SERVER_START_ARGS="-smp enable"
> 
> 
> IRC:
> [17:32] <dawgtool> background. doing some testing on 2.7.0 : 4 servers 2vcpu, 8gb ram, 80gb disc.
> [17:32] <dawgtool> cluser is setup all disc, currently one exchange durable fanout
> [17:33] <dawgtool> one queue also durable bind to the exchange.
> [17:33] <dawgtool> i'm pushing about 5M records, payload is ~500bytes each record
> [17:34] <dawgtool> rate is about 14k/s (which seems pretty slow)
> [17:35] <dawgtool> but my problem is, I'm testing a case where they consumers are busy or unavailable, so the queues would be filling up.
> [17:35] <dawgtool> even after slowing the publish rate to about 4k/s the mirrored queue does not complete on any of the clusters nodes other then master.
> [17:37] <dawgtool> memory seems to be the biggest issue here, as the servers will grow passed the high water mark, and eventually crash one at a time.
> [17:37] <dawgtool> once they are restarted, most servers in the cluster will have about 200k to 300k of messages in their queue
> [17:40] <dawgtool> so question is, why is so much memory being consumed (on disk these records are about 5.5GB) RabbitMQ pushes to 7.9 real, 11.9 virtual (swapping).
> [17:40] <dawgtool> why is the queue not stopping the publishers (RAM based clusters seem to stop the publisher until it can be spilled to disk)
> [17:41] <dawgtool> Why is mirroring unreliable in this test.
> [17:41] <dawgtool> ok, i'm done with the backgroud. =)
> [17:41] <dawgtool> lol
> [17:42] <antares_> having 300K messages in one queue will result in RAM consumption like this
> [17:42] <antares_> 30 queues with 10K is a better option
> [17:43] <antares_> I can't say for mirroring but my understanding is that mirroring cannot decrease RAM usage
> [17:43] <dawgtool> true, i need to make sure I don't loose any records, so disc with mirror
> [17:44] <dawgtool> does performance get that bad after 300k message in a queue?
> [17:44] <antares_> this kind of questions is better asked on the rabbitmq-discuss (mailing list)
> [17:45] <antares_> the exact number will vary but yes, having queues with excessive # of messages that are not consumed will result in more or less this behavior
> [17:45] <dawgtool> yea, just joined the mailing list, I can post it there. was hoping someone had a quick answer. =)
> [17:45] <antares_> each queue is backed by one Erlang process and Erlang VM GC releases process memory all at once
> [17:46] <dawgtool> even with the -smp set to true?
> [17:46] <antares_> so having large amount of messages in your queues impedes that
> [17:46] <antares_> dawgtool: I doubt that -smp affects GC behavior
> [17:46] <dawgtool> hmmm
> [17:47] <antares_> in this regard anyway, because there is still no shared heap
> [17:47] <antares_> but rabbitmq team members definitely know more than I do
> [17:47] <antares_> and they are all on rabbitmq-discuss
> [17:48] <dawgtool> ok, I'll give the mailing list a shot.  300k is going to be hard to live under, one of my current systems is  doing server times that a second. =(
> [17:49] <dawgtool> which i was hoping to migrate to a more open system, at least parts of it. =(
> [17:49] <antares_> dawgtool: total # of messages is not the point
> [17:50] <antares_> the point is max # of messages in one queue
> [17:50] <antares_> you can have 10K queues and one app consuming messages from them all
> [17:50] <antares_> unless ordering is a serious concern for your case, it will work just as well as 1 queue
> [17:50] <dawgtool> yea, understand, but some consumers might crash, and I will get a backlog
> [17:51] <dawgtool> I need to make sure the MQ system can handle at least a 30 minute outage
> [17:51] <antares_> again, you will have the same problem with just 1 queue
> [17:51] <antares_> dawgtool: I see. And not lose anything?
> [17:51] <dawgtool> right, =(
> [17:51] <antares_> rabbitmq queues can have message TTL
> [17:52] <dawgtool> yea, I have TTL on metric collection consumers.. usually 6 seconds.
> [17:55] <dawgtool> in production, the idea would be to have two exchanges: input.exchange.fanout, metric.exchange.topic bind to input.exchange.fanout. queue.durable.mirror.prod bind to input.exchange.fanout no ttl, several queue.trans.nomirror.metric[1-x] ttl 6sec.
> [17:56] <dawgtool> the input.exchange.fanout will have a second and third queue eventually, which is why there are two exchanges.
> [17:57] <dawgtool> but the second and third will have a 30min ttl
> [18:01] <dawgtool> anyway, thanks for the info.. I'll shot an email out to the listserv and see if I get any bites. =)
> [18:01] <dawgtool> thanks again. =)
> [18:01] <antares_> dawgtool: no problem
> 
> 


From daverstevens at gmail.com  Wed Dec 28 15:43:13 2011
From: daverstevens at gmail.com (Dave Stevens)
Date: Wed, 28 Dec 2011 07:43:13 -0800 (PST)
Subject: [rabbitmq-discuss] Possible bug when disposing connections in .NET
	client 2.7.0/1
Message-ID: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>

I am getting the following exception when disposing a connection. I
had previously noticed this when going from RabbitMQ Client 2.5.1 to
2.7.0 which caused me to back out the update. I ended up going to
2.7.1 because I thought I found a shutdown issue in my own code. The
exception did not present itself again until I started testing some
reconnect logic. I first noticed it again after simply pulling the
plug on my network.

System.ObjectDisposedException: Cannot access a disposed object.
Object name: 'System.Net.Sockets.Socket'.
at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
optionLevel, SocketOptionName optionName, Object optionValue)
at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
at System.Threading.ExecutionContext.runTryCode(Object userData)
at
System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode
code, CleanupCode backoutCode, Object userData)
at System.Threading.ExecutionContext.RunInternal(ExecutionContext
executionContext, ContextCallback callback, Object state)
at System.Threading.ExecutionContext.Run(ExecutionContext
executionContext, ContextCallback callback, Object state, Boolean
ignoreSyncCtx)
at System.Threading.ExecutionContext.Run(ExecutionContext
executionContext, ContextCallback callback, Object state)
at System.Threading.ThreadHelper.ThreadStart()

This code is reproducible consistently with the following:

using System;
using System.Threading;
using NUnit.Framework;
using RabbitMQ.Client;
using RabbitMQ.Client.Framing.v0_9;

namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
{
    [TestFixture]
    public class TestingObjectDispositionException
    {
        [Test(Description = "ObjectDispositionException")]
        public void TestFail()
        {
            var cf = new ConnectionFactory
                         {
                             HostName = INSERT_IP_HERE,
                             Port = 5672,
                             RequestedHeartbeat = 2
                         };
            using (var connection = cf.CreateConnection())
            using (var model = connection.CreateModel())
            {
                Thread.Sleep(TimeSpan.FromSeconds(1));
                model.Close(Constants.ReplySuccess, "Goodbye");
                connection.Close(Constants.ReplySuccess, "Goodbye");
                Thread.Sleep(TimeSpan.FromSeconds(1));
            }
        }
    }
}


I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.

Status of node rabbit at xxx ...
[{pid,1344},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
      {rabbit,"RabbitMQ","2.7.0"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,31177024},
      {processes,11828776},
      {processes_used,11772888},
      {system,19348248},
      {atom,1355273},
      {atom_used,1339382},
      {binary,84928},
      {code,14547474},
      {ets,1099944}]},
 {vm_memory_high_watermark,0.39999999995232727},
 {vm_memory_limit,5034326425}]
...done.

From hyangii at gmail.com  Thu Dec 29 01:43:40 2011
From: hyangii at gmail.com (Jae Sang Lee)
Date: Thu, 29 Dec 2011 10:43:40 +0900
Subject: [rabbitmq-discuss]  Failed to configure Rabbitmq HA(pacemaker)
Message-ID: <CAKrFU7V5221mxjoomqqsoD-ejTbiOmRgKwUmLP+gRwaq438Jfw@mail.gmail.com>

Hi, all.


I read a rabbitmq HA(pacemaker) article at a homepage, then I tried to
configure two-node HA.
I succeeded run drbd and rabbitmq service by pacemaker. But It failed when
I tried to migrate from master to slave server.


This is first situation.
my node 'ha-node-1', 'ha-node-2'.
Master is 'ha-node-2'

ha-node-2# crm_mon
============
Last updated: Thu Dec 29 10:13:15 2011
Stack: openais
Current DC: ha-node-1 - partition with quorum
Version: 1.0.8-042548a451fce8400660f6031f4da6f0223dd5dd
2 Nodes configured, 2 expected votes
3 Resources configured.
============

Online: [ ha-node-1 ha-node-2 ]

 Master/Slave Set: drbd_ms
     Masters: [ ha-node-2 ]
     Slaves: [ ha-node-1 ]
drbd_fs (ocf::heartbeat:Filesystem):    Started ha-node-2
bunny   (ocf::rabbitmq:rabbitmq-server):        Started ha-node-2


ha-node-2~# cat /proc/drbd
version: 8.3.7 (api:88/proto:86-91)
GIT-hash: ea9e28dbff98e331a62bcbcc63a6135808fe2917 build by root at glance-demo,
2011-12-26 13:05:30

 1: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r----
    ns:486 nr:5 dw:491 dr:287 al:6 bm:1 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0

I tested fail situation from master. so
ha-node-2~# crm node standby

ha-node-1~# crm_mon
============
Last updated: Thu Dec 29 10:32:56 2011
Stack: openais
Current DC: ha-node-1 - partition with quorum
Version: 1.0.8-042548a451fce8400660f6031f4da6f0223dd5dd
2 Nodes configured, 2 expected votes
3 Resources configured.
============

Node ha-node-2: standby
Online: [ ha-node-1 ]

 Master/Slave Set: drbd_ms
     Masters: [ ha-node-1 ]
     Stopped: [ drbd:1 ]
drbd_fs (ocf::heartbeat:Filesystem):    Started ha-node-1

Failed actions:
    bunny_start_0 (node=ha-node-1, call=14, rc=1, status=complete): unknown
error

drbd is migrate to slave successfully, but resource bunny(rabbitmq) isn't
start.
this is rabbitmq error log

root at ha-node-1:/var/log/rabbitmq# cat startup_log
Activating RabbitMQ plugins ...
ERROR: Could not delete dir
/media/drbd1/rabbit at localhost-plugins-expand({cannot_delete,

"/media/drbd1/rabbit at localhost-plugins-expand/rabbit.script",

eacces})

I found slave's rabbitmq mnesia dir's owner is ais, not rabbitmq.
root at ha-node-1:/var/log/rabbitmq# cd /media/drbd1/
root at ha-node-1:/media/drbd1# ll
total 20
drwxr-xr-x 5 ais  ais   1024 2011-12-28 17:09 ./
drwxr-xr-x 3 root root  4096 2011-12-27 13:22 ../
-rw-r--r-- 1 ais  ais      3 2011-12-28 16:48 hello
drwx------ 2 ais  ais  12288 2011-12-28 16:47 lost+found/
drwxr-xr-x 5 ais  ais   1024 2011-12-29 10:32 rabbit at localhost/
drwxr-xr-x 2 ais  ais   1024 2011-12-28 17:09
rabbit at localhost-plugins-expand/

When ha-node-2 success to run rabbitmq,
mnesia dir's owner is rabbitmq.
root at ha-node-2:/media/drbd1# ll
total 20
drwxr-xr-x 5 rabbitmq rabbitmq  1024 2011-12-28 17:09 ./
drwxr-xr-x 3 root     root      4096 2011-12-27 10:58 ../
-rw-r--r-- 1 rabbitmq rabbitmq     3 2011-12-28 16:48 hello
drwx------ 2 rabbitmq rabbitmq 12288 2011-12-28 16:47 lost+found/
drwxr-xr-x 5 rabbitmq rabbitmq  1024 2011-12-29 09:42 rabbit at localhost/
drwxr-xr-x 2 rabbitmq rabbitmq  1024 2011-12-28 17:09
rabbit at localhost-plugins-expand/


Why pacemaker change owner of file/folder from rabbitmq to ais? I think
that is a reason to fail to run rabbitmq at slave(ha-node-1) server.

How can I fix that? I hope your reply.

Thanks.



ps.
this is pacemaker configure.
# crm configure show
node ha-node-1 \
        attributes standby="off"
node ha-node-2 \
        attributes standby="on"
primitive bunny ocf:rabbitmq:rabbitmq-server \
        params mnesia_base="/media/drbd1" \
        meta target-role="Started" is-managed="true"
primitive drbd ocf:linbit:drbd \
        params drbd_resource="drbd1" \
        op monitor interval="60s"
primitive drbd_fs ocf:heartbeat:Filesystem \
        params device="/dev/drbd1" directory="/media/drbd1" fstype="ext3"
ms drbd_ms drbd \
        meta master-max="1" master-node-max="1" clone-max="2"
clone-node-max="1" notify="true"
colocation bunny_on_fs inf: bunny drbd_fs
colocation fs_on_drbd inf: drbd_fs drbd_ms:Master
order bunny_after_fs inf: drbd_fs bunny
order fs_after_drbd inf: drbd_ms:promote drbd_fs:start
property $id="cib-bootstrap-options" \
        dc-version="1.0.8-042548a451fce8400660f6031f4da6f0223dd5dd" \
        cluster-infrastructure="openais" \
        expected-quorum-votes="2" \
        stonith-enabled="false" \
        no-quorum-policy="ignore"
rsc_defaults $id="rsc-options" \
        resource-stickiness="100"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/755bde9e/attachment.htm>

From simone.busoli at gmail.com  Thu Dec 29 07:59:26 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 29 Dec 2011 08:59:26 +0100
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
Message-ID: <CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>

Hi Dave, although counterintuitive the documentation of the .NET client
states that explicitly. The connection closure/disposal is not idempotent,
i.e. you shall not call it twice.
On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstevens at gmail.com> wrote:

> I am getting the following exception when disposing a connection. I
> had previously noticed this when going from RabbitMQ Client 2.5.1 to
> 2.7.0 which caused me to back out the update. I ended up going to
> 2.7.1 because I thought I found a shutdown issue in my own code. The
> exception did not present itself again until I started testing some
> reconnect logic. I first noticed it again after simply pulling the
> plug on my network.
>
> System.ObjectDisposedException: Cannot access a disposed object.
> Object name: 'System.Net.Sockets.Socket'.
> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> optionLevel, SocketOptionName optionName, Object optionValue)
> at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
> at System.Threading.ExecutionContext.runTryCode(Object userData)
> at
>
> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode
> code, CleanupCode backoutCode, Object userData)
> at System.Threading.ExecutionContext.RunInternal(ExecutionContext
> executionContext, ContextCallback callback, Object state)
> at System.Threading.ExecutionContext.Run(ExecutionContext
> executionContext, ContextCallback callback, Object state, Boolean
> ignoreSyncCtx)
> at System.Threading.ExecutionContext.Run(ExecutionContext
> executionContext, ContextCallback callback, Object state)
> at System.Threading.ThreadHelper.ThreadStart()
>
> This code is reproducible consistently with the following:
>
> using System;
> using System.Threading;
> using NUnit.Framework;
> using RabbitMQ.Client;
> using RabbitMQ.Client.Framing.v0_9;
>
> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
> {
>    [TestFixture]
>    public class TestingObjectDispositionException
>    {
>        [Test(Description = "ObjectDispositionException")]
>        public void TestFail()
>        {
>            var cf = new ConnectionFactory
>                         {
>                             HostName = INSERT_IP_HERE,
>                             Port = 5672,
>                             RequestedHeartbeat = 2
>                         };
>            using (var connection = cf.CreateConnection())
>            using (var model = connection.CreateModel())
>            {
>                Thread.Sleep(TimeSpan.FromSeconds(1));
>                model.Close(Constants.ReplySuccess, "Goodbye");
>                connection.Close(Constants.ReplySuccess, "Goodbye");
>                Thread.Sleep(TimeSpan.FromSeconds(1));
>            }
>        }
>    }
> }
>
>
> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>
> Status of node rabbit at xxx ...
> [{pid,1344},
>  {running_applications,
>     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
>      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
>      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
>      {rabbit,"RabbitMQ","2.7.0"},
>      {os_mon,"CPO  CXC 138 46","2.2.5"},
>      {sasl,"SASL  CXC 138 11","2.1.9.3"},
>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
>      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
>      {inets,"INETS  CXC 138 49","5.5.2"},
>      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>      {stdlib,"ERTS  CXC 138 10","1.17.3"},
>      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>     [{total,31177024},
>      {processes,11828776},
>      {processes_used,11772888},
>      {system,19348248},
>      {atom,1355273},
>      {atom_used,1339382},
>      {binary,84928},
>      {code,14547474},
>      {ets,1099944}]},
>  {vm_memory_high_watermark,0.39999999995232727},
>  {vm_memory_limit,5034326425}]
> ...done.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/57b20a7f/attachment.htm>

From minaev at gmail.com  Thu Dec 29 09:27:35 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Thu, 29 Dec 2011 13:27:35 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
Message-ID: <CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>

Hello,

I am sorry, but upgrade to Erlang R15B and RabbitMQ 2.7.1 did not
help. Today I saw the same picture: RabbitMQ does not accept new
connections, while everything else seems to be working :(


On 22 December 2011 15:41, Dmitri Minaev <minaev at gmail.com> wrote:
> Sounds reasonable :). Ok, I will stop the hanging instance now and
> upgrade Erlang to the last version. This one just happened to be found
> in Ubuntu repository.
>
> Thank you, Matthias, Alvaro, Simon and everyone else!
>
>
> On 22 December 2011 15:36, Matthias Radestock <matthias at rabbitmq.com> wrote:
>> Dmitri,
>>
>>
>> On 22/12/11 11:30, Dmitri Minaev wrote:
>>>
>>> No, it is simply waiting. CPU is idle, RAM is free, swap is unused, IO
>>> is very moderate.
>>
>>
>> I suspect this is a problem with Erlang, somehow causing the tcp/ip
>> sub-system to get into a weird state.
>>
>> I see you are running R13B03, which is two years old. I suggest you replace
>> that with Ericsson's latest - R15B - and also run the latest rabbit (2.7.1).
>>
>> Regards,
>>
>> Matthias.
>
>
>
> --
> With best regards,
> Dmitri Minaev



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Thu Dec 29 09:35:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 29 Dec 2011 09:35:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
Message-ID: <4EFC3450.40901@rabbitmq.com>

Dmitri,

On 29/12/11 09:27, Dmitri Minaev wrote:
> I am sorry, but upgrade to Erlang R15B and RabbitMQ 2.7.1 did not
> help. Today I saw the same picture: RabbitMQ does not accept new
> connections, while everything else seems to be working :(

That's unfortunate. Though our investigation will be easier now that you 
are running the latest version.

Is there any way you could give us access to the broken rabbit?

Also, while in the hung state, what does

$ scripts/rabbitmqctl eval 'file_handle_cache:info().'

return?

Regards,

Matthias.

From joseph.a.marlin at gmail.com  Thu Dec 29 14:01:44 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Thu, 29 Dec 2011 06:01:44 -0800 (PST)
Subject: [rabbitmq-discuss] Failed to configure Rabbitmq HA(pacemaker)
In-Reply-To: <CAKrFU7V5221mxjoomqqsoD-ejTbiOmRgKwUmLP+gRwaq438Jfw@mail.gmail.com>
References: <CAKrFU7V5221mxjoomqqsoD-ejTbiOmRgKwUmLP+gRwaq438Jfw@mail.gmail.com>
Message-ID: <19860788.209.1325167304932.JavaMail.geo-discussion-forums@vbmi7>

Is there a specific reason that you do not want to use Rabbit's new built 
in active-active HA? 

http://www.rabbitmq.com/ha.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/f403b1b1/attachment.htm>

From daverstevens at gmail.com  Thu Dec 29 16:43:31 2011
From: daverstevens at gmail.com (Dave Stevens)
Date: Thu, 29 Dec 2011 11:43:31 -0500
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
Message-ID: <CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>

I get the same exception with this:

? ? ? ? [Test(Description = "ObjectDispositionException")]
? ? ? ? public void TestFail()
? ? ? ? {
? ? ? ? ? ? var cf = new ConnectionFactory
? ? ? ? ? ? ? ? ? ? ? ? ?{
? ? ? ? ? ? ? ? ? ? ? ? ? ? ?HostName = "10.10.8.96",
? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Port = 5672,
? ? ? ? ? ? ? ? ? ? ? ? ? ? ?RequestedHeartbeat = 2
? ? ? ? ? ? ? ? ? ? ? ? ?};
? ? ? ? ? ? using (var connection = cf.CreateConnection())
? ? ? ? ? ? using (var model = connection.CreateModel())
? ? ? ? ? ? {
? ? ? ? ? ? ? ? Thread.Sleep(TimeSpan.FromSeconds(1));
? ? ? ? ? ? }
? ? ? ? }

On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli <simone.busoli at gmail.com> wrote:
>
> Hi Dave, although counterintuitive the documentation of the .NET client states that explicitly. The connection closure/disposal is not idempotent, i.e. you shall not call it twice.
>
> On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstevens at gmail.com> wrote:
>>
>> I am getting the following exception when disposing a connection. I
>> had previously noticed this when going from RabbitMQ Client 2.5.1 to
>> 2.7.0 which caused me to back out the update. I ended up going to
>> 2.7.1 because I thought I found a shutdown issue in my own code. The
>> exception did not present itself again until I started testing some
>> reconnect logic. I first noticed it again after simply pulling the
>> plug on my network.
>>
>> System.ObjectDisposedException: Cannot access a disposed object.
>> Object name: 'System.Net.Sockets.Socket'.
>> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
>> optionLevel, SocketOptionName optionName, Object optionValue)
>> at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
>> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
>> at System.Threading.ExecutionContext.runTryCode(Object userData)
>> at
>> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode
>> code, CleanupCode backoutCode, Object userData)
>> at System.Threading.ExecutionContext.RunInternal(ExecutionContext
>> executionContext, ContextCallback callback, Object state)
>> at System.Threading.ExecutionContext.Run(ExecutionContext
>> executionContext, ContextCallback callback, Object state, Boolean
>> ignoreSyncCtx)
>> at System.Threading.ExecutionContext.Run(ExecutionContext
>> executionContext, ContextCallback callback, Object state)
>> at System.Threading.ThreadHelper.ThreadStart()
>>
>> This code is reproducible consistently with the following:
>>
>> using System;
>> using System.Threading;
>> using NUnit.Framework;
>> using RabbitMQ.Client;
>> using RabbitMQ.Client.Framing.v0_9;
>>
>> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
>> {
>> ? ?[TestFixture]
>> ? ?public class TestingObjectDispositionException
>> ? ?{
>> ? ? ? ?[Test(Description = "ObjectDispositionException")]
>> ? ? ? ?public void TestFail()
>> ? ? ? ?{
>> ? ? ? ? ? ?var cf = new ConnectionFactory
>> ? ? ? ? ? ? ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? HostName = INSERT_IP_HERE,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? Port = 5672,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? RequestedHeartbeat = 2
>> ? ? ? ? ? ? ? ? ? ? ? ? };
>> ? ? ? ? ? ?using (var connection = cf.CreateConnection())
>> ? ? ? ? ? ?using (var model = connection.CreateModel())
>> ? ? ? ? ? ?{
>> ? ? ? ? ? ? ? ?Thread.Sleep(TimeSpan.FromSeconds(1));
>> ? ? ? ? ? ? ? ?model.Close(Constants.ReplySuccess, "Goodbye");
>> ? ? ? ? ? ? ? ?connection.Close(Constants.ReplySuccess, "Goodbye");
>> ? ? ? ? ? ? ? ?Thread.Sleep(TimeSpan.FromSeconds(1));
>> ? ? ? ? ? ?}
>> ? ? ? ?}
>> ? ?}
>> }
>>
>>
>> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
>> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>>
>> Status of node rabbit at xxx ...
>> [{pid,1344},
>> ?{running_applications,
>> ? ? [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
>> ? ? ?{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
>> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.7.0"},
>> ? ? ?{rabbit,"RabbitMQ","2.7.0"},
>> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.5"},
>> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.9.3"},
>> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
>> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
>> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
>> ? ? ?{inets,"INETS ?CXC 138 49","5.5.2"},
>> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.17"},
>> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.17.3"},
>> ? ? ?{kernel,"ERTS ?CXC 138 10","2.14.3"}]},
>> ?{os,{unix,linux}},
>> ?{erlang_version,
>> ? ? "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
>> [async-threads:30] [kernel-poll:true]\n"},
>> ?{memory,
>> ? ? [{total,31177024},
>> ? ? ?{processes,11828776},
>> ? ? ?{processes_used,11772888},
>> ? ? ?{system,19348248},
>> ? ? ?{atom,1355273},
>> ? ? ?{atom_used,1339382},
>> ? ? ?{binary,84928},
>> ? ? ?{code,14547474},
>> ? ? ?{ets,1099944}]},
>> ?{vm_memory_high_watermark,0.39999999995232727},
>> ?{vm_memory_limit,5034326425}]
>> ...done.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Thu Dec 29 16:53:41 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 29 Dec 2011 16:53:41 +0000
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
Message-ID: <CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>

Srdan

I just had a quick look through your slides.  Have you tried using one
loader and one drainer and one queue, on one core, and gradually
increasing their rates?  What do you see?

alexis



On Wed, Dec 28, 2011 at 9:05 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>
> On Dec 28, 2011, at 19:48 , Tony Garnock-Jones wrote:
>
> On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>
>> My question is as simple as it is complex: 'Is that it?' What can I do to
>> tweak these numbers? Massively.
>
>
> Is this a transient-messaging use case (RabbitMQ as router, not relying
> particularly on disk storage), or a persistent-messaging use case (where you
> die in flames if a single message is dropped), or somewhere in-between?
>
>
> Well, it is transient in so fact that we use it to distribute messages to a
> large number of workers. In that way it is a router. But it also functions
> as a buffer. If we for instance update the workers we like to be able to
> stop and restart them without throwing messages away.
>
> Each individual message is not that important in itself. And if we loose a
> larger amount of messages, we can re-queue the affected blocks. We're big on
> idempotence and can cut ourselves some slack if we need to.
>
> That said, once you get to sending thousands of messages per second and the
> system goes all fishy on you for an indeterminate length of time, the
> re-queueing becomes? inconvenient. Inconvenient to the degree that it for
> most practical purposes stops being an option and you become prepared to
> 'invest' yourself away from those problems if at all possible.
>
>
> //S
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Myron.Hammond at wedbush.com  Thu Dec 29 19:06:47 2011
From: Myron.Hammond at wedbush.com (Myron Hammond)
Date: Thu, 29 Dec 2011 11:06:47 -0800
Subject: [rabbitmq-discuss] New to Rabbit MQ
Message-ID: <26C1D439C1BCAC43A317AD69C4BE2F910149F45C@USLAEX40.wedbush.com>

I have successfully fumbled my way through the IBM WebSphere MQ trial -
in the .NET environment.  I wanted to check out RabbitMQ.  I wanted to
know if anyone knows of any resources that show a conversion from
WebSphere to RabbitMQ.  

 

If it is available, it will save me piles of time.

 

Regards,

Myron Hammond

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/b2cc3460/attachment.htm>

From simone.busoli at gmail.com  Thu Dec 29 21:38:14 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 29 Dec 2011 22:38:14 +0100
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
Message-ID: <CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>

What happens if you remove the heartbeat setting?
On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstevens at gmail.com> wrote:

> I get the same exception with this:
>
>         [Test(Description = "ObjectDispositionException")]
>         public void TestFail()
>         {
>             var cf = new ConnectionFactory
>                          {
>                              HostName = "10.10.8.96",
>                              Port = 5672,
>                              RequestedHeartbeat = 2
>                          };
>             using (var connection = cf.CreateConnection())
>             using (var model = connection.CreateModel())
>             {
>                 Thread.Sleep(TimeSpan.FromSeconds(1));
>             }
>         }
>
> On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli <simone.busoli at gmail.com>
> wrote:
> >
> > Hi Dave, although counterintuitive the documentation of the .NET client
> states that explicitly. The connection closure/disposal is not idempotent,
> i.e. you shall not call it twice.
> >
> > On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstevens at gmail.com> wrote:
> >>
> >> I am getting the following exception when disposing a connection. I
> >> had previously noticed this when going from RabbitMQ Client 2.5.1 to
> >> 2.7.0 which caused me to back out the update. I ended up going to
> >> 2.7.1 because I thought I found a shutdown issue in my own code. The
> >> exception did not present itself again until I started testing some
> >> reconnect logic. I first noticed it again after simply pulling the
> >> plug on my network.
> >>
> >> System.ObjectDisposedException: Cannot access a disposed object.
> >> Object name: 'System.Net.Sockets.Socket'.
> >> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> >> optionLevel, SocketOptionName optionName, Object optionValue)
> >> at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
> >> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
> >> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
> >> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
> >> at System.Threading.ExecutionContext.runTryCode(Object userData)
> >> at
> >>
> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode
> >> code, CleanupCode backoutCode, Object userData)
> >> at System.Threading.ExecutionContext.RunInternal(ExecutionContext
> >> executionContext, ContextCallback callback, Object state)
> >> at System.Threading.ExecutionContext.Run(ExecutionContext
> >> executionContext, ContextCallback callback, Object state, Boolean
> >> ignoreSyncCtx)
> >> at System.Threading.ExecutionContext.Run(ExecutionContext
> >> executionContext, ContextCallback callback, Object state)
> >> at System.Threading.ThreadHelper.ThreadStart()
> >>
> >> This code is reproducible consistently with the following:
> >>
> >> using System;
> >> using System.Threading;
> >> using NUnit.Framework;
> >> using RabbitMQ.Client;
> >> using RabbitMQ.Client.Framing.v0_9;
> >>
> >> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
> >> {
> >>    [TestFixture]
> >>    public class TestingObjectDispositionException
> >>    {
> >>        [Test(Description = "ObjectDispositionException")]
> >>        public void TestFail()
> >>        {
> >>            var cf = new ConnectionFactory
> >>                         {
> >>                             HostName = INSERT_IP_HERE,
> >>                             Port = 5672,
> >>                             RequestedHeartbeat = 2
> >>                         };
> >>            using (var connection = cf.CreateConnection())
> >>            using (var model = connection.CreateModel())
> >>            {
> >>                Thread.Sleep(TimeSpan.FromSeconds(1));
> >>                model.Close(Constants.ReplySuccess, "Goodbye");
> >>                connection.Close(Constants.ReplySuccess, "Goodbye");
> >>                Thread.Sleep(TimeSpan.FromSeconds(1));
> >>            }
> >>        }
> >>    }
> >> }
> >>
> >>
> >> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
> >> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
> >>
> >> Status of node rabbit at xxx ...
> >> [{pid,1344},
> >>  {running_applications,
> >>     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
> >>      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
> >>      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
> >>      {rabbit,"RabbitMQ","2.7.0"},
> >>      {os_mon,"CPO  CXC 138 46","2.2.5"},
> >>      {sasl,"SASL  CXC 138 11","2.1.9.3"},
> >>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
> >>      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
> >>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
> >>      {inets,"INETS  CXC 138 49","5.5.2"},
> >>      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
> >>      {stdlib,"ERTS  CXC 138 10","1.17.3"},
> >>      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
> >>  {os,{unix,linux}},
> >>  {erlang_version,
> >>     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
> >> [async-threads:30] [kernel-poll:true]\n"},
> >>  {memory,
> >>     [{total,31177024},
> >>      {processes,11828776},
> >>      {processes_used,11772888},
> >>      {system,19348248},
> >>      {atom,1355273},
> >>      {atom_used,1339382},
> >>      {binary,84928},
> >>      {code,14547474},
> >>      {ets,1099944}]},
> >>  {vm_memory_high_watermark,0.39999999995232727},
> >>  {vm_memory_limit,5034326425}]
> >> ...done.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/7c9b1f6b/attachment.htm>

From srdan at burtcorp.com  Thu Dec 29 22:03:18 2011
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Thu, 29 Dec 2011 23:03:18 +0100
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
	<CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
Message-ID: <B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>

Nope, can't say that I have. 

It's not really the use case though - in real life the queues are actually significant.

I'll try it though. If that'll yield some insight. Hell, I'd try eating a balanced diet and getting plenty of sleep if that could help.

//S


On Dec 29, 2011, at 17:53 , Alexis Richardson wrote:

> Srdan
> 
> I just had a quick look through your slides.  Have you tried using one
> loader and one drainer and one queue, on one core, and gradually
> increasing their rates?  What do you see?
> 
> alexis
> 
> 
> 
> On Wed, Dec 28, 2011 at 9:05 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>> 
>> On Dec 28, 2011, at 19:48 , Tony Garnock-Jones wrote:
>> 
>> On 28 December 2011 12:49, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>>> 
>>> My question is as simple as it is complex: 'Is that it?' What can I do to
>>> tweak these numbers? Massively.
>> 
>> 
>> Is this a transient-messaging use case (RabbitMQ as router, not relying
>> particularly on disk storage), or a persistent-messaging use case (where you
>> die in flames if a single message is dropped), or somewhere in-between?
>> 
>> 
>> Well, it is transient in so fact that we use it to distribute messages to a
>> large number of workers. In that way it is a router. But it also functions
>> as a buffer. If we for instance update the workers we like to be able to
>> stop and restart them without throwing messages away.
>> 
>> Each individual message is not that important in itself. And if we loose a
>> larger amount of messages, we can re-queue the affected blocks. We're big on
>> idempotence and can cut ourselves some slack if we need to.
>> 
>> That said, once you get to sending thousands of messages per second and the
>> system goes all fishy on you for an indeterminate length of time, the
>> re-queueing becomes? inconvenient. Inconvenient to the degree that it for
>> most practical purposes stops being an option and you become prepared to
>> 'invest' yourself away from those problems if at all possible.
>> 
>> 
>> //S
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From daverstevens at gmail.com  Thu Dec 29 22:16:47 2011
From: daverstevens at gmail.com (Dave Stevens)
Date: Thu, 29 Dec 2011 14:16:47 -0800 (PST)
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
	.NET client 2.7.0/1
In-Reply-To: <CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>
Message-ID: <8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>

Yes, heartbeat is what is causing this. Version 2.7.1 of the .NET
client is itself calling System.Net.Sockets.TcpClient.Close() 3 times
per connection shutdown (4 if shutdown times out).
ConnectionBase.FinishClose() is called 3 different times when shutting
down.See MainLoop(), HeartbeatReadLoop(), and HeartbeatWriteLoop() of
ConnectionBase.cs lines 629, 566 and?538 respectively.
I am required to set the Heartbeat due to another issue where
exclusive queues are not being removed at the broker when connections
died. This prevents components from being able to restart with the
same queue name.
See http://stackoverflow.com/questions/8296201/when-does-an-amqp-rabbitmq-channel-with-no-connections-die/8299475

I believe that even with this, ConnectionBase.FinishClose() will be
called once successfully which would allow the models to shutdown
properly. I believe this is a bug though as FinishClose() should not
be called more than once or it is possible that certain event handlers
will be called more than once, Session.OnSessionShutdown specifically.
This may impact certain reconnect implementations.

On Dec 29, 4:38?pm, Simone Busoli <simone.bus... at gmail.com> wrote:
> What happens if you remove the heartbeat setting?
> On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>
>
>
>
>
>
>
> > I get the same exception with this:
>
> > ? ? ? ? [Test(Description = "ObjectDispositionException")]
> > ? ? ? ? public void TestFail()
> > ? ? ? ? {
> > ? ? ? ? ? ? var cf = new ConnectionFactory
> > ? ? ? ? ? ? ? ? ? ? ? ? ?{
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?HostName = "10.10.8.96",
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?Port = 5672,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?RequestedHeartbeat = 2
> > ? ? ? ? ? ? ? ? ? ? ? ? ?};
> > ? ? ? ? ? ? using (var connection = cf.CreateConnection())
> > ? ? ? ? ? ? using (var model = connection.CreateModel())
> > ? ? ? ? ? ? {
> > ? ? ? ? ? ? ? ? Thread.Sleep(TimeSpan.FromSeconds(1));
> > ? ? ? ? ? ? }
> > ? ? ? ? }
>
> > On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli <simone.bus... at gmail.com>
> > wrote:
>
> > > Hi Dave, although counterintuitive the documentation of the .NET client
> > states that explicitly. The connection closure/disposal is not idempotent,
> > i.e. you shall not call it twice.
>
> > > On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>
> > >> I am getting the following exception when disposing a connection. I
> > >> had previously noticed this when going from RabbitMQ Client 2.5.1 to
> > >> 2.7.0 which caused me to back out the update. I ended up going to
> > >> 2.7.1 because I thought I found a shutdown issue in my own code. The
> > >> exception did not present itself again until I started testing some
> > >> reconnect logic. I first noticed it again after simply pulling the
> > >> plug on my network.
>
> > >> System.ObjectDisposedException: Cannot access a disposed object.
> > >> Object name: 'System.Net.Sockets.Socket'.
> > >> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
> > >> optionLevel, SocketOptionName optionName, Object optionValue)
> > >> at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
> > >> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
> > >> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
> > >> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
> > >> at System.Threading.ExecutionContext.runTryCode(Object userData)
> > >> at
>
> > System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCle anup(TryCode
> > >> code, CleanupCode backoutCode, Object userData)
> > >> at System.Threading.ExecutionContext.RunInternal(ExecutionContext
> > >> executionContext, ContextCallback callback, Object state)
> > >> at System.Threading.ExecutionContext.Run(ExecutionContext
> > >> executionContext, ContextCallback callback, Object state, Boolean
> > >> ignoreSyncCtx)
> > >> at System.Threading.ExecutionContext.Run(ExecutionContext
> > >> executionContext, ContextCallback callback, Object state)
> > >> at System.Threading.ThreadHelper.ThreadStart()
>
> > >> This code is reproducible consistently with the following:
>
> > >> using System;
> > >> using System.Threading;
> > >> using NUnit.Framework;
> > >> using RabbitMQ.Client;
> > >> using RabbitMQ.Client.Framing.v0_9;
>
> > >> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
> > >> {
> > >> ? ?[TestFixture]
> > >> ? ?public class TestingObjectDispositionException
> > >> ? ?{
> > >> ? ? ? ?[Test(Description = "ObjectDispositionException")]
> > >> ? ? ? ?public void TestFail()
> > >> ? ? ? ?{
> > >> ? ? ? ? ? ?var cf = new ConnectionFactory
> > >> ? ? ? ? ? ? ? ? ? ? ? ? {
> > >> ? ? ? ? ? ? ? ? ? ? ? ? ? ? HostName = INSERT_IP_HERE,
> > >> ? ? ? ? ? ? ? ? ? ? ? ? ? ? Port = 5672,
> > >> ? ? ? ? ? ? ? ? ? ? ? ? ? ? RequestedHeartbeat = 2
> > >> ? ? ? ? ? ? ? ? ? ? ? ? };
> > >> ? ? ? ? ? ?using (var connection = cf.CreateConnection())
> > >> ? ? ? ? ? ?using (var model = connection.CreateModel())
> > >> ? ? ? ? ? ?{
> > >> ? ? ? ? ? ? ? ?Thread.Sleep(TimeSpan.FromSeconds(1));
> > >> ? ? ? ? ? ? ? ?model.Close(Constants.ReplySuccess, "Goodbye");
> > >> ? ? ? ? ? ? ? ?connection.Close(Constants.ReplySuccess, "Goodbye");
> > >> ? ? ? ? ? ? ? ?Thread.Sleep(TimeSpan.FromSeconds(1));
> > >> ? ? ? ? ? ?}
> > >> ? ? ? ?}
> > >> ? ?}
> > >> }
>
> > >> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
> > >> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>
> > >> Status of node rabbit at xxx ...
> > >> [{pid,1344},
> > >> ?{running_applications,
> > >> ? ? [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
> > >> ? ? ?{rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
> > >> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.7.0"},
> > >> ? ? ?{rabbit,"RabbitMQ","2.7.0"},
> > >> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.5"},
> > >> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.9.3"},
> > >> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
> > >> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
> > >> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
> > >> ? ? ?{inets,"INETS ?CXC 138 49","5.5.2"},
> > >> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.17"},
> > >> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.17.3"},
> > >> ? ? ?{kernel,"ERTS ?CXC 138 10","2.14.3"}]},
> > >> ?{os,{unix,linux}},
> > >> ?{erlang_version,
> > >> ? ? "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
> > >> [async-threads:30] [kernel-poll:true]\n"},
> > >> ?{memory,
> > >> ? ? [{total,31177024},
> > >> ? ? ?{processes,11828776},
> > >> ? ? ?{processes_used,11772888},
> > >> ? ? ?{system,19348248},
> > >> ? ? ?{atom,1355273},
> > >> ? ? ?{atom_used,1339382},
> > >> ? ? ?{binary,84928},
> > >> ? ? ?{code,14547474},
> > >> ? ? ?{ets,1099944}]},
> > >> ?{vm_memory_high_watermark,0.39999999995232727},
> > >> ?{vm_memory_limit,5034326425}]
> > >> ...done.
> > >> _______________________________________________
> > >> rabbitmq-discuss mailing list
> > >> rabbitmq-disc... at lists.rabbitmq.com
> > >>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sahmed1020 at gmail.com  Thu Dec 29 22:21:26 2011
From: sahmed1020 at gmail.com (S Ahmed)
Date: Thu, 29 Dec 2011 17:21:26 -0500
Subject: [rabbitmq-discuss] does rabbitmq server close connections?
Message-ID: <CAG2rwuPPsZ+90KZiK9xtinTR6Yeo3GiEwsmb6HBtp_di9Yhh+g@mail.gmail.com>

With 100's of computers connected to rabbitmq with persistent connections,
would this pose any problems?

Does it time-out by default?

Why use a heartbeat?  Is it to re-establish if the heartbeat fails?

Would it be better for clients to close connections and only open a
connection when necessary?

For reading messages we need persistent connections.

But for writing, and I can see how we could potentially only open a
connection to write a message when required.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111229/c3577914/attachment.htm>

From hyangii at gmail.com  Fri Dec 30 00:51:26 2011
From: hyangii at gmail.com (Jae Sang Lee)
Date: Fri, 30 Dec 2011 09:51:26 +0900
Subject: [rabbitmq-discuss] Failed to configure Rabbitmq HA(pacemaker)
In-Reply-To: <19860788.209.1325167304932.JavaMail.geo-discussion-forums@vbmi7>
References: <CAKrFU7V5221mxjoomqqsoD-ejTbiOmRgKwUmLP+gRwaq438Jfw@mail.gmail.com>
	<19860788.209.1325167304932.JavaMail.geo-discussion-forums@vbmi7>
Message-ID: <CAKrFU7U+YqRpThUKYezVQ8omvZE0z1473--ugesof77Mvnjf7Q@mail.gmail.com>

active-active HA looks good. but that manual isn't kindly now so I tried to
HA using pacemaker first.
HA using pacemaker is old way and don't recommend now?

2011/12/29 Joseph Marlin <joseph.a.marlin at gmail.com>

> Is there a specific reason that you do not want to use Rabbit's new built
> in active-active HA?
>
> http://www.rabbitmq.com/ha.html
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111230/363ffec5/attachment.htm>

From dhaneesh at hifx.co.in  Fri Dec 30 04:25:17 2011
From: dhaneesh at hifx.co.in (Dhaneesh Radhakrishnan)
Date: Fri, 30 Dec 2011 09:55:17 +0530
Subject: [rabbitmq-discuss] active-active implementation in php
Message-ID: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>

Hi

 Is it possible to  implement Mirrored Queue ( active-active )using
php-amqplib  for
HA

  Any pointers for more information about it would be highly
appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111230/e9832eb4/attachment.htm>

From minaev at gmail.com  Fri Dec 30 08:27:50 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 30 Dec 2011 12:27:50 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EFC3450.40901@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
Message-ID: <CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>

Matthias,

I would be most grateful if you could have a look at our server. I
will send you more info in an off-list message. Thank you.

Here's the output of file_handle_cache:info():

$ sudo /usr/local/rabbitmq/sbin/rabbitmqctl eval 'file_handle_cache:info().'
[{obtain_count,51},{obtain_limit,829}]
...done.



On 29 December 2011 13:35, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 29/12/11 09:27, Dmitri Minaev wrote:
>>
>> I am sorry, but upgrade to Erlang R15B and RabbitMQ 2.7.1 did not
>> help. Today I saw the same picture: RabbitMQ does not accept new
>> connections, while everything else seems to be working :(
>
>
> That's unfortunate. Though our investigation will be easier now that you are
> running the latest version.
>
> Is there any way you could give us access to the broken rabbit?
>
> Also, while in the hung state, what does
>
> $ scripts/rabbitmqctl eval 'file_handle_cache:info().'
>
> return?
>
> Regards,
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Fri Dec 30 12:11:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Dec 2011 12:11:30 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
Message-ID: <4EFDAA72.9090605@rabbitmq.com>

Dmitri,

On 30/12/11 08:27, Dmitri Minaev wrote:
> I would be most grateful if you could have a look at our server.

I have done this now.

Rabbit indeed wasn't accepting connections - it wasn't refusing them 
either, i.e. it was behaving as if 'accept' hadn't been called.

The Erlang process tasked with accepting AMQP connections was alive and 
well. It was simply sitting there waiting for the tcp subsystem to 
notify it of new connections. Alas that never happened.

So either the acceptor process forgot to tell Erlang's tcp stack to be 
notified of new connections, or Erlang's tcp stack forgot that it was 
supposed to tell the acceptor process...

...and it looks like there is a path in the tcp_acceptor.erl that would 
trigger the former. When the tcp stack notifies the acceptor of an error 
other than 'closed', the acceptor carries on but does not invoke 
prim_inet:async_accept/2 to be notified of the next connection attempt.

I will file a bug for this. Should be easy to fix, though we cannot be 
certain that this is definitely the problem.

Obviously if this was happening frequently we would have heard about the 
issue a long time ago - the code in question hasn't changed for >3 
years. So there must be some rare circumstances triggering this.


I got the acceptor process to issue another async_accept, so rabbit is 
happy for the moment. But no doubt the problem will re-occur.


Regards,

Matthias.

From matthias at rabbitmq.com  Fri Dec 30 14:02:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Dec 2011 14:02:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EFDAA72.9090605@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<4EE72C17.5010109@rabbitmq.com>	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com>
Message-ID: <4EFDC47D.7060204@rabbitmq.com>

Dmitri,

On 30/12/11 12:11, Matthias Radestock wrote:
> When the tcp stack notifies the acceptor of an error
> other than 'closed', the acceptor carries on but does not invoke
> prim_inet:async_accept/2 to be notified of the next connection attempt.
>
> I will file a bug for this. Should be easy to fix, though we cannot be
> certain that this is definitely the problem.

Here's a proposed fix:

http://hg.rabbitmq.com/rabbitmq-server/rev/ca0392ca0fc1

I am attaching a tcp_acceptor.beam with that fix, compiled for R15, that 
you can drop in place of the existing file. I'd be interested a) if that 
solves the problem for you, and b) what error gets logged - watch out 
for s.t. like

=ERROR REPORT==== 30-Dec-2011::13:45:01 ===
failed to accept TCP connection on [::]:5672: some_error

in the logs.


Regards,

Matthias.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tcp_acceptor.beam
Type: application/octet-stream
Size: 4920 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111230/382db03a/attachment.obj>

From steve at rabbitmq.com  Fri Dec 30 15:30:03 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Dec 2011 15:30:03 +0000
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
	.NET client 2.7.0/1
In-Reply-To: <8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
References: <240cef1d-f009-4e3e-ab8d-7de22864b615@i8g2000vbh.googlegroups.com>
	<CAOn7oW_KNrhh4we1vhsRyvB9F0sNS7zLF1kVLe5idukn9WuuTQ@mail.gmail.com>
	<CALQa0h3iXs178FH8EGS1_N_A5MPomR7GKOB7U4xqVBosven20g@mail.gmail.com>
	<CAOn7oW8DJQWVKvE+JOta=+Fa_A3+O7x94DMzBD_isxwhtjEV-Q@mail.gmail.com>
	<8cd5cf33-b465-4de1-af1b-4e8023bb241c@m7g2000vbc.googlegroups.com>
Message-ID: <3D67531F-46A7-4324-928E-CC1C87BAF48C@rabbitmq.com>

This really does look like a bug.  Thanks for spotting this.
I'm raising a bugzilla (bug24650) to track it, and will report back.

Steve Powell  (a yule bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 29 Dec 2011, at 22:16, Dave Stevens wrote:

> Yes, heartbeat is what is causing this. Version 2.7.1 of the .NET
> client is itself calling System.Net.Sockets.TcpClient.Close() 3 times
> per connection shutdown (4 if shutdown times out).
> ConnectionBase.FinishClose() is called 3 different times when shutting
> down.See MainLoop(), HeartbeatReadLoop(), and HeartbeatWriteLoop() of
> ConnectionBase.cs lines 629, 566 and 538 respectively.
> I am required to set the Heartbeat due to another issue where
> exclusive queues are not being removed at the broker when connections
> died. This prevents components from being able to restart with the
> same queue name.
> See http://stackoverflow.com/questions/8296201/when-does-an-amqp-rabbitmq-channel-with-no-connections-die/8299475
> 
> I believe that even with this, ConnectionBase.FinishClose() will be
> called once successfully which would allow the models to shutdown
> properly. I believe this is a bug though as FinishClose() should not
> be called more than once or it is possible that certain event handlers
> will be called more than once, Session.OnSessionShutdown specifically.
> This may impact certain reconnect implementations.
> 
> On Dec 29, 4:38 pm, Simone Busoli <simone.bus... at gmail.com> wrote:
>> What happens if you remove the heartbeat setting?
>> On Dec 29, 2011 5:43 PM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> I get the same exception with this:
>> 
>>>         [Test(Description = "ObjectDispositionException")]
>>>         public void TestFail()
>>>         {
>>>             var cf = new ConnectionFactory
>>>                          {
>>>                              HostName = "10.10.8.96",
>>>                              Port = 5672,
>>>                              RequestedHeartbeat = 2
>>>                          };
>>>             using (var connection = cf.CreateConnection())
>>>             using (var model = connection.CreateModel())
>>>             {
>>>                 Thread.Sleep(TimeSpan.FromSeconds(1));
>>>             }
>>>         }
>> 
>>> On Thu, Dec 29, 2011 at 2:59 AM, Simone Busoli <simone.bus... at gmail.com>
>>> wrote:
>> 
>>>> Hi Dave, although counterintuitive the documentation of the .NET client
>>> states that explicitly. The connection closure/disposal is not idempotent,
>>> i.e. you shall not call it twice.
>> 
>>>> On Dec 29, 2011 1:41 AM, "Dave Stevens" <daverstev... at gmail.com> wrote:
>> 
>>>>> I am getting the following exception when disposing a connection. I
>>>>> had previously noticed this when going from RabbitMQ Client 2.5.1 to
>>>>> 2.7.0 which caused me to back out the update. I ended up going to
>>>>> 2.7.1 because I thought I found a shutdown issue in my own code. The
>>>>> exception did not present itself again until I started testing some
>>>>> reconnect logic. I first noticed it again after simply pulling the
>>>>> plug on my network.
>> 
>>>>> System.ObjectDisposedException: Cannot access a disposed object.
>>>>> Object name: 'System.Net.Sockets.Socket'.
>>>>> at System.Net.Sockets.Socket.SetSocketOption(SocketOptionLevel
>>>>> optionLevel, SocketOptionName optionName, Object optionValue)
>>>>> at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.Close()
>>>>> at RabbitMQ.Client.Impl.ConnectionBase.FinishClose()
>>>>> at RabbitMQ.Client.Impl.ConnectionBase.HeartbeatWriteLoop()
>>>>> at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
>>>>> at System.Threading.ExecutionContext.runTryCode(Object userData)
>>>>> at
>> 
>>> System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCle anup(TryCode
>>>>> code, CleanupCode backoutCode, Object userData)
>>>>> at System.Threading.ExecutionContext.RunInternal(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state)
>>>>> at System.Threading.ExecutionContext.Run(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state, Boolean
>>>>> ignoreSyncCtx)
>>>>> at System.Threading.ExecutionContext.Run(ExecutionContext
>>>>> executionContext, ContextCallback callback, Object state)
>>>>> at System.Threading.ThreadHelper.ThreadStart()
>> 
>>>>> This code is reproducible consistently with the following:
>> 
>>>>> using System;
>>>>> using System.Threading;
>>>>> using NUnit.Framework;
>>>>> using RabbitMQ.Client;
>>>>> using RabbitMQ.Client.Framing.v0_9;
>> 
>>>>> namespace BT.ThirdPartyProxy.Functional.Test.FunctionalTests
>>>>> {
>>>>>    [TestFixture]
>>>>>    public class TestingObjectDispositionException
>>>>>    {
>>>>>        [Test(Description = "ObjectDispositionException")]
>>>>>        public void TestFail()
>>>>>        {
>>>>>            var cf = new ConnectionFactory
>>>>>                         {
>>>>>                             HostName = INSERT_IP_HERE,
>>>>>                             Port = 5672,
>>>>>                             RequestedHeartbeat = 2
>>>>>                         };
>>>>>            using (var connection = cf.CreateConnection())
>>>>>            using (var model = connection.CreateModel())
>>>>>            {
>>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>                model.Close(Constants.ReplySuccess, "Goodbye");
>>>>>                connection.Close(Constants.ReplySuccess, "Goodbye");
>>>>>                Thread.Sleep(TimeSpan.FromSeconds(1));
>>>>>            }
>>>>>        }
>>>>>    }
>>>>> }
>> 
>>>>> I am using RabbitMQ.Client.dll 2.7.1.0 in .NET 4.0 app on Windows
>>>>> server 2003 going against RabbitMQ 2.7.0 running on Ubuntu.
>> 
>>>>> Status of node rabbit at xxx ...
>>>>> [{pid,1344},
>>>>>  {running_applications,
>>>>>     [{rabbitmq_management,"RabbitMQ Management Console","2.7.0"},
>>>>>      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.0"},
>>>>>      {amqp_client,"RabbitMQ AMQP Client","2.7.0"},
>>>>>      {rabbit,"RabbitMQ","2.7.0"},
>>>>>      {os_mon,"CPO  CXC 138 46","2.2.5"},
>>>>>      {sasl,"SASL  CXC 138 11","2.1.9.3"},
>>>>>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.0"},
>>>>>      {webmachine,"webmachine","1.7.0-rmq2.7.0-hg"},
>>>>>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.0-git"},
>>>>>      {inets,"INETS  CXC 138 49","5.5.2"},
>>>>>      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>>>>>      {stdlib,"ERTS  CXC 138 10","1.17.3"},
>>>>>      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>>>>>  {os,{unix,linux}},
>>>>>  {erlang_version,
>>>>>     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:8:8] [rq:8]
>>>>> [async-threads:30] [kernel-poll:true]\n"},
>>>>>  {memory,
>>>>>     [{total,31177024},
>>>>>      {processes,11828776},
>>>>>      {processes_used,11772888},
>>>>>      {system,19348248},
>>>>>      {atom,1355273},
>>>>>      {atom_used,1339382},
>>>>>      {binary,84928},
>>>>>      {code,14547474},
>>>>>      {ets,1099944}]},
>>>>>  {vm_memory_high_watermark,0.39999999995232727},
>>>>>  {vm_memory_limit,5034326425}]
>>>>> ...done.
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From minaev at gmail.com  Fri Dec 30 15:34:38 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 30 Dec 2011 19:34:38 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EFDC47D.7060204@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<4EE72C17.5010109@rabbitmq.com>
	<CANTUpDBtGGtvTBaxMMtvJfG2A0VYe+=8OGtF4j8zr=65+3sN9Q@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
Message-ID: <CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>

Thank you very much. I will install it today or tomorrow, but our
system was switched over to another installation. Besides, I do not
expect intensive load till after 10 January, the end of Russian New
Year vacations.

But I am still curious about the fact that until about two months ago
our experience with RabbitMQ was very good. We had version 2.1 or 2.2
then and it worked fine. The problems started when I moved Rabbit to
another server and upgraded it. Either the bug was introduced between
versions 2.2 and 2.6.1, or it is related to some changes in the server
environment. Is it possible to find out whether versions 2.1-2.2 were
also influenced by the problem?


On 30 December 2011 18:02, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 30/12/11 12:11, Matthias Radestock wrote:
>>
>> When the tcp stack notifies the acceptor of an error
>> other than 'closed', the acceptor carries on but does not invoke
>> prim_inet:async_accept/2 to be notified of the next connection attempt.
>>
>> I will file a bug for this. Should be easy to fix, though we cannot be
>> certain that this is definitely the problem.
>
>
> Here's a proposed fix:
>
> http://hg.rabbitmq.com/rabbitmq-server/rev/ca0392ca0fc1
>
> I am attaching a tcp_acceptor.beam with that fix, compiled for R15, that you
> can drop in place of the existing file. I'd be interested a) if that solves
> the problem for you, and b) what error gets logged - watch out for s.t. like
>
> =ERROR REPORT==== 30-Dec-2011::13:45:01 ===
> failed to accept TCP connection on [::]:5672: some_error
>
> in the logs.
>
>
> Regards,
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From matthias at rabbitmq.com  Fri Dec 30 15:44:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Dec 2011 15:44:46 +0000
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>	<4EF2FBAC.2010208@rabbitmq.com>	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>	<4EF30590.9010103@rabbitmq.com>	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>	<4EF30B67.1070401@rabbitmq.com>	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>	<4EF30FE4.8060100@rabbitmq.com>	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>	<4EF3162A.7040009@rabbitmq.com>	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>	<4EFC3450.40901@rabbitmq.com>	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>	<4EFDAA72.9090605@rabbitmq.com>	<4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
Message-ID: <4EFDDC6E.8060200@rabbitmq.com>

Dmitri,

On 30/12/11 15:34, Dmitri Minaev wrote:
> But I am still curious about the fact that until about two months ago
> our experience with RabbitMQ was very good. We had version 2.1 or 2.2
> then and it worked fine. The problems started when I moved Rabbit to
> another server and upgraded it. Either the bug was introduced between
> versions 2.2 and 2.6.1, or it is related to some changes in the server
> environment. Is it possible to find out whether versions 2.1-2.2 were
> also influenced by the problem?

As I said, the problem I identified has been around for more than three 
years.

The likely trigger is some obscure condition in the network stack. So it 
is quite conceivable that the move to a different server made this 
happen with a much higher probability than before. For example, it looks 
like you are now using IPv6 - was that the case before the move too?


Matthias.

From andrius.norkaitis at oryo.lt  Fri Dec 30 15:48:48 2011
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 30 Dec 2011 17:48:48 +0200
Subject: [rabbitmq-discuss] RabbitMQ Direct vs Topic exchange performance
	with simple routing keys
Message-ID: <004901ccc70a$8503c940$8f0b5bc0$@oryo.lt>

Hi All,

Just quick question:

I have queue which should bind with several keys such as "ID1", "ID2" etc.
and with complex key "Rounting.1.*"
Should I use two different type of exchanges (direct and topic) or could
just use single topic exchange?
Will there be any performance differences?


Best regards,
Andrius


From minaev at gmail.com  Fri Dec 30 15:54:06 2011
From: minaev at gmail.com (Dmitri Minaev)
Date: Fri, 30 Dec 2011 19:54:06 +0400
Subject: [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
In-Reply-To: <4EFDDC6E.8060200@rabbitmq.com>
References: <CANTUpDBuF30tFVcdsG0kcc1in9nwphvaa=L6LPeOenPuhdU7sw@mail.gmail.com>
	<CANTUpDDS5NowFNe-1XC021M3yz04Dz02+xyarDt0S4hwp85Q_Q@mail.gmail.com>
	<4EF2FBAC.2010208@rabbitmq.com>
	<CANTUpDB48e06UgS56bxoVcr7zCj_Zv7mr_yjjwEZ7=pgVErBdg@mail.gmail.com>
	<4EF30590.9010103@rabbitmq.com>
	<CANTUpDDbJpoy3oKWjZozLojXqwUireK5Nn2sNNzKVTpdgvJbhQ@mail.gmail.com>
	<4EF30B67.1070401@rabbitmq.com>
	<CANTUpDBqSdS_vENHa63pEjJVcBA8wYVoKz00na3cGLgJn0vkuA@mail.gmail.com>
	<4EF30FE4.8060100@rabbitmq.com>
	<CANTUpDCTBEM1F9-g+8USa2jUuLT6CM2i72y+OhAzeGX+tP=heQ@mail.gmail.com>
	<4EF3162A.7040009@rabbitmq.com>
	<CANTUpDAdvha2aG1zckpywpK-0irDtuDw9en6xJ3Jbr__k7nx8g@mail.gmail.com>
	<CANTUpDA68DkfYF+45rp3E9AQ9p-M_kK1ff9EzOVX7Hmpkz2GwA@mail.gmail.com>
	<4EFC3450.40901@rabbitmq.com>
	<CANTUpDCZNf7+WahP_Y6osyVX+PuxwN7gZnspystbwgPcc-q5nA@mail.gmail.com>
	<4EFDAA72.9090605@rabbitmq.com> <4EFDC47D.7060204@rabbitmq.com>
	<CANTUpDBbvHcQx+pANZLTxYiH010UmXZJDUweW9XwOLLwRT8gMw@mail.gmail.com>
	<4EFDDC6E.8060200@rabbitmq.com>
Message-ID: <CANTUpDAHi9K_mAHa8hFHTGGy_iAh6ZNWvNsq6kGvDjLn45B5TA@mail.gmail.com>

We did not switch to IPv6 intentionally. I didn't even notice this
until some time ago, trying to find the cause of those troubles. I do
not think, though, that this is relevant, because the problem
persisted even when Rabbit was configured to work with v4 only.

I have installed that file and restarted Rabbit. Also, I asked the
developers whether they can stress-test the server. I will let you
know as soon as possible.

Thanks!

On 30 December 2011 19:44, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Dmitri,
>
>
> On 30/12/11 15:34, Dmitri Minaev wrote:
>>
>> But I am still curious about the fact that until about two months ago
>> our experience with RabbitMQ was very good. We had version 2.1 or 2.2
>> then and it worked fine. The problems started when I moved Rabbit to
>> another server and upgraded it. Either the bug was introduced between
>> versions 2.2 and 2.6.1, or it is related to some changes in the server
>> environment. Is it possible to find out whether versions 2.1-2.2 were
>> also influenced by the problem?
>
>
> As I said, the problem I identified has been around for more than three
> years.
>
> The likely trigger is some obscure condition in the network stack. So it is
> quite conceivable that the move to a different server made this happen with
> a much higher probability than before. For example, it looks like you are
> now using IPv6 - was that the case before the move too?
>
>
> Matthias.



-- 
With best regards,
Dmitri Minaev

From steve at rabbitmq.com  Fri Dec 30 16:02:35 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 30 Dec 2011 16:02:35 +0000
Subject: [rabbitmq-discuss] Failed to configure Rabbitmq HA(pacemaker)
In-Reply-To: <CAKrFU7U+YqRpThUKYezVQ8omvZE0z1473--ugesof77Mvnjf7Q@mail.gmail.com>
References: <CAKrFU7V5221mxjoomqqsoD-ejTbiOmRgKwUmLP+gRwaq438Jfw@mail.gmail.com>
	<19860788.209.1325167304932.JavaMail.geo-discussion-forums@vbmi7>
	<CAKrFU7U+YqRpThUKYezVQ8omvZE0z1473--ugesof77Mvnjf7Q@mail.gmail.com>
Message-ID: <89EB3837-F2CB-4488-8E9D-B92BEDEF4F06@rabbitmq.com>

I'm just guessing, but there is this on the pacemaker page:

> The main trick to HA Rabbit is to ensure that when the passive node becomes
> the active node, it must have the same node-name as the failed node. It must
> also have read and write access to the files in the shared storage, and if
> it's going to also be part of a cluster then it must also have the same
> Erlang cookie.
> 
> The server runs as the user rabbitmq which is a member of the group
> rabbitmq. You must ensure that this user and group have the same UIDs and
> GIDs on both nodes. You can probably save yourself some time by explicitly
> creating the rabbitmq user and group with the same UID and GID on all nodes
> before installing the RabbitMQ server at all. If necessary, edit/etc/passwd
> and /etc/group on both nodes, and then reinstall the RabbitMQ server to
> ensure all necessary files are owned by the correct user and group.

That could explain why the slave doesn't 'promote' properly.

However, that said, there is also this:

> This page documents a legacy technique for achieving active-passive high
> availability with RabbitMQ. Active-active mirrored queues are easier to use
> and do not impose a delay at failover.

So, yes, pacemaker HA is a 'legacy' technique though it should still work
and it is possible that in certain circumstances it may offer advantages.
However, closely coupled rabbit nodes in a cluster with mirrored queues
offers the best HA solution so far.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
avoirdupois (phr.) 'Would you like peas with that?'
distribute (v.) To denigrate an award ceremony.
definite (phr.) 'It's hard of hearing, I think.'
modest (n.) The most mod.

On 30 Dec 2011, at 00:51, Jae Sang Lee wrote:
> active-active HA looks good. but that manual isn't kindly now so I tried to
> HA using pacemaker first.
> HA using pacemaker is old way and don't recommend now?
> 
> 2011/12/29 Joseph Marlin <joseph.a.marlin at gmail.com>
> Is there a specific reason that you do not want to use Rabbit's new built in
> active-active HA? 
> 
> http://www.rabbitmq.com/ha.html
> 

From rishdev at gmail.com  Fri Dec 30 16:11:54 2011
From: rishdev at gmail.com (Rishi Dev)
Date: Fri, 30 Dec 2011 09:11:54 -0700
Subject: [rabbitmq-discuss] Recommendations for AMQP / RabbitMQ
In-Reply-To: <CAMACij6SbTg-1RXgSxEn5+oezNs5NBQLsMwcGB3HPgLtWtFsRA@mail.gmail.com>
References: <CANjYesgF1yuqNtgZOQAQQz9-EQF-kQvtPWq1xStz0Szcmk=DDA@mail.gmail.com>
	<CAMACij6SbTg-1RXgSxEn5+oezNs5NBQLsMwcGB3HPgLtWtFsRA@mail.gmail.com>
Message-ID: <CANjYesjvLpeF2Ge9Qv8y2O8pJgQ8u_8wxyPmnwLshJQ5+qSoJA@mail.gmail.com>

Thank you for your response Alex. I am working on list of parameters and
comparison against few other messaging systems. I will get back to the
group if there is anything specific that our team here has concerns with.


On Thu, Dec 22, 2011 at 10:05 AM, Alex Lovell-Troy <
alex.lovelltroy at gmail.com> wrote:

> The pedantic answer to your question is:
>
> Yes.  My expert opinion is that the RabbitMQ product is production grade.
>
> This mailing list is full of questions like this as well as the
> responses from those of us happily using rabbitMQ in production.  If
> you can be more specific about the concerns that have been raised or
> the metrics you use to guide your production choices, we can probably
> be more helpful.
>
> -alex
>
> On Thu, Dec 22, 2011 at 4:40 PM, Rishi Dev <rishdev at gmail.com> wrote:
> > Friends,
> >
> > We are close to make a decision for Enterprise Messaging system for our
> > organization.
> > We are inclined towards RabbitMQ (AMQP), but our team is little bit
> > concerned ...
> >
> > "It seems like there may be a lot of risk with AMQP right now. Do we feel
> > that the Rabbit MQ product is production grade? "
> >
> > Can some experts help me and give expert opinions?
> >
> > Thank you very much.
> >
> > Rishi
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111230/7a2bd80e/attachment.htm>

From jruiz at johnruiz.com  Fri Dec 30 16:19:27 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Fri, 30 Dec 2011 08:19:27 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
	.NET client
In-Reply-To: <4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>
Message-ID: <c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>

Now that I have all of this working, I need to switch over from an
openssl-based CA to our production CA, which is Active Directory
Certificate Services.  All certificates are issued by the subordinate
enterprise CA --> ISSUE01.devexample.com.

I have a certificate for myself in my personal store on
DC01.devexample.com (Windows Server).

The RabbitMQ Service runs as Local System on APP01.devexample.com
(Windows Server) so there's a certificate for APP01.devexample.com in
the Local Computer's Personal store.

The Root CA certificate is already in Trusted Root Certs on all
machines in the domain devexample.com.  The ISSUE01 CA cert is in the
Intermediate Certification Authority store everywhere as well.

I have exported the Root CA cert to a DER file and then moved it to a
linux machine where I used openssl to convert it to PEM.  I then moved
it back to APP01.  Next, I exported APP01's cert (with private key) to
a PFX file, moved it to a linux machine and extracted the signed
public key cert and the private key cert.

# extract the private key (still password protected)
openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
privateKey.pem

# extract the public cert
openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
app01.pem

# remove the password protection
openssl.exe rsa -in privateKey.pem -out app01-private.pem

I moved all of these PEMs back to APP01 -- the CA's public cert,
APP01's public cert, and APP01's private key.  Here is my
rabbitmq.config

[
  {rabbit, [
     {auth_mechanisms,['EXTERNAL']},
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
                    {certfile,"C:/Keys/app01.pem"},
                    {keyfile,"C:/Keys/app01-private.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]}
].

When I run the code that I've already listed in my blog post, I get
this exception: http://pastebin.com/9USFHWzf

In the rabbit log, I see this: http://pastebin.com/GsWsxLGV

As far as I can tell, I've done everything correctly.  I've ensured
that my code references APP01.devexample.com, exactly as it appears on
the certificate (Subject: CN = APP01.devexample.com).

What should I do/try?

Please help!


On Dec 27, 4:22?pm, John Ruiz <jr... at johnruiz.com> wrote:
> I have figured it out. ?There were two issues.
>
> 1. Add the external mechanism factory to your connection factory's
> auth mechanisms
> ? ? i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
> ExternalMechanismFactory() };
>
> 2. Configure the server's auth_mechanisms variable in your
> rabbitmq.config.
> ? ? Here is my complete rabbitmq.config:
>
> [
> ? {rabbit, [
> ? ? ?{auth_mechanisms,['EXTERNAL']},
> ? ? ?{ssl_listeners, [5671]},
> ? ? ?{ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
> ? ? ? ? ? ? ? ? ? ? {certfile,"C:/Path/To/Your/cert.pem"},
> ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/Path/To/Your/key.pem"},
> ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,true}]}
> ? ?]}
> ].
>
> On Dec 27, 1:16?pm, John Ruiz <jr... at johnruiz.com> wrote:
>
>
>
>
>
>
>
> > Hi All,
>
> > I've successfully followed the SSL tutorial and gotten my .NET client
> > to connect, send, and receive messages over SSL. ?See my blog for the
> > code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>
> > As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
> > and then re-installed the Windows Service. ?Then I re-ran the code I
> > have listed in my blog -- with the addition of a Console.ReadLine() at
> > the end of my using statements so I can see the connection details in
> > the management web app.
>
> > I am still connecting as guest. ?What do I need to do in order to
> > connect as the CN of the Subject on my certificate?
>
> > Thanks!
> > ~ jR
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jruiz at johnruiz.com  Fri Dec 30 16:48:41 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Fri, 30 Dec 2011 08:48:41 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
	.NET client
In-Reply-To: <c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>
	<c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>
Message-ID: <b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>

I have a certificate with the following Subject:
"CN=John Ruiz, CN=Users, DC=devexample, DC=com"

When you look at rabbit_ssl.erl's find_by_type function, (this is my
first time seeing erlang code, btw) I notice that there's a "<-
lists:flatten(RDNs)" line.  I don't know what the result of
lists:flatten will be.  This is probably why the connection suddenly
ends... the user I've created for rabbit isn't matching what the cert
says.

Can anyone help me?

On Dec 30, 11:19?am, John Ruiz <jr... at johnruiz.com> wrote:
> Now that I have all of this working, I need to switch over from an
> openssl-based CA to our production CA, which is Active Directory
> Certificate Services. ?All certificates are issued by the subordinate
> enterprise CA --> ISSUE01.devexample.com.
>
> I have a certificate for myself in my personal store on
> DC01.devexample.com (Windows Server).
>
> The RabbitMQ Service runs as Local System on APP01.devexample.com
> (Windows Server) so there's a certificate for APP01.devexample.com in
> the Local Computer's Personal store.
>
> The Root CA certificate is already in Trusted Root Certs on all
> machines in the domain devexample.com. ?The ISSUE01 CA cert is in the
> Intermediate Certification Authority store everywhere as well.
>
> I have exported the Root CA cert to a DER file and then moved it to a
> linux machine where I used openssl to convert it to PEM. ?I then moved
> it back to APP01. ?Next, I exported APP01's cert (with private key) to
> a PFX file, moved it to a linux machine and extracted the signed
> public key cert and the private key cert.
>
> # extract the private key (still password protected)
> openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
> privateKey.pem
>
> # extract the public cert
> openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
> app01.pem
>
> # remove the password protection
> openssl.exe rsa -in privateKey.pem -out app01-private.pem
>
> I moved all of these PEMs back to APP01 -- the CA's public cert,
> APP01's public cert, and APP01's private key. ?Here is my
> rabbitmq.config
>
> [
> ? {rabbit, [
> ? ? ?{auth_mechanisms,['EXTERNAL']},
> ? ? ?{ssl_listeners, [5671]},
> ? ? ?{ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
> ? ? ? ? ? ? ? ? ? ? {certfile,"C:/Keys/app01.pem"},
> ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/Keys/app01-private.pem"},
> ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,true}]}
> ? ?]}
> ].
>
> When I run the code that I've already listed in my blog post, I get
> this exception:http://pastebin.com/9USFHWzf
>
> In the rabbit log, I see this:http://pastebin.com/GsWsxLGV
>
> As far as I can tell, I've done everything correctly. ?I've ensured
> that my code references APP01.devexample.com, exactly as it appears on
> the certificate (Subject: CN = APP01.devexample.com).
>
> What should I do/try?
>
> Please help!
>
> On Dec 27, 4:22?pm, John Ruiz <jr... at johnruiz.com> wrote:
>
>
>
>
>
>
>
> > I have figured it out. ?There were two issues.
>
> > 1. Add the external mechanism factory to your connection factory's
> > auth mechanisms
> > ? ? i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
> > ExternalMechanismFactory() };
>
> > 2. Configure the server's auth_mechanisms variable in your
> > rabbitmq.config.
> > ? ? Here is my complete rabbitmq.config:
>
> > [
> > ? {rabbit, [
> > ? ? ?{auth_mechanisms,['EXTERNAL']},
> > ? ? ?{ssl_listeners, [5671]},
> > ? ? ?{ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
> > ? ? ? ? ? ? ? ? ? ? {certfile,"C:/Path/To/Your/cert.pem"},
> > ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/Path/To/Your/key.pem"},
> > ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> > ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,true}]}
> > ? ?]}
> > ].
>
> > On Dec 27, 1:16?pm, John Ruiz <jr... at johnruiz.com> wrote:
>
> > > Hi All,
>
> > > I've successfully followed the SSL tutorial and gotten my .NET client
> > > to connect, send, and receive messages over SSL. ?See my blog for the
> > > code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>
> > > As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
> > > and then re-installed the Windows Service. ?Then I re-ran the code I
> > > have listed in my blog -- with the addition of a Console.ReadLine() at
> > > the end of my using statements so I can see the connection details in
> > > the management web app.
>
> > > I am still connecting as guest. ?What do I need to do in order to
> > > connect as the CN of the Subject on my certificate?
>
> > > Thanks!
> > > ~ jR
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From hcoyote at ghostar.org  Fri Dec 30 18:59:32 2011
From: hcoyote at ghostar.org (Travis)
Date: Fri, 30 Dec 2011 12:59:32 -0600
Subject: [rabbitmq-discuss] Memory leak when using shovels?
In-Reply-To: <4EF0DFFA.4070705@rabbitmq.com>
References: <CAChq9g0SYyiZEEo_MR-Z9gEr1X_JYx1hUC3JukCUxEJpa6oVww@mail.gmail.com>
	<4EF0DFFA.4070705@rabbitmq.com>
Message-ID: <CAChq9g0znWCBEO=wL0-v5HwQzEVMW2Q2gCzeeuMv81yR5suWeQ@mail.gmail.com>

On Tue, Dec 20, 2011 at 1:20 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>> We're seeing a slow leak that grows over 6-8 days on a few instances of
>> rabbitmq that are using the shovel plugin and we're not exactly sure
>> why. ?I'm not sure if this is related to the memory leak we previously
>> reported a few weeks ago that was fixed in 2.7.1
>
>
> Is the shovel publishing to mirrored queues? If so then then it's probably
> the same problem.

It is.

I upgraded to a patched version of 2.6.1 that has the fix y'all
created, but I'm still seeing a slow increase of memory usage for no
apparent reason.

>
> Two observations:
>
> 1) there is a stray 'queue.declare' in the first shovel config. This will
> cause a new queue to be created every time the shovel connection is
> interrupted. You would surely have seen those queues in the management UI
> and rabbitmqctl, so I doubt that's the cause of the leak.

Would this be seen as queues named amqp.gen-<randomname>?  We've been
plagued by those and I never could figure out why.

>
> 2) Instead of the establishing a connection to 'localhost', specify no host
> at all, e.g.
> "amqp://my-user-prod@/my-prod"; that way a more efficient and less fault
> prone direct connection is used instead of a network connection (which is
> also why no password is required).

Interesting.  Thanks!

Travis
-- 
Travis Campbell
travis at ghostar.org

From jruiz at johnruiz.com  Fri Dec 30 19:52:51 2011
From: jruiz at johnruiz.com (John Ruiz)
Date: Fri, 30 Dec 2011 11:52:51 -0800 (PST)
Subject: [rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the
	.NET client
In-Reply-To: <b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>
References: <1ec7c1c8-91ab-4dc2-8467-87d091362144@z17g2000vbe.googlegroups.com>
	<4c33908a-5e73-4b7f-b7cb-e691aed256f6@y7g2000vbe.googlegroups.com>
	<c9696d25-4acc-4d3e-b5e4-a28362dd1dae@d10g2000vbk.googlegroups.com>
	<b5f96060-d33b-4339-9ace-5971453ee57a@z17g2000vbe.googlegroups.com>
Message-ID: <c7288b20-ff6e-4929-b0fd-f7901432df09@d10g2000vbk.googlegroups.com>

See this stackoverflow thread for more information:

http://stackoverflow.com/questions/8683006/this-erlang-code-throws-an-exception-and-i-dont-know-why

Since this is the way that Windows Domains operate out of the box, I
suggest that instead of writing the code such that it throws an
exception, it instead concatenates any CN strings it finds.

At least this way I could have created a "Users John Ruiz" or "John
Ruiz Users" user in RabbitMQ and it would work.  With the
implementation as it stands today, I would need to create my own OU in
AD and then redirect the users container following this article:
http://support.microsoft.com/kb/324949.

The problem is the note at the bottom of that article:

"Some applications require specific security principals to be located
in default containers like CN=Users or CN=Computers. Verify that your
applications have such dependencies before you move them out of the
CN=users and CN=computes containers."

I have already discovered that I cannot move my service accounts
outside of the CN=users container or else many of my Constrained
Delegation scenarios no longer work. (More on constrained delegation
of kerberos credentials here: http://technet.microsoft.com/en-us/library/cc739587%28WS.10%29.aspx).

On Dec 30, 11:48?am, John Ruiz <jr... at johnruiz.com> wrote:
> I have a certificate with the following Subject:
> "CN=John Ruiz, CN=Users, DC=devexample, DC=com"
>
> When you look at rabbit_ssl.erl's find_by_type function, (this is my
> first time seeing erlang code, btw) I notice that there's a "<-
> lists:flatten(RDNs)" line. ?I don't know what the result of
> lists:flatten will be. ?This is probably why the connection suddenly
> ends... the user I've created for rabbit isn't matching what the cert
> says.
>
> Can anyone help me?
>
> On Dec 30, 11:19?am, John Ruiz <jr... at johnruiz.com> wrote:
>
>
>
>
>
>
>
> > Now that I have all of this working, I need to switch over from an
> > openssl-based CA to our production CA, which is Active Directory
> > Certificate Services. ?All certificates are issued by the subordinate
> > enterprise CA --> ISSUE01.devexample.com.
>
> > I have a certificate for myself in my personal store on
> > DC01.devexample.com (Windows Server).
>
> > The RabbitMQ Service runs as Local System on APP01.devexample.com
> > (Windows Server) so there's a certificate for APP01.devexample.com in
> > the Local Computer's Personal store.
>
> > The Root CA certificate is already in Trusted Root Certs on all
> > machines in the domain devexample.com. ?The ISSUE01 CA cert is in the
> > Intermediate Certification Authority store everywhere as well.
>
> > I have exported the Root CA cert to a DER file and then moved it to a
> > linux machine where I used openssl to convert it to PEM. ?I then moved
> > it back to APP01. ?Next, I exported APP01's cert (with private key) to
> > a PFX file, moved it to a linux machine and extracted the signed
> > public key cert and the private key cert.
>
> > # extract the private key (still password protected)
> > openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out
> > privateKey.pem
>
> > # extract the public cert
> > openssl.exe pkcs12 -in publicAndprivate.pfx -clcerts -nokeys -out
> > app01.pem
>
> > # remove the password protection
> > openssl.exe rsa -in privateKey.pem -out app01-private.pem
>
> > I moved all of these PEMs back to APP01 -- the CA's public cert,
> > APP01's public cert, and APP01's private key. ?Here is my
> > rabbitmq.config
>
> > [
> > ? {rabbit, [
> > ? ? ?{auth_mechanisms,['EXTERNAL']},
> > ? ? ?{ssl_listeners, [5671]},
> > ? ? ?{ssl_options, [{cacertfile,"C:/Keys/pki-root-ca.pem"},
> > ? ? ? ? ? ? ? ? ? ? {certfile,"C:/Keys/app01.pem"},
> > ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/Keys/app01-private.pem"},
> > ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> > ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,true}]}
> > ? ?]}
> > ].
>
> > When I run the code that I've already listed in my blog post, I get
> > this exception:http://pastebin.com/9USFHWzf
>
> > In the rabbit log, I see this:http://pastebin.com/GsWsxLGV
>
> > As far as I can tell, I've done everything correctly. ?I've ensured
> > that my code references APP01.devexample.com, exactly as it appears on
> > the certificate (Subject: CN = APP01.devexample.com).
>
> > What should I do/try?
>
> > Please help!
>
> > On Dec 27, 4:22?pm, John Ruiz <jr... at johnruiz.com> wrote:
>
> > > I have figured it out. ?There were two issues.
>
> > > 1. Add the external mechanism factory to your connection factory's
> > > auth mechanisms
> > > ? ? i.e. -- cf.AuthMechanisms = new AuthMechanismFactory[] { new
> > > ExternalMechanismFactory() };
>
> > > 2. Configure the server's auth_mechanisms variable in your
> > > rabbitmq.config.
> > > ? ? Here is my complete rabbitmq.config:
>
> > > [
> > > ? {rabbit, [
> > > ? ? ?{auth_mechanisms,['EXTERNAL']},
> > > ? ? ?{ssl_listeners, [5671]},
> > > ? ? ?{ssl_options, [{cacertfile,"C:/Path/To/Your/cacert.pem"},
> > > ? ? ? ? ? ? ? ? ? ? {certfile,"C:/Path/To/Your/cert.pem"},
> > > ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/Path/To/Your/key.pem"},
> > > ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> > > ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,true}]}
> > > ? ?]}
> > > ].
>
> > > On Dec 27, 1:16?pm, John Ruiz <jr... at johnruiz.com> wrote:
>
> > > > Hi All,
>
> > > > I've successfully followed the SSL tutorial and gotten my .NET client
> > > > to connect, send, and receive messages over SSL. ?See my blog for the
> > > > code:http://blog.johnruiz.com/2011/12/establishing-ssl-connection-to-rabbi....
>
> > > > As the next step, I enabled the plugin "rabbitmq_auth_mechanism_ssl"
> > > > and then re-installed the Windows Service. ?Then I re-ran the code I
> > > > have listed in my blog -- with the addition of a Console.ReadLine() at
> > > > the end of my using statements so I can see the connection details in
> > > > the management web app.
>
> > > > I am still connecting as guest. ?What do I need to do in order to
> > > > connect as the CN of the Subject on my certificate?
>
> > > > Thanks!
> > > > ~ jR
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Dec 30 21:44:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Dec 2011 21:44:04 +0000
Subject: [rabbitmq-discuss] Memory leak when using shovels?
In-Reply-To: <CAChq9g0znWCBEO=wL0-v5HwQzEVMW2Q2gCzeeuMv81yR5suWeQ@mail.gmail.com>
References: <CAChq9g0SYyiZEEo_MR-Z9gEr1X_JYx1hUC3JukCUxEJpa6oVww@mail.gmail.com>	<4EF0DFFA.4070705@rabbitmq.com>
	<CAChq9g0znWCBEO=wL0-v5HwQzEVMW2Q2gCzeeuMv81yR5suWeQ@mail.gmail.com>
Message-ID: <4EFE30A4.7050906@rabbitmq.com>

Travis,

On 30/12/11 18:59, Travis wrote:
> I upgraded to a patched version of 2.6.1 that has the fix y'all
> created, but I'm still seeing a slow increase of memory usage for no
> apparent reason.

Please upgrade to 2.7.1. That way, if there is still is a problem, we 
have a sound basis for continuing our investigation.

>> Two observations:
>>
>> 1) there is a stray 'queue.declare' in the first shovel config.
> [...]
> Would this be seen as queues named amqp.gen-<randomname>?

Yes. And obviously if nothing clears those up they constitute a leak.

Regards,

Matthias.

From jared.biel at bolderthinking.com  Sat Dec 31 00:49:56 2011
From: jared.biel at bolderthinking.com (Jared Biel)
Date: Fri, 30 Dec 2011 18:49:56 -0600
Subject: [rabbitmq-discuss] Unable to build Debian package since 2.7.0
Message-ID: <CAHoS6UY3HRihpybrgUFq59_uGqS6z9EGPhQ-8t+kg-iAdEU07A@mail.gmail.com>

Hello,

We make use of the .dsc .diff and .orig.tgz files present in your apt
repo located at http://rabbitmq.com/debian to perform some
modifications and rebuild using pbuilder. I have been unable to
successfully build a package since 2.7.0 because it fails to compile
one of the plugins (eldap-wrapper.) It appears to die with
"do-package.mk:507: *** Failed to produce eldap-wrapper/build/deps.mk.
?Stop."

Please see the full output of pbuilder here:
http://pastebin.com/raw.php?i=TdnDfaPJ

The only modification that I'm performing is changing -sname to -name
in all files where it's present. This worked prior to 2.7.0 (when the
plugins weren't included in the main source.)

Thanks for your help,
Jared

From preetisp_83 at yahoo.com  Sat Dec 31 06:26:43 2011
From: preetisp_83 at yahoo.com (preeti sp)
Date: Fri, 30 Dec 2011 22:26:43 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ - JSON RPC Https Support?
Message-ID: <1325312803.25063.YahooMailClassic@web39302.mail.mud.yahoo.com>

Hi

I wanted to know If JSON RPC works over https (Secured) and I need documentation link for details on how to make it work?

Thanks,
Preeti

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111230/d15187e7/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Sat Dec 31 14:52:12 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 31 Dec 2011 09:52:12 -0500
Subject: [rabbitmq-discuss] RabbitMQ - JSON RPC Https Support?
In-Reply-To: <1325312803.25063.YahooMailClassic@web39302.mail.mud.yahoo.com>
References: <1325312803.25063.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <CAM8fPiRzN=qScjPkGxGMyKZWhNcbUC0Mi_n6hPMRj=Qjy1qYJQ@mail.gmail.com>

On 31 December 2011 01:26, preeti sp <preetisp_83 at yahoo.com> wrote:
> I wanted to know If JSON RPC works over https (Secured) and I need
documentation link for details on how to make it work?

It doesn't do HTTPS itself: for that, you could put an Apache reverse-proxy
in front. Apache would accept HTTPS connections, and would in turn make a
corresponding HTTP connection to your JSON-RPC service. Any old Apache
tutorial will tell you how to set this up: e.g.
this<http://blogs.adobe.com/cguerrero/2010/10/27/configuring-a-reverse-proxy-with-apache-that-handles-https-connections/>or
any of the other results of this
google search <https://www.google.com/search?q=apache+https+reverse-proxy>.

Regards,
  Tony
--
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111231/a9540d2f/attachment.htm>

