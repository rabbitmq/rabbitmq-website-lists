From tonyg at lshift.net  Thu Jul  1 01:55:22 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 12:55:22 +1200
Subject: [rabbitmq-discuss] Pika and Channel.Flow
In-Reply-To: <AANLkTintzQvPt7jNk--nJ8IDY6Y31OESJV7hCTBsnkcU@mail.gmail.com>
References: <AANLkTikWk7Eu6fVWTGk6zGiFlSSC68wnupjOsWGLpYZv@mail.gmail.com>	<4BF96C32.4020802@rabbitmq.com>	<AANLkTil-pqGPwRRpn-a7vbtyzaO-nGbOOj96_Z-OE61Z@mail.gmail.com>
	<AANLkTintzQvPt7jNk--nJ8IDY6Y31OESJV7hCTBsnkcU@mail.gmail.com>
Message-ID: <4C2BE77A.8030807@lshift.net>

allan bailey wrote:
> If you do a  channel.access_request before every channel.basic_publish
>  (or after ever N publishes), then
> amqplib properly raises the AMQPContentTransmissionForbidden exception
> since the active state will have been
> updated.

I've raised a Pika issue (http://github.com/tonyg/pika/issues#issue/10) for
addressing this in Pika.

Tony

From tonyg at lshift.net  Thu Jul  1 02:19:14 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:19:14 +1200
Subject: [rabbitmq-discuss] RabbitMQ JSON-RPC via GET rather than POST
In-Reply-To: <b0fec7b6-0e51-474e-abc0-7f18aa8a1e78@q13g2000vbm.googlegroups.com>
References: <b0fec7b6-0e51-474e-abc0-7f18aa8a1e78@q13g2000vbm.googlegroups.com>
Message-ID: <4C2BED12.4080804@lshift.net>

Hi Donovan,

Donovan wrote:
> I'm trying to create the equivalent GET version of the POST curl
> above, so that I can do JSON-RPC across domains. POST is not permitted
> by browsers when using jQuery, annoyingly!!!

Ah, cross-domain JSON-RPC. A total PITA.

jQuery, though, definitely does support POST, but maybe not in a cross-domain
situation? You can see our usage of jQuery's POST ajax support here:
http://hg.rabbitmq.com/rabbitmq-jsonrpc-channel/file/4acfad91d6cb/priv/www/rabbitmq-jquery.js#46
(see lines 44-59).

Regards,
  Tony

P.S. you may also be interested in http://reversehttp.net/relay-http-spec.html
from the point-of-view of its applicability to cross-domain work. :-)


From tonyg at lshift.net  Thu Jul  1 02:43:56 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:43:56 +1200
Subject: [rabbitmq-discuss] STOMP plugin problems (was: Claim on new
 ocamlmq broker...)
In-Reply-To: <AANLkTikUftXY-tDNwKVir_8fGlp3NapJoiIToSNf6DvW@mail.gmail.com>
References: <AANLkTikUftXY-tDNwKVir_8fGlp3NapJoiIToSNf6DvW@mail.gmail.com>
Message-ID: <4C2BF2DC.1030007@lshift.net>

Hi Steven,

Steven Davidson wrote:
> I have also installed the ubuntu package via apt-get which according to
> the startup log is v1.7.2. However, I can't seem to install the stomp
> plugin into this installation: I copy the .ez file into a plugins
> directory, run rabbitmq-activate-plugins and start (or restart) rabbit.

As Marek pointed out, there's a mismatch there between the latest STOMP adapter
and the slightly-older version of the core server you're running.

I have on my TODO list to tag the STOMP repository for 1.7.2- and
1.8.0-compatible versions. Until then, as Marek says, running the
tip-of-the-default-branch for the whole system is probably the best thing to do.

Cheers,
  Tony


From tonyg at lshift.net  Thu Jul  1 02:53:04 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:53:04 +1200
Subject: [rabbitmq-discuss] RabbitMQ C library
 function	amqp_simple_wait_frame takes 400 ms
In-Reply-To: <AANLkTimw1KyCa9L_-oQBCCRhG5HMDTiNrxSmOgyV6st9@mail.gmail.com>
References: <AANLkTimw1KyCa9L_-oQBCCRhG5HMDTiNrxSmOgyV6st9@mail.gmail.com>
Message-ID: <4C2BF500.7010904@lshift.net>

Hi Jim,

I think it's possible that Brett is on the right track with his suggestion of
the Nagle algorithm being responsible for the delays. You could try the following:

  int one = 1;
  setsockopt(amqp_get_sockfd(conn),
             IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));

Cheers,
  Tony


Jim Irrer wrote:
> Hi All -
> 
> I'm working on two functions that act as a client-server pair.  They
> use two amq.direct queues to communicate.  When ever either of
> them calls the amqp_simple_wait_frame function, it does not return
> for 436618 microseconds.
> 
> Some other background info that might be relevant:
> 
> If I only send messages in one direction it's really fast.
> 
> Both processes are using separate connectors and different sockets.
> 
> I used the amqp_consumer.c amqp_producer.c code in
> the examples directory as a reference.
> 
> Is there a way to avoid this delay?
> 
> Also ...
> 
> Could I use the same socket in each program as long as it was only
> used by one thread at a time?
> 
> Could I use the same connection in each program if it was only
> used by one thread at a time?
> 
> Thanks for any insights,
> 
> - Jim
> 
> Jim Irrer     irrer at umich.edu <mailto:irrer at umich.edu>       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonyg at lshift.net  Thu Jul  1 02:55:56 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:55:56 +1200
Subject: [rabbitmq-discuss] Passive versus active declaration of
 exchanges and queues
In-Reply-To: <AANLkTimaaNoW4Cqgv6sPD4Xni2AkxMOAQOFDEyKRLrmF@mail.gmail.com>
References: <AANLkTimaaNoW4Cqgv6sPD4Xni2AkxMOAQOFDEyKRLrmF@mail.gmail.com>
Message-ID: <4C2BF5AC.1050506@lshift.net>

Irmo Manie wrote:
> This does makes sense, so in theory, when wanting a passive declaration
> over active, you would first try passive and then active.

Well, another way of looking at it is to try active first, and never use
passive :-) It will succeed if everything is copacetic, and otherwise it will
close the channel with an error. Adding the call to passive doesn't actually
buy you anything.

Cheers,
  Tony


From tonyg at lshift.net  Thu Jul  1 02:57:40 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:57:40 +1200
Subject: [rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
In-Reply-To: <2F12345F-E4A0-4D84-8DDA-83880F37A1CC@npcinternational.com>
References: <2F12345F-E4A0-4D84-8DDA-83880F37A1CC@npcinternational.com>
Message-ID: <4C2BF614.9080800@lshift.net>

Jon Brisbin wrote:
> Upgraded my RabbitMQ server the other day to 1.8.0. Java stuff works fine,
> of course, because I just bumped the version number in Maven. But Ruby AMQP
> gem (v. 0.6.7) is now complaining. Downloaded the amqp-0.9.1.json file and
> re-generated the spec.rb file, which made errors go away, but now it looks
> like queue subscriptions don't work.

What kind of complaining is it doing with the stock 0.6.7 gem? What error
messages are you seeing, and which operation is failing? Is there anything in
the RabbitMQ server logs?

(Note BTW also that the 1.8.0 release of RabbitMQ is an AMQP *0-8* release, not
a 0-9-1 release.)

Tony

From tonyg at lshift.net  Thu Jul  1 02:59:34 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 13:59:34 +1200
Subject: [rabbitmq-discuss] Pika's exceptions (was Re: Pika and Channel.Flow)
In-Reply-To: <AANLkTikVyxnHHr-kdLM9sVXQLC4HAo96a0P4-xzCXi42@mail.gmail.com>
References: <AANLkTikWk7Eu6fVWTGk6zGiFlSSC68wnupjOsWGLpYZv@mail.gmail.com>	<4BF96C32.4020802@rabbitmq.com>	<AANLkTil5dl_1QIp3WCOVKvXVDavpK-qeClb6OcSRI0jn@mail.gmail.com>	<4BF9792E.1000106@rabbitmq.com>
	<AANLkTikVyxnHHr-kdLM9sVXQLC4HAo96a0P4-xzCXi42@mail.gmail.com>
Message-ID: <4C2BF686.9020108@lshift.net>

Hi Jason,

Jason J. W. Williams wrote:
> Until Pika develops to have documented, predictable exceptions we're
> going to stick with py-amqplib and txAMQP. Which is a shame because
> Pika looks like it'll be a very good replacement for py-amqplib.

If you could get the ball rolling by documenting exceptions as you see them,
that'd be a great start.

Tony



From tonyg at lshift.net  Thu Jul  1 03:00:06 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 14:00:06 +1200
Subject: [rabbitmq-discuss] socket read timeout in rabbitmq-c
In-Reply-To: <343701.1413.qm@web31805.mail.mud.yahoo.com>
References: <131339.14680.qm@web31812.mail.mud.yahoo.com>	<4BFB838A.5090900@rabbitmq.com>
	<343701.1413.qm@web31805.mail.mud.yahoo.com>
Message-ID: <4C2BF6A6.50102@lshift.net>

Hi Alex,

Thanks for the patch. It's in our TODO queue now :-)

Regards,
  Tony


alex chen wrote:
> Matthias, 
> 
> attached please find the patch to rabbitmq-c.
> thanks.
> 
> -alex
> 
> 
> 
> ----- Original Message ----
>> From: Matthias Radestock <matthias at rabbitmq.com>
>> To: alex chen <chen650 at yahoo.com>
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Tue, May 25, 2010 1:00:10 AM
>> Subject: Re: [rabbitmq-discuss] socket read timeout in rabbitmq-c
>>
>> Alex,
> 
> apologies for the delay in responding to this ...
> 
> alex chen 
>> wrote:
>> I am wondering if it can support specifying a time out 
>> (e.g.
>> amqp_set_timeout(int timeout)), and add select(timeout) before 
>> the
>> read() in wait_frame?
> 
> That would seem like a worthwhile 
>> addition. Care to submit a patch?
> 
>> We found in several cases that 
>> amqp_channel_open hanged while doing
>> read() in 
>> wait_frame_inner().
> 
> That really shouldn't happen, from an AMQP protocol 
>> perspective. Was there anything noteworthy in the server logs? Is this 
>> reproducible? If so it may help to run via rabbit's tracer 
>> (http://www.rabbitmq.com/examples.html#tracer) or wireshark to see what's 
>> happening at the protocol level and thus determine whether there is a problem at 
>> the server end (highly unlikely) or client.
> 
> 
> Matthias.
> 
> 
>       
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From dking at ketralnis.com  Thu Jul  1 06:31:32 2010
From: dking at ketralnis.com (David King)
Date: Wed, 30 Jun 2010 22:31:32 -0700
Subject: [rabbitmq-discuss] Possible memory leak?
Message-ID: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>

I have an EC2 node running rabbitmq 1.7.2. Take a look at its memory over the last month <http://i.imgur.com/LMf02.png>. Looks like a possible memory leak?

It only has 13 queues which generally sit at 0 (this is a change from the last time we restarted it, obvious from that graph, where we had one queue that would sit at ~70k because it was largely duplicates: we no longer do that), but are medium-traffic (maybe a few tens of new items per second, tops, its CPU over the same period: <http://i.imgur.com/BFhMK.png>), so it's not particularly loaded, and it's not clear where all of that memory is going (although it does belong to beam.smp, so it's not some other process). rabbitmq is the only thing this node does.

We can restart once a month, but this might be a bigger deal for higher-traffic users than us

From tonyg at lshift.net  Thu Jul  1 06:55:35 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 17:55:35 +1200
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
Message-ID: <4C2C2DD7.30104@lshift.net>

I've just uploaded Pika to PyPI for the first time.
http://pypi.python.org/pypi?:action=display&name=pika

It can now be installed with pip, virtualenv etc:

  pip install pika

Regards,
  Tony

From howie at thingy.com  Thu Jul  1 10:13:46 2010
From: howie at thingy.com (Howard Jones)
Date: Thu, 01 Jul 2010 10:13:46 +0100
Subject: [rabbitmq-discuss] In queue statistics, what does 'count' represent?
Message-ID: <4C2C5C4A.5010107@thingy.com>

Hi,

I'm a MQ newbie, so this might well be a stupid question...apologies in
advance.

I'm looking into using RabbitMQ as part of a system monitoring solution
to allow me to have multiple 'dashboard' applications reading the same
data from various sources without polling, and without having to have
the dashboard apps deal with the (non-)availability and varying data
formats of the producers. Not to mention that some of the data sources
are embedded boxes with gutless network stacks.

I have a bunch of small python scripts running happily, feeding syslog,
SNMP and other data into RabbitMQ. I have a generic consumer that just
dumps to the screen, and I also have Graphite going, so far. Final goal
is a C# windows app, a screensaver, and other consumers to do live analysis.

It seemed that with all this monitoring stuff, knowing how many messages
were passing through the queues would be a good thing, so I installed
rabbitmq-status-1.7.0. It shows queues and connections OK, but the
'Count' column never goes up. I assumed it would be a count of messages
over all time.

Is this a fault with my understanding, or with rabbitmq-status? Can I
get what I'm after?

Thanks in advance for any illumination,

Howie

From steven.davidson at physics.org  Thu Jul  1 11:05:20 2010
From: steven.davidson at physics.org (Steven Davidson)
Date: Thu, 1 Jul 2010 11:05:20 +0100
Subject: [rabbitmq-discuss] STOMP plugin problems (was: Claim on new
	ocamlmq broker...)
In-Reply-To: <4C2BF2DC.1030007@lshift.net>
References: <AANLkTikUftXY-tDNwKVir_8fGlp3NapJoiIToSNf6DvW@mail.gmail.com> 
	<4C2BF2DC.1030007@lshift.net>
Message-ID: <AANLkTimTcQOm8dfQozalFS0dH5dLmQBKzybVmcdouzVZ@mail.gmail.com>

Hi Tony (and sorry Marek for the delay replying to you, I'm hoping to get
back to spending time on this tomorrow ;-),


> Until then, as Marek says, running the
> tip-of-the-default-branch for the whole system is probably the best thing
> to do.
>

I'm certainly happy doing this but for future reference is this code
considered reasonably safe to put into production (after system testing
elsewhere)? (I seem to recall things on the default branch have been QA'd?)


Thanks for the advice, both of you!
Steven.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/d2a94d22/attachment.htm>

From tonyg at lshift.net  Thu Jul  1 11:55:13 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 01 Jul 2010 22:55:13 +1200
Subject: [rabbitmq-discuss] STOMP plugin problems (was: Claim on new
 ocamlmq broker...)
In-Reply-To: <AANLkTimTcQOm8dfQozalFS0dH5dLmQBKzybVmcdouzVZ@mail.gmail.com>
References: <AANLkTikUftXY-tDNwKVir_8fGlp3NapJoiIToSNf6DvW@mail.gmail.com>
	<4C2BF2DC.1030007@lshift.net>
	<AANLkTimTcQOm8dfQozalFS0dH5dLmQBKzybVmcdouzVZ@mail.gmail.com>
Message-ID: <4C2C7411.3010903@lshift.net>

Steven Davidson wrote:
> I'm certainly happy doing this but for future reference is this code
> considered reasonably safe to put into production (after system testing
> elsewhere)? (I seem to recall things on the default branch have been
> QA'd?)  

Reasonably so, given that it's not *officially* supported and is still labelled
"experimental" on the website :-)

Many others have indeed put it into production, and this issue has been
discussed recently; see the thread around here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-April/007032.html

Cheers,
  Tony


From majek04 at gmail.com  Thu Jul  1 11:57:38 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 1 Jul 2010 11:57:38 +0100
Subject: [rabbitmq-discuss] In queue statistics,
	what does 'count' 	represent?
In-Reply-To: <4C2C5C4A.5010107@thingy.com>
References: <4C2C5C4A.5010107@thingy.com>
Message-ID: <AANLkTimFB9Ky9wWN7cI23XClPB5SUclG9fi1V1mwmfZg@mail.gmail.com>

Howard,

On Thu, Jul 1, 2010 at 10:13, Howard Jones <howie at thingy.com> wrote:
> It seemed that with all this monitoring stuff, knowing how many messages
> were passing through the queues would be a good thing, so I installed
> rabbitmq-status-1.7.0. It shows queues and connections OK, but the
> 'Count' column never goes up. I assumed it would be a count of messages
> over all time.

In RabbitMQ "queues" can actually store messages if consumers aren't keeping
up with producers. This counter tells how many messages are stored in particular
RabbitMQ queue. If this number is rising, that could mean that your consumer
is too slow.

If this number is zero - that's perfect, you're consuming messages immediately.

I'm afraid there isn't a simple way of telling how many messages has been
forwarded through the queue. If you need this information - you should count
that in your application.

Cheers,
   Marek Majkowski

From majek04 at gmail.com  Thu Jul  1 12:12:42 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 1 Jul 2010 12:12:42 +0100
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>
Message-ID: <AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>

David,

On Thu, Jul 1, 2010 at 06:31, David King <dking at ketralnis.com> wrote:
> I have an EC2 node running rabbitmq 1.7.2. Take a look at its memory over the last month <http://i.imgur.com/LMf02.png>. Looks like a possible memory leak?

In this graph, have you restarted RabbitMQ around Saturday? Or had
this sharp edge happened without your intervention?

> It only has 13 queues which generally sit at 0 (this is a change from the last time we restarted it, obvious from that graph, where we had one queue that would sit at ~70k because it was largely duplicates: we no longer do that), but are medium-traffic (maybe a few tens of new items per second, tops, its CPU over the same period: <http://i.imgur.com/BFhMK.png>), so it's not particularly loaded, and it's not clear where all of that memory is going (although it does belong to beam.smp, so it's not some other process). rabbitmq is the only thing this node does.
>
> We can restart once a month, but this might be a bigger deal for higher-traffic users than us

It won't hurt if you upgraded to the newest RabbitMQ release - 1.8.0.

There might be several causes of the behaviour you described. First,
your specific usage patterns might not play well with garbage
collection. For example, we force full garbage collection run when the
queue is unused for more than 10 seconds. If your queue is constantly
pinged - you're left to Erlang default garbage collection.  That works
well most of the time, but sometimes it's not optimal.

Second thing, currently the broker keeps all currently handled
messages in memory. If your RabbitMQ instance handle 70K messages,
they are all stored in RAM. If that's the case, you could consider
running our experimental code branch, which tries to page out messages
to disk and save RAM.

Cheers,
  Marek Majkowski

From jasonjwwilliams at gmail.com  Thu Jul  1 12:49:56 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 1 Jul 2010 06:49:56 -0500
Subject: [rabbitmq-discuss] Pika's exceptions (was Re: Pika and
	Channel.Flow)
In-Reply-To: <4C2BF686.9020108@lshift.net>
References: <AANLkTikWk7Eu6fVWTGk6zGiFlSSC68wnupjOsWGLpYZv@mail.gmail.com>
	<4BF96C32.4020802@rabbitmq.com>
	<AANLkTil5dl_1QIp3WCOVKvXVDavpK-qeClb6OcSRI0jn@mail.gmail.com>
	<4BF9792E.1000106@rabbitmq.com>
	<AANLkTikVyxnHHr-kdLM9sVXQLC4HAo96a0P4-xzCXi42@mail.gmail.com>
	<4C2BF686.9020108@lshift.net>
Message-ID: <F057276F-F4BC-411B-A326-E4EA016DFE50@gmail.com>

Deal. :) Guess I'll start usin' Pika and put money with mouth. ;)

-J

Sent via iPhone

Is your e-mail Premiere?

On Jun 30, 2010, at 20:59, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> Hi Jason,
> 
> Jason J. W. Williams wrote:
>> Until Pika develops to have documented, predictable exceptions we're
>> going to stick with py-amqplib and txAMQP. Which is a shame because
>> Pika looks like it'll be a very good replacement for py-amqplib.
> 
> If you could get the ball rolling by documenting exceptions as you see them,
> that'd be a great start.
> 
> Tony
> 
> 

From lists at zopyx.com  Thu Jul  1 13:23:23 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 01 Jul 2010 14:23:23 +0200
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <4C2C2DD7.30104@lshift.net>
References: <4C2C2DD7.30104@lshift.net>
Message-ID: <4C2C88BB.7020805@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Tony Garnock-Jones wrote:
> I've just uploaded Pika to PyPI for the first time.
> http://pypi.python.org/pypi?:action=display&name=pika
> 
> It can now be installed with pip, virtualenv etc:
> 
>   pip install pika
> 
> 

Excellent - are there any advantages about using pika
over ampqlib (especially with using Carrot on the top)?

Andreas
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkwsiLsACgkQCJIWIbr9KYyz2ACfTH8YEUzaJwNMhmD3aVwBtdBL
UkMAn3238h+p29HVoh+kFtXuMGwSOuiO
=1LXc
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/bbdbec3d/attachment.vcf>

From majek04 at gmail.com  Thu Jul  1 13:40:37 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 1 Jul 2010 13:40:37 +0100
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <4C2C88BB.7020805@zopyx.com>
References: <4C2C2DD7.30104@lshift.net>
	<4C2C88BB.7020805@zopyx.com>
Message-ID: <AANLkTimQHdkGO6QFYXXK9prBntLPy6Kn11zXAuj_4-Zj@mail.gmail.com>

> Excellent - are there any advantages about using pika
> over ampqlib (especially with using Carrot on the top)?

For example support for AMQP-0.9.1 protocol.

Cheers,
 Marek

From matthias at rabbitmq.com  Thu Jul  1 13:55:06 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Jul 2010 13:55:06 +0100
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>
	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>
Message-ID: <4C2C902A.5010407@rabbitmq.com>

On 01/07/10 12:12, Marek Majkowski wrote:
> It won't hurt if you upgraded to the newest RabbitMQ release - 1.8.0.

...and, more importantly, to Erlang/OTP R13B03 - unless you are running 
that or a more recent Erlang release already.


Regards,

Matthias.

From jon.brisbin at npcinternational.com  Thu Jul  1 14:11:01 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Thu, 1 Jul 2010 08:11:01 -0500
Subject: [rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
In-Reply-To: <4C2BF614.9080800@lshift.net>
References: <2F12345F-E4A0-4D84-8DDA-83880F37A1CC@npcinternational.com>
	<4C2BF614.9080800@lshift.net>
Message-ID: <B925298E-AFD1-4E81-859D-F70D5E52CFDA@npcinternational.com>

Test program trying to get 4 messages in a queue.

The queue:

vcloud.deployment.events	xportal.war		[]


The test code:

#!/opt/ruby-enterprise-1.8.7-2010.02/bin/ruby

require "rubygems"
require "mq"

em_thread = Thread.new { EM.run }
AMQP.start(:host => "mq2.cloud.npci.com", 
           :port => 5672, 
           :user => "cloud", 
           :pass => "vcloud", 
           :vhost => "cloud") do
  puts "Before subscribe"
  MQ.queue("xportal.war").bind("vcloud.deployment.events").subscribe(:ack => true) do |headers, body|
    md5sum = headers.properties[:correlation_id]
    artifact = body
    
    puts "MD5: #{md5sum}"
  end                   
  puts "After subscribe"
end                    

em_thread.join()                                      

+-( ~/scratch ):> ./mq_test.rb 
Before subscribe
After subscribe
/opt/ruby-enterprise-1.8.7-2010.02/lib/ruby/gems/1.8/gems/amqp-0.6.7/lib/mq.rb:225:in `process_frame': PRECONDITION_FAILED - parameters for queue 'xportal.war' in vhost 'cloud' not equivalent in AMQP::Protocol::Queue::Declare on 1 (MQ::Error)
	from ./mq_test.rb:22:in `join'
	from ./mq_test.rb:22


The server log:

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
accepted TCP connection on 0.0.0.0:5672 from 172.16.0.131:63535

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
starting TCP connection <0.793.0> from 172.16.0.131:63535

=ERROR REPORT==== 1-Jul-2010::08:04:36 ===
connection <0.793.0> (running), channel 1 - error:
{amqp_error,precondition_failed,
            "parameters for queue 'xportal.war' in vhost 'cloud' not equivalent",
            'queue.declare'}

=WARNING REPORT==== 1-Jul-2010::08:04:36 ===
exception on TCP connection <0.793.0> from 172.16.0.131:63535
connection_closed_abruptly

=INFO REPORT==== 1-Jul-2010::08:04:36 ===
closing TCP connection <0.793.0> from 172.16.0.131:63535


Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jun 30, 2010, at 8:57 PM, Tony Garnock-Jones wrote:

> Jon Brisbin wrote:
>> Upgraded my RabbitMQ server the other day to 1.8.0. Java stuff works fine,
>> of course, because I just bumped the version number in Maven. But Ruby AMQP
>> gem (v. 0.6.7) is now complaining. Downloaded the amqp-0.9.1.json file and
>> re-generated the spec.rb file, which made errors go away, but now it looks
>> like queue subscriptions don't work.
> 
> What kind of complaining is it doing with the stock 0.6.7 gem? What error
> messages are you seeing, and which operation is failing? Is there anything in
> the RabbitMQ server logs?
> 
> (Note BTW also that the 1.8.0 release of RabbitMQ is an AMQP *0-8* release, not
> a 0-9-1 release.)
> 
> Tony


From lists at zopyx.com  Thu Jul  1 14:16:03 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 01 Jul 2010 15:16:03 +0200
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <AANLkTimQHdkGO6QFYXXK9prBntLPy6Kn11zXAuj_4-Zj@mail.gmail.com>
References: <4C2C2DD7.30104@lshift.net>	<4C2C88BB.7020805@zopyx.com>
	<AANLkTimQHdkGO6QFYXXK9prBntLPy6Kn11zXAuj_4-Zj@mail.gmail.com>
Message-ID: <4C2C9513.8090703@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Marek Majkowski wrote:
>> Excellent - are there any advantages about using pika
>> over ampqlib (especially with using Carrot on the top)?
> 
> For example support for AMQP-0.9.1 protocol.


Tried to switch my consumer from ampqlib to pika by adding
backend_cls='pika' to my BrokerConnection constructor. This
leads to:

  File "bin/consumer-text-processing", line 36, in <module>
    ym.queue.consumer.topictext.main()
  File
"/data/develop/sandboxes/occ/src/ym.queue/ym/queue/consumer/topictext.py",
line 75, in main
    SolrIndexer()
  File
"/data/develop/sandboxes/occ/src/ym.queue/ym/queue/consumer/consumer_base.py",
line 47, in __init__
    consumer  = self.setupConsumer(queue_configuration)
  File
"/data/develop/sandboxes/occ/src/ym.queue/ym/queue/consumer/consumer_base.py",
line 67, in setupConsumer
    durable=True,
  File
"/data/develop/sandboxes/occ/eggs/carrot-0.10.4-py2.6.egg/carrot/messaging.py",
line 230, in __init__
    self.declare()
  File
"/data/develop/sandboxes/occ/eggs/carrot-0.10.4-py2.6.egg/carrot/messaging.py",
line 277, in declare
    arguments=arguments)
  File
"/data/develop/sandboxes/occ/eggs/carrot-0.10.4-py2.6.egg/carrot/backends/pikachu.py",
line 108, in queue_bind
    arguments=arguments)
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/spec.py", line
3007, in queue_bind
    [Queue.BindOk])
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/channel.py",
line 180, in _rpc
    return self.connection._rpc(self.channel_number, method,
acceptable_replies)
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/connection.py", line
325, in _rpc
    self.send_method(channel_number, method)
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/connection.py", line
301, in send_method
    self.send_frame(codec.FrameMethod(channel_number, method))
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/connection.py", line
295, in send_frame
    marshalled_frame = frame.marshal()
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/codec.py",
line 74, in marshal
    pieces = self.method.encode()
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/spec.py", line
757, in encode
    pika.table.encode_table(pieces, self.arguments)
  File
"/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/table.py",
line 60, in encode_table
    for (key, value) in table.iteritems():
AttributeError: 'NoneType' object has no attribute 'iteritems'

Anything I am missing.

Andreas
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkwslRMACgkQCJIWIbr9KYz3zACgpnhGegGLwZdujBnBjQpwfJju
kR4AnR2J6N6X6yxGmaCV1s4cE1/ILe2a
=DOL1
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 330 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/301e2701/attachment-0001.vcf>

From matthew at rabbitmq.com  Thu Jul  1 14:51:14 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 1 Jul 2010 14:51:14 +0100
Subject: [rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
In-Reply-To: <B925298E-AFD1-4E81-859D-F70D5E52CFDA@npcinternational.com>
References: <2F12345F-E4A0-4D84-8DDA-83880F37A1CC@npcinternational.com>
	<4C2BF614.9080800@lshift.net>
	<B925298E-AFD1-4E81-859D-F70D5E52CFDA@npcinternational.com>
Message-ID: <20100701135114.GV11261@rabbitmq.com>

On Thu, Jul 01, 2010 at 08:11:01AM -0500, Jon Brisbin wrote:
> /opt/ruby-enterprise-1.8.7-2010.02/lib/ruby/gems/1.8/gems/amqp-0.6.7/lib/mq.rb:225:in `process_frame': PRECONDITION_FAILED - parameters for queue 'xportal.war' in vhost 'cloud' not equivalent in AMQP::Protocol::Queue::Declare on 1 (MQ::Error)
> 
> =ERROR REPORT==== 1-Jul-2010::08:04:36 ===
> connection <0.793.0> (running), channel 1 - error:
> {amqp_error,precondition_failed,
>             "parameters for queue 'xportal.war' in vhost 'cloud' not equivalent",
>             'queue.declare'}

Yup, looks like you're redeclaring the queue with different parameters
than it was originally declared with. This is something that was changed
with the 1.8.0 release where we're moving closer to 0-9-1 semantics, and
is covered towards the bottom of
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2010-June/000025.html

Matthew

From corbellini.andrea at gmail.com  Thu Jul  1 15:10:35 2010
From: corbellini.andrea at gmail.com (Andrea Corbellini)
Date: Thu, 1 Jul 2010 16:10:35 +0200
Subject: [rabbitmq-discuss] Integrating Pika into Tornado
Message-ID: <AANLkTik9H-erbYqIZxv7mCRJXY6s6Qwb3p-HmPh2ygA8@mail.gmail.com>

Hello everybody,

Recently I've started to work on a project to make Pika work with the
Tornado web server, and I would like receive some feedback from you
before proposing something for merging. The approach I've used
consists of making Pika more event-based. Since code is better that
words, I've attached what I've done so far (there's also a test
script). As you will see, I haven't touched Pika itself yet, instead
I've written a quick and dirty hack based on the library, rewriting
just the relevant parts.

There are two main steps that needs to be done in order to have
something ready to land into the development mainline. First of all,
the `Connection` and `ChannelHandler` classes should be partially
rewritten in order to make them event-oriented. Then, the asyncore and
the blocking adapters needs to be rewritten in order to make them work
with the new code.

The first step is easy: I've already done most of the work. The only
thing that should be done is to replace the calls to
IOStream.read_bytes() and IOStream.write() with two new functions that
should be overridden by the various adapters. Also, it'd be useful to
add a `callback` argument to methods such as `send_frame`,
`wait_for_open` and so on.

The second step instead requires a bit more work. The things to do
are: make the current adapters more event-based and let them use the
two new functions.

So, basically, the current flow:

connect -> drain_events() -> handle frame

will be changed in order to become:

connect -> [wait for data] -> callback1 -> [wait for data] -> callback2 -> ...

where "[wait for data]" depends on the adapter (e.g.: the Tornado's
adapter will use IOLoop, the blocking adapter will read directly from
the socket).


So, that's my propose. I'd happy to answer any of your questions and
to receive any feedback from you.

Thanks,
Andrea
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tamqp.tar.gz
Type: application/x-gzip
Size: 7237 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/b4e22fe7/attachment.bin>

From shane at digitalsanctum.com  Thu Jul  1 17:36:13 2010
From: shane at digitalsanctum.com (Shane)
Date: Thu, 1 Jul 2010 09:36:13 -0700 (PDT)
Subject: [rabbitmq-discuss] chaining gateways via Java client?
Message-ID: <2e047001-584f-4460-a08e-361527c81141@j8g2000yqd.googlegroups.com>

Does anyone have an example of chaining gateways using the Java client?

From irrer at umich.edu  Thu Jul  1 19:08:03 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 1 Jul 2010 14:08:03 -0400
Subject: [rabbitmq-discuss] RabbitMQ C library function
	amqp_simple_wait_frame takes 400 ms
In-Reply-To: <4C2BF500.7010904@lshift.net>
References: <AANLkTimw1KyCa9L_-oQBCCRhG5HMDTiNrxSmOgyV6st9@mail.gmail.com>
	<4C2BF500.7010904@lshift.net>
Message-ID: <AANLkTim_evbysMBP-pjcV04n9lg-l2ImIroMU9-Eptem@mail.gmail.com>

I had tried setting TCP_NODELAY before but did it this way:

setsockopt(socketFD, SOL_SOCKET, TCP_NODELAY, &one, sizeof(one));

and instead it needed to be done like this:

setsockopt(socketFD, IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));

Yes, that's it.  Runs really fast now.  1.4294 milliseconds per round trip.
It seems like it would be
faster than that, but it's way better than 400ms and is sufficient for our
purposes.  I suppose it's
doing program context switches  If I bump into
any

Thanks for not reading the part of my post that said that I had already
tried this, and then posting the
correct version of the call.  :)    And as a bonus you don't have to be root
do to make the call, which
was also suspicious because you can do it in Java without being root.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Wed, Jun 30, 2010 at 9:53 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Jim,
>
> I think it's possible that Brett is on the right track with his suggestion
> of
> the Nagle algorithm being responsible for the delays. You could try the
> following:
>
>  int one = 1;
>  setsockopt(amqp_get_sockfd(conn),
>             IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));
>
> Cheers,
>  Tony
>
>
> Jim Irrer wrote:
> > Hi All -
> >
> > I'm working on two functions that act as a client-server pair.  They
> > use two amq.direct queues to communicate.  When ever either of
> > them calls the amqp_simple_wait_frame function, it does not return
> > for 436618 microseconds.
> >
> > Some other background info that might be relevant:
> >
> > If I only send messages in one direction it's really fast.
> >
> > Both processes are using separate connectors and different sockets.
> >
> > I used the amqp_consumer.c amqp_producer.c code in
> > the examples directory as a reference.
> >
> > Is there a way to avoid this delay?
> >
> > Also ...
> >
> > Could I use the same socket in each program as long as it was only
> > used by one thread at a time?
> >
> > Could I use the same connection in each program if it was only
> > used by one thread at a time?
> >
> > Thanks for any insights,
> >
> > - Jim
> >
> > Jim Irrer     irrer at umich.edu <mailto:irrer at umich.edu>       (734)
> 647-4409
> > University of Michigan Hospital Radiation Oncology
> > 519 W. William St.             Ann Arbor, MI 48103
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/5e462783/attachment-0001.htm>

From irrer at umich.edu  Thu Jul  1 19:08:59 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 1 Jul 2010 14:08:59 -0400
Subject: [rabbitmq-discuss] RabbitMQ C library function
	amqp_simple_wait_frame takes 400 ms
In-Reply-To: <AANLkTim_evbysMBP-pjcV04n9lg-l2ImIroMU9-Eptem@mail.gmail.com>
References: <AANLkTimw1KyCa9L_-oQBCCRhG5HMDTiNrxSmOgyV6st9@mail.gmail.com>
	<4C2BF500.7010904@lshift.net>
	<AANLkTim_evbysMBP-pjcV04n9lg-l2ImIroMU9-Eptem@mail.gmail.com>
Message-ID: <AANLkTinKUM6-MhH1V9I9FOLtp2yKaOKimFcE35Ybyn6N@mail.gmail.com>

I suggest modifying the C client to set TCP_NODELAY in the amqp_open_socket
function.  The
Java version of the code seems to do this in the SocketFrameHandler class
with the setTcpNoDelay
call.  It seems like this would be the preferred mode in most situations and
should be the default
behavior.  If the user does not like it, they can always turn it off by
calling setsockopt.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Jul 1, 2010 at 2:08 PM, Jim Irrer <irrer at umich.edu> wrote:

> I had tried setting TCP_NODELAY before but did it this way:
>
> setsockopt(socketFD, SOL_SOCKET, TCP_NODELAY, &one, sizeof(one));
>
> and instead it needed to be done like this:
>
> setsockopt(socketFD, IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));
>
> Yes, that's it.  Runs really fast now.  1.4294 milliseconds per round
> trip.  It seems like it would be
> faster than that, but it's way better than 400ms and is sufficient for our
> purposes.  I suppose it's
> doing program context switches  If I bump into
> any
>
> Thanks for not reading the part of my post that said that I had already
> tried this, and then posting the
> correct version of the call.  :)    And as a bonus you don't have to be
> root do to make the call, which
> was also suspicious because you can do it in Java without being root.
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Wed, Jun 30, 2010 at 9:53 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:
>
>> Hi Jim,
>>
>> I think it's possible that Brett is on the right track with his suggestion
>> of
>> the Nagle algorithm being responsible for the delays. You could try the
>> following:
>>
>>  int one = 1;
>>  setsockopt(amqp_get_sockfd(conn),
>>             IPPROTO_TCP, TCP_NODELAY, &one, sizeof(one));
>>
>> Cheers,
>>  Tony
>>
>>
>> Jim Irrer wrote:
>> > Hi All -
>> >
>> > I'm working on two functions that act as a client-server pair.  They
>> > use two amq.direct queues to communicate.  When ever either of
>> > them calls the amqp_simple_wait_frame function, it does not return
>> > for 436618 microseconds.
>> >
>> > Some other background info that might be relevant:
>> >
>> > If I only send messages in one direction it's really fast.
>> >
>> > Both processes are using separate connectors and different sockets.
>> >
>> > I used the amqp_consumer.c amqp_producer.c code in
>> > the examples directory as a reference.
>> >
>> > Is there a way to avoid this delay?
>> >
>> > Also ...
>> >
>> > Could I use the same socket in each program as long as it was only
>> > used by one thread at a time?
>> >
>> > Could I use the same connection in each program if it was only
>> > used by one thread at a time?
>> >
>> > Thanks for any insights,
>> >
>> > - Jim
>> >
>> > Jim Irrer     irrer at umich.edu <mailto:irrer at umich.edu>       (734)
>> 647-4409
>> > University of Michigan Hospital Radiation Oncology
>> > 519 W. William St.             Ann Arbor, MI 48103
>> >
>> >
>> > ------------------------------------------------------------------------
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/2688fe01/attachment.htm>

From dking at ketralnis.com  Thu Jul  1 20:01:33 2010
From: dking at ketralnis.com (David King)
Date: Thu, 1 Jul 2010 12:01:33 -0700
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <4C2C902A.5010407@rabbitmq.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>
	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>
	<4C2C902A.5010407@rabbitmq.com>
Message-ID: <9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>

>> I have an EC2 node running rabbitmq 1.7.2. Take a look at its memory over the last month <http://i.imgur.com/LMf02.png>. Looks like a possible memory leak?
> In this graph, have you restarted RabbitMQ around Saturday? Or had
> this sharp edge happened without your intervention?

Yes, that's when I last restarted rabbit. We have to take our site down to do so, and that's not desirable.

> It won't hurt if you upgraded to the newest RabbitMQ release - 1.8.0.
> ...and, more importantly, to Erlang/OTP R13B03 - unless you are running that or a more recent Erlang release already.

According to that graph I'm going to have to restart the node soon anyway, so I'll try that, but if it doesn't fix a known leak that's unlikely to help, right? As for Erlang, we're running R13B-4.

> There might be several causes of the behaviour you described. First,
> your specific usage patterns might not play well with garbage
> collection. For example, we force full garbage collection run when the
> queue is unused for more than 10 seconds. If your queue is constantly
> pinged - you're left to Erlang default garbage collection.  That works
> well most of the time, but sometimes it's not optimal.

That's possible, but Erlang's default garbage collector is a stop-the-world (per-process) collector, so it's shouldn't be *that* dependent on load, it just just introduce pauses per-queue (which would actually be fine for our use-case)

> Second thing, currently the broker keeps all currently handled
> messages in memory. If your RabbitMQ instance handle 70K messages,
> they are all stored in RAM. If that's the case, you could consider
> running our experimental code branch, which tries to page out messages
> to disk and save RAM.

Right, that's why I said that we *don't* do that anymore. I thought someone might remember me from before (when we were doing that) and say "well you have this big queue so don't do that", and I wanted to pre-empt that by saying that we don't do it anymore so that I could avoid writing this paragraph right here. So to be clear, we have 13 queues that all sit at 0 backlog basically all of the time. Certainly no queues that grow at the same rate our memory does.

From matthias at rabbitmq.com  Thu Jul  1 21:23:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Jul 2010 21:23:07 +0100
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>	<4C2C902A.5010407@rabbitmq.com>
	<9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>
Message-ID: <4C2CF92B.7020008@rabbitmq.com>

David,

David King wrote:
>> this sharp edge happened without your intervention?
> 
> Yes, that's when I last restarted rabbit. We have to take our site
> down to do so, and that's not desirable.

If you just let it run, what happens?

> According to that graph I'm going to have to restart the node soon
> anyway, so I'll try that, but if it doesn't fix a known leak that's
> unlikely to help, right? As for Erlang, we're running R13B-4.

We have seen a few instances of peculiar interaction between the rabbit 
code and the Erlang VM when it comes to memory usage. Even minor and 
unrelated changes can alter the memory consumption pattern 
significantly. It is for that reason, and in order to make it easier for 
us to investigate the problem further, that we recommend running the 
latest release of Rabbit. As for Erlang/OTP, R13B-4 is recent enough.

>> your specific usage patterns might not play well with
>> garbage collection. For example, we force full garbage collection
>> run when the queue is unused for more than 10 seconds. If your
>> queue is constantly pinged - you're left to Erlang default garbage
>> collection.  That works well most of the time, but sometimes it's
>> not optimal.
> 
> That's possible, but Erlang's default garbage collector is a
> stop-the-world (per-process) collector, so it's shouldn't be *that*
> dependent on load, it just just introduce pauses per-queue (which
> would actually be fine for our use-case)

The default Erlang gc performs garbage collections after a certain 
number of reductions, and that number is so high that a queue process 
which does work infrequently may not perform a gc for a very long time 
indeed. That's particularly noticeable when the message sizes are large. 
What's the average and max message size in your set up?

> So to be clear, we have 13
> queues that all sit at 0 backlog basically all of the time. Certainly
> no queues that grow at the same rate our memory does. 

How are you measuring the queue length? With 'rabbitmqctl list_queues'?

Are any of the other items which can be listed with rabbitmqctl - 
exchanges, bindings, connections, channels, consumers - growing?

Also, have you installed any plug-ins?


Regards,

Matthias.

From irrer at umich.edu  Thu Jul  1 21:29:16 2010
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 1 Jul 2010 16:29:16 -0400
Subject: [rabbitmq-discuss] C client and thread safety
Message-ID: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>

Greetings -

Firstly, I remain impressed with Rabbit as a group that can make solid,
useful
software.

I'm working with the RabbitMQ C client, and had a few questions
about thread safety.  In particular:

Must a socket returned by amqp_open_socket be exclusively
associated with one connection, or can it be used for multiple
connections?

Must a socket returned by amqp_open_socket be exclusively
used by one thread, or can it be used by multiple threads?

Must a connection returned by amqp_new_connection be exclusively
used to read from or write to one channel/queue, or is using multiple ok,
even in a multi-threaded environment.

If any of these can be used by multiple threads, is there a performance
advantage in reusing the same socket or connection, or is using multiple
ones better?

It looks like channels (created with amqp_channel_open) are identified by
(small?)
integers chosen by the application and are associated with the connection.
This
means that it is the responsibility of the application to choose unique
numbers,
properly close them, etc..   It would seem cleaner to pass a connection as a
single parameter to amqp_channel_open and have it return a pointer to a
channel,
and the list of channels would be maintained in the connection.

Also, it looks like amqp_new_connection uses 'calloc' to allocate
memory for a connection, but amqp_connection_close does not do
a 'free' to avoid the memory leak.  Maybe that was intentional, but if
not it should be changed.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100701/52dfe08d/attachment.htm>

From jpellerin at leapfrogonline.com  Thu Jul  1 22:26:16 2010
From: jpellerin at leapfrogonline.com (Jason Pellerin)
Date: Thu, 1 Jul 2010 17:26:16 -0400
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <4C2C9513.8090703@zopyx.com>
References: <4C2C2DD7.30104@lshift.net>
	<AANLkTimQHdkGO6QFYXXK9prBntLPy6Kn11zXAuj_4-Zj@mail.gmail.com>
	<4C2C9513.8090703@zopyx.com>
Message-ID: <201007011726.16416.jpellerin@leapfrogonline.com>

On Thursday 01 July 2010 09:16:03 Andreas Jung wrote:
> Marek Majkowski wrote:
> >> Excellent - are there any advantages about using pika
> >> over ampqlib (especially with using Carrot on the top)?
> >
> > For example support for AMQP-0.9.1 protocol.
>
> Tried to switch my consumer from ampqlib to pika by adding
> backend_cls='pika' to my BrokerConnection constructor. This
> leads to:
>
> "/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/table.py",
> line 60, in encode_table
>     for (key, value) in table.iteritems():
> AttributeError: 'NoneType' object has no attribute 'iteritems'

Same error here. Python 2.6.4, carrot 0.10.5, pika 0.5, talking to rabbit
1.6.0.

JP

CONFIDENTIALITY NOTE
The document(s) accompanying this e-mail transmission, if any, and the e-mail transmittal message containing information from Leapfrog Online Customer Acquisition, LLC is confidential or privileged. The information is intended to be for the use of the individual(s) or entity(ies) named on this e-mail transmission message. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please immediately delete this e-mail and notify us by telephone of the error.

From sigurd.hogsbro at museeka.com  Thu Jul  1 22:56:07 2010
From: sigurd.hogsbro at museeka.com (=?ISO-8859-1?Q?Sigurd_H=F8gsbro?=)
Date: Thu, 1 Jul 2010 14:56:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <4C2C88BB.7020805@zopyx.com>
References: <4C2C2DD7.30104@lshift.net> <4C2C88BB.7020805@zopyx.com>
Message-ID: <32b008b2-271d-46ef-ad7d-858a7002eb22@w12g2000yqj.googlegroups.com>

I switched to pika a while back when I ran into problems with Barry's
amqplib. Specifically:
 - lack of support for flow-control
 - lack of support for content > framesize
 - lack of support to handle reconnection when/if RabbitMQ server is
unreachable/unavailable

I have enjoyed using pika so far, and have recently forked the github
project to add a patch for timeouts on asyncore connection loop. The
patch lets callers override the default 30 sec timeout currently
hardcoded within pika. I hope Tony likes the patch and commits it to
his master.

Cheers,

Sigurd

On Jul 1, 1:23?pm, Andreas Jung <li... at zopyx.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Tony Garnock-Jones wrote:
> > I've just uploaded Pika to PyPI for the first time.
> >http://pypi.python.org/pypi?:action=display&name=pika
>
> > It can now be installed with pip, virtualenv etc:
>
> > ? pip install pika
>
> Excellent - are there any advantages about using pika
> over ampqlib (especially with using Carrot on the top)?
>
> Andreas
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (Darwin)
> Comment: Using GnuPG with Mozilla -http://enigmail.mozdev.org/
>
> iEYEARECAAYFAkwsiLsACgkQCJIWIbr9KYyz2ACfTH8YEUzaJwNMhmD3aVwBtdBL
> UkMAn3238h+p29HVoh+kFtXuMGwSOuiO
> =1LXc
> -----END PGP SIGNATURE-----
>
> ?lists.vcf
> < 1KViewDownload
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonyg at lshift.net  Fri Jul  2 01:39:42 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 02 Jul 2010 12:39:42 +1200
Subject: [rabbitmq-discuss] C client and thread safety
In-Reply-To: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
References: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
Message-ID: <4C2D354E.7060804@lshift.net>

Hi Jim,

Jim Irrer wrote:
> I'm working with the RabbitMQ C client, and had a few questions
> about thread safety.

In general, there is no thread awareness built in to librabbitmq at all. It is
currently the responsibility of applications using the library to ensure that
multiple threads don't screw up the library's state.

That said, there is no longer any global state at all in the library, so if you
stick to one connection (and thus one socket) per thread, you should be fine.

> Must a socket returned by amqp_open_socket be exclusively
> associated with one connection, or can it be used for multiple
> connections?

One connection. Each AMQP connection needs exactly one socket to communicate over.

> Must a socket returned by amqp_open_socket be exclusively
> used by one thread, or can it be used by multiple threads?

The connection associated with the socket must be used by one thread *at a
time*. The locking can get quite complicated when you take into account the way
librabbitmq currently deals with incoming events, so sticking with one
connection for each thread makes life much easier.

> Must a connection returned by amqp_new_connection be exclusively
> used to read from or write to one channel/queue, or is using multiple ok,
> even in a multi-threaded environment.

Multiple are OK, but again, each connection is best kept to a single thread.
Think of multiple channels as separate *transaction* and *error reporting*
contexts; they don't buy much else in current versions of the AMQP protocol :-)

> If any of these can be used by multiple threads, is there a performance
> advantage in reusing the same socket or connection, or is using multiple
> ones better?

Using a single connection with multiple channels means that TCPs
congestion-avoidance counts all AMQP traffic as a single stream, whereas using
multiple connections with a single channel each means that TCP will count each
stream separately. Which is more appropriate to your application depends on the
structure of your network: the former might be more appropriate for a WAN link,
the latter for a LAN or a datacentre, etc.

> It looks like channels (created with amqp_channel_open) are identified
> by (small?)
> integers chosen by the application and are associated with the
> connection.  This
> means that it is the responsibility of the application to choose unique
> numbers,
> properly close them, etc..   It would seem cleaner to pass a connection as a
> single parameter to amqp_channel_open and have it return a pointer to a
> channel,
> and the list of channels would be maintained in the connection.

Yes, there is a lot of per-channel state management the library currently
doesn't do. A set of "active" channel numbers might not be too hard to manage.

> Also, it looks like amqp_new_connection uses 'calloc' to allocate
> memory for a connection, but amqp_connection_close does not do
> a 'free' to avoid the memory leak.  Maybe that was intentional, but if
> not it should be changed.

The amqp_connection_close() function causes an AMQP Connection.Close RPC to
happen on the open socket, but does not then tear down any of the application
state: that's what amqp_destroy_connection() is for. The relevant pairings are
roughly

For local connection state management (calloc/free):
  amqp_new_connection
  amqp_destroy_connection

For remote connection state management (Connection.Open/Tune/Close, once local
connection state exists):
  amqp_login
  amqp_connection_close
...plus interactions required on receipt of a Connection.Close method frame
from the peer.

Cheers,
  Tony


From tonyg at lshift.net  Fri Jul  2 05:36:48 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 02 Jul 2010 16:36:48 +1200
Subject: [rabbitmq-discuss] Ruby AMQP client not 1.8.0 friendly
In-Reply-To: <B925298E-AFD1-4E81-859D-F70D5E52CFDA@npcinternational.com>
References: <2F12345F-E4A0-4D84-8DDA-83880F37A1CC@npcinternational.com>
	<4C2BF614.9080800@lshift.net>
	<B925298E-AFD1-4E81-859D-F70D5E52CFDA@npcinternational.com>
Message-ID: <4C2D6CE0.2060009@lshift.net>

Hi Jon,

Jon Brisbin wrote:
> =ERROR REPORT==== 1-Jul-2010::08:04:36 ===
> connection <0.793.0> (running), channel 1 - error:
> {amqp_error,precondition_failed,
>             "parameters for queue 'xportal.war' in vhost 'cloud' not equivalent",
>             'queue.declare'}

As Matthew said, this is the result of a new server feature in 1.8.0 that
checks the Durable and AutoDelete flags for equivalence across separate
queue.declare calls for a given queue name.

To be clear, you should be fine with the AMQP gem as released, so long as you
are able to change your application to make sure that the Durable and
AutoDelete settings for a given queue are consistent across time.

Regards,
  Tony

From tonyg at lshift.net  Fri Jul  2 06:08:38 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 02 Jul 2010 17:08:38 +1200
Subject: [rabbitmq-discuss] RabbitMQ C library
 function	amqp_simple_wait_frame takes 400 ms
In-Reply-To: <AANLkTinKUM6-MhH1V9I9FOLtp2yKaOKimFcE35Ybyn6N@mail.gmail.com>
References: <AANLkTimw1KyCa9L_-oQBCCRhG5HMDTiNrxSmOgyV6st9@mail.gmail.com>	<4C2BF500.7010904@lshift.net>	<AANLkTim_evbysMBP-pjcV04n9lg-l2ImIroMU9-Eptem@mail.gmail.com>
	<AANLkTinKUM6-MhH1V9I9FOLtp2yKaOKimFcE35Ybyn6N@mail.gmail.com>
Message-ID: <4C2D7456.7000607@lshift.net>

Hi Jim,

I'm glad TCP_NODELAY worked for you in the end! :-)

Jim Irrer wrote:
> I suggest modifying the C client to set TCP_NODELAY in the
> amqp_open_socket function.

I think that sounds reasonable. After all, what we're doing is closer to packet
transmission than stream transmission, by and large, so choosing packet-y
defaults is probably more reasonable than TCP's stream-y defaults.

[...]

I've just tried it out, and it does (as expected) reduce straight-line
throughput a little, but I think as you say, people who need straight-line
stream-like behaviour can always switch TCP_NODELAY back off again.

I'll commit this on a branch -- bug22931 -- and we'll see what the rest of the
team thinks of it.

Thanks,
  Tony


From askh at opera.com  Fri Jul  2 09:01:14 2010
From: askh at opera.com (Ask Solem)
Date: Fri, 2 Jul 2010 10:01:14 +0200
Subject: [rabbitmq-discuss] Pika uploaded to PyPI
In-Reply-To: <4C2C9513.8090703@zopyx.com>
References: <4C2C2DD7.30104@lshift.net>	<4C2C88BB.7020805@zopyx.com>
	<AANLkTimQHdkGO6QFYXXK9prBntLPy6Kn11zXAuj_4-Zj@mail.gmail.com>
	<4C2C9513.8090703@zopyx.com>
Message-ID: <6D5266A0-282E-4481-AE94-CA162A584AB3@opera.com>


On Jul 1, 2010, at 3:16 PM, Andreas Jung wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Marek Majkowski wrote:
>>> Excellent - are there any advantages about using pika
>>> over ampqlib (especially with using Carrot on the top)?
>> 
>> For example support for AMQP-0.9.1 protocol.
> 
> 
> Tried to switch my consumer from ampqlib to pika by adding
> backend_cls='pika' to my BrokerConnection constructor. This
> leads to:
> [...]
> "/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/spec.py", line
> 757, in encode
>    pika.table.encode_table(pieces, self.arguments)
>  File
> "/data/develop/sandboxes/occ/eggs/pika-0.5-py2.6.egg/pika/table.py",
> line 60, in encode_table
>    for (key, value) in table.iteritems():
> AttributeError: 'NoneType' object has no attribute 'iteritems'
> 
> Anything I am missing.


This is because carrot uses None for the empty table instead of an empty dict which
pika expects. I've submitted a patch (http://github.com/ask/pika), hopefully it will be accepted
as amqplib already does support this (and it's a common Python idiom)
-- 
{Ask Solem,
 +47 98435213 | twitter.com/asksol }.


From majek04 at gmail.com  Fri Jul  2 14:22:10 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Jul 2010 14:22:10 +0100
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>
	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>
	<4C2C902A.5010407@rabbitmq.com>
	<9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>
Message-ID: <AANLkTimLz69YprS4gtki9Jy2fzaSqw3391cpAvRG85ev@mail.gmail.com>

On Thu, Jul 1, 2010 at 20:01, David King <dking at ketralnis.com> wrote:
>>> I have an EC2 node running rabbitmq 1.7.2. Take a look at its memory over the last month <http://i.imgur.com/LMf02.png>. Looks like a possible memory leak?
>> In this graph, have you restarted RabbitMQ around Saturday? Or had
>> this sharp edge happened without your intervention?
>
> Yes, that's when I last restarted rabbit. We have to take our site down to do so, and that's not desirable.

Hold on, if you don't have any messages in the queues why does rabbit
eat 3 gigs from the start?

>> It won't hurt if you upgraded to the newest RabbitMQ release - 1.8.0.
>> ...and, more importantly, to Erlang/OTP R13B03 - unless you are running that or a more recent Erlang release already.
>
> According to that graph I'm going to have to restart the node soon anyway, so I'll try that, but if it doesn't fix a known leak that's unlikely to help, right? As for Erlang, we're running R13B-4.

R13B3 introduced a major redesign to garbage collection for binaries.  See here:
http://www.lshift.net/blog/2009/12/01/garbage-collection-in-erlang


Cheers,
  Marek

From emile at rabbitmq.com  Fri Jul  2 14:28:06 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Jul 2010 14:28:06 +0100
Subject: [rabbitmq-discuss] chaining gateways via Java client?
In-Reply-To: <2e047001-584f-4460-a08e-361527c81141@j8g2000yqd.googlegroups.com>
References: <2e047001-584f-4460-a08e-361527c81141@j8g2000yqd.googlegroups.com>
Message-ID: <4C2DE966.2000502@rabbitmq.com>

On 01/07/10 17:36, Shane wrote:
> Does anyone have an example of chaining gateways using the Java client?


Hi Shane,

Can you provide a bit more detail what you are trying to achieve? What
do you mean by gateway?

Emile

From askh at opera.com  Fri Jul  2 14:58:45 2010
From: askh at opera.com (Ask Solem)
Date: Fri, 2 Jul 2010 15:58:45 +0200
Subject: [rabbitmq-discuss] [Ann] Celery 2.0 released
Message-ID: <FF61E404-35B3-4E14-90A6-2C2CB8898F44@opera.com>

============================
Celery 2.0 has been released
============================

We're happy to announce the release of Celery 2.0.

Big thanks to all contributors, testers and users!

What is it?
===========

Celery is an asynchronous task queue/job queue based on distributed
message passing. It is focused on real-time operation, but supports
scheduling as well.

The execution units, called tasks, are executed concurrently on a single
or more worker servers. Tasks can execute asynchronously (in the background)
or synchronously (wait until ready).

Celery is already used in production to process millions of tasks a day.

Celery is written in Python, but the protocol can be implemented in
any language. It can also operate with other languages using webhooks.

The recommended message broker is RabbitMQ, but support for Redis and
databases is also available.

You may also be pleased to know that full Django integration exists,
delivered by the django-celery package.

What's new?
===========

* Django dependency removed.

Django integration has been moved to a separate package
called django-celery.

SQLAlchemy is now used instead of the Django ORM for the database
result store.

* A curses real-time monitor: celeryev.

* Support for soft and hard time limits.

    --time-limit:
        The worker processing the task will be
        killed and replaced with a new process when this is exceeded.

    --soft-time-limit:
        The celery.exceptions.SoftTimeLimitExceeded exception
        will be raised when this is exceeded. The task can catch this to
        clean up before the hard time limit terminates it.

* Periodic tasks schedules can now be expressed using complex
  crontab-like expressions.

    For example, you can now use::

        >>> crontab(minute="*/15")

    or even::

        >>> crontab(minute="*/30", hour="8-17,1-2",
        ...         day_of_week="thu-fri")

* Built-in way to do task callbacks.

    http://celeryq.org/docs/userguide/tasksets.html

* Simplified routing of tasks.

  http://celeryq.org/docs/userguide/routing.html

* TaskSets can now contain several types of tasks.

    Tasksets has been refactored to use a new syntax, please see
    http://celeryq.org/docs/userguide/tasksets.html for more
    information. The previous syntax is still supported but deprecated,
    and will be completely removed in Celery 2.2.

* AMQP result backend can now do polling of results.

    This means it supports ``result.ready()``, ``.successful()``,
    etc.

* AMQP result backend now supports timeouts when waiting
  for results.

* celeryd: --maxtasksperchild

    Defines the maximum number of tasks a pool worker can process
    before the process is terminated and replaced by a new one.

* It's now possible to use the client side of Celery without
  configuration.


And lots more!
The Changelog contains upgrade instructions and a detailed
list of all changes:

http://celeryproject.org/docs/changelog.html

Thank you for reading it.


Resources
=========

:Homepage: http://celeryproject.org

:Download: http://pypi.python.org/pypi/celery

:Documentation: http://celeryproject.org/docs/

:Changelog: http://celeryproject.org/docs/changelog.html

:Code: http://github.com/ask/celery/

:FAQ: http://ask.github.com/celery/faq.html

:Mailing list: http://groups.google.com/group/celery-users

:IRC: #celery at irc.freenode.net.


-- 
{Ask Solem,
  twitter.com/asksol | github.com/ask }.



-- 
{Ask Solem,
 Developer ~ Webteam,
 Opera Software,
 +47 98435213 | twitter.com/asksol }.


From majek04 at gmail.com  Fri Jul  2 15:06:03 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Jul 2010 15:06:03 +0100
Subject: [rabbitmq-discuss] Integrating Pika into Tornado
In-Reply-To: <AANLkTik9H-erbYqIZxv7mCRJXY6s6Qwb3p-HmPh2ygA8@mail.gmail.com>
References: <AANLkTik9H-erbYqIZxv7mCRJXY6s6Qwb3p-HmPh2ygA8@mail.gmail.com>
Message-ID: <AANLkTinI-WPkY2z5Xo0OqXRulgMXDlbaMNfym-DcimN6@mail.gmail.com>

Andrea,

Thanks for the code, it's pretty interesting.

1. Could you publish the code on github?
2. The meat is in client.py, but I don't really get it. Is it an
object that shares interface with connection.py/Connection?
3. AMQPClient.connect is still blocking, right?
4. for example in send_method, aren't you afraid that
self._stream.write() can fail to write all the data to the buffer?
5. I love the "abc" line in close() :)

I'm very much interested in getting something like that working!

Cheers,
  Marek Majkowski


On Thu, Jul 1, 2010 at 15:10, Andrea Corbellini
<corbellini.andrea at gmail.com> wrote:
> Hello everybody,
>
> Recently I've started to work on a project to make Pika work with the
> Tornado web server, and I would like receive some feedback from you
> before proposing something for merging. The approach I've used
> consists of making Pika more event-based. Since code is better that
> words, I've attached what I've done so far (there's also a test
> script). As you will see, I haven't touched Pika itself yet, instead
> I've written a quick and dirty hack based on the library, rewriting
> just the relevant parts.
>
> There are two main steps that needs to be done in order to have
> something ready to land into the development mainline. First of all,
> the `Connection` and `ChannelHandler` classes should be partially
> rewritten in order to make them event-oriented. Then, the asyncore and
> the blocking adapters needs to be rewritten in order to make them work
> with the new code.
>
> The first step is easy: I've already done most of the work. The only
> thing that should be done is to replace the calls to
> IOStream.read_bytes() and IOStream.write() with two new functions that
> should be overridden by the various adapters. Also, it'd be useful to
> add a `callback` argument to methods such as `send_frame`,
> `wait_for_open` and so on.
>
> The second step instead requires a bit more work. The things to do
> are: make the current adapters more event-based and let them use the
> two new functions.
>
> So, basically, the current flow:
>
> connect -> drain_events() -> handle frame
>
> will be changed in order to become:
>
> connect -> [wait for data] -> callback1 -> [wait for data] -> callback2 -> ...
>
> where "[wait for data]" depends on the adapter (e.g.: the Tornado's
> adapter will use IOLoop, the blocking adapter will read directly from
> the socket).
>
>
> So, that's my propose. I'd happy to answer any of your questions and
> to receive any feedback from you.
>
> Thanks,
> Andrea
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From irrer at umich.edu  Fri Jul  2 17:26:27 2010
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 2 Jul 2010 12:26:27 -0400
Subject: [rabbitmq-discuss] Fwd: C client and thread safety
In-Reply-To: <4C2D354E.7060804@lshift.net>
References: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
	<4C2D354E.7060804@lshift.net>
Message-ID: <AANLkTik21LSuCqR8e2c_ADmb-x3ISI4q_WV530cWRLVO@mail.gmail.com>

Tony -

Thanks, that really helps.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


---------- Forwarded message ----------
From: Tony Garnock-Jones <tonyg at lshift.net>
Date: Thu, Jul 1, 2010 at 8:39 PM
Subject: Re: C client and thread safety
To: Jim Irrer <irrer at umich.edu>
Cc: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>


Hi Jim,

Jim Irrer wrote:
> I'm working with the RabbitMQ C client, and had a few questions
> about thread safety.

In general, there is no thread awareness built in to librabbitmq at all. It
is
currently the responsibility of applications using the library to ensure
that
multiple threads don't screw up the library's state.

That said, there is no longer any global state at all in the library, so if
you
stick to one connection (and thus one socket) per thread, you should be
fine.

> Must a socket returned by amqp_open_socket be exclusively
> associated with one connection, or can it be used for multiple
> connections?

One connection. Each AMQP connection needs exactly one socket to communicate
over.

> Must a socket returned by amqp_open_socket be exclusively
> used by one thread, or can it be used by multiple threads?

The connection associated with the socket must be used by one thread *at a
time*. The locking can get quite complicated when you take into account the
way
librabbitmq currently deals with incoming events, so sticking with one
connection for each thread makes life much easier.

> Must a connection returned by amqp_new_connection be exclusively
> used to read from or write to one channel/queue, or is using multiple ok,
> even in a multi-threaded environment.

Multiple are OK, but again, each connection is best kept to a single thread.
Think of multiple channels as separate *transaction* and *error reporting*
contexts; they don't buy much else in current versions of the AMQP protocol
:-)

> If any of these can be used by multiple threads, is there a performance
> advantage in reusing the same socket or connection, or is using multiple
> ones better?

Using a single connection with multiple channels means that TCPs
congestion-avoidance counts all AMQP traffic as a single stream, whereas
using
multiple connections with a single channel each means that TCP will count
each
stream separately. Which is more appropriate to your application depends on
the
structure of your network: the former might be more appropriate for a WAN
link,
the latter for a LAN or a datacentre, etc.

> It looks like channels (created with amqp_channel_open) are identified
> by (small?)
> integers chosen by the application and are associated with the
> connection.  This
> means that it is the responsibility of the application to choose unique
> numbers,
> properly close them, etc..   It would seem cleaner to pass a connection as
a
> single parameter to amqp_channel_open and have it return a pointer to a
> channel,
> and the list of channels would be maintained in the connection.

Yes, there is a lot of per-channel state management the library currently
doesn't do. A set of "active" channel numbers might not be too hard to
manage.

> Also, it looks like amqp_new_connection uses 'calloc' to allocate
> memory for a connection, but amqp_connection_close does not do
> a 'free' to avoid the memory leak.  Maybe that was intentional, but if
> not it should be changed.

The amqp_connection_close() function causes an AMQP Connection.Close RPC to
happen on the open socket, but does not then tear down any of the
application
state: that's what amqp_destroy_connection() is for. The relevant pairings
are
roughly

For local connection state management (calloc/free):
 amqp_new_connection
 amqp_destroy_connection

For remote connection state management (Connection.Open/Tune/Close, once
local
connection state exists):
 amqp_login
 amqp_connection_close
...plus interactions required on receipt of a Connection.Close method frame
from the peer.

Cheers,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100702/49e51671/attachment-0001.htm>

From amenges at vmware.com  Fri Jul  2 18:39:47 2010
From: amenges at vmware.com (Tony Menges)
Date: Fri, 2 Jul 2010 10:39:47 -0700
Subject: [rabbitmq-discuss] Erlang client for amqp_0_9_1 branch broken
Message-ID: <C8537273.78C6%amenges@vmware.com>

It looks like a recent change has broken the build of the Erlang client in the amqp_0_9_1 branch. In particular, the include/amqp_client.hrl file picked up some defines that specify version 8. The change seems to have come in with the merge of bug22885 into amqp_0_9_1.

The build failure is:

$ make
ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info -Duse_specs src/amqp_channel.erl
~/Development/RabbitMQ-Source/rabbitmq-public-umbrella/rabbitmq-erlang-client/include/amqp_client.hrl:29: redefining macro 'PROTOCOL_VERSION_MAJOR'
~/Development/RabbitMQ-Source/rabbitmq-public-umbrella/rabbitmq-erlang-client/include/amqp_client.hrl:30: redefining macro 'PROTOCOL_VERSION_MINOR'
make: *** [ebin/amqp_channel.beam] Error 1

Besides the redefinitions of PROTOCOL_VERSION_MAJOR/MINOR, amqp_client.hrl defines PROTOCOL to amqp_0_8.

In rabbit-server/include/rabbit_framing.hrl:
-define(PROTOCOL_VERSION_MAJOR, 0).
-define(PROTOCOL_VERSION_MINOR, 9).
-define(PROTOCOL_VERSION_REVISION, 1).

In rabbit-erlang-client/include/amqp_client.hrl:
-define(PROTOCOL_VERSION_MAJOR, 0).
-define(PROTOCOL_VERSION_MINOR, 8).
-define(PROTOCOL_HEADER,
        <<"AMQP", 1, 1, ?PROTOCOL_VERSION_MAJOR, ?PROTOCOL_VERSION_MINOR>>).
-define(PROTOCOL, amqp_0_8).

Removing the PROTOCOL_VERSION_MAJOR/MINOR definitions in amqp_client.hrl and changing protocol to amqp_0_9_1 allows the build to succeed; I haven't tested it yet to see if runs correctly (I currently only use the Erlang client for plugins).

Thanks,

Tony Menges

From david at rabbitmq.com  Fri Jul  2 20:37:14 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 02 Jul 2010 20:37:14 +0100
Subject: [rabbitmq-discuss] Error running rabbitmqctl in macports
In-Reply-To: <DB5B9E94-F061-455E-87D2-FBAA71A02C68@borogove.org> (Russell
	Borogove's message of "Fri, 18 Jun 2010 12:34:24 -0700")
References: <DB5B9E94-F061-455E-87D2-FBAA71A02C68@borogove.org>
Message-ID: <yrv4csk41n09h.fsf@dwragg.eng.vmware.com>

Hi Russell,

Russell Borogove <russell at borogove.org> writes:
> When I try to run rabbitmq, though, it errors out trying to read the cookie from my home dir:
> russell at shard ~: sudo rabbitmqctl -setcookie 123 stop
> {error_logger,{{2010,6,18},{12,32,20}},"Error when reading /Users/russell/.erlang.cookie: eacces",[]}
>
> Why is it looking for the cookie there?

Thanks for reporting this problem.  We've managed to reproduce it, and
we expect that a fix will appear in the next release.

In the meanwhile, you can workaround it by setting the HOME environment
variable when you run the rabbitmq scripts, like so:

$ HOME=/opt/local/var/lib/rabbitmq sudo rabbitmq-server

And:

$ HOME=/opt/local/var/lib/rabbitmq sudo rabbitmqctl list_users

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From tonyg at lshift.net  Sat Jul  3 02:59:59 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 03 Jul 2010 13:59:59 +1200
Subject: [rabbitmq-discuss] Pika's exceptions (was Re: Pika and
	Channel.Flow)
In-Reply-To: <F057276F-F4BC-411B-A326-E4EA016DFE50@gmail.com>
References: <AANLkTikWk7Eu6fVWTGk6zGiFlSSC68wnupjOsWGLpYZv@mail.gmail.com>
	<4BF96C32.4020802@rabbitmq.com>
	<AANLkTil5dl_1QIp3WCOVKvXVDavpK-qeClb6OcSRI0jn@mail.gmail.com>
	<4BF9792E.1000106@rabbitmq.com>
	<AANLkTikVyxnHHr-kdLM9sVXQLC4HAo96a0P4-xzCXi42@mail.gmail.com>
	<4C2BF686.9020108@lshift.net>
	<F057276F-F4BC-411B-A326-E4EA016DFE50@gmail.com>
Message-ID: <4C2E999F.8060104@lshift.net>

Cool, thanks Jason. I think I'm suffering from Implementor's Blindness, where
the exceptions, when they happen, are so familiar I scarcely even notice them
anymore before I've corrected the problem that's causing them... having someone
other than me describe their experiences with the exceptions should lead
quickly to some good documentation.

Tony


Jason J. W. Williams wrote:
> Deal. :) Guess I'll start usin' Pika and put money with mouth. ;)
> 
> -J
> 
> Sent via iPhone
> 
> Is your e-mail Premiere?
> 
> On Jun 30, 2010, at 20:59, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> 
>> Hi Jason,
>>
>> Jason J. W. Williams wrote:
>>> Until Pika develops to have documented, predictable exceptions we're
>>> going to stick with py-amqplib and txAMQP. Which is a shame because
>>> Pika looks like it'll be a very good replacement for py-amqplib.
>> If you could get the ball rolling by documenting exceptions as you see them,
>> that'd be a great start.
>>
>> Tony
>>
>>

From dking at ketralnis.com  Sat Jul  3 19:13:08 2010
From: dking at ketralnis.com (David King)
Date: Sat, 3 Jul 2010 11:13:08 -0700
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <4C2CF92B.7020008@rabbitmq.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>	<4C2C902A.5010407@rabbitmq.com>
	<9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>
	<4C2CF92B.7020008@rabbitmq.com>
Message-ID: <C9589553-36D4-4D17-8C72-EDDB19076F87@ketralnis.com>

> If you just let it run, what happens?

I don't know. I guess we can see, but my guess is that it will wake me up at two in the morning to fix the site. That's what usually happens when rabbit crashes, anyway.

> The default Erlang gc performs garbage collections after a certain number of reductions, and that number is so high that a queue process which does work infrequently may not perform a gc for a very long time indeed. That's particularly noticeable when the message sizes are large. What's the average and max message size in your set up?

They're just IDs, so they'll be between 5 and 10 bytes each.

>> So to be clear, we have 13
>> queues that all sit at 0 backlog basically all of the time. Certainly
>> no queues that grow at the same rate our memory does. 
> How are you measuring the queue length? With 'rabbitmqctl list_queues'?

Yes

> Are any of the other items which can be listed with rabbitmqctl - exchanges, bindings, connections, channels, consumers - growing?

That doesn't appear to be true, no

> 
> Also, have you installed any plug-ins?

No

From matthias at rabbitmq.com  Sat Jul  3 21:52:28 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Jul 2010 21:52:28 +0100
Subject: [rabbitmq-discuss] Possible memory leak?
In-Reply-To: <C9589553-36D4-4D17-8C72-EDDB19076F87@ketralnis.com>
References: <B907BD5E-5F73-4AC0-9E7B-667AC3F16A8B@ketralnis.com>	<AANLkTilOjqvg74QrRGk3Q6dpU5GY1rx3GEBdoBnwoOeq@mail.gmail.com>	<4C2C902A.5010407@rabbitmq.com>	<9D15863E-6D3C-420C-983A-85AD359A538A@ketralnis.com>	<4C2CF92B.7020008@rabbitmq.com>
	<C9589553-36D4-4D17-8C72-EDDB19076F87@ketralnis.com>
Message-ID: <4C2FA30C.10100@rabbitmq.com>

David,

David King wrote:
>> If you just let it run, what happens?
> 
> I don't know. I guess we can see, but my guess is that it will wake
> me up at two in the morning to fix the site. That's what usually
> happens when rabbit crashes, anyway.

As long as you are running rabbit 1.8.0, and given the usage pattern you 
describe, it is unlikely that rabbit would actually crash, though it may 
refuse to accept messages from producers (which, I guess, would still be 
a problem). It would be informative to find out whether it actually 
reaches that point.

What memory limit does rabbit think it has? Check the rabbit log for an 
info report along the lines of

=INFO REPORT==== 29-Oct-2009::15:43:27 ===
Memory limit set to 2048MB.

Also, are there any memory alarms in the logs? Look for entries like

=INFO REPORT==== 3-Jul-2010::21:28:31 ===
     alarm_handler: {set,{vm_memory_high_watermark,[]}}


As Marek mentioned your graphs would seem to indicate that rabbit is 
consuming a few gigs of memory right after startup. That doesn't look 
right. A healthy rabbit should eat much less memory than that. For 
example, the rabbit on my development machine starts with a 80MB virtual 
memory footprint, 25 of which is resident.

I am assuming the graph shows the memory usage of the entire machine. 
You said that the memory "does belong to beam.smp", but do you have a 
graph, or even just some data points for only that process?


If the above doesn't yield any clues, perhaps you could grant one of the 
rabbit engineers temporary access to the machine so they can delve into 
the innards of rabbit to figure out where the memory is going? This 
shouldn't affect the operation of your service.

>> What's the average and max message size in your set up?
> 
> They're just IDs, so they'll be between 5 and 10 bytes each.

Are any of the messages published as persistent? Another reason to 
upgrade to 1.8.0 is that there only messages published as persistent 
that go to durable queues actually hit the persister - a change we made 
partially as a result of the investigation into your previous problems.

>> How are you measuring the queue length? With 'rabbitmqctl
>> list_queues'?

How frequently do you run rabbitmqctl?


Regards,

Matthias.

From andrius.norkaitis at oryo.lt  Mon Jul  5 09:05:00 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 5 Jul 2010 11:05:00 +0300
Subject: [rabbitmq-discuss] Synchronous confirmation of delivery to the queue
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAAZzcyUFZXxKplxsFxQl3McBAAAAAA==@oryo.lt>

Hello,

I have publisher which send message to consumer (using direct exchange and
non-durable, autodelete queue) and it needs instant confirmation that the
message is routed to the query. I can't use asynchronous IModel.BasicReturn
event because I need to know is message routed to query instantly after I
call publish method. I think it may be done using autodelete queue,
mandatory and immediate message flags, and transactions. If subscriber is
offline there would be no query to deliver the message so publisher should
get exception after it calls publish method. Could you give me quick sample?

Thanks.
Andrius


From matthew at rabbitmq.com  Mon Jul  5 10:42:02 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Jul 2010 10:42:02 +0100
Subject: [rabbitmq-discuss] Synchronous confirmation of delivery to the
 queue
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAAZzcyUFZXxKplxsFxQl3McBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAAZzcyUFZXxKplxsFxQl3McBAAAAAA==@oryo.lt>
Message-ID: <20100705094201.GB17013@rabbitmq.com>

Hi,

On Mon, Jul 05, 2010 at 11:05:00AM +0300, Andrius Norkaitis wrote:
> I have publisher which send message to consumer (using direct exchange and
> non-durable, autodelete queue) and it needs instant confirmation that the
> message is routed to the query. I can't use asynchronous IModel.BasicReturn
> event because I need to know is message routed to query instantly after I
> call publish method. I think it may be done using autodelete queue,
> mandatory and immediate message flags, and transactions. If subscriber is
> offline there would be no query to deliver the message so publisher should
> get exception after it calls publish method.

The immediate is pretty meaningless in the context of a transaction, and
we largely reinterpret it as mandatory. I suspect you just want to use
mandatory and a transaction.

However note that if you're doing a commit per publish, performance will
be rather slower. This may not affect your application, depending on its
needs.

Matthew

From simon at rabbitmq.com  Mon Jul  5 11:00:39 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 05 Jul 2010 11:00:39 +0100
Subject: [rabbitmq-discuss] Erlang client for amqp_0_9_1 branch broken
In-Reply-To: <C8537273.78C6%amenges@vmware.com>
References: <C8537273.78C6%amenges@vmware.com>
Message-ID: <4C31AD47.6010907@rabbitmq.com>

On 02/07/10 18:39, Tony Menges wrote:
> It looks like a recent change has broken the build of the Erlang
> client in the amqp_0_9_1 branch.

Argh. This was a change that was the start of something that then never 
happened. It shouldn't have been pushed. This is now fixed.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From andrius.norkaitis at oryo.lt  Mon Jul  5 13:39:54 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 5 Jul 2010 15:39:54 +0300
Subject: [rabbitmq-discuss] Synchronous confirmation of delivery to the
	queue
In-Reply-To: <20100705094201.GB17013@rabbitmq.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAAZzcyUFZXxKplxsFxQl3McBAAAAAA==@oryo.lt>
	<20100705094201.GB17013@rabbitmq.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMDP3iijxWhNsuta5Up8u38BAAAAAA==@oryo.lt>

Thanks Matthew.

I tried it, but BasicPublish and TxCommit completes event if there are no
queues to route.

public bool Publish() {
          try{
	ch.TxSelect();
	bool Mandatory = true; Immediate = false;
	ch.BasicPublish("direct", routingKey,Mandatory, Immediate,
basicProperties, body);
	ch.TxCommit();
	return true;
          }
	catch { return false; }
}

I always get TRUE event I there is no consumer/query available.
How to detect that message wasn't published to the queue in same method
calling BasicPublish? I need to return bool flag after trying to publish.

If it is possible only in asynchronous matter using BasicReturn event then I
think I have two options:
1. Lock thread after calling BasicPublish for limited time or while
BasicReturn is returned. (Theading is hard .. Is it good way?)
2. Because I use autodelete query I can check is query available by calling:

bool isConsumerAvailable = false;
try{
ch.QueueDelete(routingKey, true, true, false);
} catch 
{
//if there is no query I get exception code=404, text="NOT_FOUND"
isConsumerAvailable = true;
}

What do you think?

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
Sackman
Sent: Monday, July 05, 2010 12:42 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Synchronous confirmation of delivery to the
queue

Hi,

On Mon, Jul 05, 2010 at 11:05:00AM +0300, Andrius Norkaitis wrote:
> I have publisher which send message to consumer (using direct exchange 
> and non-durable, autodelete queue) and it needs instant confirmation 
> that the message is routed to the query. I can't use asynchronous 
> IModel.BasicReturn event because I need to know is message routed to 
> query instantly after I call publish method. I think it may be done 
> using autodelete queue, mandatory and immediate message flags, and 
> transactions. If subscriber is offline there would be no query to 
> deliver the message so publisher should get exception after it calls
publish method.

The immediate is pretty meaningless in the context of a transaction, and we
largely reinterpret it as mandatory. I suspect you just want to use
mandatory and a transaction.

However note that if you're doing a commit per publish, performance will be
rather slower. This may not affect your application, depending on its needs.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Mon Jul  5 14:14:54 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Jul 2010 14:14:54 +0100
Subject: [rabbitmq-discuss] Synchronous confirmation of delivery to the
 queue
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMDP3iijxWhNsuta5Up8u38BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAAZzcyUFZXxKplxsFxQl3McBAAAAAA==@oryo.lt>
	<20100705094201.GB17013@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMDP3iijxWhNsuta5Up8u38BAAAAAA==@oryo.lt>
Message-ID: <20100705131453.GB19296@rabbitmq.com>

Hi,

On Mon, Jul 05, 2010 at 03:39:54PM +0300, Andrius Norkaitis wrote:
> I tried it, but BasicPublish and TxCommit completes event if there are no
> queues to route.
> 
> public bool Publish() {
>           try{
> 	ch.TxSelect();
> 	bool Mandatory = true; Immediate = false;
> 	ch.BasicPublish("direct", routingKey,Mandatory, Immediate,
> basicProperties, body);
> 	ch.TxCommit();
> 	return true;
>           }
> 	catch { return false; }
> }
> 
> I always get TRUE event I there is no consumer/query available.

Hmm, we do the basic.return first - the following is a transcript, using
the erlang client:

6> Conn = amqp_connection:start_network_link().
<0.58.0>

=INFO REPORT==== 5-Jul-2010::14:09:15 ===
Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)
7> Chan = amqp_connection:open_channel(Conn).  
<0.63.0>
8> amqp_channel:call(Chan, #'tx.select'{}).    
#'tx.select_ok'{}
9> amqp_channel:call(Chan, #'basic.publish'{ routing_key =
<<"no_such_queue">>, mandatory = true }, #amqp_msg{ payload = <<>>,
props = #'P_basic'{} }).
ok
10> 
=ERROR REPORT==== 5-Jul-2010::14:10:28 ===
Channel (<0.63.0>): received {{'basic.return',312,<<"NO_ROUTE">>,<<>>,
                                  <<"no_such_queue">>}, {amqp_msg,
                                                         {'P_basic',
                                                          undefined,undefined,
                                                          undefined,undefined,
                                                          undefined,undefined,
                                                          undefined,undefined,
                                                          undefined,undefined,
                                                          undefined,undefined,
                                                          undefined,undefined},
                                                         <<>>}} but
there is no return handler registered
10> amqp_channel:call(Chan, #'tx.commit'{}).                                                                                                            
#'tx.commit_ok'{}

The commit comes back ok because the message never got stored as part of
the commit because we detected the missing queue early and returned it.
Thus the txn ended up being empty, which is why the commit happened
without error.

> How to detect that message wasn't published to the queue in same method
> calling BasicPublish? I need to return bool flag after trying to publish.

You should install a return handler on the Channel:
ChannelN.setReturnListener. I think you can depend on that being called
before the result of the commit comes back. You'll need to be careful
with different threads, but you should effectively be able to have the
return listener set some sort of boolean, and then only check that
boolean after the commit has returned.

Matthew

From akhil.kodali at gmail.com  Mon Jul  5 15:00:26 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Mon, 5 Jul 2010 19:30:26 +0530
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
Message-ID: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>

Hi,

I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
I was unable to find /etc/rabbitmq/rabbitmq.conf
/etc/rabbitmq is empty.

but the rabbitmq seems to be running fine.

I needed to edit the file to install bql plugin.

Anyone face such issue earlier.

----
Regards,
Akhil Kodali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/dc172474/attachment.htm>

From w.richert at gmx.net  Mon Jul  5 15:07:46 2010
From: w.richert at gmx.net (Willi Richert)
Date: Mon, 05 Jul 2010 16:07:46 +0200
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
Message-ID: <4C31E732.7030202@gmx.net>

Hi,

this is also the case in the former Ubuntu versions. Maybe you post this 
(bug?) to https://launchpad.net/ubuntu/+bugs ?

wr

On 05.07.2010 16:00, Akhil Kodali wrote:
> Hi,
>
> I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
> I was unable to find /etc/rabbitmq/rabbitmq.conf
> /etc/rabbitmq is empty.
>
> but the rabbitmq seems to be running fine.
>
> I needed to edit the file to install bql plugin.
>
> Anyone face such issue earlier.
>
> ----
> Regards,
> Akhil Kodali
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/ba82145a/attachment.htm>

From matthew at rabbitmq.com  Mon Jul  5 15:33:20 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Jul 2010 15:33:20 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
Message-ID: <20100705143320.GF19296@rabbitmq.com>

On Mon, Jul 05, 2010 at 07:30:26PM +0530, Akhil Kodali wrote:
> I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
> I was unable to find /etc/rabbitmq/rabbitmq.conf
> /etc/rabbitmq is empty.

There are no configuration files by default. That is correct.

> I needed to edit the file to install bql plugin.

Yes, in which case you should create the file as necessary.

Matthew

From alexandru at rabbitmq.com  Mon Jul  5 15:38:27 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Mon, 05 Jul 2010 15:38:27 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
Message-ID: <4C31EE63.10405@rabbitmq.com>

Hi,

As you say, it's not really a bug.  If all you need is the bql plugin,
this rabbitmq.config should be fine (you may need to change the user and
password):

[
  {rabbitmq_bql, [
    {user, "guest"},
    {password, "guest"}
  ]}
].

Also, you said /etc/rabbitmq/rabbitmq.conf.   What you want is probably
rabbitmq.config.

Cheers,
Alex

On 07/05/2010 03:00 PM, Akhil Kodali wrote:
> Hi,
>
> I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
> I was unable to find /etc/rabbitmq/rabbitmq.conf
> /etc/rabbitmq is empty.
>
> but the rabbitmq seems to be running fine.
>
> I needed to edit the file to install bql plugin.
>
> Anyone face such issue earlier.
>
> ----
> Regards,
> Akhil Kodali
>
>   
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


From pauljones23 at gmail.com  Mon Jul  5 15:11:37 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Mon, 5 Jul 2010 15:11:37 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
Message-ID: <AANLkTim14koqBPH6vguz074kVfV_Eq1WnGeg5PXRrglO@mail.gmail.com>

Presumably you're wanting to do this to set a custom username/password for
BQL to connect with?

If so, it is /etc/rabbitmq/rabbitmq.config that you'll want to edit. If it
doesn't exist, then you can just create it.

On Mon, Jul 5, 2010 at 3:00 PM, Akhil Kodali <akhil.kodali at gmail.com> wrote:

> Hi,
>
> I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
> I was unable to find /etc/rabbitmq/rabbitmq.conf
> /etc/rabbitmq is empty.
>
> but the rabbitmq seems to be running fine.
>
> I needed to edit the file to install bql plugin.
>
> Anyone face such issue earlier.
>
> ----
> Regards,
> Akhil Kodali
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/2d01744d/attachment-0001.htm>

From andrius.norkaitis at oryo.lt  Mon Jul  5 15:50:41 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 5 Jul 2010 17:50:41 +0300
Subject: [rabbitmq-discuss] .net client and Subscription
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE3EZ7rKemdJuNdlezzY2fcBAAAAAA==@oryo.lt>

Hi. As from 1.8 there is queue equivalence verification I started getting
exception when I declare queue and later use it with Subscription class.

 

ch.QueueDeclare(clientID, false, false, true, true, false, null);

var sub = new Subscription(ch, clientID, false, RabbitMQexchange,
RabbitMQexchangeType, "");

 

As you can see I declare queue with Autodelete flag set to TRUE.

But if I specify queue name, Subscriber tries to re-declare this queue with
autodelete set to FALSE and exception rises.

 

Check the code from the client source:

 

  public Subscription(IModel model, string queueName, bool noAck)

        {

            m_model = model;

            if (queueName == null || queueName.Equals("")) {

                m_queueName = m_model.QueueDeclare();

                m_shouldDelete = true;

            } else {

                m_queueName = m_model.QueueDeclare(queueName);

                m_shouldDelete = false;

            }

            m_consumer = new QueueingBasicConsumer(m_model);

            m_consumerTag = m_model.BasicConsume(m_queueName, m_noAck, null,
m_consumer);

            m_latestEvent = null;

        }

 

Is this expected behaviour? What if I want to subscribe to autodelete queue
using Subscribtion class and specifying the name of the queue?

 

Best regards

Andrius Norkaitis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/f81a8942/attachment.htm>

From andrius.norkaitis at oryo.lt  Mon Jul  5 16:21:19 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 5 Jul 2010 18:21:19 +0300
Subject: [rabbitmq-discuss] .net client and Subscription
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE3EZ7rKemdJuNdlezzY2fcBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE3EZ7rKemdJuNdlezzY2fcBAAAAAA==@oryo.lt>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAEv63Picg/FJmDCz9OnmRtwBAAAAAA==@oryo.lt>

Same thing with Exchange. Look at the Subscription.cs source:

 

public void Bind(string exchangeName, string exchangeType, string
routingKey)

        {

            m_model.ExchangeDeclare(exchangeName, exchangeType);

            m_model.QueueBind(m_queueName, exchangeName, routingKey, false,
null);

        }

 

If I use other exchange than default (non-passive, non-durable,
non-autodelete, and non-internal) I got the exception.

 

 

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andrius
Norkaitis
Sent: Monday, July 05, 2010 5:51 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] .net client and Subscription

 

Hi. As from 1.8 there is queue equivalence verification I started getting
exception when I declare queue and later use it with Subscription class.

 

ch.QueueDeclare(clientID, false, false, true, true, false, null);

var sub = new Subscription(ch, clientID, false, RabbitMQexchange,
RabbitMQexchangeType, "");

 

As you can see I declare queue with Autodelete flag set to TRUE.

But if I specify queue name, Subscriber tries to re-declare this queue with
autodelete set to FALSE and exception rises.

 

Check the code from the client source:

 

  public Subscription(IModel model, string queueName, bool noAck)

        {

            m_model = model;

            if (queueName == null || queueName.Equals("")) {

                m_queueName = m_model.QueueDeclare();

                m_shouldDelete = true;

            } else {

                m_queueName = m_model.QueueDeclare(queueName);

                m_shouldDelete = false;

            }

            m_consumer = new QueueingBasicConsumer(m_model);

            m_consumerTag = m_model.BasicConsume(m_queueName, m_noAck, null,
m_consumer);

            m_latestEvent = null;

        }

 

Is this expected behaviour? What if I want to subscribe to autodelete queue
using Subscribtion class and specifying the name of the queue?

 

Best regards

Andrius Norkaitis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/14c4fcd0/attachment.htm>

From emile at rabbitmq.com  Mon Jul  5 17:08:15 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 05 Jul 2010 17:08:15 +0100
Subject: [rabbitmq-discuss] .net client and Subscription
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAEv63Picg/FJmDCz9OnmRtwBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE3EZ7rKemdJuNdlezzY2fcBAAAAAA==@oryo.lt>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAEv63Picg/FJmDCz9OnmRtwBAAAAAA==@oryo.lt>
Message-ID: <4C32036F.5050903@rabbitmq.com>


Hi Andrius,

Thanks for bringing this to our attention. The less-than-ideal behaviour
you describe is caused partly by changes that were introduced during
AMQP 0.9.1 compatibility. We also did not fully anticipate your use of
the Subscription abstraction, which is to declare queues and exchanges
outside the abstraction.

Your code will continue to work on version 1.7.2 while we consider how
to address the problem. You could also implement your own version of
Subscription, which is a very slim class. By declaring your own queues
and exchanges you are already doing much of that work.

Regards

Emile


On 05/07/10 16:21, Andrius Norkaitis wrote:
> Same thing with Exchange. Look at the Subscription.cs source:
> 
>  
> 
> public void Bind(string exchangeName, string exchangeType, string
> routingKey)
> 
>         {
> 
>             m_model.ExchangeDeclare(exchangeName, exchangeType);
> 
>             m_model.QueueBind(m_queueName, exchangeName, routingKey,
> false, null);
> 
>         }
> 
>  
> 
> If I use other exchange than default (non-passive, non-durable,
> non-autodelete, and non-internal) I got the exception.
> 
>  
> 
>  
> 
>  
> 
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of
> *Andrius Norkaitis
> *Sent:* Monday, July 05, 2010 5:51 PM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* [rabbitmq-discuss] .net client and Subscription
> 
>  
> 
> Hi. As from 1.8 there is queue equivalence verification I started
> getting exception when I declare queue and later use it with
> Subscription class.
> 
>  
> 
> ch.QueueDeclare(clientID, false, false, true, true, false, null);
> 
> var sub = new Subscription(ch, clientID, false, RabbitMQexchange,
> RabbitMQexchangeType, "");
> 
>  
> 
> As you can see I declare queue with Autodelete flag set to TRUE.
> 
> But if I specify queue name, Subscriber tries to re-declare this queue
> with autodelete set to FALSE and exception rises.
> 
>  
> 
> Check the code from the client source:
> 
>  
> 
>   public Subscription(IModel model, string queueName, bool noAck)
> 
>         {
> 
>             m_model = model;
> 
>             if (queueName == null || queueName.Equals("")) {
> 
>                 m_queueName = m_model.QueueDeclare();
> 
>                 m_shouldDelete = true;
> 
> *            } else {*
> 
> *                m_queueName = m_model.QueueDeclare(queueName);*
> 
> *                m_shouldDelete = false;*
> 
> *            }*
> 
>             m_consumer = new QueueingBasicConsumer(m_model);
> 
>             m_consumerTag = m_model.BasicConsume(m_queueName, m_noAck,
> null, m_consumer);
> 
>             m_latestEvent = null;
> 
>         }
> 
>  
> 
> Is this expected behaviour? What if I want to subscribe to autodelete
> queue using Subscribtion class and specifying the name of the queue?
> 
>  
> 
> Best regards
> 
> Andrius Norkaitis
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From andrius.norkaitis at oryo.lt  Mon Jul  5 17:44:23 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 5 Jul 2010 19:44:23 +0300
Subject: [rabbitmq-discuss] how get list of queues / check queue exists
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADUYuL9nrDJPhTcik4kMVIMBAAAAAA==@oryo.lt>

Hi.

 

I have occasionally connected clients (subscribers) which bids to
non-durable, exclusive, autodelete queue with their own ID.

I'm looking how to check which of the clients is online (queues with known
ids is available) or not.

 

If I could get a list of available queues I could compare their names with
ID to know which subscribers is online.

Also if there would be method to check is queue available I could iterate
through my list  and check it.

 

Rabbitmqctl has method to get list of available queues, but I haven't found
any way doing this using client.

 

I have founded one solution using QueueDeclare and passive flag:

 

bool QueueAvailable = false;

            try

            {

                var m = ch.QueueDeclare(routingKey, true, false, true, true,
false, null);

                QueueAvailable = true;

            }

            catch { }

 

If there is no queue available I get an exception, but also this closes the
connection so to check i.e. 500 queues I'll need to make a lot of new
connections every time.

 

Maybe there is more elegant solution?

 

Best regards

Andrius Norkaitis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100705/d2c0d4f8/attachment.htm>

From angelcaido19 at yahoo.com.ar  Mon Jul  5 17:48:02 2010
From: angelcaido19 at yahoo.com.ar (angel menichelli)
Date: Mon, 5 Jul 2010 09:48:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Get messages detail from queue
Message-ID: <476162.94482.qm@web30704.mail.mud.yahoo.com>

Hi there,

Is there any way to monitor the messages inside a queue??
I can display the amount, etc but not the message itself!!

I am using rabbit under ubuntu with python and currently using alice to monitor it.


Thanks in advance,
dario 


      

From matthias at rabbitmq.com  Mon Jul  5 22:15:00 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 05 Jul 2010 22:15:00 +0100
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>	<vfqy6dzg01p.fsf@mercury.cern.ch>	<4C28C63B.5000907@rabbitmq.com>	<19497.35021.831383.102680@mercury.cern.ch>
	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
Message-ID: <4C324B54.1050903@rabbitmq.com>

Lionel, Nathaniel,

Nathaniel Haggard wrote:
> On Mon, Jun 28, 2010 at 11:46 PM, Lionel Cons <lionel.cons at cern.ch> wrote:
>> In case something bad happens (invalid message, too many messages...),
>> we want to know who sent the offending messages.

That doesn't seem to have anything to do with SSL, intrinsically, i.e. 
one can imagine wanting to know the same even when the clients connect 
w/o ssl.

That raises the question of how exactly to identify the sender of a 
message to a) consumers, and b) administrators. That is a very large can 
of worms, raising issues of trust such as

- How do consumers establish sufficient trust into the server (to supply 
the correct information)?

- How do producers establish sufficient trust into the server (to not 
pass on information about their identity when they do not intent to, to 
not fake such information, etc)?

- How does one deal with proxies/shovels, i.e. entities that relay 
information? Do messages passing through them have their original sender 
info replaced? Or does the proxy/shovel identity get appended somehow?

None of these issues are particular to AMQP, of course, so the AMQP 
working group should built on the work already done in the world of 
securing email, web services, etc. There is an AMQP Security SIG, and it 
may be worth you describing your use case to them, so they can 
incorporate it into their designs.

There is also an issue w.r.t. message fidelity. Currently RabbitMQ 
guarantees that the entire message payload, including headers, is 
transmitted to consumers unaltered. To some users that is a highly 
desirable property of a messaging system.

> If rabbitmqctl list_connections showed the ssl common name in
> client_properties then we could find the queue by joining
> list_connections output with list_queues output on pid and owner_pid
> respectively.

Adding various bits of info extracted from ssl in the list_connections 
output would be quite easy and not run into any of the problems 
mentioned above associated with trying to attach sender identities to 
messages. But ...

Isn't the AMQP user sufficient for this? That can already be shown with 
'rabbitmqctl list_connections'.

Also, I do not understand how queue owner_pids help you here since the 
connections owning the queues are typically from the consumers and not 
the producers.


Regards,

Matthias.

From lionel.cons at cern.ch  Tue Jul  6 08:07:20 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 6 Jul 2010 09:07:20 +0200
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4C324B54.1050903@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<vfqy6dzg01p.fsf@mercury.cern.ch> <4C28C63B.5000907@rabbitmq.com>
	<19497.35021.831383.102680@mercury.cern.ch>
	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
	<4C324B54.1050903@rabbitmq.com>
Message-ID: <19506.54824.366624.7520@mercury.cern.ch>

Matthias Radestock writes:
 > Nathaniel Haggard wrote:
 > > On Mon, Jun 28, 2010 at 11:46 PM, Lionel Cons <lionel.cons at cern.ch> wrote:
 > >> In case something bad happens (invalid message, too many messages...),
 > >> we want to know who sent the offending messages.
 > 
 > That doesn't seem to have anything to do with SSL, intrinsically, i.e. 
 > one can imagine wanting to know the same even when the clients connect 
 > w/o ssl.

Correct.

The idea is the following: a broker is a black box that can optionally
use authentication. What is needed is a way to attach to a message
authentication information, when available. This could be a user name
(with password authentication) or a DN (with certificate authentication)
or something else with other authentication mechanisms.

ActiveMQ has it: http://activemq.apache.org/jmsxuserid.html.

 > That raises the question of how exactly to identify the sender of a 
 > message to a) consumers, and b) administrators. That is a very large can 
 > of worms, raising issues of trust such as

IMHO, it is indeed a can of worms, but a small one ;-)

 > - How do consumers establish sufficient trust into the server (to supply 
 > the correct information)?

They have no choice: a broker is by definition a trusted entity. For
instance, consumers expect brokers to deliver message bodies unaltered.

 > - How do producers establish sufficient trust into the server (to not 
 > pass on information about their identity when they do not intent to, to 
 > not fake such information, etc)?

Idem. Producers already trust the brokers, for instance to deliver the
messages to the right consumers. For the "information about their
identity", if this may be a concern, it would be easy to have a broker
flag specifying whether authentication information is passed or not.

 > - How does one deal with proxies/shovels, i.e. entities that relay 
 > information? Do messages passing through them have their original sender 
 > info replaced? Or does the proxy/shovel identity get appended somehow?

This is a very good question.

I've worked on a very simple model with boolean trust. Either the
sender of the message (this could be a shovel) is trusted or it is
not. So:
 - if it is trusted, the broker accepts authentication information as
   provided by the sender and simply appends what it knows, i.e. the
   identity of the sender
 - if it is not trusted, the broker discards all previous
   authentication information and puts instead what it knows

 > None of these issues are particular to AMQP, [...]

Correct. So, IMHO, the solution(s) should be independent from AMQP.

It seems that all we need is a set of headers with well defined
semantic attached.

 > There is also an issue w.r.t. message fidelity. Currently RabbitMQ 
 > guarantees that the entire message payload, including headers, is 
 > transmitted to consumers unaltered. To some users that is a highly 
 > desirable property of a messaging system.

AFAIK, AMQP 1.0 has two different things (I hope the terminology is right):
 - the bare message, with properties
 - the annotated, with extra header and footer

For me, authentication information should be in the header, leaving
intact the body and the properties.

Cheers,

Lionel

From matthias at rabbitmq.com  Tue Jul  6 09:08:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 06 Jul 2010 09:08:07 +0100
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <19506.54824.366624.7520@mercury.cern.ch>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>	<vfqy6dzg01p.fsf@mercury.cern.ch>	<4C28C63B.5000907@rabbitmq.com>	<19497.35021.831383.102680@mercury.cern.ch>	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>	<4C324B54.1050903@rabbitmq.com>
	<19506.54824.366624.7520@mercury.cern.ch>
Message-ID: <4C32E467.8040401@rabbitmq.com>

Lionel,

Lionel Cons wrote:
> ActiveMQ has it: http://activemq.apache.org/jmsxuserid.html.

...and AMQP 0-8/9/9-1 has the user-id basic content property. Alas it 
has no defined semantics.

>  > - How do consumers establish sufficient trust into the server (to supply 
>  > the correct information)?
> 
> They have no choice: a broker is by definition a trusted entity. For
> instance, consumers expect brokers to deliver message bodies unaltered.

There are messaging scenarios where the broker cannot be trusted 
sufficiently. Imagine your bank communicating with another bank over a 
public AMQP server. Standard crypto techniques at the end points, opaque 
to the broker, work in that setup.

What we are looking at here is something different: systems where apps 
*do* trust the broker and want manifestations of that trust, such as 
identities of authenticated users, to be reflected into the messaging world.

>  > - How do producers establish sufficient trust into the server (to not 
>  > pass on information about their identity when they do not intent to, to 
>  > not fake such information, etc)?
> 
> Idem. Producers already trust the brokers, for instance to deliver the
> messages to the right consumers. For the "information about their
> identity", if this may be a concern, it would be easy to have a broker
> flag specifying whether authentication information is passed or not.

I don't think a broker flag is enough here. Step outside the enterprise 
world and consider a public AMQP messaging service. I can envisage cases 
where the sender will want to control whether its identity is revealed 
to consumers. Much like it tells the broker whether the message should 
be persisted.

>  > - How does one deal with proxies/shovels, i.e. entities that relay 
>  > information? Do messages passing through them have their original sender 
>  > info replaced? Or does the proxy/shovel identity get appended somehow?
> 
> This is a very good question.
> 
> I've worked on a very simple model with boolean trust. Either the
> sender of the message (this could be a shovel) is trusted or it is
> not.

What distinguishes a trusted sender from an untrusted sender?

>  - if it is trusted, the broker accepts authentication information as
>    provided by the sender and simply appends what it knows, i.e. the
>    identity of the sender

So in a hypothetical scenario where
1) sender authenticates with broker X as user A and sends message
2) proxy authenticates with broker X as user B and consumes message
3) proxy authenticates with broker Y as user C and sends the consumed 
message
4) consumer authenticates with broker Y as user D and consumes message

what sender identity information ends up in the message sent to the 
final consumer? It seems to me that if the consumer is interested in the 
identity of the original sender it needs to trust broker Y - let's take 
that as a given - as well as the proxy and broker X. How can it 
establish that trust, since it's not directly interacting with either of 
them? Furthermore, the identity with which user A authenticates to 
broker X may be completely meaningless to the one the consumer.

This conflation of application level identities with broker 
authentication identities is problematic.

One analogy is authenticated smtp. When I send a message to an SMTP 
server that requires authentication, the identity I supply is usually 
meaningless outside the administrative domain of that server.

> AFAIK, AMQP 1.0 has two different things (I hope the terminology is right):
>  - the bare message, with properties
>  - the annotated, with extra header and footer

In AMQP 0-8/9/9-1 there is just one set of properties/headers. 
basic.deliver and basic.get-ok contain additional information, such as 
the exchange to which the message was published and the routing key, but 
that is not extensible.


Regards,

Matthias.

From zhangmingtao at PingCo.com  Tue Jul  6 09:39:26 2010
From: zhangmingtao at PingCo.com (=?gb2312?B?1cXD98zO?=)
Date: Tue, 6 Jul 2010 16:39:26 +0800
Subject: [rabbitmq-discuss] rabbit is out of service in disk mode.
Message-ID: <DA048E9B69A30A4FA2202D5C92A85C82D78B16@pingco.local>


I send messages(size:10kB) to a queue on single node,but with no consumers. Here is my java code:
  
  channel.exchangeDeclare(exec, "direct", true, false, null);
  channel.queueDeclare("FirstQueue", true, false, false, null);
  channel.queueBind(queueName, exec, routingKey);
  
  BasicProperties bp = new BasicProperties();
  bp.setDeliveryMode(2);
  channel.basicPublish(exec, routingKey, bp, messageBodyBytes);
  
  
  When 9000 message sent, the producer was blocked, I got a message in log :
  vm_memory_high_watermark set. Memory used:288650128 allowed:211065241
  alarm_handler: {set,{vm_memory_high_watermark,[]}}
  
  Then I stop the rabbit,restart it, but I got same messages in log .
  
  If I start a consumer,it receives no messages either?
  
  Anyone knows how many messages can a queue persist? just 9000 ?
  I want to persist all the messages, is it possible?

  Anyone give me some advice? Thks . 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/546cbe9b/attachment.htm>

From lionel.cons at cern.ch  Tue Jul  6 11:11:08 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 6 Jul 2010 12:11:08 +0200
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4C32E467.8040401@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<vfqy6dzg01p.fsf@mercury.cern.ch> <4C28C63B.5000907@rabbitmq.com>
	<19497.35021.831383.102680@mercury.cern.ch>
	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
	<4C324B54.1050903@rabbitmq.com>
	<19506.54824.366624.7520@mercury.cern.ch>
	<4C32E467.8040401@rabbitmq.com>
Message-ID: <19507.316.202319.131989@mercury.cern.ch>

Matthias Radestock writes:
 > I don't think a broker flag is enough here. Step outside the enterprise 
 > world and consider a public AMQP messaging service. I can envisage cases 
 > where the sender will want to control whether its identity is revealed 
 > to consumers. Much like it tells the broker whether the message should 
 > be persisted.

The "public messaging service" is exactly the model we try to work
towards. In such a model, the service provider needs to protect its
resources. Unauthenticated clients may get directed to a sacrificial
broker so that abuses do not harm authenticated clients. Similarly,
authenticated clients that do not want to expose their "identity" may
get a different level of service. Clients who play by the rules
(i.e. authentication plus traceability) may get better service.

I don't believe you can build a decent public messaging service
without a minimum security.

 > What distinguishes a trusted sender from an untrusted sender?

The server must know who is allowed to use its services or not, so it
must have a kind of user list. I could imagine something like a
per-user flag telling whether this user is trusted or not. When using
a shovel, if the connecting user is trusted, the shovel will be
somehow trusted.

 > So in a hypothetical scenario where
 > 1) sender authenticates with broker X as user A and sends message
 > 2) proxy authenticates with broker X as user B and consumes message
 > 3) proxy authenticates with broker Y as user C and sends the consumed 
 > message
 > 4) consumer authenticates with broker Y as user D and consumes message
 > 
 > what sender identity information ends up in the message sent to the 
 > final consumer? It seems to me that if the consumer is interested in the 
 > identity of the original sender it needs to trust broker Y - let's take 
 > that as a given - as well as the proxy and broker X. How can it 
 > establish that trust, since it's not directly interacting with either of 
 > them? Furthermore, the identity with which user A authenticates to 
 > broker X may be completely meaningless to the one the consumer.

There are two ways to achieve message authentication: outside or
inside of messaging.

Outside, the producer signs the message body and the consumer checks
the signature. There are no requirements on the brokers but only the
consumer knows who the sender is. This is good for the clients, not
for the messaging service.

Inside, all intermediaries (broker, proxy, shovel...) must be trusted.
Otherwise, a rogue intermediary could do evil things with the message.
This is good for the messaging service as it can control who does
what, not for the clients, unless they trust the messaging service.

So to answer your question, if the consumer trusts X and Y then it can
know the sender identity via "inside" authentication. If it does not
trust the service, it has to use "outside" authentication.

Cheers,

Lionel

From matthias at rabbitmq.com  Tue Jul  6 11:40:44 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 06 Jul 2010 11:40:44 +0100
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <19507.316.202319.131989@mercury.cern.ch>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>	<vfqy6dzg01p.fsf@mercury.cern.ch>	<4C28C63B.5000907@rabbitmq.com>	<19497.35021.831383.102680@mercury.cern.ch>	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>	<4C324B54.1050903@rabbitmq.com>	<19506.54824.366624.7520@mercury.cern.ch>	<4C32E467.8040401@rabbitmq.com>
	<19507.316.202319.131989@mercury.cern.ch>
Message-ID: <4C33082C.4080304@rabbitmq.com>

Lionel,

On 06/07/10 11:11, Lionel Cons wrote:
> The "public messaging service" is exactly the model we try to work
> towards. In such a model, the service provider needs to protect its
> resources. Unauthenticated clients may get directed to a sacrificial
> broker so that abuses do not harm authenticated clients. Similarly,
> authenticated clients that do not want to expose their "identity" may
> get a different level of service. Clients who play by the rules
> (i.e. authentication plus traceability) may get better service.
>
> I don't believe you can build a decent public messaging service
> without a minimum security.

I wasn't suggesting that clients should be able to work unauthenticated, 
but that they may not want their identity passed to consumers. So the 
question is, if the authentication is only of interest to the broker, 
why does it get passed to the *consumer*? Would it instead be sufficient 
to retain the credentials internally in the broker and present them in 
various admin tools, but not pass them to the consumers? That way we 
would also preserve message fidelity.

> There are two ways to achieve message authentication: outside or
> inside of messaging.
>
> Outside, the producer signs the message body and the consumer checks
> the signature. There are no requirements on the brokers but only the
> consumer knows who the sender is. This is good for the clients, not
> for the messaging service.
>
> Inside, all intermediaries (broker, proxy, shovel...) must be trusted.
> Otherwise, a rogue intermediary could do evil things with the message.
> This is good for the messaging service as it can control who does
> what, not for the clients, unless they trust the messaging service.
>
> So to answer your question, if the consumer trusts X and Y then it can
> know the sender identity via "inside" authentication. If it does not
> trust the service, it has to use "outside" authentication.

Right, except the consumer doesn't even know the message came via broker 
X. And, furthermore, the identity presented to broker X may be 
meaningless in the context of broker Y and the consumer.

So it seems to me that if you want *consumers* to know about sender 
identities then that should be handled at the app level, outside the 
messaging layer.

OTOH, servers, and those administering them, should be able to find out 
which AMQP users are responsible for certain actions (such as the 
creation of an exchange or queue, the sending or retrieval of a message) 
and their resulting artifacts (such as a created queue or exchange, or a 
stored message).


Regards,

Matthias.

From emile at rabbitmq.com  Tue Jul  6 12:37:35 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 06 Jul 2010 12:37:35 +0100
Subject: [rabbitmq-discuss] rabbit is out of service in disk mode.
In-Reply-To: <DA048E9B69A30A4FA2202D5C92A85C82D78B16@pingco.local>
References: <DA048E9B69A30A4FA2202D5C92A85C82D78B16@pingco.local>
Message-ID: <4C33157F.6090800@rabbitmq.com>

Hi ???,

Regardless of whether messages are published as persistent, all messages
are held in RAM. If you publish messages without consuming them them you
will eventually run out of RAM. Your server seems to have enough memory
for 9000 messages.

You will not be able to open any new channels to the broker after the
memory limit has been reached, but existing consumers may continue to
consume messages.

The source repository currently contains a new persister in branch
(bug21673) which will solve your problem. This feature is currently
undergoing QA.

The memory high-watermark is somewhat relevant to your situation. This
can be set in the config file (see
http://www.rabbitmq.com/install.html). The default of 40% is recommended.

Regards

Emile



On 06/07/10 09:39, ??? wrote:
> 
> I send messages(size:10kB) to a queue on single node,but with no
> consumers. Here is my java code:
>  
>   channel.exchangeDeclare(exec, "direct", true, false, null);
>   channel.queueDeclare("FirstQueue", true, false, false, null);
>   channel.queueBind(queueName, exec, routingKey);
>  
>   BasicProperties bp = new BasicProperties();
>   bp.setDeliveryMode(2);
>   channel.basicPublish(exec, routingKey, bp, messageBodyBytes);
>  
>  
>   When 9000 message sent, the producer was blocked, I got a message in log :
>   vm_memory_high_watermark set. Memory used:288650128 allowed:211065241
>   alarm_handler: {set,{vm_memory_high_watermark,[]}}
>  
>   Then I stop the rabbit,restart it, but I got same messages in log .
>  
>   If I start a consumer,it receives no messages either?
>  
>   Anyone knows how many messages can a queue persist? just 9000 ?
>   I want to persist all the messages, is it possible?
> 
>   Anyone give me some advice? Thks .


From holger.hoffstaette at googlemail.com  Tue Jul  6 15:44:26 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Tue, 06 Jul 2010 16:44:26 +0200
Subject: [rabbitmq-discuss] New patches for rabbitmq-java client OSGi
	compatibility
Message-ID: <pan.2010.07.06.14.44.26.329875@googlemail.com>


Hey!

I've respun my last year's OSGi integration to the latest 1.8 client
library, this time with the changes in a proper hg branch instead of
trampling all over default.. :)

Find it here in the "osgi" branch:
http://hoho.dyndns.org/hg/rabbitmq-java-client/

Things to know:

- it adds a processing step to the jar file generation using the "bnd"
utility [1] to add OSGi metadata to the generated library manifest. The
tool jar and metadata processing instructions are in the new "osgi"
subdirectory. There is no runtime code dependency; all this does is add a
bunch of headers to the jar's manifest.

- I updated the commons-io dependency to 1.4. This should not be a problem
to any clients as 1.4 is binary-compatible to the old one; however 1.4
(itself already over two years old) is the first one with valid OSGi
metadata itself. The client library itself is not affected by this. This
step is not strictly necessary as the OSGi runtime will properly resolve &
wire the needed dependency, but on the other hand pulling in ancient
dependencies is not that great either (e.g. when using maven).

- While I was there I also updated the retrotranslator & backport lib. I'm
not sure if the 1.4 backwards compatibility is something you want to
continue but it doesn't hurt either.

The bnd invocation is wired into the "jar" task. This OSGi-fication is
currently only done for the regular JDK5 jar, so the invocation of the
"bndwrap" task will also be have to be performed on the retrotranslated
jar, using 1.4-compatible bnd instructions (to pull in the
backport-concurrency lib). Let me know if this is of interest.

Also there seems to be an unneeded dependency on commons-cli in the maven
pom. commons-cli is only needed for the tests & tools.

All changesets are nicely grouped together, so you can cherry-pick what you
want.

cheers
Holger



From holger.hoffstaette at googlemail.com  Tue Jul  6 15:50:15 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Tue, 06 Jul 2010 16:50:15 +0200
Subject: [rabbitmq-discuss] New patches for rabbitmq-java client OSGi
	compatibility
References: <pan.2010.07.06.14.44.26.329875@googlemail.com>
Message-ID: <pan.2010.07.06.14.50.15.409250@googlemail.com>


*sigh*

> - it adds a processing step to the jar file generation using the "bnd"
> utility [1] to add OSGi metadata to the generated library manifest.

[1] http://www.aqute.biz/Code/Bnd




From natester at gmail.com  Tue Jul  6 18:09:26 2010
From: natester at gmail.com (Nathaniel Haggard)
Date: Tue, 6 Jul 2010 11:09:26 -0600
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4C33082C.4080304@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<vfqy6dzg01p.fsf@mercury.cern.ch> <4C28C63B.5000907@rabbitmq.com>
	<19497.35021.831383.102680@mercury.cern.ch>
	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
	<4C324B54.1050903@rabbitmq.com>
	<19506.54824.366624.7520@mercury.cern.ch>
	<4C32E467.8040401@rabbitmq.com>
	<19507.316.202319.131989@mercury.cern.ch>
	<4C33082C.4080304@rabbitmq.com>
Message-ID: <AANLkTimpr8HTUokKYApWNgxkReMPWZ5A1MvP6ETvy6Ng@mail.gmail.com>

On Tue, Jul 6, 2010 at 4:40 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Lionel,
>
> On 06/07/10 11:11, Lionel Cons wrote:
>>
>> The "public messaging service" is exactly the model we try to work
>> towards. In such a model, the service provider needs to protect its
>> resources. Unauthenticated clients may get directed to a sacrificial
>> broker so that abuses do not harm authenticated clients. Similarly,
>> authenticated clients that do not want to expose their "identity" may
>> get a different level of service. Clients who play by the rules
>> (i.e. authentication plus traceability) may get better service.
>>
>> I don't believe you can build a decent public messaging service
>> without a minimum security.
>
> I wasn't suggesting that clients should be able to work unauthenticated, but
> that they may not want their identity passed to consumers. So the question
> is, if the authentication is only of interest to the broker, why does it get
> passed to the *consumer*? Would it instead be sufficient to retain the
> credentials internally in the broker and present them in various admin
> tools, but not pass them to the consumers? That way we would also preserve
> message fidelity.
>
>> There are two ways to achieve message authentication: outside or
>> inside of messaging.
>>
>> Outside, the producer signs the message body and the consumer checks
>> the signature. There are no requirements on the brokers but only the
>> consumer knows who the sender is. This is good for the clients, not
>> for the messaging service.
>>
>> Inside, all intermediaries (broker, proxy, shovel...) must be trusted.
>> Otherwise, a rogue intermediary could do evil things with the message.
>> This is good for the messaging service as it can control who does
>> what, not for the clients, unless they trust the messaging service.
>>
>> So to answer your question, if the consumer trusts X and Y then it can
>> know the sender identity via "inside" authentication. If it does not
>> trust the service, it has to use "outside" authentication.
>
> Right, except the consumer doesn't even know the message came via broker X.
> And, furthermore, the identity presented to broker X may be meaningless in
> the context of broker Y and the consumer.
>
> So it seems to me that if you want *consumers* to know about sender
> identities then that should be handled at the app level, outside the
> messaging layer.

I would agree if RabbitMQ did not support SSL, but since it does it
why not take advantage of the features of SSL?  I'm speaking of the
scenario where producers and consumers trust the broker but not each
other.

People who try to take care of security at the app level could easily
make mistakes that the RabbitMQ SSL implementation avoids.

>
> OTOH, servers, and those administering them, should be able to find out
> which AMQP users are responsible for certain actions (such as the creation
> of an exchange or queue, the sending or retrieval of a message) and their
> resulting artifacts (such as a created queue or exchange, or a stored
> message).
>

I'm noticing a layering issue; am I the only one?

I opted for managing many certificates instead of managing many users
on the AMQP server.  In this system a certificate represents a user.
This solution for authentication works well over many systems that
support SSL.

Certainly clients could implement their own authentication mechanism,
their own transport security, and more; however, rabbit supports SSL--
why does rabbit support SSL?  ZeroMQ doesn't and now I understand
better why they do not.  Is SSL support in rabbit designed to follow
the role of SSL for HTTPS that is primarily to establish broker/server
authenticity?


>
> Regards,
>
> Matthias.
>

-Nate

From fblanch at gmail.com  Tue Jul  6 18:41:18 2010
From: fblanch at gmail.com (Francisco Gonzalez-Blanch)
Date: Tue, 6 Jul 2010 19:41:18 +0200
Subject: [rabbitmq-discuss] problems running rabbitMQ in mac os x snow
	leopard
Message-ID: <AANLkTimbrm8R1-cgdvezxFMaOq-BaahGK3nRc4Wdo4Dm@mail.gmail.com>

Hi everybody,

I've installed rabbitMQ using mac ports  in Mac Os X snow leopard, and when
i try to start the server i'm getting the following error:

{error_logger,{{2010,7,6},{18,47,58}},"Error when reading
/Users/pacman/.erlang.cookie: eacces",[]}
{error_logger,{{2010,7,6},{18,47,58}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Error
when reading /Users/pacman/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,585}],[]]}
{error_logger,{{2010,7,6},{18,47,58}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Error
when reading /Users/pacman/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,7,6},{18,47,58}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,7,6},{18,47,58}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

Thank you so much,

Francisco Gonz?lez-Blanch Rodr?guez
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/980f95e0/attachment.htm>

From russell at borogove.org  Tue Jul  6 18:51:23 2010
From: russell at borogove.org (Russell Borogove)
Date: Tue, 6 Jul 2010 10:51:23 -0700
Subject: [rabbitmq-discuss] problems running rabbitMQ in mac os x snow
	leopard
In-Reply-To: <AANLkTimbrm8R1-cgdvezxFMaOq-BaahGK3nRc4Wdo4Dm@mail.gmail.com>
References: <AANLkTimbrm8R1-cgdvezxFMaOq-BaahGK3nRc4Wdo4Dm@mail.gmail.com>
Message-ID: <00F24CBD-E56F-4CCE-AB18-3C8B068A9096@borogove.org>


On Jul 6, 2010, at 10:41 AM, Francisco Gonzalez-Blanch wrote:
> I've installed rabbitMQ using mac ports  in Mac Os X snow leopard, and when
> i try to start the server i'm getting the following error:
> 
> {error_logger,{{2010,7,6},{18,47,58}},"Error when reading
> /Users/pacman/.erlang.cookie: eacces",[]}

This is a known bug.

Erlang apps use a "cookie" to coordinate. By default, the MacPorts build of rabbitmq 
looks for the cookie in the home directory of the logged-in user (contra the documentation), 
even though it's running as user 'rabbitmq'.

The easiest fix is to change the ownership of that cookie file to rabbitmq:

chown rabbitmq /Users/pacman/.erlang.cookie

You may also need to set the permissions on the file to 0444 (read-only).

You can also set the cookie value directly on the command line launching rabbitmq-server, 
but that unfortunately isn't an option for rabbitmqctl, so I wouldn't recommend it.

-Russell Borogove
 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/0cddf419/attachment-0001.htm>

From michael at frumin.net  Tue Jul  6 19:11:27 2010
From: michael at frumin.net (Michael Frumin)
Date: Tue, 06 Jul 2010 14:11:27 -0400
Subject: [rabbitmq-discuss] RabbitMQ and C bindings -- Experimental?
Message-ID: <4C3371CF.3050600@frumin.net>

RabbitMQ'ers,

I'm a hopeful/potential user of RabbitMQ.  One requirement of my
project is to put messages into the queue using C (to be read out in
Java).  I have noticed (on http://www.rabbitmq.com/how.html ) that the
C client (rabbitmq-c) is listed as experimental.  More broadly, there
doesn't even seem to be a real home page for RabbitMQ-C (as opposed
to, for example, the Java Client: http://www.rabbitmq.com/java-client.html).
Should I be worried?  Is the C client kept up-to-date with the
releases of the broker/server?

I see that the PHP client, not listed as experimental, is based on the
C client so maybe I'm making a big deal out of nothing.  thoughts?  Is
this the appropriate forum for this type of question anyway?  I tried
IRC but nobody's responding.

Thanks,
Mike

PS Please forgive if this is a duplicate message, I'm having some
issues with subscribing/posting


From vivek at khera.org  Tue Jul  6 19:17:37 2010
From: vivek at khera.org (Vick Khera)
Date: Tue, 6 Jul 2010 14:17:37 -0400
Subject: [rabbitmq-discuss] RabbitMQ and C bindings -- Experimental?
In-Reply-To: <4C3371CF.3050600@frumin.net>
References: <4C3371CF.3050600@frumin.net>
Message-ID: <AANLkTinSBbMp_T8406h56n76ubMITIhQJLvheSJ1GTQv@mail.gmail.com>

On Tue, Jul 6, 2010 at 2:11 PM, Michael Frumin <michael at frumin.net> wrote:
> I see that the PHP client, not listed as experimental, is based on the
> C client so maybe I'm making a big deal out of nothing. ?thoughts? ?Is
> this the appropriate forum for this type of question anyway? ?I tried
> IRC but nobody's responding.
>

The perl client http://search.cpan.org/dist/Net-RabbitMQ/ is also
based on the C library.  I don't *think* it is described as
experimental, but it does have a very very low version number which
would imply it.

From michael at frumin.net  Tue Jul  6 19:31:24 2010
From: michael at frumin.net (fruminator)
Date: Tue, 6 Jul 2010 11:31:24 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and C bindings -- Experimental?
In-Reply-To: <AANLkTinSBbMp_T8406h56n76ubMITIhQJLvheSJ1GTQv@mail.gmail.com>
References: <4C3371CF.3050600@frumin.net>
	<AANLkTinSBbMp_T8406h56n76ubMITIhQJLvheSJ1GTQv@mail.gmail.com>
Message-ID: <cd0bf8a0-c1fd-4c0e-8852-475771193d6a@u26g2000yqu.googlegroups.com>

Also, there aren't really any releases for RabbitMQ-C -- should I just
be taking the bleeding edge code whatever it is?

Thanks,
Mike

On Jul 6, 2:17?pm, Vick Khera <vi... at khera.org> wrote:
> On Tue, Jul 6, 2010 at 2:11 PM, Michael Frumin <mich... at frumin.net> wrote:
> > I see that the PHP client, not listed as experimental, is based on the
> > C client so maybe I'm making a big deal out of nothing. ?thoughts? ?Is
> > this the appropriate forum for this type of question anyway? ?I tried
> > IRC but nobody's responding.
>
> The perl clienthttp://search.cpan.org/dist/Net-RabbitMQ/is also
> based on the C library. ?I don't *think* it is described as
> experimental, but it does have a very very low version number which
> would imply it.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Jul  6 20:04:24 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 6 Jul 2010 20:04:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ and C bindings -- Experimental?
In-Reply-To: <cd0bf8a0-c1fd-4c0e-8852-475771193d6a@u26g2000yqu.googlegroups.com>
References: <4C3371CF.3050600@frumin.net>
	<AANLkTinSBbMp_T8406h56n76ubMITIhQJLvheSJ1GTQv@mail.gmail.com>
	<cd0bf8a0-c1fd-4c0e-8852-475771193d6a@u26g2000yqu.googlegroups.com>
Message-ID: <20100706190423.GA17387@wellquite.org>

On Tue, Jul 06, 2010 at 11:31:24AM -0700, fruminator wrote:
> Also, there aren't really any releases for RabbitMQ-C -- should I just
> be taking the bleeding edge code whatever it is?

Yes - though stick to the default branch. Also, it very much is
experimental.

Matthew

From mpollack at vmware.com  Tue Jul  6 20:54:09 2010
From: mpollack at vmware.com (Mark Pollack)
Date: Tue, 6 Jul 2010 12:54:09 -0700
Subject: [rabbitmq-discuss] how get list of queues / check queue exists
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADUYuL9nrDJPhTcik4kMVIMBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADUYuL9nrDJPhTcik4kMVIMBAAAAAA==@oryo.lt>
Message-ID: <806F700D7E08E9408413160B05EB66672A47798BA1@EXCH-MBX-1.vmware.com>

Hi,

As part of a soon to be released project from SpringSource, we will be providing a .NET client API to access the information you can get via Rabbitmqctl and other functions in the rabbitmq broker.   Jim Apperly from the rabbitmq team did the real hard work, I'll just be doing some minor changes.  I'll post back once some code is in git here git clone git://git.springsource.org/spring-amqp/spring-amqp-net.git

Mark



From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andrius Norkaitis
Sent: Monday, July 05, 2010 12:44 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] how get list of queues / check queue exists

Hi.

I have occasionally connected clients (subscribers) which bids to non-durable, exclusive, autodelete queue with their own ID.
I'm looking how to check which of the clients is online (queues with known ids is available) or not.

If I could get a list of available queues I could compare their names with ID to know which subscribers is online.
Also if there would be method to check is queue available I could iterate through my list  and check it.

Rabbitmqctl has method to get list of available queues, but I haven't found any way doing this using client.

I have founded one solution using QueueDeclare and passive flag:

bool QueueAvailable = false;
            try
            {
                var m = ch.QueueDeclare(routingKey, true, false, true, true, false, null);
                QueueAvailable = true;
            }
            catch { }

If there is no queue available I get an exception, but also this closes the connection so to check i.e. 500 queues I'll need to make a lot of new connections every time.

Maybe there is more elegant solution?

Best regards
Andrius Norkaitis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/88cd1136/attachment.htm>

From matthias at rabbitmq.com  Tue Jul  6 21:07:50 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 06 Jul 2010 21:07:50 +0100
Subject: [rabbitmq-discuss] how get list of queues / check queue exists
In-Reply-To: <806F700D7E08E9408413160B05EB66672A47798BA1@EXCH-MBX-1.vmware.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADUYuL9nrDJPhTcik4kMVIMBAAAAAA==@oryo.lt>
	<806F700D7E08E9408413160B05EB66672A47798BA1@EXCH-MBX-1.vmware.com>
Message-ID: <4C338D16.60209@rabbitmq.com>

Mark, Andrius,

On 06/07/10 20:54, Mark Pollack wrote:
> As part of a soon to be released project from SpringSource, we will
> be providing a .NET client API to access the information you can get
> via Rabbitmqctl and other functions in the rabbitmq broker.

Presumably the rabbitmqctl part of that is working only if the client
has the correct Erlang-level credentials and can connect to the broker's
Erlang ports. In other words, this is quite different from talking AMQP 
and requires administrative access to the broker.

On 05/07/10 17:44, Andrius Norkaitis wrote:
> I have founded one solution using QueueDeclare and passive flag:
> [...] If there is no queue available I get an exception, but also
> this closes the connection

That should only close the *channel*, not the connection. And channel
creation/destruction in rabbit is quite cheap.


Regards,

Matthias.

From chen650 at yahoo.com  Tue Jul  6 23:41:52 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 6 Jul 2010 15:41:52 -0700 (PDT)
Subject: [rabbitmq-discuss] socket read timeout in rabbitmq-c
In-Reply-To: <4C2BEB1C.7060203@rabbitmq.com>
References: <131339.14680.qm@web31812.mail.mud.yahoo.com>
	<4BFB838A.5090900@rabbitmq.com>
	<343701.1413.qm@web31805.mail.mud.yahoo.com>
	<4C2BEB1C.7060203@rabbitmq.com>
Message-ID: <823534.89007.qm@web31810.mail.mud.yahoo.com>

Hi Tony,

Thanks a lot!  The previous patch does not return explicit error code for 
timeout.  

Attached please find a new rabbitmq-c.patch that returns -ETIME, so it is easier 
for caller to detect it.
thanks.

-alex



----- Original Message ----
> From: Tony Garnock-Jones <tonyg at rabbitmq.com>
> To: alex chen <chen650 at yahoo.com>
> Cc: Matthias Radestock <matthias at rabbitmq.com>; 
>rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wed, June 30, 2010 6:10:52 PM
> Subject: Re: [rabbitmq-discuss] socket read timeout in rabbitmq-c
> 
> Hi Alex,
> 
> Thanks for the patch. It's in our TODO queue now  :-)
> 
> Regards,
>   Tony
> 


      
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-c.patch
Type: text/x-patch
Size: 3998 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/d505f5b5/attachment.bin>

From zhangmingtao at pingco.com  Wed Jul  7 03:04:27 2010
From: zhangmingtao at pingco.com (=?gb2312?B?1cXD98zO?=)
Date: Wed, 7 Jul 2010 10:04:27 +0800
Subject: [rabbitmq-discuss] rabbit is out of service in disk mode.
References: <DA048E9B69A30A4FA2202D5C92A85C82D78B16@pingco.local>,
	<4C33157F.6090800@rabbitmq.com>
Message-ID: <201007071004277180747@pingco.com>

Hi Emile ?
   Thanks a lot for your help?

   "The new persister" may be the solution , I will follow it. Thanks! 

   Regards.


2010-07-07 



??? 



???? Emile Joubert 
????? 2010-07-06  19:44:43 
???? ???; RabbitMQ Discuss 
??? 
??? Re: [rabbitmq-discuss] rabbit is out of service in disk mode. 
 
Hi ???,
Regardless of whether messages are published as persistent, all messages
are held in RAM. If you publish messages without consuming them them you
will eventually run out of RAM. Your server seems to have enough memory
for 9000 messages.
You will not be able to open any new channels to the broker after the
memory limit has been reached, but existing consumers may continue to
consume messages.
The source repository currently contains a new persister in branch
(bug21673) which will solve your problem. This feature is currently
undergoing QA.
The memory high-watermark is somewhat relevant to your situation. This
can be set in the config file (see
http://www.rabbitmq.com/install.html). The default of 40% is recommended.
Regards
Emile
On 06/07/10 09:39, ??? wrote:
> 
> I send messages(size:10kB) to a queue on single node,but with no
> consumers. Here is my java code:
>  
>   channel.exchangeDeclare(exec, "direct", true, false, null);
>   channel.queueDeclare("FirstQueue", true, false, false, null);
>   channel.queueBind(queueName, exec, routingKey);
>  
>   BasicProperties bp = new BasicProperties();
>   bp.setDeliveryMode(2);
>   channel.basicPublish(exec, routingKey, bp, messageBodyBytes);
>  
>  
>   When 9000 message sent, the producer was blocked, I got a message in log :
>   vm_memory_high_watermark set. Memory used:288650128 allowed:211065241
>   alarm_handler: {set,{vm_memory_high_watermark,[]}}
>  
>   Then I stop the rabbit,restart it, but I got same messages in log .
>  
>   If I start a consumer,it receives no messages either?
>  
>   Anyone knows how many messages can a queue persist? just 9000 ?
>   I want to persist all the messages, is it possible?
> 
>   Anyone give me some advice? Thks .
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100707/50ec248b/attachment.htm>

From lgreg.meredith at gmail.com  Wed Jul  7 07:06:24 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 6 Jul 2010 23:06:24 -0700
Subject: [rabbitmq-discuss] macports install failure
Message-ID: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>

Dear Rabbiters,

The following is a trace from a fresh install of rabbitmq-server on mac os x
snow leopard. The contents of the log file appear after the signature line.

bash-3.2$ sudo port install rabbitmq-server
--->  Computing dependencies for rabbitmq-server
--->  Fetching rabbitmq-server
--->  Attempting to fetch rabbitmq-server-1.7.2.tar.gz from
http://distfiles.macports.org/rabbitmq-server
--->  Verifying checksum(s) for rabbitmq-server
--->  Extracting rabbitmq-server
--->  Configuring rabbitmq-server
--->  Building rabbitmq-server
Error: Target org.macports.build returned: shell command failed
Log for rabbitmq-server is at:
/opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
Error: Status 1 encountered during processing.
To report a bug, see <http://guide.macports.org/#project.tickets>
bash-3.2$

Best wishes,

--greg

:info:build src/rabbit_exchange.erl:100: badly formed define: missing
closing right parenthesis
:info:build src/rabbit_exchange.erl:169: undefined macro 'INFO_KEYS'
:info:build src/rabbit_exchange.erl:185: undefined macro 'INFO_KEYS'
:info:build src/rabbit_exchange.erl:37: function info/1 undefined
:info:build src/rabbit_exchange.erl:37: function info_keys/0 undefined
:info:build src/rabbit_exchange.erl:71: spec for undefined function
rabbit_exchange:info_keys/0
:info:build src/rabbit_exchange.erl:72: spec for undefined function
rabbit_exchange:info/1
:info:build src/rabbit_exchange.erl:189: function info/1 undefined
:info:build src/rabbit_exchange.erl:538: Warning: regexp:split/2: the regexp
module is deprecated (will be removed in R15A); use the re module instead
:info:build make: *** [ebin/rabbit_exchange.beam] Error 1
:info:build make: *** Waiting for unfinished jobs....
:info:build shell command " cd
"/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-1.7.2"
&& /usr/bin/make -j2 all " returned error 2
:error:build Target org.macports.build returned: shell command failed
:debug:build Backtrace: shell command failed
    while executing
"command_exec build"
    (procedure "portbuild::build_main" line 8)
    invoked from within
"$procedure $targetname"
:info:build Warning: the following items did not execute (for
rabbitmq-server): org.macports.activate org.macports.build
org.macports.destroot org.macports.install
:notice:build Log for rabbitmq-server is at:
/opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log


-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100706/d1852022/attachment-0001.htm>

From lionel.cons at cern.ch  Wed Jul  7 07:09:27 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 7 Jul 2010 08:09:27 +0200
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4C33082C.4080304@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<vfqy6dzg01p.fsf@mercury.cern.ch> <4C28C63B.5000907@rabbitmq.com>
	<19497.35021.831383.102680@mercury.cern.ch>
	<AANLkTimwqXR_-bCCPTDMFE8dmHLxhQsDCfceJwSmLnk-@mail.gmail.com>
	<4C324B54.1050903@rabbitmq.com>
	<19506.54824.366624.7520@mercury.cern.ch>
	<4C32E467.8040401@rabbitmq.com>
	<19507.316.202319.131989@mercury.cern.ch>
	<4C33082C.4080304@rabbitmq.com>
Message-ID: <19508.6679.83166.377834@mercury.cern.ch>

Matthias Radestock writes:
 > So the question is, if the authentication is only of interest to
 > the broker, why does it get passed to the *consumer*? Would it
 > instead be sufficient to retain the credentials internally in the
 > broker and present them in various admin tools, but not pass them
 > to the consumers?

This looks like a good compromise. However, I would make this configurable.
I'm sure that in some cases consumers will need this information.

Cheers,

Lionel

From simon at rabbitmq.com  Wed Jul  7 10:24:39 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Jul 2010 10:24:39 +0100
Subject: [rabbitmq-discuss] macports install failure
In-Reply-To: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>
References: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>
Message-ID: <4C3447D7.1050207@rabbitmq.com>

On 07/07/10 07:06, Meredith Gregory wrote:
> Dear Rabbiters,
>
> The following is a trace from a fresh install of rabbitmq-server on mac
> os x snow leopard. The contents of the log file appear after the
> signature line.

Hi Meredith. This is a known problem - see

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-
June/007787.html

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Wed Jul  7 10:29:20 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 07 Jul 2010 10:29:20 +0100
Subject: [rabbitmq-discuss] macports install failure
In-Reply-To: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>
	(Meredith Gregory's message of "Tue, 6 Jul 2010 23:06:24 -0700")
References: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>
Message-ID: <yrv4cmxu3od1r.fsf@dwragg.eng.vmware.com>

Meredith Gregory <lgreg.meredith at gmail.com> writes:
> Dear Rabbiters,
>
> The following is a trace from a fresh install of rabbitmq-server on mac os x
> snow leopard. The contents of the log file appear after the signature line.

This is due to macports switching to erlang R14A.  To solve this, see:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-June/007787.html

Once you get past that, there is another bug in our macports port
at the moment.  See:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/007853.html

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From lgreg.meredith at gmail.com  Wed Jul  7 10:32:40 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Wed, 7 Jul 2010 02:32:40 -0700
Subject: [rabbitmq-discuss] macports install failure
In-Reply-To: <yrv4cmxu3od1r.fsf@dwragg.eng.vmware.com>
References: <AANLkTikfmKISIy1UBfdm9qA8SJJ__AOvBi6Asq9mcVrB@mail.gmail.com>
	<yrv4cmxu3od1r.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTilCoyD-UQ7WZ367YhGeK6aX25rPrMpySPX2V8fE@mail.gmail.com>

Dear David and Simon,

Thanks for your help!

Best wishes,

--greg

On Wed, Jul 7, 2010 at 2:29 AM, David Wragg <david at rabbitmq.com> wrote:

> Meredith Gregory <lgreg.meredith at gmail.com> writes:
> > Dear Rabbiters,
> >
> > The following is a trace from a fresh install of rabbitmq-server on mac
> os x
> > snow leopard. The contents of the log file appear after the signature
> line.
>
> This is due to macports switching to erlang R14A.  To solve this, see:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-June/007787.html
>
> Once you get past that, there is another bug in our macports port
> at the moment.  See:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/007853.html
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
1219 NW 83rd St
Seattle, WA 98117

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100707/52a5f8ed/attachment.htm>

From matthias at rabbitmq.com  Wed Jul  7 11:54:50 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Jul 2010 11:54:50 +0100
Subject: [rabbitmq-discuss] Passive versus active declaration of
 exchanges and queues
In-Reply-To: <AANLkTimaaNoW4Cqgv6sPD4Xni2AkxMOAQOFDEyKRLrmF@mail.gmail.com>
References: <AANLkTimaaNoW4Cqgv6sPD4Xni2AkxMOAQOFDEyKRLrmF@mail.gmail.com>
Message-ID: <4C345CFA.3030206@rabbitmq.com>

Irmo,

On 29/06/10 08:44, Irmo Manie wrote:
> Since 1.8.0 the passive declaration is separated, taking only a name as
> parameter and will not declare anything if the exchange or queue is not
> there yet.
> This does makes sense, so in theory, when wanting a passive declaration
> over active, you would first try passive and then active.

That is usually an anti-pattern since it's racy. Another client might 
create/remove the exchange after the passive declaration. Just actively 
declare the exchange instead.

> Now the problem:
>
> If passive declaration fails, it not only throws an exception, it also
> closes the channel.

AMQP only has two kinds of errors - those that close that channel and 
those that close the connection. Channel creation/closure is quite cheap 
in rabbit, so the former type of errors are quite lightweight.

Now, perhaps passive declaration should return a not-found response 
rather than a not-found error, but the protocol is what it is.

> Questions:
>
> - What is the added value of the Exchange.DeclareOk result?

So you know that the operation has completed successfully.

> - Why is there no API call available to check if an exchange exists (and
> with which parameters) so that this exception can be prevented?

As noted above, just perform an active declaration instead.

I have yet to find a genuine use case for passive declarations. But the 
operations are defined in the protocol and quite easy to implement, so 
rabbit supports them.


Regards,

Matthias.

From tim at evri.com  Wed Jul  7 21:37:57 2010
From: tim at evri.com (Timothy Chen)
Date: Wed, 07 Jul 2010 13:37:57 -0700
Subject: [rabbitmq-discuss] Regarding FIFO Support
Message-ID: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>

Hi all,
        
        I'm currently evaluating different message queue systems, and is
        interested in learning more about RabbitMQ.
        
        I remember reading from somewhere that RabbitMQ doesn't support
FIFO, or
        in other words doesn't gurantee ordering of messages being
published.
        
        I wonder if this is true?
        
        Thanks!
        
        Tim


From jasonjwwilliams at gmail.com  Wed Jul  7 21:43:07 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 7 Jul 2010 14:43:07 -0600
Subject: [rabbitmq-discuss] Regarding FIFO Support
In-Reply-To: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>
References: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>
Message-ID: <AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>

This is true.

-J

On Wed, Jul 7, 2010 at 2:37 PM, Timothy Chen <tim at evri.com> wrote:
> Hi all,
>
> ? ? ? ?I'm currently evaluating different message queue systems, and is
> ? ? ? ?interested in learning more about RabbitMQ.
>
> ? ? ? ?I remember reading from somewhere that RabbitMQ doesn't support
> FIFO, or
> ? ? ? ?in other words doesn't gurantee ordering of messages being
> published.
>
> ? ? ? ?I wonder if this is true?
>
> ? ? ? ?Thanks!
>
> ? ? ? ?Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Wed Jul  7 21:52:30 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Jul 2010 21:52:30 +0100
Subject: [rabbitmq-discuss] Regarding FIFO Support
In-Reply-To: <AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>
References: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>
	<AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>
Message-ID: <4C34E90E.1070707@rabbitmq.com>

Tim, Jason,

Jason J. W. Williams wrote:
> On Wed, Jul 7, 2010 at 2:37 PM, Timothy Chen <tim at evri.com> wrote:
>> I remember reading from somewhere that RabbitMQ doesn't support 
>> FIFO, or in other words doesn't gurantee ordering of messages being
>> published.
>>
>> I wonder if this is true?
> This is true.

or not.

RabbitMQ conforms to the ordering guarantees specified by AMQP. See 
section 4.7 of the AMQP 0-9-1 spec:

<quote>

4.7 Content Ordering Guarantees

The order of methods flowing across a channel is stable: methods are 
received in the same order as they are sent. This is guaranteed by the 
TCP/IP transport used by AMQP. Further, contents are processed in a
stable manner by the server. Specifically, contents flowing through a 
single path within the server will remain ordered. For contents of a 
given priority flowing through a single path, we define a content
processing path as consisting of one incoming channel, one exchange, one 
queue, and one outgoing channel.

Guidelines for implementors:

The server MUST preserve the order of contents flowing through a single 
content processing path, unless the redelivered field is set on the 
Basic.Deliver or Basic.Get-Ok methods, and according to the rules 
governing the conditions under which that field can be set.

</quote>


Regards,

Matthias.

From jasonjwwilliams at gmail.com  Wed Jul  7 22:02:16 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 7 Jul 2010 15:02:16 -0600
Subject: [rabbitmq-discuss] Regarding FIFO Support
In-Reply-To: <4C34E90E.1070707@rabbitmq.com>
References: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>
	<AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>
	<4C34E90E.1070707@rabbitmq.com>
Message-ID: <AANLkTil7GnYCYEUa5viJnX7IUsSI6zvPZkwhpushIgsM@mail.gmail.com>

Matthias,

That's good to know. Could have sworn there has been discussion here
about ensuring order of delivery is up to the consumer/producers
involved.

-J

On Wed, Jul 7, 2010 at 2:52 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Tim, Jason,
>
> Jason J. W. Williams wrote:
>>
>> On Wed, Jul 7, 2010 at 2:37 PM, Timothy Chen <tim at evri.com> wrote:
>>>
>>> I remember reading from somewhere that RabbitMQ doesn't support FIFO, or
>>> in other words doesn't gurantee ordering of messages being
>>> published.
>>>
>>> I wonder if this is true?
>>
>> This is true.
>
> or not.
>
> RabbitMQ conforms to the ordering guarantees specified by AMQP. See section
> 4.7 of the AMQP 0-9-1 spec:
>
> <quote>
>
> 4.7 Content Ordering Guarantees
>
> The order of methods flowing across a channel is stable: methods are
> received in the same order as they are sent. This is guaranteed by the
> TCP/IP transport used by AMQP. Further, contents are processed in a
> stable manner by the server. Specifically, contents flowing through a single
> path within the server will remain ordered. For contents of a given priority
> flowing through a single path, we define a content
> processing path as consisting of one incoming channel, one exchange, one
> queue, and one outgoing channel.
>
> Guidelines for implementors:
>
> The server MUST preserve the order of contents flowing through a single
> content processing path, unless the redelivered field is set on the
> Basic.Deliver or Basic.Get-Ok methods, and according to the rules governing
> the conditions under which that field can be set.
>
> </quote>
>
>
> Regards,
>
> Matthias.
>

From tim at evri.com  Wed Jul  7 22:07:50 2010
From: tim at evri.com (Timothy Chen)
Date: Wed, 07 Jul 2010 14:07:50 -0700
Subject: [rabbitmq-discuss] Regarding FIFO Support
In-Reply-To: <AANLkTil7GnYCYEUa5viJnX7IUsSI6zvPZkwhpushIgsM@mail.gmail.com>
References: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>
	<AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>
	<4C34E90E.1070707@rabbitmq.com>
	<AANLkTil7GnYCYEUa5viJnX7IUsSI6zvPZkwhpushIgsM@mail.gmail.com>
Message-ID: <1278536870.2517.4.camel@tchen-lenovo.evri.corp>

I thought I read that somewhere as well, but definitely good to know
there is ordering support now in RabbitMQ (a new feature? ).

Tim


On Wed, 2010-07-07 at 15:02 -0600, Jason J. W. Williams wrote:
> Matthias,
> 
> That's good to know. Could have sworn there has been discussion here
> about ensuring order of delivery is up to the consumer/producers
> involved.
> 
> -J
> 
> On Wed, Jul 7, 2010 at 2:52 PM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
> > Tim, Jason,
> >
> > Jason J. W. Williams wrote:
> >>
> >> On Wed, Jul 7, 2010 at 2:37 PM, Timothy Chen <tim at evri.com> wrote:
> >>>
> >>> I remember reading from somewhere that RabbitMQ doesn't support FIFO, or
> >>> in other words doesn't gurantee ordering of messages being
> >>> published.
> >>>
> >>> I wonder if this is true?
> >>
> >> This is true.
> >
> > or not.
> >
> > RabbitMQ conforms to the ordering guarantees specified by AMQP. See section
> > 4.7 of the AMQP 0-9-1 spec:
> >
> > <quote>
> >
> > 4.7 Content Ordering Guarantees
> >
> > The order of methods flowing across a channel is stable: methods are
> > received in the same order as they are sent. This is guaranteed by the
> > TCP/IP transport used by AMQP. Further, contents are processed in a
> > stable manner by the server. Specifically, contents flowing through a single
> > path within the server will remain ordered. For contents of a given priority
> > flowing through a single path, we define a content
> > processing path as consisting of one incoming channel, one exchange, one
> > queue, and one outgoing channel.
> >
> > Guidelines for implementors:
> >
> > The server MUST preserve the order of contents flowing through a single
> > content processing path, unless the redelivered field is set on the
> > Basic.Deliver or Basic.Get-Ok methods, and according to the rules governing
> > the conditions under which that field can be set.
> >
> > </quote>
> >
> >
> > Regards,
> >
> > Matthias.
> >



From matthias at rabbitmq.com  Wed Jul  7 22:13:43 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 07 Jul 2010 22:13:43 +0100
Subject: [rabbitmq-discuss] Regarding FIFO Support
In-Reply-To: <AANLkTil7GnYCYEUa5viJnX7IUsSI6zvPZkwhpushIgsM@mail.gmail.com>
References: <1278535077.2517.2.camel@tchen-lenovo.evri.corp>	<AANLkTinRTn_p5VwMPrsQHwFC4rwvzHl2zvKFIZgCV1RB@mail.gmail.com>	<4C34E90E.1070707@rabbitmq.com>
	<AANLkTil7GnYCYEUa5viJnX7IUsSI6zvPZkwhpushIgsM@mail.gmail.com>
Message-ID: <4C34EE07.1080200@rabbitmq.com>

Jason, Tim,

Jason J. W. Williams wrote:
> That's good to know. Could have sworn there has been discussion here
> about ensuring order of delivery is up to the consumer/producers
> involved.

Timothy Chen wrote:
 > I thought I read that somewhere as well, but definitely good to know
 > there is ordering support now in RabbitMQ (a new feature? ).

It's not a new feature. You may have seen is discussions involving 
scenarios which fall outside the conditions for which the ordering 
guarantees apply. It is all too easy to end up in such situations. In 
particular note the "unless the redelivered field is set" condition, 
which means any disconnect by consumers can cause messages pending 
acknowledgement to be subsequently delivered out of order.


Regards,

Matthias.

From kenneth at loafman.com  Thu Jul  8 00:12:21 2010
From: kenneth at loafman.com (Kenneth Loafman)
Date: Wed, 07 Jul 2010 18:12:21 -0500
Subject: [rabbitmq-discuss] Getting Data To Persist
Message-ID: <4C3509D5.5060008@loafman.com>

Hi,

I installed elasticsearch-0.8.0 on 64-bit Ubuntu 9.10 system.  It comes
up, runs fine, creates the indices I want, etc., but has a very serious
problem I can't trace down.  If I do a 'bin/service/elasticsearch
restart' command (change config/restart), the entire database
disappears.  I'm fairly certain this is not the desired action.  Here's
a console log showing what happens:

ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/
total 4
drwxr-xr-x 22 ken ken 4096 2010-07-07 17:48 74f73a5f-50a0-4ad4-a574-6466300b9399

<go off and run ES for a while, then restart>

ken at stealth:/opt/elasticsearch-0.8.0$ bin/service/elasticsearch restart
Stopping ElasticSearch...
Stopped ElasticSearch.
Starting ElasticSearch...Waiting for ElasticSearch......
ElasticSearch started.

ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/74f73a5f-50a0-4ad4-a574-6466300b9399/
ls: cannot access work/elasticsearch/indices/74f73a5f-50a0-4ad4-a574-6466300b9399/: No such file or directory
ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/
total 0

I've read through the docs many times (very terse), changed config,
blown it away and unzipped again, nothing helps.  Perhaps you can tell
me what I can do to correct the problem.  I'm pretty sure it should
persist the data.

...Thanks,
...Ken

From kenneth at loafman.com  Thu Jul  8 00:15:09 2010
From: kenneth at loafman.com (Kenneth Loafman)
Date: Wed, 07 Jul 2010 18:15:09 -0500
Subject: [rabbitmq-discuss] Getting Data To Persist
In-Reply-To: <4C3509D5.5060008@loafman.com>
References: <4C3509D5.5060008@loafman.com>
Message-ID: <4C350A7D.6030406@loafman.com>

Please ignore.  Wrong group.  Sorry.

Kenneth Loafman wrote:
> Hi,
>
> I installed elasticsearch-0.8.0 on 64-bit Ubuntu 9.10 system.  It comes
> up, runs fine, creates the indices I want, etc., but has a very serious
> problem I can't trace down.  If I do a 'bin/service/elasticsearch
> restart' command (change config/restart), the entire database
> disappears.  I'm fairly certain this is not the desired action.  Here's
> a console log showing what happens:
>
> ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/
> total 4
> drwxr-xr-x 22 ken ken 4096 2010-07-07 17:48 74f73a5f-50a0-4ad4-a574-6466300b9399
>
> <go off and run ES for a while, then restart>
>
> ken at stealth:/opt/elasticsearch-0.8.0$ bin/service/elasticsearch restart
> Stopping ElasticSearch...
> Stopped ElasticSearch.
> Starting ElasticSearch...Waiting for ElasticSearch......
> ElasticSearch started.
>
> ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/74f73a5f-50a0-4ad4-a574-6466300b9399/
> ls: cannot access work/elasticsearch/indices/74f73a5f-50a0-4ad4-a574-6466300b9399/: No such file or directory
> ken at stealth:/opt/elasticsearch-0.8.0$ ll work/elasticsearch/indices/
> total 0
>
> I've read through the docs many times (very terse), changed config,
> blown it away and unzipped again, nothing helps.  Perhaps you can tell
> me what I can do to correct the problem.  I'm pretty sure it should
> persist the data.
>
> ...Thanks,
> ...Ken
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>   

From lee at rightscale.com  Thu Jul  8 18:04:17 2010
From: lee at rightscale.com (Lee Kirchhoff)
Date: Thu, 8 Jul 2010 10:04:17 -0700
Subject: [rabbitmq-discuss] rabbitmq-erlang-client lagging behind server
	1.8.0
Message-ID: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>

The rabbitmq-erlang-client is required by a plugin we use with the
rabbitmq-server. We are currently using version 1.7.2 of the server and
would like to step to 1.8.0 but are blocked because rabbitmq-erlang-client
is lagging back at version 1.7.0 and is incompatible with 1.8.0. Is there
anyone working to bring rabbitmq-erlang-client forward, and if so, when is
it expected to be available?

Lee Kirchhoff
RightScale
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100708/61b154c4/attachment.htm>

From matthew at rabbitmq.com  Thu Jul  8 19:28:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Jul 2010 19:28:37 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client lagging behind server
 1.8.0
In-Reply-To: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>
References: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>
Message-ID: <20100708182836.GA20617@wellquite.org>

Hi Lee,

On Thu, Jul 08, 2010 at 10:04:17AM -0700, Lee Kirchhoff wrote:
> The rabbitmq-erlang-client is required by a plugin we use with the
> rabbitmq-server. We are currently using version 1.7.2 of the server and
> would like to step to 1.8.0 but are blocked because rabbitmq-erlang-client
> is lagging back at version 1.7.0 and is incompatible with 1.8.0. Is there
> anyone working to bring rabbitmq-erlang-client forward, and if so, when is
> it expected to be available?

The erlang client is unreleased. Hopefully that'll change in the near
future. However, until then, please use the head of the default branch
in the rabbitmq-erlang-client repo. We try to tag the repos with version
numbers when things *stop* working. So eg the erlang client tagged with
1.7.0 should be the *last* version that was known to work with the 1.7.0
broker. However, thinking about it, I can think of at least a couple of
changes which would have stopped the erlang client working with 1.7.2
and I suspect there is no version tagged with 1.7.2. In any case, I
would hope that if there is no 1.8.0 tagged erlang client then the
latest on default should work with the 1.8.0 release. If that's not the
case, please let us know and we'll track down and tag the correct
version.

Hopefully this mess should go away once we get to be able to release the
erlang client, which is a priority for us in the next few months.

Matthew

From ralf at reswi.de  Thu Jul  8 22:51:12 2010
From: ralf at reswi.de (Ralf Edmund Stranzenbach)
Date: Thu, 8 Jul 2010 23:51:12 +0200
Subject: [rabbitmq-discuss] C Client API tutorial
In-Reply-To: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
References: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
Message-ID: <7E08A248-3A0E-4D2E-B04D-39D63E562FE3@reswi.de>

Hi,

for a long time, i simply ignored RabbitMQ-C client due to the fact, that it is marked as experimental code.

But the last week i spent some time checking this AMQP implementation and found it usable - at least on the Mac-OSX development machine I use. The target environment will be the iPad / iPhone and the time i write this, I had no time to check this library in that environment.

Currently my first simple tests derived from the example code seem to work fine. So i'll declare this attempt a success.

Currently I'll try to implement a wrapper on top of the C-API that manages a connection from the iPhone to the server that (correctly) reacts on the Networking events send by the iOS. My target application requires a (more or less) stable connection to the RabbitMQ infrastructure, but this requires frequent dis- and reconnects as the networking environment for the devices changes.

The exchange of message should happen in the background - but I expect this to be a single thread handling all that AMPQ communications...

For the next steps it would be useful to have some API specification or better a tutorial on the amqp_ procedures provided by the library. Is there any easy understandable documentation on this topic?

Regards,
- Ralf

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3770 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100708/2a2076db/attachment.bin>

From scott at beamdog.com  Fri Jul  9 00:23:15 2010
From: scott at beamdog.com (Scott Brooks)
Date: Thu, 8 Jul 2010 17:23:15 -0600
Subject: [rabbitmq-discuss] C Client API tutorial
In-Reply-To: <7E08A248-3A0E-4D2E-B04D-39D63E562FE3@reswi.de>
References: <AANLkTin4omKN-DD0PiFKhCJ3IN_AATRh8rdNj-giPXNF@mail.gmail.com>
	<7E08A248-3A0E-4D2E-B04D-39D63E562FE3@reswi.de>
Message-ID: <AANLkTinhV_SDFoZiQUGgAzVOE_jQZ77cTMRO_uYmcFBQ@mail.gmail.com>

I wrote a wrapper around the rabbitmq-c client quite a while ago, and
I used the XML docs, and PDF's from www.amqp.org as my main reference.

The language used internally is quite similar to the specs so I used
those specs to track down the order I had to do things in.

Scott Brooks

On Thu, Jul 8, 2010 at 3:51 PM, Ralf Edmund Stranzenbach <ralf at reswi.de> wrote:
> Hi,
>
> for a long time, i simply ignored RabbitMQ-C client due to the fact, that it is marked as experimental code.
>
> But the last week i spent some time checking this AMQP implementation and found it usable - at least on the Mac-OSX development machine I use. The target environment will be the iPad / iPhone and the time i write this, I had no time to check this library in that environment.
>
> Currently my first simple tests derived from the example code seem to work fine. So i'll declare this attempt a success.
>
> Currently I'll try to implement a wrapper on top of the C-API that manages a connection from the iPhone to the server that (correctly) reacts on the Networking events send by the iOS. My target application requires a (more or less) stable connection to the RabbitMQ infrastructure, but this requires frequent dis- and reconnects as the networking environment for the devices changes.
>
> The exchange of message should happen in the background - but I expect this to be a single thread handling all that AMPQ communications...
>
> For the next steps it would be useful to have some API specification or better a tutorial on the amqp_ procedures provided by the library. Is there any easy understandable documentation on this topic?
>
> Regards,
> - Ralf
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From lee at rightscale.com  Fri Jul  9 02:10:47 2010
From: lee at rightscale.com (Lee Kirchhoff)
Date: Thu, 8 Jul 2010 18:10:47 -0700
Subject: [rabbitmq-discuss] rabbitmq-erlang-client lagging behind server
	1.8.0
In-Reply-To: <20100708182836.GA20617@wellquite.org>
References: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>
	<20100708182836.GA20617@wellquite.org>
Message-ID: <AANLkTin3G8_E3jd6SACD4it9z0mvAitcq5OYcxJWP0FX@mail.gmail.com>

Hi Matthew,

Thanks for the quick feedback.

A week or so ago when I used the tip (I assume that is what you mean by head
of default branch) of rabbitmq-erlang-client it failed with the 1.8.0
server, but I tried it again today and now it worked. The problem before was
that the rabbit_channel:start_link/6 function was missing the CollectorPid
parameter when called from within the client.

It seems risky for us to run off anything other than a tagged version of
rabbitmq-erlang-client. Could someone tag it at a stable point?

Lee

On Thu, Jul 8, 2010 at 11:28 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Lee,
>
> On Thu, Jul 08, 2010 at 10:04:17AM -0700, Lee Kirchhoff wrote:
> > The rabbitmq-erlang-client is required by a plugin we use with the
> > rabbitmq-server. We are currently using version 1.7.2 of the server and
> > would like to step to 1.8.0 but are blocked because
> rabbitmq-erlang-client
> > is lagging back at version 1.7.0 and is incompatible with 1.8.0. Is there
> > anyone working to bring rabbitmq-erlang-client forward, and if so, when
> is
> > it expected to be available?
>
> The erlang client is unreleased. Hopefully that'll change in the near
> future. However, until then, please use the head of the default branch
> in the rabbitmq-erlang-client repo. We try to tag the repos with version
> numbers when things *stop* working. So eg the erlang client tagged with
> 1.7.0 should be the *last* version that was known to work with the 1.7.0
> broker. However, thinking about it, I can think of at least a couple of
> changes which would have stopped the erlang client working with 1.7.2
> and I suspect there is no version tagged with 1.7.2. In any case, I
> would hope that if there is no 1.8.0 tagged erlang client then the
> latest on default should work with the 1.8.0 release. If that's not the
> case, please let us know and we'll track down and tag the correct
> version.
>
> Hopefully this mess should go away once we get to be able to release the
> erlang client, which is a priority for us in the next few months.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100708/fb980b7d/attachment.htm>

From fblanch at gmail.com  Fri Jul  9 11:09:17 2010
From: fblanch at gmail.com (Francisco Gonzalez-Blanch)
Date: Fri, 9 Jul 2010 12:09:17 +0200
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers- multi
	consumers
Message-ID: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>

Hi all,

I'm a newbie in rabbitmq and i'm working on a distributed data processing
application using rabbitmq as distributed task queue. I want to ask you
about where can i find information about how to make persistent queues, and
how to make that, if a producer sends messages to queue and no one is listen
to it and then a consumer is attached , the consumer gets all the messages,
even the ones that were produced before the consumer was attached. Thank you
very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/84f513f1/attachment-0001.htm>

From lists at zopyx.com  Fri Jul  9 11:22:02 2010
From: lists at zopyx.com (Andreas Jung)
Date: Fri, 09 Jul 2010 12:22:02 +0200
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
 multi	consumers
In-Reply-To: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
Message-ID: <4C36F84A.6070602@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Francisco Gonzalez-Blanch wrote:
> Hi all,
> 
> I'm a newbie in rabbitmq and i'm working on a distributed data
> processing application using rabbitmq as distributed task queue. I want
> to ask you about where can i find information about how to make
> persistent queues, and how to make that, if a producer sends messages to
> queue and no one is listen to it and then a consumer is attached , the
> consumer gets all the messages, even the ones that were produced before
> the consumer was attached. Thank you very much.

Queues are configured/created by the consumer (not by the producer) and
they must be marked as "durable". In Python we do something like

 15         conn = BrokerConnection(hostname=config['host'],
 16                                 port=config['port'],
 17                                 userid=config['username'],
 18                                 password=config['password'])
 19         consumer = Consumer(connection=conn,
 20                             queue=config['queue'],
 21                             routing_key=config['queue'],
 22                             exchange=exchange,
 23                             durable=True,
 24                             )

Other bindings likely take a similar approach/API.

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkw2+EoACgkQCJIWIbr9KYzPjwCg4wAh/fgiScBPGgS3o1EsD+VP
VuUAnittbMxyxNpfY77sxi2kE8mYKl7k
=K1Qd
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 330 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/0be53da0/attachment.vcf>

From ovidiudeac at gmail.com  Fri Jul  9 12:37:29 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 9 Jul 2010 14:37:29 +0300
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <4C36F84A.6070602@zopyx.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
	<4C36F84A.6070602@zopyx.com>
Message-ID: <AANLkTilCpbToKQAJdYXnl_LmA-97wt7bEzZXYR7n5FVg@mail.gmail.com>

You also have to:
"1. Mark the exchange ?durable?.
2. Mark the queue ?durable?.
3. Set the message?s ?delivery mode? to a value of 2"

See the long version for python here:
http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/

On Fri, Jul 9, 2010 at 1:22 PM, Andreas Jung <lists at zopyx.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Francisco Gonzalez-Blanch wrote:
>> Hi all,
>>
>> I'm a newbie in rabbitmq and i'm working on a distributed data
>> processing application using rabbitmq as distributed task queue. I want
>> to ask you about where can i find information about how to make
>> persistent queues, and how to make that, if a producer sends messages to
>> queue and no one is listen to it and then a consumer is attached , the
>> consumer gets all the messages, even the ones that were produced before
>> the consumer was attached. Thank you very much.
>
> Queues are configured/created by the consumer (not by the producer) and
> they must be marked as "durable". In Python we do something like
>
> ?15 ? ? ? ? conn = BrokerConnection(hostname=config['host'],
> ?16 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? port=config['port'],
> ?17 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? userid=config['username'],
> ?18 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? password=config['password'])
> ?19 ? ? ? ? consumer = Consumer(connection=conn,
> ?20 ? ? ? ? ? ? ? ? ? ? ? ? ? ? queue=config['queue'],
> ?21 ? ? ? ? ? ? ? ? ? ? ? ? ? ? routing_key=config['queue'],
> ?22 ? ? ? ? ? ? ? ? ? ? ? ? ? ? exchange=exchange,
> ?23 ? ? ? ? ? ? ? ? ? ? ? ? ? ? durable=True,
> ?24 ? ? ? ? ? ? ? ? ? ? ? ? ? ? )
>
> Other bindings likely take a similar approach/API.
>
> - -aj
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (Darwin)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
>
> iEYEARECAAYFAkw2+EoACgkQCJIWIbr9KYzPjwCg4wAh/fgiScBPGgS3o1EsD+VP
> VuUAnittbMxyxNpfY77sxi2kE8mYKl7k
> =K1Qd
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From ovidiudeac at gmail.com  Fri Jul  9 12:39:11 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 9 Jul 2010 14:39:11 +0300
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
Message-ID: <AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>

If nobody extracts the message from the queue the message won't be lost.

On Fri, Jul 9, 2010 at 1:09 PM, Francisco Gonzalez-Blanch
<fblanch at gmail.com> wrote:
> Hi all,
> I'm a newbie in rabbitmq and i'm working on a distributed data processing
> application using rabbitmq as distributed task queue. I want to ask you
> about where can i find information about how to make persistent queues, and
> how to make that, if a producer sends messages to queue and no one is listen
> to it and then a consumer is attached , the consumer gets all the messages,
> even the ones that were produced before the consumer was attached. Thank you
> very much.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From fblanch at gmail.com  Fri Jul  9 12:49:01 2010
From: fblanch at gmail.com (Francisco Gonzalez-Blanch)
Date: Fri, 9 Jul 2010 13:49:01 +0200
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com> 
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
Message-ID: <AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>

Thanks for the answers!  But If the producer is launched first and then the
consumer, i'm losing all the initial messages until the consumer is created.
I attach you the code snippets with the test.


/** Producer  **/

ConnectionFactory factory = new ConnectionFactory();

        factory.setUsername("guest");
        factory.setPassword("guest");
        factory.setVirtualHost("/");
        factory.setRequestedHeartbeat(0);
        factory.setHost("127.0.0.1");
        factory.setPort(5672);

        Connection conn = factory.newConnection();

        Channel channel = conn.createChannel();
        String exchangeName = "myExchangeFanOut";
        String routingKey = "testRoute";

        for(int i= 0; i<1000000;i++){
            StringBuilder miCadena = new StringBuilder("Message num: ");
            miCadena.append(i);
            byte[] messageBodyBytes = miCadena.toString().getBytes();
            channel.basicPublish(exchangeName, routingKey,
MessageProperties.PERSISTENT_TEXT_PLAIN, messageBodyBytes) ;
            System.out.println("Sending message num: " + i);
        }
        channel.close();
        conn.close();

/** Consumer **/

ConnectionFactory factory = new ConnectionFactory();

        factory.setUsername("guest");
        factory.setPassword("guest");
        factory.setVirtualHost("/");
        factory.setRequestedHeartbeat(0);
        factory.setHost("127.0.0.1");
        factory.setPort(5672);

        Connection conn = factory.newConnection();

        Channel channel = conn.createChannel();
        String exchangeName = "myExchangeFanOut";
        String queueName = "myQueue";
        String routingKey = "testRoute";
        boolean durable = true;
        channel.exchangeDeclare(exchangeName, "fanout", durable);
        channel.queueDeclare(queueName, durable, true, true,null); //
parametros
        channel.queueBind(queueName, exchangeName, routingKey);

        boolean noAck = false;
        QueueingConsumer consumer = new QueueingConsumer(channel);
        channel.basicConsume(queueName, noAck, consumer);
        boolean runInfinite = true;

        while (runInfinite) {
            QueueingConsumer.Delivery delivery;
            try {
                delivery = consumer.nextDelivery();
            } catch (InterruptedException ie) {
                continue;
            }
            System.out.println("Processing received message. " + new
String(delivery.getBody()));
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
false);
        }

        channel.close();
        conn.close();


In addition i have another question , is it possible to make that not all
the consumers get all the messages  with a fanout exchange, i mean is it
possible to balance the messages in between the consumers. Thanks a lot.
regards!

Francisco Gonz?lez-Blanch Rodr?guez


On Fri, Jul 9, 2010 at 1:39 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:

> If nobody extracts the message from the queue the message won't be lost.
>
> On Fri, Jul 9, 2010 at 1:09 PM, Francisco Gonzalez-Blanch
> <fblanch at gmail.com> wrote:
> > Hi all,
> > I'm a newbie in rabbitmq and i'm working on a distributed data processing
> > application using rabbitmq as distributed task queue. I want to ask you
> > about where can i find information about how to make persistent queues,
> and
> > how to make that, if a producer sends messages to queue and no one is
> listen
> > to it and then a consumer is attached , the consumer gets all the
> messages,
> > even the ones that were produced before the consumer was attached. Thank
> you
> > very much.
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/3cf288ce/attachment.htm>

From simon at rabbitmq.com  Fri Jul  9 12:56:50 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Jul 2010 12:56:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
 multi consumers
In-Reply-To: <AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
Message-ID: <4C370E82.8090208@rabbitmq.com>

On 09/07/10 12:49, Francisco Gonzalez-Blanch wrote:
> Thanks for the answers!  But If the producer is launched first and then
> the consumer, i'm losing all the initial messages until the consumer is
> created. I attach you the code snippets with the test.

I think contrary to what Andreas said, in your case you should have the 
producer create a queue with a well known name when it starts up, which 
the consumer can connect to. ATM with your code no queue exists until a 
consumer creates it, so all messages before that point are dropped.

<code snipped>

> In addition i have another question , is it possible to make that not
> all the consumers get all the messages  with a fanout exchange, i mean
> is it possible to balance the messages in between the consumers. Thanks
> a lot. regards!

If each consumer creates its own queue, each consumer will get all the 
messages.

If each consumer connects to the same queue, the messages will be 
balanced among the consumers.

NB this balancing will not be very fair if the consumers connect to a 
preexisting queue with a bunch of messages, unless you set the prefetch 
count using basic.qos. Once the existing messages are drained and the 
queue is empty it will round-robin subsequent messages.

Cheers, Simon
>
> Francisco Gonz?lez-Blanch Rodr?guez
>
>
> On Fri, Jul 9, 2010 at 1:39 PM, Ovidiu Deac <ovidiudeac at gmail.com
> <mailto:ovidiudeac at gmail.com>> wrote:
>
>     If nobody extracts the message from the queue the message won't be lost.
>
>     On Fri, Jul 9, 2010 at 1:09 PM, Francisco Gonzalez-Blanch
>     <fblanch at gmail.com <mailto:fblanch at gmail.com>> wrote:
>      > Hi all,
>      > I'm a newbie in rabbitmq and i'm working on a distributed data
>     processing
>      > application using rabbitmq as distributed task queue. I want to
>     ask you
>      > about where can i find information about how to make persistent
>     queues, and
>      > how to make that, if a producer sends messages to queue and no
>     one is listen
>      > to it and then a consumer is attached , the consumer gets all the
>     messages,
>      > even the ones that were produced before the consumer was
>     attached. Thank you
>      > very much.
>      >
>      >
>      >
>      > _______________________________________________
>      > rabbitmq-discuss mailing list
>      > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>      > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>      >
>      >
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From fblanch at gmail.com  Fri Jul  9 14:08:09 2010
From: fblanch at gmail.com (Francisco Gonzalez-Blanch)
Date: Fri, 9 Jul 2010 15:08:09 +0200
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <4C37174B.2070808@gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com> 
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com> 
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com> 
	<4C37174B.2070808@gmail.com>
Message-ID: <AANLkTinV9qviXXs8JyA-53qQM9Tvb5W_ZChnlPI8hk9j@mail.gmail.com>

Dear Andreas,

Sorry i'm sure the queues are properly created during the startup. I wanted
to ask you that, (With the code above listed) How can the consumer receive
the messages sent by the producer before the consumer was started?

Francisco Gonz?lez-Blanch Rodr?guez


On Fri, Jul 9, 2010 at 2:34 PM, <zopyxfilter at gmail.com> wrote:

> Francisco Gonzalez-Blanch wrote:
> > Thanks for the answers!  But If the producer is launched first and then
> > the consumer, i'm losing all the initial messages until the consumer is
> > created.
>
> Our application code ensures that the queues are properly created during
> the startup phase and are available for the producers inside our app.
>
> Andreas
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/522999f1/attachment-0001.htm>

From fblanch at gmail.com  Fri Jul  9 14:18:02 2010
From: fblanch at gmail.com (Francisco Gonzalez-Blanch)
Date: Fri, 9 Jul 2010 15:18:02 +0200
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <4C37202F.7010905@gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com> 
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com> 
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com> 
	<4C37174B.2070808@gmail.com>
	<AANLkTinV9qviXXs8JyA-53qQM9Tvb5W_ZChnlPI8hk9j@mail.gmail.com> 
	<4C37202F.7010905@gmail.com>
Message-ID: <AANLkTikb1gWaZnZjBqnD6HL7c8OuTKdrYKE_i0fHiX7u@mail.gmail.com>

May be what i'm trying to do it is not possible :S .

My idea is to create a dynamic pool of consumers that dynamically connect to
a exchange. And receive the messages sent to that exchange. These messages
could be sent before any consumer is connected to the exchange.

If it is not possible, may be i ca  create a static initial consumer and
then create the others on demand.

Francisco Gonz?lez-Blanch Rodr?guez


On Fri, Jul 9, 2010 at 3:12 PM, <zopyxfilter at gmail.com> wrote:

>
> Consumers getting messages before they are started? What?
>
> -aj
>
> Francisco Gonzalez-Blanch wrote:
> > Dear Andreas,
> >
> > Sorry i'm sure the queues are properly created during the startup. I
> > wanted to ask you that, (With the code above listed) How can the
> > consumer receive the messages sent by the producer before the consumer
> > was started?
> >
> > Francisco Gonz?lez-Blanch Rodr?guez
> >
> >
> > On Fri, Jul 9, 2010 at 2:34 PM, <zopyxfilter at gmail.com
> > <mailto:zopyxfilter at gmail.com>> wrote:
> >
> >     Francisco Gonzalez-Blanch wrote:
> >     > Thanks for the answers!  But If the producer is launched first and
> >     then
> >     > the consumer, i'm losing all the initial messages until the
> >     consumer is
> >     > created.
> >
> >     Our application code ensures that the queues are properly created
> during
> >     the startup phase and are available for the producers inside our app.
> >
> >     Andreas
> >
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/380cca8c/attachment.htm>

From ovidiudeac at gmail.com  Fri Jul  9 14:19:15 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 9 Jul 2010 16:19:15 +0300
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
Message-ID: <AANLkTilAbuCfax5rAFaa3XjzTuWyMV2HaRzQueudBUoy@mail.gmail.com>

You should have the exchange, the queue and the binding set up before
the message is sent. Otherwise the message is unroutable.



On Fri, Jul 9, 2010 at 2:49 PM, Francisco Gonzalez-Blanch
<fblanch at gmail.com> wrote:
> Thanks for the answers! ?But If the producer is launched first and then the
> consumer, i'm losing all the initial messages until the consumer is created.
> I attach you the code snippets with the test.

From ovidiudeac at gmail.com  Fri Jul  9 14:24:37 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 9 Jul 2010 16:24:37 +0300
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
	multi consumers
In-Reply-To: <AANLkTikb1gWaZnZjBqnD6HL7c8OuTKdrYKE_i0fHiX7u@mail.gmail.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
	<4C37174B.2070808@gmail.com>
	<AANLkTinV9qviXXs8JyA-53qQM9Tvb5W_ZChnlPI8hk9j@mail.gmail.com>
	<4C37202F.7010905@gmail.com>
	<AANLkTikb1gWaZnZjBqnD6HL7c8OuTKdrYKE_i0fHiX7u@mail.gmail.com>
Message-ID: <AANLkTikFDDBqJxk3Ks9jDy-bP6IujCPjbvK3O_-mCpHx@mail.gmail.com>

I think there is a misunderstanding of terms here.

The messages are send to EXCHANGES.
Based on the exchange type and BINDINGS (routes) RabbitMQ takes the
message from the exchange and puts it in the apropriate QUEUES.
Then the consumers extract messages from QUEUES.

You need to have the queues and the bindings set up before you send the message.

On Fri, Jul 9, 2010 at 4:18 PM, Francisco Gonzalez-Blanch
<fblanch at gmail.com> wrote:
> May be what i'm trying to do it is not possible :S .
> My idea is to create a dynamic pool of consumers that dynamically connect to
> a exchange. And receive the messages sent to that exchange. These messages
> could be sent before any consumer is connected to the exchange.
>
> If it is not possible, may be i ca ?create a static initial consumer and
> then create the others on demand.
> Francisco Gonz?lez-Blanch Rodr?guez
>
>
> On Fri, Jul 9, 2010 at 3:12 PM, <zopyxfilter at gmail.com> wrote:
>>
>> Consumers getting messages before they are started? What?
>>
>> -aj
>>
>> Francisco Gonzalez-Blanch wrote:
>> > Dear Andreas,
>> >
>> > Sorry i'm sure the queues are properly created during the startup. I
>> > wanted to ask you that, (With the code above listed) How can the
>> > consumer receive the messages sent by the producer before the consumer
>> > was started?
>> >
>> > Francisco Gonz?lez-Blanch Rodr?guez
>> >
>> >
>> > On Fri, Jul 9, 2010 at 2:34 PM, <zopyxfilter at gmail.com
>> > <mailto:zopyxfilter at gmail.com>> wrote:
>> >
>> > ? ? Francisco Gonzalez-Blanch wrote:
>> > ? ? > Thanks for the answers! ?But If the producer is launched first and
>> > ? ? then
>> > ? ? > the consumer, i'm losing all the initial messages until the
>> > ? ? consumer is
>> > ? ? > created.
>> >
>> > ? ? Our application code ensures that the queues are properly created
>> > during
>> > ? ? the startup phase and are available for the producers inside our
>> > app.
>> >
>> > ? ? Andreas
>> >
>> >
>> >
>> > ------------------------------------------------------------------------
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From tim at evri.com  Fri Jul  9 18:51:47 2010
From: tim at evri.com (Timothy Chen)
Date: Fri, 09 Jul 2010 10:51:47 -0700
Subject: [rabbitmq-discuss] Message Priority support and HA Failover
Message-ID: <1278697907.2517.1005.camel@tchen-lenovo.evri.corp>

Hi all,

Get two more questions about rabbit mq here.

I've been reading more about the clustering and ha failover of rabbit
mq, and sounds like there is no out of the box solution for live
failover when a node fails? I see that the routing information will be
persisted and can be transferred over to another node, but messages will
not?

Also, are there messages priority support in RabbitMQ currently?

Thanks,

Tim


From gtcampbell at gmail.com  Fri Jul  9 20:06:39 2010
From: gtcampbell at gmail.com (Greg Campbell)
Date: Fri, 9 Jul 2010 12:06:39 -0700
Subject: [rabbitmq-discuss] rabbitmq-erlang-client lagging behind server
	1.8.0
In-Reply-To: <AANLkTin3G8_E3jd6SACD4it9z0mvAitcq5OYcxJWP0FX@mail.gmail.com>
References: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>
	<20100708182836.GA20617@wellquite.org>
	<AANLkTin3G8_E3jd6SACD4it9z0mvAitcq5OYcxJWP0FX@mail.gmail.com>
Message-ID: <AANLkTik8GMsuS10OqGRVxs7FyFEM04ON92iwp5riK2l3@mail.gmail.com>

It's my understanding that "tip" is not what you want to use - that just
refers to the most recently committed revision in *any* branch.  See
http://www.rabbitmq.com/mercurial.html for more.

I would also welcome a release of the Erlang client, as it can be a bit
onerous to keep track of the versions under the current system. Is there any
way the community can be of assistance in this effort?

On Thu, Jul 8, 2010 at 6:10 PM, Lee Kirchhoff <lee at rightscale.com> wrote:

> Hi Matthew,
>
> Thanks for the quick feedback.
>
> A week or so ago when I used the tip (I assume that is what you mean by
> head of default branch) of rabbitmq-erlang-client it failed with the 1.8.0
> server, but I tried it again today and now it worked. The problem before was
> that the rabbit_channel:start_link/6 function was missing the CollectorPid
> parameter when called from within the client.
>
> It seems risky for us to run off anything other than a tagged version of
> rabbitmq-erlang-client. Could someone tag it at a stable point?
>
> Lee
>
>
> On Thu, Jul 8, 2010 at 11:28 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> Hi Lee,
>>
>> On Thu, Jul 08, 2010 at 10:04:17AM -0700, Lee Kirchhoff wrote:
>> > The rabbitmq-erlang-client is required by a plugin we use with the
>> > rabbitmq-server. We are currently using version 1.7.2 of the server and
>> > would like to step to 1.8.0 but are blocked because
>> rabbitmq-erlang-client
>> > is lagging back at version 1.7.0 and is incompatible with 1.8.0. Is
>> there
>> > anyone working to bring rabbitmq-erlang-client forward, and if so, when
>> is
>> > it expected to be available?
>>
>> The erlang client is unreleased. Hopefully that'll change in the near
>> future. However, until then, please use the head of the default branch
>> in the rabbitmq-erlang-client repo. We try to tag the repos with version
>> numbers when things *stop* working. So eg the erlang client tagged with
>> 1.7.0 should be the *last* version that was known to work with the 1.7.0
>> broker. However, thinking about it, I can think of at least a couple of
>> changes which would have stopped the erlang client working with 1.7.2
>> and I suspect there is no version tagged with 1.7.2. In any case, I
>> would hope that if there is no 1.8.0 tagged erlang client then the
>> latest on default should work with the 1.8.0 release. If that's not the
>> case, please let us know and we'll track down and tag the correct
>> version.
>>
>> Hopefully this mess should go away once we get to be able to release the
>> erlang client, which is a priority for us in the next few months.
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/58572e54/attachment-0001.htm>

From pneumann at gmail.com  Fri Jul  9 20:08:21 2010
From: pneumann at gmail.com (Phillip Neumann)
Date: Fri, 9 Jul 2010 15:08:21 -0400
Subject: [rabbitmq-discuss] Stomp over Websockets
Message-ID: <95922289-73ED-48CE-9473-6439C8EBD410@gmail.com>

Hello all,

Ive been reading a post (http://blog.higher-order.net/2010/06/01/stomple-rc1-combining-websockets-and-reliable-messaging/ 
) wich looks pretty interesting.

The javascript library is sending stomp requests over Websockets.

Is there anyone motivated to expose stomp over websocket for RabbitMQ?

Just wondering if there any work like the guys at HornetMQ or ActiveMQ.

Thanks!


http://code.google.com/p/misultin/wiki/ExamplesPage#Misultin_Websockets
http://www.nighttale.net/activemq/activemq-54-stomp-over-web-sockets.html

From jon at jbrisbin.com  Fri Jul  9 21:43:20 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 9 Jul 2010 15:43:20 -0500
Subject: [rabbitmq-discuss] fastest way to process messages?
Message-ID: <DA2FD69D-B01A-4920-8E89-E473A633217C@jbrisbin.com>

I pushed a rough draft/alpha version of the asynchronous distributed cache I blogged about last week to GitHub. It works pretty well for a rough draft. I am noticing some pretty large variances in my metrics from one run to another, though. I'm throwing 25 messages at a time at an object with 25 workers waiting for those objects (so there's no waiting for objects to be processed). I'm seeing run times as fast as 10ms and as slow as 150-200ms. It really varies from one run to the next.

I'm sure there are bottlenecks in my code. I'm starting to investigate that right now. But I was wondering if there was some consensus on maximizing throughput (using the Java client). Since this is a cache, I'm wanting to keep load times to an absolute minimum (duh). In several runs, I've gotten down to 10-15 ms but I can't get it to do that consistently.

Will I be able to process more messages if each of my workers has its own queue, but binds to the exchange using a common key--or should I do what I'm currently doing, which is to use the QueueingConsumer and simply use multiple workers to pull messages off the single BlockingQueue? Which has the potential for higher throughput while not increasing the likelihood I'll end up with duplicate messages?

Is there a better way to process messages if performance is the primary consideration than using the QueueingConsumer? I've haven't looked at the code to see what it's doing, but I would think fewer method calls between delivery of the message and calling the callback provided by the application code would give me greater throughput and shorter run times.

I should probably also investigate alternative languages. I started this as a Java object cache, so naturally I used Java. But I'm wondering if I could get better performance by skipping the serialize/deserialize step in the cache provider (I'm storing actual objects in memory rather than the byte array, which I considered doing at first).

Have a good weekend!

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100709/138d385b/attachment.htm>

From akhil.kodali at gmail.com  Fri Jul  9 21:46:35 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Sat, 10 Jul 2010 02:16:35 +0530
Subject: [rabbitmq-discuss] timed / delayed messages
Message-ID: <AANLkTikmTUpjRdcQRoazhD8JjAi1gEUJ5nm_QRGkMRin@mail.gmail.com>

Hi,

Forgive me if this is a wrong forum for this type of question.

I need to check if the order/message has been processed(not just consumed)
by a client in 2 hours.
On successfull processing the orders are updated accordingly.
I use queues specific to clients to route the orders/messages

Would it be a good idea to send a copy to a new queue where I can begin to
consume the message once they are past due i.e. 2 hrs and check their
status
If I use this approach I'd end up having 2 hrs worth of messages in the
queue.
It aint much now but I see it going upto 20,000 in 2 hrs quickly.

Or would it be better making a DB query to do the same. Going through all
the rows doesnt seem right.

What I wanted to check was, are queues build for such a use case or is there
a better way of doing it?

Thank you
Akhil Kodali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100710/b2ae5f2b/attachment.htm>

From jon at jbrisbin.com  Sat Jul 10 15:47:34 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Sat, 10 Jul 2010 09:47:34 -0500
Subject: [rabbitmq-discuss] mnesia is overloaded
Message-ID: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>

I'm running some tests locally and I'm making a change and then just re-running the unit test, which fires up a bunch of listeners and starts dumping messages right away. Randomly, one part of my tests will hang. I noticed the following in the log file. Do I need to change some settings or something? I'm only sending several dozen messages at once...

=WARNING REPORT==== 10-Jul-2010::09:01:05 ===
Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded: {dump_log,
                                                                    time_threshold}

=WARNING REPORT==== 10-Jul-2010::09:01:05 ===
Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded: {dump_log,
                                                                    time_threshold}

It looks like one log message per sender (each in their own thread) and the first half of the test works but it has trouble sending responses back to the requestor, which is where it hangs.

I'm on OS X 10.6 with MacPorts-installed RabbitMQ 1.7.2 broker with the 1.8.0 client (though I did notice the same behaviour yesterday using 1.8.0 broker on Ubuntu...just didn't check the logs).


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100710/da9a03eb/attachment.htm>

From ovidiudeac at gmail.com  Sat Jul 10 16:11:23 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Sat, 10 Jul 2010 18:11:23 +0300
Subject: [rabbitmq-discuss] mnesia is overloaded
In-Reply-To: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>
References: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>
Message-ID: <AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>

I remember seeing this thread on erlang-questions some time ago:
http://www.erlang.org/pipermail/erlang-questions/2006-July/021484.html

Maybe it helps.

On Sat, Jul 10, 2010 at 5:47 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> I'm running some tests locally and I'm making a change and then just
> re-running the unit test, which fires up a bunch of listeners and starts
> dumping messages right away. Randomly, one part of my tests will hang. I
> noticed the following in the log file. Do I need to change some settings or
> something? I'm only sending several dozen messages at once...
> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
> {dump_log,
>
> ?time_threshold}
> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
> {dump_log,
>
> ?time_threshold}
> It looks like one log message per sender (each in their own thread) and the
> first half of the test works but it has trouble sending responses back to
> the requestor, which is where it hangs.
> I'm on OS X 10.6 with MacPorts-installed RabbitMQ 1.7.2 broker with the
> 1.8.0 client (though I did notice the same behaviour yesterday using 1.8.0
> broker on Ubuntu...just didn't check the logs).
>
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From tonyg at lshift.net  Sun Jul 11 02:48:12 2010
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 11 Jul 2010 13:48:12 +1200
Subject: [rabbitmq-discuss] Stomp over Websockets
In-Reply-To: <95922289-73ED-48CE-9473-6439C8EBD410@gmail.com>
References: <95922289-73ED-48CE-9473-6439C8EBD410@gmail.com>
Message-ID: <4C3922DC.9070402@lshift.net>

Phillip Neumann wrote:
> The javascript library is sending stomp requests over Websockets.
> Is there anyone motivated to expose stomp over websocket for RabbitMQ?

It'd be easy enough to do given mochiweb websocket support. It looks like a few
people are working on that right now, but it still seems quite up-in-the-air
and unsettled.

There are some interesting limitations of the approach - in particular,
websockets can't transmit binary data! - but it's still probably an avenue
worth exploring.

Tony


From simon at rabbitmq.com  Mon Jul 12 11:57:04 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Jul 2010 11:57:04 +0100
Subject: [rabbitmq-discuss] fastest way to process messages?
In-Reply-To: <DA2FD69D-B01A-4920-8E89-E473A633217C@jbrisbin.com>
References: <DA2FD69D-B01A-4920-8E89-E473A633217C@jbrisbin.com>
Message-ID: <4C3AF500.1080903@rabbitmq.com>

On 09/07/10 21:43, Jon Brisbin wrote:
> I pushed a rough draft/alpha version of the asynchronous distributed
> cache I blogged about last week to GitHub. It works pretty well for a
> rough draft. I am noticing some pretty large variances in my metrics
> from one run to another, though. I'm throwing 25 messages at a time at
> an object with 25 workers waiting for those objects (so there's no
> waiting for objects to be processed). I'm seeing run times as fast as
> 10ms and as slow as 150-200ms. It really varies from one run to the next.

Hi Jon. I would first of all suggest you use a profiler to check whether 
the bottlenecks are in the server or your client, and if so where. But I 
guess you already knew that :)

> I'm sure there are bottlenecks in my code. I'm starting to investigate
> that right now. But I was wondering if there was some consensus on
> maximizing throughput (using the Java client). Since this is a cache,
> I'm wanting to keep load times to an absolute minimum (duh). In several
> runs, I've gotten down to 10-15 ms but I can't get it to do that
> consistently.
>
> Will I be able to process more messages if each of my workers has its
> own queue, but binds to the exchange using a common key--or should I do
> what I'm currently doing, which is to use the QueueingConsumer and
> simply use multiple workers to pull messages off the single
> BlockingQueue? Which has the potential for higher throughput while not
> increasing the likelihood I'll end up with duplicate messages?

If each worker has its own queue, each worker will get a copy of all 
messages (or a subset depending on how you do routing). It sounds like 
this is not what you want.

> Is there a better way to process messages if performance is the primary
> consideration than using the QueueingConsumer? I've haven't looked at
> the code to see what it's doing, but I would think fewer method calls
> between delivery of the message and calling the callback provided by the
> application code would give me greater throughput and shorter run times.

QueueingConsumer implements the Consumer interface and stores messages 
inside a LinkedBlockingQueue. I'm not sure of how performant that is, 
but it shouldn't be too bad.

If you determine that's where the problems lie, you can implement 
Consumer yourself. You should make sure that you implement 
handleDelivery() in such a way as to be very fast - that method is 
invoked by the Connection main loop so the Connection will block while 
it runs (this is the motivation for the existence of QueueingConsumer).

> I should probably also investigate alternative languages. I started this
> as a Java object cache, so naturally I used Java. But I'm wondering if I
> could get better performance by skipping the serialize/deserialize step
> in the cache provider (I'm storing actual objects in memory rather than
> the byte array, which I considered doing at first).

I don't see why Java shouldn't be fast enough, but I don't know how 
optimised serialisation is.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Jul 12 12:01:17 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 12 Jul 2010 12:01:17 +0100
Subject: [rabbitmq-discuss] Message Priority support and HA Failover
In-Reply-To: <1278697907.2517.1005.camel@tchen-lenovo.evri.corp>
References: <1278697907.2517.1005.camel@tchen-lenovo.evri.corp>
Message-ID: <4C3AF5FD.7020001@rabbitmq.com>

On 09/07/10 18:51, Timothy Chen wrote:
> I've been reading more about the clustering and ha failover of rabbit
> mq, and sounds like there is no out of the box solution for live
> failover when a node fails? I see that the routing information will be
> persisted and can be transferred over to another node, but messages will
> not?

Unfortunately that is the case. We're aware that clustering / HA is a 
weak area at the moment.

> Also, are there messages priority support in RabbitMQ currently?

Also no. Sorry to reply so negatively...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tony at rightscale.com  Mon Jul 12 20:01:28 2010
From: tony at rightscale.com (Tony Spataro)
Date: Mon, 12 Jul 2010 12:01:28 -0700
Subject: [rabbitmq-discuss] Preventing uncontrolled crashes due to file
	descriptor exhaustion
Message-ID: <AANLkTimYhYt0N4HZM6iU1nrrRkHnau6lJJt-hLsMRRP2@mail.gmail.com>

Hello RabbitMQ users,

While load testing my RabbitMQ-based RPC mechanism, I managed to get my
RabbitMQ server into some very interesting states when it had a large number
of connections. When the AMQP server exceeded ~1020 active connections, it
would become unstable and eventually crash in a way that lost some data
(including a few persistent messages that had been posted to durable
queues).

The cause for the crash wasn't hard to discover: the parent process of
RabbitMQ was restricted to 1,024 open file handles (this is apparently the
default for the Linux distro I was running), and the resource limit is
inherited by child processes. Simply adding a "ulimit -n 65535" to the
RabbitMQ init script and a "+P 131072" to the Erlang VM command-line gave
the server enough file handles and Erlang processes to handle the load.

What piqued my interest, however, was the catastrophic and data-lossy way in
which the server crashed when it reached its limit. Normally, RabbitMQ is
very good about avoiding data loss even when it crashes!

Some scrutiny of the logs yielded the following explanation: exhausting the
file handles available to the process prevents various fault-tolerance and
process control mechanisms from working, including:
-- a "cpu-sup" process that the VM is trying to communicate with via a port
-- writing the Mnesia tables that hold persisted queue contents
-- the "rabbitmqctl" process

The result of all these failures taken together is that the server decides
to shutdown but can't shutdown cleanly, leading to data loss.

My ultimate solution is rather crude, but workable: using the iptables
conntrack module, I will limit the number of inbound TCP connections to the
server and ensure that the server has enough free file handles to take care
of "housekeeping" operations.

I thought I'd share my results with the group in case anyone else has
encountered this problem, and also query whether anyone else has come up
with a different/better solution. Has anyone run into this yet?

Cheers,
    Tony

P.S. Here are some log excerpts from a RabbitMQ server under heavy load that
exemplify the problem:

=ERROR REPORT==== 8-Jul-2010::19:23:13 ===
Error in process <0.121.0> on node 'rabbit at TonyS' with exit value:
{{badmatch,{error,emfile}},[{cpu_sup,get_uint32_measurement,2},{cpu_sup,measurement_server_loop,1}]}

=ERROR REPORT==== 8-Jul-2010::19:23:18 ===
Error in process <0.5307.0> on node 'rabbit at TonyS' with exit value:
{emfile,[{erlang,open_port,[{spawn,"/usr/lib/erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup"},[stream]]},{cpu_sup,start_portprogram,0},{cpu_sup,port_server_init,1}]}

=ERROR REPORT==== 8-Jul-2010::19:24:14 ===
Mnesia(rabbit at TonyS): ** ERROR ** (could not write core file: emfile)
 ** FATAL ** Cannot open log file
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_queue.DCL": {file_error,


"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_queue.DCL",

                  emfile}

=INFO REPORT==== 8-Jul-2010::19:24:14 ===
    application: mnesia
    exited: shutdown
    type: permanent

*-------^ someone decides to shutdown everything; tries to do a clean
shutdown but can't persist state  ^-------*

=ERROR REPORT==== 8-Jul-2010::19:24:14 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.39.0>,
                       {<0.42.0>,
                        "Mnesia(~p): ** ERROR ** (could not write core file:
~p)~n ** FATAL ** Cannot open log file ~p: ~p~n",
                        [rabbit at TonyS,emfile,

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_queue.DCL",
                         {file_error,

"/var/lib/rabbitmq/mnesia/rabbit/rabbit_durable_queue.DCL",
                             emfile}]}}

*-------^ can't even write a crash dump ^-------*
*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100712/35f49704/attachment.htm>

From aaron at agoragames.com  Mon Jul 12 21:32:03 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 12 Jul 2010 16:32:03 -0400
Subject: [rabbitmq-discuss] Queue delete causes transaction errors
Message-ID: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>

I've confirmed that transactions are being aborted due to a queue
being deleted using an easily-reproducible test case.

The base-case is an exchange and a 1-1 mapping of a routing key to a
destination queue.  The client is simply consuming a published message
and then publishing the next one.  A single client as a consumer is
enough to repeat the bug.

We then have a test client which we can use to attach to an exchange
using a supplied routing key.  It will create its own queue and then
act as a passive listener, for easy monitoring of traffic.  The queue
it uses is set to auto-delete. In high-traffic situations, I would
occasionally see a transaction error in the client.

I setup a test case today where a listener would open a connection and
queue, listen for 2 seconds, then disconnect.  I tried combinations of
auto_delete enabled and disabled, both with and without an explicit
queue delete call, as well as using transactions and re-using a
connection versus closing and reconnecting.  I would run this test
listener while a test client simply published a message to itself
every time it received one.  The client is using transactions,
committing after each publish call.  Within a few minutes, no matter
how my listener was configured, the client would receive a transaction
error.  I repeated this with the 1.8.0 release.

I see that 0.9.1 of the spec adds queue.unbind().  Is that the only
way to avoid this problem, or is there another approach that we can
take?

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From lfwfox at gmail.com  Mon Jul 12 21:40:49 2010
From: lfwfox at gmail.com (John Goodson)
Date: Mon, 12 Jul 2010 16:40:49 -0400
Subject: [rabbitmq-discuss] Design question: the ratio of queues to channels
Message-ID: <AANLkTilxoe0uD9QTt78gwD5DEVyypFrz4Ry7fXA-mjW1@mail.gmail.com>

Hi,

I noticed in the looking over the examples that the ratio of channels to
queue is almost one-to-one. In my applications I just open one channel and
then create the queues I need using it.

Examples based code:

    MQ.new.queue('1').subscribe ...
    MQ.new.queue('2').subscribe ..
    MQ.new.queue('2').publish ...


My usage style:

   amq = MQ.new
   q1 = amq.queue('1')
   q2 = amq.queue('2')

   q1.subscribe ..
   q2.subscribe ..
   q2.publish ...

Which approach is better and why?  Are there any documents that I can
reference that give guidelines on this?

Thanks
John
-----
John Goodson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100712/48cb07cd/attachment.htm>

From david at rabbitmq.com  Tue Jul 13 01:07:11 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 13 Jul 2010 01:07:11 +0100
Subject: [rabbitmq-discuss] Get messages detail from queue
In-Reply-To: <476162.94482.qm@web30704.mail.mud.yahoo.com> (angel menichelli's
	message of "Mon, 5 Jul 2010 09:48:02 -0700 (PDT)")
References: <476162.94482.qm@web30704.mail.mud.yahoo.com>
Message-ID: <yrv4ctyo46y8g.fsf@dwragg.eng.vmware.com>

Hi,

angel menichelli <angelcaido19 at yahoo.com.ar> writes:
> Is there any way to monitor the messages inside a queue??
> I can display the amount, etc but not the message itself!!
>
> I am using rabbit under ubuntu with python and currently using alice
> to monitor it.

RabbitMQ does not currently provide any means to browse the messages
within a queue.  The only way you can get at the messages is through the
normal AMQP methods that consume the messages (basic.consume and
basic.get).  But these are not simple read-only operations of the type
you might want for monitoring of the messages within a queue.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Tue Jul 13 10:12:36 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Jul 2010 10:12:36 +0100
Subject: [rabbitmq-discuss] Design question: the ratio of queues to
	channels
In-Reply-To: <AANLkTilxoe0uD9QTt78gwD5DEVyypFrz4Ry7fXA-mjW1@mail.gmail.com>
References: <AANLkTilxoe0uD9QTt78gwD5DEVyypFrz4Ry7fXA-mjW1@mail.gmail.com>
Message-ID: <4C3C2E04.3020607@rabbitmq.com>

On 12/07/10 21:40, John Goodson wrote:
> I noticed in the looking over the examples that the ratio of channels to
> queue is almost one-to-one. In my applications I just open one channel
> and then create the queues I need using it.

Hi John. I'm not sure which examples you're talking about - your example 
code looks like Ruby though.

> Examples based code:
>
>      MQ.new.queue('1').subscribe ...
>      MQ.new.queue('2').subscribe ..
>      MQ.new.queue('2').publish ...
>
>
> My usage style:
>
>     amq = MQ.new
>     q1 = amq.queue('1')
>     q2 = amq.queue('2')
>
>     q1.subscribe ..
>     q2.subscribe ..
>     q2.publish ...
>
> Which approach is better and why?

The primary things that channels do are:

* Give scope to some errors
* Give scope to consumers
* Allow at most one operation at once

So with your approach you run the risk that a soft error (e.g. 
not-found) will close the single channel and take down everything. This 
may or may not be a concern.

Also, if your app is multithreaded it can still only perform one 
operation at once (although channels are not threadsafe in most clients 
anyway).

Of course, neither of these may be a concern to you.

Is that any clearer?

 > Are there any documents that I can
 > reference that give guidelines on this?

The best thing is the spec. Yeah, I know. One of the items on our very 
long todo list is a comprehensive overview of AMQP...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Tue Jul 13 11:24:09 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 13 Jul 2010 11:24:09 +0100
Subject: [rabbitmq-discuss] Preventing uncontrolled crashes due to file
	descriptor exhaustion
In-Reply-To: <AANLkTimYhYt0N4HZM6iU1nrrRkHnau6lJJt-hLsMRRP2@mail.gmail.com>
References: <AANLkTimYhYt0N4HZM6iU1nrrRkHnau6lJJt-hLsMRRP2@mail.gmail.com>
Message-ID: <AANLkTiltJvVdV1adQbU6MsuO904nOuwybs_oCWZAU6YX@mail.gmail.com>

On Mon, Jul 12, 2010 at 20:01, Tony Spataro <tony at rightscale.com> wrote:
> While load testing my RabbitMQ-based RPC mechanism, I managed to get my
> RabbitMQ server into some very interesting states when it had a large number
> of connections. When the AMQP server exceeded ~1020 active connections, it
> would become unstable and eventually crash in a way that lost some data
> (including a few persistent messages that had been posted to durable
> queues).

Well, don't do it. File descriptors are a finite resource and bad things
can happen when you're getting close to the limit. The same applies
to memory and disk.

But I agree, rabbit shouldn't loose the data.

In the new persister branch "bug21673" we've made some magical tweaks.
In this branch we try to make sure that there are always enough file descriptors
for erlang.

Could you repeat your test on that branch, and tell us if it's any better?

Cheers!
  Marek Majkowski

> The cause for the crash wasn't hard to discover: the parent process of
> RabbitMQ was restricted to 1,024 open file handles (this is apparently the
> default for the Linux distro I was running), and the resource limit is
> inherited by child processes. Simply adding a "ulimit -n 65535" to the
> RabbitMQ init script and a "+P?131072" to the Erlang VM command-line gave
> the server enough file handles and Erlang processes to handle the load.
> What piqued my interest, however, was the catastrophic and data-lossy way in
> which the server crashed when it reached its limit. Normally, RabbitMQ is
> very good about avoiding data loss even when it crashes!
> Some scrutiny of the logs yielded the following explanation: exhausting the
> file handles available to the process prevents various fault-tolerance and
> process control mechanisms from working, including:
> -- a "cpu-sup" process that the VM is trying to communicate with via a port
> -- writing the Mnesia tables that hold persisted queue contents
> -- the "rabbitmqctl" process
> The result of all these failures taken together is that the server decides
> to shutdown but can't shutdown cleanly, leading to data loss.
> My ultimate solution is rather crude, but workable: using the iptables
> conntrack module, I will limit the number of inbound TCP connections to the
> server and ensure that the server has enough free file handles to take care
> of "housekeeping" operations.
> I thought I'd share my results with the group in case anyone else has
> encountered this problem, and also query whether anyone else has come up
> with a different/better solution. Has anyone run into this yet?
> Cheers,
> ?? ?Tony

From majek04 at gmail.com  Tue Jul 13 11:30:45 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 13 Jul 2010 11:30:45 +0100
Subject: [rabbitmq-discuss] timed / delayed messages
In-Reply-To: <AANLkTikmTUpjRdcQRoazhD8JjAi1gEUJ5nm_QRGkMRin@mail.gmail.com>
References: <AANLkTikmTUpjRdcQRoazhD8JjAi1gEUJ5nm_QRGkMRin@mail.gmail.com>
Message-ID: <AANLkTimro1bfQeeO7gj9YM05xQlQiEe1QtEnj-KSndiZ@mail.gmail.com>

On Fri, Jul 9, 2010 at 21:46, Akhil Kodali <akhil.kodali at gmail.com> wrote:
> [...]
> If I use this approach I'd end up having 2 hrs worth of messages in the
> queue.
> It aint much now but I see it going upto 20,000 in 2 hrs quickly.
> Or would it be better making a DB query to do the same. Going through all
> the rows doesnt seem right.
> What I wanted to check was, are queues build for such a use case or is there
> a better way of doing it?

RabbitMQ should be able to handle 20k messages without any troubles.
But as all the messages are stored in memroy, please make sure that
you have enough RAM+swap available.

You also should make sure that the messages are relatively small.

If you want to handle even more data in queues, you could use our experimental
code. In one of our development code branches we try to make rabbit dump queues
to the disk, when it's running short of memory.

Hope that helps.

Cheers,
  Marek Majkowski

From shane at digitalsanctum.com  Tue Jul 13 13:44:20 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 13 Jul 2010 05:44:20 -0700 (PDT)
Subject: [rabbitmq-discuss] status of available message buses compatible
	with Java client
In-Reply-To: <806F700D7E08E9408413160B05EB66672A47662910@EXCH-MBX-1.vmware.com>
References: <0f3476d2-74a8-4b6e-82d2-81e4c71d2d73@j8g2000yqd.googlegroups.com>
	<990C545C-A35B-458E-931F-1589B071B91A@vmware.com>,
	<35f922e0-5aea-4ff0-a07a-64306e7a15bd@u26g2000yqu.googlegroups.com> 
	<392922E81643B245A905B42E3E34C24014D35168F2@EXCH-MBX-1.vmware.com> 
	<d4f75ded-77c4-40d1-ab9d-993f06dcf723@u26g2000yqu.googlegroups.com> 
	<806F700D7E08E9408413160B05EB66672A47466558@EXCH-MBX-1.vmware.com> 
	<be6f22d8-bc78-4065-b797-3497781d24d8@y4g2000yqy.googlegroups.com> 
	<806F700D7E08E9408413160B05EB66672A47662910@EXCH-MBX-1.vmware.com>
Message-ID: <143c22d5-4667-44b9-b2ee-2535f89ee25c@j8g2000yqd.googlegroups.com>

What's the status of the new Spring AMQP project? I'm eagerly
anticipating it. Is the new git repo available yet?

On Jun 29, 1:07?pm, Mark Pollack <mpoll... at vmware.com> wrote:
> Hi,
>
> We are moving to git today/tomorrow. ?There will be some changes in terms of moving some admin functionality around the maven modules and internal structuring of the erlang mappings to rabbit function. ?
>
> We are also going to shift to a simplistic resource model for M1 instead of caching channels as we need more time to get the resource management correct. ?The issue is that we really need to cache connection/channels pairs since an error on a single channel ends up effecting the whole connection - this means all async consumers are effected and stop processing based on the behavior of one consumer. ?
>
> Yea, July 9th is still our target date, no docs yet and we need more integration testing as well :)
>
> Mark
>
>
>
>
>
> > -----Original Message-----
> > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [mailto:rabbitmq-
> > discuss-boun... at lists.rabbitmq.com] On Behalf Of Shane
> > Sent: Tuesday, June 29, 2010 12:24 PM
> > To: rabbitmq-disc... at lists.rabbitmq.com
> > Subject: Re: [rabbitmq-discuss] status of available message buses
> > compatible with Java client
>
> > Hi Mark,
>
> > I appreciate your replies. You've helped to solidify some of my design
> > decisions including using your unreleasedspring-amqp project. I've
> > noticed that there hasn't been any commits to the subversion repo you
> > pointed me to. Have you already moved to git? I also noticed the
> > documentation is not there yet and I assume you are working on that
> > now. I know you mentioned a July 9th date for an initial release but
> > I'd be interested in any other changes before then if that's cool?
>
> > Thanks again
>
> > On Jun 24, 4:44?pm, Mark Pollack <mpoll... at vmware.com> wrote:
> > > Hi,
>
> > > Was not planning on it for M1. ?We need to see what the impact is on
> > the underlying APIs, but it will certainly be a roadmap item if not
> > addressed in M1.
>
> > > Mark
>
> > > (yes - another Mark working on the same thing at SpringSource :)
>
> > > > -----Original Message-----
> > > > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [mailto:rabbitmq-
> > > > discuss-boun... at lists.rabbitmq.com] On Behalf Of Shane
> > > > Sent: Thursday, June 24, 2010 4:33 PM
> > > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > > Subject: Re: [rabbitmq-discuss] status of available message buses
> > > > compatible with Java client
>
> > > > Awesome. I noticed that the code isn't currently compatible with
> > > > version 1.8 of the java client. Are you planning on supporting 1.8
> > in
> > > > the short term?
>
> > > > On Jun 24, 11:30?am, Mark Fisher <markfis... at vmware.com> wrote:
> > > > > Shane,
>
> > > > > We are planning to release the first milestone (1.0.0.M1) on
> > Friday
> > > > July 9th.
>
> > > > > -Mark
> > > > > ________________________________________
> > > > > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [rabbitmq-
> > discuss-
> > > > boun... at lists.rabbitmq.com] On Behalf Of Shane
> > > > [sh... at digitalsanctum.com]
> > > > > Sent: Thursday, June 24, 2010 10:40 AM
> > > > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > > > Subject: Re: [rabbitmq-discuss] status of available message buses
> > > > compatible ? ?with Java client
>
> > > > > Mark,
>
> > > > > I've started looking at the code it's looking good. Any estimate
> > on
> > > > > when an initial public version will be available?
>
> > > > > Shane
>
> > > > > On Jun 23, 8:09 pm, Mark Fisher <markfis... at vmware.com> wrote:
>
> > > > > > Shane, see my replies inline...
>
> > > > > > On Jun 23, 2010, at 6:28 PM, Shane wrote:
>
> > > > > > > I'm still feeling my way around RabbitMQ (as you might have
> > > > noticed
> > > > > > > from the number of posts I've written lately). One decision
> > I'm
> > > > > > > wrestling with is what to use for message routing with the
> > Java
> > > > > > > client. I've started looking into the following:
>
> > > > > > > - Writing my own helper classes withSpring
> > > > > > > - Apache Camel
> > > > > > > -SpringIntegration with OpenCredo's contributions (amq
> > > > template, amq
> > > > > > >springintegration)
>
> > > > > > We will soon be releasing the first milestone of ourSpring
> > AMQP
> > > > project. That includes support at the same basic level asSpring's
> > JMS
> > > > support (AmqpTemplate, SimpleMessageListenerContainers for Message-
> > > > driven POJOs, MessageConverter strategies, and more). We will be
> > > > providingSpringIntegration Channel Adapters, Gateways, etc. that
> > will
> > > > build on top of that functionality.
>
> > > > > > > Since RabbitMQ was recently acquired by SpringSource, SI
> > > > w/OpenCredo
> > > > > > > seems like the natural choice but there hasn't been any
> > > > development on
> > > > > > > the OpenCredo stuff since March? (looking at github).
>
> > > > > > We're going to be collaborating with OpenCredo on the project I
> > > > mentioned above, and that project is actually quite active already.
> > > > However, as I mentioned, we're just now approaching the first
> > milestone
> > > > release. We'll be moving to Git any moment now, but until it's
> > moved,
> > > > you can browse the current codebase
> > > > here:https://src.springsource.org/svn/se-amqp/trunk/(afterthemove
> > it
> > > > will be at git.springsource.org/spring-amqp)
>
> > > > > > > Although Apache Camel seems to be more mature, I'd rather go
> > the
> > > > > > >SpringIntegration route since all of our apps already use
> >Spring
> > > > for
> > > > > > > dependency injection, etc.
>
> > > > > > As the lead ofSpringIntegration, I'm a bit biased. That said,
> > if
> > > > your main concern is having a solid (and "mature" I might add)
> >Spring
> > > > foundation with implementations that are absolutely consistent with
> > > >Spring, thenSpringIntegration is probably the best choice (and
> > 2.0 GA
> > > > is only a couple months away).
>
> > > > > > > Can someone from Rabbit comment on the state of development
> > with
> > > > > > > respect to integration withSpring? Is the contributions from
> > > > > > > OpenCredo going to be used?
>
> > > > > > Hopefully this question has been answered above. Let me know if
> > > > there is anything that I missed.
>
> > > > > > Regards,
> > > > > > Mark
>
> > > > > > > I'm also interested in other message bus solutions people are
> > > > using
> > > > > > > with the Java client.
>
> > > > > > > Thanks again,
> > > > > > > Shane
> > > > > > > _______________________________________________
> > > > > > > rabbitmq-discuss mailing list
> > > > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > > > >http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> > > > discuss
>
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-
> > disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-
> > disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
> > bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From markfisher at vmware.com  Tue Jul 13 13:46:43 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Tue, 13 Jul 2010 05:46:43 -0700
Subject: [rabbitmq-discuss] status of available message buses
	compatible	with Java client
In-Reply-To: <143c22d5-4667-44b9-b2ee-2535f89ee25c@j8g2000yqd.googlegroups.com>
References: <0f3476d2-74a8-4b6e-82d2-81e4c71d2d73@j8g2000yqd.googlegroups.com>
	<990C545C-A35B-458E-931F-1589B071B91A@vmware.com>,
	<35f922e0-5aea-4ff0-a07a-64306e7a15bd@u26g2000yqu.googlegroups.com>
	<392922E81643B245A905B42E3E34C24014D35168F2@EXCH-MBX-1.vmware.com>
	<d4f75ded-77c4-40d1-ab9d-993f06dcf723@u26g2000yqu.googlegroups.com>
	<806F700D7E08E9408413160B05EB66672A47466558@EXCH-MBX-1.vmware.com>
	<be6f22d8-bc78-4065-b797-3497781d24d8@y4g2000yqy.googlegroups.com>
	<806F700D7E08E9408413160B05EB66672A47662910@EXCH-MBX-1.vmware.com>,
	<143c22d5-4667-44b9-b2ee-2535f89ee25c@j8g2000yqd.googlegroups.com>
Message-ID: <392922E81643B245A905B42E3E34C24014D35169D9@EXCH-MBX-1.vmware.com>

Shane, The Git repository is available. You can clone from this URL:
git clone git://git.springsource.org/spring-amqp/spring-amqp.git

Then you should be able to cd into 'spring-amqp' and run: mvn clean install

We are wrapping up documentation and a few loose ends, but we do plan to release the first milestone this week.

Looking forward to your feedback.
Regards,
Mark
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Shane [shane at digitalsanctum.com]
Sent: Tuesday, July 13, 2010 8:44 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] status of available message buses compatible    with Java client

What's the status of the new Spring AMQP project? I'm eagerly
anticipating it. Is the new git repo available yet?

On Jun 29, 1:07 pm, Mark Pollack <mpoll... at vmware.com> wrote:
> Hi,
>
> We are moving to git today/tomorrow.  There will be some changes in terms of moving some admin functionality around the maven modules and internal structuring of the erlang mappings to rabbit function.
>
> We are also going to shift to a simplistic resource model for M1 instead of caching channels as we need more time to get the resource management correct.  The issue is that we really need to cache connection/channels pairs since an error on a single channel ends up effecting the whole connection - this means all async consumers are effected and stop processing based on the behavior of one consumer.
>
> Yea, July 9th is still our target date, no docs yet and we need more integration testing as well :)
>
> Mark
>
>
>
>
>
> > -----Original Message-----
> > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [mailto:rabbitmq-
> > discuss-boun... at lists.rabbitmq.com] On Behalf Of Shane
> > Sent: Tuesday, June 29, 2010 12:24 PM
> > To: rabbitmq-disc... at lists.rabbitmq.com
> > Subject: Re: [rabbitmq-discuss] status of available message buses
> > compatible with Java client
>
> > Hi Mark,
>
> > I appreciate your replies. You've helped to solidify some of my design
> > decisions including using your unreleasedspring-amqp project. I've
> > noticed that there hasn't been any commits to the subversion repo you
> > pointed me to. Have you already moved to git? I also noticed the
> > documentation is not there yet and I assume you are working on that
> > now. I know you mentioned a July 9th date for an initial release but
> > I'd be interested in any other changes before then if that's cool?
>
> > Thanks again
>
> > On Jun 24, 4:44 pm, Mark Pollack <mpoll... at vmware.com> wrote:
> > > Hi,
>
> > > Was not planning on it for M1.  We need to see what the impact is on
> > the underlying APIs, but it will certainly be a roadmap item if not
> > addressed in M1.
>
> > > Mark
>
> > > (yes - another Mark working on the same thing at SpringSource :)
>
> > > > -----Original Message-----
> > > > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [mailto:rabbitmq-
> > > > discuss-boun... at lists.rabbitmq.com] On Behalf Of Shane
> > > > Sent: Thursday, June 24, 2010 4:33 PM
> > > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > > Subject: Re: [rabbitmq-discuss] status of available message buses
> > > > compatible with Java client
>
> > > > Awesome. I noticed that the code isn't currently compatible with
> > > > version 1.8 of the java client. Are you planning on supporting 1.8
> > in
> > > > the short term?
>
> > > > On Jun 24, 11:30 am, Mark Fisher <markfis... at vmware.com> wrote:
> > > > > Shane,
>
> > > > > We are planning to release the first milestone (1.0.0.M1) on
> > Friday
> > > > July 9th.
>
> > > > > -Mark
> > > > > ________________________________________
> > > > > From: rabbitmq-discuss-boun... at lists.rabbitmq.com [rabbitmq-
> > discuss-
> > > > boun... at lists.rabbitmq.com] On Behalf Of Shane
> > > > [sh... at digitalsanctum.com]
> > > > > Sent: Thursday, June 24, 2010 10:40 AM
> > > > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > > > Subject: Re: [rabbitmq-discuss] status of available message buses
> > > > compatible    with Java client
>
> > > > > Mark,
>
> > > > > I've started looking at the code it's looking good. Any estimate
> > on
> > > > > when an initial public version will be available?
>
> > > > > Shane
>
> > > > > On Jun 23, 8:09 pm, Mark Fisher <markfis... at vmware.com> wrote:
>
> > > > > > Shane, see my replies inline...
>
> > > > > > On Jun 23, 2010, at 6:28 PM, Shane wrote:
>
> > > > > > > I'm still feeling my way around RabbitMQ (as you might have
> > > > noticed
> > > > > > > from the number of posts I've written lately). One decision
> > I'm
> > > > > > > wrestling with is what to use for message routing with the
> > Java
> > > > > > > client. I've started looking into the following:
>
> > > > > > > - Writing my own helper classes withSpring
> > > > > > > - Apache Camel
> > > > > > > -SpringIntegration with OpenCredo's contributions (amq
> > > > template, amq
> > > > > > >springintegration)
>
> > > > > > We will soon be releasing the first milestone of ourSpring
> > AMQP
> > > > project. That includes support at the same basic level asSpring's
> > JMS
> > > > support (AmqpTemplate, SimpleMessageListenerContainers for Message-
> > > > driven POJOs, MessageConverter strategies, and more). We will be
> > > > providingSpringIntegration Channel Adapters, Gateways, etc. that
> > will
> > > > build on top of that functionality.
>
> > > > > > > Since RabbitMQ was recently acquired by SpringSource, SI
> > > > w/OpenCredo
> > > > > > > seems like the natural choice but there hasn't been any
> > > > development on
> > > > > > > the OpenCredo stuff since March? (looking at github).
>
> > > > > > We're going to be collaborating with OpenCredo on the project I
> > > > mentioned above, and that project is actually quite active already.
> > > > However, as I mentioned, we're just now approaching the first
> > milestone
> > > > release. We'll be moving to Git any moment now, but until it's
> > moved,
> > > > you can browse the current codebase
> > > > here:https://src.springsource.org/svn/se-amqp/trunk/(afterthemove
> > it
> > > > will be at git.springsource.org/spring-amqp)
>
> > > > > > > Although Apache Camel seems to be more mature, I'd rather go
> > the
> > > > > > >SpringIntegration route since all of our apps already use
> >Spring
> > > > for
> > > > > > > dependency injection, etc.
>
> > > > > > As the lead ofSpringIntegration, I'm a bit biased. That said,
> > if
> > > > your main concern is having a solid (and "mature" I might add)
> >Spring
> > > > foundation with implementations that are absolutely consistent with
> > > >Spring, thenSpringIntegration is probably the best choice (and
> > 2.0 GA
> > > > is only a couple months away).
>
> > > > > > > Can someone from Rabbit comment on the state of development
> > with
> > > > > > > respect to integration withSpring? Is the contributions from
> > > > > > > OpenCredo going to be used?
>
> > > > > > Hopefully this question has been answered above. Let me know if
> > > > there is anything that I missed.
>
> > > > > > Regards,
> > > > > > Mark
>
> > > > > > > I'm also interested in other message bus solutions people are
> > > > using
> > > > > > > with the Java client.
>
> > > > > > > Thanks again,
> > > > > > > Shane
> > > > > > > _______________________________________________
> > > > > > > rabbitmq-discuss mailing list
> > > > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > > > >http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> > > > discuss
>
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-
> > disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-
> > disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
> > > > bin/mailman/listinfo/rabbitmq-discuss
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-
> > bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Jul 13 15:09:45 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Jul 2010 15:09:45 +0100
Subject: [rabbitmq-discuss] Design question: the ratio of queues to
	channels
In-Reply-To: <AANLkTilbADPhV_9_Z43NesIP7rzvYl91CIWmFOhHaeT_@mail.gmail.com>
References: <AANLkTilxoe0uD9QTt78gwD5DEVyypFrz4Ry7fXA-mjW1@mail.gmail.com>	<4C3C2E04.3020607@rabbitmq.com>
	<AANLkTilbADPhV_9_Z43NesIP7rzvYl91CIWmFOhHaeT_@mail.gmail.com>
Message-ID: <4C3C73A9.7080506@rabbitmq.com>

On 13/07/10 15:01, John Goodson wrote:
> Hi Simon,

Hi John. Please keep the mailing list CCed, it helps other people learn.

> Yes I am using Ruby.
>
> Thanks for your response, it is clearer and you have been very helpful
> in that I can now see that my initial design choices are significantly
> less then optimal for the types of behavior I want.

Sure, no problem!

> Is my understanding correct take that a design constraint in creating
> channels is how many open sockets the Erlang server can support?

Well, channels are multiplexed onto TCP connections. A connection can 
support up to 65535 channels on a single socket, so you should be OK. If 
you need more channels, opening a second connection should be OK :)

Most client libraries make this fairly obvious, e.g. in Java:

Connection conn = new ConnectionFactory().newConnection();
Channel chan = conn.createChannel();

but the Ruby library doesn't make it immediately obvious what's going 
on. It might be creating one channel per connection. Unfortunately I 
don't know much about it.

> PS, ugh on having to figure out design/usage patterns based on reading
> the spec.

Indeed. You can always ask here though.

Cheers, Simon

>
> regards
> John
>
> On Tue, Jul 13, 2010 at 5:12 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     ...
>
>
>         Which approach is better and why?
>
>
>     The primary things that channels do are:
>
>     * Give scope to some errors
>     * Give scope to consumers
>     * Allow at most one operation at once
>
>     So with your approach you run the risk that a soft error (e.g.
>     not-found) will close the single channel and take down everything.
>     This may or may not be a concern.
>
>     Also, if your app is multithreaded it can still only perform one
>     operation at once (although channels are not threadsafe in most
>     clients anyway).
>
>     Of course, neither of these may be a concern to you.
>
>     Is that any clearer?
>
>
>      > Are there any documents that I can
>      > reference that give guidelines on this?
>
>     The best thing is the spec. Yeah, I know. One of the items on our
>     very long todo list is a comprehensive overview of AMQP...
>
>     Cheers, Simon
>
>
>
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthias at rabbitmq.com  Tue Jul 13 15:42:34 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 Jul 2010 15:42:34 +0100
Subject: [rabbitmq-discuss] mnesia is overloaded
In-Reply-To: <AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>
References: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>
	<AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>
Message-ID: <4C3C7B5A.40804@rabbitmq.com>

Jon,

On 10/07/10 16:11, Ovidiu Deac wrote:
> On Sat, Jul 10, 2010 at 5:47 PM, Jon Brisbin<jon at jbrisbin.com>  wrote:
>> I'm running some tests locally and I'm making a change and then just
>> re-running the unit test, which fires up a bunch of listeners and starts
>> dumping messages right away. Randomly, one part of my tests will hang. I
>> noticed the following in the log file. Do I need to change some settings or
>> something? I'm only sending several dozen messages at once...
>> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
>> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
>> {dump_log,
>>
>>   time_threshold}
>
> I remember seeing this thread on erlang-questions some time ago:
> http://www.erlang.org/pipermail/erlang-questions/2006-July/021484.html

RabbitMQ is already pre-configured with a larger IO thread pool, so I 
doubt the above will make a difference.

The warning message is indicative of a very high rate of AMQP resource 
configuration operations, e.g. creation/deletion of exchanges, queues 
and bindings. Is that what you'd expect to see from your tests?

The message doesn't actually indicate an error. If the high transaction 
rate is just a peak and subsequently subsides then everything ought to 
be fine. So if your tests hang that is likely for a different reason.


Regards,

Matthias.

From vbarat at ubikod.com  Tue Jul 13 16:00:13 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Tue, 13 Jul 2010 17:00:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer don't
 ack deliveries during 30s
Message-ID: <4C3C7F7D.4050106@ubikod.com>

  Hello all!

I'm writing a consumer that read logs from RabbitMQ and write them 
into a database.
To ensure that all my logs are correctly copied from RabbitMQ to the 
database, I acknowledge them only once they have been written (this 
way, if the consumer is killed, it will the logs once again on restart).

But from time to time, the database blocks during 30s to 1minute and 
thus I don't acknowledge during the same time.

It seems that the RabbitMQ server closes the connection. Is there a 
timeout (or a setting) I can use to fix this issue ?

My consumer is written in Java and is using the rabbitmq client library.

Thanks for your help.


From fblanch at gmail.com  Tue Jul 13 16:12:22 2010
From: fblanch at gmail.com (alcalino)
Date: Tue, 13 Jul 2010 08:12:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ persistence and multi producers-
 multi consumers
In-Reply-To: <4C370E82.8090208@rabbitmq.com>
References: <AANLkTikp3QMetseQDiDG1CHH05b8pG1dG7k30GKpcwhC@mail.gmail.com>
	<AANLkTikgIXz3zDsNCTMFqCFdDehvLxXMfUE3ImUPkbrl@mail.gmail.com>
	<AANLkTikP91qk3ShQoepdXtdB3SkC0Cy4kWKZuKkJZOdW@mail.gmail.com>
	<4C370E82.8090208@rabbitmq.com>
Message-ID: <29151695.post@talk.nabble.com>


Thanks Simon,

It is exactly what i was looking for.  Now i understand that i misunderstood
client with consumer. 

Of course the exchange/queue/binding it is necessary to be created  before
the messages to be sent. But it don't need to be created by the clients :).

As soon as i get it to work correctly i will publish the code as example.

Cheers,



Simon MacMullen-2 wrote:
> 
> On 09/07/10 12:49, Francisco Gonzalez-Blanch wrote:
>> Thanks for the answers!  But If the producer is launched first and then
>> the consumer, i'm losing all the initial messages until the consumer is
>> created. I attach you the code snippets with the test.
> 
> I think contrary to what Andreas said, in your case you should have the 
> producer create a queue with a well known name when it starts up, which 
> the consumer can connect to. ATM with your code no queue exists until a 
> consumer creates it, so all messages before that point are dropped.
> 
> <code snipped>
> 
>> In addition i have another question , is it possible to make that not
>> all the consumers get all the messages  with a fanout exchange, i mean
>> is it possible to balance the messages in between the consumers. Thanks
>> a lot. regards!
> 
> If each consumer creates its own queue, each consumer will get all the 
> messages.
> 
> If each consumer connects to the same queue, the messages will be 
> balanced among the consumers.
> 
> NB this balancing will not be very fair if the consumers connect to a 
> preexisting queue with a bunch of messages, unless you set the prefetch 
> count using basic.qos. Once the existing messages are drained and the 
> queue is empty it will round-robin subsequent messages.
> 
> Cheers, Simon
>>
>> Francisco Gonz?lez-Blanch Rodr?guez
>>
>>
>> On Fri, Jul 9, 2010 at 1:39 PM, Ovidiu Deac <ovidiudeac at gmail.com
>> <mailto:ovidiudeac at gmail.com>> wrote:
>>
>>     If nobody extracts the message from the queue the message won't be
>> lost.
>>
>>     On Fri, Jul 9, 2010 at 1:09 PM, Francisco Gonzalez-Blanch
>>     <fblanch at gmail.com <mailto:fblanch at gmail.com>> wrote:
>>      > Hi all,
>>      > I'm a newbie in rabbitmq and i'm working on a distributed data
>>     processing
>>      > application using rabbitmq as distributed task queue. I want to
>>     ask you
>>      > about where can i find information about how to make persistent
>>     queues, and
>>      > how to make that, if a producer sends messages to queue and no
>>     one is listen
>>      > to it and then a consumer is attached , the consumer gets all the
>>     messages,
>>      > even the ones that were produced before the consumer was
>>     attached. Thank you
>>      > very much.
>>      >
>>      >
>>      >
>>      > _______________________________________________
>>      > rabbitmq-discuss mailing list
>>      > rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>      >
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>      >
>>      >
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-persistence-and-multi-producers--multi-consumers-tp29116161p29151695.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mikeb at rabbitmq.com  Tue Jul 13 16:29:11 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 13 Jul 2010 16:29:11 +0100
Subject: [rabbitmq-discuss] Queue delete causes transaction errors
In-Reply-To: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>
References: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>
Message-ID: <4C3C8647.1020705@rabbitmq.com>

Hi Aaron,

> I've confirmed that transactions are being aborted due to a queue
> being deleted using an easily-reproducible test case.
> 
> The base-case is an exchange and a 1-1 mapping of a routing key to a
> destination queue.  The client is simply consuming a published message
> and then publishing the next one.  A single client as a consumer is
> enough to repeat the bug.
> 
> We then have a test client which we can use to attach to an exchange
> using a supplied routing key.  It will create its own queue and then
> act as a passive listener, for easy monitoring of traffic.  The queue
> it uses is set to auto-delete. In high-traffic situations, I would
> occasionally see a transaction error in the client.
> 
> I setup a test case today where a listener would open a connection and
> queue, listen for 2 seconds, then disconnect.  I tried combinations of
> auto_delete enabled and disabled, both with and without an explicit
> queue delete call, as well as using transactions and re-using a
> connection versus closing and reconnecting.  I would run this test
> listener while a test client simply published a message to itself
> every time it received one.  The client is using transactions,
> committing after each publish call.  Within a few minutes, no matter
> how my listener was configured, the client would receive a transaction
> error.  I repeated this with the 1.8.0 release.

It looks like there's two races going on here:
  - the queue being autodeleted, and the transaction committing; and
  - the connection dropping, and the transaction committing.

In the first case, the transaction commit fails because the queue has 
gone away and it can no longer route the message to it.  I'm less 
certain about the second; I think it may be because the queue tries to 
deliver the message on tx.commit, and the connection drops while that's 
happening.

The AMQP spec doesn't say a lot about the properties of transactions, 
and in particular, whether routing "happens" before or after tx.commit. 
  RabbitMQ routes before the tx.commit, mainly so that persistent 
messages will land on disk.

It would be well within the spec to *act* as though routing happened 
after tx.commit; e.g., the transaction wouldn't fail because your 
autodelete queue has gone away.  We'd also have to be careful of the 
second case, that failing to deliver the message didn't cause the 
tx.commit to fail.  That's probably a more useful semantics overall, anyway.

(We actually already have a bug for looking into this -- thanks for 
bringing back to our attention!)

> I see that 0.9.1 of the spec adds queue.unbind().  Is that the only
> way to avoid this problem, or is there another approach that we can
> take?

I don't see how queue.unbind would help -- would you explain?


Cheers,
Michael

From lfwfox at gmail.com  Tue Jul 13 16:38:28 2010
From: lfwfox at gmail.com (John Goodson)
Date: Tue, 13 Jul 2010 11:38:28 -0400
Subject: [rabbitmq-discuss] Design question: the ratio of queues to
	channels
In-Reply-To: <4C3C73A9.7080506@rabbitmq.com>
References: <AANLkTilxoe0uD9QTt78gwD5DEVyypFrz4Ry7fXA-mjW1@mail.gmail.com>
	<4C3C2E04.3020607@rabbitmq.com>
	<AANLkTilbADPhV_9_Z43NesIP7rzvYl91CIWmFOhHaeT_@mail.gmail.com>
	<4C3C73A9.7080506@rabbitmq.com>
Message-ID: <AANLkTimGhyIjPDfKpDRvyy5wkbSSV0fTVqGU9J_Ay6aS@mail.gmail.com>

HI Simon,

Thanks, again very helpful, sorry about not cc'd the list.  I will ask on
the ruby-amqp list about the relationship between channel and TCP
connection.

John


On Tue, Jul 13, 2010 at 10:09 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 13/07/10 15:01, John Goodson wrote:
>
>> Hi Simon,
>>
>
> Hi John. Please keep the mailing list CCed, it helps other people learn.
>
>
>  Yes I am using Ruby.
>>
>> Thanks for your response, it is clearer and you have been very helpful
>> in that I can now see that my initial design choices are significantly
>> less then optimal for the types of behavior I want.
>>
>
> Sure, no problem!
>
>
>  Is my understanding correct take that a design constraint in creating
>> channels is how many open sockets the Erlang server can support?
>>
>
> Well, channels are multiplexed onto TCP connections. A connection can
> support up to 65535 channels on a single socket, so you should be OK. If you
> need more channels, opening a second connection should be OK :)
>
> Most client libraries make this fairly obvious, e.g. in Java:
>
> Connection conn = new ConnectionFactory().newConnection();
> Channel chan = conn.createChannel();
>
> but the Ruby library doesn't make it immediately obvious what's going on.
> It might be creating one channel per connection. Unfortunately I don't know
> much about it.
>
>
>  PS, ugh on having to figure out design/usage patterns based on reading
>> the spec.
>>
>
> Indeed. You can always ask here though.
>
> Cheers, Simon
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100713/3815719d/attachment.htm>

From fblanch at gmail.com  Tue Jul 13 16:40:36 2010
From: fblanch at gmail.com (alcalino)
Date: Tue, 13 Jul 2010 08:40:36 -0700 (PDT)
Subject: [rabbitmq-discuss]  How to check if an exchange exists
Message-ID: <29152140.post@talk.nabble.com>


Hi,

I would want to ask you how can you check if an exchange exists using the
java client api. I know ho to check if a queue exists before trying to
declare it (using queueDeclarePasive) but i don't know / understand how to
do it with the exchanges (using exchangeDeclarePasive). Thanks,

-- 
View this message in context: http://old.nabble.com/How-to-check-if-an-exchange-exists-tp29152140p29152140.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From aaron at agoragames.com  Tue Jul 13 17:08:27 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 13 Jul 2010 12:08:27 -0400
Subject: [rabbitmq-discuss] configuring beam and rabbit
Message-ID: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>

I missed some changes to the rabbitmq-server script that occurred
sometime between 1.5.0 and 1.7.0.

In older versions, the script included the following line at the top:

  [ -f /etc/rabbitmq/rabbitmq.conf ] && . /etc/rabbitmq/rabbitmq.conf

The file could be used to define any of the bash options, but
documentation and/or posts had suggested that this was how one would
disable smp, for example:

  RABBITMQ_SERVER_ERL_ARGS="-smp disable"

One could also alter the rest of the standard kernel options and set
socket buffers through this mechanism.  It appears that this file now
is loaded from /<erlang_path>/lib/<rabbit>/scripts/rabbitmq-env which
is included in both rabbitmq-server and rabbitmq-multi, and that this
environment variable is still the correct way to affect kernel polling
and thread and process count.

This causes a lot of confusion with the new config file,
/etc/rabbitmq/rabbitmq.config, which seems to be the place where all
of the application configuration should go.  I feel like I've heard
that this includes socket buffers, but I don't recall.  The only
documentation I can find on the file relates to setting
"vm_memory_high_watermark", which seems to be specific to rabbit and
not the same as the old "-os_mon system_memory_high_watermark" setting
that was embedded in the rabbitmq-server script.  Is there a complete
reference on the format of this file and what options are available?
Can the cluster configuration be merged into this file?

I'm an erlang noob, but have worked with rabbit enough and read
through the scripts to guess that the following content for
rabbitmq.config would work as expected:

[
  {rabbit, [
    {vm_memory_high_watermark, 0},
    {cluster_config, [rabbit at host1, rabbit at host2]},
  ]},
  {kernel, [
    {inet_default_listen_options,
[{nodelay,true},{sndbuf,32768},{recbuf,32768}] },
    {inet_default_connect_options, [{nodelay,true}] }
  ]},
  {os_mon, [
    {start_cpu_sup, false},
  ]}
].


Please let me know if my understanding of the current configuration is
correct.  I need to fix some of our defaults, re-arrange some files
and I'll probably write up a blog post to summarize our setup.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From aaron at agoragames.com  Tue Jul 13 17:16:59 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 13 Jul 2010 12:16:59 -0400
Subject: [rabbitmq-discuss] Queue delete causes transaction errors
In-Reply-To: <4C3C8647.1020705@rabbitmq.com>
References: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>
	<4C3C8647.1020705@rabbitmq.com>
Message-ID: <AANLkTimKb6jADqEJIRYo3E2KF6JQoHT3kWfaoVkTpuMu@mail.gmail.com>

It didn't occur to me that the failure could have arisen after the
routing but during the consumption stage of my passive listener.  I
don't think that's the case, but here's what the broker reported which
I intended to include in my first email:

  class_id: 90
  method_id: 20
  reply_code: 541
  reply_text: "INTERNAL_ERROR - commit failed:
[{<0.25498.0>,{exit,{queue_disappeared,<0.25498.0>},[{rabbit_amqqueue,'-commit_all/3-fun-0-',1},{delegate,safe_invoke,2},{delegate,'-safe_invoke/2-lc$^0/1-0-',2},{delegate,'-safe_invoke/2-lc$^0/1-0-',2},{delegate,delegat..."

>> I see that 0.9.1 of the spec adds queue.unbind(). ?Is that the only
>> way to avoid this problem, or is there another approach that we can
>> take?
>
> I don't see how queue.unbind would help -- would you explain?

I imagine that I could unbind my listener's queue, wait for a bit,
then safely delete the queue and the broker would no longer be trying
to route to it.

cheers,
Aaron

On Tue, Jul 13, 2010 at 11:29 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> Hi Aaron,
>
>> I've confirmed that transactions are being aborted due to a queue
>> being deleted using an easily-reproducible test case.
>>
>> The base-case is an exchange and a 1-1 mapping of a routing key to a
>> destination queue. ?The client is simply consuming a published message
>> and then publishing the next one. ?A single client as a consumer is
>> enough to repeat the bug.
>>
>> We then have a test client which we can use to attach to an exchange
>> using a supplied routing key. ?It will create its own queue and then
>> act as a passive listener, for easy monitoring of traffic. ?The queue
>> it uses is set to auto-delete. In high-traffic situations, I would
>> occasionally see a transaction error in the client.
>>
>> I setup a test case today where a listener would open a connection and
>> queue, listen for 2 seconds, then disconnect. ?I tried combinations of
>> auto_delete enabled and disabled, both with and without an explicit
>> queue delete call, as well as using transactions and re-using a
>> connection versus closing and reconnecting. ?I would run this test
>> listener while a test client simply published a message to itself
>> every time it received one. ?The client is using transactions,
>> committing after each publish call. ?Within a few minutes, no matter
>> how my listener was configured, the client would receive a transaction
>> error. ?I repeated this with the 1.8.0 release.
>
> It looks like there's two races going on here:
> ?- the queue being autodeleted, and the transaction committing; and
> ?- the connection dropping, and the transaction committing.
>
> In the first case, the transaction commit fails because the queue has gone
> away and it can no longer route the message to it. ?I'm less certain about
> the second; I think it may be because the queue tries to deliver the message
> on tx.commit, and the connection drops while that's happening.
>
> The AMQP spec doesn't say a lot about the properties of transactions, and in
> particular, whether routing "happens" before or after tx.commit. ?RabbitMQ
> routes before the tx.commit, mainly so that persistent messages will land on
> disk.
>
> It would be well within the spec to *act* as though routing happened after
> tx.commit; e.g., the transaction wouldn't fail because your autodelete queue
> has gone away. ?We'd also have to be careful of the second case, that
> failing to deliver the message didn't cause the tx.commit to fail. ?That's
> probably a more useful semantics overall, anyway.
>
> (We actually already have a bug for looking into this -- thanks for bringing
> back to our attention!)
>
>> I see that 0.9.1 of the spec adds queue.unbind(). ?Is that the only
>> way to avoid this problem, or is there another approach that we can
>> take?
>
> I don't see how queue.unbind would help -- would you explain?
>
>
> Cheers,
> Michael
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From majek04 at gmail.com  Tue Jul 13 17:19:09 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 13 Jul 2010 17:19:09 +0100
Subject: [rabbitmq-discuss] Preventing uncontrolled crashes due to file
	descriptor exhaustion
In-Reply-To: <AANLkTiltJvVdV1adQbU6MsuO904nOuwybs_oCWZAU6YX@mail.gmail.com>
References: <AANLkTimYhYt0N4HZM6iU1nrrRkHnau6lJJt-hLsMRRP2@mail.gmail.com>
	<AANLkTiltJvVdV1adQbU6MsuO904nOuwybs_oCWZAU6YX@mail.gmail.com>
Message-ID: <AANLkTimuTjzOOA6ltm_AXO_beAIBZa_-9i2ydU5PLxGv@mail.gmail.com>

On Tue, Jul 13, 2010 at 11:24, Marek Majkowski <majek04 at gmail.com> wrote:
> In the new persister branch "bug21673" we've made some magical tweaks.
> In this branch we try to make sure that there are always enough file descriptors
> for erlang.

Good news, apparently the "magical tweaks" were merged to the main
branch some time ago. From what I see, they are included in 1.8.0.

Quick experiments show that rabbit always leaves about 80 file descriptors
for internal use.

Cheers,
   Marek

From dario.menichelli at gmail.com  Tue Jul 13 18:20:21 2010
From: dario.menichelli at gmail.com (dario_arg)
Date: Tue, 13 Jul 2010 10:20:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Get messages detail from queue
In-Reply-To: <yrv4ctyo46y8g.fsf@dwragg.eng.vmware.com>
References: <476162.94482.qm@web30704.mail.mud.yahoo.com>
	<yrv4ctyo46y8g.fsf@dwragg.eng.vmware.com>
Message-ID: <3a17a0c6-020c-4275-bd68-4f918e20925d@g19g2000yqc.googlegroups.com>

Thanks for you ansker david,

Are you planning to include something like that in rabbitmq??

Dario

On Jul 12, 9:07?pm, David Wragg <da... at rabbitmq.com> wrote:
> Hi,
>
> angel menichelli <angelcaid... at yahoo.com.ar> writes:
> > Is there any way to monitor the messages inside a queue??
> > I can display the amount, etc but not the message itself!!
>
> > I am using rabbit under ubuntu with python and currently using alice
> > to monitor it.
>
> RabbitMQ does not currently provide any means to browse the messages
> within a queue. ?The only way you can get at the messages is through the
> normal AMQP methods that consume the messages (basic.consume and
> basic.get). ?But these are not simple read-only operations of the type
> you might want for monitoring of the messages within a queue.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From winhamwr at gmail.com  Tue Jul 13 19:12:44 2010
From: winhamwr at gmail.com (winhamwr)
Date: Tue, 13 Jul 2010 11:12:44 -0700 (PDT)
Subject: [rabbitmq-discuss]  Crash debugging
Message-ID: <29151943.post@talk.nabble.com>


Hello,

We've been running rabbit in production for ~12 months in combination with
the wonderful  http://ask.github.com/celery/ Celery  project for use as a
delayed job tool. We've seen really good stability overall and we love the
project, but we did have one unexplained crash a few months ago and today we
had another. 

Poking around the forums, the two causes I see people pointing to for
crashes seem to be from running out of file descriptors and from running out
of memory, but I don't see how that could be the case in our situation. We
process a very low volume of messages and at the time of the crash, we had
processed 10 messages over the last 2 minutes. We use munin for monitoring,
and at the time of the crash, we had plenty of free memory. 

We're running version 1.7.2-1 installed from http://www.rabbitmq.com/debian/
testing on Ubuntu 8.04. 

The rabbit-sasl.log file didn't have any information about the initial crash
(just an error message from when I tried to start rabbitmq-server back up).
To get things back up, I had to delete the mnesia folder and reconfigure our
users, vhosts and permissions and then the server started back up just fine. 

Any help or insight would be greatly appreciated.

Thanks
-Wes

Attached is the relevant log from the initial crash from rabbit.log
http://old.nabble.com/file/p29151943/2010_07_13_crash_rabbit.log
2010_07_13_crash_rabbit.log 
-- 
View this message in context: http://old.nabble.com/Crash-debugging-tp29151943p29151943.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Jul 13 19:17:52 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 Jul 2010 19:17:52 +0100
Subject: [rabbitmq-discuss] Crash debugging
In-Reply-To: <29151943.post@talk.nabble.com>
References: <29151943.post@talk.nabble.com>
Message-ID: <4C3CADD0.8040700@rabbitmq.com>

Wes,

On 13/07/10 19:12, winhamwr wrote:
> Attached is the relevant log from the initial crash from rabbit.log
> http://old.nabble.com/file/p29151943/2010_07_13_crash_rabbit.log
> 2010_07_13_crash_rabbit.log

Looks like you ran out of disk space on the file system containing 
/var/lib/rabbitmq/mnesia.


Regards,

Matthias.

From winhamwr at gmail.com  Tue Jul 13 19:33:07 2010
From: winhamwr at gmail.com (winhamwr)
Date: Tue, 13 Jul 2010 11:33:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Crash debugging
In-Reply-To: <4C3CADD0.8040700@rabbitmq.com>
References: <29151943.post@talk.nabble.com> <4C3CADD0.8040700@rabbitmq.com>
Message-ID: <29154130.post@talk.nabble.com>




Matthias Radestock-3 wrote:
> 
> Looks like you ran out of disk space on the file system containing 
> /var/lib/rabbitmq/mnesia.
> 

Interesting. That was one of my first guess, but I checked the disk space
right after the crash and we still had 13% of the drive available (1.3GB of
space). Does rabbitmq require a certain amount of free space beyond that
perhaps?

http://old.nabble.com/file/p29154130/2010_07_13_crash_munin_graph.png 

Thanks
-Wes


-- 
View this message in context: http://old.nabble.com/Crash-debugging-tp29151943p29154130.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Jul 13 20:21:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 Jul 2010 20:21:22 +0100
Subject: [rabbitmq-discuss] Crash debugging
In-Reply-To: <29154130.post@talk.nabble.com>
References: <29151943.post@talk.nabble.com> <4C3CADD0.8040700@rabbitmq.com>
	<29154130.post@talk.nabble.com>
Message-ID: <4C3CBCB2.8040300@rabbitmq.com>

Wes,

winhamwr wrote:
> Matthias Radestock-3 wrote:
>> Looks like you ran out of disk space on the file system containing 
>> /var/lib/rabbitmq/mnesia.
>>
> 
> Interesting. That was one of my first guess, but I checked the disk space
> right after the crash and we still had 13% of the drive available (1.3GB of
> space). Does rabbitmq require a certain amount of free space beyond that
> perhaps?

1.3GB is really very little disk space. Keep an eye on the space used by 
/var/lib/rabbitmq/mnesia. You should budget for 3x that to account for 
various rabbit housekeeping operations that require temporary additional 
disk space.

Regards,

Matthias.

From tonyg at rabbitmq.com  Tue Jul 13 21:46:46 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Wed, 14 Jul 2010 08:46:46 +1200
Subject: [rabbitmq-discuss] mnesia is overloaded
In-Reply-To: <4C3C7B5A.40804@rabbitmq.com>
References: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>	<AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>
	<4C3C7B5A.40804@rabbitmq.com>
Message-ID: <4C3CD0B6.1060602@rabbitmq.com>

>>> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
>>> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
>>> {dump_log,
>>>   time_threshold}

> The warning message is indicative of a very high rate of AMQP resource
> configuration operations, e.g. creation/deletion of exchanges, queues
> and bindings. Is that what you'd expect to see from your tests?

Hm, oddly I've been seeing that with recent builds from tip-of-default a bit
too. I haven't figured out what could be causing it yet; load is generally low,
and I see it while rabbit is actually idle. This'd be on karmic in a virtual
machine on my OS X laptop.

Tony


From matthias at rabbitmq.com  Tue Jul 13 23:25:19 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 13 Jul 2010 23:25:19 +0100
Subject: [rabbitmq-discuss] mnesia is overloaded
In-Reply-To: <4C3CD0B6.1060602@rabbitmq.com>
References: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>	<AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>
	<4C3C7B5A.40804@rabbitmq.com> <4C3CD0B6.1060602@rabbitmq.com>
Message-ID: <4C3CE7CF.5020501@rabbitmq.com>

Tony,

Tony Garnock-Jones wrote:
>>>> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
>>>> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
>>>> {dump_log,
>>>>   time_threshold}
> 
>> The warning message is indicative of a very high rate of AMQP resource
>> configuration operations, e.g. creation/deletion of exchanges, queues
>> and bindings. Is that what you'd expect to see from your tests?
> 
> Hm, oddly I've been seeing that with recent builds from tip-of-default a bit
> too. I haven't figured out what could be causing it yet; load is generally low,
> and I see it while rabbit is actually idle. This'd be on karmic in a virtual
> machine on my OS X laptop.

I wonder whether VM-induced clock adjustments could trigger the warning. 
I vaguely recall some weirdness in that area being reported by people on 
erlang-questions, but that was quite a while ago.


Matthias.

From simon at rabbitmq.com  Wed Jul 14 10:30:35 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Jul 2010 10:30:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3C7F7D.4050106@ubikod.com>
References: <4C3C7F7D.4050106@ubikod.com>
Message-ID: <4C3D83BB.5070107@rabbitmq.com>

On 13/07/10 16:00, Vincent Barat wrote:
<snip>
> But from time to time, the database blocks during 30s to 1minute and
> thus I don't acknowledge during the same time.
>
> It seems that the RabbitMQ server closes the connection. Is there a
> timeout (or a setting) I can use to fix this issue ?

Hi Vincent. Not acking for 30s certainly should not close the 
connection. When the server closes a connection due to client error it 
sends an error message; you should see this as an IOException in the 
Java client. Check the ShutdownSignalException inside the IOException to 
get the error code / message. Alternatively you could look in the server 
logs, sometimes there's more detail there.

One way this could be happening is:

* You have heartbeating turned on (I think some of the client version 
have this turned on by default). Heartbeating makes the server 
periodically check the client is still alive and responding.

* You block the connection main loop, say by implementing your own 
Consumer rather than using QueueingConsumer, and doing something slow / 
expensive in Consumer.handleDelivery().

Does this sound plausible? If not I would look for error messages as above.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Jul 14 10:38:05 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Jul 2010 10:38:05 +0100
Subject: [rabbitmq-discuss] How to check if an exchange exists
In-Reply-To: <29152140.post@talk.nabble.com>
References: <29152140.post@talk.nabble.com>
Message-ID: <4C3D857D.7090105@rabbitmq.com>

On 13/07/10 16:40, alcalino wrote:
> I would want to ask you how can you check if an exchange exists using the
> java client api. I know ho to check if a queue exists before trying to
> declare it (using queueDeclarePasive) but i don't know / understand how to
> do it with the exchanges (using exchangeDeclarePasive). Thanks,

Hi Francisco. exchangeDeclarePassive should work exactly like 
queueDeclarePassive - i.e. either succeeds or closes the channel.

If you just want to ensure the exchange exists before publishing to it, 
you should actively declare it - that's idempotent so you don't need to 
worry about doing it more than once.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Wed Jul 14 14:02:58 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Jul 2010 14:02:58 +0100
Subject: [rabbitmq-discuss] Memory problems
In-Reply-To: <AANLkTikhdxoEat-tO6-MUqshMv8-Jx7kZ7jIbW2Dvi7S@mail.gmail.com>
References: <AANLkTikhdxoEat-tO6-MUqshMv8-Jx7kZ7jIbW2Dvi7S@mail.gmail.com>
Message-ID: <AANLkTimbhyAThRScRSiP1rp2repac4IYWNfCB7gqlafC@mail.gmail.com>

Nicol?s

First, sorry for timing, I must have missed your message somehow.

2010/6/3 Nicol?s C?sar <nico at nicocesar.com>:
> A process -> A_q queue -> B process -> fat_queue -> many C processes (even
> that I have many Cs,?? A is much faster)
>
> Here is the problem when everythig is almost empty:
>
> rabbitmqctl list_queues memory | awk '{T += $1;}END{print T;}'
> 5703040
>
> this means that the total memory used for queues is arround 5Mb but RES
> memory for beam.smp process is 358Mb !!!

You're right. rabbitmqctl memory report isn't anything useful.

Actually, it's impossible to give any decent memory statistics. Consider
a fanout exchange, where a single message gets distributed into multiple queues.
RabbitMQ actually doesn't copy the message, it shares it between
queues - what should memory usage return in that case?


> And when I start using it, things get worse. beam.smp just jumps from 400m
> to1.6G (in jumps of 100-200m per second) and well... my VPS provider just
> decides to kill almost everything on that machine. Right now I'm killing the
> B process after a bunch of messages, but actually i don't know how to
> estimate how much memory rabbit will be using per message.

RabbitMQ stores messages body as erlang binaries. They are handled
by a bit different garbage collection algorithms than normal erlang runtime
(that's another reason why we don't really know how much memory
messages are using).

Generally, garbage collector once in a while decides that it needs to
defragment the memory. To do so it allocates a big memory block
and copies used data there. After that's done, it frees the old memory block.

But for a while erlang will use _twice_ as much memory as it really needs.

That can be one of the reasons why you see the huge memory consumption.
Another reason may be badly tune garbage collector. In one
of my installations I noticed that setting some magic erlang gc option made
rabbit use way less memory. But tuning gc internals is not a thing we want
to recommend.

> I've heard the "new persister" (what a name, eh!) is "much better" with
> "memory issues":
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-May/007251.html

It definitely is. If you can afford compiling rabbit from source, please give
it a try. Just do "hg up bug21673; make run". More info here:
  http://www.rabbitmq.com/build-server.html#obtaining

Using erlang R13B03 or later may also help (it introduces better
garbage collection for binaries)

> taken from:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006397.html
>
>> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
>> Memory limit set to 3196MB.
>
> I'd love that functionality! when was implemented? or what parameters I need
> to pass to rabbit?

The idea behind it, is to tell the producers that they should stop
sending messages
when rabbit is using too much memory. To make it useful your client
must support
channel.flow amqp command, which tells the client to stop sending.
I'm afraid python-amqplib doesn't support that.

Some server side documentation:
  http://www.rabbitmq.com/extensions.html#memsup

This functionality works a bit differently in the new persister
branch. It gives a hint
to rabbit about how much memory rabbit may use. If it's using more - data gets
saved to the disk. So theoretically you should never see channel.flow
(if you have fast enough disk).

Cheers,
  Marek Majkowski

From majek04 at gmail.com  Wed Jul 14 14:33:47 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Jul 2010 14:33:47 +0100
Subject: [rabbitmq-discuss] Memory problems
In-Reply-To: <AANLkTikhdxoEat-tO6-MUqshMv8-Jx7kZ7jIbW2Dvi7S@mail.gmail.com>
References: <AANLkTikhdxoEat-tO6-MUqshMv8-Jx7kZ7jIbW2Dvi7S@mail.gmail.com>
Message-ID: <AANLkTikhA76ezh7NfrEUT6VcSrcx56YZ-KV0kTVfcYnP@mail.gmail.com>

(resent, looks like previously it haven't gone to the mailing list)

Nicol?s

First, sorry for timing, I must have missed your message somehow.

2010/6/3 Nicol?s C?sar <nico at nicocesar.com>:
> A process -> A_q queue -> B process -> fat_queue -> many C processes (even
> that I have many Cs,?? A is much faster)
>
> Here is the problem when everythig is almost empty:
>
> rabbitmqctl list_queues memory | awk '{T += $1;}END{print T;}'
> 5703040
>
> this means that the total memory used for queues is arround 5Mb but RES
> memory for beam.smp process is 358Mb !!!

You're right. rabbitmqctl memory report isn't anything useful.

Actually, it's impossible to give any decent memory statistics. Consider
a fanout exchange, where a single message gets distributed into multiple queues.
RabbitMQ actually doesn't copy the message, it shares it between
queues - what should memory usage return in that case?


> And when I start using it, things get worse. beam.smp just jumps from 400m
> to1.6G (in jumps of 100-200m per second) and well... my VPS provider just
> decides to kill almost everything on that machine. Right now I'm killing the
> B process after a bunch of messages, but actually i don't know how to
> estimate how much memory rabbit will be using per message.

RabbitMQ stores messages body as erlang binaries. They are handled
by a bit different garbage collection algorithms than normal erlang runtime
(that's another reason why we don't really know how much memory
messages are using).

Generally, garbage collector once in a while decides that it needs to
defragment the memory. To do so it allocates a big memory block
and copies used data there. After that's done, it frees the old memory block.

But for a while erlang will use _twice_ as much memory as it really needs.

That can be one of the reasons why you see the huge memory consumption.
Another reason may be badly tune garbage collector. In one
of my installations I noticed that setting some magic erlang gc option made
rabbit use way less memory. But tuning gc internals is not a thing we want
to recommend.

> I've heard the "new persister" (what a name, eh!) is "much better" with
> "memory issues":
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-May/007251.html

It definitely is. If you can afford compiling rabbit from source, please give
it a try. Just do "hg up bug21673; make run". More info here:
?http://www.rabbitmq.com/build-server.html#obtaining

Using erlang R13B03 or later may also help (it introduces better
garbage collection for binaries)

> taken from:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-February/006397.html
>
>> =INFO REPORT==== 16-Feb-2010::04:42:05 ===
>> Memory limit set to 3196MB.
>
> I'd love that functionality! when was implemented? or what parameters I need
> to pass to rabbit?

The idea behind it, is to tell the producers that they should stop
sending messages
when rabbit is using too much memory. To make it useful your client
must support
channel.flow amqp command, which tells the client to stop sending.
I'm afraid python-amqplib doesn't support that.

Some server side documentation:
?http://www.rabbitmq.com/extensions.html#memsup

This functionality works a bit differently in the new persister
branch. It gives a hint
to rabbit about how much memory rabbit may use. If it's using more - data gets
saved to the disk. So theoretically you should never see channel.flow
(if you have fast enough disk).

Cheers,
?Marek Majkowski

From jon at jbrisbin.com  Wed Jul 14 14:57:46 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 14 Jul 2010 08:57:46 -0500
Subject: [rabbitmq-discuss] mnesia is overloaded
In-Reply-To: <4C3CE7CF.5020501@rabbitmq.com>
References: <1270161D-F56A-4E79-BC99-DB14C9FCE94B@jbrisbin.com>	<AANLkTim05ZvjJ5HC_ir4qKr4HWVYI6RvH1RcrqlkwGa3@mail.gmail.com>
	<4C3C7B5A.40804@rabbitmq.com> <4C3CD0B6.1060602@rabbitmq.com>
	<4C3CE7CF.5020501@rabbitmq.com>
Message-ID: <D3F901A2-6504-4509-B469-A9DF948BFEDA@jbrisbin.com>

I can't always re-create the problem, but I have a unit test that creates a hundred or more bindings as fast as I can spool off threads. It might be able to be isolated like that...

jb


On Jul 13, 2010, at 5:25 PM, Matthias Radestock wrote:

> Tony,
> 
> Tony Garnock-Jones wrote:
>>>>> =WARNING REPORT==== 10-Jul-2010::09:01:05 ===
>>>>> Mnesia('rabbit at brisbins-mbp'): ** WARNING ** Mnesia is overloaded:
>>>>> {dump_log,
>>>>>  time_threshold}
>>> The warning message is indicative of a very high rate of AMQP resource
>>> configuration operations, e.g. creation/deletion of exchanges, queues
>>> and bindings. Is that what you'd expect to see from your tests?
>> Hm, oddly I've been seeing that with recent builds from tip-of-default a bit
>> too. I haven't figured out what could be causing it yet; load is generally low,
>> and I see it while rabbit is actually idle. This'd be on karmic in a virtual
>> machine on my OS X laptop.
> 
> I wonder whether VM-induced clock adjustments could trigger the warning. I vaguely recall some weirdness in that area being reported by people on erlang-questions, but that was quite a while ago.
> 
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100714/e145b2ed/attachment.htm>

From mikeb at rabbitmq.com  Wed Jul 14 16:31:12 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 14 Jul 2010 16:31:12 +0100
Subject: [rabbitmq-discuss] Queue delete causes transaction errors
In-Reply-To: <AANLkTimKb6jADqEJIRYo3E2KF6JQoHT3kWfaoVkTpuMu@mail.gmail.com>
References: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>	<4C3C8647.1020705@rabbitmq.com>
	<AANLkTimKb6jADqEJIRYo3E2KF6JQoHT3kWfaoVkTpuMu@mail.gmail.com>
Message-ID: <4C3DD840.2000608@rabbitmq.com>

Hi Aaron,

Thanks for the follow-up.

> It didn't occur to me that the failure could have arisen after the
> routing but during the consumption stage of my passive listener.  I
> don't think that's the case, but here's what the broker reported which
> I intended to include in my first email:
> 
>   class_id: 90
>   method_id: 20
>   reply_code: 541
>   reply_text: "INTERNAL_ERROR - commit failed:
> [{<0.25498.0>,{exit,{queue_disappeared,<0.25498.0>},[{rabbit_amqqueue,'-commit_all/3-fun-0-',1},{delegate,safe_invoke,2},{delegate,'-safe_invoke/2-lc$^0/1-0-',2},{delegate,'-safe_invoke/2-lc$^0/1-0-',2},{delegate,delegat..."

Right, yes it looks like the queue has disappeared in-between routing 
the message and committing the transaction.

I'm puzzled about why this would happen when you are not deleting the 
queue, though.  Are you declaring the queues as exclusive?  That would 
delete them with the connection.

(The proposed "new" semantics for transactions would obviate the 
queue-going-away problem, by the way)

>>> I see that 0.9.1 of the spec adds queue.unbind().  Is that the only
>>> way to avoid this problem, or is there another approach that we can
>>> take?
>> I don't see how queue.unbind would help -- would you explain?
> 
> I imagine that I could unbind my listener's queue, wait for a bit,
> then safely delete the queue and the broker would no longer be trying
> to route to it.

There would still be a race between the delete and the transaction 
committing, unless those are co-ordinated somehow (which I wouldn't have 
thought).  I.e., if you publish then commit in one process, and unbind 
then delete in another other process, the publish and commit could still 
fall either side of the unbind and delete.


Michael


> On Tue, Jul 13, 2010 at 11:29 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>> Hi Aaron,
>>
>>> I've confirmed that transactions are being aborted due to a queue
>>> being deleted using an easily-reproducible test case.
>>>
>>> The base-case is an exchange and a 1-1 mapping of a routing key to a
>>> destination queue.  The client is simply consuming a published message
>>> and then publishing the next one.  A single client as a consumer is
>>> enough to repeat the bug.
>>>
>>> We then have a test client which we can use to attach to an exchange
>>> using a supplied routing key.  It will create its own queue and then
>>> act as a passive listener, for easy monitoring of traffic.  The queue
>>> it uses is set to auto-delete. In high-traffic situations, I would
>>> occasionally see a transaction error in the client.
>>>
>>> I setup a test case today where a listener would open a connection and
>>> queue, listen for 2 seconds, then disconnect.  I tried combinations of
>>> auto_delete enabled and disabled, both with and without an explicit
>>> queue delete call, as well as using transactions and re-using a
>>> connection versus closing and reconnecting.  I would run this test
>>> listener while a test client simply published a message to itself
>>> every time it received one.  The client is using transactions,
>>> committing after each publish call.  Within a few minutes, no matter
>>> how my listener was configured, the client would receive a transaction
>>> error.  I repeated this with the 1.8.0 release.
>> It looks like there's two races going on here:
>>  - the queue being autodeleted, and the transaction committing; and
>>  - the connection dropping, and the transaction committing.
>>
>> In the first case, the transaction commit fails because the queue has gone
>> away and it can no longer route the message to it.  I'm less certain about
>> the second; I think it may be because the queue tries to deliver the message
>> on tx.commit, and the connection drops while that's happening.
>>
>> The AMQP spec doesn't say a lot about the properties of transactions, and in
>> particular, whether routing "happens" before or after tx.commit.  RabbitMQ
>> routes before the tx.commit, mainly so that persistent messages will land on
>> disk.
>>
>> It would be well within the spec to *act* as though routing happened after
>> tx.commit; e.g., the transaction wouldn't fail because your autodelete queue
>> has gone away.  We'd also have to be careful of the second case, that
>> failing to deliver the message didn't cause the tx.commit to fail.  That's
>> probably a more useful semantics overall, anyway.
>>
>> (We actually already have a bug for looking into this -- thanks for bringing
>> back to our attention!)
>>
>>> I see that 0.9.1 of the spec adds queue.unbind().  Is that the only
>>> way to avoid this problem, or is there another approach that we can
>>> take?
>> I don't see how queue.unbind would help -- would you explain?
>>
>>
>> Cheers,
>> Michael
>>
> 
> 
> 


From rauan at maemirov.com  Wed Jul 14 16:55:33 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Wed, 14 Jul 2010 21:55:33 +0600
Subject: [rabbitmq-discuss] configure: error: could not find AMQP spec file
	at "'/codegen/amqp-0.9.1.json'"
Message-ID: <AANLkTimsjT6UhCJPnL5FJfpAslmBp-bgIQyR6vLtFYwT@mail.gmail.com>

Hi, all.

I'm getting this error while trying to install rabbitmq-c... yes, i've
already seen this thread at
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-April/007011.html,
but it doesn't solve this problem. How can I set codegen path in configure?
(i tried many ways, but none of them worked for me)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100714/c292e330/attachment.htm>

From david at rabbitmq.com  Wed Jul 14 17:22:58 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 14 Jul 2010 17:22:58 +0100
Subject: [rabbitmq-discuss] configure: error: could not find AMQP spec
	file at "'/codegen/amqp-0.9.1.json'"
In-Reply-To: <AANLkTimsjT6UhCJPnL5FJfpAslmBp-bgIQyR6vLtFYwT@mail.gmail.com>
	(Rauan Maemirov's message of "Wed, 14 Jul 2010 21:55:33 +0600")
References: <AANLkTimsjT6UhCJPnL5FJfpAslmBp-bgIQyR6vLtFYwT@mail.gmail.com>
Message-ID: <yrv4clj9eav8d.fsf@dwragg.eng.vmware.com>

Hi Rauan,

Rauan Maemirov <rauan at maemirov.com> writes:
> I'm getting this error while trying to install rabbitmq-c... yes, i've
> already seen this thread at
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-April/007011.html,
> but it doesn't solve this problem. How can I set codegen path in configure?
> (i tried many ways, but none of them worked for me)

I'm trying to reproduce your problem, but I think I'm going to need more
information.

If I do

  $ cd /tmp
  $ rm -rf rabbitmq-c rabbitmq-codegen
  $ hg clone http://hg.rabbitmq.com/rabbitmq-codegen/
  $ hg clone http://hg.rabbitmq.com/rabbitmq-c/
  $ cd rabbitmq-c
  $ autoreconf -i
  $ ./configure
  $ make

everything builds fine.  Could you give a similar recipe to reproduce
your error?

I happen to be working on a Fedora machine.  What operating system are
you on?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From ovidiudeac at gmail.com  Wed Jul 14 17:37:20 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Wed, 14 Jul 2010 19:37:20 +0300
Subject: [rabbitmq-discuss] RABBITMQ_NODENAME
Message-ID: <AANLkTimPPABJ2AwSyupReswT-Ih472tI1x1E4BrSIBhO@mail.gmail.com>

Can somebody explain what is RABBITMQ_NODENAME and when is it used?

Thanks
Ovidiu

From vbarat at ubikod.com  Wed Jul 14 17:38:35 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Wed, 14 Jul 2010 18:38:35 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3D83BB.5070107@rabbitmq.com>
References: <4C3C7F7D.4050106@ubikod.com> <4C3D83BB.5070107@rabbitmq.com>
Message-ID: <4C3DE80B.7040703@ubikod.com>

  Concerning this issue, I've read about the basicQos() call.

Do you think that I can use this call to force the server to send me 
a maximum of, say, 1000 messages that I could store in an array in 
handleDelivery() (without blocking), and, once I've counted 1000 
messages exactly, I trigger another thread to store all messages and 
then ack all messages ?

Le 14/07/10 11:30, Simon MacMullen a ?crit :
> On 13/07/10 16:00, Vincent Barat wrote:
> <snip>
>> But from time to time, the database blocks during 30s to 1minute and
>> thus I don't acknowledge during the same time.
>>
>> It seems that the RabbitMQ server closes the connection. Is there a
>> timeout (or a setting) I can use to fix this issue ?
>
> Hi Vincent. Not acking for 30s certainly should not close the 
> connection. When the server closes a connection due to client 
> error it sends an error message; you should see this as an 
> IOException in the Java client. Check the ShutdownSignalException 
> inside the IOException to get the error code / message. 
> Alternatively you could look in the server logs, sometimes there's 
> more detail there.
>
> One way this could be happening is:
>
> * You have heartbeating turned on (I think some of the client 
> version have this turned on by default). Heartbeating makes the 
> server periodically check the client is still alive and responding.
>
> * You block the connection main loop, say by implementing your own 
> Consumer rather than using QueueingConsumer, and doing something 
> slow / expensive in Consumer.handleDelivery().
>
> Does this sound plausible? If not I would look for error messages 
> as above.
>
> Cheers, Simon
>

From emile at rabbitmq.com  Wed Jul 14 17:46:15 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Jul 2010 17:46:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.8.1 release
Message-ID: <4C3DE9D7.3060101@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.8.1.

This release of RabbitMQ can now be compiled with Erlang R14A. This is
expected to bring relief for MacPorts users and Debian (unstable) users
who build from source. Administration tools are now easier to use on
MacPorts. Further enhancements include the ability to observe
channel.flow events from the Java API and clustering usability improvements.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.8.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100714/b61b7d5b/attachment.txt>

From simon at rabbitmq.com  Wed Jul 14 17:53:07 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Jul 2010 17:53:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3DE80B.7040703@ubikod.com>
References: <4C3C7F7D.4050106@ubikod.com> <4C3D83BB.5070107@rabbitmq.com>
	<4C3DE80B.7040703@ubikod.com>
Message-ID: <4C3DEB73.80102@rabbitmq.com>

Hi Vincent. Yes, I think you could do that, although you have to think 
about what to do when there aren't 1000 messages to deliver - would you 
just wait indefinitely?

It does sound like you'd be building something like a fixed-length 
QueueingConsumer though - I don't really see what that would gain you.

Cheers, Simon

On 14/07/10 17:38, Vincent Barat wrote:
> Concerning this issue, I've read about the basicQos() call.
>
> Do you think that I can use this call to force the server to send me a
> maximum of, say, 1000 messages that I could store in an array in
> handleDelivery() (without blocking), and, once I've counted 1000
> messages exactly, I trigger another thread to store all messages and
> then ack all messages ?
>
> Le 14/07/10 11:30, Simon MacMullen a ?crit :
>> On 13/07/10 16:00, Vincent Barat wrote:
>> <snip>
>>> But from time to time, the database blocks during 30s to 1minute and
>>> thus I don't acknowledge during the same time.
>>>
>>> It seems that the RabbitMQ server closes the connection. Is there a
>>> timeout (or a setting) I can use to fix this issue ?
>>
>> Hi Vincent. Not acking for 30s certainly should not close the
>> connection. When the server closes a connection due to client error it
>> sends an error message; you should see this as an IOException in the
>> Java client. Check the ShutdownSignalException inside the IOException
>> to get the error code / message. Alternatively you could look in the
>> server logs, sometimes there's more detail there.
>>
>> One way this could be happening is:
>>
>> * You have heartbeating turned on (I think some of the client version
>> have this turned on by default). Heartbeating makes the server
>> periodically check the client is still alive and responding.
>>
>> * You block the connection main loop, say by implementing your own
>> Consumer rather than using QueueingConsumer, and doing something slow
>> / expensive in Consumer.handleDelivery().
>>
>> Does this sound plausible? If not I would look for error messages as
>> above.
>>
>> Cheers, Simon
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tony at rightscale.com  Wed Jul 14 17:54:24 2010
From: tony at rightscale.com (Tony Spataro)
Date: Wed, 14 Jul 2010 09:54:24 -0700
Subject: [rabbitmq-discuss] Preventing uncontrolled crashes due to file
	descriptor exhaustion
In-Reply-To: <AANLkTimuTjzOOA6ltm_AXO_beAIBZa_-9i2ydU5PLxGv@mail.gmail.com>
References: <AANLkTimYhYt0N4HZM6iU1nrrRkHnau6lJJt-hLsMRRP2@mail.gmail.com>
	<AANLkTiltJvVdV1adQbU6MsuO904nOuwybs_oCWZAU6YX@mail.gmail.com>
	<AANLkTimuTjzOOA6ltm_AXO_beAIBZa_-9i2ydU5PLxGv@mail.gmail.com>
Message-ID: <AANLkTimndlX5lelPYHld4e_1eHXdlNmk4FlNxXIbmLU4@mail.gmail.com>

Thanks Marek. I'll retry my tests with a 1.8 broker and verify that it
doesn't crash when its number of connections approaches its FD limit.

For a use case like mine (where the broker is listening for connections on a
public IP) I don't have the luxury of guaranteeing an upper bound on the
number of open sockets; but if the broker stops accepting connections once
it reaches its threshold, that should be sufficient to stop any new FDs from
being allocated.

Cheers,
   Tony


2010/7/13 Marek Majkowski <majek04 at gmail.com>

> On Tue, Jul 13, 2010 at 11:24, Marek Majkowski <majek04 at gmail.com> wrote:
> > In the new persister branch "bug21673" we've made some magical tweaks.
> > In this branch we try to make sure that there are always enough file
> descriptors
> > for erlang.
>
> Good news, apparently the "magical tweaks" were merged to the main
> branch some time ago. From what I see, they are included in 1.8.0.
>
> Quick experiments show that rabbit always leaves about 80 file descriptors
> for internal use.
>
> Cheers,
>    Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100714/c5054243/attachment-0001.htm>

From majek04 at gmail.com  Wed Jul 14 18:19:49 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Jul 2010 18:19:49 +0100
Subject: [rabbitmq-discuss] RABBITMQ_NODENAME
In-Reply-To: <AANLkTimPPABJ2AwSyupReswT-Ih472tI1x1E4BrSIBhO@mail.gmail.com>
References: <AANLkTimPPABJ2AwSyupReswT-Ih472tI1x1E4BrSIBhO@mail.gmail.com>
Message-ID: <AANLkTikE7I-k_OQU-Zl6yN-vd_bWFT5hthT7pAMbf2cB@mail.gmail.com>

On Wed, Jul 14, 2010 at 17:37, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> Can somebody explain what is RABBITMQ_NODENAME and when is it used?

RabbitMQ is build using Erlang. Erlang is a programming language, but actually
it's way more than that.

Erlang runs in a virtual machine (you can think about it as JVM (java
virtual machine) but for erlang). Every virtual machine is named.
RABBITMQ_NODENAME sets that name.

This name allows you to:
 - make sure that only one instance of Rabbit is running
   (there can't be two erlang vm's with the same name)
 - connect remotely to Rabbit instance
   (you can open a new terminal, type a magic command and
    get access to live rabbitmq instance. you could see statistics,
    run any code, or maybe even do a live code upgrade!)
 - connect remote tools, for example 'rabbitmqctl' connects
    to a specified node, gets statistics and prints them on the screen.

You can also say that erlang node name (RABBITMQ_NODENAME)
is used to identify that particular Rabbitmq instance.

Some pointer to erlang documentation:
http://www.erlang.org/doc/reference_manual/distributed.html

Hope that helps.

Cheers!
  Marek Majkowski

From aaron at agoragames.com  Wed Jul 14 19:43:57 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 14 Jul 2010 14:43:57 -0400
Subject: [rabbitmq-discuss] Queue delete causes transaction errors
In-Reply-To: <4C3DD840.2000608@rabbitmq.com>
References: <AANLkTil8w3yMRQFjxLipFEsXnOR9aLeMixlqoO-cCYfT@mail.gmail.com>
	<4C3C8647.1020705@rabbitmq.com>
	<AANLkTimKb6jADqEJIRYo3E2KF6JQoHT3kWfaoVkTpuMu@mail.gmail.com>
	<4C3DD840.2000608@rabbitmq.com>
Message-ID: <AANLkTil8BV-wc_EMnJYk8-wZhuHcsHyovl9GFyyL4p4B@mail.gmail.com>

On Wed, Jul 14, 2010 at 11:31 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> Right, yes it looks like the queue has disappeared in-between routing the
> message and committing the transaction.
>
> I'm puzzled about why this would happen when you are not deleting the queue,
> though. ?Are you declaring the queues as exclusive? ?That would delete them
> with the connection.

I'm always deleting the queue, just exercising whether it's
auto-deleted or not, and the exact timing of the delete and whether or
not I close the connection.  I haven't played with the exclusivity
setting.

> There would still be a race between the delete and the transaction
> committing, unless those are co-ordinated somehow (which I wouldn't have
> thought). ?I.e., if you publish then commit in one process, and unbind then
> delete in another other process, the publish and commit could still fall
> either side of the unbind and delete.

Good point.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From david at rabbitmq.com  Wed Jul 14 20:23:22 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 14 Jul 2010 20:23:22 +0100
Subject: [rabbitmq-discuss] configure: error: could not find AMQP spec
	file at "'/codegen/amqp-0.9.1.json'"
In-Reply-To: <AANLkTikK9EipqsBmk1NAaUbRTR0sXQt8TUtQRvbGBvfJ@mail.gmail.com>
	(Rauan Maemirov's message of "Thu, 15 Jul 2010 00:31:03 +0700")
References: <AANLkTimsjT6UhCJPnL5FJfpAslmBp-bgIQyR6vLtFYwT@mail.gmail.com>
	<yrv4clj9eav8d.fsf@dwragg.eng.vmware.com>
	<AANLkTikK9EipqsBmk1NAaUbRTR0sXQt8TUtQRvbGBvfJ@mail.gmail.com>
Message-ID: <yrv4c8w5dc1g5.fsf@dwragg.eng.vmware.com>

Rauan Maemirov <rauan at maemirov.com> writes:
> CentOS 5.4 (5.5)

That's the key.  I've managed to reproduce your problem now.

The issue seems to be that CentOS/RHEL has an old version of autoconf
which doesn't support the ac_abs_confdir variable.

But you can work around this issue by setting this variable in the
environment when you run configure, like so:

  $ ac_abs_confdir=$PWD ./configure

After that, I can "make" successfully (there are some warnings while
generating the man pages, but the resulting man pages look ok).

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From ovidiudeac at gmail.com  Wed Jul 14 22:39:54 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 00:39:54 +0300
Subject: [rabbitmq-discuss] RABBITMQ_NODENAME
In-Reply-To: <AANLkTikE7I-k_OQU-Zl6yN-vd_bWFT5hthT7pAMbf2cB@mail.gmail.com>
References: <AANLkTimPPABJ2AwSyupReswT-Ih472tI1x1E4BrSIBhO@mail.gmail.com>
	<AANLkTikE7I-k_OQU-Zl6yN-vd_bWFT5hthT7pAMbf2cB@mail.gmail.com>
Message-ID: <AANLkTilZjgXXBdVCMcxqn3fAOQ_YpkYIMIa19_lVVs36@mail.gmail.com>

Thanks for the explanation. I knew a few things about erlang but I was
more interested when the rabbitmq node name is used. So basically the
node name is used only when you want to build a cluster or to
administer the machine remotely.  If no cluster stuff is involved and
the administration is done locally then you shouldn't care about the
node name. Right?

On Wed, Jul 14, 2010 at 8:19 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Jul 14, 2010 at 17:37, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>> Can somebody explain what is RABBITMQ_NODENAME and when is it used?
>
> RabbitMQ is build using Erlang. Erlang is a programming language, but actually
> it's way more than that.
>
> Erlang runs in a virtual machine (you can think about it as JVM (java
> virtual machine) but for erlang). Every virtual machine is named.
> RABBITMQ_NODENAME sets that name.
>
> This name allows you to:
> ?- make sure that only one instance of Rabbit is running
> ? (there can't be two erlang vm's with the same name)
> ?- connect remotely to Rabbit instance
> ? (you can open a new terminal, type a magic command and
> ? ?get access to live rabbitmq instance. you could see statistics,
> ? ?run any code, or maybe even do a live code upgrade!)
> ?- connect remote tools, for example 'rabbitmqctl' connects
> ? ?to a specified node, gets statistics and prints them on the screen.
>
> You can also say that erlang node name (RABBITMQ_NODENAME)
> is used to identify that particular Rabbitmq instance.
>
> Some pointer to erlang documentation:
> http://www.erlang.org/doc/reference_manual/distributed.html
>
> Hope that helps.
>
> Cheers!
> ?Marek Majkowski
>

From irrer at umich.edu  Wed Jul 14 23:00:20 2010
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 14 Jul 2010 18:00:20 -0400
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
Message-ID: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>

Hi -

I know this is experimental, but I'm trying to compile the rabbitmq-c libs
under mingw on Windows.

The make gets to the point where it needs the include file arpa/inet.h , but
that is not provided by mingw.  Is there a workaround?

I've looked around the RabbitMQ web site but was not smart enough to find
any instructions for building C on Windows.  If there are some, please point
me to the URL.

Also, would it be possible to post a copy of the binary version of the
libraries,
or wouldn't that make sense?

FYI - the make output says:

PYTHONPATH=/home/irrer/rabbitmq-c-default/codegen python2.5 ./codegen.py
header /home/irrer/rabbitmq-c-default/codegen/amqp-0.8.json amqp_framing.h
PYTHONPATH=/home/irrer/rabbitmq-c-default/codegen python2.5 ./codegen.py
body /home/irrer/rabbitmq-c-default/codegen/amqp-0.8.json amqp_framing.c
make  all-am
make[3]: Entering directory `/home/irrer/rabbitmq-c-default/librabbitmq'
if /bin/sh ../libtool --tag=CC --mode=compile gcc -DHAVE_CONFIG_H -I. -I.
-I..     -g -O2 -Wall -MT amqp_mem.lo -MD -MP -MF ".deps/amqp_mem.Tpo" -c -o
amqp_mem.lo amqp_mem.c; \
        then mv -f ".deps/amqp_mem.Tpo" ".deps/amqp_mem.Plo"; else rm -f
".deps/amqp_mem.Tpo"; exit 1; fi
mkdir .libs
 gcc -DHAVE_CONFIG_H -I. -I. -I.. -g -O2 -Wall -MT amqp_mem.lo -MD -MP -MF
.deps/amqp_mem.Tpo -c amqp_mem.c  -DDLL_EXPORT -DPIC -o .libs/amqp_mem.o
 gcc -DHAVE_CONFIG_H -I. -I. -I.. -g -O2 -Wall -MT amqp_mem.lo -MD -MP -MF
.deps/amqp_mem.Tpo -c amqp_mem.c -o amqp_mem.o >/dev/null 2>&1 if /bin/sh
../libtool --tag=CC --mode=compile gcc -DHAVE_CONFIG_H -I. -I. -I..     -g
-O2 -Wall -MT amqp_table.lo -MD -MP -MF ".deps/amqp_ta
ble.Tpo" -c -o amqp_table.lo amqp_table.c;
        then mv -f ".deps/amqp_table.Tpo" ".deps/amqp_table.Plo"; else rm -f
".deps/amqp_table.Tpo"; exit 1; fi
gcc -DHAVE_CONFIG_H -I. -I. -I.. -g -O2 -Wall -MT amqp_table.lo -MD -MP -MF
.deps/amqp_table.Tpo -c amqp_table.c  -DDLL_EXPORT -DPIC -o
.libs/amqp_table.o
In file included from amqp_table.c:8:0:
amqp_private.h:8:56: fatal error: arpa/inet.h: No such file or directory
compilation terminated.


Thanks for any advice,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100714/77a8415a/attachment.htm>

From david at rabbitmq.com  Wed Jul 14 23:11:16 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 14 Jul 2010 23:11:16 +0100
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
	(Jim Irrer's message of "Wed, 14 Jul 2010 18:00:20 -0400")
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
Message-ID: <yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>

Hi Jim,

Jim Irrer <irrer at umich.edu> writes:
> I know this is experimental, but I'm trying to compile the rabbitmq-c libs
> under mingw on Windows.

The work to support building rabbitmq-c under mingw still lives in a
branch.  Please checkout bug22825, and read README.windows carefully.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From scott at beamdog.com  Thu Jul 15 05:18:47 2010
From: scott at beamdog.com (Scott Brooks)
Date: Wed, 14 Jul 2010 22:18:47 -0600
Subject: [rabbitmq-discuss] High Res Logo/Media
Message-ID: <AANLkTinJqS7Fpk0ZQ8nrew_Bnj8bI_8S-UpzbycZPEJd@mail.gmail.com>

Is there a high resolution logo available anywhere?

I'm doing a presentation at my local ruby group and a high res logo
would be nice.

Thanks
Scott Brooks

From Dan.Wise at ignisasset.com  Thu Jul 15 10:53:36 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Thu, 15 Jul 2010 10:53:36 +0100
Subject: [rabbitmq-discuss] Authenticating users via SSPI
Message-ID: <20100715095345.6BA7414F87C@lists.rabbitmq.com>

Hi,

 

We have a number of Windows users who want to use our rabbitmq
messaging. However we need to ensure that we authenticate them without
them having to enter their Windows passwords and syncing with the
rabbitmq user passwords.

 

Has anyone looked at a mechanism for using SSPI authentication to allow
clients to connect? This is surely a common challenge, particularly in
an organisation where there are large numbers of users and the job of
providing and maintaining separate passwords for different systems is
hugs.

 

Thanks,

 

Dan Wise

 

 

</PRE>**************************************************************<BR><BR>Visit our Website at http://www.ignisasset.com/ <BR>The information contained in this email (including any attachments transmitted within it) is confidential and is intended solely for the use of the named person. <BR>The unauthorised access, copying or re-use of the information in it by any other person is strictly forbidden. <BR>
If you are not the intended recipient please notify us immediately by return email to postmaster at ignisasset.com.<BR><BR>Internet communication is not guaranteed to be timely, secure, error or virus free. We accept no liability for any harm to systems or data,
nor for personal emails.  Emails may be recalled, deleted and monitored.<BR><BR>Ignis Asset Management is the trading name of the Ignis Asset Management Limited group of companies which includes the following subsidiary and associated companies: Ignis Asset Management Limited (Registered in Scotland No. SC200801), Ignis Investment Services Limited* (Registered in Scotland No. SC101825) <BR>Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish Mutual Investment Managers Limited* (Registered in Scotland No. SC88674) <BR>Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No. 971504)<BR>Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and Ignis Investment Management Limited* (Registered in England No. 5809046) <BR>Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD. Scottish Mutual is a registered trade mark of Scottish Mutual Assurance Limited<BR><BR>*Authorised and regulated by the Financial Services Authority.<BR><BR>**************************************************************<BR><PRE>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/ee0cfaf4/attachment.htm>

From majek04 at gmail.com  Thu Jul 15 11:04:55 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 15 Jul 2010 11:04:55 +0100
Subject: [rabbitmq-discuss] RABBITMQ_NODENAME
In-Reply-To: <AANLkTilZjgXXBdVCMcxqn3fAOQ_YpkYIMIa19_lVVs36@mail.gmail.com>
References: <AANLkTimPPABJ2AwSyupReswT-Ih472tI1x1E4BrSIBhO@mail.gmail.com>
	<AANLkTikE7I-k_OQU-Zl6yN-vd_bWFT5hthT7pAMbf2cB@mail.gmail.com>
	<AANLkTilZjgXXBdVCMcxqn3fAOQ_YpkYIMIa19_lVVs36@mail.gmail.com>
Message-ID: <AANLkTino2YkljJBZn_JyXu5IpxvAznzv7-40--icbko4@mail.gmail.com>

On Wed, Jul 14, 2010 at 22:39, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> Thanks for the explanation. I knew a few things about erlang but I was
> more interested when the rabbitmq node name is used. So basically the
> node name is used only when you want to build a cluster or to
> administer the machine remotely. ?If no cluster stuff is involved and
> the administration is done locally then you shouldn't care about the
> node name. Right?

Right. The you shouldn't really care about the nodename unless
you're playing with the cluster.

Cheers,
 Marek

From ovidiudeac at gmail.com  Thu Jul 15 12:40:58 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 14:40:58 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
Message-ID: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>

We are testing a rabbitmq intalation to see how it behaves if there is
no consumer while the producer publishes messages. The point of the
test is to see what we can rely on if somehow our consumer processes
die.

In order to do this we send persistent messages with a 300bytes
content in a loop and after 200k messages rabbitmq uses 100% processor
and is unreachable. The memory usage on the machine is only 27%. Even
when restarting the broker it won't start anymore.

Any ideas how I can tune rabbitmq to deal with this situation?

Thanks,
Ovidiu

From ovidiudeac at gmail.com  Thu Jul 15 12:53:12 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 14:53:12 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
Message-ID: <AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>

I forgot to say that we are using rabbitmq 1.8.0 on linux.

On Thu, Jul 15, 2010 at 2:40 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> We are testing a rabbitmq intalation to see how it behaves if there is
> no consumer while the producer publishes messages. The point of the
> test is to see what we can rely on if somehow our consumer processes
> die.
>
> In order to do this we send persistent messages with a 300bytes
> content in a loop and after 200k messages rabbitmq uses 100% processor
> and is unreachable. The memory usage on the machine is only 27%. Even
> when restarting the broker it won't start anymore.
>
> Any ideas how I can tune rabbitmq to deal with this situation?
>
> Thanks,
> Ovidiu
>

From ovidiudeac at gmail.com  Thu Jul 15 12:58:07 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 14:58:07 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
Message-ID: <AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>

...and the erlang version is "R13B01"

On Thu, Jul 15, 2010 at 2:53 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> I forgot to say that we are using rabbitmq 1.8.0 on linux.
>
> On Thu, Jul 15, 2010 at 2:40 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>> We are testing a rabbitmq intalation to see how it behaves if there is
>> no consumer while the producer publishes messages. The point of the
>> test is to see what we can rely on if somehow our consumer processes
>> die.
>>
>> In order to do this we send persistent messages with a 300bytes
>> content in a loop and after 200k messages rabbitmq uses 100% processor
>> and is unreachable. The memory usage on the machine is only 27%. Even
>> when restarting the broker it won't start anymore.
>>
>> Any ideas how I can tune rabbitmq to deal with this situation?
>>
>> Thanks,
>> Ovidiu
>>
>

From rtrlists at googlemail.com  Thu Jul 15 14:19:56 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 15 Jul 2010 14:19:56 +0100
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
Message-ID: <AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>

On Thu, Jul 15, 2010 at 12:58 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:

> ...and the erlang version is "R13B01"
>
> On Thu, Jul 15, 2010 at 2:53 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> > I forgot to say that we are using rabbitmq 1.8.0 on linux.
> >
> > On Thu, Jul 15, 2010 at 2:40 PM, Ovidiu Deac <ovidiudeac at gmail.com>
> wrote:
> >> We are testing a rabbitmq intalation to see how it behaves if there is
> >> no consumer while the producer publishes messages. The point of the
> >> test is to see what we can rely on if somehow our consumer processes
> >> die.
> >>
> >> In order to do this we send persistent messages with a 300bytes
> >> content in a loop and after 200k messages rabbitmq uses 100% processor
> >> and is unreachable. The memory usage on the machine is only 27%. Even
> >> when restarting the broker it won't start anymore.
> >>
> >> Any ideas how I can tune rabbitmq to deal with this situation?
> >>
> >> Thanks,
> >> Ovidiu
> >>
> >
>
>
I think you should use some flow control. If your Rabbit has the memory
alerts turned on, then your producer can pick up the
channel.flow/active=false and stop sending until you get the active=true.

Otherwise your sending of persistent message will eventually make Rabbit run
out of resources.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/1f86a92e/attachment.htm>

From davorin.rusevljan at gmail.com  Thu Jul 15 14:29:14 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Thu, 15 Jul 2010 15:29:14 +0200
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
Message-ID: <AANLkTil0H5kfbetCvoYYuwI3Pm--K2_VRNt8UX0QpOuc@mail.gmail.com>

On Thu, Jul 15, 2010 at 3:19 PM, Robert Raschke <rtrlists at googlemail.com>wrote:

>
> I think you should use some flow control. If your Rabbit has the memory
> alerts turned on, then your producer can pick up the
> channel.flow/active=false and stop sending until you get the active=true.
>
> Otherwise your sending of persistent message will eventually make Rabbit
> run out of resources.
>
> Robby
>
>
well, I think RabbitMQ server should have (and it probably does?) means to
stop accepting messages from the producer before it enters the inconsistent
and unrecoverable state. Because in many applications server can not expect
to have cooperative and well behaved producers, and it should be able to
survive such situations without going down.

davorin rusevljan
http://www.cloud208.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/871e8f7b/attachment.htm>

From msteele at beringmedia.com  Thu Jul 15 14:51:38 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Thu, 15 Jul 2010 09:51:38 -0400
Subject: [rabbitmq-discuss] Authenticating users via SSPI
In-Reply-To: <20100715095345.6BA7414F87C@lists.rabbitmq.com>
References: <20100715095345.6BA7414F87C@lists.rabbitmq.com>
Message-ID: <AANLkTikkZhrOKhlY12Dz-eew1rrMnR5wfOlaR8uFQ4fM@mail.gmail.com>

You could use PKI and store the certificates in LDAP. Have your app use the
current credentials of the user to grab the certificate and connect to
rabbit over SSL with peer certificate verification enabled.

Mark Steele
Director of development
Bering Media Inc.



On Thu, Jul 15, 2010 at 5:53 AM, Dan Wise <Dan.Wise at ignisasset.com> wrote:

>  Hi,
>
>
>
> We have a number of Windows users who want to use our rabbitmq messaging.
> However we need to ensure that we authenticate them without them having to
> enter their Windows passwords and syncing with the rabbitmq user passwords.
>
>
>
> Has anyone looked at a mechanism for using SSPI authentication to allow
> clients to connect? This is surely a common challenge, particularly in an
> organisation where there are large numbers of users and the job of providing
> and maintaining separate passwords for different systems is hugs.
>
>
>
> Thanks,
>
>
>
> *Dan Wise*
>
> * *
>
>
>
> **************************************************************
>
> Visit our Website at http://www.ignisasset.com/
> The information contained in this email (including any attachments
> transmitted within it) is confidential and is intended solely for the use of
> the named person.
> The unauthorised access, copying or re-use of the information in it by any
> other person is strictly forbidden.
> If you are not the intended recipient please notify us immediately by
> return email to postmaster at ignisasset.com.
>
> Internet communication is not guaranteed to be timely, secure, error or
> virus free. We accept no liability for any harm to systems or data, nor for
> personal emails. Emails may be recalled, deleted and monitored.
>
> Ignis Asset Management is the trading name of the Ignis Asset Management
> Limited group of companies which includes the following subsidiary and
> associated companies: Ignis Asset Management Limited (Registered in Scotland
> No. SC200801), Ignis Investment Services Limited* (Registered in Scotland
> No. SC101825)
> Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish
> Mutual Investment Managers Limited* (Registered in Scotland No. SC88674)
> Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000
> and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No.
> 971504)
> Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and
> Ignis Investment Management Limited* (Registered in England No. 5809046)
> Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD.
> Scottish Mutual is a registered trade mark of Scottish Mutual Assurance
> Limited
>
> *Authorised and regulated by the Financial Services Authority.
>
> **************************************************************
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/7382ff07/attachment-0001.htm>

From alexis at rabbitmq.com  Thu Jul 15 15:07:16 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 15 Jul 2010 15:07:16 +0100
Subject: [rabbitmq-discuss] High Res Logo/Media
In-Reply-To: <AANLkTinJqS7Fpk0ZQ8nrew_Bnj8bI_8S-UpzbycZPEJd@mail.gmail.com>
References: <AANLkTinJqS7Fpk0ZQ8nrew_Bnj8bI_8S-UpzbycZPEJd@mail.gmail.com>
Message-ID: <AANLkTinB-2ad6ulXR_lF7vMZVi0gm78p4xlW-LqZt820@mail.gmail.com>

Scott

Is the attached hi res enough?

alexis


On Thu, Jul 15, 2010 at 5:18 AM, Scott Brooks <scott at beamdog.com> wrote:
> Is there a high resolution logo available anywhere?
>
> I'm doing a presentation at my local ruby group and a high res logo
> would be nice.
>
> Thanks
> Scott Brooks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit4-newstrap.png
Type: image/png
Size: 7601 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/995a6a38/attachment.png>

From ovidiudeac at gmail.com  Thu Jul 15 15:18:00 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 17:18:00 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
Message-ID: <AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>

stopping the producer is not an option because the messages come from
the outside and we don't want to lose any of them. In that case the
producer should store them locally somehow and then we get back to
storing the messages in the db.

I'm thinking that there has to be some ways to increase the number of
messages that we are able to store in the queues if the consumers die
(a worst case scenario).

On Thu, Jul 15, 2010 at 4:19 PM, Robert Raschke <rtrlists at googlemail.com> wrote:
>
> On Thu, Jul 15, 2010 at 12:58 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>>
>> ...and the erlang version is "R13B01"
>>
>> On Thu, Jul 15, 2010 at 2:53 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>> > I forgot to say that we are using rabbitmq 1.8.0 on linux.
>> >
>> > On Thu, Jul 15, 2010 at 2:40 PM, Ovidiu Deac <ovidiudeac at gmail.com>
>> > wrote:
>> >> We are testing a rabbitmq intalation to see how it behaves if there is
>> >> no consumer while the producer publishes messages. The point of the
>> >> test is to see what we can rely on if somehow our consumer processes
>> >> die.
>> >>
>> >> In order to do this we send persistent messages with a 300bytes
>> >> content in a loop and after 200k messages rabbitmq uses 100% processor
>> >> and is unreachable. The memory usage on the machine is only 27%. Even
>> >> when restarting the broker it won't start anymore.
>> >>
>> >> Any ideas how I can tune rabbitmq to deal with this situation?
>> >>
>> >> Thanks,
>> >> Ovidiu
>> >>
>> >
>>
>
> I think you should use some flow control. If your Rabbit has the memory
> alerts turned on, then your producer can pick up the
> channel.flow/active=false and stop sending until you get the active=true.
>
> Otherwise your sending of persistent message will eventually make Rabbit run
> out of resources.
>
> Robby
>
>

From ovidiudeac at gmail.com  Thu Jul 15 15:21:35 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 17:21:35 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTil0H5kfbetCvoYYuwI3Pm--K2_VRNt8UX0QpOuc@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTil0H5kfbetCvoYYuwI3Pm--K2_VRNt8UX0QpOuc@mail.gmail.com>
Message-ID: <AANLkTinE4tPszMre1YfDXvwa6ZdC7V9GWTUFMEj2-CIW@mail.gmail.com>

I think that rabbit should protect itself from getting in an
inconsistent state. It closes the connection with the producer but
doesn't accept other connections either

On Thu, Jul 15, 2010 at 4:29 PM, Davorin Rusevljan
<davorin.rusevljan at gmail.com> wrote:
> On Thu, Jul 15, 2010 at 3:19 PM, Robert Raschke <rtrlists at googlemail.com>
> wrote:
>>
>> I think you should use some flow control. If your Rabbit has the memory
>> alerts turned on, then your producer can pick up the
>> channel.flow/active=false and stop sending until you get the active=true.
>>
>> Otherwise your sending of persistent message will eventually make Rabbit
>> run out of resources.
>>
>> Robby
>>
>
> well, I think RabbitMQ server should have (and it probably does?) means to
> stop accepting messages from the producer before it enters the inconsistent
> and unrecoverable state. Because in many applications server can not expect
> to have cooperative and well behaved producers, and it should be able to
> survive such situations without going down.
>
> davorin rusevljan
> http://www.cloud208.com/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From darius.damalakas at gmail.com  Thu Jul 15 15:25:45 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Thu, 15 Jul 2010 17:25:45 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com> 
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com> 
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com> 
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com> 
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
Message-ID: <AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>

> > I think you should use some flow control. If your Rabbit has the memory
> > alerts turned on, then your producer can pick up the
> > channel.flow/active=false and stop sending until you get the active=true.
> >
> > Otherwise your sending of persistent message will eventually make Rabbit
> run
> > out of resources.
>

IMHO, If it is not possible to store big amounts of messages, that will
require storing them somewhere else. Which basically means implementing
messaging logic twice.

Is there a possibility to use a different database back-end for persisting
messages?

Darius Damalakas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/53472711/attachment.htm>

From vbarat at ubikod.com  Thu Jul 15 15:35:59 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Thu, 15 Jul 2010 16:35:59 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3DEB73.80102@rabbitmq.com>
References: <4C3C7F7D.4050106@ubikod.com> <4C3D83BB.5070107@rabbitmq.com>
	<4C3DE80B.7040703@ubikod.com> <4C3DEB73.80102@rabbitmq.com>
Message-ID: <4C3F1CCF.1020409@ubikod.com>

  Hi Simon,

I got my fix: here is what I do:

1- I use basicQos() to be sure that the server will not send "too 
many" messages (actually, I have checked that basicQos() does not 
offers a guarantee on the number of un-acknoledged messages sent, 
since I actually receive much more than the parameter I give, but it 
seems at least to limit the amount of messages, maybe there is a bug 
here ?).
2- I use an unlimited LinkedBlockingQueue to buffer my messages and 
to be sure that handleDelivery will never block
3- then, I use another thread to read this queue and write my 
message to the database

It works perfectly.

Here is the code:

public abstract class BufferedQueueConsumer extends QueueConsumer
{
   private static final Log LOG = 
LogFactory.getLog(BufferedQueueConsumer.class);

   /** Maximum time during which the messages will be buffered 
before triggering a delivery */
   private int pace = 1000;

   /** Maximum number of messages being buffered before triggering a 
delivered */
   private int capacity = 1000;

   /** Thread used to consume buffered messages */
   private final Thread consumerThread;

   /**
    * The message buffer. A queue is used to store the buffered 
messages and to synchronize the
    * message producer and consumer. This queue must not have a 
maximum capacity, otherwise it could
    * block the producer in handleDelivery() and then brake the AMQP 
connection. Instead, we rely on
    * AMQP's QOS parameter which allow to configure the server to 
send not more than a given amount
    * of unacknowledged deliveries. Tests have shown that this 
parameter is not a guarantee (we can
    * receive more unacknowledged messages than expected) but it has 
a clear effect preventing memory
    * overflows.
    */
   private final BlockingQueue<Delivery> deliveryQueue = new 
LinkedBlockingQueue<Delivery>();

   public BufferedQueueConsumer(final String queueName, String 
exchange, String routingKey,
     String mode, boolean durable)
   {
     /* Create the parent queue consumer */
     super(queueName, exchange, routingKey, mode, durable);

     /* Create the thread consuming delivered messages */
     consumerThread = new Thread(queueName + "'s consumer")
     {
       @Override
       public void run()
       {
         LOG.info("Thread " + this.getName() + " started");

         /* Create a delivery list used to extract deliveries from 
the delivery queue */
         final List<Delivery> deliveryList = new ArrayList<Delivery>();
         final List<Delivery> readOnlyDeliveryList = 
Collections.unmodifiableList(deliveryList);

         /* Initialize last delivery time */
         long lastDeliveryTime = System.currentTimeMillis();

         while (true)
         {
           long currentTime = System.currentTimeMillis();

           /*
            * If we have polled enough messages from the delivery 
queue, or we have polled the
            * delivery queue long enough
            */
           if (deliveryList.size() == capacity
             || ((currentTime >= lastDeliveryTime + pace) && 
!deliveryList.isEmpty()))
           {
             /* Ask subclass to handle all buffered deliveries */
             handleBufferedDeliveries(readOnlyDeliveryList);

             /* Acknowledge all buffered deliveries */
             ackDeliveries(readOnlyDeliveryList);

             /* Forget all buffered deliveries */
             deliveryList.clear();

             /* Reset last delivery time */
             lastDeliveryTime = System.currentTimeMillis();
           }

           /*
            * If we need to poll more messages from the delivery 
queue, or we haven't polled the
            * delivery queue long enough
            */
           else
           {
             try
             {
               /*
                * If the delivery list is empty, we need to wait 
forever for one message before being
                * able to deliver something
                */
               if (deliveryList.isEmpty())
                 deliveryList.add(deliveryQueue.take());

               /*
                * If the delivery list is not empty, we only need to 
wait for the time remaining to
                * poll
                */
               else
               {
                 Delivery delivery = 
deliveryQueue.poll(lastDeliveryTime + pace - currentTime,
                   TimeUnit.MILLISECONDS);
                 if (delivery != null)
                   deliveryList.add(delivery);
               }
             }
             catch (InterruptedException ie)
             {
               LOG.warn("Thread " + this.getName() + " for " + 
queueName + " interrupted");
               return;
             }
           }
         }
       }
     };
     consumerThread.setDaemon(true);
     consumerThread.start();
   }

   @Override
   protected void onNewChannel(Channel channel) throws IOException
   {
     super.onNewChannel(channel);

     /*
      * Configure the channel to send not more than a given amount 
of unacknowledged messages. This
      * avoid at the same time to buffer too many messages (which 
could exhaust memory) and to block
      * in handleDelivery() (which could brake the connection).
      */
     channel.basicQos(capacity);
   }

   @Override
   public void handleDelivery(String consumerTag, Envelope envelope, 
BasicProperties properties,
     byte[] body)
   {
     try
     {
       /* Store the delivery in the message buffer */
       deliveryQueue.put(new Delivery(envelope, properties, body));
     }
     catch (InterruptedException ie)
     {
       /* Due to program being exited, do nothing */
     }
   }

   /**
    * Override this method to be notified of buffered deliveries. 
Once this method has run, messages
    * will be acknowledged.
    * @param stack unmodifiable list of deliveries.
    */
   public abstract void handleBufferedDeliveries(List<Delivery> stack);
}


Le 14/07/10 18:53, Simon MacMullen a ?crit :
> Hi Vincent. Yes, I think you could do that, although you have to 
> think about what to do when there aren't 1000 messages to deliver 
> - would you just wait indefinitely?
>
> It does sound like you'd be building something like a fixed-length 
> QueueingConsumer though - I don't really see what that would gain 
> you.
>
> Cheers, Simon
>
> On 14/07/10 17:38, Vincent Barat wrote:
>> Concerning this issue, I've read about the basicQos() call.
>>
>> Do you think that I can use this call to force the server to send 
>> me a
>> maximum of, say, 1000 messages that I could store in an array in
>> handleDelivery() (without blocking), and, once I've counted 1000
>> messages exactly, I trigger another thread to store all messages and
>> then ack all messages ?
>>
>> Le 14/07/10 11:30, Simon MacMullen a ?crit :
>>> On 13/07/10 16:00, Vincent Barat wrote:
>>> <snip>
>>>> But from time to time, the database blocks during 30s to 
>>>> 1minute and
>>>> thus I don't acknowledge during the same time.
>>>>
>>>> It seems that the RabbitMQ server closes the connection. Is 
>>>> there a
>>>> timeout (or a setting) I can use to fix this issue ?
>>>
>>> Hi Vincent. Not acking for 30s certainly should not close the
>>> connection. When the server closes a connection due to client 
>>> error it
>>> sends an error message; you should see this as an IOException in 
>>> the
>>> Java client. Check the ShutdownSignalException inside the 
>>> IOException
>>> to get the error code / message. Alternatively you could look in 
>>> the
>>> server logs, sometimes there's more detail there.
>>>
>>> One way this could be happening is:
>>>
>>> * You have heartbeating turned on (I think some of the client 
>>> version
>>> have this turned on by default). Heartbeating makes the server
>>> periodically check the client is still alive and responding.
>>>
>>> * You block the connection main loop, say by implementing your own
>>> Consumer rather than using QueueingConsumer, and doing something 
>>> slow
>>> / expensive in Consumer.handleDelivery().
>>>
>>> Does this sound plausible? If not I would look for error 
>>> messages as
>>> above.
>>>
>>> Cheers, Simon
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Thu Jul 15 16:09:07 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 15 Jul 2010 16:09:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3F1CCF.1020409@ubikod.com>
References: <4C3C7F7D.4050106@ubikod.com> <4C3D83BB.5070107@rabbitmq.com>
	<4C3DE80B.7040703@ubikod.com> <4C3DEB73.80102@rabbitmq.com>
	<4C3F1CCF.1020409@ubikod.com>
Message-ID: <4C3F2493.1080003@rabbitmq.com>

On 15/07/10 15:35, Vincent Barat wrote:
> I got my fix: here is what I do:
>
> 1- I use basicQos() to be sure that the server will not send "too many"
> messages (actually, I have checked that basicQos() does not offers a
> guarantee on the number of un-acknoledged messages sent, since I
> actually receive much more than the parameter I give, but it seems at
> least to limit the amount of messages, maybe there is a bug here ?).

Hi Vincent. I don't think there's a bug in our handling of basic.qos - 
it's been around for a while and a lot of people are using it successfully.

I notice that in onNewChannel():

   @Override
   protected void onNewChannel(Channel channel) throws IOException
   {
     super.onNewChannel(channel);

     /*
      * Configure the channel to send not more than a given amount of 
unacknowledged messages. This
      * avoid at the same time to buffer too many messages (which could 
exhaust memory) and to block
      * in handleDelivery() (which could brake the connection).
      */
     channel.basicQos(capacity);
   }

You invoke channel.basicQos() after super.onNewChannel(). Does 
super.onNewChannel() invoke channel.basicConsume() by any chance? If it 
does so then the server can start sending an unlimited  number of 
messages as soon as it receives this message - it'll only start limiting 
the number it sends out after receiving basic.qos. Therefore it's 
usually better to send basic.qos before basic.consume.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From lists at zopyx.com  Thu Jul 15 16:24:46 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 15 Jul 2010 17:24:46 +0200
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
Message-ID: <4C3F283E.2040505@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Darius Damalakas wrote:
> 
>     > I think you should use some flow control. If your Rabbit has the
>     memory
>     > alerts turned on, then your producer can pick up the
>     > channel.flow/active=false and stop sending until you get the
>     active=true.
>     >
>     > Otherwise your sending of persistent message will eventually make
>     Rabbit run
>     > out of resources.
> 
> 
> IMHO, If it is not possible to store big amounts of messages, that will
> require storing them somewhere else. Which basically means implementing
> messaging logic twice.
> 
> Is there a possibility to use a different database back-end for
> persisting messages?
>



Shall we learn from this thread that RabbitMQ can not deal 200k message
with a size of 300 bytes in a reasonable way? That's not much data.

- -aj

- -- 
ZOPYX Limited           | zopyx group
Charlottenstr. 37/1     | The full-service network for Zope & Plone
D-72070 T?bingen        | Produce & Publish
www.zopyx.com           | www.produce-and-publish.com
- ------------------------------------------------------------------------
E-Publishing, Python, Zope & Plone development, Consulting


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkw/KD4ACgkQCJIWIbr9KYz3GACfd1wbP7ftbRPnjvuvkQ/GXl1V
QZQAn0kSWaUHpxStaBJ7312yf3Ji19RK
=zQdJ
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 330 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/fa442c89/attachment.vcf>

From majek04 at gmail.com  Thu Jul 15 17:53:31 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 15 Jul 2010 17:53:31 +0100
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
Message-ID: <AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>

Aaron,

On Tue, Jul 13, 2010 at 17:08, Aaron Westendorf <aaron at agoragames.com> wrote:
> I missed some changes to the rabbitmq-server script that occurred
> sometime between 1.5.0 and 1.7.0.
>
> In older versions, the script included the following line at the top:
>
> ?[ -f /etc/rabbitmq/rabbitmq.conf ] && . /etc/rabbitmq/rabbitmq.conf
>
> The file could be used to define any of the bash options, but
> documentation and/or posts had suggested that this was how one would
> disable smp, for example:
>
> ?RABBITMQ_SERVER_ERL_ARGS="-smp disable"

/etc/rabbitmq/rabbitmq.conf is still okay. Here's a partial list of supported
parameters:
   http://www.rabbitmq.com/install.html#install-windows-separately

But please, strip the "RABBITMQ_" prefix. To disable smp
put following settings to "/etc/rabbitmq/rabbitmq.conf":
SERVER_START_ARGS="-smp disable"


> This causes a lot of confusion with the new config file,
> /etc/rabbitmq/rabbitmq.config, which seems to be the place where all
> of the application configuration should go.

Agreed, rabbitmq settings are awful.
/etc/rabbitmq/rabbitmq.conf <- put global bash env variables here
/etc/rabbitmq/rabbitmq.config <- erlang setup config

> I feel like I've heard
> that this includes socket buffers, but I don't recall. ?The only
> documentation I can find on the file relates to setting
> "vm_memory_high_watermark", which seems to be specific to rabbit and
> not the same as the old "-os_mon system_memory_high_watermark" setting
> that was embedded in the rabbitmq-server script. ?Is there a complete
> reference on the format of this file and what options are available?
> Can the cluster configuration be merged into this file?
>
> I'm an erlang noob, but have worked with rabbit enough and read
> through the scripts to guess that the following content for
> rabbitmq.config would work as expected:
>
> [
> ?{rabbit, [
> ? ?{vm_memory_high_watermark, 0},
> ? ?{cluster_config, [rabbit at host1, rabbit at host2]},
> ?]},
> ?{kernel, [
> ? ?{inet_default_listen_options,
> [{nodelay,true},{sndbuf,32768},{recbuf,32768}] },
> ? ?{inet_default_connect_options, [{nodelay,true}] }
> ?]},
> ?{os_mon, [
> ? ?{start_cpu_sup, false},
> ?]}
> ].

That looks okay, tough I'm not able to check if you haven't missed a
coma or a bracket.
But I can share my /etc/rabbitmq/rabbitmq.config:

[
                {kernel,
                        [{inet_dist_listen_min, 50000},
                         {inet_dist_listen_max, 60000},
                         {inet_default_listen_options, [{nodelay,true}]},
                         {inet_default_connect_options, [{nodelay,true}]}
                        ]
                },
                {rabbit,
                        [{vm_memory_high_watermark, 0.1}]
                }
].


Cheers,
  Marek Majkowski

From rtrlists at googlemail.com  Thu Jul 15 17:55:15 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 15 Jul 2010 17:55:15 +0100
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <4C3F283E.2040505@zopyx.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
Message-ID: <AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>

On Thu, Jul 15, 2010 at 4:24 PM, Andreas Jung <lists at zopyx.com> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Darius Damalakas wrote:
> >
> >     > I think you should use some flow control. If your Rabbit has the
> >     memory
> >     > alerts turned on, then your producer can pick up the
> >     > channel.flow/active=false and stop sending until you get the
> >     active=true.
> >     >
> >     > Otherwise your sending of persistent message will eventually make
> >     Rabbit run
> >     > out of resources.
> >
> >
> > IMHO, If it is not possible to store big amounts of messages, that will
> > require storing them somewhere else. Which basically means implementing
> > messaging logic twice.
> >
> > Is there a possibility to use a different database back-end for
> > persisting messages?
> >
>
>
>
> Shall we learn from this thread that RabbitMQ can not deal 200k message
> with a size of 300 bytes in a reasonable way? That's not much data.
>
> - -aj
>
>
Sorry I can't be of more help with regards the actual resource usage pattern
that is seen here (I'm still on 1.6). Maybe someone from the team will jump
in at some point.

My hunch would be that the underlying DB is flushing the logs and that is
eating up your CPU. If that was then killed mid flush, the next start up
will start repairing your DB, also eating up your CPU. The logfile will
probably contain something that will help diagnose this further.

@Ovidiu:
BUT, are you really sure you want what you are asking for? If I understand
you correctly you want to allow outside producers (not under your control)
to send persistant messages directly into your RabbitMQ and not have those
producers back off?

Personally, I think that is not achievable. At some point your server is
going to reject messages, and your producers must be able to deal with that,
if, as you say, no messages are allowed to be lost.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/34117e9b/attachment.htm>

From aaron at agoragames.com  Thu Jul 15 18:30:17 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 15 Jul 2010 13:30:17 -0400
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
	<AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
Message-ID: <AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>

Marek,

Fantastic, thank you; I was looking for the general format and
capability, I'm sure it's not perfectly formatted.  I'll be writing up
a post in the coming weeks summarizing our rabbit configuration.  For
a future release, I'd recommend:

* better documentation on rabbitmq.config
* deprecating the rabbitmq_cluster.config file in favor of a single config
* renaming rabbitmq.conf to rabbitmq.env or similar

cheers,
Aaron

On Thu, Jul 15, 2010 at 12:53 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> Aaron,
>
> On Tue, Jul 13, 2010 at 17:08, Aaron Westendorf <aaron at agoragames.com> wrote:
>> I missed some changes to the rabbitmq-server script that occurred
>> sometime between 1.5.0 and 1.7.0.
>>
>> In older versions, the script included the following line at the top:
>>
>> ?[ -f /etc/rabbitmq/rabbitmq.conf ] && . /etc/rabbitmq/rabbitmq.conf
>>
>> The file could be used to define any of the bash options, but
>> documentation and/or posts had suggested that this was how one would
>> disable smp, for example:
>>
>> ?RABBITMQ_SERVER_ERL_ARGS="-smp disable"
>
> /etc/rabbitmq/rabbitmq.conf is still okay. Here's a partial list of supported
> parameters:
> ? http://www.rabbitmq.com/install.html#install-windows-separately
>
> But please, strip the "RABBITMQ_" prefix. To disable smp
> put following settings to "/etc/rabbitmq/rabbitmq.conf":
> SERVER_START_ARGS="-smp disable"
>
>
>> This causes a lot of confusion with the new config file,
>> /etc/rabbitmq/rabbitmq.config, which seems to be the place where all
>> of the application configuration should go.
>
> Agreed, rabbitmq settings are awful.
> /etc/rabbitmq/rabbitmq.conf <- put global bash env variables here
> /etc/rabbitmq/rabbitmq.config <- erlang setup config
>
>> I feel like I've heard
>> that this includes socket buffers, but I don't recall. ?The only
>> documentation I can find on the file relates to setting
>> "vm_memory_high_watermark", which seems to be specific to rabbit and
>> not the same as the old "-os_mon system_memory_high_watermark" setting
>> that was embedded in the rabbitmq-server script. ?Is there a complete
>> reference on the format of this file and what options are available?
>> Can the cluster configuration be merged into this file?
>>
>> I'm an erlang noob, but have worked with rabbit enough and read
>> through the scripts to guess that the following content for
>> rabbitmq.config would work as expected:
>>
>> [
>> ?{rabbit, [
>> ? ?{vm_memory_high_watermark, 0},
>> ? ?{cluster_config, [rabbit at host1, rabbit at host2]},
>> ?]},
>> ?{kernel, [
>> ? ?{inet_default_listen_options,
>> [{nodelay,true},{sndbuf,32768},{recbuf,32768}] },
>> ? ?{inet_default_connect_options, [{nodelay,true}] }
>> ?]},
>> ?{os_mon, [
>> ? ?{start_cpu_sup, false},
>> ?]}
>> ].
>
> That looks okay, tough I'm not able to check if you haven't missed a
> coma or a bracket.
> But I can share my /etc/rabbitmq/rabbitmq.config:
>
> [
> ? ? ? ? ? ? ? ?{kernel,
> ? ? ? ? ? ? ? ? ? ? ? ?[{inet_dist_listen_min, 50000},
> ? ? ? ? ? ? ? ? ? ? ? ? {inet_dist_listen_max, 60000},
> ? ? ? ? ? ? ? ? ? ? ? ? {inet_default_listen_options, [{nodelay,true}]},
> ? ? ? ? ? ? ? ? ? ? ? ? {inet_default_connect_options, [{nodelay,true}]}
> ? ? ? ? ? ? ? ? ? ? ? ?]
> ? ? ? ? ? ? ? ?},
> ? ? ? ? ? ? ? ?{rabbit,
> ? ? ? ? ? ? ? ? ? ? ? ?[{vm_memory_high_watermark, 0.1}]
> ? ? ? ? ? ? ? ?}
> ].
>
>
> Cheers,
> ?Marek Majkowski
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From ovidiudeac at gmail.com  Thu Jul 15 18:33:14 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 20:33:14 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
Message-ID: <AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>

First of all thanks for the answers. Second I'll explain the situation
a little better.

The big picture is like this: we receive orders from outside and they
are put in rabbit by our "gateway" and then routed by rabbit to the
processing modules. The whole business is about handling those
messages and if we are unable to receive messages from outside is very
bad so basically our gateway should be up all the time.

Normally all the orders coming in should be handled smoothly BUT if
something happens to the consumers and they have a downtime the
producer has no way to stop the incoming messages. Also we always want
to be able to accept messages because we are payed for each incoming
message.

Normally the system admin should handle the problem and restart the
consumers. As I was saying before, we are testing for the worst case
scenario, to see what the limits of RabbitMQ are. We want to see how
can we extend these limits to increase the time we have until the
queues get full.

>From our calculations if rabbitmq could hold 500k messages up to
300bytes each we would be pretty safe as that would give us enough
time to react. The 200k limit is a little tight.

ovidiu

> @Ovidiu:
> BUT, are you really sure you want what you are asking for? If I understand
> you correctly you want to allow outside producers (not under your control)
> to send persistant messages directly into your RabbitMQ and not have those
> producers back off?
>
> Personally, I think that is not achievable. At some point your server ii>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

s
> going to reject messages, and your producers must be able to deal with that,
> if, as you say, no messages are allowed to be lost.
>
> Robby

From scott at beamdog.com  Thu Jul 15 18:50:42 2010
From: scott at beamdog.com (Scott Brooks)
Date: Thu, 15 Jul 2010 11:50:42 -0600
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
Message-ID: <AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>

200k messages, @ 300 bytes a piece is nothing.

I just ran a test and everything is fine for me.

Can you re-do the test?  Also what are the specs on the server you are
running the test on?

Scott


On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> First of all thanks for the answers. Second I'll explain the situation
> a little better.
>
> The big picture is like this: we receive orders from outside and they
> are put in rabbit by our "gateway" and then routed by rabbit to the
> processing modules. The whole business is about handling those
> messages and if we are unable to receive messages from outside is very
> bad so basically our gateway should be up all the time.
>
> Normally all the orders coming in should be handled smoothly BUT if
> something happens to the consumers and they have a downtime the
> producer has no way to stop the incoming messages. Also we always want
> to be able to accept messages because we are payed for each incoming
> message.
>
> Normally the system admin should handle the problem and restart the
> consumers. As I was saying before, we are testing for the worst case
> scenario, to see what the limits of RabbitMQ are. We want to see how
> can we extend these limits to increase the time we have until the
> queues get full.
>
> From our calculations if rabbitmq could hold 500k messages up to
> 300bytes each we would be pretty safe as that would give us enough
> time to react. The 200k limit is a little tight.
>
> ovidiu
>
>> @Ovidiu:
>> BUT, are you really sure you want what you are asking for? If I understand
>> you correctly you want to allow outside producers (not under your control)
>> to send persistant messages directly into your RabbitMQ and not have those
>> producers back off?
>>
>> Personally, I think that is not achievable. At some point your server ii>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> s
>> going to reject messages, and your producers must be able to deal with that,
>> if, as you say, no messages are allowed to be lost.
>>
>> Robby
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Thu Jul 15 19:00:56 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Jul 2010 19:00:56 +0100
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>	<AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
	<AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>
Message-ID: <4C3F4CD8.5060509@rabbitmq.com>

Aaron,

On 15/07/10 18:30, Aaron Westendorf wrote:
> For a future release, I'd recommend:
>
> * better documentation on rabbitmq.config

There are actually very few rabbit application env vars, but yes, they 
should be documented better.

> * deprecating the rabbitmq_cluster.config file in favor of a single config

We could make that part of rabbitmq.config. I have filed a bug for that.

> * renaming rabbitmq.conf to rabbitmq.env or similar

We've never been happy with the confusingly similar naming but have so 
far failed to come up with a sensible alternative. "rabbitmq.env" is 
nice but we already have a "rabbitmq-env" script in our distribution, so 
there could be a new kind of confusion. We rejected "rabbitmq-env.sh" 
for the same reason. Any other suggestions?


Regards,

Matthias.

From scott at beamdog.com  Thu Jul 15 19:29:03 2010
From: scott at beamdog.com (Scott Brooks)
Date: Thu, 15 Jul 2010 12:29:03 -0600
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <4C3F4CD8.5060509@rabbitmq.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
	<AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
	<AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>
	<4C3F4CD8.5060509@rabbitmq.com>
Message-ID: <AANLkTilg5dtT_7BpoN7FoQT-oqNY9TH6o3_kFhDPsZbc@mail.gmail.com>

Since scripts/rabbitmq-env is the one that reads rabbitmq.conf, I
think calling it rabbitmq.env actually does work.

Or rabbitmq-env.conf or something along those lines.

Scott Brooks

On Thu, Jul 15, 2010 at 12:00 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Aaron,
>
> On 15/07/10 18:30, Aaron Westendorf wrote:
>>
>> For a future release, I'd recommend:
>>
>> * better documentation on rabbitmq.config
>
> There are actually very few rabbit application env vars, but yes, they
> should be documented better.
>
>> * deprecating the rabbitmq_cluster.config file in favor of a single config
>
> We could make that part of rabbitmq.config. I have filed a bug for that.
>
>> * renaming rabbitmq.conf to rabbitmq.env or similar
>
> We've never been happy with the confusingly similar naming but have so far
> failed to come up with a sensible alternative. "rabbitmq.env" is nice but we
> already have a "rabbitmq-env" script in our distribution, so there could be
> a new kind of confusion. We rejected "rabbitmq-env.sh" for the same reason.
> Any other suggestions?
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aaron at agoragames.com  Thu Jul 15 19:30:25 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 15 Jul 2010 14:30:25 -0400
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <4C3F4CD8.5060509@rabbitmq.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
	<AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
	<AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>
	<4C3F4CD8.5060509@rabbitmq.com>
Message-ID: <AANLkTin_-2UMJ7SgTm-f7GpNxDT563lAHcoK9crML9g_@mail.gmail.com>

> We've never been happy with the confusingly similar naming but have so far
> failed to come up with a sensible alternative. "rabbitmq.env" is nice but we
> already have a "rabbitmq-env" script in our distribution, so there could be
> a new kind of confusion. We rejected "rabbitmq-env.sh" for the same reason.
> Any other suggestions?

I doubt many people venture into the scripts and as this is (by
default) in /etc/rabbitmq, the confusion should be minimized.  You
could also go with rabbitmqrc, rabbitmq.rc, or similar.

cheers

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From vbarat at ubikod.com  Thu Jul 15 20:43:37 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Thu, 15 Jul 2010 21:43:37 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.7.0 close the cnx when consumer
 don't ack deliveries during 30s
In-Reply-To: <4C3F2493.1080003@rabbitmq.com>
References: <4C3C7F7D.4050106@ubikod.com> <4C3D83BB.5070107@rabbitmq.com>
	<4C3DE80B.7040703@ubikod.com> <4C3DEB73.80102@rabbitmq.com>
	<4C3F1CCF.1020409@ubikod.com> <4C3F2493.1080003@rabbitmq.com>
Message-ID: <4C3F64E9.6060202@ubikod.com>

  Hi again,

You are definitively right!  I will update my code that will work 
perfectly now I'm sure :-)

Thank you so much for your help!

Le 15/07/10 17:09, Simon MacMullen a ?crit :
> On 15/07/10 15:35, Vincent Barat wrote:
>> I got my fix: here is what I do:
>>
>> 1- I use basicQos() to be sure that the server will not send "too 
>> many"
>> messages (actually, I have checked that basicQos() does not offers a
>> guarantee on the number of un-acknoledged messages sent, since I
>> actually receive much more than the parameter I give, but it 
>> seems at
>> least to limit the amount of messages, maybe there is a bug here ?).
>
> Hi Vincent. I don't think there's a bug in our handling of 
> basic.qos - it's been around for a while and a lot of people are 
> using it successfully.
>
> I notice that in onNewChannel():
>
>   @Override
>   protected void onNewChannel(Channel channel) throws IOException
>   {
>     super.onNewChannel(channel);
>
>     /*
>      * Configure the channel to send not more than a given amount 
> of unacknowledged messages. This
>      * avoid at the same time to buffer too many messages (which 
> could exhaust memory) and to block
>      * in handleDelivery() (which could brake the connection).
>      */
>     channel.basicQos(capacity);
>   }
>
> You invoke channel.basicQos() after super.onNewChannel(). Does 
> super.onNewChannel() invoke channel.basicConsume() by any chance? 
> If it does so then the server can start sending an unlimited  
> number of messages as soon as it receives this message - it'll 
> only start limiting the number it sends out after receiving 
> basic.qos. Therefore it's usually better to send basic.qos before 
> basic.consume.
>
> Cheers, Simon
>

From ovidiudeac at gmail.com  Thu Jul 15 20:51:03 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 22:51:03 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
Message-ID: <AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>

I found the problem: the memory limit was the default one which is 1.6
i.e. 40% out of 4GB. It seems the OS installed is 32bits and this is
why erlang doesn't see the full 6GB RAM.

Of course the system didn't work if it ran out of memory.

As soon as I changed vm_memory_high_watermark to 0.98 by putting
[{rabbit, [{vm_memory_high_watermark, 0.98}]}].
... in /etc/rabbitmq/rabbitmq.config the problem was fixed

Thanks for the help.

ovidiu

On Thu, Jul 15, 2010 at 8:50 PM, Scott Brooks <scott at beamdog.com> wrote:
> 200k messages, @ 300 bytes a piece is nothing.
>
> I just ran a test and everything is fine for me.
>
> Can you re-do the test? ?Also what are the specs on the server you are
> running the test on?
>
> Scott
>
>
> On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>> First of all thanks for the answers. Second I'll explain the situation
>> a little better.
>>
>> The big picture is like this: we receive orders from outside and they
>> are put in rabbit by our "gateway" and then routed by rabbit to the
>> processing modules. The whole business is about handling those
>> messages and if we are unable to receive messages from outside is very
>> bad so basically our gateway should be up all the time.
>>
>> Normally all the orders coming in should be handled smoothly BUT if
>> something happens to the consumers and they have a downtime the
>> producer has no way to stop the incoming messages. Also we always want
>> to be able to accept messages because we are payed for each incoming
>> message.
>>
>> Normally the system admin should handle the problem and restart the
>> consumers. As I was saying before, we are testing for the worst case
>> scenario, to see what the limits of RabbitMQ are. We want to see how
>> can we extend these limits to increase the time we have until the
>> queues get full.
>>
>> From our calculations if rabbitmq could hold 500k messages up to
>> 300bytes each we would be pretty safe as that would give us enough
>> time to react. The 200k limit is a little tight.
>>
>> ovidiu
>>
>>> @Ovidiu:
>>> BUT, are you really sure you want what you are asking for? If I understand
>>> you correctly you want to allow outside producers (not under your control)
>>> to send persistant messages directly into your RabbitMQ and not have those
>>> producers back off?
>>>
>>> Personally, I think that is not achievable. At some point your server ii>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> s
>>> going to reject messages, and your producers must be able to deal with that,
>>> if, as you say, no messages are allowed to be lost.
>>>
>>> Robby
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From ovidiudeac at gmail.com  Thu Jul 15 21:09:00 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Thu, 15 Jul 2010 23:09:00 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
Message-ID: <AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>

There is one thing though which is wrong: if a memory limit is given
rabbitmq should manage its memory such that it can continue working
properly but doesn't accept any more messages. If the memory limit is
above a certain level the queues should be closed and all the messages
published become unroutable.

This way it would accept connections which extract messages and thus
would free that memory.

On Thu, Jul 15, 2010 at 10:51 PM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
> I found the problem: the memory limit was the default one which is 1.6
> i.e. 40% out of 4GB. It seems the OS installed is 32bits and this is
> why erlang doesn't see the full 6GB RAM.
>
> Of course the system didn't work if it ran out of memory.
>
> As soon as I changed vm_memory_high_watermark to 0.98 by putting
> [{rabbit, [{vm_memory_high_watermark, 0.98}]}].
> ... in /etc/rabbitmq/rabbitmq.config the problem was fixed
>
> Thanks for the help.
>
> ovidiu
>
> On Thu, Jul 15, 2010 at 8:50 PM, Scott Brooks <scott at beamdog.com> wrote:
>> 200k messages, @ 300 bytes a piece is nothing.
>>
>> I just ran a test and everything is fine for me.
>>
>> Can you re-do the test? ?Also what are the specs on the server you are
>> running the test on?
>>
>> Scott
>>
>>
>> On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>>> First of all thanks for the answers. Second I'll explain the situation
>>> a little better.
>>>
>>> The big picture is like this: we receive orders from outside and they
>>> are put in rabbit by our "gateway" and then routed by rabbit to the
>>> processing modules. The whole business is about handling those
>>> messages and if we are unable to receive messages from outside is very
>>> bad so basically our gateway should be up all the time.
>>>
>>> Normally all the orders coming in should be handled smoothly BUT if
>>> something happens to the consumers and they have a downtime the
>>> producer has no way to stop the incoming messages. Also we always want
>>> to be able to accept messages because we are payed for each incoming
>>> message.
>>>
>>> Normally the system admin should handle the problem and restart the
>>> consumers. As I was saying before, we are testing for the worst case
>>> scenario, to see what the limits of RabbitMQ are. We want to see how
>>> can we extend these limits to increase the time we have until the
>>> queues get full.
>>>
>>> From our calculations if rabbitmq could hold 500k messages up to
>>> 300bytes each we would be pretty safe as that would give us enough
>>> time to react. The 200k limit is a little tight.
>>>
>>> ovidiu
>>>
>>>> @Ovidiu:
>>>> BUT, are you really sure you want what you are asking for? If I understand
>>>> you correctly you want to allow outside producers (not under your control)
>>>> to send persistant messages directly into your RabbitMQ and not have those
>>>> producers back off?
>>>>
>>>> Personally, I think that is not achievable. At some point your server ii>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> s
>>>> going to reject messages, and your producers must be able to deal with that,
>>>> if, as you say, no messages are allowed to be lost.
>>>>
>>>> Robby
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From darius.damalakas at gmail.com  Thu Jul 15 21:30:05 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Thu, 15 Jul 2010 23:30:05 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com> 
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com> 
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com> 
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com> 
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com> 
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com> 
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com> 
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com> 
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com> 
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com> 
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
Message-ID: <AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>

Thanks for telling the story.

By the way, how much messages can now RabbitMQ handle easily?

2010/7/15 Ovidiu Deac <ovidiudeac at gmail.com>

> There is one thing though which is wrong: if a memory limit is given
> rabbitmq should manage its memory such that it can continue working
> properly but doesn't accept any more messages. If the memory limit is
> above a certain level the queues should be closed and all the messages
> published become unroutable.
>
> This way it would accept connections which extract messages and thus
> would free that memory.
>
> On Thu, Jul 15, 2010 at 10:51 PM, Ovidiu Deac <ovidiudeac at gmail.com>
> wrote:
> > I found the problem: the memory limit was the default one which is 1.6
> > i.e. 40% out of 4GB. It seems the OS installed is 32bits and this is
> > why erlang doesn't see the full 6GB RAM.
> >
> > Of course the system didn't work if it ran out of memory.
> >
> > As soon as I changed vm_memory_high_watermark to 0.98 by putting
> > [{rabbit, [{vm_memory_high_watermark, 0.98}]}].
> > ... in /etc/rabbitmq/rabbitmq.config the problem was fixed
> >
> > Thanks for the help.
> >
> > ovidiu
> >
> > On Thu, Jul 15, 2010 at 8:50 PM, Scott Brooks <scott at beamdog.com> wrote:
> >> 200k messages, @ 300 bytes a piece is nothing.
> >>
> >> I just ran a test and everything is fine for me.
> >>
> >> Can you re-do the test?  Also what are the specs on the server you are
> >> running the test on?
> >>
> >> Scott
> >>
> >>
> >> On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac <ovidiudeac at gmail.com>
> wrote:
> >>> First of all thanks for the answers. Second I'll explain the situation
> >>> a little better.
> >>>
> >>> The big picture is like this: we receive orders from outside and they
> >>> are put in rabbit by our "gateway" and then routed by rabbit to the
> >>> processing modules. The whole business is about handling those
> >>> messages and if we are unable to receive messages from outside is very
> >>> bad so basically our gateway should be up all the time.
> >>>
> >>> Normally all the orders coming in should be handled smoothly BUT if
> >>> something happens to the consumers and they have a downtime the
> >>> producer has no way to stop the incoming messages. Also we always want
> >>> to be able to accept messages because we are payed for each incoming
> >>> message.
> >>>
> >>> Normally the system admin should handle the problem and restart the
> >>> consumers. As I was saying before, we are testing for the worst case
> >>> scenario, to see what the limits of RabbitMQ are. We want to see how
> >>> can we extend these limits to increase the time we have until the
> >>> queues get full.
> >>>
> >>> From our calculations if rabbitmq could hold 500k messages up to
> >>> 300bytes each we would be pretty safe as that would give us enough
> >>> time to react. The 200k limit is a little tight.
> >>>
> >>> ovidiu
> >>>
> >>>> @Ovidiu:
> >>>> BUT, are you really sure you want what you are asking for? If I
> understand
> >>>> you correctly you want to allow outside producers (not under your
> control)
> >>>> to send persistant messages directly into your RabbitMQ and not have
> those
> >>>> producers back off?
> >>>>
> >>>> Personally, I think that is not achievable. At some point your server
> ii>
> >>>>
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>>
> >>>>
> >>>
> >>> s
> >>>> going to reject messages, and your producers must be able to deal with
> that,
> >>>> if, as you say, no messages are allowed to be lost.
> >>>>
> >>>> Robby
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Link?jimai, Best Regards

Darius Damalakas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/ab67894d/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 15 22:23:26 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 15 Jul 2010 22:23:26 +0100
Subject: [rabbitmq-discuss] Get messages detail from queue
In-Reply-To: <3a17a0c6-020c-4275-bd68-4f918e20925d@g19g2000yqc.googlegroups.com>
References: <476162.94482.qm@web30704.mail.mud.yahoo.com>	<yrv4ctyo46y8g.fsf@dwragg.eng.vmware.com>
	<3a17a0c6-020c-4275-bd68-4f918e20925d@g19g2000yqc.googlegroups.com>
Message-ID: <4C3F7C4E.2000907@rabbitmq.com>

Dario,

dario_arg wrote:
> On Jul 12, 9:07 pm, David Wragg <da... at rabbitmq.com> wrote:
>> RabbitMQ does not currently provide any means to browse the messages
>> within a queue. [...]
 >
> Are you planning to include something like that in rabbitmq??

We have been thinking about queue browsing for a while, but it's 
actually quite hard to come up with a sensible semantics for it that 
isn't too constraining on implementations. We'll keep trying.


Regards,

Matthias.

From Dan.Wise at ignisasset.com  Thu Jul 15 23:33:11 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Thu, 15 Jul 2010 23:33:11 +0100
Subject: [rabbitmq-discuss] Authenticating users via SSPI
Message-ID: <20100715223314.C148814F87C@lists.rabbitmq.com>

Would I need a separate certificate for each user? Does peer certificate
verification bypass normal username and password checking?

 

Dan.

 

 

From: Mark Steele [mailto:msteele at beringmedia.com] 
Sent: 15 July 2010 14:52
To: Dan Wise
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Authenticating users via SSPI

 

You could use PKI and store the certificates in LDAP. Have your app use
the current credentials of the user to grab the certificate and connect
to rabbit over SSL with peer certificate verification enabled.


Mark Steele
Director of development
Bering Media Inc.




On Thu, Jul 15, 2010 at 5:53 AM, Dan Wise <Dan.Wise at ignisasset.com>
wrote:

Hi,

 

We have a number of Windows users who want to use our rabbitmq
messaging. However we need to ensure that we authenticate them without
them having to enter their Windows passwords and syncing with the
rabbitmq user passwords.

 

Has anyone looked at a mechanism for using SSPI authentication to allow
clients to connect? This is surely a common challenge, particularly in
an organisation where there are large numbers of users and the job of
providing and maintaining separate passwords for different systems is
hugs.

 

Thanks,

 

Dan Wise

 

 

**************************************************************

Visit our Website at http://www.ignisasset.com/ 
The information contained in this email (including any attachments
transmitted within it) is confidential and is intended solely for the
use of the named person. 
The unauthorised access, copying or re-use of the information in it by
any other person is strictly forbidden. 
If you are not the intended recipient please notify us immediately by
return email to postmaster at ignisasset.com.

Internet communication is not guaranteed to be timely, secure, error or
virus free. We accept no liability for any harm to systems or data, nor
for personal emails. Emails may be recalled, deleted and monitored.

Ignis Asset Management is the trading name of the Ignis Asset Management
Limited group of companies which includes the following subsidiary and
associated companies: Ignis Asset Management Limited (Registered in
Scotland No. SC200801), Ignis Investment Services Limited* (Registered
in Scotland No. SC101825) 
Ignis Fund Managers Limited* (Registered in Scotland No. SC85610)
Scottish Mutual Investment Managers Limited* (Registered in Scotland No.
SC88674) 
Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel:
0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited*
(Registered in England No. 971504)
Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and
Ignis Investment Management Limited* (Registered in England No. 5809046)

Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD.
Scottish Mutual is a registered trade mark of Scottish Mutual Assurance
Limited

*Authorised and regulated by the Financial Services Authority.

**************************************************************


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100715/0b3652a1/attachment-0001.htm>

From ovidiudeac at gmail.com  Thu Jul 15 23:42:06 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Fri, 16 Jul 2010 01:42:06 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
References: <AANLkTin04q33g2aIdGA-tlke3VkdhnSR-uMzHZ3N-mqO@mail.gmail.com>
	<AANLkTimWjgldWu_lTPkt0ZyJqU3TLO-KZmeQ0Ai81Yb0@mail.gmail.com>
	<AANLkTimsk2lMOdB3ca-em5OCK2B83737t0sq9BkQmEAh@mail.gmail.com>
	<AANLkTimJFYRxs8yVICzUYBcOPJzTB81aQVS_iBk4EEt8@mail.gmail.com>
	<AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
Message-ID: <AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>

With almost 4GB RAM available it can keep 1.3milion messages in one queue. I

On Thu, Jul 15, 2010 at 11:30 PM, Darius Damalakas
<darius.damalakas at gmail.com> wrote:
> Thanks for telling the story.
>
> By the way, how much messages can now RabbitMQ handle easily?
>
> 2010/7/15 Ovidiu Deac <ovidiudeac at gmail.com>
>>
>> There is one thing though which is wrong: if a memory limit is given
>> rabbitmq should manage its memory such that it can continue working
>> properly but doesn't accept any more messages. If the memory limit is
>> above a certain level the queues should be closed and all the messages
>> published become unroutable.
>>
>> This way it would accept connections which extract messages and thus
>> would free that memory.
>>
>> On Thu, Jul 15, 2010 at 10:51 PM, Ovidiu Deac <ovidiudeac at gmail.com>
>> wrote:
>> > I found the problem: the memory limit was the default one which is 1.6
>> > i.e. 40% out of 4GB. It seems the OS installed is 32bits and this is
>> > why erlang doesn't see the full 6GB RAM.
>> >
>> > Of course the system didn't work if it ran out of memory.
>> >
>> > As soon as I changed vm_memory_high_watermark to 0.98 by putting
>> > [{rabbit, [{vm_memory_high_watermark, 0.98}]}].
>> > ... in /etc/rabbitmq/rabbitmq.config the problem was fixed
>> >
>> > Thanks for the help.
>> >
>> > ovidiu
>> >
>> > On Thu, Jul 15, 2010 at 8:50 PM, Scott Brooks <scott at beamdog.com> wrote:
>> >> 200k messages, @ 300 bytes a piece is nothing.
>> >>
>> >> I just ran a test and everything is fine for me.
>> >>
>> >> Can you re-do the test? ?Also what are the specs on the server you are
>> >> running the test on?
>> >>
>> >> Scott
>> >>
>> >>
>> >> On Thu, Jul 15, 2010 at 11:33 AM, Ovidiu Deac <ovidiudeac at gmail.com>
>> >> wrote:
>> >>> First of all thanks for the answers. Second I'll explain the situation
>> >>> a little better.
>> >>>
>> >>> The big picture is like this: we receive orders from outside and they
>> >>> are put in rabbit by our "gateway" and then routed by rabbit to the
>> >>> processing modules. The whole business is about handling those
>> >>> messages and if we are unable to receive messages from outside is very
>> >>> bad so basically our gateway should be up all the time.
>> >>>
>> >>> Normally all the orders coming in should be handled smoothly BUT if
>> >>> something happens to the consumers and they have a downtime the
>> >>> producer has no way to stop the incoming messages. Also we always want
>> >>> to be able to accept messages because we are payed for each incoming
>> >>> message.
>> >>>
>> >>> Normally the system admin should handle the problem and restart the
>> >>> consumers. As I was saying before, we are testing for the worst case
>> >>> scenario, to see what the limits of RabbitMQ are. We want to see how
>> >>> can we extend these limits to increase the time we have until the
>> >>> queues get full.
>> >>>
>> >>> From our calculations if rabbitmq could hold 500k messages up to
>> >>> 300bytes each we would be pretty safe as that would give us enough
>> >>> time to react. The 200k limit is a little tight.
>> >>>
>> >>> ovidiu
>> >>>
>> >>>> @Ovidiu:
>> >>>> BUT, are you really sure you want what you are asking for? If I
>> >>>> understand
>> >>>> you correctly you want to allow outside producers (not under your
>> >>>> control)
>> >>>> to send persistant messages directly into your RabbitMQ and not have
>> >>>> those
>> >>>> producers back off?
>> >>>>
>> >>>> Personally, I think that is not achievable. At some point your server
>> >>>> ii>
>> >>>>
>> >>>> _______________________________________________
>> >>>> rabbitmq-discuss mailing list
>> >>>> rabbitmq-discuss at lists.rabbitmq.com
>> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>>
>> >>>>
>> >>>
>> >>> s
>> >>>> going to reject messages, and your producers must be able to deal
>> >>>> with that,
>> >>>> if, as you say, no messages are allowed to be lost.
>> >>>>
>> >>>> Robby
>> >>> _______________________________________________
>> >>> rabbitmq-discuss mailing list
>> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>
>> >>
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Link?jimai, Best Regards
>
> Darius Damalakas
>

From tonyg at rabbitmq.com  Fri Jul 16 06:15:32 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Fri, 16 Jul 2010 17:15:32 +1200
Subject: [rabbitmq-discuss] High Res Logo/Media
In-Reply-To: <AANLkTinB-2ad6ulXR_lF7vMZVi0gm78p4xlW-LqZt820@mail.gmail.com>
References: <AANLkTinJqS7Fpk0ZQ8nrew_Bnj8bI_8S-UpzbycZPEJd@mail.gmail.com>
	<AANLkTinB-2ad6ulXR_lF7vMZVi0gm78p4xlW-LqZt820@mail.gmail.com>
Message-ID: <4C3FEAF4.4010600@rabbitmq.com>

Alexis Richardson wrote:
> Is the attached hi res enough?

Wow, what happened to the kerning on the strapline?

Tony


From alexis at rabbitmq.com  Fri Jul 16 07:24:47 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 16 Jul 2010 07:24:47 +0100
Subject: [rabbitmq-discuss] High Res Logo/Media
In-Reply-To: <4C3FEAF4.4010600@rabbitmq.com>
References: <AANLkTinJqS7Fpk0ZQ8nrew_Bnj8bI_8S-UpzbycZPEJd@mail.gmail.com>
	<AANLkTinB-2ad6ulXR_lF7vMZVi0gm78p4xlW-LqZt820@mail.gmail.com>
	<4C3FEAF4.4010600@rabbitmq.com>
Message-ID: <AANLkTineHh7gCOXcIoK0OUo97uTqBMbD5-LOFTkyr0hM@mail.gmail.com>

On Fri, Jul 16, 2010 at 6:15 AM, Tony Garnock-Jones <tonyg at rabbitmq.com> wrote:
> Alexis Richardson wrote:
>> Is the attached hi res enough?
>
> Wow, what happened to the kerning on the strapline?

Hmm, now that you mention it, that could be better.

From sunkini at gmail.com  Fri Jul 16 07:28:40 2010
From: sunkini at gmail.com (Sunil Kini)
Date: Fri, 16 Jul 2010 11:58:40 +0530
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
Message-ID: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>

Hello,

I am new to AMQP and RabbitMQ. I am tying to understand RabbitMQ.
Does it support databases like MS SQL and MySQL? Whether C++/C library is
officially released on Linux/Windows?

Any pointers are greatly appreciated.

Thanks in advance,
Sunil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/db09df63/attachment.htm>

From jasonjwwilliams at gmail.com  Fri Jul 16 07:32:35 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 16 Jul 2010 00:32:35 -0600
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
In-Reply-To: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>
References: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>
Message-ID: <32403162-51D1-4603-8728-CA0620F4586D@gmail.com>

Hi Sunil,

RabbitMQ is a communication bus your software can use to communicate. What is your target use?

-J

Sent via iPhone

Is your e-mail Premiere?

On Jul 16, 2010, at 0:28, Sunil Kini <sunkini at gmail.com> wrote:

> Hello,
> 
> I am new to AMQP and RabbitMQ. I am tying to understand RabbitMQ. 
> Does it support databases like MS SQL and MySQL? Whether C++/C library is officially released on Linux/Windows?
> 
> Any pointers are greatly appreciated.
> 
> Thanks in advance,
> Sunil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sunkini at gmail.com  Fri Jul 16 07:45:35 2010
From: sunkini at gmail.com (Sunil Kini)
Date: Fri, 16 Jul 2010 12:15:35 +0530
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
In-Reply-To: <32403162-51D1-4603-8728-CA0620F4586D@gmail.com>
References: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>
	<32403162-51D1-4603-8728-CA0620F4586D@gmail.com>
Message-ID: <AANLkTin6bOvc1aQwbhIDxCdWgHstP_ihteJswnSjd7dx@mail.gmail.com>

Hi Jason,

I was trying to understand RabbitMQ. What I know is RabbitMQ uses Mnesia for
reliability and persistence. I wanted to know whether 3rd party databases
like MS SQL and MySQL can be used with RabbitMQ for reliability and
persistence? Or is it that Mnesia is the only database which RabbitMQ
supports?

Thanks,
Sunil




On Fri, Jul 16, 2010 at 12:02 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Hi Sunil,
>
> RabbitMQ is a communication bus your software can use to communicate. What
> is your target use?
>
> -J
>
> Sent via iPhone
>
> Is your e-mail Premiere?
>
> On Jul 16, 2010, at 0:28, Sunil Kini <sunkini at gmail.com> wrote:
>
> > Hello,
> >
> > I am new to AMQP and RabbitMQ. I am tying to understand RabbitMQ.
> > Does it support databases like MS SQL and MySQL? Whether C++/C library is
> officially released on Linux/Windows?
> >
> > Any pointers are greatly appreciated.
> >
> > Thanks in advance,
> > Sunil
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/79501c33/attachment.htm>

From alexis at rabbitmq.com  Fri Jul 16 07:50:51 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 16 Jul 2010 07:50:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
In-Reply-To: <AANLkTin6bOvc1aQwbhIDxCdWgHstP_ihteJswnSjd7dx@mail.gmail.com>
References: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>
	<32403162-51D1-4603-8728-CA0620F4586D@gmail.com>
	<AANLkTin6bOvc1aQwbhIDxCdWgHstP_ihteJswnSjd7dx@mail.gmail.com>
Message-ID: <AANLkTinprjUOe4JB5osHnlxMCogjQ-1s7umIM-BYIEwi@mail.gmail.com>

Sunil

RabbitMQ has never used Mnesia to persist messages.  It has its own
persistent message heap and txn journals.

However....

To answer your question: as of recently it is possible to use RabbitMQ
with "your database of choice".  There is an API for this.  It's a new
feature and consequently not yet well documented.  We would love to
see people experiment with it.  Are you interested?  It would involve
some erlang hacking ;-)

alexis




On Fri, Jul 16, 2010 at 7:45 AM, Sunil Kini <sunkini at gmail.com> wrote:
> Hi Jason,
>
> I was trying to understand RabbitMQ. What I know is RabbitMQ uses Mnesia for
> reliability and persistence. I wanted to know whether 3rd party databases
> like MS SQL and MySQL can be used with RabbitMQ for reliability and
> persistence? Or is it that Mnesia is the only database which RabbitMQ
> supports?
>
> Thanks,
> Sunil
>
>
>
>
> On Fri, Jul 16, 2010 at 12:02 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>>
>> Hi Sunil,
>>
>> RabbitMQ is a communication bus your software can use to communicate. What
>> is your target use?
>>
>> -J
>>
>> Sent via iPhone
>>
>> Is your e-mail Premiere?
>>
>> On Jul 16, 2010, at 0:28, Sunil Kini <sunkini at gmail.com> wrote:
>>
>> > Hello,
>> >
>> > I am new to AMQP and RabbitMQ. I am tying to understand RabbitMQ.
>> > Does it support databases like MS SQL and MySQL? Whether C++/C library
>> > is officially released on Linux/Windows?
>> >
>> > Any pointers are greatly appreciated.
>> >
>> > Thanks in advance,
>> > Sunil
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From darius.damalakas at gmail.com  Fri Jul 16 08:20:25 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Fri, 16 Jul 2010 10:20:25 +0300
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
In-Reply-To: <AANLkTinprjUOe4JB5osHnlxMCogjQ-1s7umIM-BYIEwi@mail.gmail.com>
References: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com> 
	<32403162-51D1-4603-8728-CA0620F4586D@gmail.com>
	<AANLkTin6bOvc1aQwbhIDxCdWgHstP_ihteJswnSjd7dx@mail.gmail.com> 
	<AANLkTinprjUOe4JB5osHnlxMCogjQ-1s7umIM-BYIEwi@mail.gmail.com>
Message-ID: <AANLkTimPuyqKSmck4q9RD1ixCFgIYM-gaIARACmTGMYX@mail.gmail.com>

> To answer your question: as of recently it is possible to use RabbitMQ
> with "your database of choice".  There is an API for this.  It's a new
> feature and consequently not yet well documented.
>
Nice news!
Did not know that.


Darius
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/14d7362f/attachment.htm>

From sunkini at gmail.com  Fri Jul 16 09:06:01 2010
From: sunkini at gmail.com (Sunil Kini)
Date: Fri, 16 Jul 2010 13:36:01 +0530
Subject: [rabbitmq-discuss] RabbitMQ with MS SQL and MySQL
In-Reply-To: <AANLkTimPuyqKSmck4q9RD1ixCFgIYM-gaIARACmTGMYX@mail.gmail.com>
References: <AANLkTikjH1AfYOADwG6Krs7e6muHtWjNd4uXcy9WE6rW@mail.gmail.com>
	<32403162-51D1-4603-8728-CA0620F4586D@gmail.com>
	<AANLkTin6bOvc1aQwbhIDxCdWgHstP_ihteJswnSjd7dx@mail.gmail.com>
	<AANLkTinprjUOe4JB5osHnlxMCogjQ-1s7umIM-BYIEwi@mail.gmail.com>
	<AANLkTimPuyqKSmck4q9RD1ixCFgIYM-gaIARACmTGMYX@mail.gmail.com>
Message-ID: <AANLkTikJdJeSDJ6LRR0LFqBwlczDEbdX5CCG7hnPqvmN@mail.gmail.com>

Thanks a lot for your quick responses :-)



On Fri, Jul 16, 2010 at 12:50 PM, Darius Damalakas <
darius.damalakas at gmail.com> wrote:

>
> To answer your question: as of recently it is possible to use RabbitMQ
>> with "your database of choice".  There is an API for this.  It's a new
>> feature and consequently not yet well documented.
>>
> Nice news!
> Did not know that.
>
>
> Darius
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/7492d687/attachment.htm>

From msteele at beringmedia.com  Fri Jul 16 13:44:06 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 16 Jul 2010 08:44:06 -0400
Subject: [rabbitmq-discuss] Authenticating users via SSPI
In-Reply-To: <4c3f8ca9.c3e9d80a.3f66.ffffededSMTPIN_ADDED@mx.google.com>
References: <4c3f8ca9.c3e9d80a.3f66.ffffededSMTPIN_ADDED@mx.google.com>
Message-ID: <AANLkTinxyDnxzK32h5jUuTZFUx-52KxxCmPBxA3eXK5n@mail.gmail.com>

Really depends on what your needs are.

You could have one cert per user, and use the same authentication
information in your rabbit cloud for all users. I just noticed however that
the erlang new_ssl implementation does not support CRLs, so you won't be
able to revoke a certificate and have that reflected by an authentication
failure on the rabbit server.

Wonder what the odds of adding CRL or OCSP support to rabbit are....There
was a thread about this in 2009:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004189.html

Both these functionalities are pretty trivial to implement using the openssl
library

So I guess my original suggestion doesn't fly as a good solution, sorry!

Cheers,

Mark Steele
Director of development
Bering Media Inc.



On Thu, Jul 15, 2010 at 6:33 PM, Dan Wise <Dan.Wise at ignisasset.com> wrote:

>  Would I need a separate certificate for each user? Does peer certificate
> verification bypass normal username and password checking?
>
>
>
> Dan.
>
>
>
>
>
> *From:* Mark Steele [mailto:msteele at beringmedia.com]
> *Sent:* 15 July 2010 14:52
> *To:* Dan Wise
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Authenticating users via SSPI
>
>
>
> You could use PKI and store the certificates in LDAP. Have your app use the
> current credentials of the user to grab the certificate and connect to
> rabbit over SSL with peer certificate verification enabled.
>
>
> Mark Steele
> Director of development
> Bering Media Inc.
>
>
>  On Thu, Jul 15, 2010 at 5:53 AM, Dan Wise <Dan.Wise at ignisasset.com>
> wrote:
>
> Hi,
>
>
>
> We have a number of Windows users who want to use our rabbitmq messaging.
> However we need to ensure that we authenticate them without them having to
> enter their Windows passwords and syncing with the rabbitmq user passwords.
>
>
>
> Has anyone looked at a mechanism for using SSPI authentication to allow
> clients to connect? This is surely a common challenge, particularly in an
> organisation where there are large numbers of users and the job of providing
> and maintaining separate passwords for different systems is hugs.
>
>
>
> Thanks,
>
>
>
> *Dan Wise*
>
> * *
>
>
>
> **************************************************************
>
> Visit our Website at http://www.ignisasset.com/
> The information contained in this email (including any attachments
> transmitted within it) is confidential and is intended solely for the use of
> the named person.
> The unauthorised access, copying or re-use of the information in it by any
> other person is strictly forbidden.
> If you are not the intended recipient please notify us immediately by
> return email to postmaster at ignisasset.com.
>
> Internet communication is not guaranteed to be timely, secure, error or
> virus free. We accept no liability for any harm to systems or data, nor for
> personal emails. Emails may be recalled, deleted and monitored.
>
> Ignis Asset Management is the trading name of the Ignis Asset Management
> Limited group of companies which includes the following subsidiary and
> associated companies: Ignis Asset Management Limited (Registered in Scotland
> No. SC200801), Ignis Investment Services Limited* (Registered in Scotland
> No. SC101825)
> Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish
> Mutual Investment Managers Limited* (Registered in Scotland No. SC88674)
> Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000
> and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No.
> 971504)
> Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and
> Ignis Investment Management Limited* (Registered in England No. 5809046)
> Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD.
> Scottish Mutual is a registered trade mark of Scottish Mutual Assurance
> Limited
>
> *Authorised and regulated by the Financial Services Authority.
>
> **************************************************************
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/b78cd453/attachment.htm>

From Dan.Wise at ignisasset.com  Fri Jul 16 15:05:07 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Fri, 16 Jul 2010 15:05:07 +0100
Subject: [rabbitmq-discuss] Authenticating users via SSPI
Message-ID: <20100716140513.99F2214F8EB@lists.rabbitmq.com>

Yes, this confirms the issue I was worrying about. 

 

I think it would be very valuable to add NTLM authentication to Rabbit
on Windows, so that only a username could be supplied on the client and
the authentication verified on the server, without the need to pass
clear-text passwords or per-user SSL certificates. This would really
enhance the commercial attractiveness of Rabbit.

 

Anyone want to take up the challenge?

 

Dan.

 

 

From: Mark Steele [mailto:msteele at beringmedia.com] 
Sent: 16 July 2010 13:44
To: Dan Wise
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Authenticating users via SSPI

 

Really depends on what your needs are.

 

You could have one cert per user, and use the same authentication
information in your rabbit cloud for all users. I just noticed however
that the erlang new_ssl implementation does not support CRLs, so you
won't be able to revoke a certificate and have that reflected by an
authentication failure on the rabbit server.

 

Wonder what the odds of adding CRL or OCSP support to rabbit
are....There was a thread about this in 2009:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004189.ht
ml

 

Both these functionalities are pretty trivial to implement using the
openssl library

 

So I guess my original suggestion doesn't fly as a good solution, sorry!

 

Cheers,


Mark Steele
Director of development
Bering Media Inc.




On Thu, Jul 15, 2010 at 6:33 PM, Dan Wise <Dan.Wise at ignisasset.com>
wrote:

Would I need a separate certificate for each user? Does peer certificate
verification bypass normal username and password checking?

 

Dan.

 

 

From: Mark Steele [mailto:msteele at beringmedia.com] 
Sent: 15 July 2010 14:52
To: Dan Wise
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Authenticating users via SSPI

 

You could use PKI and store the certificates in LDAP. Have your app use
the current credentials of the user to grab the certificate and connect
to rabbit over SSL with peer certificate verification enabled.


Mark Steele
Director of development
Bering Media Inc.



On Thu, Jul 15, 2010 at 5:53 AM, Dan Wise <Dan.Wise at ignisasset.com>
wrote:

Hi,

 

We have a number of Windows users who want to use our rabbitmq
messaging. However we need to ensure that we authenticate them without
them having to enter their Windows passwords and syncing with the
rabbitmq user passwords.

 

Has anyone looked at a mechanism for using SSPI authentication to allow
clients to connect? This is surely a common challenge, particularly in
an organisation where there are large numbers of users and the job of
providing and maintaining separate passwords for different systems is
hugs.

 

Thanks,

 

Dan Wise

 

 

**************************************************************

Visit our Website at http://www.ignisasset.com/ 
The information contained in this email (including any attachments
transmitted within it) is confidential and is intended solely for the
use of the named person. 
The unauthorised access, copying or re-use of the information in it by
any other person is strictly forbidden. 
If you are not the intended recipient please notify us immediately by
return email to postmaster at ignisasset.com.

Internet communication is not guaranteed to be timely, secure, error or
virus free. We accept no liability for any harm to systems or data, nor
for personal emails. Emails may be recalled, deleted and monitored.

Ignis Asset Management is the trading name of the Ignis Asset Management
Limited group of companies which includes the following subsidiary and
associated companies: Ignis Asset Management Limited (Registered in
Scotland No. SC200801), Ignis Investment Services Limited* (Registered
in Scotland No. SC101825) 
Ignis Fund Managers Limited* (Registered in Scotland No. SC85610)
Scottish Mutual Investment Managers Limited* (Registered in Scotland No.
SC88674) 
Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel:
0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited*
(Registered in England No. 971504)
Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and
Ignis Investment Management Limited* (Registered in England No. 5809046)

Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD.
Scottish Mutual is a registered trade mark of Scottish Mutual Assurance
Limited

*Authorised and regulated by the Financial Services Authority.

**************************************************************


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/16344da3/attachment-0001.htm>

From rlotun at gmail.com  Fri Jul 16 15:40:01 2010
From: rlotun at gmail.com (Reza Lotun)
Date: Fri, 16 Jul 2010 15:40:01 +0100
Subject: [rabbitmq-discuss] Using init.d vs upstart script on EC2 image
Message-ID: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>

Hi All,

I currently have a RabbitMQ node deployed on EC2. I used your 64-bit
image from here:
http://www.rabbitmq.com/ec2.html

The default setup for this image works. However, I noticed that the
config scripts use a standard /etc/init.d init script. Since you're on
ubuntu, I'd suggest using an upstart (http://upstart.ubuntu.com)
config - mainly because it allows respawning processes. So, if the
queue broker dies for whatever reason, upstart can be configured to
automatically restart it.

A simple example config:

---
description "RabbitMQ Server"
author  "RabbitMQ"

start on runlevel 2
start on runlevel 3

stop on runlevel 0
stop on runlevel 1
stop on runlevel 4
stop on runlevel 5
stop on runlevel 6

exec /usr/sbin/rabbitmq-multi start_all 1 >
/var/log/rabbitmq/startup_log 2> /var/log/rabbitmq/startup_err
respawn
----

And then to use it:

cp rabbitmq-server.conf /etc/init
sudo initctl reload-configuration
sudo start rabbitmq-server

Has anyone else done something similar?

Cheers,
Reza

-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:? rlotun at gmail.com
work:?? reza at tweetdeck.com
twitter: @rlotun

From majek04 at gmail.com  Fri Jul 16 16:55:49 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Jul 2010 16:55:49 +0100
Subject: [rabbitmq-discuss] Using init.d vs upstart script on EC2 image
In-Reply-To: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>
References: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>
Message-ID: <AANLkTimWDKgM45_03tJd10UhrjNLTPzR2U8JAVfa1gDt@mail.gmail.com>

Thanks for suggestion.

Do you think our main ubuntu package should also use upstart,
or is it only relevant for EC2?

Is it compatible with debian?

Cheers,
  Marek

On Fri, Jul 16, 2010 at 15:40, Reza Lotun <rlotun at gmail.com> wrote:
> Hi All,
>
> I currently have a RabbitMQ node deployed on EC2. I used your 64-bit
> image from here:
> http://www.rabbitmq.com/ec2.html
>
> The default setup for this image works. However, I noticed that the
> config scripts use a standard /etc/init.d init script. Since you're on
> ubuntu, I'd suggest using an upstart (http://upstart.ubuntu.com)
> config - mainly because it allows respawning processes. So, if the
> queue broker dies for whatever reason, upstart can be configured to
> automatically restart it.
>
> A simple example config:
>
> ---
> description "RabbitMQ Server"
> author ?"RabbitMQ"
>
> start on runlevel 2
> start on runlevel 3
>
> stop on runlevel 0
> stop on runlevel 1
> stop on runlevel 4
> stop on runlevel 5
> stop on runlevel 6
>
> exec /usr/sbin/rabbitmq-multi start_all 1 >
> /var/log/rabbitmq/startup_log 2> /var/log/rabbitmq/startup_err
> respawn
> ----
>
> And then to use it:
>
> cp rabbitmq-server.conf /etc/init
> sudo initctl reload-configuration
> sudo start rabbitmq-server
>
> Has anyone else done something similar?

From rlotun at gmail.com  Fri Jul 16 17:05:07 2010
From: rlotun at gmail.com (Reza Lotun)
Date: Fri, 16 Jul 2010 17:05:07 +0100
Subject: [rabbitmq-discuss] Using init.d vs upstart script on EC2 image
In-Reply-To: <AANLkTimWDKgM45_03tJd10UhrjNLTPzR2U8JAVfa1gDt@mail.gmail.com>
References: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>
	<AANLkTimWDKgM45_03tJd10UhrjNLTPzR2U8JAVfa1gDt@mail.gmail.com>
Message-ID: <AANLkTin8LZsJUkumvfevPK84y5VPHgkuk-lC3ak4P7V0@mail.gmail.com>

Hi Marek,

> Do you think our main ubuntu package should also use upstart,
> or is it only relevant for EC2?

I don't see any reason why not. Whether it's EC2 or your laptop,
process respawning (and all the other advantages of upstart) would be
useful.

> Is it compatible with debian?

I believe debian is planning on switching to upstart
(http://lwn.net/Articles/351013/) - or at least they were as of
September 2009. I don't know what the current status is though.

Thanks,
Reza


-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:? rlotun at gmail.com
work:?? reza at tweetdeck.com
twitter: @rlotun

From majek04 at gmail.com  Fri Jul 16 17:22:19 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Jul 2010 17:22:19 +0100
Subject: [rabbitmq-discuss] Using init.d vs upstart script on EC2 image
In-Reply-To: <AANLkTin8LZsJUkumvfevPK84y5VPHgkuk-lC3ak4P7V0@mail.gmail.com>
References: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>
	<AANLkTimWDKgM45_03tJd10UhrjNLTPzR2U8JAVfa1gDt@mail.gmail.com>
	<AANLkTin8LZsJUkumvfevPK84y5VPHgkuk-lC3ak4P7V0@mail.gmail.com>
Message-ID: <AANLkTikv-UURZTOVh8y6DaKJTwAvvXly2eEkIv1gYOxG@mail.gmail.com>

On Fri, Jul 16, 2010 at 17:05, Reza Lotun <rlotun at gmail.com> wrote:
>> Do you think our main ubuntu package should also use upstart,
>> or is it only relevant for EC2?
>
> I don't see any reason why not. Whether it's EC2 or your laptop,
> process respawning (and all the other advantages of upstart) would be
> useful.
>
>> Is it compatible with debian?
>
> I believe debian is planning on switching to upstart
> (http://lwn.net/Articles/351013/) - or at least they were as of
> September 2009. I don't know what the current status is though.

Great. I created a bug for that. We still want to have a single .deb package
for both debian and ubuntu, and supporting two different start mechanisms
(upstart vs init) might be troublesome. But we'll do whatever possible.

Thanks again.

Marek

From msteele at beringmedia.com  Fri Jul 16 18:08:32 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 16 Jul 2010 13:08:32 -0400
Subject: [rabbitmq-discuss] Authenticating users via SSPI
In-Reply-To: <4c406717.8becd80a.720b.3bf5SMTPIN_ADDED@mx.google.com>
References: <4c406717.8becd80a.720b.3bf5SMTPIN_ADDED@mx.google.com>
Message-ID: <AANLkTinLKj4DrRilK7aDYSAGSVsEol84DjImn0bE4uhB@mail.gmail.com>

Personally I feel using PKI is a much better solution than any proprietary
windows protocol. I would also guess that the majority of users using rabbit
are using it in unix environments at this point.

The certificate based authentication works like a charm, just need to update
it to support the full gamut of PKI functionality. From a security
standpoint, it's much better to encrypt the communication channel.

Mark Steele
Director of development
Bering Media Inc.



On Fri, Jul 16, 2010 at 10:05 AM, Dan Wise <Dan.Wise at ignisasset.com> wrote:

>  Yes, this confirms the issue I was worrying about.
>
>
>
> I think it would be very valuable to add NTLM authentication to Rabbit on
> Windows, so that only a username could be supplied on the client and the
> authentication verified on the server, without the need to pass clear-text
> passwords or per-user SSL certificates. This would really enhance the
> commercial attractiveness of Rabbit.
>
>
>
> Anyone want to take up the challenge?
>
>
>
> Dan.
>
>
>
>
>
> *From:* Mark Steele [mailto:msteele at beringmedia.com]
> *Sent:* 16 July 2010 13:44
>
> *To:* Dan Wise
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Authenticating users via SSPI
>
>
>
> Really depends on what your needs are.
>
>
>
> You could have one cert per user, and use the same authentication
> information in your rabbit cloud for all users. I just noticed however that
> the erlang new_ssl implementation does not support CRLs, so you won't be
> able to revoke a certificate and have that reflected by an authentication
> failure on the rabbit server.
>
>
>
> Wonder what the odds of adding CRL or OCSP support to rabbit are....There
> was a thread about this in 2009:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-July/004189.html
>
>
>
> Both these functionalities are pretty trivial to implement using the
> openssl library
>
>
>
> So I guess my original suggestion doesn't fly as a good solution, sorry!
>
>
>
> Cheers,
>
>
> Mark Steele
> Director of development
> Bering Media Inc.
>
>
>  On Thu, Jul 15, 2010 at 6:33 PM, Dan Wise <Dan.Wise at ignisasset.com>
> wrote:
>
> Would I need a separate certificate for each user? Does peer certificate
> verification bypass normal username and password checking?
>
>
>
> Dan.
>
>
>
>
>
> *From:* Mark Steele [mailto:msteele at beringmedia.com]
> *Sent:* 15 July 2010 14:52
> *To:* Dan Wise
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Authenticating users via SSPI
>
>
>
> You could use PKI and store the certificates in LDAP. Have your app use the
> current credentials of the user to grab the certificate and connect to
> rabbit over SSL with peer certificate verification enabled.
>
>
> Mark Steele
> Director of development
> Bering Media Inc.
>
>   On Thu, Jul 15, 2010 at 5:53 AM, Dan Wise <Dan.Wise at ignisasset.com>
> wrote:
>
> Hi,
>
>
>
> We have a number of Windows users who want to use our rabbitmq messaging.
> However we need to ensure that we authenticate them without them having to
> enter their Windows passwords and syncing with the rabbitmq user passwords.
>
>
>
> Has anyone looked at a mechanism for using SSPI authentication to allow
> clients to connect? This is surely a common challenge, particularly in an
> organisation where there are large numbers of users and the job of providing
> and maintaining separate passwords for different systems is hugs.
>
>
>
> Thanks,
>
>
>
> *Dan Wise*
>
> * *
>
>
>
> **************************************************************
>
> Visit our Website at http://www.ignisasset.com/
> The information contained in this email (including any attachments
> transmitted within it) is confidential and is intended solely for the use of
> the named person.
> The unauthorised access, copying or re-use of the information in it by any
> other person is strictly forbidden.
> If you are not the intended recipient please notify us immediately by
> return email to postmaster at ignisasset.com.
>
> Internet communication is not guaranteed to be timely, secure, error or
> virus free. We accept no liability for any harm to systems or data, nor for
> personal emails. Emails may be recalled, deleted and monitored.
>
> Ignis Asset Management is the trading name of the Ignis Asset Management
> Limited group of companies which includes the following subsidiary and
> associated companies: Ignis Asset Management Limited (Registered in Scotland
> No. SC200801), Ignis Investment Services Limited* (Registered in Scotland
> No. SC101825)
> Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish
> Mutual Investment Managers Limited* (Registered in Scotland No. SC88674)
> Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000
> and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No.
> 971504)
> Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and
> Ignis Investment Management Limited* (Registered in England No. 5809046)
> Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD.
> Scottish Mutual is a registered trade mark of Scottish Mutual Assurance
> Limited
>
> *Authorised and regulated by the Financial Services Authority.
>
> **************************************************************
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100716/3e6312d5/attachment-0001.htm>

From rgh at topikality.com  Sat Jul 17 05:33:20 2010
From: rgh at topikality.com (Richard Heycock)
Date: Sat, 17 Jul 2010 14:33:20 +1000
Subject: [rabbitmq-discuss] Using init.d vs upstart script on EC2 image
In-Reply-To: <AANLkTikv-UURZTOVh8y6DaKJTwAvvXly2eEkIv1gYOxG@mail.gmail.com>
References: <AANLkTinP0JklIVhHJJUDgCStNbN5VQ04l-QumK8Wqveh@mail.gmail.com>
	<AANLkTimWDKgM45_03tJd10UhrjNLTPzR2U8JAVfa1gDt@mail.gmail.com>
	<AANLkTin8LZsJUkumvfevPK84y5VPHgkuk-lC3ak4P7V0@mail.gmail.com>
	<AANLkTikv-UURZTOVh8y6DaKJTwAvvXly2eEkIv1gYOxG@mail.gmail.com>
Message-ID: <1279340190-sup-4487@roughage.com.au>

Excerpts from Marek Majkowski's message of 2010-07-17 02:22:19 +1000:
> On Fri, Jul 16, 2010 at 17:05, Reza Lotun <rlotun at gmail.com> wrote:
> >> Do you think our main ubuntu package should also use upstart,
> >> or is it only relevant for EC2?
> >
> > I don't see any reason why not. Whether it's EC2 or your laptop,
> > process respawning (and all the other advantages of upstart) would be
> > useful.
> >
> >> Is it compatible with debian?
> >
> > I believe debian is planning on switching to upstart
> > (http://lwn.net/Articles/351013/) - or at least they were as of
> > September 2009. I don't know what the current status is though.
> 
> Great. I created a bug for that. We still want to have a single .deb package
> for both debian and ubuntu, and supporting two different start mechanisms
> (upstart vs init) might be troublesome. But we'll do whatever possible.
> 
> Thanks again.
> 
> Marek

I'm not sure it's a good idea re. Debian at the moment as whilst they
have announced that they intend to move to upstart work is moving very
slowly and is not looking likely any time soon; certainly not for
Squeeze.

In addition to this there is a fair amount of noise about systemd and
there is a bit of push by some for it to become the Debian standard
though it is no means clear at this stage which way they will go.

A couple of urls.

  The original (and long) announcement:
      http://0pointer.de/blog/projects/systemd.html

  A shorter LWN article with lots of (good) comments:
  http://lwn.net/Articles/389149/

rgh
-- 
Richard Heycock

http://topikality.com

+61 (0) 410 646 369
[e]:  rgh at topikality.com
[im]: rgh at topikality.com

From thesoftwaresimplist at udidahan.com  Sat Jul 17 16:19:41 2010
From: thesoftwaresimplist at udidahan.com (Udi Dahan)
Date: Sat, 17 Jul 2010 08:19:41 -0700
Subject: [rabbitmq-discuss] Integrating NServiceBus and RabbitMQ
Message-ID: <008b01cb25c3$7b96c540$72c44fc0$@com>

I've been hearing from many of my clients of the desire to use NServiceBus
(an open source .NET service bus) on Linux by using Mono.

The thing missing is that MSMQ (the default transport used by NServiceBus)
isn't available on Linux (duh :-) )

 

In terms of high availability and transactional support, I think that
RabbitMQ is the best option for enabling the above.

The thing is if there are certain APIs that should (or should not) be used
for working with RabbitMQ in "federated mode" - no central broker. Also, is
there anything special that needs to be done to flow transactions from the
application level into RabbitMQ and enlisting it into distributed
transactions?

 

With thanks,

 

-- 

Udi Dahan - The Software Simplist

Enterprise Development Expert & SOA Specialist

 

 <mailto:email at UdiDahan.com> email at UdiDahan.com
<http://www.udidahan.com/> http://www.UdiDahan.com

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100717/f01e41db/attachment.htm>

From clegnitto at mozilla.com  Sat Jul 17 22:54:11 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Sat, 17 Jul 2010 14:54:11 -0700
Subject: [rabbitmq-discuss] Having some issues with RabbitMQ
Message-ID: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>

Hey guys, I'm having some issues with RabbitMQ. It may just be me, my setup, may be real bugs, etc. Not sure and I would appreciate any help. I've wrote a more in-depth description here:

http://bit.ly/9P3IEX

In a nutshell:

	1. I need to have a lot (100's?) of queues with a lot (10,000s?) of messages that may not be consumed in a timely manner.. this (obviously) falls down with the current persister
	2. I need to have a read-only user, but one that can potentially create queues it cares about for topic exchanes. This seemed to work in 1.7, doesn't in 1.8
	3. The new persister doesn't seem to solve #1, but perhaps I didn't configure it correctly (I didn't configure anything when using the branch other than the BQL user/pass)

I'm really excited about RabbitMQ and hope it can work for me!

Thanks,
Christian

From matthew at rabbitmq.com  Sun Jul 18 00:14:50 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 18 Jul 2010 00:14:50 +0100
Subject: [rabbitmq-discuss] Having some issues with RabbitMQ
In-Reply-To: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>
References: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>
Message-ID: <20100717231449.GA11469@wellquite.org>

Hi Christian,

On Sat, Jul 17, 2010 at 02:54:11PM -0700, Christian Legnitto wrote:
> http://bit.ly/9P3IEX

I replied on your blog with (mostly) the following, but it's easier to
keep the discussion on the mailing list.

The new persister branch is regularly merged into from the current
default branch. Whilst it is correct to say it is currently based off
the 1.8 release, that?s only true in the sense of the above. The new
persister stores messages in a completely different format from the old,
and there is currently no tool to allow upgrading from a released
version of Rabbit to the new persister without losing persistent
messages.

The issue you ran into when going 1.7 to 1.8 is subtly different. Whilst
both use the old persister, both the on-disk format of the messages when
they are written to disk, and a database schema changed, again,
resulting in no state-maintaining upgrade path. To date we have never
produced a tool which can do upgrades maintaining state when database
schema or on-disk formats have changed.

You talk about users creating queues. I think that what you want is for
all users to use queues which have server-generated names, thus you
guarantee they are private, and you want to declare them ?exclusive?,
which means that when the connection that created the queue disappears,
the queue itself (and any bindings to the queue) also automatically get
deleted.

I quote this text from
http://www.rabbitmq.com/admin-guide.html#access-control:

?Some AMQP operations can create resources with server-generated names.
Every user has configure, write and read permissions for such resources.
However, the names are strong and not discoverable as part of the
protocol, only through management functionality. Therefore these
resources are in effect private to the user unless they choose to
dilvuge their names to other users.?

Thus I think that if you force users to create server-named queues, you
don?t need to grant any write privileges to your public user. It?ll need
read access to the exchange to create the binding, and it should
automatically have write access to create the binding to the private
queues. If this doesn?t work please let us know.

The 1.8 semantic changes concern what happens when you *re*declare a
queue. Previously, if the queue already existed and you redeclare it,
but with different attributes, it would still come back with an OK
result. This is misleading because it could lead the user to think that
a queue had been created with the specified attributes when in fact it
has not. Thus now, you must ensure you redeclare with the same
attributes as created the queue otherwise the redeclaration will fail
and close the channel. Full details can be found in the lower half of
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2010-June/000025.html

I am very curious about you managing to get the new persister to crash.
Could you provide the rabbit logs (or the end of the logs) which should
show some sort of stack trace? The new persister just *should not*
crash.

One thing that might be happening is that Rabbit is raising flow
control, to request that publishers stop sending further messages to
Rabbit ? even with the new persister this can happen sometimes to allow
disks to catch up, but this tends to only be necessary at high data
rates. The client must respond with a flow_ok message to the broker to
confirm it understands the flow control, and it must then not send any
further messages ? this is usually handled by the AMQP client library as
it just makes any subsequent publishes block ? until it receives a
further flow control message from the broker, informing it it can
resume. Now I notice you?re using a python client, and they have
historically not supported flow control, which can lead to Rabbit
forcibly disconnecting clients that do not respond appropriately to the
flow control messages. This may crash a badly written client, but it
should not crash the broker itself.

You have a very interesting use case, and there is absolutely nothing
about it that shouldn?t work perfectly well with RabbitMQ.

Best wishes,

Matthew

From clegnitto at mozilla.com  Sun Jul 18 01:31:45 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Sat, 17 Jul 2010 17:31:45 -0700
Subject: [rabbitmq-discuss] Having some issues with RabbitMQ
In-Reply-To: <20100717231449.GA11469@wellquite.org>
References: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>
	<20100717231449.GA11469@wellquite.org>
Message-ID: <4905999B-B266-4350-B431-C329CBBFE62A@mozilla.com>

Thanks Matthew, comments inline.

On Jul 17, 2010, at 4:14 PM, Matthew Sackman wrote:

> Hi Christian,
> 
> On Sat, Jul 17, 2010 at 02:54:11PM -0700, Christian Legnitto wrote:
>> http://bit.ly/9P3IEX
> 
> I replied on your blog with (mostly) the following, but it's easier to
> keep the discussion on the mailing list.
> 
> The new persister branch is regularly merged into from the current
> default branch. Whilst it is correct to say it is currently based off
> the 1.8 release, that?s only true in the sense of the above. The new
> persister stores messages in a completely different format from the old,
> and there is currently no tool to allow upgrading from a released
> version of Rabbit to the new persister without losing persistent
> messages.
> 
> The issue you ran into when going 1.7 to 1.8 is subtly different. Whilst
> both use the old persister, both the on-disk format of the messages when
> they are written to disk, and a database schema changed, again,
> resulting in no state-maintaining upgrade path. To date we have never
> produced a tool which can do upgrades maintaining state when database
> schema or on-disk formats have changed.

Right, I understand this. I eventually made sure to delete the entire /var/db/rabbitmq (?) directory when changing versions...I didn't care about the messages in there anyway. I'm saying even after clearing out the data it didn't seem to be using the new persister (or, the broker behavior looked the same).


> You talk about users creating queues. I think that what you want is for
> all users to use queues which have server-generated names, thus you
> guarantee they are private, and you want to declare them ?exclusive?,
> which means that when the connection that created the queue disappears,
> the queue itself (and any bindings to the queue) also automatically get
> deleted.
> 
> I quote this text from
> http://www.rabbitmq.com/admin-guide.html#access-control:
> 
> ?Some AMQP operations can create resources with server-generated names.
> Every user has configure, write and read permissions for such resources.
> However, the names are strong and not discoverable as part of the
> protocol, only through management functionality. Therefore these
> resources are in effect private to the user unless they choose to
> dilvuge their names to other users.?
> 
> Thus I think that if you force users to create server-named queues, you
> don?t need to grant any write privileges to your public user. It?ll need
> read access to the exchange to create the binding, and it should
> automatically have write access to create the binding to the private
> queues. If this doesn?t work please let us know.


I saw that and I'm not sure that is what I want. There will be users creating queues with scripts running locally on laptops and such. With your suggestion I believe this would happen:

	1. User has a local script "foo.py" running on a laptop, which connects ("connection1"), gets a queue with a server-defined name (call it "queue1") and reads messages
	2. User goes to a meeting and the laptop sleeps, causing RabbitMQ to close connection1
	3. User comes back, foo.py is running but has thrown an exception (or perhaps is listening on a dead connection, not sure what happens here)
	4. User restarts foo.py, getting a new connection ("connection2") to a new server-generated queue ("queue2")
	5. All messages sent between the closing of connection1 and creation of connection2 never make it into queue2, so foo.py possibly missed a bunch of messages

If I am mistaken, please correct me..this is all new :-)

What I want:

	1. User has a local script "foo.py" running on a laptop, which connects ("connection1"), gets a queue with a a script-defined unique name (call it "queue1") and reads messages
	2. User goes to a meeting and the laptop sleeps, causing RabbitMQ to close connection1
	3. User comes back, foo.py is running but has thrown an exception (or perhaps is listening on a dead connection, not sure what happens here)
	4. User restarts foo.py, getting a new connection ("connection2") and connecting to the existing queue1, which has been queueing messages while connection1 has been closed
	5. foo.py can choose to empty queue1 before processing (if it is the sort of script that doesn't maintain state) or can choose to process the "old" messages

So, if the server takes care of creating the queue, there is no way for the client to tell it to reconnect when it comes back (and no queue will be there anyway as the server has cleared it). Creating a named queue takes write permission, correct? If so that means my public user could send (possibly nefarious) messages in for others to consume, correct? Is this use-case a non-starter with the current permissions system? Like I said, this appeared to work with 1.7 with read-only access for the public user.


> The 1.8 semantic changes concern what happens when you *re*declare a
> queue. Previously, if the queue already existed and you redeclare it,
> but with different attributes, it would still come back with an OK
> result. This is misleading because it could lead the user to think that
> a queue had been created with the specified attributes when in fact it
> has not. Thus now, you must ensure you redeclare with the same
> attributes as created the queue otherwise the redeclaration will fail
> and close the channel. Full details can be found in the lower half of
> http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2010-June/000025.html

Ok, I was aware of this because I had hit it in testing :-). I guess before it would silently just use the previous/first declaration and now it returns an error? This is fine, as my usecase is there are no changes between connection1 and connection2 above (of course they could change the attributes and name it something else if needed)

> 
> I am very curious about you managing to get the new persister to crash.
> Could you provide the rabbit logs (or the end of the logs) which should
> show some sort of stack trace? The new persister just *should not*
> crash.

It doesn't actually crash (bad choice of words on my part). The whole server is hung from the standpoint of any client I can use (python mainly). The BQL client won't even connect or give me a prompt at that point, it just hangs. amqp-utils (ruby, but may use the same lib as python) hangs and doesn't let me do anything. I end up stopping the server, clearing the data directory, and restarting it (which clearly wouldn't work in production). FWIW I got the same behavior with the old persister, which is why I thought I perhaps wasn't turning the new one on even though I am using the branch.


> One thing that might be happening is that Rabbit is raising flow
> control, to request that publishers stop sending further messages to
> Rabbit ? even with the new persister this can happen sometimes to allow
> disks to catch up, but this tends to only be necessary at high data
> rates. The client must respond with a flow_ok message to the broker to
> confirm it understands the flow control, and it must then not send any
> further messages ? this is usually handled by the AMQP client library as
> it just makes any subsequent publishes block ? until it receives a
> further flow control message from the broker, informing it it can
> resume. Now I notice you?re using a python client, and they have
> historically not supported flow control, which can lead to Rabbit
> forcibly disconnecting clients that do not respond appropriately to the
> flow control messages. This may crash a badly written client, but it
> should not crash the broker itself.

Yeah, I saw that flow control is generally not supported by the python libs (though I see http://gist.github.com/399282), but I'm not sure I would have hit it with ~30 msgs per second going to 10 queues.
The fact that the BQL plugin stopped working was suspect. I'm not sure how that's written though, but I assumed it used the erlang client and would allow me to clear queues and get everything unblocked. So even though it isn't a crash, the behavior is the same....I can't read anything, publish anything, or clear queues to unblock, via carrot (python), amqp-utils (ruby), and the BQL plugin (erlang I guess). Perhaps all the libs I am using to interact with the broker barf with flow control?

I also notice the status plugin says "memory (used/available) = 1498MB / 810MB" with the new persister...is that expected? I thought that it would always stay under the max and just flush to disk. Is my VM too wimpy?


> You have a very interesting use case, and there is absolutely nothing
> about it that shouldn?t work perfectly well with RabbitMQ.

Whew, that's good to hear. There may be some administration-type stuff that moves us off Rabbit, but I am enjoying working with it on the prototype system in the meantime and would love to get it solid for us.

Thanks again for the quick and detailed reply!

Christian

From alex.lovelltroy at gmail.com  Sun Jul 18 09:53:22 2010
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Sun, 18 Jul 2010 09:53:22 +0100
Subject: [rabbitmq-discuss] the new persister and mnesia replication
Message-ID: <AANLkTillgLm11GVf6Hp5uGcEUtb9OGfT1x4SY5Fha1Tr@mail.gmail.com>

I'm interested in using rabbitmq for guaranteed delivery rather than
speed.  Disk persistence through durable queues isn't enough because
messages can still be lost in the case of disk/host death.  But,
rabbitmq already uses mnesia for the durable message store and mnesia
is replicable.  Has anyone done anything with the current persistence
engine or the new persister to take advantage of mnesia replication to
replicate persistent messages on durable queues across multiple mnesia
nodes?  If not, is that a crazy thing to do in a low message volume
situation?

-alex

From matthew at rabbitmq.com  Sun Jul 18 10:43:25 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 18 Jul 2010 10:43:25 +0100
Subject: [rabbitmq-discuss] Having some issues with RabbitMQ
In-Reply-To: <4905999B-B266-4350-B431-C329CBBFE62A@mozilla.com>
References: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>
	<20100717231449.GA11469@wellquite.org>
	<4905999B-B266-4350-B431-C329CBBFE62A@mozilla.com>
Message-ID: <20100718094325.GA28733@wellquite.org>

Hi Christian,

On Sat, Jul 17, 2010 at 05:31:45PM -0700, Christian Legnitto wrote:
> I saw that and I'm not sure that is what I want. There will be users
> creating queues with scripts running locally on laptops and such. With
> your suggestion I believe this would happen:
> 
>       1. User has a local script "foo.py" running on a laptop, which
>       connects ("connection1"), gets a queue with a server-defined
>       name (call it "queue1") and reads messages
>       2. User goes to a meeting and the laptop sleeps, causing
>       RabbitMQ to close connection1
>       3. User comes back, foo.py is running but has thrown an
>       exception (or perhaps is listening on a dead connection, not
>       sure what happens here)
>       4. User restarts foo.py, getting a new connection
>       ("connection2") to a new server-generated queue ("queue2")
>       5. All messages sent between the closing of connection1 and
>       creation of connection2 never make it into queue2, so foo.py
>       possibly missed a bunch of messages
> 
> If I am mistaken, please correct me..this is all new :-)

No, you are right. But what you are asking for is nearly an impossible
situation - you'd like queues to be deleted if they're no longer used,
but you'd like them to stay around if the consumer disconnects - as far
as Rabbit is concerned, the two scenarios are the same. Thus if you
really want the queues to remain present after the clients have
disconnected (and clients which are shutdown "nicely" must remember to
delete any queues they created) then you'll have to use named queues and
revert to something like BQL to tidy up any mess left over.

> So, if the server takes care of creating the queue, there is no way
> for the client to tell it to reconnect when it comes back (and no
> queue will be there anyway as the server has cleared it). Creating a
> named queue takes write permission, correct?

No, configure permission. See
http://www.rabbitmq.com/admin-guide.html#access-control

Creating a binding to that queue requires write permission to the queue.
You could partition your namespace so that the exchanges all start
"exchange-" and the queues all start "queue-" and then you only need to
grant write permissions to "^queue-.*". That would allow your public
users to connect, create queues, bind them to the exchanges, but *not*
publish to the exchanges. (they'd also need configure permission on
"^queue-.*".

> It doesn't actually crash (bad choice of words on my part). The whole
> server is hung from the standpoint of any client I can use (python
> mainly). The BQL client won't even connect or give me a prompt at that
> point, it just hangs. amqp-utils (ruby, but may use the same lib as
> python) hangs and doesn't let me do anything. I end up stopping the
> server, clearing the data directory, and restarting it (which clearly
> wouldn't work in production). FWIW I got the same behavior with the
> old persister, which is why I thought I perhaps wasn't turning the new
> one on even though I am using the branch.

When this happens, is the disk thrashing, or is CPU use really high?
Also what type of machine / OS are you running this on?

> Yeah, I saw that flow control is generally not supported by the python
> libs (though I see http://gist.github.com/399282), but I'm not sure I
> would have hit it with ~30 msgs per second going to 10 queues.

Well, if the queues are backing up, with the old persister you would
eventually hit it. With the new persister, unless your disks are
catastrophically slow or your messages are massive, you certainly
shouldn't. How big are your messages?

> The fact that the BQL plugin stopped working was suspect. I'm not sure
> how that's written though, but I assumed it used the erlang client and
> would allow me to clear queues and get everything unblocked.

Indeed, it should, and yes, it uses the erlang client.

> So even though it isn't a crash, the behavior is the same....I can't
> read anything, publish anything, or clear queues to unblock, via
> carrot (python), amqp-utils (ruby), and the BQL plugin (erlang I
> guess). Perhaps all the libs I am using to interact with the broker
> barf with flow control?

You're right - it is pretty much indistinguishable from a crash, though
I'd love to know exactly what it's doing when it gets into this state.
The erlang client certainly does understand flow control, and I believe
the ruby client does as well.

> I also notice the status plugin says "memory (used/available) = 1498MB
> / 810MB" with the new persister...is that expected? I thought that it
> would always stay under the max and just flush to disk. Is my VM too
> wimpy?

Ahh! So that's a first clue - can you check the rabbit logs please
because there should be entries in there talking about it hitting the
high memory watermark. Certainly, that would ensure that the flow
control has been invoked. It's possible then that at least with the new
persister it's then flushing to disk, and bizarrely enough, if you keep
something like the status plugin installed and enabled and up in a web
browser, it can actually *prevent* GC from occurring, thus even when
everything has been flushed to disk, it can then take a huge amount of
time before the memory usage drops. I would (temporarily) suggest not
using the status plugin, relying on rabbitmqctl and the logs, and not
running rabbitmqctl more than once every 30 seconds. Yes, this is a
fairly severe issue with Rabbit and I'd certainly like to fix it.

Matthew


From matthias at rabbitmq.com  Sun Jul 18 11:52:03 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 18 Jul 2010 11:52:03 +0100
Subject: [rabbitmq-discuss] Having some issues with RabbitMQ
In-Reply-To: <20100718094325.GA28733@wellquite.org>
References: <4A50DED8-D751-4B83-9148-B2787EFEA4F2@mozilla.com>	<20100717231449.GA11469@wellquite.org>	<4905999B-B266-4350-B431-C329CBBFE62A@mozilla.com>
	<20100718094325.GA28733@wellquite.org>
Message-ID: <4C42DCD3.4020501@rabbitmq.com>

Christian,

Matthew Sackman wrote:
> Thus if you really want the queues to remain present after the
> clients have disconnected [...] then you'll have to use named queues

Actually you can still use server-named queues, just don't make them 
exclusive. The clients would need to remember the names of the queues 
they created though, so they can re-attach to them when reconnecting.

Another option is to get the clients to generate cryptographically 
strong names for their queue based on a one-way hash of some easily 
obtainable constant information. Then the clients wouldn't have to 
record the names.

>> The whole server is hung

Hmmm. I wonder whether you are actually using the new persister. What hg 
version of the server are you running? One tell-tale sign of the new 
persister is the following messages near the beginning of the rabbit log:

=INFO REPORT==== 18-Jul-2010::08:50:14 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 18-Jul-2010::08:50:14 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

Do you see these?


Regards,

Matthias

From matthew at rabbitmq.com  Sun Jul 18 12:12:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 18 Jul 2010 12:12:37 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client lagging behind server
 1.8.0
In-Reply-To: <AANLkTik8GMsuS10OqGRVxs7FyFEM04ON92iwp5riK2l3@mail.gmail.com>
References: <AANLkTikRqQrBhvOwj24KOVDyV416oufuqHJ6RpXiqqvR@mail.gmail.com>
	<20100708182836.GA20617@wellquite.org>
	<AANLkTin3G8_E3jd6SACD4it9z0mvAitcq5OYcxJWP0FX@mail.gmail.com>
	<AANLkTik8GMsuS10OqGRVxs7FyFEM04ON92iwp5riK2l3@mail.gmail.com>
Message-ID: <20100718111237.GC28733@wellquite.org>

On Fri, Jul 09, 2010 at 12:06:39PM -0700, Greg Campbell wrote:
> It's my understanding that "tip" is not what you want to use - that just
> refers to the most recently committed revision in *any* branch.  See
> http://www.rabbitmq.com/mercurial.html for more.
> 
> I would also welcome a release of the Erlang client, as it can be a bit
> onerous to keep track of the versions under the current system. Is there any
> way the community can be of assistance in this effort?

We are working on this. It is hopefully going to be a priority item for
us in the near future, but there are a few things that need fixing in
the Erlang client first to bring it up to standard. It's great that
people are using it, and of course most of the plugins us it too, so
getting it released will also help us manage to make the plugin
development and installation process somewhat easier.

Matthew

From matthew at rabbitmq.com  Sun Jul 18 12:15:09 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 18 Jul 2010 12:15:09 +0100
Subject: [rabbitmq-discuss] Message Priority support and HA Failover
In-Reply-To: <4C3AF5FD.7020001@rabbitmq.com>
References: <1278697907.2517.1005.camel@tchen-lenovo.evri.corp>
	<4C3AF5FD.7020001@rabbitmq.com>
Message-ID: <20100718111509.GD28733@wellquite.org>

On Mon, Jul 12, 2010 at 12:01:17PM +0100, Simon MacMullen wrote:
> On 09/07/10 18:51, Timothy Chen wrote:
> >I've been reading more about the clustering and ha failover of rabbit
> >mq, and sounds like there is no out of the box solution for live
> >failover when a node fails? I see that the routing information will be
> >persisted and can be transferred over to another node, but messages will
> >not?
> 
> Unfortunately that is the case. We're aware that clustering / HA is
> a weak area at the moment.

The active/passive setup *will* recover persisted messages that have
been written to disk. http://www.rabbitmq.com/pacemaker.html has the
full details. There is no active/active support out of the box, but a
number of possibilities are available here with support from clients,
such as publishing everything to multiple brokers with identical
topologies.

Matthew

From matthew at rabbitmq.com  Sun Jul 18 12:35:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 18 Jul 2010 12:35:16 +0100
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
References: <AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
	<AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
Message-ID: <20100718113516.GE28733@wellquite.org>

1. If your goal is to be able to use Rabbit to buffer large numbers of
messages, larger than the amount of RAM you have available, then you
need to be using the new persister.

2. The memory watermark is deliberately set at 0.4 because GC can
temporarily cause twice as much memory to be required (so will jump to
0.8) and the remaining 0.2 is ideally left for OS disk buffers.

3. A 32-bit OS will only ever be able to allocate a maximum of 4GB to
one process (and frequently 2GB).

4. If Erlang requires more memory than the OS can allocate to it, then
it will crash. Thus setting the memory watermark to 0.98 will result in
a crash as soon as a GC run causes Rabbit to use more than
0.98 * (min(4GB, installed RAM))

5. If you're using the new persister, you shouldn't have any need to
move the watermark away from 0.4.

Matthew

From ovidiudeac at gmail.com  Sun Jul 18 18:51:04 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Sun, 18 Jul 2010 20:51:04 +0300
Subject: [rabbitmq-discuss] python publish an unroutable message
Message-ID: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>

Does anyone have an example of using the mandatory flag to detect
unroutable messages in python?

Thanks!
ovidiu

From ovidiudeac at gmail.com  Sun Jul 18 21:10:56 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Sun, 18 Jul 2010 23:10:56 +0300
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <20100718113516.GE28733@wellquite.org>
References: <AANLkTilv1hRudJeHM4xQ-WPfLnxk5OP_exvWE_G_zWq9@mail.gmail.com>
	<AANLkTim6la0YW-k5Mm-MxK0ytih7PHzAZbRvzQky-I4n@mail.gmail.com>
	<4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
	<AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
	<20100718113516.GE28733@wellquite.org>
Message-ID: <AANLkTimLcdDdnLyDSDOjVvhETfnQ_5JaO1NPYbnnWH1G@mail.gmail.com>

Thanks for the info!

A few questions:
1. How stable is the new persister?
2. How can I try it?
3. When is it expected to be released?

ovidiu

On Sun, Jul 18, 2010 at 2:35 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> 1. If your goal is to be able to use Rabbit to buffer large numbers of
> messages, larger than the amount of RAM you have available, then you
> need to be using the new persister.
>
> 2. The memory watermark is deliberately set at 0.4 because GC can
> temporarily cause twice as much memory to be required (so will jump to
> 0.8) and the remaining 0.2 is ideally left for OS disk buffers.
>
> 3. A 32-bit OS will only ever be able to allocate a maximum of 4GB to
> one process (and frequently 2GB).
>
> 4. If Erlang requires more memory than the OS can allocate to it, then
> it will crash. Thus setting the memory watermark to 0.98 will result in
> a crash as soon as a GC run causes Rabbit to use more than
> 0.98 * (min(4GB, installed RAM))
>
> 5. If you're using the new persister, you shouldn't have any need to
> move the watermark away from 0.4.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Dan.Wise at ignisasset.com  Sun Jul 18 22:11:47 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Sun, 18 Jul 2010 22:11:47 +0100
Subject: [rabbitmq-discuss] SSL errors on broker
Message-ID: <20100718211154.2AD9A14F874@lists.rabbitmq.com>

Hi,

 

Can anyone help track down the following error when connecting via SSL:

 

error on TCP connection <0.178.0>:{ssl_upgrade_failure,

                                   {{function_clause,

                                     [{ssl_record,mac_hash,

                                       [undefined,0,undefined,0,21,2,

                                        <<2,22>>]},

 
{ssl_record,hash_and_bump_seqno,5},

                                      {ssl_record,cipher,4},

                                      {ssl_record,encode_plain_text,4},

 
{ssl_connection,handle_own_alert,4},

                                      {ssl_connection,handle_info,3},

                                      {gen_fsm,handle_msg,7},

                                      {proc_lib,init_p_do_apply,3}]},

                                    {gen_fsm,sync_send_all_state_event,

                                     [<0.179.0>,started,5000]}}}

 

 

 

My rabbit.conf reads:

 

[

  {rabbit, [

     {ssl_listeners, [{"0.0.0.0",15601}]},

     {ssl_options,
[{cacertfile,"D:/dev/trunk/amqp/pki/testca/cacert.pem"},

                    {certfile,"D:/dev/trunk/amqp/pki/server/cert.pem"},

                    {keyfile,"D:/dev/trunk/amqp/pki/server/key.pem"},

                    {verify,verify_peer},

                    {fail_if_no_peer_cert,false}]}

   ]}

].

 

Thanks,

 

Dan.

 

 

 

</PRE>**************************************************************<BR><BR>Visit our Website at http://www.ignisasset.com/ <BR>The information contained in this email (including any attachments transmitted within it) is confidential and is intended solely for the use of the named person. <BR>The unauthorised access, copying or re-use of the information in it by any other person is strictly forbidden. <BR>
If you are not the intended recipient please notify us immediately by return email to postmaster at ignisasset.com.<BR><BR>Internet communication is not guaranteed to be timely, secure, error or virus free. We accept no liability for any harm to systems or data,
nor for personal emails.  Emails may be recalled, deleted and monitored.<BR><BR>Ignis Asset Management is the trading name of the Ignis Asset Management Limited group of companies which includes the following subsidiary and associated companies: Ignis Asset Management Limited (Registered in Scotland No. SC200801), Ignis Investment Services Limited* (Registered in Scotland No. SC101825) <BR>Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish Mutual Investment Managers Limited* (Registered in Scotland No. SC88674) <BR>Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No. 971504)<BR>Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and Ignis Investment Management Limited* (Registered in England No. 5809046) <BR>Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD. Scottish Mutual is a registered trade mark of Scottish Mutual Assurance Limited<BR><BR>*Authorised and regulated by the Financial Services Authority.<BR><BR>**************************************************************<BR><PRE>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100718/ab52873b/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Jul 19 10:28:50 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 10:28:50 +0100
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTimLcdDdnLyDSDOjVvhETfnQ_5JaO1NPYbnnWH1G@mail.gmail.com>
References: <4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
	<AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
	<20100718113516.GE28733@wellquite.org>
	<AANLkTimLcdDdnLyDSDOjVvhETfnQ_5JaO1NPYbnnWH1G@mail.gmail.com>
Message-ID: <20100719092849.GA6466@rabbitmq.com>

On Sun, Jul 18, 2010 at 11:10:56PM +0300, Ovidiu Deac wrote:
> 1. How stable is the new persister?

Many people are using it. It's just finishing going through QA -
something I personally doubted would ever happen...

> 2. How can I try it?

Compile from source - see http://www.rabbitmq.com/build-server.html but
before the "make" step, add in "hg up -C bug21673"

> 3. When is it expected to be released?

"Very soon" - it /should/ be in the next release.

Matthew

From matthew at rabbitmq.com  Mon Jul 19 10:30:48 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 10:30:48 +0100
Subject: [rabbitmq-discuss] SSL errors on broker
In-Reply-To: <20100718211154.2AD9A14F874@lists.rabbitmq.com>
References: <20100718211154.2AD9A14F874@lists.rabbitmq.com>
Message-ID: <20100719093048.GB6466@rabbitmq.com>

Hi Dan,

What version of Rabbit and Erlang are you using? - the Erlang SSL module
has changed a lot recently and the last version we noticed worked well
for us was in Erlang R13B03. It's possible the SSL module has changed to
such an extent that we need to rewrite some of our code to work properly
with R13B04 or the BETA R14A, but we've not recently taken a look at
this.

Matthew

From Dan.Wise at ignisasset.com  Mon Jul 19 10:54:00 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Mon, 19 Jul 2010 10:54:00 +0100
Subject: [rabbitmq-discuss] SSL errors on broker
Message-ID: <20100719095401.84A1A14F871@lists.rabbitmq.com>

Matthew,

We are running Rabbit 1.8.1 and Erlang R13B03 on Windows and using the
.NET libraries to connect over SSL. To simplify matters I am running the
broker and client on the same machine. BTW I am using OpenSSL 0.9.8 to
enable the Erlang SSL binaries. Not sure if this will make a difference.

I also tried the Erlang R14A release but this failed in a different way
altogether, so I decided to revert back to testing on R13B03 in order to
focus on one failure scenario at a time.

Dan.


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthew Sackman
Sent: 19 July 2010 10:31
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] SSL errors on broker

Hi Dan,

What version of Rabbit and Erlang are you using? - the Erlang SSL module
has changed a lot recently and the last version we noticed worked well
for us was in Erlang R13B03. It's possible the SSL module has changed to
such an extent that we need to rewrite some of our code to work properly
with R13B04 or the BETA R14A, but we've not recently taken a look at
this.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
**************************************************************

Visit our Website at http://www.ignisasset.com/ 

The information contained in this email (including any attachments transmitted within it) is confidential and is intended solely for the use of the named person.  
The unauthorised access, copying or re-use of the information in it by any other person is strictly forbidden.  
If you are not the intended recipient please notify us immediately by return email to postmaster at ignisasset.com.

Internet communication is not guaranteed to be timely, secure, error or virus free. We accept no liability for any harm to systems or data,
nor for personal emails.  Emails may be recalled, deleted and monitored.

Ignis Asset Management is the trading name of the Ignis Asset Management Limited group of companies which includes the following subsidiary and associated companies: 
Ignis Asset Management Limited (Registered in Scotland No. SC200801), Ignis Investment Services Limited* (Registered in Scotland No. SC101825) 
Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish Mutual Investment Managers Limited* (Registered in Scotland No. SC88674) 
Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No. 971504)
Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and Ignis Investment Management Limited* (Registered in England No. 5809046) 
Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD. Scottish Mutual is a registered trade mark of Scottish Mutual Assurance Limited

*Authorised and regulated by the Financial Services Authority.

**************************************************************




From matthew at rabbitmq.com  Mon Jul 19 10:58:30 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 10:58:30 +0100
Subject: [rabbitmq-discuss] SSL errors on broker
Message-ID: <20100719095830.GA13335@rabbitmq.com>

Hi Dan,

We've just spotted that in your original posting you said
"rabbit.conf". That config should be in "rabbitmq.config" - did you
just mistype or do you have the file named wrong? Given your error
message, I suspect you just mistyped...

Matthew

From carl.bourne at intellect.co.uk  Mon Jul 19 11:21:54 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 03:21:54 -0700 (PDT)
Subject: [rabbitmq-discuss]  Updating messages on queues
Message-ID: <29203202.post@talk.nabble.com>


Hi, 

Does anybody know if it's possible to update messages on a queue without
actually removing them. My use case requires a message to be removed from a
queue, only if the consumer is able to successfully process the message and
perform an action contained therein. If the action fails then the message
remains on the queue ready for a scheduled retry. I was thinking a message
time value could be changed so consumers only process messages that are
within a certain time range. If there's a better way to do this, any advice
would be welcome. 

If there any examples or demos that can show this using Ruby or Python, this
would be even better. 

Best regards, 

Carl ?

-- 
View this message in context: http://old.nabble.com/Updating-messages-on-queues-tp29203202p29203202.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Mon Jul 19 11:46:15 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 11:46:15 +0100
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <29203202.post@talk.nabble.com>
References: <29203202.post@talk.nabble.com>
Message-ID: <20100719104614.GB13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 03:21:54AM -0700, cbourne wrote:
> Does anybody know if it's possible to update messages on a queue without
> actually removing them.

Yes, I know. And no, there are no side-effect-free operations on
messages in a queue.

> My use case requires a message to be removed from a
> queue, only if the consumer is able to successfully process the message and
> perform an action contained therein. If the action fails then the message
> remains on the queue ready for a scheduled retry.

You simply want to have the consumers delay acknowledging the message
until after they've successfully processed the message. If they can't
process the message then presumably some error has occurred, which
you should make cause the client to close the channel on which it
received the message. That will cause the message to be requeued.

> I was thinking a message
> time value could be changed so consumers only process messages that are
> within a certain time range. If there's a better way to do this, any advice
> would be welcome. 

I'm afraid I don't really understand this. Can you explain this some
more?

Matthew

From carl.bourne at intellect.co.uk  Mon Jul 19 12:06:38 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 04:06:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <20100719104614.GB13335@rabbitmq.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
Message-ID: <29203456.post@talk.nabble.com>




Matthew Sackman-3 wrote:
> 
> On Mon, Jul 19, 2010 at 03:21:54AM -0700, cbourne wrote:
>> Does anybody know if it's possible to update messages on a queue without
>> actually removing them.
> 
> Yes, I know. And no, there are no side-effect-free operations on
> messages in a queue.O
> 
>> My use case requires a message to be removed from a
>> queue, only if the consumer is able to successfully process the message
>> and
>> perform an action contained therein. If the action fails then the message
>> remains on the queue ready for a scheduled retry.
> 
> You simply want to have the consumers delay acknowledging the message
> until after they've successfully processed the message. If they can't
> process the message then presumably some error has occurred, which
> you should make cause the client to close the channel on which it
> received the message. That will cause the message to be requeued.
> 
>> I was thinking a message
>> time value could be changed so consumers only process messages that are
>> within a certain time range. If there's a better way to do this, any
>> advice
>> would be welcome. 
> 
>> I'm afraid I don't really understand this. Can you explain this some
>> more?
> 
> So by this I mean adding some kind of a time field to the header so the
> consumer can apply a time based filter to the messages. Basically I need a
> retry queue that allows messages to be re-processed after a pre-defined
> time if the first attempt failed. Ideally this would also include the
> number of times to try before failing permanently.
> 
> Carl
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Updating-messages-on-queues-tp29203202p29203456.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From carl.bourne at intellect.co.uk  Mon Jul 19 12:07:34 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 04:07:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <20100719104614.GB13335@rabbitmq.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
Message-ID: <29203464.post@talk.nabble.com>




Matthew Sackman-3 wrote:
> 
> On Mon, Jul 19, 2010 at 03:21:54AM -0700, cbourne wrote:
>> Does anybody know if it's possible to update messages on a queue without
>> actually removing them.
> 
> Yes, I know. And no, there are no side-effect-free operations on
> messages in a queue.O
> 
>> My use case requires a message to be removed from a
>> queue, only if the consumer is able to successfully process the message
>> and
>> perform an action contained therein. If the action fails then the message
>> remains on the queue ready for a scheduled retry.
> 
> You simply want to have the consumers delay acknowledging the message
> until after they've successfully processed the message. If they can't
> process the message then presumably some error has occurred, which
> you should make cause the client to close the channel on which it
> received the message. That will cause the message to be requeued.
> 
>> I was thinking a message
>> time value could be changed so consumers only process messages that are
>> within a certain time range. If there's a better way to do this, any
>> advice
>> would be welcome. 
> 
>> I'm afraid I don't really understand this. Can you explain this some
>> more?
> 
> So by this I mean adding some kind of a time field to the header so the
> consumer can apply a time based filter to the messages. Basically I need a
> retry queue that allows messages to be re-processed after a pre-defined
> time if the first attempt failed. Ideally this would also include the
> number of times to try before failing permanently.
> 
> Carl
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Updating-messages-on-queues-tp29203202p29203464.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Mon Jul 19 12:12:13 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 12:12:13 +0100
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <29203456.post@talk.nabble.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
Message-ID: <20100719111213.GC13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 04:06:38AM -0700, cbourne wrote:
> > So by this I mean adding some kind of a time field to the header so the
> > consumer can apply a time based filter to the messages. Basically I need a
> > retry queue that allows messages to be re-processed after a pre-defined
> > time if the first attempt failed. Ideally this would also include the
> > number of times to try before failing permanently.

Well, you could always just handle it completely in the consumer - if
the consumer can't process it, republish the message with an update try
count and then ack the original message. Because the publish will go to
the end of the queue, that'll ensure that new messages do get seen and
that a repeatedly failing message doesn't ensure that other messages get
starved of attention.

Matthew

From carl.bourne at intellect.co.uk  Mon Jul 19 12:14:26 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 04:14:26 -0700 (PDT)
Subject: [rabbitmq-discuss]  Sending large files to a queue
Message-ID: <29203549.post@talk.nabble.com>


I found a reference to a file stream class in the rabbit FAQ's. Has anybody
actually used this for sending large files to a queue before? The FAQ seems
to imply that it works by persisting the data to a disk based storage area.

Regards, 

Carl 
-- 
View this message in context: http://old.nabble.com/Sending-large-files-to-a-queue-tp29203549p29203549.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From Dan.Wise at ignisasset.com  Mon Jul 19 12:15:39 2010
From: Dan.Wise at ignisasset.com (Dan Wise)
Date: Mon, 19 Jul 2010 12:15:39 +0100
Subject: [rabbitmq-discuss] SSL errors on broker
Message-ID: <20100719111541.3A1F514F871@lists.rabbitmq.com>

Matthew,

That was a typo. It's definitely rabbit.config. The settings are without
doubt being picked up by the broker as the log shows it to be listening
on the correct SSL port.

Dan.


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthew Sackman
Sent: 19 July 2010 10:59
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] SSL errors on broker

Hi Dan,

We've just spotted that in your original posting you said
"rabbit.conf". That config should be in "rabbitmq.config" - did you
just mistype or do you have the file named wrong? Given your error
message, I suspect you just mistyped...

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
**************************************************************

Visit our Website at http://www.ignisasset.com/ 

The information contained in this email (including any attachments transmitted within it) is confidential and is intended solely for the use of the named person.  
The unauthorised access, copying or re-use of the information in it by any other person is strictly forbidden.  
If you are not the intended recipient please notify us immediately by return email to postmaster at ignisasset.com.

Internet communication is not guaranteed to be timely, secure, error or virus free. We accept no liability for any harm to systems or data,
nor for personal emails.  Emails may be recalled, deleted and monitored.

Ignis Asset Management is the trading name of the Ignis Asset Management Limited group of companies which includes the following subsidiary and associated companies: 
Ignis Asset Management Limited (Registered in Scotland No. SC200801), Ignis Investment Services Limited* (Registered in Scotland No. SC101825) 
Ignis Fund Managers Limited* (Registered in Scotland No. SC85610) Scottish Mutual Investment Managers Limited* (Registered in Scotland No. SC88674) 
Registered Office: 50 Bothwell Street, Glasgow, G2 6HR, Tel: 0141-222-8000 and Scottish Mutual PEP & ISA Managers Limited* (Registered in England No. 971504)
Registered Office: 1 Wythall Green Way, Wythall, Birmingham B47 6WG and Ignis Investment Management Limited* (Registered in England No. 5809046) 
Registered Office: Sentinel House, 16 Harcourt Street, London, W1H 4AD. Scottish Mutual is a registered trade mark of Scottish Mutual Assurance Limited

*Authorised and regulated by the Financial Services Authority.

**************************************************************




From matthew at rabbitmq.com  Mon Jul 19 12:18:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 12:18:18 +0100
Subject: [rabbitmq-discuss] Sending large files to a queue
In-Reply-To: <29203549.post@talk.nabble.com>
References: <29203549.post@talk.nabble.com>
Message-ID: <20100719111817.GE13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 04:14:26AM -0700, cbourne wrote:
> I found a reference to a file stream class in the rabbit FAQ's. Has anybody
> actually used this for sending large files to a queue before? The FAQ seems
> to imply that it works by persisting the data to a disk based storage area.

It's unimplemented - there were several such classes in the 0.8 spec
which were bizarre and not obviously different from the basic class. We
did not implement them, and they were removed in 0.9.1 spec. If you have
really big files that you need to pass around then I'd suggest placing
them somewhere else (pretty much anything will do here - NFS even!), and
then passing pointers (URLs, Paths etc) as the message in Rabbit.

Matthew

From alexis at rabbitmq.com  Mon Jul 19 12:20:48 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 19 Jul 2010 12:20:48 +0100
Subject: [rabbitmq-discuss] Sending large files to a queue
In-Reply-To: <20100719111817.GE13335@rabbitmq.com>
References: <29203549.post@talk.nabble.com>
	<20100719111817.GE13335@rabbitmq.com>
Message-ID: <AANLkTilvvrwTvQpoviizG5bZoQoGCLJ0IPqo-2eTlpN1@mail.gmail.com>

+1

Carl, to add to Matthew's comment: yes, people have implemented 'file
chunking' apps over RabbitMQ.  I think Nanite may have (ruby) libs for
this.

alexis



On Mon, Jul 19, 2010 at 12:18 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Jul 19, 2010 at 04:14:26AM -0700, cbourne wrote:
>> I found a reference to a file stream class in the rabbit FAQ's. Has anybody
>> actually used this for sending large files to a queue before? The FAQ seems
>> to imply that it works by persisting the data to a disk based storage area.
>
> It's unimplemented - there were several such classes in the 0.8 spec
> which were bizarre and not obviously different from the basic class. We
> did not implement them, and they were removed in 0.9.1 spec. If you have
> really big files that you need to pass around then I'd suggest placing
> them somewhere else (pretty much anything will do here - NFS even!), and
> then passing pointers (URLs, Paths etc) as the message in Rabbit.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From carl.bourne at intellect.co.uk  Mon Jul 19 12:22:12 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 04:22:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <20100719111213.GC13335@rabbitmq.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
	<20100719111213.GC13335@rabbitmq.com>
Message-ID: <29203617.post@talk.nabble.com>




Matthew Sackman-3 wrote:
> 
> On Mon, Jul 19, 2010 at 04:06:38AM -0700, cbourne wrote:
>> > So by this I mean adding some kind of a time field to the header so the
>> > consumer can apply a time based filter to the messages. Basically I
>> need a
>> > retry queue that allows messages to be re-processed after a pre-defined
>> > time if the first attempt failed. Ideally this would also include the
>> > number of times to try before failing permanently.
> 
> Well, you could always just handle it completely in the consumer - if
> the consumer can't process it, republish the message with an update try
> count and then ack the original message. Because the publish will go to
> the end of the queue, that'll ensure that new messages do get seen and
> that a repeatedly failing message doesn't ensure that other messages get
> starved of attention.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


Thanks Matt - guess the only problem with getting the consumer to do this is
that if it's the consumer that fails, then the message could be lost. Would
be better to leave the message on the queue so it could at least be
processed by a different consumer if that were to happen. Hence, the
requirement to update a field in the message header.

Carl
-- 
View this message in context: http://old.nabble.com/Updating-messages-on-queues-tp29203202p29203617.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Mon Jul 19 12:25:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 12:25:16 +0100
Subject: [rabbitmq-discuss] Sending large files to a queue
In-Reply-To: <AANLkTilvvrwTvQpoviizG5bZoQoGCLJ0IPqo-2eTlpN1@mail.gmail.com>
References: <29203549.post@talk.nabble.com>
	<20100719111817.GE13335@rabbitmq.com>
	<AANLkTilvvrwTvQpoviizG5bZoQoGCLJ0IPqo-2eTlpN1@mail.gmail.com>
Message-ID: <20100719112516.GF13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 12:20:48PM +0100, Alexis Richardson wrote:
> Carl, to add to Matthew's comment: yes, people have implemented 'file
> chunking' apps over RabbitMQ.  I think Nanite may have (ruby) libs for
> this.

Yeah, you can do that, but it's not necessarily a great idea due to
message reordering issues. However, if you use something like tornado
codes / erasure code, that might be one (very neat) way around the
problem. Pushing the message through Rabbit gives you the advantage that
you don't need some additional logic to work out when to delete the file
from, say, your shared NFS store. However, pushing the message through
Rabbit has the disadvantage that you may find for large files you need
to do chunking... swings, roundabouts and traffic lights.

Matthew

From matthew at rabbitmq.com  Mon Jul 19 12:26:04 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 12:26:04 +0100
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <29203617.post@talk.nabble.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
	<20100719111213.GC13335@rabbitmq.com>
	<29203617.post@talk.nabble.com>
Message-ID: <20100719112603.GG13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 04:22:12AM -0700, cbourne wrote:
> Thanks Matt - guess the only problem with getting the consumer to do this is
> that if it's the consumer that fails, then the message could be lost.

Not true. If the consumer fails before acking the message then Rabbit
reinserts the message into the queue.

Matthew

From aaron at agoragames.com  Mon Jul 19 13:17:55 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 19 Jul 2010 08:17:55 -0400
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <20100719112603.GG13335@rabbitmq.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
	<20100719111213.GC13335@rabbitmq.com>
	<29203617.post@talk.nabble.com>
	<20100719112603.GG13335@rabbitmq.com>
Message-ID: <AANLkTim4HAsKhFUP3IXT0n_k5ytPJth8-w8dugGb2uiP@mail.gmail.com>

What are the rules for this?  We're using no-ack messages and I've
considered switching to explicit acks, but am concerned about the case
where a message takes "a long time" to process.

-Aaron

On Mon, Jul 19, 2010 at 7:26 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Jul 19, 2010 at 04:22:12AM -0700, cbourne wrote:
>> Thanks Matt - guess the only problem with getting the consumer to do this is
>> that if it's the consumer that fails, then the message could be lost.
>
> Not true. If the consumer fails before acking the message then Rabbit
> reinserts the message into the queue.
>
> Matthew


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthew at rabbitmq.com  Mon Jul 19 13:29:48 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 13:29:48 +0100
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <AANLkTim4HAsKhFUP3IXT0n_k5ytPJth8-w8dugGb2uiP@mail.gmail.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
	<20100719111213.GC13335@rabbitmq.com>
	<29203617.post@talk.nabble.com>
	<20100719112603.GG13335@rabbitmq.com>
	<AANLkTim4HAsKhFUP3IXT0n_k5ytPJth8-w8dugGb2uiP@mail.gmail.com>
Message-ID: <20100719122947.GH13335@rabbitmq.com>

On Mon, Jul 19, 2010 at 08:17:55AM -0400, Aaron Westendorf wrote:
> What are the rules for this?  We're using no-ack messages and I've
> considered switching to explicit acks, but am concerned about the case
> where a message takes "a long time" to process.

There is no timeout on acks. Once a message has been sent to the client,
the client has as long as it needs before it acks the message. Until it
acks the message, Rabbit hangs onto the message so that in the event of
failure, Rabbit can reinsert the message into the queue from whence it
came.

Matthew

From carl.bourne at intellect.co.uk  Mon Jul 19 13:44:00 2010
From: carl.bourne at intellect.co.uk (cbourne)
Date: Mon, 19 Jul 2010 05:44:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Updating messages on queues
In-Reply-To: <20100719122947.GH13335@rabbitmq.com>
References: <29203202.post@talk.nabble.com>
	<20100719104614.GB13335@rabbitmq.com>
	<29203456.post@talk.nabble.com>
	<20100719111213.GC13335@rabbitmq.com>
	<29203617.post@talk.nabble.com>
	<20100719112603.GG13335@rabbitmq.com>
	<AANLkTim4HAsKhFUP3IXT0n_k5ytPJth8-w8dugGb2uiP@mail.gmail.com>
	<20100719122947.GH13335@rabbitmq.com>
Message-ID: <29204231.post@talk.nabble.com>




Matthew Sackman-3 wrote:
> 
> On Mon, Jul 19, 2010 at 08:17:55AM -0400, Aaron Westendorf wrote:
>> What are the rules for this?  We're using no-ack messages and I've
>> considered switching to explicit acks, but am concerned about the case
>> where a message takes "a long time" to process.
> 
> There is no timeout on acks. Once a message has been sent to the client,
> the client has as long as it needs before it acks the message. Until it
> acks the message, Rabbit hangs onto the message so that in the event of
> failure, Rabbit can reinsert the message into the queue from whence it
> came.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

Thanks for all you help on this. Think this should give me something to go
on.

Carl
-- 
View this message in context: http://old.nabble.com/Updating-messages-on-queues-tp29203202p29204231.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Mon Jul 19 16:42:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 16:42:37 +0100
Subject: [rabbitmq-discuss] the new persister and mnesia replication
In-Reply-To: <AANLkTillgLm11GVf6Hp5uGcEUtb9OGfT1x4SY5Fha1Tr@mail.gmail.com>
References: <AANLkTillgLm11GVf6Hp5uGcEUtb9OGfT1x4SY5Fha1Tr@mail.gmail.com>
Message-ID: <20100719154237.GD24186@rabbitmq.com>

Hi Alex,

On Sun, Jul 18, 2010 at 09:53:22AM +0100, Alex Lovell-Troy wrote:
> I'm interested in using rabbitmq for guaranteed delivery rather than
> speed.  Disk persistence through durable queues isn't enough because
> messages can still be lost in the case of disk/host death.

Well, with some level of RAID > 0, you could certainly make it somewhat
unlikely that the messages will get totally lost...

> But,
> rabbitmq already uses mnesia for the durable message store and mnesia
> is replicable.

No it doesn't. Rabbit does not use mnesia to store messages. It only
uses mnesia to store meta information about exchanges, queues, bindings,
usernames, permissions etc. Not messages, and certainly not message
content.

> Has anyone done anything with the current persistence
> engine or the new persister to take advantage of mnesia replication to
> replicate persistent messages on durable queues across multiple mnesia
> nodes?

Not that I'm aware of.

> If not, is that a crazy thing to do in a low message volume
> situation?

In a low volume case it could work. But the messages would not be
accessible from other nodes in the event of a failure - yes you could
access the messages directly in the database, but you would not be able
to bring up a queue and have it populate itself with the messages in the
database without repairing the original node - at least not without
changing quite a lot more of Rabbit's innards. As such, I'm not really
sure what you've gained which you wouldn't have from a NAS or even
something like DRBD.

Matthew

From ben at simplegeo.com  Mon Jul 19 22:14:47 2010
From: ben at simplegeo.com (Ben Standefer)
Date: Mon, 19 Jul 2010 14:14:47 -0700
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <20100719092849.GA6466@rabbitmq.com>
References: <4C3F283E.2040505@zopyx.com>
	<AANLkTin47vug7o1uWS0V2fsiSVbBNy_UpK0kt3oxO0aA@mail.gmail.com>
	<AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
	<AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
	<20100718113516.GE28733@wellquite.org>
	<AANLkTimLcdDdnLyDSDOjVvhETfnQ_5JaO1NPYbnnWH1G@mail.gmail.com>
	<20100719092849.GA6466@rabbitmq.com>
Message-ID: <AANLkTinwrEkgnSx_g6Vaa1xvHFzt-5imOQ8qWB5Y8SFc@mail.gmail.com>

Is the "new persister" a replacement for using Mnesia to make RabbitMQ more
durable?  We've had issues moving the Mnesia database between machines,
requiring us to make questionable binary edits of schema.DAT.  One of our
main frustrations with RabbitMQ is how it handles durability, recovery, and
failure, so it'd be awesome to see improvement in this area soon.  Thanks!

-Ben Standefer


On Mon, Jul 19, 2010 at 2:28 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Sun, Jul 18, 2010 at 11:10:56PM +0300, Ovidiu Deac wrote:
> > 1. How stable is the new persister?
>
> Many people are using it. It's just finishing going through QA -
> something I personally doubted would ever happen...
>
> > 2. How can I try it?
>
> Compile from source - see http://www.rabbitmq.com/build-server.html but
> before the "make" step, add in "hg up -C bug21673"
>
> > 3. When is it expected to be released?
>
> "Very soon" - it /should/ be in the next release.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100719/2fee830f/attachment.htm>

From jon.brisbin at npcinternational.com  Mon Jul 19 22:25:34 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Mon, 19 Jul 2010 16:25:34 -0500
Subject: [rabbitmq-discuss] spring-amqp
Message-ID: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>

Is the spring-amqp stuff on a Maven repo somewhere yet? I'm thinking about branching my async cache stuff and trying to integrate it with spring-amqp.

Along those lines, what kinds of performance testing has this undergone? I'll be interested to see how it performs compared to a completely asynchronous send-receive pattern like I'm using now. I've found that I get better throughput if I don't directly send or receive any messages. I've been using consumers and dedicated message senders to handle all the messaging communication and use BlockingQueues exclusively for communication between the threads that actually do the work. It seems, in my cursory glances at the source code, that spring-amqp does something similar.

Jon Brisbin
Portal Webmaster
NPC International, Inc.




From matthew at rabbitmq.com  Mon Jul 19 22:41:17 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Jul 2010 22:41:17 +0100
Subject: [rabbitmq-discuss] rabbitmq with one producer no consumer
In-Reply-To: <AANLkTinwrEkgnSx_g6Vaa1xvHFzt-5imOQ8qWB5Y8SFc@mail.gmail.com>
References: <AANLkTimlDH7atqET-IOlHGJKMBc0JUA90k3k6i0dQeUD@mail.gmail.com>
	<AANLkTik6PEuDpi3G-3TaA-TUByMkesj6s8zXtmAsrd2e@mail.gmail.com>
	<AANLkTin8D6c3DORFAkheSN1DYZZFBCvY1UuSMvwhWzru@mail.gmail.com>
	<AANLkTikL4vqNjiP19QLg4zj2LEQsYFmYwEbHw3U4Th8c@mail.gmail.com>
	<AANLkTil2ngE66ycqkwvRnD8Rn-rN-kHik285Mm74uI3g@mail.gmail.com>
	<AANLkTinE4PVbaxvUocbZd2VkqZ9pNbJsLUVAYgou3_Ne@mail.gmail.com>
	<20100718113516.GE28733@wellquite.org>
	<AANLkTimLcdDdnLyDSDOjVvhETfnQ_5JaO1NPYbnnWH1G@mail.gmail.com>
	<20100719092849.GA6466@rabbitmq.com>
	<AANLkTinwrEkgnSx_g6Vaa1xvHFzt-5imOQ8qWB5Y8SFc@mail.gmail.com>
Message-ID: <20100719214117.GA17420@wellquite.org>

On Mon, Jul 19, 2010 at 02:14:47PM -0700, Ben Standefer wrote:
> Is the "new persister" a replacement for using Mnesia to make RabbitMQ more
> durable?

Persistence and mnesia have very little to do with each other. Rabbit
has never used mnesia for storing messages. The "new persister" makes
Rabbit vastly more scalable. It does not change any of the guarantees
made about when messages are written to disk.

>  We've had issues moving the Mnesia database between machines,
> requiring us to make questionable binary edits of schema.DAT. 

That is indeed questionable. You should ensure that the nodename is the
same on both machines to allow mnesia to startup and load the database.

> One of our
> main frustrations with RabbitMQ is how it handles durability, recovery, and
> failure, so it'd be awesome to see improvement in this area soon.  Thanks!

Can you be more specific as to exactly what issues you have run into and
under what circumstances? That way I can suggest what improvements you
will see for each case with the new persister.

Matthew

From gquezada at lapolar.cl  Mon Jul 19 23:31:10 2010
From: gquezada at lapolar.cl (Gaston Quezada)
Date: Mon, 19 Jul 2010 18:31:10 -0400
Subject: [rabbitmq-discuss] How to configure timeout for rabbit client
Message-ID: <4C44D22E.1030000@lapolar.cl>

Hi All,

How can I to change the socket timeout for rabbit client for jvm 1.4.2.?

Thanks..
-- 
Gaston Quezada

From ravi at makara.com  Mon Jul 19 23:52:59 2010
From: ravi at makara.com (Ravi Sankar Penta)
Date: Mon, 19 Jul 2010 18:52:59 -0400
Subject: [rabbitmq-discuss] Does TTL for message implemented in rabbitmq?
	<eom>
Message-ID: <456B14F1A5382845A58F29F652D38DC10EAEBE3A70@VMBX116.ihostexchange.net>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100719/4b155081/attachment.htm>

From yong.liu at nyapc.com  Tue Jul 20 06:55:02 2010
From: yong.liu at nyapc.com (Yong Liu)
Date: Tue, 20 Jul 2010 13:55:02 +0800
Subject: [rabbitmq-discuss] Rabbitmq v. 1.8.1 - Bug report - Could not start
	a node as RAM node in cluster
Message-ID: <003301cb27d0$18e012d0$4aa03870$@liu@nyapc.com>

Hello, I am a new comer to the rabbitmq world.

 

While trying to start a node as a RAM node in a rabbitmq cluster, I found
that it would not work as indicated on the website.

 

"rabbit2$ rabbitmqctl cluster rabbit at rabbit1"

 

The result shows rabbit2 is a DISC node, not a RAM node.

Rabbit2$ rabbitmqctl status
Status of node rabbit at rabbit3 ...
[...,
 {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
 {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
...done.

 

Testing environment:

OS: FreeBSD 8.1

Rabbitmq: 1.8.1

 

Another question would be if a node does not join a cluster, would it be
configured as a RAM node.  If so, how do I do it?

 

Your prompt reply is very much appreciated!

 

Yong

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/3cdf3712/attachment.htm>

From irmo.manie at gmail.com  Tue Jul 20 08:07:59 2010
From: irmo.manie at gmail.com (Irmo Manie)
Date: Tue, 20 Jul 2010 09:07:59 +0200
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
Message-ID: <AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>

Hi Jon,

On Mon, Jul 19, 2010 at 11:25 PM, Jon Brisbin <
jon.brisbin at npcinternational.com> wrote:

> Is the spring-amqp stuff on a Maven repo somewhere yet? I'm thinking about
> branching my async cache stuff and trying to integrate it with spring-amqp.
>
>
Do you by any chance mean this spring-amqp code:
http://github.com/momania/spring-rabbitmq
If so, there is nothing on any maven repo of that. Also it's not maintained
anymore. (Not by me at least ;) )


> Along those lines, what kinds of performance testing has this undergone?
> I'll be interested to see how it performs compared to a completely
> asynchronous send-receive pattern like I'm using now. I've found that I get
> better throughput if I don't directly send or receive any messages. I've
> been using consumers and dedicated message senders to handle all the
> messaging communication and use BlockingQueues exclusively for communication
> between the threads that actually do the work. It seems, in my cursory
> glances at the source code, that spring-amqp does something similar.
>

As it is not very well maintained and also what a first raw take at the code
it hasn't undergone much testing.

My suggestion is to wait a couple of more days for the first rabbitmq/amqp
integration from SpringSource. That should be available very soon in a RC1
stage. Anybody from SpringSource/RabbitMQ team should be able to give a
indication on this

Cheers,
Irmo


> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/aa3f9d36/attachment.htm>

From flocha2000-agile at yahoo.fr  Tue Jul 20 09:55:30 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Tue, 20 Jul 2010 08:55:30 +0000 (GMT)
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
Message-ID: <281503.55292.qm@web26001.mail.ukl.yahoo.com>



                Hello list,


Our team is in a spike sprint to choose between ActiveMQ or RabbitMQ.
 We made 2 little producer/consumer spikes sending an object message 
with an array of 16 strings, a timestamp, and 2 integers. The spikes are
 ok on our devs machines (messages are well consumed).


Then came the benchs. We first noticed that somtimes, on our 
machines, when we were sending a lot of messages the consumer was 
sometimes hanging. It was there, but the messsages were accumulating in 
the queue.

When we went on the bench plateform :

cluster of 2 rabbitmq machines 4 cores/3.2Ghz, 4Gb RAM, load 
balanced by a VIPone to 6 consumers running on the rabbitmq machines, saving the 
messages in a mysql DB (same type of machine for the DB)12 producers running on 12 AS machines (tomcat), attacked with 
jmeter running on another machine. The load is about 600 to 700 http 
request per second, on the servlets that produces the same load of 
RabbitMQ messages.

We noticed that sometimes, consumers hang (well, they 
are not blocked, but they dont consume messages anymore). We can see 
that because each consumer save around 100 msg/sec in database, so when 
one is stopping consumming, the overall messages saved per seconds in DB
 fall down with the same ratio (if let say 3 consumers stop, we fall 
around 600 msg/sec to 300 msg/sec).


During that time, the producers are ok, and still produce at the 
jmeter rate (around 600 msg/sec). The messages are in the queues and 
taken by the consumers still "alive". 


We load all the servlets with the producers first, then launch all 
the consumers one by one, checking if the connexions are ok, then run 
jmeter.


We are sending messages to one direct exchange. All consumers are 
listening to one persistent queue bounded to the exchange. 


That point is major for our choice. Have you seen this with rabbitmq,
 do you have an idea of what is going on ?
FYI there has been a similar issue here, but it wasn't resolved : http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html



Thank you for your answers.

            
Florence.



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/a35bb4b4/attachment-0001.htm>

From alexandru at rabbitmq.com  Tue Jul 20 09:57:05 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Tue, 20 Jul 2010 09:57:05 +0100 (BST)
Subject: [rabbitmq-discuss] Rabbitmq v. 1.8.1 - Bug report - Could not
 start a node as RAM node in cluster
In-Reply-To: <003301cb27d0$18e012d0$4aa03870$@liu@nyapc.com>
References: <003301cb27d0$18e012d0$4aa03870$@liu@nyapc.com>
Message-ID: <alpine.LNX.2.00.1007200954130.2641@dakota>


Thanks for pointing this out.  We've filed a bug for it.  For now, please
disregard the node_type repported by rabbitmqctl status.

Regards,
Alexandru

On Tue, 20 Jul 2010, Yong Liu wrote:

>
> Hello, I am a new comer to the rabbitmq world.
>
> ?
>
> While trying to start a node as a RAM node in a rabbitmq cluster, I found that it would not work as indicated on the website.
>
> ?
>
> ?rabbit2$ rabbitmqctl cluster rabbit at rabbit1?
>
> ?
>
> The result shows rabbit2 is a DISC node, not a RAM node.
>
> Rabbit2$ rabbitmqctl status
>
> Status of node rabbit at rabbit3 ...
>
> [...,
>
>  {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
>
>  {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
>
> ...done.
>
> ?
>
> Testing environment:
>
> OS: FreeBSD 8.1
>
> Rabbitmq: 1.8.1
>
> ?
>
> Another question would be if a node does not join a cluster, would it be configured as a RAM node.? If so, how do I do it?
>
> ?
>
> Your prompt reply is very much appreciated!
>
> ?
>
> Yong
>
> ?
>
>
>

From simon at rabbitmq.com  Tue Jul 20 10:26:32 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Jul 2010 10:26:32 +0100
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
In-Reply-To: <281503.55292.qm@web26001.mail.ukl.yahoo.com>
References: <281503.55292.qm@web26001.mail.ukl.yahoo.com>
Message-ID: <4C456BC8.3020705@rabbitmq.com>

On 20/07/10 09:55, Florence Chabanois wrote:
<snip>
> We noticed that /*sometimes*/, consumers hang (well, they are not
> blocked, but they dont consume messages anymore). We can see that
> because each consumer save around 100 msg/sec in database, so when one
> is stopping consumming, the overall messages saved per seconds in DB
> fall down with the same ratio (if let say 3 consumers stop, we fall
> around 600 msg/sec to 300 msg/sec).
<snip>
> FYI there has been a similar issue here, but it wasn't resolved :
> http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html

Hi Florence. One possibility that was considered in the linked thread 
was that all the messages were being sent to some consumers due to 
basic.qos not being set (in the absence of basic.qos, Rabbit is allowed 
to do that).

So:

* Are you setting the basic.qos prefetch count?
* What does rabbitmqctl lists_queues say about he queue when the system 
is in this state?
* Are you able to post your spike code anywhere?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From yong.liu at nyapc.com  Tue Jul 20 10:29:20 2010
From: yong.liu at nyapc.com (Yong Liu)
Date: Tue, 20 Jul 2010 17:29:20 +0800
Subject: [rabbitmq-discuss] Rabbitmq v. 1.8.1 - Bug report - Could not
	start a node as RAM node in cluster
In-Reply-To: <alpine.LNX.2.00.1007200954130.2641@dakota>
References: <003301cb27d0$18e012d0$4aa03870$@liu@nyapc.com>
	<alpine.LNX.2.00.1007200954130.2641@dakota>
Message-ID: <004a01cb27ee$0caff930$260feb90$@liu@nyapc.com>

Thank you for your prompt reply.  
Regards,
Yong

Yong Liu
??????????????
Tel:  +86-10-66416778-238
Fax:  +86-10-66415578
Mob:  +86-13601256745
E-mail: yong.liu at nyapc.com
Add:?????????????2?????A???15?   ???100031


-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru Scvortov
Sent: Tuesday, July 20, 2010 4:57 PM
To: Yong Liu
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Rabbitmq v. 1.8.1 - Bug report - Could not start a node as RAM node in cluster


Thanks for pointing this out.  We've filed a bug for it.  For now, please
disregard the node_type repported by rabbitmqctl status.

Regards,
Alexandru

On Tue, 20 Jul 2010, Yong Liu wrote:

>
> Hello, I am a new comer to the rabbitmq world.
>
> ?
>
> While trying to start a node as a RAM node in a rabbitmq cluster, I found that it would not work as indicated on the website.
>
> ?
>
> rabbit2$ rabbitmqctl cluster rabbit at rabbit1
>
> ?
>
> The result shows rabbit2 is a DISC node, not a RAM node.
>
> Rabbit2$ rabbitmqctl status
>
> Status of node rabbit at rabbit3 ...
>
> [...,
>
>  {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
>
>  {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
>
> ...done.
>
> ?
>
> Testing environment:
>
> OS: FreeBSD 8.1
>
> Rabbitmq: 1.8.1
>
> ?
>
> Another question would be if a node does not join a cluster, would it be configured as a RAM node.? If so, how do I do it?
>
> ?
>
> Your prompt reply is very much appreciated!
>
> ?
>
> Yong
>
> ?
>
>
>


From sunkini at gmail.com  Tue Jul 20 10:38:28 2010
From: sunkini at gmail.com (Sunil Kini)
Date: Tue, 20 Jul 2010 15:08:28 +0530
Subject: [rabbitmq-discuss] Disaster Recovery / Disaster tolerance Features
Message-ID: <AANLkTilfNTonchcLK7oyQmtqCOP9Wuoo-dlKrs5u1Yfx@mail.gmail.com>

Hello,

I wanted to know what kind of Disaster recovery / Disaster tolerance
features are available in RabbitMQ.

How does RabbitMQ guarantee complete recovery of messages after the
disaster(broker down)? and also how does it perform a fail-over?

Thanks in advance,
Sunil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/d32eeb2a/attachment.htm>

From matthew at rabbitmq.com  Tue Jul 20 11:31:22 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 20 Jul 2010 11:31:22 +0100
Subject: [rabbitmq-discuss] Does TTL for message implemented in
 rabbitmq? No, not yet <eom>
In-Reply-To: <456B14F1A5382845A58F29F652D38DC10EAEBE3A70@VMBX116.ihostexchange.net>
References: <456B14F1A5382845A58F29F652D38DC10EAEBE3A70@VMBX116.ihostexchange.net>
Message-ID: <20100720103121.GH24186@rabbitmq.com>


From flocha2000-agile at yahoo.fr  Tue Jul 20 11:38:51 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Tue, 20 Jul 2010 10:38:51 +0000 (GMT)
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
Message-ID: <777676.82785.qm@web26002.mail.ukl.yahoo.com>


Hi Simon (sorry for answering twice),

Thanks for your reply. We didn't find how to configure 
the basic.qos in the java API. Here is our spike code :

??? 
private void consommeEvenements() throws IOException {
??? ??? 
Channel channel = acteurRabbitMQ.chaines.get(QUEUE_PRINCIPALE);
??? 
??? QueueingConsumer consumer = new QueueingConsumer(channel);
??? 
??? channel.basicConsume(QUEUE_PRINCIPALE.name(), consumer);
??? ??? 
while (channel.isOpen()) {
??? ??? ??? QueueingConsumer.Delivery 
evenementBrut = null;
??? ??????? EvenementStat evenementRecu = null;
???
 ??? ??? try
 {
??? ??? ??? ??? evenementBrut = consumer.nextDelivery();
??? 
??? ??????? evenementRecu = decode(evenementBrut);
??? ??? ??????? 
logger.info("evenement recu : " + evenementRecu);
??? ??? ??????? 
simuleErreurBaseDeDonnees(evenementRecu);
??? ??? ??? } catch 
(IOException e) {
??? ??? ??? ??? logger.fatal("Soucis de 
deserialize", e);
??? ??? ??? } catch (Exception e) {
??? ??? ??? 
??? logger.error("Soucis d'?criture en base", e);
??? ???
 ??? ??? if (evenementRecu.estReinjectable()) {
??? ??? ??? ??? ??? 
logger.info("--> renvoi de " + evenementRecu);
??? ??? ??? ??? ???
 programmeRepublication(evenementRecu);
??? ??? ??? ??? } else {
???
 ??? ??? ??? ??? logger.info("--> DEAD LETTER " + evenementRecu);
???
 ??? ??? ??? ??? acteurRabbitMQ.publie(evenementRecu, 
QUEUE_DEAD_LETTER);
??? ??? ??? ??? }
??? ??? ??? }
??? ??? ???
 boolean
 ackMultiple = false;
??? ??? ??? final long deliveryTag = 
evenementBrut.getEnvelope().getDeliveryTag();
??? ??? ??? 
logger.info("ACK " + deliveryTag);
??? ??? ??? 
channel.basicAck(deliveryTag, ackMultiple);
??? ??? }
??? ??? 
acteurRabbitMQ.ferme();
??? }

Yet, I'm not sure the basic.qos 
is the issue as long as the 6 consumers sometimes keep consuming the 
messages during the 10 minutes bench, and sometimes not. 

When 
the problem occurs, the list_queues option displays that the queue 
starts growing because the "active" (the ones that keep on consuming) 
consumers cannot insert in DB the overall messages load fast enough.

Cheers,
 
Florence.


--- En date de?: Mar 20.7.10, Florence Chabanois <flocha2000-agile at yahoo.fr> a ?crit?:


De: Simon MacMullen <simon at rabbitmq.com>
Objet: Re: [rabbitmq-discuss] Consumers stopped consuming messages
?: rabbitmq-discuss at lists.rabbitmq.com
Date: Mardi 20 juillet 2010, 11h26

On 20/07/10 09:55, Florence Chabanois wrote:
<snip>
> We noticed that /*sometimes*/, consumers hang (well, they are not
> blocked, but they dont consume messages anymore). We can see that
> because each consumer save around 100 msg/sec in database, so when one
> is stopping consumming, the overall messages saved per seconds in DB
> fall down with the same ratio (if let say 3 consumers stop, we fall
> around 600 msg/sec to 300 msg/sec).
<snip>
> FYI there has been a similar issue here, but it wasn't resolved
 :
> http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html

Hi Florence. One possibility that was considered in the linked thread was that all the messages were being sent to some consumers due to basic.qos not being set (in the absence of basic.qos, Rabbit is allowed to do that).

So:

* Are you setting the basic.qos prefetch count?
* What does rabbitmqctl lists_queues say about he queue when the system is in this state?
* Are you able to post your spike code anywhere?

Cheers, Simon

-- Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss






      


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/59dbb7b0/attachment-0001.htm>

From david at rabbitmq.com  Tue Jul 20 12:11:43 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 20 Jul 2010 12:11:43 +0100
Subject: [rabbitmq-discuss] python publish an unroutable message
In-Reply-To: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>
	(Ovidiu Deac's message of "Sun, 18 Jul 2010 20:51:04 +0300")
References: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>
Message-ID: <yrv4chbjuz9u8.fsf@dwragg.eng.vmware.com>

Hi Ovidiu,

Ovidiu Deac <ovidiudeac at gmail.com> writes:
> Does anyone have an example of using the mandatory flag to detect
> unroutable messages in python?

Such an example would be specific to each python AMQP client library, of
which there are several.  Are you already using a particular client
library?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From mikeb at rabbitmq.com  Tue Jul 20 12:21:59 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 20 Jul 2010 12:21:59 +0100
Subject: [rabbitmq-discuss] Integrating NServiceBus and RabbitMQ
In-Reply-To: <008b01cb25c3$7b96c540$72c44fc0$@com>
References: <008b01cb25c3$7b96c540$72c44fc0$@com>
Message-ID: <4C4586D7.8020903@rabbitmq.com>

Hi Udi,

> I've been hearing from many of my clients of the desire to use 
> NServiceBus (an open source .NET service bus) on Linux by using Mono.
> 
> The thing missing is that MSMQ (the default transport used by 
> NServiceBus) isn't available on Linux (duh :-) )
> 
>  
> 
> In terms of high availability and transactional support, I think that 
> RabbitMQ is the best option for enabling the above.
> 
> The thing is if there are certain APIs that should (or should not) be 
> used for working with RabbitMQ in "federated mode" - no central broker. 
> Also, is there anything special that needs to be done to flow 
> transactions from the application level into RabbitMQ and enlisting it 
> into distributed transactions?

On the surface of things, I too would expect RabbitMQ to be suitable for 
backing a message bus; and, RabbitMQ is already used in Mono for messaging:
http://www.mono-project.com/SystemMessaging

That may be enough for what you want to do -- I don't know the .NET APIs 
well enough to judge.

 From your description, though, it looks like NServiceBus's design has 
assumptions about the transport that would make your intended use difficult.

RabbitMQ is designed to be a central broker, in that its model is fitted 
to AMQP, which is a client-broker protocol.  Addresses are scoped to the 
broker.

The MSMQ model, as I understand it, is that the queues are local 
transmission buffers, and addressing is global.

It would take some work to implement the MSMQ model with the AMQP model. 
  In particular I would guess it can't be accomplished without adapting 
the broker (e.g., with a plugin) or at least out-of-band communication 
between clients, which would rather undermine the effort.

We are looking into models of federation, so I'll keep this use case in 
mind.

With regard to distributed transactions, RabbitMQ doesn't support them. 
  If I recall, they were mentioned but not specified in AMQP 0-8, and 
the mention removed in AMQP 0-9-1.  RabbitMQ does support local 
transactions, scoped to channels.  But again, I think it would require 
modification (and probably substantial development) to support 
distributed transactions.


Regards,
Michael

From ozhurakousky at vmware.com  Tue Jul 20 12:22:58 2010
From: ozhurakousky at vmware.com (Oleg Zhurakousky)
Date: Tue, 20 Jul 2010 04:22:58 -0700
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
Message-ID: <7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>

Irmo

Here is an excerpt from Mark Fisher's (SpringSource) announcement last week regarding Spring AMQP. Is that what you were looking for?

==========================
The community download site will have these distributions soon, but you can grab them directly from S3:
  https://s3browse.springsource.com/browse/dist.springframework.org/milestone/AMQP/

If you're using Maven, the JARs are available here (they will be available in EBR soon):
  https://s3browse.springsource.com/browse/maven.springframework.org/milestone/org/springframework/amqp/

The Reference Manuals are a great place to start - especially the walk-through of our 2 samples (helloworld and stocks):
  http://static.springsource.org/spring-amqp/docs/1.0.x/reference/htmlsingle/
  http://static.springsource.org/spring-amqp-net/docs/1.0.x/reference/html/

For all other links, please visit the official project homepage:
  http://www.springsource.org/spring-amqp


On Jul 20, 2010, at 3:07 AM, Irmo Manie wrote:

Hi Jon,

On Mon, Jul 19, 2010 at 11:25 PM, Jon Brisbin <jon.brisbin at npcinternational.com<mailto:jon.brisbin at npcinternational.com>> wrote:
Is the spring-amqp stuff on a Maven repo somewhere yet? I'm thinking about branching my async cache stuff and trying to integrate it with spring-amqp.


Do you by any chance mean this spring-amqp code: http://github.com/momania/spring-rabbitmq
If so, there is nothing on any maven repo of that. Also it's not maintained anymore. (Not by me at least ;) )

Along those lines, what kinds of performance testing has this undergone? I'll be interested to see how it performs compared to a completely asynchronous send-receive pattern like I'm using now. I've found that I get better throughput if I don't directly send or receive any messages. I've been using consumers and dedicated message senders to handle all the messaging communication and use BlockingQueues exclusively for communication between the threads that actually do the work. It seems, in my cursory glances at the source code, that spring-amqp does something similar.

As it is not very well maintained and also what a first raw take at the code it hasn't undergone much testing.

My suggestion is to wait a couple of more days for the first rabbitmq/amqp integration from SpringSource. That should be available very soon in a RC1 stage. Anybody from SpringSource/RabbitMQ team should be able to give a indication on this

Cheers,
Irmo


Jon Brisbin
Portal Webmaster
NPC International, Inc.



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

<ATT00001..txt>


From ovidiudeac at gmail.com  Tue Jul 20 12:42:18 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Tue, 20 Jul 2010 14:42:18 +0300
Subject: [rabbitmq-discuss] python publish an unroutable message
In-Reply-To: <yrv4chbjuz9u8.fsf@dwragg.eng.vmware.com>
References: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>
	<yrv4chbjuz9u8.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTilZXrpf7oMhBvxbSEyA5EuJwQW7QqTT3xoQ9Loj@mail.gmail.com>

I'm using py-amqplib but it's not a problem to switch to another
library if it's easier to use.

On Tue, Jul 20, 2010 at 2:11 PM, David Wragg <david at rabbitmq.com> wrote:
> Hi Ovidiu,
>
> Ovidiu Deac <ovidiudeac at gmail.com> writes:
>> Does anyone have an example of using the mandatory flag to detect
>> unroutable messages in python?
>
> Such an example would be specific to each python AMQP client library, of
> which there are several. ?Are you already using a particular client
> library?
>
> Dav
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>

From markfisher at vmware.com  Tue Jul 20 12:43:17 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Tue, 20 Jul 2010 04:43:17 -0700
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>,
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
Message-ID: <392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>

Irmo,

And here's the official announcement that I published on springsource.org on Saturday: http://www.springsource.org/node/2715

Cheers,
Mark
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Oleg Zhurakousky [ozhurakousky at vmware.com]
Sent: Tuesday, July 20, 2010 7:22 AM
To: Irmo Manie
Cc: RabbitMQ
Subject: Re: [rabbitmq-discuss] spring-amqp

Irmo

Here is an excerpt from Mark Fisher's (SpringSource) announcement last week regarding Spring AMQP. Is that what you were looking for?

==========================
The community download site will have these distributions soon, but you can grab them directly from S3:
  https://s3browse.springsource.com/browse/dist.springframework.org/milestone/AMQP/

If you're using Maven, the JARs are available here (they will be available in EBR soon):
  https://s3browse.springsource.com/browse/maven.springframework.org/milestone/org/springframework/amqp/

The Reference Manuals are a great place to start - especially the walk-through of our 2 samples (helloworld and stocks):
  http://static.springsource.org/spring-amqp/docs/1.0.x/reference/htmlsingle/
  http://static.springsource.org/spring-amqp-net/docs/1.0.x/reference/html/

For all other links, please visit the official project homepage:
  http://www.springsource.org/spring-amqp


On Jul 20, 2010, at 3:07 AM, Irmo Manie wrote:

Hi Jon,

On Mon, Jul 19, 2010 at 11:25 PM, Jon Brisbin <jon.brisbin at npcinternational.com<mailto:jon.brisbin at npcinternational.com>> wrote:
Is the spring-amqp stuff on a Maven repo somewhere yet? I'm thinking about branching my async cache stuff and trying to integrate it with spring-amqp.


Do you by any chance mean this spring-amqp code: http://github.com/momania/spring-rabbitmq
If so, there is nothing on any maven repo of that. Also it's not maintained anymore. (Not by me at least ;) )

Along those lines, what kinds of performance testing has this undergone? I'll be interested to see how it performs compared to a completely asynchronous send-receive pattern like I'm using now. I've found that I get better throughput if I don't directly send or receive any messages. I've been using consumers and dedicated message senders to handle all the messaging communication and use BlockingQueues exclusively for communication between the threads that actually do the work. It seems, in my cursory glances at the source code, that spring-amqp does something similar.

As it is not very well maintained and also what a first raw take at the code it hasn't undergone much testing.

My suggestion is to wait a couple of more days for the first rabbitmq/amqp integration from SpringSource. That should be available very soon in a RC1 stage. Anybody from SpringSource/RabbitMQ team should be able to give a indication on this

Cheers,
Irmo


Jon Brisbin
Portal Webmaster
NPC International, Inc.



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

<ATT00001..txt>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From markfisher at vmware.com  Tue Jul 20 15:12:26 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Tue, 20 Jul 2010 07:12:26 -0700
Subject: [rabbitmq-discuss] Spring AMQP 1.0 Milestone 1 released
Message-ID: <392922E81643B245A905B42E3E34C24014D3516A75@EXCH-MBX-1.vmware.com>

A few recent mails on this list have referred to the Spring AMQP 1.0 M1 release, so I wanted to take this opportunity to *formally* announce it here.

Indeed, the first milestone release of the Spring AMQP 1.0 project is now available for both Java and .NET, and you can download the distribution ZIPs from the SpringSource community download page:
Spring AMQP for Java:  http://www.springsource.com/download/community?project=Spring%20AMQP
Spring AMQP for .NET:  http://www.springsource.com/download/community?project=Spring%20AMQP.NET

I would highly recommend reading the Reference Manual(s):
for Java:  http://static.springsource.org/spring-amqp/docs/1.0.x/reference/htmlsingle/
for .NET:  http://static.springsource.org/spring-amqp-net/docs/1.0.x/reference/html/

(If you just want to get a quick feel for the programming model, at least browse Chapter 3: Sample Applications).

For all other resources (source code repository, issue tracker, forum, etc.), please visit the homepage: http://www.springsource.org/spring-amqp

For those using Maven, the Spring AMQP for Java M1 JARs are available from the SpringSource milestone repository. Here is the relevant POM excerpt:
    <repository>
        <id>repository.springframework.maven.milestone</id>
        <name>Spring Framework Maven Milestone Repository</name>
        <url>http://maven.springframework.org/milestone</url>
    </repository>

Finally, to briefly describe the goals of the project, here is an excerpt for the official announcement on springsource.org:
"Spring AMQP makes common Spring idioms available to developers who are building AMQP-based messaging solutions. For example, building a messaging application that uses RabbitMQ (http://rabbitmq.com) as a broker will feel quite similar to building an application based on Spring's JMS support. To learn more about the project, visit the Spring AMQP Homepage (http://www.springsource.org/spring-amqp). There you will find links to the Reference Manual, Forum, Issue Tracker, and more."

We are really looking forward to feedback from the community to help drive the project as we progress toward a GA release.

Regards,
Mark

From simon at rabbitmq.com  Tue Jul 20 16:07:59 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Jul 2010 16:07:59 +0100
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
In-Reply-To: <777676.82785.qm@web26002.mail.ukl.yahoo.com>
References: <777676.82785.qm@web26002.mail.ukl.yahoo.com>
Message-ID: <4C45BBCF.7030008@rabbitmq.com>

Hi Florence. As far as I can see this is reasonable. It's always worth 
setting the prefetch count when using basic.consume (add a line like:

channel.basicQos(100);

before the channel.basicConsume line in order to ensure you never have 
more than 100 messages queued up in your QueueingConsumer). However, I 
don't think that's your problem.

I assume you have checked that the consumers are idle and waiting for 
message deliveries (with Ctrl+Break / SIGQUIT). Does anything appear in 
the server logs when consumers stop consuming?

Cheers, Simon

On 20/07/10 11:38, Florence Chabanois wrote:
>
> Hi Simon (sorry for answering twice),
>
> Thanks for your reply. We didn't find how to configure the basic.qos in
> the java API. Here is our spike code :
>
> private void consommeEvenements() throws IOException {
> Channel channel = acteurRabbitMQ.chaines.get(QUEUE_PRINCIPALE);
> QueueingConsumer consumer = new QueueingConsumer(channel);
> channel.basicConsume(QUEUE_PRINCIPALE.name(), consumer);
> while (channel.isOpen()) {
> QueueingConsumer.Delivery evenementBrut = null;
> EvenementStat evenementRecu = null;
> try {
> evenementBrut = consumer.nextDelivery();
> evenementRecu = decode(evenementBrut);
> logger.info("evenement recu : " + evenementRecu);
> simuleErreurBaseDeDonnees(evenementRecu);
> } catch (IOException e) {
> logger.fatal("Soucis de deserialize", e);
> } catch (Exception e) {
> logger.error("Soucis d'?criture en base", e);
> if (evenementRecu.estReinjectable()) {
> logger.info("--> renvoi de " + evenementRecu);
> programmeRepublication(evenementRecu);
> } else {
> logger.info("--> DEAD LETTER " + evenementRecu);
> acteurRabbitMQ.publie(evenementRecu, QUEUE_DEAD_LETTER);
> }
> }
> boolean ackMultiple = false;
> final long deliveryTag = evenementBrut.getEnvelope().getDeliveryTag();
> logger.info("ACK " + deliveryTag);
> channel.basicAck(deliveryTag, ackMultiple);
> }
> acteurRabbitMQ.ferme();
> }
>
> Yet, I'm not sure the basic.qos is the issue as long as the 6 consumers
> sometimes keep consuming the messages during the 10 minutes bench, and
> sometimes not.
>
> When the problem occurs, the list_queues option displays that the queue
> starts growing because the "active" (the ones that keep on consuming)
> consumers cannot insert in DB the overall messages load fast enough.
>
> Cheers,
> Florence.
>
>
> --- En date de : *Mar 20.7.10, Florence Chabanois
> /<flocha2000-agile at yahoo.fr>/* a ?crit :
>
>
>
>         De: Simon MacMullen <simon at rabbitmq.com>
>         Objet: Re: [rabbitmq-discuss] Consumers stopped consuming messages
>         ?: rabbitmq-discuss at lists.rabbitmq.com
>         Date: Mardi 20 juillet 2010, 11h26
>
>         On 20/07/10 09:55, Florence Chabanois wrote:
>         <snip>
>          > We noticed that /*sometimes*/, consumers hang (well, they are not
>          > blocked, but they dont consume messages anymore). We can see that
>          > because each consumer save around 100 msg/sec in database, so
>         when one
>          > is stopping consumming, the overall messages saved per
>         seconds in DB
>          > fall down with the same ratio (if let say 3 consumers stop,
>         we fall
>          > around 600 msg/sec to 300 msg/sec).
>         <snip>
>          > FYI there has been a similar issue here, but it wasn't resolved :
>          >
>         http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html
>
>         Hi Florence. One possibility that was considered in the linked
>         thread was that all the messages were being sent to some
>         consumers due to basic.qos not being set (in the absence of
>         basic.qos, Rabbit is allowed to do that).
>
>         So:
>
>         * Are you setting the basic.qos prefetch count?
>         * What does rabbitmqctl lists_queues say about he queue when the
>         system is in this state?
>         * Are you able to post your spike code anywhere?
>
>         Cheers, Simon
>
>         -- Simon MacMullen
>         Staff Engineer, RabbitMQ
>         SpringSource, a division of VMware
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From flocha2000-agile at yahoo.fr  Tue Jul 20 17:15:59 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Tue, 20 Jul 2010 16:15:59 +0000 (GMT)
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
In-Reply-To: <4C45BBCF.7030008@rabbitmq.com>
Message-ID: <164116.1510.qm@web26001.mail.ukl.yahoo.com>


I assume you have checked that the consumers are idle and waiting for 
message
 deliveries (with Ctrl+Break / SIGQUIT). Does anything appear in 
the
 server logs when consumers stop consuming?

> we used "ps aux | grep " to see if the consumers were still running and only checked the consumers logs not the brokers'. I'll let you know if I see anything here.

Cheers,
Florence.

--- En date de?: Mar 20.7.10, Simon MacMullen <simon at rabbitmq.com> a ?crit?:

De: Simon MacMullen <simon at rabbitmq.com>
Objet: Re: [rabbitmq-discuss] Consumers stopped consuming messages
?: rabbitmq-discuss at lists.rabbitmq.com
Date: Mardi 20 juillet 2010, 17h07

Hi Florence. As far as I can see this is reasonable. It's always worth 
setting the prefetch count when using basic.consume (add a line like:

channel.basicQos(100);

before the channel.basicConsume line in order to ensure you never have 
more than 100 messages queued up in your QueueingConsumer). However, I 
don't think that's your problem.

I assume you have checked that the consumers are idle and waiting for 
message deliveries (with Ctrl+Break / SIGQUIT). Does anything appear in 
the server logs when consumers stop consuming?

Cheers, Simon

On 20/07/10 11:38, Florence Chabanois wrote:
>
> Hi Simon (sorry for answering twice),
>
> Thanks for your reply. We didn't find how to configure the basic.qos in
> the java API. Here is our spike code :
>
> private void consommeEvenements() throws IOException {
> Channel channel = acteurRabbitMQ.chaines.get(QUEUE_PRINCIPALE);
> QueueingConsumer consumer = new QueueingConsumer(channel);
> channel.basicConsume(QUEUE_PRINCIPALE.name(), consumer);
> while (channel.isOpen()) {
> QueueingConsumer.Delivery evenementBrut = null;
> EvenementStat evenementRecu = null;
> try {
> evenementBrut = consumer.nextDelivery();
> evenementRecu = decode(evenementBrut);
> logger.info("evenement recu : " + evenementRecu);
> simuleErreurBaseDeDonnees(evenementRecu);
> } catch (IOException e) {
> logger.fatal("Soucis de deserialize", e);
> } catch (Exception e) {
> logger.error("Soucis d'?criture en base", e);
> if (evenementRecu.estReinjectable()) {
> logger.info("--> renvoi de " + evenementRecu);
> programmeRepublication(evenementRecu);
> } else {
> logger.info("--> DEAD LETTER " + evenementRecu);
> acteurRabbitMQ.publie(evenementRecu, QUEUE_DEAD_LETTER);
> }
> }
> boolean ackMultiple = false;
> final long deliveryTag = evenementBrut.getEnvelope().getDeliveryTag();
> logger.info("ACK " + deliveryTag);
> channel.basicAck(deliveryTag, ackMultiple);
> }
> acteurRabbitMQ.ferme();
> }
>
> Yet, I'm not sure the basic.qos is the issue as long as the 6 consumers
> sometimes keep consuming the messages during the 10 minutes bench, and
> sometimes not.
>
> When the problem occurs, the list_queues option displays that the queue
> starts growing because the "active" (the ones that keep on consuming)
> consumers cannot insert in DB the overall messages load fast enough.
>
> Cheers,
> Florence.
>
>
> --- En date de : *Mar 20.7.10, Florence Chabanois
> /<flocha2000-agile at yahoo.fr>/* a ?crit :
>
>
>
>? ? ? ???De: Simon MacMullen <simon at rabbitmq.com>
>? ? ? ???Objet: Re: [rabbitmq-discuss] Consumers stopped consuming messages
>? ? ? ????: rabbitmq-discuss at lists.rabbitmq.com
>? ? ? ???Date: Mardi 20 juillet 2010, 11h26
>
>? ? ? ???On 20/07/10 09:55, Florence Chabanois wrote:
>? ? ? ???<snip>
>? ? ? ? ? > We noticed that /*sometimes*/, consumers hang (well, they are not
>? ? ? ? ? > blocked, but they dont consume messages anymore). We can see that
>? ? ? ? ? > because each consumer save around 100 msg/sec in database, so
>? ? ? ???when one
>? ? ? ? ? > is stopping consumming, the overall messages saved per
>? ? ? ???seconds in DB
>? ? ? ? ? > fall down with the same ratio (if let say 3 consumers stop,
>? ? ? ???we fall
>? ? ? ? ? > around 600 msg/sec to 300 msg/sec).
>? ? ? ???<snip>
>? ? ? ? ? > FYI there has been a similar issue here, but it wasn't resolved :
>? ? ? ? ? >
>? ? ? ???http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html
>
>? ? ? ???Hi Florence. One possibility that was considered in the linked
>? ? ? ???thread was that all the messages were being sent to some
>? ? ? ???consumers due to basic.qos not being set (in the absence of
>? ? ? ???basic.qos, Rabbit is allowed to do that).
>
>? ? ? ???So:
>
>? ? ? ???* Are you setting the basic.qos prefetch count?
>? ? ? ???* What does rabbitmqctl lists_queues say about he queue when the
>? ? ? ???system is in this state?
>? ? ? ???* Are you able to post your spike code anywhere?
>
>? ? ? ???Cheers, Simon
>
>? ? ? ???-- Simon MacMullen
>? ? ? ???Staff Engineer, RabbitMQ
>? ? ? ???SpringSource, a division of VMware
>
>? ? ? ???_______________________________________________
>? ? ? ???rabbitmq-discuss mailing list
>? ? ? ???rabbitmq-discuss at lists.rabbitmq.com
>? ? ? ???https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100720/ca49991c/attachment.htm>

From akhil.kodali at gmail.com  Wed Jul 21 08:07:07 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 12:37:07 +0530
Subject: [rabbitmq-discuss] timed / delayed messages
In-Reply-To: <AANLkTimro1bfQeeO7gj9YM05xQlQiEe1QtEnj-KSndiZ@mail.gmail.com>
References: <AANLkTikmTUpjRdcQRoazhD8JjAi1gEUJ5nm_QRGkMRin@mail.gmail.com> 
	<AANLkTimro1bfQeeO7gj9YM05xQlQiEe1QtEnj-KSndiZ@mail.gmail.com>
Message-ID: <AANLkTinjqiuWUlm92zW00ISdKjFRJlzM6zvUJNcFCpjL@mail.gmail.com>

Thanks for the info
----
Regards,
Akhil Kodali



On Tue, Jul 13, 2010 at 4:00 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Fri, Jul 9, 2010 at 21:46, Akhil Kodali <akhil.kodali at gmail.com> wrote:
> > [...]
> > If I use this approach I'd end up having 2 hrs worth of messages in the
> > queue.
> > It aint much now but I see it going upto 20,000 in 2 hrs quickly.
> > Or would it be better making a DB query to do the same. Going through all
> > the rows doesnt seem right.
> > What I wanted to check was, are queues build for such a use case or is
> there
> > a better way of doing it?
>
> RabbitMQ should be able to handle 20k messages without any troubles.
> But as all the messages are stored in memroy, please make sure that
> you have enough RAM+swap available.
>
> You also should make sure that the messages are relatively small.
>
> If you want to handle even more data in queues, you could use our
> experimental
> code. In one of our development code branches we try to make rabbit dump
> queues
> to the disk, when it's running short of memory.
>
> Hope that helps.
>
> Cheers,
>   Marek Majkowski
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/402f79e3/attachment.htm>

From akhil.kodali at gmail.com  Wed Jul 21 08:14:35 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 12:44:35 +0530
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <4C31EE63.10405@rabbitmq.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com> 
	<4C31EE63.10405@rabbitmq.com>
Message-ID: <AANLkTilZ_q7iWoWv2yxpXsyT91pxOjZwVE_z17epczVD@mail.gmail.com>

Hi,

I cant seem to get bql working after creating the rabbitmq.conf file with
content mentioned.
I get a crash dump when it try to execute bql


Pasting rabbitmq status and bql output


root at akhil-laptop:~# rabbitmqctl status
Status of node 'rabbit at akhil-laptop' ...
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
      {rabbitmq_bql,"RabbitMQ Broker Query Language","0.01"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
      {rabbit_status,"RabbitMQ Status Page","0.01"},
      {rabbit,"RabbitMQ","1.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbithub,"rabbithub","0.0.1"},
      {crypto,"CRYPTO version 1","1.6.3"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mochiweb,"MochiMedia Web Server","0.01"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,['rabbit at akhil-laptop']}]},
 {running_nodes,['rabbit at akhil-laptop']}]
...done.


akhil at akhil-laptop:~/rabbitmq-public-umbrella/rabbitmq-bql/scripts$ sudo
./bql
{"init terminating in
do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()



----
Regards,
Akhil Kodali



On Mon, Jul 5, 2010 at 8:08 PM, Alexandru Scvortov
<alexandru at rabbitmq.com>wrote:

> Hi,
>
> As you say, it's not really a bug.  If all you need is the bql plugin,
> this rabbitmq.config should be fine (you may need to change the user and
> password):
>
> [
>  {rabbitmq_bql, [
>    {user, "guest"},
>    {password, "guest"}
>  ]}
> ].
>
> Also, you said /etc/rabbitmq/rabbitmq.conf.   What you want is probably
> rabbitmq.config.
>
> Cheers,
> Alex
>
> On 07/05/2010 03:00 PM, Akhil Kodali wrote:
> > Hi,
> >
> > I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
> > I was unable to find /etc/rabbitmq/rabbitmq.conf
> > /etc/rabbitmq is empty.
> >
> > but the rabbitmq seems to be running fine.
> >
> > I needed to edit the file to install bql plugin.
> >
> > Anyone face such issue earlier.
> >
> > ----
> > Regards,
> > Akhil Kodali
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/128a95f0/attachment-0001.htm>

From akhil.kodali at gmail.com  Wed Jul 21 08:16:56 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 12:46:56 +0530
Subject: [rabbitmq-discuss] reg rabbithub how to
Message-ID: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>

Hi,

I compiled and installed rabbithub as a rabbitmq plugin from github.

What do I do next? I mean how do I begin using it.
I am trying to use it primarily as a REST way for consuming from queues.

Thank you

Akhil Kodali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/6fe98ad6/attachment.htm>

From akhil.kodali at gmail.com  Wed Jul 21 08:19:58 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 12:49:58 +0530
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
Message-ID: <AANLkTimrUT9-1kmenc1B2lLE2zBNUTtmeKqod5vXQvfx@mail.gmail.com>

Hi,

Forgot to mention.
I don't seem to have anything running on port 8000.
Am I missing something?

Heres the output for rabbitmqctl status

root at akhil-laptop:~# rabbitmqctl status
Status of node 'rabbit at akhil-laptop' ...
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
      {rabbitmq_bql,"RabbitMQ Broker Query Language","0.01"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
      {rabbit_status,"RabbitMQ Status Page","0.01"},
      {rabbit,"RabbitMQ","1.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbithub,"rabbithub","0.0.1"},
      {crypto,"CRYPTO version 1","1.6.3"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
      {mochiweb,"MochiMedia Web Server","0.01"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,['rabbit at akhil-laptop']}]},
 {running_nodes,['rabbit at akhil-laptop']}]
...done.



On Wed, Jul 21, 2010 at 12:46 PM, Akhil Kodali <akhil.kodali at gmail.com>wrote:

> Hi,
>
> I compiled and installed rabbithub as a rabbitmq plugin from github.
>
> What do I do next? I mean how do I begin using it.
> I am trying to use it primarily as a REST way for consuming from queues.
>
> Thank you
>
> Akhil Kodali
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/3b42d855/attachment.htm>

From csshenqian at gmail.com  Wed Jul 21 08:26:05 2010
From: csshenqian at gmail.com (Chester Shen)
Date: Wed, 21 Jul 2010 15:26:05 +0800
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java client
	1.8.1
Message-ID: <1279697165.1602.256.camel@chestsh-ubunbu>

Hi.

In my huge memory consumption program when it hit the memory watermark
the client will receive a channel.flow{active=false} which I can capture
in FlowListener, then I need to send a channel.flow_ok{active=false} to
acknowledge it, but I do not know how to do it in java client 1.8.1. 
Is there a method that I miss or it has not been implemented yet?

Thanks!


From pauljones23 at gmail.com  Wed Jul 21 08:26:47 2010
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 21 Jul 2010 08:26:47 +0100
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTilZ_q7iWoWv2yxpXsyT91pxOjZwVE_z17epczVD@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com>
	<4C31EE63.10405@rabbitmq.com>
	<AANLkTilZ_q7iWoWv2yxpXsyT91pxOjZwVE_z17epczVD@mail.gmail.com>
Message-ID: <AANLkTik1d6FYe7AcvrXWD5ixMDvjszzGlziUFl-XWdAq@mail.gmail.com>

Akhil,

The RabbitMQ client cannot be run directly from the script in the source
build. As per the installation instructions at
http://www.rabbitmq.com/rabbitmq-bql.html#installation, you'll need the
built version that is stored in the rabbitmq-bql-client.zip file. A
pre-expanded version of this is put into build/client as part of the build
process, so you can run it from there.

Paul.

On Wed, Jul 21, 2010 at 8:14 AM, Akhil Kodali <akhil.kodali at gmail.com>wrote:

> Hi,
>
> I cant seem to get bql working after creating the rabbitmq.conf file with
> content mentioned.
> I get a crash dump when it try to execute bql
>
>
> Pasting rabbitmq status and bql output
>
>
> root at akhil-laptop:~# rabbitmqctl status
> Status of node 'rabbit at akhil-laptop' ...
> [{running_applications,
>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>       {rabbitmq_bql,"RabbitMQ Broker Query Language","0.01"},
>       {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>       {rabbit_status,"RabbitMQ Status Page","0.01"},
>       {rabbit,"RabbitMQ","1.8.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>       {sasl,"SASL  CXC 138 11","2.1.8"},
>       {rabbithub,"rabbithub","0.0.1"},
>       {crypto,"CRYPTO version 1","1.6.3"},
>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>       {mochiweb,"MochiMedia Web Server","0.01"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>  {nodes,[{disc,['rabbit at akhil-laptop']}]},
>  {running_nodes,['rabbit at akhil-laptop']}]
> ...done.
>
>
> akhil at akhil-laptop:~/rabbitmq-public-umbrella/rabbitmq-bql/scripts$ sudo
> ./bql
> {"init terminating in
> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
>
>
> ----
> Regards,
> Akhil Kodali
>
>
>
>
> On Mon, Jul 5, 2010 at 8:08 PM, Alexandru Scvortov <alexandru at rabbitmq.com
> > wrote:
>
>> Hi,
>>
>> As you say, it's not really a bug.  If all you need is the bql plugin,
>> this rabbitmq.config should be fine (you may need to change the user and
>> password):
>>
>> [
>>  {rabbitmq_bql, [
>>    {user, "guest"},
>>    {password, "guest"}
>>  ]}
>> ].
>>
>> Also, you said /etc/rabbitmq/rabbitmq.conf.   What you want is probably
>> rabbitmq.config.
>>
>> Cheers,
>> Alex
>>
>> On 07/05/2010 03:00 PM, Akhil Kodali wrote:
>> > Hi,
>> >
>> > I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
>> > I was unable to find /etc/rabbitmq/rabbitmq.conf
>> > /etc/rabbitmq is empty.
>> >
>> > but the rabbitmq seems to be running fine.
>> >
>> > I needed to edit the file to install bql plugin.
>> >
>> > Anyone face such issue earlier.
>> >
>> > ----
>> > Regards,
>> > Akhil Kodali
>> >
>> >
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/a792693b/attachment.htm>

From alexis at rabbitmq.com  Wed Jul 21 08:45:09 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 21 Jul 2010 08:45:09 +0100
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
Message-ID: <AANLkTik6VfLdzlKyZ24c3sOMrtrVpSFvnaMU71LkqnZT@mail.gmail.com>

Cool!

Yes the docs are a little opaque.  I've bcc'd the author....

alexis


On Wed, Jul 21, 2010 at 8:16 AM, Akhil Kodali <akhil.kodali at gmail.com> wrote:
> Hi,
>
> I compiled and installed rabbithub as a rabbitmq plugin from github.
>
> What do I do next? I mean how do I begin using it.
> I am trying to use it primarily as a REST way for consuming from queues.
>
> Thank you
>
> Akhil Kodali
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From akhil.kodali at gmail.com  Wed Jul 21 08:45:20 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 13:15:20 +0530
Subject: [rabbitmq-discuss] rabbitmq 1.8.0 on ubuntu lucid
In-Reply-To: <AANLkTik1d6FYe7AcvrXWD5ixMDvjszzGlziUFl-XWdAq@mail.gmail.com>
References: <AANLkTinxwrtoRKfLxiOQy3mSpnh-7azy_e9pmiV2OMnW@mail.gmail.com> 
	<4C31EE63.10405@rabbitmq.com>
	<AANLkTilZ_q7iWoWv2yxpXsyT91pxOjZwVE_z17epczVD@mail.gmail.com> 
	<AANLkTik1d6FYe7AcvrXWD5ixMDvjszzGlziUFl-XWdAq@mail.gmail.com>
Message-ID: <AANLkTil2pMTqcpcaWLTyf6C2YZEPN2LpyXWNG4MSrOiL@mail.gmail.com>

Hi,

That was stupid of me...all working now, thanks for the help

----
Regards,
Akhil Kodali



On Wed, Jul 21, 2010 at 12:56 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Akhil,
>
> The RabbitMQ client cannot be run directly from the script in the source
> build. As per the installation instructions at
> http://www.rabbitmq.com/rabbitmq-bql.html#installation, you'll need the
> built version that is stored in the rabbitmq-bql-client.zip file. A
> pre-expanded version of this is put into build/client as part of the build
> process, so you can run it from there.
>
> Paul.
>
>
> On Wed, Jul 21, 2010 at 8:14 AM, Akhil Kodali <akhil.kodali at gmail.com>wrote:
>
>> Hi,
>>
>> I cant seem to get bql working after creating the rabbitmq.conf file with
>> content mentioned.
>> I get a crash dump when it try to execute bql
>>
>>
>> Pasting rabbitmq status and bql output
>>
>>
>> root at akhil-laptop:~# rabbitmqctl status
>> Status of node 'rabbit at akhil-laptop' ...
>> [{running_applications,
>>      [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","0.01"},
>>       {rabbitmq_bql,"RabbitMQ Broker Query Language","0.01"},
>>       {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
>>       {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
>>       {rabbit_jsonrpc,"Rabbit JSON-RPC","0.01"},
>>       {rabbit_status,"RabbitMQ Status Page","0.01"},
>>       {rabbit,"RabbitMQ","1.8.1"},
>>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>>       {sasl,"SASL  CXC 138 11","2.1.8"},
>>       {rabbithub,"rabbithub","0.0.1"},
>>       {crypto,"CRYPTO version 1","1.6.3"},
>>       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","0.01"},
>>       {mochiweb,"MochiMedia Web Server","0.01"},
>>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>>  {nodes,[{disc,['rabbit at akhil-laptop']}]},
>>  {running_nodes,['rabbit at akhil-laptop']}]
>> ...done.
>>
>>
>> akhil at akhil-laptop:~/rabbitmq-public-umbrella/rabbitmq-bql/scripts$ sudo
>> ./bql
>> {"init terminating in
>> do_boot",{undef,[{bql_shell,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>
>> Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>>
>>
>>
>> ----
>> Regards,
>> Akhil Kodali
>>
>>
>>
>>
>> On Mon, Jul 5, 2010 at 8:08 PM, Alexandru Scvortov <
>> alexandru at rabbitmq.com> wrote:
>>
>>> Hi,
>>>
>>> As you say, it's not really a bug.  If all you need is the bql plugin,
>>> this rabbitmq.config should be fine (you may need to change the user and
>>> password):
>>>
>>> [
>>>  {rabbitmq_bql, [
>>>    {user, "guest"},
>>>    {password, "guest"}
>>>  ]}
>>> ].
>>>
>>> Also, you said /etc/rabbitmq/rabbitmq.conf.   What you want is probably
>>> rabbitmq.config.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On 07/05/2010 03:00 PM, Akhil Kodali wrote:
>>> > Hi,
>>> >
>>> > I just installed rabbitmq 1.8.0 on ubuntu 10.04 lucid.
>>> > I was unable to find /etc/rabbitmq/rabbitmq.conf
>>> > /etc/rabbitmq is empty.
>>> >
>>> > but the rabbitmq seems to be running fine.
>>> >
>>> > I needed to edit the file to install bql plugin.
>>> >
>>> > Anyone face such issue earlier.
>>> >
>>> > ----
>>> > Regards,
>>> > Akhil Kodali
>>> >
>>> >
>>> >
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/72438779/attachment.htm>

From simon at rabbitmq.com  Wed Jul 21 09:38:23 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Jul 2010 09:38:23 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <1279697165.1602.256.camel@chestsh-ubunbu>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
Message-ID: <4C46B1FF.9090306@rabbitmq.com>

On 21/07/10 08:26, Chester Shen wrote:
> In my huge memory consumption program when it hit the memory watermark
> the client will receive a channel.flow{active=false} which I can capture
> in FlowListener, then I need to send a channel.flow_ok{active=false} to
> acknowledge it, but I do not know how to do it in java client 1.8.1.
> Is there a method that I miss or it has not been implemented yet?

Hi Chester. You shouldn't need to do that - the Java client should 
receive the flow message, automatically respond with flow-ok, and cause 
Channel.basicPublish to block until it sees a channel.flow{active=true}.

The FlowListener is just there in case you need to be aware that this is 
happening; in normal use you shouldn't need to do anything.

Cheers, Simon

From mikeb at rabbitmq.com  Wed Jul 21 10:13:09 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 21 Jul 2010 10:13:09 +0100
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
Message-ID: <4C46BA25.5070805@rabbitmq.com>

> I compiled and installed rabbithub as a rabbitmq plugin from github.
> 
> What do I do next? I mean how do I begin using it.

The rabbitmqctl status output you posted suggests you got it running OK, 
but for the record:  If you've successfully compiled it, you can either 
symlink in into rabbitmq-server/plugins/ or drop the rabbithub.ez in the 
same place.  RabbitMQ should then tell you the RabbitHub has started up 
during boot.

It will be running under control of RabbitMochiweb at
http://localhost:55672/rabbithub/

In general you'll need to address endpoints, e.g.,
http://localhost:55672/rabbithub/endpoint/x/amq.direct

> I am trying to use it primarily as a REST way for consuming from queues.

RabbitHub implements PubSubHubbub (a.k.a., PuSH), which isn't RESTful 
(and shouldn't be).  However, it *is* a fairly idiomatic use of HTTP.

Hope this helps; have fun!

Michael

From johndapps at gmail.com  Wed Jul 21 10:19:48 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 21 Jul 2010 11:19:48 +0200
Subject: [rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 ===
	Limiting to approx 10, 000,
	000 file handles (should hold things for a while?)
Message-ID: <AANLkTikJxuR9rRxPW-0Jodz98QBfc2S9yu56OLNEfuhi@mail.gmail.com>

Just noticed this in the RabbiqMQ log of 1.8.1:

=INFO REPORT==== 21-Jul-2010::11:09:35 ===
Limiting to approx 10000000 file handles

One assumes this does not take much memory? It is presumably possible to
limit this value, or increase it?
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/6e36ff88/attachment.htm>

From csshenqian at gmail.com  Wed Jul 21 10:24:24 2010
From: csshenqian at gmail.com (Chester Shen)
Date: Wed, 21 Jul 2010 17:24:24 +0800
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <4C46B1FF.9090306@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
	<4C46B1FF.9090306@rabbitmq.com>
Message-ID: <1279704264.1602.292.camel@chestsh-ubunbu>

Hi Simon

Thanks for the quick reply!

I asked the question because my client always get the exception:
"com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel" when it hit the memory watermark.
In the log I can find this:

=INFO REPORT==== 21-Jul-2010::11:08:13 ===
vm_memory_high_watermark set. Memory used:906599728 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:13 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

=INFO REPORT==== 21-Jul-2010::11:08:15 ===
vm_memory_high_watermark clear. Memory used:809917968 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:15 ===
    alarm_handler: {clear,vm_memory_high_watermark}

=INFO REPORT==== 21-Jul-2010::11:08:16 ===
vm_memory_high_watermark set. Memory used:880253288 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:16 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

=INFO REPORT==== 21-Jul-2010::11:08:19 ===
vm_memory_high_watermark clear. Memory used:778205448 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:19 ===
    alarm_handler: {clear,vm_memory_high_watermark}

=INFO REPORT==== 21-Jul-2010::11:08:21 ===
vm_memory_high_watermark set. Memory used:845297232 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:21 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

=ERROR REPORT==== 21-Jul-2010::11:08:23 ===
connection <0.3067.2> (running), channel 1 - error:
{amqp_error,precondition_failed,
            "timeout waiting for channel.flow_ok{active=false}",none}

=INFO REPORT==== 21-Jul-2010::11:08:24 ===
vm_memory_high_watermark clear. Memory used:131894968 allowed:825611059

=INFO REPORT==== 21-Jul-2010::11:08:24 ===
    alarm_handler: {clear,vm_memory_high_watermark}

It looks like that the client failed to reply channel.flow{active=false}
in the first place, so after 10 seconds the channel had been terminated.



On Wed, 2010-07-21 at 09:38 +0100, Simon MacMullen wrote:
> On 21/07/10 08:26, Chester Shen wrote:
> > In my huge memory consumption program when it hit the memory watermark
> > the client will receive a channel.flow{active=false} which I can capture
> > in FlowListener, then I need to send a channel.flow_ok{active=false} to
> > acknowledge it, but I do not know how to do it in java client 1.8.1.
> > Is there a method that I miss or it has not been implemented yet?
> 
> Hi Chester. You shouldn't need to do that - the Java client should 
> receive the flow message, automatically respond with flow-ok, and cause 
> Channel.basicPublish to block until it sees a channel.flow{active=true}.
> 
> The FlowListener is just there in case you need to be aware that this is 
> happening; in normal use you shouldn't need to do anything.
> 
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From akhil.kodali at gmail.com  Wed Jul 21 10:27:05 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 14:57:05 +0530
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <4C46BA25.5070805@rabbitmq.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com> 
	<4C46BA25.5070805@rabbitmq.com>
Message-ID: <AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>

Hi,

Yup, I can see it.

I meant I needed any HTTP way of accessing queues and exchanges.
Is there anything that I should be aware of while using it?


Thank you
Akhil Kodali



On Wed, Jul 21, 2010 at 2:43 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:

>  I compiled and installed rabbithub as a rabbitmq plugin from github.
>>
>> What do I do next? I mean how do I begin using it.
>>
>
> The rabbitmqctl status output you posted suggests you got it running OK,
> but for the record:  If you've successfully compiled it, you can either
> symlink in into rabbitmq-server/plugins/ or drop the rabbithub.ez in the
> same place.  RabbitMQ should then tell you the RabbitHub has started up
> during boot.
>
> It will be running under control of RabbitMochiweb at
> http://localhost:55672/rabbithub/
>
> In general you'll need to address endpoints, e.g.,
> http://localhost:55672/rabbithub/endpoint/x/amq.direct
>
>
>  I am trying to use it primarily as a REST way for consuming from queues.
>>
>
> RabbitHub implements PubSubHubbub (a.k.a., PuSH), which isn't RESTful (and
> shouldn't be).  However, it *is* a fairly idiomatic use of HTTP.
>
> Hope this helps; have fun!
>
> Michael
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/6572f343/attachment.htm>

From akhil.kodali at gmail.com  Wed Jul 21 10:43:00 2010
From: akhil.kodali at gmail.com (Akhil Kodali)
Date: Wed, 21 Jul 2010 15:13:00 +0530
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com> 
	<4C46BA25.5070805@rabbitmq.com>
	<AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
Message-ID: <AANLkTikTG-rVcz2nm5uBLbKLD8QNVoA34d7PD55KXzKW@mail.gmail.com>

Hi,

I am sorry for bombarding the mailing list, the documentation at github on
rabbithub isnt helping me much.

How do I push a message "Hello World" to a direct exchange "teste" with the
routing key "testr" on vhost "/test"?



On Wed, Jul 21, 2010 at 2:57 PM, Akhil Kodali <akhil.kodali at gmail.com>wrote:

> Hi,
>
> Yup, I can see it.
>
> I meant I needed any HTTP way of accessing queues and exchanges.
> Is there anything that I should be aware of while using it?
>
>
> Thank you
> Akhil Kodali
>
>
>
>
> On Wed, Jul 21, 2010 at 2:43 PM, Michael Bridgen <mikeb at rabbitmq.com>wrote:
>
>>  I compiled and installed rabbithub as a rabbitmq plugin from github.
>>>
>>> What do I do next? I mean how do I begin using it.
>>>
>>
>> The rabbitmqctl status output you posted suggests you got it running OK,
>> but for the record:  If you've successfully compiled it, you can either
>> symlink in into rabbitmq-server/plugins/ or drop the rabbithub.ez in the
>> same place.  RabbitMQ should then tell you the RabbitHub has started up
>> during boot.
>>
>> It will be running under control of RabbitMochiweb at
>> http://localhost:55672/rabbithub/
>>
>> In general you'll need to address endpoints, e.g.,
>> http://localhost:55672/rabbithub/endpoint/x/amq.direct
>>
>>
>>  I am trying to use it primarily as a REST way for consuming from queues.
>>>
>>
>> RabbitHub implements PubSubHubbub (a.k.a., PuSH), which isn't RESTful (and
>> shouldn't be).  However, it *is* a fairly idiomatic use of HTTP.
>>
>> Hope this helps; have fun!
>>
>> Michael
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100721/a6575947/attachment.htm>

From mikeb at rabbitmq.com  Wed Jul 21 10:44:55 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 21 Jul 2010 10:44:55 +0100
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
	<4C46BA25.5070805@rabbitmq.com>
	<AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
Message-ID: <4C46C197.9020507@rabbitmq.com>

Hi Akhil,

> Yup, I can see it.
> 
> I meant I needed any HTTP way of accessing queues and exchanges.
> Is there anything that I should be aware of while using it?

Depends what you mean by "accessing".  For instance, PuSH, and thereby 
RabbitHub, doesn't have a discovery mechanism.  It's just the messaging.

One thing to be aware of is that RabbitHub treats PuSH as a symmetric 
messaging protocol -- on one side it accepts subscriptions from 
downstream (the "subscription" interface, e.g., 
http://localhost:55672/rabbithub/subscription/q/myqueue), and on the 
other it accepts messages from upstream (the "endpoint" interface, e.g., 
http://localhost:55672/endpoint/x/amq.fanout).

It's also content-agnostic, and doesn't try to do any of the XML/Atom 
processing implied in the PuSH specification.

Each exchange and queue in RabbitHub is exposed as its own PuSH hub, 
with the topics being AMQP routing keys.  You can also create and delete 
exchanges and queues using PUT and DELETE.


Michael.

> Thank you
> Akhil Kodali
> 
> 
> 
> On Wed, Jul 21, 2010 at 2:43 PM, Michael Bridgen <mikeb at rabbitmq.com 
> <mailto:mikeb at rabbitmq.com>> wrote:
> 
>         I compiled and installed rabbithub as a rabbitmq plugin from github.
> 
>         What do I do next? I mean how do I begin using it.
> 
> 
>     The rabbitmqctl status output you posted suggests you got it running
>     OK, but for the record:  If you've successfully compiled it, you can
>     either symlink in into rabbitmq-server/plugins/ or drop the
>     rabbithub.ez in the same place.  RabbitMQ should then tell you the
>     RabbitHub has started up during boot.
> 
>     It will be running under control of RabbitMochiweb at
>     http://localhost:55672/rabbithub/
> 
>     In general you'll need to address endpoints, e.g.,
>     http://localhost:55672/rabbithub/endpoint/x/amq.direct
> 
> 
>         I am trying to use it primarily as a REST way for consuming from
>         queues.
> 
> 
>     RabbitHub implements PubSubHubbub (a.k.a., PuSH), which isn't
>     RESTful (and shouldn't be).  However, it *is* a fairly idiomatic use
>     of HTTP.
> 
>     Hope this helps; have fun!
> 
>     Michael
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mikeb at rabbitmq.com  Wed Jul 21 10:53:57 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 21 Jul 2010 10:53:57 +0100
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTikTG-rVcz2nm5uBLbKLD8QNVoA34d7PD55KXzKW@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
	<4C46BA25.5070805@rabbitmq.com>	<AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
	<AANLkTikTG-rVcz2nm5uBLbKLD8QNVoA34d7PD55KXzKW@mail.gmail.com>
Message-ID: <4C46C3B5.5050809@rabbitmq.com>

[ops, sending to list as well]

> How do I push a message "Hello World" to a direct exchange "teste" with 
> the routing key "testr" on vhost "/test"?

At the minute RabbitHub supports only the default VHost "/".  There's
minor technical trickiness in addressing other vhosts, but nothing
insuperable.

Putting that aside, it's worth looking at the test scripts, which
contain examples of pretty much everything.

In this case, it's
http://github.com/tonyg/rabbithub/blob/master/test/send_x_foo.sh
(with appropriate modifications, e.g., to the port number).

It's also worth reading the PuSH spec, if you've not -- it's admirably
to the point.

> On Wed, Jul 21, 2010 at 2:57 PM, Akhil Kodali <akhil.kodali at gmail.com 
> <mailto:akhil.kodali at gmail.com>> wrote:
> 
>     Hi,
> 
>     Yup, I can see it.
> 
>     I meant I needed any HTTP way of accessing queues and exchanges.
>     Is there anything that I should be aware of while using it?
> 
> 
>     Thank you
>     Akhil Kodali
> 
> 
> 
> 
>     On Wed, Jul 21, 2010 at 2:43 PM, Michael Bridgen <mikeb at rabbitmq.com
>     <mailto:mikeb at rabbitmq.com>> wrote:
> 
>             I compiled and installed rabbithub as a rabbitmq plugin from
>             github.
> 
>             What do I do next? I mean how do I begin using it.
> 
> 
>         The rabbitmqctl status output you posted suggests you got it
>         running OK, but for the record:  If you've successfully compiled
>         it, you can either symlink in into rabbitmq-server/plugins/ or
>         drop the rabbithub.ez in the same place.  RabbitMQ should then
>         tell you the RabbitHub has started up during boot.
> 
>         It will be running under control of RabbitMochiweb at
>         http://localhost:55672/rabbithub/
> 
>         In general you'll need to address endpoints, e.g.,
>         http://localhost:55672/rabbithub/endpoint/x/amq.direct
> 
> 
>             I am trying to use it primarily as a REST way for consuming
>             from queues.
> 
> 
>         RabbitHub implements PubSubHubbub (a.k.a., PuSH), which isn't
>         RESTful (and shouldn't be).  However, it *is* a fairly idiomatic
>         use of HTTP.
> 
>         Hope this helps; have fun!
> 
>         Michael
> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthew at rabbitmq.com  Wed Jul 21 10:54:24 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 21 Jul 2010 10:54:24 +0100
Subject: [rabbitmq-discuss] =INFO REPORT==== 21-Jul-2010::11:09:35 ===
 Limiting to approx 10, 000,
 000 file handles (should hold things for a while?)
In-Reply-To: <AANLkTikJxuR9rRxPW-0Jodz98QBfc2S9yu56OLNEfuhi@mail.gmail.com>
References: <AANLkTikJxuR9rRxPW-0Jodz98QBfc2S9yu56OLNEfuhi@mail.gmail.com>
Message-ID: <20100721095423.GL24186@rabbitmq.com>

Hi John,

On Wed, Jul 21, 2010 at 11:19:48AM +0200, John Apps wrote:
> Just noticed this in the RabbiqMQ log of 1.8.1:
> 
> =INFO REPORT==== 21-Jul-2010::11:09:35 ===
> Limiting to approx 10000000 file handles
> 
> One assumes this does not take much memory? It is presumably possible to
> limit this value, or increase it?

Yes, it can be changed. You need to set a file_handles_high_watermark
entry in rabbitmq.config:

[{rabbit, [{file_handles_high_watermark, X}]}].

The value is autodetected and is simply held as a number - there are no
memory implications. Under unices, ulimit -n is used. Under Windows,
there seems to be a limit around 16M. Eg see
http://blogs.technet.com/markrussinovich/archive/2009/09/29/3283844.aspx
but we knock that down to 10M.

The point of detecting and limiting file descriptor use is that the
Erlang VM blows up quite badly if some core process within it tries to
read a file and finds it can't. Thus we do what we can to try and
monitor Rabbit's use of file descriptors and to ensure there are always
some left over for the VM to use when it needs. A long blog post on this
topic is at
http://www.lshift.net/blog/2010/03/23/the-fine-art-of-holding-a-file-descriptor

Best wishes,

Matthew

From tonyg at rabbitmq.com  Wed Jul 21 10:54:52 2010
From: tonyg at rabbitmq.com (Tony Garnock-Jones)
Date: Wed, 21 Jul 2010 21:54:52 +1200
Subject: [rabbitmq-discuss] reg rabbithub how to
In-Reply-To: <AANLkTikTG-rVcz2nm5uBLbKLD8QNVoA34d7PD55KXzKW@mail.gmail.com>
References: <AANLkTilBoEKntiHagLEIAUNpakZh0me1lnsKx_vHfNC-@mail.gmail.com>
	<4C46BA25.5070805@rabbitmq.com>	<AANLkTinZF5bzI3vuHdYl4Wgy7PAXq69qOkLOYjeOGF1u@mail.gmail.com>
	<AANLkTikTG-rVcz2nm5uBLbKLD8QNVoA34d7PD55KXzKW@mail.gmail.com>
Message-ID: <4C46C3EC.6020400@rabbitmq.com>

Akhil Kodali wrote:
> How do I push a message "Hello World" to a direct exchange "teste" with
> the routing key "testr" on vhost "/test"?

There is no support for vhosts other than "/" at present. The rest, though:

curl -d "Hello World" http://yourhost/rabbithub/endpoint/x/teste?hub.topic=testr

In general, exchanges/queues map to PSHB hubs, and routing keys map to PSHB topics.

You can also get documentation on available options by visiting an endpoint URL
in your browser: http://yourhost/rabbithub/endpoint/x/teste. (A live example is
http://dev.rabbitmq.com/rabbithub/endpoint/x/amq.direct)

Cheers,
  Tony


From simon at rabbitmq.com  Wed Jul 21 11:03:49 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Jul 2010 11:03:49 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <1279704264.1602.292.camel@chestsh-ubunbu>
References: <1279697165.1602.256.camel@chestsh-ubunbu>	
	<4C46B1FF.9090306@rabbitmq.com>
	<1279704264.1602.292.camel@chestsh-ubunbu>
Message-ID: <4C46C605.1050104@rabbitmq.com>

Odd. Those are exactly the symptoms you'd expect to see if you were 
using an old version of the Java client that doesn't support 
channel.flow; recent versions of the server will forcibly disconnect 
such misbehaving clients rather than risk running out of memory.

Umm, you are sure you're using 1.8.1? No older versions lying around on 
the classpath?

Cheers, Simon

On 21/07/10 10:24, Chester Shen wrote:
> Hi Simon
>
> Thanks for the quick reply!
>
> I asked the question because my client always get the exception:
> "com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channel" when it hit the memory watermark.
> In the log I can find this:
>
> =INFO REPORT==== 21-Jul-2010::11:08:13 ===
> vm_memory_high_watermark set. Memory used:906599728 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:13 ===
>      alarm_handler: {set,{vm_memory_high_watermark,[]}}
>
> =INFO REPORT==== 21-Jul-2010::11:08:15 ===
> vm_memory_high_watermark clear. Memory used:809917968 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:15 ===
>      alarm_handler: {clear,vm_memory_high_watermark}
>
> =INFO REPORT==== 21-Jul-2010::11:08:16 ===
> vm_memory_high_watermark set. Memory used:880253288 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:16 ===
>      alarm_handler: {set,{vm_memory_high_watermark,[]}}
>
> =INFO REPORT==== 21-Jul-2010::11:08:19 ===
> vm_memory_high_watermark clear. Memory used:778205448 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:19 ===
>      alarm_handler: {clear,vm_memory_high_watermark}
>
> =INFO REPORT==== 21-Jul-2010::11:08:21 ===
> vm_memory_high_watermark set. Memory used:845297232 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:21 ===
>      alarm_handler: {set,{vm_memory_high_watermark,[]}}
>
> =ERROR REPORT==== 21-Jul-2010::11:08:23 ===
> connection<0.3067.2>  (running), channel 1 - error:
> {amqp_error,precondition_failed,
>              "timeout waiting for channel.flow_ok{active=false}",none}
>
> =INFO REPORT==== 21-Jul-2010::11:08:24 ===
> vm_memory_high_watermark clear. Memory used:131894968 allowed:825611059
>
> =INFO REPORT==== 21-Jul-2010::11:08:24 ===
>      alarm_handler: {clear,vm_memory_high_watermark}
>
> It looks like that the client failed to reply channel.flow{active=false}
> in the first place, so after 10 seconds the channel had been terminated.
>
>
>
> On Wed, 2010-07-21 at 09:38 +0100, Simon MacMullen wrote:
>> On 21/07/10 08:26, Chester Shen wrote:
>>> In my huge memory consumption program when it hit the memory watermark
>>> the client will receive a channel.flow{active=false} which I can capture
>>> in FlowListener, then I need to send a channel.flow_ok{active=false} to
>>> acknowledge it, but I do not know how to do it in java client 1.8.1.
>>> Is there a method that I miss or it has not been implemented yet?
>>
>> Hi Chester. You shouldn't need to do that - the Java client should
>> receive the flow message, automatically respond with flow-ok, and cause
>> Channel.basicPublish to block until it sees a channel.flow{active=true}.
>>
>> The FlowListener is just there in case you need to be aware that this is
>> happening; in normal use you shouldn't need to do anything.
>>
>> Cheers, Simon
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From matthias at rabbitmq.com  Wed Jul 21 11:37:54 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Jul 2010 11:37:54 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <4C46C605.1050104@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>		<4C46B1FF.9090306@rabbitmq.com>	<1279704264.1602.292.camel@chestsh-ubunbu>
	<4C46C605.1050104@rabbitmq.com>
Message-ID: <4C46CE02.8050302@rabbitmq.com>

Simon MacMullen wrote:
> Odd. Those are exactly the symptoms you'd expect to see if you were 
> using an old version of the Java client that doesn't support 
> channel.flow; recent versions of the server will forcibly disconnect 
> such misbehaving clients rather than risk running out of memory.
> 
> Umm, you are sure you're using 1.8.1? No older versions lying around on 
> the classpath?

The Java client has been supporting (and responding to) channel.flow for 
ages, so I doubt this is a version problem.

Is the client perhaps really busy and thus not getting round to 
responding to the channel.flow in time?

You may want to trace the client-server interaction with the tracer 
(http://www.rabbitmq.com/examples.html#tracer) to check on the sequence 
and timing of the commands.


Matthias.

From matthew at rabbitmq.com  Wed Jul 21 11:59:31 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 21 Jul 2010 11:59:31 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <4C46CE02.8050302@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
	<4C46B1FF.9090306@rabbitmq.com>
	<1279704264.1602.292.camel@chestsh-ubunbu>
	<4C46C605.1050104@rabbitmq.com> <4C46CE02.8050302@rabbitmq.com>
Message-ID: <20100721105931.GN24186@rabbitmq.com>

On Wed, Jul 21, 2010 at 11:37:54AM +0100, Matthias Radestock wrote:
> Is the client perhaps really busy and thus not getting round to
> responding to the channel.flow in time?

It's possible that consuming messages is being done in the mainloop
thread, rather than via something like the queuing consumer. Thus the
client never gets around to replying.

Matthew

From majek04 at gmail.com  Wed Jul 21 13:06:27 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 21 Jul 2010 13:06:27 +0100
Subject: [rabbitmq-discuss] Disaster Recovery / Disaster tolerance
	Features
In-Reply-To: <AANLkTilfNTonchcLK7oyQmtqCOP9Wuoo-dlKrs5u1Yfx@mail.gmail.com>
References: <AANLkTilfNTonchcLK7oyQmtqCOP9Wuoo-dlKrs5u1Yfx@mail.gmail.com>
Message-ID: <AANLkTinP_mw1oVfQX3UW8ITk_wPImrOamF4uB63MN04d@mail.gmail.com>

On Tue, Jul 20, 2010 at 10:38, Sunil Kini <sunkini at gmail.com> wrote:
> I wanted to know what kind of Disaster recovery / Disaster tolerance
> features are available in RabbitMQ.

We support active-passive HA scenario, but that requires shared storage.
See our tutorial:
  http://www.rabbitmq.com/pacemaker.html

> How does RabbitMQ guarantee complete recovery of messages after the
> disaster(broker down)? and also how does it perform a fail-over?

RabbitMQ looses the state of messages that aren't marked as persistent.
The persistent messages, which were successfully written to the disk
before disaster will be available after the recovery.

Persistent metadata, like bindings and exchanges will be recovered.

Marek

From majek04 at gmail.com  Wed Jul 21 13:41:16 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 21 Jul 2010 13:41:16 +0100
Subject: [rabbitmq-discuss] python publish an unroutable message
In-Reply-To: <AANLkTilZXrpf7oMhBvxbSEyA5EuJwQW7QqTT3xoQ9Loj@mail.gmail.com>
References: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>
	<yrv4chbjuz9u8.fsf@dwragg.eng.vmware.com>
	<AANLkTilZXrpf7oMhBvxbSEyA5EuJwQW7QqTT3xoQ9Loj@mail.gmail.com>
Message-ID: <AANLkTilBTezsyPPEwLKZ-5tFdb1Glgs6livCN_xLy7B4@mail.gmail.com>

On Tue, Jul 20, 2010 at 12:42, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>> Ovidiu Deac <ovidiudeac at gmail.com> writes:
>>> Does anyone have an example of using the mandatory flag to detect
>>> unroutable messages in python?

Pika: raises an exception on basic.return
look at pika/channel.py:
    def _async_basic_return(self, method_frame, header_frame, body):
        raise NotImplementedError("Basic.Return")


Pyamqplib: looks like it appends returned message to an internal queue:
http://code.google.com/p/py-amqplib/source/browse/amqplib/client_0_8/channel.py#2426

That _basic_return code is executed only when you do ch.wait. This kind
of flow works for me:

ch.returned_messages.empty() -> True
ch.basic_publish(...)
ch.wait()
ch.returned_messages.empty() -> False

On the other hand ch.returned_messages is a standard python Queue.Queue,
so it might be safe to just block on it in a separate thread.

Cheers,
 Marek

From tsuraan at gmail.com  Wed Jul 21 17:19:32 2010
From: tsuraan at gmail.com (tsuraan)
Date: Wed, 21 Jul 2010 11:19:32 -0500
Subject: [rabbitmq-discuss] building bug21673 with erlang R13B4
Message-ID: <AANLkTilg8iCa-10idMmAJ1k7qROvkculQLdo9peaW-KB@mail.gmail.com>

When I'm attempting to build the latest bug21673, I get this compile
error (in src/rabbit_msg_store.erl and src/rabbit_msg_store_gc.erl):

src/rabbit_msg_store.erl:146: referring to built-in type tid as a
remote type; please take out the module name

If I replace the ets:tid() with just tid() in the -spec declarations,
everything compiles nicely.  Was this one of the changes to make
rabbit work with R14?  It looks like I could probably get around this
by setting USE_SPECS to "false" in the Makefile, but it would be nice
if there were a cleaner way to fix things.

From matthew at rabbitmq.com  Wed Jul 21 17:31:57 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 21 Jul 2010 17:31:57 +0100
Subject: [rabbitmq-discuss] building bug21673 with erlang R13B4
In-Reply-To: <AANLkTilg8iCa-10idMmAJ1k7qROvkculQLdo9peaW-KB@mail.gmail.com>
References: <AANLkTilg8iCa-10idMmAJ1k7qROvkculQLdo9peaW-KB@mail.gmail.com>
Message-ID: <20100721163156.GZ24186@rabbitmq.com>

Hi Tsuraan,

On Wed, Jul 21, 2010 at 11:19:32AM -0500, tsuraan wrote:
> When I'm attempting to build the latest bug21673, I get this compile
> error (in src/rabbit_msg_store.erl and src/rabbit_msg_store_gc.erl):
> 
> src/rabbit_msg_store.erl:146: referring to built-in type tid as a
> remote type; please take out the module name

Ugh. Yes, in R14A, the type is ets:tid(), and in previous versions it's
tid(). They decided not to try and migrate gently... Another example is
that it would seem dict:dictionary() only exists from R14A onwards and
was dict() previously. Weirdly, that issue only shows up when you
actually run "make dialyze" whereas the previous one breaks the
compilation. Very strange.

I've bumped the version requirements for the specs to R14A - if you pull
and update, it should now build for you.

> If I replace the ets:tid() with just tid() in the -spec declarations,
> everything compiles nicely.  Was this one of the changes to make
> rabbit work with R14?  It looks like I could probably get around this
> by setting USE_SPECS to "false" in the Makefile, but it would be nice
> if there were a cleaner way to fix things.

Yeah, it should pick it up from the enviroment too -
"make -j USE_SPECS=false" should work.

Matthew

From emile at rabbitmq.com  Wed Jul 21 18:29:03 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 21 Jul 2010 18:29:03 +0100
Subject: [rabbitmq-discuss] How to configure timeout for rabbit client
In-Reply-To: <4C44D22E.1030000@lapolar.cl>
References: <4C44D22E.1030000@lapolar.cl>
Message-ID: <4C472E5F.306@rabbitmq.com>

On 19/07/10 23:31, Gaston Quezada wrote:
> Hi All,
> 
> How can I to change the socket timeout for rabbit client for jvm 1.4.2.?
> 
> Thanks..

Hi Gaston,

The java client does not currently support setting a socket timeout, so
we will treat this as a feature request.

If you are interested in experimenting with adding this yourself in the
meantime then com.rabbitmq.client.ConnectionFactory would be the place
to look.

Regards

Emile


From frank.goenninger at consequor.de  Wed Jul 21 18:30:31 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Wed, 21 Jul 2010 19:30:31 +0200
Subject: [rabbitmq-discuss] Newbie question: How to listen for a certain
	message content ?
Message-ID: <684D1588-4245-4E69-A1B5-2E22641E7D3B@consequor.de>

Hi all,

being an old Tibco "user" (Tibco Rendezvous) I am looking for a way to listen for a "subject" while not having to create separate queues for each subject.

I have event messages where I need to have always the same event message structure and have different event classes. Is there a way to not have queues like

event.application.start
event.application.abort
event.application.shutdown
event.application.terminated

etc et  but rather

have one queue

events

with subjects

application.start etc being part of the message...

I only want my consumer to be awakened when the "right" message is arriving ... Yeah, pubsub is it, but how to do this with RabbitMQ ?

Thanks for helping a newbie do the first baby steps ...

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From ovidiudeac at gmail.com  Wed Jul 21 19:14:29 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Wed, 21 Jul 2010 21:14:29 +0300
Subject: [rabbitmq-discuss] python publish an unroutable message
In-Reply-To: <AANLkTilBTezsyPPEwLKZ-5tFdb1Glgs6livCN_xLy7B4@mail.gmail.com>
References: <AANLkTinAzDNYFmC8DXIMV-twI8dIwRsLRJhOZLa7VGBq@mail.gmail.com>
	<yrv4chbjuz9u8.fsf@dwragg.eng.vmware.com>
	<AANLkTilZXrpf7oMhBvxbSEyA5EuJwQW7QqTT3xoQ9Loj@mail.gmail.com>
	<AANLkTilBTezsyPPEwLKZ-5tFdb1Glgs6livCN_xLy7B4@mail.gmail.com>
Message-ID: <AANLkTinz4O88DYNOjkgXk34Ezs6SQDxaaev-ZDxEd_2i@mail.gmail.com>

Unfortunately, based on the number of available developers, the
decision was to use C# instead of Python but anyway, thanks for the
answer.

Cheers!
ovidiu

On Wed, Jul 21, 2010 at 3:41 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Tue, Jul 20, 2010 at 12:42, Ovidiu Deac <ovidiudeac at gmail.com> wrote:
>>> Ovidiu Deac <ovidiudeac at gmail.com> writes:
>>>> Does anyone have an example of using the mandatory flag to detect
>>>> unroutable messages in python?
>
> Pika: raises an exception on basic.return
> look at pika/channel.py:
> ? ?def _async_basic_return(self, method_frame, header_frame, body):
> ? ? ? ?raise NotImplementedError("Basic.Return")
>
>
> Pyamqplib: looks like it appends returned message to an internal queue:
> http://code.google.com/p/py-amqplib/source/browse/amqplib/client_0_8/channel.py#2426
>
> That _basic_return code is executed only when you do ch.wait. This kind
> of flow works for me:
>
> ch.returned_messages.empty() -> True
> ch.basic_publish(...)
> ch.wait()
> ch.returned_messages.empty() -> False
>
> On the other hand ch.returned_messages is a standard python Queue.Queue,
> so it might be safe to just block on it in a separate thread.
>
> Cheers,
> ?Marek
>

From davegreggory at yahoo.com  Wed Jul 21 21:43:05 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 21 Jul 2010 13:43:05 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
Message-ID: <681276.9988.qm@web111008.mail.gq1.yahoo.com>

Hi,

We are setting up a RabbitMQ cluster as our message broker for servicing our 
guaranteed delivery needs. We will have a local data store on our producers for 
guaranteeing delivery, but we don't want to resort to that except as a last 
ditch effort in cases of catastrophic failures. I would like to better 
understand how the cluster setup in RabbitMQ works.

Our setup:
2 rabbitmq nodes clustered together sitting behind a hardware load balancer. 
Upon initial release, our message volume will not be that high, but it will grow 
real fast once we offload more work to the message broker from our current 
non-messaging based infrastructure. Since the initial volume is not very high, 
we do not intend to use the load balancer for actual load balancing but to 
always send connections to a specific rabbitmq node in the cluster. If RabbitMQ 
does not respond or the port is not open, it will automatically switch to the 
second node for new connections.

Questions:
1. Are there any case studies for setting up clustering in RabbitMQ?
2. When a queue is declared (by one of our producers), is the queue always 
created on the rabbitmq node the producer client has a connection to or is the 
queue created on a randomly selected node within the cluster?
3. If the queue is durable and the messages sent to it are marked persistent, 
will these messages always be persisted to disk and be available after a restart 
of the node that has that queue, regardless of whether the node is a disk node 
or RAM node? (This line "Should you do this, and suffer           a power 
failure to the entire cluster, the entire state of           the cluster, 
including all messages, will be lost.         " in 
http://www.rabbitmq.com/clustering.html is confusing)
4. Should I configure both my nodes as disk nodes or will one disk node be 
sufficient? In other words, if only 1 disk node was there in the cluster and its 
hard drive went bust, what can I recover from the RAM node? If nothing can be 
recovered from the RAM node, is it mainly for increasing the number of 
connections without taking any hits to disk throughput?
5. Are connections redirects actually supported by the current version? The FAQ 
and Clustering documents on site are contradictory of each other. (FAQ says 
"Future releases will support live failover using, for 	      instance, a 
combination of the "known hosts" field in connection.open-ok and the 
connection.redirect message.")
6. If redirects are supported, when all connections are being sent to a specific 
rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node still 
send a redirect request to the client if it's getting too taxed? If so, then is 
it possible to limit redirects to only the disk nodes within the cluster so that 
we don't lose any data? 

7. Will the connections be redirected solely based on RabbitMQ node's ability to 
serve it or is it more round-robin?
8. Is there a way to ensure that the cluster configuration is correct because 
'disc/RAM' is not reported correctly by rabbitmqctl (as per 
http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?


Thanks so much,
Dave



      

From aaron at agoragames.com  Wed Jul 21 22:02:46 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 21 Jul 2010 17:02:46 -0400
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
In-Reply-To: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <AANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS@mail.gmail.com>

Dave,

I intend to write up a blog post on our cluster setup which will
hopefully address some of your questions.  You're trying to set up
your cluster much the way we originally did, but it's not quite the
way Rabbit or AMQP operate.

Think of it as the postal service, where exchanges are your
street-corner deposit boxes and office tellers, and the postal service
is the cluster itself.  Your address is your routing scheme, and that
routing key will deliver a message to your postal box.  The box/queue
is the ultimate endpoint, it lives in a discrete location, and you
have to go to your local post office and consume the mail out of it.

Your load balancer will be of little use for consumers, as your
consumers must be connecting to the node on which your queues reside.
Load balancing can be used for your producers though, in cases where
they are easily separated.

I've heard redirect is removed from later specifications.  Regardless,
I recommend turning the "insist" flag on and avoiding redirects
altogether, because they're inconsistent with the way AMQP clustering
works.

I hope that gives you a good start.

-Aaron


On Wed, Jul 21, 2010 at 4:43 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
> Hi,
>
> We are setting up a RabbitMQ cluster as our message broker for servicing our
> guaranteed delivery needs. We will have a local data store on our producers for
> guaranteeing delivery, but we don't want to resort to that except as a last
> ditch effort in cases of catastrophic failures. I would like to better
> understand how the cluster setup in RabbitMQ works.
>
> Our setup:
> 2 rabbitmq nodes clustered together sitting behind a hardware load balancer.
> Upon initial release, our message volume will not be that high, but it will grow
> real fast once we offload more work to the message broker from our current
> non-messaging based infrastructure. Since the initial volume is not very high,
> we do not intend to use the load balancer for actual load balancing but to
> always send connections to a specific rabbitmq node in the cluster. If RabbitMQ
> does not respond or the port is not open, it will automatically switch to the
> second node for new connections.
>
> Questions:
> 1. Are there any case studies for setting up clustering in RabbitMQ?
> 2. When a queue is declared (by one of our producers), is the queue always
> created on the rabbitmq node the producer client has a connection to or is the
> queue created on a randomly selected node within the cluster?
> 3. If the queue is durable and the messages sent to it are marked persistent,
> will these messages always be persisted to disk and be available after a restart
> of the node that has that queue, regardless of whether the node is a disk node
> or RAM node? (This line "Should you do this, and suffer ? ? ? ? ? a power
> failure to the entire cluster, the entire state of ? ? ? ? ? the cluster,
> including all messages, will be lost. ? ? ? ? " in
> http://www.rabbitmq.com/clustering.html is confusing)
> 4. Should I configure both my nodes as disk nodes or will one disk node be
> sufficient? In other words, if only 1 disk node was there in the cluster and its
> hard drive went bust, what can I recover from the RAM node? If nothing can be
> recovered from the RAM node, is it mainly for increasing the number of
> connections without taking any hits to disk throughput?
> 5. Are connections redirects actually supported by the current version? The FAQ
> and Clustering documents on site are contradictory of each other. (FAQ says
> "Future releases will support live failover using, for ? ? ? ?instance, a
> combination of the "known hosts" field in connection.open-ok and the
> connection.redirect message.")
> 6. If redirects are supported, when all connections are being sent to a specific
> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node still
> send a redirect request to the client if it's getting too taxed? If so, then is
> it possible to limit redirects to only the disk nodes within the cluster so that
> we don't lose any data?
>
> 7. Will the connections be redirected solely based on RabbitMQ node's ability to
> serve it or is it more round-robin?
> 8. Is there a way to ensure that the cluster configuration is correct because
> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
> http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?
>
>
> Thanks so much,
> Dave



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From davegreggory at yahoo.com  Wed Jul 21 22:47:27 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 21 Jul 2010 14:47:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
In-Reply-To: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <568428.65159.qm@web111005.mail.gq1.yahoo.com>

Sending to list...



----- Forwarded Message ----
From: Aaron Westendorf <aaron at agoragames.com>
To: Dave Greggory <davegreggory at yahoo.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, July 21, 2010 5:02:46 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ production setup questions around  
clustering

Dave,

I intend to write up a blog post on our cluster setup which will
hopefully address some of your questions.  You're trying to set up
your cluster much the way we originally did, but it's not quite the
way Rabbit or AMQP operate.

Think of it as the postal service, where exchanges are your
street-corner deposit boxes and office tellers, and the postal service
is the cluster itself.  Your address is your routing scheme, and that
routing key will deliver a message to your postal box.  The box/queue
is the ultimate endpoint, it lives in a discrete location, and you
have to go to your local post office and consume the mail out of it.

Your load balancer will be of little use for consumers, as your
consumers must be connecting to the node on which your queues reside.
Load balancing can be used for your producers though, in cases where
they are easily separated.

I've heard redirect is removed from later specifications.  Regardless,
I recommend turning the "insist" flag on and avoiding redirects
altogether, because they're inconsistent with the way AMQP clustering
works.

I hope that gives you a good start.

-Aaron


On Wed, Jul 21, 2010 at 4:43 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
> Hi,
>
> We are setting up a RabbitMQ cluster as our message broker for servicing our
> guaranteed delivery needs. We will have a local data store on our producers 
for
> guaranteeing delivery, but we don't want to resort to that except as a last
> ditch effort in cases of catastrophic failures. I would like to better
> understand how the cluster setup in RabbitMQ works.
>
> Our setup:
> 2 rabbitmq nodes clustered together sitting behind a hardware load balancer.
> Upon initial release, our message volume will not be that high, but it will 
>grow
> real fast once we offload more work to the message broker from our current
> non-messaging based infrastructure. Since the initial volume is not very high,
> we do not intend to use the load balancer for actual load balancing but to
> always send connections to a specific rabbitmq node in the cluster. If 
RabbitMQ
> does not respond or the port is not open, it will automatically switch to the
> second node for new connections.
>
> Questions:
> 1. Are there any case studies for setting up clustering in RabbitMQ?
> 2. When a queue is declared (by one of our producers), is the queue always
> created on the rabbitmq node the producer client has a connection to or is the
> queue created on a randomly selected node within the cluster?
> 3. If the queue is durable and the messages sent to it are marked persistent,
> will these messages always be persisted to disk and be available after a 
>restart
> of the node that has that queue, regardless of whether the node is a disk node
> or RAM node? (This line "Should you do this, and suffer           a power
> failure to the entire cluster, the entire state of           the cluster,
> including all messages, will be lost.         " in
> http://www.rabbitmq.com/clustering.html is confusing)
> 4. Should I configure both my nodes as disk nodes or will one disk node be
> sufficient? In other words, if only 1 disk node was there in the cluster and 
>its
> hard drive went bust, what can I recover from the RAM node? If nothing can be
> recovered from the RAM node, is it mainly for increasing the number of
> connections without taking any hits to disk throughput?
> 5. Are connections redirects actually supported by the current version? The 
FAQ
> and Clustering documents on site are contradictory of each other. (FAQ says
> "Future releases will support live failover using, for        instance, a
> combination of the "known hosts" field in connection.open-ok and the
> connection.redirect message.")
> 6. If redirects are supported, when all connections are being sent to a 
>specific
> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node 
still
> send a redirect request to the client if it's getting too taxed? If so, then 
is
> it possible to limit redirects to only the disk nodes within the cluster so 
>that
> we don't lose any data?
>
> 7. Will the connections be redirected solely based on RabbitMQ node's ability 
>to
> serve it or is it more round-robin?
> 8. Is there a way to ensure that the cluster configuration is correct because
> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
>http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?
>?
>
>
> Thanks so much,
> Dave



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com



      

From david at rabbitmq.com  Wed Jul 21 23:04:55 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 21 Jul 2010 23:04:55 +0100
Subject: [rabbitmq-discuss] Newbie question: How to listen for a certain
	message content ?
In-Reply-To: <684D1588-4245-4E69-A1B5-2E22641E7D3B@consequor.de> ("Frank
	=?utf-8?Q?G=C3=B6nninger=22's?= message of "Wed, 21 Jul 2010 19:30:31
	+0200")
References: <684D1588-4245-4E69-A1B5-2E22641E7D3B@consequor.de>
Message-ID: <yrv4cbpa0jxtk.fsf@dwragg.eng.vmware.com>

Hi Frank,

Frank G?nninger <frank.goenninger at consequor.de> writes:
> Hi all,
>
> being an old Tibco "user" (Tibco Rendezvous) I am looking for a way to
> listen for a "subject" while not having to create separate queues for
> each subject.
>
> I have event messages where I need to have always the same event
> message structure and have different event classes. Is there a way to
> not have queues like
>
> event.application.start
> event.application.abort
> event.application.shutdown
> event.application.terminated
>
> etc et  but rather
>
> have one queue
>
> events
>
> with subjects
>
> application.start etc being part of the message...
>
> I only want my consumer to be awakened when the "right" message is
> arriving ... Yeah, pubsub is it, but how to do this with RabbitMQ ?

The short answer is: using routing keys and a direct or topic exchange.

You ask about how to do this with only a single queue.  With AMQP, You
will need one queue for each consumer, because queues are explicit,
unlike in tibrv.  However, you don't need an exchange per subject.

One way to think of it, from a tibrv point of view, is that AMQP allows
many distinct subject namespaces, which are called exchanges.

So your application could work as follows:

- Declare a single direct exchange, which you might call "events"

- A publishing component publishes to the "events" exchange specifying a
  routing key, which might be "application.start", "application.stop",
  etc.  The routing key accompanies the message on its journey from the
  publisher to consumers.

- A consuming component declares a queue, and binds it to the exchange,
  with the binding key to specify which event type it is interested in.
  With a direct exchange, messages will be delivered to the consumer
  when its binding key matches the routing key under which the message
  was published.  You can bind the queue multiple times, with different
  binding keys, to subscribe to multiple event types.

The need to have each consumer declare a queue might seem like
unnecessary work.  But it is quite straightforward: If you declare with
an unspecified (i.e. empty) name, the server will automatically give the
queue a unique name.  And you can specify the "exclusive" flag for the
queue, so that it will automatically be deleted (along with its
bindings) when you close the connection.

By using a topic exchange, you can also reproduce the hierarchical
nature of tibrv subjects.  For example, if you declare "events" as a
topic exchange, a consumer could bind with a binding key like
"application.*" to subscribe to all application events.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From thomas.sanchz at gmail.com  Wed Jul 21 23:27:05 2010
From: thomas.sanchz at gmail.com (Thomas Sanchez)
Date: Wed, 21 Jul 2010 15:27:05 -0700
Subject: [rabbitmq-discuss] RabbitMq and clustering
Message-ID: <AANLkTilsZvurobqyWFZAEKM-7JwX7rqNiqUWGPvkrCdj@mail.gmail.com>

Hi guys,

I'm trying to setup a cluster.
I followed the documentation here: http://www.rabbitmq.com/clustering.html

root at lucid:~# cat /etc/hosts
127.0.0.1   localhost
127.0.1.1   lucid
10.252.XXX.XXX
 rabbit1

root at lucid:~# rabbitmqctl stop_app
Stopping node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl reset
Resetting node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
Clustering node rabbit at lucid with [rabbit at rabbit1] ...
Error: {failed_to_cluster_with,[rabbit at rabbit1],
                               "Mnesia could not connect to some nodes."}


There is nothing in log.
I'm running the 1.8.1 version of rabbitmq (installed from .deb package)

erlang:
Erlang (BEAM) emulator version 5.7.4
Compiled on Fri Apr  9 11:08:48 2010

Have you some ideas on what happens ?

Thanks.

-- 
Thomas Sanchez

From davegreggory at yahoo.com  Wed Jul 21 23:33:52 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 21 Jul 2010 15:33:52 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq and clustering
In-Reply-To: <AANLkTilsZvurobqyWFZAEKM-7JwX7rqNiqUWGPvkrCdj@mail.gmail.com>
References: <AANLkTilsZvurobqyWFZAEKM-7JwX7rqNiqUWGPvkrCdj@mail.gmail.com>
Message-ID: <773060.34591.qm@web111007.mail.gq1.yahoo.com>

You need to have more ports open than just the regular 5672. This one bit me as 
well.

See 
http://old.nabble.com/Re%3A-problems-with-rabbitmq-cluster-across-2%09ubuntu-9.04-machines-p25632176.html

and
http://www.joshdevins.net/2010/03/21/rabbitmq-cluster-auto-configuration-debugging/





----- Original Message ----
From: Thomas Sanchez <thomas.sanchz at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, July 21, 2010 6:27:05 PM
Subject: [rabbitmq-discuss] RabbitMq and clustering

Hi guys,

I'm trying to setup a cluster.
I followed the documentation here: http://www.rabbitmq.com/clustering.html

root at lucid:~# cat /etc/hosts
127.0.0.1   localhost
127.0.1.1   lucid
10.252.XXX.XXX
rabbit1

root at lucid:~# rabbitmqctl stop_app
Stopping node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl reset
Resetting node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
Clustering node rabbit at lucid with [rabbit at rabbit1] ...
Error: {failed_to_cluster_with,[rabbit at rabbit1],
                               "Mnesia could not connect to some nodes."}


There is nothing in log.
I'm running the 1.8.1 version of rabbitmq (installed from .deb package)

erlang:
Erlang (BEAM) emulator version 5.7.4
Compiled on Fri Apr  9 11:08:48 2010

Have you some ideas on what happens ?

Thanks.

-- 
Thomas Sanchez
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      

From davegreggory at yahoo.com  Wed Jul 21 23:36:13 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 21 Jul 2010 15:36:13 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq and clustering
Message-ID: <839931.84391.qm@web111001.mail.gq1.yahoo.com>

Just to clarify, I got this problem when I was trying out 1.7.2 and it gave no 
indication of any problems in any of the logs. I just saw the rabbtmqctl status 
didn't list the two nodes. The error you're seeing may not be related to ports 
not being open but it's something to double check.



----- Original Message ----
From: Dave Greggory <davegreggory at yahoo.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, July 21, 2010 6:33:52 PM
Subject: Re: [rabbitmq-discuss] RabbitMq and clustering

You need to have more ports open than just the regular 5672. This one bit me as 
well.

See 
http://old.nabble.com/Re%3A-problems-with-rabbitmq-cluster-across-2%09ubuntu-9.04-machines-p25632176.html


and
http://www.joshdevins.net/2010/03/21/rabbitmq-cluster-auto-configuration-debugging/






----- Original Message ----
From: Thomas Sanchez <thomas.sanchz at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, July 21, 2010 6:27:05 PM
Subject: [rabbitmq-discuss] RabbitMq and clustering

Hi guys,

I'm trying to setup a cluster.
I followed the documentation here: http://www.rabbitmq.com/clustering.html

root at lucid:~# cat /etc/hosts
127.0.0.1   localhost
127.0.1.1   lucid
10.252.XXX.XXX
rabbit1

root at lucid:~# rabbitmqctl stop_app
Stopping node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl reset
Resetting node rabbit at lucid ...
...done.
root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
Clustering node rabbit at lucid with [rabbit at rabbit1] ...
Error: {failed_to_cluster_with,[rabbit at rabbit1],
                               "Mnesia could not connect to some nodes."}


There is nothing in log.
I'm running the 1.8.1 version of rabbitmq (installed from .deb package)

erlang:
Erlang (BEAM) emulator version 5.7.4
Compiled on Fri Apr  9 11:08:48 2010

Have you some ideas on what happens ?

Thanks.

-- 
Thomas Sanchez
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


      

From thomas.sanchz at gmail.com  Thu Jul 22 01:30:41 2010
From: thomas.sanchz at gmail.com (Thomas Sanchez)
Date: Wed, 21 Jul 2010 17:30:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq and clustering
In-Reply-To: <839931.84391.qm@web111001.mail.gq1.yahoo.com>
References: <839931.84391.qm@web111001.mail.gq1.yahoo.com>
Message-ID: <6a71461a-2a71-40aa-a41f-26176baac1a1@v6g2000prd.googlegroups.com>

Thanks for your response, it can be a port issue.
I've to check that

Thanks !

On Jul 21, 3:36?pm, Dave Greggory <davegregg... at yahoo.com> wrote:
> Just to clarify, I got this problem when I was trying out 1.7.2 and it gave no
> indication of any problems in any of the logs. I just saw the rabbtmqctl status
> didn't list the two nodes. The error you're seeing may not be related to ports
> not being open but it's something to double check.
>
>
>
> ----- Original Message ----
> From: Dave Greggory <davegregg... at yahoo.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Wed, July 21, 2010 6:33:52 PM
> Subject: Re: [rabbitmq-discuss] RabbitMq and clustering
>
> You need to have more ports open than just the regular 5672. This one bit me as
> well.
>
> Seehttp://old.nabble.com/Re%3A-problems-with-rabbitmq-cluster-across-2%0...
>
> andhttp://www.joshdevins.net/2010/03/21/rabbitmq-cluster-auto-configurat...
>
> ----- Original Message ----
> From: Thomas Sanchez <thomas.san... at gmail.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Wed, July 21, 2010 6:27:05 PM
> Subject: [rabbitmq-discuss] RabbitMq and clustering
>
> Hi guys,
>
> I'm trying to setup a cluster.
> I followed the documentation here:http://www.rabbitmq.com/clustering.html
>
> root at lucid:~# cat /etc/hosts
> 127.0.0.1 ? localhost
> 127.0.1.1 ? lucid
> 10.252.XXX.XXX
> rabbit1
>
> root at lucid:~# rabbitmqctl stop_app
> Stopping node rabbit at lucid ...
> ...done.
> root at lucid:~# rabbitmqctl reset
> Resetting node rabbit at lucid ...
> ...done.
> root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
> Clustering node rabbit at lucid with [rabbit at rabbit1] ...
> Error: {failed_to_cluster_with,[rabbit at rabbit1],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"Mnesia could not connect to some nodes."}
>
> There is nothing in log.
> I'm running the 1.8.1 version of rabbitmq (installed from .deb package)
>
> erlang:
> Erlang (BEAM) emulator version 5.7.4
> Compiled on Fri Apr ?9 11:08:48 2010
>
> Have you some ideas on what happens ?
>
> Thanks.
>
> --
> Thomas Sanchez
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From csshenqian at gmail.com  Thu Jul 22 04:36:50 2010
From: csshenqian at gmail.com (Chester Shen)
Date: Thu, 22 Jul 2010 11:36:50 +0800
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <20100721105931.GN24186@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
	<4C46B1FF.9090306@rabbitmq.com>
	<1279704264.1602.292.camel@chestsh-ubunbu>
	<4C46C605.1050104@rabbitmq.com> <4C46CE02.8050302@rabbitmq.com>
	<20100721105931.GN24186@rabbitmq.com>
Message-ID: <1279769810.1587.115.camel@chestsh-ubunbu>

Hi.

I can be sure that the client I am using is 1.8.1 since I can get
channel.flow{active=false} in FlowListener.

And my client is pretty simple that it just publish as much messages as
it can in the main loop by using channel.basicPublish, would that cause
the client too busy to respond to the channel.flow in time?

 

On Wed, 2010-07-21 at 11:59 +0100, Matthew Sackman wrote:
> On Wed, Jul 21, 2010 at 11:37:54AM +0100, Matthias Radestock wrote:
> > Is the client perhaps really busy and thus not getting round to
> > responding to the channel.flow in time?
> 
> It's possible that consuming messages is being done in the mainloop
> thread, rather than via something like the queuing consumer. Thus the
> client never gets around to replying.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From scott at beamdog.com  Thu Jul 22 05:11:26 2010
From: scott at beamdog.com (Scott Brooks)
Date: Wed, 21 Jul 2010 22:11:26 -0600
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ Proxy
	Authentication patch/Plugin
Message-ID: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>

TLDR: proof of concept patch to rabbitmq-server, plugin, and ruby
backend to authenticate users.
http://github.com/Blaze74/rabbit_proxyauth
http://github.com/Blaze74/proxyauth.rb

After discussing this a while ago about pluggable authentication
backends, I finally got around to implementing this.

At http://github.com/Blaze74/rabbit_proxyauth
I've got a readme up on github with a nice 23 step process to get
everything going :)

It includes a patch for RabbitMQ-server to adjust the failure
conditions in rabbit_access_control.erl to try to proxy the
request(through a new rabbit_access_control_proxy gen_server) before
failing.

It also includes a plugin that takes message from RabbitMQ, converts
them to JSON and sends them to the proxyauth exchange.

Then at
http://github.com/Blaze74/proxyauth.rb
I've got a really simple back end that looks up the user in a YAML
file to see if they should be allowed access.

This is my first pass over this, and any comments or suggestions are welcome.

Scott Brooks

From arun.suresh at gmail.com  Thu Jul 22 06:51:21 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Thu, 22 Jul 2010 11:21:21 +0530
Subject: [rabbitmq-discuss] What is a good tradeoff for number of
	connections and channels/connection for a client ?
Message-ID: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>

Hello

We are currently using rabbitmq 1.7.2 with the erlang client.
We have some code that sits on top of the erlang client library that
abstract away the need for the client to actually know anything about the
rabbitmq connections or channels. Basically, we create a pool of
connections, and try to multiplex multiple channels across these pooled
connections.

We've noticed lately that, we've been seeing a lot of timeouts which is
manifested in the crash reports as follows:

=CRASH REPORT==== 21-Jul-2010::20:14:31 ===
  crasher:
    initial call: amqp_channel:init/1
    pid: <0.26346.57>
    registered_name: []
    exception exit: {timeout,
                        {gen_server,call,
                            [<0.8759.144>,{call,{'channel.open',<<>>}}]}}
      in function  gen_server:terminate/6
    ancestors: [<0.686.0>,'q_conn_harley02.ypost.re1.yahoo.com_8',
                  'q_sup_harley02.ypost.re1.yahoo.com
',harvester_sup,<0.95.0>]
    messages: [{'EXIT',<0.26348.57>,connection_socket_closed_unexpectedly}]
    links: [<0.26347.57>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1256

Earlier, prior to us using our abstraction layer, we used have a fixed 10
Channels per connections, and new connections were created every once in a
while..

So I was wondering if you guys have any recommendations wrt to number of
connections and channels/connection to be maintained.
We use rabbitmq as a sort of a router.. around 50000 messages are pushed
into the queue per hour. Message size wont exceed a couple of Kb.

regards
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100722/93472e66/attachment-0001.htm>

From emile at rabbitmq.com  Thu Jul 22 11:47:14 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 22 Jul 2010 11:47:14 +0100
Subject: [rabbitmq-discuss] How to configure timeout for rabbit client
In-Reply-To: <4C472E5F.306@rabbitmq.com>
References: <4C44D22E.1030000@lapolar.cl> <4C472E5F.306@rabbitmq.com>
Message-ID: <4C4821B2.4010506@rabbitmq.com>

On 21/07/10 18:29, Emile Joubert wrote:
> On 19/07/10 23:31, Gaston Quezada wrote:
>> Hi All,
>>
>> How can I to change the socket timeout for rabbit client for jvm 1.4.2.?
>>
>> Thanks..
> 
> Hi Gaston,
> 
> The java client does not currently support setting a socket timeout
[...]

Hi Gaston,

Actually this is possible - com.rabbitmq.client.ConnectionFactory has a
configureSocket() method that allows you to configure the timeout value
of the socket.

Regards

Emile

From matthias at rabbitmq.com  Thu Jul 22 11:56:40 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Jul 2010 11:56:40 +0100
Subject: [rabbitmq-discuss] How to configure timeout for rabbit client
In-Reply-To: <4C4821B2.4010506@rabbitmq.com>
References: <4C44D22E.1030000@lapolar.cl> <4C472E5F.306@rabbitmq.com>
	<4C4821B2.4010506@rabbitmq.com>
Message-ID: <4C4823E8.9060600@rabbitmq.com>

On 22/07/10 11:47, Emile Joubert wrote:
>> The java client does not currently support setting a socket timeout
> [...]
>
> Actually this is possible - com.rabbitmq.client.ConnectionFactory has a
> configureSocket() method that allows you to configure the timeout value
> of the socket.

Indeed. By overriding that method 
(http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.8.1/rabbitmq-java-client-javadoc-1.8.1/com/rabbitmq/client/ConnectionFactory.html#configureSocket%28java.net.Socket%29) 
one gets full control over configuring the socket - not just for setting 
timeouts, but also configuring buffer sizes, disabling nagle, etc.

Regards,

Matthias.

From matthew at rabbitmq.com  Thu Jul 22 12:00:22 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 22 Jul 2010 12:00:22 +0100
Subject: [rabbitmq-discuss] How to implement the Aggregator pattern?
In-Reply-To: <1439d16a-2bad-417d-adb6-c512ed7c6766@j8g2000yqd.googlegroups.com>
References: <40410f93-93e4-4f56-b570-3821bbcdc63d@e5g2000yqn.googlegroups.com>
	<20100625125409.GU14541@rabbitmq.com>
	<1439d16a-2bad-417d-adb6-c512ed7c6766@j8g2000yqd.googlegroups.com>
Message-ID: <20100722110022.GJ24186@rabbitmq.com>

Hi Shane,

Apologies for the near-month-long delay - this one seemed to slip
through somewhat.

On Fri, Jun 25, 2010 at 11:57:51AM -0700, Shane wrote:
> I think you interpreted my question correctly. A and B are actually
> calculations on specific messages. C requires the result of the calcs
> of A and B in order to do it's work (another calculation). If I do as
> you suggested, then that seems to imply that I need to manage the
> messages based on the content to correctly group them. Otherwise, the
> calc of C might include calc results of arbitrary messages not related
> to it.

No. A and B should be consuming from their own queues and then
republishing as necessary such that their published messages end up on
separate queues to which C is subscribed. C can detect which
subscription a message is coming from - indeed that's the purpose of the
consumer tag. Thus C will be able to detect when a message comes from A
or if it comes from B.

> I should also mention that C may or may not be necessary based on the
> message content. So the flow may look something like this:
> 
> data(x): A, B
> data(y): A, B, C
> 
> So in the case of data(x), C is not needed and in the case of data(y)
> C needs the results of A and B.

How is this determined? If all the messages from A and B flow through C,
can C work this out and just fail to do any further work, or does A and
B know this, in which case they could avoid publishing their transformed
messages?

Matthew

From alexandru at rabbitmq.com  Thu Jul 22 13:05:34 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 22 Jul 2010 13:05:34 +0100 (BST)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
 clustering
In-Reply-To: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
Message-ID: <alpine.LNX.2.00.1007221224360.2650@dakota>


Hi Dave,

> Questions:
> 2. When a queue is declared (by one of our producers), is the queue always
> created on the rabbitmq node the producer client has a connection to or is the
> queue created on a randomly selected node within the cluster?

The queue is created only on that one node, but is accessible from all
nodes in the cluster.  All nodes in the same cluster are functionally
interchangeable, i.e. it doesn't matter which of the nodes you connect to,
you can still use the queue.

> 3. If the queue is durable and the messages sent to it are marked persistent,
> will these messages always be persisted to disk and be available after a restart
> of the node that has that queue, regardless of whether the node is a disk node
> or RAM node? (This line "Should you do this, and suffer           a power
> failure to the entire cluster, the entire state of           the cluster,
> including all messages, will be lost.         " in
> http://www.rabbitmq.com/clustering.html is confusing)

The distinction between RAM and disk nodes refers to where the Mnesia
tables are stored.  The routing configuration (what queues there are,
which exchanges they're bound to, etc.) is stored in Mnesia, so at least one
of the nodes should be a disk node.  This way, if both nodes go down
at the same time (power failure), when they're restarted, the cluster
should spring back to life just like before.

Messages are persisted to disk, regardless of whether the node is a
disc node or not.  Also, messages are persisted to disk only on the node
on which the queue was declared.  If said node is a RAM node and it goes
down, it won't lose the messages; when it reconnects to the cluster, the
queue should just get recreated (assuming it was declared as durable).

If both nodes are RAM nodes, and they both go down, when they're
restarted, they won't know what queues were declared, etc.  So, in this
case, the messages will be lost.

> 4. Should I configure both my nodes as disk nodes or will one disk node be
> sufficient? In other words, if only 1 disk node was there in the cluster and its
> hard drive went bust, what can I recover from the RAM node? If nothing can be
> recovered from the RAM node

As mentioned above, the RAM node will not store the routing configuration to disk.
If the disc node goes down, you should still be able to recover the broker
configuration from it by adding a new disc node to the cluster.

If any of the nodes goes down permanently (disk failure, etc.), the
messages stored on it will be lost.  If you don't want this to happen,
have a look at the HA Clustering guide:

  http://www.rabbitmq.com/pacemaker.html

> is it mainly for increasing the number of
> connections without taking any hits to disk throughput?

Pretty much, yes.

> 5. Are connections redirects actually supported by the current version? The FAQ
> and Clustering documents on site are contradictory of each other. (FAQ says
> "Future releases will support live failover using, for 	      instance, a
> combination of the "known hosts" field in connection.open-ok and the
> connection.redirect message.")
> 6. If redirects are supported, when all connections are being sent to a specific
> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node still
> send a redirect request to the client if it's getting too taxed? If so, then is
> it possible to limit redirects to only the disk nodes within the cluster so that
> we don't lose any data?
> 7. Will the connections be redirected solely based on RabbitMQ node's ability to
> serve it or is it more round-robin?

There is currently some loadbalancing done via AMQP's connection.redirect
methods.

Both redirects and loadbalancing will soon be removed from RabbitMQ.  It
would probably be better if you didn't count on this feature.

> 8. Is there a way to ensure that the cluster configuration is correct because
> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
> http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?

Not in the current release, no.  It's been fixed on the develpment branch
and should make it into the next release.


Hope this clears things up.

Cheers,
Alex

From alexandru at rabbitmq.com  Thu Jul 22 13:16:47 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 22 Jul 2010 13:16:47 +0100 (BST)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
 clustering
In-Reply-To: <AANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS@mail.gmail.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
	<AANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1007221311180.2650@dakota>



On Wed, 21 Jul 2010, Aaron Westendorf wrote:

Aaron,

> I intend to write up a blog post on our cluster setup which will
> hopefully address some of your questions.

That's great!  Can't wait to read it.

> Think of it as the postal service, where exchanges are your
> street-corner deposit boxes and office tellers, and the postal service
> is the cluster itself.  Your address is your routing scheme, and that
> routing key will deliver a message to your postal box.  The box/queue
> is the ultimate endpoint, it lives in a discrete location, and you
> have to go to your local post office and consume the mail out of it.
>
> Your load balancer will be of little use for consumers, as your
> consumers must be connecting to the node on which your queues reside.

That's not quite true.  Clients can consume the messages from any of the
nodes.  The messages reside only on the node on which their queue was
declared, but they're routed through the cluster to the consumer that
needs them.

> I've heard redirect is removed from later specifications.

Yes, it has.


Cheers,
Alex

From aaron at agoragames.com  Thu Jul 22 13:33:48 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 22 Jul 2010 08:33:48 -0400
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
In-Reply-To: <alpine.LNX.2.00.1007221224360.2650@dakota>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
	<alpine.LNX.2.00.1007221224360.2650@dakota>
Message-ID: <AANLkTikx6uxqk8Ub_ulCm4FXAAocN8_p73MFFBO51v0q@mail.gmail.com>

On Thu, Jul 22, 2010 at 8:05 AM, Alexandru Scvortov
<alexandru at rabbitmq.com> wrote:
>
> The queue is created only on that one node, but is accessible from all
> nodes in the cluster. ?All nodes in the same cluster are functionally
> interchangeable, i.e. it doesn't matter which of the nodes you connect to,
> you can still use the queue.

Interesting, I was not aware of this subtlety which is why I went with
the PO analogy when describing how our cluster works.  So I can
connect to any host in the cluster, call basic.consume(), and receive
messages from a queue that resides on another host?  What about the
case where multiple clients start at the same time and they each
declare the queue and its bindings (identically)?  I swear that we
tried this exact setup, maybe in the 1.5 series, and we kept getting
dropped messages.  This has a big effect on how one can go about
clustering and failover, and matches our original plan for a generic
pool of rabbit hosts.

We have very wide pipes between our hosts, but there's still overhead
in handling inter-node traffic.  Is there an optimal setup, such as
all consumers of a queue connected to the host on which it resides?

-Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From aaron at agoragames.com  Thu Jul 22 13:50:58 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 22 Jul 2010 08:50:58 -0400
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
In-Reply-To: <123015.23057.qm@web111009.mail.gq1.yahoo.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
	<AANLkTimibWt-4ALmI_Ux8DWT7GgO6PVEBLuLJ4GlKjrS@mail.gmail.com>
	<123015.23057.qm@web111009.mail.gq1.yahoo.com>
Message-ID: <AANLkTilAsQxT7gbSzCe4o95q3ZX_AXWaKlZYz7NgXArN@mail.gmail.com>

Dave,

Including the list on the reply.

On Wed, Jul 21, 2010 at 5:44 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
>
> Your postal service analogy is good one and that is how I understood it mostly.
> From what I understood, if a client requests a message from a queue that is not
> on the node he has the current connection to, because of clustering, you will
> get the message back indirectly. But your analogy makes it sound like the client
> will actually need to establish a second connection to the node that has the
> queue. I'm fine with that, that's not a big deal.

I may be wrong in this, Alexandru hinted that clustering might be more
of flexible than I described.

> I declare my (durable) queues from the both producer and consumer ends because
> exchanges would just drop the messages if we left it up to consumers and no
> consumers were up at the time a producer sends message. So But I'm trying to
> understand where a queue will be created when it's ?declared (will it be in the
> node the client has the connection open to or ?could it end up existing in
> another node)?

We have run in to that exact chicken-and-egg problem.  We don't have a
need for persistent messages before a consumer starts for the first
time, so we've been able to allow the consumer to drive the queue
declare and drop unrouteable messages.  If that doesn't work for you,
then perhaps you can have something that sits outside your apps and
ensures that all queues are declared and in good health.  We've taken
to adding a several monitoring tools because it's so easy and it adds
to our reliability.

The queue will exist on the host to which you are connected when you declare it.

> I may have misused the term load-balancer in this context (just because that's
> what we use that piece of hardware most often). Let's just call it node-switcher
> for this purpose. I intended it to serve two purposes,
> a) Hide the hostnames/ip-addresses of rabbitmq nodes from producers and clients
> b) Serve as switch for determining which rabbitmq nodes consumers/producers
> connect to, so that we can:
> ? ? i. Switch all new consumer/producer connections ?automatically to the other
> node if the first node goes down
>
> ? ? ii. Upgrade rabbitmq nodes without affecting producer/consumer nodes
> because we can switch out different rabbitmq nodes

We've solved this problem with DNS aliases.  It's not automated by
design but it does allow us to cleanly disconnect nodes and have the
clients reconnect to another.  The trick there is that if a queue
existed on a node that is shutdown, the clients have to also declare
it, its bindings and the consumers again.  This was best accomplished
for us by simply killing the clients off on a Rabbit disconnect and
letting the "hypervisor" restart them.

That only worked because all consumers of the queue were connected to
the same host on which the queue resided.  If Alexandru is correct and
the cluster can be treated as a pool, then the reconnect scenario has
to include those other clients re-initializing their consumer calls to
the new queue, after it is re-declared.  So perhaps it is best to
always connect to the node hosting the queue you want to consume from.

cheers,
Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From davegreggory at yahoo.com  Thu Jul 22 14:01:01 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 22 Jul 2010 06:01:01 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
Message-ID: <501396.18930.qm@web111007.mail.gq1.yahoo.com>

I sent this message yesterday to directly to Aaron and tried to send to the list as well but sent the wrong message again... Heh. 

Off-topic: Why isn't the reply-address set to the mailing address

On Wed Jul 21st, 2010 5:44 PM EDT Dave Greggory wrote:

>Thanks for the reply, Aaron. I look forward to reading your blog post.
>
>Your postal service analogy is good one and that is how I understood it mostly. 
>From what I understood, if a client requests a message from a queue that is not 
>on the node he has the current connection to, because of clustering, you will 
>get the message back indirectly. But your analogy makes it sound like the client 
>will actually need to establish a second connection to the node that has the 
>queue. I'm fine with that, that's not a big deal. 
>
>
>I declare my (durable) queues from the both producer and consumer ends because 
>exchanges would just drop the messages if we left it up to consumers and no 
>consumers were up at the time a producer sends message. So But I'm trying to 
>understand where a queue will be created when it's  declared (will it be in the 
>node the client has the connection open to or  could it end up existing in 
>another node)? 
>
>
>I may have misused the term load-balancer in this context (just because that's 
>what we use that piece of hardware most often). Let's just call it node-switcher 
>for this purpose. I intended it to serve two purposes,
>a) Hide the hostnames/ip-addresses of rabbitmq nodes from producers and clients
>b) Serve as switch for determining which rabbitmq nodes consumers/producers 
>connect to, so that we can:
>     i. Switch all new consumer/producer connections  automatically to the other 
>node if the first node goes down 
>
>     ii. Upgrade rabbitmq nodes without affecting producer/consumer nodes 
>because we can switch out different rabbitmq nodes
>
>If rabbitmq goes down on 1 node and the node-switches switches out that node, 
>I'm okay with queues on the downed node not being available. But would a new 
>queue be automatically be created on the switched-in node without having to be 
>declared? I'm hoping that because it was part of the cluster before the first 
>node went down, it knew that a certain queue existed on the other node and since 
>the first node is no longer available, it will take over receiving messages for 
>that queue from producers? If that's not true, how do people handle that 
>scenario?
>
>Thanks for the heads up on not using redirects.
>
>Dave
>
>
>----- Original Message ----
>From: Aaron Westendorf <aaron at agoragames.com>
>To: Dave Greggory <davegreggory at yahoo.com>
>Cc: rabbitmq-discuss at lists.rabbitmq.com
>Sent: Wed, July 21, 2010 5:02:46 PM
>Subject: Re: [rabbitmq-discuss] RabbitMQ production setup questions around  
>clustering
>
>Dave,
>
>I intend to write up a blog post on our cluster setup which will
>hopefully address some of your questions.  You're trying to set up
>your cluster much the way we originally did, but it's not quite the
>way Rabbit or AMQP operate.
>
>Think of it as the postal service, where exchanges are your
>street-corner deposit boxes and office tellers, and the postal service
>is the cluster itself.  Your address is your routing scheme, and that
>routing key will deliver a message to your postal box.  The box/queue
>is the ultimate endpoint, it lives in a discrete location, and you
>have to go to your local post office and consume the mail out of it.
>
>Your load balancer will be of little use for consumers, as your
>consumers must be connecting to the node on which your queues reside.
>Load balancing can be used for your producers though, in cases where
>they are easily separated.
>
>I've heard redirect is removed from later specifications.  Regardless,
>I recommend turning the "insist" flag on and avoiding redirects
>altogether, because they're inconsistent with the way AMQP clustering
>works.
>
>I hope that gives you a good start.
>
>-Aaron
>
>
>On Wed, Jul 21, 2010 at 4:43 PM, Dave Greggory <davegreggory at yahoo.com> wrote:
>> Hi,
>>
>> We are setting up a RabbitMQ cluster as our message broker for servicing our
>> guaranteed delivery needs. We will have a local data store on our producers 
>for
>> guaranteeing delivery, but we don't want to resort to that except as a last
>> ditch effort in cases of catastrophic failures. I would like to better
>> understand how the cluster setup in RabbitMQ works.
>>
>> Our setup:
>> 2 rabbitmq nodes clustered together sitting behind a hardware load balancer.
>> Upon initial release, our message volume will not be that high, but it will 
>>grow
>> real fast once we offload more work to the message broker from our current
>> non-messaging based infrastructure. Since the initial volume is not very high,
>> we do not intend to use the load balancer for actual load balancing but to
>> always send connections to a specific rabbitmq node in the cluster. If 
>RabbitMQ
>> does not respond or the port is not open, it will automatically switch to the
>> second node for new connections.
>>
>> Questions:
>> 1. Are there any case studies for setting up clustering in RabbitMQ?
>> 2. When a queue is declared (by one of our producers), is the queue always
>> created on the rabbitmq node the producer client has a connection to or is the
>> queue created on a randomly selected node within the cluster?
>> 3. If the queue is durable and the messages sent to it are marked persistent,
>> will these messages always be persisted to disk and be available after a 
>>restart
>> of the node that has that queue, regardless of whether the node is a disk node
>> or RAM node? (This line "Should you do this, and suffer           a power
>> failure to the entire cluster, the entire state of           the cluster,
>> including all messages, will be lost.         " in
>> http://www.rabbitmq.com/clustering.html is confusing)
>> 4. Should I configure both my nodes as disk nodes or will one disk node be
>> sufficient? In other words, if only 1 disk node was there in the cluster and 
>>its
>> hard drive went bust, what can I recover from the RAM node? If nothing can be
>> recovered from the RAM node, is it mainly for increasing the number of
>> connections without taking any hits to disk throughput?
>> 5. Are connections redirects actually supported by the current version? The 
>FAQ
>> and Clustering documents on site are contradictory of each other. (FAQ says
>> "Future releases will support live failover using, for        instance, a
>> combination of the "known hosts" field in connection.open-ok and the
>> connection.redirect message.")
>> 6. If redirects are supported, when all connections are being sent to a 
>>specific
>> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node 
>still
>> send a redirect request to the client if it's getting too taxed? If so, then 
>is
>> it possible to limit redirects to only the disk nodes within the cluster so 
>>that
>> we don't lose any data?
>>
>> 7. Will the connections be redirected solely based on RabbitMQ node's ability 
>>to
>> serve it or is it more round-robin?
>> 8. Is there a way to ensure that the cluster configuration is correct because
>> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
>>http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?
>>?
>>
>>
>> Thanks so much,
>> Dave
>
>
>
>-- 
>Aaron Westendorf
>Senior Software Engineer
>Agora Games
>359 Broadway
>Troy, NY 12180
>Phone: 518.268.1000
>aaron at agoragames.com
>www.agoragames.com
>
>
>
>      



      

From matthias at rabbitmq.com  Thu Jul 22 14:08:50 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Jul 2010 14:08:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
 clustering
In-Reply-To: <501396.18930.qm@web111007.mail.gq1.yahoo.com>
References: <501396.18930.qm@web111007.mail.gq1.yahoo.com>
Message-ID: <4C4842E2.80300@rabbitmq.com>

On 22/07/10 14:01, Dave Greggory wrote:
> Off-topic: Why isn't the reply-address set to the mailing address

We stick to mailman's default settings here. It's a religious issue. See 
http://www.gnu.org/software/mailman/mailman-admin/node11.html


Matthias.

From davegreggory at yahoo.com  Thu Jul 22 14:20:28 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 22 Jul 2010 06:20:28 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
	clustering
Message-ID: <524136.47554.qm@web111003.mail.gq1.yahoo.com>

Thanks, Alex. That clears up a lot. 

Looks like I will be setting up a 2 node cluster with both nodes as disc nodes (as that's the only way to recover from a permanent failure of a disc node). I will have clients connect through the node-switcher/load-balancer with the insist flag on.

On Thu Jul 22nd, 2010 8:05 AM EDT Alexandru Scvortov wrote:

>
>Hi Dave,
>
>> Questions:
>> 2. When a queue is declared (by one of our producers), is the queue always
>> created on the rabbitmq node the producer client has a connection to or is the
>> queue created on a randomly selected node within the cluster?
>
>The queue is created only on that one node, but is accessible from all
>nodes in the cluster.  All nodes in the same cluster are functionally
>interchangeable, i.e. it doesn't matter which of the nodes you connect to,
>you can still use the queue.
>
>> 3. If the queue is durable and the messages sent to it are marked persistent,
>> will these messages always be persisted to disk and be available after a restart
>> of the node that has that queue, regardless of whether the node is a disk node
>> or RAM node? (This line "Should you do this, and suffer           a power
>> failure to the entire cluster, the entire state of           the cluster,
>> including all messages, will be lost.         " in
>> http://www.rabbitmq.com/clustering.html is confusing)
>
>The distinction between RAM and disk nodes refers to where the Mnesia
>tables are stored.  The routing configuration (what queues there are,
>which exchanges they're bound to, etc.) is stored in Mnesia, so at least one
>of the nodes should be a disk node.  This way, if both nodes go down
>at the same time (power failure), when they're restarted, the cluster
>should spring back to life just like before.
>
>Messages are persisted to disk, regardless of whether the node is a
>disc node or not.  Also, messages are persisted to disk only on the node
>on which the queue was declared.  If said node is a RAM node and it goes
>down, it won't lose the messages; when it reconnects to the cluster, the
>queue should just get recreated (assuming it was declared as durable).
>
>If both nodes are RAM nodes, and they both go down, when they're
>restarted, they won't know what queues were declared, etc.  So, in this
>case, the messages will be lost.
>
>> 4. Should I configure both my nodes as disk nodes or will one disk node be
>> sufficient? In other words, if only 1 disk node was there in the cluster and its
>> hard drive went bust, what can I recover from the RAM node? If nothing can be
>> recovered from the RAM node
>
>As mentioned above, the RAM node will not store the routing configuration to disk.
>If the disc node goes down, you should still be able to recover the broker
>configuration from it by adding a new disc node to the cluster.
>
>If any of the nodes goes down permanently (disk failure, etc.), the
>messages stored on it will be lost.  If you don't want this to happen,
>have a look at the HA Clustering guide:
>
>  http://www.rabbitmq.com/pacemaker.html
>
>> is it mainly for increasing the number of
>> connections without taking any hits to disk throughput?
>
>Pretty much, yes.
>
>> 5. Are connections redirects actually supported by the current version? The FAQ
>> and Clustering documents on site are contradictory of each other. (FAQ says
>> "Future releases will support live failover using, for 	      instance, a
>> combination of the "known hosts" field in connection.open-ok and the
>> connection.redirect message.")
>> 6. If redirects are supported, when all connections are being sent to a specific
>> rabbitmq node in the cluster by the loadbalancer, will that rabbitmq node still
>> send a redirect request to the client if it's getting too taxed? If so, then is
>> it possible to limit redirects to only the disk nodes within the cluster so that
>> we don't lose any data?
>> 7. Will the connections be redirected solely based on RabbitMQ node's ability to
>> serve it or is it more round-robin?
>
>There is currently some loadbalancing done via AMQP's connection.redirect
>methods.
>
>Both redirects and loadbalancing will soon be removed from RabbitMQ.  It
>would probably be better if you didn't count on this feature.
>
>> 8. Is there a way to ensure that the cluster configuration is correct because
>> 'disc/RAM' is not reported correctly by rabbitmqctl (as per
>> http://old.nabble.com/Rabbitmq-v.-1.8.1---Bug-report---Could-not-start-a-node-as-RAM-node-in-cluster-ts29211668.html)?
>
>Not in the current release, no.  It's been fixed on the develpment branch
>and should make it into the next release.
>
>
>Hope this clears things up.
>
>Cheers,
>Alex



      

From simon at rabbitmq.com  Thu Jul 22 16:01:19 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 22 Jul 2010 16:01:19 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <1279769810.1587.115.camel@chestsh-ubunbu>
References: <1279697165.1602.256.camel@chestsh-ubunbu>	<4C46B1FF.9090306@rabbitmq.com>	<1279704264.1602.292.camel@chestsh-ubunbu>	<4C46C605.1050104@rabbitmq.com>
	<4C46CE02.8050302@rabbitmq.com>	<20100721105931.GN24186@rabbitmq.com>
	<1279769810.1587.115.camel@chestsh-ubunbu>
Message-ID: <4C485D3F.2090506@rabbitmq.com>

On 22/07/10 04:36, Chester Shen wrote:
> Hi.
>
> I can be sure that the client I am using is 1.8.1 since I can get
> channel.flow{active=false} in FlowListener.
>
> And my client is pretty simple that it just publish as much messages as
> it can in the main loop by using channel.basicPublish, would that cause
> the client too busy to respond to the channel.flow in time?

Hmm. It shouldn't do.

The best idea we can come up with at the moment is that the publish 
messages are backing up in the channel process inside the server, 
blocking the flow-ok message (which the client has sent) from getting 
read. This requires the publishes to be happening comparatively slowly, 
and for there to be a lot of them. Are you publishing persistent 
messages to durable queues? If so, are you using transactions?

If this theory is correct then there's not a great deal we can do except 
ask you to try the new persister. This would both relieve the memory 
pressure and put a lower upper bound on how long it takes to publish a 
persistent message.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Thu Jul 22 17:21:57 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 22 Jul 2010 17:21:57 +0100
Subject: [rabbitmq-discuss] Bug21673 (aka new persister) has landed on
	default
Message-ID: <AANLkTinglxWyK0JbqB5Hy8qNr9Pp7EV6vSJ3n3WG4QxW@mail.gmail.com>

Bug21673, new persister, was just merged into the default branch. This
is a big news to anyone that is using this code. From now on you can
switch to the "default" branch.

Marek

From matthew at rabbitmq.com  Thu Jul 22 17:48:30 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 22 Jul 2010 17:48:30 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
Message-ID: <20100722164829.GA20367@rabbitmq.com>

After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
of work, the addition of at least 50,545 lines of code and the removal
of at least 42,866 lines of code from the broker, we finally arrive with
the last changeset, merging the final 5762 lines of code from the new
persister branch, bug21673, into default.

The new persister will be in the next release of RabbitMQ.

You should now use the default branch, not bug21673.

Matthew

From scott at beamdog.com  Thu Jul 22 17:59:43 2010
From: scott at beamdog.com (Scott Brooks)
Date: Thu, 22 Jul 2010 10:59:43 -0600
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>

Congratulations.  I know you guys have been working long and hard on
this for quite a while, and I look forward to seeing it in production.

Will this be RabbitMQ 2.0 when it gets released?  I figure 14 months
is worth a 2.0

Scott Brooks

On Thu, Jul 22, 2010 at 10:48 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
>
> The new persister will be in the next release of RabbitMQ.
>
> You should now use the default branch, not bug21673.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexandru at rabbitmq.com  Thu Jul 22 17:59:53 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 22 Jul 2010 17:59:53 +0100 (BST)
Subject: [rabbitmq-discuss] What is a good tradeoff for number of
 connections and channels/connection for a client ?
In-Reply-To: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>
References: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>
Message-ID: <alpine.LNX.2.00.1007221746090.2650@dakota>

Hello Arun,

> We are currently using rabbitmq 1.7.2 with the erlang client.
> We have some code that sits on top of the erlang client library that abstract away the need for the client to actually know anything about the rabbitmq connections or channels.
> Basically, we create a pool of connections, and try to multiplex multiple channels across these pooled connections.

Why are you creating a pool of connections?

Why are you multiplexing channels across them?  It sounds as if you've got
a number of channels and are selecting one at random to execute some
command.  Is that it?


Unless you have some strange requirements, one connection should be
enough.

Channels have a logical role.  For instance, some AMQP methods raise
exceptions that close the channel they were exectued in.

Otherwise, there shouldn't be any reason to have multiple channels.
Specifically, there shouldn't be any performance gains.

Cheers,
Alex

From matthew at rabbitmq.com  Thu Jul 22 18:04:50 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 22 Jul 2010 18:04:50 +0100
Subject: [rabbitmq-discuss] What is a good tradeoff for number of
 connections and channels/connection for a client ?
In-Reply-To: <alpine.LNX.2.00.1007221746090.2650@dakota>
References: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>
	<alpine.LNX.2.00.1007221746090.2650@dakota>
Message-ID: <20100722170449.GC20367@rabbitmq.com>

On Thu, Jul 22, 2010 at 05:59:53PM +0100, Alexandru Scvortov wrote:
> Otherwise, there shouldn't be any reason to have multiple channels.

Well, channels are stateful so for example you either have a
transactional channel or a non transactional channel. That's a reason to
have multiple channels. Also if you want different qos settings in
different channels then that's a reason, also the meaning of
ack{multiple=true} is obviously scoped by the non-acked msgs received in
each channel. Thus there are some reasons to have multiple channels. But
generally creating a pool of them or connections is, as Alex says, a bad
idea.

Matthew

From scott at beamdog.com  Thu Jul 22 18:17:58 2010
From: scott at beamdog.com (Scott Brooks)
Date: Thu, 22 Jul 2010 11:17:58 -0600
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
Message-ID: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>

I spoke at my local ruby users group yegrb.com about RabbitMQ

Here are the slides, they may be of interest.
http://docs.google.com/present/embed?id=dck5j8mb_0rqn4psdg&size=l

Let me know if there is anything wrong/or things I could improve on.

Scott Brooks

From arun.suresh at gmail.com  Thu Jul 22 18:21:25 2010
From: arun.suresh at gmail.com (Arun Suresh)
Date: Thu, 22 Jul 2010 22:51:25 +0530
Subject: [rabbitmq-discuss] What is a good tradeoff for number of
	connections and channels/connection for a client ?
In-Reply-To: <20100722170449.GC20367@rabbitmq.com>
References: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>
	<alpine.LNX.2.00.1007221746090.2650@dakota>
	<20100722170449.GC20367@rabbitmq.com>
Message-ID: <AANLkTinx6eAxNfZrLxpLQOwFfNSdenovIpkwF88TR29p@mail.gmail.com>

oh okay.. thanx for the response guys...

Like uve guessed, we do have need for multiple channels. Basically, we have
a large number of consumers each listening for messages on their own
specific queuus. So for each consumer, we have to create a channel.. and
yes.. like uve guessed, we do enforce certain specific qos settings on there
channels..

So is it safe for me to assume, that like Alex mentioned, there should NOT
be any issue if I create ALL the channels on the same connection ?

-Arun


On Thu, Jul 22, 2010 at 10:34 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Jul 22, 2010 at 05:59:53PM +0100, Alexandru Scvortov wrote:
> > Otherwise, there shouldn't be any reason to have multiple channels.
>
> Well, channels are stateful so for example you either have a
> transactional channel or a non transactional channel. That's a reason to
> have multiple channels. Also if you want different qos settings in
> different channels then that's a reason, also the meaning of
> ack{multiple=true} is obviously scoped by the non-acked msgs received in
> each channel. Thus there are some reasons to have multiple channels. But
> generally creating a pool of them or connections is, as Alex says, a bad
> idea.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100722/aa1ffdb1/attachment.htm>

From tsuraan at gmail.com  Thu Jul 22 19:31:09 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 22 Jul 2010 13:31:09 -0500
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <AANLkTike06p80mn_q0nAzzWghdMX5-qviU8H43kxDtdz@mail.gmail.com>

Congratulations!

On 22 July 2010 11:48, Matthew Sackman <matthew at rabbitmq.com> wrote:
> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
>
> The new persister will be in the next release of RabbitMQ.
>
> You should now use the default branch, not bug21673.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From darius.damalakas at gmail.com  Thu Jul 22 19:55:13 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Thu, 22 Jul 2010 21:55:13 +0300
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTike06p80mn_q0nAzzWghdMX5-qviU8H43kxDtdz@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTike06p80mn_q0nAzzWghdMX5-qviU8H43kxDtdz@mail.gmail.com>
Message-ID: <AANLkTilZnQiPNWn3q7CtAS3fIa4q6yFPQG2J13VVXuBq@mail.gmail.com>

Congrats!

2010/7/22 tsuraan <tsuraan at gmail.com>

> Congratulations!
>
> On 22 July 2010 11:48, Matthew Sackman <matthew at rabbitmq.com> wrote:
> > After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> > of work, the addition of at least 50,545 lines of code and the removal
> > of at least 42,866 lines of code from the broker, we finally arrive with
> > the last changeset, merging the final 5762 lines of code from the new
> > persister branch, bug21673, into default.
> >
> > The new persister will be in the next release of RabbitMQ.
> >
> > You should now use the default branch, not bug21673.
> >
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Link?jimai, Best Regards

Darius Damalakas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100722/3d5fe83d/attachment.htm>

From irmo.manie at gmail.com  Thu Jul 22 20:41:07 2010
From: irmo.manie at gmail.com (Irmo Manie)
Date: Thu, 22 Jul 2010 21:41:07 +0200
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <8614303613886530063@unknownmsgid>

Nomnomnomnom!

Cool stuff!

On 22 Jul 2010, at 18:48, Matthew Sackman <matthew at rabbitmq.com> wrote:

> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
>
> The new persister will be in the next release of RabbitMQ.
>
> You should now use the default branch, not bug21673.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Fri Jul 23 01:55:38 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 23 Jul 2010 08:55:38 +0800
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <9E61E710-BA8F-47E1-AB4B-E5F086A151F5@gmail.com>

Congratulations to the RabbitMQ team and everyone involved!

Alvaro

Sent from my iFad

On Jul 23, 2010, at 12:48 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:

> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
> 
> The new persister will be in the next release of RabbitMQ.
> 
> You should now use the default branch, not bug21673.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Fri Jul 23 03:45:33 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 22 Jul 2010 20:45:33 -0600
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <9E61E710-BA8F-47E1-AB4B-E5F086A151F5@gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<9E61E710-BA8F-47E1-AB4B-E5F086A151F5@gmail.com>
Message-ID: <DABD7C47-B627-461B-A1E1-7C9D9493C7BB@gmail.com>

Indeed! Congratulations guys. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Jul 22, 2010, at 18:55, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Congratulations to the RabbitMQ team and everyone involved!
> 
> Alvaro
> 
> Sent from my iFad
> 
> On Jul 23, 2010, at 12:48 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> 
>> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
>> of work, the addition of at least 50,545 lines of code and the removal
>> of at least 42,866 lines of code from the broker, we finally arrive with
>> the last changeset, merging the final 5762 lines of code from the new
>> persister branch, bug21673, into default.
>> 
>> The new persister will be in the next release of RabbitMQ.
>> 
>> You should now use the default branch, not bug21673.
>> 
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From johndapps at gmail.com  Fri Jul 23 08:19:58 2010
From: johndapps at gmail.com (John Apps)
Date: Fri, 23 Jul 2010 09:19:58 +0200
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <AANLkTin7+5Epbyeu4f5U6aqCi1Phyos2J3TAEXddp=Ep@mail.gmail.com>

Congratulations to one and all!

All in all, then, you only changed some 7679 lines of code? [?]

I am really looking forward to trying the new persister out, having had lots
of fun and games with the old one...

Cheers, John

On Thu, Jul 22, 2010 at 18:48, Matthew Sackman <matthew at rabbitmq.com> wrote:

> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
>
> The new persister will be in the next release of RabbitMQ.
>
> You should now use the default branch, not bug21673.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/8173d5a6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 96 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/8173d5a6/attachment.gif>

From johndapps at gmail.com  Fri Jul 23 08:35:37 2010
From: johndapps at gmail.com (John Apps)
Date: Fri, 23 Jul 2010 09:35:37 +0200
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
In-Reply-To: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
References: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
Message-ID: <AANLkTin9o26C1Ttb50R3LdFMc=ZeRGLbMBWUS+Zc8VJF@mail.gmail.com>

Very nice set of slides and thank you for sharing them with us! I assume we
may 'borrow' liberally as long as attribution is made?

One or two comments:

1. RabbitMQ also runs on HP OpenVMS. See http://www.johndapps.com/ and
related pages
2. StormMQ is another AMQP implementation worth looking into
3. http://www.springsource.org/spring-amqp has Java and .NET client
implementations (just released first version)

On Thu, Jul 22, 2010 at 19:17, Scott Brooks <scott at beamdog.com> wrote:

> I spoke at my local ruby users group yegrb.com about RabbitMQ
>
> Here are the slides, they may be of interest.
> http://docs.google.com/present/embed?id=dck5j8mb_0rqn4psdg&size=l
>
> Let me know if there is anything wrong/or things I could improve on.
>
> Scott Brooks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/f93b32a5/attachment.htm>

From darius.damalakas at gmail.com  Fri Jul 23 08:39:25 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Fri, 23 Jul 2010 10:39:25 +0300
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
In-Reply-To: <AANLkTin9o26C1Ttb50R3LdFMc=ZeRGLbMBWUS+Zc8VJF@mail.gmail.com>
References: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com> 
	<AANLkTin9o26C1Ttb50R3LdFMc=ZeRGLbMBWUS+Zc8VJF@mail.gmail.com>
Message-ID: <AANLkTins+pmLrCUouPOxB81D-FAKYv=Ebf5SBpEXXS5O@mail.gmail.com>

Thanks for sharind slides from my side too.
I've got some new ideas, such as logging.

And other ideas where expressed quite nicely, and now it willl be easier to
explain to my friends what is messaging and how to eat it


2010/7/23 John Apps <johndapps at gmail.com>

> Very nice set of slides and thank you for sharing them with us! I assume we
> may 'borrow' liberally as long as attribution is made?
>
> One or two comments:
>
> 1. RabbitMQ also runs on HP OpenVMS. See http://www.johndapps.com/ and
> related pages
> 2. StormMQ is another AMQP implementation worth looking into
> 3. http://www.springsource.org/spring-amqp has Java and .NET client
> implementations (just released first version)
>
>
> On Thu, Jul 22, 2010 at 19:17, Scott Brooks <scott at beamdog.com> wrote:
>
>> I spoke at my local ruby users group yegrb.com about RabbitMQ
>>
>> Here are the slides, they may be of interest.
>> http://docs.google.com/present/embed?id=dck5j8mb_0rqn4psdg&size=l
>>
>> Let me know if there is anything wrong/or things I could improve on.
>>
>> Scott Brooks
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> ---
> John Apps
> (49) 171 869 1813
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Link?jimai, Best Regards

Darius Damalakas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/98059833/attachment.htm>

From matthew at rabbitmq.com  Fri Jul 23 09:31:49 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 23 Jul 2010 09:31:49 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTin7+5Epbyeu4f5U6aqCi1Phyos2J3TAEXddp=Ep@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTin7+5Epbyeu4f5U6aqCi1Phyos2J3TAEXddp=Ep@mail.gmail.com>
Message-ID: <20100723083148.GA14221@wellquite.org>

On Fri, Jul 23, 2010 at 09:19:58AM +0200, John Apps wrote:
> Congratulations to one and all!

Many thanks, for everyone's patience with this and for the early
adopters who bravely tested this code whilst it was in development and
helped us by reporting bugs as they found them.

> All in all, then, you only changed some 7679 lines of code? [?]

The final merge to default was just 5762 lines. However, large amounts
of refactorings and abstraction had already made it to default - for
example we now have an API for developing backing-queues against, which
(currently) allows you to select between the new persister and the old
(and allows others to experiment with writing further persisters), and
was originally developed as part of the new persister but the
infrastructure there made it onto default much sooner and has been part
of the last couple of releases. As a result, I've no idea really how to
work out the number of LoC that originated with the new persister which
have now made it to default.

> I am really looking forward to trying the new persister out, having had lots
> of fun and games with the old one...

Indeed! I'm looking forwards to your reports - I'm hoping you're going
to report it's suddenly become much much harder to make Rabbit crash ;)

Matthew 

From brett.r.cameron at gmail.com  Fri Jul 23 09:38:55 2010
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 23 Jul 2010 20:38:55 +1200
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100723083148.GA14221@wellquite.org>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTin7+5Epbyeu4f5U6aqCi1Phyos2J3TAEXddp=Ep@mail.gmail.com>
	<20100723083148.GA14221@wellquite.org>
Message-ID: <AANLkTin=P0Hcvpy=Yx0QzCJNoDk=w93chhZxKYQY30gJ@mail.gmail.com>

5672 - spooky!

John and I will have to give the new persister a spin on OpenVMS.

Brett

On Fri, Jul 23, 2010 at 8:31 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Jul 23, 2010 at 09:19:58AM +0200, John Apps wrote:
> > Congratulations to one and all!
>
> Many thanks, for everyone's patience with this and for the early
> adopters who bravely tested this code whilst it was in development and
> helped us by reporting bugs as they found them.
>
> > All in all, then, you only changed some 7679 lines of code? [?]
>
> The final merge to default was just 5762 lines. However, large amounts
> of refactorings and abstraction had already made it to default - for
> example we now have an API for developing backing-queues against, which
> (currently) allows you to select between the new persister and the old
> (and allows others to experiment with writing further persisters), and
> was originally developed as part of the new persister but the
> infrastructure there made it onto default much sooner and has been part
> of the last couple of releases. As a result, I've no idea really how to
> work out the number of LoC that originated with the new persister which
> have now made it to default.
>
> > I am really looking forward to trying the new persister out, having had
> lots
> > of fun and games with the old one...
>
> Indeed! I'm looking forwards to your reports - I'm hoping you're going
> to report it's suddenly become much much harder to make Rabbit crash ;)
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/c992008b/attachment-0001.htm>

From matthew at rabbitmq.com  Fri Jul 23 09:44:02 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 23 Jul 2010 09:44:02 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTin=P0Hcvpy=Yx0QzCJNoDk=w93chhZxKYQY30gJ@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTin7+5Epbyeu4f5U6aqCi1Phyos2J3TAEXddp=Ep@mail.gmail.com>
	<20100723083148.GA14221@wellquite.org>
	<AANLkTin=P0Hcvpy=Yx0QzCJNoDk=w93chhZxKYQY30gJ@mail.gmail.com>
Message-ID: <20100723084401.GB14221@wellquite.org>

On Fri, Jul 23, 2010 at 08:38:55PM +1200, Brett Cameron wrote:
> 5672 - spooky!

Damn - if only we'd managed to shave another 90 lines off!

Matthew

From alexis at rabbitmq.com  Fri Jul 23 10:16:15 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 23 Jul 2010 10:16:15 +0100
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
In-Reply-To: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
References: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
Message-ID: <AANLkTikMeCP59jap4VrVnZtLq5c2t4s-tzyfB9u0JVPL@mail.gmail.com>

Scott

Nice slides.  It would be interesting to get more of your thoughts on
use cases.  I think that we could make it easier for users to set up a
few simple cases like "pubsub" without having to work out which
exchanges to use, and "shared queue" without having to think about
routing.  In other words: to make Rabbit's interface more humane
especially for the simple cases.

Separately on your last slide --- some readers *may* infer that unless
a message is "stored" in a database, then it can be lost.  But Rabbit
(and, indeed, AMQP) supports message persistence for *recovery*.  If I
could suggest one change, it would be to clarify that.

alexis




On Thu, Jul 22, 2010 at 6:17 PM, Scott Brooks <scott at beamdog.com> wrote:
> I spoke at my local ruby users group yegrb.com about RabbitMQ
>
> Here are the slides, they may be of interest.
> http://docs.google.com/present/embed?id=dck5j8mb_0rqn4psdg&size=l
>
> Let me know if there is anything wrong/or things I could improve on.
>
> Scott Brooks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From howie at thingy.com  Fri Jul 23 10:51:04 2010
From: howie at thingy.com (Howard Jones)
Date: Fri, 23 Jul 2010 10:51:04 +0100
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
In-Reply-To: <AANLkTins+pmLrCUouPOxB81D-FAKYv=Ebf5SBpEXXS5O@mail.gmail.com>
References: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
	<AANLkTin9o26C1Ttb50R3LdFMc=ZeRGLbMBWUS+Zc8VJF@mail.gmail.com>
	<AANLkTins+pmLrCUouPOxB81D-FAKYv=Ebf5SBpEXXS5O@mail.gmail.com>
Message-ID: <4C496608.9060101@thingy.com>

 On 23/07/2010 08:39, Darius Damalakas wrote:
> Thanks for sharind slides from my side too.
> I've got some new ideas, such as logging.
>
> And other ideas where expressed quite nicely, and now it willl be easier to
> explain to my friends what is messaging and how to eat it

The initial examples of a producer would perhaps be a little clearer
(and underline that the producer doesn't use a queue) if they weren't
also interleaved with consumer code. Maybe side-by-side
producer/consumer bits instead?

I guess this makes more sense with accompanying chat, but it makes
things less clear when just reading the slides.

Howie

From sh at defuze.org  Fri Jul 23 12:49:04 2010
From: sh at defuze.org (Sylvain Hellegouarch)
Date: Fri, 23 Jul 2010 13:49:04 +0200
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100722164829.GA20367@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
Message-ID: <AANLkTimFFw8V4hc=VrPAsLMZsXuvi0Ssw=jv3ecw0yPb@mail.gmail.com>

On Thu, Jul 22, 2010 at 6:48 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
> of work, the addition of at least 50,545 lines of code and the removal
> of at least 42,866 lines of code from the broker, we finally arrive with
> the last changeset, merging the final 5762 lines of code from the new
> persister branch, bug21673, into default.
>
> The new persister will be in the next release of RabbitMQ.
>
> You should now use the default branch, not bug21673.
>
>
I'll follow up and definitely say congratulations for this good news.

-- 
- Sylvain
http://www.defuze.org
http://twitter.com/lawouach
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/e939815d/attachment.htm>

From irrer at umich.edu  Fri Jul 23 13:48:58 2010
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 23 Jul 2010 08:48:58 -0400
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTimFFw8V4hc=VrPAsLMZsXuvi0Ssw=jv3ecw0yPb@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTimFFw8V4hc=VrPAsLMZsXuvi0Ssw=jv3ecw0yPb@mail.gmail.com>
Message-ID: <AANLkTin9FCxrpexsm--MN3CHLxz6TZXiswEPvEyG7M5K@mail.gmail.com>

Congratulations for all the hard work and persistence (bad pun intended).

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 23, 2010 at 7:49 AM, Sylvain Hellegouarch <sh at defuze.org> wrote:

>
>
> On Thu, Jul 22, 2010 at 6:48 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> After 1237 commits to the broker, 1415 comments in bugzilla, 14 months
>> of work, the addition of at least 50,545 lines of code and the removal
>> of at least 42,866 lines of code from the broker, we finally arrive with
>> the last changeset, merging the final 5762 lines of code from the new
>> persister branch, bug21673, into default.
>>
>> The new persister will be in the next release of RabbitMQ.
>>
>> You should now use the default branch, not bug21673.
>>
>>
> I'll follow up and definitely say congratulations for this good news.
>
> --
> - Sylvain
> http://www.defuze.org
> http://twitter.com/lawouach
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/5bb72674/attachment.htm>

From davegreggory at yahoo.com  Fri Jul 23 15:33:05 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 23 Jul 2010 07:33:05 -0700 (PDT)
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
Message-ID: <237032.46347.qm@web111010.mail.gq1.yahoo.com>

Hi,

I configured my 2 node cluster to behind a load balancer that round robins to 
the two nodes. Once I did that, I started noticing these errors in RabbitMQ 
logs.

_________________________________________________________________________
=INFO REPORT==== 23-Jul-2010::10:27:09 ===
starting TCP connection <0.3870.4> from <loadbalancer_ip>:33407

=WARNING REPORT==== 23-Jul-2010::10:27:09 ===
exception on TCP connection <0.3870.4> from <loadbalancer_ip>:33407
connection_closed_abruptly

=INFO REPORT==== 23-Jul-2010::10:27:09 ===
closing TCP connection <0.3870.4> from <loadbalancer_ip>:33407

=INFO REPORT==== 23-Jul-2010::10:27:14 ===
accepted TCP connection on 0.0.0.0:5672 from <loadbalancer_ip>:1706

=INFO REPORT==== 23-Jul-2010::10:27:14 ===
starting TCP connection <0.3879.4> from <loadbalancer_ip>:1706

=WARNING REPORT==== 23-Jul-2010::10:27:14 ===
exception on TCP connection <0.3879.4> from <loadbalancer_ip>:1706
connection_closed_abruptly

=INFO REPORT==== 23-Jul-2010::10:27:14 ===
closing TCP connection <0.3879.4> from <loadbalancer_ip>:1706
_________________________________________________________________________

Messages sent to RabbitMQ are being handled properly and consumers seem to be 
receiving them just fine. What do these errors mean?

I'm using RabbitMQ 1.8.1 with Erlang R13B04.

Thanks,
Dave



      

From scott at beamdog.com  Fri Jul 23 16:45:11 2010
From: scott at beamdog.com (Scott Brooks)
Date: Fri, 23 Jul 2010 09:45:11 -0600
Subject: [rabbitmq-discuss] Slides from a RabbitMQ presentation
In-Reply-To: <AANLkTikMeCP59jap4VrVnZtLq5c2t4s-tzyfB9u0JVPL@mail.gmail.com>
References: <AANLkTikCCADgBkZB-AWAuvK62vhTVlIsbVb0gwj5CO2C@mail.gmail.com>
	<AANLkTikMeCP59jap4VrVnZtLq5c2t4s-tzyfB9u0JVPL@mail.gmail.com>
Message-ID: <AANLkTi=1S7mkgLZfRMWza6gW77Byj_90wEfnR+4m3nqY@mail.gmail.com>

I've updated the slides a bit to include some of the comments from
here.  I've cleaned up the last slide a bit more since at the talk I
went into what I meant a bit more.  You're right that it could be a
little confusing otherwise.  Let me know if it's clearer now.

On Fri, Jul 23, 2010 at 3:16 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Scott
>
> Nice slides. ?It would be interesting to get more of your thoughts on
> use cases. ?I think that we could make it easier for users to set up a
> few simple cases like "pubsub" without having to work out which
> exchanges to use, and "shared queue" without having to think about
> routing. ?In other words: to make Rabbit's interface more humane
> especially for the simple cases.
>
> Separately on your last slide --- some readers *may* infer that unless
> a message is "stored" in a database, then it can be lost. ?But Rabbit
> (and, indeed, AMQP) supports message persistence for *recovery*. ?If I
> could suggest one change, it would be to clarify that.
>
> alexis
>
>
>
>
> On Thu, Jul 22, 2010 at 6:17 PM, Scott Brooks <scott at beamdog.com> wrote:
>> I spoke at my local ruby users group yegrb.com about RabbitMQ
>>
>> Here are the slides, they may be of interest.
>> http://docs.google.com/present/embed?id=dck5j8mb_0rqn4psdg&size=l
>>
>> Let me know if there is anything wrong/or things I could improve on.
>>
>> Scott Brooks
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From irrer at umich.edu  Fri Jul 23 20:46:59 2010
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 23 Jul 2010 15:46:59 -0400
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com> 
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>

Ok, that was no help at all,    :)
but I got it working.

The big key is to replace all of the socket calls with Windows
compatible calls (which you probably did):

write --> sendto
read --> recvfrom
close --> closesocket
htons macro --> htons function
use MS inet_addr function
call WSAStartup before you do anything
(not sure if I listed all of them)

It seems to me that generating code on site using Python is
a little heavy handed - requires installation of Python.  Simpler
would be to package code for each protocol version and then
control which was being used with #if statements.  Just a suggestion.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Wed, Jul 14, 2010 at 6:11 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi Jim,
>
> Jim Irrer <irrer at umich.edu> writes:
> > I know this is experimental, but I'm trying to compile the rabbitmq-c
> libs
> > under mingw on Windows.
>
> The work to support building rabbitmq-c under mingw still lives in a
> branch.  Please checkout bug22825, and read README.windows carefully.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/ef78c97f/attachment.htm>

From johndapps at gmail.com  Fri Jul 23 20:56:21 2010
From: johndapps at gmail.com (John Apps)
Date: Fri, 23 Jul 2010 21:56:21 +0200
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
	<AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
Message-ID: <AANLkTinpWKWP=UtRCdYn8h4zrh=XLx+EP-HzYvBD6y3q@mail.gmail.com>

Jim,
  will you be making the changes you have made available? I have been
thinking of compiling the libRabbitMQ-C library, but have not found the time
yet.

On Fri, Jul 23, 2010 at 21:46, Jim Irrer <irrer at umich.edu> wrote:

> Ok, that was no help at all,    :)
> but I got it working.
>
> The big key is to replace all of the socket calls with Windows
> compatible calls (which you probably did):
>
> write --> sendto
> read --> recvfrom
> close --> closesocket
> htons macro --> htons function
> use MS inet_addr function
> call WSAStartup before you do anything
> (not sure if I listed all of them)
>
> It seems to me that generating code on site using Python is
> a little heavy handed - requires installation of Python.  Simpler
> would be to package code for each protocol version and then
> control which was being used with #if statements.  Just a suggestion.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Wed, Jul 14, 2010 at 6:11 PM, David Wragg <david at rabbitmq.com> wrote:
>
>> Hi Jim,
>>
>> Jim Irrer <irrer at umich.edu> writes:
>> > I know this is experimental, but I'm trying to compile the rabbitmq-c
>> libs
>> > under mingw on Windows.
>>
>> The work to support building rabbitmq-c under mingw still lives in a
>> branch.  Please checkout bug22825, and read README.windows carefully.
>>
>> David
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/1d2918f7/attachment-0001.htm>

From david at rabbitmq.com  Fri Jul 23 20:57:44 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 23 Jul 2010 20:57:44 +0100
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
	(Jim Irrer's message of "Fri, 23 Jul 2010 15:46:59 -0400")
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
	<AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
Message-ID: <yrv4c39vam0nb.fsf@dwragg.eng.vmware.com>

Jim Irrer <irrer at umich.edu> writes:
> Ok, that was no help at all,    :)
> but I got it working.
>
> The big key is to replace all of the socket calls with Windows
> compatible calls (which you probably did):
>
> write --> sendto
> read --> recvfrom
> close --> closesocket
> htons macro --> htons function
> use MS inet_addr function
> call WSAStartup before you do anything
> (not sure if I listed all of them)

The bug22825 branch does this, and a few other things besides, while
maintaining support for builds under unix-descended operating systems
too.

Could you tell me what the reason you were unable to use it was?
bu22825 is likely to be merged into default in the not too distant
future, so if there is a problem with it, it would be cool if you could
let us know about it.


David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From irrer at umich.edu  Fri Jul 23 22:28:29 2010
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 23 Jul 2010 17:28:29 -0400
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <yrv4c39vam0nb.fsf@dwragg.eng.vmware.com>
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com> 
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
	<AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com> 
	<yrv4c39vam0nb.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=MzKy3HiezCM1PzFk1UqO6xe1bEOVJgYcZEVW2@mail.gmail.com>

The advice made no explicit mention of a URL to download and I
got the main (wrong) branch of the code.  It had no windows
subdirectory under librabbitmq.

That was a lot of pain for nothing.

FYI:

After more searching of the web site I just now downloaded
http://hg.rabbitmq.com/rabbitmq-c/archive/22cb3bbbca10.tar.gz
which had no configure file as mentioned in the README.windows.

Running autoreconf -i yields:

configure.ac:13: error: Autoconf version 2.58 or higher is required
aclocal.m4:1250: LT_INIT is expanded from...
aclocal.m4:1254: AM_PROG_LIBTOOL is expanded from...
configure.ac:13: the top level
autom4te: /bin/m4 failed with exit status: 1
configure.ac:13: error: Autoconf version 2.58 or higher is required
aclocal.m4:1250: LT_INIT is expanded from...
aclocal.m4:1254: AM_PROG_LIBTOOL is expanded from...
configure.ac:13: the top level
autom4te: /bin/m4 failed with exit status: 1
autoreconf: /usr/bin/autoconf failed with exit status: 1

and it fails to make a configure file.

My mingw autoconf is at version 2.56 and I don't know how to upgrade it.
I just downloaded and installed mingw a few weeks ago and this is the
version that
was there.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 23, 2010 at 3:57 PM, David Wragg <david at rabbitmq.com> wrote:

> Jim Irrer <irrer at umich.edu> writes:
> > Ok, that was no help at all,    :)
> > but I got it working.
> >
> > The big key is to replace all of the socket calls with Windows
> > compatible calls (which you probably did):
> >
> > write --> sendto
> > read --> recvfrom
> > close --> closesocket
> > htons macro --> htons function
> > use MS inet_addr function
> > call WSAStartup before you do anything
> > (not sure if I listed all of them)
>
> The bug22825 branch does this, and a few other things besides, while
> maintaining support for builds under unix-descended operating systems
> too.
>
> Could you tell me what the reason you were unable to use it was?
> bu22825 is likely to be merged into default in the not too distant
> future, so if there is a problem with it, it would be cool if you could
> let us know about it.
>
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100723/c6909888/attachment.htm>

From david at rabbitmq.com  Sat Jul 24 00:19:43 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 24 Jul 2010 00:19:43 +0100
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <AANLkTi=MzKy3HiezCM1PzFk1UqO6xe1bEOVJgYcZEVW2@mail.gmail.com>
	(Jim Irrer's message of "Fri, 23 Jul 2010 17:28:29 -0400")
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
	<AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
	<yrv4c39vam0nb.fsf@dwragg.eng.vmware.com>
	<AANLkTi=MzKy3HiezCM1PzFk1UqO6xe1bEOVJgYcZEVW2@mail.gmail.com>
Message-ID: <yrv4chbjppz00.fsf@dwragg.eng.vmware.com>

Hi Jim,

Jim Irrer <irrer at umich.edu> writes:
> The advice made no explicit mention of a URL to download and I
> got the main (wrong) branch of the code.  It had no windows
> subdirectory under librabbitmq.

Sorry if my advice was unclear.  As we only distribute rabbitmq-c
through Mercurial, I was assuming you'd be able to find the branch
without too much trouble.

> That was a lot of pain for nothing.
>
> FYI:
>
> After more searching of the web site I just now downloaded
> http://hg.rabbitmq.com/rabbitmq-c/archive/22cb3bbbca10.tar.gz
> which had no configure file as mentioned in the README.windows.
>
> Running autoreconf -i yields:
>
> configure.ac:13: error: Autoconf version 2.58 or higher is required
> aclocal.m4:1250: LT_INIT is expanded from...
> aclocal.m4:1254: AM_PROG_LIBTOOL is expanded from...
> configure.ac:13: the top level
> autom4te: /bin/m4 failed with exit status: 1
> configure.ac:13: error: Autoconf version 2.58 or higher is required
> aclocal.m4:1250: LT_INIT is expanded from...
> aclocal.m4:1254: AM_PROG_LIBTOOL is expanded from...
> configure.ac:13: the top level
> autom4te: /bin/m4 failed with exit status: 1
> autoreconf: /usr/bin/autoconf failed with exit status: 1
>
> and it fails to make a configure file.
>
> My mingw autoconf is at version 2.56 and I don't know how to upgrade it.
> I just downloaded and installed mingw a few weeks ago and this is the
> version that
> was there.

Fair point.  When I wrote that README.windows, I was really thinking in
terms of a source distribution tarball, in which the configure file
would already be made.  I'm not sure I've tried autoconf under mingw.
But now that you've pointed this out, I'll see if I can get it working.

The mingw distribution method tends to be a bit chaotic, which is why I
wrote the install-mingw.sh script to install the correct versions of the
other tools required to build.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From thomas.sanchz at gmail.com  Sat Jul 24 05:11:25 2010
From: thomas.sanchz at gmail.com (Thomas Sanchez)
Date: Fri, 23 Jul 2010 21:11:25 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq and clustering
In-Reply-To: <6a71461a-2a71-40aa-a41f-26176baac1a1@v6g2000prd.googlegroups.com>
References: <839931.84391.qm@web111001.mail.gq1.yahoo.com> 
	<6a71461a-2a71-40aa-a41f-26176baac1a1@v6g2000prd.googlegroups.com>
Message-ID: <e2e59754-9818-4830-9cfc-76b6a55deb6e@s24g2000pri.googlegroups.com>

So I could start a cluster and play with some rabbitmq nodes + an
haproxy !

So, if it can help someone:
- Each node need to know each others nodes. I used the /etc/hosts file
BUT
hostname cannot contains `.`. I did not try with `-`.
Moreover rabbitmq won't be able to start if it cannot resolve its
hostname. So you have
to add (it is not already present) in /etc/hosts a line like this:
127.0.0.1 YOURHOSTNAME

- Each node must have the same erlang cookie (located in: /var/lib/
rabbitmq/.erlang.cookie). I did not try to set it as parameter.

- Port 5672, 4369 and the port for rabbit nodes wich is dynamically
determined BUT it can be fixed by adding this lines:
-kernel inet_dist_listen_min PORT
-kernel inet_dist_listen_max PORT
as argument in file: /usr/lib/rabbitmq/bin/rabbitmq-server.

If you set the same port in the two line, obviously it'll be the
chosen port.

I hope this can help somebody, but I think that the documentation
should mention this.

Regards.

On Jul 21, 5:30?pm, Thomas Sanchez <thomas.san... at gmail.com> wrote:
> Thanks for your response, it can be a port issue.
> I've to check that
>
> Thanks !
>
> On Jul 21, 3:36?pm, Dave Greggory <davegregg... at yahoo.com> wrote:
>
>
>
> > Just to clarify, I got this problem when I was trying out 1.7.2 and it gave no
> > indication of any problems in any of the logs. I just saw the rabbtmqctl status
> > didn't list the two nodes. The error you're seeing may not be related to ports
> > not being open but it's something to double check.
>
> > ----- Original Message ----
> > From: Dave Greggory <davegregg... at yahoo.com>
> > To: rabbitmq-disc... at lists.rabbitmq.com
> > Sent: Wed, July 21, 2010 6:33:52 PM
> > Subject: Re: [rabbitmq-discuss] RabbitMq and clustering
>
> > You need to have more ports open than just the regular 5672. This one bit me as
> > well.
>
> > Seehttp://old.nabble.com/Re%3A-problems-with-rabbitmq-cluster-across-2%0...
>
> > andhttp://www.joshdevins.net/2010/03/21/rabbitmq-cluster-auto-configurat...
>
> > ----- Original Message ----
> > From: Thomas Sanchez <thomas.san... at gmail.com>
> > To: rabbitmq-disc... at lists.rabbitmq.com
> > Sent: Wed, July 21, 2010 6:27:05 PM
> > Subject: [rabbitmq-discuss] RabbitMq and clustering
>
> > Hi guys,
>
> > I'm trying to setup a cluster.
> > I followed the documentation here:http://www.rabbitmq.com/clustering.html
>
> > root at lucid:~# cat /etc/hosts
> > 127.0.0.1 ? localhost
> > 127.0.1.1 ? lucid
> > 10.252.XXX.XXX
> > rabbit1
>
> > root at lucid:~# rabbitmqctl stop_app
> > Stopping node rabbit at lucid ...
> > ...done.
> > root at lucid:~# rabbitmqctl reset
> > Resetting node rabbit at lucid ...
> > ...done.
> > root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
> > Clustering node rabbit at lucid with [rabbit at rabbit1] ...
> > Error: {failed_to_cluster_with,[rabbit at rabbit1],
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"Mnesia could not connect to some nodes."}
>
> > There is nothing in log.
> > I'm running the 1.8.1 version of rabbitmq (installed from .deb package)
>
> > erlang:
> > Erlang (BEAM) emulator version 5.7.4
> > Compiled on Fri Apr ?9 11:08:48 2010
>
> > Have you some ideas on what happens ?
>
> > Thanks.
>
> > --
> > Thomas Sanchez
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From thomas.sanchz at gmail.com  Sat Jul 24 05:14:32 2010
From: thomas.sanchz at gmail.com (Thomas Sanchez)
Date: Fri, 23 Jul 2010 21:14:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq and clustering
In-Reply-To: <e2e59754-9818-4830-9cfc-76b6a55deb6e@s24g2000pri.googlegroups.com>
References: <839931.84391.qm@web111001.mail.gq1.yahoo.com> 
	<6a71461a-2a71-40aa-a41f-26176baac1a1@v6g2000prd.googlegroups.com> 
	<e2e59754-9818-4830-9cfc-76b6a55deb6e@s24g2000pri.googlegroups.com>
Message-ID: <e7c65419-869b-4813-af2b-fc36ad442d2d@l25g2000prn.googlegroups.com>

- *Open* port 5672, 4369 and the port for rabbit nodes wich is
dynamically
determined BUT it can be fixed by adding this lines:
-kernel inet_dist_listen_min PORT
-kernel inet_dist_listen_max PORT
as argument in file: /usr/lib/rabbitmq/bin/rabbitmq-server.

Sorry for the typo.

On Jul 23, 9:11?pm, Thomas Sanchez <thomas.san... at gmail.com> wrote:
> So I could start a cluster and play with some rabbitmq nodes + an
> haproxy !
>
> So, if it can help someone:
> - Each node need to know each others nodes. I used the /etc/hosts file
> BUT
> hostname cannot contains `.`. I did not try with `-`.
> Moreover rabbitmq won't be able to start if it cannot resolve its
> hostname. So you have
> to add (it is not already present) in /etc/hosts a line like this:
> 127.0.0.1 YOURHOSTNAME
>
> - Each node must have the same erlang cookie (located in: /var/lib/
> rabbitmq/.erlang.cookie). I did not try to set it as parameter.
>
> - Port 5672, 4369 and the port for rabbit nodes wich is dynamically
> determined BUT it can be fixed by adding this lines:
> -kernel inet_dist_listen_min PORT
> -kernel inet_dist_listen_max PORT
> as argument in file: /usr/lib/rabbitmq/bin/rabbitmq-server.
>
> If you set the same port in the two line, obviously it'll be the
> chosen port.
>
> I hope this can help somebody, but I think that the documentation
> should mention this.
>
> Regards.
>
> On Jul 21, 5:30?pm, Thomas Sanchez <thomas.san... at gmail.com> wrote:
>
>
>
> > Thanks for your response, it can be a port issue.
> > I've to check that
>
> > Thanks !
>
> > On Jul 21, 3:36?pm, Dave Greggory <davegregg... at yahoo.com> wrote:
>
> > > Just to clarify, I got this problem when I was trying out 1.7.2 and it gave no
> > > indication of any problems in any of the logs. I just saw the rabbtmqctl status
> > > didn't list the two nodes. The error you're seeing may not be related to ports
> > > not being open but it's something to double check.
>
> > > ----- Original Message ----
> > > From: Dave Greggory <davegregg... at yahoo.com>
> > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > Sent: Wed, July 21, 2010 6:33:52 PM
> > > Subject: Re: [rabbitmq-discuss] RabbitMq and clustering
>
> > > You need to have more ports open than just the regular 5672. This one bit me as
> > > well.
>
> > > Seehttp://old.nabble.com/Re%3A-problems-with-rabbitmq-cluster-across-2%0...
>
> > > andhttp://www.joshdevins.net/2010/03/21/rabbitmq-cluster-auto-configurat...
>
> > > ----- Original Message ----
> > > From: Thomas Sanchez <thomas.san... at gmail.com>
> > > To: rabbitmq-disc... at lists.rabbitmq.com
> > > Sent: Wed, July 21, 2010 6:27:05 PM
> > > Subject: [rabbitmq-discuss] RabbitMq and clustering
>
> > > Hi guys,
>
> > > I'm trying to setup a cluster.
> > > I followed the documentation here:http://www.rabbitmq.com/clustering.html
>
> > > root at lucid:~# cat /etc/hosts
> > > 127.0.0.1 ? localhost
> > > 127.0.1.1 ? lucid
> > > 10.252.XXX.XXX
> > > rabbit1
>
> > > root at lucid:~# rabbitmqctl stop_app
> > > Stopping node rabbit at lucid ...
> > > ...done.
> > > root at lucid:~# rabbitmqctl reset
> > > Resetting node rabbit at lucid ...
> > > ...done.
> > > root at lucid:~# rabbitmqctl cluster rabbit at rabbit1
> > > Clustering node rabbit at lucid with [rabbit at rabbit1] ...
> > > Error: {failed_to_cluster_with,[rabbit at rabbit1],
> > > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"Mnesia could not connect to some nodes."}
>
> > > There is nothing in log.
> > > I'm running the 1.8.1 version of rabbitmq (installed from .deb package)
>
> > > erlang:
> > > Erlang (BEAM) emulator version 5.7.4
> > > Compiled on Fri Apr ?9 11:08:48 2010
>
> > > Have you some ideas on what happens ?
>
> > > Thanks.
>
> > > --
> > > Thomas Sanchez
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From davegreggory at yahoo.com  Sat Jul 24 16:33:35 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Sat, 24 Jul 2010 08:33:35 -0700 (PDT)
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
Message-ID: <3256.34232.qm@web111005.mail.gq1.yahoo.com>

Hey all,

This is one of the better mailing lists I've been, it seems to have a high 
signal to noise ratio here. 


I've presenting RabbitMQ as a solution to the powers that be on Monday and I 
would like to know about your experiences with using RabbitMQ in high volume 
environment needing guaranteed delivery.

1. Erlang VM/RabbitMQ management: It was a breeze for me to get RabbitMQ running 
on Ubuntu (<10m) but our  operations folks had a lot of trouble getting 
Erlang/RabbitMQ installed  on CentOs (>5hrs). I haven't run into any issues in 
our QA environment yet, but it's not very high volume. What type of issues 
should I expect in a production environment with regards to managing the Erlang 
VM and RabbitMQ in general? I'm looking at it from the perspective of having a 
game-plan for what to do when things go wrong and to have runbooks for 
operations people to follow for solving common and known problems that come up 
in day-to-day management of Erlang VM and RabbitMQ.
2. HA/Failover: I've seen the Pacemaker guide but I'm a little hesitant to set 
that up as we have little experience in house with Pacemaker/Corosync/DRBD. How 
many people use it for HA/Failover in production systems and how happy are you 
with it? Does it support failing over if the hard drive on one of the nodes die 
instead something a little more simple like a node running out of memory or 
hanging?
3. Out of the box live failover: I've read in a few places on site that this is 
coming in a future release? Do we have an idea of how far off this is (3 months? 
6 months? or too far off to speculate?)
4. What tools do you use for broker administration in production environments? 
Does anyone use BQL and have a good experience running it without any issues in 
a high volume/guaranteed delivery environment? It's not yet officially released 
so I don't want to run it in a production environment. If not, how do you 
manage? Tools built in-house? Is it even possible to do that without resorting 
to programming Erlang?
5. How do you monitor RabbitMQ nodes and what do you monitor for (I'm thinking 
of monitoring various queue sizes)? The Zenoss AMQP Plugin looks interesting to 
us, but I have been informed that it's not playing nice with latest Zenoss. 


Any other thoughts that come to mind... please feel free to share.
Thanks much,

Dave



      

From david at rabbitmq.com  Sat Jul 24 16:55:12 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 24 Jul 2010 16:55:12 +0100
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <3256.34232.qm@web111005.mail.gq1.yahoo.com> (Dave Greggory's
	message of "Sat, 24 Jul 2010 08:33:35 -0700 (PDT)")
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
Message-ID: <yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>

Hi Dave,

Just addressing one point from your email:

Dave Greggory <davegreggory at yahoo.com> writes:
> 1. Erlang VM/RabbitMQ management: It was a breeze for me to get RabbitMQ running 
> on Ubuntu (<10m) but our  operations folks had a lot of trouble getting 
> Erlang/RabbitMQ installed  on CentOs (>5hrs).

Do you know what issues they ran into that took up so much time?

It shouldn't be significantly harder to install RabbitMQ on CentOS than
on Ubuntu.  You have to enable EPEL on CentOS, but after that the
processes are equivalent.  Search for CentOS on
<http://www.rabbitmq.com/server.html>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From andrius.norkaitis at oryo.lt  Sat Jul 24 18:40:36 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Sat, 24 Jul 2010 20:40:36 +0300
Subject: [rabbitmq-discuss] messages delivery question
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>

Hi,

 

I got some strange situation with messages delivery.

Publisher sends two messages, first one is send with TxSelect, second -
without:

 

ch.TxSelect()

ch.BasicPublish(exchange, routingKey, true, false, basicProperties, body);
//publishing #1 msg

ch.TxCommit();

ch.BasicPublish(exchange, routingKey, true, false, basicProperties, body);
//publishing #2 msg

 

Problem is that consumer gets only first message. Second message is
delivered only if I call this code again and send new two messages, where
the last one is not delivered immediately again.

 

Consumer is .NET client using Subscription class: sub = new Subscription(ch,
BindToQueryID, false, exchange, exchangeType, routingKey);

 

Any ideas?

 

Best regards

Andrius Norkaitis

Skype: andriusnorkaitis

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100724/4dd01341/attachment.htm>

From matthew at rabbitmq.com  Sat Jul 24 18:47:35 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 24 Jul 2010 18:47:35 +0100
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
Message-ID: <20100724174734.GB22389@wellquite.org>

Hi,

Once you put a channel in transactional mode, it stays in transactional
mode until you close the channel. Your second publish is waiting for a
commit.

You cannot take a channel out of transactional mode without closing it
and reopening it.

Matthew

From andrius.norkaitis at oryo.lt  Sat Jul 24 19:10:26 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Sat, 24 Jul 2010 21:10:26 +0300
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <20100724174734.GB22389@wellquite.org>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
	<20100724174734.GB22389@wellquite.org>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>

Thanks, Matthew!!!

I was reusing one channel to publish messages. Should I create two channels
(one transactional, one not) and reuse them or it better always create new
one?
In my case messages rate is slow (1 msg per 10 secs).

Regards
Andrius Norkaitis


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
Sackman
Sent: Saturday, July 24, 2010 8:48 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] messages delivery question

Hi,

Once you put a channel in transactional mode, it stays in transactional mode
until you close the channel. Your second publish is waiting for a commit.

You cannot take a channel out of transactional mode without closing it and
reopening it.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Sat Jul 24 19:28:55 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 24 Jul 2010 19:28:55 +0100
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
	<20100724174734.GB22389@wellquite.org>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>
Message-ID: <20100724182855.GC22389@wellquite.org>

On Sat, Jul 24, 2010 at 09:10:26PM +0300, Andrius Norkaitis wrote:
> I was reusing one channel to publish messages. Should I create two channels
> (one transactional, one not) and reuse them or it better always create new
> one?

Better to have two channels and keep them open. At your msg rates, it's
not so important, but generally channel creation isn't /that/ cheap an
operation, so best to keep them open after creation.

Matthew

From scott at beamdog.com  Sat Jul 24 23:43:57 2010
From: scott at beamdog.com (Scott Brooks)
Date: Sat, 24 Jul 2010 16:43:57 -0600
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTimaaLythaX7mOJnVNyiwbcMS0pGLhFfaztgVbWQ@mail.gmail.com>

I think the problem with CentOS 5.5/EPEL is that it includes erlang
R12B-5(last I checked)

That's perfectly fine to get up and running on, but the general wisdom
AFAIK is if you are going into production you want to be on R13-B03 or
above for the GC improvements.

Scott Brooks

On Sat, Jul 24, 2010 at 9:55 AM, David Wragg <david at rabbitmq.com> wrote:
> Hi Dave,
>
> Just addressing one point from your email:
>
> Dave Greggory <davegreggory at yahoo.com> writes:
>> 1. Erlang VM/RabbitMQ management: It was a breeze for me to get RabbitMQ running
>> on Ubuntu (<10m) but our ?operations folks had a lot of trouble getting
>> Erlang/RabbitMQ installed ?on CentOs (>5hrs).
>
> Do you know what issues they ran into that took up so much time?
>
> It shouldn't be significantly harder to install RabbitMQ on CentOS than
> on Ubuntu. ?You have to enable EPEL on CentOS, but after that the
> processes are equivalent. ?Search for CentOS on
> <http://www.rabbitmq.com/server.html>.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From scott at beamdog.com  Sat Jul 24 23:46:31 2010
From: scott at beamdog.com (Scott Brooks)
Date: Sat, 24 Jul 2010 16:46:31 -0600
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <20100724182855.GC22389@wellquite.org>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
	<20100724174734.GB22389@wellquite.org>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>
	<20100724182855.GC22389@wellquite.org>
Message-ID: <AANLkTimXrG1aq4N2NHAJYSrJCYRVvDYKonpS1D3g4pSk@mail.gmail.com>

You can just call ch.TxCommit again.

Once you call ch.TxSelect(), you need to commit to complete the
transaction.  A Commit implicitly starts another transaction.

On Sat, Jul 24, 2010 at 12:28 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Sat, Jul 24, 2010 at 09:10:26PM +0300, Andrius Norkaitis wrote:
>> I was reusing one channel to publish messages. Should I create two channels
>> (one transactional, one not) and reuse them or it better always create new
>> one?
>
> Better to have two channels and keep them open. At your msg rates, it's
> not so important, but generally channel creation isn't /that/ cheap an
> operation, so best to keep them open after creation.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From david at rabbitmq.com  Sun Jul 25 01:18:38 2010
From: david at rabbitmq.com (David Wragg)
Date: Sun, 25 Jul 2010 01:18:38 +0100
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <AANLkTimaaLythaX7mOJnVNyiwbcMS0pGLhFfaztgVbWQ@mail.gmail.com>
	(Scott Brooks's message of "Sat, 24 Jul 2010 16:43:57 -0600")
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>
	<AANLkTimaaLythaX7mOJnVNyiwbcMS0pGLhFfaztgVbWQ@mail.gmail.com>
Message-ID: <yrv4c8w50pg69.fsf@dwragg.eng.vmware.com>

Hi Scott,

Scott Brooks <scott at beamdog.com> writes:
> I think the problem with CentOS 5.5/EPEL is that it includes erlang
> R12B-5(last I checked)
>
> That's perfectly fine to get up and running on, but the general wisdom
> AFAIK is if you are going into production you want to be on R13-B03 or
> above for the GC improvements.

It's true that R13 versions are preferred.  On the other hand, we
currently support erlang versions back to R12-B3, and therefore rabbitmq
is supported in EPEL5.  I hope that no-one wanting to try rabbit is
investing hours of effort to build a later erlang version, unless they
are sure that their application really needs it.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From clegnitto at mozilla.com  Sun Jul 25 03:08:09 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Sat, 24 Jul 2010 19:08:09 -0700
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <yrv4c8w50pg69.fsf@dwragg.eng.vmware.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>
	<AANLkTimaaLythaX7mOJnVNyiwbcMS0pGLhFfaztgVbWQ@mail.gmail.com>
	<yrv4c8w50pg69.fsf@dwragg.eng.vmware.com>
Message-ID: <BB191399-1118-4068-99E5-9161FC98C8F7@mozilla.com>

On Jul 24, 2010, at 5:18 PM, David Wragg wrote:

> Hi Scott,
> 
> Scott Brooks <scott at beamdog.com> writes:
>> I think the problem with CentOS 5.5/EPEL is that it includes erlang
>> R12B-5(last I checked)
>> 
>> That's perfectly fine to get up and running on, but the general wisdom
>> AFAIK is if you are going into production you want to be on R13-B03 or
>> above for the GC improvements.
> 
> It's true that R13 versions are preferred.  On the other hand, we
> currently support erlang versions back to R12-B3, and therefore rabbitmq
> is supported in EPEL5.  I hope that no-one wanting to try rabbit is
> investing hours of effort to build a later erlang version, unless they
> are sure that their application really needs it.
> 
> David

I would like to chime in that it wasn't painful at all for me to install on a (fairly lean) VM of RHEL 5.5, which I think is the same as CentOS 5.5....here are my (sparse, old) notes:

* Couldn't find a rpm, looked for 5 mins (RHEL 5.5)
* Downloaded http://www.erlang.org/download/otp_src_R13B04.tar.gz
* unzipped, configure && make && make install
* failed with:
    configure: error: /bin/sh '/source/otp_src_R13B04/erts/configure' failed for erts
* yum install ncurses-devel
* configure && make && make install
* Installed to /usr/local/{bin,lib/erlang} (default)

I then create my own RabbitMQ rpm from source and install it (slightly more involved as there are more deps and the python on 5.5 is ancient, but not hard).  I can try to provide notes if someone wants them.

Is there a particular step you had issues with? Were you creating a rpm (or trying to find one in the assorted repos) for erlang instead?

Christian




From davegreggory at yahoo.com  Sun Jul 25 13:30:19 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Sun, 25 Jul 2010 05:30:19 -0700 (PDT)
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <BB191399-1118-4068-99E5-9161FC98C8F7@mozilla.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<yrv4cd3ucq3hb.fsf@dwragg.eng.vmware.com>
	<AANLkTimaaLythaX7mOJnVNyiwbcMS0pGLhFfaztgVbWQ@mail.gmail.com>
	<yrv4c8w50pg69.fsf@dwragg.eng.vmware.com>
	<BB191399-1118-4068-99E5-9161FC98C8F7@mozilla.com>
Message-ID: <497191.15413.qm@web111011.mail.gq1.yahoo.com>

Not completely sure what the problems our operations folks had... but they tried 
EPEL but couldn't get Rabbit to work on that. They may have been simple errors 
but were not easy to troubleshoot since none of them were familiar with Erlang 
and it's error logs are pretty hard to read. 


Eventually, they compiled erlang   R13B4 from scratch and used rabbitmq generic 
linux version. Either   way, this is not a problem anymore, since we're up and 
running. 


I   would rather appreciate hearing people's thoughts on my questions.



      

From david at rabbitmq.com  Mon Jul 26 04:39:16 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 26 Jul 2010 04:39:16 +0100
Subject: [rabbitmq-discuss] compiling rabbitmq-c under mingw
In-Reply-To: <yrv4chbjppz00.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Sat, 24 Jul 2010 00:19:43 +0100")
References: <AANLkTikKN0iOYoOXka7NaKcw49Tah9nS938m9cTtA9Cz@mail.gmail.com>
	<yrv4c1vb5btob.fsf@dwragg.eng.vmware.com>
	<AANLkTinzX7xXJY4x+GPS3NP+KPhe2mWK0g+rO3ZJskDy@mail.gmail.com>
	<yrv4c39vam0nb.fsf@dwragg.eng.vmware.com>
	<AANLkTi=MzKy3HiezCM1PzFk1UqO6xe1bEOVJgYcZEVW2@mail.gmail.com>
	<yrv4chbjppz00.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4ck4oisyhn.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> Jim Irrer <irrer at umich.edu> writes:
>> My mingw autoconf is at version 2.56 and I don't know how to upgrade it.
>> I just downloaded and installed mingw a few weeks ago and this is the
>> version that
>> was there.
>
> Fair point.  When I wrote that README.windows, I was really thinking in
> terms of a source distribution tarball, in which the configure file
> would already be made.  I'm not sure I've tried autoconf under mingw.
> But now that you've pointed this out, I'll see if I can get it
> working.

I've extended the install-mingw.sh script and the instructions in
README.windows to cover running autoreconf.

This is still in the bug22825 branch, but I've addressed other issues
raised during review, so I hope it will get merged before too much
longer.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From csshenqian at gmail.com  Mon Jul 26 04:40:11 2010
From: csshenqian at gmail.com (Chester Shen)
Date: Mon, 26 Jul 2010 11:40:11 +0800
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <4C485D3F.2090506@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
	<4C46B1FF.9090306@rabbitmq.com>	<1279704264.1602.292.camel@chestsh-ubunbu>
	<4C46C605.1050104@rabbitmq.com> <4C46CE02.8050302@rabbitmq.com>
	<20100721105931.GN24186@rabbitmq.com>
	<1279769810.1587.115.camel@chestsh-ubunbu>
	<4C485D3F.2090506@rabbitmq.com>
Message-ID: <1280115611.1554.46.camel@chestsh-ubunbu>

My program is running in a three nodes cluster, a publisher client on
one node publish non-persistent messages to non-durable, auto-delete
queues, two consumer clients on the other two nodes process messages in
threads that invoked by HandDelivery(). Is it possible that the
published messages are blocked in the server under this circumstance?

On Thu, 2010-07-22 at 16:01 +0100, Simon MacMullen wrote:
> 
> Hmm. It shouldn't do.
> 
> The best idea we can come up with at the moment is that the publish 
> messages are backing up in the channel process inside the server, 
> blocking the flow-ok message (which the client has sent) from getting 
> read. This requires the publishes to be happening comparatively slowly, 
> and for there to be a lot of them. Are you publishing persistent 
> messages to durable queues? If so, are you using transactions?
> 
> If this theory is correct then there's not a great deal we can do except 
> ask you to try the new persister. This would both relieve the memory 
> pressure and put a lower upper bound on how long it takes to publish a 
> persistent message.
> 
> Cheers, Simon
> 



From darius.damalakas at gmail.com  Mon Jul 26 08:30:23 2010
From: darius.damalakas at gmail.com (Darius Damalakas)
Date: Mon, 26 Jul 2010 10:30:23 +0300
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <AANLkTimXrG1aq4N2NHAJYSrJCYRVvDYKonpS1D3g4pSk@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>
	<20100724174734.GB22389@wellquite.org>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>
	<20100724182855.GC22389@wellquite.org>
	<AANLkTimXrG1aq4N2NHAJYSrJCYRVvDYKonpS1D3g4pSk@mail.gmail.com>
Message-ID: <AANLkTik7TUAinr4FCAgA5i7jYnq4daK-Ha8B+8HuEPm3@mail.gmail.com>

Is it possible to make the transactional channel not transactional?
I expect a NO answer, but better to be 100% sure than have a guess


2010/7/25 Scott Brooks <scott at beamdog.com>

> You can just call ch.TxCommit again.
>
> Once you call ch.TxSelect(), you need to commit to complete the
> transaction.  A Commit implicitly starts another transaction.
>
> On Sat, Jul 24, 2010 at 12:28 PM, Matthew Sackman <matthew at rabbitmq.com>
> wrote:
> > On Sat, Jul 24, 2010 at 09:10:26PM +0300, Andrius Norkaitis wrote:
> >> I was reusing one channel to publish messages. Should I create two
> channels
> >> (one transactional, one not) and reuse them or it better always create
> new
> >> one?
> >
> > Better to have two channels and keep them open. At your msg rates, it's
> > not so important, but generally channel creation isn't /that/ cheap an
> > operation, so best to keep them open after creation.
> >
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Link?jimai, Best Regards

Darius Damalakas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100726/83c4b288/attachment.htm>

From mikeb at rabbitmq.com  Mon Jul 26 09:02:22 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 26 Jul 2010 09:02:22 +0100
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <AANLkTik7TUAinr4FCAgA5i7jYnq4daK-Ha8B+8HuEPm3@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>	<20100724174734.GB22389@wellquite.org>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>	<20100724182855.GC22389@wellquite.org>	<AANLkTimXrG1aq4N2NHAJYSrJCYRVvDYKonpS1D3g4pSk@mail.gmail.com>
	<AANLkTik7TUAinr4FCAgA5i7jYnq4daK-Ha8B+8HuEPm3@mail.gmail.com>
Message-ID: <4C4D410E.9060903@rabbitmq.com>

> Is it possible to make the transactional channel not transactional?  
> I expect a NO answer, but better to be 100% sure than have a guess

The answer is indeed "No"; once you call tx.select, there's no going 
back.  Rightly or wrongly, that's just the way it's specified in AMQP.

--Michael


> 
> 2010/7/25 Scott Brooks <scott at beamdog.com <mailto:scott at beamdog.com>>
> 
>     You can just call ch.TxCommit again.
> 
>     Once you call ch.TxSelect(), you need to commit to complete the
>     transaction.  A Commit implicitly starts another transaction.
> 
>     On Sat, Jul 24, 2010 at 12:28 PM, Matthew Sackman
>     <matthew at rabbitmq.com <mailto:matthew at rabbitmq.com>> wrote:
>      > On Sat, Jul 24, 2010 at 09:10:26PM +0300, Andrius Norkaitis wrote:
>      >> I was reusing one channel to publish messages. Should I create
>     two channels
>      >> (one transactional, one not) and reuse them or it better always
>     create new
>      >> one?
>      >
>      > Better to have two channels and keep them open. At your msg
>     rates, it's
>      > not so important, but generally channel creation isn't /that/
>     cheap an
>      > operation, so best to keep them open after creation.
>      >
>      > Matthew
>      > _______________________________________________
>      > rabbitmq-discuss mailing list
>      > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>      > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>      >
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> Link?jimai, Best Regards
> 
> Darius Damalakas
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From therevoltingx at gmail.com  Mon Jul 26 09:59:38 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 26 Jul 2010 01:59:38 -0700
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
Message-ID: <AANLkTikMaXvLzLwffGwx_NHPa6Te3m3J8PeRgD3crnq1@mail.gmail.com>

Just to comment, it took me about an hour to set up (the latest at the
time) rabbitmq on CentOS 5.  I wrote a blog post about it here, maybe
it'll be helpful:
http://developingthedream.blogspot.com/2009/10/rabbitmq-erlang-client-yay.html

You can ignore the whole new project part, but installing rabbitmq
itself is fairly straightforward.
For management, there's Alice:
http://willcodeforfoo.com/2009/07/13/announcing-alice/

Apparently, with the new persister, rabbitmq can save messages to disk
before any crashes.  You can read more about it here:
http://www.rabbitmq.com/faq.html

However, I personally use a backup message storing system (PostgreSQL)
and redeliver undelivered messages (my queues are not durable.)  This
however makes for extra code.

Others might provide more insight, but that's my 2 cents from my
particular usage case.

On Sat, Jul 24, 2010 at 8:33 AM, Dave Greggory <davegreggory at yahoo.com> wrote:
> Hey all,
>
> This is one of the better mailing lists I've been, it seems to have a high
> signal to noise ratio here.
>
>
> I've presenting RabbitMQ as a solution to the powers that be on Monday and I
> would like to know about your experiences with using RabbitMQ in high volume
> environment needing guaranteed delivery.
>
> 1. Erlang VM/RabbitMQ management: It was a breeze for me to get RabbitMQ running
> on Ubuntu (<10m) but our ?operations folks had a lot of trouble getting
> Erlang/RabbitMQ installed ?on CentOs (>5hrs). I haven't run into any issues in
> our QA environment yet, but it's not very high volume. What type of issues
> should I expect in a production environment with regards to managing the Erlang
> VM and RabbitMQ in general? I'm looking at it from the perspective of having a
> game-plan for what to do when things go wrong and to have runbooks for
> operations people to follow for solving common and known problems that come up
> in day-to-day management of Erlang VM and RabbitMQ.
> 2. HA/Failover: I've seen the Pacemaker guide but I'm a little hesitant to set
> that up as we have little experience in house with Pacemaker/Corosync/DRBD. How
> many people use it for HA/Failover in production systems and how happy are you
> with it? Does it support failing over if the hard drive on one of the nodes die
> instead something a little more simple like a node running out of memory or
> hanging?
> 3. Out of the box live failover: I've read in a few places on site that this is
> coming in a future release? Do we have an idea of how far off this is (3 months?
> 6 months? or too far off to speculate?)
> 4. What tools do you use for broker administration in production environments?
> Does anyone use BQL and have a good experience running it without any issues in
> a high volume/guaranteed delivery environment? It's not yet officially released
> so I don't want to run it in a production environment. If not, how do you
> manage? Tools built in-house? Is it even possible to do that without resorting
> to programming Erlang?
> 5. How do you monitor RabbitMQ nodes and what do you monitor for (I'm thinking
> of monitoring various queue sizes)? The Zenoss AMQP Plugin looks interesting to
> us, but I have been informed that it's not playing nice with latest Zenoss.
>
>
> Any other thoughts that come to mind... please feel free to share.
> Thanks much,
>
> Dave
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
http://developingthedream.blogspot.com/,
http://diastrofunk.com,
http://www.youtube.com/user/revoltingx, ~Isaiah 55:8-9

From matthias at rabbitmq.com  Mon Jul 26 10:44:27 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 26 Jul 2010 10:44:27 +0100
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ
 Proxy Authentication patch/Plugin
In-Reply-To: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>
References: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>
Message-ID: <4C4D58FB.7090008@rabbitmq.com>

Scott,

On 22/07/10 05:11, Scott Brooks wrote:
> TLDR: proof of concept patch to rabbitmq-server, plugin, and ruby
> backend to authenticate users.
> http://github.com/Blaze74/rabbit_proxyauth
> http://github.com/Blaze74/proxyauth.rb

some comments on the server patch:

1) I'd prefer if this dealt with authentication only, not also 
authorisation. The latter is very rabbit-specific and likely to change 
in the future.

2) Your rabbit_access_control_proxy module should have an API that 
performs the gen_server calls, i.e. the interface to it should be a set 
of functions (e.g. authenticate(User, Pass) -> boolean()), not a set of 
gen_server messages. That's a general OTP design principle.

3) The authentication backend should be configurable via an 
"authentication_module" app env var, and the default setting should 
point to a module which refuses all authentication requests (i.e. 
returns 'false' in the authenticate/2 call).

The objective of 2 and 3 is to allow a plug-in to override the default 
setting for the authentication_module with a conforming alternative 
implementation. For an example of how to structure 2 and 3 (including 
behaviour definitions, spec files etc) take a look at the 
backing_queue_module setting in 'default'.


Regards,

Matthias.

From simon at rabbitmq.com  Mon Jul 26 11:32:11 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 26 Jul 2010 11:32:11 +0100
Subject: [rabbitmq-discuss] General questions about HA,
 Stability/Reliability and Broker Administration
In-Reply-To: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
Message-ID: <4C4D642B.70806@rabbitmq.com>

Hi Dave. I'll just reply to a couple of your points as well; hopefully 
eventually you'll get a full set of answers.

On 24/07/10 16:33, Dave Greggory wrote:
> 4. What tools do you use for broker administration in production environments?
> Does anyone use BQL and have a good experience running it without any issues in
> a high volume/guaranteed delivery environment? It's not yet officially released
> so I don't want to run it in a production environment. If not, how do you
> manage? Tools built in-house? Is it even possible to do that without resorting
> to programming Erlang?

Depends what you mean by broker administration. RabbitMQ provides 
everything you need in theory out of the box: use rabbitmqctl for user / 
vhost / permission administration and get your applications to declare 
all the AMQPish resources they need.

Some people prefer a unified view and a central point of administration 
for these things; at the moment BQL and Alice are the best options 
available.

> 5. How do you monitor RabbitMQ nodes and what do you monitor for (I'm thinking
> of monitoring various queue sizes)? The Zenoss AMQP Plugin looks interesting to
> us, but I have been informed that it's not playing nice with latest Zenoss.

There's a variety of monitoring tools people have put together, but as 
far as I know they're all really doing the equivalent of "rabbitmqctl 
list_queues" and exporting that somewhere. So all you get is a way to 
check the number of messages in queues (and polling that goes and wakes 
all your queues up).

We're aware that our monitoring situation is quite poor (and our 
management situation could use some polish) and we (well, I) am starting 
to take steps to improve the situation. Watch this space.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Mon Jul 26 12:05:31 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 26 Jul 2010 12:05:31 +0100
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
In-Reply-To: <237032.46347.qm@web111010.mail.gq1.yahoo.com> (Dave Greggory's
	message of "Fri, 23 Jul 2010 07:33:05 -0700 (PDT)")
References: <237032.46347.qm@web111010.mail.gq1.yahoo.com>
Message-ID: <yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com>

Hi Dave,

Dave Greggory <davegreggory at yahoo.com> writes:
> I configured my 2 node cluster to behind a load balancer that round robins to 
> the two nodes. Once I did that, I started noticing these errors in RabbitMQ 
> logs.
>
> [...]
>
> =INFO REPORT==== 23-Jul-2010::10:27:14 ===
> accepted TCP connection on 0.0.0.0:5672 from <loadbalancer_ip>:1706
>
> =INFO REPORT==== 23-Jul-2010::10:27:14 ===
> starting TCP connection <0.3879.4> from <loadbalancer_ip>:1706
>
> =WARNING REPORT==== 23-Jul-2010::10:27:14 ===
> exception on TCP connection <0.3879.4> from <loadbalancer_ip>:1706
> connection_closed_abruptly
>
> [...]
>
> Messages sent to RabbitMQ are being handled properly and consumers seem to be 
> receiving them just fine. What do these errors mean?

That is caused by clients disconnecting without following the proper
AMQP shutdown protocol, e.g. they simply close the socket instead of
sending a "connection.close" command and waiting for
"connection.close_ok".

Given the timestamps in the logs above, it looks like the load balancer
is connecting, and then promptly closing the connection.  This is
probably the load balancer probing to check that the nodes are available
from connections.  If so, they are nothing to worry about.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Mon Jul 26 12:07:40 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 26 Jul 2010 12:07:40 +0100
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
In-Reply-To: <yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Mon, 26 Jul 2010 12:05:31 +0100")
References: <237032.46347.qm@web111010.mail.gq1.yahoo.com>
	<yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4cmxtelcw3.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> Given the timestamps in the logs above, it looks like the load balancer
> is connecting, and then promptly closing the connection.  This is
> probably the load balancer probing to check that the nodes are available
> from connections.  If so, they are nothing to worry about.

^--- available *for* connections.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthew at rabbitmq.com  Mon Jul 26 16:09:44 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 26 Jul 2010 16:09:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ production setup questions around
 clustering
In-Reply-To: <AANLkTikx6uxqk8Ub_ulCm4FXAAocN8_p73MFFBO51v0q@mail.gmail.com>
References: <681276.9988.qm@web111008.mail.gq1.yahoo.com>
	<alpine.LNX.2.00.1007221224360.2650@dakota>
	<AANLkTikx6uxqk8Ub_ulCm4FXAAocN8_p73MFFBO51v0q@mail.gmail.com>
Message-ID: <20100726150944.GB6839@rabbitmq.com>

Hi Aaron,

On Thu, Jul 22, 2010 at 08:33:48AM -0400, Aaron Westendorf wrote:
> So I can
> connect to any host in the cluster, call basic.consume(), and receive
> messages from a queue that resides on another host?

Correct. However, the messages are only stored on the node on which the
queue was created, thus latency will be higher due to the extra hop than
connecting to the queue-local node.

> What about the
> case where multiple clients start at the same time and they each
> declare the queue and its bindings (identically)?

By using distributed transactions in mnesia, we detect this case. Also,
queue declaration is idempotent, so the "winner" of the race will indeed
create a new queue. The "loser" of the race will return the queue that
was created by the winner.

> I swear that we
> tried this exact setup, maybe in the 1.5 series, and we kept getting
> dropped messages.  This has a big effect on how one can go about
> clustering and failover, and matches our original plan for a generic
> pool of rabbit hosts.

There were some bugs back then, especially with regards to what happens
when a queue is declared that was previously declared on a now-failed
node. That used to be permitted and caused all sorts of problems when
the failed node came back up (if not before). That case is not expressly
forbidden and will result in a 404 (literally - the node on which this
queue has been created cannot be found).

With regards to fail over, it should be noted that clustering is not a
means for HA because of the fact that when a node goes down it takes its
queues with it, and those queues can't be recovered before the node
comes back up.

> We have very wide pipes between our hosts, but there's still overhead
> in handling inter-node traffic.  Is there an optimal setup, such as
> all consumers of a queue connected to the host on which it resides?

Yes. Within a cluster, there is no batching of deliveries at least
nothing we're doing explicitly. I don't think the VM does anything magic
underneath but I could be wrong. Thus you may wish to try to ensure that
clients are directly connected to the correct nodes for their queues.

On the publishing side, we do do explicit batching so if you are
publishing a message which ends up going to several queues all on some
other node, then that will only be sent as one message to the other node
rather than N messages.

Matthew

From matthew at rabbitmq.com  Mon Jul 26 16:11:40 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 26 Jul 2010 16:11:40 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
Message-ID: <20100726151140.GC6839@rabbitmq.com>

On Thu, Jul 22, 2010 at 10:59:43AM -0600, Scott Brooks wrote:
> Will this be RabbitMQ 2.0 when it gets released?  I figure 14 months
> is worth a 2.0

Apparently we have policy on version numbers, even for major version
number changes: http://www.rabbitmq.com/faq.html#version-numbering:

"major: This number indicates the major version of the software. It is
only changed for significant alterations to the software, such as (for
instance) a total rewrite"

Whilst a lot of code got rewritten, and a lot of code got added, I don't
think this counts as a "total rewrite" so alas, I don't think this will
be a 2.0.

Matthew

From matthew at rabbitmq.com  Mon Jul 26 16:30:12 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 26 Jul 2010 16:30:12 +0100
Subject: [rabbitmq-discuss] What is a good tradeoff for number of
 connections and channels/connection for a client ?
In-Reply-To: <AANLkTinx6eAxNfZrLxpLQOwFfNSdenovIpkwF88TR29p@mail.gmail.com>
References: <AANLkTilGwqufCKjkk-i-IpFRZW7DNWOweh0iMS1oNbvh@mail.gmail.com>
	<alpine.LNX.2.00.1007221746090.2650@dakota>
	<20100722170449.GC20367@rabbitmq.com>
	<AANLkTinx6eAxNfZrLxpLQOwFfNSdenovIpkwF88TR29p@mail.gmail.com>
Message-ID: <20100726153012.GD6839@rabbitmq.com>

On Thu, Jul 22, 2010 at 10:51:25PM +0530, Arun Suresh wrote:
> So is it safe for me to assume, that like Alex mentioned, there should NOT
> be any issue if I create ALL the channels on the same connection ?

There should be no issues. AMQP allows up to 16384 channels per
connection (though one is the magic channel 0, so you actually get 16383
"normal" channels to use), as this transcript from the erlang client
shows:

rabbitmq-erlang-client$ ERL_LIBS=deps:dist erl -pa ebin ../rabbitmq-server/ebin test +P 1000000
Erlang R14A (erts-5.8) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:0] [kernel-poll:false]

Eshell V5.8  (abort with ^G)
1> Conn = amqp_connection:start_network_link().

=INFO REPORT==== 26-Jul-2010::16:28:45 ===
Negotiated maximums: (Channel = 0, Frame= 131072, Heartbeat=0)
<0.34.0>
2> [amqp_connection:open_channel(Conn) || _ <- lists:seq(1,16383)].
[<0.42.0>,<0.45.0>,<0.48.0>,<0.51.0>,<0.54.0>,<0.57.0>,
 <0.60.0>,<0.63.0>,<0.66.0>,<0.69.0>,<0.72.0>,<0.75.0>,
 <0.78.0>,<0.81.0>,<0.84.0>,<0.87.0>,<0.90.0>,<0.93.0>,
 <0.96.0>,<0.99.0>,<0.102.0>,<0.105.0>,<0.108.0>,<0.111.0>,
 <0.114.0>,<0.117.0>,<0.120.0>,<0.123.0>,<0.126.0>|...]

Matthew

From scott at beamdog.com  Mon Jul 26 16:40:28 2010
From: scott at beamdog.com (Scott Brooks)
Date: Mon, 26 Jul 2010 09:40:28 -0600
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ
	Proxy Authentication patch/Plugin
In-Reply-To: <4C4D58FB.7090008@rabbitmq.com>
References: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>
	<4C4D58FB.7090008@rabbitmq.com>
Message-ID: <AANLkTi=iFRAK+7z6nLN1EhVXUOTsLxOX8Cmjky_rqp+N@mail.gmail.com>

Ok, I'll see what I can do for points 2/3

For #1, I guess I would need to make it so permissions can be set on
non existent users then?
$ rabbitmqctl set_permissions unknown_user '.*' '.*' '.*'
Setting permissions for user "unknown_user" in vhost "/" ...
Error: {no_such_user,<<"unknown_user">>}

Also, here is the use case I'd be looking to use this to solve.
I'm exposing RabbitMQ to the Internet, and don't want to have to share
a username/password.
I also don't want to have to maintain two sets of users, and two sets
of passwords/permissions.

Assuming I do the above so you can set permissions ahead of time for
all your users, it's not really much more work to just create the
users then as well.

Maybe my understanding of the problem domain doesn't quite match
yours, but I don't see how just doing authentication only is
worthwhile.

Scott

On Mon, Jul 26, 2010 at 3:44 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Scott,
>
> On 22/07/10 05:11, Scott Brooks wrote:
>>
>> TLDR: proof of concept patch to rabbitmq-server, plugin, and ruby
>> backend to authenticate users.
>> http://github.com/Blaze74/rabbit_proxyauth
>> http://github.com/Blaze74/proxyauth.rb
>
> some comments on the server patch:
>
> 1) I'd prefer if this dealt with authentication only, not also
> authorisation. The latter is very rabbit-specific and likely to change in
> the future.
>
> 2) Your rabbit_access_control_proxy module should have an API that performs
> the gen_server calls, i.e. the interface to it should be a set of functions
> (e.g. authenticate(User, Pass) -> boolean()), not a set of gen_server
> messages. That's a general OTP design principle.
>
> 3) The authentication backend should be configurable via an
> "authentication_module" app env var, and the default setting should point to
> a module which refuses all authentication requests (i.e. returns 'false' in
> the authenticate/2 call).
>
> The objective of 2 and 3 is to allow a plug-in to override the default
> setting for the authentication_module with a conforming alternative
> implementation. For an example of how to structure 2 and 3 (including
> behaviour definitions, spec files etc) take a look at the
> backing_queue_module setting in 'default'.
>
>
> Regards,
>
> Matthias.
>

From andrius.norkaitis at oryo.lt  Mon Jul 26 17:38:21 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 26 Jul 2010 19:38:21 +0300
Subject: [rabbitmq-discuss] messages delivery question
In-Reply-To: <4C4D410E.9060903@rabbitmq.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIuZl1mKClVLh8qgZwOWYHcBAAAAAA==@oryo.lt>	<20100724174734.GB22389@wellquite.org>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACoQrIfbPXtAqD+IL//8EMgBAAAAAA==@oryo.lt>	<20100724182855.GC22389@wellquite.org>	<AANLkTimXrG1aq4N2NHAJYSrJCYRVvDYKonpS1D3g4pSk@mail.gmail.com>	<AANLkTik7TUAinr4FCAgA5i7jYnq4daK-Ha8B+8HuEPm3@mail.gmail.com>
	<4C4D410E.9060903@rabbitmq.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAA5fHe5AKOtLqBX2LL0aCE8BAAAAAA==@oryo.lt>

Thank you for information.

Best regards
Andrius Norkaitis


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Bridgen
Sent: Monday, July 26, 2010 11:02 AM
To: Darius Damalakas
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] messages delivery question

> Is it possible to make the transactional channel not transactional?  
> I expect a NO answer, but better to be 100% sure than have a guess

The answer is indeed "No"; once you call tx.select, there's no going back.  Rightly or wrongly, that's just the way it's specified in AMQP.

--Michael


> 
> 2010/7/25 Scott Brooks <scott at beamdog.com <mailto:scott at beamdog.com>>
> 
>     You can just call ch.TxCommit again.
> 
>     Once you call ch.TxSelect(), you need to commit to complete the
>     transaction.  A Commit implicitly starts another transaction.
> 
>     On Sat, Jul 24, 2010 at 12:28 PM, Matthew Sackman
>     <matthew at rabbitmq.com <mailto:matthew at rabbitmq.com>> wrote:
>      > On Sat, Jul 24, 2010 at 09:10:26PM +0300, Andrius Norkaitis wrote:
>      >> I was reusing one channel to publish messages. Should I create
>     two channels
>      >> (one transactional, one not) and reuse them or it better always
>     create new
>      >> one?
>      >
>      > Better to have two channels and keep them open. At your msg
>     rates, it's
>      > not so important, but generally channel creation isn't /that/
>     cheap an
>      > operation, so best to keep them open after creation.
>      >
>      > Matthew
>      > _______________________________________________
>      > rabbitmq-discuss mailing list
>      > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>      > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>      >
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> --
> Link?jimai, Best Regards
> 
> Darius Damalakas
> 
> 
> ----------------------------------------------------------------------
> --
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sunkini at gmail.com  Tue Jul 27 10:22:08 2010
From: sunkini at gmail.com (Sunil Kini)
Date: Tue, 27 Jul 2010 14:52:08 +0530
Subject: [rabbitmq-discuss] Disaster Recovery / Disaster tolerance
	Features
In-Reply-To: <AANLkTinP_mw1oVfQX3UW8ITk_wPImrOamF4uB63MN04d@mail.gmail.com>
References: <AANLkTilfNTonchcLK7oyQmtqCOP9Wuoo-dlKrs5u1Yfx@mail.gmail.com>
	<AANLkTinP_mw1oVfQX3UW8ITk_wPImrOamF4uB63MN04d@mail.gmail.com>
Message-ID: <AANLkTikgBvYa3DCJCP2vkN9JKJV1oVd6x4xCEK1ZHkzv@mail.gmail.com>

Hi Marek,

Sorry for late reply.

Thanks a lot. This is exactly what I was looking for while understanding
RabbitMQ.

Regards,
Sunil


On Wed, Jul 21, 2010 at 5:36 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Tue, Jul 20, 2010 at 10:38, Sunil Kini <sunkini at gmail.com> wrote:
> > I wanted to know what kind of Disaster recovery / Disaster tolerance
> > features are available in RabbitMQ.
>
> We support active-passive HA scenario, but that requires shared storage.
> See our tutorial:
>  http://www.rabbitmq.com/pacemaker.html
>
> > How does RabbitMQ guarantee complete recovery of messages after the
> > disaster(broker down)? and also how does it perform a fail-over?
>
> RabbitMQ looses the state of messages that aren't marked as persistent.
> The persistent messages, which were successfully written to the disk
> before disaster will be available after the recovery.
>
> Persistent metadata, like bindings and exchanges will be recovered.
>
> Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100727/e32f3d2d/attachment.htm>

From jon.brisbin at npcinternational.com  Tue Jul 27 15:04:52 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Tue, 27 Jul 2010 09:04:52 -0500
Subject: [rabbitmq-discuss] RabbitKernel
Message-ID: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>

Has anyone worked with RabbitMQ inside NetKernel?

http://www.1060research.com/netkernel/

I know enough about OSGI to make myself dangerous. I've worked some with Apache's ESB, so when I came across NetKernel, I thought I'd at least explore it a little to see if it would make our cloud infrastructure easier to manage. I'd love to have some AMQP integration in NetKernel to play with, so I wondered if anyone has already worked on something or if there are plans to do so?

This is just an experiment, of course, so I'm not sure I want to spend a lot of time on something I might not end up using, but thought I'd at least give it a shot.

Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100727/349ddf24/attachment.htm>

From joehealy at gmail.com  Tue Jul 27 15:33:42 2010
From: joehealy at gmail.com (Joe Healy)
Date: Wed, 28 Jul 2010 00:33:42 +1000
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
Message-ID: <AANLkTikYYKHBNm6iMd8G_ywJE9pUySm4o1Avv_GAShYM@mail.gmail.com>

On Sun, Jul 25, 2010 at 1:33 AM, Dave Greggory <davegreggory at yahoo.com>wrote:

> 2. HA/Failover: I've seen the Pacemaker guide but I'm a little hesitant to
> set
> that up as we have little experience in house with Pacemaker/Corosync/DRBD.
> How
> many people use it for HA/Failover in production systems and how happy are
> you
> with it? Does it support failing over if the hard drive on one of the nodes
> die
> instead something a little more simple like a node running out of memory or
> hanging?
>

We are contemplating this and have done some trialling/testing. For us the
question is between providing HA at the xenserver level or at the host/app
level using pacemaker etc.

It took a little bit of fiddling to get it running with pacemaker (this was
before the HA document was available), but once we had the system working,
it worked/works well. Our solution used/uses shared ISCSI storage rather
than DRDB and so relies on the reliability of the SAN. If a drive on one of
the hosts fails (such as the root/other partition) and this causes
difficulties for the status check script, it will failover to the other
node. We assume that the drives containing the rabbitmq storage are "safe"
through redundancy (RAID1, redundant storage controllers etc)

At this stage we are leaning towards the xenserver level due to lower
complexity and still satisfying our requirements. We've also had some
hardware changes (production system will now be on a FC SAN rather than
ISCSI) and have not done the work testing on the new configuration yet.

In terms of monitoring, we generally run rabbitmq_ctl list_queues as part of
a munin plugin. We plan to hook it up to nagios, but havent done so yet.

Hope this is useful information.

Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100728/ea223da0/attachment.htm>

From mybayworkz at gmail.com  Tue Jul 27 18:31:30 2010
From: mybayworkz at gmail.com (Chandra R)
Date: Tue, 27 Jul 2010 12:31:30 -0500
Subject: [rabbitmq-discuss] installation issue
Message-ID: <AANLkTim_d8EKuk0-Azsbv8VfLeCpkaVKuP8eFDf+uoDs@mail.gmail.com>

Hi,

I am very new to RabbitMQ and messaging. I installed and run successfully
last night. I am running it on win-xp on vmware.
I tried to run today but I am unable to do so.


 Instead of getting RabbitRam.debug file I am gettinig RabbitRam.debug.1
icnspite of deleting and installing new.
I am trying to do the most basic installation and I remember even though my
rabbit.congif file was empty, still the node was running successfully.
 Any help would be appreciated.

Thanks in advance
Chandra


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v1.8.1  +---+   |
|                   |
+-------------------+
AMQP 8-0
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at mywinserver
app descriptor : c:/Program
Files/RabbitMQ/rabbitmq_server-1.8.1/sbin/../ebin/rabbit.app
home dir       : C:\WINDOWS
cookie hash    : E3Wh60bLpBaeclHgPlq11g==
log            : C:\Documents and
Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit.log
sasl log       : C:\Documents and
Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit-sasl.log
database dir   : c:/Documents and
Settings/Administrator/ApplicationData/RabbitMQ/db/rabbit-mnesia
erlang version : 5.7.4

starting file handle cache server
...done
starting worker pool
 ...done
starting database
...BOOT ERROR: FAILED
Reason: {{case_clause,{ok,[]}},
         [{rabbit_mnesia,read_cluster_nodes_config,0},
          {rabbit_mnesia,init,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2},
          {application_master,start_it_old,4}]}
in message_loop
win32sysinfo:Erlang has closed.Eshell V5.7.4  (abort with ^G)
(rabbit at mywinserver)1> {"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

Crash dump was written to: C:/Documents and
Settings/Administrator/ApplicationData/RabbitMQ/erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100727/299050fd/attachment.htm>

From tsuraan at gmail.com  Tue Jul 27 21:53:04 2010
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 27 Jul 2010 15:53:04 -0500
Subject: [rabbitmq-discuss] QueueingConsumer basicPublish safety
Message-ID: <AANLkTi=RbR962yjQsyxJ=iK17jefKCbpbT9kNguUqnQq@mail.gmail.com>

In my program, messages coming from rabbit are handled on different
threads, and once the message is handled it is ack'd.  New messages
are also sometimes generated, so I need to send them as well.  I know
that channels aren't thread-safe, so I wrote a wrapper class around
QueueingConsumer that maintains two internal BlockingQueues, one for
delivery tags to ack and one for messages to send.  I have public
methods ack and publish that take dtags or message representations and
enqueue them, and I overrode the nextDelivery(long) method to look
like this:

  public QueueingConsumer.Delivery nextDelivery(long timeout)
    throws ShutdownSignalException, InterruptedException
  {
    QueueingConsumer.Delivery delivery = super.nextDelivery(timeout);
    this.processAcks();
    this.processPublishes();
    return delivery;
  }

processAcks() iterates through the acks BlockingQueue and calls

this.getChannel().basicAck(l.longValue(), false);

while processPublishes() iterates through the publishes BlockingQueue and calls

this.getChannel().basicPublish(m.exchange, m.key, ...)

The problem I'm having is that, although all these functions are
always being called in the thread that the consumer is running in, I'm
hanging.  My stack trace looks like this:

Stack trace:
java.lang.Object.wait(Native Method)
java.lang.Object.wait(Object.java:485)
com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:300)
com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:285)
com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:403)
com.foo.rabbit.AckingQueueingConsumer.processPublishes(AckingQueueingConsumer.java:136)
com.foo.rabbit.AckingQueueingConsumer.nextDelivery(AckingQueueingConsumer.java:40)
[handler stuff]
java.lang.Thread.run(Thread.java:619)

It seems to have been stuck there for quite a while.  Am I doing
something obviously wrong, or is this something complicated?  I'm
reasonably sure that the channel is only being used in the thread
where the consumer is subscribed, so I'm hoping that I missed some
caveat about doing publishes right after a nextDelivery or something.
Any tips would be very appreciated.

From simon at rabbitmq.com  Wed Jul 28 10:23:38 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Jul 2010 10:23:38 +0100
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <1280115611.1554.46.camel@chestsh-ubunbu>
References: <1279697165.1602.256.camel@chestsh-ubunbu>	
	<4C46B1FF.9090306@rabbitmq.com>	<1279704264.1602.292.camel@chestsh-ubunbu>	
	<4C46C605.1050104@rabbitmq.com> <4C46CE02.8050302@rabbitmq.com>	
	<20100721105931.GN24186@rabbitmq.com>	
	<1279769810.1587.115.camel@chestsh-ubunbu>
	<4C485D3F.2090506@rabbitmq.com>
	<1280115611.1554.46.camel@chestsh-ubunbu>
Message-ID: <4C4FF71A.1020806@rabbitmq.com>

Hi Chester. Just wanted to let you know that we've managed to replicate 
this at our end with non-persistent messages and we're looking into a 
solution.

If you need a workaround, I'm afraid you'll need to build the server 
from source. If you increase the value of FLOW_OK_TIMEOUT defined near 
the top of rabbit_channel.erl then this should do it.

Cheers, Simon

On 26/07/10 04:40, Chester Shen wrote:
> My program is running in a three nodes cluster, a publisher client on
> one node publish non-persistent messages to non-durable, auto-delete
> queues, two consumer clients on the other two nodes process messages in
> threads that invoked by HandDelivery(). Is it possible that the
> published messages are blocked in the server under this circumstance?
>
> On Thu, 2010-07-22 at 16:01 +0100, Simon MacMullen wrote:
>>
>> Hmm. It shouldn't do.
>>
>> The best idea we can come up with at the moment is that the publish
>> messages are backing up in the channel process inside the server,
>> blocking the flow-ok message (which the client has sent) from getting
>> read. This requires the publishes to be happening comparatively slowly,
>> and for there to be a lot of them. Are you publishing persistent
>> messages to durable queues? If so, are you using transactions?
>>
>> If this theory is correct then there's not a great deal we can do except
>> ask you to try the new persister. This would both relieve the memory
>> pressure and put a lower upper bound on how long it takes to publish a
>> persistent message.
>>
>> Cheers, Simon
>>
>
>

From mark-erlang at aufflick.com  Wed Jul 28 12:08:42 2010
From: mark-erlang at aufflick.com (Mark Aufflick)
Date: Wed, 28 Jul 2010 21:08:42 +1000
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <20100726151140.GC6839@rabbitmq.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com> 
	<20100726151140.GC6839@rabbitmq.com>
Message-ID: <AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>

Exciting stuff - fantastic work everyone.

From ovidiudeac at gmail.com  Wed Jul 28 13:22:58 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Wed, 28 Jul 2010 15:22:58 +0300
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
Message-ID: <AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>

Any idea about when to expect the next official version of rabbitmq?

On Wed, Jul 28, 2010 at 2:08 PM, Mark Aufflick <mark-erlang at aufflick.com> wrote:
> Exciting stuff - fantastic work everyone.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Wed Jul 28 13:46:27 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 28 Jul 2010 13:46:27 +0100
Subject: [rabbitmq-discuss] New Persister merged into default
In-Reply-To: <AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
References: <20100722164829.GA20367@rabbitmq.com>
	<AANLkTim5SSOM3Nlp8AmxKOle0mRFKByJ-GxFnexrFfmm@mail.gmail.com>
	<20100726151140.GC6839@rabbitmq.com>
	<AANLkTi=mcdPquVhGvL2cp9Qqd9G0o0h8zPu2RQeU0DAm@mail.gmail.com>
	<AANLkTikMC-OMvrJT1V7yjHyNxgxDaN+6AqsqCvmkghu8@mail.gmail.com>
Message-ID: <20100728124626.GH554@rabbitmq.com>

On Wed, Jul 28, 2010 at 03:22:58PM +0300, Ovidiu Deac wrote:
> Any idea about when to expect the next official version of rabbitmq?

I can't give out any official date but in the "next few weeks".

Matthew

From davegreggory at yahoo.com  Wed Jul 28 14:02:27 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 28 Jul 2010 09:02:27 -0400
Subject: [rabbitmq-discuss] connection closed abruptly errors on logs
In-Reply-To: <yrv4cmxtelcw3.fsf@dwragg.eng.vmware.com>
References: <237032.46347.qm@web111010.mail.gq1.yahoo.com>
	<yrv4cr5iqlczo.fsf@dwragg.eng.vmware.com>
	<yrv4cmxtelcw3.fsf@dwragg.eng.vmware.com>
Message-ID: <3A4FD6E5-5454-4712-92C7-55A9B8E20C92@yahoo.com>

That's exactly what it was. Thanks for helping me clear that up. 

From davegreggory at yahoo.com  Wed Jul 28 14:21:57 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 28 Jul 2010 09:21:57 -0400
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <AANLkTikMaXvLzLwffGwx_NHPa6Te3m3J8PeRgD3crnq1@mail.gmail.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<AANLkTikMaXvLzLwffGwx_NHPa6Te3m3J8PeRgD3crnq1@mail.gmail.com>
Message-ID: <F6971D89-0DB0-4FE5-B693-415F6D1A81AF@yahoo.com>

Hi Miguel,

> For management, there's Alice:
> http://willcodeforfoo.com/2009/07/13/announcing-alice/

Wow, Alice looks pretty powerful. That's great, just what we were looking for. I don't think we want remote administration, just remote monitoring. So will need to figure out whether I want to use Alice or just the json output of Status plugin for monitoring. 


> However, I personally use a backup message storing system (PostgreSQL)
> and redeliver undelivered messages (my queues are not durable.)  This
> however makes for extra code.

Yep, we also plan to use a local data store at the producer end... Maybe Hsqldb or something like that. 

From davegreggory at yahoo.com  Wed Jul 28 14:38:56 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 28 Jul 2010 09:38:56 -0400
Subject: [rabbitmq-discuss] General questions about HA,
	Stability/Reliability and Broker Administration
In-Reply-To: <4C4D642B.70806@rabbitmq.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<4C4D642B.70806@rabbitmq.com>
Message-ID: <B9C642D6-30F9-40C6-9091-865EE42B7A2F@yahoo.com>

> Depends what you mean by broker administration. RabbitMQ provides everything you need in theory out of the box: use rabbitmqctl for user / vhost / permission administration and get your applications to declare all the AMQPish resources they need.

You're right, rabbitmqctl pretty much provides almost everything you need. Only thing I wish it had that BQL has is the ability to:
1. purge or empty queues 
2. Declare exchanges / queues / bindings
3. Export / import routing tables (for restoring a cluster that suffered irrecoverable failure)

One thing I like about RabbitMQ as opposed to most other brokers is that all these functionality is provided as plugins instead of being tightly integrated into the broker itself. That's why I'd prefer to not have to run BQL or Status or any other plugins and keep the broker clean and as simple as possible. 

Since we're not using the new persister yet (we'll switch when it's officially released), I'd like to monitor the overall memory usage. Is it possible to that using rabbitmqctl? List_queues only show memory per queue. Where does the Status plugin get it's total memory usage details from?

Thanks Simon. 

- Dave


From simon at rabbitmq.com  Wed Jul 28 15:07:17 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 28 Jul 2010 15:07:17 +0100
Subject: [rabbitmq-discuss] General questions about HA,
 Stability/Reliability and Broker Administration
In-Reply-To: <B9C642D6-30F9-40C6-9091-865EE42B7A2F@yahoo.com>
References: <3256.34232.qm@web111005.mail.gq1.yahoo.com>
	<4C4D642B.70806@rabbitmq.com>
	<B9C642D6-30F9-40C6-9091-865EE42B7A2F@yahoo.com>
Message-ID: <4C503995.8000700@rabbitmq.com>

On 28/07/10 14:38, Dave Greggory wrote:
> One thing I like about RabbitMQ as opposed to most other brokers is
> that all these functionality is provided as plugins instead of being
> tightly integrated into the broker itself. That's why I'd prefer to
> not have to run BQL or Status or any other plugins and keep the
> broker clean and as simple as possible.

Nice to hear someone with something good to say about plugins :)

> Since we're not using the new persister yet (we'll switch when it's
> officially released), I'd like to monitor the overall memory usage.
> Is it possible to that using rabbitmqctl? List_queues only show
> memory per queue. Where does the Status plugin get it's total memory
> usage details from?

I'm afraid not with rabbitmqctl, the status plugin directly invokes 
erlang:memory(total). You could do this from a shell script with e.g.

echo 'erlang:memory(total).' | erl_call -sname rabbit@`hostname` -e

assuming your node name is as usual, and you're running as the same user 
as the server.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From johndapps at gmail.com  Wed Jul 28 19:12:33 2010
From: johndapps at gmail.com (John Apps)
Date: Wed, 28 Jul 2010 20:12:33 +0200
Subject: [rabbitmq-discuss] Very simply example showing request/reply
	communication (C/C++, COBOL, C#)
In-Reply-To: <AANLkTi=Z=msANYzw5opuqbyg4jAb6Aygm3-GhsbUB31M@mail.gmail.com>
References: <AANLkTi=Z=msANYzw5opuqbyg4jAb6Aygm3-GhsbUB31M@mail.gmail.com>
Message-ID: <AANLkTinX4A9=1XEvYHxP2QNqSo-KQ87K=R2dPgfw3CWj@mail.gmail.com>

Of course I shall dig through the sample directories and look on the Web,
but I am hoping -being the lazy chap I am- that someone can point me to a
very simple example showing request/response communication with
RabbitMQ. I realize there are lots of options to this, e.g., transactions,
durable, so will take whatever is there. All the more the merrier!

Platforms can be Windows, UNIX, Linux, OpenVMS; languages preferably C#,
C/C++, COBOL. (The latter may be a challenge which I have to solve myself.)

Comparisons with TIBCO RV in the example will be welcomed...

Cheers, John
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100728/2956ed25/attachment-0001.htm>

From csshenqian at gmail.com  Thu Jul 29 04:33:17 2010
From: csshenqian at gmail.com (Chester Shen)
Date: Thu, 29 Jul 2010 11:33:17 +0800
Subject: [rabbitmq-discuss] channel.flow_ok{active=false} and java
 client 1.8.1
In-Reply-To: <4C4FF71A.1020806@rabbitmq.com>
References: <1279697165.1602.256.camel@chestsh-ubunbu>
	<4C46B1FF.9090306@rabbitmq.com>	<1279704264.1602.292.camel@chestsh-ubunbu>
	<4C46C605.1050104@rabbitmq.com> <4C46CE02.8050302@rabbitmq.com>
	<20100721105931.GN24186@rabbitmq.com>
	<1279769810.1587.115.camel@chestsh-ubunbu>
	<4C485D3F.2090506@rabbitmq.com>
	<1280115611.1554.46.camel@chestsh-ubunbu>
	<4C4FF71A.1020806@rabbitmq.com>
Message-ID: <1280374397.2015.115.camel@chestsh-ubunbu>

Hi Simon

Thanks for the reminder, if you solve the issue please inform me,
thanks!

On Wed, 2010-07-28 at 10:23 +0100, Simon MacMullen wrote:
> Hi Chester. Just wanted to let you know that we've managed to replicate 
> this at our end with non-persistent messages and we're looking into a 
> solution.
> 
> If you need a workaround, I'm afraid you'll need to build the server 
> from source. If you increase the value of FLOW_OK_TIMEOUT defined near 
> the top of rabbit_channel.erl then this should do it.
> 
> Cheers, Simon
> 



From flocha2000-agile at yahoo.fr  Thu Jul 29 09:18:03 2010
From: flocha2000-agile at yahoo.fr (Florence Chabanois)
Date: Thu, 29 Jul 2010 08:18:03 +0000 (GMT)
Subject: [rabbitmq-discuss] Consumers stopped consuming messages
In-Reply-To: <4C45BBCF.7030008@rabbitmq.com>
Message-ID: <471589.13069.qm@web26002.mail.ukl.yahoo.com>

Hi Simon,

You were right about the prefetch count : the consumers always keep consuming now that it is set to 100 instead of infinite. 

Thank you very much for your help !
Florence.



--- En date de?: Mar 20.7.10, Simon MacMullen <simon at rabbitmq.com> a ?crit?:

De: Simon MacMullen <simon at rabbitmq.com>
Objet: Re: [rabbitmq-discuss] Consumers stopped consuming messages
?: rabbitmq-discuss at lists.rabbitmq.com
Date: Mardi 20 juillet 2010, 17h07

Hi Florence. As far as I can see this is reasonable. It's always worth 
setting the prefetch count when using basic.consume (add a line like:

channel.basicQos(100);

before the
 channel.basicConsume line
 in order to ensure you never have 
more than 100 messages queued up in your QueueingConsumer). However, I 
don't think that's your problem.

I assume you have checked that the consumers are idle and waiting for 
message deliveries (with Ctrl+Break / SIGQUIT). Does anything appear in 
the server logs when consumers stop consuming?

Cheers, Simon



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100729/f1199bac/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 29 09:23:25 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 29 Jul 2010 09:23:25 +0100
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ
 Proxy Authentication patch/Plugin
In-Reply-To: <AANLkTi=iFRAK+7z6nLN1EhVXUOTsLxOX8Cmjky_rqp+N@mail.gmail.com>
References: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>	<4C4D58FB.7090008@rabbitmq.com>
	<AANLkTi=iFRAK+7z6nLN1EhVXUOTsLxOX8Cmjky_rqp+N@mail.gmail.com>
Message-ID: <4C513A7D.6070509@rabbitmq.com>

Scott,

On 26/07/10 16:40, Scott Brooks wrote:
> Ok, I'll see what I can do for points 2/3
>
> For #1, I guess I would need to make it so permissions can be set on
> non existent users then?

yes, you would have to do that, but ...

> Also, here is the use case I'd be looking to use this to solve.
> I'm exposing RabbitMQ to the Internet, and don't want to have to share
> a username/password.
> I also don't want to have to maintain two sets of users, and two sets
> of passwords/permissions.
>
> Assuming I do the above so you can set permissions ahead of time for
> all your users, it's not really much more work to just create the
> users then as well.

Fair point. An alternative would be to map all users authenticated via 
the plug-in to a single, ordinary rabbit user for the purposes of 
authorisation. That feels like a kludge though, and the same effect 
could be achieved by making authorisation pluggable and then simply have 
the plug-in perform the mapping and checks.

So I guess the plug-in's API should cover both authentication and 
authorisation after all.


Regards,

Matthias.

From abhishek.kona at gmail.com  Thu Jul 29 11:59:14 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Thu, 29 Jul 2010 16:29:14 +0530
Subject: [rabbitmq-discuss] Query - Batch Consume
Message-ID: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>

I am just checking out RabbitMQ for use at a small company.
I need to know if there is Batch Consume Option and even batch publish .

(Basically instead of sending messages one by one, the messages can be sent
to the Consumer in one network transfer)
Is there any plugin available for it.
It would be great if you point me to some links.

Also can you give me some links /guides for Clustering ?

Thanks

Abhishek Kona
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100729/76f47d4f/attachment.htm>

From lists at zopyx.com  Thu Jul 29 12:11:57 2010
From: lists at zopyx.com (Andreas Jung)
Date: Thu, 29 Jul 2010 13:11:57 +0200
Subject: [rabbitmq-discuss] Query - Batch Consume
In-Reply-To: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
References: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
Message-ID: <4C5161FD.2010201@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Abhishek K wrote:
> I am just checking out RabbitMQ for use at a small company.
> I need to know if there is Batch Consume Option and even batch publish .
> 
> (Basically instead of sending messages one by one, the messages can be
> sent to the Consumer in one network transfer)
> Is there any plugin available for it.
> It would be great if you point me to some links.
> 
> 

Does one really need that? RabbitMQ is very, very fast and batching is
usually not needed...how many data do you need to store in "batch"?

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxRYf0ACgkQCJIWIbr9KYzMoACfaKRpLmpGn7n+jkceCQYJGod2
sBgAn0VQf7jFkIs64/iwsBh8MnLAOhu3
=0ltN
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100729/1c78b475/attachment.vcf>

From david at rabbitmq.com  Thu Jul 29 12:39:44 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 29 Jul 2010 12:39:44 +0100
Subject: [rabbitmq-discuss] Query - Batch Consume
In-Reply-To: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
	(Abhishek K.'s message of "Thu, 29 Jul 2010 16:29:14 +0530")
References: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
Message-ID: <yrv4caapajz3z.fsf@dwragg.eng.vmware.com>

Hi Abhishek,

Abhishek K <abhishek.kona at gmail.com> writes:
> I am just checking out RabbitMQ for use at a small company.
> I need to know if there is Batch Consume Option and even batch publish .
>
> (Basically instead of sending messages one by one, the messages can be sent
> to the Consumer in one network transfer)
> Is there any plugin available for it.
> It would be great if you point me to some links.

Batch operations are normally useful in a protocol with synchrnous
operations, so that rather than having to wait for a response on each
operation, a client can perform many operations and only wait for one
response.

But the publish and consume operations in AMQP are not synchronous, so
it's not clear what efficiency improvements could be allowed by batch
operations.

> Also can you give me some links /guides for Clustering ?

See the clustering guide at <http://www.rabbitmq.com/clustering.html>.
If you are interested in clustering, you probably also want to look at
the active/passive failover guide at
<http://www.rabbitmq.com/pacemaker.html>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Thu Jul 29 13:25:11 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 29 Jul 2010 13:25:11 +0100
Subject: [rabbitmq-discuss] Query - Batch Consume
In-Reply-To: <AANLkTim3AhM=huRN10M0V7JzR3T8YWW53sC-VyAG=DBQ@mail.gmail.com>
	(Abhishek K.'s message of "Thu, 29 Jul 2010 17:12:22 +0530")
References: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
	<yrv4caapajz3z.fsf@dwragg.eng.vmware.com>
	<AANLkTim3AhM=huRN10M0V7JzR3T8YWW53sC-VyAG=DBQ@mail.gmail.com>
Message-ID: <yrv4c62zyjx08.fsf@dwragg.eng.vmware.com>

Abhishek K <abhishek.kona at gmail.com> writes:
> But will not batching reduce network transfers?
> I mean if there are 10 items in a queue. Can a consumer consume them in one
> network transfer?
> Can something like that be done.

AMQP already permits an AMQP server to deliver many messages to a
consumer in a single network transfer (unless the consumer does
something like setting qos which would prevent this).

The RabbitMQ broker does not currently strive to make this happen - it
looks like it will do one write to the socket for each AMQP frame.  But
the operating system TCP stack might coalesce several socket writes into
a single IP packet.  I haven't looked at packet traces to check whether
this actually happens.

So RabbitMQ is either already doing what you suggest, or could be
optimised to do so, without introducing batch operations.  This is a key
advantage of an asynchronous protocol.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vlad at rabbitmq.com  Thu Jul 29 13:27:20 2010
From: vlad at rabbitmq.com (Vlad Ionescu)
Date: Thu, 29 Jul 2010 13:27:20 +0100
Subject: [rabbitmq-discuss] installation issue
In-Reply-To: <AANLkTim_d8EKuk0-Azsbv8VfLeCpkaVKuP8eFDf+uoDs@mail.gmail.com>
References: <AANLkTim_d8EKuk0-Azsbv8VfLeCpkaVKuP8eFDf+uoDs@mail.gmail.com>
Message-ID: <4C5173A8.5090603@rabbitmq.com>

Hi Chandra,

I believe your config file cannot be empty. See 
http://www.rabbitmq.com/install.html#configfile for an example.

Vlad.


On 07/27/2010 06:31 PM, Chandra R wrote:
> Hi,
>
> I am very new to RabbitMQ and messaging. I installed and run 
> successfully last night. I am running it on win-xp on vmware.
> I tried to run today but I am unable to do so.
>
>
>  Instead of getting RabbitRam.debug file I am gettinig 
> RabbitRam.debug.1 icnspite of deleting and installing new.
> I am trying to do the most basic installation and I remember even 
> though my rabbit.congif file was empty, still the node was running 
> successfully.
>  Any help would be appreciated.
>
> Thanks in advance
> Chandra
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v1.8.1  +---+   |
> |                   |
> +-------------------+
> AMQP 8-0
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies 
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at mywinserver
> app descriptor : c:/Program 
> Files/RabbitMQ/rabbitmq_server-1.8.1/sbin/../ebin/rabbit.app
> home dir       : C:\WINDOWS
> cookie hash    : E3Wh60bLpBaeclHgPlq11g==
> log            : C:\Documents and 
> Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit.log
> sasl log       : C:\Documents and 
> Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit-sasl.log
> database dir   : c:/Documents and 
> Settings/Administrator/ApplicationData/RabbitMQ/db/rabbit-mnesia
> erlang version : 5.7.4
>
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     
> ...BOOT ERROR: FAILED
> Reason: {{case_clause,{ok,[]}},
>          [{rabbit_mnesia,read_cluster_nodes_config,0},
>           {rabbit_mnesia,init,0},
>           {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>           {rabbit,run_boot_step,1},
>           {rabbit,'-start/2-lc$^0/1-0-',1},
>           {rabbit,start,2},
>           {application_master,start_it_old,4}]}
> in message_loop
> win32sysinfo:Erlang has closed.Eshell V5.7.4  (abort with ^G)
> (rabbit at mywinserver)1> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
> Crash dump was written to: C:/Documents and 
> Settings/Administrator/ApplicationData/RabbitMQ/erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100729/d7018cd9/attachment.htm>

From matthew at rabbitmq.com  Thu Jul 29 13:33:36 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 29 Jul 2010 13:33:36 +0100
Subject: [rabbitmq-discuss] Query - Batch Consume
In-Reply-To: <yrv4c62zyjx08.fsf@dwragg.eng.vmware.com>
References: <AANLkTi=1P3eXyUoqe0c6e9f_RKdWVLz_u6SvGj+1Py+z@mail.gmail.com>
	<yrv4caapajz3z.fsf@dwragg.eng.vmware.com>
	<AANLkTim3AhM=huRN10M0V7JzR3T8YWW53sC-VyAG=DBQ@mail.gmail.com>
	<yrv4c62zyjx08.fsf@dwragg.eng.vmware.com>
Message-ID: <20100729123335.GE15851@rabbitmq.com>

On Thu, Jul 29, 2010 at 01:25:11PM +0100, David Wragg wrote:
> The RabbitMQ broker does not currently strive to make this happen - it
> looks like it will do one write to the socket for each AMQP frame.  But
> the operating system TCP stack might coalesce several socket writes into
> a single IP packet.  I haven't looked at packet traces to check whether
> this actually happens.

We turn Nagel off by default to reduce latency. You can always turn it
back on to allow the kernel to minimise packets.

Matthew

From vlad at rabbitmq.com  Thu Jul 29 13:37:29 2010
From: vlad at rabbitmq.com (Vlad Ionescu)
Date: Thu, 29 Jul 2010 13:37:29 +0100
Subject: [rabbitmq-discuss] installation issue
In-Reply-To: <4C5173A8.5090603@rabbitmq.com>
References: <AANLkTim_d8EKuk0-Azsbv8VfLeCpkaVKuP8eFDf+uoDs@mail.gmail.com>
	<4C5173A8.5090603@rabbitmq.com>
Message-ID: <4C517609.6040509@rabbitmq.com>


Chandra,

Actually the problem might be an empty clustering config file. It is 
specified by the variable RABBITMQ_CLUSTER_CONFIG_FILE .

Vlad.



On 07/29/2010 01:27 PM, Vlad Ionescu wrote:
> Hi Chandra,
>
> I believe your config file cannot be empty. See 
> http://www.rabbitmq.com/install.html#configfile for an example.
>
> Vlad.
>
>
> On 07/27/2010 06:31 PM, Chandra R wrote:
>> Hi,
>>
>> I am very new to RabbitMQ and messaging. I installed and run 
>> successfully last night. I am running it on win-xp on vmware.
>> I tried to run today but I am unable to do so.
>>
>>
>>  Instead of getting RabbitRam.debug file I am gettinig 
>> RabbitRam.debug.1 icnspite of deleting and installing new.
>> I am trying to do the most basic installation and I remember even 
>> though my rabbit.congif file was empty, still the node was running 
>> successfully.
>>  Any help would be appreciated.
>>
>> Thanks in advance
>> Chandra
>>
>>
>> +---+   +---+
>> |   |   |   |
>> |   |   |   |
>> |   |   |   |
>> |   +---+   +-------+
>> |                   |
>> | RabbitMQ  +---+   |
>> |           |   |   |
>> |   v1.8.1  +---+   |
>> |                   |
>> +-------------------+
>> AMQP 8-0
>> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies 
>> LLC., and Rabbit Technologies Ltd.
>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>
>> node           : rabbit at mywinserver
>> app descriptor : c:/Program 
>> Files/RabbitMQ/rabbitmq_server-1.8.1/sbin/../ebin/rabbit.app
>> home dir       : C:\WINDOWS
>> cookie hash    : E3Wh60bLpBaeclHgPlq11g==
>> log            : C:\Documents and 
>> Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit.log
>> sasl log       : C:\Documents and 
>> Settings\Administrator\ApplicationData\RabbitMQ\log/rabbit-sasl.log
>> database dir   : c:/Documents and 
>> Settings/Administrator/ApplicationData/RabbitMQ/db/rabbit-mnesia
>> erlang version : 5.7.4
>>
>> starting file handle cache server                                     
>> ...done
>> starting worker pool                                                 
>>  ...done
>> starting database                                                     
>> ...BOOT ERROR: FAILED
>> Reason: {{case_clause,{ok,[]}},
>>          [{rabbit_mnesia,read_cluster_nodes_config,0},
>>           {rabbit_mnesia,init,0},
>>           {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>>           {rabbit,run_boot_step,1},
>>           {rabbit,'-start/2-lc$^0/1-0-',1},
>>           {rabbit,start,2},
>>           {application_master,start_it_old,4}]}
>> in message_loop
>> win32sysinfo:Erlang has closed.Eshell V5.7.4  (abort with ^G)
>> (rabbit at mywinserver)1> {"Kernel pid 
>> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>>
>> Crash dump was written to: C:/Documents and 
>> Settings/Administrator/ApplicationData/RabbitMQ/erl_crash.dump
>> Kernel pid terminated (application_controller) 
>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>    
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100729/74ec6096/attachment-0001.htm>

From aaron at agoragames.com  Thu Jul 29 13:37:03 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 29 Jul 2010 08:37:03 -0400
Subject: [rabbitmq-discuss] configuring beam and rabbit
In-Reply-To: <AANLkTin_-2UMJ7SgTm-f7GpNxDT563lAHcoK9crML9g_@mail.gmail.com>
References: <AANLkTilIrepCZNjgpO_QJxNft3DXMtWtgvYMzafXhQda@mail.gmail.com>
	<AANLkTik30DS2bi64nVhw0xhjsYEUbfqLrdDxAKOop2ka@mail.gmail.com>
	<AANLkTimCIsIVbG9kBujqRBS6A-VdjW7VKErF3X7HwkSZ@mail.gmail.com>
	<4C3F4CD8.5060509@rabbitmq.com>
	<AANLkTin_-2UMJ7SgTm-f7GpNxDT563lAHcoK9crML9g_@mail.gmail.com>
Message-ID: <AANLkTinEs4_f-y5OXjAOruxa8q0XWRbNc3frKvi2hJOH@mail.gmail.com>

I wrote up a quick blog post covering the environment variables and
how we make use of them in our deployment.

http://blog.agoragames.com/2010/07/28/grabbing-the-rabbit-by-the-horns/

-Aaron


On Thu, Jul 15, 2010 at 2:30 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
>> We've never been happy with the confusingly similar naming but have so far
>> failed to come up with a sensible alternative. "rabbitmq.env" is nice but we
>> already have a "rabbitmq-env" script in our distribution, so there could be
>> a new kind of confusion. We rejected "rabbitmq-env.sh" for the same reason.
>> Any other suggestions?
>
> I doubt many people venture into the scripts and as this is (by
> default) in /etc/rabbitmq, the confusion should be minimized. ?You
> could also go with rabbitmqrc, rabbitmq.rc, or similar.
>
> cheers
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From emile at rabbitmq.com  Thu Jul 29 15:09:28 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 29 Jul 2010 15:09:28 +0100
Subject: [rabbitmq-discuss] QueueingConsumer basicPublish safety
In-Reply-To: <AANLkTi=RbR962yjQsyxJ=iK17jefKCbpbT9kNguUqnQq@mail.gmail.com>
References: <AANLkTi=RbR962yjQsyxJ=iK17jefKCbpbT9kNguUqnQq@mail.gmail.com>
Message-ID: <4C518B98.2060808@rabbitmq.com>


Hi Tsuraan,

Channel.flow has been asserted and therefore the basic.publish call has
blocked. We are aware that our API documentation is incorrect in
claiming that basic.publish is safe to use in the given context. This
will be updated.

You need to enable consumption of messages while publishers are
potentially blocked. This will allow memory pressure on the broker to be
relieved and publishers to resume eventually. In your example
consumption and publication happens in the same thread and therefore
your application gets completely stuck as soon as publication blocks.

You could also consider using separate channels for publishing and
consuming messages.

Regards

Emile








On 27/07/10 21:53, tsuraan wrote:
> In my program, messages coming from rabbit are handled on different
> threads, and once the message is handled it is ack'd.  New messages
> are also sometimes generated, so I need to send them as well.  I know
> that channels aren't thread-safe, so I wrote a wrapper class around
> QueueingConsumer that maintains two internal BlockingQueues, one for
> delivery tags to ack and one for messages to send.  I have public
> methods ack and publish that take dtags or message representations and
> enqueue them, and I overrode the nextDelivery(long) method to look
> like this:
> 
>   public QueueingConsumer.Delivery nextDelivery(long timeout)
>     throws ShutdownSignalException, InterruptedException
>   {
>     QueueingConsumer.Delivery delivery = super.nextDelivery(timeout);
>     this.processAcks();
>     this.processPublishes();
>     return delivery;
>   }
> 
> processAcks() iterates through the acks BlockingQueue and calls
> 
> this.getChannel().basicAck(l.longValue(), false);
> 
> while processPublishes() iterates through the publishes BlockingQueue and calls
> 
> this.getChannel().basicPublish(m.exchange, m.key, ...)
> 
> The problem I'm having is that, although all these functions are
> always being called in the thread that the consumer is running in, I'm
> hanging.  My stack trace looks like this:
> 
> Stack trace:
> java.lang.Object.wait(Native Method)
> java.lang.Object.wait(Object.java:485)
> com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:300)
> com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:285)
> com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:403)
> com.foo.rabbit.AckingQueueingConsumer.processPublishes(AckingQueueingConsumer.java:136)
> com.foo.rabbit.AckingQueueingConsumer.nextDelivery(AckingQueueingConsumer.java:40)
> [handler stuff]
> java.lang.Thread.run(Thread.java:619)
> 
> It seems to have been stuck there for quite a while.  Am I doing
> something obviously wrong, or is this something complicated?  I'm
> reasonably sure that the channel is only being used in the thread
> where the consumer is subscribed, so I'm hoping that I missed some
> caveat about doing publishes right after a nextDelivery or something.
> Any tips would be very appreciated.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tsuraan at gmail.com  Thu Jul 29 17:11:28 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 29 Jul 2010 11:11:28 -0500
Subject: [rabbitmq-discuss] QueueingConsumer basicPublish safety
In-Reply-To: <4C518B98.2060808@rabbitmq.com>
References: <AANLkTi=RbR962yjQsyxJ=iK17jefKCbpbT9kNguUqnQq@mail.gmail.com>
	<4C518B98.2060808@rabbitmq.com>
Message-ID: <AANLkTik0z=kehYVPxHGfOB5DDRVPMgcyByYC4c8pn1Or@mail.gmail.com>

> Channel.flow has been asserted and therefore the basic.publish call has
> blocked. We are aware that our API documentation is incorrect in
> claiming that basic.publish is safe to use in the given context. This
> will be updated.

So this probably only happens when rabbit thinks it's overloaded?

> You need to enable consumption of messages while publishers are
> potentially blocked. This will allow memory pressure on the broker to be
> relieved and publishers to resume eventually. In your example
> consumption and publication happens in the same thread and therefore
> your application gets completely stuck as soon as publication blocks.

So is it safe to publish messages on a channel when some other thread
is consuming on that channel?  If I acquire a lock on the channel in a
different thread, and the channel blocks in basicPublish, will that
still allow new messages to be delivered to the consumer?

> You could also consider using separate channels for publishing and
> consuming messages.

I'm currently doing acks and publishes in a transaction, but I'm not
sure if that's entirely necessary.  It's certainly convenient and
safe, but I don't know that I really need to do it.  Are acks
guaranteed not to block the way that publishes do?  I obviously can't
send my acks on a different channel :)

From santikschzt at gmail.com  Thu Jul 29 18:38:33 2010
From: santikschzt at gmail.com (Santi Manninen)
Date: Thu, 29 Jul 2010 19:38:33 +0200
Subject: [rabbitmq-discuss] versioned routing
Message-ID: <AANLkTimMB1cz9vaOy06x-Y-73S+1YLLZh_Dwe21eYQ3o@mail.gmail.com>

Hi,

I've been trying to figure out a way to single out service versions
for front end users.
Here is the current, simplified scenario:

- Web users with sessions issue requests to a front end server, which
just routes their messages
- Messages are routed to queues called 'LoginService' and 'PingService'

I have a number of LoginService and PingService instances, each bound
to the same queue, so messages are distributed with round-robin and I
can add/remove them based on demand. Wonderful.

PingService currently runs 1.0. Now, I'd like to add a completely new
version of PingService, 1.0.1, with spiffy new features, and have
'selected users' (through Sessions given from LoginService) use the
new version and try it out, so I can monitor and test that the new
version of PingService works correctly before moving more, or all
users into the new version, and deploying 1.0.1 onto more servers.

We talked about doing this with |Blaze|| on the IRC channel (thanks!)
but we didn't really come up with an elegant solution yet.

- Bind the PingService queues with the version name in the queue name,
and have the front end route messages to PingService, based on the
version defined in the Session. Many problems with this. Old users
with active sessions bound to the previous version (which was just
built 15 minutes ago, perhaps!) will lose service once the new version
is completely rolled out, and a failover from basicReturn in the
client would have to be implemented.
- Use topic exchanges for each version, eg. 1.0.1.topic, and a
catch-all with *.topic. I think round-robin is lost here?

That's the gist of it. Your help is appreciated. Thanks!

Santi

From aaron at agoragames.com  Thu Jul 29 20:23:42 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 29 Jul 2010 15:23:42 -0400
Subject: [rabbitmq-discuss] versioned routing
In-Reply-To: <AANLkTimMB1cz9vaOy06x-Y-73S+1YLLZh_Dwe21eYQ3o@mail.gmail.com>
References: <AANLkTimMB1cz9vaOy06x-Y-73S+1YLLZh_Dwe21eYQ3o@mail.gmail.com>
Message-ID: <AANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0+XMQ_7Akw@mail.gmail.com>

Santi,

We have a similar requirement, and it seems you have most of the
pieces in place to implement a similar solution.

Topic exchanges will round robbin between consumers so no need to
worry there.  Seeing as you have the version already stored in your
session, you can continue to maintain both old and new sessions so
long as consumers and bindings remain in place for both.

So you have a hypervisor that can maintain consumers for all your
deployed versions.  In your case, LoginService might consume from the
queue "ls.1_0_0" which is bound to your publishing exchange with a
routing key of the same name.  Your new version would run alongside
using queue name and binding "ls.1_0_1".  If a user does not have a
session yet, then something in front of AMQP will have to determine
based on URL, host, whitelist, etc which routing key to use.

I would caution against using dotted version notation in your routing
key, mostly to keep sane as your routing scheme expands in complexity
and you have numerous bindings.

Hope that helps.

-Aaron


On Thu, Jul 29, 2010 at 1:38 PM, Santi Manninen <santikschzt at gmail.com> wrote:
> Hi,
>
> I've been trying to figure out a way to single out service versions
> for front end users.
> Here is the current, simplified scenario:
>
> - Web users with sessions issue requests to a front end server, which
> just routes their messages
> - Messages are routed to queues called 'LoginService' and 'PingService'
>
> I have a number of LoginService and PingService instances, each bound
> to the same queue, so messages are distributed with round-robin and I
> can add/remove them based on demand. Wonderful.
>
> PingService currently runs 1.0. Now, I'd like to add a completely new
> version of PingService, 1.0.1, with spiffy new features, and have
> 'selected users' (through Sessions given from LoginService) use the
> new version and try it out, so I can monitor and test that the new
> version of PingService works correctly before moving more, or all
> users into the new version, and deploying 1.0.1 onto more servers.
>
> We talked about doing this with |Blaze|| on the IRC channel (thanks!)
> but we didn't really come up with an elegant solution yet.
>
> - Bind the PingService queues with the version name in the queue name,
> and have the front end route messages to PingService, based on the
> version defined in the Session. Many problems with this. Old users
> with active sessions bound to the previous version (which was just
> built 15 minutes ago, perhaps!) will lose service once the new version
> is completely rolled out, and a failover from basicReturn in the
> client would have to be implemented.
> - Use topic exchanges for each version, eg. 1.0.1.topic, and a
> catch-all with *.topic. I think round-robin is lost here?
>
> That's the gist of it. Your help is appreciated. Thanks!
>
> Santi
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From david at rabbitmq.com  Thu Jul 29 22:34:23 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 29 Jul 2010 22:34:23 +0100
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com> (Jon
	Brisbin's message of "Tue, 27 Jul 2010 09:04:52 -0500")
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
Message-ID: <yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>

Hi Jon,

Jon Brisbin <jon.brisbin at npcinternational.com> writes:
> Has anyone worked with RabbitMQ inside NetKernel?
>
> http://www.1060research.com/netkernel/
>
> I know enough about OSGI to make myself dangerous. I've worked some
> with Apache's ESB, so when I came across NetKernel, I thought I'd at
> least explore it a little to see if it would make our cloud
> infrastructure easier to manage. I'd love to have some AMQP
> integration in NetKernel to play with, so I wondered if anyone has
> already worked on something or if there are plans to do so?

I don't think we've heard of RabbitMQ and NetKernel being used together.

I wonder how you would combine the resource oriented computing paradigm
of NetKernel with a messaging approach?  Or were you thinking of using
AMQP as a transport for Netkernel?

Dvid

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From alexis at rabbitmq.com  Fri Jul 30 00:08:27 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Jul 2010 00:08:27 +0100
Subject: [rabbitmq-discuss] versioned routing
In-Reply-To: <AANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0+XMQ_7Akw@mail.gmail.com>
References: <AANLkTimMB1cz9vaOy06x-Y-73S+1YLLZh_Dwe21eYQ3o@mail.gmail.com>
	<AANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0+XMQ_7Akw@mail.gmail.com>
Message-ID: <AANLkTikZ7UWJA14yEoXWud=tSA_nrDq7TLDiPighcCcv@mail.gmail.com>

Aaron

On Thu, Jul 29, 2010 at 8:23 PM, Aaron Westendorf <aaron at agoragames.com> wrote:
> Santi,
>
> We have a similar requirement, and it seems you have most of the
> pieces in place to implement a similar solution.
>
> Topic exchanges will round robbin between consumers

Don't you mean *queues* will round robin?

Exchanges provide pubsub, ie. delivery to all subscribers that satisfy
the routing rule.

alexis



> so no need to
> worry there. ?Seeing as you have the version already stored in your
> session, you can continue to maintain both old and new sessions so
> long as consumers and bindings remain in place for both.
>
> So you have a hypervisor that can maintain consumers for all your
> deployed versions. ?In your case, LoginService might consume from the
> queue "ls.1_0_0" which is bound to your publishing exchange with a
> routing key of the same name. ?Your new version would run alongside
> using queue name and binding "ls.1_0_1". ?If a user does not have a
> session yet, then something in front of AMQP will have to determine
> based on URL, host, whitelist, etc which routing key to use.
>
> I would caution against using dotted version notation in your routing
> key, mostly to keep sane as your routing scheme expands in complexity
> and you have numerous bindings.
>
> Hope that helps.
>
> -Aaron
>
>
> On Thu, Jul 29, 2010 at 1:38 PM, Santi Manninen <santikschzt at gmail.com> wrote:
>> Hi,
>>
>> I've been trying to figure out a way to single out service versions
>> for front end users.
>> Here is the current, simplified scenario:
>>
>> - Web users with sessions issue requests to a front end server, which
>> just routes their messages
>> - Messages are routed to queues called 'LoginService' and 'PingService'
>>
>> I have a number of LoginService and PingService instances, each bound
>> to the same queue, so messages are distributed with round-robin and I
>> can add/remove them based on demand. Wonderful.
>>
>> PingService currently runs 1.0. Now, I'd like to add a completely new
>> version of PingService, 1.0.1, with spiffy new features, and have
>> 'selected users' (through Sessions given from LoginService) use the
>> new version and try it out, so I can monitor and test that the new
>> version of PingService works correctly before moving more, or all
>> users into the new version, and deploying 1.0.1 onto more servers.
>>
>> We talked about doing this with |Blaze|| on the IRC channel (thanks!)
>> but we didn't really come up with an elegant solution yet.
>>
>> - Bind the PingService queues with the version name in the queue name,
>> and have the front end route messages to PingService, based on the
>> version defined in the Session. Many problems with this. Old users
>> with active sessions bound to the previous version (which was just
>> built 15 minutes ago, perhaps!) will lose service once the new version
>> is completely rolled out, and a failover from basicReturn in the
>> client would have to be implemented.
>> - Use topic exchanges for each version, eg. 1.0.1.topic, and a
>> catch-all with *.topic. I think round-robin is lost here?
>>
>> That's the gist of it. Your help is appreciated. Thanks!
>>
>> Santi
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aaron at agoragames.com  Fri Jul 30 03:15:31 2010
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 29 Jul 2010 22:15:31 -0400
Subject: [rabbitmq-discuss] versioned routing
In-Reply-To: <AANLkTikZ7UWJA14yEoXWud=tSA_nrDq7TLDiPighcCcv@mail.gmail.com>
References: <AANLkTimMB1cz9vaOy06x-Y-73S+1YLLZh_Dwe21eYQ3o@mail.gmail.com>
	<AANLkTinsfhczf1oD6RWJLwX9YqSLz9jKAG0+XMQ_7Akw@mail.gmail.com>
	<AANLkTikZ7UWJA14yEoXWud=tSA_nrDq7TLDiPighcCcv@mail.gmail.com>
Message-ID: <AANLkTi=94OrQ2Pvu5J7ejbBsm+hOKaDBY-SwqAbn7-A-@mail.gmail.com>

> Don't you mean *queues* will round robin?

Yes, thank you.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From abhishek.kona at gmail.com  Fri Jul 30 13:36:46 2010
From: abhishek.kona at gmail.com (Abhishek K)
Date: Fri, 30 Jul 2010 18:06:46 +0530
Subject: [rabbitmq-discuss] Sending objects across different clients
Message-ID: <AANLkTikmxSfCPnxCoF45WSoMYa8-JK+=o-QKpvmEpt+6@mail.gmail.com>

I need to send Objects (usually maps) into an exchange and a client will
consume them. Clients can be in different languages. What are the ways of
doing it. Am I missing some thing here?


Abhishek Kona
India
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100730/1171687c/attachment.htm>

From emile at rabbitmq.com  Fri Jul 30 14:32:00 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 30 Jul 2010 14:32:00 +0100
Subject: [rabbitmq-discuss] QueueingConsumer basicPublish safety
In-Reply-To: <AANLkTik0z=kehYVPxHGfOB5DDRVPMgcyByYC4c8pn1Or@mail.gmail.com>
References: <AANLkTi=RbR962yjQsyxJ=iK17jefKCbpbT9kNguUqnQq@mail.gmail.com>	<4C518B98.2060808@rabbitmq.com>
	<AANLkTik0z=kehYVPxHGfOB5DDRVPMgcyByYC4c8pn1Or@mail.gmail.com>
Message-ID: <4C52D450.2030003@rabbitmq.com>

Hi Tsuraan,

On 29/07/10 17:11, tsuraan wrote:
>> Channel.flow has been asserted and therefore the basic.publish call has
>> blocked. We are aware that our API documentation is incorrect in
>> claiming that basic.publish is safe to use in the given context. This
>> will be updated.
> 
> So this probably only happens when rabbit thinks it's overloaded?

Correct

>> You need to enable consumption of messages while publishers are
>> potentially blocked. This will allow memory pressure on the broker to be
>> relieved and publishers to resume eventually. In your example
>> consumption and publication happens in the same thread and therefore
>> your application gets completely stuck as soon as publication blocks.
> 
> So is it safe to publish messages on a channel when some other thread
> is consuming on that channel?  If I acquire a lock on the channel in a
> different thread, and the channel blocks in basicPublish, will that
> still allow new messages to be delivered to the consumer?

In general, channels should not be shared by multiple threads, which is
what you are proposing. In your case it makes sense to publish and
consume on different channels to prevent this.

Even so, the channel.flow event from the broker that blocks the producer
only affects messages travelling in one direction. AMQP permits the
broker to deliver messages to consumer on the same channel.

>> You could also consider using separate channels for publishing and
>> consuming messages.
> I'm currently doing acks and publishes in a transaction, but I'm not
> sure if that's entirely necessary.  It's certainly convenient and
> safe, but I don't know that I really need to do it.  Are acks
> guaranteed not to block the way that publishes do?  I obviously can't
> send my acks on a different channel :)

Acks are guaranteed not to block.



Regards

Emile

From lists at zopyx.com  Fri Jul 30 14:34:49 2010
From: lists at zopyx.com (Andreas Jung)
Date: Fri, 30 Jul 2010 15:34:49 +0200
Subject: [rabbitmq-discuss] Sending objects across different clients
In-Reply-To: <AANLkTikmxSfCPnxCoF45WSoMYa8-JK+=o-QKpvmEpt+6@mail.gmail.com>
References: <AANLkTikmxSfCPnxCoF45WSoMYa8-JK+=o-QKpvmEpt+6@mail.gmail.com>
Message-ID: <4C52D4F9.7000401@zopyx.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Abhishek K wrote:
> I need to send Objects (usually maps) into an exchange and a client will
> consume them. Clients can be in different languages. What are the ways
> of doing it. Am I missing some thing here?

You are missing nothing - RabbitMQ is not about object serialization.
This is a topic that must be handled inside your application (producer
and consumer). The serialization approach depends on you needs and
technology. If you can: use XML as serialization format. Language
dependent serialization could look like this: Python uses a 'pickle'
format for serializing objects. Python bindings for RabbitMQ like Carrot
provide this level of serialization (besides others) out of the
box...but as said: object serialization is out of scope or RabbitMQ.

- -aj
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (Darwin)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkxS1PkACgkQCJIWIbr9KYxHegCgqT2iSYCpbVi+fWe3f+3E8kDH
9DQAnjYSdzmHDFsEFizykU81Rk51+hFS
=gpsS
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lists.vcf
Type: text/x-vcard
Size: 316 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100730/9d28616d/attachment.vcf>

From david at rabbitmq.com  Fri Jul 30 14:54:43 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 30 Jul 2010 14:54:43 +0100
Subject: [rabbitmq-discuss] Sending objects across different clients
In-Reply-To: <4C52D4F9.7000401@zopyx.com> (Andreas Jung's message of "Fri, 30
	Jul 2010 15:34:49 +0200")
References: <AANLkTikmxSfCPnxCoF45WSoMYa8-JK+=o-QKpvmEpt+6@mail.gmail.com>
	<4C52D4F9.7000401@zopyx.com>
Message-ID: <yrv4cpqy5hy70.fsf@dwragg.eng.vmware.com>

Andreas Jung <lists at zopyx.com> writes:
> Abhishek K wrote:
>> I need to send Objects (usually maps) into an exchange and a client will
>> consume them. Clients can be in different languages. What are the ways
>> of doing it. Am I missing some thing here?
>
> You are missing nothing - RabbitMQ is not about object serialization.
> This is a topic that must be handled inside your application (producer
> and consumer). The serialization approach depends on you needs and
> technology. If you can: use XML as serialization format. Language
> dependent serialization could look like this: Python uses a 'pickle'
> format for serializing objects. Python bindings for RabbitMQ like Carrot
> provide this level of serialization (besides others) out of the
> box...but as said: object serialization is out of scope or RabbitMQ.

Andreas is correct - you'll need to choose a serialization format based
on your requirements.

With that said, if interop between different languages is a requirement,
then the list of candidates is not huge.  If you are using dynamic
languages (e.g. Ruby, Python), JSON works well.  For more static
languages (e.g. Java, C#), XML might give you a richer toolset.  If
message size is more of a concern than human readability of messages,
then consider language-independent binary serialization technologies,
such as protobufs, thrift, and fudge.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jon.brisbin at npcinternational.com  Fri Jul 30 17:01:34 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 30 Jul 2010 11:01:34 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
Message-ID: <73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>

To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.

OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently). 

I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.

There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jul 29, 2010, at 4:34 PM, David Wragg wrote:

> Hi Jon,
> 
> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>> Has anyone worked with RabbitMQ inside NetKernel?
>> 
>> http://www.1060research.com/netkernel/
>> 
>> I know enough about OSGI to make myself dangerous. I've worked some
>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>> least explore it a little to see if it would make our cloud
>> infrastructure easier to manage. I'd love to have some AMQP
>> integration in NetKernel to play with, so I wondered if anyone has
>> already worked on something or if there are plans to do so?
> 
> I don't think we've heard of RabbitMQ and NetKernel being used together.
> 
> I wonder how you would combine the resource oriented computing paradigm
> of NetKernel with a messaging approach?  Or were you thinking of using
> AMQP as a transport for Netkernel?
> 
> Dvid
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware


From alexis at rabbitmq.com  Fri Jul 30 19:34:34 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Jul 2010 19:34:34 +0100
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
Message-ID: <AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>

Jon

Interesting indeed!  At the risk of being both laconic and glib... do
you have a diagram showing what you propose to achieve?  I think that
would bring this to life...

alexis

On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>
> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>
> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>
> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>
>> Hi Jon,
>>
>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>
>>> http://www.1060research.com/netkernel/
>>>
>>> I know enough about OSGI to make myself dangerous. I've worked some
>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>> least explore it a little to see if it would make our cloud
>>> infrastructure easier to manage. I'd love to have some AMQP
>>> integration in NetKernel to play with, so I wondered if anyone has
>>> already worked on something or if there are plans to do so?
>>
>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>
>> I wonder how you would combine the resource oriented computing paradigm
>> of NetKernel with a messaging approach? ?Or were you thinking of using
>> AMQP as a transport for Netkernel?
>>
>> Dvid
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jon.brisbin at npcinternational.com  Fri Jul 30 21:09:59 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 30 Jul 2010 15:09:59 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
Message-ID: <0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>

I've attached a PDF of a 5-minute diagram that shows some use cases for me.

On the right:

Top is a tcServer instance that needs to load an object from the distributed cache.

Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.

Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.

Flow for tcServer code requesting object from distributed cache:

1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages. 

2. Sends a message to the cloud, asking for the object.

3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.

4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.

Flow for AS/400 wanting to update a store:

1. AS/400 trigger fires, dumping a message into RabbitMQ.

2. AMQP module sees it and delegates to Store Updater Module.

3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.

Jon Brisbin
Portal Webmaster
NPC International, Inc.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: NetKernelDiagram.pdf
Type: application/pdf
Size: 398517 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100730/693d42d5/attachment-0001.pdf>
-------------- next part --------------

On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:

> Jon
> 
> Interesting indeed!  At the risk of being both laconic and glib... do
> you have a diagram showing what you propose to achieve?  I think that
> would bring this to life...
> 
> alexis
> 
> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>> 
>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>> 
>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>> 
>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>> 
>>> Hi Jon,
>>> 
>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>> 
>>>> http://www.1060research.com/netkernel/
>>>> 
>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>> least explore it a little to see if it would make our cloud
>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>> already worked on something or if there are plans to do so?
>>> 
>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>> 
>>> I wonder how you would combine the resource oriented computing paradigm
>>> of NetKernel with a messaging approach?  Or were you thinking of using
>>> AMQP as a transport for Netkernel?
>>> 
>>> Dvid
>>> 
>>> --
>>> David Wragg
>>> Staff Engineer, RabbitMQ
>>> SpringSource, a division of VMware
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From alexis at rabbitmq.com  Fri Jul 30 21:16:39 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Jul 2010 21:16:39 +0100
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
Message-ID: <AANLkTikZFMrQ1as2qZozpD1yG--HSD9i+FpTRaoj-ne4@mail.gmail.com>

Jon

Thank-you!  Now can you elaborate on what the middle tier 'gets you'
please?  Is it just a convenient hosting layer or does it control
something that can't be in the other two tiers?

alexis



On Fri, Jul 30, 2010 at 9:09 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
>
> On the right:
>
> Top is a tcServer instance that needs to load an object from the distributed cache.
>
> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
>
> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
>
> Flow for tcServer code requesting object from distributed cache:
>
> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages.
>
> 2. Sends a message to the cloud, asking for the object.
>
> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
>
> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
>
> Flow for AS/400 wanting to update a store:
>
> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
>
> 2. AMQP module sees it and delegates to Store Updater Module.
>
> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
>
>> Jon
>>
>> Interesting indeed! ?At the risk of being both laconic and glib... do
>> you have a diagram showing what you propose to achieve? ?I think that
>> would bring this to life...
>>
>> alexis
>>
>> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
>> <jon.brisbin at npcinternational.com> wrote:
>>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>>>
>>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>>>
>>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>>>
>>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>>>
>>> Jon Brisbin
>>> Portal Webmaster
>>> NPC International, Inc.
>>>
>>>
>>>
>>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>>>
>>>> Hi Jon,
>>>>
>>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>>>
>>>>> http://www.1060research.com/netkernel/
>>>>>
>>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>>> least explore it a little to see if it would make our cloud
>>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>>> already worked on something or if there are plans to do so?
>>>>
>>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>>>
>>>> I wonder how you would combine the resource oriented computing paradigm
>>>> of NetKernel with a messaging approach? ?Or were you thinking of using
>>>> AMQP as a transport for Netkernel?
>>>>
>>>> Dvid
>>>>
>>>> --
>>>> David Wragg
>>>> Staff Engineer, RabbitMQ
>>>> SpringSource, a division of VMware
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>
>

From alexis at rabbitmq.com  Fri Jul 30 21:19:35 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Jul 2010 21:19:35 +0100
Subject: [rabbitmq-discuss] Very simply example showing request/reply
	communication (C/C++, COBOL, C#)
In-Reply-To: <AANLkTinX4A9=1XEvYHxP2QNqSo-KQ87K=R2dPgfw3CWj@mail.gmail.com>
References: <AANLkTi=Z=msANYzw5opuqbyg4jAb6Aygm3-GhsbUB31M@mail.gmail.com>
	<AANLkTinX4A9=1XEvYHxP2QNqSo-KQ87K=R2dPgfw3CWj@mail.gmail.com>
Message-ID: <AANLkTimSJo648cad7T0QZnsnkHgHPt_H4FhF6Zrk0cSg@mail.gmail.com>

John

We have some message patterns libraries at

http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/ and
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/

Does that help?

alexis


On Wed, Jul 28, 2010 at 7:12 PM, John Apps <johndapps at gmail.com> wrote:
> Of course I shall dig through the sample directories and look on the Web,
> but I am hoping -being the lazy chap I am- that someone can point me to a
> very simple example showing request/response communication with
> RabbitMQ. I realize there are lots of options to this, e.g., transactions,
> durable, so will take whatever is there. All the more the merrier!
> Platforms can be Windows, UNIX, Linux, OpenVMS; languages preferably C#,
> C/C++, COBOL. (The latter may be a challenge which I have to solve myself.)
> Comparisons with TIBCO RV in the example will be welcomed...
>
> Cheers, John
> ---
> John Apps
> (49) 171 869 1813
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jon.brisbin at npcinternational.com  Fri Jul 30 21:31:42 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 30 Jul 2010 15:31:42 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <AANLkTikZFMrQ1as2qZozpD1yG--HSD9i+FpTRaoj-ne4@mail.gmail.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<AANLkTikZFMrQ1as2qZozpD1yG--HSD9i+FpTRaoj-ne4@mail.gmail.com>
Message-ID: <D0D75CBE-A939-4A2C-A79C-9A5046C145E5@npcinternational.com>

I can see several advantages:

In addition to the management and resource efficiency of consolidating to a central (to that VM anyway) postoffice, it seems more scalable, can support higher throughput because of the dedicated dispatching (which is a pattern I use anyway inside the code where I do messaging), vastly reduces resource usage in those other components where all of this functionality is duplicated at current, and seems it will make testing easier because I can dispense with actual message sending/receiving in the test versions of modules without affecting application code.

It should also be easier to manage services I would otherwise have to start with a bash script like the cache, the store updater, the distributed ClassLoader, and suchlike...

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jul 30, 2010, at 3:16 PM, Alexis Richardson wrote:

> Jon
> 
> Thank-you!  Now can you elaborate on what the middle tier 'gets you'
> please?  Is it just a convenient hosting layer or does it control
> something that can't be in the other two tiers?
> 
> alexis
> 
> 
> 
> On Fri, Jul 30, 2010 at 9:09 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
>> 
>> On the right:
>> 
>> Top is a tcServer instance that needs to load an object from the distributed cache.
>> 
>> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
>> 
>> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
>> 
>> Flow for tcServer code requesting object from distributed cache:
>> 
>> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages.
>> 
>> 2. Sends a message to the cloud, asking for the object.
>> 
>> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
>> 
>> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
>> 
>> Flow for AS/400 wanting to update a store:
>> 
>> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
>> 
>> 2. AMQP module sees it and delegates to Store Updater Module.
>> 
>> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
>> 
>>> Jon
>>> 
>>> Interesting indeed!  At the risk of being both laconic and glib... do
>>> you have a diagram showing what you propose to achieve?  I think that
>>> would bring this to life...
>>> 
>>> alexis
>>> 
>>> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
>>> <jon.brisbin at npcinternational.com> wrote:
>>>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>>>> 
>>>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>>>> 
>>>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>>>> 
>>>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>>>> 
>>>> Jon Brisbin
>>>> Portal Webmaster
>>>> NPC International, Inc.
>>>> 
>>>> 
>>>> 
>>>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>>>> 
>>>>> Hi Jon,
>>>>> 
>>>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>>>> 
>>>>>> http://www.1060research.com/netkernel/
>>>>>> 
>>>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>>>> least explore it a little to see if it would make our cloud
>>>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>>>> already worked on something or if there are plans to do so?
>>>>> 
>>>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>>>> 
>>>>> I wonder how you would combine the resource oriented computing paradigm
>>>>> of NetKernel with a messaging approach?  Or were you thinking of using
>>>>> AMQP as a transport for Netkernel?
>>>>> 
>>>>> Dvid
>>>>> 
>>>>> --
>>>>> David Wragg
>>>>> Staff Engineer, RabbitMQ
>>>>> SpringSource, a division of VMware
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>> 
>> 
>> 


From alexis at rabbitmq.com  Fri Jul 30 21:34:43 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 30 Jul 2010 21:34:43 +0100
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <D0D75CBE-A939-4A2C-A79C-9A5046C145E5@npcinternational.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<AANLkTikZFMrQ1as2qZozpD1yG--HSD9i+FpTRaoj-ne4@mail.gmail.com>
	<D0D75CBE-A939-4A2C-A79C-9A5046C145E5@npcinternational.com>
Message-ID: <AANLkTi==UH3d_c4KnwjSNCZ5eNyAg1DhJS3nu2NSRzGG@mail.gmail.com>

Surely that would only make sense at *very* high volume?


On Fri, Jul 30, 2010 at 9:31 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
> I can see several advantages:
>
> In addition to the management and resource efficiency of consolidating to a central (to that VM anyway) postoffice, it seems more scalable, can support higher throughput because of the dedicated dispatching (which is a pattern I use anyway inside the code where I do messaging), vastly reduces resource usage in those other components where all of this functionality is duplicated at current, and seems it will make testing easier because I can dispense with actual message sending/receiving in the test versions of modules without affecting application code.
>
> It should also be easier to manage services I would otherwise have to start with a bash script like the cache, the store updater, the distributed ClassLoader, and suchlike...
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
> On Jul 30, 2010, at 3:16 PM, Alexis Richardson wrote:
>
>> Jon
>>
>> Thank-you! ?Now can you elaborate on what the middle tier 'gets you'
>> please? ?Is it just a convenient hosting layer or does it control
>> something that can't be in the other two tiers?
>>
>> alexis
>>
>>
>>
>> On Fri, Jul 30, 2010 at 9:09 PM, Jon Brisbin
>> <jon.brisbin at npcinternational.com> wrote:
>>> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
>>>
>>> On the right:
>>>
>>> Top is a tcServer instance that needs to load an object from the distributed cache.
>>>
>>> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
>>>
>>> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
>>>
>>> Flow for tcServer code requesting object from distributed cache:
>>>
>>> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages.
>>>
>>> 2. Sends a message to the cloud, asking for the object.
>>>
>>> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
>>>
>>> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
>>>
>>> Flow for AS/400 wanting to update a store:
>>>
>>> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
>>>
>>> 2. AMQP module sees it and delegates to Store Updater Module.
>>>
>>> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
>>>
>>> Jon Brisbin
>>> Portal Webmaster
>>> NPC International, Inc.
>>>
>>>
>>>
>>> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
>>>
>>>> Jon
>>>>
>>>> Interesting indeed! ?At the risk of being both laconic and glib... do
>>>> you have a diagram showing what you propose to achieve? ?I think that
>>>> would bring this to life...
>>>>
>>>> alexis
>>>>
>>>> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
>>>> <jon.brisbin at npcinternational.com> wrote:
>>>>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>>>>>
>>>>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>>>>>
>>>>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>>>>>
>>>>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>>>>>
>>>>> Jon Brisbin
>>>>> Portal Webmaster
>>>>> NPC International, Inc.
>>>>>
>>>>>
>>>>>
>>>>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>>>>>
>>>>>> Hi Jon,
>>>>>>
>>>>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>>>>>
>>>>>>> http://www.1060research.com/netkernel/
>>>>>>>
>>>>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>>>>> least explore it a little to see if it would make our cloud
>>>>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>>>>> already worked on something or if there are plans to do so?
>>>>>>
>>>>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>>>>>
>>>>>> I wonder how you would combine the resource oriented computing paradigm
>>>>>> of NetKernel with a messaging approach? ?Or were you thinking of using
>>>>>> AMQP as a transport for Netkernel?
>>>>>>
>>>>>> Dvid
>>>>>>
>>>>>> --
>>>>>> David Wragg
>>>>>> Staff Engineer, RabbitMQ
>>>>>> SpringSource, a division of VMware
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>
>>>
>>>
>
>

From jon.brisbin at npcinternational.com  Fri Jul 30 21:34:46 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 30 Jul 2010 15:34:46 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
Message-ID: <552C4FCB-8E8C-4B45-A3E3-CD287A9021BD@npcinternational.com>

I would basically be implementing an AMQP version of the JMS stuff:

http://docs.netkernel.org/book/view/book:mod:reference/doc:tpt:jms:accessor:service

...but with consumers added, instead of the one-way street the JMS sender is.

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Jul 30, 2010, at 3:09 PM, Jon Brisbin wrote:

> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
> 
> On the right:
> 
> Top is a tcServer instance that needs to load an object from the distributed cache.
> 
> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
> 
> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
> 
> Flow for tcServer code requesting object from distributed cache:
> 
> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages. 
> 
> 2. Sends a message to the cloud, asking for the object.
> 
> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
> 
> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
> 
> Flow for AS/400 wanting to update a store:
> 
> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
> 
> 2. AMQP module sees it and delegates to Store Updater Module.
> 
> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> <NetKernelDiagram.pdf>
> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
> 
>> Jon
>> 
>> Interesting indeed!  At the risk of being both laconic and glib... do
>> you have a diagram showing what you propose to achieve?  I think that
>> would bring this to life...
>> 
>> alexis
>> 
>> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
>> <jon.brisbin at npcinternational.com> wrote:
>>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>>> 
>>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>>> 
>>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>>> 
>>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>>> 
>>> Jon Brisbin
>>> Portal Webmaster
>>> NPC International, Inc.
>>> 
>>> 
>>> 
>>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>>> 
>>>> Hi Jon,
>>>> 
>>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>>> 
>>>>> http://www.1060research.com/netkernel/
>>>>> 
>>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>>> least explore it a little to see if it would make our cloud
>>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>>> already worked on something or if there are plans to do so?
>>>> 
>>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>>> 
>>>> I wonder how you would combine the resource oriented computing paradigm
>>>> of NetKernel with a messaging approach?  Or were you thinking of using
>>>> AMQP as a transport for Netkernel?
>>>> 
>>>> Dvid
>>>> 
>>>> --
>>>> David Wragg
>>>> Staff Engineer, RabbitMQ
>>>> SpringSource, a division of VMware
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jon.brisbin at npcinternational.com  Fri Jul 30 22:01:04 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 30 Jul 2010 16:01:04 -0500
Subject: [rabbitmq-discuss] RabbitKernel
In-Reply-To: <AANLkTi==UH3d_c4KnwjSNCZ5eNyAg1DhJS3nu2NSRzGG@mail.gmail.com>
References: <4ADEF198-C94B-4199-9541-964DC986AB14@npcinternational.com>
	<yrv4ck4oedlb4.fsf@dwragg.eng.vmware.com>
	<73EC566C-EB93-4019-8C06-37CC3E45359E@npcinternational.com>
	<AANLkTik8CbMR0yimyjOfs6eZK2tGve0NXR0hL-4DeEu-@mail.gmail.com>
	<0A837654-F22B-44D2-95D8-F50FEE42F7ED@npcinternational.com>
	<AANLkTikZFMrQ1as2qZozpD1yG--HSD9i+FpTRaoj-ne4@mail.gmail.com>
	<D0D75CBE-A939-4A2C-A79C-9A5046C145E5@npcinternational.com>
	<AANLkTi==UH3d_c4KnwjSNCZ5eNyAg1DhJS3nu2NSRzGG@mail.gmail.com>
Message-ID: <D4D84159-EC4C-4C5C-9956-D82CC97ED126@npcinternational.com>


On Jul 30, 2010, at 3:34 PM, Alexis Richardson wrote:

> Surely that would only make sense at *very* high volume?
> 

We're certainly not doing as much traffic as a lot of people, so I'm sure we've got CPU/RAM to burn. 

This duplication of resources concerns me because there's such a variation in the way each component works (which is mostly an artefact of me constantly tweaking things). I'm already hovering in the 60%-70% memory usage range under normal circumstances (VMs with 3GB RAM, 3 instances of tcServer, and sundry other apps). This is giving us great performance. Page responses are consistent and usually in the tens of milliseconds (unless it's talking to the AS/400...then it's 10 seconds-ish!). But we haven't even fully utilized all the messaging we're going to be doing in the next couple months. I'm not sure what impact that's going to have.

I'm thinking every VM will have something like this running on it, whether it's doing app serving or as a slave compute node for map/reduce jobs (which I'm trying to architect for, even though the other developers can't even spell map/reduce! ;). I've got to find a way to start these services/listeners/consumers anyway, whether as a module in NetKernel, or as a Java app using commons-cli and invoking it from a bash script. It seems to me that using an OSGi approach will yield better results with fewer headaches. I might be wrong.

You raise a good point, though. At what point does it become a theoretical exercise, done simply to see if it's possible? I just follow my instincts. My instinct says I can make this better than what it is today. I guess you could say I simply can't help myself. :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.


> 
> On Fri, Jul 30, 2010 at 9:31 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> I can see several advantages:
>> 
>> In addition to the management and resource efficiency of consolidating to a central (to that VM anyway) postoffice, it seems more scalable, can support higher throughput because of the dedicated dispatching (which is a pattern I use anyway inside the code where I do messaging), vastly reduces resource usage in those other components where all of this functionality is duplicated at current, and seems it will make testing easier because I can dispense with actual message sending/receiving in the test versions of modules without affecting application code.
>> 
>> It should also be easier to manage services I would otherwise have to start with a bash script like the cache, the store updater, the distributed ClassLoader, and suchlike...
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> On Jul 30, 2010, at 3:16 PM, Alexis Richardson wrote:
>> 
>>> Jon
>>> 
>>> Thank-you!  Now can you elaborate on what the middle tier 'gets you'
>>> please?  Is it just a convenient hosting layer or does it control
>>> something that can't be in the other two tiers?
>>> 
>>> alexis
>>> 
>>> 
>>> 
>>> On Fri, Jul 30, 2010 at 9:09 PM, Jon Brisbin
>>> <jon.brisbin at npcinternational.com> wrote:
>>>> I've attached a PDF of a 5-minute diagram that shows some use cases for me.
>>>> 
>>>> On the right:
>>>> 
>>>> Top is a tcServer instance that needs to load an object from the distributed cache.
>>>> 
>>>> Middle is a cron job that needs access to modules running in NetKernel on that machine for maintenance functions.
>>>> 
>>>> Bottom is the AS/400 that needs to update the PostgreSQL server at a store as the result of a database trigger.
>>>> 
>>>> Flow for tcServer code requesting object from distributed cache:
>>>> 
>>>> 1. Use Scala/Akka (or some IPC mechanism) to block on a remote Actor which checks local cache module but doesn't find the object. It shells out to the AMQP module, which is solely responsible for sending and receiving messages.
>>>> 
>>>> 2. Sends a message to the cloud, asking for the object.
>>>> 
>>>> 3. Remote AMQP module gets a cache request message and dispatches it to the cache module, which returns an object. The remote AMQP module then replies to the requestor, handing back the Protobuf'd object.
>>>> 
>>>> 4. Requesting AMQP module maybe stores object in local cache and hands object back to Akka module, which replies to the tcServer code that originally requested the object.
>>>> 
>>>> Flow for AS/400 wanting to update a store:
>>>> 
>>>> 1. AS/400 trigger fires, dumping a message into RabbitMQ.
>>>> 
>>>> 2. AMQP module sees it and delegates to Store Updater Module.
>>>> 
>>>> 3. Store Updater Module sees this is a fire-and-forget update, so returns immediately and proceeds to update a store database in Birmingham, Alabama (or Portland, Oregon for that matter) asynchronously.
>>>> 
>>>> Jon Brisbin
>>>> Portal Webmaster
>>>> NPC International, Inc.
>>>> 
>>>> 
>>>> 
>>>> On Jul 30, 2010, at 1:34 PM, Alexis Richardson wrote:
>>>> 
>>>>> Jon
>>>>> 
>>>>> Interesting indeed!  At the risk of being both laconic and glib... do
>>>>> you have a diagram showing what you propose to achieve?  I think that
>>>>> would bring this to life...
>>>>> 
>>>>> alexis
>>>>> 
>>>>> On Fri, Jul 30, 2010 at 5:01 PM, Jon Brisbin
>>>>> <jon.brisbin at npcinternational.com> wrote:
>>>>>> To expand some (and for the benefit of the list), I guess what I'm thinking is related to a problem I see on the horizon as I build more utilities that have at their foundation AMQP messaging. Each component needs to talk to the other components running on different VMs within the cloud on different exchanges/queues and each has their own system of subscribing consumers and producing messages. This means: if I have three instances of tcServer running on a VM and each webapp is using the cloud session manager and and the server is using the JMX invoker, I've got four different ConnectionFactories, four sets of subscribers, four sets of producers (times the number of workers I have configured; I'll likely have 40 or more of these per VM). This doesn't seem terribly scalable to me, so I'm hunting for a way to use messaging on a VM for communicating to various components (that are likely unrelated) in a more reasonable way.
>>>>>> 
>>>>>> OSGi has always appealed to me because of module versioning, live reloading, etc... and the ROC approach that NetKernel takes to abstracting OSGi seems to offer (in my initial estimation at least) the ability to de-duplicate the various ways I'm managing connections, channels, subscribers, and producers (which is to say: each time I write a module, I try and improve it; the side-effect being each module does these things a little differently).
>>>>>> 
>>>>>> I'm starting with a proof-of-concept NetKernel module that offers endpoints for publishing messages. That seems the easiest to start with. But after that, I think creating a system of consumers and resource "callbacks" would be fairly lightweight and, more than anything, better than what I've got now because it wouldn't be copied all over the place in different ways.
>>>>>> 
>>>>>> There seems to be a "best practice" way of managing the actual sending and receiving of messages irregardless of the application into which this functionality is injected. Once I can encapsulate that into a module, I have to figure out how IPC will happen! :/ I'm leaning toward Scala/Akka remote actors but there are more ways to go about this, I'm sure. I could also use local Redis servers that would use a variation on OSGi's "whiteboard" pattern where code inside the RabbitMQ NetKernel module would write data to a local Redis server where it could be picked up by code running in other JVMs on the same machine. I just haven't thought enough about it yet to decide which is best (my luck will be that it's actually a combination of various things).
>>>>>> 
>>>>>> Jon Brisbin
>>>>>> Portal Webmaster
>>>>>> NPC International, Inc.
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> On Jul 29, 2010, at 4:34 PM, David Wragg wrote:
>>>>>> 
>>>>>>> Hi Jon,
>>>>>>> 
>>>>>>> Jon Brisbin <jon.brisbin at npcinternational.com> writes:
>>>>>>>> Has anyone worked with RabbitMQ inside NetKernel?
>>>>>>>> 
>>>>>>>> http://www.1060research.com/netkernel/
>>>>>>>> 
>>>>>>>> I know enough about OSGI to make myself dangerous. I've worked some
>>>>>>>> with Apache's ESB, so when I came across NetKernel, I thought I'd at
>>>>>>>> least explore it a little to see if it would make our cloud
>>>>>>>> infrastructure easier to manage. I'd love to have some AMQP
>>>>>>>> integration in NetKernel to play with, so I wondered if anyone has
>>>>>>>> already worked on something or if there are plans to do so?
>>>>>>> 
>>>>>>> I don't think we've heard of RabbitMQ and NetKernel being used together.
>>>>>>> 
>>>>>>> I wonder how you would combine the resource oriented computing paradigm
>>>>>>> of NetKernel with a messaging approach?  Or were you thinking of using
>>>>>>> AMQP as a transport for Netkernel?
>>>>>>> 
>>>>>>> Dvid
>>>>>>> 
>>>>>>> --
>>>>>>> David Wragg
>>>>>>> Staff Engineer, RabbitMQ
>>>>>>> SpringSource, a division of VMware
>>>>>> 
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>> 
>>>> 
>>>> 
>>>> 
>> 
>> 


From tsuraan at gmail.com  Sat Jul 31 02:01:31 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 30 Jul 2010 20:01:31 -0500
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
Message-ID: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>

I just updated to default (wanting to try out the disk persister that
just merged in), and it doesn't look like py-amqplib can handshake
with it anymore.  It's protocol header is AMQP\x01\x01\x09\x01 (which
seems like a strange header for the 0.8 client, but anyhow...).  In
the bug21673 branch, the handshake pattern was
AMQP\x01\x01\x<Major>\x<Minor>, but in default, it's now divided into
AMQP0091, AMQP1109, and AMQP1180.  Why was this done?  Changing the
header string in py-amqplib is easy enough, but it seems weird that a
client cannot be compatible with the old rabbit and the new one.

From matthew at rabbitmq.com  Sat Jul 31 11:28:29 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 31 Jul 2010 11:28:29 +0100
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
In-Reply-To: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>
References: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>
Message-ID: <20100731102828.GA20755@wellquite.org>

On Fri, Jul 30, 2010 at 08:01:31PM -0500, tsuraan wrote:
> I just updated to default (wanting to try out the disk persister that
> just merged in), and it doesn't look like py-amqplib can handshake
> with it anymore.  It's protocol header is AMQP\x01\x01\x09\x01 (which
> seems like a strange header for the 0.8 client, but anyhow...).  In
> the bug21673 branch, the handshake pattern was
> AMQP\x01\x01\x<Major>\x<Minor>, but in default, it's now divided into
> AMQP0091, AMQP1109, and AMQP1180.  Why was this done?  Changing the
> header string in py-amqplib is easy enough, but it seems weird that a
> client cannot be compatible with the old rabbit and the new one.

Ahh well the multi-protocol broker stuff landed yesterday so the broker
can now speak AMQP 0-8 and 0-9-1. I wonder whether we've managed to get
protocol negotiation wrong. I'm afraid I've not worked on that area of
the codebase and don't really understand the bizarre complexities of
protocol negotiation in AMQP at all so this might have to wait until
Monday... What may be more likely is that the py-amqplib always sent a
0-9-1 protocol header which we accepted and told it we were only going
to speak 0-8 to it. But it may be the 0-9-1 header it was sending was
actually wrong as far as the 0-9-1 spec says. Certainly I'm aware we've
found other AMQP brokers that get the protocol header wrong too...

Matthew

From simon at rabbitmq.com  Sat Jul 31 14:46:55 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 31 Jul 2010 14:46:55 +0100
Subject: [rabbitmq-discuss] py-amqplib and rabbit default
In-Reply-To: <20100731102828.GA20755@wellquite.org>
References: <AANLkTim+4VR3bgwaiyAdyNn6sBSiZFXenyNhV1Nqxi7G@mail.gmail.com>
	<20100731102828.GA20755@wellquite.org>
Message-ID: <4C54294F.4020109@rabbitmq.com>

On 31/07/10 11:28, Matthew Sackman wrote:
> On Fri, Jul 30, 2010 at 08:01:31PM -0500, tsuraan wrote:
>> I just updated to default (wanting to try out the disk persister that
>> just merged in), and it doesn't look like py-amqplib can handshake
>> with it anymore.  It's protocol header is AMQP\x01\x01\x09\x01 (which
>> seems like a strange header for the 0.8 client, but anyhow...).  In
>> the bug21673 branch, the handshake pattern was
>> AMQP\x01\x01\x<Major>\x<Minor>, but in default, it's now divided into
>> AMQP0091, AMQP1109, and AMQP1180.  Why was this done?  Changing the
>> header string in py-amqplib is easy enough, but it seems weird that a
>> client cannot be compatible with the old rabbit and the new one.
>
> Ahh well the multi-protocol broker stuff landed yesterday so the broker
> can now speak AMQP 0-8 and 0-9-1. I wonder whether we've managed to get
> protocol negotiation wrong. I'm afraid I've not worked on that area of
> the codebase and don't really understand the bizarre complexities of
> protocol negotiation in AMQP at all so this might have to wait until
> Monday... What may be more likely is that the py-amqplib always sent a
> 0-9-1 protocol header which we accepted and told it we were only going
> to speak 0-8 to it. But it may be the 0-9-1 header it was sending was
> actually wrong as far as the 0-9-1 spec says. Certainly I'm aware we've
> found other AMQP brokers that get the protocol header wrong too...

Speaking as someone who did work on this, that's basically it.

In theory each of the four bytes after "AMQP" have meaningful semantics. 
However, each version of the AMQP standard seems to manage to assign 
them *different* semantics, so in practice we just pattern-match.

The standards say[0]:

AMQP1180 = 0-8
AMQP1109 = 0-9
AMQP0091 = 0-9-1

And yes, that's not exactly a regular pattern there, but that's what the 
specs say.

However, we weren't aware that there were clients out there in the wild 
sending even odder handshakes. Unfortunately the 0-8 handshake code that 
was in RabbitMQ up till Friday was quite lax; accepting either 0-8, or 
any version that claimed to be higher than 0-8 by the 0-8 semantics of 
each of the bytes. Hence AMQP1191 was accepted, and treated as 0-8. Now 
we're stricter, and reject it.

I'm not sure what the best approach is. Our goal was for 0-9-1 support 
to just appear and work, and not inconvenience any existing 0-8 users. 
With that in mind, I suspect we'll end up adding a workaround for 
py-amqplib, treating AMQP1191 as 0-8. But not until Monday :) Of course, 
py-amqplib should be fixed too.

Cheers, Simon

[0] Whenever I write AMQPabcd, please treat the four digits as byte 
values not ASCII characters.

