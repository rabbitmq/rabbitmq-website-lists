From majek04 at gmail.com  Fri Oct  1 10:22:06 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 10:22:06 +0100
Subject: [rabbitmq-discuss] use of an NFS for broker failover
In-Reply-To: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>
References: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>
Message-ID: <AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>

On Thu, Sep 30, 2010 at 17:37, Shane <shane at digitalsanctum.com> wrote:
> Given two brokers (Broker A and Broker B) use the same file system
> space via NFS and the following events occur:
>
> 1. Broker A goes down with producers/consumers connected to it.
> 2. Broker B starts up
> 3. Producers/consumers reconnect to Broker B.
>
> All exchanges/queues are created upon startup of the producers/
> consumers.
>
> What else should I be considering to achieve failover?

That sounds good. NFS may not be the best tool for this job, but
it might just work. Do make sure that at no point two Rabbits
are using the same data. You may also find the "reconnect"
bit hard, how will your clients know which Rabbit to connect to?

Have you looked at our Pacemaker tutorial?
http://www.rabbitmq.com/pacemaker.html

Cheers,
    Marek

From videlalvaro at gmail.com  Fri Oct  1 10:28:56 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 1 Oct 2010 17:28:56 +0800
Subject: [rabbitmq-discuss] use of an NFS for broker failover
In-Reply-To: <AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>
References: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>
	<AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>
Message-ID: <3C4A8646-6C15-4978-9EC9-713D8F331F44@gmail.com>

Why don't you use LVS for such scenario? We us RabbitMQ in prod behind a LVS.

On Oct 1, 2010, at 5:22 PM, Marek Majkowski wrote:

> On Thu, Sep 30, 2010 at 17:37, Shane <shane at digitalsanctum.com> wrote:
>> Given two brokers (Broker A and Broker B) use the same file system
>> space via NFS and the following events occur:
>> 
>> 1. Broker A goes down with producers/consumers connected to it.
>> 2. Broker B starts up
>> 3. Producers/consumers reconnect to Broker B.
>> 
>> All exchanges/queues are created upon startup of the producers/
>> consumers.
>> 
>> What else should I be considering to achieve failover?
> 
> That sounds good. NFS may not be the best tool for this job, but
> it might just work. Do make sure that at no point two Rabbits
> are using the same data. You may also find the "reconnect"
> bit hard, how will your clients know which Rabbit to connect to?
> 
> Have you looked at our Pacemaker tutorial?
> http://www.rabbitmq.com/pacemaker.html
> 
> Cheers,
>    Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Fri Oct  1 12:02:05 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Oct 2010 12:02:05 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
Message-ID: <4CA5BFAD.2040705@rabbitmq.com>

Doug Barth wrote:
> We needed similar functionality.

There are two features which we are planning to implement in RabbitMQ 
(please don't ask when ;) that in their combination can provide 
delayed/scheduled message functionality: 1) per-queue message TTLs, and 
2) dead-letter exchanges. The setup would look something like this:

The app creates a queue with the desired delay as the per-queue message 
ttl. That queue is configured to route purged messages to an exchange 
(using the dead-letter exchange feature). A second queue is bound to 
that exchange to receive all the messages. The app consumes from the 
second queue.


Regards,

Matthias.

From matthias at rabbitmq.com  Fri Oct  1 12:26:46 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Oct 2010 12:26:46 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <4CA5BFAD.2040705@rabbitmq.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com>
Message-ID: <4CA5C576.6080709@rabbitmq.com>

Matthias Radestock wrote:
> Doug Barth wrote:
>> We needed similar functionality.
> 
> There are two features which we are planning to implement in RabbitMQ 
> (please don't ask when ;) that in their combination can provide 
> delayed/scheduled message functionality: 1) per-queue message TTLs, and 
> 2) dead-letter exchanges. The setup would look something like this:
> [...]

Another solution, which you can implement right now, is to get the 
publishers to stick an expiry header into the message and to publish the 
message to a dedicated delay queue. A helper app consumes messages from 
that queue one at a time and checks the expiry. If the expiry is in the 
past it re-publishes the message to the appropriate exchange for 
routing. Otherwise it waits until the deadline.

The expiries must be monotonically increasing per delay queue, though 
you can setup several delay queues for different expiry intervals.


Regards,

Matthias.

From david at rabbitmq.com  Fri Oct  1 12:51:35 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 01 Oct 2010 12:51:35 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <4CA5C576.6080709@rabbitmq.com> (Matthias Radestock's message of
	"Fri, 01 Oct 2010 12:26:46 +0100")
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
Message-ID: <yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>

Matthias Radestock <matthias at rabbitmq.com> writes:
> Another solution, which you can implement right now, is to get the
> publishers to stick an expiry header into the message and to publish
> the message to a dedicated delay queue. A helper app consumes messages
> from that queue one at a time and checks the expiry. If the expiry is
> in the past it re-publishes the message to the appropriate exchange
> for routing. Otherwise it waits until the deadline.

This (any many other) AMQP intermiediaries would be assisted by:

- A way to consume messages without receiving the message content, just
  the properties and headers.

- A way to republish consumed messages without having to re-send the
  message content to the server.

An with these features, implementing a general and efficient message
scheduler based on timer wheels would be fairly simple.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Fri Oct  1 12:53:37 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 01 Oct 2010 12:53:37 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com> (David Wragg's message
	of "Fri, 01 Oct 2010 12:51:35 +0100")
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
Message-ID: <yrv4cr5gagmda.fsf@dwragg.eng.vmware.com>

David Wragg <david at rabbitmq.com> writes:
> This (any many other) AMQP intermiediaries would be assisted by:

By "intermediaries" (when I can spell it), I mean AMQP clients that
shuffle messages around, rather than publishing or consuming for their
own ends.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From mikeb at rabbitmq.com  Fri Oct  1 13:45:46 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 01 Oct 2010 13:45:46 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>	<4CA5BFAD.2040705@rabbitmq.com>
	<4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
Message-ID: <4CA5D7FA.8030504@rabbitmq.com>

>> Another solution, which you can implement right now, is to get the
>> publishers to stick an expiry header into the message and to publish
>> the message to a dedicated delay queue. A helper app consumes messages
>> from that queue one at a time and checks the expiry. If the expiry is
>> in the past it re-publishes the message to the appropriate exchange
>> for routing. Otherwise it waits until the deadline.
> 
> This (any many other) AMQP intermiediaries would be assisted by:
> 
> - A way to consume messages without receiving the message content, just
>   the properties and headers.
> 
> - A way to republish consumed messages without having to re-send the
>   message content to the server.
> 
> An with these features, implementing a general and efficient message
> scheduler based on timer wheels would be fairly simple.

Interesting thought; like a basic.head (just the headers please) and 
basic.redirect (please dequeue this and publish it again).  The latter 
could work with (unacked) messages acquired through basic.consume or 
basic.get, too.

In the case of plugins, using a direct connection is effectively the 
same thing, by the way.

mkb

From matthew at rabbitmq.com  Fri Oct  1 14:00:50 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 14:00:50 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <4CA5D7FA.8030504@rabbitmq.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
	<4CA5D7FA.8030504@rabbitmq.com>
Message-ID: <20101001130050.GC20604@rabbitmq.com>

On Fri, Oct 01, 2010 at 01:45:46PM +0100, Michael Bridgen wrote:
> In the case of plugins, using a direct connection is effectively the
> same thing, by the way.

No it's not. The msg may be fully on disk and not in RAM, at which point
you have to issue a disk read regardless of whether the client is
embedded or not.

Furthermore, we do not store the message headers separately from the msg
body. Thus the only thing you're saving by getting one, not the other,
is network transfer. And given the average message body size, ethernet
frame size and the fact that we turn nagel off, I'm not convinced in the
average case you'd actually save anything at all, but I could be missing
something.

Matthew

From matthew at rabbitmq.com  Fri Oct  1 14:07:01 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 14:07:01 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <20101001130050.GC20604@rabbitmq.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
	<4CA5D7FA.8030504@rabbitmq.com>
	<20101001130050.GC20604@rabbitmq.com>
Message-ID: <20101001130701.GE20604@rabbitmq.com>

On Fri, Oct 01, 2010 at 02:00:50PM +0100, Matthew Sackman wrote:
> On Fri, Oct 01, 2010 at 01:45:46PM +0100, Michael Bridgen wrote:
> > In the case of plugins, using a direct connection is effectively the
> > same thing, by the way.
> 
> No it's not.

Well, it's not if the goal is to avoid unnecessary disk access. It is if
the goal is to avoid unnecessary TCP stack usage.

Matthew

From jon.brisbin at npcinternational.com  Fri Oct  1 14:11:44 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 1 Oct 2010 08:11:44 -0500
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
Message-ID: <A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>

I had not really looked at the spring integration stuff for a solution. It looks interesting, though.

Thanks for the link...

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Sep 30, 2010, at 4:19 PM, Shane Witbeck wrote:

> Have you thought about using an Aggregator? Spring Integration offers this: 
> 
> http://static.springsource.org/spring-integration/reference/htmlsingle/spring-integration-reference.html#aggregator
> 
> I think Apache Camel offers this too. Both might be overkill in your case but maybe a look at how they're doing it will help.
> 
> HTH,
> Shane
> 
> 
> On Thu, Sep 30, 2010 at 4:41 PM, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
> I've got a pest of a sticky wicket in my map/reduce implementation that's using Groovy for the logic and RabbitMQ for the plumbing. It's frustrating because I'm so close.
> 
> The problem I'm having is knowing when I'm finished. Using data like this:
> 
> 1
> 2
> 3
> 4
> 5
> 6
> 7
> 8
> 9
> 10
> END
> 
> The "END" goes through a separate consumer thread because it goes out on a fanout exchange (it has to go to all workers), so it comes in out-of-order from the other data:
> 
> 1    2    3
>           END
> 4    5    6
> END  END  
> 7    8    9
> ...etc...
> 
> I can sort of work around this by keeping track of id changes in my consumers using the classic "if this.id != last.id" approach. But the last record is a tricky one because there's no key change event to trigger sending the response back. Unless I simply wait until a timeout has occurred, I'm not sure how I can tell when I've collected all the responses I'm going to get.
> 
> The problem is that I only know how many message I've sent and not how many to expect in return. emit() can be called multiple times from a map phase and the reduce phase can take (records per key) * (emitted) and either rereduce the result or reply back to the requestor. The requestor shouldn't know whether the result has been rereduced or not. It should simply process the return values.
> 
> What am I missing to handle situations like this? Should I introduce another component to this that keeps track of how many messages are sent and received? Maybe put a ZooKeeper install in somewhere and coordinate all this? I've already got Riak integrated, though I'd think ZooKeeper would be better at managing concurrent updates.
> 
> Any help or suggestions here would be greatly appreciated! :)
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> -Shane

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/5e0578c0/attachment-0001.htm>

From jon.brisbin at npcinternational.com  Fri Oct  1 14:34:41 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 1 Oct 2010 08:34:41 -0500
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
	<A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>
Message-ID: <5E91BB01-C950-46EC-B7AA-F086F6354603@npcinternational.com>

I'm also wondering if anyone uses counts to determine when a job is finished or not. By that I mean, increment a counter for every outgoing message and decrement the counter when a response is received. In the case of a map/reduce job, I'd need to do something like:

SQL -> Map phase = +1 (per row)
Map phase -> Reduce phase = -1 (that we got the original msg) +1 * (num of emit's)
Reduce phase -> Response|ReReduce = -1 (for emit's) +1 (for response/rereduce)
[ReReduce -> Response] = -1 +1 (for sending response)
Response = -1

Essentially, each step would decrement a counter for the incoming message and increment the counter for the outgoing message. A reduce phase might decrement the counter 1000 times and increment it once. But since the map phase incremented it 1000 times prior, the count after map/reduce would be "1". The response listener would then decrement the counter when it processed the response, see that it's now zero, and know to continue.

If my goal is to beat processing times on the AS/400 when doing large financial calculations (daily acct'g reports take several hours to generate), I can't really depend on timeouts to make sure I've gathered all my results. I want the job to return as soon as results are ready. I'd like to go to management and show them a 2 hr -> 15 min improvement by using parallel processing.

I'm just wondering if using ZooKeeper or similar to do distributed, synchronized counters will have enough atomicity to not miss a count incr/decr. If I miss even one, I'm screwed because it'll never get back to zero (or get there prematurely).

I need a sentence with a question mark or this will definitely go unanswered: are message counters like this a good way to monitor asynchronous, distributed processing state?

Thanks! :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



On Oct 1, 2010, at 8:11 AM, Jon Brisbin wrote:

> I had not really looked at the spring integration stuff for a solution. It looks interesting, though.
> 
> Thanks for the link...
> 
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
> 
> 
> 
> On Sep 30, 2010, at 4:19 PM, Shane Witbeck wrote:
> 
>> Have you thought about using an Aggregator? Spring Integration offers this: 
>> 
>> http://static.springsource.org/spring-integration/reference/htmlsingle/spring-integration-reference.html#aggregator
>> 
>> I think Apache Camel offers this too. Both might be overkill in your case but maybe a look at how they're doing it will help.
>> 
>> HTH,
>> Shane
>> 
>> 
>> On Thu, Sep 30, 2010 at 4:41 PM, Jon Brisbin <jon.brisbin at npcinternational.com> wrote:
>> I've got a pest of a sticky wicket in my map/reduce implementation that's using Groovy for the logic and RabbitMQ for the plumbing. It's frustrating because I'm so close.
>> 
>> The problem I'm having is knowing when I'm finished. Using data like this:
>> 
>> 1
>> 2
>> 3
>> 4
>> 5
>> 6
>> 7
>> 8
>> 9
>> 10
>> END
>> 
>> The "END" goes through a separate consumer thread because it goes out on a fanout exchange (it has to go to all workers), so it comes in out-of-order from the other data:
>> 
>> 1    2    3
>>           END
>> 4    5    6
>> END  END  
>> 7    8    9
>> ...etc...
>> 
>> I can sort of work around this by keeping track of id changes in my consumers using the classic "if this.id != last.id" approach. But the last record is a tricky one because there's no key change event to trigger sending the response back. Unless I simply wait until a timeout has occurred, I'm not sure how I can tell when I've collected all the responses I'm going to get.
>> 
>> The problem is that I only know how many message I've sent and not how many to expect in return. emit() can be called multiple times from a map phase and the reduce phase can take (records per key) * (emitted) and either rereduce the result or reply back to the requestor. The requestor shouldn't know whether the result has been rereduced or not. It should simply process the return values.
>> 
>> What am I missing to handle situations like this? Should I introduce another component to this that keeps track of how many messages are sent and received? Maybe put a ZooKeeper install in somewhere and coordinate all this? I've already got Riak integrated, though I'd think ZooKeeper would be better at managing concurrent updates.
>> 
>> Any help or suggestions here would be greatly appreciated! :)
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> 
>> -- 
>> -Shane
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/831a0347/attachment.htm>

From david at rabbitmq.com  Fri Oct  1 14:46:05 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 01 Oct 2010 14:46:05 +0100
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <20101001130050.GC20604@rabbitmq.com> (Matthew Sackman's message
	of "Fri, 1 Oct 2010 14:00:50 +0100")
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
	<4CA5D7FA.8030504@rabbitmq.com> <20101001130050.GC20604@rabbitmq.com>
Message-ID: <yrv4ck4m2gh5u.fsf@dwragg.eng.vmware.com>

Matthew Sackman <matthew at rabbitmq.com> writes:
> On Fri, Oct 01, 2010 at 01:45:46PM +0100, Michael Bridgen wrote:
>> In the case of plugins, using a direct connection is effectively the
>> same thing, by the way.
>
> No it's not. The msg may be fully on disk and not in RAM, at which point
> you have to issue a disk read regardless of whether the client is
> embedded or not.
>
> Furthermore, we do not store the message headers separately from the msg
> body. Thus the only thing you're saving by getting one, not the other,
> is network transfer. And given the average message body size, ethernet
> frame size and the fact that we turn nagel off, I'm not convinced in the
> average case you'd actually save anything at all, but I could be missing
> something.

We'd get the network traffic saving immediately.  And if worthwhile,
later on we could store message bodies separately, above a certain size
threshold.  At the moment there is no motivation to consider doing that,
because AMQP always transmits the properties and body together.

And I doubt there is a meaningful notion of the average message body
size.  Different AMQP applications have different characteristics.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vbarat at ubikod.com  Fri Oct  1 14:46:29 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Fri, 01 Oct 2010 15:46:29 +0200
Subject: [rabbitmq-discuss] How to use more than 4GB of RAM ?
In-Reply-To: <AANLkTin_9v-fe8W4KOge01Hi+0EihcZE=cPjZqt=VUe_@mail.gmail.com>
References: <4CA490FD.6090009@ubikod.com>
	<AANLkTin_9v-fe8W4KOge01Hi+0EihcZE=cPjZqt=VUe_@mail.gmail.com>
Message-ID: <4CA5E635.2020000@ubikod.com>

  Thanks for the reply.

Is there some well known incompatibilities on client side (I mean 
different APIs or behavior between 1.7.2 and 2.0.0) ?

Le 30/09/10 15:35, Marek Majkowski a ?crit :
> On Thu, Sep 30, 2010 at 14:30, Vincent Barat<vbarat at ubikod.com>  wrote:
>> I run RabbitMQ 1.7.2 on a 8GB RAM 64bits machine.
>>
>> When the RabbitMQ process reach a 4GB limit of heap size, it crashes.
>> Do you know if it is a limitation of the RabbitMQ server or Erlang VM itself
>> ?
>> Is there a workarround ?
> On releases pre 2.0.0 there is a limit of 4GB persistent messages in one queue.
> If you're using many persistent(durable) messages in a single queue please:
>   - upgrade to at least 2.0.0
>   - split your one huge queue into many smaller and make sure that you
>     never reach 4GB/queue limit.
>
> Cheers,
>    Marek
>

From adam at varud.com  Fri Oct  1 14:48:58 2010
From: adam at varud.com (Adam Nelson)
Date: Fri, 1 Oct 2010 09:48:58 -0400
Subject: [rabbitmq-discuss] use of an NFS for broker failover
In-Reply-To: <AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>
References: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>
	<AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>
Message-ID: <AANLkTint4196CJkjib6GnS2qkfQSZw-duoyiOc0tHbN_@mail.gmail.com>

>
> > What else should I be considering to achieve failover?
>
> That sounds good. NFS may not be the best tool for this job, but
> it might just work. Do make sure that at no point two Rabbits
> are using the same data. You may also find the "reconnect"
> bit hard, how will your clients know which Rabbit to connect to?
>
> Have you looked at our Pacemaker tutorial?
> http://www.rabbitmq.com/pacemaker.html
>
>
I agree with Marek.  NFS seems like it will introduce more problems than it
solves.  Maybe things have changed since I last dealt with it, but NFS is
much more about shared file access than application level redundant storage.

-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/51e900a2/attachment.htm>

From alexis at rabbitmq.com  Fri Oct  1 14:51:42 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 1 Oct 2010 14:51:42 +0100
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <5E91BB01-C950-46EC-B7AA-F086F6354603@npcinternational.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
	<A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>
	<5E91BB01-C950-46EC-B7AA-F086F6354603@npcinternational.com>
Message-ID: <AANLkTikNdqbcxvYOGZJsxOvc4c5ObYFvm+i15htDXQhi@mail.gmail.com>

Why can't you use a checksum instead? Each time you create a set of n
subtasks from some task T, attach a fraction m/n to each subtask where m is
the fraction attached to T. Start with m equals 1. The sum of the fractions
will always be 1. No need for shared counters...

On Oct 1, 2010 3:35 PM, "Jon Brisbin" <jon.brisbin at npcinternational.com>
wrote:

I'm also wondering if anyone uses counts to determine when a job is finished
or not. By that I mean, increment a counter for every outgoing message and
decrement the counter when a response is received. In the case of a
map/reduce job, I'd need to do something like:

SQL -> Map phase = +1 (per row)
Map phase -> Reduce phase = -1 (that we got the original msg) +1 * (num of
emit's)
Reduce phase -> Response|ReReduce = -1 (for emit's) +1 (for
response/rereduce)
[ReReduce -> Response] = -1 +1 (for sending response)
Response = -1

Essentially, each step would decrement a counter for the incoming message
and increment the counter for the outgoing message. A reduce phase might
decrement the counter 1000 times and increment it once. But since the map
phase incremented it 1000 times prior, the count after map/reduce would be
"1". The response listener would then decrement the counter when it
processed the response, see that it's now zero, and know to continue.

If my goal is to beat processing times on the AS/400 when doing large
financial calculations (daily acct'g reports take several hours to
generate), I can't really depend on timeouts to make sure I've gathered all
my results. I want the job to return as soon as results are ready. I'd like
to go to management and show them a 2 hr -> 15 min improvement by using
parallel processing.

I'm just wondering if using ZooKeeper or similar to do distributed,
synchronized counters will have enough atomicity to not miss a count
incr/decr. If I miss even one, I'm screwed because it'll never get back to
zero (or get there prematurely).

I need a sentence with a question mark or this will definitely go
unanswered: are message counters like this a good way to monitor
asynchronous, distributed processing state?

Thanks! :)

Jon Brisbin Portal Webmaster NPC International, Inc.

On Oct 1, 2010, at 8:11 AM, Jon Brisbin wrote: > I had not really looked at
the spring integration ...

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/f8d07728/attachment-0001.htm>

From majek04 at gmail.com  Fri Oct  1 14:53:39 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 14:53:39 +0100
Subject: [rabbitmq-discuss] How to use more than 4GB of RAM ?
In-Reply-To: <4CA5E635.2020000@ubikod.com>
References: <4CA490FD.6090009@ubikod.com>
	<AANLkTin_9v-fe8W4KOge01Hi+0EihcZE=cPjZqt=VUe_@mail.gmail.com>
	<4CA5E635.2020000@ubikod.com>
Message-ID: <AANLkTi=RekGpm4hm2JNmEusKKzdknnoWc00knN4=8AXm@mail.gmail.com>

On Fri, Oct 1, 2010 at 14:46, Vincent Barat <vbarat at ubikod.com> wrote:
> ?Thanks for the reply.
>
> Is there some well known incompatibilities on client side (I mean different
> APIs or behavior between 1.7.2 and 2.0.0) ?

Two main changes are:
 - we migrated from AMQP 0-8 to AMQP 0-9-1, that has some implications
   on client apis, though minor if I remember correctly
 - we don't send channel.flow any more and instead we block the connection
   on tcp layer when we run out of memory

Cheers,
  Marek

From matthew at rabbitmq.com  Fri Oct  1 14:57:49 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 14:57:49 +0100
Subject: [rabbitmq-discuss] use of an NFS for broker failover
In-Reply-To: <AANLkTint4196CJkjib6GnS2qkfQSZw-duoyiOc0tHbN_@mail.gmail.com>
References: <f6119e26-c5a4-4f7a-b210-ff0c386b1653@n3g2000yqb.googlegroups.com>
	<AANLkTinLdHZj34QO-XGnftDhKrTN8zto2rx_ENzPQqsU@mail.gmail.com>
	<AANLkTint4196CJkjib6GnS2qkfQSZw-duoyiOc0tHbN_@mail.gmail.com>
Message-ID: <20101001135748.GG20604@rabbitmq.com>

On Fri, Oct 01, 2010 at 09:48:58AM -0400, Adam Nelson wrote:
> > > What else should I be considering to achieve failover?
> >
> > That sounds good. NFS may not be the best tool for this job, but
> > it might just work. Do make sure that at no point two Rabbits
> > are using the same data. You may also find the "reconnect"
> > bit hard, how will your clients know which Rabbit to connect to?

Sticking a load balancer in front is one idea, mobile IPs is another
idea. Heck, pacemaker can even move NIC MACs between different machines
if you want to continue to use DHCP. Even DNS round robin will work -
the client just needs to keep on trying until it gets a connection
again.

> I agree with Marek.  NFS seems like it will introduce more problems than it
> solves.

Most SANs or NASs which export filesystems rather than block-level
storage support NFS or CIFS. The former is much simpler and more
battle tested. NFS is a perfectly good solution provided you ensure that
you don't have both Rabbits trying to access the store at the same time
(as they'll stomp over each other's files and then get very upset and
angry with each other).

Matthew

From jon at jbrisbin.com  Fri Oct  1 15:04:09 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 1 Oct 2010 09:04:09 -0500
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <AANLkTikNdqbcxvYOGZJsxOvc4c5ObYFvm+i15htDXQhi@mail.gmail.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
	<A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>
	<5E91BB01-C950-46EC-B7AA-F086F6354603@npcinternational.com>
	<AANLkTikNdqbcxvYOGZJsxOvc4c5ObYFvm+i15htDXQhi@mail.gmail.com>
Message-ID: <A1AB686A-4260-40EA-BDC5-C7D23B48754E@jbrisbin.com>

On Oct 1, 2010, at 8:51 AM, Alexis Richardson wrote:

> Why can't you use a checksum instead? Each time you create a set of n subtasks from some task T, attach a fraction m/n to each subtask where m is the fraction attached to T. Start with m equals 1. The sum of the fractions will always be 1. No need for shared counters...
> 

Wouldn't I have to know how many subtasks I'll create total when the first subtask goes out? I don't know that in this case. 

Could you give me an example of what you're thinking?

jb

> 
>> On Oct 1, 2010 3:35 PM, "Jon Brisbin" <jon.brisbin at npcinternational.com> wrote:
>> 
>> I'm also wondering if anyone uses counts to determine when a job is finished or not. By that I mean, increment a counter for every outgoing message and decrement the counter when a response is received. In the case of a map/reduce job, I'd need to do something like:
>> 
>> SQL -> Map phase = +1 (per row)
>> Map phase -> Reduce phase = -1 (that we got the original msg) +1 * (num of emit's)
>> Reduce phase -> Response|ReReduce = -1 (for emit's) +1 (for response/rereduce)
>> [ReReduce -> Response] = -1 +1 (for sending response)
>> Response = -1
>> 
>> Essentially, each step would decrement a counter for the incoming message and increment the counter for the outgoing message. A reduce phase might decrement the counter 1000 times and increment it once. But since the map phase incremented it 1000 times prior, the count after map/reduce would be "1". The response listener would then decrement the counter when it processed the response, see that it's now zero, and know to continue.
>> 
>> If my goal is to beat processing times on the AS/400 when doing large financial calculations (daily acct'g reports take several hours to generate), I can't really depend on timeouts to make sure I've gathered all my results. I want the job to return as soon as results are ready. I'd like to go to management and show them a 2 hr -> 15 min improvement by using parallel processing.
>> 
>> I'm just wondering if using ZooKeeper or similar to do distributed, synchronized counters will have enough atomicity to not miss a count incr/decr. If I miss even one, I'm screwed because it'll never get back to zero (or get there prematurely).
>> 
>> I need a sentence with a question mark or this will definitely go unanswered: are message counters like this a good way to monitor asynchronous, distributed processing state?
>> 
>> Thanks! :)
>> Jon Brisbin Portal Webmaster NPC International, Inc.
>> 
>> On Oct 1, 2010, at 8:11 AM, Jon Brisbin wrote: > I had not really looked at the spring integration ...
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/ab90f1df/attachment.htm>

From jon at jbrisbin.com  Fri Oct  1 15:21:18 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 1 Oct 2010 09:21:18 -0500
Subject: [rabbitmq-discuss] Schedule Messages
In-Reply-To: <yrv4ck4m2gh5u.fsf@dwragg.eng.vmware.com>
References: <5BB7251A7DC8094B8024D868E77E139818B4FB3384@34093-MBX-C03.mex07a.mlsrvr.com>
	<f7464c21-552e-4d83-adec-ed85577270f3@30g2000yqm.googlegroups.com>
	<4CA5BFAD.2040705@rabbitmq.com> <4CA5C576.6080709@rabbitmq.com>
	<yrv4cvd5mgmgo.fsf@dwragg.eng.vmware.com>
	<4CA5D7FA.8030504@rabbitmq.com>
	<20101001130050.GC20604@rabbitmq.com>
	<yrv4ck4m2gh5u.fsf@dwragg.eng.vmware.com>
Message-ID: <885693B0-5C4A-4642-B466-FA0D986C18CE@jbrisbin.com>

Sorry to hijack the discussion here, but I'm ++1 on a head-style query of messages in a queue. I can think of several places right off where I could use this.

And I would be careful lumping all AMQP applications into a single bucket when it comes to message size. I would not write an application that interrogated the properties/headers of my batch file processor because it's sending zip files as message bodies but I would if I could get just the props/headers without the body. 

I also have applications that send a key value as the message body; maybe a few bytes in size. It just depends.

jb


On Oct 1, 2010, at 8:46 AM, David Wragg wrote:

> Matthew Sackman <matthew at rabbitmq.com> writes:
>> On Fri, Oct 01, 2010 at 01:45:46PM +0100, Michael Bridgen wrote:
>>> In the case of plugins, using a direct connection is effectively the
>>> same thing, by the way.
>> 
>> No it's not. The msg may be fully on disk and not in RAM, at which point
>> you have to issue a disk read regardless of whether the client is
>> embedded or not.
>> 
>> Furthermore, we do not store the message headers separately from the msg
>> body. Thus the only thing you're saving by getting one, not the other,
>> is network transfer. And given the average message body size, ethernet
>> frame size and the fact that we turn nagel off, I'm not convinced in the
>> average case you'd actually save anything at all, but I could be missing
>> something.
> 
> We'd get the network traffic saving immediately.  And if worthwhile,
> later on we could store message bodies separately, above a certain size
> threshold.  At the moment there is no motivation to consider doing that,
> because AMQP always transmits the properties and body together.
> 
> And I doubt there is a meaningful notion of the average message body
> size.  Different AMQP applications have different characteristics.
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/e45b971f/attachment-0001.htm>

From majek04 at gmail.com  Fri Oct  1 15:31:03 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 15:31:03 +0100
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
Message-ID: <AANLkTin=t7zWOaME6uORk7yBzbwamZCgqFRUoC_Lq98J@mail.gmail.com>

On Thu, Sep 30, 2010 at 21:41, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
> I've got a pest of a sticky wicket in my map/reduce implementation that's
> using Groovy for the logic and RabbitMQ for the plumbing. It's frustrating
> because I'm so close.
> The problem I'm having is knowing when I'm finished. Using data like this:
> 1
> 2
> 3
> 4
> 5
> 6
> 7
> 8
> 9
> 10
> END
> The "END" goes through a separate consumer thread because it goes out on a
> fanout exchange (it has to go to all workers), so it comes in out-of-order
> from the other data:
> 1 ? ?2 ? ?3
> ?? ? ? ? ?END
> 4 ? ?5 ? ?6
> END ?END
> 7 ? ?8 ? ?9
> ...etc...
> I can sort of work around this by keeping track of id changes in my
> consumers using the classic "if this.id != last.id" approach. But the last
> record is a tricky one because there's no key change event to trigger
> sending the response back. Unless I simply wait until a timeout has
> occurred, I'm not sure how I can tell when I've collected all the responses
> I'm going to get.


Interesting problem. If you're using a single queue to handle tasks, you can
never be sure that all the tasks have been done. Well, there always can be
a hanged consumer that got one task and never had done it fully!

The simplest approach would be to keep a timeout. If you haven't received
a message in some time - your worker is ready to quit. But that's wrong -
it won't handle the 'hanged worker' situation.

So before exiting the last 'behaving' worker we should make sure that there
are no other 'misbehaving' workers left. The simplest way to know if we're
the last broker is by doing "queue.declare" and looking at the consumer
count for that particular queue. If it's more than one - we're not the last
consumer.

The trick is how to know if the consumers that are left alone are 'behaving'
or not and how to avoid race condition - many workers quitting in exactly
the same moment.

I'd solve it by sending a message 'QUIT' to the queue once we're sure
that no other work is left in the queue. A worker that receives that
QUIT message may think - okay, there is at least one more 'behaving'
worker, I can't see any work to do, he also can't see any more work,
one of us can happily go home.

That approach works fine until a worker receives it's own message.
If that happens that might mean:
 - we're the only left 'behaving' consumer
 - we have a bad luck and the message always gets randomly dispatched
to ourselves.

In the first case, if we're the only one 'behaving' consumer and if
'queue.declare' doesn't claim any left misbehaving consumers, we may
happily quit.

I hope I answered the right question.

Cheers,
  Marek Majkowski

From rob at rabbitmq.com  Fri Oct  1 15:35:07 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 1 Oct 2010 15:35:07 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
Message-ID: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>

All,

Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway. 

This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.

Regards,

Rob

DESIGN.md
----------------------
# STOMP Adapter Enhancements

This document outlines proposed changes to the way in which the STOMP adapter handles destinations and routing.

IMPORTANT: Support for all existing custom headers will be removed. 

## Destinations 

In the current STOMP adapter, much of the destination configuration is handled by custom headers, including `routing_key` and `exchange`. 

This design proposes to remove the custom headers, and use only the `destination` header with compound values that define the exchange, routing key and queue names.

### Standard AMQP Destinations

Any exchange/queue or exchange/routing key combination can be accessed using destinations prefixed with `/exchange`.

For `SUBSCRIBE` frames, a destination of the form `/exchange/<name>[/<pattern>]` can be used. This destination will:

1. Create an anonymous, auto-delete queue on `<name>` exchange.
2. If `<pattern>` is supplied, bind the queue to `<name>` exchange using `<pattern>`
3. Register a subscription against the queue, for the current STOMP session

For `SEND` frames, a destination of the form `/exchange/<name>[/<routing-key>]` can be used. This destination will:

1. Send to exchange `<name>`with the routing key `<routing-key>`

### Queue Destinations

For simple queue destinations with round-robin delivery semantics, destinations of the form `/queue/<name>` can be used.

For both `SEND` and `SUBSCRIBE` frames, these destinations will create the queue `<name>` and bind it to the `amq.direct` exchange with routing key `<name>`.

For `SEND` frames, the message will be sent to the `amq.direct` exchange with the routing key `<name>`. For `SUBSCRIBE` frames, a subscription against the queue `<name>` will be created for the current STOMP session.

Given that both `SEND` and `SUBSCRIBE` frames cause the queue to be created, the ordering constraint, client codes doesn't need to worry about creating a subscription before sending messages. Furthermore, the created queues are set to `auto-delete=false` so they will last until they are deleted by the user. 

### Topic Destinations

For simple topic destinations which deliver a copy of each message to all active subscribers, destinations of the form `/topic/<name>` can be used.

For `SEND` frames, the message will be sent to the `amq.topic` exchange with the routing key `<name>`. 

For `SUBSCRIBE` frames, an exclusive queue will be created and bound to the `amq.topic` exchange with routing key `<name>`. A subscription will be created against the exclusive queue.


From majek04 at gmail.com  Fri Oct  1 15:40:22 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 15:40:22 +0100
Subject: [rabbitmq-discuss] multiple threads in one queue
In-Reply-To: <AANLkTi=2ZWrjY_WHhCx9+ASFfDYGmdfj8L5eV26XFLP=@mail.gmail.com>
References: <AANLkTi=2ZWrjY_WHhCx9+ASFfDYGmdfj8L5eV26XFLP=@mail.gmail.com>
Message-ID: <AANLkTimSKf57xofiSNoeO=U2sqOapSrpjr4GwKu4Dp5b@mail.gmail.com>

On Fri, Sep 24, 2010 at 12:35, Isa?as <mcallus at gmail.com> wrote:
> In this moment, I have an unique channel and consumer in a main thread, it
> consume the queue and save the content in a normal java queue.
>
> The sons threads get the tasks from java queue, i want know how can I send
> one delay ack because my main thread can not follow consuming the rabbit
> queue if i does not send the ack inmediately.
>
> When the task finishs correctly in a son thread, it saves the task in a
> second queue that main thread read and send the ack for this task to
> eliminate the task from rabbit queue.
>
> Is it possible this??

So you pop messages from RabbitMQ queue and push it into a shared
data structure in Java. Java threads than pop messages from that
shared queue, do the work, and push a new message (ack) onto
another shared queue.

Main thread is responsible for receiving tasks from RabbitMQ and
popping acks from second shared queue and acknowledging them.

- yes, that sounds correct. Though, in my opinion you'll have issues
with the second bit - it's hard (impossible?) to wait both on RabbitMQ
events and on events from shared java queue.

Instead, I propose to send acknowledgments directly from your worker
threads. If I remember correctly, acks are thread-safe and can be
called from every thread.

> or is it better that i have one syncronize channel and
> one syncronize consumer and that all threads consume the rabbit queue?

It might be simpler to just have one AMQP connection for every
worker thread. Why not?

Cheers,
   Marek

From andrius.norkaitis at oryo.lt  Fri Oct  1 15:42:31 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 1 Oct 2010 17:42:31 +0300
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <4C7E49EC.3090501@rabbitmq.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>	<AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAJQQ2PBVBzpCs/OnVIcmCE8BAAAAAA==@oryo.lt>
	<4C7E49EC.3090501@rabbitmq.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADq4lf2NYwJEm1ERxj4x1s0BAAAAAA==@oryo.lt>

Big thanks Emile for her overview. It's sad as I really hoped to find easier
solution for mobile devices and still haven't found any... I have not so
much experience with amqp or Compact framework as it would be worth to me to
experiment trying it make changes in source code of rabbit client to work in
Compact framework. :(

Do anybody knows/tried any other solution for guarantied push messaging that
would work in Windows Mobile / Embedded (preferred with .NET Compact
framework) devices?
My minimum requirement is to have client which could subscribe to queue and
get guaranteed push messages.

Thank you,
Andrius

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Wednesday, September 01, 2010 3:41 PM
To: Andrius Norkaitis
Cc: 'Alexis Richardson'; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] AMQP on Windows CE


Hi Andrius,

I've tried to get an overview of how hard it would be to get the RabbitMQ
.NET client to compile using only the Compact Framework library. Here are
some of the hurdles:

---
SSL-related classes, methods and parameters in AmqpTcpEndpoint don't exist

A few exceptions assume members that don't exist in the CF

AppDomain uploading and use of reflection in ConnectionBase will need to be
removed

Buffered streaming (in SocketFrameHandler) doesn't exist

ConfigurationSettings in Protocols is missing

UTF8 encoding and decoding in WireFormatting will need to be done
differently

Threading primitives in SharedQueue don't exist.
---

I get the sense that porting the .NET client to Compact Framework is not
impossible, but not a trivial undertaking. I'm not aware of anyone else
having attempted this.

Regards

Emile




On 28/08/10 00:20, Andrius Norkaitis wrote:
> Last time I tried using Rabbit .NET client in Windows Mobile/CE, some 
> .NET function which was used was missing in .NET Compact.
> Maybe somebody has some ideas and want to look for solution? I'm not 
> very familiar with source code of Rabbit .NET client, but I would be 
> glad to help.
> Bringing RabbitMQ to mobile platforms would open so much possibilities...
> 
> Best,
> Andrius Norkaitis
> 
> 
> -----Original Message-----
> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] 
> On Behalf Of Alexis Richardson
> Sent: Friday, August 27, 2010 9:20 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
> 
> Andrius
> 
> I checked the archives and afaict only you have spoken up on this in 
> the past!
> 
> Do you know why the .NET client might not work on WinCE?
> 
> alexis
> 
> 
> On Fri, Aug 27, 2010 at 6:17 PM, Andrius Norkaitis 
> <andrius.norkaitis at oryo.lt> wrote:
>> We're using Microsoft .NET. As I know RabbitMQ .NET Client is not 
>> directly compatible with Microsoft .NET Compact Framework, isn't it?.
>> My question is maybe somebody ported it to work on .NET Compact or 
>> has experience by using other client with interop.
>>
>> Best,
>> Andrius Norkaitis
>>
>>
>> -----Original Message-----
>> From: David Wragg [mailto:david at rabbitmq.com]
>> Sent: Friday, August 27, 2010 6:38 PM
>> To: Andrius Norkaitis
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>>
>> Hi Andrius,
>>
>> "Andrius Norkaitis" <andrius.norkaitis at oryo.lt> writes:
>>> I would like to know if someone already use or did the source code 
>>> port of AMQP client API to run on Windows CE operating system ?
>>
>> What programming language/platform are you using to develop your 
>> Windows CE applications?
>>
>> (Forgive me if there is an obvious answer to this question; I'm not 
>> very familiar with WinCE.)
>>
>> David
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware


From jon at jbrisbin.com  Fri Oct  1 15:42:37 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 1 Oct 2010 09:42:37 -0500
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <AANLkTin=t7zWOaME6uORk7yBzbwamZCgqFRUoC_Lq98J@mail.gmail.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTin=t7zWOaME6uORk7yBzbwamZCgqFRUoC_Lq98J@mail.gmail.com>
Message-ID: <61DB8569-7375-4977-8951-5C0496C1094F@jbrisbin.com>


On Oct 1, 2010, at 9:31 AM, Marek Majkowski wrote:

> I'd solve it by sending a message 'QUIT' to the queue once we're sure
> that no other work is left in the queue. A worker that receives that
> QUIT message may think - okay, there is at least one more 'behaving'
> worker, I can't see any work to do, he also can't see any more work,
> one of us can happily go home.


This is an interesting approach. I was handling the QUIT message when I received it rather than spooling off into a separate thread a "watcher" that only did the clean up after it saw that no more work needed to be done.

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/e8f11376/attachment-0001.htm>

From majek04 at gmail.com  Fri Oct  1 16:06:58 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 16:06:58 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
Message-ID: <AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>

On Fri, Oct 1, 2010 at 15:35, Rob Harrop <rob at rabbitmq.com> wrote:
> Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway.
>
> This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.
> `/exchange/<name>[/<pattern>]`
> `/exchange/<name>[/<routing-key>]`
> `/queue/<name>`
> `/topic/<name>`

I like that very much!

Just for the comparison, have you looked at other STOMP
implementations? (I haven't.) How do others address resources
using STOMP?

Cheers,
  Marek Majkowski

From alexis at rabbitmq.com  Fri Oct  1 16:20:28 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 1 Oct 2010 16:20:28 +0100
Subject: [rabbitmq-discuss] last sticky wicket on map/reduce
In-Reply-To: <A1AB686A-4260-40EA-BDC5-C7D23B48754E@jbrisbin.com>
References: <61B2CAFD-202F-4374-8F65-D6F8EC3C4D85@npcinternational.com>
	<AANLkTinuWjOBGAM5=DCNCWtO4eSFnm-wCbK+O2BDshoj@mail.gmail.com>
	<A4BB3C20-05F3-4EB6-A785-9B94F5EF4ECF@npcinternational.com>
	<5E91BB01-C950-46EC-B7AA-F086F6354603@npcinternational.com>
	<AANLkTikNdqbcxvYOGZJsxOvc4c5ObYFvm+i15htDXQhi@mail.gmail.com>
	<A1AB686A-4260-40EA-BDC5-C7D23B48754E@jbrisbin.com>
Message-ID: <AANLkTikELDEKNshVFbFYv8JQ0bUQsz8Phjt7AKHeqDn_@mail.gmail.com>

You would only need to know the number of subtasks at each stage. You would
not need to know the total number of subtasks that would be created during
the whole run.

Example... start job, make 10 subtasks, give a weight of 0.1. The total
weight is 1. Now suppose one subtask comes back and needs to be split into 4
subtasks. Give each of those weight 0.025. The grand total is still 1;
indeed it is invariant

On Oct 1, 2010 4:04 PM, "Jon Brisbin" <jon at jbrisbin.com> wrote:

On Oct 1, 2010, at 8:51 AM, Alexis Richardson wrote: > Why can't you use a
checksum instead? Each t...
Wouldn't I have to know how many subtasks I'll create total when the first
subtask goes out? I don't know that in this case.

Could you give me an example of what you're thinking?

jb

> >> On Oct 1, 2010 3:35 PM, "Jon Brisbin" <jon.brisbin at npcinternational.com>
wrote: >> >> I'm als...

Thanks!

J. Brisbin
http://jbrisbin.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/db470dae/attachment.htm>

From majek04 at gmail.com  Fri Oct  1 16:28:08 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Oct 2010 16:28:08 +0100
Subject: [rabbitmq-discuss] multiple threads in one queue
In-Reply-To: <AANLkTimSKf57xofiSNoeO=U2sqOapSrpjr4GwKu4Dp5b@mail.gmail.com>
References: <AANLkTi=2ZWrjY_WHhCx9+ASFfDYGmdfj8L5eV26XFLP=@mail.gmail.com>
	<AANLkTimSKf57xofiSNoeO=U2sqOapSrpjr4GwKu4Dp5b@mail.gmail.com>
Message-ID: <AANLkTikxqTXVYnF3V6J=0YyM9GUye8K8cnpxDh=fT+bB@mail.gmail.com>

On Fri, Oct 1, 2010 at 15:40, Marek Majkowski <majek04 at gmail.com> wrote:
> Instead, I propose to send acknowledgments directly from your worker
> threads. If I remember correctly, acks are thread-safe and can be
> called from every thread.

As a side note, our guide clearly says that you shouldn't touch channel
in different threads:
    http://www.rabbitmq.com/api-guide.html#channel-threads

Though, I'm pretty sure basicAck shouldn't have any issues even if
it was called from other threads. But, that's not a supported or
recommended option.

From abhishek.kona at gmail.com  Fri Oct  1 16:36:35 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 01 Oct 2010 21:06:35 +0530
Subject: [rabbitmq-discuss] AMQP on Windows CE
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADq4lf2NYwJEm1ERxj4x1s0BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAIHLscgCA3VHk8l3L4iLb80BAAAAAA==@oryo.lt>	<yrv4chbig3w28.fsf@dwragg.eng.vmware.com>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAACwv9x25VzBPtBYobneQQm4BAAAAAA==@oryo.lt>	<AANLkTimBLLghW61V2tsAFrcvxrYi=GZDO03fEScKzGbQ@mail.gmail.com>	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAJQQ2PBVBzpCs/OnVIcmCE8BAAAAAA==@oryo.lt>	<4C7E49EC.3090501@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAADq4lf2NYwJEm1ERxj4x1s0BAAAAAA==@oryo.lt>
Message-ID: <4CA60003.7090600@gmail.com>

  On Friday 01 October 2010 08:12 PM, Andrius Norkaitis wrote:
> Big thanks Emile for her overview. It's sad as I really hoped to find easier
> solution for mobile devices and still haven't found any... I have not so
> much experience with amqp or Compact framework as it would be worth to me to
> experiment trying it make changes in source code of rabbit client to work in
> Compact framework. :(
>
> Do anybody knows/tried any other solution for guarantied push messaging that
> would work in Windows Mobile / Embedded (preferred with .NET Compact
> framework) devices?
> My minimum requirement is to have client which could subscribe to queue and
> get guaranteed push messages.
>
> Thank you,
> Andrius
>
> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Wednesday, September 01, 2010 3:41 PM
> To: Andrius Norkaitis
> Cc: 'Alexis Richardson'; rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>
>
> Hi Andrius,
>
> I've tried to get an overview of how hard it would be to get the RabbitMQ
> .NET client to compile using only the Compact Framework library. Here are
> some of the hurdles:
>
> ---
> SSL-related classes, methods and parameters in AmqpTcpEndpoint don't exist
>
> A few exceptions assume members that don't exist in the CF
>
> AppDomain uploading and use of reflection in ConnectionBase will need to be
> removed
>
> Buffered streaming (in SocketFrameHandler) doesn't exist
>
> ConfigurationSettings in Protocols is missing
>
> UTF8 encoding and decoding in WireFormatting will need to be done
> differently
>
> Threading primitives in SharedQueue don't exist.
> ---
>
> I get the sense that porting the .NET client to Compact Framework is not
> impossible, but not a trivial undertaking. I'm not aware of anyone else
> having attempted this.
>
> Regards
>
> Emile
>
>
>
>
> On 28/08/10 00:20, Andrius Norkaitis wrote:
>> Last time I tried using Rabbit .NET client in Windows Mobile/CE, some
>> .NET function which was used was missing in .NET Compact.
>> Maybe somebody has some ideas and want to look for solution? I'm not
>> very familiar with source code of Rabbit .NET client, but I would be
>> glad to help.
>> Bringing RabbitMQ to mobile platforms would open so much possibilities...
>>
>> Best,
>> Andrius Norkaitis
>>
>>
>> -----Original Message-----
>> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com]
>> On Behalf Of Alexis Richardson
>> Sent: Friday, August 27, 2010 9:20 PM
>> To: Andrius Norkaitis
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>>
>> Andrius
>>
>> I checked the archives and afaict only you have spoken up on this in
>> the past!
>>
>> Do you know why the .NET client might not work on WinCE?
>>
>> alexis
>>
>>
>> On Fri, Aug 27, 2010 at 6:17 PM, Andrius Norkaitis
>> <andrius.norkaitis at oryo.lt>  wrote:
>>> We're using Microsoft .NET. As I know RabbitMQ .NET Client is not
>>> directly compatible with Microsoft .NET Compact Framework, isn't it?.
>>> My question is maybe somebody ported it to work on .NET Compact or
>>> has experience by using other client with interop.
>>>
>>> Best,
>>> Andrius Norkaitis
>>>
>>>
>>> -----Original Message-----
>>> From: David Wragg [mailto:david at rabbitmq.com]
>>> Sent: Friday, August 27, 2010 6:38 PM
>>> To: Andrius Norkaitis
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Subject: Re: [rabbitmq-discuss] AMQP on Windows CE
>>>
>>> Hi Andrius,
>>>
>>> "Andrius Norkaitis"<andrius.norkaitis at oryo.lt>  writes:
>>>> I would like to know if someone already use or did the source code
>>>> port of AMQP client API to run on Windows CE operating system ?
>>> What programming language/platform are you using to develop your
>>> Windows CE applications?
>>>
>>> (Forgive me if there is an obvious answer to this question; I'm not
>>> very familiar with WinCE.)
>>>
>>> David
>>>
>>> --
>>> David Wragg
>>> Staff Engineer, RabbitMQ
>>> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
One way would be to use ICE. They allow you to write an RPC and your 
Windows mobile can be the client. Your RPC can do necessary actions on 
the RabbitMQ server, using whatever library you want.

Abhishek Kona

From nico at nicocesar.com  Fri Oct  1 17:17:43 2010
From: nico at nicocesar.com (=?UTF-8?B?Tmljb2zDoXMgQ8Opc2Fy?=)
Date: Fri, 1 Oct 2010 13:17:43 -0300
Subject: [rabbitmq-discuss] queue_declare returning a (50,
	10) NOT_FOUND....
In-Reply-To: <4CA4318E.4020909@rabbitmq.com>
References: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
	<4CA4318E.4020909@rabbitmq.com>
Message-ID: <AANLkTi=9etZ2j=fJtdOoYtvTWBikG84NsMJ+HFpiiVDj@mail.gmail.com>

No. this is my declaration

        self.chan_in.queue_declare(queue=self.config_in['queue'],
                                   durable=True,
                                   exclusive=True,
                                   auto_delete=False)


but there is a strange issue, if I change the name... to something I havent
used, there is no problem; just like I did in
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d925b0bbaed7f86?pli=1

is there a presistent queue "namespace" table that maybe got corrupted? BTW
is one  of the few "exclusive" queues that I have. maybe a wrong consumer
connected stored somewhere?

I've solved this changing the name (just like before), so it's over for me.,

Nico C?sar
http://blog.nicocesar.com


El 30 de septiembre de 2010 03:43, Matthias Radestock <matthias at rabbitmq.com
> escribi?:

> Nicolas,
>
>
> Nicol?s C?sar wrote:
>
>> Hi i'm getting a
>>
>> (404, u"NOT_FOUND - no queue 'xxx in vhost '/'", (50, 10),
>> 'Channel.queue_declare')
>>
>
> How are you issuing the queue.declare? Do you perhaps have the 'passive'
> flag set?
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/d637d7ce/attachment-0001.htm>

From tsuraan at gmail.com  Fri Oct  1 18:11:03 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 1 Oct 2010 12:11:03 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
Message-ID: <AANLkTi=CkQFwpzXWFN_X33Uy05OjrVQPs8z+Nt=fqR=M@mail.gmail.com>

> While this is happening, the consumers are consuming from
> the queues. ?If I stop the consumers, then the hangs also stop. ?I
> also don't ever seem to get hangs when doing normal message sending
> through the exchanges that I normally use;

Ok, this bit isn't true; apparently this is happening during normal
runtime as well, so it's probably not related to the amq.direct
exchange.  It looks like any call to tx_commit is hanging, when called
from anywhere in the system.  I could really use some sort of advice
for how to debug this.  It's rabbit 2.1.0 on erlang 13.2.4 (erl
-version gives 5.7.5; I can never remember exactly how that maps to
erlang's crazy versions: 13B4 maybe?).

From matthew at rabbitmq.com  Fri Oct  1 18:19:36 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 18:19:36 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
Message-ID: <20101001171936.GP20604@rabbitmq.com>

Hi,

On Thu, Sep 30, 2010 at 04:52:46PM -0500, tsuraan wrote:
> The way I'm repopulating the queues is by binding each queue to the
> amq.direct exchange with the queue name as the routing key, and then
> sending messages to that exchange with the desired queue's name as the
> key.  The messages are being created as persistent messages, and the
> sends are done in a transactional channel with a commit every hundred
> messages.

Ok, so you should be seeing a fair amount of disk activity.

>  While this is happening, the consumers are consuming from
> the queues.  If I stop the consumers, then the hangs also stop.

Are the consumers part of the same clients that are doing the sending or
are they different clients?

>  I
> also don't ever seem to get hangs when doing normal message sending
> through the exchanges that I normally use; at least I haven't seen any
> evidence or heard any bug reports that would indicate that's
> happening.  There is nothing in my sasl log, and the only unusual
> thing in my other log is that I'm sometimes hitting the high water
> mark, but I haven't seen that happen while I've been attempting to
> send messages.

At what rate are the consumers consuming messages? Rabbit is optimised
to get rid of messages quickly, thus if a queue is quite long, it can
drive consumers as fast as possible, but will ignore publishes until the
queue has become empty... however, that should really only express
itself internally within Rabbit - the client shouldn't actually see any
impact on publishing, unless it was also doing something synchronous
from time to time like tx.commit. Are you finding it blocks when it hits
tx.commit?

I don't think there's anything wrong with what you're doing. But this
might be a client library issue.

Seeing as you're using a client to shovel messages from one broker to
another, I would suggest experimenting with using the shovel - I'd
configure it in the new broker (where it's easiest to install) and just
have it drag all messages over from the old broker. If that works, then
it does point to something going wrong in the python client library.

Socket flushing will block if the broker has hit its high memory
watermarks. This is because we now use TCP backpressure to block any
clients which are sending us messages. If you have the sender and the
consumer on the same connection, this will certainly affect you, and it
is possible that memory use will be worse (more fragmented) if you have
a consumer and publisher at the same time rather than just a publisher,
so you might just be hitting the limits more often. It could be that the
socket flush doesn't correctly return even when the socket becomes
unblocked.

Best wishes,

Matthew

From matthew at rabbitmq.com  Fri Oct  1 18:21:20 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 18:21:20 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=CkQFwpzXWFN_X33Uy05OjrVQPs8z+Nt=fqR=M@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<AANLkTi=CkQFwpzXWFN_X33Uy05OjrVQPs8z+Nt=fqR=M@mail.gmail.com>
Message-ID: <20101001172119.GQ20604@rabbitmq.com>

On Fri, Oct 01, 2010 at 12:11:03PM -0500, tsuraan wrote:
> > While this is happening, the consumers are consuming from
> > the queues. ?If I stop the consumers, then the hangs also stop. ?I
> > also don't ever seem to get hangs when doing normal message sending
> > through the exchanges that I normally use;
> 
> Ok, this bit isn't true; apparently this is happening during normal
> runtime as well, so it's probably not related to the amq.direct
> exchange.  It looks like any call to tx_commit is hanging, when called
> from anywhere in the system.  I could really use some sort of advice
> for how to debug this.  It's rabbit 2.1.0 on erlang 13.2.4 (erl
> -version gives 5.7.5; I can never remember exactly how that maps to
> erlang's crazy versions: 13B4 maybe?).

Brilliant timing ;) Hmm, check disk access on the broker - if
transactions are occurring then there should be a fair amount of disk
activity. Probably a dumb question, but you have done a tx.select on the
publishing channel first?

Matthew

From matthias at rabbitmq.com  Fri Oct  1 18:31:02 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Oct 2010 18:31:02 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
Message-ID: <4CA61AD6.40702@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> The way I'm repopulating the queues is by binding each queue to the
> amq.direct exchange with the queue name as the routing key, and then
> sending messages to that exchange with the desired queue's name as the
> key.

As an aside, instead of creating bindings to amq.direct, why not simply 
publish the messages to the default exchange? That already has all the 
bindings you need and exists for the very purpose of publishing to 
individual named queues.

Regards,

Matthias.

From rob at rabbitmq.com  Fri Oct  1 18:54:10 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 1 Oct 2010 18:54:10 +0100
Subject: [rabbitmq-discuss] Multi-threaded Dispatch in Java Client
Message-ID: <2B5773E7-547A-49BA-9D57-41B23CBC64F4@rabbitmq.com>

Recently I pushed branch bug18384 that changes the way callbacks are sent to Consumer implementations.

Following this change, the Connection maintains a dispatch thread that is used to send callbacks to the Consumers. This frees Consumers call blocking methods on the Connection and Channel.

A question came up on Twitter about making this configurable, allowing for a custom Executor to be plugged into the ConnectionFactory. I wanted to outline why this is complicated, discuss a possible implementation and see if there is much interest.

First off, we should establish that each Consumer should only receive callbacks in a single thread. If this is not the case, then chaos will ensue and Consumers will need to worry about their own thread safety beyond that of initialisation safety.

With only a single dispatch thread for all Consumers, this Consumer-Thread pairing is easy honoured.

When we introduce multiple threads, we have to ensure that each Consumer is paired with only one thread. When using the Executor abstraction, this prevents each callback dispatch from being wrapped up in a Runnable and sent to Executor, because you cannot guarantee which thread will be used.

To get around this, the Executor can be set to run 'n' long-running tasks (n being the number of threads in the Executor). Each of these tasks pulls dispatch instructions off a queue and executes them. Each Consumer is paired with one dispatch instruction queue, probably assigned on a round-robin basis. This is not too complicated and will provide simple balancing of dispatch load across the threads in the Executor.

Now, there are still some problems:

1. The number of threads in an Executor is not necessarily fixed (as with ThreadPoolExecutor).
2. There is no way, via Executor or ExecutorService to find out how many threads there are. Thus, we cannot know how many dispatch instruction queues to create.

However, we can certainly introduce a ConnectionFactory.setDispatchThreadCount(int). Behind the scenes this will create an Executors.newFixedThreadPool() and the correct number of dispatch queues and dispatch tasks.

I'm interested in hearing if anyone thinks I'm overlooking some simpler way of solving this, and indeed if this is even worth solving.

Regards,

Rob

From tsuraan at gmail.com  Fri Oct  1 18:56:27 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 1 Oct 2010 12:56:27 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <20101001171936.GP20604@rabbitmq.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
Message-ID: <AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>

> Ok, so you should be seeing a fair amount of disk activity.

Sort of; the disks on the affected machines seem to resist activity
(i.e. they're crap).  I think I am maxing them out though, which I
guess is the problem here.

> Are the consumers part of the same clients that are doing the sending or
> are they different clients?

The consumers also do sending on their own.  It turns out that it's a
single consumer that is the source of the problem.  That consumer gets
messages via a subscription, does some pretty IO heavy work
(parsing/indexing file data), and then publishes new messages and acks
the ones it was working on.  All the queue work is done
transactionally, so the acks and the publishes happen at once.  All my
consumers are also producers, but none of them smash the disk as badly
as that one, which is probably why the problem goes away when I shut
off that consumer.

> At what rate are the consumers consuming messages? Rabbit is optimised
> to get rid of messages quickly, thus if a queue is quite long, it can
> drive consumers as fast as possible, but will ignore publishes until the
> queue has become empty... however, that should really only express
> itself internally within Rabbit - the client shouldn't actually see any
> impact on publishing, unless it was also doing something synchronous
> from time to time like tx.commit. Are you finding it blocks when it hits
> tx.commit?

Yeah, every tx.commit is blocking when that one consumer is running.
Can the priority of publishes/commits be elevated when in a
transaction?  It sounds like starvation is really likely for
transaction producer/consumer processes, if I understand what you said
correctly.  Would setting a really low prefetch for this consumer
cause rabbit to send fewer messages to that consumer without
acknowledgement, and thus maybe provide some degree of throttling?  I
don't think I'm setting the prefetch limit on that channel at all
right now, which would maybe explain why it can keep working even when
rabbit is unable to handle any tx_commits or publishes.

> Seeing as you're using a client to shovel messages from one broker to
> another, I would suggest experimenting with using the shovel - I'd
> configure it in the new broker (where it's easiest to install) and just
> have it drag all messages over from the old broker. If that works, then
> it does point to something going wrong in the python client library.

To get two broker's running, I'd need to use different names for both,
and configure the old one to use a non-standard port, right?  Is there
anything else I'd need to do to get two rabbits running on the same
machine?  Also, does shovel run in transactional mode to guarantee
that no messages are lost?

> Socket flushing will block if the broker has hit its high memory
> watermarks. This is because we now use TCP backpressure to block any
> clients which are sending us messages. If you have the sender and the
> consumer on the same connection, this will certainly affect you, and it
> is possible that memory use will be worse (more fragmented) if you have
> a consumer and publisher at the same time rather than just a publisher,
> so you might just be hitting the limits more often. It could be that the
> socket flush doesn't correctly return even when the socket becomes
> unblocked.

I'm guessing that maybe it wasn't an eternal block, it was just due to
how unhappy the machines disks are with running rabbit and my indexing
at the same time.  I never saw this under bug21673 (last checkout in
April, though); did the publishes being starved by sends change since
then?

> Brilliant timing ;) Hmm, check disk access on the broker - if
> transactions are occurring then there should be a fair amount of disk
> activity. Probably a dumb question, but you have done a tx.select on the
> publishing channel first?

Yeah, tx.select is the first thing I do on all my channels.

From rob at rabbitmq.com  Fri Oct  1 18:58:23 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 1 Oct 2010 18:58:23 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>
Message-ID: <1F596B67-B1FA-4F04-88A0-2A935CE0D4A4@rabbitmq.com>

I checked out ActiveMQ and HornetQ.

ActiveMQ has both /queue/ and /topic/ and I'm trying to match the semantics there.

HornetQ using jms.queue and jms.topic prefixes which don't fit very well :)

Rob
On 1 Oct 2010, at 16:06, Marek Majkowski wrote:

> On Fri, Oct 1, 2010 at 15:35, Rob Harrop <rob at rabbitmq.com> wrote:
>> Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway.
>> 
>> This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.
>> `/exchange/<name>[/<pattern>]`
>> `/exchange/<name>[/<routing-key>]`
>> `/queue/<name>`
>> `/topic/<name>`
> 
> I like that very much!
> 
> Just for the comparison, have you looked at other STOMP
> implementations? (I haven't.) How do others address resources
> using STOMP?
> 
> Cheers,
>  Marek Majkowski


From clegnitto at mozilla.com  Fri Oct  1 19:14:30 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Fri, 1 Oct 2010 11:14:30 -0700
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <1F596B67-B1FA-4F04-88A0-2A935CE0D4A4@rabbitmq.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>
	<1F596B67-B1FA-4F04-88A0-2A935CE0D4A4@rabbitmq.com>
Message-ID: <B40A2F1D-4862-46EC-AE7C-300792D9203B@mozilla.com>

I appreciate you trying to match others. I've been trying to get generalized stomp support to work with http://github.com/LegNeato/bugzilla-push and it is a pain dealing with every broker's differing semantics. For the time being I have basically given up and have just followed what RabbitMQ is doing.

Have you reached out to the other projects to perhaps standardize? I know the protocol leaves it up to the broker, but it's lame that you can have everything working with one broker, slide in another and not have it work.

Christian

On Oct 1, 2010, at 10:58 AM, Rob Harrop wrote:

> I checked out ActiveMQ and HornetQ.
> 
> ActiveMQ has both /queue/ and /topic/ and I'm trying to match the semantics there.
> 
> HornetQ using jms.queue and jms.topic prefixes which don't fit very well :)
> 
> Rob
> On 1 Oct 2010, at 16:06, Marek Majkowski wrote:
> 
>> On Fri, Oct 1, 2010 at 15:35, Rob Harrop <rob at rabbitmq.com> wrote:
>>> Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway.
>>> 
>>> This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.
>>> `/exchange/<name>[/<pattern>]`
>>> `/exchange/<name>[/<routing-key>]`
>>> `/queue/<name>`
>>> `/topic/<name>`
>> 
>> I like that very much!
>> 
>> Just for the comparison, have you looked at other STOMP
>> implementations? (I haven't.) How do others address resources
>> using STOMP?
>> 
>> Cheers,
>> Marek Majkowski
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From chrisch at ecollege.com  Fri Oct  1 19:46:58 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 1 Oct 2010 12:46:58 -0600
Subject: [rabbitmq-discuss] Silly Question...Delete Guest User?
Message-ID: <74D4EDFED2256749A5BF5B59267E085303C726D0@EXMBCL01CORP.eclg.org>

Hi Everybody.

Is it safe to delete the guest user on a fresh deployment of Rabbit?

Thanks!

Chris

From tsuraan at gmail.com  Fri Oct  1 20:14:15 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 1 Oct 2010 14:14:15 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
Message-ID: <AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>

> Would setting a really low prefetch for this consumer
> cause rabbit to send fewer messages to that consumer without
> acknowledgement, and thus maybe provide some degree of throttling? ?I
> don't think I'm setting the prefetch limit on that channel at all
> right now, which would maybe explain why it can keep working even when
> rabbit is unable to handle any tx_commits or publishes.

For the archives, setting a prefetch message count limit of 1,000 is
allowing my other agents to proceed.  I'm concerned that there is
might be a starvation condition inside of rabbit, but the throttling
does seem to keep it from manifesting.

From alexandru at rabbitmq.com  Fri Oct  1 20:41:14 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 1 Oct 2010 20:41:14 +0100
Subject: [rabbitmq-discuss] Silly Question...Delete Guest User?
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C726D0@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303C726D0@EXMBCL01CORP.eclg.org>
Message-ID: <20101001194114.GB2290@dakota>

Hi Chris,

It depends on what you mean by safe.  There's certainly no harm in
deleting guest and you'll probably want to do that eventually anyway,
but you do need a user to connect to the broker.

All of our clients use username guest and password guest as defaults.

You can delete guest and, if you change your mind, you can re-add him
with:
   rabbitmqctl add_user guest guest
   rabbitmqctl set_permission guest '.*' '.*' '.*'

Cheers,
Alex

On Fri, Oct 01, 2010 at 12:46:58PM -0600, Chris Chew wrote:
> Hi Everybody.
> 
> Is it safe to delete the guest user on a fresh deployment of Rabbit?
> 
> Thanks!
> 
> Chris
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Fri Oct  1 20:45:10 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 01 Oct 2010 20:45:10 +0100
Subject: [rabbitmq-discuss] Silly Question...Delete Guest User?
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C726D0@EXMBCL01CORP.eclg.org>
	(Chris Chew's message of "Fri, 1 Oct 2010 12:46:58 -0600")
References: <74D4EDFED2256749A5BF5B59267E085303C726D0@EXMBCL01CORP.eclg.org>
Message-ID: <yrv4c4od5g0jd.fsf@dwragg.eng.vmware.com>

"Chris Chew" <chrisch at ecollege.com> writes:
> Is it safe to delete the guest user on a fresh deployment of Rabbit?

Yes.  In fact, that's what you are expected to do, if you care about
broker-level security.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From alexis at rabbitmq.com  Fri Oct  1 20:52:47 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 1 Oct 2010 19:52:47 +0000
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <B40A2F1D-4862-46EC-AE7C-300792D9203B@mozilla.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>
	<1F596B67-B1FA-4F04-88A0-2A935CE0D4A4@rabbitmq.com>
	<B40A2F1D-4862-46EC-AE7C-300792D9203B@mozilla.com>
Message-ID: <AANLkTiksrHonSTWtnAduR6QUFeeDvPG7EKqaHpH47qBm@mail.gmail.com>

Christian

We did sort of try this previously.  Now, however, the impending
arrival of STOMP 1.1 may be an opportunity to consolidate the spec and
standardise.  Are you following that discussion on stomp-spec?

alexis




On Fri, Oct 1, 2010 at 7:14 PM, Christian Legnitto
<clegnitto at mozilla.com> wrote:
> I appreciate you trying to match others. I've been trying to get generalized stomp support to work with http://github.com/LegNeato/bugzilla-push and it is a pain dealing with every broker's differing semantics. For the time being I have basically given up and have just followed what RabbitMQ is doing.
>
> Have you reached out to the other projects to perhaps standardize? I know the protocol leaves it up to the broker, but it's lame that you can have everything working with one broker, slide in another and not have it work.
>
> Christian
>
> On Oct 1, 2010, at 10:58 AM, Rob Harrop wrote:
>
>> I checked out ActiveMQ and HornetQ.
>>
>> ActiveMQ has both /queue/ and /topic/ and I'm trying to match the semantics there.
>>
>> HornetQ using jms.queue and jms.topic prefixes which don't fit very well :)
>>
>> Rob
>> On 1 Oct 2010, at 16:06, Marek Majkowski wrote:
>>
>>> On Fri, Oct 1, 2010 at 15:35, Rob Harrop <rob at rabbitmq.com> wrote:
>>>> Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway.
>>>>
>>>> This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.
>>>> `/exchange/<name>[/<pattern>]`
>>>> `/exchange/<name>[/<routing-key>]`
>>>> `/queue/<name>`
>>>> `/topic/<name>`
>>>
>>> I like that very much!
>>>
>>> Just for the comparison, have you looked at other STOMP
>>> implementations? (I haven't.) How do others address resources
>>> using STOMP?
>>>
>>> Cheers,
>>> Marek Majkowski
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From chrisch at ecollege.com  Fri Oct  1 20:56:40 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 1 Oct 2010 13:56:40 -0600
Subject: [rabbitmq-discuss] Silly Question...Delete Guest User?
In-Reply-To: <20101001194114.GB2290@dakota>
Message-ID: <74D4EDFED2256749A5BF5B59267E085303C726EB@EXMBCL01CORP.eclg.org>

> -----Original Message-----
> From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru
> Scvortov
> Sent: Friday, October 01, 2010 1:41 PM
> To: Chris Chew
> Cc: RabbitMQ
> Subject: Re: [rabbitmq-discuss] Silly Question...Delete Guest User?
> 
> Hi Chris,
> 
> It depends on what you mean by safe.  There's certainly no harm in
> deleting guest and you'll probably want to do that eventually anyway,
> but you do need a user to connect to the broker.
> 
> All of our clients use username guest and password guest as defaults.
> 
> You can delete guest and, if you change your mind, you can re-add him
> with:
>    rabbitmqctl add_user guest guest
>    rabbitmqctl set_permission guest '.*' '.*' '.*'
> 
> Cheers,
> Alex

Thank you for the confirmation.  We are creating new users for the various systems connecting to our furry Rabbit, but wanted to delete guest in the interest of security.

I just first wanted to make sure there wasn't some hidden internal operational requirement on guest.

The admin guide (http://www.rabbitmq.com/admin-guide.html) advises changing the guest password, perhaps it would be more proper to say,

"It is advisable to delete the guest user or change the password to something private, particularly if your broker is accessible publicly."

Thanks!

Chris

From clegnitto at mozilla.com  Fri Oct  1 21:05:11 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Fri, 1 Oct 2010 13:05:11 -0700
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <AANLkTiksrHonSTWtnAduR6QUFeeDvPG7EKqaHpH47qBm@mail.gmail.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<AANLkTi=cdkosUWMYYNiUVVrcoGNaRe9_sp2vwgocsVMX@mail.gmail.com>
	<1F596B67-B1FA-4F04-88A0-2A935CE0D4A4@rabbitmq.com>
	<B40A2F1D-4862-46EC-AE7C-300792D9203B@mozilla.com>
	<AANLkTiksrHonSTWtnAduR6QUFeeDvPG7EKqaHpH47qBm@mail.gmail.com>
Message-ID: <C0F6CA3A-D56E-4056-87CF-11D90541D927@mozilla.com>

I'm not. I'll get on that list.

Christian

On Oct 1, 2010, at 12:52 PM, Alexis Richardson wrote:

> Christian
> 
> We did sort of try this previously.  Now, however, the impending
> arrival of STOMP 1.1 may be an opportunity to consolidate the spec and
> standardise.  Are you following that discussion on stomp-spec?
> 
> alexis
> 
> 
> 
> 
> On Fri, Oct 1, 2010 at 7:14 PM, Christian Legnitto
> <clegnitto at mozilla.com> wrote:
>> I appreciate you trying to match others. I've been trying to get generalized stomp support to work with http://github.com/LegNeato/bugzilla-push and it is a pain dealing with every broker's differing semantics. For the time being I have basically given up and have just followed what RabbitMQ is doing.
>> 
>> Have you reached out to the other projects to perhaps standardize? I know the protocol leaves it up to the broker, but it's lame that you can have everything working with one broker, slide in another and not have it work.
>> 
>> Christian
>> 
>> On Oct 1, 2010, at 10:58 AM, Rob Harrop wrote:
>> 
>>> I checked out ActiveMQ and HornetQ.
>>> 
>>> ActiveMQ has both /queue/ and /topic/ and I'm trying to match the semantics there.
>>> 
>>> HornetQ using jms.queue and jms.topic prefixes which don't fit very well :)
>>> 
>>> Rob
>>> On 1 Oct 2010, at 16:06, Marek Majkowski wrote:
>>> 
>>>> On Fri, Oct 1, 2010 at 15:35, Rob Harrop <rob at rabbitmq.com> wrote:
>>>>> Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway.
>>>>> 
>>>>> This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.
>>>>> `/exchange/<name>[/<pattern>]`
>>>>> `/exchange/<name>[/<routing-key>]`
>>>>> `/queue/<name>`
>>>>> `/topic/<name>`
>>>> 
>>>> I like that very much!
>>>> 
>>>> Just for the comparison, have you looked at other STOMP
>>>> implementations? (I haven't.) How do others address resources
>>>> using STOMP?
>>>> 
>>>> Cheers,
>>>> Marek Majkowski
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From matthias at rabbitmq.com  Fri Oct  1 21:16:52 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Oct 2010 21:16:52 +0100
Subject: [rabbitmq-discuss] Silly Question...Delete Guest User?
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C726EB@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303C726EB@EXMBCL01CORP.eclg.org>
Message-ID: <4CA641B4.80809@rabbitmq.com>

Chris Chew wrote:
> The admin guide (http://www.rabbitmq.com/admin-guide.html) advises
> changing the guest password, perhaps it would be more proper to say,
> 
> "It is advisable to delete the guest user or change the password to
> something private, particularly if your broker is accessible
> publicly."

Done.

Matthias.

From DandyLoon at gmail.com  Fri Oct  1 22:32:56 2010
From: DandyLoon at gmail.com (DandyLoon at gmail.com)
Date: Fri, 01 Oct 2010 21:32:56 +0000
Subject: [rabbitmq-discuss] Message persistence problems?
Message-ID: <0016364571a81e167d049194f01b@google.com>

I've got a stock rabbitmq 2.1.0 installation on CentOS with no extra  
plugins or configuration beyond setting up ip/port/etc.

I'm having a problem with message persistence - I can send and receive  
messages with delivery_mode=2 and verify that rabbit's temp files grow and  
shrink as expected. If I run 'rabbitmqctl stop' while there are persistent  
messages in the queue and then restart rabbit, those messages are still in  
the queue when the broker comes back up. If I kill -9 the erlang processes  
instead of doing a clean shutdown (testing a crash scenario), the queue  
comes back up empty. Is this expected behavior?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/07a03141/attachment.htm>

From tsuraan at gmail.com  Fri Oct  1 23:05:07 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 1 Oct 2010 17:05:07 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
Message-ID: <AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>

> For the archives, setting a prefetch message count limit of 1,000 is
> allowing my other agents to proceed. ?I'm concerned that there is
> might be a starvation condition inside of rabbit, but the throttling
> does seem to keep it from manifesting.

Nevermind that, it solved one case of hanging, but I have another on a
totally idle machine where all my tx_commit calls are hanging.  There
is no disk activity at all; the system is just stuck with a small
handful of processes (consumers/producers) stuck at tx_commit.  I can
restart the processes, and they run until their first tx_commit, and
then hang.  top shows no CPU activity, and iotop shows no disk
activity.  This is also with rabbit 2.1.0 and erlang 13B4.

A sample python script that's hanging for me is:

>>> c=connect()
>>> from amqplib.client_0_8 import Message
>>> ch=c.channel()
>>> ch.tx_select()
>>> ch.basic_publish(m, 'amq.direct', 'foo')
>>> ch.tx_commit()

The tx_commit call just never returns.  There isn't anything
apparently consuming from any queue, as the disks are entirely idle,
so I don't know what's going on here.  I have full shell access to
this machine, so any commands that you can think of that could be done
through remsh, I'd be happy to try.  I don't know if I can get you
guys direct access to the machine, but I can try if you need me to.

I have a total of 13 queues, most of which are pretty close to empty.
One of them has ~50,000 and another has ~600,000 messages.  All are
durable, and all messages are persistent.  The huge queue's consumer
is completely disabled right now, so its consumer isn't generating any
traffic of any kind.

From matthew at rabbitmq.com  Fri Oct  1 23:21:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Oct 2010 23:21:18 +0100
Subject: [rabbitmq-discuss] Message persistence problems?
In-Reply-To: <0016364571a81e167d049194f01b@google.com>
References: <0016364571a81e167d049194f01b@google.com>
Message-ID: <20101001222118.GA17008@wellquite.org>

On Fri, Oct 01, 2010 at 09:32:56PM +0000, DandyLoon at gmail.com wrote:
> I've got a stock rabbitmq 2.1.0 installation on CentOS with no extra
> plugins or configuration beyond setting up ip/port/etc.
> 
> I'm having a problem with message persistence - I can send and
> receive messages with delivery_mode=2 and verify that rabbit's temp
> files grow and shrink as expected. If I run 'rabbitmqctl stop' while
> there are persistent messages in the queue and then restart rabbit,
> those messages are still in the queue when the broker comes back up.
> If I kill -9 the erlang processes instead of doing a clean shutdown
> (testing a crash scenario), the queue comes back up empty. Is this
> expected behavior?

Yes. The only scenario in which AMQP makes any guarantees about msgs
being written to disk is if the messages are published persistent to a
durable queue with transactions. Anything less than this is a "best
effort" basis only.

As you'll no doubt soon discover, one tx.commit (aka fsync) per msg
creates an enormous performance hit.

Matthew

From matthias at rabbitmq.com  Fri Oct  1 23:22:59 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Oct 2010 23:22:59 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>	<20101001171936.GP20604@rabbitmq.com>	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
Message-ID: <4CA65F43.9030600@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> A sample python script that's hanging for me is:
> 
>>>> c=connect()
>>>> from amqplib.client_0_8 import Message
>>>> ch=c.channel()
>>>> ch.tx_select()
>>>> ch.basic_publish(m, 'amq.direct', 'foo')
>>>> ch.tx_commit()
> 
> The tx_commit call just never returns.

And that's in a rabbit that otherwise is completely idle?

How much memory is rabbit currently using?

Does the rabbit.log say anything about memory alarms?

If you can, please post the output of the various rabbitmqctl list_* 
commands.


Matthias.

From dking at ketralnis.com  Fri Oct  1 23:43:03 2010
From: dking at ketralnis.com (David King)
Date: Fri, 1 Oct 2010 15:43:03 -0700
Subject: [rabbitmq-discuss] Queue has inaccessible messages?
Message-ID: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>

I have a moderate-traffic queue on rabbit 1.8.1 that for some reason doesn't ever get smaller than 1.3k (as reported by rabbitmqctl list_queues).  http://i.imgur.com/m6Zva.png

> ri at queue01:~$ rabbitmqctl list_queues name messages_ready messages_unacknowledged messages memory | grep indextank_changes
> indextank_changes       10      1342    1352    91015008

The queue has two consumers that have been killed/restarted (several times), so it's not a matter of them being stuck in a consumer. It's not an issue of not being able to process them fast enough, because if I shut off the consumers to let the queue grow a bit then turn them back on, messages are processed down to that point near-instantly (that's the giant spike in the aforelinked graph).

Any idea why these messages can't be retrieved?

From shaneman at adobe.com  Sat Oct  2 00:02:02 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Fri, 1 Oct 2010 16:02:02 -0700
Subject: [rabbitmq-discuss] bql crash
Message-ID: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>

RabbitMq: rabbitmq-server_2.1.0-1_all.deb
OS: ubuntu-10.04.1-server-amd64
Bql sources downloaded today

Generic RabbitMQ server is running fine, able to create Exchanges, Queues, push/pop messages.

$ ./bql
BQL> select * from exchanges
{"init terminating in do_boot",{timeout,{gen_server,call,[<0.47.0>,{call,<<16 bytes>>,<<107 bytes>>},500]}}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/faf9e0ca/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 391125 bytes
Desc: erl_crash.dump
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101001/faf9e0ca/attachment-0001.obj>

From tsuraan at gmail.com  Sat Oct  2 01:35:34 2010
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 1 Oct 2010 19:35:34 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <4CA65F43.9030600@rabbitmq.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
	<4CA65F43.9030600@rabbitmq.com>
Message-ID: <AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>

> And that's in a rabbit that otherwise is completely idle?

It's not apparently doing anything; it should be (there are a few
other agents that are stuck trying to commit), but it's not.  disk and
cpu activity are idle.

> How much memory is rabbit currently using?

/proc/<pid>/status gives 446MB (peak of 589MB).  That's on a 2GB machine

> Does the rabbit.log say anything about memory alarms?

It looks like in an 8-minute interval about 5 hours ago, it had 57
high memory events (57 alerts, and 57 clears).  That was about 3 hours
before I ran my script that hung, I think.

> If you can, please post the output of the various rabbitmqctl list_*
> commands.

Names changed to protect the innocent (*sigh*):

Listing queues ...
Queue0  5
Queue1  54468
Queue2  0
Queue3  0
Queue4  13
Queue5  0
Queue6  579055
Queue7  0
Queue8  15
Queue9  143
Queue10 0
Queue11 0
Queue12 12

Listing exchanges ...
amq.direct      direct
Exchange0       fanout
Exchange1       fanout
amq.topic       topic
Exchange2       fanout
Exchange3       fanout
Exchange4       fanout
Exchange5       fanout
amq.rabbitmq.log        topic
Exchange6       fanout
amq.fanout      fanout
Exchange7       fanout
Exchange8       fanout
Exchange9       fanout
amq.headers     headers
Exchange10      fanout
amq.match       headers

Listing bindings ...
Exchange5       Queue11 []
Exchange4       Queue8  []
Exchange4       Queue0  []
Exchange4       Queue1  []
Exchange3       Queue10 []
Exchange1       Queue7  []
Exchange1       Queue3  []
Exchange9       Queue2  []
Exchange2       Queue1  []
Exchange8       Queue12 []
Exchange6       Queue9  []
Exchange6       Queue6  []
Exchange0       Queue1  []
Exchange7       Queue5  []
Exchange10      Queue4  []
amq.direct      Queue6  []

Hope that's useful.

From matthias at rabbitmq.com  Sat Oct  2 02:15:21 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Oct 2010 02:15:21 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>	<20101001171936.GP20604@rabbitmq.com>	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>	<4CA65F43.9030600@rabbitmq.com>
	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>
Message-ID: <4CA687A9.20405@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> Names changed to protect the innocent (*sigh*):
> 
> Listing queues ...

Please run it like this:
  rabbitmqctl list_queues name durable auto_delete owner_pid 
messages_ready messages_unacknowledged consumers memory

Also, please post the output of

rabbitmqctl list_connections pid peer_address peer_port state channels 
send_pend

rabbitmqctl list_channels pid connection number transactional 
consumer_count messages_unacknowledged acks_uncommitted prefetch_count

rabbitmqctl list_consumers


And do all that *while* the "send a single transactional message to foo" 
program is stuck. And in the output of the above commands please 
highlight the connection, exchange and queue involved in that stuck 
interaction.


Regards,

Matthias.

From tsuraan at gmail.com  Sat Oct  2 07:03:58 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 2 Oct 2010 01:03:58 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <4CA687A9.20405@rabbitmq.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
	<4CA65F43.9030600@rabbitmq.com>
	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>
	<4CA687A9.20405@rabbitmq.com>
Message-ID: <AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>

> ?rabbitmqctl list_queues name durable auto_delete owner_pid messages_ready
> messages_unacknowledged consumers memory
> rabbitmqctl list_connections pid peer_address peer_port state channels
> send_pend
> rabbitmqctl list_channels pid connection number transactional consumer_count
> messages_unacknowledged acks_uncommitted prefetch_count
> rabbitmqctl list_consumers

Don't feel like doing the confusing name-mangling stuff, so sending
these directly to you

> And do all that *while* the "send a single transactional message to foo"
> program is stuck. And in the output of the above commands please highlight
> the connection, exchange and queue involved in that stuck interaction.

The script I ran this time is just making a single transactional
channel and publishing a message to 'amq.fanout'.  There aren't any
queues attached to the fanout exchange, but the tx.commit still hangs.
 Hopefully the data I'm sending privately is of some use.

From matthias at rabbitmq.com  Sat Oct  2 10:09:43 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Oct 2010 10:09:43 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>	<20101001171936.GP20604@rabbitmq.com>	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>	<4CA65F43.9030600@rabbitmq.com>	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>	<4CA687A9.20405@rabbitmq.com>
	<AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>
Message-ID: <4CA6F6D7.2020605@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> Don't feel like doing the confusing name-mangling stuff, so sending
> these directly to you
> [...]

The output of list_connections show many connections in the 'blocked' 
state, which means the broker is refusing to accept any more data.

That should only happen if the memory alarm is currently active. What 
does the log file say about that? Perhaps you could post it.

The output of list_queues shows a number of queues with messages waiting 
for acknowledgement. One queue in particular has a high count. What's 
the average message size of messages in that queue?

The messages waiting for acks also show up in list_channels.

Tracing the from the queue through the consumers, channels and 
connections to find the connection which is consuming from the high-ack 
queue, we discover that connection to be blocked.


So I think what is happening here is that you have a client that is both 
a consumer and producer. At some point the memory alarm is raised. 
Because the client has been identified as a producer the server blocks 
the inbound socket data stream, thus pausing the client in its tracks. 
But messages still get delivered to the client. And they all pile up in 
memory, in the server's channel process. That is preventing the server 
from ever recovering, clearing the memory alarm and unblocking the 
connections.


I reckon one way to prevent this situation is to set a 
qos.prefetch_count, thus bounding the number of messages which are 
waiting for acknowledgement. Or, if you can consume in no-ack mode that 
would be even better.


Regards,

Matthias.

From michaelburns1 at gmail.com  Sat Oct  2 12:42:40 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Sat, 2 Oct 2010 12:42:40 +0100
Subject: [rabbitmq-discuss] Queue has inaccessible messages?
In-Reply-To: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
Message-ID: <AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>

Are you sure the connection on the broker is being closed after you kill
your consumers? I have a similar problem and sometimes have to manually
close the connection on the broker in order to get messages delivered to the
consumer.

See this thread for details
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-September/008779.html


On Fri, Oct 1, 2010 at 11:43 PM, David King <dking at ketralnis.com> wrote:

> I have a moderate-traffic queue on rabbit 1.8.1 that for some reason
> doesn't ever get smaller than 1.3k (as reported by rabbitmqctl list_queues).
>  http://i.imgur.com/m6Zva.png
>
> > ri at queue01:~$ rabbitmqctl list_queues name messages_ready
> messages_unacknowledged messages memory | grep indextank_changes
> > indextank_changes       10      1342    1352    91015008
>
> The queue has two consumers that have been killed/restarted (several
> times), so it's not a matter of them being stuck in a consumer. It's not an
> issue of not being able to process them fast enough, because if I shut off
> the consumers to let the queue grow a bit then turn them back on, messages
> are processed down to that point near-instantly (that's the giant spike in
> the aforelinked graph).
>
> Any idea why these messages can't be retrieved?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101002/6e33a44a/attachment.htm>

From tsuraan at gmail.com  Sat Oct  2 17:15:35 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 2 Oct 2010 11:15:35 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <4CA6F6D7.2020605@rabbitmq.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
	<4CA65F43.9030600@rabbitmq.com>
	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>
	<4CA687A9.20405@rabbitmq.com>
	<AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>
	<4CA6F6D7.2020605@rabbitmq.com>
Message-ID: <AANLkTimTh1x2em7Zep7=C4nNA9BXP56UrV_nxFdyzEEw@mail.gmail.com>

> The output of list_connections show many connections in the 'blocked' state,
> which means the broker is refusing to accept any more data.
>
> That should only happen if the memory alarm is currently active. What does
> the log file say about that? Perhaps you could post it.

Yeah, it is in an alarm state.  The thing goes up and down like mad
for a minute or so, and then settles down with everything hung.  The
logfile is attached.

> The output of list_queues shows a number of queues with messages waiting for
> acknowledgement. One queue in particular has a high count. What's the
> average message size of messages in that queue?

it's around a hundred bytes to a few hundred bytes.  Is it strange
that the largest of the queues is using ~12MB, and the second largest
is using ~3MB, and we're hitting our 200MB high water mark?  Am I
reading that wrong, or does there seem to be a lot of memory being
used that's not in the queued messages?  Could it be one of the
tracking things, and solvable with the toke plugin?  The highest
unack'd count is 54,468, which seems high, but not insanely so.  The
other strange thing is that the process slurping from that queue
should have a prefetch of 1,000 messages.  I'll have to see what went
wrong there, but I'm guessing it's running the wrong code.

> The messages waiting for acks also show up in list_channels.
>
> Tracing the from the queue through the consumers, channels and connections
> to find the connection which is consuming from the high-ack queue, we
> discover that connection to be blocked.
>
>
> So I think what is happening here is that you have a client that is both a
> consumer and producer. At some point the memory alarm is raised. Because the
> client has been identified as a producer the server blocks the inbound
> socket data stream, thus pausing the client in its tracks. But messages
> still get delivered to the client. And they all pile up in memory, in the
> server's channel process. That is preventing the server from ever
> recovering, clearing the memory alarm and unblocking the connections.

If the client isn't also a producer (at least on that channel), but is
in transactional mode, will the high water mark prevent tx.commit
messages from being handled?

> I reckon one way to prevent this situation is to set a qos.prefetch_count,
> thus bounding the number of messages which are waiting for acknowledgement.
> Or, if you can consume in no-ack mode that would be even better.

the prefetch_count should be getting set, but doesn't appear to be.
I'll look into that.  The original machine that was having this
problem was doing it after ~300 messages were inserted into the
queues, and it had a high water mark of 800MB.  I really wish I still
had access to that machine for testing, but unfortunately that exact
situation doesn't seem to be repeatable.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mqueue at master.0.log.gz
Type: application/x-gzip
Size: 4497 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101002/7efe6d33/attachment.bin>

From matthias at rabbitmq.com  Sat Oct  2 18:31:03 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Oct 2010 18:31:03 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTimTh1x2em7Zep7=C4nNA9BXP56UrV_nxFdyzEEw@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>	<20101001171936.GP20604@rabbitmq.com>	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>	<4CA65F43.9030600@rabbitmq.com>	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>	<4CA687A9.20405@rabbitmq.com>	<AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>	<4CA6F6D7.2020605@rabbitmq.com>
	<AANLkTimTh1x2em7Zep7=C4nNA9BXP56UrV_nxFdyzEEw@mail.gmail.com>
Message-ID: <4CA76C57.2020709@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> we're hitting our 200MB high water mark?

Why is your water mark set so low? I thought you said you had 2GB of 
memory in the machine, which with the default setting of the mark at 0.4 
would be about 819Mb.

> Am I reading that wrong, or does there seem to be a lot of memory being
> used that's not in the queued messages?  Could it be one of the
> tracking things, and solvable with the toke plugin?  The highest
> unack'd count is 54,468, which seems high, but not insanely so.

Toke would probably help since you have one queue with nearly 600k 
messages. But 200Mb is really very little to give to a rabbit that is 
supposed to handle the message volume you have. So I'd start be 
increasing that.

> The other strange thing is that the process slurping from that queue
> should have a prefetch of 1,000 messages.  I'll have to see what went
> wrong there, but I'm guessing it's running the wrong code.

A prefetch of 1000 is quite high. I'd suggest lowering that.

> If the client isn't also a producer (at least on that channel), but is
> in transactional mode, will the high water mark prevent tx.commit
> messages from being handled?

Blocking happens at the *connection* level. A client connection that 
hasn't done any publishing will not be blocked.


Regards,

Matthias.

From tsuraan at gmail.com  Sat Oct  2 18:53:09 2010
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 2 Oct 2010 12:53:09 -0500
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <4CA76C57.2020709@rabbitmq.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>
	<20101001171936.GP20604@rabbitmq.com>
	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>
	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>
	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>
	<4CA65F43.9030600@rabbitmq.com>
	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>
	<4CA687A9.20405@rabbitmq.com>
	<AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>
	<4CA6F6D7.2020605@rabbitmq.com>
	<AANLkTimTh1x2em7Zep7=C4nNA9BXP56UrV_nxFdyzEEw@mail.gmail.com>
	<4CA76C57.2020709@rabbitmq.com>
Message-ID: <AANLkTi=KeryhDT-fv00YNG90ZU_KKUA8DvpRSmxbcNeD@mail.gmail.com>

> Why is your water mark set so low? I thought you said you had 2GB of memory
> in the machine, which with the default setting of the mark at 0.4 would be
> about 819Mb.

The machine runs quite a few processes.  My understanding of the high
water mark is that the erlang process running rabbit will use at most
2*(watermark * total_ram), so a watermark of 0.1 will result in rabbit
consuming at most 20% of the machine's RAM, correct?  The default
value of 0.4 would let rabbit consume 80% of RAM, which isn't so good
for the other stuff running on the machine.  I know the ideal is that
rabbit gets its own machine, but that isn't an option for us; we sell
individual computers.

> Toke would probably help since you have one queue with nearly 600k messages.
> But 200Mb is really very little to give to a rabbit that is supposed to
> handle the message volume you have. So I'd start be increasing that.

We're not too worried about having really high rabbit performance;
rabbit's ability to handle hundreds of thousands of messages per
second is awesome, but the rest of our system can't handle more than a
few thousand messages per minute, so rabbit isn't a bottleneck.  I had
hoped that setting a low watermark would just make rabbit keep more
messages on disk and less in RAM, and it would just have to feed from
its disk queues more often than it would with a higher watermark.

> A prefetch of 1000 is quite high. I'd suggest lowering that.

That process gets messages from rabbit, does indexing on the
associated data (not stored in rabbit) and does a checkpoint per
minute on a postgres database, a transactional search index, and on
rabbit.  If it acknowledges messages from rabbit before they are
committed, then they can be lost, which is bad.  Checkpoints on the
search index are somewhat expensive; doing them once a minute isn't
bad, but more frequent checkpoints mean busier disks, which means an
uphappy machine.  The number of messages we can process per checkpoint
interval is effectively limited by the prefetch limit, and going under
a thousand means our indexer is idle until the next checkpoint.

> Blocking happens at the *connection* level. A client connection that hasn't
> done any publishing will not be blocked.

Ok, so if I have a few channels on a connection, and one of the
channels is only getting messages, acking message, and committing
while another channel is publishing, then the connection will be
blocked on a low memory alert.  If I move the publishing channel and
the consuming channel to different connections, then the consuming
channel will never be blocked?  I can do that easily enough, and it
might just fix things.

From matthias at rabbitmq.com  Sat Oct  2 19:20:40 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Oct 2010 19:20:40 +0100
Subject: [rabbitmq-discuss] hanging on message sending with py-amqplib
In-Reply-To: <AANLkTi=KeryhDT-fv00YNG90ZU_KKUA8DvpRSmxbcNeD@mail.gmail.com>
References: <AANLkTi=XsJWYP6ZVxhAT8qKsKWRCHJ4Ohew=_==Yaq3f@mail.gmail.com>	<20101001171936.GP20604@rabbitmq.com>	<AANLkTimYnKYxhxY9RmmBOnRS40c==i-nPr5JSxwKPS2w@mail.gmail.com>	<AANLkTimmLN4dr96riKdCUFZPrNoqXWY=+SaZofVpiWhc@mail.gmail.com>	<AANLkTi=aTu6CG1k3eGcG=3YGfMXSXQA4Sbwyawwh+y+B@mail.gmail.com>	<4CA65F43.9030600@rabbitmq.com>	<AANLkTimQJs8oBAsz3PWgYZ=x1-FOhe73Dw=Hoo_1iYPA@mail.gmail.com>	<4CA687A9.20405@rabbitmq.com>	<AANLkTimkN-CyNFKWvvXgS3svbH8zhno0S2RJbxkzQpTy@mail.gmail.com>	<4CA6F6D7.2020605@rabbitmq.com>	<AANLkTimTh1x2em7Zep7=C4nNA9BXP56UrV_nxFdyzEEw@mail.gmail.com>	<4CA76C57.2020709@rabbitmq.com>
	<AANLkTi=KeryhDT-fv00YNG90ZU_KKUA8DvpRSmxbcNeD@mail.gmail.com>
Message-ID: <4CA777F8.4060306@rabbitmq.com>

Tsuraan,

tsuraan wrote:
> The machine runs quite a few processes.  My understanding of the high
>  water mark is that the erlang process running rabbit will use at
> most 2*(watermark * total_ram), so a watermark of 0.1 will result in
> rabbit consuming at most 20% of the machine's RAM, correct?

It can be higher than that. Depends on the work load. But generally 
rabbit should only grow above 1 x watermark briefly.

> The default value of 0.4 would let rabbit consume 80% of RAM, which
> isn't so good for the other stuff running on the machine.

No. 0.4 lets rabbit consume 40% of the RAM. It will use more for brief 
periods if time when the workload is spiky. Is that really a problem in 
your setup?

> The number of messages we can process per
> checkpoint interval is effectively limited by the prefetch limit, and
> going under a thousand means our indexer is idle until the next
> checkpoint.

Understood. I have filed a bug to look into reducing the memory 
footprint of unack'd messages.

> If I move the publishing channel and the consuming channel to
> different connections, then the consuming channel will never be
> blocked?

Correct.


Matthias.

From dking at ketralnis.com  Sat Oct  2 20:19:04 2010
From: dking at ketralnis.com (David King)
Date: Sat, 2 Oct 2010 12:19:04 -0700
Subject: [rabbitmq-discuss] Queue has inaccessible messages?
In-Reply-To: <AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
Message-ID: <9A2DBBBB-8BFA-49BC-86FF-1733A873D43A@ketralnis.com>

> Are you sure the connection on the broker is being closed after you kill your consumers? I have a similar problem and sometimes have to manually close the connection on the broker in order to get messages delivered to the consumer. 

I'm sure that I'm killing both of the only the consumers themselves with 'kill -9', so unless rabbit keeps the consumer open with the remote process entirely dead, yeah, the broker is being closed.

If it makes a difference, this queue is being consumed with basic.get, not basic.consume

From matthew at rabbitmq.com  Sat Oct  2 21:07:09 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 2 Oct 2010 21:07:09 +0100
Subject: [rabbitmq-discuss] Queue has inaccessible messages?
In-Reply-To: <9A2DBBBB-8BFA-49BC-86FF-1733A873D43A@ketralnis.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
	<9A2DBBBB-8BFA-49BC-86FF-1733A873D43A@ketralnis.com>
Message-ID: <20101002200708.GB8805@wellquite.org>

On Sat, Oct 02, 2010 at 12:19:04PM -0700, David King wrote:
> > Are you sure the connection on the broker is being closed after you kill your consumers? I have a similar problem and sometimes have to manually close the connection on the broker in order to get messages delivered to the consumer. 
> 
> I'm sure that I'm killing both of the only the consumers themselves with 'kill -9', so unless rabbit keeps the consumer open with the remote process entirely dead, yeah, the broker is being closed.
> 
> If it makes a difference, this queue is being consumed with basic.get, not basic.consume

So with the consumers killed off, rabbitmqctl list_connections and
rabbitmqctl list_consumers show no entries?

Matthew

From matthias at rabbitmq.com  Sat Oct  2 21:16:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Oct 2010 21:16:15 +0100
Subject: [rabbitmq-discuss] Queue has inaccessible messages?
In-Reply-To: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
Message-ID: <4CA7930F.3000004@rabbitmq.com>

David,

David King wrote:
> I have a moderate-traffic queue on rabbit 1.8.1

You should upgrade.

> that for some reason doesn't ever get smaller than 1.3k (as reported
> by rabbitmqctl list_queues).  http://i.imgur.com/m6Zva.png
> 
>> ri at queue01:~$ rabbitmqctl list_queues name messages_ready 
>> messages_unacknowledged messages memory | grep indextank_changes 
>> indextank_changes       10      1342    1352    91015008

According to that 1342 messages have been sent to the consumer but have 
not been acknowledged. Is your app ack'ing the messages?


Regards,

Matthias.

From darren_gilroy at yahoo.com  Sat Oct  2 21:55:31 2010
From: darren_gilroy at yahoo.com (darr)
Date: Sat, 2 Oct 2010 13:55:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Multi-threaded Dispatch in Java Client
In-Reply-To: <2B5773E7-547A-49BA-9D57-41B23CBC64F4@rabbitmq.com>
References: <2B5773E7-547A-49BA-9D57-41B23CBC64F4@rabbitmq.com>
Message-ID: <29868134.post@talk.nabble.com>


http://bitbucket.org/robharrop/rabbitmq-java-client/changeset/ea463bbd4871
That's the commit I'm referencing.  I hope it's the right one.

It looks like you're breaking the contract of Consumer a little bit when you
move this off of the Connection's thread (since that's what's documented). 
This is a Good Thing, because, as you note, implementations of consumer can
now call blocking methods on Connection and Channel.  However, this has a
down side in that only some consumers are permitted to call blocking methods
-- those that use DispatchingConsumer.  Other consumers are guaranteed to
have their methods called from the Connection thread.

So this is a bit of extra complexity for implementations of Consumer to
consider.  Given that implementors of Consumer already need to think of
these things, you might re-evaluate the idea that consumers require all of
their methods to be called from a single thread.  The mechanics of making a
consumer thread-safe seem very manageable.  There's not a lot of interaction
between the methods and very little state.

However, if you share my concern about breaking the contract of Consumer,
you could introduce another interface (ConcurrentConsumer) which specifies
exactly the requirements of its implementations and modify
DispachingConsumer to accept only ConcurrentConsumer.

As for the possibility of ConnectionFactory.setDispatchThreadCount(int), I
think if I set that to some value greater than one, and had only a single
consumer, I would expect handleDelivery to be called from multiple threads. 
I think we might be safer making DispatchingConsumer the sole party
responsible for these things and it can accept an Executor on construction.
Then the user can decide if all consumers can safely share the same set of
threads, or if they need some other behavior.

What do you think?

Thanks,
Darren.


Rob Harrop-5 wrote:
> 
> Recently I pushed branch bug18384 that changes the way callbacks are sent
> to Consumer implementations.
> 
> Following this change, the Connection maintains a dispatch thread that is
> used to send callbacks to the Consumers. This frees Consumers call
> blocking methods on the Connection and Channel.
> 
> A question came up on Twitter about making this configurable, allowing for
> a custom Executor to be plugged into the ConnectionFactory. I wanted to
> outline why this is complicated, discuss a possible implementation and see
> if there is much interest.
> 
> First off, we should establish that each Consumer should only receive
> callbacks in a single thread. If this is not the case, then chaos will
> ensue and Consumers will need to worry about their own thread safety
> beyond that of initialisation safety.
> 
> With only a single dispatch thread for all Consumers, this Consumer-Thread
> pairing is easy honoured.
> 
> When we introduce multiple threads, we have to ensure that each Consumer
> is paired with only one thread. When using the Executor abstraction, this
> prevents each callback dispatch from being wrapped up in a Runnable and
> sent to Executor, because you cannot guarantee which thread will be used.
> 
> To get around this, the Executor can be set to run 'n' long-running tasks
> (n being the number of threads in the Executor). Each of these tasks pulls
> dispatch instructions off a queue and executes them. Each Consumer is
> paired with one dispatch instruction queue, probably assigned on a
> round-robin basis. This is not too complicated and will provide simple
> balancing of dispatch load across the threads in the Executor.
> 
> Now, there are still some problems:
> 
> 1. The number of threads in an Executor is not necessarily fixed (as with
> ThreadPoolExecutor).
> 2. There is no way, via Executor or ExecutorService to find out how many
> threads there are. Thus, we cannot know how many dispatch instruction
> queues to create.
> 
> However, we can certainly introduce a
> ConnectionFactory.setDispatchThreadCount(int). Behind the scenes this will
> create an Executors.newFixedThreadPool() and the correct number of
> dispatch queues and dispatch tasks.
> 
> I'm interested in hearing if anyone thinks I'm overlooking some simpler
> way of solving this, and indeed if this is even worth solving.
> 
> Regards,
> 
> Rob
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Multi-threaded-Dispatch-in-Java-Client-tp29860178p29868134.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ovidiudeac at gmail.com  Sat Oct  2 22:15:30 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Sun, 3 Oct 2010 00:15:30 +0300
Subject: [rabbitmq-discuss] queue related error when declaring an exchange
Message-ID: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>

Hi,

I get this exception when I try to declare an exchange:

RabbitMQ.Client.Exceptions.OperationInterruptedException : The AMQP
operation was interrupted: AMQP close-reason, initiated by Peer,
code=404, text="NOT_FOUND - no queue 'myqueue' in vhost '/'",
classId=50, methodId=30, cause=
   [nunit2]   at
RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply ()
[0x00000] in <filename unknown>:0
   [nunit2]   at RabbitMQ.Client.Impl.ModelBase.ModelRpc
(RabbitMQ.Client.Impl.MethodBase method,
RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body)
[0x00000] in <filename unknown>:0
   [nunit2]   at
RabbitMQ.Client.Framing.Impl.v0_8.Model.ExchangeDeclare (System.String
exchange, System.String type, Boolean passive, Boolean durable,
Boolean autoDelete, Boolean internal, Boolean nowait, IDictionary
arguments) [0x00000] in <filename unknown>:0
   [nunit2]   at RabbitMQ.Client.Impl.ModelBase.ExchangeDeclare
(System.String exchange, System.String type, Boolean durable)
[0x00000] in <filename unknown>:0
   [nunit2]   at tools.RabbitConnection.ExchangeDeclare (System.String
exchange) [0x00000] in <filename unknown>:0

Does anybody know why it complains about QUEUE NOT FOUND when I call
ExchangeDeclare? Is this a bug or a feature? :)

I'm using .Net client 1.8.0.

Thanks,
Ovidiu

From matthew at rabbitmq.com  Sat Oct  2 23:22:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 2 Oct 2010 23:22:18 +0100
Subject: [rabbitmq-discuss] queue related error when declaring an
 exchange
In-Reply-To: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>
References: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>
Message-ID: <20101002222218.GD8805@wellquite.org>

This exception is not caused by exchange declaration. Can you post the
code that is causing this?

On Sun, Oct 03, 2010 at 12:15:30AM +0300, Ovidiu Deac wrote:
> Hi,
> 
> I get this exception when I try to declare an exchange:
> 
> RabbitMQ.Client.Exceptions.OperationInterruptedException : The AMQP
> operation was interrupted: AMQP close-reason, initiated by Peer,
> code=404, text="NOT_FOUND - no queue 'myqueue' in vhost '/'",
> classId=50, methodId=30, cause=
>    [nunit2]   at
> RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply ()
> [0x00000] in <filename unknown>:0
>    [nunit2]   at RabbitMQ.Client.Impl.ModelBase.ModelRpc
> (RabbitMQ.Client.Impl.MethodBase method,
> RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body)
> [0x00000] in <filename unknown>:0
>    [nunit2]   at
> RabbitMQ.Client.Framing.Impl.v0_8.Model.ExchangeDeclare (System.String
> exchange, System.String type, Boolean passive, Boolean durable,
> Boolean autoDelete, Boolean internal, Boolean nowait, IDictionary
> arguments) [0x00000] in <filename unknown>:0
>    [nunit2]   at RabbitMQ.Client.Impl.ModelBase.ExchangeDeclare
> (System.String exchange, System.String type, Boolean durable)
> [0x00000] in <filename unknown>:0
>    [nunit2]   at tools.RabbitConnection.ExchangeDeclare (System.String
> exchange) [0x00000] in <filename unknown>:0
> 
> Does anybody know why it complains about QUEUE NOT FOUND when I call
> ExchangeDeclare? Is this a bug or a feature? :)
> 
> I'm using .Net client 1.8.0.
> 
> Thanks,
> Ovidiu
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pablo.ruiz at gmail.com  Sun Oct  3 01:39:57 2010
From: pablo.ruiz at gmail.com (Pablo Ruiz)
Date: Sun, 3 Oct 2010 02:39:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ.Client.Net error: SocketException: The
 descriptor is not a socket (on mono 2.8)
Message-ID: <AANLkTinDzr7haVjxVJQsn1DT+=GSPf9aUVj841=SOvOZ@mail.gmail.com>

Hello,

I'm implementing an NServiceBus plugin for RabbitMQ, but when running on
mono I'm getting the following error randomly, I've tested RabbitMQ.Client
versions 1.8.1, 2.0.0 and 2.1.0:

System.Net.Sockets.SocketException: The descriptor is not a socket
  at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel
optionLevel, SocketOptionName optionName, Int32 optionValue) [0x00046] in
/usr/src/redhat/BUILD/mono-2.8/mcs/class/System/System.Net.Sockets/Socket_2_1.cs:718
  at System.Net.Sockets.TcpClient.set_ReceiveTimeout (Int32 value) [0x00026]
in
/usr/src/redhat/BUILD/mono-2.8/mcs/class/System/System.Net.Sockets/TcpClient.cs:225
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.set_Timeout (Int32 value)
[0x00000] in <filename unknown>:0
  at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop () [0x00000] in
<filename unknown>:0


Any clue?

Greets.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101003/2e060834/attachment-0001.htm>

From matthias at rabbitmq.com  Sun Oct  3 08:35:24 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 03 Oct 2010 08:35:24 +0100
Subject: [rabbitmq-discuss] queue related error when declaring an
	exchange
In-Reply-To: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>
References: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>
Message-ID: <4CA8323C.4090203@rabbitmq.com>

Ovidiu,

Ovidiu Deac wrote:
> I get this exception when I try to declare an exchange:
> [...]
> Does anybody know why it complains about QUEUE NOT FOUND when I call
> ExchangeDeclare?

Are you perhaps setting NoWait=true in a preceding queue declaration?

When an asynchronous command causes an exception it is possible for that 
exception to be returned against the next synchronous command since the 
client API has no way of telling which of the two commands caused the 
exception.


Regards,

Matthias.

From matthias at rabbitmq.com  Sun Oct  3 10:27:12 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 03 Oct 2010 10:27:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ.Client.Net error: SocketException:
 The descriptor is not a socket (on mono 2.8)
In-Reply-To: <AANLkTinDzr7haVjxVJQsn1DT+=GSPf9aUVj841=SOvOZ@mail.gmail.com>
References: <AANLkTinDzr7haVjxVJQsn1DT+=GSPf9aUVj841=SOvOZ@mail.gmail.com>
Message-ID: <4CA84C70.3010004@rabbitmq.com>

Pablo,

Pablo Ruiz wrote:
> I'm getting the following error randomly: [...]
> 
> System.Net.Sockets.SocketException: The descriptor is not a socket
> [...]
>   at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop () [0x00000] in 
> <filename unknown>:0

That looks like a race between the server closing the socket and the 
client setting a timeout on the socket. I've filed a bug to look into this.

As a quick hack to work around this you may want to try commenting out 
the 'm_frameHandler.Timeout = ConnectionCloseTimeout' line in 
ConnectionBase.ClosingLoop.


Regards,

Matthias.

From ovidiudeac at gmail.com  Sun Oct  3 13:58:18 2010
From: ovidiudeac at gmail.com (Ovidiu Deac)
Date: Sun, 3 Oct 2010 15:58:18 +0300
Subject: [rabbitmq-discuss] queue related error when declaring an
	exchange
In-Reply-To: <4CA8323C.4090203@rabbitmq.com>
References: <AANLkTi=z-6S+BufjyND4GR9jCWe61=vtovbsSHKWi5Ko@mail.gmail.com>
	<4CA8323C.4090203@rabbitmq.com>
Message-ID: <AANLkTinTs-ysp2p-dQ7byboGGtA-ix6d8UPBRxRsvNYP@mail.gmail.com>

You are right. I was doing that.

Thanks!

On Sun, Oct 3, 2010 at 10:35 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Ovidiu,
>
> Ovidiu Deac wrote:
>>
>> I get this exception when I try to declare an exchange:
>> [...]
>> Does anybody know why it complains about QUEUE NOT FOUND when I call
>> ExchangeDeclare?
>
> Are you perhaps setting NoWait=true in a preceding queue declaration?
>
> When an asynchronous command causes an exception it is possible for that
> exception to be returned against the next synchronous command since the
> client API has no way of telling which of the two commands caused the
> exception.
>
>
> Regards,
>
> Matthias.
>

From tim at cantemo.com  Sun Oct  3 17:10:26 2010
From: tim at cantemo.com (Tim Child)
Date: Sun, 3 Oct 2010 18:10:26 +0200
Subject: [rabbitmq-discuss] Installation problems on Ubuntu 10.04 LTS
In-Reply-To: <AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
Message-ID: <B93133F9-C884-4BBE-B587-01F9836AE2D6@cantemo.com>

Hi, 

I just tried to do an installation on a completely fresh ubuntu 10.04 LTS Server, following the instructions here: http://www.rabbitmq.com/debian.html#apt  and I get the following problem:

Setting up erlang-crypto (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-mnesia (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-runtime-tools (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-snmp (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-os-mon (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-public-key (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-ssl (1:13.b.3-dfsg-2ubuntu2) ...
Setting up erlang-syntax-tools (1:13.b.3-dfsg-2ubuntu2) ...
Setting up libsctp1 (1.0.11+dfsg-1) ...

Setting up lksctp-tools (1.0.11+dfsg-1) ...
Setting up rabbitmq-server (2.1.0-1) ...
Adding group `rabbitmq' (GID 106) ...
Done.
Adding system user `rabbitmq' (UID 103) ...
Adding new user `rabbitmq' (UID 103) with group `rabbitmq' ...
Not creating home directory `/var/lib/rabbitmq'.
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)



In /var/log/rabbitmq/startup_err I get:

	Error: {cannot_connect_to_epmd,"portal2",nxdomain}

portal2 is part of the domain name though the actual hostname in /etc/hostname is set to portal2.cantemo.lan.

There is also nothing in /etc/rabbitmq/

Any ideas?

Thanks




Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101003/b724dba4/attachment.htm>

From ralf.kistner at gmail.com  Sun Oct  3 18:18:28 2010
From: ralf.kistner at gmail.com (Ralf Kistner)
Date: Sun, 3 Oct 2010 19:18:28 +0200
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
Message-ID: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>

For my application I have many users that need to publish messages.
When processing messages, I need to validate that the user had
permission to perform the requested operations.

I could not find any way for the consumer of the message to determine
the identity of the user that sent the message. Is this possible, or
do I have to send kind of authorization token with every message?

Currently I'm using STOMP for the connection to the clients. An
alternative would be to create some middle layer between the clients
and RabbitMQ. This middle layer could then automatically add
authorization tokens to each message. Any comments on this? Would it
be better to implement this middle layer as a plugin in RabbitMQ, or
as a separate AMQP client?

From ralf.kistner at gmail.com  Sun Oct  3 18:25:49 2010
From: ralf.kistner at gmail.com (Ralf Kistner)
Date: Sun, 3 Oct 2010 19:25:49 +0200
Subject: [rabbitmq-discuss] Questions on RabbitMQ
In-Reply-To: <396F9222-9382-48DC-83F6-6AE7BA6F51CA@jbrisbin.com>
References: <AANLkTikrFyz3FiBf9cqEhizWUehAOgjZtFd4H81KYUgB@mail.gmail.com>
	<396F9222-9382-48DC-83F6-6AE7BA6F51CA@jbrisbin.com>
Message-ID: <AANLkTikTq04iJQVtdWUG6gJbm6B58Seqbsp6Ke1Ehc8G@mail.gmail.com>

Thanks for the response.

EventMachine looks perfect for my Ruby script.

I'm already using MongoDB for other parts of my application, so I'll
use it to implement a similar approach to what you suggested.
My messages will mostly be binary data, but that shouldn't make a big
difference.

I'll use an additional consumer (on routing key "#") , to ensure that
the messages are all persisted even when my consumer is broken and
silently discards messages (this happened to me in the past).

Ralf


On Sat, Sep 25, 2010 at 2:59 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> On Sep 25, 2010, at 6:07 AM, Ralf Kistner wrote:
>
> 2 a. Are there any recommended practices for running a (Ruby) process
> to consume messages in an infinite loop?
>
> Check out the AMQP stuff in Ruby. It uses EventMachine. EM will run until
> you tell it to stop, which is what you're looking for.
>
> 2 b. The Ruby script would occasionally be unable to process a
> message. This could be because of a temporary lock on the database, an
> invalid message from the mobile client, or a bug on the server. The
> ideal would be for these messages to be retried a few times, then
> moved to a different queue if it still fails. The messages in the
> queue could then be inspected manually, and moved back to the original
> queue when the bug was fixed.
> How would this be accomplished? Does RabbitMQ have something like a
> dead letter queue? Or would I have to move the message to a different
> queue myself (in the Ruby script), in case of an error?
> Note that I can't return any messages to the sender, I want to keep it
> on the server in a different queue.
>
> Redelivery is something I'm working on in my own application. I use it to
> update databases at remote locations that might or might not be online. If I
> get a timeout error, I write my message into a Riak bucket. There is a
> Quartz-based job that runs every five minutes that checks this retry bucket
> and simply deletes the messages and dumps them back into the broker. I
> haven't put it in yet, but I'm planning on implementing a "maxRetries" so
> that when a message exceeds the retry number, it will be either sent to a
> notification queue where it gets emailed, or moved to another Riak bucket
> where I can write an RSS feed over the top of it.
>
> 3. What is the best way to create a backup of all the message sent to
> the server? Does RabbitMQ automatically do this, or should I write an
> additional consumer to create a backup?
>
> A NoSQL store where you keep the entire message in JSON format seems to me
> the safest and most performant way to persist messages with enough
> information to be able to resubmit the message at a later time. I have
> security tokens in the headers (I don't use logins but tokens) and of course
> I have to capture the exchange and routing key information. I use JSON data
> for my messages, so this fits nicely together but you could also base64
> encode your data.
> You could use an additional consumer (e.g. on routing key "#") but I let the
> consumer decide whether to persist a message to Riak or not.
>
> Thanks!
> J. Brisbin
> http://jbrisbin.com/
>
>
>
>
>
>

From davegreggory at yahoo.com  Sun Oct  3 19:09:18 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Sun, 3 Oct 2010 11:09:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Shutdown Listener on Java Client API
In-Reply-To: <B332427A-10AA-4C9F-AF44-7CFB2ABE0690@yahoo.com>
References: <509856.68626.qm@web111016.mail.gq1.yahoo.com>
	<4C90B33F.6090002@rabbitmq.com>
	<847412.22324.qm@web111008.mail.gq1.yahoo.com>
	<4CA25934.1000903@rabbitmq.com>
	<B332427A-10AA-4C9F-AF44-7CFB2ABE0690@yahoo.com>
Message-ID: <813798.92480.qm@web111001.mail.gq1.yahoo.com>

We upgraded our production nodes to 2.0 last night. Client were still on the 
1.8.1 java client API. This happened again this morning starting around 9:51 AM 
until 2:00 PM, when I decided to re-start the client (message producer).  Since 
the "alleged" connection loss (or blocked connection) went undetected by the 
shutDownListener for over 4 hours, maybe it might be the client API.

We will eventually upgrade clients to 2.0 API as well, but there's a  dependency 
on Spring AMQP there, so will wait for the next milestone  build of that. 


Of course, we haven't setup the AMQP heartbeats as you originally recommended, 
plan to do so in our next release. Hoping that will help, but thought I'd give 
you an update that it happened with 2.0 broker as well.


      

From majek04 at gmail.com  Mon Oct  4 10:42:50 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 4 Oct 2010 10:42:50 +0100
Subject: [rabbitmq-discuss] Installation problems on Ubuntu 10.04 LTS
In-Reply-To: <B93133F9-C884-4BBE-B587-01F9836AE2D6@cantemo.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
	<B93133F9-C884-4BBE-B587-01F9836AE2D6@cantemo.com>
Message-ID: <AANLkTik8A0tuQQfGzvvr0d_kzGFrfzyK+95=22NfugM+@mail.gmail.com>

On Sun, Oct 3, 2010 at 17:10, Tim Child <tim at cantemo.com> wrote:
> I just tried to do an installation on a completely fresh ubuntu 10.04 LTS
> Server, following the instructions
> here:?http://www.rabbitmq.com/debian.html#apt ?and I get the following
> problem:
>
> In /var/log/rabbitmq/startup_err I get:
> Error: {cannot_connect_to_epmd,"portal2",nxdomain}
> portal2 is part of the domain name though the actual hostname in
> /etc/hostname is set to?portal2.cantemo.lan.

I'll try to reproduce that, have you used 64 bit or 32 bit image?
Is your hostname resolvable (ie: can you "ping portal2.cantemo.lan")?

Marek

From tim at cantemo.com  Mon Oct  4 11:23:35 2010
From: tim at cantemo.com (Tim Child)
Date: Mon, 4 Oct 2010 12:23:35 +0200
Subject: [rabbitmq-discuss] Installation problems on Ubuntu 10.04 LTS
In-Reply-To: <AANLkTik8A0tuQQfGzvvr0d_kzGFrfzyK+95=22NfugM+@mail.gmail.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
	<B93133F9-C884-4BBE-B587-01F9836AE2D6@cantemo.com>
	<AANLkTik8A0tuQQfGzvvr0d_kzGFrfzyK+95=22NfugM+@mail.gmail.com>
Message-ID: <4290B168-2A8F-4ABB-A78F-28C179CF78C0@cantemo.com>

Mmm. If I ping to that it resolves to: portal2.cantemo.lan.cantemo.lan (127.0.1.1)

And its a 64bit machine. So I have changed my /etc/hosts to:

127.0.1.1 portal2 portal2.cantemo.lan

And reran the apt-get to install, and now its working. Not sure where it got that long domain from, but I will investigate.

Thanks,

Tim.



On 4 Oct 2010, at 11:42, Marek Majkowski wrote:

> On Sun, Oct 3, 2010 at 17:10, Tim Child <tim at cantemo.com> wrote:
>> I just tried to do an installation on a completely fresh ubuntu 10.04 LTS
>> Server, following the instructions
>> here: http://www.rabbitmq.com/debian.html#apt  and I get the following
>> problem:
>> 
>> In /var/log/rabbitmq/startup_err I get:
>> Error: {cannot_connect_to_epmd,"portal2",nxdomain}
>> portal2 is part of the domain name though the actual hostname in
>> /etc/hostname is set to portal2.cantemo.lan.
> 
> I'll try to reproduce that, have you used 64 bit or 32 bit image?
> Is your hostname resolvable (ie: can you "ping portal2.cantemo.lan")?
> 
> Marek

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101004/6a1e9724/attachment.htm>

From majek04 at gmail.com  Mon Oct  4 11:27:00 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 4 Oct 2010 11:27:00 +0100
Subject: [rabbitmq-discuss] Installation problems on Ubuntu 10.04 LTS
In-Reply-To: <4290B168-2A8F-4ABB-A78F-28C179CF78C0@cantemo.com>
References: <CDF8CA2B-B7A7-4401-8F6C-DB0A6C04FEBF@ketralnis.com>
	<AANLkTimj3ZHCOz37cv=Js_5So80r+HRfJQPM+QhL69fL@mail.gmail.com>
	<B93133F9-C884-4BBE-B587-01F9836AE2D6@cantemo.com>
	<AANLkTik8A0tuQQfGzvvr0d_kzGFrfzyK+95=22NfugM+@mail.gmail.com>
	<4290B168-2A8F-4ABB-A78F-28C179CF78C0@cantemo.com>
Message-ID: <AANLkTi=W94AYt0CC-8VzuKNT1HSCQP6StfKR1by=hega@mail.gmail.com>

On Mon, Oct 4, 2010 at 11:23, Tim Child <tim at cantemo.com> wrote:
> Mmm. If I ping to that it resolves to:?portal2.cantemo.lan.cantemo.lan
> (127.0.1.1)
> And its a 64bit machine. So I have changed my /etc/hosts to:
> 127.0.1.1 portal2 portal2.cantemo.lan
> And reran the apt-get to install, and now its working. Not sure where it got
> that long domain from, but I will investigate.

Great! Erlang depends on a proper and resolvable long domain name, so
do make sure it's correct.

Marek

From majek04 at gmail.com  Mon Oct  4 14:20:44 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 4 Oct 2010 14:20:44 +0100
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
In-Reply-To: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
References: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
Message-ID: <AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>

On Sun, Oct 3, 2010 at 18:18, Ralf Kistner <ralf.kistner at gmail.com> wrote:
> For my application I have many users that need to publish messages.
> When processing messages, I need to validate that the user had
> permission to perform the requested operations.
>
> I could not find any way for the consumer of the message to determine
> the identity of the user that sent the message. Is this possible, or
> do I have to send kind of authorization token with every message?
>
> Currently I'm using STOMP for the connection to the clients. An
> alternative would be to create some middle layer between the clients
> and RabbitMQ. This middle layer could then automatically add
> authorization tokens to each message. Any comments on this? Would it
> be better to implement this middle layer as a plugin in RabbitMQ, or
> as a separate AMQP client?

Ralf,

I don't think STOMP adds any auth headers to messages. STOMP is
basically a very simple protocol, and should remain as simple as possible.

I'm not sure what setup you have, but can you just implement authentication
inside your application? Maybe a crypto signature that comes with the message?

Cheers,
  Marek

From ralf.kistner at gmail.com  Mon Oct  4 14:38:02 2010
From: ralf.kistner at gmail.com (Ralf Kistner)
Date: Mon, 4 Oct 2010 15:38:02 +0200
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
In-Reply-To: <AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>
References: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
	<AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>
Message-ID: <AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>

I'm have a client that runs on mobile phones, that are sending
messages to my server (via STOMP on RabbitMQ).

I could add a signature to each message, but it could add significant
overhead to the messages. It would also be difficult to notify the
mobile client when its signature is invalid.

So far the best solution seems to be to implement a custom protocol,
with a small application on the server relaying the messages to
RabbitMQ via AMQP.

Ralf

>
> Ralf,
>
> I don't think STOMP adds any auth headers to messages. STOMP is
> basically a very simple protocol, and should remain as simple as possible.
>
> I'm not sure what setup you have, but can you just implement authentication
> inside your application? Maybe a crypto signature that comes with the message?
>
> Cheers,
> ?Marek
>

From majek04 at gmail.com  Mon Oct  4 15:15:48 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 4 Oct 2010 15:15:48 +0100
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
In-Reply-To: <AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>
References: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
	<AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>
	<AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>
Message-ID: <AANLkTimLP7SHXpVj4g7sr7t_toy_a7dRbwgVjLwMhkEN@mail.gmail.com>

On Mon, Oct 4, 2010 at 14:38, Ralf Kistner <ralf.kistner at gmail.com> wrote:
> So far the best solution seems to be to implement a custom protocol,
> with a small application on the server relaying the messages to
> RabbitMQ via AMQP.

Sounds fine. I suggest HTTP if it suits your use case. Ruby eventmachine
library is pretty pleasant, python Twisted one is okay but requires a bit
more time to learn.

Marek

From lionel.cons at cern.ch  Mon Oct  4 15:50:44 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 04 Oct 2010 16:50:44 +0200
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com> (Rob Harrop's
	message of "Fri, 1 Oct 2010 16:35:07 +0200")
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
Message-ID: <vfqk4lyhv0b.fsf@mail.cern.ch>

Rob Harrop <rob at rabbitmq.com> writes:
> This design proposes to remove the custom headers, and use only the
> `destination` header with compound values that define the exchange,
> routing key and queue names.

Rob,

This looks very good.

There is one additional use case which is often needed: private
temporary queues to get replies back. This maps to the Return Address
concept in Enterprise Integration Patterns.

Is this something that could be done with your proposed syntax?

Also, what about AMQP 1.0? Have you considered it in order to get a
syntax that can be adapted/extended to the new AMQP 1.0 concepts?

Cheers,

Lionel

From mikeb at rabbitmq.com  Mon Oct  4 16:27:01 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 04 Oct 2010 16:27:01 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <vfqk4lyhv0b.fsf@mail.cern.ch>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<vfqk4lyhv0b.fsf@mail.cern.ch>
Message-ID: <4CA9F245.8010309@rabbitmq.com>

>> This design proposes to remove the custom headers, and use only the
>> `destination` header with compound values that define the exchange,
>> routing key and queue names.
>
> Rob,
>
> This looks very good.
>
> There is one additional use case which is often needed: private
> temporary queues to get replies back. This maps to the Return Address
> concept in Enterprise Integration Patterns.
>
> Is this something that could be done with your proposed syntax?

Since there's no reply from the server to SUBSCRIBE, and we generally 
want reply queues to have different properties to shared queues, really 
the only option is to have a distinguished prefix for reply queue 
destinations, and require clients to supply their own (preferably fresh) 
names.

For example:
SUBSCRIBE /reply/<md5 of some client properties>

It might be an idea to use queue leases for these, instead of 
auto-delete, so that a client fronting up after a connection drop has a 
chance of recovering replies. (If it's lost its own state, then it 
should construct a fresh name)

> Also, what about AMQP 1.0? Have you considered it in order to get a
> syntax that can be adapted/extended to the new AMQP 1.0 concepts?

Do you mean using something like /node/ for destinations?

There aren't really any such concepts in AMQP 1.0 to pin a concrete 
protocol implementation to.  It's only a message exchange protocol, and 
just like STOMP, doesn't take an opinion on what is addressable at the 
broker.  Indeed, if we were to make an AMQP 1.0 adapter, we'd have to 
invent some scheme for addressing exchanges and queues there, too.


Michael.

From mc at majorcomputing.com  Mon Oct  4 16:48:47 2010
From: mc at majorcomputing.com (Pedram Nimreezi)
Date: Mon, 4 Oct 2010 11:48:47 -0400
Subject: [rabbitmq-discuss] I have a question about disc nodes..
Message-ID: <AANLkTimYpYqUByQAo7PS1-7PA_79JZwE=1adc-cLwLyw@mail.gmail.com>

I have setup a cluster with 2 disc nodes and 1 or more ram nodes,

I create a durable exchange and a durable queue

I check the list_queues, list_bindings command on each server and it works.

If i take down the first disc node all the queues disappear...

Is this normal?  how can i make the queue persist if at least 1 disc node is
online?

I don't care if i lose the messages from the server that failed, but I can't
let the queues just disappear..

I'm routing to a direct topic bound to queues using routing keys under the
same name..

The list_exchanges still shows the exchange, but the queues are missing as
soon as disc node1 is brought down..

regadless if ram nodes or another disc node is up...  Please advise..


-- 
/* Sincerely
-------------------------------------------------------------- */
Pedram N.
Every man is guilty of every good he did not do - Voltaire
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101004/866817f5/attachment.htm>

From alexandru at rabbitmq.com  Mon Oct  4 17:14:31 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 4 Oct 2010 17:14:31 +0100
Subject: [rabbitmq-discuss] I have a question about disc nodes..
In-Reply-To: <AANLkTimYpYqUByQAo7PS1-7PA_79JZwE=1adc-cLwLyw@mail.gmail.com>
References: <AANLkTimYpYqUByQAo7PS1-7PA_79JZwE=1adc-cLwLyw@mail.gmail.com>
Message-ID: <20101004161431.GA2818@dakota.eng.vmware.com>

Hi,

> I have setup a cluster with 2 disc nodes and 1 or more ram nodes,
> I create a durable exchange and a durable queue
> I check the list_queues, list_bindings command on each server and it works.
> If i take down the first disc node all the queues disappear...

When you declare a queue, it's only created on the node you declared it
on (but it's accessible from all nodes in the cluster).  This means that
if the node is taken down, all of its queues disappear.  What's worse,
if you then try to redeclare a persistent queue on another node,
you'll get a 404 "Not Found" error.

So, what you're seeing is expected behaviour.

>  how can i make the queue persist if at least 1 disc node is
> online?

Have a look at our HA with RabbitMQ Guide [1].  It gives you the steps
necessary to create an active/passive RabbitMQ Cluster (so, when the
first disk nodes goes down, the second just takes its place).  Of
course, this would mean one of the two disk nodes would not be used
until the other fails.

The might be other things you could try.  What are you trying to achieve?

If you don't care about losing some messages, why not just have each
client declare the queue when it needs it?  (i.e. just do a
queue.declare before using the queue).  This way, if the queue's
missing, it will be created, but if it's already there, you'll just use
the old one.

Cheers,
Alex

[1] http://www.rabbitmq.com/pacemaker.html


On Mon, Oct 04, 2010 at 11:48:47AM -0400, Pedram Nimreezi wrote:
> I have setup a cluster with 2 disc nodes and 1 or more ram nodes,
> 
> I create a durable exchange and a durable queue
> 
> I check the list_queues, list_bindings command on each server and it works.
> 
> If i take down the first disc node all the queues disappear...
> 
> Is this normal?  how can i make the queue persist if at least 1 disc node is
> online?
> 
> I don't care if i lose the messages from the server that failed, but I can't
> let the queues just disappear..
> 
> I'm routing to a direct topic bound to queues using routing keys under the
> same name..
> 
> The list_exchanges still shows the exchange, but the queues are missing as
> soon as disc node1 is brought down..
> 
> regadless if ram nodes or another disc node is up...  Please advise..
> 
> 
> -- 
> /* Sincerely
> -------------------------------------------------------------- */
> Pedram N.
> Every man is guilty of every good he did not do - Voltaire

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tsuraan at gmail.com  Mon Oct  4 18:04:23 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 4 Oct 2010 12:04:23 -0500
Subject: [rabbitmq-discuss] Using Toke
Message-ID: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>

Is there a setup guide somewhere for the Toke plugin?  The plugins
page (http://www.rabbitmq.com/plugins.html) doesn't mention it, and
there isn't a README in the rabbitmq-toke project.  My rabbit build
environment is just a download of the 2.1.0 tarball; I have tokyo
cabinet installed, so after that, what do I need to do to get Toke
running?  Also, is there a way to tell that toke is running on a given
rabbit process?

From matthew at rabbitmq.com  Mon Oct  4 18:27:30 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 4 Oct 2010 18:27:30 +0100
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
Message-ID: <20101004172730.GT20604@rabbitmq.com>

On Mon, Oct 04, 2010 at 12:04:23PM -0500, tsuraan wrote:
> Is there a setup guide somewhere for the Toke plugin?  The plugins
> page (http://www.rabbitmq.com/plugins.html) doesn't mention it, and
> there isn't a README in the rabbitmq-toke project.  My rabbit build
> environment is just a download of the 2.1.0 tarball; I have tokyo
> cabinet installed, so after that, what do I need to do to get Toke
> running?  Also, is there a way to tell that toke is running on a given
> rabbit process?

Sadly, it's all a bit of a mess just at the moment.

rabbitmq-toke requires toke, which requires tokyocabinet to be
installed.

Because we don't ship native code, and because we certainly don't want
to ship tokyocabinet, the rabbitmq-toke package was never added to our
overall list of plugins in the rabbitmq-public-umbrella repo. As a
result of this, recent changes to the public umbrella build mechanism
managed to break rabbitmq-toke (amongst other things).

I've spent the last two weeks rewriting the whole build system, pretty
much from scratch, and it's now vastly improved and rabbitmq-toke works
again now, however, that work has not yet been through QA, and is thus
only available on branch bug23274. Thus, the following should work:

First, install tokyocabinet locally, including development headers -
compiling from source is your best bet.

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23274
cd rabbitmq-public-umbrella
make checkout
cd rabbitmq-toke
make -j
make run_in_broker

You should then see as part of the rabbit boot steps:
starting Tokyo Cabinet for rabbit_msg_store    ...done

If you exit the broker, then ls dist/*.ez, you should see something
like:

rabbitmq-toke$ ls dist/*.ez
dist/amqp_client-0.0.0.ez  dist/rabbit_common-0.0.0.ez
dist/rabbit_toke-0.0.0.ez  dist/toke-0.0.0.ez

Copy all but the rabbit_common to your server plugins dir. Now I _think_
you should be ok running these with a 2.1.0 broker, but you may not be -
you may have to run the latest broker from default.

Hopefully, this building mess will be sorted in the next day or two, as
this new work gets through QA. However, there is a general issue with
toke that we don't want to ship native code, but can't build or package
toke without. Certainly, the website plugins page should be properly
updated soon.

Matthew

From tsuraan at gmail.com  Mon Oct  4 18:49:46 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 4 Oct 2010 12:49:46 -0500
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <20101004172730.GT20604@rabbitmq.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
Message-ID: <AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>

> If you exit the broker, then ls dist/*.ez, you should see something
> like:
>
> rabbitmq-toke$ ls dist/*.ez
> dist/amqp_client-0.0.0.ez ?dist/rabbit_common-0.0.0.ez
> dist/rabbit_toke-0.0.0.ez ?dist/toke-0.0.0.ez

Strange, some things are getting the -0.0.0 part, and some aren't.
The amqp_client and rabbit_common didn't get the -0.0.0, but the toke
did, so I made links from the files that were created to the -0.0.0
locations.  I haven't been able to get the actual rabbitmq-toke to
build yet; I get this error:

ERL_LIBS=/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/dist
erlc  -Wall +debug_info -I
/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/include -pa
/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin -o
/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin
/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/src/rabbit_msg_store_toke_index.erl
src/rabbit_msg_store_toke_index.erl:46: can't find include lib
"rabbit_common/include/rabbit_msg_store_index.hrl"
src/rabbit_msg_store_toke_index.erl:73: record msg_location undefined
src/rabbit_msg_store_toke_index.erl:76: record msg_location undefined
src/rabbit_msg_store_toke_index.erl:77: variable 'Guid' is unbound
src/rabbit_msg_store_toke_index.erl:86: record msg_location undefined
src/rabbit_msg_store_toke_index.erl:95: record msg_location undefined
src/rabbit_msg_store_toke_index.erl:96: variable 'Guid' is unbound
src/rabbit_msg_store_toke_index.erl:101: record msg_location undefined
make: *** [/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin/rabbit_msg_store_toke_index.beam]
Error 1

I don't think the dist dir is being included somehow, although ls
dist/rabbit_common/include (from the rabbitmq-toke dir) does give me
rabbit.hrl and rabbit_msg_store_index.hrl.  Could this be related to
the fact that I'm using links to the 0.0.0 files instead of getting
them generated properly?

From tsuraan at gmail.com  Mon Oct  4 19:53:15 2010
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 4 Oct 2010 13:53:15 -0500
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
	<AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
Message-ID: <AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>

> Strange, some things are getting the -0.0.0 part, and some aren't.
> The amqp_client and rabbit_common didn't get the -0.0.0, but the toke
> did, so I made links from the files that were created to the -0.0.0
> locations. ?I haven't been able to get the actual rabbitmq-toke to
> build yet; I get this error:
>
> ERL_LIBS=/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/dist
> erlc ?-Wall +debug_info -I
> /home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/include -pa
> /home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin -o
> /home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin
> /home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/src/rabbit_msg_store_toke_index.erl
> src/rabbit_msg_store_toke_index.erl:46: can't find include lib
> "rabbit_common/include/rabbit_msg_store_index.hrl"
> src/rabbit_msg_store_toke_index.erl:73: record msg_location undefined
> src/rabbit_msg_store_toke_index.erl:76: record msg_location undefined
> src/rabbit_msg_store_toke_index.erl:77: variable 'Guid' is unbound
> src/rabbit_msg_store_toke_index.erl:86: record msg_location undefined
> src/rabbit_msg_store_toke_index.erl:95: record msg_location undefined
> src/rabbit_msg_store_toke_index.erl:96: variable 'Guid' is unbound
> src/rabbit_msg_store_toke_index.erl:101: record msg_location undefined
> make: *** [/home/tsuraan/rabbitmq-public-umbrella/rabbitmq-toke/ebin/rabbit_msg_store_toke_index.beam]
> Error 1
>
> I don't think the dist dir is being included somehow, although ls
> dist/rabbit_common/include (from the rabbitmq-toke dir) does give me
> rabbit.hrl and rabbit_msg_store_index.hrl. ?Could this be related to
> the fact that I'm using links to the 0.0.0 files instead of getting
> them generated properly?

Ok, so it looks like it was due to this. I modified
rabbitmq-erlang-client/common.mk and added APPEND_VERSION=1 near the
top, and everything built nicely.  For toke to build, I had to change
its makefile so that CFLAGS was set to
"-I/usr/lib64/erlang/usr/include/"; apparently gentoo doesn't put
erlang headers into the common include dir.  Erlang also doesn't
appear to do the pkgconfig thing, so I'm not sure how you can automate
the detection of the header paths.  Anyhow, off to testing now :)

From alexis at rabbitmq.com  Mon Oct  4 21:10:03 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 4 Oct 2010 21:10:03 +0100
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTikg4m5+Rs1K-Ne_Fb+wBpSNi5giyD9o=WsEJABH@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
	<AANLkTim4a=MNStVE-yHqE+4NYQ2cNnm8zLaxS1ozYDvP@mail.gmail.com>
	<AANLkTinGAoiRjYaO8fkg9H01fYN9sA2GZtrvZ6zGP1kJ@mail.gmail.com>
	<AANLkTikg4m5+Rs1K-Ne_Fb+wBpSNi5giyD9o=WsEJABH@mail.gmail.com>
Message-ID: <AANLkTimBbgDW=+nJbyzqCOuDQC5pU4ceaR8q3wH23S7n@mail.gmail.com>

Thiago

You must tell the perl community about this!  Eg. guys like Theo.

As for Rabbit/091 vs Qpid/010 .. I don't want to say much about that
but it's fair to say that 0-10 introduces new features, while 0-9-1
tries to make the core features more stable across implementations.

alexis


On Wed, Sep 29, 2010 at 4:17 PM, Thiago Rondon <thiago.rondon at gmail.com> wrote:
>> Thiago,
>> I ended up picking RabbitMQ because of its maturity and because Celery says
>> it's the most commonly used and since I'm definitely using Celery, the rest
>> is a cascading decision for me.
>> In the interest of completeness however, people are also using ZeroMQ also
>> which has alot of open source support and goes through OpenAMQ (at least
>> that's how I understand it):
>> http://www.zeromq.org/docs:welcome-from-amqp
>> http://www.openamq.org/
>> For me it's all about Python support and docs (since I'm
>> developer-constrained).
>> -Adam
>
> Adam,
>
> I'm starting to develop this library in Perl for make simple syntax to
> librabbitmq (and to learn about) .
>
> http://github.com/maluco/Net-RabbitMQ-Simple
>
> Suggestions are welcome.
>
> -Thiago Rondon
>

From therevoltingx at gmail.com  Mon Oct  4 21:17:31 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 4 Oct 2010 13:17:31 -0700
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
In-Reply-To: <AANLkTimLP7SHXpVj4g7sr7t_toy_a7dRbwgVjLwMhkEN@mail.gmail.com>
References: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
	<AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>
	<AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>
	<AANLkTimLP7SHXpVj4g7sr7t_toy_a7dRbwgVjLwMhkEN@mail.gmail.com>
Message-ID: <AANLkTi=K_bz6Mz2q+eMHJHTcd=JRusVm5dVA2eP5zFmi@mail.gmail.com>

I've run into this issue as well.  I couldn't find a good way to
authenticate packets without having to add extra authentication data.
It actually wasn't an issue beside perhaps the extra bytes.

However, I decided that each user would have an account in the broker.
 I was still unable to figure out how to authenticate users when they
post to a single queue.

For now, I create a queue for each user and user their (encrypted)
password as the binding key.  Then I just keep a consumer process for
each user.  (So each user can only post to that one queue)

Not sure if that's the optimal approach, but it keeps the structure
fairly clean.

On Mon, Oct 4, 2010 at 7:15 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Mon, Oct 4, 2010 at 14:38, Ralf Kistner <ralf.kistner at gmail.com> wrote:
>> So far the best solution seems to be to implement a custom protocol,
>> with a small application on the server relaying the messages to
>> RabbitMQ via AMQP.
>
> Sounds fine. I suggest HTTP if it suits your use case. Ruby eventmachine
> library is pretty pleasant, python Twisted one is okay but requires a bit
> more time to learn.
>
> Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://diastrofunk.com,
http://www.youtube.com/user/revoltingx

From adam at varud.com  Mon Oct  4 22:09:51 2010
From: adam at varud.com (Adam Nelson)
Date: Mon, 4 Oct 2010 17:09:51 -0400
Subject: [rabbitmq-discuss] Authorization in RabbitMQ
In-Reply-To: <AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>
References: <AANLkTika=aNG9dU__t4U4iBUBXkuOHkAO-6ibO8MH2yF@mail.gmail.com>
	<AANLkTikrgsVv75Ofv3u395-q7MAjCDtg8fFf7dkVe+8i@mail.gmail.com>
	<AANLkTikERKMEoEZyb5VnQWLmVOTrPq=9EqEVREaO+PQT@mail.gmail.com>
Message-ID: <AANLkTikLc-H-6QA4eHi77mHzvRJ2U8=QKcNLtrH_X1gN@mail.gmail.com>

>
>
> So far the best solution seems to be to implement a custom protocol,
> with a small application on the server relaying the messages to
> RabbitMQ via AMQP.
>
>
Ralf,

You could also check out some of the stuff Urban Airship is doing:

http://blog.urbanairship.com/
http://urbanairship.com/developers/

They're using Cassandra/Python, but the authentication issue from mobile
devices can't be that much different for RabbitMQ/Ruby.

-Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101004/a8cbcb3d/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Oct  4 23:13:22 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 4 Oct 2010 23:13:22 +0100
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
	<AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
	<AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>
Message-ID: <20101004221321.GA9729@wellquite.org>

On Mon, Oct 04, 2010 at 01:53:15PM -0500, tsuraan wrote:
> Ok, so it looks like it was due to this.

Yup, I was in a rehearsal so couldn't reply but yes, your erlang client
also needed to be on bug23274 - or for you to make the change you
figured out ;)

> For toke to build, I had to change
> its makefile so that CFLAGS was set to
> "-I/usr/lib64/erlang/usr/include/"; apparently gentoo doesn't put
> erlang headers into the common include dir.

Good to know - I'll try and incorporate that somehow.

> Erlang also doesn't
> appear to do the pkgconfig thing, so I'm not sure how you can automate
> the detection of the header paths.  Anyhow, off to testing now :)

Excellent. You'll find it's a bit slower than ets but that's inevitable
as it's disk and not RAM.

Matthew

From lionel.cons at cern.ch  Tue Oct  5 08:07:06 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 05 Oct 2010 09:07:06 +0200
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <4CA9F245.8010309@rabbitmq.com> (Michael Bridgen's message of
	"Mon, 4 Oct 2010 17:27:01 +0200")
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<vfqk4lyhv0b.fsf@mail.cern.ch> <4CA9F245.8010309@rabbitmq.com>
Message-ID: <vfqaamt5d9h.fsf@mail.cern.ch>

Michael Bridgen <mikeb at rabbitmq.com> writes:
> Since there's no reply from the server to SUBSCRIBE, and we generally 
> want reply queues to have different properties to shared queues, really 
> the only option is to have a distinguished prefix for reply queue 
> destinations, and require clients to supply their own (preferably fresh) 
> names.

In practice, other solutions exist. I'm not sure which one is
preferable.

(1) With ActiveMQ, one can subscribe to /temp-queue/whatever and a
private queue with a random name will be created on the broker. The
client program can send a message to itself, examine the destination
header of the received message and find out this way what is the real
queue name.

(2) We could imagine using the RECEIPT frame to allow the broker to
"reply" to the client. Something like:

  SUBSCRIBE /i-want-a-private-queue
  receipt:123

  RECEIPT
  receipt-id:123
  destination:/queue/004b2782fba54d18576bc2c710b517b1

> SUBSCRIBE /reply/<md5 of some client properties>

This would work too.

>> Also, what about AMQP 1.0? Have you considered it in order to get a
>> syntax that can be adapted/extended to the new AMQP 1.0 concepts?
>
> Do you mean using something like /node/ for destinations?

For instance. AMQP 1.0 has nodes, queues, links and filters (and no more
exchanges). They should be exposed via STOMP somehow.

In addition, AMQP 1.0 introduced the notion of global addressing,
something like node-name at container. This should also be usable from
STOMP.

However, I'm not up-to-date with what AMQP 1.0 really is today. Concepts
like remote addressing have been described for instance in last year's
F2F meeting:
http://www.amqp.org/confluence/download/attachments/2523324/AMQP+F2F+Presentation.pdf
I don't know if these are still relevant...

Cheers,

Lionel

From davorin.rusevljan at gmail.com  Tue Oct  5 11:31:34 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Tue, 5 Oct 2010 12:31:34 +0200
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
Message-ID: <AANLkTikdvJZorED2hDwjtdXdTEB5uxEzb955yydeZS0C@mail.gmail.com>

On Wed, Sep 29, 2010 at 4:08 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> 3) Is Rabbit MQ planning on implementing AMQP 1.0?
>
> When we know what it is.

Are you enthusiastic about 1.0?

Davorin Rusevljan
http://www.cloud208.com/

From mikeb at rabbitmq.com  Tue Oct  5 12:36:07 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 05 Oct 2010 12:36:07 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <vfqaamt5d9h.fsf@mail.cern.ch>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>	<vfqk4lyhv0b.fsf@mail.cern.ch>
	<4CA9F245.8010309@rabbitmq.com> <vfqaamt5d9h.fsf@mail.cern.ch>
Message-ID: <4CAB0DA7.9010704@rabbitmq.com>

Lionel,

On 10/05/2010 08:07 AM, Lionel Cons wrote:
> Michael Bridgen<mikeb at rabbitmq.com>  writes:
>> Since there's no reply from the server to SUBSCRIBE, and we generally
>> want reply queues to have different properties to shared queues, really
>> the only option is to have a distinguished prefix for reply queue
>> destinations, and require clients to supply their own (preferably fresh)
>> names.
>
> In practice, other solutions exist. I'm not sure which one is
> preferable.
>
> (1) With ActiveMQ, one can subscribe to /temp-queue/whatever and a
> private queue with a random name will be created on the broker. The
> client program can send a message to itself, examine the destination
> header of the received message and find out this way what is the real
> queue name.

I don't quite understand this -- when sending the tracer message, does 
the client also use "/temp-queue/whatever" as the destination; and if 
that works, why bother finding out the "real" queue name?

> (2) We could imagine using the RECEIPT frame to allow the broker to
> "reply" to the client. Something like:
>
>    SUBSCRIBE /i-want-a-private-queue
>    receipt:123
>
>    RECEIPT
>    receipt-id:123
>    destination:/queue/004b2782fba54d18576bc2c710b517b1

Ah, RECEIPT, good call.  I was wrong about the server no being able to 
reply.  This would be my preferred style; with the following as a option 
too.

>> SUBSCRIBE /reply/<md5 of some client properties>
>
> This would work too.
>
>>> Also, what about AMQP 1.0? Have you considered it in order to get a
>>> syntax that can be adapted/extended to the new AMQP 1.0 concepts?
>>
>> Do you mean using something like /node/ for destinations?
>
> For instance. AMQP 1.0 has nodes, queues, links and filters (and no more
> exchanges). They should be exposed via STOMP somehow.

Not any more; queues are mentioned only in passing if at all.  And nodes 
really are just a stand-in something for addresses to be addressing. 
Links are an abstraction in the transfer protocol rather than part of a 
model.

It's not true to say there are "no more exchanges" in the sense that 
AMQP 1.0 somehow does away with the exchange/binding/queue model.  The 
recommendation sets out a message transfer protocol, and tries very hard 
to not take any position on where messages are when they are not being 
transferred.  So it's not the case that the AMQP 1.0 recommendation 
supplants the broker model given in previous versions of AMQP with 
something else (nodes, links, whatever) -- it simply steers clear of 
saying anything about a broker model.

> In addition, AMQP 1.0 introduced the notion of global addressing,
> something like node-name at container. This should also be usable from
> STOMP.

This was mooted at some point but doesn't actually appear in the 
recommendation, which says next to nothing about the form of addresses. 
  It may still come about, in some ancillary part of the specification.

> However, I'm not up-to-date with what AMQP 1.0 really is today. Concepts
> like remote addressing have been described for instance in last year's
> F2F meeting:
> http://www.amqp.org/confluence/download/attachments/2523324/AMQP+F2F+Presentation.pdf
> I don't know if these are still relevant...

If you want to catch up it is worth reading the recommendation; it's 
significantly different to the previous most long-lived revision (PR2) 
which was itself something of a departure from earlier revisions.


Michael.

From lionel.cons at cern.ch  Tue Oct  5 14:28:26 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 05 Oct 2010 15:28:26 +0200
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <4CAB0DA7.9010704@rabbitmq.com> (Michael Bridgen's message of
	"Tue, 5 Oct 2010 12:36:07 +0100")
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<vfqk4lyhv0b.fsf@mail.cern.ch> <4CA9F245.8010309@rabbitmq.com>
	<vfqaamt5d9h.fsf@mail.cern.ch> <4CAB0DA7.9010704@rabbitmq.com>
Message-ID: <vfqzkus4vlx.fsf@mail.cern.ch>

Michael Bridgen <mikeb at rabbitmq.com> writes:
> I don't quite understand this -- when sending the tracer message, does
> the client also use "/temp-queue/whatever" as the destination; and if
> that works, why bother finding out the "real" queue name?

The "/temp-queue/whatever" destination only works for the currently open
connection. The "real" name has to be used from elsewhere.

Cheers,

Lionel

From mikeb at rabbitmq.com  Tue Oct  5 15:46:43 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 05 Oct 2010 15:46:43 +0100
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <vfqzkus4vlx.fsf@mail.cern.ch>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>	<vfqk4lyhv0b.fsf@mail.cern.ch>
	<4CA9F245.8010309@rabbitmq.com>	<vfqaamt5d9h.fsf@mail.cern.ch>
	<4CAB0DA7.9010704@rabbitmq.com> <vfqzkus4vlx.fsf@mail.cern.ch>
Message-ID: <4CAB3A53.6010109@rabbitmq.com>

On 10/05/2010 02:28 PM, Lionel Cons wrote:
> Michael Bridgen<mikeb at rabbitmq.com>  writes:
>> I don't quite understand this -- when sending the tracer message, does
>> the client also use "/temp-queue/whatever" as the destination; and if
>> that works, why bother finding out the "real" queue name?
>
> The "/temp-queue/whatever" destination only works for the currently open
> connection. The "real" name has to be used from elsewhere.

Right, got it now.  So, crucially, you have to do this tracer message 
thing to get an address to send as a reply-to.  Would you agree that the 
other two options are preferable?

Michael

From lionel.cons at cern.ch  Tue Oct  5 15:50:26 2010
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 5 Oct 2010 16:50:26 +0200
Subject: [rabbitmq-discuss] Simpler STOMP Behaviour
In-Reply-To: <4CAB3A53.6010109@rabbitmq.com>
References: <A3C35442-9402-4BE0-8AE8-EAA995279A1F@rabbitmq.com>
	<vfqk4lyhv0b.fsf@mail.cern.ch> <4CA9F245.8010309@rabbitmq.com>
	<vfqaamt5d9h.fsf@mail.cern.ch> <4CAB0DA7.9010704@rabbitmq.com>
	<vfqzkus4vlx.fsf@mail.cern.ch> <4CAB3A53.6010109@rabbitmq.com>
Message-ID: <19627.15154.551503.494553@mail.cern.ch>

Michael Bridgen writes:
 > Right, got it now.  So, crucially, you have to do this tracer message 
 > thing to get an address to send as a reply-to.  Would you agree that the 
 > other two options are preferable?

Indeed. I don't like this dirty hack. Its only advantage is that it's
the only solution that currently works with ActiveMQ...

Cheers,

Lionel

From alexis at rabbitmq.com  Tue Oct  5 16:23:55 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 5 Oct 2010 16:23:55 +0100
Subject: [rabbitmq-discuss] Rabbit MQ AMQP
In-Reply-To: <AANLkTikdvJZorED2hDwjtdXdTEB5uxEzb955yydeZS0C@mail.gmail.com>
References: <29838814.post@talk.nabble.com>
	<AANLkTi=-JZ8_HJg3+Byr2JyBvMONSXNgDQ8rqmpg_RL+@mail.gmail.com>
	<AANLkTikdvJZorED2hDwjtdXdTEB5uxEzb955yydeZS0C@mail.gmail.com>
Message-ID: <AANLkTi=1Xg_X2F0emLzHHYrrxObt_BU7j30JgVe2sb4P@mail.gmail.com>

On Tue, Oct 5, 2010 at 11:31 AM, Davorin Rusevljan
<davorin.rusevljan at gmail.com> wrote:
> On Wed, Sep 29, 2010 at 4:08 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>> 3) Is Rabbit MQ planning on implementing AMQP 1.0?
>>
>> When we know what it is.
>
> Are you enthusiastic about 1.0?

If the technology in the 1-0 is used to bridge between the existing
adopted base of AMQP, and the 'legacy' of non-AMQP brokers (eg.
Biztalk Server), then it will play a role.

alexis

From rob at rabbitmq.com  Tue Oct  5 19:32:29 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 5 Oct 2010 19:32:29 +0100
Subject: [rabbitmq-discuss] Multi-threaded Dispatch in Java Client
In-Reply-To: <29868134.post@talk.nabble.com>
References: <2B5773E7-547A-49BA-9D57-41B23CBC64F4@rabbitmq.com>
	<29868134.post@talk.nabble.com>
Message-ID: <2D709699-F08F-4BA9-A7FA-A0C3C58FEB95@rabbitmq.com>

Darren,

That repo is out of date. All work on this bug moved to hg.rabbitmq.com.

In the latest patch all consumers get the new threading behaviour and the JavaDoc is updated to reflect that.

I'm pretty concerned about sending callback methods to consumers on different threads. As a bare minimum we have to ensure that handleDelivery is never called out of order. 

Not just that but I think we need to ensure that exit from handleDelivery happens-before each subsequent entry into handleDelivery on a given consumer. 

This prevents us from using a rudimentary producer/consumer model. Such a model would allow for multiple hD calls for a given consumer to run concurrently.

Beyond just a single dispatch, I'm happy with a model that maintains a pool of threads but assigns consumers to one thread or another.

I'm concerned about the impact on user code of allowing dispatches to a consumer in multiple threads.

Rob
On 2 Oct 2010, at 21:55, darr wrote:

> 
> http://bitbucket.org/robharrop/rabbitmq-java-client/changeset/ea463bbd4871
> That's the commit I'm referencing.  I hope it's the right one.
> 
> It looks like you're breaking the contract of Consumer a little bit when you
> move this off of the Connection's thread (since that's what's documented). 
> This is a Good Thing, because, as you note, implementations of consumer can
> now call blocking methods on Connection and Channel.  However, this has a
> down side in that only some consumers are permitted to call blocking methods
> -- those that use DispatchingConsumer.  Other consumers are guaranteed to
> have their methods called from the Connection thread.
> 
> So this is a bit of extra complexity for implementations of Consumer to
> consider.  Given that implementors of Consumer already need to think of
> these things, you might re-evaluate the idea that consumers require all of
> their methods to be called from a single thread.  The mechanics of making a
> consumer thread-safe seem very manageable.  There's not a lot of interaction
> between the methods and very little state.
> 
> However, if you share my concern about breaking the contract of Consumer,
> you could introduce another interface (ConcurrentConsumer) which specifies
> exactly the requirements of its implementations and modify
> DispachingConsumer to accept only ConcurrentConsumer.
> 
> As for the possibility of ConnectionFactory.setDispatchThreadCount(int), I
> think if I set that to some value greater than one, and had only a single
> consumer, I would expect handleDelivery to be called from multiple threads. 
> I think we might be safer making DispatchingConsumer the sole party
> responsible for these things and it can accept an Executor on construction.
> Then the user can decide if all consumers can safely share the same set of
> threads, or if they need some other behavior.
> 
> What do you think?
> 
> Thanks,
> Darren.
> 
> 
> Rob Harrop-5 wrote:
>> 
>> Recently I pushed branch bug18384 that changes the way callbacks are sent
>> to Consumer implementations.
>> 
>> Following this change, the Connection maintains a dispatch thread that is
>> used to send callbacks to the Consumers. This frees Consumers call
>> blocking methods on the Connection and Channel.
>> 
>> A question came up on Twitter about making this configurable, allowing for
>> a custom Executor to be plugged into the ConnectionFactory. I wanted to
>> outline why this is complicated, discuss a possible implementation and see
>> if there is much interest.
>> 
>> First off, we should establish that each Consumer should only receive
>> callbacks in a single thread. If this is not the case, then chaos will
>> ensue and Consumers will need to worry about their own thread safety
>> beyond that of initialisation safety.
>> 
>> With only a single dispatch thread for all Consumers, this Consumer-Thread
>> pairing is easy honoured.
>> 
>> When we introduce multiple threads, we have to ensure that each Consumer
>> is paired with only one thread. When using the Executor abstraction, this
>> prevents each callback dispatch from being wrapped up in a Runnable and
>> sent to Executor, because you cannot guarantee which thread will be used.
>> 
>> To get around this, the Executor can be set to run 'n' long-running tasks
>> (n being the number of threads in the Executor). Each of these tasks pulls
>> dispatch instructions off a queue and executes them. Each Consumer is
>> paired with one dispatch instruction queue, probably assigned on a
>> round-robin basis. This is not too complicated and will provide simple
>> balancing of dispatch load across the threads in the Executor.
>> 
>> Now, there are still some problems:
>> 
>> 1. The number of threads in an Executor is not necessarily fixed (as with
>> ThreadPoolExecutor).
>> 2. There is no way, via Executor or ExecutorService to find out how many
>> threads there are. Thus, we cannot know how many dispatch instruction
>> queues to create.
>> 
>> However, we can certainly introduce a
>> ConnectionFactory.setDispatchThreadCount(int). Behind the scenes this will
>> create an Executors.newFixedThreadPool() and the correct number of
>> dispatch queues and dispatch tasks.
>> 
>> I'm interested in hearing if anyone thinks I'm overlooking some simpler
>> way of solving this, and indeed if this is even worth solving.
>> 
>> Regards,
>> 
>> Rob
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/Multi-threaded-Dispatch-in-Java-Client-tp29860178p29868134.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101005/c164711d/attachment-0001.htm>

From armamig at hotmail.co.uk  Wed Oct  6 10:26:57 2010
From: armamig at hotmail.co.uk (Armax)
Date: Wed, 6 Oct 2010 02:26:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure recovery
 strategies
Message-ID: <29894938.post@talk.nabble.com>


Hi,

I have been reading the mailing list to gather information about scalable
and HA configurations for RabbitMQ. From my understanding, I assune that if
a RabbitMQ node in a cluster fails all the queues and messages on that node
will be lost until the node is not recovered and any attempt of re-creating
the queues on another node is forbidden by the cluster implementation. Is
still the case in the latest RabbitMQ release?

I was thinking about fail-over strategies and I was wondering if there is
any way to say to the cluster to forget about the binding (queue-cluster
node) after the failure. If I did that, then I could re-create the queue on
another node. 

If this is not available, is there a specific reason why this is not
possible?

Many thanks and keep up the good work :)
-- 
View this message in context: http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Wed Oct  6 11:26:40 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 6 Oct 2010 11:26:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
 recovery strategies
In-Reply-To: <29894938.post@talk.nabble.com>
References: <29894938.post@talk.nabble.com>
Message-ID: <20101006102640.GD3070@dakota.eng.vmware.com>

Hi,

> I have been reading the mailing list to gather information about
> scalable
> and HA configurations for RabbitMQ. From my understanding, I assune
> that if
> a RabbitMQ node in a cluster fails all the queues and messages on that
> node
> will be lost until the node is not recovered and any attempt of
> re-creating
> the queues on another node is forbidden by the cluster implementation.
> Is
> still the case in the latest RabbitMQ release?

We're talking about durable queues.  Yes, this is still the case with
the latest broker.  You can't recreate the lost queue on a different
node
because it causes all sorts of problems if the original node comes back
up.

> I was thinking about fail-over strategies and I was wondering if there
> is
> any way to say to the cluster to forget about the binding
> (queue-cluster
> node) after the failure. If I did that, then I could re-create the
> queue on
> another node.

The only way to remove a queue from a downed node is either to restart
the node and remove the queue, or have another node masquerade as that
node and remove it.  In the second case, you lose the messages.

If you don't care about losing some messages, you can just use
non-durable queues.  This way, when the node goes down, the queue is
deleted from the cluster and can be redeclared on any other node.  Of
course, whatever messages were on the queue are lost.

Does this help?

Cheers,
Alex


On Wed, Oct 06, 2010 at 02:26:57AM -0700, Armax wrote:
> 
> Hi,
> 
> I have been reading the mailing list to gather information about scalable
> and HA configurations for RabbitMQ. From my understanding, I assune that if
> a RabbitMQ node in a cluster fails all the queues and messages on that node
> will be lost until the node is not recovered and any attempt of re-creating
> the queues on another node is forbidden by the cluster implementation. Is
> still the case in the latest RabbitMQ release?
> 
> I was thinking about fail-over strategies and I was wondering if there is
> any way to say to the cluster to forget about the binding (queue-cluster
> node) after the failure. If I did that, then I could re-create the queue on
> another node. 
> 
> If this is not available, is there a specific reason why this is not
> possible?
> 
> Many thanks and keep up the good work :)
> -- 
> View this message in context: http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Oct  6 12:01:58 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 6 Oct 2010 12:01:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
 recovery strategies
In-Reply-To: <29894938.post@talk.nabble.com>
References: <29894938.post@talk.nabble.com>
Message-ID: <20101006110158.GX20604@rabbitmq.com>

Hi,

In general, please don't think of clustering as trying to provide HA.
Clustering is solely about scalability.

For HA, the only easy thing that currently exists is active/passive
which is documented at http://rabbitmq.com/pacemaker.html

In that guide, it does go so far as to explain how you can have a
cluster of nodes, in which each node is actually an active/passive HA
pair, and thus achieve both the scalability of clustering, with HA.

Matthew

From matthew at rabbitmq.com  Wed Oct  6 13:46:06 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 6 Oct 2010 13:46:06 +0100
Subject: [rabbitmq-discuss] unsynchronized access to
 com.rabbitmq.client.impl.AMQChannel#_blockContent in java client
In-Reply-To: <4C9B1273.6050903@gmail.com>
References: <4C9B1273.6050903@gmail.com>
Message-ID: <20101006124606.GD20604@rabbitmq.com>

Hi Anton,

On Thu, Sep 23, 2010 at 12:40:19PM +0400, mabrek wrote:
> I use Channel.basicPublish() in http request handler (java client 2.1.0).
> Messages should be sent immediately or exception should be thrown
> after rabbitmq server had sent channel.flow active=false. If I don't
> handle channel.flow status, basicPublish() will hang until server
> sends channel.flow active=true.

That suggests that whilst you're using the client 2.1.0, you're not
using the broker 2.1.0 - the broker no longer sends channel.flow events
to the client - it simply relies on TCP backpressure to block clients
when the broker's under too much pressure. It is true that in the Java
client, when the broker is refusing publishes, the publish method in the
client will block. We have a bug open to try and figure out what we
could do here.

> I'm trying to check channel flow status before sending messages. It
> seems that the proper way to do it is to check
> channel.getFlow().getActive() but
> com.rabbitmq.client.impl.ChannelN#getFlow uses unsynchronized access
> to field _blockContent. Access to _blockContent is protected by
> synchronized (_channelMutex) in all other places.

That is a flawed approach as 1. we don't use channel.flow any more
anyway; 2. even if we did, what you propose is racey as the channel
could become blocked between you checking the status of the channel and
trying to publish.

Really, you need to make your application asynchronous and perhaps
buffer messages internally so that should a publish block, the rest of
your application can carry on regardless.

Matthew

From filip at tepper.pl  Wed Oct  6 14:16:51 2010
From: filip at tepper.pl (filiptepper)
Date: Wed, 6 Oct 2010 06:16:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading RabbitMQ cluster from 1.7.x to 2.1.x.
Message-ID: <29896612.post@talk.nabble.com>


Hi,

I'm running a small cluster of 2 RabbitMQ 1.7.x nodes. Due to random crashes
after some consumer failures I'm looking into an upgrade to 2.1.x version
(yes, the persistor!).

I was wondering if someone has any experience with doing live upgrades
between these version? I require HA, so it's impossible to shut down both
nodes, upgrade and bring them back. I was looking into the possibility of
clustering one 1.7.x node with a 2.1.x, but this didn't work as expected (am
I doing something wrong?).

Of course I could try shutting down first node, upgrade it, clear all the
queues on the second node, bring back the first node unclustered and then
move all the traffic to it, upgrade second and cluster it back with the
first one.

Any other ideas?

Regards,
Filip
-- 
View this message in context: http://old.nabble.com/Upgrading-RabbitMQ-cluster-from-1.7.x-to-2.1.x.-tp29896612p29896612.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Wed Oct  6 14:38:47 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 6 Oct 2010 14:38:47 +0100
Subject: [rabbitmq-discuss] Upgrading RabbitMQ cluster from 1.7.x to
	2.1.x.
In-Reply-To: <29896612.post@talk.nabble.com>
References: <29896612.post@talk.nabble.com>
Message-ID: <AANLkTiku_tQkfeRG0AxdeUzUgn6n6Zzmw6usK8zD5jj5@mail.gmail.com>

Blip is using Rabbit, cool!

On Wed, Oct 6, 2010 at 14:16, filiptepper <filip at tepper.pl> wrote:
> I was wondering if someone has any experience with doing live upgrades
> between these version?

What we usually suggest is to set up a new rabbitmq installation
and migrate gradually.
1. set up consumers to receive from both old and new hosts
2. move publishes to the new host
3. wait till all the data has been served from the old instance
4. kill the old instance

> I require HA, so it's impossible to shut down both
> nodes, upgrade and bring them back. I was looking into the possibility of
> clustering one 1.7.x node with a 2.1.x, but this didn't work as expected (am
> I doing something wrong?).

I would be very surprised if that worked.
You are aware that clustering is something different than HA?

> Of course I could try shutting down first node, upgrade it, clear all the
> queues on the second node, bring back the first node unclustered and then
> move all the traffic to it, upgrade second and cluster it back with the
> first one.

Exactly.

> Any other ideas?

Not really, it all depends on your use case. Sometimes people can just
stop the rabbit instance for the update.

Cheers,
  Marek Majkowski

From davegreggory at yahoo.com  Wed Oct  6 15:04:51 2010
From: davegreggory at yahoo.com (Dave Greggory)
Date: Wed, 6 Oct 2010 07:04:51 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
	recovery strategies
In-Reply-To: <20101006110158.GX20604@rabbitmq.com>
References: <29894938.post@talk.nabble.com>
	<20101006110158.GX20604@rabbitmq.com>
Message-ID: <519826.40198.qm@web111009.mail.gq1.yahoo.com>

When a node in a cluster goes down hard (let's say HDD failure), how would you 
recommend recovering from that situation (since the durable queues cannot be 
re-created in another node)? Can we bring up a new VM with a new RabbitMQ node 
installed with the same hostname and Rabbit nodename and have it join the old 
cluster? Would that work? Or would it fail because the new node had an empty 
mnesia db and did not have the durable queues in it that the other nodes in the 
clustered expected?



      

From bmurphy1976 at gmail.com  Wed Oct  6 16:10:04 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 6 Oct 2010 10:10:04 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 talking to older client
Message-ID: <AANLkTim2TtbYN7wbe01mfDhhsRn-=c_a3-HNDmUurb-A@mail.gmail.com>

Is there a way I can get an older client (1.7.x) to talk to a RabbitMQ 2.1.0
server?  We are weeks away from being able to deploy a new client release to
one of our customers, but our admin side is desperate to get the last of our
servers upgraded to 2.1.0.  Right now, I get protocol errors because of the
AMQP 0-8/0-9-1 change.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101006/74c1ec50/attachment.htm>

From matthew at rabbitmq.com  Wed Oct  6 16:39:56 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 6 Oct 2010 16:39:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 talking to older client
In-Reply-To: <AANLkTim2TtbYN7wbe01mfDhhsRn-=c_a3-HNDmUurb-A@mail.gmail.com>
References: <AANLkTim2TtbYN7wbe01mfDhhsRn-=c_a3-HNDmUurb-A@mail.gmail.com>
Message-ID: <20101006153956.GF20604@rabbitmq.com>

On Wed, Oct 06, 2010 at 10:10:04AM -0500, Bryan Murphy wrote:
> Is there a way I can get an older client (1.7.x) to talk to a RabbitMQ 2.1.0
> server?  We are weeks away from being able to deploy a new client release to
> one of our customers, but our admin side is desperate to get the last of our
> servers upgraded to 2.1.0.  Right now, I get protocol errors because of the
> AMQP 0-8/0-9-1 change.

Hmm, that's interesting - I thought we still spoke AMQP 0-8 to clients
that ask for it. Can you give us some examples of the kinds of errors
you're getting?

Matthew

From bmurphy1976 at gmail.com  Wed Oct  6 16:59:02 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 6 Oct 2010 10:59:02 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.1.0 talking to older client
In-Reply-To: <20101006153956.GF20604@rabbitmq.com>
References: <AANLkTim2TtbYN7wbe01mfDhhsRn-=c_a3-HNDmUurb-A@mail.gmail.com>
	<20101006153956.GF20604@rabbitmq.com>
Message-ID: <AANLkTikSqN4dLYodVdbw7TC5ST98Akgw8dyuiA3d1_KG@mail.gmail.com>

On Wed, Oct 6, 2010 at 10:39 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hmm, that's interesting - I thought we still spoke AMQP 0-8 to clients
> that ask for it. Can you give us some examples of the kinds of errors
> you're getting?
>
> Matthew
>

Ah, thanks for pointing that out.  I was hoping it was a simple
configuration switch we had missed, but it turns out we simply had our
script backwards (v1.7.2 server, v2.1.0 client).  Even easier.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101006/cbad834b/attachment-0001.htm>

From chrisch at ecollege.com  Wed Oct  6 21:37:37 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Wed, 6 Oct 2010 14:37:37 -0600
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
Message-ID: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>

Hello.

I have a plain vanilla RabbitMQ 2.1.0 install on Ubuntu 10.04, installed
using dpkg -i.

I downloaded the rabbitmq-management plugin and pre-requisites as linked
from the plugins page (http://www.rabbitmq.com/plugins.html) into
/usr/lib/rabbitmq/lib/rabbitmq_server-2.1.0/plugins.

Restarting Rabbit starts the plugin on port 55672.  But when I browse to
it and log in as an admin user (guest, after `rabbitmqctl set_admin
guest`...) I get the following error:

The server encountered an error while processing this request:
{error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
             [{mochijson2,json_encode,2},
              {mochijson2,'-json_encode_array/2-fun-0-',3},
              {lists,foldl,3},
              {mochijson2,json_encode_array,2},
              {rabbit_mgmt_util,reply,3},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1}]}}


Digging into it, it appears the problematic api call is:

curl -iv -u guest:guest http://localhost:55672/api/overview


Have I misconfigured something, or would this be a bug in the plugin?

Thank you!

Chris Chew

From romain.conseil at gmail.com  Thu Oct  7 10:09:57 2010
From: romain.conseil at gmail.com (RomainC)
Date: Thu, 7 Oct 2010 02:09:57 -0700 (PDT)
Subject: [rabbitmq-discuss]  Publish messages only when needed ?
Message-ID: <29904396.post@talk.nabble.com>


Hello,

I am working with rabbitMQ + lvc plugin on a prototype of telemetry
diffusion with :
- up to 10 producers (1 exchanges by producer) located on the rabbit-server
node
- up to 10 remote/local consumers (2 queues by consumer) 
- up to 10000 messages/s (max 78byte/message) splitted on the different
exchanges
- a consumers only subscribe to a part of the whole flow of messages.
- java language api

Everything is working fine but my prototype is using a large amount of CPU
time and memory. I even experienced some 'out of memory' crash of the server
in extreme cases.

I try to find some ways to enhance this. So my question : would it be
possible to publish essages to the exchange only if there is at least one
consumer that subscribed this message ? In other words, I would like to
implement a kind of binding listener on exchanges and a way to request the
list of bindings (in Java).

I searched the api and it doesn't seem to be available. I am also aware that
this breaks the publisher/subscriber model since the publisher doesn't have
to carry about diffusion, it just publishes.

So what do you think about that, am I completely wrong ?
Is there a way to implement such a feature (I saw that this was possible to
request bindings thanks to the erlang client rabbitctl in rabbit_control.rl)
?

Thanks a lot for your help. 
-- 
View this message in context: http://old.nabble.com/Publish-messages-only-when-needed---tp29904396p29904396.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From armamig at hotmail.co.uk  Thu Oct  7 10:58:13 2010
From: armamig at hotmail.co.uk (Armax)
Date: Thu, 7 Oct 2010 02:58:13 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
 recovery strategies
In-Reply-To: <20101006102640.GD3070@dakota.eng.vmware.com>
References: <29894938.post@talk.nabble.com>
	<20101006102640.GD3070@dakota.eng.vmware.com>
Message-ID: <29904767.post@talk.nabble.com>


That helps, thanks! What do you mean by maskerading? Is cloning
IP/hostname/cookie enough? How about Mnesia?




Alexandru Scvor?ov wrote:
> 
> Hi,
> 
>> I have been reading the mailing list to gather information about
>> scalable
>> and HA configurations for RabbitMQ. From my understanding, I assune
>> that if
>> a RabbitMQ node in a cluster fails all the queues and messages on that
>> node
>> will be lost until the node is not recovered and any attempt of
>> re-creating
>> the queues on another node is forbidden by the cluster implementation.
>> Is
>> still the case in the latest RabbitMQ release?
> 
> We're talking about durable queues.  Yes, this is still the case with
> the latest broker.  You can't recreate the lost queue on a different
> node
> because it causes all sorts of problems if the original node comes back
> up.
> 
>> I was thinking about fail-over strategies and I was wondering if there
>> is
>> any way to say to the cluster to forget about the binding
>> (queue-cluster
>> node) after the failure. If I did that, then I could re-create the
>> queue on
>> another node.
> 
> The only way to remove a queue from a downed node is either to restart
> the node and remove the queue, or have another node masquerade as that
> node and remove it.  In the second case, you lose the messages.
> 
> If you don't care about losing some messages, you can just use
> non-durable queues.  This way, when the node goes down, the queue is
> deleted from the cluster and can be redeclared on any other node.  Of
> course, whatever messages were on the queue are lost.
> 
> Does this help?
> 
> Cheers,
> Alex
> 
> 
> On Wed, Oct 06, 2010 at 02:26:57AM -0700, Armax wrote:
>> 
>> Hi,
>> 
>> I have been reading the mailing list to gather information about scalable
>> and HA configurations for RabbitMQ. From my understanding, I assune that
>> if
>> a RabbitMQ node in a cluster fails all the queues and messages on that
>> node
>> will be lost until the node is not recovered and any attempt of
>> re-creating
>> the queues on another node is forbidden by the cluster implementation. Is
>> still the case in the latest RabbitMQ release?
>> 
>> I was thinking about fail-over strategies and I was wondering if there is
>> any way to say to the cluster to forget about the binding (queue-cluster
>> node) after the failure. If I did that, then I could re-create the queue
>> on
>> another node. 
>> 
>> If this is not available, is there a specific reason why this is not
>> possible?
>> 
>> Many thanks and keep up the good work :)
>> -- 
>> View this message in context:
>> http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29904767.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Thu Oct  7 11:47:02 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 7 Oct 2010 11:47:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
 recovery strategies
In-Reply-To: <29904767.post@talk.nabble.com>
References: <29894938.post@talk.nabble.com>
	<20101006102640.GD3070@dakota.eng.vmware.com>
	<29904767.post@talk.nabble.com>
Message-ID: <20101007104702.GB2363@dakota>

> What do you mean by maskerading? Is cloning
> IP/hostname/cookie enough? How about Mnesia?

IIRC, just clustering a new node with the same nodename as the down node
should be enough.  So, the same hostname and cookie should do it.

If you clone everything, you'll probably end up with a setup similar to
the one in our HA guide.

Really though, deleting queues and immediately declaring them on a
different node doesn't seem right.  You're probably better of using
non-durable queues.

Alex

On Thu, Oct 07, 2010 at 02:58:13AM -0700, Armax wrote:
> 
> That helps, thanks! What do you mean by maskerading? Is cloning
> IP/hostname/cookie enough? How about Mnesia?
> 
> 
> 
> 
> Alexandru Scvor?ov wrote:
> > 
> > Hi,
> > 
> >> I have been reading the mailing list to gather information about
> >> scalable
> >> and HA configurations for RabbitMQ. From my understanding, I assune
> >> that if
> >> a RabbitMQ node in a cluster fails all the queues and messages on that
> >> node
> >> will be lost until the node is not recovered and any attempt of
> >> re-creating
> >> the queues on another node is forbidden by the cluster implementation.
> >> Is
> >> still the case in the latest RabbitMQ release?
> > 
> > We're talking about durable queues.  Yes, this is still the case with
> > the latest broker.  You can't recreate the lost queue on a different
> > node
> > because it causes all sorts of problems if the original node comes back
> > up.
> > 
> >> I was thinking about fail-over strategies and I was wondering if there
> >> is
> >> any way to say to the cluster to forget about the binding
> >> (queue-cluster
> >> node) after the failure. If I did that, then I could re-create the
> >> queue on
> >> another node.
> > 
> > The only way to remove a queue from a downed node is either to restart
> > the node and remove the queue, or have another node masquerade as that
> > node and remove it.  In the second case, you lose the messages.
> > 
> > If you don't care about losing some messages, you can just use
> > non-durable queues.  This way, when the node goes down, the queue is
> > deleted from the cluster and can be redeclared on any other node.  Of
> > course, whatever messages were on the queue are lost.
> > 
> > Does this help?
> > 
> > Cheers,
> > Alex
> > 
> > 
> > On Wed, Oct 06, 2010 at 02:26:57AM -0700, Armax wrote:
> >> 
> >> Hi,
> >> 
> >> I have been reading the mailing list to gather information about scalable
> >> and HA configurations for RabbitMQ. From my understanding, I assune that
> >> if
> >> a RabbitMQ node in a cluster fails all the queues and messages on that
> >> node
> >> will be lost until the node is not recovered and any attempt of
> >> re-creating
> >> the queues on another node is forbidden by the cluster implementation. Is
> >> still the case in the latest RabbitMQ release?
> >> 
> >> I was thinking about fail-over strategies and I was wondering if there is
> >> any way to say to the cluster to forget about the binding (queue-cluster
> >> node) after the failure. If I did that, then I could re-create the queue
> >> on
> >> another node. 
> >> 
> >> If this is not available, is there a specific reason why this is not
> >> possible?
> >> 
> >> Many thanks and keep up the good work :)
> >> -- 
> >> View this message in context:
> >> http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html
> >> Sent from the RabbitMQ mailing list archive at Nabble.com.
> >> 
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> 
> -- 
> View this message in context: http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29904767.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Oct  7 12:55:13 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Oct 2010 12:55:13 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
Message-ID: <4CADB521.6050402@rabbitmq.com>

On 06/10/10 21:37, Chris Chew wrote:
> I get the following error:
>
> The server encountered an error while processing this request:
> {error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
<snip>
>
> Digging into it, it appears the problematic api call is:
>
> curl -iv -u guest:guest http://localhost:55672/api/overview
>
>
> Have I misconfigured something, or would this be a bug in the plugin?

Well, I doubt you've misconfigured anything, but I can't replicate what 
you're seeing. It's somehow failing to encode the port / IP the server 
is bound to - but you aren't doing anything unusual here.

Can you show me the output of:

sudo -u rabbitmq -H erl_call -sname rabbit@`hostname` \
   -a 'rabbit_mgmt_external_stats info'

please? That might shed some light on what's going on.

Cheers, Simon

From bmurphy1976 at gmail.com  Thu Oct  7 14:50:04 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 7 Oct 2010 08:50:04 -0500
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
Message-ID: <AANLkTinm9wCHqfBikhtAiM+KKktZkY1EQB=cvw3X+nB_@mail.gmail.com>

On Wed, Oct 6, 2010 at 3:37 PM, Chris Chew <chrisch at ecollege.com> wrote:

> Hello.
>
> I have a plain vanilla RabbitMQ 2.1.0 install on Ubuntu 10.04, installed
> using dpkg -i.
>
> I downloaded the rabbitmq-management plugin and pre-requisites as linked
> from the plugins page (http://www.rabbitmq.com/plugins.html) into
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.1.0/plugins.
>
> Restarting Rabbit starts the plugin on port 55672.  But when I browse to
> it and log in as an admin user (guest, after `rabbitmqctl set_admin
> guest`...) I get the following error:
>
> The server encountered an error while processing this request:
> {error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
>             [{mochijson2,json_encode,2},
>              {mochijson2,'-json_encode_array/2-fun-0-',3},
>              {lists,foldl,3},
>              {mochijson2,json_encode_array,2},
>              {rabbit_mgmt_util,reply,3},
>              {webmachine_resource,resource_call,3},
>              {webmachine_resource,do,3},
>              {webmachine_decision_core,resource_call,1}]}}
>
>
> Digging into it, it appears the problematic api call is:
>
> curl -iv -u guest:guest http://localhost:55672/api/overview
>
>
> Have I misconfigured something, or would this be a bug in the plugin?
>
> Thank you!
>
> Chris Chew
>
>
I did the same thing just yesterday and received a similar error.  For me,
at least, it went away after giving the server a few extra minutes to warm
up so I didn't think anything of it.

Also, I had another issue where I installed the plugin on a server that was
actively being used.  When I restarted the rabbitmq server, none of my
queues had any count information.  I had to shut down the server, delete the
mnesia folder, and restart it before I started to get counts.

There's clearly some variability in behavior based on the contents of the
mnesia folder.  I don't know if that is contributing to your issue, but it's
worth investigating.

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/076c4cf7/attachment.htm>

From simon at rabbitmq.com  Thu Oct  7 15:16:03 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Oct 2010 15:16:03 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <AANLkTinm9wCHqfBikhtAiM+KKktZkY1EQB=cvw3X+nB_@mail.gmail.com>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
	<AANLkTinm9wCHqfBikhtAiM+KKktZkY1EQB=cvw3X+nB_@mail.gmail.com>
Message-ID: <4CADD623.8080409@rabbitmq.com>

On 07/10/10 14:50, Bryan Murphy wrote:
> I did the same thing just yesterday and received a similar error.  For
> me, at least, it went away after giving the server a few extra minutes
> to warm up so I didn't think anything of it.

Hmm. Warm up? Were there very many / very large queues?

> Also, I had another issue where I installed the plugin on a server that
> was actively being used.  When I restarted the rabbitmq server, none of
> my queues had any count information.  I had to shut down the server,
> delete the mnesia folder, and restart it before I started to get counts.

This is known; it's fixed in default.

Cheers, Simon

From matthew at rabbitmq.com  Thu Oct  7 15:40:42 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 7 Oct 2010 15:40:42 +0100
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <20101004221321.GA9729@wellquite.org>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
	<AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
	<AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>
	<20101004221321.GA9729@wellquite.org>
Message-ID: <20101007144041.GF28336@rabbitmq.com>

On Mon, Oct 04, 2010 at 11:13:22PM +0100, Matthew Sackman wrote:
> > Anyhow, off to testing now :)
> 
> Excellent. You'll find it's a bit slower than ets but that's inevitable
> as it's disk and not RAM.

You'll also find it crashes from time to time under high load. Sorry,
but over the last couple of days, we've really hammered on rabbitmq-toke
and found a number of bugs which will take a little while to sort out.
Please do not use toke for any valuable data just for the moment!

Matthew

From chrisch at ecollege.com  Thu Oct  7 15:53:13 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Thu, 7 Oct 2010 08:53:13 -0600
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <4CADB521.6050402@rabbitmq.com>
Message-ID: <74D4EDFED2256749A5BF5B59267E085303D89CC7@EXMBCL01CORP.eclg.org>

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: Thursday, October 07, 2010 5:55 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
> 
> On 06/10/10 21:37, Chris Chew wrote:
> > I get the following error:
> >
> > The server encountered an error while processing this request:
> >
{error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
> <snip>
> >
> > Digging into it, it appears the problematic api call is:
> >
> > curl -iv -u guest:guest http://localhost:55672/api/overview
> >
> >
> > Have I misconfigured something, or would this be a bug in the
plugin?
> 
> Well, I doubt you've misconfigured anything, but I can't replicate
what
> you're seeing. It's somehow failing to encode the port / IP the server
> is bound to - but you aren't doing anything unusual here.
> 
> Can you show me the output of:
> 
> sudo -u rabbitmq -H erl_call -sname rabbit@`hostname` \
>    -a 'rabbit_mgmt_external_stats info'
> 
> please? That might shed some light on what's going on.
> 

The output:

[{bound_to, [#Bin<48,46,48,46,48,46,48,58,53,54,55,50>]}, {fd_used, 32},
{fd_total, 1024}, {mem_used, 47857952}, {mem_total, 842724147.000000},
{proc_used, 189}


Thank you!

Chris

From bmurphy1976 at gmail.com  Thu Oct  7 15:54:28 2010
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 7 Oct 2010 09:54:28 -0500
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <4CADD623.8080409@rabbitmq.com>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
	<AANLkTinm9wCHqfBikhtAiM+KKktZkY1EQB=cvw3X+nB_@mail.gmail.com>
	<4CADD623.8080409@rabbitmq.com>
Message-ID: <AANLkTi=_Vew7zjZKf7WrpucZ6fNRJzMAqB8_AcnO8q=F@mail.gmail.com>

On Thu, Oct 7, 2010 at 9:16 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/10/10 14:50, Bryan Murphy wrote:
>
>> I did the same thing just yesterday and received a similar error.  For
>> me, at least, it went away after giving the server a few extra minutes
>> to warm up so I didn't think anything of it.
>>
>
> Hmm. Warm up? Were there very many / very large queues?


We have about 50 queues, most of the time they are empty but we are handling
20 to 50 msgs/sec for all queues combined.  I'm not sure if it was waiting,
or me playing around with the UI and triggering something else, but
eventually the UI error would go away (it happened to me twice on two
different installs).  On other installs, it worked the first time out of the
box.

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/9c51d812/attachment.htm>

From majek04 at gmail.com  Thu Oct  7 16:18:34 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 7 Oct 2010 16:18:34 +0100
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <29904396.post@talk.nabble.com>
References: <29904396.post@talk.nabble.com>
Message-ID: <AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>

> I try to find some ways to enhance this. So my question : would it be
> possible to publish essages to the exchange only if there is at least one
> consumer that subscribed this message ? In other words, I would like to
> implement a kind of binding listener on exchanges and a way to request the
> list of bindings (in Java).
>
> I searched the api and it doesn't seem to be available. I am also aware that
> this breaks the publisher/subscriber model since the publisher doesn't have
> to carry about diffusion, it just publishes.

Have you looked at the "immediate" and "mandatory" flags in basic.publish?

>From http://www.rabbitmq.com/api-guide.html:
"If a message is published with the "mandatory" or "immediate" flags
set, but cannot be delivered, the broker will return it to the sending
client (via a AMQP.Basic.Return command)."


Cheers,
  Marek

From matthias at rabbitmq.com  Thu Oct  7 16:29:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Oct 2010 16:29:15 +0100
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <29904396.post@talk.nabble.com>
References: <29904396.post@talk.nabble.com>
Message-ID: <4CADE74B.3090906@rabbitmq.com>

RomainC wrote:
> Hello,
> 
> I am working with rabbitMQ + lvc plugin on a prototype of telemetry
> diffusion with :
> - up to 10 producers (1 exchanges by producer) located on the rabbit-server
> node
> - up to 10 remote/local consumers (2 queues by consumer) 
> - up to 10000 messages/s (max 78byte/message) splitted on the different
> exchanges
> - a consumers only subscribe to a part of the whole flow of messages.
> - java language api
> 
> Everything is working fine but my prototype is using a large amount of CPU
> time and memory. I even experienced some 'out of memory' crash of the server
> in extreme cases.

What version of rabbitmq-server are you running? It's quite difficult to 
make rabbit >= 2.0.0 crash due to running out of memory.

Also, the high CPU load doesn't sound right for the figures you mention 
above. When you see that, could you capture the output of all the 
'rabbitmqctl list_*' commands and post it here? That might allow us to 
identify some inefficiency in your set up.

Regards,

Matthias.

From tsuraan at gmail.com  Thu Oct  7 17:27:02 2010
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 7 Oct 2010 11:27:02 -0500
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <20101007144041.GF28336@rabbitmq.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
	<AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
	<AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>
	<20101004221321.GA9729@wellquite.org>
	<20101007144041.GF28336@rabbitmq.com>
Message-ID: <AANLkTinQSME4GaqtrEWvD9XH_SB4djFoJ48GQ6VC8NCL@mail.gmail.com>

> You'll also find it crashes from time to time under high load. Sorry,
> but over the last couple of days, we've really hammered on rabbitmq-toke
> and found a number of bugs which will take a little while to sort out.
> Please do not use toke for any valuable data just for the moment!

thanks for the warning :)

From alexandru at rabbitmq.com  Thu Oct  7 17:40:49 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 7 Oct 2010 17:40:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ clustering and node failure
 recovery strategies
In-Reply-To: <519826.40198.qm@web111009.mail.gq1.yahoo.com>
References: <29894938.post@talk.nabble.com>
	<20101006110158.GX20604@rabbitmq.com>
	<519826.40198.qm@web111009.mail.gq1.yahoo.com>
Message-ID: <20101007164049.GA2360@dakota>

> Can we bring up a new VM with a new RabbitMQ node 
> installed with the same hostname and Rabbit nodename and have it join the old 
> cluster? 

Yes.

> Would that work? Or would it fail because the new node had an empty 
> mnesia db and did not have the durable queues in it that the other nodes in the 
> clustered expected?

I've just tried it and it doesn't seem to be a problem.

Also, see the other messages in this thread.

Alex

On Wed, Oct 06, 2010 at 07:04:51AM -0700, Dave Greggory wrote:
> When a node in a cluster goes down hard (let's say HDD failure), how would you 
> recommend recovering from that situation (since the durable queues cannot be 
> re-created in another node)? Can we bring up a new VM with a new RabbitMQ node 
> installed with the same hostname and Rabbit nodename and have it join the old 
> cluster? Would that work? Or would it fail because the new node had an empty 
> mnesia db and did not have the durable queues in it that the other nodes in the 
> clustered expected?
> 
> 
> 
>       
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Thu Oct  7 17:47:54 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 7 Oct 2010 11:47:54 -0500
Subject: [rabbitmq-discuss] rabbitmq meetup at springone 2gx?
Message-ID: <9FC624B6-0E30-4D08-B025-44E7AC2885B0@jbrisbin.com>

Any plans to have a little RabbitMQ community confab at SpringOne 2GX week after next? 

Would be nice to put some faces with some email addresses. :)

Thanks!

J. Brisbin
http://jbrisbin.com/






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/25340216/attachment.htm>

From matthew at rabbitmq.com  Thu Oct  7 17:57:12 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 7 Oct 2010 17:57:12 +0100
Subject: [rabbitmq-discuss] Using Toke
In-Reply-To: <AANLkTinQSME4GaqtrEWvD9XH_SB4djFoJ48GQ6VC8NCL@mail.gmail.com>
References: <AANLkTikCnB4k59n4mc3VYSDK8j+wgtyGZAB+uMM_5ZFS@mail.gmail.com>
	<20101004172730.GT20604@rabbitmq.com>
	<AANLkTimkAxsJjWKqwM-+qh22bPkpqEdL0goV=Lr2eSQ_@mail.gmail.com>
	<AANLkTimPtFcKZoQYOq-eXw6978dbq5nvAgb2x5QFPvwx@mail.gmail.com>
	<20101004221321.GA9729@wellquite.org>
	<20101007144041.GF28336@rabbitmq.com>
	<AANLkTinQSME4GaqtrEWvD9XH_SB4djFoJ48GQ6VC8NCL@mail.gmail.com>
Message-ID: <20101007165712.GI28336@rabbitmq.com>

On Thu, Oct 07, 2010 at 11:27:02AM -0500, tsuraan wrote:
> > You'll also find it crashes from time to time under high load. Sorry,
> > but over the last couple of days, we've really hammered on rabbitmq-toke
> > and found a number of bugs which will take a little while to sort out.
> > Please do not use toke for any valuable data just for the moment!
> 
> thanks for the warning :)

Of course, when I said "a little while", I was actually meaning "mere
minutes"! If, in public-umbrella, you issue "make pull update", then you
should find toke and rabbitmq-toke both get updated to the head of
bug23274, and you should then be able to rebuild and continue testing
them.

Matthew

From pdezwart at rubiconproject.com  Thu Oct  7 18:15:20 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 07 Oct 2010 10:15:20 -0700
Subject: [rabbitmq-discuss] Uncaught exception 'AMQPConnectionException'
 with message 'Parameter 'host' exceeds 32 characters limit
In-Reply-To: <AANLkTik8h-eh74E=xjDZ7ANnAEDBDspTk=c6B2bO==Bs@mail.gmail.com>
Message-ID: <C8D34E38.108DE%pdezwart@rubiconproject.com>

None whatsoever. Ill get this fixed asap. Sorry.
Pieter


On 9/29/10 6:09 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:

> I'm afraid we know nothing about the php lib. But going through
> the sources reveals more 32-byte limits:
> http://svn.php.net/repository/pecl/amqp/trunk/amqp.c
> 
> Let's ask the author:
> 
> Pieter,
>   is there any reason for the 32 byte limits?
> 
> Cheers,
>   Marek
> 
> On Tue, Sep 28, 2010 at 14:56, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
>> > I'm trying to use php pecl amqp to set up some monitoring scripts. ?When I
>> > create a connection using a valid DNS name, I get the following exception:
>> > PHP Fatal error: ?Uncaught exception 'AMQPConnectionException' with message
>> > 'Parameter 'host' exceeds 32 characters limit.'
>> >
>> > Seems way too restrictive to me.
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/03fa39d2/attachment.htm>

From stephen.pasco at gmail.com  Thu Oct  7 22:00:26 2010
From: stephen.pasco at gmail.com (spasco)
Date: Thu, 7 Oct 2010 14:00:26 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq install on mac 10.6.4 os using macports
Message-ID: <29910220.post@talk.nabble.com>


Following the Macports install notes here (running Mac 10.6.4):

http://www.rabbitmq.com/install.html#macports

I'm getting a not so intuitive error upon starting RabbitMQ (see below). 

Any clues would be helpful.

Thank you,
Stephen


AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at spasco
app descriptor :
/opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-2.1.0/sbin/../ebin/rabbit.app
home dir       : /opt/local/var/lib/rabbitmq
cookie hash    : oajNNcoTG/ZsFKLN7fTzaQ==
log            : /opt/local/var/log/rabbitmq/rabbit at spasco.log
sasl log       : /opt/local/var/log/rabbitmq/rabbit at spasco-sasl.log
database dir   : /opt/local/var/lib/rabbitmq/mnesia/rabbit at spasco
erlang version : 5.7.5

WARNING: module gen_server2 not found, so not scanned for boot steps.
WARNING: module rabbit_tests not found, so not scanned for boot steps.
WARNING: module test_sup not found, so not scanned for boot steps.
starting file handle cache server                                    
...done
starting worker pool                                                 
...BOOT ERROR: FAILED
Reason: {{badmatch,
             {error,
                 {shutdown,
                     {child,undefined,worker_pool_sup,
                         {worker_pool_sup,start_link,[]},
                         transient,4294967295,worker,
                         [worker_pool_sup]}}}},
         [{rabbit_sup,start_child,3},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2},
          {application_master,start_it_old,4}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

-- 
View this message in context: http://old.nabble.com/rabbitmq-install-on-mac-10.6.4-os-using-macports-tp29910220p29910220.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From adam at varud.com  Fri Oct  8 01:03:29 2010
From: adam at varud.com (Adam Nelson)
Date: Thu, 7 Oct 2010 20:03:29 -0400
Subject: [rabbitmq-discuss] rabbitmq install on mac 10.6.4 os using
	macports
In-Reply-To: <29910220.post@talk.nabble.com>
References: <29910220.post@talk.nabble.com>
Message-ID: <B2A9E50A-FCB0-459D-A229-F4E281298D7E@varud.com>

Homebrew has a much easier Mac installation process.  Try that one.

Adam

Sent from my iPhone

On Oct 7, 2010, at 5:00 PM, spasco <stephen.pasco at gmail.com> wrote:

> 
> Following the Macports install notes here (running Mac 10.6.4):
> 
> http://www.rabbitmq.com/install.html#macports
> 
> I'm getting a not so intuitive error upon starting RabbitMQ (see below). 
> 
> Any clues would be helpful.
> 
> Thank you,
> Stephen
> 
> 
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> node           : rabbit at spasco
> app descriptor :
> /opt/local/lib/rabbitmq/bin/../lib/rabbitmq_server-2.1.0/sbin/../ebin/rabbit.app
> home dir       : /opt/local/var/lib/rabbitmq
> cookie hash    : oajNNcoTG/ZsFKLN7fTzaQ==
> log            : /opt/local/var/log/rabbitmq/rabbit at spasco.log
> sasl log       : /opt/local/var/log/rabbitmq/rabbit at spasco-sasl.log
> database dir   : /opt/local/var/lib/rabbitmq/mnesia/rabbit at spasco
> erlang version : 5.7.5
> 
> WARNING: module gen_server2 not found, so not scanned for boot steps.
> WARNING: module rabbit_tests not found, so not scanned for boot steps.
> WARNING: module test_sup not found, so not scanned for boot steps.
> starting file handle cache server                                    
> ...done
> starting worker pool                                                 
> ...BOOT ERROR: FAILED
> Reason: {{badmatch,
>             {error,
>                 {shutdown,
>                     {child,undefined,worker_pool_sup,
>                         {worker_pool_sup,start_link,[]},
>                         transient,4294967295,worker,
>                         [worker_pool_sup]}}}},
>         [{rabbit_sup,start_child,3},
>          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>          {rabbit,run_boot_step,1},
>          {rabbit,'-start/2-lc$^0/1-0-',1},
>          {rabbit,start,2},
>          {application_master,start_it_old,4}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
> 
> -- 
> View this message in context: http://old.nabble.com/rabbitmq-install-on-mac-10.6.4-os-using-macports-tp29910220p29910220.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dking at ketralnis.com  Fri Oct  8 01:32:36 2010
From: dking at ketralnis.com (David King)
Date: Thu, 7 Oct 2010 17:32:36 -0700
Subject: [rabbitmq-discuss] Failed upgrade from 1.8.1 to 2.1.0
Message-ID: <13F25047-7FB8-42BC-AB84-82E6C4F54C91@ketralnis.com>

I tried to upgrade from 1.8.1 to 2.1.0. The "upgrade" was a process of provisioning a new machine running 2.1.0 and slowly moving all of the producers and consumers. Either 2.1.0 couldn't keep up with the load, or there's some max number of connections, or something. A better story can be told by the graphs <http://i.imgur.com/flLPX.png>

At first (about 15:10 on the graph), almost all of the queues started growing. Consumers would hang, unaided by restarts. But some of the queues (like commenstree_q and register_vote_q) didn't have any trouble at all.

At about 15:50, after about 30 minutes of trying to figure out what was going on I restarted rabbit. This time, some of the queues that were uncomsumable before (like spam_q and corrections_q) were now working, but other queues (like indextank_changes) would still hang on consuming.

At 16:20 I gave up and started reverting back to the other queue machine (running rabbit 1.8.1). As that happened, some of the queues that were unconsumable finally started shrinkining and their consumers unhung. Some of them (newcomments_q) processed all of the items in the queue basically instantly, so this isn't a case of our own app not being able to keep up. By about 16:30 I'd completed moving back to the old machine.

Potentially relevant:
* commentstree_q has 4 consumers
* corrections_q has 1 consumer
* the one with the blacked out name has 1 consumer that runs from cron, not continuously
* indextank_changes has 2 consumers
* log_q has 1 consumer
* newcomments_q has 1 consumer
* register_vote_q has ~15 consumers
* scraper_q has 5 consumers
* solrsearch_changes has 1 consumer
* spam_q has 4 consumers
* usage_q has 2 consumers

I realise this may not be enough information, but the logs were basically empty for this period (they'd have occasional messages like "someone connected" and "someone disconnected" but nothing more useful). So what information can I gather beyond this that might help diagnose why rabbit 2.1.0 can't keep up but 1.8.1 can?

Also, this is unrelated, but I'd provisioned the new machine a couple of weeks ago, and it's been sitting literally 100% idle until I tried moving today. But look at its memory usage over the last week <http://i.imgur.com/M7x6m.png>. What on earth could it be doing that it's growing in memory when *not used*? This machine is identical to our other machines (it's an EC2 node from the same AMI), but only this node has this problem, and all it's running is rabbit.

From pdezwart at rubiconproject.com  Fri Oct  8 05:11:10 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 07 Oct 2010 21:11:10 -0700
Subject: [rabbitmq-discuss] Uncaught exception 'AMQPConnectionException'
 with message 'Parameter 'host' exceeds 32 characters limit
In-Reply-To: <AANLkTin2518-c4ViBd0gg2Jk6Kjo3fDE8HnSp3ONi=o1@mail.gmail.com>
Message-ID: <C8D3E7EE.10982%pdezwart@rubiconproject.com>

Hey Bryan,

What version are you using of the AMQP extension and Rabbit? I am patching
the newest version I am working on, but I want to backport it to whatever
you are using as well.

Thanks,
Pieter


On 9/28/10 6:56 AM, "Bryan Murphy" <bmurphy1976 at gmail.com> wrote:

> I'm trying to use php pecl amqp to set up some monitoring scripts. ?When I
> create a connection using a valid DNS name, I get the following exception:
> 
> PHP Fatal error: ?Uncaught exception 'AMQPConnectionException' with message
> 'Parameter 'host' exceeds 32 characters limit.'?
> 
> Seems way too restrictive to me.
> 
> Thanks,
> Bryan
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?COMPANY OF THE YEAR? ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS ? ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  ?08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES ?08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/50dc7521/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101007/50dc7521/attachment-0001.png>

From videlalvaro at gmail.com  Fri Oct  8 07:04:37 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Oct 2010 14:04:37 +0800
Subject: [rabbitmq-discuss] About PHP PECL extension
Message-ID: <4BC03D48-759E-4A0F-A556-814125D3F408@gmail.com>

Hi,

I would like to know where's the code for the PHP extension that appears on the PHP website.

Regards,

Alvaro

From alexis at rabbitmq.com  Fri Oct  8 07:41:16 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 8 Oct 2010 07:41:16 +0100
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <4BC03D48-759E-4A0F-A556-814125D3F408@gmail.com>
References: <4BC03D48-759E-4A0F-A556-814125D3F408@gmail.com>
Message-ID: <AANLkTik6JWFyf81p92Rn=z_uJ2cbpxqaMEeDqorEtG4u@mail.gmail.com>

Could it be one of these?

http://www.delicious.com/alexisrichardson/rabbitmq+client+php



On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I would like to know where's the code for the PHP extension that appears on the PHP website.
>
> Regards,
>
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Fri Oct  8 07:45:48 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Oct 2010 14:45:48 +0800
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <AANLkTik6JWFyf81p92Rn=z_uJ2cbpxqaMEeDqorEtG4u@mail.gmail.com>
References: <4BC03D48-759E-4A0F-A556-814125D3F408@gmail.com>
	<AANLkTik6JWFyf81p92Rn=z_uJ2cbpxqaMEeDqorEtG4u@mail.gmail.com>
Message-ID: <E4C58FFD-FA04-4EEC-956C-A143C514CAAB@gmail.com>

I think is php-rabbit

Thanks!

On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:

> Could it be one of these?
> 
> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
> 
> 
> 
> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi,
>> 
>> I would like to know where's the code for the PHP extension that appears on the PHP website.
>> 
>> Regards,
>> 
>> Alvaro
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From pdezwart at rubiconproject.com  Fri Oct  8 08:05:10 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 08 Oct 2010 00:05:10 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <E4C58FFD-FA04-4EEC-956C-A143C514CAAB@gmail.com>
Message-ID: <C8D410B6.10997%pdezwart@rubiconproject.com>

Excellent question. The source code for this:
http://php.net/manual/en/book.amqp.php
is available here:
http://pecl.php.net/package/amqp

I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
listed works with 1.7.*.

Pieter


On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:

> I think is php-rabbit
> 
> Thanks!
> 
> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
> 
>> Could it be one of these?
>> 
>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>> 
>> 
>> 
>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Hi,
>>> 
>>> I would like to know where's the code for the PHP extension that appears on
>>> the PHP website.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Fri Oct  8 08:06:23 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Oct 2010 15:06:23 +0800
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <C8D410B6.10997%pdezwart@rubiconproject.com>
References: <C8D410B6.10997%pdezwart@rubiconproject.com>
Message-ID: <CBB2639B-FC77-4B7D-9398-92E260A98B13@gmail.com>

Hi Pieter,

My question is more where is the source code that we can contribute back. I know about the PECL stuff :)

Regards,

Alvaro


On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:

> Excellent question. The source code for this:
> http://php.net/manual/en/book.amqp.php
> is available here:
> http://pecl.php.net/package/amqp
> 
> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
> listed works with 1.7.*.
> 
> Pieter
> 
> 
> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
> 
>> I think is php-rabbit
>> 
>> Thanks!
>> 
>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>> 
>>> Could it be one of these?
>>> 
>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>> 
>>> 
>>> 
>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>>> Hi,
>>>> 
>>>> I would like to know where's the code for the PHP extension that appears on
>>>> the PHP website.
>>>> 
>>>> Regards,
>>>> 
>>>> Alvaro
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From pdezwart at rubiconproject.com  Fri Oct  8 08:09:00 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 08 Oct 2010 00:09:00 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <CBB2639B-FC77-4B7D-9398-92E260A98B13@gmail.com>
Message-ID: <C8D4119C.1099A%pdezwart@rubiconproject.com>

Oh thank you deity of your choice for answering me. I need help.
Lets take this off list so we don't pollute the airways.
Pieter


On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:

> Hi Pieter,
> 
> My question is more where is the source code that we can contribute back. I
> know about the PECL stuff :)
> 
> Regards,
> 
> Alvaro
> 
> 
> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
> 
>> Excellent question. The source code for this:
>> http://php.net/manual/en/book.amqp.php
>> is available here:
>> http://pecl.php.net/package/amqp
>> 
>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
>> listed works with 1.7.*.
>> 
>> Pieter
>> 
>> 
>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>> 
>>> I think is php-rabbit
>>> 
>>> Thanks!
>>> 
>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>> 
>>>> Could it be one of these?
>>>> 
>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>>> 
>>>> 
>>>> 
>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com>
>>>> wrote:
>>>>> Hi,
>>>>> 
>>>>> I would like to know where's the code for the PHP extension that appears
>>>>> on
>>>>> the PHP website.
>>>>> 
>>>>> Regards,
>>>>> 
>>>>> Alvaro
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 


From videlalvaro at gmail.com  Fri Oct  8 08:11:40 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Oct 2010 15:11:40 +0800
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <C8D4119C.1099A%pdezwart@rubiconproject.com>
References: <C8D4119C.1099A%pdezwart@rubiconproject.com>
Message-ID: <C57FEB6F-0E29-46EE-A458-CEC1249754A3@gmail.com>

Well, 

I said where is the place to contribute, not that I had something to contribute right now?

But we might start using this extension in prod and I remember last time I checked the API there was some stuff I'd like it to be "different"

Regards,

Alvaro

On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:

> Oh thank you deity of your choice for answering me. I need help.
> Lets take this off list so we don't pollute the airways.
> Pieter
> 
> 
> On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
> 
>> Hi Pieter,
>> 
>> My question is more where is the source code that we can contribute back. I
>> know about the PECL stuff :)
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> 
>> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
>> 
>>> Excellent question. The source code for this:
>>> http://php.net/manual/en/book.amqp.php
>>> is available here:
>>> http://pecl.php.net/package/amqp
>>> 
>>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
>>> listed works with 1.7.*.
>>> 
>>> Pieter
>>> 
>>> 
>>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>> 
>>>> I think is php-rabbit
>>>> 
>>>> Thanks!
>>>> 
>>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>>> 
>>>>> Could it be one of these?
>>>>> 
>>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>>>> 
>>>>> 
>>>>> 
>>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com>
>>>>> wrote:
>>>>>> Hi,
>>>>>> 
>>>>>> I would like to know where's the code for the PHP extension that appears
>>>>>> on
>>>>>> the PHP website.
>>>>>> 
>>>>>> Regards,
>>>>>> 
>>>>>> Alvaro
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>> 
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
> 


From mc at majorcomputing.com  Fri Oct  8 08:41:58 2010
From: mc at majorcomputing.com (Pedram Nimreezi)
Date: Fri, 8 Oct 2010 03:41:58 -0400
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <C57FEB6F-0E29-46EE-A458-CEC1249754A3@gmail.com>
References: <C8D4119C.1099A%pdezwart@rubiconproject.com>
	<C57FEB6F-0E29-46EE-A458-CEC1249754A3@gmail.com>
Message-ID: <AANLkTikR1pD8akoa225TtSEsMneodN26K2h7VrpCKzT2@mail.gmail.com>

Keep it on the air ways...  if you would...



On Fri, Oct 8, 2010 at 3:11 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Well,
>
> I said where is the place to contribute, not that I had something to
> contribute right now?
>
> But we might start using this extension in prod and I remember last time I
> checked the API there was some stuff I'd like it to be "different"
>
> Regards,
>
> Alvaro
>
> On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:
>
> > Oh thank you deity of your choice for answering me. I need help.
> > Lets take this off list so we don't pollute the airways.
> > Pieter
> >
> >
> > On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
> >
> >> Hi Pieter,
> >>
> >> My question is more where is the source code that we can contribute
> back. I
> >> know about the PECL stuff :)
> >>
> >> Regards,
> >>
> >> Alvaro
> >>
> >>
> >> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
> >>
> >>> Excellent question. The source code for this:
> >>> http://php.net/manual/en/book.amqp.php
> >>> is available here:
> >>> http://pecl.php.net/package/amqp
> >>>
> >>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The
> one
> >>> listed works with 1.7.*.
> >>>
> >>> Pieter
> >>>
> >>>
> >>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
> >>>
> >>>> I think is php-rabbit
> >>>>
> >>>> Thanks!
> >>>>
> >>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
> >>>>
> >>>>> Could it be one of these?
> >>>>>
> >>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
> >>>>>
> >>>>>
> >>>>>
> >>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com
> >
> >>>>> wrote:
> >>>>>> Hi,
> >>>>>>
> >>>>>> I would like to know where's the code for the PHP extension that
> appears
> >>>>>> on
> >>>>>> the PHP website.
> >>>>>>
> >>>>>> Regards,
> >>>>>>
> >>>>>> Alvaro
> >>>>>> _______________________________________________
> >>>>>> rabbitmq-discuss mailing list
> >>>>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>>>>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>>>>
> >>>>
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
/* Sincerely
-------------------------------------------------------------- */
Pedram N
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/6ed5123d/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  8 08:54:49 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 08:54:49 +0100
Subject: [rabbitmq-discuss] queue_declare returning a (50,
	10) NOT_FOUND....
In-Reply-To: <AANLkTi=9etZ2j=fJtdOoYtvTWBikG84NsMJ+HFpiiVDj@mail.gmail.com>
References: <AANLkTimtp1ZJ9AddyMhGHDwOAv5wDwNrQ_x+AKtGYdMD@mail.gmail.com>
	<4CA4318E.4020909@rabbitmq.com>
	<AANLkTi=9etZ2j=fJtdOoYtvTWBikG84NsMJ+HFpiiVDj@mail.gmail.com>
Message-ID: <4CAECE49.9020202@rabbitmq.com>

Nicolas,

Nicol?s C?sar wrote:
> No. this is my declaration
> 
>         self.chan_in.queue_declare(queue=self.config_in['queue'],
>                                    durable=True,
>                                    exclusive=True,
>                                    auto_delete=False)
> 
> 
> but there is a strange issue, if I change the name... to something I 
> havent used, there is no problem; just like I did in
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/2d925b0bbaed7f86?pli=1
> 
> is there a presistent queue "namespace" table that maybe got corrupted? 
> BTW is one  of the few "exclusive" queues that I have. maybe a wrong 
> consumer connected stored somewhere?

Exclusive queues only survive for as long as the connection that created 
them. (As an aside, this also means declaring an exclusive queue as 
durable is somewhat pointless.) And an exclusivity violation gets 
reported as different error than NOT_FOUND. So no, that's not it.

As Simon mentioned, the only case in which an active queue.declare 
should report a NOT_FOUND error is when it encounters a durable queue 
residing on a cluster node that is currently down. Now, your 
'rabbitmqctl status' output indicates that the system isn't clustered. 
But from your previous posts I gather that perhaps it was clustered 
earlier. It is possible that the unclustering left something behind. If 
the above error is reproducible, please let us know.

> I've solved this changing the name (just like before), so it's over for me.,

Next time this happens, list the existing queues with 'rabbitmqctl 
list_queues name durable auto_delete pid owner_pid' and post the result 
here.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Oct  8 09:21:35 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 09:21:35 +0100
Subject: [rabbitmq-discuss] rabbitmq install on mac 10.6.4 os using
	macports
In-Reply-To: <29910220.post@talk.nabble.com>
References: <29910220.post@talk.nabble.com>
Message-ID: <4CAED48F.2060700@rabbitmq.com>

Stephen,

spasco wrote:
> Following the Macports install notes here (running Mac 10.6.4):
> 
> http://www.rabbitmq.com/install.html#macports
> 
> I'm getting a not so intuitive error upon starting RabbitMQ (see below). 

How are you starting rabbit?

> WARNING: module gen_server2 not found, so not scanned for boot steps.
> WARNING: module rabbit_tests not found, so not scanned for boot steps.
> WARNING: module test_sup not found, so not scanned for boot steps.

Very strange. That looks like missing files / wrong permissions.

Does 
/opt/local/lib/rabbitmq/lib/rabbitmq_server-2.1.0/ebin/gen_server2.beam 
exists? What's the size of the file? Are its permissions the same as
/opt/local/lib/rabbitmq/lib/rabbitmq_server-2.1.0/ebin/rabbit.beam?

OR (and perhaps more likely), this could be an Erlang version issue. The 
current version of Erlang in macports is R14A, but the output from your 
rabbit startup indicates that it is running R13B04. Do you have an old 
version of Erlang installed somewhere?


Regards,

Matthias.

From romain.conseil at gmail.com  Fri Oct  8 09:42:33 2010
From: romain.conseil at gmail.com (RomainC)
Date: Fri, 8 Oct 2010 01:42:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
References: <29904396.post@talk.nabble.com>
	<AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
Message-ID: <29913525.post@talk.nabble.com>


Hi and thanks for your interest !

Marek, I checked my code and I had already set the mandatory and immediate
flags to false.
Matthias, here is the description of my case :

the server (2.1.0) is started on linux after a clean.
I start 5 publishers that sends 2000 messages of 78 bytes per second on 10
exchnages. that is to say :

-10 exchanges (with x-lvc plugin that stores in mnesia database the last
value for each message)
-10000 different messages @ 1Hz (= 10000 different routeId) --> ~700Kb/s
- each exchange handles 1000 msg/s

"top" shows me a 130% CPU load with no subscriber (= no queue) for the
moment, just publishing.
Here are the control traces :

Listing exchanges ...
amq.direct	direct
amq.topic	topic
tm://SAT.DRV7	x-lvc
tm://SAT.DRV1	x-lvc
amq.rabbitmq.log	topic
tm://SAT.DRV6	x-lvc
tm://SAT.DRV2	x-lvc
tm://SAT.DRV4	x-lvc
amq.fanout	fanout
tm://SAT.DRV8	x-lvc
tm://SAT.DRV3	x-lvc
tm://SAT.DRV5	x-lvc
tm://SAT.DRV0	x-lvc
amq.headers	headers
tm://SAT.DRV9	x-lvc
	direct
amq.match	headers
...done.
Listing queues ...
...done.
Listing channels ...
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
...done.
Listing connections ...
guest	140.94.126.54	2831	running
guest	140.94.126.54	2834	running
guest	140.94.126.54	2835	running
guest	140.94.126.54	2833	running
guest	140.94.126.54	2832	running
...done.
Listing bindings ...
...done.

I made the same test with direct exchanges (without mnesia) : 
CPU load : 120%
Control traces :

Listing exchanges ...
amq.direct	direct
amq.topic	topic
tm://SAT.DRV7	direct
tm://SAT.DRV1	direct
amq.rabbitmq.log	topic
tm://SAT.DRV6	direct
tm://SAT.DRV2	direct
tm://SAT.DRV4	direct
amq.fanout	fanout
tm://SAT.DRV8	direct
tm://SAT.DRV3	direct
tm://SAT.DRV5	direct
tm://SAT.DRV0	direct
amq.headers	headers
tm://SAT.DRV9	direct
	direct
amq.match	headers
...done.
Listing queues ...
...done.
Listing channels ...
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
	guest	false	0	0
...done.
Listing connections ...
guest	140.94.126.54	2956	running
guest	140.94.126.54	2955	running
guest	140.94.126.54	2952	running
guest	140.94.126.54	2954	running
guest	140.94.126.54	2953	running
...done.
Listing bindings ...
...done.


What disturbs me is this high CPU load whereas there is no subscriber.
That's the reason why I search a way to "control the message flow sent by
publishers". for instance when listening the bindings on a subscriber.

Thanks a lot for your help.
Romain


Marek Majkowski wrote:
> 
>> I try to find some ways to enhance this. So my question : would it be
>> possible to publish essages to the exchange only if there is at least one
>> consumer that subscribed this message ? In other words, I would like to
>> implement a kind of binding listener on exchanges and a way to request
>> the
>> list of bindings (in Java).
>>
>> I searched the api and it doesn't seem to be available. I am also aware
>> that
>> this breaks the publisher/subscriber model since the publisher doesn't
>> have
>> to carry about diffusion, it just publishes.
> 
> Have you looked at the "immediate" and "mandatory" flags in basic.publish?
> 
> From http://www.rabbitmq.com/api-guide.html:
> "If a message is published with the "mandatory" or "immediate" flags
> set, but cannot be delivered, the broker will return it to the sending
> client (via a AMQP.Basic.Return command)."
> 
> 
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Publish-messages-only-when-needed---tp29904396p29913525.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/91e43974/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Oct  8 09:51:57 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 09:51:57 +0100
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <29913525.post@talk.nabble.com>
References: <29904396.post@talk.nabble.com>	<AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
	<29913525.post@talk.nabble.com>
Message-ID: <4CAEDBAD.9010600@rabbitmq.com>

Romain,

RomainC wrote:
> 10 exchanges (with x-lvc plugin that stores in mnesia database the
> last value for each message)

Ah, there is your explanation for the high CPU load then. The lvc plugin 
has not been designed/tuned for high performance. It does a 
transactional mnesia write per publish, which is hugely expensive.


Matthias.

From romain.conseil at gmail.com  Fri Oct  8 09:59:38 2010
From: romain.conseil at gmail.com (Romain Conseil)
Date: Fri, 8 Oct 2010 10:59:38 +0200
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <4CAEDBAD.9010600@rabbitmq.com>
References: <29904396.post@talk.nabble.com>
	<AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
	<29913525.post@talk.nabble.com> <4CAEDBAD.9010600@rabbitmq.com>
Message-ID: <AANLkTikWZ3QBMGRi-gWKP1nFSV53LCUP6XPZr=2gn8ve@mail.gmail.com>

Matthias,

as you will see in the previous message, I tested the two settings for
exchanges (with x-lvc / with direct) : the difference is only 10% oc CPU
load and is still at 120% with direct exchanges. According to you, would it
be possible to control the producer flow ? In fact a ckeck could be done on
the publisher-side prior to publish any message : if the routeId belongs to
a list of required routeIds publish it otherwise no.

the problem is to have a routeIds list uptodate which requires :
- to know the all list of bindings at pblisher startup
- to be notify of each new binding when running.

Would this be possible ?
Thanks for your help.
Romain

2010/10/8 Matthias Radestock <matthias at rabbitmq.com>

> Romain,
>
>
> RomainC wrote:
>
>> 10 exchanges (with x-lvc plugin that stores in mnesia database the
>> last value for each message)
>>
>
> Ah, there is your explanation for the high CPU load then. The lvc plugin
> has not been designed/tuned for high performance. It does a transactional
> mnesia write per publish, which is hugely expensive.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/1e358934/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  8 10:18:56 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 10:18:56 +0100
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <AANLkTikWZ3QBMGRi-gWKP1nFSV53LCUP6XPZr=2gn8ve@mail.gmail.com>
References: <29904396.post@talk.nabble.com>
	<AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
	<29913525.post@talk.nabble.com> <4CAEDBAD.9010600@rabbitmq.com>
	<AANLkTikWZ3QBMGRi-gWKP1nFSV53LCUP6XPZr=2gn8ve@mail.gmail.com>
Message-ID: <4CAEE200.8010903@rabbitmq.com>

Romain,

Romain Conseil wrote:
> as you will see in the previous message, I tested the two settings for 
> exchanges (with x-lvc / with direct) : the difference is only 10% oc CPU 
> load and is still at 120% with direct exchanges.

Missed that, sorry. And thinking about it, 120% CPU for a 10kHz 
publisher stream sounds about right - I get similar figures on my machine.

> the problem is to have a routeIds list uptodate which requires :
> - to know the all list of bindings at pblisher startup
> - to be notify of each new binding when running.
> 
> Would this be possible ?

You could write a custom exchange type that captures the bind/unbind 
events. It would maintain internal state (in mnesia, perhaps) to count 
the number of bindings per routeId. Whenever that count transitions 
between zero and non-zero it would publish an message to an exchange, 
with the routeId as the routing key.

Producers could then bind to that exchange to receive a stream of 
bind/unbind events relevant to them. And making that exchange an lvc 
exchange allows new producers to learn about the current state.


Regards,

Matthias.

From romain.conseil at gmail.com  Fri Oct  8 10:27:43 2010
From: romain.conseil at gmail.com (Romain Conseil)
Date: Fri, 8 Oct 2010 11:27:43 +0200
Subject: [rabbitmq-discuss] Publish messages only when needed ?
In-Reply-To: <4CAEE200.8010903@rabbitmq.com>
References: <29904396.post@talk.nabble.com>
	<AANLkTim03gRek4Bt5aoH39LYJsuZ6-Zh1fBSPb3VQBkc@mail.gmail.com>
	<29913525.post@talk.nabble.com> <4CAEDBAD.9010600@rabbitmq.com>
	<AANLkTikWZ3QBMGRi-gWKP1nFSV53LCUP6XPZr=2gn8ve@mail.gmail.com>
	<4CAEE200.8010903@rabbitmq.com>
Message-ID: <AANLkTinnrzrq-x_JWuFZesNGx61QonrwtNUP=iYGrXUi@mail.gmail.com>

Ok,
Thanks for this Idea and the time spent, i will try to implement such an
exchange. Keep you informed !

Cheers
Romain

2010/10/8 Matthias Radestock <matthias at rabbitmq.com>

> Romain,
>
>
> Romain Conseil wrote:
>
>> as you will see in the previous message, I tested the two settings for
>> exchanges (with x-lvc / with direct) : the difference is only 10% oc CPU
>> load and is still at 120% with direct exchanges.
>>
>
> Missed that, sorry. And thinking about it, 120% CPU for a 10kHz publisher
> stream sounds about right - I get similar figures on my machine.
>
>
>  the problem is to have a routeIds list uptodate which requires :
>> - to know the all list of bindings at pblisher startup
>> - to be notify of each new binding when running.
>>
>> Would this be possible ?
>>
>
> You could write a custom exchange type that captures the bind/unbind
> events. It would maintain internal state (in mnesia, perhaps) to count the
> number of bindings per routeId. Whenever that count transitions between zero
> and non-zero it would publish an message to an exchange, with the routeId as
> the routing key.
>
> Producers could then bind to that exchange to receive a stream of
> bind/unbind events relevant to them. And making that exchange an lvc
> exchange allows new producers to learn about the current state.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/7b8f2d7e/attachment.htm>

From simon at rabbitmq.com  Fri Oct  8 11:11:10 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Oct 2010 11:11:10 +0100
Subject: [rabbitmq-discuss] bql crash
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>
Message-ID: <4CAEEE3E.5010109@rabbitmq.com>

On 02/10/10 00:02, Steve Haneman wrote:
> BQL> select * from exchanges
>
> {"init terminating in
> do_boot",{timeout,{gen_server,call,[<0.47.0>,{call,<<16 bytes>>,<<107
> bytes>>},500]}}}

I don't know whether this is going to be what you want to hear but, in 
general I would not recommend that you use BQL. It's unlikely to receive 
much in the way of future development and at some point will probably 
stop working. Use rabbitmq-management instead :)

Having said that, the error you're seeing is consistent with running the 
BQL client against a server which does not have the BQL plugin 
installed. Could that be the problem?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Fri Oct  8 12:30:46 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 8 Oct 2010 12:30:46 +0100
Subject: [rabbitmq-discuss] Tutorials for RabbitMQ
Message-ID: <AANLkTikmeD9hiXtO2kg_fq0jumhTY5A7VrCfbOJmwHeZ@mail.gmail.com>

Guys,

We're working on a few tutorials for RabbitMQ.
They are addressed to the beginners, but we hope that even
more experienced users can learn something from them.

You can see them here:

http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-two.md
http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-three.md

http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/tutorial-one.md

The work is very much in progress, so please do let us know about typos,
mistakes or any ideas how to enhance them.

Cheers,
  Marek

From matthew at rabbitmq.com  Fri Oct  8 13:12:07 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 8 Oct 2010 13:12:07 +0100
Subject: [rabbitmq-discuss] Failed upgrade from 1.8.1 to 2.1.0
In-Reply-To: <13F25047-7FB8-42BC-AB84-82E6C4F54C91@ketralnis.com>
References: <13F25047-7FB8-42BC-AB84-82E6C4F54C91@ketralnis.com>
Message-ID: <20101008121207.GP28336@rabbitmq.com>

Hi David,

Glad you're well.

On Thu, Oct 07, 2010 at 05:32:36PM -0700, David King wrote:
> At first (about 15:10 on the graph), almost all of the queues started
> growing. Consumers would hang, unaided by restarts. But some of the
> queues (like commenstree_q and register_vote_q) didn't have any
> trouble at all.

Ok, how much memory is in the box, and what are the average sizes of
these messages? Are you setting the memory_high_watermark to anything
non-default (of 0.4)? When rabbit starts, there should be entries in the
logs saying things like:

=INFO REPORT==== 8-Oct-2010::12:47:52 ===
Memory limit set to 4816MB.

What does it say in your case?

I suspect that you're maybe hitting the memory high watermark - are
there any entries in the logs like:

=INFO REPORT==== 7-Oct-2010::17:41:43 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

?

Also, are you publishing messages transient or persistent (what's the
delivery_mode when you publish messages)?. And your consumers that
blocked, are these the ones using basic.get or basic.consume? And are
they acking messages or using autoack? Are any of the consumers doing
any publishes too?

> At about 15:50, after about 30 minutes of trying to figure out what
> was going on I restarted rabbit. This time, some of the queues that
> were uncomsumable before (like spam_q and corrections_q) were now
> working, but other queues (like indextank_changes) would still hang on
> consuming.

Interesting. What actions other than basic.consume (I assume) are these
consumers doing when they connect? Do they try and redeclare the queue
or create any other resources?

> At 16:20 I gave up and started reverting back to the other queue
> machine (running rabbit 1.8.1). As that happened, some of the queues
> that were unconsumable finally started shrinkining and their consumers
> unhung. Some of them (newcomments_q) processed all of the items in the
> queue basically instantly, so this isn't a case of our own app not
> being able to keep up. By about 16:30 I'd completed moving back to the
> old machine.

Ok, what was the disk activity during this exercise in general? The new
persister is much better at coping with memory pressure. However, that
has a few interesting and possibly surprising facets:

1. Eventually, if memory pressure continues to build, all messages have
to be written to disk.

2. At no point do we want the queue to become unresponsive. This means
that we have to batch work, and actually start writing messages to disk
fairly early on, in the general scheme of things: we don't want to get
to the point where we suddenly realise we have to write out millions of
items to disk: we want a smooth transition to occur.

3. Short fast queues are prioritised. This is because they probably
won't be able to maintain their rates if they're having to go via the
disk, whereas slower queues probably can. That said, we work as hard as
possible to avoid having to do any reads until things get really bad,
memory wise. Most of the time, it should just be appends.

Of course, all of this is only relevant if you're actually seeing the
disk thrashing itself to death and you're running out of memory.

We have recently identified and fixed some memory issues with queues in
general, however, they're only really relevant if you're using thousands
of queues, so I don't think it's these that are biting you.

> Also, this is unrelated, but I'd provisioned the new machine a couple
> of weeks ago, and it's been sitting literally 100% idle until I tried
> moving today. But look at its memory usage over the last week
> <http://i.imgur.com/M7x6m.png>. What on earth could it be doing that
> it's growing in memory when *not used*? This machine is identical to
> our other machines (it's an EC2 node from the same AMI), but only this
> node has this problem, and all it's running is rabbit.

Now that is interesting. What version of Erlang are you running?

Matthew

From simon at rabbitmq.com  Fri Oct  8 13:49:23 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Oct 2010 13:49:23 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
Message-ID: <4CAF1353.9000500@rabbitmq.com>

On 06/10/10 21:37, Chris Chew wrote:
> I get the following error:
>
> The server encountered an error while processing this request:
> {error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},

Hmm. The only way I was able to get this error was to use an old version 
of mochiweb with the management plugin. Could this be happening to you? 
Did you grab the .ez files from rabbitmq.com, build from source, 
something else? Could there be another version of mochiweb around somehow?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From taylste at gmail.com  Fri Oct  8 13:50:29 2010
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 8 Oct 2010 13:50:29 +0100
Subject: [rabbitmq-discuss] Distributed garbage collection
Message-ID: <AANLkTinMG+5fQMtD4xyRoHXvO+mhd8CwWUj6=q4eEO66@mail.gmail.com>

Hi Guys,

I'm digging into RabbitMQ, and would like to build in fault
tollerance, scalability, and garbage collection within the cloud (highly
asynchronous context).  Probably the solution should be message queue based,
and heuristic based.  eg. I lost the connection, so self destruct.  The
queue is filling up, so fire up more instances. Talk to AWS and conduct an
audit on nodes sending in a heart beat. Destroy anything that does not
respond.

Would anyone care to share some experiences?  There have got to be a few
papers out there on this.  I'm hoping to get through this without rebuilding
the operating system.  Given that RabbitMQ relies on Erlang, I'm hoping to
get some of this for free, and that new nodes can make lightweight
considerations in code.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/91393021/attachment.htm>

From simon at rabbitmq.com  Fri Oct  8 13:53:49 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Oct 2010 13:53:49 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <4CAF1353.9000500@rabbitmq.com>
References: <74D4EDFED2256749A5BF5B59267E085303C72BCC@EXMBCL01CORP.eclg.org>
	<4CAF1353.9000500@rabbitmq.com>
Message-ID: <4CAF145D.9070204@rabbitmq.com>

On 08/10/10 13:49, Simon MacMullen wrote:
> On 06/10/10 21:37, Chris Chew wrote:
>> I get the following error:
>>
>> The server encountered an error while processing this request:
>> {error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
>
> Hmm. The only way I was able to get this error was to use an old version
> of mochiweb with the management plugin. Could this be happening to you?
> Did you grab the .ez files from rabbitmq.com, build from source,
> something else? Could there be another version of mochiweb around somehow?

Ah, I see from your original mail that you downloaded the .ez files. 
Still, could there somehow be another version of mochiweb around?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From 0x6e6562 at gmail.com  Fri Oct  8 14:37:34 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 8 Oct 2010 14:37:34 +0100
Subject: [rabbitmq-discuss] bql crash
In-Reply-To: <4CAEEE3E.5010109@rabbitmq.com>
References: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>
	<4CAEEE3E.5010109@rabbitmq.com>
Message-ID: <AANLkTin5m8M2UQDag=ZmFUdnyDcbADXGYKDB++cb0n0f@mail.gmail.com>

Simon,

On Fri, Oct 8, 2010 at 11:11 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> I don't know whether this is going to be what you want to hear but, in
> general I would not recommend that you use BQL. It's unlikely to receive
> much in the way of future development and at some point will probably stop
> working. Use rabbitmq-management instead :)

I was just about to recommend an upgrade of a production installation
of 1.7.2 server (with BQL installed) to a client.

Can you give a non-official recommendation of the best combination of
the server and BQL would be (under consideration of the current state
of the umbrella)? Or is this just a case of suck it and see?

Cheers,

Ben

From tim at cantemo.com  Fri Oct  8 15:03:59 2010
From: tim at cantemo.com (Tim Child)
Date: Fri, 8 Oct 2010 16:03:59 +0200
Subject: [rabbitmq-discuss] Tutorials for RabbitMQ
In-Reply-To: <AANLkTikmeD9hiXtO2kg_fq0jumhTY5A7VrCfbOJmwHeZ@mail.gmail.com>
References: <AANLkTikmeD9hiXtO2kg_fq0jumhTY5A7VrCfbOJmwHeZ@mail.gmail.com>
Message-ID: <AB8F1016-D2BA-499D-BFF4-404002C423CD@cantemo.com>

Fantastic.

I will work through the tutorials this weekend and post a response back to the message list.

Tim.

On 8 Oct 2010, at 13:30, Marek Majkowski wrote:

> Guys,
> 
> We're working on a few tutorials for RabbitMQ.
> They are addressed to the beginners, but we hope that even
> more experienced users can learn something from them.
> 
> You can see them here:
> 
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-two.md
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-three.md
> 
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/tutorial-one.md
> 
> The work is very much in progress, so please do let us know about typos,
> mistakes or any ideas how to enhance them.
> 
> Cheers,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Tim Child
+46 (0) 7602 17785
Skype: timchild
http://www.cantemo.com
CANTEMO

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/ff019dbb/attachment-0001.htm>

From simon at rabbitmq.com  Fri Oct  8 16:07:31 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Oct 2010 16:07:31 +0100
Subject: [rabbitmq-discuss] bql crash
In-Reply-To: <AANLkTin5m8M2UQDag=ZmFUdnyDcbADXGYKDB++cb0n0f@mail.gmail.com>
References: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>	<4CAEEE3E.5010109@rabbitmq.com>
	<AANLkTin5m8M2UQDag=ZmFUdnyDcbADXGYKDB++cb0n0f@mail.gmail.com>
Message-ID: <4CAF33B3.7070705@rabbitmq.com>

On 08/10/10 14:37, Ben Hood wrote:
> I was just about to recommend an upgrade of a production installation
> of 1.7.2 server (with BQL installed) to a client.
>
> Can you give a non-official recommendation of the best combination of
> the server and BQL would be (under consideration of the current state
> of the umbrella)? Or is this just a case of suck it and see?

I think that's it I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From chrisch at ecollege.com  Fri Oct  8 16:10:17 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 8 Oct 2010 09:10:17 -0600
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <4CAF1353.9000500@rabbitmq.com>
Message-ID: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: Friday, October 08, 2010 6:49 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
> 
> On 06/10/10 21:37, Chris Chew wrote:
> > I get the following error:
> >
> > The server encountered an error while processing this request:
> >
{error,{exit,{json_encode,{bad_term,{bound_to,[<<"0.0.0.0:5672">>]}}},
> 
> Hmm. The only way I was able to get this error was to use an old
version
> of mochiweb with the management plugin. Could this be happening to
you?
> Did you grab the .ez files from rabbitmq.com, build from source,
> something else? Could there be another version of mochiweb around
somehow?

So it appears I do have a stale hand-compiled version of mochiweb in the
Erlang lib directory on that server.  I'll remove it and try again
today.

Assuming that fixes the problem, I apologize for wasting your time! :)

Thank you,

Chris

From simon at rabbitmq.com  Fri Oct  8 16:16:19 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Oct 2010 16:16:19 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>
References: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>
Message-ID: <4CAF35C3.4080606@rabbitmq.com>

On 08/10/10 16:10, Chris Chew wrote:
> Assuming that fixes the problem, I apologize for wasting your time! :)

That's fine, I'm just glad this isn't some weird bug...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From 0x6e6562 at gmail.com  Fri Oct  8 16:28:04 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 8 Oct 2010 16:28:04 +0100
Subject: [rabbitmq-discuss] bql crash
In-Reply-To: <4CAF33B3.7070705@rabbitmq.com>
References: <A1CB3D904533654CB64599397AC43ADE01406798E59E@NAMBX02.corp.adobe.com>
	<4CAEEE3E.5010109@rabbitmq.com>
	<AANLkTin5m8M2UQDag=ZmFUdnyDcbADXGYKDB++cb0n0f@mail.gmail.com>
	<4CAF33B3.7070705@rabbitmq.com>
Message-ID: <AANLkTikkaTGjwpUaqVB+=ER_JcGra7eTXhtd73hpqJwu@mail.gmail.com>

On Fri, Oct 8, 2010 at 4:07 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> Can you give a non-official recommendation of the best combination of
>> the server and BQL would be (under consideration of the current state
>> of the umbrella)? Or is this just a case of suck it and see?
>
> I think that's it I'm afraid.

Cool, thanks for the heads up.

Cheers, Ben

From romain.conseil at gmail.com  Fri Oct  8 16:50:44 2010
From: romain.conseil at gmail.com (Romain Conseil)
Date: Fri, 8 Oct 2010 17:50:44 +0200
Subject: [rabbitmq-discuss] Clustering & load balancing
Message-ID: <AANLkTikN2WT0iSY0wQKVtMLw2BnXB=xgwH_f4qixDe0n@mail.gmail.com>

Hi

Following to my previous post (high CPU load due to 10kHz messages), I
tested clustering on a single node with the help of the tutorial.
Everything is set correctly, 3 instances (one disk, 2 ram) on my single
machine. When I start the message flow, I can see that the exhcnages are
shared trhough the 3 nodes but nevertheless the cpu load is not balanced on
the 3 nodes but only one. When reading I have understood that clustering was
different from the load balancing I expected. Then how could I configure
such a behaviour ?

Thanks for your help.
Romain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/c63edfa2/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  8 16:53:23 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 16:53:23 +0100
Subject: [rabbitmq-discuss] Clustering & load balancing
In-Reply-To: <AANLkTikN2WT0iSY0wQKVtMLw2BnXB=xgwH_f4qixDe0n@mail.gmail.com>
References: <AANLkTikN2WT0iSY0wQKVtMLw2BnXB=xgwH_f4qixDe0n@mail.gmail.com>
Message-ID: <4CAF3E73.1080305@rabbitmq.com>

Romain,

On 08/10/10 16:50, Romain Conseil wrote:
> Following to my previous post (high CPU load due to 10kHz messages), I
> tested clustering on a single node with the help of the tutorial.
> Everything is set correctly, 3 instances (one disk, 2 ram) on my single
> machine. When I start the message flow, I can see that the exhcnages are
> shared trhough the 3 nodes but nevertheless the cpu load is not balanced
> on the 3 nodes but only one. When reading I have understood that
> clustering was different from the load balancing I expected. Then how
> could I configure such a behaviour ?

Do your publishers connect to different nodes? If they all connect to 
the same node then that load gets all the load.


Matthias.

From shane at digitalsanctum.com  Fri Oct  8 17:44:21 2010
From: shane at digitalsanctum.com (Shane)
Date: Fri, 8 Oct 2010 09:44:21 -0700 (PDT)
Subject: [rabbitmq-discuss] how to remotely start/stop broker nodes
Message-ID: <09dde643-54cf-475a-a6cd-be51d9e0a355@f25g2000yqc.googlegroups.com>

What's the recommended way of remotely controlling brokers. More
specifically, starting and stopping nodes. I looked at the management
plugin but didn't see anything available there. Ideally, I'd like to
be able to explicitly start/stop brokers via HTTP to test failover
scenarios.

Thanks,
Shane

From romain.conseil at gmail.com  Fri Oct  8 18:02:18 2010
From: romain.conseil at gmail.com (Romain Conseil)
Date: Fri, 8 Oct 2010 19:02:18 +0200
Subject: [rabbitmq-discuss] Clustering & load balancing
In-Reply-To: <4CAF3E73.1080305@rabbitmq.com>
References: <AANLkTikN2WT0iSY0wQKVtMLw2BnXB=xgwH_f4qixDe0n@mail.gmail.com>
	<4CAF3E73.1080305@rabbitmq.com>
Message-ID: <AANLkTimqn9QnhkpS4Le9X=VKD-hdDArV3UC9coKNJp_g@mail.gmail.com>

Yes they connect to the same node... I was not clear in fact : is there a
way to implement a kind of proxy that balance load ?
Publishers could then send messages transparently to a single adress.

Thanks

2010/10/8 Matthias Radestock <matthias at rabbitmq.com>

> Romain,
>
>
> On 08/10/10 16:50, Romain Conseil wrote:
>
>> Following to my previous post (high CPU load due to 10kHz messages), I
>> tested clustering on a single node with the help of the tutorial.
>> Everything is set correctly, 3 instances (one disk, 2 ram) on my single
>> machine. When I start the message flow, I can see that the exhcnages are
>> shared trhough the 3 nodes but nevertheless the cpu load is not balanced
>> on the 3 nodes but only one. When reading I have understood that
>> clustering was different from the load balancing I expected. Then how
>> could I configure such a behaviour ?
>>
>
> Do your publishers connect to different nodes? If they all connect to the
> same node then that load gets all the load.
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/9e5a3260/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Oct  8 18:10:40 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Oct 2010 18:10:40 +0100
Subject: [rabbitmq-discuss] Clustering & load balancing
In-Reply-To: <AANLkTimqn9QnhkpS4Le9X=VKD-hdDArV3UC9coKNJp_g@mail.gmail.com>
References: <AANLkTikN2WT0iSY0wQKVtMLw2BnXB=xgwH_f4qixDe0n@mail.gmail.com>
	<4CAF3E73.1080305@rabbitmq.com>
	<AANLkTimqn9QnhkpS4Le9X=VKD-hdDArV3UC9coKNJp_g@mail.gmail.com>
Message-ID: <4CAF5090.1070907@rabbitmq.com>

Romain,

On 08/10/10 18:02, Romain Conseil wrote:
> is there a way to implement a kind of proxy that balance load ?

Any decent off-the-shelf TCP load balancer should be able to do this. 
Others on this list may have some recommendations.


Matthias.

From dking at ketralnis.com  Fri Oct  8 19:53:28 2010
From: dking at ketralnis.com (David King)
Date: Fri, 8 Oct 2010 11:53:28 -0700
Subject: [rabbitmq-discuss] Failed upgrade from 1.8.1 to 2.1.0
In-Reply-To: <20101008121207.GP28336@rabbitmq.com>
References: <13F25047-7FB8-42BC-AB84-82E6C4F54C91@ketralnis.com>
	<20101008121207.GP28336@rabbitmq.com>
Message-ID: <D36A9E17-B4AE-4132-98E7-8A8FBFF5F936@ketralnis.com>

> Ok, how much memory is in the box, and what are the average sizes of
> these messages? Are you setting the memory_high_watermark to anything
> non-default (of 0.4)? When rabbit starts, there should be entries in the
> logs saying things like:

The messages average about 8 bytes (they are mostly IDs that look like "t3_abcde"). The machine has 7.5gb of RAM, and the log messages you describe look like:

    =INFO REPORT==== 7-Oct-2010::15:54:19 ===
    Limiting to approx 924 file handles (829 sockets)
    =INFO REPORT==== 7-Oct-2010::15:54:19 ===
    Memory limit set to 3081MB.

> I suspect that you're maybe hitting the memory high watermark - are
> there any entries in the logs like:

There are no messages mentioning vm_memory_high_watermark or alarms:

    ri at q01:~/rabbitmq_server/log$ egrep -i '(alarm|memory)' *
    rabbit at q01.log:Memory limit set to 3081MB.
    rabbit at q01.log.1:Memory limit set to 3081MB.
    rabbit at q01.log.1:Memory limit set to 3081MB.

And as you can see in the memory graph I included at the end there, the bump at the end was this attempted upgrade, and the machine definitely didn't run out of RAM. But that "924 file handles" does look quite low, how can I increase that?

> Also, are you publishing messages transient or persistent (what's the
> delivery_mode when you publish messages)?. And your consumers that
> blocked, are these the ones using basic.get or basic.consume? And are
> they acking messages or using autoack? Are any of the consumers doing
> any publishes too?

Some messages are transient and some are persistent. The blocked queues appear to be a mix of basic.get and basic.consume. The consumers ack their own messages (not autoack). I don't think any of the consumers publish messages

> Interesting. What actions other than basic.consume (I assume) are these
> consumers doing when they connect? Do they try and redeclare the queue
> or create any other resources?

They do all try to redeclare all of the queues and bindings, yes

> Ok, what was the disk activity during this exercise in general?

I didn't get a note of it, but the CPU usage, including WAIT CPU, didn't noticeably increase (I have the CPU graph for that period and it's flat with respect to before, during, and after the upgrade), and I'd expect the WAIT to go up if the disk was swamped. 

>> Also, this is unrelated, but I'd provisioned the new machine a couple
>> of weeks ago, and it's been sitting literally 100% idle until I tried
>> moving today. But look at its memory usage over the last week
>> <http://i.imgur.com/M7x6m.png>. What on earth could it be doing that
>> it's growing in memory when *not used*? This machine is identical to
>> our other machines (it's an EC2 node from the same AMI), but only this
>> node has this problem, and all it's running is rabbit.
> Now that is interesting. What version of Erlang are you running?

ri at q01:~/rabbitmq_server/log$ erl --version
Erlang R14B (erts-5.8.1) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [kernel-poll:false]

Thanks for the help so far :)

From pdezwart at rubiconproject.com  Sat Oct  9 02:54:02 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 08 Oct 2010 18:54:02 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <AANLkTikR1pD8akoa225TtSEsMneodN26K2h7VrpCKzT2@mail.gmail.com>
Message-ID: <C8D5194A.10A2F%pdezwart@rubiconproject.com>

Happy too. Though I?m gonna point at you if we start annoying people =)

I looked through the Java client, which would seem to be the most mature and
well built client to date. The major difference between the PHP extension
(hereby PHPE) and the Java client (hereby JC... get it?) is that the JC
allows the creation of multiple channels, and the ability to act within a
channel. PHPE instead uses one channel for everything (channel 1.)
As far as objects go, since I want PHPE to be OO, the current layout seems
to make sense to me, with AMQPConnection, AMQPExchange and AMQPQueue. From
there, the methods I think need to be cleaned up:
AMQPConnection should continue to allow the $params = array() setup, whereby
a user can create and set username, password, host, port and vhost, like so:

$cnn = new AMQPConnection(array(?login? => ?guest?, ?password? => ??, ?host?
=> ?localhost?)); 

However, I want to remove the auto-connect portion of the constructor, so
users have to call:

$cnn->connect();

That way, we can also add the following method: setLogin, setPassword,
setPort, setHost, setVHost. I also want to add the following action methods:
reconnect, disconnect.

The connection object should in turn give access to exchanges and queues,
but how I am not yet sure, and I would love feedback from everyone on this.
I like JC?s approach of using AMQPConnection->queueDeclare and
AMQPConnectio->exchangeDeclare which would return instances of AMQPQueue and
AMQPExchange respectively. I guess those methods would also accept an
additional bit mask for options, and if the queue/exchange already exists,
the new bit mask values would be applied...

I am tired, so I will stop here and look for others to poke holes in my
theory. Feedback from JC users in particular would be much appreciated in
terms of likes and dislikes of their client.

Pieter 



On 10/8/10 12:41 AM, "Pedram Nimreezi" <mc at majorcomputing.com> wrote:

> Keep it on the air ways...? if you would...
> 
> 
> 
> On Fri, Oct 8, 2010 at 3:11 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Well,
>> 
>> I said where is the place to contribute, not that I had something to
>> contribute right now?
>> 
>> But we might start using this extension in prod and I remember last time I
>> checked the API there was some stuff I'd like it to be "different"
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:
>> 
>>> > Oh thank you deity of your choice for answering me. I need help.
>>> > Lets take this off list so we don't pollute the airways.
>>> > Pieter
>>> >
>>> >
>>> > On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>> >
>>>> >> Hi Pieter,
>>>> >>
>>>> >> My question is more where is the source code that we can contribute
>>>> back. I
>>>> >> know about the PECL stuff :)
>>>> >>
>>>> >> Regards,
>>>> >>
>>>> >> Alvaro
>>>> >>
>>>> >>
>>>> >> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
>>>> >>
>>>>> >>> Excellent question. The source code for this:
>>>>> >>> http://php.net/manual/en/book.amqp.php
>>>>> >>> is available here:
>>>>> >>> http://pecl.php.net/package/amqp
>>>>> >>>
>>>>> >>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The
one
>>>>> >>> listed works with 1.7.*.
>>>>> >>>
>>>>> >>> Pieter
>>>>> >>>
>>>>> >>>
>>>>> >>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>>>> >>>
>>>>>> >>>> I think is php-rabbit
>>>>>> >>>>
>>>>>> >>>> Thanks!
>>>>>> >>>>
>>>>>> >>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>>>>> >>>>
>>>>>>> >>>>> Could it be one of these?
>>>>>>> >>>>>
>>>>>>> >>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>>>>>> >>>>>
>>>>>>> >>>>>
>>>>>>> >>>>>
>>>>>>> >>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla
>>>>>>> <videlalvaro at gmail.com>
>>>>>>> >>>>> wrote:
>>>>>>>> >>>>>> Hi,
>>>>>>>> >>>>>>
>>>>>>>> >>>>>> I would like to know where's the code for the PHP extension that
>>>>>>>> appears
>>>>>>>> >>>>>> on
>>>>>>>> >>>>>> the PHP website.
>>>>>>>> >>>>>>
>>>>>>>> >>>>>> Regards,
>>>>>>>> >>>>>>
>>>>>>>> >>>>>> Alvaro
>>>>>>>> >>>>>> _______________________________________________
>>>>>>>> >>>>>> rabbitmq-discuss mailing list
>>>>>>>> >>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>> >>>>>> 
>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>> >>>>>>
>>>>>> >>>>
>>>>>> >>>> _______________________________________________
>>>>>> >>>> rabbitmq-discuss mailing list
>>>>>> >>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>> >>>
>>>> >>
>>> >
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101008/98b7ad30/attachment.htm>

From tim at cantemo.com  Sat Oct  9 14:28:07 2010
From: tim at cantemo.com (Tim Child)
Date: Sat, 9 Oct 2010 15:28:07 +0200
Subject: [rabbitmq-discuss] Tutorials for RabbitMQ
In-Reply-To: <AB8F1016-D2BA-499D-BFF4-404002C423CD@cantemo.com>
References: <AANLkTikmeD9hiXtO2kg_fq0jumhTY5A7VrCfbOJmwHeZ@mail.gmail.com>
	<AB8F1016-D2BA-499D-BFF4-404002C423CD@cantemo.com>
Message-ID: <B981AB02-D3F6-4C90-9A74-DABE4B749250@cantemo.com>

So I just ran through the tutorials on a fresh Ubuntu 10.04 LTS server with RabbitMQ installed.

Overall:

Good basic level of tutorial, and the basics of queuing.

In Tutorial One:

You mentioned how to install PIP, and Pika but not how to install Git - which didn't come on my fresh Ubuntu installation.

In Tutorial Two:

Basic I know, but its a step that is missing:

chmod +x new_task.py

In Tutorial Three:

All though we deal with the the fanout exchange type, it might be wise to include a link to the documentation which describes the other types of exchange types.

"Secondly, once we disconnect the client the queue" - client - should that be the consumer?
chmod -x scripts again

It would also be interesting to say at the end that you can open more than one session of ./receive_logs.py
And to look at:

rabbitmqctl list_bindings.

When you have the receive_logs running and not running.

Maybe next steps:

One of the things that I have actually found harder than implementation of how to work with RabbitMq is actually making good design decisions on queues, bindings, exchanges. Not sure what can be done there, or if there is a good resource of AMQP patterns.

Good stuff anyway!

Tim.




On 8 Oct 2010, at 16:03, Tim Child wrote:

> Fantastic.
> 
> I will work through the tutorials this weekend and post a response back to the message list.
> 
> Tim.
> 
> On 8 Oct 2010, at 13:30, Marek Majkowski wrote:
> 
>> Guys,
>> 
>> We're working on a few tutorials for RabbitMQ.
>> They are addressed to the beginners, but we hope that even
>> more experienced users can learn something from them.
>> 
>> You can see them here:
>> 
>> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
>> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-two.md
>> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-three.md
>> 
>> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/tutorial-one.md
>> 
>> The work is very much in progress, so please do let us know about typos,
>> mistakes or any ideas how to enhance them.
>> 
>> Cheers,
>>  Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Tim Child
> +46 (0) 7602 17785
> Skype: timchild
> http://www.cantemo.com
> CANTEMO



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101009/e37cc4fc/attachment-0001.htm>

From tim at cantemo.com  Sat Oct  9 14:58:38 2010
From: tim at cantemo.com (Tim Child)
Date: Sat, 9 Oct 2010 15:58:38 +0200
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <4CAF35C3.4080606@rabbitmq.com>
References: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>
	<4CAF35C3.4080606@rabbitmq.com>
Message-ID: <03EA8C36-7C2D-49CA-B233-2C01C127EDA8@cantemo.com>

This is probably unrelated, but I copied:

amqp_client-2.1.0.ez  mochiweb-2.1.0.ez  rabbitmq-management-2.1.0.ez  rabbitmq-mochiweb-2.1.0.ez  webmachine-2.1.0.ez

Into /usr/lib/rabbitmq/lib/rabbitmq_server-2.1.0/plugins/ 

And then restarted:

sudo /etc/init.	d/rabbitmq-server restart

And I got this in start_log:

Activating RabbitMQ plugins ...
ERROR: failed to load application inets:
{"no such file or directory","inets.app"}


From tim at cantemo.com  Sat Oct  9 15:05:30 2010
From: tim at cantemo.com (Tim Child)
Date: Sat, 9 Oct 2010 16:05:30 +0200
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <03EA8C36-7C2D-49CA-B233-2C01C127EDA8@cantemo.com>
References: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>
	<4CAF35C3.4080606@rabbitmq.com>
	<03EA8C36-7C2D-49CA-B233-2C01C127EDA8@cantemo.com>
Message-ID: <86C1BD63-5E04-49B4-9AD9-E146B690D1BE@cantemo.com>

To answer my own question inets was missing from /usr/lib/erland/lib/

sudo apt-get install erlang-inets

Fixed that.



From simon at rabbitmq.com  Sat Oct  9 17:14:25 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 09 Oct 2010 17:14:25 +0100
Subject: [rabbitmq-discuss] Management Plugin v2.1.0 Problems
In-Reply-To: <86C1BD63-5E04-49B4-9AD9-E146B690D1BE@cantemo.com>
References: <74D4EDFED2256749A5BF5B59267E085303D89E16@EXMBCL01CORP.eclg.org>	<4CAF35C3.4080606@rabbitmq.com>	<03EA8C36-7C2D-49CA-B233-2C01C127EDA8@cantemo.com>
	<86C1BD63-5E04-49B4-9AD9-E146B690D1BE@cantemo.com>
Message-ID: <4CB094E1.3080200@rabbitmq.com>

On 09/10/2010 3:05PM, Tim Child wrote:
> To answer my own question inets was missing from /usr/lib/erland/lib/
>
> sudo apt-get install erlang-inets
>
> Fixed that.

Cool. BTW the next .deb for rabbitmq-server will install erlang-inets in 
case you want the management plugin.

Cheers, Simon

From preeti.padalia at gmail.com  Mon Oct 11 12:13:57 2010
From: preeti.padalia at gmail.com (padl)
Date: Mon, 11 Oct 2010 04:13:57 -0700 (PDT)
Subject: [rabbitmq-discuss] How to ensure the message delivery using shared
 queues
Message-ID: <29933060.post@talk.nabble.com>


hi

 I am a novice user. I just want to know when we use shared queue how to
ensure the delivery and durability of message?

Any help will be appreciable.

Thank You
-- 
View this message in context: http://old.nabble.com/How-to-ensure-the-message-delivery-using-shared-queues-tp29933060p29933060.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From thomasbam at gmail.com  Mon Oct 11 16:25:45 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Mon, 11 Oct 2010 17:25:45 +0200
Subject: [rabbitmq-discuss] Guaranteed delivery
Message-ID: <AANLkTimVRT-rmJZU0Nrs4e+ABOdcoEBAV-C_u79SJToQ@mail.gmail.com>

Hi all,


I'd like to know what is the best way to deal with communication
errors (rabbitmq crash or network problems for example), with java
API.

We use the Channel.basicPublish(...) method and we would like to
guaranty delivery for each message we send to the broker.

How would you do that ?

Thank you,

Bruno Thomas

From bsellner at seegrid.com  Mon Oct 11 18:35:31 2010
From: bsellner at seegrid.com (Brennan Sellner)
Date: Mon, 11 Oct 2010 13:35:31 -0400
Subject: [rabbitmq-discuss] Durable exclusive queues
Message-ID: <1286818531.15860.4346.camel@bsellner>

Hi all,

Does anyone have a preferred mechanism for creating what amounts to a
durable, exclusive queue?  We need durable queues, and want to ensure
that only one client subscribes to each queue at a time.  I'm not seeing
an AMQP way to do this, since exclusive and durable are mutually
exclusive: am I missing something?

Alternatively, I could hack around this if there were a way to retrieve
the number of clients subscribed to a given queue, but again I haven't
been able to find any way to get that information.

We're using Rabbit 2.1.0, with txAMQP 0.3.

Thanks,

-Brennan




From alexandru at rabbitmq.com  Mon Oct 11 19:00:54 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 11 Oct 2010 19:00:54 +0100
Subject: [rabbitmq-discuss] Durable exclusive queues
In-Reply-To: <1286818531.15860.4346.camel@bsellner>
References: <1286818531.15860.4346.camel@bsellner>
Message-ID: <20101011180054.GB2568@dakota.eng.vmware.com>

Hi Brennan,

I don't think exclusive queues are quite what you expect them to be.
An exclusive queue can only be accessed by the channel that created it.
A durable queue is one that survives a broker restart.  Since the
connection and channel will be closed on a broker restart, a durable
exclusive queue would become completely unaccessible.

What you probably want is exclusive consumers.  If a consumer sets the
exclusive bit in the basic.consume method, only that consumer is
allowed to consume from the queue.  Using this, you can ensure that only
one consumer consumes from any queue at any time.

I'm not familiar with txAMQP, but have a look at basic.consume.  There
should (fingers crossed) be an 'exclusive' parameter.

Cheers,
Alex

On Mon, Oct 11, 2010 at 01:35:31PM -0400, Brennan Sellner wrote:
> Hi all,
> 
> Does anyone have a preferred mechanism for creating what amounts to a
> durable, exclusive queue?  We need durable queues, and want to ensure
> that only one client subscribes to each queue at a time.  I'm not seeing
> an AMQP way to do this, since exclusive and durable are mutually
> exclusive: am I missing something?
> 
> Alternatively, I could hack around this if there were a way to retrieve
> the number of clients subscribed to a given queue, but again I haven't
> been able to find any way to get that information.
> 
> We're using Rabbit 2.1.0, with txAMQP 0.3.
> 
> Thanks,
> 
> -Brennan
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rob at rabbitmq.com  Mon Oct 11 19:15:52 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 11 Oct 2010 19:15:52 +0100
Subject: [rabbitmq-discuss] Java Client Heartbeat
In-Reply-To: <db219b5a-71f0-4051-bb1d-38453b92577a@j18g2000yqd.googlegroups.com>
References: <db219b5a-71f0-4051-bb1d-38453b92577a@j18g2000yqd.googlegroups.com>
Message-ID: <97A91E13-3570-4066-A0E6-CBE99089F289@rabbitmq.com>

Danielius,

I just pushed a patch up to mercurial on branch bug23357 that moves the heartbeat on to a separate thread.

Please can you try this for your use case and let me know how it works out.

Regards,

Rob

On 29 Sep 2010, at 07:03, Danielius Jurna wrote:

> Hi.
> I'm testing the robustness of rabbitmq server/java client on
> unreliable network.
> It seems that there is a flaw in heartbeat implementatin in java
> client.
> Here is the scenario.
> 1. Message producer tries to publish message to server. During this
> connection is lost in the network. Client blocks on socket write.
> (SocketFrameHandler.writeFrame)
> 2. Heartbeat implementation tries to send heartbeat message to server.
> It also blocks in SocketFrameHandler.writeFrame on synchronized
> statement.
> 3. The whole client blocks until tcp timeouts. This takes ages.
> 
> I cannot see how current implementation can work correctly until you
> have separate heartbeat thread.
> Is there a plan to improve java client robustness on unreliabile
> networks?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From cybergrind at gmail.com  Mon Oct 11 22:07:08 2010
From: cybergrind at gmail.com (CyBergRind CBR)
Date: Tue, 12 Oct 2010 00:07:08 +0300
Subject: [rabbitmq-discuss] Durable exclusive queues
In-Reply-To: <1286818531.15860.4346.camel@bsellner>
References: <1286818531.15860.4346.camel@bsellner>
Message-ID: <AANLkTinvj_pMGGN2e0kQnME9-n5BQ++4hEAbjJ4JJCUL@mail.gmail.com>

Hi,
This is from amqp 0-8 spec (
http://www.amqp.org/confluence/download/attachments/720900/amqp0-8.xml)

definition of parameters for consume:
<field name="exclusive" type="bit">
    request exclusive access
<doc>
      Request exclusive consumer access, meaning only this consumer can
      access the queue.
</doc>
<doc name="rule" test="amq_basic_02">
      If the server cannot grant exclusive access to the queue when asked,
      - because there are other consumers active - it MUST raise a channel
      exception with return code 403 (access refused).
</doc>


On Mon, Oct 11, 2010 at 8:35 PM, Brennan Sellner <bsellner at seegrid.com>wrote:

> Hi all,
>
> Does anyone have a preferred mechanism for creating what amounts to a
> durable, exclusive queue?  We need durable queues, and want to ensure
> that only one client subscribes to each queue at a time.  I'm not seeing
> an AMQP way to do this, since exclusive and durable are mutually
> exclusive: am I missing something?
>
> Alternatively, I could hack around this if there were a way to retrieve
> the number of clients subscribed to a given queue, but again I haven't
> been able to find any way to get that information.
>
> We're using Rabbit 2.1.0, with txAMQP 0.3.
>
> Thanks,
>
> -Brennan
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/909aa48b/attachment.htm>

From cybergrind at gmail.com  Mon Oct 11 22:09:30 2010
From: cybergrind at gmail.com (CyBergRind CBR)
Date: Tue, 12 Oct 2010 00:09:30 +0300
Subject: [rabbitmq-discuss] Durable exclusive queues
In-Reply-To: <20101011180054.GB2568@dakota.eng.vmware.com>
References: <1286818531.15860.4346.camel@bsellner>
	<20101011180054.GB2568@dakota.eng.vmware.com>
Message-ID: <AANLkTinMaWvrEVyOBvgo8WLRD-_Rir-yHgkuBck+kSrp@mail.gmail.com>

Sorry, didn't see your reply =)
txAMQP takes all parameters that defined in spec.

On Mon, Oct 11, 2010 at 9:00 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi Brennan,
>
> I don't think exclusive queues are quite what you expect them to be.
> An exclusive queue can only be accessed by the channel that created it.
> A durable queue is one that survives a broker restart.  Since the
> connection and channel will be closed on a broker restart, a durable
> exclusive queue would become completely unaccessible.
>
> What you probably want is exclusive consumers.  If a consumer sets the
> exclusive bit in the basic.consume method, only that consumer is
> allowed to consume from the queue.  Using this, you can ensure that only
> one consumer consumes from any queue at any time.
>
> I'm not familiar with txAMQP, but have a look at basic.consume.  There
> should (fingers crossed) be an 'exclusive' parameter.
>
> Cheers,
> Alex
>
> On Mon, Oct 11, 2010 at 01:35:31PM -0400, Brennan Sellner wrote:
> > Hi all,
> >
> > Does anyone have a preferred mechanism for creating what amounts to a
> > durable, exclusive queue?  We need durable queues, and want to ensure
> > that only one client subscribes to each queue at a time.  I'm not seeing
> > an AMQP way to do this, since exclusive and durable are mutually
> > exclusive: am I missing something?
> >
> > Alternatively, I could hack around this if there were a way to retrieve
> > the number of clients subscribed to a given queue, but again I haven't
> > been able to find any way to get that information.
> >
> > We're using Rabbit 2.1.0, with txAMQP 0.3.
> >
> > Thanks,
> >
> > -Brennan
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/c7d6eec6/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Oct 11 22:23:41 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 11 Oct 2010 22:23:41 +0100
Subject: [rabbitmq-discuss] Failed upgrade from 1.8.1 to 2.1.0
In-Reply-To: <D36A9E17-B4AE-4132-98E7-8A8FBFF5F936@ketralnis.com>
References: <13F25047-7FB8-42BC-AB84-82E6C4F54C91@ketralnis.com>
	<20101008121207.GP28336@rabbitmq.com>
	<D36A9E17-B4AE-4132-98E7-8A8FBFF5F936@ketralnis.com>
Message-ID: <20101011212340.GA25597@wellquite.org>

Hi David,

On Fri, Oct 08, 2010 at 11:53:28AM -0700, David King wrote:
> And as you can see in the memory graph I included at the end there,
> the bump at the end was this attempted upgrade, and the machine
> definitely didn't run out of RAM. But that "924 file handles" does
> look quite low, how can I increase that?

ulimit -n and /etc/security/limits.conf

However, for the number of queues you have, 924 is more than plenty.

The rest of your details leave me puzzled. Is there any possibility of
you being able to attempt the migration again, but without any consumers
at all? - literally just duplicate all your incoming streams into a new
Rabbit? - I'm curious if the queues will continue to fill correctly for
some time before exhausting RAM. Also, during this time, the output of
"rabbitmqctl list_queues name backing_queue_status" would be useful.

I remember when I was in your office we talking briefly about the
monitoring you were doing, but I've since forgotten - how are the stats
for those graphs being obtained? - is something just shelling out to
rabbitmqctl or is something else going on or...?

Your graphs that you posted didn't include the unacknowledged_messages
field which is available from rabbitmqctl list_queues, or from
rabbitmqctl list_channels. Do you have that data for that period of
time?

Best wishes,

Matthew

From bsellner at seegrid.com  Mon Oct 11 22:55:37 2010
From: bsellner at seegrid.com (Brennan Sellner)
Date: Mon, 11 Oct 2010 17:55:37 -0400
Subject: [rabbitmq-discuss] Durable exclusive queues
In-Reply-To: <20101011180054.GB2568@dakota.eng.vmware.com>
References: <1286818531.15860.4346.camel@bsellner>
	<20101011180054.GB2568@dakota.eng.vmware.com>
Message-ID: <1286834137.2402.2294.camel@localhost,>

On Mon, 2010-10-11 at 19:00 +0100, Alexandru Scvor?ov wrote:
> I don't think exclusive queues are quite what you expect them to be.
> An exclusive queue can only be accessed by the channel that created it.
> A durable queue is one that survives a broker restart.  Since the
> connection and channel will be closed on a broker restart, a durable
> exclusive queue would become completely unaccessible.

Right: I understood the semantics of exclusive queues, but didn't have a
better word to describe what I was looking for. :-)

> What you probably want is exclusive consumers.  If a consumer sets the
> exclusive bit in the basic.consume method, only that consumer is
> allowed to consume from the queue.  Using this, you can ensure that only
> one consumer consumes from any queue at any time.
> 
> I'm not familiar with txAMQP, but have a look at basic.consume.  There
> should (fingers crossed) be an 'exclusive' parameter.

And that did the trick!  I was so focused on the queues, I missed that
part of the consumer spec.  For others' reference, the appropriate
txAMQP invocation is:

  chan.basic_consume ( queue = queueName, exclusive = True)

where chan is the parameter provided to the AMQClient.channelAdded
callback, after opening it.

Thanks, Alex & CyBergRind!

-Brennan



From thomasbam at gmail.com  Tue Oct 12 10:19:22 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Tue, 12 Oct 2010 11:19:22 +0200
Subject: [rabbitmq-discuss] Guaranteed delivery
In-Reply-To: <AANLkTimVRT-rmJZU0Nrs4e+ABOdcoEBAV-C_u79SJToQ@mail.gmail.com>
References: <AANLkTimVRT-rmJZU0Nrs4e+ABOdcoEBAV-C_u79SJToQ@mail.gmail.com>
Message-ID: <AANLkTi=9X8C1BgoQnjumHjnQRKGUyrEBj8q6TNsS7wJs@mail.gmail.com>

2010/10/11 Bruno Thomas <thomasbam at gmail.com>:
> We use the Channel.basicPublish(...) method and we would like to
> guaranty delivery for each message we send to the broker.
>
> How would you do that ?

To be more specific, is there a mecanism in the java client publish
API (before the message is sent to the bus)  that insures that the
message will be delivered (or a callback called when the bus send an
IOException), or do we have to implement this process ?

Thank you for your answers.

Bruno Thomas

From simon at rabbitmq.com  Tue Oct 12 10:25:14 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Oct 2010 10:25:14 +0100
Subject: [rabbitmq-discuss] Guaranteed delivery
In-Reply-To: <AANLkTi=9X8C1BgoQnjumHjnQRKGUyrEBj8q6TNsS7wJs@mail.gmail.com>
References: <AANLkTimVRT-rmJZU0Nrs4e+ABOdcoEBAV-C_u79SJToQ@mail.gmail.com>
	<AANLkTi=9X8C1BgoQnjumHjnQRKGUyrEBj8q6TNsS7wJs@mail.gmail.com>
Message-ID: <4CB4297A.60805@rabbitmq.com>

On 12/10/10 10:19, Bruno Thomas wrote:
> To be more specific, is there a mecanism in the java client publish
> API (before the message is sent to the bus)  that insures that the
> message will be delivered (or a callback called when the bus send an
> IOException), or do we have to implement this process ?

At the moment the only way you can guarantee that a publish has gone 
through is to publish inside a transaction - when the transaction commit 
completes the message is on disk (assuming durable queue / persistent 
message). This is a little heavyweight though. In the future we intend 
to introduce streaming publisher acks to do the same job in a more async 
way.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From azzuwan at gmail.com  Tue Oct 12 10:43:29 2010
From: azzuwan at gmail.com (azzuwan)
Date: Tue, 12 Oct 2010 02:43:29 -0700 (PDT)
Subject: [rabbitmq-discuss]  Consumer Not Getting Message
Message-ID: <29941664.post@talk.nabble.com>


I'm using Rabbit MQ 1.8.0 and connecting using the java client from an EJB in
JBOSS 5.1.

I'm having a problem while trying to get message from the queue using the
following codes

QueueingConsumer consumer = new QueueingConsumer(replyChannel);
            replyChannel.basicConsume(replyQueueName, consumer);
            boolean run = true;

            logger.info("BEFORE LOOP");
            while (run) {
                QueueingConsumer.Delivery delivery = null;
                logger.info("GETTING MESSAGE");
                try {                    

                    delivery = consumer.nextDelivery();
                    logger.info("MESSAGE RECIEVED STATE ");
                   
replyChannel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);

                    

                } catch (InterruptedException ie) {
                    logger.info(ie.getMessage());
                    continue;
                }                
                
                ....
            }


I managed to get the first message successfully but the second and
subsequent messages never gets delivered.
>From the output, it seems that the attempt to get the message stuck at 
delivery = consumer.nextDelivery() .
MESSAGE RECIEVED STATE gets print out for the first time only.
>From then on, all the messages gets piled up in the queue.
Any idea why?


-- 
View this message in context: http://old.nabble.com/Consumer-Not-Getting-Message-tp29941664p29941664.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rob at rabbitmq.com  Tue Oct 12 14:39:27 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 12 Oct 2010 14:39:27 +0100
Subject: [rabbitmq-discuss] Java Client Changes
Message-ID: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>

All,

We're almost locked down on our proposed changes to the threading in the Java Client. Before we merge these changes into default I'd love to get some more testing from the community to make sure the new behaviour does what we need it to do and doesn't cause problems that we haven't found in testing.

Summary of changes:

* Dispatch to consumers now happens on a separate thread from the Connection thread
* Each Channel has its own dispatch thread
* Consumers can now call back into Channel without worrying about deadlocking
* Consumers on one Channel don't stall Consumers on another Channel
* Channels are safe for use from multiple threads (not suitable for heavy concurrent usage though)
* QueueingConsumer is now deprecated in favour of implementing Consumer directly or extending DefaultConsumer

You can get and build the client with:

hg clone http://hg.rabbitmq.com/rabbitmq-java-client/
cd rabbitmq-java-client
hg up bug18384
ant dist

You'll find rabbitmq-client.jar in bulid/dist.

Please try the new client out and let me know if you have any suggestions/problems.

Regards,

Rob

From stephanion2002 at gmail.com  Tue Oct 12 14:44:43 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Tue, 12 Oct 2010 19:14:43 +0530
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
Message-ID: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>

Hi,

Is there any way to indicate that it is now safe tio delete the message from
RabbitMQ's queue ? any property ? or any flag or something like that ?

My use-case is that the message should be deleted from the queue only after
some processing is completed at the consumer's side.

Regards,
Kshitiz Garg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/8f8524ec/attachment.htm>

From matthew at rabbitmq.com  Tue Oct 12 14:47:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 12 Oct 2010 14:47:28 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
Message-ID: <20101012134728.GD6665@rabbitmq.com>

On Tue, Oct 12, 2010 at 07:14:43PM +0530, Kshitiz Garg wrote:
> My use-case is that the message should be deleted from the queue only after
> some processing is completed at the consumer's side.

Yes. Acknowledge the message after processing it. Thus consume or get
the message with noAck = false.

Matthew

From mabrek at gmail.com  Tue Oct 12 15:03:33 2010
From: mabrek at gmail.com (mabrek)
Date: Tue, 12 Oct 2010 18:03:33 +0400
Subject: [rabbitmq-discuss] Java client 2.1.0 deadlock
Message-ID: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>

Hello.
I've got reproducible deadlock while working with java client 2.1.0.

Steps to follow:
1) create connection
2) create several threads that use single connection from step 1. Each
thread does:
2.1) create channel
2.2) consumes from non-existing queue
3) run all threads in parallel.
It will hang up.

One thread holds lock on ChannelManager:
"pool-1-thread-3" prio=10 tid=0x00007f74640e2000 nid=0x4667 in
Object.wait() [0x00007f7463ffe000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on <0x00007f747339bbe8> (a
com.rabbitmq.utility.BlockingValueOrException)
	at java.lang.Object.wait(Object.java:485)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:64)
	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:103)
	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
	at com.rabbitmq.client.impl.ChannelN.open(ChannelN.java:125)
	at com.rabbitmq.client.impl.ChannelManager.createChannelInternal(ChannelManager.java:121)
	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:100)
	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)

AMQP connection waits for this lock to handle Channel.Close(NOT_FOUND)
"AMQP Connection localhost:5672" prio=10 tid=0x00007f7464287800
nid=0x4675 waiting for monitor entry [0x00007f74631f0000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at com.rabbitmq.client.impl.ChannelManager.disconnectChannel(ChannelManager.java:135)
	- waiting to lock <0x00007f7473af80c8> (a
com.rabbitmq.client.impl.ChannelManager)
	at com.rabbitmq.client.impl.AMQConnection.disconnectChannel(AMQConnection.java:130)
	at com.rabbitmq.client.impl.ChannelN.releaseChannelNumber(ChannelN.java:205)
	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:229)
	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:165)
	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:434)
   Locked ownable synchronizers:
	- None

All other threads wait for this lock:
"pool-6-thread-1" prio=10 tid=0x00007f74642d4800 nid=0x4698 waiting
for monitor entry [0x00007f7460ecd000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:96)
	- waiting to lock <0x00007f7473af80c8> (a
com.rabbitmq.client.impl.ChannelManager)
	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)

It looks like something was done around this issue at branch bug22064,
but it haven't merged into default yet and it's quite old. Do you have
any plans to use more fine grained locking in ChannelManager?

Regards,
Anton Lebedevich.

From rob at rabbitmq.com  Tue Oct 12 15:47:18 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 12 Oct 2010 15:47:18 +0100
Subject: [rabbitmq-discuss] Java client 2.1.0 deadlock
In-Reply-To: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>
References: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>
Message-ID: <77D67963-51AF-4EA7-9B8E-E349380E5543@rabbitmq.com>

Anton,

I just pushed a fix for this issue on branch bug23360:

http://hg.rabbitmq.com/rabbitmq-java-client/rev/83a89cdc53aa

Let me know if this works for you.

Regards,

Rob

On 12 Oct 2010, at 15:03, mabrek wrote:

> Hello.
> I've got reproducible deadlock while working with java client 2.1.0.
> 
> Steps to follow:
> 1) create connection
> 2) create several threads that use single connection from step 1. Each
> thread does:
> 2.1) create channel
> 2.2) consumes from non-existing queue
> 3) run all threads in parallel.
> It will hang up.
> 
> One thread holds lock on ChannelManager:
> "pool-1-thread-3" prio=10 tid=0x00007f74640e2000 nid=0x4667 in
> Object.wait() [0x00007f7463ffe000]
>   java.lang.Thread.State: WAITING (on object monitor)
> 	at java.lang.Object.wait(Native Method)
> 	- waiting on <0x00007f747339bbe8> (a
> com.rabbitmq.utility.BlockingValueOrException)
> 	at java.lang.Object.wait(Object.java:485)
> 	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:64)
> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
> 	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:103)
> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
> 	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
> 	at com.rabbitmq.client.impl.ChannelN.open(ChannelN.java:125)
> 	at com.rabbitmq.client.impl.ChannelManager.createChannelInternal(ChannelManager.java:121)
> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:100)
> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
> 
> AMQP connection waits for this lock to handle Channel.Close(NOT_FOUND)
> "AMQP Connection localhost:5672" prio=10 tid=0x00007f7464287800
> nid=0x4675 waiting for monitor entry [0x00007f74631f0000]
>   java.lang.Thread.State: BLOCKED (on object monitor)
> 	at com.rabbitmq.client.impl.ChannelManager.disconnectChannel(ChannelManager.java:135)
> 	- waiting to lock <0x00007f7473af80c8> (a
> com.rabbitmq.client.impl.ChannelManager)
> 	at com.rabbitmq.client.impl.AMQConnection.disconnectChannel(AMQConnection.java:130)
> 	at com.rabbitmq.client.impl.ChannelN.releaseChannelNumber(ChannelN.java:205)
> 	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:229)
> 	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:165)
> 	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:434)
>   Locked ownable synchronizers:
> 	- None
> 
> All other threads wait for this lock:
> "pool-6-thread-1" prio=10 tid=0x00007f74642d4800 nid=0x4698 waiting
> for monitor entry [0x00007f7460ecd000]
>   java.lang.Thread.State: BLOCKED (on object monitor)
> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:96)
> 	- waiting to lock <0x00007f7473af80c8> (a
> com.rabbitmq.client.impl.ChannelManager)
> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
> 
> It looks like something was done around this issue at branch bug22064,
> but it haven't merged into default yet and it's quite old. Do you have
> any plans to use more fine grained locking in ChannelManager?
> 
> Regards,
> Anton Lebedevich.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From shane at digitalsanctum.com  Tue Oct 12 18:39:05 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 12 Oct 2010 10:39:05 -0700 (PDT)
Subject: [rabbitmq-discuss] how to remotely start/stop broker nodes
In-Reply-To: <09dde643-54cf-475a-a6cd-be51d9e0a355@f25g2000yqc.googlegroups.com>
References: <09dde643-54cf-475a-a6cd-be51d9e0a355@f25g2000yqc.googlegroups.com>
Message-ID: <e217e51d-837b-4e3c-9d9c-120eff4cf150@d17g2000yqm.googlegroups.com>

anyone?

On Oct 8, 12:44?pm, Shane <sh... at digitalsanctum.com> wrote:
> What's the recommended way of remotely controlling brokers. More
> specifically, starting and stopping nodes. I looked at the management
> plugin but didn't see anything available there. Ideally, I'd like to
> be able to explicitly start/stop brokers via HTTP to test failover
> scenarios.
>
> Thanks,
> Shane
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Tue Oct 12 18:44:39 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 13 Oct 2010 01:44:39 +0800
Subject: [rabbitmq-discuss] how to remotely start/stop broker nodes
In-Reply-To: <e217e51d-837b-4e3c-9d9c-120eff4cf150@d17g2000yqm.googlegroups.com>
References: <09dde643-54cf-475a-a6cd-be51d9e0a355@f25g2000yqc.googlegroups.com>
	<e217e51d-837b-4e3c-9d9c-120eff4cf150@d17g2000yqm.googlegroups.com>
Message-ID: <3E99BE7C-8DD4-48BD-8329-B15CB20986AD@gmail.com>

You can start/stop remote nodes using the rabbitmqctl script. Take a look at the -n option

Regards,

Alvaro


On Oct 13, 2010, at 1:39 AM, Shane wrote:

> anyone?
> 
> On Oct 8, 12:44 pm, Shane <sh... at digitalsanctum.com> wrote:
>> What's the recommended way of remotely controlling brokers. More
>> specifically, starting and stopping nodes. I looked at the management
>> plugin but didn't see anything available there. Ideally, I'd like to
>> be able to explicitly start/stop brokers via HTTP to test failover
>> scenarios.
>> 
>> Thanks,
>> Shane
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From stephanion2002 at gmail.com  Tue Oct 12 19:17:45 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Tue, 12 Oct 2010 23:47:45 +0530
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <20101012134728.GD6665@rabbitmq.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
Message-ID: <AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>

Hi Mathhew/Simon,

Thanks for your responses. I want to know that is the publisher is at all
involved in the process when I consume with no_ack=false and then basic.ack
messages after the processing ? I want to make sure that the publisher
remains be free of any such impact.

Regards,
Kshitiz

On Tue, Oct 12, 2010 at 7:17 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Oct 12, 2010 at 07:14:43PM +0530, Kshitiz Garg wrote:
> > My use-case is that the message should be deleted from the queue only
> after
> > some processing is completed at the consumer's side.
>
> Yes. Acknowledge the message after processing it. Thus consume or get
> the message with noAck = false.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/1e3ddb91/attachment.htm>

From stephanion2002 at gmail.com  Tue Oct 12 19:17:45 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Tue, 12 Oct 2010 23:47:45 +0530
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <20101012134728.GD6665@rabbitmq.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
Message-ID: <AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>

Hi Mathhew/Simon,

Thanks for your responses. I want to know that is the publisher is at all
involved in the process when I consume with no_ack=false and then basic.ack
messages after the processing ? I want to make sure that the publisher
remains be free of any such impact.

Regards,
Kshitiz

On Tue, Oct 12, 2010 at 7:17 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Oct 12, 2010 at 07:14:43PM +0530, Kshitiz Garg wrote:
> > My use-case is that the message should be deleted from the queue only
> after
> > some processing is completed at the consumer's side.
>
> Yes. Acknowledge the message after processing it. Thus consume or get
> the message with noAck = false.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/1e3ddb91/attachment-0001.htm>

From stephanion2002 at gmail.com  Tue Oct 12 19:17:45 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Tue, 12 Oct 2010 23:47:45 +0530
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <20101012134728.GD6665@rabbitmq.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
Message-ID: <AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>

Hi Mathhew/Simon,

Thanks for your responses. I want to know that is the publisher is at all
involved in the process when I consume with no_ack=false and then basic.ack
messages after the processing ? I want to make sure that the publisher
remains be free of any such impact.

Regards,
Kshitiz

On Tue, Oct 12, 2010 at 7:17 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Oct 12, 2010 at 07:14:43PM +0530, Kshitiz Garg wrote:
> > My use-case is that the message should be deleted from the queue only
> after
> > some processing is completed at the consumer's side.
>
> Yes. Acknowledge the message after processing it. Thus consume or get
> the message with noAck = false.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/1e3ddb91/attachment-0002.htm>

From simon at rabbitmq.com  Tue Oct 12 19:26:40 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Oct 2010 19:26:40 +0100
Subject: [rabbitmq-discuss] how to remotely start/stop broker nodes
In-Reply-To: <3E99BE7C-8DD4-48BD-8329-B15CB20986AD@gmail.com>
References: <09dde643-54cf-475a-a6cd-be51d9e0a355@f25g2000yqc.googlegroups.com>	<e217e51d-837b-4e3c-9d9c-120eff4cf150@d17g2000yqm.googlegroups.com>
	<3E99BE7C-8DD4-48BD-8329-B15CB20986AD@gmail.com>
Message-ID: <4CB4A860.9030803@rabbitmq.com>

Also, at some point this will probably make its way into the management 
plugin, but it's not terribly high on the list ATM.

Cheers, Simon

On 12/10/2010 6:44PM, Alvaro Videla wrote:
> You can start/stop remote nodes using the rabbitmqctl script. Take a look at the -n option
>
> Regards,
>
> Alvaro
>
>
> On Oct 13, 2010, at 1:39 AM, Shane wrote:
>
>> anyone?
>>
>> On Oct 8, 12:44 pm, Shane<sh... at digitalsanctum.com>  wrote:
>>> What's the recommended way of remotely controlling brokers. More
>>> specifically, starting and stopping nodes. I looked at the management
>>> plugin but didn't see anything available there. Ideally, I'd like to
>>> be able to explicitly start/stop brokers via HTTP to test failover
>>> scenarios.
>>>
>>> Thanks,
>>> Shane
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Oct 12 19:27:59 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Oct 2010 19:27:59 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>	<20101012134728.GD6665@rabbitmq.com>
	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
Message-ID: <4CB4A8AF.6030808@rabbitmq.com>

On 12/10/2010 7:17PM, Kshitiz Garg wrote:
> Thanks for your responses. I want to know that is the publisher is at
> all involved in the process when I consume with no_ack=false and then
> basic.ack messages after the processing ? I want to make sure that the
> publisher remains be free of any such impact.

No, the publisher is not involved. If the consumer dies without acking a 
message then the message just goes back on the queue.

Cheers, Simon


From uwe at dauernheim.net  Tue Oct 12 20:05:33 2010
From: uwe at dauernheim.net (Uwe Dauernheim)
Date: Tue, 12 Oct 2010 21:05:33 +0200
Subject: [rabbitmq-discuss] Priority Queue implementation and performance
Message-ID: <C0B7D6F5-E399-438D-83A0-07ECD2B865C2@dauernheim.net>

Hej,

I stumbled upon the priority queue implementation (priority_queue.erl) and was wondering if implementing it as a heap wouldn't increase performance, maybe not for the in but for the out? Or are there other reasons to keep it like that?

/Uwe

From matthew at rabbitmq.com  Tue Oct 12 20:18:10 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 12 Oct 2010 20:18:10 +0100
Subject: [rabbitmq-discuss] Priority Queue implementation and performance
In-Reply-To: <C0B7D6F5-E399-438D-83A0-07ECD2B865C2@dauernheim.net>
References: <C0B7D6F5-E399-438D-83A0-07ECD2B865C2@dauernheim.net>
Message-ID: <20101012191809.GC768@wellquite.org>

On Tue, Oct 12, 2010 at 09:05:33PM +0200, Uwe Dauernheim wrote:
> I stumbled upon the priority queue implementation (priority_queue.erl)
> and was wondering if implementing it as a heap wouldn't increase
> performance, maybe not for the in but for the out? Or are there other
> reasons to keep it like that?

It's deliberately optimised for a very small number of priorities. I
doubt we have any use case with > 5 priorities. It's only used in
gen_server2 where we allow prioritisation of messages.

Note the priority_queue.erl has nothing to do with AMQP priorities which
we don't implement.

Matthew

From lgreg.meredith at gmail.com  Tue Oct 12 23:03:22 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 15:03:22 -0700
Subject: [rabbitmq-discuss] texlive dependency in rabbitmq-server portfile
Message-ID: <AANLkTinQUeqwvu5Od35+wkLuS9qW5o0zdv5rDT2moLOw@mail.gmail.com>

Dear Rabbitters,

The rabbitmq-server port recently (as in the last few months) picked up a
dependency on texlive. That would be fine -- except that the texlive macport
install trounces the TeTex macport install. i use the TeTex macport install.
The build environment for the book i'm writing for Artima doesn't work well
with texlive. Is possible to make a rabbitmq-server portfile that doesn't
pull in texlive?

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/85ff25ef/attachment-0001.htm>

From stephanion2002 at gmail.com  Tue Oct 12 23:29:25 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Wed, 13 Oct 2010 03:59:25 +0530
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
Message-ID: <AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>

By the way, *noAck=false* seems to propose that I want an acknowledgment and
not defer it...as *noAck=false* seems equivalent to *Ack=True* ?? please
confirm ...

On Tue, Oct 12, 2010 at 11:47 PM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:

> Hi Mathhew/Simon,
>
> Thanks for your responses. I want to know that is the publisher is at all
> involved in the process when I consume with no_ack=false and then basic.ack
> messages after the processing ? I want to make sure that the publisher
> remains be free of any such impact.
>
> Regards,
> Kshitiz
>
>
> On Tue, Oct 12, 2010 at 7:17 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> On Tue, Oct 12, 2010 at 07:14:43PM +0530, Kshitiz Garg wrote:
>> > My use-case is that the message should be deleted from the queue only
>> after
>> > some processing is completed at the consumer's side.
>>
>> Yes. Acknowledge the message after processing it. Thus consume or get
>> the message with noAck = false.
>>
>> Matthew
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101013/118144e4/attachment.htm>

From lgreg.meredith at gmail.com  Wed Oct 13 00:01:54 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 16:01:54 -0700
Subject: [rabbitmq-discuss] rabbit crash
Message-ID: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>

Dear Rabbitters,

i freshly installed rabbitmq-server and attempted to start the server on Mac
OS X Snowleopard. It crashes immediately. i would appreciate any clues.

Best wishes,

--greg

bash-3.2$ sudo rabbitmq-server
Password:
Activating RabbitMQ plugins ...
0 plugins activated:

{error_logger,{{2010,10,12},{15,59,41}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,10,12},{15,59,41}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.69>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,486}],[]]}
{error_logger,{{2010,10,12},{15,59,41}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at BiosimLT2
',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,10,12},{15,59,41}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,10,12},{15,59,41}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
bash-3.2$

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/11ac9ab5/attachment.htm>

From simon at rabbitmq.com  Wed Oct 13 00:16:24 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Oct 2010 00:16:24 +0100
Subject: [rabbitmq-discuss] rabbit crash
In-Reply-To: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
References: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
Message-ID: <4CB4EC48.3040102@rabbitmq.com>

That looks as though RabbitMQ is already running; I believe it runs in 
the background on MacPorts so you shouldn't need to "sudo 
rabbitmq-server" to start it.

Cheers, Simon

On 13/10/2010 12:01AM, Meredith Gregory wrote:
> Dear Rabbitters,
>
> i freshly installed rabbitmq-server and attempted to start the server on
> Mac OS X Snowleopard. It crashes immediately. i would appreciate any clues.
>
> Best wishes,
>
> --greg
>
> bash-3.2$ sudo rabbitmq-server
> Password:
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> {error_logger,{{2010,10,12},{15,59,41}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2010,10,12},{15,59,41}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.69>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,486}],[]]}
> {error_logger,{{2010,10,12},{15,59,41}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at BiosimLT2',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2010,10,12},{15,59,41}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2010,10,12},{15,59,41}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> bash-3.2$
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Wed Oct 13 00:16:47 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 13 Oct 2010 00:16:47 +0100
Subject: [rabbitmq-discuss] texlive dependency in rabbitmq-server
	portfile
In-Reply-To: <AANLkTinQUeqwvu5Od35+wkLuS9qW5o0zdv5rDT2moLOw@mail.gmail.com>
	(Meredith Gregory's message of "Tue, 12 Oct 2010 15:03:22 -0700")
References: <AANLkTinQUeqwvu5Od35+wkLuS9qW5o0zdv5rDT2moLOw@mail.gmail.com>
Message-ID: <yrv4cfwwb2e8w.fsf@dwragg.eng.vmware.com>

Hi Greg,

Meredith Gregory <lgreg.meredith at gmail.com> writes:
> The rabbitmq-server port recently (as in the last few months) picked up a
> dependency on texlive. That would be fine -- except that the texlive macport
> install trounces the TeTex macport install. i use the TeTex macport install.
> The build environment for the book i'm writing for Artima doesn't work well
> with texlive. Is possible to make a rabbitmq-server portfile that doesn't
> pull in texlive?

It's a transitive dependency via the xmlto port.  There are a few ways
that we or the maintainers of the xmlto port could fix this.  Perhaps
the easiest thing for us to do in the short term would be to simply drop
the man pages from the port, but we would prefer not to do that.  Other
fixes might involve more work, and/or involve using less mature macports
features.

But thanks for letting us know that this isn't simply an issue of
unnecessary dependencies, but does actually cause you a specific
problem.

The easiest workaround for you in the short term might be to use the
generic unix package that we distribute, which is reported to work under
OS X (and does have the man pages :)

David

P.S. Someone will be along shortly to unconditionally recommend
homebrew.

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Wed Oct 13 00:19:29 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 13 Oct 2010 00:19:29 +0100
Subject: [rabbitmq-discuss] rabbit crash
In-Reply-To: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
	(Meredith Gregory's message of "Tue, 12 Oct 2010 16:01:54 -0700")
References: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
Message-ID: <yrv4c8w232e4e.fsf@dwragg.eng.vmware.com>

Hi Greg,

Meredith Gregory <lgreg.meredith at gmail.com> writes:
> i freshly installed rabbitmq-server and attempted to start the server on Mac
> OS X Snowleopard. It crashes immediately. i would appreciate any clues.
>
> bash-3.2$ sudo rabbitmq-server
> Password:
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> {error_logger,{{2010,10,12},{15,59,41}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},
> [...]

Some version of rabbitmq-server is already running on your system.  Find
the process called "beam" and kill it, then try again.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From lgreg.meredith at gmail.com  Wed Oct 13 00:40:08 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 16:40:08 -0700
Subject: [rabbitmq-discuss] rabbit installation failure
Message-ID: <AANLkTin3Rymj3BKFD1eBQj_oAd5OxYSW7Ex1ya5-s6tA@mail.gmail.com>

Dear Rabbitters,

Based on a conversation i had with a RabbitMQ expert on this list a couple
of months ago, i tried deleted /opt/local/var/lib/rabbitmq and then
reinstalling rabbitmq-server. Even though rabbit claimed to have
successfully installed, this made things worse. See the trace below.

Best wishes,

--greg

bash-3.2$ ls
paperconfig rabbitmq-multi rabbitmq-server rabbitmqctl
bash-3.2$ sudo rabbitmq-server
Password:
rabbitmq-server: line 43: cd: /opt/local/var/lib/rabbitmq: No such file or
directory
Activating RabbitMQ plugins ...
ERROR: Could not create dir
/opt/local/var/lib/rabbitmq/mnesia/rabbit at BiosimLT2/plugins-scratch (enoent)
bash-3.2$ pushd /opt/local/var/lib/
/opt/local/var/lib /opt/local/sbin /opt/local/sbin
~/work/src/projex/stellar/seleKt
bash-3.2$ ls
dbus
bash-3.2$ sudo mkdir rabbitmq
bash-3.2$ popd
/opt/local/sbin /opt/local/sbin ~/work/src/projex/stellar/seleKt
bash-3.2$ sudo rabbitmq-server
Activating RabbitMQ plugins ...
ERROR: Could not create dir
/opt/local/var/lib/rabbitmq/mnesia/rabbit at BiosimLT2/plugins-scratch (enoent)
bash-3.2$

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/59613fd3/attachment-0001.htm>

From lgreg.meredith at gmail.com  Wed Oct 13 00:46:50 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 16:46:50 -0700
Subject: [rabbitmq-discuss] rabbit crash
In-Reply-To: <yrv4c8w232e4e.fsf@dwragg.eng.vmware.com>
References: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
	<yrv4c8w232e4e.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTikVEOfBRchOfG_kLZUfZYU538-XmP8AmGtQOk4O@mail.gmail.com>

Dear David, Simon,

Thanks for responding! i did see that a beam process was running. i killed
that; uninstalled rabbitmq-server, again; reinstalled rabbitmq-server;
checked that no beam process was running and attempted to start the server.
This is the failure trace:

/opt/local/var/lib /opt/local/sbin /opt/local/sbin
~/work/src/projex/stellar/seleKt
bash-3.2$ ls
dbus rabbitmq
bash-3.2$ cd rabbitmq/
bash-3.2$ ls
mnesia
bash-3.2$ cd mnesia/
bash-3.2$ sl
bash: sl: command not found
bash-3.2$ ls
rabbit at BiosimLT2
bash-3.2$ cd rabbit at BiosimLT2/
bash-3.2$ ls
plugins-scratch
bash-3.2$

Best wishes,

--greg

On Tue, Oct 12, 2010 at 4:19 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi Greg,
>
> Meredith Gregory <lgreg.meredith at gmail.com> writes:
> > i freshly installed rabbitmq-server and attempted to start the server on
> Mac
> > OS X Snowleopard. It crashes immediately. i would appreciate any clues.
> >
> > bash-3.2$ sudo rabbitmq-server
> > Password:
> > Activating RabbitMQ plugins ...
> > 0 plugins activated:
> >
> > {error_logger,{{2010,10,12},{15,59,41}},"Protocol: ~p: register error:
> > ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},
> > [...]
>
> Some version of rabbitmq-server is already running on your system.  Find
> the process called "beam" and kill it, then try again.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/2f30e011/attachment.htm>

From lgreg.meredith at gmail.com  Wed Oct 13 00:47:22 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 16:47:22 -0700
Subject: [rabbitmq-discuss] rabbit crash
In-Reply-To: <AANLkTikVEOfBRchOfG_kLZUfZYU538-XmP8AmGtQOk4O@mail.gmail.com>
References: <AANLkTikao-zv1GMyQ0o6qAY0K1SmGxAF9Av1SDw2A8W+@mail.gmail.com>
	<yrv4c8w232e4e.fsf@dwragg.eng.vmware.com>
	<AANLkTikVEOfBRchOfG_kLZUfZYU538-XmP8AmGtQOk4O@mail.gmail.com>
Message-ID: <AANLkTimssBo6S5BpbtPpYg=xjzF9rxt6G3aZ8Bw92isq@mail.gmail.com>

P.S. Cut-n-pasto

###########################################################
# A startup item has been generated that will aid in
# starting rabbitmq-server with launchd. It is disabled
# by default. Execute the following command to start it,
# and to cause it to launch at startup:
#
# sudo port load rabbitmq-server
###########################################################
--->  Installing rabbitmq-server @2.1.0_0
--->  Activating rabbitmq-server @2.1.0_0
--->  Cleaning rabbitmq-server
bash-3.2$ ps -axwww | grep beam
bash-3.2$ pwd
/opt/local/sbin
bash-3.2$ sudo rabbitmq-server
Activating RabbitMQ plugins ...
0 plugins activated:

{error_logger,{{2010,10,12},{16,44,4}},"Failed to create cookie file",[]}
{error_logger,{{2010,10,12},{16,44,4}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,604}],[]]}
{error_logger,{{2010,10,12},{16,44,4}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,10,12},{16,44,4}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,10,12},{16,44,4}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
bash-3.2$ ps -axwww | grep beam
bash-3.2$ pushd /opt/local/var/lib/
/opt/local/var/lib /opt/local/sbin /opt/local/sbin
~/work/src/projex/stellar/seleKt
bash-3.2$ ls
dbus rabbitmq
bash-3.2$ cd rabbitmq/
bash-3.2$ ls
mnesia
bash-3.2$ cd mnesia/
bash-3.2$ sl
bash: sl: command not found
bash-3.2$ ls
rabbit at BiosimLT2
bash-3.2$ cd rabbit at BiosimLT2/
bash-3.2$ ls
plugins-scratch
bash-3.2$

On Tue, Oct 12, 2010 at 4:46 PM, Meredith Gregory
<lgreg.meredith at gmail.com>wrote:

> Dear David, Simon,
>
> Thanks for responding! i did see that a beam process was running. i killed
> that; uninstalled rabbitmq-server, again; reinstalled rabbitmq-server;
> checked that no beam process was running and attempted to start the server.
> This is the failure trace:
>
> /opt/local/var/lib /opt/local/sbin /opt/local/sbin
> ~/work/src/projex/stellar/seleKt
> bash-3.2$ ls
> dbus rabbitmq
> bash-3.2$ cd rabbitmq/
> bash-3.2$ ls
> mnesia
> bash-3.2$ cd mnesia/
> bash-3.2$ sl
> bash: sl: command not found
> bash-3.2$ ls
> rabbit at BiosimLT2
> bash-3.2$ cd rabbit at BiosimLT2/
> bash-3.2$ ls
> plugins-scratch
> bash-3.2$
>
> Best wishes,
>
> --greg
>
>
> On Tue, Oct 12, 2010 at 4:19 PM, David Wragg <david at rabbitmq.com> wrote:
>
>> Hi Greg,
>>
>> Meredith Gregory <lgreg.meredith at gmail.com> writes:
>> > i freshly installed rabbitmq-server and attempted to start the server on
>> Mac
>> > OS X Snowleopard. It crashes immediately. i would appreciate any clues.
>> >
>> > bash-3.2$ sudo rabbitmq-server
>> > Password:
>> > Activating RabbitMQ plugins ...
>> > 0 plugins activated:
>> >
>> > {error_logger,{{2010,10,12},{15,59,41}},"Protocol: ~p: register error:
>> > ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},
>> > [...]
>>
>> Some version of rabbitmq-server is already running on your system.  Find
>> the process called "beam" and kill it, then try again.
>>
>> David
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>>
>
>
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
>


-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/7c246a6d/attachment.htm>

From lgreg.meredith at gmail.com  Wed Oct 13 01:29:29 2010
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 12 Oct 2010 17:29:29 -0700
Subject: [rabbitmq-discuss] one more time...
Message-ID: <AANLkTi=qjZ_uAM_45zBA3LFUjeS+5bOzfkh-baWAfGKf@mail.gmail.com>

Dear Rabbitters,

So, i uninstalled rabbitmq and reinstalled again. Still to no avail. Any
help would be most appreciated.

bash-3.2$ sudo port install rabbitmq-server
Password:
--->  Computing dependencies for rabbitmq-server
--->  Fetching rabbitmq-server
--->  Verifying checksum(s) for rabbitmq-server
--->  Extracting rabbitmq-server
--->  Configuring rabbitmq-server
--->  Building rabbitmq-server
--->  Staging rabbitmq-server into destroot
--->  Creating launchd control script
###########################################################
# A startup item has been generated that will aid in
# starting rabbitmq-server with launchd. It is disabled
# by default. Execute the following command to start it,
# and to cause it to launch at startup:
#
# sudo port load rabbitmq-server
###########################################################
--->  Installing rabbitmq-server @2.1.0_0
--->  Activating rabbitmq-server @2.1.0_0
--->  Cleaning rabbitmq-server
bash-3.2$ ps -axwww | grep beam
bash-3.2$ sudo port load rabbitmq-server
Error: Target org.macports.load returned: org.macports.rabbitmq-server:
Already loaded
Log for rabbitmq-server is at:
/opt/local/var/macports/logs/_opt_local_var_macports_portdirs_rabbitmq-server/main.log
Error: Status 1 encountered during processing.
To report a bug, see <http://guide.macports.org/#project.tickets>
bash-3.2$ pwd
/opt/local/sbin
bash-3.2$ ls
paperconfig rabbitmq-multi rabbitmq-server rabbitmqctl
bash-3.2$ ls -al
total 40
drwxrwxrwx   7 root  admin   238 Oct 12 17:27 .
drwxrwxrwx  12 root  admin   408 Jul  6 18:40 ..
-rw-rw-rw-   1 root  admin     0 Jun 17 17:38 .turd_MacPorts
-rwxr-xr-x   2 root  admin  4190 Oct 12 16:15 paperconfig
-r-xr-xr-x   2 root  admin  2127 Oct 12 17:27 rabbitmq-multi
-r-xr-xr-x   2 root  admin  2127 Oct 12 17:27 rabbitmq-server
-r-xr-xr-x   2 root  admin  2127 Oct 12 17:27 rabbitmqctl
bash-3.2$ sudo rabbitmqctl start
{error_logger,{{2010,10,12},{17,28,5}},"Failed to create cookie file",[]}
{error_logger,{{2010,10,12},{17,28,5}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.18.0>},{registered_name,[]},{error_info,{exit,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.16.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,604}],[]]}
{error_logger,{{2010,10,12},{17,28,5}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,10,12},{17,28,5}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,10,12},{17,28,5}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
bash-3.2$

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/4b8da3de/attachment-0001.htm>

From david at rabbitmq.com  Wed Oct 13 02:31:02 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 13 Oct 2010 02:31:02 +0100
Subject: [rabbitmq-discuss] one more time...
In-Reply-To: <AANLkTi=qjZ_uAM_45zBA3LFUjeS+5bOzfkh-baWAfGKf@mail.gmail.com>
	(Meredith Gregory's message of "Tue, 12 Oct 2010 17:29:29 -0700")
References: <AANLkTi=qjZ_uAM_45zBA3LFUjeS+5bOzfkh-baWAfGKf@mail.gmail.com>
Message-ID: <yrv4c1v7u3mll.fsf@dwragg.eng.vmware.com>

Meredith Gregory <lgreg.meredith at gmail.com> writes:
> So, i uninstalled rabbitmq and reinstalled again. Still to no avail. Any
> help would be most appreciated.
>
> [...]
> bash-3.2$ sudo rabbitmqctl start
> {error_logger,{{2010,10,12},{17,28,5}},"Failed to create cookie
> file",[]}

Based on your previous mail, I suspect you've ended up with the wrong
ownership on /opt/local/var/lib/rabbitmq.  It should be writable by the
rabbitmq user.

So

sudo chown -R rabbitmq:rabbitmq /opt/local/var/lib/rabbitmq
sudo chmod -R u+rwx /opt/local/var/lib/rabbitmq

should get "sudo rabbitmq-server" or "sudo port load rabbitmq-server"
to work (I'm not sure where you've got "rabbitmqctl start" from).

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From brodrigu at gmail.com  Wed Oct 13 05:09:07 2010
From: brodrigu at gmail.com (Brad Rodriguez)
Date: Tue, 12 Oct 2010 21:09:07 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <C8D5194A.10A2F%pdezwart@rubiconproject.com>
References: <C8D5194A.10A2F%pdezwart@rubiconproject.com>
Message-ID: <D97DC0FD-B201-4FDD-A291-37E15EBEF0AD@gmail.com>

I generally like the API of the Java client, although we would obviously not want the php client to be quite as verbose.

I'm on board with disabling auto-connect in favor of explicitly controlling when we connect and disconnect. Specifically, having disconnect and reconnect methods will be especially useful.

I like the following API:

$connection = new AMQPConnection($params);
$connection->connect();

$exchangeList = $connection->listExchanges();
$exchange = $connection->exchangeDeclare('my_exchange', AMQP_EX_TYPE_TOPIC, $flags);

$queueList = $exchange->listQueues();
$queue = $connection->queueDeclare('my_queue', $flags);


$queue->bind($exchange, $routingKey);
$queue->unbind($exchange, $routingKey);

$exchange->publish($message, $routingKey);

$connection->disconnect();

-Brad


On Oct 8, 2010, at 6:54 PM, Pieter de Zwart wrote:

> Happy too. Though I?m gonna point at you if we start annoying people =)
> 
> I looked through the Java client, which would seem to be the most mature and well built client to date. The major difference between the PHP extension (hereby PHPE) and the Java client (hereby JC... get it?) is that the JC allows the creation of multiple channels, and the ability to act within a channel. PHPE instead uses one channel for everything (channel 1.)
> As far as objects go, since I want PHPE to be OO, the current layout seems to make sense to me, with AMQPConnection, AMQPExchange and AMQPQueue. From there, the methods I think need to be cleaned up:
> AMQPConnection should continue to allow the $params = array() setup, whereby a user can create and set username, password, host, port and vhost, like so:
> 
> $cnn = new AMQPConnection(array(?login? => ?guest?, ?password? => ??, ?host? => ?localhost?)); 
> 
> However, I want to remove the auto-connect portion of the constructor, so users have to call:
> 
> $cnn->connect();
> 
> That way, we can also add the following method: setLogin, setPassword, setPort, setHost, setVHost. I also want to add the following action methods: reconnect, disconnect.
> 
> The connection object should in turn give access to exchanges and queues, but how I am not yet sure, and I would love feedback from everyone on this. I like JC?s approach of using AMQPConnection->queueDeclare and AMQPConnectio->exchangeDeclare which would return instances of AMQPQueue and AMQPExchange respectively. I guess those methods would also accept an additional bit mask for options, and if the queue/exchange already exists, the new bit mask values would be applied...
> 
> I am tired, so I will stop here and look for others to poke holes in my theory. Feedback from JC users in particular would be much appreciated in terms of likes and dislikes of their client.
> 
> Pieter 
> 
> 
> 
> On 10/8/10 12:41 AM, "Pedram Nimreezi" <mc at majorcomputing.com> wrote:
> 
>> Keep it on the air ways...  if you would...
>> 
>> 
>> 
>> On Fri, Oct 8, 2010 at 3:11 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Well,
>>> 
>>> I said where is the place to contribute, not that I had something to contribute right now?
>>> 
>>> But we might start using this extension in prod and I remember last time I checked the API there was some stuff I'd like it to be "different"
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> 
>>> On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:
>>> 
>>> > Oh thank you deity of your choice for answering me. I need help.
>>> > Lets take this off list so we don't pollute the airways.
>>> > Pieter
>>> >
>>> >
>>> > On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>> >
>>> >> Hi Pieter,
>>> >>
>>> >> My question is more where is the source code that we can contribute back. I
>>> >> know about the PECL stuff :)
>>> >>
>>> >> Regards,
>>> >>
>>> >> Alvaro
>>> >>
>>> >>
>>> >> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
>>> >>
>>> >>> Excellent question. The source code for this:
>>> >>> http://php.net/manual/en/book.amqp.php
>>> >>> is available here:
>>> >>> http://pecl.php.net/package/amqp
>>> >>>
>>> >>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
>>> >>> listed works with 1.7.*.
>>> >>>
>>> >>> Pieter
>>> >>>
>>> >>>
>>> >>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>> >>>
>>> >>>> I think is php-rabbit
>>> >>>>
>>> >>>> Thanks!
>>> >>>>
>>> >>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>> >>>>
>>> >>>>> Could it be one of these?
>>> >>>>>
>>> >>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>> >>>>>
>>> >>>>>
>>> >>>>>
>>> >>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com>
>>> >>>>> wrote:
>>> >>>>>> Hi,
>>> >>>>>>
>>> >>>>>> I would like to know where's the code for the PHP extension that appears
>>> >>>>>> on
>>> >>>>>> the PHP website.
>>> >>>>>>
>>> >>>>>> Regards,
>>> >>>>>>
>>> >>>>>> Alvaro
>>> >>>>>> _______________________________________________
>>> >>>>>> rabbitmq-discuss mailing list
>>> >>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>> >>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >>>>>>
>>> >>>>
>>> >>>> _______________________________________________
>>> >>>> rabbitmq-discuss mailing list
>>> >>>> rabbitmq-discuss at lists.rabbitmq.com
>>> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >>>
>>> >>
>>> >
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101012/1f7d22a1/attachment.htm>

From videlalvaro at gmail.com  Wed Oct 13 05:36:20 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 13 Oct 2010 12:36:20 +0800
Subject: [rabbitmq-discuss] Problems with the management plugin
Message-ID: <E50D7DAC-2F91-45D6-A63E-021576F52F93@gmail.com>

Hi Simon,

We are seeing this error every second request to the management page.

We are using the latest RabbitMQ and the latest plugin version. 

Regards,

Alvaro


The server encountered an error while processing this request:
{error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
                                {rabbit_mgmt_db,gs_update_add,3},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {rabbit_mgmt_db,'-gs_update/2-lc$^0/1-0-',2},
                                {dict,update_bkt,4},
                                {dict,on_bucket,3},
                                {dict,update,4},
                                {lists,foldl,3}]},
              {gen_server,call,[rabbit_mgmt_db,get_overview,infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2},
              {webmachine_mochiweb,loop,1}]}}


From monikatewari12 at gmail.com  Wed Oct 13 08:21:54 2010
From: monikatewari12 at gmail.com (MOTEW)
Date: Wed, 13 Oct 2010 00:21:54 -0700 (PDT)
Subject: [rabbitmq-discuss]  message acknowledment
Message-ID: <29950181.post@talk.nabble.com>


hello to all.
 i am working on rabbitmq 
if the consumer get the mesage will he send some acknowledment to
rabbitmq???

>> or what about  rabbitmq acknowledment policies???

>>if the message is lost whether due to node down or else how it is
relievered to the consumer without any error message to the publisher????and
also after successful delievery we want to delete it from broker's queue???

any help is appreciable



-- 
View this message in context: http://old.nabble.com/message-acknowledment-tp29950181p29950181.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Wed Oct 13 08:30:16 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Oct 2010 08:30:16 +0100
Subject: [rabbitmq-discuss] Problems with the management plugin
In-Reply-To: <E50D7DAC-2F91-45D6-A63E-021576F52F93@gmail.com>
References: <E50D7DAC-2F91-45D6-A63E-021576F52F93@gmail.com>
Message-ID: <4CB56008.2030702@rabbitmq.com>

On 13/10/2010 5:36AM, Alvaro Videla wrote:
> The server encountered an error while processing this request:
> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},

Hi Alvaro.

This is a known bug, fixed in Mercurial. The fix will be in the next 
release.

Cheers, Simon

From videlalvaro at gmail.com  Wed Oct 13 08:32:18 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 13 Oct 2010 15:32:18 +0800
Subject: [rabbitmq-discuss] Problems with the management plugin
In-Reply-To: <4CB56008.2030702@rabbitmq.com>
References: <E50D7DAC-2F91-45D6-A63E-021576F52F93@gmail.com>
	<4CB56008.2030702@rabbitmq.com>
Message-ID: <62EA8A0A-6BA8-4AD6-80CA-CA37A3B5FEA5@gmail.com>

Cool!


On Oct 13, 2010, at 3:30 PM, Simon MacMullen wrote:

> On 13/10/2010 5:36AM, Alvaro Videla wrote:
>> The server encountered an error while processing this request:
>> {error,{exit,{{function_clause,[{proplists,get_value,[rate,0,unknown]},
> 
> Hi Alvaro.
> 
> This is a known bug, fixed in Mercurial. The fix will be in the next release.
> 
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Wed Oct 13 11:09:18 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 13 Oct 2010 11:09:18 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>
Message-ID: <20101013100918.GA18263@wellquite.org>

On Wed, Oct 13, 2010 at 03:59:25AM +0530, Kshitiz Garg wrote:
> By the way, *noAck=false* seems to propose that I want an acknowledgment and
> not defer it...as *noAck=false* seems equivalent to *Ack=True* ?? please
> confirm ...

You are correct: noAck=false <=> Ack=true

From irmo.manie at gmail.com  Wed Oct 13 11:13:06 2010
From: irmo.manie at gmail.com (Irmo Manie)
Date: Wed, 13 Oct 2010 12:13:06 +0200
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <20101013100918.GA18263@wellquite.org>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>
	<20101013100918.GA18263@wellquite.org>
Message-ID: <AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>

Shouldn't that parameter be renamed anyway? In my opinion negative parameter
names always cause to many confusions. 'autoAck' or something similar would
be much better I reckon.

/2cents
Irmo

On Wed, Oct 13, 2010 at 12:09 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Wed, Oct 13, 2010 at 03:59:25AM +0530, Kshitiz Garg wrote:
> > By the way, *noAck=false* seems to propose that I want an acknowledgment
> and
> > not defer it...as *noAck=false* seems equivalent to *Ack=True* ?? please
> > confirm ...
>
> You are correct: noAck=false <=> Ack=true
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101013/db9ab13f/attachment.htm>

From simon at rabbitmq.com  Wed Oct 13 11:15:52 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Oct 2010 11:15:52 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <20101013100918.GA18263@wellquite.org>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>	<20101012134728.GD6665@rabbitmq.com>	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>
	<20101013100918.GA18263@wellquite.org>
Message-ID: <4CB586D8.7050106@rabbitmq.com>

On 13/10/10 11:09, Matthew Sackman wrote:
> On Wed, Oct 13, 2010 at 03:59:25AM +0530, Kshitiz Garg wrote:
>> By the way, *noAck=false* seems to propose that I want an acknowledgment and
>> not defer it...as *noAck=false* seems equivalent to *Ack=True* ?? please
>> confirm ...
>
> You are correct: noAck=false<=>  Ack=true

But just to be clear: noAck=false means "I intend to acknowledge 
messages myself after processing", which is not quite what Kshitiz seems 
to be saying with "not defer it".

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Oct 13 11:18:00 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Oct 2010 11:18:00 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>	<20101012134728.GD6665@rabbitmq.com>	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>	<20101013100918.GA18263@wellquite.org>
	<AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
Message-ID: <4CB58758.4020603@rabbitmq.com>

On 13/10/10 11:13, Irmo Manie wrote:
> Shouldn't that parameter be renamed anyway? In my opinion negative
> parameter names always cause to many confusions. 'autoAck' or something
> similar would be much better I reckon.

Maybe. It's part of the spec though. I'd be a bit reluctant to rename it 
in the clients since I think clients should use the same language as the 
spec, so we're all speaking the same language. And I guess maybe they 
named it like that in the spec since noAck=true is actually the 
non-typical way to do things, and they wanted booleans to default to 
false. At a guess.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Wed Oct 13 11:17:51 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 13 Oct 2010 11:17:51 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>
	<20101012134728.GD6665@rabbitmq.com>
	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>
	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>
	<20101013100918.GA18263@wellquite.org>
	<AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
Message-ID: <20101013101751.GB18263@wellquite.org>

On Wed, Oct 13, 2010 at 12:13:06PM +0200, Irmo Manie wrote:
> Shouldn't that parameter be renamed anyway? In my opinion negative parameter
> names always cause to many confusions. 'autoAck' or something similar would
> be much better I reckon.

Yup, and we do renaming as such within the codebase of the broker.
Sadly, we can't unilaterally correct the AMQP spec.

Matthew

From mikeb at rabbitmq.com  Wed Oct 13 11:26:13 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 13 Oct 2010 11:26:13 +0100
Subject: [rabbitmq-discuss] Acknowledging for the deletion of the message
In-Reply-To: <AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
References: <AANLkTinmriedfXSQvCREeuUS3dkV7Y=TkK81wHNBKU=N@mail.gmail.com>	<20101012134728.GD6665@rabbitmq.com>	<AANLkTikMYsyxUzrXPUvfqJN=zaBzuk1UjGC+sq-0cBXO@mail.gmail.com>	<AANLkTimaReXVBHci=GMo+cOfvCaVtphjyJ0_q7_C0J9X@mail.gmail.com>	<20101013100918.GA18263@wellquite.org>
	<AANLkTimfeNoGTRSZ8JKA1vc9u2St72P2QHYmLM7cT2H=@mail.gmail.com>
Message-ID: <4CB58945.7040404@rabbitmq.com>

On 10/13/2010 11:13 AM, Irmo Manie wrote:
> Shouldn't that parameter be renamed anyway? In my opinion negative
> parameter names always cause to many confusions. 'autoAck' or something
> similar would be much better I reckon.

Renamed where?  It's noAck in the AMQP protocol specification; so, it's 
a choice between faithfully reflecting the protocol or risking further 
confusion by reversing the negation. (To be fair, some client libraries 
actually do do this, and the sky doesn't fall)

Probably better would be to avoid the double or triple negative by using 
an argument that isn't boolean, in APIs.  For instance, "ack-mode" which 
can be "auto" or "client".

mkb.

> /2cents
> Irmo
>
> On Wed, Oct 13, 2010 at 12:09 PM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com>> wrote:
>
>     On Wed, Oct 13, 2010 at 03:59:25AM +0530, Kshitiz Garg wrote:
>      > By the way, *noAck=false* seems to propose that I want an
>     acknowledgment and
>      > not defer it...as *noAck=false* seems equivalent to *Ack=True* ??
>     please
>      > confirm ...
>
>     You are correct: noAck=false <=> Ack=true
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Wed Oct 13 13:15:12 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Oct 2010 13:15:12 +0100
Subject: [rabbitmq-discuss] rabbitmq meetup at springone 2gx?
In-Reply-To: <9FC624B6-0E30-4D08-B025-44E7AC2885B0@jbrisbin.com>
References: <9FC624B6-0E30-4D08-B025-44E7AC2885B0@jbrisbin.com>
Message-ID: <4CB5A2D0.50000@rabbitmq.com>

Jon,

On 07/10/10 17:47, Jon Brisbin wrote:
> Any plans to have a little RabbitMQ community confab at SpringOne 2GX
> week after next?

I'd be happy to host a breakout session on rabbit. Let's coordinate on 
this at the conference.

I am presenting rabbit as part of Mark Pollack and Mark Fisher's 
Spring-AMQP talk. One of Peter Ledbrook's Grails talks features rabbit 
too. So does Brian Dussault and Tom McCuch's EMC case study. So there 
will be at least four talks with rabbit content at SpringOne.


Regards,

Matthias.

From clegnitto at mozilla.com  Thu Oct 14 06:41:11 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 13 Oct 2010 22:41:11 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <D97DC0FD-B201-4FDD-A291-37E15EBEF0AD@gmail.com>
References: <C8D5194A.10A2F%pdezwart@rubiconproject.com>
	<D97DC0FD-B201-4FDD-A291-37E15EBEF0AD@gmail.com>
Message-ID: <F5337DD6-2768-4C36-A5A0-222AFD7363E4@mozilla.com>

Ok, I wasn't interested in this before but now I am :-). I plan to write a mediawiki extension that publishes messages into rabbit and this is a rather crucial piece.

Let me know what help I can give.

I would also take a look at carrot (python) as it has an API that is fairly easy to use and can be generalized for other protocols (like stomp). Every time I do something amqp specific it seems like the next question is if it will support stomp. That being said, I like what has been proposed so far.

Thanks,
Christian

On Oct 12, 2010, at 9:09 PM, Brad Rodriguez wrote:

> I generally like the API of the Java client, although we would obviously not want the php client to be quite as verbose.
> 
> I'm on board with disabling auto-connect in favor of explicitly controlling when we connect and disconnect. Specifically, having disconnect and reconnect methods will be especially useful.
> 
> I like the following API:
> 
> $connection = new AMQPConnection($params);
> $connection->connect();
> 
> $exchangeList = $connection->listExchanges();
> $exchange = $connection->exchangeDeclare('my_exchange', AMQP_EX_TYPE_TOPIC, $flags);
> 
> $queueList = $exchange->listQueues();
> $queue = $connection->queueDeclare('my_queue', $flags);
> 
> 
> $queue->bind($exchange, $routingKey);
> $queue->unbind($exchange, $routingKey);
> 
> $exchange->publish($message, $routingKey);
> 
> $connection->disconnect();
> 
> -Brad
> 
> 
> On Oct 8, 2010, at 6:54 PM, Pieter de Zwart wrote:
> 
>> Happy too. Though I?m gonna point at you if we start annoying people =)
>> 
>> I looked through the Java client, which would seem to be the most mature and well built client to date. The major difference between the PHP extension (hereby PHPE) and the Java client (hereby JC... get it?) is that the JC allows the creation of multiple channels, and the ability to act within a channel. PHPE instead uses one channel for everything (channel 1.)
>> As far as objects go, since I want PHPE to be OO, the current layout seems to make sense to me, with AMQPConnection, AMQPExchange and AMQPQueue. From there, the methods I think need to be cleaned up:
>> AMQPConnection should continue to allow the $params = array() setup, whereby a user can create and set username, password, host, port and vhost, like so:
>> 
>> $cnn = new AMQPConnection(array(?login? => ?guest?, ?password? => ??, ?host? => ?localhost?)); 
>> 
>> However, I want to remove the auto-connect portion of the constructor, so users have to call:
>> 
>> $cnn->connect();
>> 
>> That way, we can also add the following method: setLogin, setPassword, setPort, setHost, setVHost. I also want to add the following action methods: reconnect, disconnect.
>> 
>> The connection object should in turn give access to exchanges and queues, but how I am not yet sure, and I would love feedback from everyone on this. I like JC?s approach of using AMQPConnection->queueDeclare and AMQPConnectio->exchangeDeclare which would return instances of AMQPQueue and AMQPExchange respectively. I guess those methods would also accept an additional bit mask for options, and if the queue/exchange already exists, the new bit mask values would be applied...
>> 
>> I am tired, so I will stop here and look for others to poke holes in my theory. Feedback from JC users in particular would be much appreciated in terms of likes and dislikes of their client.
>> 
>> Pieter 
>> 
>> 
>> 
>> On 10/8/10 12:41 AM, "Pedram Nimreezi" <mc at majorcomputing.com> wrote:
>> 
>>> Keep it on the air ways...  if you would...
>>> 
>>> 
>>> 
>>> On Fri, Oct 8, 2010 at 3:11 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>>> Well,
>>>> 
>>>> I said where is the place to contribute, not that I had something to contribute right now?
>>>> 
>>>> But we might start using this extension in prod and I remember last time I checked the API there was some stuff I'd like it to be "different"
>>>> 
>>>> Regards,
>>>> 
>>>> Alvaro
>>>> 
>>>> On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:
>>>> 
>>>> > Oh thank you deity of your choice for answering me. I need help.
>>>> > Lets take this off list so we don't pollute the airways.
>>>> > Pieter
>>>> >
>>>> >
>>>> > On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>>> >
>>>> >> Hi Pieter,
>>>> >>
>>>> >> My question is more where is the source code that we can contribute back. I
>>>> >> know about the PECL stuff :)
>>>> >>
>>>> >> Regards,
>>>> >>
>>>> >> Alvaro
>>>> >>
>>>> >>
>>>> >> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
>>>> >>
>>>> >>> Excellent question. The source code for this:
>>>> >>> http://php.net/manual/en/book.amqp.php
>>>> >>> is available here:
>>>> >>> http://pecl.php.net/package/amqp
>>>> >>>
>>>> >>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*. The one
>>>> >>> listed works with 1.7.*.
>>>> >>>
>>>> >>> Pieter
>>>> >>>
>>>> >>>
>>>> >>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>>>> >>>
>>>> >>>> I think is php-rabbit
>>>> >>>>
>>>> >>>> Thanks!
>>>> >>>>
>>>> >>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>>> >>>>
>>>> >>>>> Could it be one of these?
>>>> >>>>>
>>>> >>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>>> >>>>>
>>>> >>>>>
>>>> >>>>>
>>>> >>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla <videlalvaro at gmail.com>
>>>> >>>>> wrote:
>>>> >>>>>> Hi,
>>>> >>>>>>
>>>> >>>>>> I would like to know where's the code for the PHP extension that appears
>>>> >>>>>> on
>>>> >>>>>> the PHP website.
>>>> >>>>>>
>>>> >>>>>> Regards,
>>>> >>>>>>
>>>> >>>>>> Alvaro
>>>> >>>>>> _______________________________________________
>>>> >>>>>> rabbitmq-discuss mailing list
>>>> >>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> >>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> >>>>>>
>>>> >>>>
>>>> >>>> _______________________________________________
>>>> >>>> rabbitmq-discuss mailing list
>>>> >>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> >>>
>>>> >>
>>>> >
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101013/58aed3c9/attachment.htm>

From sameek at arosys.com  Thu Oct 14 07:35:45 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 13 Oct 2010 23:35:45 -0700 (PDT)
Subject: [rabbitmq-discuss] another approach to retrieve message from queue?
Message-ID: <29959643.post@talk.nabble.com>


Hi

i am using the following code to read an queue and extract the messages from
queue. I want to know that there is another approach to retrieve message
from queue? if there is another approach please describe the details
information to get the messages from queue. 

 while (runInfinite)
 {
     QueueingConsumer.Delivery delivery;
            try
            {
              delivery = consumer.nextDelivery();
            } catch (InterruptedException ie)
            {
               continue;
            }
         System.out.println("Message received-"
+ new String(delivery.getBody()));

file included that contain the  code for reading and extracting message:
--------------------------------------------------------------------------
http://old.nabble.com/file/p29959643/Result.java Result.java 

Thanks

-- 
View this message in context: http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From stephanion2002 at gmail.com  Thu Oct 14 07:55:31 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Thu, 14 Oct 2010 12:25:31 +0530
Subject: [rabbitmq-discuss] another approach to retrieve message from
	queue?
In-Reply-To: <29959643.post@talk.nabble.com>
References: <29959643.post@talk.nabble.com>
Message-ID: <AANLkTikG31Z=HGYtqqKhQy5te4WCG9k5wsfN_qTvsWqZ@mail.gmail.com>

I am using spring amqp. Simple POJOs get message automatically upon arrival
of a new message or rabbitMQ's delivery.

*spring configurations for template :*

<!-- Define a RabbitMQ connectionFactory -->
    <bean id="connectionFactory"

class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
        <constructor-arg value="localhost" />
        <property name="username" value="guest" />
        <property name="password" value="guest" />
    </bean>

*use that template in ur POJO to become a "magical" consumer:*

<bean id="msgHandler" class="com.xyz.MsgHandler" />

    <bean id="msgHandlerAdaptor"
class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
        <constructor-arg ref="msgHandler" />
    </bean>

    <bean id="msgListener"
class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"
        p:connectionFactory-ref="connectionFactory" p:queueName="Queue1"
p:autoAck="false" p:concurrentConsumers="20"
p:messageListener-ref="msgHandlerAdaptor" />

*Bean has*

    public void handleMessage(String msg) {

    }


That's it !!!


On Thu, Oct 14, 2010 at 12:05 PM, sam_mis <sameek at arosys.com> wrote:

>
> Hi
>
> i am using the following code to read an queue and extract the messages
> from
> queue. I want to know that there is another approach to retrieve message
> from queue? if there is another approach please describe the details
> information to get the messages from queue.
>
>  while (runInfinite)
>  {
>     QueueingConsumer.Delivery delivery;
>            try
>            {
>              delivery = consumer.nextDelivery();
>            } catch (InterruptedException ie)
>            {
>               continue;
>            }
>         System.out.println("Message received-"
> + new String(delivery.getBody()));
>
> file included that contain the  code for reading and extracting message:
> --------------------------------------------------------------------------
> http://old.nabble.com/file/p29959643/Result.java Result.java
>
> Thanks
>
> --
> View this message in context:
> http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/ee44f983/attachment-0001.htm>

From mabrek at gmail.com  Thu Oct 14 09:09:16 2010
From: mabrek at gmail.com (mabrek)
Date: Thu, 14 Oct 2010 12:09:16 +0400
Subject: [rabbitmq-discuss] Java client 2.1.0 deadlock
In-Reply-To: <77D67963-51AF-4EA7-9B8E-E349380E5543@rabbitmq.com>
References: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>
	<77D67963-51AF-4EA7-9B8E-E349380E5543@rabbitmq.com>
Message-ID: <4CB6BAAC.3060002@gmail.com>

Works for me, great thanks!
Are there any plans to merge it to default branch?

Regards,
Anton Lebedevich

On 10/12/2010 06:47 PM, Rob Harrop wrote:
> Anton,
> 
> I just pushed a fix for this issue on branch bug23360:
> 
> http://hg.rabbitmq.com/rabbitmq-java-client/rev/83a89cdc53aa
> 
> Let me know if this works for you.
> 
> Regards,
> 
> Rob
> 
> On 12 Oct 2010, at 15:03, mabrek wrote:
> 
>> Hello.
>> I've got reproducible deadlock while working with java client 2.1.0.
>>
>> Steps to follow:
>> 1) create connection
>> 2) create several threads that use single connection from step 1. Each
>> thread does:
>> 2.1) create channel
>> 2.2) consumes from non-existing queue
>> 3) run all threads in parallel.
>> It will hang up.
>>
>> One thread holds lock on ChannelManager:
>> "pool-1-thread-3" prio=10 tid=0x00007f74640e2000 nid=0x4667 in
>> Object.wait() [0x00007f7463ffe000]
>>   java.lang.Thread.State: WAITING (on object monitor)
>> 	at java.lang.Object.wait(Native Method)
>> 	- waiting on <0x00007f747339bbe8> (a
>> com.rabbitmq.utility.BlockingValueOrException)
>> 	at java.lang.Object.wait(Object.java:485)
>> 	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:64)
>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>> 	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:103)
>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
>> 	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
>> 	at com.rabbitmq.client.impl.ChannelN.open(ChannelN.java:125)
>> 	at com.rabbitmq.client.impl.ChannelManager.createChannelInternal(ChannelManager.java:121)
>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:100)
>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>
>> AMQP connection waits for this lock to handle Channel.Close(NOT_FOUND)
>> "AMQP Connection localhost:5672" prio=10 tid=0x00007f7464287800
>> nid=0x4675 waiting for monitor entry [0x00007f74631f0000]
>>   java.lang.Thread.State: BLOCKED (on object monitor)
>> 	at com.rabbitmq.client.impl.ChannelManager.disconnectChannel(ChannelManager.java:135)
>> 	- waiting to lock <0x00007f7473af80c8> (a
>> com.rabbitmq.client.impl.ChannelManager)
>> 	at com.rabbitmq.client.impl.AMQConnection.disconnectChannel(AMQConnection.java:130)
>> 	at com.rabbitmq.client.impl.ChannelN.releaseChannelNumber(ChannelN.java:205)
>> 	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:229)
>> 	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:165)
>> 	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
>> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:434)
>>   Locked ownable synchronizers:
>> 	- None
>>
>> All other threads wait for this lock:
>> "pool-6-thread-1" prio=10 tid=0x00007f74642d4800 nid=0x4698 waiting
>> for monitor entry [0x00007f7460ecd000]
>>   java.lang.Thread.State: BLOCKED (on object monitor)
>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:96)
>> 	- waiting to lock <0x00007f7473af80c8> (a
>> com.rabbitmq.client.impl.ChannelManager)
>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>
>> It looks like something was done around this issue at branch bug22064,
>> but it haven't merged into default yet and it's quite old. Do you have
>> any plans to use more fine grained locking in ChannelManager?
>>
>> Regards,
>> Anton Lebedevich.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From sameek at arosys.com  Thu Oct 14 12:15:42 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 14 Oct 2010 04:15:42 -0700 (PDT)
Subject: [rabbitmq-discuss] another approach to retrieve message from
 queue?
In-Reply-To: <AANLkTikG31Z=HGYtqqKhQy5te4WCG9k5wsfN_qTvsWqZ@mail.gmail.com>
References: <29959643.post@talk.nabble.com>
	<AANLkTikG31Z=HGYtqqKhQy5te4WCG9k5wsfN_qTvsWqZ@mail.gmail.com>
Message-ID: <29961403.post@talk.nabble.com>


Thanks for reply but i am not using spring amqp.
-------

Kshitiz Garg-2 wrote:
> 
> I am using spring amqp. Simple POJOs get message automatically upon
> arrival
> of a new message or rabbitMQ's delivery.
> 
> *spring configurations for template :*
> 
> <!-- Define a RabbitMQ connectionFactory -->
>     <bean id="connectionFactory"
> 
> class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>         <constructor-arg value="localhost" />
>         <property name="username" value="guest" />
>         <property name="password" value="guest" />
>     </bean>
> 
> *use that template in ur POJO to become a "magical" consumer:*
> 
> <bean id="msgHandler" class="com.xyz.MsgHandler" />
> 
>     <bean id="msgHandlerAdaptor"
> class="org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter">
>         <constructor-arg ref="msgHandler" />
>     </bean>
> 
>     <bean id="msgListener"
> class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"
>         p:connectionFactory-ref="connectionFactory" p:queueName="Queue1"
> p:autoAck="false" p:concurrentConsumers="20"
> p:messageListener-ref="msgHandlerAdaptor" />
> 
> *Bean has*
> 
>     public void handleMessage(String msg) {
> 
>     }
> 
> 
> That's it !!!
> 
> 
> On Thu, Oct 14, 2010 at 12:05 PM, sam_mis <sameek at arosys.com> wrote:
> 
>>
>> Hi
>>
>> i am using the following code to read an queue and extract the messages
>> from
>> queue. I want to know that there is another approach to retrieve message
>> from queue? if there is another approach please describe the details
>> information to get the messages from queue.
>>
>>  while (runInfinite)
>>  {
>>     QueueingConsumer.Delivery delivery;
>>            try
>>            {
>>              delivery = consumer.nextDelivery();
>>            } catch (InterruptedException ie)
>>            {
>>               continue;
>>            }
>>         System.out.println("Message received-"
>> + new String(delivery.getBody()));
>>
>> file included that contain the  code for reading and extracting message:
>> --------------------------------------------------------------------------
>> http://old.nabble.com/file/p29959643/Result.java Result.java
>>
>> Thanks
>>
>> --
>> View this message in context:
>> http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29961403.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rob at rabbitmq.com  Thu Oct 14 13:57:36 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 13:57:36 +0100
Subject: [rabbitmq-discuss] Java client 2.1.0 deadlock
In-Reply-To: <4CB6BAAC.3060002@gmail.com>
References: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>
	<77D67963-51AF-4EA7-9B8E-E349380E5543@rabbitmq.com>
	<4CB6BAAC.3060002@gmail.com>
Message-ID: <99016EC7-9014-44FD-B94B-1211E1A15E75@rabbitmq.com>

Yes. This got accepted by QA today so I expect it will be in the next release of the client.

Rob

On 14 Oct 2010, at 09:09, mabrek wrote:

> Works for me, great thanks!
> Are there any plans to merge it to default branch?
> 
> Regards,
> Anton Lebedevich
> 
> On 10/12/2010 06:47 PM, Rob Harrop wrote:
>> Anton,
>> 
>> I just pushed a fix for this issue on branch bug23360:
>> 
>> http://hg.rabbitmq.com/rabbitmq-java-client/rev/83a89cdc53aa
>> 
>> Let me know if this works for you.
>> 
>> Regards,
>> 
>> Rob
>> 
>> On 12 Oct 2010, at 15:03, mabrek wrote:
>> 
>>> Hello.
>>> I've got reproducible deadlock while working with java client 2.1.0.
>>> 
>>> Steps to follow:
>>> 1) create connection
>>> 2) create several threads that use single connection from step 1. Each
>>> thread does:
>>> 2.1) create channel
>>> 2.2) consumes from non-existing queue
>>> 3) run all threads in parallel.
>>> It will hang up.
>>> 
>>> One thread holds lock on ChannelManager:
>>> "pool-1-thread-3" prio=10 tid=0x00007f74640e2000 nid=0x4667 in
>>> Object.wait() [0x00007f7463ffe000]
>>>  java.lang.Thread.State: WAITING (on object monitor)
>>> 	at java.lang.Object.wait(Native Method)
>>> 	- waiting on <0x00007f747339bbe8> (a
>>> com.rabbitmq.utility.BlockingValueOrException)
>>> 	at java.lang.Object.wait(Object.java:485)
>>> 	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:64)
>>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>>> 	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:103)
>>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>>> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>>> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>>> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
>>> 	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
>>> 	at com.rabbitmq.client.impl.ChannelN.open(ChannelN.java:125)
>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannelInternal(ChannelManager.java:121)
>>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:100)
>>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>> 
>>> AMQP connection waits for this lock to handle Channel.Close(NOT_FOUND)
>>> "AMQP Connection localhost:5672" prio=10 tid=0x00007f7464287800
>>> nid=0x4675 waiting for monitor entry [0x00007f74631f0000]
>>>  java.lang.Thread.State: BLOCKED (on object monitor)
>>> 	at com.rabbitmq.client.impl.ChannelManager.disconnectChannel(ChannelManager.java:135)
>>> 	- waiting to lock <0x00007f7473af80c8> (a
>>> com.rabbitmq.client.impl.ChannelManager)
>>> 	at com.rabbitmq.client.impl.AMQConnection.disconnectChannel(AMQConnection.java:130)
>>> 	at com.rabbitmq.client.impl.ChannelN.releaseChannelNumber(ChannelN.java:205)
>>> 	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:229)
>>> 	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:165)
>>> 	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
>>> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:434)
>>>  Locked ownable synchronizers:
>>> 	- None
>>> 
>>> All other threads wait for this lock:
>>> "pool-6-thread-1" prio=10 tid=0x00007f74642d4800 nid=0x4698 waiting
>>> for monitor entry [0x00007f7460ecd000]
>>>  java.lang.Thread.State: BLOCKED (on object monitor)
>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:96)
>>> 	- waiting to lock <0x00007f7473af80c8> (a
>>> com.rabbitmq.client.impl.ChannelManager)
>>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>> 
>>> It looks like something was done around this issue at branch bug22064,
>>> but it haven't merged into default yet and it's quite old. Do you have
>>> any plans to use more fine grained locking in ChannelManager?
>>> 
>>> Regards,
>>> Anton Lebedevich.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 


From rob at rabbitmq.com  Thu Oct 14 14:38:10 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 14:38:10 +0100
Subject: [rabbitmq-discuss] Java client 2.1.0 deadlock
In-Reply-To: <99016EC7-9014-44FD-B94B-1211E1A15E75@rabbitmq.com>
References: <AANLkTim+_tcE0qOcS-0XsXrajjikJh4Jes0HACsQ5CWf@mail.gmail.com>
	<77D67963-51AF-4EA7-9B8E-E349380E5543@rabbitmq.com>
	<4CB6BAAC.3060002@gmail.com>
	<99016EC7-9014-44FD-B94B-1211E1A15E75@rabbitmq.com>
Message-ID: <297F578A-0C45-4FFF-9A57-C2132B34E91D@rabbitmq.com>

It just got merged: http://hg.rabbitmq.com/rabbitmq-java-client/rev/599b3a8b5c1c

Regards,

Rob

On 14 Oct 2010, at 13:57, Rob Harrop wrote:

> Yes. This got accepted by QA today so I expect it will be in the next release of the client.
> 
> Rob
> 
> On 14 Oct 2010, at 09:09, mabrek wrote:
> 
>> Works for me, great thanks!
>> Are there any plans to merge it to default branch?
>> 
>> Regards,
>> Anton Lebedevich
>> 
>> On 10/12/2010 06:47 PM, Rob Harrop wrote:
>>> Anton,
>>> 
>>> I just pushed a fix for this issue on branch bug23360:
>>> 
>>> http://hg.rabbitmq.com/rabbitmq-java-client/rev/83a89cdc53aa
>>> 
>>> Let me know if this works for you.
>>> 
>>> Regards,
>>> 
>>> Rob
>>> 
>>> On 12 Oct 2010, at 15:03, mabrek wrote:
>>> 
>>>> Hello.
>>>> I've got reproducible deadlock while working with java client 2.1.0.
>>>> 
>>>> Steps to follow:
>>>> 1) create connection
>>>> 2) create several threads that use single connection from step 1. Each
>>>> thread does:
>>>> 2.1) create channel
>>>> 2.2) consumes from non-existing queue
>>>> 3) run all threads in parallel.
>>>> It will hang up.
>>>> 
>>>> One thread holds lock on ChannelManager:
>>>> "pool-1-thread-3" prio=10 tid=0x00007f74640e2000 nid=0x4667 in
>>>> Object.wait() [0x00007f7463ffe000]
>>>> java.lang.Thread.State: WAITING (on object monitor)
>>>> 	at java.lang.Object.wait(Native Method)
>>>> 	- waiting on <0x00007f747339bbe8> (a
>>>> com.rabbitmq.utility.BlockingValueOrException)
>>>> 	at java.lang.Object.wait(Object.java:485)
>>>> 	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:64)
>>>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>>>> 	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:103)
>>>> 	- locked <0x00007f747339bbe8> (a com.rabbitmq.utility.BlockingValueOrException)
>>>> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>>>> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>>>> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
>>>> 	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:139)
>>>> 	at com.rabbitmq.client.impl.ChannelN.open(ChannelN.java:125)
>>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannelInternal(ChannelManager.java:121)
>>>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:100)
>>>> 	- locked <0x00007f7473af80c8> (a com.rabbitmq.client.impl.ChannelManager)
>>>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>>> 
>>>> AMQP connection waits for this lock to handle Channel.Close(NOT_FOUND)
>>>> "AMQP Connection localhost:5672" prio=10 tid=0x00007f7464287800
>>>> nid=0x4675 waiting for monitor entry [0x00007f74631f0000]
>>>> java.lang.Thread.State: BLOCKED (on object monitor)
>>>> 	at com.rabbitmq.client.impl.ChannelManager.disconnectChannel(ChannelManager.java:135)
>>>> 	- waiting to lock <0x00007f7473af80c8> (a
>>>> com.rabbitmq.client.impl.ChannelManager)
>>>> 	at com.rabbitmq.client.impl.AMQConnection.disconnectChannel(AMQConnection.java:130)
>>>> 	at com.rabbitmq.client.impl.ChannelN.releaseChannelNumber(ChannelN.java:205)
>>>> 	at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:229)
>>>> 	at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:165)
>>>> 	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
>>>> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:434)
>>>> Locked ownable synchronizers:
>>>> 	- None
>>>> 
>>>> All other threads wait for this lock:
>>>> "pool-6-thread-1" prio=10 tid=0x00007f74642d4800 nid=0x4698 waiting
>>>> for monitor entry [0x00007f7460ecd000]
>>>> java.lang.Thread.State: BLOCKED (on object monitor)
>>>> 	at com.rabbitmq.client.impl.ChannelManager.createChannel(ChannelManager.java:96)
>>>> 	- waiting to lock <0x00007f7473af80c8> (a
>>>> com.rabbitmq.client.impl.ChannelManager)
>>>> 	at com.rabbitmq.client.impl.AMQConnection.createChannel(AMQConnection.java:382)
>>>> 
>>>> It looks like something was done around this issue at branch bug22064,
>>>> but it haven't merged into default yet and it's quite old. Do you have
>>>> any plans to use more fine grained locking in ChannelManager?
>>>> 
>>>> Regards,
>>>> Anton Lebedevich.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Thu Oct 14 14:51:54 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 14:51:54 +0100
Subject: [rabbitmq-discuss] another approach to retrieve message from
	queue?
In-Reply-To: <29959643.post@talk.nabble.com>
References: <29959643.post@talk.nabble.com>
Message-ID: <5AB3822A-43C2-44EB-9834-65EC2B5E2659@rabbitmq.com>

Using Channel.basicConsume along with QueueingConsumer (or another implementation of Consumer) is what I would recommend.

If you want to just grab a message of the queue as a one-shot action then you can use Channel.basicGet:

GetResponse r = channel.basicGet("thequeue", true); // note use of noAck = true

if(r != null) {
 // got a message
 byte[] contents = r.getBody();
 doSomethingWithBody(r);
}

Note the null check - this is important. Channel.basicGet does not block until a message becomes available, instead it just returns null if there is no message.

Hope this helps,

Rob

On 14 Oct 2010, at 07:35, sam_mis wrote:

> 
> Hi
> 
> i am using the following code to read an queue and extract the messages from
> queue. I want to know that there is another approach to retrieve message
> from queue? if there is another approach please describe the details
> information to get the messages from queue. 
> 
> while (runInfinite)
> {
>     QueueingConsumer.Delivery delivery;
>            try
>            {
>              delivery = consumer.nextDelivery();
>            } catch (InterruptedException ie)
>            {
>               continue;
>            }
>         System.out.println("Message received-"
> + new String(delivery.getBody()));
> 
> file included that contain the  code for reading and extracting message:
> --------------------------------------------------------------------------
> http://old.nabble.com/file/p29959643/Result.java Result.java 
> 
> Thanks
> 
> -- 
> View this message in context: http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Thu Oct 14 14:56:49 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 14:56:49 +0100
Subject: [rabbitmq-discuss] Consumer Not Getting Message
In-Reply-To: <29941664.post@talk.nabble.com>
References: <29941664.post@talk.nabble.com>
Message-ID: <B80E9C61-98A4-45BF-ABCC-B16832541B98@rabbitmq.com>

On the face of it the code looks fine.

Just to check, do you see GETTING MESSAGE printed out the second time?

Is it possible for you to pull this out of an EJB and run it standalone? I doubt that it is anything specific about the JBoss environment but it's worth checking to be sure. 

Is there anything of interest in the Rabbit logs?

Regards,

Rob

On 12 Oct 2010, at 10:43, azzuwan wrote:

> 
> I'm using Rabbit MQ 1.8.0 and connecting using the java client from an EJB in
> JBOSS 5.1.
> 
> I'm having a problem while trying to get message from the queue using the
> following codes
> 
> QueueingConsumer consumer = new QueueingConsumer(replyChannel);
>            replyChannel.basicConsume(replyQueueName, consumer);
>            boolean run = true;
> 
>            logger.info("BEFORE LOOP");
>            while (run) {
>                QueueingConsumer.Delivery delivery = null;
>                logger.info("GETTING MESSAGE");
>                try {                    
> 
>                    delivery = consumer.nextDelivery();
>                    logger.info("MESSAGE RECIEVED STATE ");
> 
> replyChannel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
> 
> 
> 
>                } catch (InterruptedException ie) {
>                    logger.info(ie.getMessage());
>                    continue;
>                }                
> 
>                ....
>            }
> 
> 
> I managed to get the first message successfully but the second and
> subsequent messages never gets delivered.
> From the output, it seems that the attempt to get the message stuck at 
> delivery = consumer.nextDelivery() .
> MESSAGE RECIEVED STATE gets print out for the first time only.
> From then on, all the messages gets piled up in the queue.
> Any idea why?
> 
> 
> -- 
> View this message in context: http://old.nabble.com/Consumer-Not-Getting-Message-tp29941664p29941664.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Thu Oct 14 15:19:41 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 15:19:41 +0100
Subject: [rabbitmq-discuss] How to ensure the message delivery using
	shared queues
In-Reply-To: <29933060.post@talk.nabble.com>
References: <29933060.post@talk.nabble.com>
Message-ID: <4A14EF4C-9C4B-4645-B5CC-F44F32020B08@rabbitmq.com>

Hi,

For your queue setup you should make sure that you are creating a durable queue. If the queue is not durable it will just disappear when the server is restarted.

On the publish side, you want to make sure that you set delivery mode to 2 (persistent). By default, delivery mode is set to 1 (transient). In Java this looks like:

	AMQP.BasicProperties props = new AMQP.BasicProperties();
	props.setDeliveryMode(2);

	channel.basicPublish("amq.direct", "test", props, "test".getBytes());

You might want to do your publish transactionally to be certain that the messages have been written to disk. Once you get back tx.commit_ok you can be sure that persistent messages published in that transaction are written to disk.

On the consume side, you can work with noAck=false and only acknowledge the messages when they are successfully processed. 

If a Channel closes without acknowledging a message that has been delivered to it for a given queue, then that message will be redelivered to another consumer on that queue.

I hope this helps. Let me know if you need any more detail.

Rob

On 11 Oct 2010, at 12:13, padl wrote:

> 
> hi
> 
> I am a novice user. I just want to know when we use shared queue how to
> ensure the delivery and durability of message?
> 
> Any help will be appreciable.
> 
> Thank You
> -- 
> View this message in context: http://old.nabble.com/How-to-ensure-the-message-delivery-using-shared-queues-tp29933060p29933060.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pdezwart at rubiconproject.com  Thu Oct 14 17:17:51 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 14 Oct 2010 09:17:51 -0700
Subject: [rabbitmq-discuss] About PHP PECL extension
In-Reply-To: <F5337DD6-2768-4C36-A5A0-222AFD7363E4@mozilla.com>
Message-ID: <C8DC7B3F.10D80%pdezwart@rubiconproject.com>

Good call. Ill check it out and get back to you.
Pieter


On 10/13/10 10:41 PM, "Christian Legnitto" <clegnitto at mozilla.com> wrote:

> Ok, I wasn't interested in this before but now I am :-). I plan to write a
> mediawiki extension that publishes messages into rabbit and this is a rather
> crucial piece.
> 
> Let me know what help I can give.
> 
> I would also take a look at carrot (python) as it has an API that is fairly
> easy to use and can be generalized for other protocols (like stomp). Every
> time I do something amqp specific it seems like the next question is if it
> will support stomp. That being said, I like what has been proposed so far.
> 
> Thanks,
> Christian
> 
> On Oct 12, 2010, at 9:09 PM, Brad Rodriguez wrote:
> 
>> I generally like the API of the Java client, although we would obviously not
>> want the php client to be quite as verbose.
>> 
>> I'm on board with disabling auto-connect in favor of explicitly controlling
>> when we connect and disconnect. Specifically, having disconnect and reconnect
>> methods will be especially useful.
>> 
>> I like the following API:
>> 
>> $connection = new AMQPConnection($params);
>> $connection->connect();
>> 
>> $exchangeList = $connection->listExchanges();
>> $exchange = $connection->exchangeDeclare('my_exchange', AMQP_EX_TYPE_TOPIC,
>> $flags);
>> 
>> $queueList = $exchange->listQueues();
>> $queue = $connection->queueDeclare('my_queue', $flags);
>> 
>> 
>> $queue->bind($exchange, $routingKey);
>> $queue->unbind($exchange, $routingKey);
>> 
>> $exchange->publish($message, $routingKey);
>> 
>> $connection->disconnect();
>> 
>> -Brad
>> 
>> 
>> On Oct 8, 2010, at 6:54 PM, Pieter de Zwart wrote:
>> 
>>> Happy too. Though I?m gonna point at you if we start annoying people =)
>>> 
>>> I looked through the Java client, which would seem to be the most mature and
>>> well built client to date. The major difference between the PHP extension
>>> (hereby PHPE) and the Java client (hereby JC... get it?) is that the JC
>>> allows the creation of multiple channels, and the ability to act within a
>>> channel. PHPE instead uses one channel for everything (channel 1.)
>>> As far as objects go, since I want PHPE to be OO, the current layout seems
>>> to make sense to me, with AMQPConnection, AMQPExchange and AMQPQueue. From
>>> there, the methods I think need to be cleaned up:
>>> AMQPConnection should continue to allow the $params = array() setup, whereby
>>> a user can create and set username, password, host, port and vhost, like so:
>>> 
>>> $cnn = new AMQPConnection(array(?login? => ?guest?, ?password? => ??, ?host?
>>> => ?localhost?));
>>> 
>>> However, I want to remove the auto-connect portion of the constructor, so
>>> users have to call:
>>> 
>>> $cnn->connect();
>>> 
>>> That way, we can also add the following method: setLogin, setPassword,
>>> setPort, setHost, setVHost. I also want to add the following action methods:
>>> reconnect, disconnect.
>>> 
>>> The connection object should in turn give access to exchanges and queues,
>>> but how I am not yet sure, and I would love feedback from everyone on this.
>>> I like JC?s approach of using AMQPConnection->queueDeclare and
>>> AMQPConnectio->exchangeDeclare which would return instances of AMQPQueue and
>>> AMQPExchange respectively. I guess those methods would also accept an
>>> additional bit mask for options, and if the queue/exchange already exists,
>>> the new bit mask values would be applied...
>>> 
>>> I am tired, so I will stop here and look for others to poke holes in my
>>> theory. Feedback from JC users in particular would be much appreciated in
>>> terms of likes and dislikes of their client.
>>> 
>>> Pieter 
>>> 
>>> 
>>> 
>>> On 10/8/10 12:41 AM, "Pedram Nimreezi" <mc at majorcomputing.com
>>> <x-msg://716/mc at majorcomputing.com> > wrote:
>>> 
>>>> Keep it on the air ways...  if you would...
>>>> 
>>>> 
>>>> 
>>>> On Fri, Oct 8, 2010 at 3:11 AM, Alvaro Videla <videlalvaro at gmail.com
>>>> <x-msg://716/videlalvaro at gmail.com> > wrote:
>>>>> Well,
>>>>> 
>>>>> I said where is the place to contribute, not that I had something to
>>>>> contribute right now?
>>>>> 
>>>>> But we might start using this extension in prod and I remember last time I
>>>>> checked the API there was some stuff I'd like it to be "different"
>>>>> 
>>>>> Regards,
>>>>> 
>>>>> Alvaro
>>>>> 
>>>>> On Oct 8, 2010, at 3:09 PM, Pieter de Zwart wrote:
>>>>> 
>>>>>> > Oh thank you deity of your choice for answering me. I need help.
>>>>>> > Lets take this off list so we don't pollute the airways.
>>>>>> > Pieter
>>>>>> >
>>>>>> >
>>>>>> > On 10/8/10 12:06 AM, "Alvaro Videla" <videlalvaro at gmail.com
>>>>>> <x-msg://716/videlalvaro at gmail.com> > wrote:
>>>>>> >
>>>>>>> >> Hi Pieter,
>>>>>>> >>
>>>>>>> >> My question is more where is the source code that we can contribute
>>>>>>> back. I
>>>>>>> >> know about the PECL stuff :)
>>>>>>> >>
>>>>>>> >> Regards,
>>>>>>> >>
>>>>>>> >> Alvaro
>>>>>>> >>
>>>>>>> >>
>>>>>>> >> On Oct 8, 2010, at 3:05 PM, Pieter de Zwart wrote:
>>>>>>> >>
>>>>>>>> >>> Excellent question. The source code for this:
>>>>>>>> >>> http://php.net/manual/en/book.amqp.php
>>>>>>>> >>> is available here:
>>>>>>>> >>> http://pecl.php.net/package/amqp
>>>>>>>> >>>
>>>>>>>> >>> I am reworking it right now to work with Rabbit 2.0.* and 2.1.*.
>>>>>>>> The one
>>>>>>>> >>> listed works with 1.7.*.
>>>>>>>> >>>
>>>>>>>> >>> Pieter
>>>>>>>> >>>
>>>>>>>> >>>
>>>>>>>> >>> On 10/7/10 11:45 PM, "Alvaro Videla" <videlalvaro at gmail.com
>>>>>>>> <x-msg://716/videlalvaro at gmail.com> > wrote:
>>>>>>>> >>>
>>>>>>>>> >>>> I think is php-rabbit
>>>>>>>>> >>>>
>>>>>>>>> >>>> Thanks!
>>>>>>>>> >>>>
>>>>>>>>> >>>> On Oct 8, 2010, at 2:41 PM, Alexis Richardson wrote:
>>>>>>>>> >>>>
>>>>>>>>>> >>>>> Could it be one of these?
>>>>>>>>>> >>>>>
>>>>>>>>>> >>>>> http://www.delicious.com/alexisrichardson/rabbitmq+client+php
>>>>>>>>>> >>>>>
>>>>>>>>>> >>>>>
>>>>>>>>>> >>>>>
>>>>>>>>>> >>>>> On Fri, Oct 8, 2010 at 7:04 AM, Alvaro Videla
>>>>>>>>>> <videlalvaro at gmail.com <x-msg://716/videlalvaro at gmail.com> >
>>>>>>>>>> >>>>> wrote:
>>>>>>>>>>> >>>>>> Hi,
>>>>>>>>>>> >>>>>>
>>>>>>>>>>> >>>>>> I would like to know where's the code for the PHP extension
>>>>>>>>>>> that appears
>>>>>>>>>>> >>>>>> on
>>>>>>>>>>> >>>>>> the PHP website.
>>>>>>>>>>> >>>>>>
>>>>>>>>>>> >>>>>> Regards,
>>>>>>>>>>> >>>>>>
>>>>>>>>>>> >>>>>> Alvaro
>>>>>>>>>>> >>>>>> _______________________________________________
>>>>>>>>>>> >>>>>> rabbitmq-discuss mailing list
>>>>>>>>>>> >>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>>>> <x-msg://716/rabbitmq-discuss at lists.rabbitmq.com>
>>>>>>>>>>> >>>>>> 
>>>>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>>>> >>>>>>
>>>>>>>>> >>>>
>>>>>>>>> >>>> _______________________________________________
>>>>>>>>> >>>> rabbitmq-discuss mailing list
>>>>>>>>> >>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>>> <x-msg://716/rabbitmq-discuss at lists.rabbitmq.com>
>>>>>>>>> >>>> 
>>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>> >>>
>>>>>>> >>
>>>>>> >
>>>>> 
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> <x-msg://716/rabbitmq-discuss at lists.rabbitmq.com>
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/dc913bb7/attachment.htm>

From holger.hoffstaette at googlemail.com  Thu Oct 14 18:02:20 2010
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Thu, 14 Oct 2010 19:02:20 +0200
Subject: [rabbitmq-discuss] Java Client Changes
References: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>
Message-ID: <pan.2010.10.14.17.02.20.453446@googlemail.com>


Hi Rob,

thanks for taking the time to look into this. Sorry that I haven't
commented earlier but I moved and had no internet/mail/list access etc.

On Tue, 12 Oct 2010 14:39:27 +0100, Rob Harrop wrote:

> * Dispatch to consumers now happens on a separate thread from the
> Connection thread

This is good. :)

> * Each Channel has its own dispatch thread

This is unfortunately not so good and pretty much what I was hoping to
avoid. It can lead to excessive context switching (the #1 enemy), and with
a large number of Channels to really large memory use.
I've looked at the code and understand that ChannelDispatcher will
not deadlock when a consumer calls back with Channel ops, since it runs in
the same thread. However, this is "recursive" in the sense that call
chains that are too deep could blow the stack - unlikely though.
I know that this is unavoidable since Java does not have real
continuations, but if that's the acceptable tradeoff then we might as well
just pull a Thread from an arbitrary pool, note that in the dispatcher and
do any channel ops. Any callbacks from a consumer on that thread should
now be able to re-enter the dispatcher. When all is done just clear the
current thread from the dispatcher and pop out.
That way we can have a freely configurable ExecutorService and less
threads with no deadlock on callback.

I should probably add that I just made that up and haven't tested it yet,
but maybe you find the idea interesting. :-)

-h



From rob at rabbitmq.com  Thu Oct 14 19:16:23 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 19:16:23 +0100
Subject: [rabbitmq-discuss] message acknowledment
In-Reply-To: <29950181.post@talk.nabble.com>
References: <29950181.post@talk.nabble.com>
Message-ID: <B6A1D9B5-1D14-486D-827D-35BC4BFAA2AE@rabbitmq.com>

When you consume a message, either with basic.get or basic.consume you have control over the noAck flag. 

When you set noAck=true, messages are considered automatically acknowledged as soon as they have been delivered.

With noAck=false, messages must be acknowledged manually with basic.ack.


For example, in Java, you can use noAck=true like this:

	GetResponse theResp = channel.basicGet("queue", true);
	// message is acknowledged now and won't be redelivered for this queue

With noAck=false:

	try {
		GetResponse theResp = channel.basicGet("queue", true);
		if(theResp != null) {
			doSomething(theResp);
			channel.basicAck(theResp.getEnvelope().getDeliveryTag(), false);
		}
	catch(Exception ex) {
		// processing error, close the channel
		channel.close();
	}

After the channel is closed, the message will be redelivered to another consumer on that queue.

Hope this helps!

Rob

On 13 Oct 2010, at 08:21, MOTEW wrote:

> 
> hello to all.
> i am working on rabbitmq 
> if the consumer get the mesage will he send some acknowledment to
> rabbitmq???
> 
>>> or what about  rabbitmq acknowledment policies???
> 
>>> if the message is lost whether due to node down or else how it is
> relievered to the consumer without any error message to the publisher????and
> also after successful delievery we want to delete it from broker's queue???
> 
> any help is appreciable
> 
> 
> 
> -- 
> View this message in context: http://old.nabble.com/message-acknowledment-tp29950181p29950181.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Thu Oct 14 19:23:36 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 19:23:36 +0100
Subject: [rabbitmq-discuss] message acknowledment
In-Reply-To: <B6A1D9B5-1D14-486D-827D-35BC4BFAA2AE@rabbitmq.com>
References: <29950181.post@talk.nabble.com>
	<B6A1D9B5-1D14-486D-827D-35BC4BFAA2AE@rabbitmq.com>
Message-ID: <6CA35BCE-4217-4602-A4CD-C005A393B0FF@rabbitmq.com>

Thanks to Matthias for noticing I set noAck=true in both examples. The second example should start:
	
	try {
		GetResponse theResp = channel.basicGet("queue", false);

Rob

On 14 Oct 2010, at 19:16, Rob Harrop wrote:

> When you consume a message, either with basic.get or basic.consume you have control over the noAck flag. 
> 
> When you set noAck=true, messages are considered automatically acknowledged as soon as they have been delivered.
> 
> With noAck=false, messages must be acknowledged manually with basic.ack.
> 
> 
> For example, in Java, you can use noAck=true like this:
> 
> 	GetResponse theResp = channel.basicGet("queue", true);
> 	// message is acknowledged now and won't be redelivered for this queue
> 
> With noAck=false:
> 
> 	try {
> 		GetResponse theResp = channel.basicGet("queue", true);
> 		if(theResp != null) {
> 			doSomething(theResp);
> 			channel.basicAck(theResp.getEnvelope().getDeliveryTag(), false);
> 		}
> 	catch(Exception ex) {
> 		// processing error, close the channel
> 		channel.close();
> 	}
> 
> After the channel is closed, the message will be redelivered to another consumer on that queue.
> 
> Hope this helps!
> 
> Rob
> 
> On 13 Oct 2010, at 08:21, MOTEW wrote:
> 
>> 
>> hello to all.
>> i am working on rabbitmq 
>> if the consumer get the mesage will he send some acknowledment to
>> rabbitmq???
>> 
>>>> or what about  rabbitmq acknowledment policies???
>> 
>>>> if the message is lost whether due to node down or else how it is
>> relievered to the consumer without any error message to the publisher????and
>> also after successful delievery we want to delete it from broker's queue???
>> 
>> any help is appreciable
>> 
>> 
>> 
>> -- 
>> View this message in context: http://old.nabble.com/message-acknowledment-tp29950181p29950181.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From akalend at mail.ru  Thu Oct 14 20:44:47 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Thu, 14 Oct 2010 23:44:47 +0400
Subject: [rabbitmq-discuss] the productivity of RabbitMQ
Message-ID: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>

Hi collegues,

I make some test and was surprised:
I have the cons 256 byte message len and publish the message to broker at localhost by fanout.

I have the 8-9 Kqps.

I make consume one clitnt and had 2-5K qps.

Haw I can increase productivity?


Alexandre

From mlong at crocodoc.com  Thu Oct 14 21:33:03 2010
From: mlong at crocodoc.com (Matt Long)
Date: Thu, 14 Oct 2010 16:33:03 -0400
Subject: [rabbitmq-discuss] rabbitmq beginner,
	cannot start rabbitmq/cannot get status
Message-ID: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>

Hello,

I've just started using rabbitmq. I've run into trouble trying to use
rabbitmq-server on an Ubuntu 10.04 EC2 EBS instance (ami-6006f309). When I
first installed rabbitmq (sudo apt-get install rabbitmq-server), it was
working just fine and also worked fine after stopping/starting my EC2
instance. However, now after I reboot the EC2 instance and ssh back in, I
get this when trying to check the status (the first command I issue):

$ sudo rabbitmqctl status
Status of node 'rabbit at ip-10-100-100-200' ...
Error: unable to connect to node 'rabbit at ip-10-100-100-200': nodedown
diagnostics:
- unable to connect to epmd on ip-10-100-100-200: address
- current node: 'rabbitmqctl812 at ip-10-100-100-200'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: X5WdGfO9GimAgcVGJx/dSQ==

So then I try to manually start it:

$ sudo rabbitmq-server
{error_logger,{{2010,10,14},{19,54,3}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,10,14},{19,54,3}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.22.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.119>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,495}],[]]}
{error_logger,{{2010,10,14},{19,54,3}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,10,14},{19,54,3}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,10,14},{19,54,3}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

>From googling around I determined that that error means rabbitmq is already
running, which makes sense since it should have started via /etc/init.d. So
I kill the running processes and then try to start it again and it appears
to startup fine:

$ ps ax | grep beam
  530 ?        Sl     0:00 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -- -root
/usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin -noshell -noinput
-hidden -sname rabbitmq_multi530 -s rabbit_multi -extra start_all 1
  661 ?        Ssl    0:00 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W w -K
true -A30 -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq
-- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin -noshell
-noinput -s rabbit -sname rabbit -boot start_sasl -kernel
inet_default_listen_options [{nodelay,true}] -kernel
inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
-kernel error_logger {file,"/var/log/rabbitmq/rabbit.log"} -sasl
sasl_error_logger {file,"/var/log/rabbitmq/rabbit-sasl.log"} -os_mon
start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false
-mnesia dir "/var/lib/rabbitmq/mnesia/rabbit" -noshell -noinput
  972 pts/0    R+     0:00 grep --color=auto beam
$ sudo kill 530
kill: No such process
$ sudo kill 661
$ sudo rabbitmq-server
*<standard rabbitmq logo and other info>*
node          : rabbit at ip-10-100-100-200
app descriptor:
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
home dir      : /var/lib/rabbitmq
cookie hash   : X5WdGfO9GimAgcVGJx/dSQ==
log           : /var/log/rabbitmq/rabbit.log
sasl log      : /var/log/rabbitmq/rabbit-sasl.log
database dir  : /var/lib/rabbitmq/mnesia/rabbit
*<alot of "starting" lines; each of which has "...done" at the end>*
broker running

Then in another SSH terminal I try to check the status and get the same
error as my first attempt to check the status. So I again made no rabbitmq
(i.e. beam) processes were running and tried to start rabbitmq via
/etc/init.d/rabbitmq-server:

$ sudo /etc/init.d/rabbitmq-server start
Starting rabbitmq-server:
*<indefinite hang, had to Ctrl-C,Ctrl-C>*

I tried several other things like deleting all contents of /var/lib/rabbitmq
and that starting again; all to no avail. Can someone help? I'm hoping this
is fairly easy to reproduce as I did a very straightforward setup from the
official Ubuntu us-east ebs ami (ami-6006f309). Note that I've changed the
hostname (ip-10-100-100-200) in everything I've pasted above from it's
original (but similar) value for privacy.

Also, at some point in my testing i got the following in startup_err, but I
can't remember what the steps were that led to getting that error message:

$ cat /var/log/rabbitma/startup_err
Error: cannot_get_pid


Many thanks in advance for any help!

-Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/d9bfd9d6/attachment-0001.htm>

From matthias at rabbitmq.com  Thu Oct 14 21:40:47 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 14 Oct 2010 21:40:47 +0100
Subject: [rabbitmq-discuss] rabbitmq beginner,
 cannot start rabbitmq/cannot get status
In-Reply-To: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>
References: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>
Message-ID: <4CB76ACF.1060601@rabbitmq.com>

Matt,

Matt Long wrote:
> after I reboot the EC2 instance and ssh back 
> in, I get this when trying to check the status:
> 
> $ sudo rabbitmqctl status
> Status of node 'rabbit at ip-10-100-100-200' ...
> Error: unable to connect to node 'rabbit at ip-10-100-100-200': nodedown
> diagnostics:
> - unable to connect to epmd on ip-10-100-100-200: address

That last line indicates that rabbitmqctl was unable to resolve 
ip-10-100-100-200 to an IP address.


Matthias.

From shaneman at adobe.com  Thu Oct 14 22:13:11 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Thu, 14 Oct 2010 14:13:11 -0700
Subject: [rabbitmq-discuss] connection.close() hangs
Message-ID: <A1CB3D904533654CB64599397AC43ADE014067AB8787@NAMBX02.corp.adobe.com>

ubuntu-10.04.1-server-amd64
RabbitMQ 2.1.0, generic install
Java client: rabbitmq-java-client-bin-2.1.0
Java 1.5

The following code hangs on conn.close().  Specifying a timeout did not help.  No issues when run on RabbitMQ 2.0.

--Steve

package com.bla.rabbit.test;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.MessageProperties;

public class Small {

      /**
       * @param args
       */
      public static void main(String[] args) {

            String exchange = "myexchangename";
            String queue = "myqueuename";
            String route = "myroutingkey";
            String msg = "hello";
            byte[] messageBodyBytes = msg.getBytes();

            ConnectionFactory factory = new ConnectionFactory();
            factory.setUsername("guest");
            factory.setPassword("guest");
            factory.setHost("127.0.0.1");
            factory.setVirtualHost("test");

            try {
                  Connection conn = factory.newConnection();
                  Channel pushChannel = conn.createChannel();

                  pushChannel.exchangeDeclare(exchange, "direct", true);
                  pushChannel.queueDeclare(queue, true, false, false, null);
                  pushChannel.queueBind(queue, exchange, route);

                  System.out.println("publish");
                  pushChannel.basicPublish(exchange, route, true, true, MessageProperties.PERSISTENT_TEXT_PLAIN, messageBodyBytes);

                  // we hang here
                  System.out.println("start close");
                  conn.close();
                  System.out.println("end close");
            } catch (Exception ex) {
                  ex.printStackTrace();
            }
      }

}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/c1e2baa4/attachment-0001.htm>

From michaelburns1 at gmail.com  Thu Oct 14 22:32:00 2010
From: michaelburns1 at gmail.com (Michael Burns)
Date: Thu, 14 Oct 2010 22:32:00 +0100
Subject: [rabbitmq-discuss] rabbitmq beginner,
 cannot start rabbitmq/cannot get status
In-Reply-To: <4CB76ACF.1060601@rabbitmq.com>
References: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>
	<4CB76ACF.1060601@rabbitmq.com>
Message-ID: <AANLkTi=mcE8COQrtW9X6YuH1wAfVwcM12z3wuiLWDvTg@mail.gmail.com>

I've seen this problem with RabbitMQ on an EC2 instance before - the
solution here is to adjust the hostname of the machine to something that
will resolve across reboots of your EC2 instance.

Matt,
>
> Matt Long wrote:
>
>> after I reboot the EC2 instance and ssh back in, I get this when trying to
>> check the status:
>>
>> $ sudo rabbitmqctl status
>>
>> Status of node 'rabbit at ip-10-100-100-200' ...
>> Error: unable to connect to node 'rabbit at ip-10-100-100-200': nodedown
>> diagnostics:
>> - unable to connect to epmd on ip-10-100-100-200: address
>>
>
> That last line indicates that rabbitmqctl was unable to resolve
> ip-10-100-100-200 to an IP address.
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/28c64b79/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 14 22:42:52 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 14 Oct 2010 22:42:52 +0100
Subject: [rabbitmq-discuss] connection.close() hangs
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE014067AB8787@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE014067AB8787@NAMBX02.corp.adobe.com>
Message-ID: <4CB7795C.4020604@rabbitmq.com>

Steve,

Steve Haneman wrote:
> ubuntu-10.04.1-server-amd64
> RabbitMQ 2.1.0, generic install
> Java client: rabbitmq-java-client-bin-2.1.0
> Java 1.5
> 
> The following code hangs on conn.close().  Specifying a timeout did not 
> help.  No issues when run on RabbitMQ 2.0.

Is this reproducible? If so, please run the code you posted against the 
server with the protocol tracer 
(http://www.rabbitmq.com/examples.html#tracer) inbetween and post the 
output.

>                   System.out.println("publish");
>                   pushChannel.basicPublish(exchange, route, true, 
> true, MessageProperties.PERSISTENT_TEXT_PLAIN, messageBodyBytes);
>                   // we hang here
>                   System.out.println("start close");
>                   conn.close();
>                   System.out.println("end close");

So you do see the "start close" but not the "end close"?


Regards,

Matthias.

From shaneman at adobe.com  Thu Oct 14 22:45:32 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Thu, 14 Oct 2010 14:45:32 -0700
Subject: [rabbitmq-discuss] connection.close() hangs
Message-ID: <A1CB3D904533654CB64599397AC43ADE014067AB87B2@NAMBX02.corp.adobe.com>

A restart of the server cleared it up.  No errors in the rabbitmq logs.  Seems fishy.  I had been running some load tests on the server prior to it acting this way.

--Steve

From: Steve Haneman
Sent: Thursday, October 14, 2010 2:13 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: connection.close() hangs

ubuntu-10.04.1-server-amd64
RabbitMQ 2.1.0, generic install
Java client: rabbitmq-java-client-bin-2.1.0
Java 1.5

The following code hangs on conn.close().  Specifying a timeout did not help.  No issues when run on RabbitMQ 2.0.

--Steve

package com.bla.rabbit.test;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.MessageProperties;

public class Small {

      /**
       * @param args
       */
      public static void main(String[] args) {

            String exchange = "myexchangename";
            String queue = "myqueuename";
            String route = "myroutingkey";
            String msg = "hello";
            byte[] messageBodyBytes = msg.getBytes();

            ConnectionFactory factory = new ConnectionFactory();
            factory.setUsername("guest");
            factory.setPassword("guest");
            factory.setHost("127.0.0.1");
            factory.setVirtualHost("test");

            try {
                  Connection conn = factory.newConnection();
                  Channel pushChannel = conn.createChannel();

                  pushChannel.exchangeDeclare(exchange, "direct", true);
                  pushChannel.queueDeclare(queue, true, false, false, null);
                  pushChannel.queueBind(queue, exchange, route);

                  System.out.println("publish");
                  pushChannel.basicPublish(exchange, route, true, true, MessageProperties.PERSISTENT_TEXT_PLAIN, messageBodyBytes);

                  // we hang here
                  System.out.println("start close");
                  conn.close();
                  System.out.println("end close");
            } catch (Exception ex) {
                  ex.printStackTrace();
            }
      }

}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/6dea1b4a/attachment-0001.htm>

From rob at rabbitmq.com  Thu Oct 14 23:08:30 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Oct 2010 23:08:30 +0100
Subject: [rabbitmq-discuss] Java Client Changes
In-Reply-To: <pan.2010.10.14.17.02.20.453446@googlemail.com>
References: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>
	<pan.2010.10.14.17.02.20.453446@googlemail.com>
Message-ID: <0C5036F2-7100-40E7-B099-17BE7E5F3A3F@rabbitmq.com>

Thanks for taking the time to look at this and write up your thoughts. Your input is most appreciated.

On 14 Oct 2010, at 18:02, Holger Hoffstaette wrote:

> 
> Hi Rob,
> 
> thanks for taking the time to look into this. Sorry that I haven't
> commented earlier but I moved and had no internet/mail/list access etc.
> 
> On Tue, 12 Oct 2010 14:39:27 +0100, Rob Harrop wrote:
> 
>> * Dispatch to consumers now happens on a separate thread from the
>> Connection thread
> 
> This is good. :)
> 
>> * Each Channel has its own dispatch thread
> 
> This is unfortunately not so good and pretty much what I was hoping to
> avoid. It can lead to excessive context switching (the #1 enemy), and with
> a large number of Channels to really large memory use.
> I've looked at the code and understand that ChannelDispatcher will
> not deadlock when a consumer calls back with Channel ops, since it runs in
> the same thread. However, this is "recursive" in the sense that call
> chains that are too deep could blow the stack -

I might be misunderstanding what you mean here but the ConsumerDispatcher is not self-recursive. Importantly, no two dispatch calls are ever nested on the same stack. Consider what might happen if you initiate basicConsume on queue1 and the consumer gets back a handleConsumeOK. In that call back the Consumer sends a message to queue1 and gets a handleDelivery callback. The stack in both callbacks is the same depth. I've posted an example here: http://pastebin.com/VVZaTb5T to demonstrate this.

> unlikely though.
> I know that this is unavoidable since Java does not have real
> continuations, but if that's the acceptable tradeoff then we might as well
> just pull a Thread from an arbitrary pool, note that in the dispatcher and
> do any channel ops. Any callbacks from a consumer on that thread should
> now be able to re-enter the dispatcher. When all is done just clear the
> current thread from the dispatcher and pop out.
> That way we can have a freely configurable ExecutorService and less
> threads with no deadlock on callback.

I've managed to convince myself that given the ExecutorService abstraction, it is simply not really feasible to allow for an arbitrary ExecutorService to be injected. I've written a bit about this in a past post, but looking back it wasn't all that clear or detailed. Hopefully you can forgive the detail that is about to spew forth :)

Most importantly we should agree on some constraints:

1. Dispatches to Consumers should happen in the order they arrive at the Connection
2. Completion of dispatch to a given Consumer should happen-before the start of subsequent dispatch to that Consumer (this implies an as-if-serial execution for dispatches to a Consumer)

It's also important to remember the limitations of the ExecutorService abstraction. In the general case, the size of the thread pool is neither fixed nor known to the outside world. As such, the usage model tends to be to submit one Runnable per discrete task, rather than one Runnable per thread (because we don't know how many threads there are).

This maps to submitting one task per dispatch to the ExecutorService. There are two problems with this. Firstly, there is the matter of enforcing constraint 2. We must lock each Consumer so that we can only dispatch one callback at a time. If the ES queue has n tasks for Consumer a at the front of its work queue, and n is greater than the number of threads, then the ES will stall and other, potentially executable, callbacks will sit in the queue.

Secondly, is the issue of enforcing ordering. Consider 2 callbacks c1 and c2, both for the same Consumer. The ES queue is [c1,c2]. The ES has 2 threads. Both threads can execute, one picking c1 and the other c2. The ExecutorService alone _does not_ provide guarantees as to the execution order here. To do this, we could give each callback a sequence number and ensure that only the next callback in sequence can proceed. This is not too simple. A typical wait/notify solution here can churn for some time when there are many callbacks all vying to execute.

The real solution to ordering is to actually schedule a proxy task in the ES for each dispatcher, and maintain a queue of callbacks. When a proxy executes, it reserves the dispatcher, executes the head of the queue and unreserves the dispatcher. This works for ordering guarantees but doesn't prevent stalls. To prevent stalls, we need to introduce some kind of context stealing, and this is quite a meaty thing to do correctly.

None of this is insurmountable, but I'd love to see a real scenario where it would make a difference worth the effort and pain to implement.

I hope this makes sense. if you think I'm over thinking this or that there is a glaringly simple solution that I'm missing please do say. I'd love to be able to make the ExecutorService configurable in a safe and predictable fashion.

Rob

> 
> I should probably add that I just made that up and haven't tested it yet,
> but maybe you find the idea interesting. :-)
> 
> -h
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mlong at crocodoc.com  Thu Oct 14 23:19:40 2010
From: mlong at crocodoc.com (Matt Long)
Date: Thu, 14 Oct 2010 18:19:40 -0400
Subject: [rabbitmq-discuss] rabbitmq beginner,
 cannot start rabbitmq/cannot get status
In-Reply-To: <4CB76ACF.1060601@rabbitmq.com>
References: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>
	<4CB76ACF.1060601@rabbitmq.com>
Message-ID: <AANLkTimH8PbOPALa-bN-FgN8ecQWt2iYV46=snqOP85K@mail.gmail.com>

adding the following line to /etc/hosts worked. Can anyone suggest a way to
have something similar done automatically via a customized AMI?

127.0.0.1    ip-10-100-100-200

Thanks,
Matt

On Thu, Oct 14, 2010 at 4:40 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Matt,
>
> Matt Long wrote:
>
>> after I reboot the EC2 instance and ssh back in, I get this when trying to
>> check the status:
>>
>> $ sudo rabbitmqctl status
>>
>> Status of node 'rabbit at ip-10-100-100-200' ...
>> Error: unable to connect to node 'rabbit at ip-10-100-100-200': nodedown
>> diagnostics:
>> - unable to connect to epmd on ip-10-100-100-200: address
>>
>
> That last line indicates that rabbitmqctl was unable to resolve
> ip-10-100-100-200 to an IP address.
>
>
> Matthias.
>



-- 
Matt Long
Lead Developer
617-329-1001
crocodoc.com
webnotes.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101014/946c6196/attachment.htm>

From dbecker at cpicorp.com  Fri Oct 15 00:20:02 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Thu, 14 Oct 2010 18:20:02 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
Message-ID: <4CB79022.1010407@cpicorp.com>

At my company we're taking a serious look at using AMQP to unify our
communications between various apps and sites (about 3000 locations in a
hub and spoke topology). Volume will be relatively low, but some of our
apps have requirements on delivery guarantees which we've worked hard to
meet by designing our own protocols and error handling in the past. One
of our goals here is to actually reduce the amount of error handling we
have to do for each app, so the delivery guarantees of AMQP are
important to us.

Of all of the brokers we've looked at, RabbitMQ seems the most
functional and most mature, but the lack of replicated queues is
problematic for us because the hardware that will be running the broker
in our locations is COTS non-enterprise-grade stuff (just the nature of
our business). To pile on to the issue, we're running Windows (ugh) so a
nice, simple solution like DRBD is ruled out.

We don't need HA or real-time failover, we just need to make sure that
persistent messages get stored on the broker and backed up somewhere
else so that if the broker server goes belly up we can somehow restore
what was in the queue at the time that the server failed. Server
failures happen regularly enough at our remote sites that we'd like a
backup, and we're prepared to deal with a complete loss of the data if
we lose both the server and its backup at the same time, but having a
backup of the data would allow us to save a significant amount of effort
for the common case.

I've been digging through the site (and even the source) to see what
options we might have. The fact that we're running this on Windows (not
my choice) seems to put us in a very small minority, so really I'm
looking for any kind of advice on how we might be able to pull this off.
I've seen some mention of replaying transaction logs in the mailing list
archives but I can't seem to find any real details on what they or how
to use them.

I'm hoping that somehow this is possible to accomplish because the
alternatives mean a lot more work for us :(

Thanks,

Derek

From sameek at arosys.com  Fri Oct 15 05:24:23 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 14 Oct 2010 21:24:23 -0700 (PDT)
Subject: [rabbitmq-discuss] another approach to retrieve message from
 queue?
In-Reply-To: <5AB3822A-43C2-44EB-9834-65EC2B5E2659@rabbitmq.com>
References: <29959643.post@talk.nabble.com>
	<5AB3822A-43C2-44EB-9834-65EC2B5E2659@rabbitmq.com>
Message-ID: <29968590.post@talk.nabble.com>


Thanks for reply.i tried that code code but it read queue only once time when
another message come it's not show next message it only show old message
repeatedly.please guide me where i am doing mistake.
http://old.nabble.com/file/p29968590/Result.java Result.java 


Rob Harrop-5 wrote:
> 
> Using Channel.basicConsume along with QueueingConsumer (or another
> implementation of Consumer) is what I would recommend.
> 
> If you want to just grab a message of the queue as a one-shot action then
> you can use Channel.basicGet:
> 
> GetResponse r = channel.basicGet("thequeue", true); // note use of noAck =
> true
> 
> if(r != null) {
>  // got a message
>  byte[] contents = r.getBody();
>  doSomethingWithBody(r);
> }
> 
> Note the null check - this is important. Channel.basicGet does not block
> until a message becomes available, instead it just returns null if there
> is no message.
> 
> Hope this helps,
> 
> Rob
> 
> On 14 Oct 2010, at 07:35, sam_mis wrote:
> 
>> 
>> Hi
>> 
>> i am using the following code to read an queue and extract the messages
>> from
>> queue. I want to know that there is another approach to retrieve message
>> from queue? if there is another approach please describe the details
>> information to get the messages from queue. 
>> 
>> while (runInfinite)
>> {
>>     QueueingConsumer.Delivery delivery;
>>            try
>>            {
>>              delivery = consumer.nextDelivery();
>>            } catch (InterruptedException ie)
>>            {
>>               continue;
>>            }
>>         System.out.println("Message received-"
>> + new String(delivery.getBody()));
>> 
>> file included that contain the  code for reading and extracting message:
>> --------------------------------------------------------------------------
>> http://old.nabble.com/file/p29959643/Result.java Result.java 
>> 
>> Thanks
>> 
>> -- 
>> View this message in context:
>> http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29968590.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rob at rabbitmq.com  Fri Oct 15 06:50:11 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 15 Oct 2010 06:50:11 +0100
Subject: [rabbitmq-discuss] another approach to retrieve message from
	queue?
In-Reply-To: <29968590.post@talk.nabble.com>
References: <29959643.post@talk.nabble.com>
	<5AB3822A-43C2-44EB-9834-65EC2B5E2659@rabbitmq.com>
	<29968590.post@talk.nabble.com>
Message-ID: <4D07F7D2-1457-4CD0-A4D7-34861D8E6768@rabbitmq.com>

I think the issue here is that you have noAck=true and you're calling basicAck. There was a mistake in my initial reply and I'm not sure if you saw my follow up.

You need to call basicGet with noAck=false if you're using basicAck.

Rob





On 15 Oct 2010, at 05:24, sam_mis <sameek at arosys.com> wrote:

> 
> Thanks for reply.i tried that code code but it read queue only once time when
> another message come it's not show next message it only show old message
> repeatedly.please guide me where i am doing mistake.
> http://old.nabble.com/file/p29968590/Result.java Result.java 
> 
> 
> Rob Harrop-5 wrote:
>> 
>> Using Channel.basicConsume along with QueueingConsumer (or another
>> implementation of Consumer) is what I would recommend.
>> 
>> If you want to just grab a message of the queue as a one-shot action then
>> you can use Channel.basicGet:
>> 
>> GetResponse r = channel.basicGet("thequeue", true); // note use of noAck =
>> true
>> 
>> if(r != null) {
>> // got a message
>> byte[] contents = r.getBody();
>> doSomethingWithBody(r);
>> }
>> 
>> Note the null check - this is important. Channel.basicGet does not block
>> until a message becomes available, instead it just returns null if there
>> is no message.
>> 
>> Hope this helps,
>> 
>> Rob
>> 
>> On 14 Oct 2010, at 07:35, sam_mis wrote:
>> 
>>> 
>>> Hi
>>> 
>>> i am using the following code to read an queue and extract the messages
>>> from
>>> queue. I want to know that there is another approach to retrieve message
>>> from queue? if there is another approach please describe the details
>>> information to get the messages from queue. 
>>> 
>>> while (runInfinite)
>>> {
>>>    QueueingConsumer.Delivery delivery;
>>>           try
>>>           {
>>>             delivery = consumer.nextDelivery();
>>>           } catch (InterruptedException ie)
>>>           {
>>>              continue;
>>>           }
>>>        System.out.println("Message received-"
>>> + new String(delivery.getBody()));
>>> 
>>> file included that contain the  code for reading and extracting message:
>>> --------------------------------------------------------------------------
>>> http://old.nabble.com/file/p29959643/Result.java Result.java 
>>> 
>>> Thanks
>>> 
>>> -- 
>>> View this message in context:
>>> http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29959643.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/another-approach-to-retrieve-message-from-queue--tp29959643p29968590.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From abarea at tid.es  Fri Oct 15 09:36:23 2010
From: abarea at tid.es (ALBERT HIDALGO BAREA)
Date: Fri, 15 Oct 2010 10:36:23 +0200
Subject: [rabbitmq-discuss] RabbitMQ JSONRPC-CHANNEL Error
Message-ID: <6D466181A86F4042896593D8F56C32624A44048FAA@EXCLU2K7.hi.inet>

Hello,

I'm trying to test the plugin jsonrpc-channel and it only gets errors.
I have search Google looking for solutions, but I didn't find any.

Configuration of the machine:
                Red Hat 5.3 EL
                RabbitMQ server 2.1.0
                Erlang R13B-03
                Project-umbrella latest release (compiled and running the broker through the plugin folder like says the README of the jsonrpc-channel plugin)

Post of the error:

test_main
{"installGenericProxy":{"name":"open","idempotent":false,"params":[{"name":"username","type":"str"},{"name":"password","type":"str"},{"name":"sessionTimeout","type":"num"},{"name":"virtualHost","type":"str"}]}}
open
JsonRPC error:
Service: "/rpc/rabbitmq"
Method: "open"
Params: ["guest","guest",5,null]
Response: {"version":"1.1","id":2,"error":{"name":"JSONRPCError","code":500,"message":"Internal error","error":"{{{badmatch,
      {error,
          {undef,
              [{rabbit_channel,start_link,
                   [rabbit_jsonrpc_channel,<0.17653.0>,<0.17653.0>,
                    <<\"guest\">>,<<\"/\">>,<0.17654.0>]},
               {rabbit_jsonrpc_channel,init,1},
               {gen_server,init_it,6},
               {proc_lib,init_p_do_apply,3}]}}},
  [{rabbit_jsonrpc_channel,open,1},
   {rabbit_jsonrpc_channel_factory,handle_call,3},
   {gen_server,handle_msg,5},
   {proc_lib,init_p_do_apply,3}]},
 {gen_server,call,
     [<0.2478.0>,
      {jsonrpc,<<\"open\">>,
          {obj,
              [{\"http_method\",<<\"POST\">>},
               {\"http_query_parameters\",{obj,[]}},
               {\"http_headers\",
                {obj,
                    [{\"accept\",<<\"*/*\">>},
                     {\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
                     {\"accept-encoding\",<<\"gzip,deflate\">>},
                     {\"accept-language\",<<\"en-us,en;q=0.5\">>},
                     {\"cache-control\",<<\"no-cache\">>},
                     {\"connection\",<<\"keep-alive\">>},
                     {\"content-length\",<<\"74\">>},
                     {\"content-type\",<<\"application/json; charset=UTF-8\">>},
                     {\"host\",<<\"localhost:55672\">>},
                     {\"keep-alive\",<<\"115\">>},
                     {\"pragma\",<<\"no-cache\">>},
                     {\"referer\",
                      <<\"http://localhost:55672/rpc-examples/test/index.html\">>},
                     {\"user-agent\",
                      <<\"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10 ( .NET CLR 3.5.30729)\">>},
                     {\"x-json-rpc-timeout\",<<\"30000\">>},
                     {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
               {\"remote_peername\",<<\"10.95.110.157\">>},
               {\"scheme\",<<\"http\">>}]},
          [<<\"guest\">>,<<\"guest\">>,5,null]},
      30000]}}"}}

Thank you for the help.
Regards,
---
Albert

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101015/ecb5468d/attachment-0001.htm>

From mabrek at gmail.com  Fri Oct 15 10:03:21 2010
From: mabrek at gmail.com (mabrek)
Date: Fri, 15 Oct 2010 13:03:21 +0400
Subject: [rabbitmq-discuss] Java Client Changes
In-Reply-To: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>
References: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>
Message-ID: <4CB818D9.9020400@gmail.com>

On 10/12/2010 05:39 PM, Rob Harrop wrote:
> Summary of changes:
> 
> * Dispatch to consumers now happens on a separate thread from the Connection thread

Have you considered switching to NIO with one io-loop thread per connection/several connections?
Something like Netty or Apache Mina.

> * Each Channel has its own dispatch thread

It can result in creating too many threads.

> * Channels are safe for use from multiple threads (not suitable for heavy concurrent usage though)

Consider web appication scenario. It sends a message per incoming request. Requests are served from several threads (up to 100) with a heavy concurrency (hundreds requests per second). So application needs either thread-safe non-blocking publisher that is suitable for heavy concurrency or very light-weight non-thread-safe publisher that can be created per incoming request and deleted after use.

Regards,
Anton Lebedevich.

From matthew at rabbitmq.com  Fri Oct 15 10:20:26 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 15 Oct 2010 10:20:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ JSONRPC-CHANNEL Error
In-Reply-To: <6D466181A86F4042896593D8F56C32624A44048FAA@EXCLU2K7.hi.inet>
References: <6D466181A86F4042896593D8F56C32624A44048FAA@EXCLU2K7.hi.inet>
Message-ID: <20101015092026.GA11086@wellquite.org>

On Fri, Oct 15, 2010 at 10:36:23AM +0200, ALBERT HIDALGO BAREA wrote:
> Configuration of the machine:
>                 Red Hat 5.3 EL
>                 RabbitMQ server 2.1.0
>                 Erlang R13B-03
>                 Project-umbrella latest release (compiled and running the broker through the plugin folder like says the README of the jsonrpc-channel plugin)

>           {undef,
>               [{rabbit_channel,start_link,
>                    [rabbit_jsonrpc_channel,<0.17653.0>,<0.17653.0>,
>                     <<\"guest\">>,<<\"/\">>,<0.17654.0>]},

Yeah, channel:start_link is now a /7, not a /6, so something's a bit
wrong there - my guess is that in building the plugin, it's checked out
a copy of the server which is more up to date than the 2.1.0 that you've
got installed.

I'd suggest you just download the binary version of the plugin from
http://www.rabbitmq.com/plugins.html

Best wishes,

Matthew

From simon at rabbitmq.com  Fri Oct 15 10:48:49 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Oct 2010 10:48:49 +0100
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CB79022.1010407@cpicorp.com>
References: <4CB79022.1010407@cpicorp.com>
Message-ID: <4CB82381.1040302@rabbitmq.com>

On 15/10/10 00:20, Derek Chen-Becker wrote:
> At my company we're taking a serious look at using AMQP to unify our
> communications between various apps and sites (about 3000 locations in a
> hub and spoke topology). Volume will be relatively low, but some of our
> apps have requirements on delivery guarantees which we've worked hard to
> meet by designing our own protocols and error handling in the past. One
> of our goals here is to actually reduce the amount of error handling we
> have to do for each app, so the delivery guarantees of AMQP are
> important to us.
>
> Of all of the brokers we've looked at, RabbitMQ seems the most
> functional and most mature, but the lack of replicated queues is
> problematic for us because the hardware that will be running the broker
> in our locations is COTS non-enterprise-grade stuff (just the nature of
> our business). To pile on to the issue, we're running Windows (ugh) so a
> nice, simple solution like DRBD is ruled out.

So we're talking about active / passive here, right?

The real issue is that you need some sort of redundant, shared storage. 
Once you've got that, RabbitMQ will tolerate being killed on one machine 
with said storage and restarted on another one.

> We don't need HA or real-time failover, we just need to make sure that
> persistent messages get stored on the broker and backed up somewhere
> else so that if the broker server goes belly up we can somehow restore
> what was in the queue at the time that the server failed.

Ah, in that case you don't even need a backup broker (and hence shared 
storage). Just redundant storage. Is that practical?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From rob at rabbitmq.com  Fri Oct 15 11:00:41 2010
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 15 Oct 2010 11:00:41 +0100
Subject: [rabbitmq-discuss] Java Client Changes
In-Reply-To: <4CB818D9.9020400@gmail.com>
References: <BEFA34A0-2C8F-408C-A346-9097B4488C04@rabbitmq.com>
	<4CB818D9.9020400@gmail.com>
Message-ID: <09562139-91EE-404C-B1B0-53FF55F18DE7@rabbitmq.com>

On 15 Oct 2010, at 10:03, mabrek <mabrek at gmail.com> wrote:

> On 10/12/2010 05:39 PM, Rob Harrop wrote:
>> Summary of changes:
>> 
>> * Dispatch to consumers now happens on a separate thread from the Connection thread
> 
> Have you considered switching to NIO with one io-loop thread per connection/several connections?
> Something like Netty or Apache Mina.

We've been chewing over NIO a bit recently. It's possible that we'll switch over but currently I think 1 IO thread per connection is sufficient.

> 
>> * Each Channel has its own dispatch thread
> 
> It can result in creating too many threads.

This is bounded by the number of channels.

> 
>> * Channels are safe for use from multiple threads (not suitable for heavy concurrent usage though)
> 
> Consider web appication scenario. It sends a message per incoming request. Requests are served from several threads (up to 100) with a heavy concurrency (hundreds requests per second). So application needs either thread-safe non-blocking publisher that is suitable for heavy concurrency or very light-weight non-thread-safe publisher that can be created per incoming request and deleted after use.

Channels are pretty light to create. But I can certainly see a case where thread usage can go crazy.

I'm on vacation this weekend but I'm pondering a solution to general thread pooling that will allow for a pluggable ExecutorService. The solution I have in mind will guarantee per consumer ordering and is not susceptible to stalling.

> 
> Regards,
> Anton Lebedevich.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101015/d2021104/attachment.htm>

From larsw at kredinor.no  Fri Oct 15 11:58:08 2010
From: larsw at kredinor.no (Lars Wilhelmsen)
Date: Fri, 15 Oct 2010 12:58:08 +0200
Subject: [rabbitmq-discuss] Warnings on server startup
Message-ID: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>

Hi list,

I'm a RabbitMQ newbie with a fresh Erlang (5.8.1.1) and RabbitMQ (2.1.0) installation on my Win7-64 laptop.

When I start the server with rabbitmq-server.bat, it reports:

*WARNING* rabbit: Object code (delegate) out of date
*WARNING* rabbit: Object code (delegate_sup) out of date
*WARNING* rabbit: Object code (file_handle_cache) out of date
*WARNING* rabbit: Object code (gatherer) out of date
*WARNING* rabbit: Object code (pg_local) out of date
...... more more more ...
*WARNING* rabbit: Object code (tcp_client_sup) out of date
*WARNING* rabbit: Object code (tcp_listener) out of date
*WARNING* rabbit: Object code (tcp_listener_sup) out of date
*WARNING* rabbit: Object code (test_sup) out of date
*WARNING* rabbit: Object code (vm_memory_monitor) out of date
*WARNING* rabbit: Object code (worker_pool) out of date
*WARNING* rabbit: Object code (worker_pool_sup) out of date

What do I have to do to resolve these warnings? Can it be that RabbitMQ was built against an earlier version of Erlang (5.8.1 perhaps)
and because of that it reports the warnings?

Thanks in advance,

Lars Wilhelmsen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101015/ffda3611/attachment.htm>

From david at rabbitmq.com  Fri Oct 15 12:18:20 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 15 Oct 2010 12:18:20 +0100
Subject: [rabbitmq-discuss] Warnings on server startup
In-Reply-To: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>
	(Lars Wilhelmsen's message of "Fri, 15 Oct 2010 12:58:08 +0200")
References: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>
Message-ID: <yrv4cocav901v.fsf@dwragg.eng.vmware.com>

Hi Lars,

Lars Wilhelmsen <larsw at kredinor.no> writes:
> I'm a RabbitMQ newbie with a fresh Erlang (5.8.1.1) and RabbitMQ
> (2.1.0) installation on my Win7-64 laptop.
>
> When I start the server with rabbitmq-server.bat, it reports:
>
> *WARNING* rabbit: Object code (delegate) out of date
> [...]
> *WARNING* rabbit: Object code (worker_pool_sup) out of date
>
> What do I have to do to resolve these warnings?

I think these warnings result from you having erlang object code files
(.beam files) and erlang source code files (.erl files), and erlang
noticing that the source code files have been modified after the
corresponding object code files, therefore the object code files are out
of date.

I'm not sure what might have led up to this situation occuring for you -
it doesn't seem to have been reported before.  But deleting the source
files in rabbitmq_server-2.1.0\src should fix it - they are not required
for rabbitmq-server to function.

> Can it be that
> RabbitMQ was built against an earlier version of Erlang (5.8.1
> perhaps) and because of that it reports the warnings?

We always build RabbitMQ releases with quite an old version of erlang
anyway, in order to be able to run on a wide range of erlang releases.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jon.rowland at isam.com  Fri Oct 15 12:21:25 2010
From: jon.rowland at isam.com (Jon Rowland)
Date: Fri, 15 Oct 2010 06:21:25 -0500
Subject: [rabbitmq-discuss] Warnings on server startup
In-Reply-To: <yrv4cocav901v.fsf@dwragg.eng.vmware.com>
References: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>
	<yrv4cocav901v.fsf@dwragg.eng.vmware.com>
Message-ID: <985477893245CF449ABD4F01814A9FF65E773AF61D@34093-MBX-C06.mex07a.mlsrvr.com>

I had the same problem a month or so ago, see the thread "Plug-in out of date warnings when starting the RabbitMQ server on Windows".

I didn't manage to resolve (moved on to something else).

Regards,
Jon

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of David Wragg
Sent: 15 October 2010 12:18
To: Lars Wilhelmsen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Warnings on server startup

Hi Lars,

Lars Wilhelmsen <larsw at kredinor.no> writes:
> I'm a RabbitMQ newbie with a fresh Erlang (5.8.1.1) and RabbitMQ
> (2.1.0) installation on my Win7-64 laptop.
>
> When I start the server with rabbitmq-server.bat, it reports:
>
> *WARNING* rabbit: Object code (delegate) out of date
> [...]
> *WARNING* rabbit: Object code (worker_pool_sup) out of date
>
> What do I have to do to resolve these warnings?

I think these warnings result from you having erlang object code files
(.beam files) and erlang source code files (.erl files), and erlang
noticing that the source code files have been modified after the
corresponding object code files, therefore the object code files are out
of date.

I'm not sure what might have led up to this situation occuring for you -
it doesn't seem to have been reported before.  But deleting the source
files in rabbitmq_server-2.1.0\src should fix it - they are not required
for rabbitmq-server to function.

> Can it be that
> RabbitMQ was built against an earlier version of Erlang (5.8.1
> perhaps) and because of that it reports the warnings?

We always build RabbitMQ releases with quite an old version of erlang
anyway, in order to be able to run on a wide range of erlang releases.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Fri Oct 15 12:29:28 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 15 Oct 2010 12:29:28 +0100
Subject: [rabbitmq-discuss] Warnings on server startup
In-Reply-To: <985477893245CF449ABD4F01814A9FF65E773AF61D@34093-MBX-C06.mex07a.mlsrvr.com>
	(Jon Rowland's message of "Fri, 15 Oct 2010 06:21:25 -0500")
References: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>
	<yrv4cocav901v.fsf@dwragg.eng.vmware.com>
	<985477893245CF449ABD4F01814A9FF65E773AF61D@34093-MBX-C06.mex07a.mlsrvr.com>
Message-ID: <yrv4ck4lj8zjb.fsf@dwragg.eng.vmware.com>

Hi Jon,

Jon Rowland <jon.rowland at isam.com> writes:
> I had the same problem a month or so ago, see the thread "Plug-in out
> of date warnings when starting the RabbitMQ server on Windows".
>
> I didn't manage to resolve (moved on to something else).

Yes, I found your post when searching for other reports of Lars'
problem.

While the direct cause of the warning is the same, the context is a bit
different.  I'm not sure how Lars have triggered this warning, but it's
quite easy to propose a resolution for him.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Fri Oct 15 12:42:19 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 15 Oct 2010 12:42:19 +0100
Subject: [rabbitmq-discuss] rabbitmq beginner,
	cannot start rabbitmq/cannot get status
In-Reply-To: <AANLkTimH8PbOPALa-bN-FgN8ecQWt2iYV46=snqOP85K@mail.gmail.com>
	(Matt Long's message of "Thu, 14 Oct 2010 18:19:40 -0400")
References: <AANLkTim+QogntFqoRY_=e8+tpa7Ys45oxbiYT7=sE5uB@mail.gmail.com>
	<4CB76ACF.1060601@rabbitmq.com>
	<AANLkTimH8PbOPALa-bN-FgN8ecQWt2iYV46=snqOP85K@mail.gmail.com>
Message-ID: <yrv4cfww78yxw.fsf@dwragg.eng.vmware.com>

Hi Matt,

Matt Long <mlong at crocodoc.com> writes:
> adding the following line to /etc/hosts worked. Can anyone suggest a way to
> have something similar done automatically via a customized AMI?
>
> 127.0.0.1    ip-10-100-100-200

When you instantiate an AMI, you can supply a user-data file, and the
Ubuntu images will execute this as a shell script on startup.  You can
add commands into that file something like the following:

echo "HOSTNAME" > /etc/hostname
echo "127.0.0.1\tHOSTNAME" >> /etc/hosts
hostname --file /etc/hostname

Substitute a name of your choice for HOSTNAME, either manually or
automatically.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From larsw at kredinor.no  Fri Oct 15 12:47:30 2010
From: larsw at kredinor.no (Lars Wilhelmsen)
Date: Fri, 15 Oct 2010 13:47:30 +0200
Subject: [rabbitmq-discuss] Warnings on server startup
In-Reply-To: <yrv4cocav901v.fsf@dwragg.eng.vmware.com>
References: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34AD@MBX01.kredinor.no>
	<yrv4cocav901v.fsf@dwragg.eng.vmware.com>
Message-ID: <58EB0FC59535A343AE555A6794DA7FEF015BCF9B34C9@MBX01.kredinor.no>

Thanks David - I'll give it a try!

 --larsw

-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: 15. oktober 2010 13:18
To: Lars Wilhelmsen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Warnings on server startup

Hi Lars,

Lars Wilhelmsen <larsw at kredinor.no> writes:
> I'm a RabbitMQ newbie with a fresh Erlang (5.8.1.1) and RabbitMQ
> (2.1.0) installation on my Win7-64 laptop.
>
> When I start the server with rabbitmq-server.bat, it reports:
>
> *WARNING* rabbit: Object code (delegate) out of date [...]
> *WARNING* rabbit: Object code (worker_pool_sup) out of date
>
> What do I have to do to resolve these warnings?

I think these warnings result from you having erlang object code files (.beam files) and erlang source code files (.erl files), and erlang noticing that the source code files have been modified after the corresponding object code files, therefore the object code files are out of date.

I'm not sure what might have led up to this situation occuring for you - it doesn't seem to have been reported before.  But deleting the source files in rabbitmq_server-2.1.0\src should fix it - they are not required for rabbitmq-server to function.

> Can it be that
> RabbitMQ was built against an earlier version of Erlang (5.8.1
> perhaps) and because of that it reports the warnings?

We always build RabbitMQ releases with quite an old version of erlang anyway, in order to be able to run on a wide range of erlang releases.

David

--
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From dbecker at cpicorp.com  Fri Oct 15 15:08:39 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Fri, 15 Oct 2010 09:08:39 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CB82381.1040302@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
Message-ID: <4CB86067.2010902@cpicorp.com>

On 10/15/2010 04:48 AM, Simon MacMullen wrote:
>> We don't need HA or real-time failover, we just need to make sure that
>> persistent messages get stored on the broker and backed up somewhere
>> else so that if the broker server goes belly up we can somehow restore
>> what was in the queue at the time that the server failed.
> 
> Ah, in that case you don't even need a backup broker (and hence shared 
> storage). Just redundant storage. Is that practical?
> 

Basically, yes. Ideally, the broker would duplicate every file write
operation to a second location. It would be really nice if we could do
this with Mnesia, too, so that essentially we're getting a real-time
copy of state on a backup machine. If the primary machine went down I
would do the work of starting a new broker on the backup machine using
the redundant files. The only concern I have with this scenario is that
it sounds like RabbitMQ uses the node name to identify itself, so I
wasn't sure if that was configurable or if I could uses the hosts file
to fake it.

Like I said, if we weren't constrained to run on Windows I would just be
doing DRBD and this would all be fine, but the decision on OS was made a
long, long time ago and it's infeasible to change it now :(

Thanks,

Derek

From csharp4me at gmail.com  Fri Oct 15 17:22:11 2010
From: csharp4me at gmail.com (Dave Gorman)
Date: Fri, 15 Oct 2010 11:22:11 -0500
Subject: [rabbitmq-discuss] Publish while processing?
Message-ID: <AANLkTinDC+LMb4dgsDKtfEmO=PAZ0K_1h3BqK9rbOSLJ@mail.gmail.com>

I have a couple messaging scenarios I need help with...
1) I would like to have a subscriber listening to "raw" queue; then do some
preprocessing and publish a new message, such as "preprocessed" to the same
exchange.
2) I would also like to have a subscriber that would process and push to a
different exchange.

I noticed in the .Net Client User Guide that it says do not call
.basicPublish during a callback as it blocks threads.

using (IConnection conn = connectionFactory.CreateConnection())
{
    using (IModel model = conn.CreateModel())
    {
        var sub = new Subscription(model, "rtls");
        foreach (BasicDeliverEventArgs iter in sub)
        {
            var message = System.Text.Encoding.UTF8.GetString(iter.Body);
            //want to crunch and publish to different exchange or same
exchange
            //  ***.BasicPublish(...);

            sub.Ack(iter);
        }

    }
}

I would like to successfully process and publish the new message before I
send the ack() on the original message; just so I'm sure every message is
processed.

Is this the proper way to process or will that cause threading issues?

Thank you,
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101015/838fe8f2/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Oct 15 18:41:30 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Oct 2010 18:41:30 +0100
Subject: [rabbitmq-discuss] the productivity of RabbitMQ
In-Reply-To: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>
References: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>
Message-ID: <4CB8924A.5090908@rabbitmq.com>

Alexandre,

On 14/10/10 20:44, Alexandre Kalendarev wrote:
> I make some test and was surprised: I have the cons 256 byte message
> len and publish the message to broker at localhost by fanout.
>
> I have the 8-9 Kqps.
>
> I make consume one clitnt and had 2-5K qps.
>
> Haw I can increase productivity?

I get about 18kHz end-to-end on my desktop machine, publishing and 
consuming at the same rate, using the Java client's MulticastMain 
example program with a message size of 256 bytes. And that's using just 
4 of the 8 cores.

What message rates are you hoping to achieve?

What client library are you using?

How are you consuming messages? basic.consume is faster than basic.ack.

Are you marking messages as persistent? non-persistent messages can be 
processed at higher rates.


Regards,

Matthias.

From simon at rabbitmq.com  Fri Oct 15 19:14:33 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Oct 2010 19:14:33 +0100
Subject: [rabbitmq-discuss] the productivity of RabbitMQ
In-Reply-To: <4CB8924A.5090908@rabbitmq.com>
References: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>
	<4CB8924A.5090908@rabbitmq.com>
Message-ID: <4CB89A09.6070301@rabbitmq.com>

On 15/10/2010 6:41PM, Matthias Radestock wrote:
> How are you consuming messages? basic.consume is faster than basic.ack.

I assume you mean basic.get :)

Cheers, Simon

From ian.ragsdale at gmail.com  Fri Oct 15 23:44:16 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Fri, 15 Oct 2010 17:44:16 -0500
Subject: [rabbitmq-discuss] management plugin missing queue details (on
	version 2.1.0)
Message-ID: <9249B239-BCB8-4BC3-B697-E9C770D763DA@gmail.com>

Hello all, I'm seeing a strange issue with the management plugin (version 2.1.0) on a fresh install of the official 2.1.0 package on ubuntu 10.0.4.  

In the API (and the UI) some of my queues show up without entries for number of consumers or messages.  Some queues contain this information, some don't - those details just don't exist in the JSON. 
I also see the exact same thing running on Mac OS 10.6.  Other than that, the queues work fine, I just can't retrieve that information via the API.

Any suggestions for how to debug?

Thanks,
Ian



From manishtpatel at yahoo.com  Sat Oct 16 01:46:38 2010
From: manishtpatel at yahoo.com (mamu)
Date: Fri, 15 Oct 2010 17:46:38 -0700 (PDT)
Subject: [rabbitmq-discuss]  WCF Do not act if failed to process
Message-ID: <29976517.post@talk.nabble.com>


WCF client library act's as soon as it read message from queue. Below is line
called as soon as message got read from queue.

                m_messageQueue.Model.BasicAck(msg.DeliveryTag, false);

It is going to call service after message is removed from rabbitmq, and if
service has some component down it's going to fail in executing actual
implementation in service.

I would like to change this behavior to like, call basicact only if message
was processed successfully by wcf service.

Any one could suggest how can i change rabbitmq wcf implementation to
achieve above? 


Also would like to hear you experience around handling above case.

-- 
View this message in context: http://old.nabble.com/WCF-Do-not-act-if-failed-to-process-tp29976517p29976517.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Sat Oct 16 10:00:50 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Oct 2010 10:00:50 +0100
Subject: [rabbitmq-discuss] the productivity of RabbitMQ
In-Reply-To: <E1P71sR-0001g3-00.akalend-mail-ru@f247.mail.ru>
References: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>
	<4CB8924A.5090908@rabbitmq.com>
	<E1P71sR-0001g3-00.akalend-mail-ru@f247.mail.ru>
Message-ID: <4CB969C2.6060207@rabbitmq.com>

Alexandre,

Alexandre Kalendarev wrote:
> My notebook have 2 core, 2.8 Mhz
> I use the rabbitmq-c client in my tests, so I make the tests for php
> client over rabbitmq-c . My system build by  PHP.
> I use basic.consume and basic.get
> I use the persisten message.
> 
>> What message rates are you hoping to achieve?
> I hope more or near 100K  rps for short messages (256 byte).

The only way to get that kind of rate with RabbitMQ on commodity 
hardware in a straight-through producer->exchange->queue->consumer 
scenario is to batch messages, i.e. send multiple application messages 
as a single AMQP message.


Regards,

Matthias.

From simon at rabbitmq.com  Sat Oct 16 12:02:34 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 16 Oct 2010 12:02:34 +0100
Subject: [rabbitmq-discuss] management plugin missing queue details (on
 version 2.1.0)
In-Reply-To: <9249B239-BCB8-4BC3-B697-E9C770D763DA@gmail.com>
References: <9249B239-BCB8-4BC3-B697-E9C770D763DA@gmail.com>
Message-ID: <4CB9864A.8040009@rabbitmq.com>

On 15/10/2010 11:44PM, Ian Ragsdale wrote:
 > In the API (and the UI) some of my queues show up without entries for
 > number of consumers or messages.  Some queues contain this
 > information, some don't - those details just don't exist in the
 > JSON. I also see the exact same thing running on Mac OS 10.6.  Other
 > than that, the queues work fine, I just can't retrieve that
 > information via the API.

Hi Ian. It's a known bug in 2.1.0 - the information is missing in queues 
that have been through a broker restart and been inactive since. The fix 
is in Mercurial and will be in the next release.

Cheers, Simon

From johndapps at gmail.com  Sat Oct 16 15:27:56 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:27:56 +0200
Subject: [rabbitmq-discuss] [Ticket #7] rabbitmqctl often hangs at the end
	of a query, e.g., list_queu...
Message-ID: <4cb9b66c7c6ad_191838afdba984@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/7
Ticket: # 7
Submitted: Oct 16, 2010 @ 04:27 pm
Summary: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a query, e.g., list_queu...
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
John,

John Apps wrote:
> Whilst not being a bug per se, it is annoying behaviour when rabbitmqctl 
> 'sits there' for quite some time.

How long is 'quite some time'?

And what rabbitmqctl command were you trying to run? list_queues (as per 
the subject line)? If so, how many queues did you have at the time?

And when you say (in the subject line) that rabbitmqctl hangs *at the 
end* of a query, do you mean it displays the results and *then* hangs?

> Interestingly enough, it does not accept <CTRL>C either.

I'll have to find a Windows machine to try to reproduce that.

Are you running the standard rabbitmqctl.bat script? In the other thread 
you posted some rabbitmqctl output which contained progress log 
information, which is not something we see in testing and for which the 
most plausible explanation is that some additional options have been 
passed to the erl executable.

> This wait is only encountered when activity is going on with
> RabbitMQ, no matter what it is.

So this only happens when rabbit is really busy?

Rabbit does prioritise handling of rabbitmqctl processing over most 
other tasks, but when the server is under heavy load it can still take 
some time to handle these requests. There is not much we can do about 
that really, since we wouldn't want to stop message processing altogether.


Regards,

Matthias.
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:28:25 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:28:25 +0200
Subject: [rabbitmq-discuss] [Ticket #7] New Comment: rabbitmqctl often hangs
	at the end of a query, e.g., list_queu...
Message-ID: <4cb9b6898e65c_191838afdba2334@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/7
Ticket: # 7
Submitted: Oct 16, 2010 @ 04:27 pm
Summary: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a query, e.g., list_queu...
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
John Apps said: Assigned to John Apps 
John Apps said: Matthias,
  I tried this out on another Windows 7 X64 machine I have and was unable to
reproduce the behaviour there. Rather than have this entry hang around,
please disregard for now.
When I have time I will pursue the matter and let you know what the cause
was.

Thank you for the support, John
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:05 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:05 +0200
Subject: [rabbitmq-discuss] [Ticket #15]  Disabling channel.flow
Message-ID: <4cb9b6b1b964a_191838afdba40c6@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/15
Ticket: # 15
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Disabling channel.flow
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
On Mon, Feb 1, 2010 at 3:47 PM, Matthew Sackman <matthew at lshift.net> wrote:
> Which version of Rabbit are you using? - the details for disabling
> memory monitoring have changed between 1.7.0 and 1.7.1.

I downloaded rabbitmq-public-umbrella using hg, the tip points to:

changeset:   44:259da26ec626
tag:         tip
parent:      43:0d8d8a6dddae
parent:      42:b08e26cc7170
user:        David Wragg <dpw at lshift.net>
date:        Mon Oct 05 13:03:37 2009 +0100
summary:     Merge bug21745 into default

I used hg to install stomp plugin also along with rabbit. I can always
try and install latest/other  versions if that helps.

> I advise against disabling memory monitoring. If you do disable it, and
> then Rabbit runs out of memory, Rabbit will crash, likely losing more
> messages.

I understand, but the flow control keeps hitting frequently enough to
make rabbit-stomp almost useless :( So far I have not been able to
exercise any sort of control over when the flow control kicks in. Is
it possible to know how much memory rabbit thinks it has and how much
more memory it can use before flow control kicks in?

I just want to make sure that flow control does not kick in too frequently.

with regards,

raj

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:17 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:17 +0200
Subject: [rabbitmq-discuss] [Ticket #16] messages get stuck when using
	rabbitmq on windows, but not on ...
Message-ID: <4cb9b6bde524d_191838afdba4681@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/16
Ticket: # 16
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] messages get stuck when using rabbitmq on windows, but not on ...
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
I'm experiencing a problem with messages getting "stalled" when serving
RabbitMQ with Windows XP.

The context is a distributed job processing system, wherein some message
payloads can be around 250-500 kB.  The clients connecting to the broker are
several programs written in Python using the txAMQP library and the AMQP 0-8
protocol.  (*)

We can submit one job in our system, which results in several small
messages, and four larger messages being routed through RabbitMQ with the
size ranges noted above, and this succeeds.  However, when we submit an
identical job, one message with a larger payload is successfully routed, but
the second one is not.  I can see that it successfully reaches the broker
but never reaches the intended destination, because I get this output:

C:\rabbitmq_server-1.7.1\sbin>rabbitmqctl list_connections send_oct
send_pend
Listing connections ...
594     0
1183650 0
236655  0
616     0
610     0
2492155 256809    <-- here is the stuck message
616     0
616     0
367     0


Configuration:
- rabbitmq 1.7.1 on Windows XP, installed from packages available at
rabbitmq.com
- (also exhibited problem with rabbitmq 1.6.0 on Windows XP)
- all clients running on Windows, OR some clients on Windows (required as
they call out to Windows executables) and some on OS X
- ***exhibits problems noted above***

Configuration:
- rabbitmq 1.7.0 on Mac OS X 10.6, installed via
http://github.com/mxcl/homebrew/blob/master/Library/Formula/rabbitmq.rb
- all clients running on Windows
- no problems exhibited; can run many jobs successfully

Configuration:
- rabbitmq 1.6.0 on Ubuntu 9.10, installed using official Ubuntu packages
- all clients running on Windows
- no problems exhibited; can run many jobs successfully


We would prefer to run RabbitMQ as a service on Windows, as we have more
combined experience with Windows administration, but if stumped we will
consider running RabbitMQ on a locked down Ubuntu VM.

If needed I can try to create and post a script that triggers this problem,
but I thought I'd post this first to see if anyone has experienced a similar
problem and can offer a potential solution, or other troubleshooting
techniques.


(*) These programs originally used py-amqplib, and experienced the same
problem, but were ported to txAMQP to see if that would fix the problem and
to also improve performance when the system is idle.  Unfortunately while
the system performance improved, the problem with RabbitMQ on Windows still
persists.


-- 
Matthew Scott
ElevenCraft Inc.
+1 360 389-2512
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:09 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:09 +0200
Subject: [rabbitmq-discuss] [Ticket #15] New Comment: Disabling channel.flow
Message-ID: <4cb9b6b59d2a7_191838afdba423c@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/15
Ticket: # 15
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Disabling channel.flow
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
matthew at lshift.net said: Hi,
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:35 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:35 +0200
Subject: [rabbitmq-discuss] [Ticket #17] New Comment: Simple client/server
	running on different OS are lagging
Message-ID: <4cb9b6cf74ca5_191838afdba5451@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/17
Ticket: # 17
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Simple client/server running on different OS are lagging
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
matthew at lshift.net said: Hi Frank,

Not really too sure what to suggest, but others on the list have
reported better throughput when increasing buffers in Rabbit:

Vladimir Balandin wrote:
> We have fixed the problem by set send/receive buffers on server side.
> 
> -kernel inet_default_listen_options
> [{nodelay,true},{sndbuf,65535},{recbuf,65535}]

The easiest way to set these is to edit rabbitmq-server(.bat) directly -
these values are set near the top of rabbitmq-server and near the bottom
of rabbitmq-server.bat.

That may or may not solve these issues, but it's certainly worth trying.
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:31 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:31 +0200
Subject: [rabbitmq-discuss] [Ticket #17] Simple client/server running on
	different OS are lagging
Message-ID: <4cb9b6cbb733b_191838afdba5262@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/17
Ticket: # 17
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Simple client/server running on different OS are lagging
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
Hello,

 

I am facing a strange issue with the Rabbitmq environment.

I try to run two simple processes written in Python (with amqplib): One
publisher and one subscriber.

The publisher is publishing a 10Meg data (not exactly 10Meg but
10,000,000 * 'A') and the subscriber is receiving it.

When all these three processes (including rabbitmq) are running under
the same OS  (not especially the same computer but the same OS),
everything is working correctly but when one of them is running on a
different OS, it is lagging a lot.

Hereunder is a king of matrix giving you a rough idea of what is
happening:

 

-          Publisher-OS: WIN ; RabbitMQ-OS: WIN ; Subscriber-OS: WIN =>
OK (less than a sec for the transfert)

-          Publisher-OS: WIN ; RabbitMQ-OS: WIN ; Subscriber-OS: LIN =>
NOK (Subscriber is lagging)

-          Publisher-OS: WIN ; RabbitMQ-OS: LIN ; Subscriber-OS: WIN =>
NOK (At least publisher is lagging - more than 4min to publish)

-          Publisher-OS: WIN ; RabbitMQ-OS: LIN ; Subscriber-OS: LIN =>
NOK (Publisher is lagging - more than 4min to publish)

-          Publisher-OS: LIN ; RabbitMQ-OS: WIN ; Subscriber-OS: WIN =>
NOK (Publisher is lagging - more than 4min to publish)

-          Publisher-OS: LIN ; RabbitMQ-OS: LIN ; Subscriber-OS: LIN =>
OK (less than a sec for the transfert)

-          ...

 

I am using RabbitMQ V1.7.0

 

Regards

Franck

 


######################################################################
The information contained in this communication is confidential and
may contain information that is privileged or exempt from disclosure
under applicable law. If you are not a named addressee, please notify
the sender immediately and delete this email from your system.
If you have received this communication, and are not a named
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
######################################################################
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:39 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:39 +0200
Subject: [rabbitmq-discuss] [Ticket #17] New Comment: Simple client/server
	running on different OS are lagging
Message-ID: <4cb9b6d33e97c_191838afdba56f7@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/17
Ticket: # 17
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Simple client/server running on different OS are lagging
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
matthew at lshift.net said: Hi Frank,

Not really too sure what to suggest, but others on the list have
reported better throughput when increasing buffers in Rabbit:

Vladimir Balandin wrote:
> We have fixed the problem by set send/receive buffers on server side.
> 
> -kernel inet_default_listen_options
> [{nodelay,true},{sndbuf,65535},{recbuf,65535}]

The easiest way to set these is to edit rabbitmq-server(.bat) directly -
these values are set near the top of rabbitmq-server and near the bottom
of rabbitmq-server.bat.

That may or may not solve these issues, but it's certainly worth trying. 
matthew at lshift.net said: Hi Frank,
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:54 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:54 +0200
Subject: [rabbitmq-discuss] [Ticket #17] New Comment: Simple client/server
	running on different OS are lagging
Message-ID: <4cb9b6e2a410d_191838afdba6221@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/17
Ticket: # 17
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Simple client/server running on different OS are lagging
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
matthew at lshift.net said: Hi Frank,

Not really too sure what to suggest, but others on the list have
reported better throughput when increasing buffers in Rabbit:

Vladimir Balandin wrote:
> We have fixed the problem by set send/receive buffers on server side.
> 
> -kernel inet_default_listen_options
> [{nodelay,true},{sndbuf,65535},{recbuf,65535}]

The easiest way to set these is to edit rabbitmq-server(.bat) directly -
these values are set near the top of rabbitmq-server and near the bottom
of rabbitmq-server.bat.

That may or may not solve these issues, but it's certainly worth trying. 
matthew at lshift.net said: Hi Frank, 
pradeep.gatram at gmail.com said: Franck,

Have you checked the timestamps of the involved machines? Sounds like a 4min
time difference between the two clocks.

Pradeep
www.masplantiz.com
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:29:59 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:29:59 +0200
Subject: [rabbitmq-discuss] [Ticket #19] Is there more infos about AMQP 1.0
	and rabbitmq roadmap toward...
Message-ID: <4cb9b6e7eaefb_191838afdba6538@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/19
Ticket: # 19
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] Is there more infos about AMQP 1.0 and rabbitmq roadmap toward...
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
Hi

On Wed, Feb 3, 2010 at 4:57 AM, techabc <techabc at gmail.com> wrote:
> AMQP 1.0 reached PR 2 stage, and what plans after that?

The plan is to develop 1.0 to a "recommended" or "Commitee Draft"
spec, after which full AMQP 1.0 broker implementations should be
developed.  When two independent, proven conformant and interoperable
broker implementations exist, then 1.0 can be declared "final".
Changes *may* occur between "Commitee Draft" and "final" but they
should be *minor*.

See: http://www.amqp.org/confluence/display/AMQP/AMQP1.0+SIG


> When final release?

We hope all the spec releases can be in 2010.  Obviously "final" is
contingent on seeing proven broker interop and conformance.  We
wouldn't want to rush that and mess it up.  So that may be a practical
factor in slowing things down.  But, in my personal view, the major
spec to keep an eye on is the *next* release aka "Commitee Draft".


> According to the amqp bussiness requrement, must be 1.0 final after a
> few implementations finished

Yes.  To be precise: "The Committee Draft will only be promoted to
AMQP 1.0 Final once two materially independent implementations have
been developed and demonstrated to interoperate."


> rabbitmq ready for it?

We are at least as ready as anyone else is.

alexis



>
> best regards,
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:30:55 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:30:55 +0200
Subject: [rabbitmq-discuss] [Ticket #16] New Comment: messages get stuck
	when using rabbitmq on windows, but not on ...
Message-ID: <4cb9b71f39bd_191838afdba94c0@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/16
Ticket: # 16
Submitted: Oct 16, 2010 @ 04:29 pm
Summary: [rabbitmq-discuss] messages get stuck when using rabbitmq on windows, but not on ...
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
matthias at lshift.net said: Matthew,

Matthew Scott wrote:
> I'm experiencing a problem with messages getting "stalled" when serving 
> RabbitMQ with Windows XP.
> 
> The context is a distributed job processing system, wherein some message 
> payloads can be around 250-500 kB.  The clients connecting to the broker 
> are several programs written in Python using the txAMQP library and the 
> AMQP 0-8 protocol.  (*)
> 
> We can submit one job in our system, which results in several small 
> messages, and four larger messages being routed through RabbitMQ with 
> the size ranges noted above, and this succeeds.  However, when we submit 
> an identical job, one message with a larger payload is successfully 
> routed, but the second one is not.  I can see that it successfully 
> reaches the broker but never reaches the intended destination, because I 
> get this output:
> 
> C:\rabbitmq_server-1.7.1\sbin>rabbitmqctl list_connections send_oct 
> send_pend
> Listing connections ...
> 594     0
> 1183650 0
> 236655  0
> 616     0
> 610     0
> 2492155 256809    <-- here is the stuck message
> 616     0
> 616     0
> 367     0

On the surface this does look like a client problem, namely that for
some reason the client has stopped reading data from the socket, causing
the tcp flow control to stall the connection and thus data backing up in
the server's tcp buffers.

It could also be some weird networking problem in the O/S.

I suggest sticking the AMQP tracer
(http://www.rabbitmq.com/examples.html#tracer) inbetween the broker and
the client, running it on either the client or server machine (it's
worth trying both options). That will tell you what's going on at the
AMQP protocol level. If you need help interpreting the output, feel free
to post it here.

It's possible that inserting the tracer alters the behaviour, and
"fixes" the problem. If so then a lower-level tool to capture the
network traffic, such as wireshark, is your best bet.


Regards,

Matthias.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:31:00 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:31:00 +0200
Subject: [rabbitmq-discuss] [Ticket #23]  Monitoring Message Throughput
Message-ID: <4cb9b72465dff_191838afdba974b@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/23
Ticket: # 23
Submitted: Oct 16, 2010 @ 04:30 pm
Summary: [rabbitmq-discuss] Monitoring Message Throughput
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
Nico,

Nico Meyer wrote:
> are there any good solutions to monitor the message throughput of
> RabbitMQ? Preferably broken down by queues. I have quickly checked the
> monitoring solutions on the webpage, but none seem to have that feature.
> Also there is probably not enough data exported by RabbitMQ to do this.

The closest you can get at the moment is the various socket stats 
reported by 'rabbitmqctl list_connections', but that is clearly quite a 
long way from per-queue message throughput stats.

We will add more stats (and more ways of getting at them) in the future, 
so your input is appreciated in defining what exactly it is that you and 
other users are looking for. So, regarding your specific request ...

By "throughput" do you mean:
- rate at which messages are enqueued?
- rate at which messages are dequeued?

If it's "messages enqueued", what happens to messages that are part of a 
transaction? Are they included in the figure immediately or only when 
the tx has committed?

If it's "messages dequeued", what happens to message redeliveries (e.g. 
when a message has been delivered but then the client disconnected w/o 
acking them and the message is subsequently redelivered to another 
client)? Are they included in the figure?

Also,
- are you interested in message counts, i.e. messages per second, or 
data volumes, i.e. octets per second?
- over what period of time should the figures be averaged?
- do the stats of a durable queue need to survive a broker restart?
- do the stats still need to be accessible after a queue has been deleted?
- what stats other than per-queue throughputs would you like to see?

I realise these are a lot of questions. But answering them will help us 
shape our future stats architecture.


Regards,

Matthias.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:31:11 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:31:11 +0200
Subject: [rabbitmq-discuss] [Ticket #23] New Comment: Monitoring Message
	Throughput
Message-ID: <4cb9b72fd0131_191838afdba1032a@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/23
Ticket: # 23
Submitted: Oct 16, 2010 @ 04:30 pm
Summary: [rabbitmq-discuss] Monitoring Message Throughput
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
gmr at myyearbook.com said: Hey Matthias, 
g at rre.tt said: No Comment
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:31:06 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:31:06 +0200
Subject: [rabbitmq-discuss] [Ticket #23] New Comment: Monitoring Message
	Throughput
Message-ID: <4cb9b72a2ec52_191838afdba100b6@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/23
Ticket: # 23
Submitted: Oct 16, 2010 @ 04:30 pm
Summary: [rabbitmq-discuss] Monitoring Message Throughput
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
gmr at myyearbook.com said: Hey Matthias,
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:31:36 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:31:36 +0200
Subject: [rabbitmq-discuss] [Ticket #25]  Controlling queue size
Message-ID: <4cb9b748b419a_191838afdba11527@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/25
Ticket: # 25
Submitted: Oct 16, 2010 @ 04:31 pm
Summary: [rabbitmq-discuss] Controlling queue size
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
Gustavo,

On Tue, Feb 9, 2010 at 10:42 PM, Gustavo Aquino
<aquino.gustavo at gmail.com> wrote:
> Jeremy,
> Thanks, but I need another way to control the queue size,  I'm very scared
> with memory limitation in RabbitMQ. I'm doing some testes and all the time
> that RabbitMQ consume all server's memory, caused by one producer without
> consumer, it crashes. Therefore we need a way to monitoring this or one
> configuration that solve it, I would prefer a solution to put a limitation
> by server side, persisting this message on disk, or reject message, or other
> algorithm while memory still full that don't crash server.

There is more info about channel.flow here:
http://www.rabbitmq.com/extensions.html

This should give you a way to monitor memory use and tell producers to back off.




> Some queues can loose messages, but others can't loose about that I'm trying
> to found some solutions to cover this problem.

Can you describe what you are doing in more detail?

That will help us address your problem and (I hope) help you fix them.

alexis




> Regards.
>
> On Tue, Feb 9, 2010 at 7:51 PM, Jeremy Dunck <jdunck at gmail.com> wrote:
>>
>> This might help:
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003317.html
>>
>> On Tue, Feb 9, 2010 at 3:31 PM, Gustavo Aquino <aquino.gustavo at gmail.com>
>> wrote:
>> > Anybody ?
>> >
>> > On Tue, Feb 9, 2010 at 10:46 AM, Gustavo Aquino
>> > <aquino.gustavo at gmail.com>
>> > wrote:
>> >>
>> >> Hi,
>> >> I would like to control my queue size, due to the fact that RabbitMQ
>> >> crash
>> >> if you don't consume queue and continuing posting messages.
>> >> RabbitMQ can control queue size by reject, disk, old messages...... etc
>> >> ?
>> >> Regards.
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:31:43 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:31:43 +0200
Subject: [rabbitmq-discuss] [Ticket #23] New Comment: Monitoring Message
	Throughput
Message-ID: <4cb9b74feff3a_191838afdba1184a@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/23
Ticket: # 23
Submitted: Oct 16, 2010 @ 04:30 pm
Summary: [rabbitmq-discuss] Monitoring Message Throughput
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
gmr at myyearbook.com said: Hey Matthias, 
g at rre.tt said: No Comment 
mtodd at highgroove.com said: I agree with both Garrett and Gavin with some minor additions:

I think pure throughput should include messages failed to be ack'd and
having to be resent since it is technically output. They could be reported
separately and combined manually for those that don't mind the difference.

I think it would be cool to see something similar to Unix load that reports
on the last minute averages, the last 5 minute's average, and the last 15
minute's average. But, this goes back to the discussion on counters and how
easy it is for us to do this on our end since many tools do this for us
already.

So, in this regard, it would be much more useful for the data to just be
handed back to us whenever we request it as a pure count. Let us do the
hard/interesting work of calculating averages over specific time intervals,
etc.

RE: throughput, I think we should show both enqueued and dequeued throughput
separately, but do definitely want to include both.

Matt
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:32:12 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:32:12 +0200
Subject: [rabbitmq-discuss] [Ticket #23] New Comment: Monitoring Message
	Throughput
Message-ID: <4cb9b76c16412_191838afdba1325d@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/23
Ticket: # 23
Submitted: Oct 16, 2010 @ 04:30 pm
Summary: [rabbitmq-discuss] Monitoring Message Throughput
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
g at rre.tt said: No Comment 
mtodd at highgroove.com said: I agree with both Garrett and Gavin with some minor additions:

I think pure throughput should include messages failed to be ack'd and
having to be resent since it is technically output. They could be reported
separately and combined manually for those that don't mind the difference.

I think it would be cool to see something similar to Unix load that reports
on the last minute averages, the last 5 minute's average, and the last 15
minute's average. But, this goes back to the discussion on counters and how
easy it is for us to do this on our end since many tools do this for us
already.

So, in this regard, it would be much more useful for the data to just be
handed back to us whenever we request it as a pure count. Let us do the
hard/interesting work of calculating averages over specific time intervals,
etc.

RE: throughput, I think we should show both enqueued and dequeued throughput
separately, but do definitely want to include both.

Matt 
matthew at lshift.net said: No Comment
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:37:31 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:37:31 +0200
Subject: [rabbitmq-discuss] [Ticket #65] rabbitmqctl often hangs at the end
	of a query, e.g., list_queu...
Message-ID: <4cb9b8ab7edaa_bc42dc2ede438@BIGPOOH.tmail>

This is a notification from the Help Desk.


Your ticket has been submitted.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/65
Ticket: # 65
Submitted: Oct 16, 2010 @ 04:37 pm
Summary: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a query, e.g., list_queu...
Status: open
Priority: Med

Description:
----------------------------------------------------------------------------------------------------
John,

John Apps wrote:
> Whilst not being a bug per se, it is annoying behaviour when rabbitmqctl 
> 'sits there' for quite some time.

How long is 'quite some time'?

And what rabbitmqctl command were you trying to run? list_queues (as per 
the subject line)? If so, how many queues did you have at the time?

And when you say (in the subject line) that rabbitmqctl hangs *at the 
end* of a query, do you mean it displays the results and *then* hangs?

> Interestingly enough, it does not accept <CTRL>C either.

I'll have to find a Windows machine to try to reproduce that.

Are you running the standard rabbitmqctl.bat script? In the other thread 
you posted some rabbitmqctl output which contained progress log 
information, which is not something we see in testing and for which the 
most plausible explanation is that some additional options have been 
passed to the erl executable.

> This wait is only encountered when activity is going on with
> RabbitMQ, no matter what it is.

So this only happens when rabbit is really busy?

Rabbit does prioritise handling of rabbitmqctl processing over most 
other tasks, but when the server is under heavy load it can still take 
some time to handle these requests. There is not much we can do about 
that really, since we wouldn't want to stop message processing altogether.


Regards,

Matthias.
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From johndapps at gmail.com  Sat Oct 16 15:37:59 2010
From: johndapps at gmail.com (John Apps)
Date: Sat, 16 Oct 2010 16:37:59 +0200
Subject: [rabbitmq-discuss] [Ticket #7] New Comment: rabbitmqctl often hangs
	at the end of a query, e.g., list_queu...
Message-ID: <4cb9b8c7bbe02_bc42dc2ede18c4@BIGPOOH.tmail>

This is a notification from the Help Desk.


A new comment has been added.  Please reply to this email (keeping the subject intact) with any additional information or comments.

Help Desk: http://BIGPOOH:9675/portal/view-help-request/7
Ticket: # 7
Submitted: Oct 16, 2010 @ 04:27 pm
Summary: [rabbitmq-discuss] rabbitmqctl often hangs at the end of a query, e.g., list_queu...
Status: open
Priority: Med

Comment:
----------------------------------------------------------------------------------------------------
John Apps said: Assigned to John Apps 
John Apps said: Matthias,
  I tried this out on another Windows 7 X64 machine I have and was unable to
reproduce the behaviour there. Rather than have this entry hang around,
please disregard for now.
When I have time I will pursue the matter and let you know what the cause
was.

Thank you for the support, John 
John Apps said: Matthias,
  I tried this out on another Windows 7 X64 machine I have and was unable to
reproduce the behaviour there. Rather than have this entry hang around,
please disregard for now.
When I have time I will pursue the matter and let you know what the cause
was.

Thank you for the support, John
----------------------------------------------------------------------------------------------------
This is an automated message sent from your help desk.

From matthias at rabbitmq.com  Sat Oct 16 15:48:53 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Oct 2010 15:48:53 +0100
Subject: [rabbitmq-discuss] sorry for the spam
Message-ID: <4CB9BB55.1000904@rabbitmq.com>

Apologies for the recent deluge of issue tracker spam purporting to come 
from John Apps' email account. I have turned on the moderation flag for 
that subscriber now to stop any more of these emails from getting through.

Matthias.

From videlalvaro at gmail.com  Sat Oct 16 15:56:11 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 16 Oct 2010 22:56:11 +0800
Subject: [rabbitmq-discuss] sorry for the spam
In-Reply-To: <4CB9BB55.1000904@rabbitmq.com>
References: <4CB9BB55.1000904@rabbitmq.com>
Message-ID: <E27C9E9A-1C3B-4AE9-8292-FE6E1A6A9162@gmail.com>

Thanks :D
On Oct 16, 2010, at 10:48 PM, Matthias Radestock wrote:

> Apologies for the recent deluge of issue tracker spam purporting to come from John Apps' email account. I have turned on the moderation flag for that subscriber now to stop any more of these emails from getting through.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Sun Oct 17 09:07:33 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 17 Oct 2010 09:07:33 +0100
Subject: [rabbitmq-discuss] the productivity of RabbitMQ
In-Reply-To: <E1P7Nxp-0007tw-00.akalend-mail-ru@f159.mail.ru>
References: <E1P6TjL-00059c-00.akalend-mail-ru@f178.mail.ru>
	<4CB8924A.5090908@rabbitmq.com>
	<E1P7Nxp-0007tw-00.akalend-mail-ru@f159.mail.ru>
Message-ID: <4CBAAEC5.2000600@rabbitmq.com>

Alexandre,

Alexandre Kalendarev wrote:
>> I get about 18kHz end-to-end on my desktop machine, publishing and
>> 
> Is the 18kHZ = 18 k rps (request per sec)  for message 256  or
> accounting lenght message?

It is 18,000 messages with a payload of 256 bytes, being sent by a 
producer to RabbitMQ, routed to a queue, sent out to a consumer, and 
acknowledged by that consumer.


Matthias.
PS: please keep rabbitmq-discuss cc'ed on this thread.

From abarea at tid.es  Mon Oct 18 07:19:57 2010
From: abarea at tid.es (ALBERT HIDALGO BAREA)
Date: Mon, 18 Oct 2010 08:19:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ JSONRPC-CHANNEL Error
In-Reply-To: <20101015092026.GA11086@wellquite.org>
References: <6D466181A86F4042896593D8F56C32624A44048FAA@EXCLU2K7.hi.inet>
	<20101015092026.GA11086@wellquite.org>
Message-ID: <6D466181A86F4042896593D8F56C32624A44049032@EXCLU2K7.hi.inet>

Hi Matthew,

I tried on Friday, but also gave me the same problem as before.
If it is a general problem, I will wait until there is a new release of the RabbitMQ server or the JSONRPC-CHANNEL plugin.

Regards,


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: viernes, 15 de octubre de 2010 11:20
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ JSONRPC-CHANNEL Error

On Fri, Oct 15, 2010 at 10:36:23AM +0200, ALBERT HIDALGO BAREA wrote:
> Configuration of the machine:
>                 Red Hat 5.3 EL
>                 RabbitMQ server 2.1.0
>                 Erlang R13B-03
>                 Project-umbrella latest release (compiled and running the broker through the plugin folder like says the README of the jsonrpc-channel plugin)

>           {undef,
>               [{rabbit_channel,start_link,
>                    [rabbit_jsonrpc_channel,<0.17653.0>,<0.17653.0>,
>                     <<\"guest\">>,<<\"/\">>,<0.17654.0>]},

Yeah, channel:start_link is now a /7, not a /6, so something's a bit
wrong there - my guess is that in building the plugin, it's checked out
a copy of the server which is more up to date than the 2.1.0 that you've
got installed.

I'd suggest you just download the binary version of the plugin from
http://www.rabbitmq.com/plugins.html

Best wishes,

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Mon Oct 18 13:04:29 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 18 Oct 2010 13:04:29 +0100
Subject: [rabbitmq-discuss] Tutorials for RabbitMQ
In-Reply-To: <B981AB02-D3F6-4C90-9A74-DABE4B749250@cantemo.com>
References: <AANLkTikmeD9hiXtO2kg_fq0jumhTY5A7VrCfbOJmwHeZ@mail.gmail.com>
	<AB8F1016-D2BA-499D-BFF4-404002C423CD@cantemo.com>
	<B981AB02-D3F6-4C90-9A74-DABE4B749250@cantemo.com>
Message-ID: <AANLkTimdbPti2KX_bkyYEocefYe=3-MzYcFdmp8eVUPb@mail.gmail.com>

Tim,

Thanks for the feedback. I followed your suggestions, you should
be able to see updated version on the github.

Shout if you have any more comments!

Cheers,
  Marek

On Sat, Oct 9, 2010 at 14:28, Tim Child <tim at cantemo.com> wrote:
> So I just ran through the tutorials on a fresh Ubuntu 10.04 LTS server with
> RabbitMQ installed.
> Overall:
> Good basic level of tutorial, and the basics of queuing.
> In Tutorial One:
> You mentioned how to install PIP, and Pika but not how to install Git -
> which didn't come on my fresh Ubuntu installation.
> In Tutorial Two:
> Basic I know, but its a step that is missing:
> chmod +x new_task.py
> In Tutorial Three:
> All though we deal with the the fanout exchange type, it might be wise to
> include a link to the documentation which describes the other types of
> exchange types.
> "Secondly, once we disconnect the client the queue" - client - should that
> be the consumer?
> chmod -x scripts again
> It would also be interesting to say at the end that you can open more than
> one session of?./receive_logs.py
> And to look at:
> rabbitmqctl list_bindings.
> When you have the receive_logs running and not running.
> Maybe next steps:
> One of the things that I have actually found harder than implementation of
> how to work with RabbitMq is actually making good design decisions on
> queues, bindings, exchanges. Not sure what can be done there, or if there is
> a good resource of AMQP patterns.
> Good stuff anyway!
> Tim.
>
>
>
> On 8 Oct 2010, at 16:03, Tim Child wrote:
>
> Fantastic.
> I will work through the tutorials this weekend and post a response back to
> the message list.
> Tim.
> On 8 Oct 2010, at 13:30, Marek Majkowski wrote:
>
> Guys,
>
> We're working on a few tutorials for RabbitMQ.
> They are addressed to the beginners, but we hope that even
> more experienced users can learn something from them.
>
> You can see them here:
>
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-one.md
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-two.md
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/tutorial-three.md
>
> http://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/tutorial-one.md
>
> The work is very much in progress, so please do let us know about typos,
> mistakes or any ideas how to enhance them.
>
> Cheers,
> ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Tim Child
> +46 (0) 7602 17785
> Skype: timchild
> http://www.cantemo.com
> CANTEMO
>
>

From abhishek.kona at gmail.com  Mon Oct 18 13:10:51 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Mon, 18 Oct 2010 17:40:51 +0530
Subject: [rabbitmq-discuss] Failure on Installing management plugins
Message-ID: <4CBC394B.5080303@gmail.com>

  Hi

I am not able to start RabbitMQ with all the five plugins for Management 
plugin copied to
/usr/lib/rabbitmq/lib/rabbitmq_server-2.1.0/plugins (an ubuntu machine)

The startup log has:
Starting all nodes...
Starting node rabbit at mq1...
Activating RabbitMQ plugins ...
ERROR: failed to load application inets:
{"no such file or directory","inets.app"}

root is the owner of all the files in the directory 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.1.0/plugins
Is that an issue.


I am able to run the management plugin on my laptop which is a mac.
I think this is an issue with user privileges. Can some one throw some 
more light on it?

Thanks

-Abhishek Kona
Flipkart.com

From simon at rabbitmq.com  Mon Oct 18 13:21:39 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Oct 2010 13:21:39 +0100
Subject: [rabbitmq-discuss] Failure on Installing management plugins
In-Reply-To: <4CBC394B.5080303@gmail.com>
References: <4CBC394B.5080303@gmail.com>
Message-ID: <4CBC3BD3.8000600@rabbitmq.com>

On 18/10/10 13:10, Abhishek Kona wrote:
> I am able to run the management plugin on my laptop which is a mac.
> I think this is an issue with user privileges. Can some one throw some
> more light on it?

You need to install the erlang-inets package.

Future versions of the rabbitmq-server deb will do this automatically in 
case you install the plugin.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From abhishek.kona at gmail.com  Mon Oct 18 13:40:09 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Mon, 18 Oct 2010 18:10:09 +0530
Subject: [rabbitmq-discuss] Failure on Installing management plugins
In-Reply-To: <4CBC3BD3.8000600@rabbitmq.com>
References: <4CBC394B.5080303@gmail.com> <4CBC3BD3.8000600@rabbitmq.com>
Message-ID: <4CBC4029.2090800@gmail.com>

  On 18/10/10 5:51 PM, Simon MacMullen wrote:
> On 18/10/10 13:10, Abhishek Kona wrote:
>> I am able to run the management plugin on my laptop which is a mac.
>> I think this is an issue with user privileges. Can some one throw some
>> more light on it?
>
> You need to install the erlang-inets package.
>
> Future versions of the rabbitmq-server deb will do this automatically 
> in case you install the plugin.
>
> Cheers, Simon
Thanks for the quick reply. Works like a charm now

-Abhishek Kona
Software Engineer, Platform
Flipkart.com

From simon at rabbitmq.com  Mon Oct 18 15:39:35 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Oct 2010 15:39:35 +0100
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CB86067.2010902@cpicorp.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
	<4CB86067.2010902@cpicorp.com>
Message-ID: <4CBC5C27.6040200@rabbitmq.com>

On 15/10/10 15:08, Derek Chen-Becker wrote:
> Basically, yes. Ideally, the broker would duplicate every file write
> operation to a second location. It would be really nice if we could do
> this with Mnesia, too, so that essentially we're getting a real-time
> copy of state on a backup machine. If the primary machine went down I
> would do the work of starting a new broker on the backup machine using
> the redundant files. The only concern I have with this scenario is that
> it sounds like RabbitMQ uses the node name to identify itself, so I
> wasn't sure if that was configurable or if I could uses the hosts file
> to fake it.

I don't think there's really a reason for having RabbitMQ duplicate file 
writes - the Windows software RAID or hardware RAID or a SAN can do 
that. Real active-active is of course another story.

You can change the node name by setting the environment variable 
RABBITMQ_NODENAME to something like rabbit at myhostname. Note that 
myhostname must be resolvable by DNS or the hosts file.

> Like I said, if we weren't constrained to run on Windows I would just be
> doing DRBD and this would all be fine, but the decision on OS was made a
> long, long time ago and it's infeasible to change it now :(

Sorry to hear that :(

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From dbecker at cpicorp.com  Mon Oct 18 17:28:06 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Mon, 18 Oct 2010 11:28:06 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CBC5C27.6040200@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com>
	<4CB82381.1040302@rabbitmq.com>	<4CB86067.2010902@cpicorp.com>
	<4CBC5C27.6040200@rabbitmq.com>
Message-ID: <4CBC7596.1000502@cpicorp.com>

On 10/18/2010 09:39 AM, Simon MacMullen wrote:
> I don't think there's really a reason for having RabbitMQ duplicate file 
> writes - the Windows software RAID or hardware RAID or a SAN can do 
> that. Real active-active is of course another story.

Let me clarify things a bit here. These are retail locations with
commodity PCs running Windows XP. There is one SOHO-class server at each
site and a handful of desktop machines in various roles. The server does
have hardware RAID, but the scenario we're trying to provide recovery
for is when the server itself dies. This could be for any number of
reasons, including people spilling drinks in the power supply (this has
happened, multiple times). The people at the sites are *extremely*
non-technical, so we're looking for (ideally) automated failover
solutions, or when that doesn't exist we would at least like a setup
that would allow our help desk to remotely bring up a service on another
machine in the site so that they can continue to function. We're not
looking for clustering, or HA even. We just want the queue and config
data to get copied somewhere else so that in the event that the server
is fried, we haven't lost it. Like I said, DRBD would make this
stupid-simple, but it doesn't exist for Windows (I don't know of
anything like it for Windows). The next best thing as far as I can tell
would be to simply have RabbitMQ write everything twice. If anyone on
the list has a better idea (outside of purchasing equipment) I'm all ears :)

Thanks,

Derek

From pneumann at gmail.com  Mon Oct 18 17:48:22 2010
From: pneumann at gmail.com (Phillip Neumann)
Date: Mon, 18 Oct 2010 13:48:22 -0300
Subject: [rabbitmq-discuss] Error: invalid command
In-Reply-To: <4C6DF54A.4090600@rabbitmq.com>
References: <1281537968.feDCF5317.13533@mail.ua>
	<4C6DF54A.4090600@rabbitmq.com>
Message-ID: <AANLkTinSc+u+YacWUCNjMNcmj=M2j70hHTGBLwMjMCs1@mail.gmail.com>

Please update to rabbitmq 2.1.0.
There was an error with the freebsd port.

Good luck!

2010/8/19 Matthias Radestock <matthias at rabbitmq.com>:
> ?????????,
>
> ????????? ????? wrote:
>>
>> Emile Joubert wrote:
>>>
>>> Which shell are you using? The reason why read-only commands appear
>>> to work is because they have no additional parameters. I've seen
>>> something similar while using tcsh. The problem is that the parameters are
>>> not being split correctly. Do you get the same error
>>> when using bash?
>>
>> I use bash. I already tried do same with /bin/sh and /bin/tcsh with
>> same result.
>
> Did you manage to resolve this?
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 


__________________
Phillip Neumann
pneumann at gmail.com

From dbecker at cpicorp.com  Mon Oct 18 23:12:32 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Mon, 18 Oct 2010 17:12:32 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CB82381.1040302@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
Message-ID: <4CBCC650.3050605@cpicorp.com>

I'm trying to think about this from a different angle, since it sounds
like duplicate writes won't be supported. If I make a periodic copy of
the entire data directory for my RabbitMQ instance on the server to
another machine, would I be able to bring up the backup machine using
that copy if the primary dies a horrible death (assuming I properly set
RABBITMQ_NODENAME)?

Thanks,

Derek

From fullblaststorm at gmail.com  Tue Oct 19 06:19:56 2010
From: fullblaststorm at gmail.com (Victor Lyapunov)
Date: Tue, 19 Oct 2010 11:19:56 +0600
Subject: [rabbitmq-discuss] Messaging system for the university
Message-ID: <AANLkTikYFvKSXF8biZ7Gv9BcvyP9E+R9U3op5iV=hgVP@mail.gmail.com>

Hi,
We are building a messaging system for our university.
Currently we have a rabbitmq cluster setup running on 2
nodes(CentOS-5.5x86 and CentOS-5.5x86_64). There are message consumers
connected to both nodes. The problem is that consumers receive
messages in a round-robin fashion (e.g. Message#1 is received by
consumer #1(not by the second consumer) and message#2 is received by
the second consumer(not by the first consumer)). We want all of our
consumers to receive all of the published messages.

Any thoughts on this?



[root at bv ~]# rabbitmqctl status
Status of node rabbit at bv ...
[{running_applications,[{rabbit,"RabbitMQ","2.0.0"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[{disc,[rabbit at bv]},{ram,[rabbit at dcbackup]}]},
 {running_nodes,[rabbit at dcbackup,rabbit at bv]}]
...done.

[root at dcbackup ~]# rabbitmqctl status
Status of node rabbit at dcbackup ...
[{running_applications,[{rabbit,"RabbitMQ","2.0.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[{disc,[rabbit at bv]},{ram,[rabbit at dcbackup]}]},
 {running_nodes,[rabbit at bv,rabbit at dcbackup]}]
...done.



#---- amqp_consumer.py on server `dcbackup' ------
from amqplib import client_0_8 as amqp

conn = amqp.Connection(host="dcbackup:5672", userid="guest",
password="guest", virtual_host="/", insist=False)
chan = conn.channel()

chan.queue_declare(queue="po_box", durable=True, exclusive=False,
auto_delete=False)
chan.exchange_declare(exchange="sorting_room", type="direct",
durable=True, auto_delete=False,)

chan.queue_bind(queue="po_box", exchange="sorting_room", routing_key="jason")

def recv_callback(msg):
    print 'Received: ' + msg.body + ' from channel #' +
str(msg.channel.channel_id)

chan.basic_consume(queue='po_box', no_ack=True,
callback=recv_callback, consumer_tag="testtag")
while True:
    chan.wait()
chan.basic_cancel("testtag")
chan.close()
conn.close()


#---- amqp_consumer.py on server `bv' ------
from amqplib import client_0_8 as amqp

conn = amqp.Connection(host="bv:5672", userid="guest",
password="guest", virtual_host="/", insist=False)
chan = conn.channel()

chan.queue_declare(queue="po_box", durable=True, exclusive=False,
auto_delete=False)
chan.exchange_declare(exchange="sorting_room", type="direct",
durable=True, auto_delete=False,)

chan.queue_bind(queue="po_box", exchange="sorting_room", routing_key="jason")

def recv_callback(msg):
    print 'Received: ' + msg.body + ' from channel #' +
str(msg.channel.channel_id)

chan.basic_consume(queue='po_box', no_ack=True,
callback=recv_callback, consumer_tag="testtag")
while True:
    chan.wait()
chan.basic_cancel("testtag")
chan.close()
conn.close()


#---- amqp_consumer.py on server `bv' ------
from amqplib import client_0_8 as amqp
import sys

conn = amqp.Connection(host="bv:5672", userid="guest",
password="guest", virtual_host="/", insist=False)
chan = conn.channel()

msg = amqp.Message(sys.argv[1])
msg.properties["delivery_mode"] = 1
chan.basic_publish(msg,exchange="sorting_room",routing_key="jason")

chan.close()
conn.close()


[root at bv ~]# uname -a
Linux bv.localdomain 2.6.18-194.el5xen #1 SMP Fri Apr 2 15:34:40 EDT
2010 x86_64 x86_64 x86_64 GNU/Linux


[root at dcbackup ~]# uname -a
Linux dcbackup.localdomain 2.6.18-194.el5xen #1 SMP Fri Apr 2 16:16:54
EDT 2010 i686 i686 i386 GNU/Linux

Our python version is:
Python 2.6.5 (r265:79063, Apr  9 2010, 11:16:46)
[GCC 4.1.2 20080704 (Red Hat 4.1.2-48)] on linux2

From akalend at mail.ru  Tue Oct 19 07:10:23 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Tue, 19 Oct 2010 10:10:23 +0400
Subject: [rabbitmq-discuss]
	=?windows-1251?q?Messaging_system_for_the_univ?=
	=?windows-1251?q?ersity?=
In-Reply-To: <AANLkTikYFvKSXF8biZ7Gv9BcvyP9ER9U3op5iV=hgVP@mail.gmail.com>
References: <AANLkTikYFvKSXF8biZ7Gv9BcvyP9ER9U3op5iV=hgVP@mail.gmail.com>
Message-ID: <E1P85Ox-0000wK-00.akalend-mail-ru@f297.mail.ru>

Victor,

You using the type of exchange is "direct", one messages one consumer.
If using the type fanout, the all messages for all consumer


Alexandre

From abhishek.kona at gmail.com  Tue Oct 19 07:28:53 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Tue, 19 Oct 2010 11:58:53 +0530
Subject: [rabbitmq-discuss] Failure on Installing management plugins
In-Reply-To: <4CBC4029.2090800@gmail.com>
References: <4CBC394B.5080303@gmail.com> <4CBC3BD3.8000600@rabbitmq.com>
	<4CBC4029.2090800@gmail.com>
Message-ID: <4CBD3AA5.6000704@gmail.com>

  On 18/10/10 6:10 PM, Abhishek Kona wrote:
>  On 18/10/10 5:51 PM, Simon MacMullen wrote:
>> On 18/10/10 13:10, Abhishek Kona wrote:
>>> I am able to run the management plugin on my laptop which is a mac.
>>> I think this is an issue with user privileges. Can some one throw some
>>> more light on it?
>>
>> You need to install the erlang-inets package.
>>
>> Future versions of the rabbitmq-server deb will do this automatically 
>> in case you install the plugin.
>>
>> Cheers, Simon
> Thanks for the quick reply. Works like a charm now
>
> -Abhishek Kona
> Software Engineer, Platform
> Flipkart.com
Continuing on the same not when I install the management plugin on a 
Debian machine Rabbit Fails to start with the following error

Starting all nodes...
Starting node rabbit at cms3...
Activating RabbitMQ plugins ...
5 plugins activated:
* amqp_client-2.1.0
* mochiweb-1.3
* rabbit_management-2.1.0
* rabbit_mochiweb-2.1.0
* webmachine-1.7.0

{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}

Any thoughts on this?

-Abhishek Kona
Flipkart.com


From abarea at tid.es  Tue Oct 19 07:31:29 2010
From: abarea at tid.es (ALBERT HIDALGO BAREA)
Date: Tue, 19 Oct 2010 08:31:29 +0200
Subject: [rabbitmq-discuss] Failure on Installing management plugins
In-Reply-To: <4CBD3AA5.6000704@gmail.com>
References: <4CBC394B.5080303@gmail.com> <4CBC3BD3.8000600@rabbitmq.com>
	<4CBC4029.2090800@gmail.com> <4CBD3AA5.6000704@gmail.com>
Message-ID: <6D466181A86F4042896593D8F56C32624A44049139@EXCLU2K7.hi.inet>

I had the same problem and it was because I was using Erlang R12-B5, and at least must be R13-B03.
So updating Erlang maybe solves your problem. Also take a look to the rabbitmq-server script in order to change the Erlang path (if it is necessary).

Regards,

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Abhishek Kona
Sent: martes, 19 de octubre de 2010 8:29
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Failure on Installing management plugins

  On 18/10/10 6:10 PM, Abhishek Kona wrote:
>  On 18/10/10 5:51 PM, Simon MacMullen wrote:
>> On 18/10/10 13:10, Abhishek Kona wrote:
>>> I am able to run the management plugin on my laptop which is a mac.
>>> I think this is an issue with user privileges. Can some one throw some
>>> more light on it?
>>
>> You need to install the erlang-inets package.
>>
>> Future versions of the rabbitmq-server deb will do this automatically 
>> in case you install the plugin.
>>
>> Cheers, Simon
> Thanks for the quick reply. Works like a charm now
>
> -Abhishek Kona
> Software Engineer, Platform
> Flipkart.com
Continuing on the same not when I install the management plugin on a 
Debian machine Rabbit Fails to start with the following error

Starting all nodes...
Starting node rabbit at cms3...
Activating RabbitMQ plugins ...
5 plugins activated:
* amqp_client-2.1.0
* mochiweb-1.3
* rabbit_management-2.1.0
* rabbit_mochiweb-2.1.0
* webmachine-1.7.0

{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}

Any thoughts on this?

-Abhishek Kona
Flipkart.com

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Oct 19 10:10:09 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Oct 2010 10:10:09 +0100
Subject: [rabbitmq-discuss] Messaging system for the university
In-Reply-To: <AANLkTikYFvKSXF8biZ7Gv9BcvyP9E+R9U3op5iV=hgVP@mail.gmail.com>
References: <AANLkTikYFvKSXF8biZ7Gv9BcvyP9E+R9U3op5iV=hgVP@mail.gmail.com>
Message-ID: <4CBD6071.1000606@rabbitmq.com>

On 19/10/10 06:19, Victor Lyapunov wrote:
> Hi,
> We are building a messaging system for our university.
> Currently we have a rabbitmq cluster setup running on 2
> nodes(CentOS-5.5x86 and CentOS-5.5x86_64). There are message consumers
> connected to both nodes. The problem is that consumers receive
> messages in a round-robin fashion (e.g. Message#1 is received by
> consumer #1(not by the second consumer) and message#2 is received by
> the second consumer(not by the first consumer)). We want all of our
> consumers to receive all of the published messages.

Hi Victor.

The problem is that you're only creating one queue ("po_box") and 
binding two consumers to it. Each message can only be retrieved from a 
given queue once. Round robin is the intended behaviour in this setup.

The solution is for each consumer to create its own queue. To help with 
this:

If you do not supply a queue name the server will generate one and 
return it to you (so you don't have to worry about keeping names 
unique). Also, if you set exclusive=true on the queue declare, the queue 
will be "owned" by its connection and will be automatically destroyed 
when the client disconnects.

Alexandre's response about fanout vs direct is a bit of a red herring, 
that only controls how messages get routed to queues.

Cheers, Simon

>
> Any thoughts on this?
>
>
>
> [root at bv ~]# rabbitmqctl status
> Status of node rabbit at bv ...
> [{running_applications,[{rabbit,"RabbitMQ","2.0.0"},
>                          {os_mon,"CPO  CXC 138 46","2.1.8"},
>                          {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                          {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                          {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                          {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>   {nodes,[{disc,[rabbit at bv]},{ram,[rabbit at dcbackup]}]},
>   {running_nodes,[rabbit at dcbackup,rabbit at bv]}]
> ...done.
>
> [root at dcbackup ~]# rabbitmqctl status
> Status of node rabbit at dcbackup ...
> [{running_applications,[{rabbit,"RabbitMQ","2.0.0"},
>                          {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                          {os_mon,"CPO  CXC 138 46","2.1.8"},
>                          {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                          {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                          {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>   {nodes,[{disc,[rabbit at bv]},{ram,[rabbit at dcbackup]}]},
>   {running_nodes,[rabbit at bv,rabbit at dcbackup]}]
> ...done.
>
>
>
> #---- amqp_consumer.py on server `dcbackup' ------
> from amqplib import client_0_8 as amqp
>
> conn = amqp.Connection(host="dcbackup:5672", userid="guest",
> password="guest", virtual_host="/", insist=False)
> chan = conn.channel()
>
> chan.queue_declare(queue="po_box", durable=True, exclusive=False,
> auto_delete=False)
> chan.exchange_declare(exchange="sorting_room", type="direct",
> durable=True, auto_delete=False,)
>
> chan.queue_bind(queue="po_box", exchange="sorting_room", routing_key="jason")
>
> def recv_callback(msg):
>      print 'Received: ' + msg.body + ' from channel #' +
> str(msg.channel.channel_id)
>
> chan.basic_consume(queue='po_box', no_ack=True,
> callback=recv_callback, consumer_tag="testtag")
> while True:
>      chan.wait()
> chan.basic_cancel("testtag")
> chan.close()
> conn.close()
>
>
> #---- amqp_consumer.py on server `bv' ------
> from amqplib import client_0_8 as amqp
>
> conn = amqp.Connection(host="bv:5672", userid="guest",
> password="guest", virtual_host="/", insist=False)
> chan = conn.channel()
>
> chan.queue_declare(queue="po_box", durable=True, exclusive=False,
> auto_delete=False)
> chan.exchange_declare(exchange="sorting_room", type="direct",
> durable=True, auto_delete=False,)
>
> chan.queue_bind(queue="po_box", exchange="sorting_room", routing_key="jason")
>
> def recv_callback(msg):
>      print 'Received: ' + msg.body + ' from channel #' +
> str(msg.channel.channel_id)
>
> chan.basic_consume(queue='po_box', no_ack=True,
> callback=recv_callback, consumer_tag="testtag")
> while True:
>      chan.wait()
> chan.basic_cancel("testtag")
> chan.close()
> conn.close()
>
>
> #---- amqp_consumer.py on server `bv' ------
> from amqplib import client_0_8 as amqp
> import sys
>
> conn = amqp.Connection(host="bv:5672", userid="guest",
> password="guest", virtual_host="/", insist=False)
> chan = conn.channel()
>
> msg = amqp.Message(sys.argv[1])
> msg.properties["delivery_mode"] = 1
> chan.basic_publish(msg,exchange="sorting_room",routing_key="jason")
>
> chan.close()
> conn.close()
>
>
> [root at bv ~]# uname -a
> Linux bv.localdomain 2.6.18-194.el5xen #1 SMP Fri Apr 2 15:34:40 EDT
> 2010 x86_64 x86_64 x86_64 GNU/Linux
>
>
> [root at dcbackup ~]# uname -a
> Linux dcbackup.localdomain 2.6.18-194.el5xen #1 SMP Fri Apr 2 16:16:54
> EDT 2010 i686 i686 i386 GNU/Linux
>
> Our python version is:
> Python 2.6.5 (r265:79063, Apr  9 2010, 11:16:46)
> [GCC 4.1.2 20080704 (Red Hat 4.1.2-48)] on linux2
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue Oct 19 10:12:02 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Oct 2010 10:12:02 +0100
Subject: [rabbitmq-discuss] Failure on Installing management plugins
In-Reply-To: <4CBD3AA5.6000704@gmail.com>
References: <4CBC394B.5080303@gmail.com>
	<4CBC3BD3.8000600@rabbitmq.com>	<4CBC4029.2090800@gmail.com>
	<4CBD3AA5.6000704@gmail.com>
Message-ID: <4CBD60E2.50102@rabbitmq.com>

On 19/10/10 07:28, Abhishek Kona wrote:
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}
>
>

If Albert's suggestion has not helped, please check the SASL log
(/var/log/rabbitmq/rabbit@<nodename>-sasl.log). It should have more
information on why rabbit_mochiweb did not start. But yes, if "Debian"
means lenny, I'm pretty sure the Erlang version is too old.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From krzysztof_gawronek at o2.pl  Tue Oct 19 12:24:41 2010
From: krzysztof_gawronek at o2.pl (chriss_rook)
Date: Tue, 19 Oct 2010 04:24:41 -0700 (PDT)
Subject: [rabbitmq-discuss] messages not consumed by client for al long time
 >10min
Message-ID: <29999206.post@talk.nabble.com>


I have a problem with messages which are not consumed for a long period of
time. For some messages it take more than 10 minutes between posting a
message by producerand receiving it on consumer. During this period of time
i can see that message on queue and it is in ready status. Other messages,
sent later, are delivered and consumed instantly. For purpose of test i have
one producer and one consumer located on different servers.

Has anybody encountered that problem? Any working solution/walkaround/clue
will be mostly welcome?


I'm using server and client version 1.7.1.
The messages are PERSISTENT_TEXT_PLAIN

CR
-- 
View this message in context: http://old.nabble.com/messages-not-consumed-by-client-for-al-long-time-%3E10min-tp29999206p29999206.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Tue Oct 19 13:24:28 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 19 Oct 2010 13:24:28 +0100
Subject: [rabbitmq-discuss] messages not consumed by client for al long
 time >10min
In-Reply-To: <29999206.post@talk.nabble.com>
References: <29999206.post@talk.nabble.com>
Message-ID: <20101019122428.GA2364@dakota>

> I'm using server and client version 1.7.1.

1.7.1 is quite old.  A lot of bugfixes (including the new persister)
have gone into the broker since then.

Could you upgrade to the latest version and try again?

Alex

On Tue, Oct 19, 2010 at 04:24:41AM -0700, chriss_rook wrote:
> 
> I have a problem with messages which are not consumed for a long period of
> time. For some messages it take more than 10 minutes between posting a
> message by producerand receiving it on consumer. During this period of time
> i can see that message on queue and it is in ready status. Other messages,
> sent later, are delivered and consumed instantly. For purpose of test i have
> one producer and one consumer located on different servers.
> 
> Has anybody encountered that problem? Any working solution/walkaround/clue
> will be mostly welcome?
> 
> 
> I'm using server and client version 1.7.1.
> The messages are PERSISTENT_TEXT_PLAIN
> 
> CR
> -- 
> View this message in context: http://old.nabble.com/messages-not-consumed-by-client-for-al-long-time-%3E10min-tp29999206p29999206.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vbarat at ubikod.com  Tue Oct 19 14:11:55 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Tue, 19 Oct 2010 15:11:55 +0200
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
Message-ID: <4CBD991B.3080704@ubikod.com>

  Hello,

We are using RabbitMQ 1.7.2 in cluster (2 nodes).

When the first node is not started, the second node cannot be 
started (AFAIK, because it need to wait for the "master" node to be 
up in order to replicate Mnesia tables).

My question: is this behavior mandatory ? What if we configure 
Mnesia not to wait for the master node to be up ? What side effects 
would it trigger ?

Thanks a lot for your help.

From matthew at rabbitmq.com  Tue Oct 19 14:14:06 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 14:14:06 +0100
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
In-Reply-To: <4CBD991B.3080704@ubikod.com>
References: <4CBD991B.3080704@ubikod.com>
Message-ID: <20101019131405.GE6803@rabbitmq.com>

On Tue, Oct 19, 2010 at 03:11:55PM +0200, Vincent Barat wrote:
> When the first node is not started, the second node cannot be
> started (AFAIK, because it need to wait for the "master" node to be
> up in order to replicate Mnesia tables).

If your master node is a disk node, and your non master node is a Ram
node, then yes, you'll always need the disk node to be up. Otherwise,
the ram node will not contain any data.

Matthew

From michael at ndrix.org  Tue Oct 19 15:29:58 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Tue, 19 Oct 2010 08:29:58 -0600
Subject: [rabbitmq-discuss] shutdown_error debugging
Message-ID: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>

I recently upgraded RabbitMQ from 2.0.0 to 2.1.0 (using the provided
Debian packages) and now I'm getting error messages like:

=SUPERVISOR REPORT==== 19-Oct-2010::08:07:50 ===
     Supervisor: {<0.18170.3>,rabbit_connection_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.18172.3>},
                  {name,collector},
                  {mfa,{rabbit_queue_collector,start_link,[]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]

and

=SUPERVISOR REPORT==== 19-Oct-2010::08:20:57 ===
     Supervisor: {<0.24308.3>,rabbit_channel_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.24311.3>},
                  {name,framing_channel},
                  {mfa,
                      {rabbit_framing_channel,start_link,
                          [<0.24307.3>,<0.24310.3>,rabbit_framing_amqp_0_8]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]

I'm using Perl (Net::RabbitMQ 0.1.8) and Haskell (amqp-0.2.1)
libraries to connect to RabbitMQ.  The output of `rabbitmqctl status`
is

Status of node rabbit at acs ...
[{running_applications,[{rabbit,"RabbitMQ","2.1.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,[{disc,[rabbit at acs]}]},
 {running_nodes,[rabbit at acs]}]
...done.

How can I find the cause of these errors?

Thanks.

-- 
Michael

From matthew at rabbitmq.com  Tue Oct 19 15:33:49 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 15:33:49 +0100
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
Message-ID: <20101019143348.GF6803@rabbitmq.com>

On Tue, Oct 19, 2010 at 08:29:58AM -0600, Michael Hendricks wrote:
> I recently upgraded RabbitMQ from 2.0.0 to 2.1.0 (using the provided
> Debian packages) and now I'm getting error messages like:

When are these error messages appearing? When the broker shuts down or
when connections are terminated?

Matthew

From matthew at rabbitmq.com  Tue Oct 19 15:51:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 15:51:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ JSONRPC-CHANNEL Error
In-Reply-To: <6D466181A86F4042896593D8F56C32624A44049032@EXCLU2K7.hi.inet>
References: <6D466181A86F4042896593D8F56C32624A44048FAA@EXCLU2K7.hi.inet>
	<20101015092026.GA11086@wellquite.org>
	<6D466181A86F4042896593D8F56C32624A44049032@EXCLU2K7.hi.inet>
Message-ID: <20101019145116.GJ6803@rabbitmq.com>

On Mon, Oct 18, 2010 at 08:19:57AM +0200, ALBERT HIDALGO BAREA wrote:
> I tried on Friday, but also gave me the same problem as before.
> If it is a general problem, I will wait until there is a new release of the RabbitMQ server or the JSONRPC-CHANNEL plugin.

Simon has just noticed that this has been in fact been broken in our
source tree for some time. We have a fix for this which has been through
QA and works - if you compile the plugin from the head of the default
branch then you should be fine now - certainly please let us know if it
still doesn't work for you.

The fix will be included in the next release.

Matthew

From michael at ndrix.org  Tue Oct 19 16:10:08 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Tue, 19 Oct 2010 09:10:08 -0600
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <20101019143348.GF6803@rabbitmq.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
Message-ID: <AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>

I haven't shut down the broker in the last 24 hours, so that shouldn't
be it.  Connecting to the broker, publishing a message and
disconnecting produced the error in 3 out of 6 attempts.  The error
message was always this variant:

=SUPERVISOR REPORT==== 19-Oct-2010::09:08:05 ===
     Supervisor: {<0.30680.3>,rabbit_connection_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.30682.3>},
                  {name,collector},
                  {mfa,{rabbit_queue_collector,start_link,[]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]

These tests were done with the Haskell library.

-- 
Michael

On Tue, Oct 19, 2010 at 8:33 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Oct 19, 2010 at 08:29:58AM -0600, Michael Hendricks wrote:
>> I recently upgraded RabbitMQ from 2.0.0 to 2.1.0 (using the provided
>> Debian packages) and now I'm getting error messages like:
>
> When are these error messages appearing? When the broker shuts down or
> when connections are terminated?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Tue Oct 19 16:42:32 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 16:42:32 +0100
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
Message-ID: <20101019154231.GK6803@rabbitmq.com>

On Tue, Oct 19, 2010 at 09:10:08AM -0600, Michael Hendricks wrote:
> These tests were done with the Haskell library.

I'm not sure, but this could be that the library isn't doing shutdown
correctly - the "error" is rather erroneously labelled an error due to
OTP rather than our choice. Is there any chance you could put the
tracer[0] in between the broker and the client - I'm curious as to
whether the Haskell library is doing the correct sequence of
close methods.

[0] http://www.rabbitmq.com/examples.html#tracer

Matthew

From matthew at rabbitmq.com  Tue Oct 19 16:43:31 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 16:43:31 +0100
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <20101019154231.GK6803@rabbitmq.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
	<20101019154231.GK6803@rabbitmq.com>
Message-ID: <20101019154331.GL6803@rabbitmq.com>

On Tue, Oct 19, 2010 at 04:42:31PM +0100, Matthew Sackman wrote:
> On Tue, Oct 19, 2010 at 09:10:08AM -0600, Michael Hendricks wrote:
> > These tests were done with the Haskell library.
> 
> I'm not sure, but this could be that the library isn't doing shutdown
> correctly - the "error" is rather erroneously labelled an error due to
> OTP rather than our choice. Is there any chance you could put the
> tracer[0] in between the broker and the client - I'm curious as to
> whether the Haskell library is doing the correct sequence of
> close methods.

Or, or traffic capture with wireshark would likely work fine too.

Matthew

From vbarat at ubikod.com  Tue Oct 19 17:28:47 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Tue, 19 Oct 2010 18:28:47 +0200
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
In-Reply-To: <20101019131405.GE6803@rabbitmq.com>
References: <4CBD991B.3080704@ubikod.com> <20101019131405.GE6803@rabbitmq.com>
Message-ID: <4CBDC73F.4080301@ubikod.com>

  Thanks for the answer.

My two nodes are RAM nodes actually.

Le 19/10/10 15:14, Matthew Sackman a ?crit :
> On Tue, Oct 19, 2010 at 03:11:55PM +0200, Vincent Barat wrote:
>> When the first node is not started, the second node cannot be
>> started (AFAIK, because it need to wait for the "master" node to be
>> up in order to replicate Mnesia tables).
> If your master node is a disk node, and your non master node is a Ram
> node, then yes, you'll always need the disk node to be up. Otherwise,
> the ram node will not contain any data.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Tue Oct 19 17:35:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 19 Oct 2010 17:35:16 +0100
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
In-Reply-To: <4CBDC73F.4080301@ubikod.com>
References: <4CBD991B.3080704@ubikod.com> <20101019131405.GE6803@rabbitmq.com>
	<4CBDC73F.4080301@ubikod.com>
Message-ID: <20101019163516.GM6803@rabbitmq.com>

On Tue, Oct 19, 2010 at 06:28:47PM +0200, Vincent Barat wrote:
> My two nodes are RAM nodes actually.

Ahh. From http://rabbitmq.com/clustering.html:

"Because state is replicated across all nodes in the cluster, it is
sufficient to have just one disk node within a cluster, to store the
state of the cluster safely. Beware, however, that RabbitMQ will not
stop you from creating a cluster with only RAM nodes. Should you do
this, and suffer a power failure to the entire cluster, the entire state
of the cluster, including all messages, will be lost."

I think we used to prevent you from building RAM-node-only clusters. We
must have changed behaviour there a while ago. It makes sense that the
last node to die needs to be brought up first: if a node goes down and
it knew that it was part of a cluster, then when coming back up, it'll
remember it was part of a cluster and try to reconnect to it - it will
be very aware that any data it holds (in this case, none!) will likely
be out of date and it needs to resync from the other nodes in the
cluster - it'll have no knowledge that the other nodes also went down.

That said, it's been a while since I played around with clusters so my
information might be out of date.

Matthew

From vlad at rabbitmq.com  Tue Oct 19 18:30:58 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Tue, 19 Oct 2010 18:30:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1 release
Message-ID: <4CBDD5D2.9030901@rabbitmq.com>


The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.1.

This release fixes a number of bugs and introduces some enhancements,
including exchange to exchange bindings and some performance
improvements, in the server and clients.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

   The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.1.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101019/b2a394f3/attachment.txt>

From davide.maestroni at gmail.com  Tue Oct 19 18:30:50 2010
From: davide.maestroni at gmail.com (Davide Maestroni)
Date: Tue, 19 Oct 2010 19:30:50 +0200
Subject: [rabbitmq-discuss] Batch Acknowledge
Message-ID: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>

Hi all,

I'm new to RabbitMQ and I am still trying to put everything together, so
please be patient.

What I want to achieve is a queue in which all the messages persist until a
"consumer" (not sure if it is really a consumer actually)  do some batch
processing on N messages, like updating a separate DB, and, only when
everything has completed correctly, send an acknowledge so that the queue
can release the last delivered N messages.
As per my understanding I can "declare" a queue and then start reading from
it using basicGet() API. Then, after processing the desired number of
messages, I call basicAck(deliveryTag, true) passing the tag of the last
read message.
In my case it is both important to keep the message ordering and not to lose
any message even if the consumer or the broker crash. In order to achieve
that, I am going to publish messages "mandatory" and "persistent" and then
send an ack in the consumer after successfully securing the data in some
other place.
What I want to be clear here is: is it correct to say that if the consumer
crashes after M basicGet() (but before sending the ack), at restart the same
M messages will be returned calling basicGet()? I.e. are the messages
removed from the queue only after receiving the acknowledge?
If it is not so, do I have to call basicRecover()? Can I do it even if I
don't call basicConsume()? And most importantly, which is the order of the
messages when calling basicRecover() after a crash and restart of the
consumer node?

A final question: if a message is flagged as "mandatory", how long the queue
wait for a consumer to be ready before returning the message to the sender?

Thanks and Best Regards,

Davide
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101019/93f784c9/attachment.htm>

From simon at rabbitmq.com  Tue Oct 19 18:33:20 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Oct 2010 18:33:20 +0100
Subject: [rabbitmq-discuss] Management plugin changelog 2.1.0 -> 2.1.1
Message-ID: <4CBDD660.3070802@rabbitmq.com>

The management plugin has received quite a bit of attention between
2.1.0 and 2.1.1. Since we don't normally provide changelogs for
plugins as part of the main RabbitMQ changelog, I thought it'd be good
to provide an independent one here. I'm not guaranteeing to do this
again; not least because I doubt the management plugin will see such
intensive development in future; the last month or so has been quite
busy...

The headline features include many bug fixes and UI improvements,
import and export of the server configuration, ability for
non-administrators to use the web UI, and an experimental command
line tool. I would strongly recommend you upgrade if you can; the number 
of bugfixes alone should be worth it...

If you want to try the command line tool browse to
http://<server_name>:55672/cli/. You will need Python installed. And
please bear in mind it's experimental :)

Detailed changes are below:

enhancements
  - Import / export broker configuration to text file
  - Aliveness test for HTTP monitoring tools
  - Support arguments in exchange / queue / binding declare
  - Optimize file descriptor counting on Linux
  - Truncate very long lists in the web UI
  - Automatically refresh lists / statistics in web UI
  - Make the web UI usable for non-administrators
  - Allow queues to be purged
  - Support 'client_flow' channel info item
  - Filter listing pages by virtual host
  - Sort listings sensibly by default. Allow the user to choose other
    orderings.
  - Support exchange-to-exchange bindings
  - List the channels within a connection
  - Provide an experimental command line tool
  - All sorts of visual and usability tweaks :)

bug fixes
  - Fix use of non-ASCII characters in names.
  - Fix the bug throwing {function_clause,[{proplists,get_value,[rate,...
    when new connections appear.
  - Correctly show arguments in web UI
  - Fix queue length showing as "?" after broker restart
  - Fix the web UI to work with MSIE 6.0+
  - Fix failure on startup when memory monitor disabled
  - Much more automated test coverage

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jasonjwwilliams at gmail.com  Tue Oct 19 18:43:51 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 19 Oct 2010 11:43:51 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1 release
In-Reply-To: <4CBDD5D2.9030901@rabbitmq.com>
References: <4CBDD5D2.9030901@rabbitmq.com>
Message-ID: <AANLkTikaXVDt7ASUPzCjw1oXgpEOAZ70Bz8xwvkg0d_=@mail.gmail.com>

Wow guys sneaking in Exchange 2 Exchange bindings is really cool.
Impressive for a point release.

Thank you. You all do phenomenal work.

-J

On Tue, Oct 19, 2010 at 11:30 AM, Vlad Alexandru Ionescu
<vlad at rabbitmq.com> wrote:
>
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.1.
>
> This release fixes a number of bugs and introduces some enhancements,
> including exchange to exchange bindings and some performance
> improvements, in the server and clients.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
>
> Regards,
>
> ?The RabbitMQ Team
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jasonjwwilliams at gmail.com  Tue Oct 19 18:48:49 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 19 Oct 2010 11:48:49 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1 release
In-Reply-To: <4CBDD5D2.9030901@rabbitmq.com>
References: <4CBDD5D2.9030901@rabbitmq.com>
Message-ID: <AANLkTiny9PpQEKEah54mR19pvLSckgQLp8Ndc7K3=OP=@mail.gmail.com>

BTW, rabbitmq-server-generic-unix-2.1.1.tar.gz unpacks into a
directory still called 2.1.0.

-J

On Tue, Oct 19, 2010 at 11:30 AM, Vlad Alexandru Ionescu
<vlad at rabbitmq.com> wrote:
>
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.1.
>
> This release fixes a number of bugs and introduces some enhancements,
> including exchange to exchange bindings and some performance
> improvements, in the server and clients.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
>
> Regards,
>
> ?The RabbitMQ Team
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From vlad at rabbitmq.com  Tue Oct 19 18:54:33 2010
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Tue, 19 Oct 2010 18:54:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1 release
In-Reply-To: <AANLkTiny9PpQEKEah54mR19pvLSckgQLp8Ndc7K3=OP=@mail.gmail.com>
References: <4CBDD5D2.9030901@rabbitmq.com>
	<AANLkTiny9PpQEKEah54mR19pvLSckgQLp8Ndc7K3=OP=@mail.gmail.com>
Message-ID: <4CBDDB59.4040503@rabbitmq.com>


No it does not, I double checked it.

Rgds,
Vlad.


On 10/19/2010 06:48 PM, Jason J. W. Williams wrote:
> BTW, rabbitmq-server-generic-unix-2.1.1.tar.gz unpacks into a
> directory still called 2.1.0.
>
> -J
>
> On Tue, Oct 19, 2010 at 11:30 AM, Vlad Alexandru Ionescu
> <vlad at rabbitmq.com>  wrote:
>    
>> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.1.
>>
>> This release fixes a number of bugs and introduces some enhancements,
>> including exchange to exchange bindings and some performance
>> improvements, in the server and clients.
>>
>> As always, we welcome any questions, bug reports, and other feedback on
>> this release, as well as general suggestions for features and
>> enhancements in future releases. Mail us via the RabbitMQ discussion
>> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
>> info at rabbitmq.com.
>>
>>
>> Regards,
>>
>>   The RabbitMQ Team
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>      

From jasonjwwilliams at gmail.com  Tue Oct 19 18:57:53 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 19 Oct 2010 11:57:53 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.1.1 release
In-Reply-To: <4CBDDB59.4040503@rabbitmq.com>
References: <4CBDD5D2.9030901@rabbitmq.com>
	<AANLkTiny9PpQEKEah54mR19pvLSckgQLp8Ndc7K3=OP=@mail.gmail.com>
	<4CBDDB59.4040503@rabbitmq.com>
Message-ID: <AANLkTin6AA4nUqLtumvkf_DqnG+4NiNNoMV-7UYDJnu=@mail.gmail.com>

Wierd. I must have had a 2.1.0 dir I didn't get to installing. Apologies.

-J

On Tue, Oct 19, 2010 at 11:54 AM, Vlad Alexandru Ionescu
<vlad at rabbitmq.com> wrote:
>
> No it does not, I double checked it.
>
> Rgds,
> Vlad.
>
>
> On 10/19/2010 06:48 PM, Jason J. W. Williams wrote:
>>
>> BTW, rabbitmq-server-generic-unix-2.1.1.tar.gz unpacks into a
>> directory still called 2.1.0.
>>
>> -J
>>
>> On Tue, Oct 19, 2010 at 11:30 AM, Vlad Alexandru Ionescu
>> <vlad at rabbitmq.com> ?wrote:
>>
>>>
>>> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.1.1.
>>>
>>> This release fixes a number of bugs and introduces some enhancements,
>>> including exchange to exchange bindings and some performance
>>> improvements, in the server and clients.
>>>
>>> As always, we welcome any questions, bug reports, and other feedback on
>>> this release, as well as general suggestions for features and
>>> enhancements in future releases. Mail us via the RabbitMQ discussion
>>> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
>>> info at rabbitmq.com.
>>>
>>>
>>> Regards,
>>>
>>> ?The RabbitMQ Team
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>

From michael at ndrix.org  Tue Oct 19 19:28:57 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Tue, 19 Oct 2010 12:28:57 -0600
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <20101019154231.GK6803@rabbitmq.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
	<20101019154231.GK6803@rabbitmq.com>
Message-ID: <AANLkTi=_9ohbZbDoBq8dQRVc-kGV7ONbZqnk8OU9kCK9@mail.gmail.com>

I'll send a packet capture off list (since the capture has server and
login info in it).

The Haskell library explicitly mentions that it doesn't close channels
yet and there are TODO comments in the code for closing connections.

-- 
Michael

On Tue, Oct 19, 2010 at 9:42 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Oct 19, 2010 at 09:10:08AM -0600, Michael Hendricks wrote:
>> These tests were done with the Haskell library.
>
> I'm not sure, but this could be that the library isn't doing shutdown
> correctly - the "error" is rather erroneously labelled an error due to
> OTP rather than our choice. Is there any chance you could put the
> tracer[0] in between the broker and the client - I'm curious as to
> whether the Haskell library is doing the correct sequence of
> close methods.
>
> [0] http://www.rabbitmq.com/examples.html#tracer
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tim at cantemo.com  Tue Oct 19 20:41:08 2010
From: tim at cantemo.com (Tim Child)
Date: Tue, 19 Oct 2010 21:41:08 +0200
Subject: [rabbitmq-discuss] RabbitMQ running on VMWare
In-Reply-To: <AANLkTin6AA4nUqLtumvkf_DqnG+4NiNNoMV-7UYDJnu=@mail.gmail.com>
References: <4CBDD5D2.9030901@rabbitmq.com>
	<AANLkTiny9PpQEKEah54mR19pvLSckgQLp8Ndc7K3=OP=@mail.gmail.com>
	<4CBDDB59.4040503@rabbitmq.com>
	<AANLkTin6AA4nUqLtumvkf_DqnG+4NiNNoMV-7UYDJnu=@mail.gmail.com>
Message-ID: <02A5DCD2-D013-4011-B5CD-E54261A64605@cantemo.com>

Hi,

What are the thoughts on deploying RabbitMQ 2.1.1 on to VMWare ESXi?

From what I have seen RabbitMQ likes memory, and fast disk access (where I feel that ESXi needs a lot of pre-thought) is not so important?

I know it depends on the messaging throughput but I am only talking about a couple of thousand messages an hour at peak and at the start far less than that.

Any experiences on that?

Thanks,

Tim.

From shane at digitalsanctum.com  Tue Oct 19 21:11:05 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 19 Oct 2010 13:11:05 -0700 (PDT)
Subject: [rabbitmq-discuss] plugin warnings on startup for 2.1.1
Message-ID: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>

I just installed 2.1.1 with the management plugin and I'm getting the
following warnings:

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
5 plugins activated:
* amqp_client-2.1.1
* mochiweb-1.3
* rabbit_management-2.1.1
* rabbit_mochiweb-2.1.1
* webmachine-1.7.0


I'm using Erlang R13B04 on Windows XP.

The broker can process messages but I'm not getting any message rates
numbers on the management overview page.

From alexandru at rabbitmq.com  Tue Oct 19 23:04:16 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 19 Oct 2010 23:04:16 +0100
Subject: [rabbitmq-discuss] plugin warnings on startup for 2.1.1
In-Reply-To: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>
References: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>
Message-ID: <20101019220416.GA2365@dakota>

Hi,

> I just installed 2.1.1 with the management plugin and I'm getting the
> following warnings:
> 
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 5 plugins activated:
> * amqp_client-2.1.1
> * mochiweb-1.3
> * rabbit_management-2.1.1
> * rabbit_mochiweb-2.1.1
> * webmachine-1.7.0

Those warnings are normal.  Mochiweb uses some functions in some modules
we don't distribute.  One of our startup checks catches this and
complains.  Since we never actually use those functions, it shouldn't be
a problem.

> The broker can process messages but I'm not getting any message rates
> numbers on the management overview page.

Works on Linux, kind of.

If I start the broker, look at the management Overview page, I see
"Currently Idle" under message rates.  If I startup MulticastMain to
generate some traffic, that text disappears.  If I then collapse the
Message Rates section and expand it, I get the message rates.  All of
this is using Chromium and Firefox.

Could you check if this is what's happening in your case?

Also, what browser are you using?

Cheers,
Alex

On Tue, Oct 19, 2010 at 01:11:05PM -0700, Shane wrote:
> I just installed 2.1.1 with the management plugin and I'm getting the
> following warnings:
> 
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 5 plugins activated:
> * amqp_client-2.1.1
> * mochiweb-1.3
> * rabbit_management-2.1.1
> * rabbit_mochiweb-2.1.1
> * webmachine-1.7.0
> 
> 
> I'm using Erlang R13B04 on Windows XP.
> 
> The broker can process messages but I'm not getting any message rates
> numbers on the management overview page.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shane at digitalsanctum.com  Tue Oct 19 23:28:44 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 19 Oct 2010 15:28:44 -0700 (PDT)
Subject: [rabbitmq-discuss] plugin warnings on startup for 2.1.1
In-Reply-To: <20101019220416.GA2365@dakota>
References: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>
	<20101019220416.GA2365@dakota>
Message-ID: <621d299f-7ba9-44ef-8c97-8223581c0608@l8g2000yql.googlegroups.com>

Alex,

I'm on windows using IE 7. I tried your workaround but nothing shows
up. If I try FF 3.6.3 I can get the "Deliver" and "Acknowledge"
elements to show up but they stay at 0 msg/s.

Thanks,
Shane

On Oct 19, 6:04?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> Hi,
>
> > I just installed 2.1.1 with the management plugin and I'm getting the
> > following warnings:
>
> > Activating RabbitMQ plugins ...
> > *WARNING* Undefined function fdsrv:bind_socket/2
> > *WARNING* Undefined function fdsrv:start/0
> > *WARNING* Undefined function fdsrv:stop/0
> > *WARNING* Undefined function webmachine_resource:start_link/2
> > 5 plugins activated:
> > * amqp_client-2.1.1
> > * mochiweb-1.3
> > * rabbit_management-2.1.1
> > * rabbit_mochiweb-2.1.1
> > * webmachine-1.7.0
>
> Those warnings are normal. ?Mochiweb uses some functions in some modules
> we don't distribute. ?One of our startup checks catches this and
> complains. ?Since we never actually use those functions, it shouldn't be
> a problem.
>
> > The broker can process messages but I'm not getting any message rates
> > numbers on the management overview page.
>
> Works on Linux, kind of.
>
> If I start the broker, look at the management Overview page, I see
> "Currently Idle" under message rates. ?If I startup MulticastMain to
> generate some traffic, that text disappears. ?If I then collapse the
> Message Rates section and expand it, I get the message rates. ?All of
> this is using Chromium and Firefox.
>
> Could you check if this is what's happening in your case?
>
> Also, what browser are you using?
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Tue, Oct 19, 2010 at 01:11:05PM -0700, Shane wrote:
> > I just installed 2.1.1 with the management plugin and I'm getting the
> > following warnings:
>
> > Activating RabbitMQ plugins ...
> > *WARNING* Undefined function fdsrv:bind_socket/2
> > *WARNING* Undefined function fdsrv:start/0
> > *WARNING* Undefined function fdsrv:stop/0
> > *WARNING* Undefined function webmachine_resource:start_link/2
> > 5 plugins activated:
> > * amqp_client-2.1.1
> > * mochiweb-1.3
> > * rabbit_management-2.1.1
> > * rabbit_mochiweb-2.1.1
> > * webmachine-1.7.0
>
> > I'm using Erlang R13B04 on Windows XP.
>
> > The broker can process messages but I'm not getting any message rates
> > numbers on the management overview page.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From timp at paneris.org  Wed Oct 20 00:48:30 2010
From: timp at paneris.org (Tim Pizey)
Date: Wed, 20 Oct 2010 00:48:30 +0100
Subject: [rabbitmq-discuss] Problem with plugin development guide example
Message-ID: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>

Hi,

this is my first outing with rabbitmq, erlang and make so apologies if
I have made a stupid oversight.

I have installed erlang:
 Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:0] [kernel-poll:false]
Eshell V5.8

(and zip)

on my uptodate debian amd64 sid which gives GNU Make 3.81

I have followed the example at http://www.rabbitmq.com/plugin-development.html
and can get rabbit-server running without any plugins.

The result of running make in the rabbit_metronome directory is

Archive:  rabbit_common.ez
   creating: rabbit_common/
   creating: rabbit_common/include/
  inflating: rabbit_common/include/rabbit_msg_store.hrl
  inflating: rabbit_common/include/rabbit_msg_store_index.hrl
  inflating: rabbit_common/include/rabbit_exchange_type_spec.hrl
  inflating: rabbit_common/include/rabbit.hrl
  inflating: rabbit_common/include/rabbit_backing_queue_spec.hrl
  inflating: rabbit_common/include/rabbit_framing.hrl
   creating: rabbit_common/ebin/
  inflating: rabbit_common/ebin/rabbit_framing_amqp_0_8.beam
  inflating: rabbit_common/ebin/rabbit_common.app
  inflating: rabbit_common/ebin/rabbit_net.beam
  inflating: rabbit_common/ebin/rabbit_exchange_type.beam
  inflating: rabbit_common/ebin/rabbit_binary_parser.beam
  inflating: rabbit_common/ebin/rabbit_framing_channel.beam
  inflating: rabbit_common/ebin/rabbit_channel.beam
  inflating: rabbit_common/ebin/priority_queue.beam
  inflating: rabbit_common/ebin/supervisor2.beam
  inflating: rabbit_common/ebin/rabbit_writer.beam
  inflating: rabbit_common/ebin/rabbit_misc.beam
  inflating: rabbit_common/ebin/gen_server2.beam
  inflating: rabbit_common/ebin/rabbit_msg_store_index.beam
  inflating: rabbit_common/ebin/rabbit_basic.beam
  inflating: rabbit_common/ebin/rabbit_framing_amqp_0_9_1.beam
  inflating: rabbit_common/ebin/rabbit_binary_generator.beam
  inflating: rabbit_common/ebin/rabbit_heartbeat.beam
  inflating: rabbit_common/ebin/rabbit_reader.beam
ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
ebin src/rabbit_metronome.erl
ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
ebin src/rabbit_metronome_sup.erl
ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
ebin src/rabbit_metronome_worker.erl
make: *** No rule to make target `ebin/.app', needed by
`dist/rabbitmq-metronome.ez'.  Stop.

I can get it to complete by touching ebin/.app
however that creates a corrupt package

I manually removed rabbit_metronome/dist/ebin/.app and manually repackaged,
but the server still crashes on startup.

Is there a bash script, or a repository copy of a working version of the
metronome app, so that can check if I have made a typo somewhere?

I do not know make well enough, but it looks like a list has an
additional empty member.

yours
Tim Pizey






-- 
Tim Pizey
http://pizey.net/~timp

From matthew at rabbitmq.com  Wed Oct 20 01:01:41 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Oct 2010 01:01:41 +0100
Subject: [rabbitmq-discuss] Problem with plugin development guide example
In-Reply-To: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>
References: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>
Message-ID: <20101020000140.GA28186@wellquite.org>

On Wed, Oct 20, 2010 at 12:48:30AM +0100, Tim Pizey wrote:
> this is my first outing with rabbitmq, erlang and make so apologies if
> I have made a stupid oversight.

You have not. The plugin development guide is out of date. It is
unlikely to be corrected before bug23274 lands, which substantially
alters plugin development again (albeit for the better).

To be honest, at this stage, I'd recommend updating the public umbrella
to bug23274, taking a look at some of the exchange Makefile and
package.mk in repos such as rabbitmq-shovel (again, on branch bug23274),
and reading the README.makefiles in the public umbrella. Much of the
plugin development guide will still be correct, but where it talks about
Makefiles and such like, it'll be badly wrong. If you're developing a
plugin that works with the erlang client (more than likely the case),
you'll also want that on branch bug23274 - in fact, is just safest to
have _everything_ on that branch, right at the moment ;)

Apologies for this situation - hopefully it should be sorted out
reasonably soon.

Matthew

From jdetreville at vmware.com  Wed Oct 20 04:45:48 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Tue, 19 Oct 2010 20:45:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ running on VMWare
In-Reply-To: <mailman.1006.1287525866.13459.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1006.1287525866.13459.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <EFBFD63F-0F2A-4090-9049-E045E02E0DCD@vmware.com>

Tim,

We're talking about a peak load of about 1 msg/second, right? This is about a millionth of what RabbitMQ can handle on physical hardware, and I'd doubt that the overhead of any virtualization platform would be that great. I'd expect that everything should work just fine.

That said, things don't always work out exactly as they should, and I know we'd be very interested to learn about performance problems (and non-problems) running RabbitMQ under virtualization. If there are practical gotchas, we should fix them or at least document them.

Disclaimer: I just joined the RabbitMQ team from elsewhere in VMware. I have no personal experience running RabbitMQ under ESXi. I spell "virtualization" the American way.

Cheers,
John

From: Tim Child <tim at cantemo.com<mailto:tim at cantemo.com>>
Date: October 19, 2010 12:41:08 PM PDT
To: RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] RabbitMQ running on VMWare

Hi,

What are the thoughts on deploying RabbitMQ 2.1.1 on to VMWare ESXi?

>From what I have seen RabbitMQ likes memory, and fast disk access (where I feel that ESXi needs a lot of pre-thought) is not so important?

I know it depends on the messaging throughput but I am only talking about a couple of thousand messages an hour at peak and at the start far less than that.

Any experiences on that?

Thanks,

Tim.

From dbecker at cpicorp.com  Wed Oct 20 05:04:29 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Tue, 19 Oct 2010 23:04:29 -0500
Subject: [rabbitmq-discuss] RabbitMQ running on VMWare
In-Reply-To: <EFBFD63F-0F2A-4090-9049-E045E02E0DCD@vmware.com>
References: <mailman.1006.1287525866.13459.rabbitmq-discuss@lists.rabbitmq.com>
	<EFBFD63F-0F2A-4090-9049-E045E02E0DCD@vmware.com>
Message-ID: <4CBE6A4D.2090507@cpicorp.com>

As long as we're discussing running RabbitMQ on VMWare, we're looking at
running a broker on a pair of fault-tolerant VMs. Supposedly this should
allow an active/passive cluster with full redundancy of not just
metadata but QUEUES. We'll ping the list with testing results.

Derek

From dbecker at cpicorp.com  Wed Oct 20 05:14:06 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Tue, 19 Oct 2010 23:14:06 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CB82381.1040302@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
Message-ID: <4CBE6C8E.9070304@cpicorp.com>

So, I've been doing some testing today with backing up the data store
for a broker to another machine and so far things have been working. If
I shut down the broker, copy the /var/lib/rabbitmq directory from the
server to a backup host, then start a new broker on the backup host,
durable queues/exchanges show up, persistent messages are exactly as
they were on the primary host, etc. I would be rather surprised if this
didn't work, but I wanted to throw this out there as a data point.

What's more interesting is that if I copy the /var/lib/rabbitmq
directory to the backup host *without stopping the primary broker*, and
then stop the primary and start the backup, everything still appears to
work fine. Now, I suspect that with the low volume I'm pushing here I'm
just getting lucky and not copying files in an inconsistent state, but
it made me think of possibly another approach to making backups: would
it be possible to implement a "pause/snapshot" for the broker such that
it would flush data, hold off on writes, etc. so that I could copy the
data in a consistent state. I could then issue a "resume" and all of the
clients would just continue on their merry way. At least this way the
sockets and socket bindings would stay open so that as far as clients
are concerned my broker is just being reaaaaallly slow.

Thanks,

Derek

From vbarat at ubikod.com  Wed Oct 20 08:19:30 2010
From: vbarat at ubikod.com (Vincent Barat)
Date: Wed, 20 Oct 2010 09:19:30 +0200
Subject: [rabbitmq-discuss] Is the "master" node mandatory ?
In-Reply-To: <20101019163516.GM6803@rabbitmq.com>
References: <4CBD991B.3080704@ubikod.com>
	<20101019131405.GE6803@rabbitmq.com>	<4CBDC73F.4080301@ubikod.com>
	<20101019163516.GM6803@rabbitmq.com>
Message-ID: <4CBE9802.20300@ubikod.com>

  Thank you for this long reply, I was not aware about that.

In our use case, all queues are not persistent. Thus, when a node 
fails, all messages of all queues it handles are lost (since 
messages are not replicated between nodes).
This situation is ok for us (anyway there is nothing we can do to 
prevent this, except to upgrade to RabbitMQ 2.0 with persistent 
queues, something we plan to do, but throughput being our main 
concern, we need to benchmark it first).

For the moment, what we must ensure is not to lose the global list 
of exchanges declared by producers on node failure.
AFAIK, this list is maintained in mnesia. If all nodes fails, 
because they are all RAM nodes, we lose this exchange list. But in 
that case, producers would recreate all exchange at reconnection 
time, whatever the node that is restarted first.

To summarize, the list of exchanges and queues are recreated at 
reconnection time by producers and consumers, thus, the "state" of 
the cluster can be lost. That's why I think we can use RAM node 
only. But maybe the "state" of the cluster is not limited to the 
list of exchanges and queues ?


Le 19/10/10 18:35, Matthew Sackman a ?crit :
> On Tue, Oct 19, 2010 at 06:28:47PM +0200, Vincent Barat wrote:
>> My two nodes are RAM nodes actually.
> Ahh. From http://rabbitmq.com/clustering.html:
>
> "Because state is replicated across all nodes in the cluster, it is
> sufficient to have just one disk node within a cluster, to store the
> state of the cluster safely. Beware, however, that RabbitMQ will not
> stop you from creating a cluster with only RAM nodes. Should you do
> this, and suffer a power failure to the entire cluster, the entire state
> of the cluster, including all messages, will be lost."
>
> I think we used to prevent you from building RAM-node-only clusters. We
> must have changed behaviour there a while ago. It makes sense that the
> last node to die needs to be brought up first: if a node goes down and
> it knew that it was part of a cluster, then when coming back up, it'll
> remember it was part of a cluster and try to reconnect to it - it will
> be very aware that any data it holds (in this case, none!) will likely
> be out of date and it needs to resync from the other nodes in the
> cluster - it'll have no knowledge that the other nodes also went down.
>
> That said, it's been a while since I played around with clusters so my
> information might be out of date.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From 0x6e6562 at gmail.com  Wed Oct 20 08:40:21 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Oct 2010 08:40:21 +0100
Subject: [rabbitmq-discuss] Management plugin changelog 2.1.0 -> 2.1.1
In-Reply-To: <4CBDD660.3070802@rabbitmq.com>
References: <4CBDD660.3070802@rabbitmq.com>
Message-ID: <AANLkTik74tgqFJpA85ZUeX8SGmw9MG6Ocsi=hZ6LEOOY@mail.gmail.com>

Hey Simon,

On Tue, Oct 19, 2010 at 6:33 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> ?- Allow queues to be purged

Could you envisage logging each message (as a binary) to disk during a
purge as a roadmap item for the management plugin? The use case would
be where you're pretty sure you can happily turf the messages in a
queue, but just wanted to keep a backup in case your judgement was
wrong. Or is this something you should just script with basic.get and
log to disk? Or some other means?

Cheers,

Ben

From timp at paneris.org  Wed Oct 20 09:47:47 2010
From: timp at paneris.org (Tim Pizey)
Date: Wed, 20 Oct 2010 09:47:47 +0100
Subject: [rabbitmq-discuss] Problem with plugin development guide example
In-Reply-To: <20101020000140.GA28186@wellquite.org>
References: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>
	<20101020000140.GA28186@wellquite.org>
Message-ID: <AANLkTi=PMzkFzuBjN4nNF7QDnKS7S0eE2HqHqiCr=-sc@mail.gmail.com>

Hi Matthew,

On 20 October 2010 01:01, Matthew Sackman  wrote:
> On Wed, Oct 20, 2010 at 12:48:30AM +0100, Tim Pizey wrote:
>> this is my first outing with rabbitmq, erlang and make so apologies if
>> I have made a stupid oversight.
>
> You have not. The plugin development guide is out of date. It is
> unlikely to be corrected before bug23274 lands, which substantially
> alters plugin development again (albeit for the better).
>
> To be honest, at this stage, I'd recommend updating the public umbrella
> to bug23274, taking a look at some of the exchange Makefile and
> package.mk in repos such as rabbitmq-shovel (again, on branch bug23274),
> and reading the README.makefiles in the public umbrella. Much of the
> plugin development guide will still be correct, but where it talks about
> Makefiles and such like, it'll be badly wrong. If you're developing a
> plugin that works with the erlang client (more than likely the case),
> you'll also want that on branch bug23274 - in fact, is just safest to
> have _everything_ on that branch, right at the moment ;)
>
> Apologies for this situation - hopefully it should be sorted out
> reasonably soon.
>
> Matthew

Thank you for your rapid reply.

However, I have wasted 2 hours in self-doubt and error;
how difficult is it to update an introductory document,
and to put its content into a CI environment  so that
someone notices when it breaks?

My actual objective is to get rabbithub running, but I thought
I would do the "Hello world" exercise as a warm up, never having
used this tool chain before.

thanks for the reply
Tim




-- 
Tim Pizey
http://pizey.net/~timp

From simon at rabbitmq.com  Wed Oct 20 10:56:58 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 10:56:58 +0100
Subject: [rabbitmq-discuss] Management plugin changelog 2.1.0 -> 2.1.1
In-Reply-To: <AANLkTik74tgqFJpA85ZUeX8SGmw9MG6Ocsi=hZ6LEOOY@mail.gmail.com>
References: <4CBDD660.3070802@rabbitmq.com>
	<AANLkTik74tgqFJpA85ZUeX8SGmw9MG6Ocsi=hZ6LEOOY@mail.gmail.com>
Message-ID: <4CBEBCEA.1030608@rabbitmq.com>

On 20/10/10 08:40, Ben Hood wrote:
> Hey Simon,
>
> On Tue, Oct 19, 2010 at 6:33 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>>   - Allow queues to be purged
>
> Could you envisage logging each message (as a binary) to disk during a
> purge as a roadmap item for the management plugin? The use case would
> be where you're pretty sure you can happily turf the messages in a
> queue, but just wanted to keep a backup in case your judgement was
> wrong. Or is this something you should just script with basic.get and
> log to disk? Or some other means?

I think this is a broker issue rather than one specifically for the 
management plugin.

Are you talking about some scenario where the broker could reinsert the 
purged messages if necessary? That might be... involved. Of course, it 
could move them to another queue (we've been idly thinking about that) 
but I don't know if that solves your problem. If all you want is a log, 
scripting something with basic.get is probably simple enough.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexis at rabbitmq.com  Wed Oct 20 11:00:18 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 20 Oct 2010 11:00:18 +0100
Subject: [rabbitmq-discuss] Problem with plugin development guide example
In-Reply-To: <AANLkTi=PMzkFzuBjN4nNF7QDnKS7S0eE2HqHqiCr=-sc@mail.gmail.com>
References: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>
	<20101020000140.GA28186@wellquite.org>
	<AANLkTi=PMzkFzuBjN4nNF7QDnKS7S0eE2HqHqiCr=-sc@mail.gmail.com>
Message-ID: <AANLkTimrO50n6Wr+E19+HwR2JPMsSRDGiFwgnW2QM0q8@mail.gmail.com>

Tim,

Hello :-)

On Wed, Oct 20, 2010 at 9:47 AM, Tim Pizey <timp at paneris.org> wrote:
>
> Thank you for your rapid reply.
>
> However, I have wasted 2 hours in self-doubt and error;
> how difficult is it to update an introductory document,
> and to put its content into a CI environment ?so that
> someone notices when it breaks?

I'm sorry you had a bad experience.  We are working as hard as we can
on multiple fronts ranging from better HA to better docs.  The answer
to your question is that it *is* difficult to do that because we don't
have a CI environment right now.  Yes, it would help in lots of ways
to have one!


> My actual objective is to get rabbithub running, but I thought
> I would do the "Hello world" exercise as a warm up, never having
> used this tool chain before.

Mike, cc'd, may be able to give you some pointers on RabbitHub..

alexis



> thanks for the reply
> Tim
>
>
>
>
> --
> Tim Pizey
> http://pizey.net/~timp
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Wed Oct 20 11:05:05 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 11:05:05 +0100
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CBE6C8E.9070304@cpicorp.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
	<4CBE6C8E.9070304@cpicorp.com>
Message-ID: <4CBEBED1.8070107@rabbitmq.com>

On 20/10/10 05:14, Derek Chen-Becker wrote:
> What's more interesting is that if I copy the /var/lib/rabbitmq
> directory to the backup host *without stopping the primary broker*, and
> then stop the primary and start the backup, everything still appears to
> work fine. Now, I suspect that with the low volume I'm pushing here I'm
> just getting lucky and not copying files in an inconsistent state,

Probably not. Rabbit is designed to repair queues when it comes up 
again, so if you're copying queues when they're inconsistent it'll get 
fixed by the time the backup broker is accepting connections. Of course, 
if you're unlucky, you could lose a few messages in such a process but 
from what you've said before it sounds like that isn't your biggest concern?

Of course with buffering involved messages can take a while to be 
written to disk. Transactions around publishes will help here - when you 
get commit-ok back you know any persistent messages are on disk.

> but
> it made me think of possibly another approach to making backups: would
> it be possible to implement a "pause/snapshot" for the broker such that
> it would flush data, hold off on writes, etc. so that I could copy the
> data in a consistent state. I could then issue a "resume" and all of the
> clients would just continue on their merry way. At least this way the
> sockets and socket bindings would stay open so that as far as clients
> are concerned my broker is just being reaaaaallly slow.

Hmm, interesting idea. I'll see if we're interested in doing that. We're 
currently looking at how to make the HA experience better so this might 
be a possibility.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Oct 20 11:15:11 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 11:15:11 +0100
Subject: [rabbitmq-discuss] Batch Acknowledge
In-Reply-To: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>
Message-ID: <4CBEC12F.8000303@rabbitmq.com>

On 19/10/10 18:30, Davide Maestroni wrote:
> What I want to achieve is a queue in which all the messages persist
> until a "consumer" (not sure if it is really a consumer actually)  do
> some batch processing on N messages, like updating a separate DB, and,
> only when everything has completed correctly, send an acknowledge so
> that the queue can release the last delivered N messages.
> As per my understanding I can "declare" a queue and then start reading
> from it using basicGet() API. Then, after processing the desired number
> of messages, I call basicAck(deliveryTag, true) passing the tag of the
> last read message.
> In my case it is both important to keep the message ordering and not to
> lose any message even if the consumer or the broker crash.

Note that we only guarantee message ordering when messages are not 
redelivered. If your client dies with unacked messages about, those 
messages will be reinserted into the queue.

Example: the queue contains messages ABCDEF. You client consumes ABC, 
does not ack them, and dies. The queue will now contain DEFABC.

> In order to
> achieve that, I am going to publish messages "mandatory" and
> "persistent" and then send an ack in the consumer after successfully
> securing the data in some other place.
> What I want to be clear here is: is it correct to say that if the
> consumer crashes after M basicGet() (but before sending the ack), at
> restart the same M messages will be returned calling basicGet()? I.e.
> are the messages removed from the queue only after receiving the
> acknowledge?

They are only finally removed when the server sees the ack, but see 
above about ordering.

> If it is not so, do I have to call basicRecover()?

No. basic.recover allows you to say "pretend I crashed". It's not 100% 
obvious why this is useful, but it's in the spec. Note that you don't 
have to call recover after recovering from crashing...

> Can I do it even if I don't call basicConsume()?

Yes, the rules are exactly the same for consume vs get.

> And most importantly, which is the order of
> the messages when calling basicRecover() after a crash and restart of
> the consumer node?

Hopefully explained above.

> A final question: if a message is flagged as "mandatory", how long the
> queue wait for a consumer to be ready before returning the message to
> the sender?

"Mandatory" just means the message must get routed to a queue, not that 
anything must be listening on the queue. I think you mean "immediate". 
And in the immediate case, it really is immediate; there must be a 
consumer on the queue (no basic.get!), no messages already in the queue 
and the consumer must not be blocked for basic.qos or channel.flow reasons.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Oct 20 11:23:43 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 11:23:43 +0100
Subject: [rabbitmq-discuss] plugin warnings on startup for 2.1.1
In-Reply-To: <621d299f-7ba9-44ef-8c97-8223581c0608@l8g2000yql.googlegroups.com>
References: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>	<20101019220416.GA2365@dakota>
	<621d299f-7ba9-44ef-8c97-8223581c0608@l8g2000yql.googlegroups.com>
Message-ID: <4CBEC32F.9070909@rabbitmq.com>

On 19/10/10 23:28, Shane wrote:
 > On Oct 19, 6:04 pm, Alexandru Scvor?ov<alexan... at rabbitmq.com>  wrote:
 >> If I start the broker, look at the management Overview page, I see
 >> "Currently Idle" under message rates.  If I startup MulticastMain to
 >> generate some traffic, that text disappears.  If I then collapse the
 >> Message Rates section and expand it, I get the message rates.  All of
 >> this is using Chromium and Firefox.
>
> I'm on windows using IE 7. I tried your workaround but nothing shows
> up. If I try FF 3.6.3 I can get the "Deliver" and "Acknowledge"
> elements to show up but they stay at 0 msg/s.

Blimey. As soon as you release something you notice an obvious glitch. 
So the text "Currently idle" should not disappear until message rates 
are available. I'll get that fixed.

However, Alexandru's workaround is not needed. The message rates take 
10s to appear anyway (we get message counts every 5s, and need two to 
calculate a rate). I suspect the collapse / expand thing was just making 
Alexandru wait long enough :) Could this also be why you saw nothing 
with IE7? I've tested with IE6 and it works.

The fact that you're seeing "0 msg/s" is more concerning however. Is 
this in a cluster?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexandru at rabbitmq.com  Wed Oct 20 11:37:00 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Wed, 20 Oct 2010 11:37:00 +0100
Subject: [rabbitmq-discuss] plugin warnings on startup for 2.1.1
In-Reply-To: <4CBEC32F.9070909@rabbitmq.com>
References: <d677e972-e5e8-4c93-b94c-f37bb15bbee9@g18g2000yqk.googlegroups.com>
	<20101019220416.GA2365@dakota>
	<621d299f-7ba9-44ef-8c97-8223581c0608@l8g2000yql.googlegroups.com>
	<4CBEC32F.9070909@rabbitmq.com>
Message-ID: <20101020103700.GD2365@dakota>

> However, Alexandru's workaround is not needed. The message rates take 
> 10s to appear anyway (we get message counts every 5s, and need two to 
> calculate a rate). I suspect the collapse / expand thing was just making 
> Alexandru wait long enough :) 

Right.

On Wed, Oct 20, 2010 at 11:23:43AM +0100, Simon MacMullen wrote:
> On 19/10/10 23:28, Shane wrote:
>  > On Oct 19, 6:04 pm, Alexandru Scvor?ov<alexan... at rabbitmq.com>  wrote:
>  >> If I start the broker, look at the management Overview page, I see
>  >> "Currently Idle" under message rates.  If I startup MulticastMain to
>  >> generate some traffic, that text disappears.  If I then collapse the
>  >> Message Rates section and expand it, I get the message rates.  All of
>  >> this is using Chromium and Firefox.
> >
> > I'm on windows using IE 7. I tried your workaround but nothing shows
> > up. If I try FF 3.6.3 I can get the "Deliver" and "Acknowledge"
> > elements to show up but they stay at 0 msg/s.
> 
> Blimey. As soon as you release something you notice an obvious glitch. 
> So the text "Currently idle" should not disappear until message rates 
> are available. I'll get that fixed.
> 
> However, Alexandru's workaround is not needed. The message rates take 
> 10s to appear anyway (we get message counts every 5s, and need two to 
> calculate a rate). I suspect the collapse / expand thing was just making 
> Alexandru wait long enough :) Could this also be why you saw nothing 
> with IE7? I've tested with IE6 and it works.
> 
> The fact that you're seeing "0 msg/s" is more concerning however. Is 
> this in a cluster?
> 
> Cheers, Simon
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sameek at arosys.com  Wed Oct 20 12:49:27 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 20 Oct 2010 04:49:27 -0700 (PDT)
Subject: [rabbitmq-discuss] can Message is send in the form of XML in Queue?
Message-ID: <30009030.post@talk.nabble.com>


Hi

In my scenario message is put in request queue in the form of XML and
another end consumer can extract the XML message from queue. i not sure
about to messages are send in the form of XML in the queue.if it is possible
then please guide me ,that procedure to implement in my scenario.

any suggestion will be appreciable.

Thanks
-- 
View this message in context: http://old.nabble.com/can-Message-is-send-in-the-form-of-XML-in-Queue--tp30009030p30009030.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Wed Oct 20 12:51:23 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 12:51:23 +0100
Subject: [rabbitmq-discuss] can Message is send in the form of XML in
 Queue?
In-Reply-To: <30009030.post@talk.nabble.com>
References: <30009030.post@talk.nabble.com>
Message-ID: <4CBED7BB.3010207@rabbitmq.com>

On 20/10/10 12:49, sam_mis wrote:
> In my scenario message is put in request queue in the form of XML and
> another end consumer can extract the XML message from queue. i not sure
> about to messages are send in the form of XML in the queue.if it is possible
> then please guide me ,that procedure to implement in my scenario.

As far as RabbitMQ is concerned all messages are binary. So just 
serialise the XML into the message and deserialise it at the other end.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From sameek at arosys.com  Wed Oct 20 13:15:41 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 20 Oct 2010 05:15:41 -0700 (PDT)
Subject: [rabbitmq-discuss] can Message is send in the form of XML in
 Queue?
In-Reply-To: <4CBED7BB.3010207@rabbitmq.com>
References: <30009030.post@talk.nabble.com> <4CBED7BB.3010207@rabbitmq.com>
Message-ID: <30009239.post@talk.nabble.com>


Thanks for reply.could you please describe more detail about the "serialise
the XML into the message and deserialise it at the other end",if possible
then please provide some example about.

Simon MacMullen-2 wrote:
> 
> On 20/10/10 12:49, sam_mis wrote:
>> In my scenario message is put in request queue in the form of XML and
>> another end consumer can extract the XML message from queue. i not sure
>> about to messages are send in the form of XML in the queue.if it is
>> possible
>> then please guide me ,that procedure to implement in my scenario.
> 
> As far as RabbitMQ is concerned all messages are binary. So just 
> serialise the XML into the message and deserialise it at the other end.
> 
> Cheers, Simon
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/can-Message-is-send-in-the-form-of-XML-in-Queue--tp30009030p30009239.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Wed Oct 20 13:30:28 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Oct 2010 13:30:28 +0100
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <AANLkTi=_9ohbZbDoBq8dQRVc-kGV7ONbZqnk8OU9kCK9@mail.gmail.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
	<20101019154231.GK6803@rabbitmq.com>
	<AANLkTi=_9ohbZbDoBq8dQRVc-kGV7ONbZqnk8OU9kCK9@mail.gmail.com>
Message-ID: <20101020123027.GE15631@rabbitmq.com>

On Tue, Oct 19, 2010 at 12:28:57PM -0600, Michael Hendricks wrote:
> I'll send a packet capture off list (since the capture has server and
> login info in it).
> 
> The Haskell library explicitly mentions that it doesn't close channels
> yet and there are TODO comments in the code for closing connections.

Yup, that's the culprit. It's just straight closing the TCP socket which
causes these warnings to be emitted into the logs. I know they say
error, but you can safely ignore them. They've only been showing up
since 2.1.0 because we changed the relationships and organisation of
various processes.

You might like to gently poke the author of the Haskell library to do
the right thing with connection and channel closing. :)

Matthew

From akalend at mail.ru  Wed Oct 20 13:59:28 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Wed, 20 Oct 2010 16:59:28 +0400
Subject: [rabbitmq-discuss]
	=?windows-1251?q?can_Message_is_send_in_the_fo?=
	=?windows-1251?q?rm_of_XML_in_Queue=3F?=
In-Reply-To: <30009030.post@talk.nabble.com>
References: <30009030.post@talk.nabble.com>
Message-ID: <E1P8YGO-0005Gn-00.akalend-mail-ru@f122.mail.ru>

> Hi
> In my scenario message is put in request queue in the form of XML and
> another end consumer can extract the XML message from queue. i not sure
> about to messages are send in the form of XML in the queue.if it is possible
> then please guide me ,that procedure to implement in my scenario.
> any suggestion will be appreciable.
> Thanks

You can to use any Content-type type for your messages, include XML. You can to set the Content-type property 
for your messages as text/xml. 



From michael at ndrix.org  Wed Oct 20 15:05:35 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Wed, 20 Oct 2010 08:05:35 -0600
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <20101020123027.GE15631@rabbitmq.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
	<20101019154231.GK6803@rabbitmq.com>
	<AANLkTi=_9ohbZbDoBq8dQRVc-kGV7ONbZqnk8OU9kCK9@mail.gmail.com>
	<20101020123027.GE15631@rabbitmq.com>
Message-ID: <AANLkTinW7qmvf0r6rF+u9SK=WR6+O-uoj4i8hT08ncUX@mail.gmail.com>

I've notified the Haskell library developer.  Thank you for the help.

-- 
Michael

On Wed, Oct 20, 2010 at 6:30 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Oct 19, 2010 at 12:28:57PM -0600, Michael Hendricks wrote:
>> I'll send a packet capture off list (since the capture has server and
>> login info in it).
>>
>> The Haskell library explicitly mentions that it doesn't close channels
>> yet and there are TODO comments in the code for closing connections.
>
> Yup, that's the culprit. It's just straight closing the TCP socket which
> causes these warnings to be emitted into the logs. I know they say
> error, but you can safely ignore them. They've only been showing up
> since 2.1.0 because we changed the relationships and organisation of
> various processes.
>
> You might like to gently poke the author of the Haskell library to do
> the right thing with connection and channel closing. :)
>
> Matthew
>

From davide.maestroni at gmail.com  Wed Oct 20 15:56:39 2010
From: davide.maestroni at gmail.com (Davide Maestroni)
Date: Wed, 20 Oct 2010 16:56:39 +0200
Subject: [rabbitmq-discuss] Fwd:  Batch Acknowledge
In-Reply-To: <AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>
	<4CBEC12F.8000303@rabbitmq.com>
	<AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>
Message-ID: <AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>

BTW, does it make sense to use transactions in the consumer?

Davide

---------- Forwarded message ----------
From: Davide Maestroni <davide.maestroni at gmail.com>
Date: Wed, Oct 20, 2010 at 2:58 PM
Subject: Re: [rabbitmq-discuss] Batch Acknowledge
To: Simon MacMullen <simon at rabbitmq.com>


Hi Simon,

thank you very much for the quick reply!
Now I have a better understanding on how the message flow works. Still I
cannot find a way to achieve correct message ordering even after a crash.
My point here is: as soon as I read a message from the queue, the order of
that message is virtually lost, even if I try immediately to write the
message somewhere else. So if a crash happens after reading something,
either through "basic.get" or "basic.consume", it does not matter if the
acknowledge was sent or not, in any case I have no way to get the same
message(s) as the first one(s) after the recovery.
Is there no method to just "peek" into the queue? or, can you suggest me a
way to ensure ordering AND not lose any message at the same time?

Thanks,

Davide


On Wed, Oct 20, 2010 at 12:15 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 19/10/10 18:30, Davide Maestroni wrote:
>
>> What I want to achieve is a queue in which all the messages persist
>> until a "consumer" (not sure if it is really a consumer actually)  do
>> some batch processing on N messages, like updating a separate DB, and,
>> only when everything has completed correctly, send an acknowledge so
>> that the queue can release the last delivered N messages.
>> As per my understanding I can "declare" a queue and then start reading
>> from it using basicGet() API. Then, after processing the desired number
>> of messages, I call basicAck(deliveryTag, true) passing the tag of the
>> last read message.
>> In my case it is both important to keep the message ordering and not to
>> lose any message even if the consumer or the broker crash.
>>
>
> Note that we only guarantee message ordering when messages are not
> redelivered. If your client dies with unacked messages about, those messages
> will be reinserted into the queue.
>
> Example: the queue contains messages ABCDEF. You client consumes ABC, does
> not ack them, and dies. The queue will now contain DEFABC.
>
>
>  In order to
>> achieve that, I am going to publish messages "mandatory" and
>> "persistent" and then send an ack in the consumer after successfully
>> securing the data in some other place.
>> What I want to be clear here is: is it correct to say that if the
>> consumer crashes after M basicGet() (but before sending the ack), at
>> restart the same M messages will be returned calling basicGet()? I.e.
>> are the messages removed from the queue only after receiving the
>> acknowledge?
>>
>
> They are only finally removed when the server sees the ack, but see above
> about ordering.
>
>
>  If it is not so, do I have to call basicRecover()?
>>
>
> No. basic.recover allows you to say "pretend I crashed". It's not 100%
> obvious why this is useful, but it's in the spec. Note that you don't have
> to call recover after recovering from crashing...
>
>
>  Can I do it even if I don't call basicConsume()?
>>
>
> Yes, the rules are exactly the same for consume vs get.
>
>
>  And most importantly, which is the order of
>> the messages when calling basicRecover() after a crash and restart of
>> the consumer node?
>>
>
> Hopefully explained above.
>
>
>  A final question: if a message is flagged as "mandatory", how long the
>> queue wait for a consumer to be ready before returning the message to
>> the sender?
>>
>
> "Mandatory" just means the message must get routed to a queue, not that
> anything must be listening on the queue. I think you mean "immediate". And
> in the immediate case, it really is immediate; there must be a consumer on
> the queue (no basic.get!), no messages already in the queue and the consumer
> must not be blocked for basic.qos or channel.flow reasons.
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101020/e9a69641/attachment-0001.htm>

From dbecker at cpicorp.com  Wed Oct 20 16:00:27 2010
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Wed, 20 Oct 2010 10:00:27 -0500
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CBEBED1.8070107@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com>
	<4CB82381.1040302@rabbitmq.com>	<4CBE6C8E.9070304@cpicorp.com>
	<4CBEBED1.8070107@rabbitmq.com>
Message-ID: <4CBF040B.702@cpicorp.com>

On 10/20/2010 05:05 AM, Simon MacMullen wrote:
> On 20/10/10 05:14, Derek Chen-Becker wrote:
>> What's more interesting is that if I copy the /var/lib/rabbitmq
>> directory to the backup host *without stopping the primary broker*, and
>> then stop the primary and start the backup, everything still appears to
>> work fine. Now, I suspect that with the low volume I'm pushing here I'm
>> just getting lucky and not copying files in an inconsistent state,
> 
> Probably not. Rabbit is designed to repair queues when it comes up 
> again, so if you're copying queues when they're inconsistent it'll get 
> fixed by the time the backup broker is accepting connections. Of course, 
> if you're unlucky, you could lose a few messages in such a process but 
> from what you've said before it sounds like that isn't your biggest concern?

OK, that helps us a lot. Our main concern is with not having to
retransmit a large time-span of messages, but we can deal with a few
lost ones in the case where the primary broker goes down. Your note on
doing transacted publishes makes sense, so we'll modify our wrappers to
do that. I'm assuming there's some performance overhead with transacted
messages but with the low volume we're talking about that shouldn't be
an issue.

> Hmm, interesting idea. I'll see if we're interested in doing that. We're 
> currently looking at how to make the HA experience better so this might 
> be a possibility.

Thanks, any work to improve HA would be greatly appreciated.

Derek

From simon at rabbitmq.com  Wed Oct 20 16:00:56 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 16:00:56 +0100
Subject: [rabbitmq-discuss] Fwd:  Batch Acknowledge
In-Reply-To: <AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>	<4CBEC12F.8000303@rabbitmq.com>	<AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>
	<AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>
Message-ID: <4CBF0428.8020403@rabbitmq.com>

For your case it doesn't make much difference. The usual use case for 
consuming with transactions is some sort of message transformer that 
needs to consume and publish atomically.

Cheers, Simon

On 20/10/10 15:56, Davide Maestroni wrote:
> BTW, does it make sense to use transactions in the consumer?
>
> Davide
>
> ---------- Forwarded message ----------
> From: *Davide Maestroni* <davide.maestroni at gmail.com
> <mailto:davide.maestroni at gmail.com>>
> Date: Wed, Oct 20, 2010 at 2:58 PM
> Subject: Re: [rabbitmq-discuss] Batch Acknowledge
> To: Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>
> Hi Simon,
>
> thank you very much for the quick reply!
> Now I have a better understanding on how the message flow works. Still I
> cannot find a way to achieve correct message ordering even after a crash.
> My point here is: as soon as I read a message from the queue, the order
> of that message is virtually lost, even if I try immediately to write
> the message somewhere else. So if a crash happens after reading
> something, either through "basic.get" or "basic.consume", it does not
> matter if the acknowledge was sent or not, in any case I have no way to
> get the same message(s) as the first one(s) after the recovery.
> Is there no method to just "peek" into the queue? or, can you suggest me
> a way to ensure ordering AND not lose any message at the same time?
>
> Thanks,
>
> Davide
>
>
> On Wed, Oct 20, 2010 at 12:15 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 19/10/10 18:30, Davide Maestroni wrote:
>
>         What I want to achieve is a queue in which all the messages persist
>         until a "consumer" (not sure if it is really a consumer
>         actually)  do
>         some batch processing on N messages, like updating a separate
>         DB, and,
>         only when everything has completed correctly, send an acknowledge so
>         that the queue can release the last delivered N messages.
>         As per my understanding I can "declare" a queue and then start
>         reading
>         from it using basicGet() API. Then, after processing the desired
>         number
>         of messages, I call basicAck(deliveryTag, true) passing the tag
>         of the
>         last read message.
>         In my case it is both important to keep the message ordering and
>         not to
>         lose any message even if the consumer or the broker crash.
>
>
>     Note that we only guarantee message ordering when messages are not
>     redelivered. If your client dies with unacked messages about, those
>     messages will be reinserted into the queue.
>
>     Example: the queue contains messages ABCDEF. You client consumes
>     ABC, does not ack them, and dies. The queue will now contain DEFABC.
>
>
>         In order to
>         achieve that, I am going to publish messages "mandatory" and
>         "persistent" and then send an ack in the consumer after successfully
>         securing the data in some other place.
>         What I want to be clear here is: is it correct to say that if the
>         consumer crashes after M basicGet() (but before sending the ack), at
>         restart the same M messages will be returned calling basicGet()?
>         I.e.
>         are the messages removed from the queue only after receiving the
>         acknowledge?
>
>
>     They are only finally removed when the server sees the ack, but see
>     above about ordering.
>
>
>         If it is not so, do I have to call basicRecover()?
>
>
>     No. basic.recover allows you to say "pretend I crashed". It's not
>     100% obvious why this is useful, but it's in the spec. Note that you
>     don't have to call recover after recovering from crashing...
>
>
>         Can I do it even if I don't call basicConsume()?
>
>
>     Yes, the rules are exactly the same for consume vs get.
>
>
>         And most importantly, which is the order of
>         the messages when calling basicRecover() after a crash and
>         restart of
>         the consumer node?
>
>
>     Hopefully explained above.
>
>
>         A final question: if a message is flagged as "mandatory", how
>         long the
>         queue wait for a consumer to be ready before returning the
>         message to
>         the sender?
>
>
>     "Mandatory" just means the message must get routed to a queue, not
>     that anything must be listening on the queue. I think you mean
>     "immediate". And in the immediate case, it really is immediate;
>     there must be a consumer on the queue (no basic.get!), no messages
>     already in the queue and the consumer must not be blocked for
>     basic.qos or channel.flow reasons.
>
>     Cheers, Simon
>     --
>     Simon MacMullen
>     Staff Engineer, RabbitMQ
>     SpringSource, a division of VMware
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Oct 20 16:03:04 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 16:03:04 +0100
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CBF040B.702@cpicorp.com>
References: <4CB79022.1010407@cpicorp.com>	<4CB82381.1040302@rabbitmq.com>	<4CBE6C8E.9070304@cpicorp.com>	<4CBEBED1.8070107@rabbitmq.com>
	<4CBF040B.702@cpicorp.com>
Message-ID: <4CBF04A8.20903@rabbitmq.com>

On 20/10/10 16:00, Derek Chen-Becker wrote:
> I'm assuming there's some performance overhead with transacted
> messages

Yes - basically the cost of an fsync() per commit since we need to know 
the message is on disk.

> but with the low volume we're talking about that shouldn't be
> an issue.

Cool.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Wed Oct 20 16:05:40 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Oct 2010 16:05:40 +0100
Subject: [rabbitmq-discuss] Queue replication (I know, I know)
In-Reply-To: <4CBF04A8.20903@rabbitmq.com>
References: <4CB79022.1010407@cpicorp.com> <4CB82381.1040302@rabbitmq.com>
	<4CBE6C8E.9070304@cpicorp.com> <4CBEBED1.8070107@rabbitmq.com>
	<4CBF040B.702@cpicorp.com> <4CBF04A8.20903@rabbitmq.com>
Message-ID: <20101020150540.GA3607@rabbitmq.com>

On Wed, Oct 20, 2010 at 04:03:04PM +0100, Simon MacMullen wrote:
> On 20/10/10 16:00, Derek Chen-Becker wrote:
> >I'm assuming there's some performance overhead with transacted
> >messages
> 
> Yes - basically the cost of an fsync() per commit since we need to
> know the message is on disk.

Note that multiple txns that commit at the same time can in some cases
be coalesced into a single fsync. So you might see < 1 fsync per
transaction.

Matthew

From davide.maestroni at gmail.com  Wed Oct 20 16:23:50 2010
From: davide.maestroni at gmail.com (Davide Maestroni)
Date: Wed, 20 Oct 2010 17:23:50 +0200
Subject: [rabbitmq-discuss] Fwd: Batch Acknowledge
In-Reply-To: <4CBF0428.8020403@rabbitmq.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>
	<4CBEC12F.8000303@rabbitmq.com>
	<AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>
	<AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>
	<4CBF0428.8020403@rabbitmq.com>
Message-ID: <AANLkTi=vQWBbjY-cGAsaB5wCzrZYNEKB=HBmKV3=uctx@mail.gmail.com>

Hi Simon,

thank you again. I see that transactions are only meant for publications, so
they have no use in my case.
My problem here is that, in the architecture I have to implement, I could
receive a lot of messages in a very short time, so if the broker re-enqueues
not acknowledged ones they can end up to be re-sent thousands of messages
later. Which means that there's no way I can do the re-ordering on the
consumer side.
The first idea that comes into my mind is to re-publish the consumed
messages in a separate dedicated queue, so to limit the number of messages
in it, and then stop reading from the first queue until all the messages in
the second one has been read, re-ordered and correctly processed. Though,
there's still a case in which the consumer crashes before being able to
re-enqueue one message, thus effectively losing it.
I really can't see a solution to my problem... :-(

Best,

Davide

On Wed, Oct 20, 2010 at 5:00 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> For your case it doesn't make much difference. The usual use case for
> consuming with transactions is some sort of message transformer that needs
> to consume and publish atomically.
>
> Cheers, Simon
>
>
> On 20/10/10 15:56, Davide Maestroni wrote:
>
>> BTW, does it make sense to use transactions in the consumer?
>>
>> Davide
>>
>> ---------- Forwarded message ----------
>> From: *Davide Maestroni* <davide.maestroni at gmail.com
>> <mailto:davide.maestroni at gmail.com>>
>> Date: Wed, Oct 20, 2010 at 2:58 PM
>> Subject: Re: [rabbitmq-discuss] Batch Acknowledge
>> To: Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>>
>>
>> Hi Simon,
>>
>> thank you very much for the quick reply!
>> Now I have a better understanding on how the message flow works. Still I
>> cannot find a way to achieve correct message ordering even after a crash.
>> My point here is: as soon as I read a message from the queue, the order
>> of that message is virtually lost, even if I try immediately to write
>> the message somewhere else. So if a crash happens after reading
>> something, either through "basic.get" or "basic.consume", it does not
>> matter if the acknowledge was sent or not, in any case I have no way to
>> get the same message(s) as the first one(s) after the recovery.
>> Is there no method to just "peek" into the queue? or, can you suggest me
>> a way to ensure ordering AND not lose any message at the same time?
>>
>> Thanks,
>>
>> Davide
>>
>>
>> On Wed, Oct 20, 2010 at 12:15 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    On 19/10/10 18:30, Davide Maestroni wrote:
>>
>>        What I want to achieve is a queue in which all the messages persist
>>        until a "consumer" (not sure if it is really a consumer
>>        actually)  do
>>        some batch processing on N messages, like updating a separate
>>        DB, and,
>>        only when everything has completed correctly, send an acknowledge
>> so
>>        that the queue can release the last delivered N messages.
>>        As per my understanding I can "declare" a queue and then start
>>        reading
>>        from it using basicGet() API. Then, after processing the desired
>>        number
>>        of messages, I call basicAck(deliveryTag, true) passing the tag
>>        of the
>>        last read message.
>>        In my case it is both important to keep the message ordering and
>>        not to
>>        lose any message even if the consumer or the broker crash.
>>
>>
>>    Note that we only guarantee message ordering when messages are not
>>    redelivered. If your client dies with unacked messages about, those
>>    messages will be reinserted into the queue.
>>
>>    Example: the queue contains messages ABCDEF. You client consumes
>>    ABC, does not ack them, and dies. The queue will now contain DEFABC.
>>
>>
>>        In order to
>>        achieve that, I am going to publish messages "mandatory" and
>>        "persistent" and then send an ack in the consumer after
>> successfully
>>        securing the data in some other place.
>>        What I want to be clear here is: is it correct to say that if the
>>        consumer crashes after M basicGet() (but before sending the ack),
>> at
>>        restart the same M messages will be returned calling basicGet()?
>>        I.e.
>>        are the messages removed from the queue only after receiving the
>>        acknowledge?
>>
>>
>>    They are only finally removed when the server sees the ack, but see
>>    above about ordering.
>>
>>
>>        If it is not so, do I have to call basicRecover()?
>>
>>
>>    No. basic.recover allows you to say "pretend I crashed". It's not
>>    100% obvious why this is useful, but it's in the spec. Note that you
>>    don't have to call recover after recovering from crashing...
>>
>>
>>        Can I do it even if I don't call basicConsume()?
>>
>>
>>    Yes, the rules are exactly the same for consume vs get.
>>
>>
>>        And most importantly, which is the order of
>>        the messages when calling basicRecover() after a crash and
>>        restart of
>>        the consumer node?
>>
>>
>>    Hopefully explained above.
>>
>>
>>        A final question: if a message is flagged as "mandatory", how
>>        long the
>>        queue wait for a consumer to be ready before returning the
>>        message to
>>        the sender?
>>
>>
>>    "Mandatory" just means the message must get routed to a queue, not
>>    that anything must be listening on the queue. I think you mean
>>    "immediate". And in the immediate case, it really is immediate;
>>    there must be a consumer on the queue (no basic.get!), no messages
>>    already in the queue and the consumer must not be blocked for
>>    basic.qos or channel.flow reasons.
>>
>>    Cheers, Simon
>>    --
>>    Simon MacMullen
>>    Staff Engineer, RabbitMQ
>>    SpringSource, a division of VMware
>>
>>    _______________________________________________
>>    rabbitmq-discuss mailing list
>>    rabbitmq-discuss at lists.rabbitmq.com
>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101020/3e144434/attachment-0001.htm>

From shane at digitalsanctum.com  Wed Oct 20 16:26:30 2010
From: shane at digitalsanctum.com (Shane)
Date: Wed, 20 Oct 2010 08:26:30 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.1.1: no such file or directory crypto.app
 message prevents broker from starting
Message-ID: <a46a589c-c235-4170-a9fd-3df715957cf6@l14g2000yqb.googlegroups.com>


A fresh install of 2.1.1 and the management plugin on Linux with
Erlang R14A prevents the broker from starting and has the following
output:

Activating RabbitMQ plugins ...
ERROR: failed to load application crypto:
{"no such file or directory","crypto.app"}


If I try without the management plugin, the broker starts but still
has the following output:

Activating RabbitMQ plugins ...
*WARNING* Undefined function crypto:des3_cbc_decrypt/5
*WARNING* Undefined function crypto:start/0
*WARNING* Undefined function ssl:close/1
*WARNING* Undefined function ssl:controlling_process/2
*WARNING* Undefined function ssl:peercert/1
*WARNING* Undefined function ssl:peername/1
*WARNING* Undefined function ssl:recv/3
*WARNING* Undefined function ssl:send/2
*WARNING* Undefined function ssl:sockname/1
*WARNING* Undefined function ssl:ssl_accept/3
0 plugins activated:


What do I need to do in order to get the management plugin working?


From matthew at rabbitmq.com  Wed Oct 20 16:43:47 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Oct 2010 16:43:47 +0100
Subject: [rabbitmq-discuss] 2.1.1: no such file or directory crypto.app
 message prevents broker from starting
In-Reply-To: <a46a589c-c235-4170-a9fd-3df715957cf6@l14g2000yqb.googlegroups.com>
References: <a46a589c-c235-4170-a9fd-3df715957cf6@l14g2000yqb.googlegroups.com>
Message-ID: <20101020154347.GB3607@rabbitmq.com>

On Wed, Oct 20, 2010 at 08:26:30AM -0700, Shane wrote:
> A fresh install of 2.1.1 and the management plugin on Linux with
> Erlang R14A prevents the broker from starting and has the following
> output:
> 
> Activating RabbitMQ plugins ...
> ERROR: failed to load application crypto:
> {"no such file or directory","crypto.app"}

Did you build erlang yourself? If so, you may need to rebuild, this time
with the openssl dev libraries installed as they'll be necessary for
crypto to be buildable.

Alternatively, you may just need to apt-get install erlang-ssl.

Or, you could have multiple versions of erlang installed, maybe some
with very old versions of crypto, which is now upsetting things.

If none of the above works, which distribution are you using, and how
did you install erlang?

Matthew

From simon at rabbitmq.com  Wed Oct 20 16:46:18 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 16:46:18 +0100
Subject: [rabbitmq-discuss] 2.1.1: no such file or directory crypto.app
 message prevents broker from starting
In-Reply-To: <20101020154347.GB3607@rabbitmq.com>
References: <a46a589c-c235-4170-a9fd-3df715957cf6@l14g2000yqb.googlegroups.com>
	<20101020154347.GB3607@rabbitmq.com>
Message-ID: <4CBF0ECA.4050000@rabbitmq.com>

On 20/10/10 16:43, Matthew Sackman wrote:
> On Wed, Oct 20, 2010 at 08:26:30AM -0700, Shane wrote:
>> A fresh install of 2.1.1 and the management plugin on Linux with
>> Erlang R14A prevents the broker from starting and has the following
>> output:
>>
>> Activating RabbitMQ plugins ...
>> ERROR: failed to load application crypto:
>> {"no such file or directory","crypto.app"}
>
<snip>
> If none of the above works, which distribution are you using, and how
> did you install erlang?

Also, how did you install RabbitMQ? Our debs and RPMs are *supposed* to 
sort all this out for you...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From elubisse at sportingindex.com  Wed Oct 20 17:24:17 2010
From: elubisse at sportingindex.com (Eric@SPIN)
Date: Wed, 20 Oct 2010 09:24:17 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP Connection gets forcibly closed : .Net
 client
In-Reply-To: <4B707F75.8000909@lshift.net>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>
	<4B5DEE87.1090700@lshift.net>
	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>
	<4B5F0C63.3060806@lshift.net>
	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>
	<4B5F3059.8060006@lshift.net>
	<03FC0D29D4E88943AB7420C524BE8489027C3D81@mllnc20mb056.emea.win.ml.com>
	<4B707F75.8000909@lshift.net>
Message-ID: <30011591.post@talk.nabble.com>


Hi Matthias,

This is the exact error where are getting...

The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=320, text="CONNECTION_FORCED - broker forced connection closure with
reason 'shutdown'", classId=0, methodId=0, cause=

I've checked your reply. I've been assured that nobody shut-down the broker.
This has happened twice today. In both cases re-starting our application we
were able to progress. Could there be any other reason? By the way we are
now on version 2.1.1.0

Regards,

Eric


Matthias Radestock-2 wrote:
> 
> Rajesh,
> 
> 
> Reddy, Rajesh (GPT EMEA) wrote:
>> We are using the .NET client and the heartbeat is set to 60 sec for the
>> connection. We are getting the following exception some times and the
>> client losses the connection.
>> 
>> AMQP Connection closed. Initiator:Peer Reason:CONNECTION_FORCED - broker
>> forced connection closure with reason 'shutdown'
> 
> That message originates at the broker when it performs a controlled 
> shutdown. So it should not come as a surprise, unless somebody is 
> shutting down your rabbit broker without telling you.
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/MulticastMain-Java-client-causes-Erlang-error-eheap_alloc%3A-Cannot-allocate-467078560-bytes-of-memory-%28of-type-%22heap%22%29-%28with-RabbitMQ-1.7.1%29-tp27311241p30011591.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From shaneman at adobe.com  Wed Oct 20 21:38:25 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Wed, 20 Oct 2010 13:38:25 -0700
Subject: [rabbitmq-discuss] persistent messages stored where?
Message-ID: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>

Where are the persistent messages stored on a generic Ubuntu RabbitMQ 2.x install?

--Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101020/7fb46691/attachment.htm>

From simon at rabbitmq.com  Wed Oct 20 21:52:53 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 21:52:53 +0100
Subject: [rabbitmq-discuss] persistent messages stored where?
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>
Message-ID: <4CBF56A5.5020803@rabbitmq.com>

On 20/10/2010 9:38PM, Steve Haneman wrote:
> Where are the persistent messages stored on a generic Ubuntu RabbitMQ
> 2.x install?

I'm not sure how much detail you are looking for, so here's the minimum ;)

/var/lib/rabbitmq/mnesia/

Cheers, Simon

From shaneman at adobe.com  Wed Oct 20 22:05:15 2010
From: shaneman at adobe.com (Steve Haneman)
Date: Wed, 20 Oct 2010 14:05:15 -0700
Subject: [rabbitmq-discuss] persistent messages stored where?
In-Reply-To: <4CBF56A5.5020803@rabbitmq.com>
References: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>
	<4CBF56A5.5020803@rabbitmq.com>
Message-ID: <A1CB3D904533654CB64599397AC43ADE014067B4F9A3@NAMBX02.corp.adobe.com>

I'm looking to find out how much disk space 1,000,000 10k messages take up on disk.  I pushed the messages and then shut down the server.  If I do a "du -sh" in the /var/lib/rabbitmq/mnesia/ directory, is that it?

--Stev

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Wednesday, October 20, 2010 1:53 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] persistent messages stored where?

On 20/10/2010 9:38PM, Steve Haneman wrote:
> Where are the persistent messages stored on a generic Ubuntu RabbitMQ
> 2.x install?

I'm not sure how much detail you are looking for, so here's the minimum ;)

/var/lib/rabbitmq/mnesia/

Cheers, Simon
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Wed Oct 20 22:15:53 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Oct 2010 22:15:53 +0100
Subject: [rabbitmq-discuss] persistent messages stored where?
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE014067B4F9A3@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>
	<4CBF56A5.5020803@rabbitmq.com>
	<A1CB3D904533654CB64599397AC43ADE014067B4F9A3@NAMBX02.corp.adobe.com>
Message-ID: <4CBF5C09.8030307@rabbitmq.com>

Yes; assuming you haven't been doing anything funky with changing node 
names etc. You'll pick up the configuration database and a couple of 
other things too, but they're not huge. To count just the message store, 
look at

/var/lib/rabbitmq/mnesia/rabbit@$(hostname)/msg_store_persistent/

(I think, maybe Matthew will correct me now...)

You should also be aware that when a message gets routed to many queues, 
RabbitMQ only stores one copy on disk (plus a lot of pointers). I don't 
know if that's relevant to your use case.

Cheers, Simon

On 20/10/2010 10:05PM, Steve Haneman wrote:
> I'm looking to find out how much disk space 1,000,000 10k messages
> take up on disk.  I pushed the messages and then shut down the
> server.  If I do a "du -sh" in the /var/lib/rabbitmq/mnesia/
> directory, is that it?
>
> --Stev
>
> -----Original Message----- From:
> rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Simon MacMullen Sent: Wednesday, October 20, 2010 1:53 PM To:
> rabbitmq-discuss at lists.rabbitmq.com Subject: Re: [rabbitmq-discuss]
> persistent messages stored where?
>
> On 20/10/2010 9:38PM, Steve Haneman wrote:
>> Where are the persistent messages stored on a generic Ubuntu
>> RabbitMQ 2.x install?
>
> I'm not sure how much detail you are looking for, so here's the
> minimum ;)
>
> /var/lib/rabbitmq/mnesia/
>
> Cheers, Simon _______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Oct 20 22:19:53 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Oct 2010 22:19:53 +0100
Subject: [rabbitmq-discuss] persistent messages stored where?
In-Reply-To: <A1CB3D904533654CB64599397AC43ADE014067B4F9A3@NAMBX02.corp.adobe.com>
References: <A1CB3D904533654CB64599397AC43ADE014067B4F977@NAMBX02.corp.adobe.com>
	<4CBF56A5.5020803@rabbitmq.com>
	<A1CB3D904533654CB64599397AC43ADE014067B4F9A3@NAMBX02.corp.adobe.com>
Message-ID: <20101020211952.GA5796@wellquite.org>

On Wed, Oct 20, 2010 at 02:05:15PM -0700, Steve Haneman wrote:
> I'm looking to find out how much disk space 1,000,000 10k messages take up on disk.  I pushed the messages and then shut down the server.  If I do a "du -sh" in the /var/lib/rabbitmq/mnesia/ directory, is that it?

Yes. However, I can just do the sums for the best case. Worst case will
be double (due to dead space on disk that's pending GC etc).

Per message, we have about a 200 byte overhead for the erlang data
structure that holds the message. We then have a further 25 bytes
overhead on disk (the on disk format is self-describing).

But then we have further cost per queue (a message can go to several
queues). Per queue, assuming the queue journal is flushed, we'll have 18
bytes per message, assuming the message isn't delivered.

So, if you have 1e6 * 10kB msgs going to one queue, I reckon you'll be
looking at about 1e6 * (10240 + 250) bytes (assuming 1kB == 1024B),
which I make to be about 9.77GB.

But as I say, that's best case. It can be anywhere between that and
double that, depending on what's going on in the system.

Thus for 10kB msgs, we're looking at about a 2.5% inflation on disk.

Does that match what you measure? (You'll find the numbers are a bit
bigger because of other stuff you'll be measuring, including mnesia
databases etc. But the trend should be about the same)

Matthew

From darren_gilroy at yahoo.com  Thu Oct 21 04:47:16 2010
From: darren_gilroy at yahoo.com (darr)
Date: Wed, 20 Oct 2010 20:47:16 -0700 (PDT)
Subject: [rabbitmq-discuss] can Message is send in the form of XML in
 Queue?
In-Reply-To: <30009239.post@talk.nabble.com>
References: <30009030.post@talk.nabble.com> <4CBED7BB.3010207@rabbitmq.com>
	<30009239.post@talk.nabble.com>
Message-ID: <30016000.post@talk.nabble.com>




sam_mis wrote:
> 
> Thanks for reply.could you please describe more detail about the
> "serialise the XML into the message and deserialise it at the other
> end",if possible then please provide some example about.
> 

That depends on what language you're using to talk to RabbitMQ with, and, as
gently as possible, whatever the answer is would be outside the scope of
this list.  Questions about how to serialize xml to a byte stream are better
answered elsewhere.

However, in general "serialize" just means to take XML text and convert into
to the raw bytes that RabbitMQ understands.  In java, and very abstractly 
  String myXml = "<foo>bar</foo>";
  byte[] myBytes = myXml.getBytes();

So, you can say that "myBytes" is a "serialized form" of "myXml".   There
are many, many ways to do this, of course -- in java and in other languages. 
Once you have a byte[] or equivalent, then you're back to the "Publish
Messages" area of http://www.rabbitmq.com/api-guide.html

Good luck!

-- 
View this message in context: http://old.nabble.com/can-Message-is-send-in-the-form-of-XML-in-Queue--tp30009030p30016000.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Thu Oct 21 05:27:16 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 20 Oct 2010 21:27:16 -0700 (PDT)
Subject: [rabbitmq-discuss] problem to understand configuration regarding
 Rabbitmq server in client?
Message-ID: <30016113.post@talk.nabble.com>


Hi

i installed Rabbitmq server[for windows] in my machine,in same machine i am
using Rabbitmq Java client API for publish the message in queue and consume
it.
where i use the some configuration:

       ConnectionFactory factory = new ConnectionFactory();  // opening a
Connection to an AMQP broker
       factory.setUsername("guest");     //Default username
       factory.setPassword("guest");     //Default  password
       factory.setVirtualHost("/");         // set the virtual host
       factory.setHost("0.0.0.0");      //set the IP Address
       factory.setPort(5672);               //Default Port       
     
but when i talking about the Rabbitmq server side configuration,i didn't do
anything,here is no problem.my program was running smoothly.i have some
confusion regrading this configuration:

username-"guest" is the default username to access Rabbitmq server
password-"guest" is the default password to access Rabbitmq server
virtualHost-"/"
Host-"0.0.0.0"
port-"5672"

if i installed Rabbitmq server in Linux machine and my client program which
use the Rabbitmq Java client API running on another machine[windows] then
where to required to change this configuration.
please help me to clear such things .

Thanks
-- 
View this message in context: http://old.nabble.com/problem-to-understand-configuration-regarding-Rabbitmq-server-in-client--tp30016113p30016113.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Thu Oct 21 05:27:39 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 20 Oct 2010 21:27:39 -0700 (PDT)
Subject: [rabbitmq-discuss] problem to understand configuration regarding
 Rabbitmq server in client?
Message-ID: <30016113.post@talk.nabble.com>


Hi

I installed Rabbitmq server[for windows] in my machine,in same machine i am
using Rabbitmq Java client API for publish the message in queue and consume
it.
where i use the some configuration:

       ConnectionFactory factory = new ConnectionFactory();  // opening a
Connection to an AMQP broker
       factory.setUsername("guest");     //Default username
       factory.setPassword("guest");     //Default  password
       factory.setVirtualHost("/");         // set the virtual host
       factory.setHost("0.0.0.0");      //set the IP Address
       factory.setPort(5672);               //Default Port       
     
but when i talking about the Rabbitmq server side configuration,i didn't do
anything,here is no problem.my program was running smoothly.i have some
confusion regrading this configuration:

username-"guest" is the default username to access Rabbitmq server
password-"guest" is the default password to access Rabbitmq server
virtualHost-"/"
Host-"0.0.0.0"
port-"5672"

if i installed Rabbitmq server in Linux machine and my client program which
use the Rabbitmq Java client API running on another machine[windows] then
where to required to change this configuration.
please help me to clear such things .

Thanks
-- 
View this message in context: http://old.nabble.com/problem-to-understand-configuration-regarding-Rabbitmq-server-in-client--tp30016113p30016113.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From abarea at tid.es  Thu Oct 21 07:23:39 2010
From: abarea at tid.es (ALBERT HIDALGO BAREA)
Date: Thu, 21 Oct 2010 08:23:39 +0200
Subject: [rabbitmq-discuss] problem to understand configuration
 regarding Rabbitmq server in client?
In-Reply-To: <30016113.post@talk.nabble.com>
References: <30016113.post@talk.nabble.com>
Message-ID: <6D466181A86F4042896593D8F56C32624A44049377@EXCLU2K7.hi.inet>

If the server (machine where is installed RabbitMQ, in your case a Linux one) has the IP x.x.x.x, you should put in the factory.setHost(x.x.x.x), instead of 0.0.0.0.
The username and password will depend if you add another user in the RabbitMQ server (in this case in the Linux machine, the default one is "guest" and "guest"). 
The default port is 5672, so if you do not change it in the configuration file of RabbitMQ server side, leave as factory.setPort(5672).

Regards,

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of sam_mis
Sent: jueves, 21 de octubre de 2010 6:28
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] problem to understand configuration regarding Rabbitmq server in client?


Hi

I installed Rabbitmq server[for windows] in my machine,in same machine i am
using Rabbitmq Java client API for publish the message in queue and consume
it.
where i use the some configuration:

       ConnectionFactory factory = new ConnectionFactory();  // opening a
Connection to an AMQP broker
       factory.setUsername("guest");     //Default username
       factory.setPassword("guest");     //Default  password
       factory.setVirtualHost("/");         // set the virtual host
       factory.setHost("0.0.0.0");      //set the IP Address
       factory.setPort(5672);               //Default Port       
     
but when i talking about the Rabbitmq server side configuration,i didn't do
anything,here is no problem.my program was running smoothly.i have some
confusion regrading this configuration:

username-"guest" is the default username to access Rabbitmq server
password-"guest" is the default password to access Rabbitmq server
virtualHost-"/"
Host-"0.0.0.0"
port-"5672"

if i installed Rabbitmq server in Linux machine and my client program which
use the Rabbitmq Java client API running on another machine[windows] then
where to required to change this configuration.
please help me to clear such things .

Thanks
-- 
View this message in context: http://old.nabble.com/problem-to-understand-configuration-regarding-Rabbitmq-server-in-client--tp30016113p30016113.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sameek at arosys.com  Thu Oct 21 07:42:26 2010
From: sameek at arosys.com (sam_mis)
Date: Wed, 20 Oct 2010 23:42:26 -0700 (PDT)
Subject: [rabbitmq-discuss] problem to understand configuration
 regarding Rabbitmq server in client?
In-Reply-To: <30016113.post@talk.nabble.com>
References: <30016113.post@talk.nabble.com>
Message-ID: <30016627.post@talk.nabble.com>


Thanks for reply.

sam_mis wrote:
> 
> Hi
> 
> I installed Rabbitmq server[for windows] in my machine,in same machine i
> am using Rabbitmq Java client API for publish the message in queue and
> consume it.
> where i use the some configuration:
> 
>        ConnectionFactory factory = new ConnectionFactory();  // opening a
> Connection to an AMQP broker
>        factory.setUsername("guest");     //Default username
>        factory.setPassword("guest");     //Default  password
>        factory.setVirtualHost("/");         // set the virtual host
>        factory.setHost("0.0.0.0");      //set the IP Address
>        factory.setPort(5672);               //Default Port       
>      
> but when i talking about the Rabbitmq server side configuration,i didn't
> do anything,here is no problem.my program was running smoothly.i have some
> confusion regrading this configuration:
> 
> username-"guest" is the default username to access Rabbitmq server
> password-"guest" is the default password to access Rabbitmq server
> virtualHost-"/"
> Host-"0.0.0.0"
> port-"5672"
> 
> if i installed Rabbitmq server in Linux machine and my client program
> which use the Rabbitmq Java client API running on another machine[windows]
> then where to required to change this configuration.
> please help me to clear such things .
> 
> Thanks
> 

-- 
View this message in context: http://old.nabble.com/problem-to-understand-configuration-regarding-Rabbitmq-server-in-client--tp30016113p30016627.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From 0x6e6562 at gmail.com  Thu Oct 21 09:42:33 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 21 Oct 2010 09:42:33 +0100
Subject: [rabbitmq-discuss] Management plugin changelog 2.1.0 -> 2.1.1
In-Reply-To: <4CBEBCEA.1030608@rabbitmq.com>
References: <4CBDD660.3070802@rabbitmq.com>
	<AANLkTik74tgqFJpA85ZUeX8SGmw9MG6Ocsi=hZ6LEOOY@mail.gmail.com>
	<4CBEBCEA.1030608@rabbitmq.com>
Message-ID: <AANLkTikR_bf-+6ZccBZCeDQJSjYurJLA1VTgygqdrgUK@mail.gmail.com>

On Wed, Oct 20, 2010 at 10:56 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> I think this is a broker issue rather than one specifically for the
> management plugin.
>
> Are you talking about some scenario where the broker could reinsert the
> purged messages if necessary? That might be... involved. Of course, it could
> move them to another queue (we've been idly thinking about that) but I don't
> know if that solves your problem. If all you want is a log, scripting
> something with basic.get is probably simple enough.

I think the scenario is that you're pretty sure you do actually want
to nuke data message and hence in all likelihood a queue purge would
be sufficient.

The logging bit was just a get out of jail card should you find out
after having done the purge that you did actually need those messages
after all (hence the drain via basic.get/disk log option).

Of course, having some way to DLQ all messages from a particular queue
on demand would solve the use case as well, because this would have
the same effect as purging the queue but still keeping the data around
lest you find out you were wrong in the first place.

Cheers,

Ben

From rauan at maemirov.com  Thu Oct 21 10:06:29 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Thu, 21 Oct 2010 15:06:29 +0600
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.1.1
Message-ID: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>

After installing latest rabbit and trying to start service, I get this:

#service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.

Here's log

#tail -f /var/log/rabbitmq/startup_log -n 100
Starting all nodes...
Starting node rabbit at smotrelka...
Activating RabbitMQ plugins ...
*WARNING* Undefined function ssl:ssl_accept/3
0 plugins activated:

{error_logger,{{2010,10,21},{15,2,48}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,10,21},{15,2,48}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{initial_call,{net_kernel,init,['Argument__1']}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.56>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,492}],[]]}
{error_logger,{{2010,10,21},{15,2,48}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbit at smotrelka
',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,10,21},{15,2,48}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,10,21},{15,2,48}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p_do_apply,3}]}},{initial_call,{application_master,init,['Argument__1','Argument__2','Argument__3','Argument__4']}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,124}],[]]}
{error_logger,{{2010,10,21},{15,2,48}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}


CentOS 5.5, Erlang R12B-5.12

#uname -a
Linux smotrelka 2.6.18-194.17.1.el5.centos.plus #1 SMP Thu Sep 30 19:27:14
EDT 2010 x86_64 x86_64 x86_64 GNU/Linux

Did I miss something?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101021/8300a22b/attachment-0001.htm>

From lemenkov at gmail.com  Thu Oct 21 10:09:48 2010
From: lemenkov at gmail.com (Peter Lemenkov)
Date: Thu, 21 Oct 2010 13:09:48 +0400
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.1.1
In-Reply-To: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>
References: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>
Message-ID: <AANLkTin7Q5ii7Zy+MmaKLmDYUxro7JVJX7eaTrecWsQA@mail.gmail.com>

2010/10/21 Rauan Maemirov <rauan at maemirov.com>:

> {error_logger,{{2010,10,21},{15,2,48}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},

Already started.


-- 
With best regards, Peter Lemenkov.

From rauan at maemirov.com  Thu Oct 21 10:14:56 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Thu, 21 Oct 2010 15:14:56 +0600
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.1.1
In-Reply-To: <AANLkTin7Q5ii7Zy+MmaKLmDYUxro7JVJX7eaTrecWsQA@mail.gmail.com>
References: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>
	<AANLkTin7Q5ii7Zy+MmaKLmDYUxro7JVJX7eaTrecWsQA@mail.gmail.com>
Message-ID: <AANLkTinXMiv6eLooW0EBb36dLSX1jjsLzJNthSR=y1HC@mail.gmail.com>

But ps ax doesn't show me anything, neither for rabbit nor for erlang
(except for epmd, which i pkilled, though).

Where is pid-file meant to be?

2010/10/21 Peter Lemenkov <lemenkov at gmail.com>

> 2010/10/21 Rauan Maemirov <rauan at maemirov.com>:
>
> > {error_logger,{{2010,10,21},{15,2,48}},"Protocol: ~p: register error:
> > ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},
>
> Already started.
>
>
> --
> With best regards, Peter Lemenkov.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101021/344056f1/attachment.htm>

From sameek at arosys.com  Thu Oct 21 10:22:16 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 21 Oct 2010 02:22:16 -0700 (PDT)
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian
 operating system
Message-ID: <30017597.post@talk.nabble.com>


Hi,

 

I am using Debian operating system.i downloaded the give installer for 

Debian,but when i try to install using the below command :

 

  dpkg --install rabbitmq-server_2.1.1-1_all.deb

 

it give the following error:

 

[Error]:

 

dpkg --install rabbitmq-server_2.1.1-1_all.deb

Selecting previously deselected package rabbitmq-server.

(Reading database ... 115899 files and directories currently installed.)

Unpacking rabbitmq-server (from rabbitmq-server_2.1.1-1_all.deb) ...

dpkg: dependency problems prevent configuration of rabbitmq-server:

  rabbitmq-server depends on erlang-base (>= 1:12.b.3) | 

erlang-base-hipe (>= 1:12.b.3); however:

   Package erlang-base is not installed.

   Package erlang-base-hipe is not installed.

  rabbitmq-server depends on erlang-ssl | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-ssl is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-os-mon | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-os-mon is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-mnesia | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-mnesia is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-inets | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-inets is not installed.

   Package erlang-nox is not installed.

dpkg: error processing rabbitmq-server (--install):

  dependency problems - leaving unconfigured

Processing triggers for man-db ...

Errors were encountered while processing:

  rabbitmq-server

 

please guide me where i have problem to install rabbitmq server and if 

possible then please send the details description about the installation 

of server and configuration.

 

Thanks

-- 
View this message in context: http://old.nabble.com/problem-to-install-rabbitmq-server-in-debian-operating-system-tp30017597p30017597.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From abarea at tid.es  Thu Oct 21 10:36:00 2010
From: abarea at tid.es (ALBERT HIDALGO BAREA)
Date: Thu, 21 Oct 2010 11:36:00 +0200
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian
 operating system
In-Reply-To: <30017597.post@talk.nabble.com>
References: <30017597.post@talk.nabble.com>
Message-ID: <6D466181A86F4042896593D8F56C32624A440493CC@EXCLU2K7.hi.inet>

Did you install Erlang R12-B3 or newer (if using plugins you will need R13 at least) before trying to install RabbitMQ server?
If not, try to use the "rabbitmq-server-generic-unix-2.1.1.tar.gz" package, so you have only to uncompress the file, copy the folders and run the program.

Regards,


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of sam_mis
Sent: jueves, 21 de octubre de 2010 11:22
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian operating system


Hi,

 

I am using Debian operating system.i downloaded the give installer for 

Debian,but when i try to install using the below command :

 

  dpkg --install rabbitmq-server_2.1.1-1_all.deb

 

it give the following error:

 

[Error]:

 

dpkg --install rabbitmq-server_2.1.1-1_all.deb

Selecting previously deselected package rabbitmq-server.

(Reading database ... 115899 files and directories currently installed.)

Unpacking rabbitmq-server (from rabbitmq-server_2.1.1-1_all.deb) ...

dpkg: dependency problems prevent configuration of rabbitmq-server:

  rabbitmq-server depends on erlang-base (>= 1:12.b.3) | 

erlang-base-hipe (>= 1:12.b.3); however:

   Package erlang-base is not installed.

   Package erlang-base-hipe is not installed.

  rabbitmq-server depends on erlang-ssl | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-ssl is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-os-mon | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-os-mon is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-mnesia | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-mnesia is not installed.

   Package erlang-nox is not installed.

  rabbitmq-server depends on erlang-inets | erlang-nox (<< 

1:13.b-dfsg1-1); however:

   Package erlang-inets is not installed.

   Package erlang-nox is not installed.

dpkg: error processing rabbitmq-server (--install):

  dependency problems - leaving unconfigured

Processing triggers for man-db ...

Errors were encountered while processing:

  rabbitmq-server

 

please guide me where i have problem to install rabbitmq server and if 

possible then please send the details description about the installation 

of server and configuration.

 

Thanks

-- 
View this message in context: http://old.nabble.com/problem-to-install-rabbitmq-server-in-debian-operating-system-tp30017597p30017597.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rauan at maemirov.com  Thu Oct 21 10:43:35 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Thu, 21 Oct 2010 15:43:35 +0600
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.1.1
In-Reply-To: <AANLkTinXMiv6eLooW0EBb36dLSX1jjsLzJNthSR=y1HC@mail.gmail.com>
References: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>
	<AANLkTin7Q5ii7Zy+MmaKLmDYUxro7JVJX7eaTrecWsQA@mail.gmail.com>
	<AANLkTinXMiv6eLooW0EBb36dLSX1jjsLzJNthSR=y1HC@mail.gmail.com>
Message-ID: <AANLkTi=azfQkwhBMjNA6vQJvev=QCbqrc+uiW75jYU+f@mail.gmail.com>

# rabbitmqctl status
Status of node rabbit at smotrelka ...
Error: unable to connect to node rabbit at smotrelka: nodedown
diagnostics:
- nodes and their ports on smotrelka: [{rabbit,33213},
                                       {rabbitmqctl13935,47497}]
- current node: rabbitmqctl13935 at smotrelka
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: ww0bjeu0Iku8GDrBRu6+Ww==


2010/10/21 Rauan Maemirov <rauan at maemirov.com>

> But ps ax doesn't show me anything, neither for rabbit nor for erlang
> (except for epmd, which i pkilled, though).
>
> Where is pid-file meant to be?
>
> 2010/10/21 Peter Lemenkov <lemenkov at gmail.com>
>
> 2010/10/21 Rauan Maemirov <rauan at maemirov.com>:
>>
>> > {error_logger,{{2010,10,21},{15,2,48}},"Protocol: ~p: register error:
>> > ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},
>>
>> Already started.
>>
>>
>> --
>> With best regards, Peter Lemenkov.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101021/d251a603/attachment.htm>

From david at rabbitmq.com  Thu Oct 21 11:15:52 2010
From: david at rabbitmq.com (David Wragg)
Date: Thu, 21 Oct 2010 11:15:52 +0100
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian
	operating system
In-Reply-To: <30017597.post@talk.nabble.com> (sam mis's message of "Thu, 21
	Oct 2010 02:22:16 -0700 (PDT)")
References: <30017597.post@talk.nabble.com>
Message-ID: <yrv4cmxq7g8br.fsf@dwragg.eng.vmware.com>

Hi,

sam_mis <sameek at arosys.com> writes:
> I am using Debian operating system.i downloaded the give installer for
> Debian,but when i try to install using the below command :
>
>   dpkg --install rabbitmq-server_2.1.1-1_all.deb
>
> it give the following error:
>
> [Error]:
>
> dpkg --install rabbitmq-server_2.1.1-1_all.deb
> [...]

These errors indicate that you do not have all the dependencies of the
rabbitmq-server package installed.  The dpkg tool will not automatically
install such dependencies for you.  Instead, it is easier to use a
package installation tool that does, such as gdebi, or follow the
instructions at <http://www.rabbitmq.com/debian.html#apt> to make our
packages available for installation through apt-get, aptitude, synaptic,
etc.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From cstoyles at gmail.com  Thu Oct 21 11:16:11 2010
From: cstoyles at gmail.com (ChrisStoyles)
Date: Thu, 21 Oct 2010 03:16:11 -0700 (PDT)
Subject: [rabbitmq-discuss]  Documentation for the Storage API
Message-ID: <30017978.post@talk.nabble.com>


Hi Everyone,

After reading "Growing Up" on the RabbitMQ blog
(http://www.rabbitmq.com/blog/2010/08/27/growing-up/) I'd like to find out
more about the "Storage API". In particular, if queues were stored in
PostgreSQL would this provide persistent queues across multiple machines in
a cluster (e.g. if a server goes down, all it's queue items will still be
visible by the other members in the cluster).

I'm looking for a way to avoid having to use Pacemaker and DRDB as per the
HA guide.

If there's any documentation you can point me to that would be great, even
if it's inside actual source files and I have to go digging through to find
out how to use it.

Thanks,
Chris.
-- 
View this message in context: http://old.nabble.com/Documentation-for-the-Storage-API-tp30017978p30017978.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From thomasbam at gmail.com  Thu Oct 21 11:57:46 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Thu, 21 Oct 2010 12:57:46 +0200
Subject: [rabbitmq-discuss] rabbitmq configuration file and access control
Message-ID: <AANLkTi=BUBKX6qEwpf1Hma_Go=fnE-WsFQjgqsoCa=mD@mail.gmail.com>

Hello,


Is there a way to declare a set of users in the rabbitmq configuration
file  (ex /etc/rabbitmq.conf) to give rabbitmq on startup a list of
authorized users/pass/permissions ?

Thank you for your answsers.

Bruno Thomas

From matthew at rabbitmq.com  Thu Oct 21 12:14:04 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 21 Oct 2010 12:14:04 +0100
Subject: [rabbitmq-discuss] rabbitmq configuration file and access
 control
In-Reply-To: <AANLkTi=BUBKX6qEwpf1Hma_Go=fnE-WsFQjgqsoCa=mD@mail.gmail.com>
References: <AANLkTi=BUBKX6qEwpf1Hma_Go=fnE-WsFQjgqsoCa=mD@mail.gmail.com>
Message-ID: <20101021111404.GE26102@rabbitmq.com>

Hi Bruno,

On Thu, Oct 21, 2010 at 12:57:46PM +0200, Bruno Thomas wrote:
> Is there a way to declare a set of users in the rabbitmq configuration
> file  (ex /etc/rabbitmq.conf) to give rabbitmq on startup a list of
> authorized users/pass/permissions ?

Nope, sorry. Your best bet would be to script something using
rabbitmqctl.

Matthew

From sameek at arosys.com  Thu Oct 21 12:23:05 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 21 Oct 2010 04:23:05 -0700 (PDT)
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian
 operating system
In-Reply-To: <30017597.post@talk.nabble.com>
References: <30017597.post@talk.nabble.com>
Message-ID: <30018478.post@talk.nabble.com>


Thanks for reply,but my problem is not solve yet using Debian APT
repository.it give an error:
used command after setting deb http://www.rabbitmq.com/debian/ testing main
in /etc/apt/sources.list:

sudo apt-get install rabbitmq-server

sudo: unable to resolve host server01
Reading package lists... Done
Building dependency tree       
Reading state information... Done
You might want to run `apt-get -f install' to correct these:
The following packages have unmet dependencies:
  rabbitmq-server: Depends: erlang-base (>= 1:12.b.3) but it is not going to
be installed or
                            erlang-base-hipe (>= 1:12.b.3) but it is not
going to be installed
                   Depends: erlang-ssl but it is not installable or
                            erlang-nox (< 1:13.b-dfsg1-1) but it is not
going to be installed
                   Depends: erlang-os-mon but it is not installable or
                            erlang-nox (< 1:13.b-dfsg1-1) but it is not
going to be installed
                   Depends: erlang-mnesia but it is not installable or
                            erlang-nox (< 1:13.b-dfsg1-1) but it is not
going to be installed
                   Depends: erlang-inets but it is not installable or
                            erlang-nox (< 1:13.b-dfsg1-1) but it is not
going to be installed
E: Unmet dependencies. Try 'apt-get -f install' with no packages (or specify
a solution).



sam_mis wrote:
> 
> Hi,
> 
>  
> 
> I am using Debian operating system.i downloaded the give installer for 
> 
> Debian,but when i try to install using the below command :
> 
>  
> 
>   dpkg --install rabbitmq-server_2.1.1-1_all.deb
> 
>  
> 
> it give the following error:
> 
>  
> 
> [Error]:
> 
>  
> 
> dpkg --install rabbitmq-server_2.1.1-1_all.deb
> 
> Selecting previously deselected package rabbitmq-server.
> 
> (Reading database ... 115899 files and directories currently installed.)
> 
> Unpacking rabbitmq-server (from rabbitmq-server_2.1.1-1_all.deb) ...
> 
> dpkg: dependency problems prevent configuration of rabbitmq-server:
> 
>   rabbitmq-server depends on erlang-base (>= 1:12.b.3) | 
> 
> erlang-base-hipe (>= 1:12.b.3); however:
> 
>    Package erlang-base is not installed.
> 
>    Package erlang-base-hipe is not installed.
> 
>   rabbitmq-server depends on erlang-ssl | erlang-nox (<< 
> 
> 1:13.b-dfsg1-1); however:
> 
>    Package erlang-ssl is not installed.
> 
>    Package erlang-nox is not installed.
> 
>   rabbitmq-server depends on erlang-os-mon | erlang-nox (<< 
> 
> 1:13.b-dfsg1-1); however:
> 
>    Package erlang-os-mon is not installed.
> 
>    Package erlang-nox is not installed.
> 
>   rabbitmq-server depends on erlang-mnesia | erlang-nox (<< 
> 
> 1:13.b-dfsg1-1); however:
> 
>    Package erlang-mnesia is not installed.
> 
>    Package erlang-nox is not installed.
> 
>   rabbitmq-server depends on erlang-inets | erlang-nox (<< 
> 
> 1:13.b-dfsg1-1); however:
> 
>    Package erlang-inets is not installed.
> 
>    Package erlang-nox is not installed.
> 
> dpkg: error processing rabbitmq-server (--install):
> 
>   dependency problems - leaving unconfigured
> 
> Processing triggers for man-db ...
> 
> Errors were encountered while processing:
> 
>   rabbitmq-server
> 
>  
> 
> please guide me where i have problem to install rabbitmq server and if 
> 
> possible then please send the details description about the installation 
> 
> of server and configuration.
> 
>  
> 
> Thanks
> 
> 

-- 
View this message in context: http://old.nabble.com/problem-to-install-rabbitmq-server-in-debian-operating-system-tp30017597p30018478.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Thu Oct 21 12:27:57 2010
From: sameek at arosys.com (sam_mis)
Date: Thu, 21 Oct 2010 04:27:57 -0700 (PDT)
Subject: [rabbitmq-discuss] how to install Erlang R12-B3 or newer in Debian
 operating system?
Message-ID: <30018521.post@talk.nabble.com>


Hi 

how to install Erlang R12-B3 or newer .

Thanks

-- 
View this message in context: http://old.nabble.com/how-to-install-Erlang-R12-B3-or-newer-in-Debian-operating-system--tp30018521p30018521.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Thu Oct 21 12:33:47 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 21 Oct 2010 12:33:47 +0100
Subject: [rabbitmq-discuss] how to install Erlang R12-B3 or newer in
 Debian operating system?
In-Reply-To: <30018521.post@talk.nabble.com>
References: <30018521.post@talk.nabble.com>
Message-ID: <AANLkTinuGxepWJuAFRY5z9h4w0F9JQtVQ2NF7BWq6v_z@mail.gmail.com>

I suggest starting here:

http://www.debian.org/doc/



On Thu, Oct 21, 2010 at 12:27, sam_mis <sameek at arosys.com> wrote:
> how to install Erlang R12-B3 or newer .

From 0x6e6562 at gmail.com  Thu Oct 21 13:18:07 2010
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 21 Oct 2010 13:18:07 +0100
Subject: [rabbitmq-discuss] Management plugin changelog 2.1.0 -> 2.1.1
In-Reply-To: <AANLkTikR_bf-+6ZccBZCeDQJSjYurJLA1VTgygqdrgUK@mail.gmail.com>
References: <4CBDD660.3070802@rabbitmq.com>
	<AANLkTik74tgqFJpA85ZUeX8SGmw9MG6Ocsi=hZ6LEOOY@mail.gmail.com>
	<4CBEBCEA.1030608@rabbitmq.com>
	<AANLkTikR_bf-+6ZccBZCeDQJSjYurJLA1VTgygqdrgUK@mail.gmail.com>
Message-ID: <AANLkTinqd=BwfLZrvT9SYbjj+0ta6C4ke9Tn=Y4Dqirf@mail.gmail.com>

On Thu, Oct 21, 2010 at 9:42 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> On Wed, Oct 20, 2010 at 10:56 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Of course, having some way to DLQ all messages from a particular queue
> on demand would solve the use case as well, because this would have
> the same effect as purging the queue but still keeping the data around
> lest you find out you were wrong in the first place.

Not sure how much you're going to like this one, but seeing as the
management website is maturing, one way to implement this feature is
to be able to drain a queue and download it's current contents via a
link on the website. That way you could allow members of a
non-sysadmin group role to purge queues in a really easy way. If you
wanted to be really nice you could also offer the reverse operation,
to upload into a queue via the management website.

Just a thought.

Ben

From emile at rabbitmq.com  Thu Oct 21 15:25:05 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Oct 2010 15:25:05 +0100
Subject: [rabbitmq-discuss] WCF Do not act if failed to process
In-Reply-To: <29976517.post@talk.nabble.com>
References: <29976517.post@talk.nabble.com>
Message-ID: <4CC04D41.7060906@rabbitmq.com>


Hi Mamu,

On 16/10/10 01:46, mamu wrote:
> 
> WCF client library act's as soon as it read message from queue. Below is line
> called as soon as message got read from queue.
> 
>                 m_messageQueue.Model.BasicAck(msg.DeliveryTag, false);
> 
> It is going to call service after message is removed from rabbitmq, and if
> service has some component down it's going to fail in executing actual
> implementation in service.
> 
> I would like to change this behavior to like, call basicact only if message
> was processed successfully by wcf service.
> 
> Any one could suggest how can i change rabbitmq wcf implementation to
> achieve above? 
> 
> 
> Also would like to hear you experience around handling above case.


I suggest you investigate System.ServiceModel.Channels.ReceiveContext to
exercise greater control over precisely when acknowledgements are sent.
This is only available in .NET 4 though. From the docs:

"...receive context allows a service to control when it sends an
acknowledgement message or it can indicate a problem by sending a
negative acknowledgement message."


Regards

Emile

From s4nchez at gmail.com  Thu Oct 21 15:55:05 2010
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 21 Oct 2010 07:55:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering not working for some connections
Message-ID: <2c7ad6b9-0503-434f-a346-450ed5deab23@26g2000yqv.googlegroups.com>

  Hi all,

  We are trying to run a cluster of 2 rabbitmq machines on Amazon EC2
and although it runs fine for a little while, at some stage it stops
working only for messages where producer and consumer are connected to
different nodes. At this point, "rabbitmqctl list_connections" becomes
completely unresponsive, as well as trying to restart the servers. The
only option is kill -9 all erlang process and start them again.

  rabbitmqctl status shows:

Status of node rabbit at rabbit1 ...
[{running_applications,
     [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
      {webmachine,"webmachine","1.7.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
      {rabbit,"RabbitMQ","2.1.0"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.6.4"},
      {inets,"INETS  CXC 138 49","5.3"},
      {mnesia,"MNESIA  CXC 138 12","4.4.13"},
      {stdlib,"ERTS  CXC 138 10","1.16.5"},
      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
 {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
...done.

Status of node rabbit at rabbit2 ...
[{running_applications,
     [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
      {webmachine,"webmachine","1.7.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
      {rabbit,"RabbitMQ","2.1.0"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.6.4"},
      {inets,"INETS  CXC 138 49","5.3"},
      {mnesia,"MNESIA  CXC 138 12","4.4.13"},
      {stdlib,"ERTS  CXC 138 10","1.16.5"},
      {kernel,"ERTS  CXC 138 10","2.13.5"}]},
 {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
 {running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
...done.

On the logs of rabbit2, the only error I see some of these:

=ERROR REPORT==== 21-Oct-2010::14:40:47 ===
exception on TCP connection <0.19069.0> from 88.211.55.18:13580
{bad_header,<<"<policy-">>}

  Other information:
  - The hostnames (rabbit1, rabbit2) are defined in /etc/hosts on both
machines using their private IP, and consumers access them through a
DNS round-robin to their public IP
  - Both machines use NODENAME=rabbit@<host> on /etc/rabbitmq/
rabbitmq.conf
  - Cluster is defined in /etc/rabbitmq/rabbitmq.config using
{cluster_nodes, ['rabbit at rabbit1','rabbit at rabbit2']}
  - We are using RabbitMQ 2.1.0 and Erlang R13B04 (erts-5.7.5)
[source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-
poll:false]

  Any ideas of what can be wrong?

--
Ivan Sanchez


From emile at rabbitmq.com  Thu Oct 21 15:58:17 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Oct 2010 15:58:17 +0100
Subject: [rabbitmq-discuss] Publish while processing?
In-Reply-To: <AANLkTinDC+LMb4dgsDKtfEmO=PAZ0K_1h3BqK9rbOSLJ@mail.gmail.com>
References: <AANLkTinDC+LMb4dgsDKtfEmO=PAZ0K_1h3BqK9rbOSLJ@mail.gmail.com>
Message-ID: <4CC05509.5070609@rabbitmq.com>

Hi Dave.

On 15/10/10 17:22, Dave Gorman wrote:
> I have a couple messaging scenarios I need help with... 
> 1) I would like to have a subscriber listening to "raw" queue; then do
> some preprocessing and publish a new message, such as "preprocessed" to
> the same exchange.
> 2) I would also like to have a subscriber that would process and push to
> a different exchange.
> 
> I noticed in the .Net Client User Guide that it says do not call
> .basicPublish during a callback as it blocks threads. 
> 
> using (IConnection conn = connectionFactory.CreateConnection())
> {
>     using (IModel model = conn.CreateModel())
>     {
>         var sub = new Subscription(model, "rtls");
>         foreach (BasicDeliverEventArgs iter in sub)
>         {
>             var message = System.Text.Encoding.UTF8.GetString(iter.Body);
>             //want to crunch and publish to different exchange or same
> exchange
>             //  ***.BasicPublish(...);
> 
>             sub.Ack(iter);
>         }
> 
>     }
> }
> 
> I would like to successfully process and publish the new message before
> I send the ack() on the original message; just so I'm sure every message
> is processed.
> 
> Is this the proper way to process or will that cause threading issues?

When using Subscription the threading issues warned about in the user
guide do not arise, because callbacks are not invoked from the
connection thread. Subscription makes use of QueueingBasicConsumer
internally and prevents a deadline scenario.

You should therefore be able to replace "***" with "model" in your
example above.

Regards

Emile


From michael at ndrix.org  Thu Oct 21 16:23:58 2010
From: michael at ndrix.org (Michael Hendricks)
Date: Thu, 21 Oct 2010 09:23:58 -0600
Subject: [rabbitmq-discuss] shutdown_error debugging
In-Reply-To: <20101020123027.GE15631@rabbitmq.com>
References: <AANLkTinr-bTFw0SdoK3qM_Bnmpb_qLFuoe9MMsdQr0id@mail.gmail.com>
	<20101019143348.GF6803@rabbitmq.com>
	<AANLkTinpovxTjADGUn=yXbA0tG8A4jDrbsJCZadc_7Mz@mail.gmail.com>
	<20101019154231.GK6803@rabbitmq.com>
	<AANLkTi=_9ohbZbDoBq8dQRVc-kGV7ONbZqnk8OU9kCK9@mail.gmail.com>
	<20101020123027.GE15631@rabbitmq.com>
Message-ID: <AANLkTi=BBojSa+jLVqpkEUq5epAyA8d8zKNqmd+7iQZv@mail.gmail.com>

The problem with closing connections has been fixed in Haskell amqp
library version 0.2.3

-- 
Michael

On Wed, Oct 20, 2010 at 6:30 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Oct 19, 2010 at 12:28:57PM -0600, Michael Hendricks wrote:
>> I'll send a packet capture off list (since the capture has server and
>> login info in it).
>>
>> The Haskell library explicitly mentions that it doesn't close channels
>> yet and there are TODO comments in the code for closing connections.
>
> Yup, that's the culprit. It's just straight closing the TCP socket which
> causes these warnings to be emitted into the logs. I know they say
> error, but you can safely ignore them. They've only been showing up
> since 2.1.0 because we changed the relationships and organisation of
> various processes.
>
> You might like to gently poke the author of the Haskell library to do
> the right thing with connection and channel closing. :)
>
> Matthew
>

From georgios.paraskevas at excelian.com  Thu Oct 21 16:27:48 2010
From: georgios.paraskevas at excelian.com (gparaskevas80)
Date: Thu, 21 Oct 2010 08:27:48 -0700 (PDT)
Subject: [rabbitmq-discuss]  Pushing many chunks of messages...
Message-ID: <30020626.post@talk.nabble.com>


Guys, 
I would like to ask you... 
Does anyone knows if it is possible to send to the RabbitMQ server bunches
of messages at one go instead one after the other?

Cheers,
George
-- 
View this message in context: http://old.nabble.com/Pushing-many-chunks-of-messages...-tp30020626p30020626.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From althomas at maninvestments.com  Thu Oct 21 16:56:28 2010
From: althomas at maninvestments.com (Alext0)
Date: Thu, 21 Oct 2010 08:56:28 -0700 (PDT)
Subject: [rabbitmq-discuss]  Mgmt plugin (2.1.1)
Message-ID: <30020890.post@talk.nabble.com>


Hi folks,

Can anyone confirm whether the latest mgmt plugin works on 2.1.1? 

Just doing a fresh install on Linux and we see a crash from rabbit_mochiweb:
    application: rabbit_mochiweb
    exited: {shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}
    type: permanent

I thought we might be tempting fate running on RHEL 5.0 rather than 5.5 but
from what I understand this error usually indicates an app-level problem.

Many thanks
Alex

-- 
View this message in context: http://old.nabble.com/Mgmt-plugin-%282.1.1%29-tp30020890p30020890.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ian.ragsdale at gmail.com  Thu Oct 21 17:07:08 2010
From: ian.ragsdale at gmail.com (Ian Ragsdale)
Date: Thu, 21 Oct 2010 11:07:08 -0500
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <30020890.post@talk.nabble.com>
References: <30020890.post@talk.nabble.com>
Message-ID: <EADD9444-32D7-43AB-B300-A31CF4D194D9@gmail.com>

It is working for me.

On Oct 21, 2010, at 10:56 AM, Alext0 wrote:

> 
> Hi folks,
> 
> Can anyone confirm whether the latest mgmt plugin works on 2.1.1? 
> 
> Just doing a fresh install on Linux and we see a crash from rabbit_mochiweb:
>    application: rabbit_mochiweb
>    exited: {shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}
>    type: permanent
> 
> I thought we might be tempting fate running on RHEL 5.0 rather than 5.5 but
> from what I understand this error usually indicates an app-level problem.
> 
> Many thanks
> Alex
> 
> -- 
> View this message in context: http://old.nabble.com/Mgmt-plugin-%282.1.1%29-tp30020890p30020890.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From oyvind at tjervaag.com  Thu Oct 21 17:11:43 2010
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Thu, 21 Oct 2010 18:11:43 +0200
Subject: [rabbitmq-discuss] RabbitMQ windows service fails to start
	(distribution name conflict?)
Message-ID: <EAD113F6-1F9B-4C68-9447-5150C5804AB4@tjervaag.com>

Hi!

I'm having some trouble with a 2.0.0 rabbitmq install. It's running as a windows service and on a couple of occasions it has failed to start (most recent after an apparent windows update and restart).

When I try to start the service, i get a message in my windows event log: "Erlang machine stopped instantly (distribution name conflict?)". Don't know if it is the hostname it is complaining about (.. is that even the same as the nodename?), but the hostname has not changed when this happens.

Removing and reinstalling the service solves the problem, and enables me to start the service, but I obviously can't rely on that every time the machine restarts (don't know if this happens on _every_ restart, but that was the case earlier today at least...).

Help? :)

/?yvind

From s4nchez at gmail.com  Thu Oct 21 17:08:39 2010
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 21 Oct 2010 09:08:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering not working for some connections
In-Reply-To: <2c7ad6b9-0503-434f-a346-450ed5deab23@26g2000yqv.googlegroups.com>
References: <2c7ad6b9-0503-434f-a346-450ed5deab23@26g2000yqv.googlegroups.com>
Message-ID: <a8b6a554-f109-4b78-97d9-40412a66dcd3@t8g2000yqk.googlegroups.com>


  I just noticed that on my tests the producers are also getting
blocked (we are using a java client and basicPublish()).

  Trying to list_consumers also becomes unresponsive at this point.

  Any help would be really appreciated.

  Thank you,

--
Ivan Sanchez

On Oct 21, 3:55?pm, Ivan Sanchez <s4nc... at gmail.com> wrote:
> ? Hi all,
>
> ? We are trying to run a cluster of 2 rabbitmq machines on Amazon EC2
> and although it runs fine for a little while, at some stage it stops
> working only for messages where producer and consumer are connected to
> different nodes. At this point, "rabbitmqctl list_connections" becomes
> completely unresponsive, as well as trying to restart the servers. The
> only option is kill -9 all erlang process and start them again.
>
> ? rabbitmqctl status shows:
>
> Status of node rabbit at rabbit1 ...
> [{running_applications,
> ? ? ?[{rabbit_management,"RabbitMQ Management Console","2.1.1"},
> ? ? ? {webmachine,"webmachine","1.7.0"},
> ? ? ? {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
> ? ? ? {rabbit,"RabbitMQ","2.1.0"},
> ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.5"},
> ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9"},
> ? ? ? {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
> ? ? ? {mochiweb,"MochiMedia Web Server","1.3"},
> ? ? ? {crypto,"CRYPTO version 1","1.6.4"},
> ? ? ? {inets,"INETS ?CXC 138 49","5.3"},
> ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.13"},
> ? ? ? {stdlib,"ERTS ?CXC 138 10","1.16.5"},
> ? ? ? {kernel,"ERTS ?CXC 138 10","2.13.5"}]},
> ?{nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
> ?{running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
> ...done.
>
> Status of node rabbit at rabbit2 ...
> [{running_applications,
> ? ? ?[{rabbit_management,"RabbitMQ Management Console","2.1.1"},
> ? ? ? {webmachine,"webmachine","1.7.0"},
> ? ? ? {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
> ? ? ? {rabbit,"RabbitMQ","2.1.0"},
> ? ? ? {os_mon,"CPO ?CXC 138 46","2.2.5"},
> ? ? ? {sasl,"SASL ?CXC 138 11","2.1.9"},
> ? ? ? {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
> ? ? ? {mochiweb,"MochiMedia Web Server","1.3"},
> ? ? ? {crypto,"CRYPTO version 1","1.6.4"},
> ? ? ? {inets,"INETS ?CXC 138 49","5.3"},
> ? ? ? {mnesia,"MNESIA ?CXC 138 12","4.4.13"},
> ? ? ? {stdlib,"ERTS ?CXC 138 10","1.16.5"},
> ? ? ? {kernel,"ERTS ?CXC 138 10","2.13.5"}]},
> ?{nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
> ?{running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
> ...done.
>
> On the logs of rabbit2, the only error I see some of these:
>
> =ERROR REPORT==== 21-Oct-2010::14:40:47 ===
> exception on TCP connection <0.19069.0> from 88.211.55.18:13580
> {bad_header,<<"<policy-">>}
>
> ? Other information:
> ? - The hostnames (rabbit1, rabbit2) are defined in /etc/hosts on both
> machines using their private IP, and consumers access them through a
> DNS round-robin to their public IP
> ? - Both machines use NODENAME=rabbit@<host> on /etc/rabbitmq/
> rabbitmq.conf
> ? - Cluster is defined in /etc/rabbitmq/rabbitmq.config using
> {cluster_nodes, ['rabbit at rabbit1','rabbit at rabbit2']}
> ? - We are using RabbitMQ 2.1.0 and Erlang R13B04 (erts-5.7.5)
> [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-
> poll:false]
>
> ? Any ideas of what can be wrong?
>
> --
> Ivan Sanchez
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Oct 21 17:18:06 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Oct 2010 17:18:06 +0100
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <30020890.post@talk.nabble.com>
References: <30020890.post@talk.nabble.com>
Message-ID: <4CC067BE.5040205@rabbitmq.com>

On 21/10/10 16:56, Alext0 wrote:
>
> Hi folks,
>
> Can anyone confirm whether the latest mgmt plugin works on 2.1.1?

Certainly should do.

> Just doing a fresh install on Linux and we see a crash from rabbit_mochiweb:
>      application: rabbit_mochiweb
>      exited: {shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}
>      type: permanent
>
> I thought we might be tempting fate running on RHEL 5.0 rather than 5.5 but
> from what I understand this error usually indicates an app-level problem.

Which Erlang? Mochiweb unfortunately needs a newer one than the R12B5 in 
EPEL (yes, this is going to be documented better).

I noticed today that http://repos.fedorapeople.org/ claims to have an 
RPM for R14B that is compatible with EPEL 5 / EPEL 6.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Thu Oct 21 17:25:47 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Oct 2010 17:25:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ windows service fails to
 start	(distribution name conflict?)
In-Reply-To: <EAD113F6-1F9B-4C68-9447-5150C5804AB4@tjervaag.com>
References: <EAD113F6-1F9B-4C68-9447-5150C5804AB4@tjervaag.com>
Message-ID: <4CC0698B.2080507@rabbitmq.com>

Hi ?yvind,

On 21/10/10 17:11, ?yvind Tjervaag wrote:
> Hi!
> 
> I'm having some trouble with a 2.0.0 rabbitmq install. It's running
> as a windows service and on a couple of occasions it has failed to
> start (most recent after an apparent windows update and restart).
> 
> When I try to start the service, i get a message in my windows event
> log: "Erlang machine stopped instantly (distribution name
> conflict?)". Don't know if it is the hostname it is complaining about
> (.. is that even the same as the nodename?), but the hostname has not
> changed when this happens.
> 
> Removing and reinstalling the service solves the problem, and enables
> me to start the service, but I obviously can't rely on that every
> time the machine restarts (don't know if this happens on _every_
> restart, but that was the case earlier today at least...).
> 
> Help? :)

I've not seen this error before, but the next time this happens can you
check whether the output of "rabbitmq-service.bat list" is different
before and after reinstalling the rabbitmq service?

Regards

Emile

From oyvind at tjervaag.com  Thu Oct 21 17:33:38 2010
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Thu, 21 Oct 2010 18:33:38 +0200
Subject: [rabbitmq-discuss] RabbitMQ windows service fails to start
	(distribution name conflict?)
In-Reply-To: <4CC0698B.2080507@rabbitmq.com>
References: <EAD113F6-1F9B-4C68-9447-5150C5804AB4@tjervaag.com>
	<4CC0698B.2080507@rabbitmq.com>
Message-ID: <31249AD2-B9A3-47A7-8239-DF8F33D92205@tjervaag.com>


On Oct 21, 2010, at 6:25 PM, Emile Joubert wrote:

> Hi ?yvind,
> 
> I've not seen this error before, but the next time this happens can you
> check whether the output of "rabbitmq-service.bat list" is different
> before and after reinstalling the rabbitmq service?
> 
> Regards
> 
> Emile

Yep, I've yet to find a way to reproduce it, but I'll try doing some restarts tomorrow to make it fail :)

?yvind

From shane at digitalsanctum.com  Thu Oct 21 17:48:12 2010
From: shane at digitalsanctum.com (Shane)
Date: Thu, 21 Oct 2010 09:48:12 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.1.1: no such file or directory crypto.app
 message prevents broker from starting
In-Reply-To: <20101020154347.GB3607@rabbitmq.com>
References: <a46a589c-c235-4170-a9fd-3df715957cf6@l14g2000yqb.googlegroups.com>
	<20101020154347.GB3607@rabbitmq.com>
Message-ID: <5cdfa491-8bda-4ebd-a44f-89f5d22015c1@m7g2000yqm.googlegroups.com>

I got it to work by compiling OpenSSL, then recompiling Erlang with
the '--with-ssl=PATH' option.

Thanks for the help.

On Oct 20, 11:43?am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Wed, Oct 20, 2010 at 08:26:30AM -0700, Shane wrote:
> > A fresh install of 2.1.1 and the management plugin on Linux with
> > Erlang R14A prevents the broker from starting and has the following
> > output:
>
> > Activating RabbitMQ plugins ...
> > ERROR: failed to load application crypto:
> > {"no such file or directory","crypto.app"}
>
> Did you build erlang yourself? If so, you may need to rebuild, this time
> with the openssl dev libraries installed as they'll be necessary for
> crypto to be buildable.
>
> Alternatively, you may just need to apt-get install erlang-ssl.
>
> Or, you could have multiple versions of erlang installed, maybe some
> with very old versions of crypto, which is now upsetting things.
>
> If none of the above works, which distribution are you using, and how
> did you install erlang?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From althomas at maninvestments.com  Thu Oct 21 17:37:55 2010
From: althomas at maninvestments.com (Alext0)
Date: Thu, 21 Oct 2010 09:37:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <4CC067BE.5040205@rabbitmq.com>
References: <30020890.post@talk.nabble.com> <4CC067BE.5040205@rabbitmq.com>
Message-ID: <30021317.post@talk.nabble.com>


Crikey, low latency email! Thank you both...

Yes this is with R12B5, and explains why Mochiweb is missing erlang:max. 

I haven't been able to get R14B yet but will try that.

cheers
Alex


Simon MacMullen-2 wrote:
> 
> On 21/10/10 16:56, Alext0 wrote:
>>
>> Hi folks,
>>
>> Can anyone confirm whether the latest mgmt plugin works on 2.1.1?
> 
> Certainly should do.
> 
>> Just doing a fresh install on Linux and we see a crash from
>> rabbit_mochiweb:
>>      application: rabbit_mochiweb
>>      exited: {shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}
>>      type: permanent
>>
>> I thought we might be tempting fate running on RHEL 5.0 rather than 5.5
>> but
>> from what I understand this error usually indicates an app-level problem.
> 
> Which Erlang? Mochiweb unfortunately needs a newer one than the R12B5 in 
> EPEL (yes, this is going to be documented better).
> 
> I noticed today that http://repos.fedorapeople.org/ claims to have an 
> RPM for R14B that is compatible with EPEL 5 / EPEL 6.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Mgmt-plugin-%282.1.1%29-tp30020890p30021317.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From david at rabbitmq.com  Fri Oct 22 10:13:54 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 22 Oct 2010 10:13:54 +0100
Subject: [rabbitmq-discuss] Pushing many chunks of messages...
In-Reply-To: <30020626.post@talk.nabble.com> (gparaskevas's message of "Thu,
	21 Oct 2010 08:27:48 -0700 (PDT)")
References: <30020626.post@talk.nabble.com>
Message-ID: <yrv4c1v7iy4h9.fsf@dwragg.eng.vmware.com>

Hi Georgios,

gparaskevas80 <georgios.paraskevas at excelian.com> writes:
> Does anyone knows if it is possible to send to the RabbitMQ server bunches
> of messages at one go instead one after the other?

The publish operation in AMQP is asynchronous - after publishing a
message, a client does not have to wait to hear back from the server
before publishing more mesages.  So there would be no efficiency
advantage in a batch publish operation.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Fri Oct 22 10:29:23 2010
From: david at rabbitmq.com (David Wragg)
Date: Fri, 22 Oct 2010 10:29:23 +0100
Subject: [rabbitmq-discuss] problem to install rabbitmq server in debian
	operating system
In-Reply-To: <30018478.post@talk.nabble.com> (sam mis's message of "Thu, 21
	Oct 2010 04:23:05 -0700 (PDT)")
References: <30017597.post@talk.nabble.com> <30018478.post@talk.nabble.com>
Message-ID: <yrv4cwrpawp70.fsf@dwragg.eng.vmware.com>

Hi,

sam_mis <sameek at arosys.com> writes:
> Thanks for reply,but my problem is not solve yet using Debian APT
> repository.it give an error:
> used command after setting deb http://www.rabbitmq.com/debian/ testing main
> in /etc/apt/sources.list:
>
> sudo apt-get install rabbitmq-server
>
> sudo: unable to resolve host server01
> Reading package lists... Done
> Building dependency tree       
> Reading state information... Done
> You might want to run `apt-get -f install' to correct these:
> The following packages have unmet dependencies:
>   rabbitmq-server: Depends: erlang-base (>= 1:12.b.3) but it is not going to
> be installed or
>                             erlang-base-hipe (>= 1:12.b.3) but it is
> not
> [...]

Strange.  Which release of debian are you using?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From james.anderson at setf.de  Fri Oct 22 12:44:22 2010
From: james.anderson at setf.de (james anderson)
Date: Fri, 22 Oct 2010 13:44:22 +0200
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
Message-ID: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>

good morning;

the grammar on page 31 of amqp0-9-1.pdf[1] describes an encoding for  
field-values in field-tables which would permit short strings to be  
encoded as 's'<length><data>.

i am running rabbitmg, version 2.1.0-1, installed as per the download  
page[2].

if i attempt to send to that server a basic.publish for which the  
properties includes a field table which contains a short string, the  
request causes an exception, and the respective connection appears to  
be rendered zombie. the error report is:

=ERROR REPORT==== 22-Oct-2010::00:07:02 ===
** Generic server <0.23205.8> terminating
** Last message in was {'$gen_cast',
                            {method,
                                {'basic.publish',0,<<"spocq.store">>,
                                    <<"foaf">>,false,false},
                                {content,60,none,
                                     
<<255,248,10,84,69,88,84,47,80,76,65,73,78,
                                       
10,73,83,79,45,56,56,53,57,45,49,0,0,0,48,
                                       
12,69,76,69,77,69,78,84,45,84,89,80,69,
                                       
115,6,83,84,82,73,78,71,7,80,65,67,75,65,
                                       
71,69,115,17,68,69,46,83,69,84,70,46,65,
                                       
77,81,80,46,85,83,69,82,1,0,0,0,0,0,0,0,0,
                                      0,0,0,0,0,0,0,0>>,
                                    rabbit_framing_amqp_0_9_1,
                                    [<<"a test message">>]}}}
** When Server state == {ch,running,1,<0.23202.8>,<0.23204.8>,undefined,
                             #Fun<rabbit_channel_sup.0.58069862>,none,
                             {set,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]}}},
                             1,
                             {[],[]},
                             {[],[]},
                             <<"guest">>,<<"/">>,<<"spocq.store">>,
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             <0.23201.8>,
                             {state,none,undefined}}
** Reason for termination ==
** {function_clause,
        [{rabbit_binary_parser,parse_table,
              
[<<84,82,73,78,71,7,80,65,67,75,65,71,69,115,17,68,69,46,83,69,
                84,70,46,65,77,81,80,46,85,83,69,82>>]},
         {rabbit_binary_parser,parse_table,1},
         {rabbit_binary_parser,parse_property,2},
         {rabbit_binary_parser,parse_properties,6},
         {rabbit_framing_amqp_0_9_1,decode_properties,2},
         {rabbit_binary_parser,ensure_content_decoded,1},
         {rabbit_channel,handle_method,3},
         {rabbit_channel,handle_cast,2}]}

i understand this, and the code in the repository[3] to indicate that  
the 115,6,83 at the start of the fourth line of the content vector,  
above, was decoded as a short 16/signed instead of the intended six  
byte short string. given which state, the subsequent vector  
<<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand  
these events correctly?


---
[1] https://www.amqp.org/confluence/download/attachments/720900/ 
amqp0-9-1.pdf
[2] http://www.rabbitmq.com/debian.html#apt
[3] http://hg.rabbitmq.com/rabbitmq-server/file/ec44d2fa3842/src/ 
rabbit_binary_parser.erl#l57

From simon at rabbitmq.com  Fri Oct 22 12:53:37 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Oct 2010 12:53:37 +0100
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>
Message-ID: <4CC17B41.2060708@rabbitmq.com>

On 22/10/10 12:44, james anderson wrote:

<snip>
> i understand this, and the code in the repository[3] to indicate that
> the 115,6,83 at the start of the fourth line of the content vector,
> above, was decoded as a short 16/signed instead of the intended six byte
> short string. given which state, the subsequent vector
> <<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand these
> events correctly?

Yes.

See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3 for a bit more 
information, but in short this is an area where we believe the spec to 
be incorrect.

The upshot is that there isn't a way to put short strings in tables; you 
have to use long strings.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From althomas at maninvestments.com  Fri Oct 22 14:16:34 2010
From: althomas at maninvestments.com (Alext0)
Date: Fri, 22 Oct 2010 06:16:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <30021317.post@talk.nabble.com>
References: <30020890.post@talk.nabble.com> <4CC067BE.5040205@rabbitmq.com>
	<30021317.post@talk.nabble.com>
Message-ID: <30028590.post@talk.nabble.com>


Unfortunately the R14B from http://repos.fedorapeople.org/ doesn't seem to be
there yet.

I've tried a couple of other things:

1) Built from src, but startup fails even with no plugins:
Activating RabbitMQ plugins ...
ERROR: generation of boot script file
/opt/mnesia/flopsy/plugins-scratch/rabbit.script failed:
{'EXIT',{{badmatch,{erl_prim_loader,error}},
         [{xref_utils,find_beam,1},
          {xref_base,'-make_libs/5-fun-0-',2},
          {lists,foldl,3},
          {xref_base,make_libs,5},
          {xref_base,do_set_up,1},
          {xref_base,do_set_up,2},
          {xref_base,q,3},
          {xref,handle_call,3}]}}

2) Tried a branch of Mochiweb that is R12B compatible from
http://github.com/lemenkov/mochiweb.git
Strangely, this referenced boolean(), which apparently is after Erlang R12,
so I changed this to bool(). 
This still didn't build correctly though - see below - so maybe I haven't
picked up the right branch.

[athomas at tlonapesbs52 mochiwebR12B]$ make
(cd src;make all)
make[1]: Entering directory `/home/athomas/projects/mochiwebR12B/src'
../support/make_app.escript mochiweb.app.src ../ebin/mochiweb.app _
"mochifmt mochifmt_records mochifmt_std mochiglobal mochihex mochijson2\
 mochijson mochilists mochilogfile2 mochinum mochitemp mochiutf8
mochiweb_acceptor mochiweb_app mochiweb_charref mochiweb_cookies mochiweb_\
cover mochiweb_echo mochiweb mochiweb_headers mochiweb_html mochiweb_http
mochiweb_io mochiweb_mime mochiweb_multipart mochiweb_request moc\
hiweb_response mochiweb_skel mochiweb_socket mochiweb_socket_server
mochiweb_sup mochiweb_util reloader"
escript: exception error: undefined function erl_scan:string/3
make[1]: *** [../ebin/mochiweb.app] Error 127
make[1]: Leaving directory `/home/athomas/projects/mochiwebR12B/src'
make: *** [all] Error 2

Any other tips appreciated

cheers
Alex




Alext0 wrote:
> 
> Crikey, low latency email! Thank you both...
> 
> Yes this is with R12B5, and explains why Mochiweb is missing erlang:max. 
> 
> I haven't been able to get R14B yet but will try that.
> 
> cheers
> Alex
> 
> 
> Simon MacMullen-2 wrote:
>> 
>> On 21/10/10 16:56, Alext0 wrote:
>>>
>>> Hi folks,
>>>
>>> Can anyone confirm whether the latest mgmt plugin works on 2.1.1?
>> 
>> Certainly should do.
>> 
>>> Just doing a fresh install on Linux and we see a crash from
>>> rabbit_mochiweb:
>>>      application: rabbit_mochiweb
>>>      exited: {shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}
>>>      type: permanent
>>>
>>> I thought we might be tempting fate running on RHEL 5.0 rather than 5.5
>>> but
>>> from what I understand this error usually indicates an app-level
>>> problem.
>> 
>> Which Erlang? Mochiweb unfortunately needs a newer one than the R12B5 in 
>> EPEL (yes, this is going to be documented better).
>> 
>> I noticed today that http://repos.fedorapeople.org/ claims to have an 
>> RPM for R14B that is compatible with EPEL 5 / EPEL 6.
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 

-- 
View this message in context: http://old.nabble.com/Mgmt-plugin-%282.1.1%29-tp30020890p30028590.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From georgios.paraskevas at excelian.com  Fri Oct 22 14:05:37 2010
From: georgios.paraskevas at excelian.com (gparaskevas80)
Date: Fri, 22 Oct 2010 06:05:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Pushing many chunks of messages...
In-Reply-To: <yrv4c1v7iy4h9.fsf@dwragg.eng.vmware.com>
References: <30020626.post@talk.nabble.com>
	<yrv4c1v7iy4h9.fsf@dwragg.eng.vmware.com>
Message-ID: <30028465.post@talk.nabble.com>


Hi David,
I understand the asynchronous nature of AMPQ, but I was wondering that in
the case that you want to send lots of messages which have to be ordered.
Surely in that case being able to send lots of messages at one go would
provide an advantage... Of course if my logic is flawed I do apologise :)

George


David Wragg-4 wrote:
> 
> Hi Georgios,
> 
> gparaskevas80 <georgios.paraskevas at excelian.com> writes:
>> Does anyone knows if it is possible to send to the RabbitMQ server
>> bunches
>> of messages at one go instead one after the other?
> 
> The publish operation in AMQP is asynchronous - after publishing a
> message, a client does not have to wait to hear back from the server
> before publishing more mesages.  So there would be no efficiency
> advantage in a batch publish operation.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Pushing-many-chunks-of-messages...-tp30020626p30028465.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From james.anderson at setf.de  Fri Oct 22 16:16:17 2010
From: james.anderson at setf.de (james anderson)
Date: Fri, 22 Oct 2010 17:16:17 +0200
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <4CC17B41.2060708@rabbitmq.com>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>
	<4CC17B41.2060708@rabbitmq.com>
Message-ID: <E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>

good afternoon;

thank you for your note.

On 2010-10-22, at 13:53 , Simon MacMullen wrote:

> On 22/10/10 12:44, james anderson wrote:
>
> <snip>
>> i understand this, and the code in the repository[3] to indicate that
>> the 115,6,83 at the start of the fourth line of the content vector,
>> above, was decoded as a short 16/signed instead of the intended  
>> six byte
>> short string. given which state, the subsequent vector
>> <<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand  
>> these
>> events correctly?
>
> Yes.
>
> See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3 for a bit  
> more information, but in short this is an area where we believe the  
> spec to be incorrect.

ok. it would help, if the page which describes that rabbitmq  
implements 0.9.1 were to include something to the effect that the  
specification which version 2 purports to support is not the one to  
which the page links, but some other. perhaps it could also include a  
link to that other specification, or at least to the wiki errata  
page. perhaps the release notes page could include the topic. or  
perhaps the release news page.

>
> The upshot is that there isn't a way to put short strings in  
> tables; you have to use long strings.

evidently.
the question remains, whether rabbitmq's intention is that, a library  
which purports to implement the standard now needs to not only  
negotiate protocol version, but also implementation?

the errata describes a mail thread which includes contributions from  
tony [garnock-jones] and john o'hara. a link would be helpful here.  
without additional background, it is difficult to comprehend, why a  
standard would set one encoding and two prominent implementations  
would "gratuitously" disregard it. given the versioned nature of the  
protocol, as demonstrated by the variations to framing, there is no  
inherent reason that the type codes be identical across version.  
there must have been more at issue than the errata describes.

in any case, did their discussion ever progress further? can one  
expect that discussion to proceed to a conclusion? to a ratified  
errata for the specification itself? if one expects implementors to  
follow a ratified, published, standard specification to which the  
implementations purport to conform, that would be appropriate.

thanks,


From emile at rabbitmq.com  Fri Oct 22 17:18:42 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Oct 2010 17:18:42 +0100
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>	<4CC17B41.2060708@rabbitmq.com>
	<E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
Message-ID: <4CC1B962.2040506@rabbitmq.com>


Hi James,

On 22/10/10 16:16, james anderson wrote:
> good afternoon;
> 
> thank you for your note.
> 
> On 2010-10-22, at 13:53 , Simon MacMullen wrote:
> 
>> On 22/10/10 12:44, james anderson wrote:
>>
>> <snip>
>>> i understand this, and the code in the repository[3] to indicate that
>>> the 115,6,83 at the start of the fourth line of the content vector,
>>> above, was decoded as a short 16/signed instead of the intended six byte
>>> short string. given which state, the subsequent vector
>>> <<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand these
>>> events correctly?
>>
>> Yes.
>>
>> See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3 for a bit
>> more information, but in short this is an area where we believe the
>> spec to be incorrect.
> 
> ok. it would help, if the page which describes that rabbitmq implements
> 0.9.1 were to include something to the effect that the specification
> which version 2 purports to support is not the one to which the page
> links, but some other. perhaps it could also include a link to that
> other specification, or at least to the wiki errata page. perhaps the
> release notes page could include the topic. or perhaps the release news
> page.

That is a good suggestion, thanks.

>> The upshot is that there isn't a way to put short strings in tables;
>> you have to use long strings.
> 
> evidently.
> the question remains, whether rabbitmq's intention is that, a library
> which purports to implement the standard now needs to not only negotiate
> protocol version, but also implementation?

That should be possible by inspecting the server properties which are
returned by the server during protocol negotiation. If a library wishes
to use short strings and interoperate with multiple brokers then that
would be the only way at present.

> the errata describes a mail thread which includes contributions from
> tony [garnock-jones] and john o'hara. a link would be helpful here.

That discussion may not have taken place in public.

> without additional background, it is difficult to comprehend, why a
> standard would set one encoding and two prominent implementations would
> "gratuitously" disregard it. given the versioned nature of the protocol,
> as demonstrated by the variations to framing, there is no inherent
> reason that the type codes be identical across version. there must have
> been more at issue than the errata describes.

I can assure you that there is nothing gratuitous about the way RabbitMQ
interprets the spec. We believe the spec contains a mistake in this case
and we have implemented what was probably intended.

> in any case, did their discussion ever progress further? can one expect
> that discussion to proceed to a conclusion? to a ratified errata for the
> specification itself? if one expects implementors to follow a ratified,
> published, standard specification to which the implementations purport
> to conform, that would be appropriate.

The RabbitMQ project is in a good position to motivate that the
collected errata inform subsequent revisions of the spec. If concerned
members of the AMQP community such as yourself petition for this cause
then it becomes ever more likely.


Regards

Emile






From mikeb at rabbitmq.com  Fri Oct 22 18:22:07 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 22 Oct 2010 18:22:07 +0100
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>	<4CC17B41.2060708@rabbitmq.com>
	<E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
Message-ID: <4CC1C83F.5000107@rabbitmq.com>

James,

>> <snip>
>>> i understand this, and the code in the repository[3] to indicate that
>>> the 115,6,83 at the start of the fourth line of the content vector,
>>> above, was decoded as a short 16/signed instead of the intended six byte
>>> short string. given which state, the subsequent vector
>>> <<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand these
>>> events correctly?
>>
>> Yes.
>>
>> See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3 for a bit
>> more information, but in short this is an area where we believe the
>> spec to be incorrect.
>
> ok. it would help, if the page which describes that rabbitmq implements
> 0.9.1 were to include something to the effect that the specification
> which version 2 purports to support is not the one to which the page
> links, but some other. perhaps it could also include a link to that
> other specification, or at least to the wiki errata page. perhaps the
> release notes page could include the topic. or perhaps the release news
> page.

In general RabbitMQ tries very hard to implement the letter of the 
specification; however there are a few things in the published AMQP 
0-9-1, as in most specifications, that are either ambiguous or 
inconsistent.  In those cases we set out in the errata what is it 
RabbitMQ /does/ do.  This is not an unusual situation.

As an egregious though amusing example, see the published *AMQP 0-8* 
specification under the heading "4.2.2 Protocol Header".

If you are cross because this cost you time and effort, then I 
sympathise -- we've spent rather a lot of time and effort ourselves 
trying to implement 0-9-1 in a way that it consistent /and/ 
interoperates with other implementations.

>> The upshot is that there isn't a way to put short strings in tables;
>> you have to use long strings.
>
> evidently.
> the question remains, whether rabbitmq's intention is that, a library
> which purports to implement the standard now needs to not only negotiate
> protocol version, but also implementation?

Sadly, it is a choice between being faithful to the specification and 
working with the implementations extant.  For us, too.

[...]
> can one expect
> that discussion to proceed to a conclusion? to a ratified errata for the
> specification itself? if one expects implementors to follow a ratified,
> published, standard specification to which the implementations purport
> to conform, that would be appropriate.

I'm not going to disagree.


Michael.

From james.anderson at setf.de  Sat Oct 23 00:38:27 2010
From: james.anderson at setf.de (james anderson)
Date: Sat, 23 Oct 2010 01:38:27 +0200
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <4CC1B962.2040506@rabbitmq.com>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>	<4CC17B41.2060708@rabbitmq.com>
	<E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
	<4CC1B962.2040506@rabbitmq.com>
Message-ID: <0093F271-23F5-46F9-9BF8-51D15B221FF6@setf.de>

good evening emile,

thank you for your note.

On 2010-10-22, at 18:18 , Emile Joubert wrote:

>
> Hi James,
>
> [...]
>
>>> The upshot is that there isn't a way to put short strings in tables;
>>> you have to use long strings.
>>
>> evidently.
>> the question remains, whether rabbitmq's intention is that, a library
>> which purports to implement the standard now needs to not only  
>> negotiate
>> protocol version, but also implementation?
>
> That should be possible by inspecting the server properties which are
> returned by the server during protocol negotiation. If a library  
> wishes
> to use short strings and interoperate with multiple brokers then that
> would be the only way at present.

in other words, "yes", despite the technical capacity inherent in the  
standard interoperability now requires implementation negotiation.
>
>> the errata describes a mail thread which includes contributions from
>> tony [garnock-jones] and john o'hara. a link would be helpful here.
>
> That discussion may not have taken place in public.
>
>> without additional background, it is difficult to comprehend, why a
>> standard would set one encoding and two prominent implementations  
>> would
>> "gratuitously" disregard it. given the versioned nature of the  
>> protocol,
>> as demonstrated by the variations to framing, there is no inherent
>> reason that the type codes be identical across version. there must  
>> have
>> been more at issue than the errata describes.
>
> I can assure you that there is nothing gratuitous about the way  
> RabbitMQ
> interprets the spec.

absent the insights achieved in the private discussions, the rabbitmq  
interpretation is no more or less necessary than the qpid-0-9 v/s  
amqp-0-9-1 type code incompatibility. the text in the errata does  
little to justify the interpretation.

> We believe the spec contains a mistake in this case
> and we have implemented what was probably intended.

then rabbitmq shouldn't purport to conform to that version of the  
specification.
there would not be anything inherently wrong with that.

>
>> in any case, did their discussion ever progress further? can one  
>> expect
>> that discussion to proceed to a conclusion? to a ratified errata  
>> for the
>> specification itself? if one expects implementors to follow a  
>> ratified,
>> published, standard specification to which the implementations  
>> purport
>> to conform, that would be appropriate.
>
> The RabbitMQ project is in a good position to motivate that the
> collected errata inform subsequent revisions of the spec. If concerned
> members of the AMQP community such as yourself petition for this cause
> then it becomes ever more likely.

i am at a loss, why an outsider should need to petition for an  
obvious and evidently necessary step in a standards process, but i'll  
ask anyway: to whom?


From james.anderson at setf.de  Sat Oct 23 00:38:30 2010
From: james.anderson at setf.de (james anderson)
Date: Sat, 23 Oct 2010 01:38:30 +0200
Subject: [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
In-Reply-To: <4CC1C83F.5000107@rabbitmq.com>
References: <CF7D2F03-0683-4C5E-A8B0-B357FA3894B1@setf.de>	<4CC17B41.2060708@rabbitmq.com>
	<E5B1F9B3-99DC-4A77-9D5D-431F6F075DBA@setf.de>
	<4CC1C83F.5000107@rabbitmq.com>
Message-ID: <79377FA6-D916-409B-B41D-DF1EDE4DC0A4@setf.de>

good evening, michael;

thank you for your note;

On 2010-10-22, at 19:22 , Michael Bridgen wrote:

> James,
>
>>> <snip>
>>>> i understand this, and the code in the repository[3] to indicate  
>>>> that
>>>> the 115,6,83 at the start of the fourth line of the content vector,
>>>> above, was decoded as a short 16/signed instead of the intended  
>>>> six byte
>>>> short string. given which state, the subsequent vector
>>>> <<84,82,73,78,71,7,80, ...>> matched no pattern. do i understand  
>>>> these
>>>> events correctly?
>>>
>>> Yes.
>>>
>>> See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3 for a bit
>>> more information, but in short this is an area where we believe the
>>> spec to be incorrect.
>>
>> ok. it would help, if the page which describes that rabbitmq  
>> implements
>> 0.9.1 were to include something to the effect that the specification
>> which version 2 purports to support is not the one to which the page
>> links, but some other. perhaps it could also include a link to that
>> other specification, or at least to the wiki errata page. perhaps the
>> release notes page could include the topic. or perhaps the release  
>> news
>> page.
>
> In general RabbitMQ tries very hard to implement the letter of the  
> specification; however there are a few things in the published AMQP  
> 0-9-1, as in most specifications, that are either ambiguous or  
> inconsistent.  In those cases we set out in the errata what is it  
> RabbitMQ /does/ do.  This is not an unusual situation.
>
> As an egregious though amusing example, see the published *AMQP  
> 0-8* specification under the heading "4.2.2 Protocol Header".

another author was kind enough some months ago to have cleared up any  
misconceptions and unreasonable expectations which i might have had  
about those passages.

>
> If you are cross because this cost you time and effort, then I  
> sympathise -- we've spent rather a lot of time and effort ourselves  
> trying to implement 0-9-1 in a way that it consistent /and/  
> interoperates with other implementations.
>
>>> The upshot is that there isn't a way to put short strings in tables;
>>> you have to use long strings.
>>
>> evidently.
>> the question remains, whether rabbitmq's intention is that, a library
>> which purports to implement the standard now needs to not only  
>> negotiate
>> protocol version, but also implementation?
>
> Sadly, it is a choice between being faithful to the specification  
> and working with the implementations extant.  For us, too.

i am not cross. independent of any questions of lost time and/or  
unsatisfactory documentation, i am disappointed. the amqp  
specification provides sufficient technical capacity, that an  
argument that the type codes need be identical between versions is  
unfounded. i was not (evidently, fortunately) witness to the history,  
but if the issue is that qpid claimed a combination between an 9.0.1  
and an incompatible set of type codes, then the logical step would  
have been to assign that set and the set in the present 9.0.1  
specification a distinct versions of the specification. given which  
option the choice, above, is difficult to comprehend.


From omp08 at doc.ic.ac.uk  Sat Oct 23 03:05:29 2010
From: omp08 at doc.ic.ac.uk (Olivier Pernet)
Date: Sat, 23 Oct 2010 03:05:29 +0100
Subject: [rabbitmq-discuss] Status of C client libraries
Message-ID: <AANLkTi=+8T-1ggG-ONBkZwsZn8NXjc4tGJ+WpiZLhjTG@mail.gmail.com>

Hi everyone,

I need to use RabbitMQ from OCaml, and since I can't find any OCaml
AMQP client libraries, I'm planning to use the OCaml FFI to wrap one
of the C libraries. I found two C libraries with recent activity: the
"experimental" one from Rabbit (http://hg.rabbitmq.com/rabbitmq-c/),
and the one at http://github.com/dg1sbg/librabbitmq.
Which one would you recommend me to use?

Olivier Pernet

From david at rabbitmq.com  Sat Oct 23 11:23:37 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 23 Oct 2010 11:23:37 +0100
Subject: [rabbitmq-discuss] Status of C client libraries
In-Reply-To: <AANLkTi=+8T-1ggG-ONBkZwsZn8NXjc4tGJ+WpiZLhjTG@mail.gmail.com>
	(Olivier Pernet's message of "Sat, 23 Oct 2010 03:05:29 +0100")
References: <AANLkTi=+8T-1ggG-ONBkZwsZn8NXjc4tGJ+WpiZLhjTG@mail.gmail.com>
Message-ID: <yrv4cfwvxyzpy.fsf@dwragg.eng.vmware.com>

Hi Olivier,

Olivier Pernet <omp08 at doc.ic.ac.uk> writes:
> I need to use RabbitMQ from OCaml, and since I can't find any OCaml
> AMQP client libraries, I'm planning to use the OCaml FFI to wrap one
> of the C libraries. I found two C libraries with recent activity: the
> "experimental" one from Rabbit (http://hg.rabbitmq.com/rabbitmq-c/),
> and the one at http://github.com/dg1sbg/librabbitmq.
> Which one would you recommend me to use?

You should probably use rabbitmq-c.

<http://github.com/dg1sbg/librabbitmq> contains Frank Goenninger's work
on porting our rabbitmq-c client to build under Visual Studio.  We are
in the process of updating the main rabbitmq-c repo so that it can also
build with the Microsoft toolchain, and produce a DLL to be used from
Visual Studio.  So if your primary platform today is MS Visual Studio,
then you face a choice between the two.  Otherwise, you should just go
with rabbitmq-c.

rabbitmq-c is experimental in the sense that is is not currently at the
same level of maturity as the Java and .NET clients that we release
alongside our broken.  It is our intention that rabbitmq-c will graduate
to officially-supported status at some point.  But there will be some
API changes along the way.

With that said, rabbitmq-c is already widely used, and we're not aware
of bugs in it.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david at rabbitmq.com  Sat Oct 23 12:38:30 2010
From: david at rabbitmq.com (David Wragg)
Date: Sat, 23 Oct 2010 12:38:30 +0100
Subject: [rabbitmq-discuss] Pushing many chunks of messages...
In-Reply-To: <30028465.post@talk.nabble.com> (gparaskevas's message of "Fri,
	22 Oct 2010 06:05:37 -0700 (PDT)")
References: <30020626.post@talk.nabble.com>
	<yrv4c1v7iy4h9.fsf@dwragg.eng.vmware.com>
	<30028465.post@talk.nabble.com>
Message-ID: <yrv4cbp6lyw95.fsf@dwragg.eng.vmware.com>

gparaskevas80 <georgios.paraskevas at excelian.com> writes:
> I understand the asynchronous nature of AMPQ, but I was wondering that in
> the case that you want to send lots of messages which have to be ordered.
> Surely in that case being able to send lots of messages at one go would
> provide an advantage... Of course if my logic is flawed I do apologise
> :)

You can publish many message asynchronously, and they will remain
ordered - as long as you do it on a single channel and obey the other
constraints AMQP imposes for message ordering.

I'll turn the question around: Where do you expect the efficiency gains
(or other advantages) to come from if there was a batch publish
operation?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From amr.mostafa at gmail.com  Sat Oct 23 19:20:19 2010
From: amr.mostafa at gmail.com (Amr Mostafa)
Date: Sat, 23 Oct 2010 20:20:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ Cilent: Allow specifying the connect
	timeout
Message-ID: <AANLkTi=jY7CCcYnjtnftBuqaAVdZJFZ5F03RjH+Fhmi+@mail.gmail.com>

Hi,

I've been searching around for a way to specify a connect timeout in the
Java client, but couldn't find an easy way to do that. There is one way,
which is by extending ConnectionFactory with a custom createFrameHandler
method, but that doesn't work with my case since I'm using Spring AMQP
support on top of the client API.

It would be very useful to add an option for that in the ConnectionFactory
which, if specified, would be passed to the socket connect call.

Similar (old) thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-November/005291.html

Kind Regards,

-- 
Amr Mostafa
Egypt Development Center
Member of NTG
Mobile: +(2012)1700502
Office: +(202)24052355/6 - Ext.: 2005
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101023/24d7f07c/attachment.htm>

From neerajapte at gmail.com  Sun Oct 24 09:02:37 2010
From: neerajapte at gmail.com (paneer_tikka)
Date: Sun, 24 Oct 2010 01:02:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Publishing binary messages using ruby amqp gem
Message-ID: <86de46d2-97a1-4178-8fbc-e748020770eb@y23g2000yqd.googlegroups.com>

Hi,
  Has anyone published binary messages (where payload is binary) to
RabbitMQ using amqp gem? I am a newbie when it comes to RabbitMQ/AMQP.
I am able to publish text files and json messages fine. Having read
that RabbitMQ message is a pure binary message, I thought publishing
binary payload would be as simple as passing the bytes of the message
to the "publish" call.
When I try to publish a binary message, it seems that the queue simply
?hangs?. Any further messages on the queue, even text messages, seem
to get ?stuck?. Here?s a simple test code you can run from irb. If I
run it as it is, the client gets the 'blabla' text message fine. Now
if I change the publisher to publish the contents (uncomment the line
q.publish(contents)), the queue seems to hang from there on. Any
subsequent text messages also seem to be lost.

I am hoping that I?m missing something obvious here, like a
configuration param to the queue or an optional arg to the publish
method, but I haven?t been able to figure it out. Spent several hours
fighting with this yesterday. Can anyone help please?

--- publisher---
require ?mq?
AMQP.start(:host => '127.0.0.1') do
 q = MQ.queue('test_bin_q')
 contents = open('C:/Temp/guid.zip', "rb") {|io| io.read }
 #q.publish(contents)
 q.publish(?blabla?)
 puts 'done publishing'
end
----------------

--- subscriber---
AMQP.start(:host => '127.0.0.1') do
 q = MQ.queue('test_bin_q1')
 q.subscribe {|message| puts "got it!\n#{message}"}
end
----------------

Neeraj

From neerajapte at gmail.com  Sun Oct 24 15:40:47 2010
From: neerajapte at gmail.com (paneer_tikka)
Date: Sun, 24 Oct 2010 07:40:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Publishing binary messages using ruby amqp
	gem
In-Reply-To: <86de46d2-97a1-4178-8fbc-e748020770eb@y23g2000yqd.googlegroups.com>
References: <86de46d2-97a1-4178-8fbc-e748020770eb@y23g2000yqd.googlegroups.com>
Message-ID: <a947623b-365a-42c4-9d14-7ab971d172a4@j25g2000yqa.googlegroups.com>

To answer my own question -

All I had to do was to change:
q.subscribe {|message| puts "got it!\n#{message}"}

TO:
q.subscribe {|header, message| puts "got it!\n#{message}"}

Unfortunately I couldn't readily find it in the documentation of the
gem.
Hopefully it will save someone some time!

- Neeraj

On Oct 24, 1:02?pm, paneer_tikka <neeraja... at gmail.com> wrote:
> Hi,
> ? Has anyone published binary messages (where payload is binary) to
> RabbitMQ using amqp gem? I am a newbie when it comes to RabbitMQ/AMQP.
> I am able to publish text files and json messages fine. Having read
> that RabbitMQ message is a pure binary message, I thought publishing
> binary payload would be as simple as passing the bytes of the message
> to the "publish" call.
> When I try to publish a binary message, it seems that the queue simply
> ?hangs?. Any further messages on the queue, even text messages, seem
> to get ?stuck?. Here?s a simple test code you can run from irb. If I
> run it as it is, the client gets the 'blabla' text message fine. Now
> if I change the publisher to publish the contents (uncomment the line
> q.publish(contents)), the queue seems to hang from there on. Any
> subsequent text messages also seem to be lost.
>
> I am hoping that I?m missing something obvious here, like a
> configuration param to the queue or an optional arg to the publish
> method, but I haven?t been able to figure it out. Spent several hours
> fighting with this yesterday. Can anyone help please?
>
> --- publisher---
> require ?mq?
> AMQP.start(:host => '127.0.0.1') do
> ?q = MQ.queue('test_bin_q')
> ?contents = open('C:/Temp/guid.zip', "rb") {|io| io.read }
> ?#q.publish(contents)
> ?q.publish(?blabla?)
> ?puts 'done publishing'
> end
> ----------------
>
> --- subscriber---
> AMQP.start(:host => '127.0.0.1') do
> ?q = MQ.queue('test_bin_q1')
> ?q.subscribe {|message| puts "got it!\n#{message}"}
> end
> ----------------
>
> Neeraj
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From akalend at mail.ru  Sun Oct 24 23:09:51 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Mon, 25 Oct 2010 02:09:51 +0400
Subject: [rabbitmq-discuss]
	=?windows-1251?q?Status_of_C_client_libraries?=
In-Reply-To: <AANLkTi8T-1ggG-ONBkZwsZn8NXjc4tGJ+WpiZLhjTG@mail.gmail.com>
References: <AANLkTi8T-1ggG-ONBkZwsZn8NXjc4tGJ+WpiZLhjTG@mail.gmail.com>
Message-ID: <E1PA8lD-000237-00.akalend-mail-ru@f265.mail.ru>

The second library is double first.
I use the lib from official site http://hg.rabbitmq.com/rabbitmq-c

Alexandre

From charlvn at charlvn.com  Mon Oct 25 13:40:50 2010
From: charlvn at charlvn.com (Charl van Niekerk)
Date: Mon, 25 Oct 2010 14:40:50 +0200
Subject: [rabbitmq-discuss] AMPQ PHP Extensions on Ubuntu 10.04
Message-ID: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>

Hi All,

I recently installed the rabbitmq-server package on Ubuntu 10.04 and
am now trying to get one of the available PHP extensions installed and
configured. I seem to be hitting compilation errors though.

Firstly, I tried to install the amqp-0.1.1 package directly from PECL:

http://pecl.php.net/package/amqp
http://pastebin.com/S8EDmPF1

Then I tried php-amqp 0.0.7:

http://code.google.com/p/php-amqp/
http://pastebin.com/PDptCs64

And afterwards php-rabbit:

http://code.google.com/p/php-rabbit/
http://pastebin.com/5hTCR1HG

I installed librabbitmq-c / librabbitmq-codegen prior to attempting
php-amqp 0.0.7 or php-rabbit and it seems to have completed without
any trouble.

Any help / advice would be much appreciated!

Thanks,
Charl

From mikeb at rabbitmq.com  Mon Oct 25 14:04:30 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 25 Oct 2010 14:04:30 +0100
Subject: [rabbitmq-discuss] *Advisory* Clustering not working for some
 connections
In-Reply-To: <a8b6a554-f109-4b78-97d9-40412a66dcd3@t8g2000yqk.googlegroups.com>
References: <2c7ad6b9-0503-434f-a346-450ed5deab23@26g2000yqv.googlegroups.com>
	<a8b6a554-f109-4b78-97d9-40412a66dcd3@t8g2000yqk.googlegroups.com>
Message-ID: <4CC5805E.4010103@rabbitmq.com>

All,

We are pretty sure we have traced this to the inter-node routing code 
used in clustering.

It's quite hard to reproduce, and in general seems uncommon; however, 
/if/ you are using clustering /and/ you see these symptoms:

  - publishing across nodes stops working
  - rabbitmqctl list_queues or list_connections don't respond
  - RabbitMQ has to have a hard restart

it is likely to be this problem, and we advise trying to adapt your 
set-up to work without clustering for the time being.

We are working on fixing it in the next release.


Michael

--
Michael Bridgen
Staff Engineer, RabbitMQ


>    I just noticed that on my tests the producers are also getting
> blocked (we are using a java client and basicPublish()).
>
>    Trying to list_consumers also becomes unresponsive at this point.
>
>    Any help would be really appreciated.
>
>    Thank you,
>
> --
> Ivan Sanchez
>
> On Oct 21, 3:55 pm, Ivan Sanchez<s4nc... at gmail.com>  wrote:
>>    Hi all,
>>
>>    We are trying to run a cluster of 2 rabbitmq machines on Amazon EC2
>> and although it runs fine for a little while, at some stage it stops
>> working only for messages where producer and consumer are connected to
>> different nodes. At this point, "rabbitmqctl list_connections" becomes
>> completely unresponsive, as well as trying to restart the servers. The
>> only option is kill -9 all erlang process and start them again.
>>
>>    rabbitmqctl status shows:
>>
>> Status of node rabbit at rabbit1 ...
>> [{running_applications,
>>       [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
>>        {webmachine,"webmachine","1.7.0"},
>>        {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
>>        {rabbit,"RabbitMQ","2.1.0"},
>>        {os_mon,"CPO  CXC 138 46","2.2.5"},
>>        {sasl,"SASL  CXC 138 11","2.1.9"},
>>        {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
>>        {mochiweb,"MochiMedia Web Server","1.3"},
>>        {crypto,"CRYPTO version 1","1.6.4"},
>>        {inets,"INETS  CXC 138 49","5.3"},
>>        {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>>        {stdlib,"ERTS  CXC 138 10","1.16.5"},
>>        {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>>   {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
>>   {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
>> ...done.
>>
>> Status of node rabbit at rabbit2 ...
>> [{running_applications,
>>       [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
>>        {webmachine,"webmachine","1.7.0"},
>>        {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
>>        {rabbit,"RabbitMQ","2.1.0"},
>>        {os_mon,"CPO  CXC 138 46","2.2.5"},
>>        {sasl,"SASL  CXC 138 11","2.1.9"},
>>        {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
>>        {mochiweb,"MochiMedia Web Server","1.3"},
>>        {crypto,"CRYPTO version 1","1.6.4"},
>>        {inets,"INETS  CXC 138 49","5.3"},
>>        {mnesia,"MNESIA  CXC 138 12","4.4.13"},
>>        {stdlib,"ERTS  CXC 138 10","1.16.5"},
>>        {kernel,"ERTS  CXC 138 10","2.13.5"}]},
>>   {nodes,[{disc,[rabbit at rabbit1,rabbit at rabbit2]}]},
>>   {running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
>> ...done.
>>
>> On the logs of rabbit2, the only error I see some of these:
>>
>> =ERROR REPORT==== 21-Oct-2010::14:40:47 ===
>> exception on TCP connection<0.19069.0>  from 88.211.55.18:13580
>> {bad_header,<<"<policy-">>}
>>
>>    Other information:
>>    - The hostnames (rabbit1, rabbit2) are defined in /etc/hosts on both
>> machines using their private IP, and consumers access them through a
>> DNS round-robin to their public IP
>>    - Both machines use NODENAME=rabbit@<host>  on /etc/rabbitmq/
>> rabbitmq.conf
>>    - Cluster is defined in /etc/rabbitmq/rabbitmq.config using
>> {cluster_nodes, ['rabbit at rabbit1','rabbit at rabbit2']}
>>    - We are using RabbitMQ 2.1.0 and Erlang R13B04 (erts-5.7.5)
>> [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-
>> poll:false]
>>
>>    Any ideas of what can be wrong?
>>
>> --
>> Ivan Sanchez
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david at rabbitmq.com  Mon Oct 25 14:35:16 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 25 Oct 2010 14:35:16 +0100
Subject: [rabbitmq-discuss] AMPQ PHP Extensions on Ubuntu 10.04
In-Reply-To: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>
	(Charl van Niekerk's message of "Mon, 25 Oct 2010 14:40:50 +0200")
References: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>
Message-ID: <yrv4c8w1m1jl7.fsf@dwragg.eng.vmware.com>

Hi Charl,

Charl van Niekerk <charlvn at charlvn.com> writes:
> I recently installed the rabbitmq-server package on Ubuntu 10.04 and
> am now trying to get one of the available PHP extensions installed and
> configured. I seem to be hitting compilation errors though.
>
> Firstly, I tried to install the amqp-0.1.1 package directly from PECL:
>
> http://pecl.php.net/package/amqp
> http://pastebin.com/S8EDmPF1

Looks like this one might not be happy that librabbitmq is installed under
/usr/local?

> Then I tried php-amqp 0.0.7:
>
> http://code.google.com/p/php-amqp/
> http://pastebin.com/PDptCs64
>
> And afterwards php-rabbit:
>
> http://code.google.com/p/php-rabbit/
> http://pastebin.com/5hTCR1HG

These errors appear to be due to the extension code targeting an older
version of rabbitmq-c than what's currently in default.  rabbitmq-c is
still maturing, and sometimes we make changes to its API.  At this
point, code using librabbitmq should probably document the revision ID
of rabbitmq-c it is known to work against.

It would be good to bring those extensions up to date to work against
the current librabbitmq.  I'd be happy to help by reviewing the code for
one of the projects, if someone can tell me which project I should
review.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From charlvn at charlvn.com  Mon Oct 25 14:39:53 2010
From: charlvn at charlvn.com (Charl van Niekerk)
Date: Mon, 25 Oct 2010 15:39:53 +0200
Subject: [rabbitmq-discuss] AMPQ PHP Extensions on Ubuntu 10.04
In-Reply-To: <yrv4c8w1m1jl7.fsf@dwragg.eng.vmware.com>
References: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>
	<yrv4c8w1m1jl7.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTinYpPN6Nje_+oG4OiGoMupzFEVUOW1ezBX5f01T@mail.gmail.com>

On Mon, Oct 25, 2010 at 3:35 PM, David Wragg <david at rabbitmq.com> wrote:
> These errors appear to be due to the extension code targeting an older
> version of rabbitmq-c than what's currently in default. ?rabbitmq-c is
> still maturing, and sometimes we make changes to its API. ?At this
> point, code using librabbitmq should probably document the revision ID
> of rabbitmq-c it is known to work against.

Thanks very much for the info, David. The code I need to write is
going to be part of a GPL-licensed open source project, I am thinking
I should use the php-amqplib library for the moment. It seems to be
all-PHP so will be less efficient but might be a more stable solution
for the interim:

http://code.google.com/p/php-amqplib/

Any thoughts appreciated.

Thanks,
Charl

From videlalvaro at gmail.com  Mon Oct 25 14:43:02 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 25 Oct 2010 21:43:02 +0800
Subject: [rabbitmq-discuss] AMPQ PHP Extensions on Ubuntu 10.04
In-Reply-To: <AANLkTinYpPN6Nje_+oG4OiGoMupzFEVUOW1ezBX5f01T@mail.gmail.com>
References: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>
	<yrv4c8w1m1jl7.fsf@dwragg.eng.vmware.com>
	<AANLkTinYpPN6Nje_+oG4OiGoMupzFEVUOW1ezBX5f01T@mail.gmail.com>
Message-ID: <E1AF0B29-0BDA-4BC9-86E6-B24F4943B9CB@gmail.com>

Hi,

You might want to check

This:

http://github.com/videlalvaro/Thumper/

and this:

http://github.com/tnc/php-amqplib

Is the same library that you want to use, but is PHP 5.3 compatible plus some minor performance improvements.

Regards,

Alvaro

On Oct 25, 2010, at 9:39 PM, Charl van Niekerk wrote:

> On Mon, Oct 25, 2010 at 3:35 PM, David Wragg <david at rabbitmq.com> wrote:
>> These errors appear to be due to the extension code targeting an older
>> version of rabbitmq-c than what's currently in default.  rabbitmq-c is
>> still maturing, and sometimes we make changes to its API.  At this
>> point, code using librabbitmq should probably document the revision ID
>> of rabbitmq-c it is known to work against.
> 
> Thanks very much for the info, David. The code I need to write is
> going to be part of a GPL-licensed open source project, I am thinking
> I should use the php-amqplib library for the moment. It seems to be
> all-PHP so will be less efficient but might be a more stable solution
> for the interim:
> 
> http://code.google.com/p/php-amqplib/
> 
> Any thoughts appreciated.
> 
> Thanks,
> Charl
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From julian at boxsolutions.com  Mon Oct 25 16:06:51 2010
From: julian at boxsolutions.com (Julian Charles Ball)
Date: Mon, 25 Oct 2010 16:06:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure
Message-ID: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>

Hi

Our RabbitMQ instance died a death today and threw up the following in its
log, is this meaningful to anyone?  I'm new to the wonderful world of
Rabbit!

=INFO REPORT==== 25-Oct-2010::12:59:20 ===
closing TCP connection <0.2019.1097> from 192.168.10.8:44459

=ERROR REPORT==== 25-Oct-2010::12:59:20 ===
** Generic server <0.209.0> terminating
** Last message in was {'$gen_cast',{ack,none,[18045],<0.18112.556>}}
** When Server state == {q,
                        {amqqueue,
                         {resource,<<"onevhost">>,queue,<<"celery">>},
                         true,false,none,[],<0.209.0>},
                        none,true,rabbit_variable_queue,

                        {vqstate,
                         {[],[]},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {[],[]},
                         18048,
                         {dict,43,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[[17779|
                              {true,
                               <<187,33,167,59,240,134,152,31,154,119,54,20,
                                 249,149,197,153>>}],
                             [18042|
                              {true,
                               <<145,248,188,106,249,32,22,45,119,174,235,
                                 195,228,80,130,153>>}]],
                            [[17766|
                              {true,
                               <<18,73,252,227,117,133,163,22,201,41,4,151,
                                 147,213,153,3>>}],
                             [17814|
                              {true,
                               <<5,79,81,253,245,22,82,158,146,80,80,158,70,
                                 236,88,61>>}],
:

                             [17830|
                              {true,
                               <<6,168,213,43,164,33,118,44,191,229,228,250,
                                 178,249,161,122>>}],
                             [17846|
                              {true,
                               <<175,192,248,83,218,17,226,81,169,176,86,
                                 194,70,30,113,23>>}],
                             [17862|
                              {true,
                               <<46,206,171,231,248,194,202,94,0,161,64,26,
                                 137,166,45,60>>}],
                             [18045|
                              {true,
                               <<66,1,214,55,86,118,209,220,74,116,116,227,
                                 137,129,32,109>>}]],
                            [[17801|
                              {true,
                               <<59,74,186,81,39,108,9,65,59,17,39,253,137,
                                 158,172,34>>}]],
                            [[17692|
                              {true,
                               <<64,0,224,186,10,116,138,181,238,138,181,
                                 111,117,120,162,122>>}]],
                            [[17679|
                              {true,
                               <<125,130,6,70,84,13,135,81,61,89,241,141,6,
                                 84,242,169>>}],
                             [17775|
:

                             [17775|
                              {true,
                               <<99,67,7,101,129,68,39,103,27,245,48,20,
                                 246,115,250,102>>}]],
                            [[17762|
                              {true,
                               <<230,8,221,78,53,105,234,120,239,151,146,
                                 107,153,178,87,127>>}],
                             [17810|
                              {true,
                               <<119,117,87,21,33,143,210,173,67,8,243,114,
                                 231,137,247,139>>}],
                             [17826|
                              {true,
                               <<113,161,27,143,139,49,80,198,167,89,125,
                                 198,75,50,149,188>>}],
                             [17842|
                              {true,
                               <<193,251,248,183,25,0,147,234,12,105,168,
                                 248,69,172,107,16>>}],
                             [17858|
                              {true,
                               <<156,254,173,85,235,208,232,93,119,50,66,10,
                                 97,71,143,63>>}],
                             [17874|
                              {true,
                               <<58,28,54,119,156,184,133,136,239,218,203,
                                 235,74,97,234,150>>}]],
                            [[18044|
:

and it goes on forever along the same lines....

-- 
- - - - - - -
Julian Charles Ball
:: BOX ::

Call me on +44 (0)7737 123341
Email me on julian at boxsolutions.com
Visit us at www.boxsolutions.com

Find out more information about BOX's ONE Media Manager at
www.onemediamanager.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101025/8667d1f5/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Oct 25 16:14:29 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 25 Oct 2010 16:14:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure
In-Reply-To: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>
References: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>
Message-ID: <20101025151428.GC32334@wellquite.org>

On Mon, Oct 25, 2010 at 04:06:51PM +0100, Julian Charles Ball wrote:
> and it goes on forever along the same lines....

No it doesn't. It will stop, and much meaningful information is in the
logs right at the bottom. Any chance you can send us the complete logs?
(Maybe to info at rabbitmq.com rather than spamming the list, if the logs
are big?).

Also, which version of Rabbit are you running, and which version of
Erlang are you using?


Best wishes,

Matthew

From julian at boxsolutions.com  Mon Oct 25 16:36:49 2010
From: julian at boxsolutions.com (Julian Charles Ball)
Date: Mon, 25 Oct 2010 16:36:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure
In-Reply-To: <20101025151428.GC32334@wellquite.org>
References: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>
	<20101025151428.GC32334@wellquite.org>
Message-ID: <AANLkTindoe5TJCyU66Z72Rj9QKpO_Siw0chv3vURPc1P@mail.gmail.com>

Thanks Matthew, my colleague Harel is better placed to answer the version
questions... Harel, could you respond please and perhaps send a copy of the
log?

On 25 October 2010 16:14, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Mon, Oct 25, 2010 at 04:06:51PM +0100, Julian Charles Ball wrote:
> > and it goes on forever along the same lines....
>
> No it doesn't. It will stop, and much meaningful information is in the
> logs right at the bottom. Any chance you can send us the complete logs?
> (Maybe to info at rabbitmq.com rather than spamming the list, if the logs
> are big?).
>
> Also, which version of Rabbit are you running, and which version of
> Erlang are you using?
>
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
- - - - - - -
Julian Charles Ball
:: BOX ::

Call me on +44 (0)7737 123341
Email me on julian at boxsolutions.com
Visit us at www.boxsolutions.com

Find out more information about BOX's ONE Media Manager at
www.onemediamanager.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101025/9ba16eb1/attachment.htm>

From pdezwart at rubiconproject.com  Mon Oct 25 18:49:14 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 25 Oct 2010 10:49:14 -0700
Subject: [rabbitmq-discuss] AMPQ PHP Extensions on Ubuntu 10.04
In-Reply-To: <AANLkTikN0uAo9Xx0ytaLVhZUnF599ei6+fF0rj44oH9v@mail.gmail.com>
Message-ID: <C8EB112A.114A0%pdezwart@rubiconproject.com>

We are working on rewriting the PHP PECL extension for 0-9-1 support. We are
taking the opportunity to rework the API a little to be more user friendly.
 
As of right now, I would recommend writing an OO wrapper for all of your
AMQP interactions and use Alvaro's suggestion, and when the PHP PECL
extension is ready, you will be able to easily switch over if you so desire.

Pieter


On 10/25/10 5:40 AM, "Charl van Niekerk" <charlvn at charlvn.com> wrote:

> Hi All,
> 
> I recently installed the rabbitmq-server package on Ubuntu 10.04 and
> am now trying to get one of the available PHP extensions installed and
> configured. I seem to be hitting compilation errors though.
> 
> Firstly, I tried to install the amqp-0.1.1 package directly from PECL:
> 
> http://pecl.php.net/package/amqp
> http://pastebin.com/S8EDmPF1
> 
> Then I tried php-amqp 0.0.7:
> 
> http://code.google.com/p/php-amqp/
> http://pastebin.com/PDptCs64
> 
> And afterwards php-rabbit:
> 
> http://code.google.com/p/php-rabbit/
> http://pastebin.com/5hTCR1HG
> 
> I installed librabbitmq-c / librabbitmq-codegen prior to attempting
> php-amqp 0.0.7 or php-rabbit and it seems to have completed without
> any trouble.
> 
> Any help / advice would be much appreciated!
> 
> Thanks,
> Charl
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From Byron.Albert at dealer.com  Mon Oct 25 23:21:11 2010
From: Byron.Albert at dealer.com (Byron Albert)
Date: Mon, 25 Oct 2010 22:21:11 +0000
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
Message-ID: <E84B542096D9F5469A7CA1F600F59B9D0B886C@vtmbx2.dealerdotcom.corp>

Hello All,

 I am new to the list and had some questions about the HA guide. I don't really know pacemaker and was looking through the docs and was wondering how/if this configuration is checking if rabbit app is alive or just if the server is alive?  Is it doing any functional test? Or is the only real situation this recovers from is if the server fails?  Is its not doing any functional testing is there any way to add logic to do functional tests and try and restart if there is an issue then fail over?

And on a different but related note would NFS or OCFS2 work for the file system that rabbit is using? What would happen if multiple rabbits were accessing the files at the same time?

Thanks
Byron

_____________________________________
Byron Albert | Systems Operations
[cid:part1.01070402.03060807 at dealer.com]
V 877-327-8422 x496 F 802.658.0926
1 Howard St., Burlington, VT 05401
Byron.Albert at dealer.com<mailto:Byron.Albert at dealer.com> | www.dealer.com<http://www.dealer.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101025/90aef9c5/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1658 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101025/90aef9c5/attachment.gif>

From alexandru at rabbitmq.com  Tue Oct 26 00:51:12 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 26 Oct 2010 00:51:12 +0100
Subject: [rabbitmq-discuss] Release of HA + Pacemaker guide
In-Reply-To: <E84B542096D9F5469A7CA1F600F59B9D0B886C@vtmbx2.dealerdotcom.corp>
References: <E84B542096D9F5469A7CA1F600F59B9D0B886C@vtmbx2.dealerdotcom.corp>
Message-ID: <20101025235112.GF2386@dakota>

Hello Byron,

>  and had some questions about the HA guide. I don't really know pacemaker 

The RabbitMQ ocf script is packaging/common/rabbitmq-server.ocf:
  http://hg.rabbitmq.com/rabbitmq-server/file/default/packaging/common/rabbitmq-server.ocf

That file has all the RabbitMQ-specific Pacemaker/Corosync
configuration.

> how/if this configuration is checking if rabbit app is alive or just if the server is alive?  Is it doing any functional test?

The script uses rabbitmqctl to check the node's status.  So, any problem
detected by rabbitmqctl should be picked up by Pacemaker.

> And on a different but related note would NFS or OCFS2 work for the file system that rabbit is using? 

Yes.

> What would happen if multiple rabbits were accessing the files at the same time?

Bad things.  Probably a corrupted mnesia database.

Cheers,
Alex


On Mon, Oct 25, 2010 at 10:21:11PM +0000, Byron Albert wrote:
> Hello All,
> 
>  I am new to the list and had some questions about the HA guide. I don't really know pacemaker and was looking through the docs and was wondering how/if this configuration is checking if rabbit app is alive or just if the server is alive?  Is it doing any functional test? Or is the only real situation this recovers from is if the server fails?  Is its not doing any functional testing is there any way to add logic to do functional tests and try and restart if there is an issue then fail over?
> 
> And on a different but related note would NFS or OCFS2 work for the file system that rabbit is using? What would happen if multiple rabbits were accessing the files at the same time?
> 
> Thanks
> Byron
> 
> _____________________________________
> Byron Albert | Systems Operations
> [cid:part1.01070402.03060807 at dealer.com]
> V 877-327-8422 x496 F 802.658.0926
> 1 Howard St., Burlington, VT 05401
> Byron.Albert at dealer.com<mailto:Byron.Albert at dealer.com> | www.dealer.com<http://www.dealer.com>
> 



> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From cstoyles at gmail.com  Tue Oct 26 01:30:05 2010
From: cstoyles at gmail.com (ChrisStoyles)
Date: Mon, 25 Oct 2010 17:30:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Documentation for the Storage API
In-Reply-To: <30017978.post@talk.nabble.com>
References: <30017978.post@talk.nabble.com>
Message-ID: <30053126.post@talk.nabble.com>



ChrisStoyles wrote:
> 
> After reading "Growing Up" on the RabbitMQ blog
> (http://www.rabbitmq.com/blog/2010/08/27/growing-up/) I'd like to find out
> more about the "Storage API". In particular, if queues were stored in
> PostgreSQL would this provide persistent queues across multiple machines
> in a cluster (e.g. if a server goes down, all it's queue items will still
> be visible by the other members in the cluster).
> 
> ...If there's any documentation you can point me to that would be great...
> 

Hi Everyone,

Just wanted to quickly re-post a follow up here to see if there's anyone out
there that might be able to help me?

Chris.
-- 
View this message in context: http://old.nabble.com/Documentation-for-the-Storage-API-tp30017978p30053126.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rwirth at demandware.com  Tue Oct 26 00:12:58 2010
From: rwirth at demandware.com (rjwirth)
Date: Mon, 25 Oct 2010 16:12:58 -0700 (PDT)
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
Message-ID: <30052745.post@talk.nabble.com>



Hello Mark et al

I am new to Rabbit/AMQP (come from the JBoss messaging world) and I am
working on a simple Rabbit/Spring-AMQP piece.  Playing with QoS, retry etc,
I noticed that e.g. Basic.Reject isn't in Spring spring-amqp/rabbit version
1.0.0.M1, which pulls in the rabbit client 1.8.1, which is quite old. latest
rabbit version is 2.1.1.

There hasn't been an updated Spring-AMQP after 1.0.0.M1 -- do you happen to
know if there's an updated release for Rabbit 2.1.1?  Is Spring-AMQP dev for
Rabbit active?  POM Spring-AMQP 1.0.0.M1 and amqp-client 2.1.0 give me
NoSuchMethod errors...

Shall I move to Spring-AMQP trunk?

Many thanks in advance & apologies if there's an obvious post that I missed.
Best,
-Rudi


Mark Fisher-8 wrote:
> 
> Irmo,
> 
> And here's the official announcement that I published on springsource.org
> on Saturday: http://www.springsource.org/node/2715
> 
> Cheers,
> Mark
> 

-- 
View this message in context: http://old.nabble.com/spring-amqp-tp29209324p30052745.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Oct 26 12:45:02 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Oct 2010 12:45:02 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <152675.81635.qm@web31808.mail.mud.yahoo.com>
References: <95833.58711.qm@web31801.mail.mud.yahoo.com>
	<4C65FC4E.8070804@rabbitmq.com> <4C66AA9F.1000006@rabbitmq.com>
	<20100815101257.GA4835@wellquite.org>
	<20100816103018.GA16525@rabbitmq.com>
	<766990.31259.qm@web31804.mail.mud.yahoo.com>
	<597082.60604.qm@web31809.mail.mud.yahoo.com>
	<20100817171720.GL16525@rabbitmq.com>
	<140810.79403.qm@web31813.mail.mud.yahoo.com>
	<4C73F0BF.30605@rabbitmq.com>
	<400676.56539.qm@web31808.mail.mud.yahoo.com>
	<4C742C47.6080306@rabbitmq.com>
	<685259.73254.qm@web31807.mail.mud.yahoo.com>
	<4C748F7E.7020805@rabbitmq.com>
	<111467.41327.qm@web31811.mail.mud.yahoo.com>
	<4C74A480.3080600@rabbitmq.com>
	<152675.81635.qm@web31808.mail.mud.yahoo.com>
Message-ID: <4CC6BF3E.60105@rabbitmq.com>

Alex,

have you had a chance to run your tests against the latest (2.1.1) 
broker release? We fixed an excessive queue memory usage bug in that 
release, which might well have been the cause of the problems you were 
seeing.


Regards,

Matthias.

From markfisher at vmware.com  Tue Oct 26 13:00:23 2010
From: markfisher at vmware.com (Mark Fisher)
Date: Tue, 26 Oct 2010 05:00:23 -0700
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <30052745.post@talk.nabble.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>,
	<30052745.post@talk.nabble.com>
Message-ID: <392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>

Rudi, the Spring AMQP 1.0 M2 release will be built against version 2.1.1. That should be available within roughly a month. You are welcome to follow the trunk, but it might be changing more frequently than you would like. Another option is to grab a recent snapshot and stick with that until M2 is available.

Out of curiosity, what is the use-case where you expect to use Basic.Reject from within a Spring AMQP app?

Thanks,
Mark
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of rjwirth [rwirth at demandware.com]
Sent: Monday, October 25, 2010 7:12 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] spring-amqp

Hello Mark et al

I am new to Rabbit/AMQP (come from the JBoss messaging world) and I am
working on a simple Rabbit/Spring-AMQP piece.  Playing with QoS, retry etc,
I noticed that e.g. Basic.Reject isn't in Spring spring-amqp/rabbit version
1.0.0.M1, which pulls in the rabbit client 1.8.1, which is quite old. latest
rabbit version is 2.1.1.

There hasn't been an updated Spring-AMQP after 1.0.0.M1 -- do you happen to
know if there's an updated release for Rabbit 2.1.1?  Is Spring-AMQP dev for
Rabbit active?  POM Spring-AMQP 1.0.0.M1 and amqp-client 2.1.0 give me
NoSuchMethod errors...

Shall I move to Spring-AMQP trunk?

Many thanks in advance & apologies if there's an obvious post that I missed.
Best,
-Rudi


Mark Fisher-8 wrote:
>
> Irmo,
>
> And here's the official announcement that I published on springsource.org
> on Saturday: http://www.springsource.org/node/2715
>
> Cheers,
> Mark
>

--
View this message in context: http://old.nabble.com/spring-amqp-tp29209324p30052745.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rwirth at demandware.com  Tue Oct 26 13:19:26 2010
From: rwirth at demandware.com (rjwirth)
Date: Tue, 26 Oct 2010 05:19:26 -0700 (PDT)
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
	<30052745.post@talk.nabble.com>
	<392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>
Message-ID: <30056951.post@talk.nabble.com>



Mark Fisher-8 wrote:
> 
> Out of curiosity, what is the use-case where you expect to use
> Basic.Reject from within a Spring AMQP app?
> 

Hello Mark, thanks for getting back to me.
I am playing with QoS, Retry, transacted mode vs. ack/reject etc, and the
first thing I wanted to try is the onMessage() fail case to rollback and let
another consumer take the message.  If I use auto-ack and, the message seems
to remain on the broker. Again, I am new to AMQP, having worked with JBoss
and Sonic before. I stumbled over this post:
http://neopatel.blogspot.com/2010/08/rabbitmq-retrying-failed-messages.html


> The problem with rabbitMQ is that once a message is delivered to the
> consumer even if the consumer doesn't acknowledges it, RabbitMQ won't
> redeliver the unacked message to consumers until the channel is properly
> closed and reopened.  I tried checking rabbit transactions api to rollback
> the transaction in case of external component failure and also tried
> basic_recover but it has its own issues and none of them worked.
> 
-- 
View this message in context: http://old.nabble.com/spring-amqp-tp29209324p30056951.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexis at rabbitmq.com  Tue Oct 26 13:34:27 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 26 Oct 2010 13:34:27 +0100
Subject: [rabbitmq-discuss] Documentation for the Storage API
In-Reply-To: <30053126.post@talk.nabble.com>
References: <30017978.post@talk.nabble.com>
	<30053126.post@talk.nabble.com>
Message-ID: <AANLkTinGay+6u54mUEWoH91iGnMbsPeUDr33T1Ou5aTb@mail.gmail.com>

A response is now here:

http://www.rabbitmq.com/blog/2010/08/27/growing-up/



On Tue, Oct 26, 2010 at 1:30 AM, ChrisStoyles <cstoyles at gmail.com> wrote:
>
>
> ChrisStoyles wrote:
>>
>> After reading "Growing Up" on the RabbitMQ blog
>> (http://www.rabbitmq.com/blog/2010/08/27/growing-up/) I'd like to find out
>> more about the "Storage API". In particular, if queues were stored in
>> PostgreSQL would this provide persistent queues across multiple machines
>> in a cluster (e.g. if a server goes down, all it's queue items will still
>> be visible by the other members in the cluster).
>>
>> ...If there's any documentation you can point me to that would be great...
>>
>
> Hi Everyone,
>
> Just wanted to quickly re-post a follow up here to see if there's anyone out
> there that might be able to help me?
>
> Chris.
> --
> View this message in context: http://old.nabble.com/Documentation-for-the-Storage-API-tp30017978p30053126.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From harel at harelmalka.com  Tue Oct 26 13:22:54 2010
From: harel at harelmalka.com (Harel Malka)
Date: Tue, 26 Oct 2010 13:22:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure
In-Reply-To: <AANLkTindoe5TJCyU66Z72Rj9QKpO_Siw0chv3vURPc1P@mail.gmail.com>
References: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>
	<20101025151428.GC32334@wellquite.org>
	<AANLkTindoe5TJCyU66Z72Rj9QKpO_Siw0chv3vURPc1P@mail.gmail.com>
Message-ID: <AANLkTin_Vx4yXYNWEFaNRkmraEZt3GYdGK5e0+HOi-qR@mail.gmail.com>

Hi Matthew.
Here's the rabbit details:

Status of node 'rabbit at IS-10651' ...
[{running_applications,[{rabbit,"RabbitMQ","2.1.0"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,[{disc,['rabbit at IS-10651']}]},
 {running_nodes,['rabbit at IS-10651']}]
...done.

Erlang:
Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:4]
[async-threads:0] [kernel-poll:false]
Eshell V5.6.3  (abort with ^G)

All Logs will be provided directly. They are rather large, though the
one in question (that matters) can be emailed. Should I do that or
send a link to download the lot?
Harel


On Mon, Oct 25, 2010 at 4:36 PM, Julian Charles Ball
<julian at boxsolutions.com> wrote:
> Thanks Matthew, my colleague Harel is better placed to answer the version
> questions... Harel, could you respond please and perhaps send a copy of the
> log?
>
> On 25 October 2010 16:14, Matthew Sackman <matthew at rabbitmq.com> wrote:
>>
>> On Mon, Oct 25, 2010 at 04:06:51PM +0100, Julian Charles Ball wrote:
>> > and it goes on forever along the same lines....
>>
>> No it doesn't. It will stop, and much meaningful information is in the
>> logs right at the bottom. Any chance you can send us the complete logs?
>> (Maybe to info at rabbitmq.com rather than spamming the list, if the logs
>> are big?).
>>
>> Also, which version of Rabbit are you running, and which version of
>> Erlang are you using?
>>
>>
>> Best wishes,
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> - - - - - - -
> Julian Charles Ball
> :: BOX ::
>
> Call me on +44 (0)7737 123341
> Email me on?julian at boxsolutions.com
> Visit us at?www.boxsolutions.com
>
> Find out more information about BOX's ONE Media Manager at
> www.onemediamanager.com
>
>

From matthew at rabbitmq.com  Tue Oct 26 13:42:27 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 26 Oct 2010 13:42:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure
In-Reply-To: <AANLkTin_Vx4yXYNWEFaNRkmraEZt3GYdGK5e0+HOi-qR@mail.gmail.com>
References: <AANLkTinAOdJN9=o=pADF6WM-DgoaEGQqkKs1seEiEoTW@mail.gmail.com>
	<20101025151428.GC32334@wellquite.org>
	<AANLkTindoe5TJCyU66Z72Rj9QKpO_Siw0chv3vURPc1P@mail.gmail.com>
	<AANLkTin_Vx4yXYNWEFaNRkmraEZt3GYdGK5e0+HOi-qR@mail.gmail.com>
Message-ID: <20101026124227.GD18475@rabbitmq.com>

Hi Harel,

On Tue, Oct 26, 2010 at 01:22:54PM +0100, Harel Malka wrote:
> [{running_applications,[{rabbit,"RabbitMQ","2.1.0"},

Cool, that's pretty recent - 2.1.1 is out now, but I don't think you're
having issues with anything that 2.1.1 fixed.

> Erlang:
> Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:4]

Ahh, Erlang R12B3. That is rather ancient. Is this a Debian Lenny box,
per chance? Again, that said, the issue you're seeing may not be related
to that.

> All Logs will be provided directly. They are rather large, though the
> one in question (that matters) can be emailed. Should I do that or
> send a link to download the lot?

Emailing them all is file. They should get through to us. They're also
likely to be easily compressible.

Many thanks,

Matthew

From mikeb at rabbitmq.com  Tue Oct 26 14:06:02 2010
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 26 Oct 2010 14:06:02 +0100
Subject: [rabbitmq-discuss] Documentation for the Storage API
In-Reply-To: <AANLkTinGay+6u54mUEWoH91iGnMbsPeUDr33T1Ou5aTb@mail.gmail.com>
References: <30017978.post@talk.nabble.com>	<30053126.post@talk.nabble.com>
	<AANLkTinGay+6u54mUEWoH91iGnMbsPeUDr33T1Ou5aTb@mail.gmail.com>
Message-ID: <4CC6D23A.5020705@rabbitmq.com>

On 10/26/2010 01:34 PM, Alexis Richardson wrote:
> A response is now here:
>
> http://www.rabbitmq.com/blog/2010/08/27/growing-up/

FTR: the interface is the behaviour
http://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_backing_queue.erl

Michael

>> ChrisStoyles wrote:
>>>
>>> After reading "Growing Up" on the RabbitMQ blog
>>> (http://www.rabbitmq.com/blog/2010/08/27/growing-up/) I'd like to find out
>>> more about the "Storage API". In particular, if queues were stored in
>>> PostgreSQL would this provide persistent queues across multiple machines
>>> in a cluster (e.g. if a server goes down, all it's queue items will still
>>> be visible by the other members in the cluster).
>>>
>>> ...If there's any documentation you can point me to that would be great...
>>>
>>
>> Hi Everyone,
>>
>> Just wanted to quickly re-post a follow up here to see if there's anyone out
>> there that might be able to help me?
>>
>> Chris.
>> --
>> View this message in context: http://old.nabble.com/Documentation-for-the-Storage-API-tp30017978p30053126.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david_syer at hotmail.com  Tue Oct 26 14:57:22 2010
From: david_syer at hotmail.com (Dave Syer)
Date: Tue, 26 Oct 2010 06:57:22 -0700 (PDT)
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <30056951.post@talk.nabble.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
	<30052745.post@talk.nabble.com>
	<392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>
	<30056951.post@talk.nabble.com>
Message-ID: <30057825.post@talk.nabble.com>




rjwirth wrote:
> 
> I am playing with QoS, Retry, transacted mode vs. ack/reject etc, and the
> first thing I wanted to try is the onMessage() fail case to rollback and
> let another consumer take the message.  If I use auto-ack and, the message
> seems to remain on the broker. 
> 

We haven't implemented rollback in the asynch case yet in Spring AMQP (sync
works but it's less useful) - it's on the list of things to do for M2.  The
intention really is that for basic use cases like this you shouldn't care
which version of the low-level Rabbit client you are using.  You shouldn't
need to know how or when to call basicRecover() because the listener
container will do it for you.
-- 
View this message in context: http://old.nabble.com/spring-amqp-tp29209324p30057825.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Oct 26 15:35:12 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Oct 2010 15:35:12 +0100
Subject: [rabbitmq-discuss] Fwd: Batch Acknowledge
In-Reply-To: <AANLkTi=vQWBbjY-cGAsaB5wCzrZYNEKB=HBmKV3=uctx@mail.gmail.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>	<4CBEC12F.8000303@rabbitmq.com>	<AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>	<AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>	<4CBF0428.8020403@rabbitmq.com>
	<AANLkTi=vQWBbjY-cGAsaB5wCzrZYNEKB=HBmKV3=uctx@mail.gmail.com>
Message-ID: <4CC6E720.1060602@rabbitmq.com>

Davide,

Davide Maestroni wrote:
> My problem here is that, in the architecture I have to implement, I 
> could receive a lot of messages in a very short time, so if the broker 
> re-enqueues not acknowledged ones they can end up to be re-sent 
> thousands of messages later. Which means that there's no way I can do 
> the re-ordering on the consumer side.

Could you recover ordering by the producer sticking a sequence number 
into the message? That should work as long as all the produced messages 
end up in the same queue.

Also note that rabbit sets the 'redelivered' flag on deliveries that 
have been sent to a consumer for the second and subsequent times. This 
too helps in recovering order.


Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct 26 15:42:04 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Oct 2010 15:42:04 +0100
Subject: [rabbitmq-discuss] AMQP Connection gets forcibly closed : .Net
 client
In-Reply-To: <30011591.post@talk.nabble.com>
References: <173a1edc1001251027i75137559xb52cb561b26c3c58@mail.gmail.com>	<4B5DEE87.1090700@lshift.net>	<173a1edc1001260732t6bb6c741wec500876451c0ca6@mail.gmail.com>	<4B5F0C63.3060806@lshift.net>	<173a1edc1001260946o2a0281c5vc72c094f7585cdbf@mail.gmail.com>	<4B5F3059.8060006@lshift.net>	<03FC0D29D4E88943AB7420C524BE8489027C3D81@mllnc20mb056.emea.win.ml.com>	<4B707F75.8000909@lshift.net>
	<30011591.post@talk.nabble.com>
Message-ID: <4CC6E8BC.6070501@rabbitmq.com>

Eric,

Eric at SPIN wrote:
> The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
> code=320, text="CONNECTION_FORCED - broker forced connection closure with
> reason 'shutdown'", classId=0, methodId=0, cause=
> 
> I've checked your reply. I've been assured that nobody shut-down the broker.
> This has happened twice today. In both cases re-starting our application we
> were able to progress. Could there be any other reason? By the way we are
> now on version 2.1.1.0

A controlled broker shutdown, or use of 'rabbitmqctl close_connection' 
are the most likely causes. If the broker stayed alive then it can only 
be the latter.

Can you post the rabbit.log and rabbit-sasl.log from the time when you 
saw the above error?


Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct 26 16:02:42 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Oct 2010 16:02:42 +0100
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.1.1
In-Reply-To: <AANLkTi=azfQkwhBMjNA6vQJvev=QCbqrc+uiW75jYU+f@mail.gmail.com>
References: <AANLkTi=LDJKrCynu6Atbc028Rs3jCTq+ZbLLBLhfButP@mail.gmail.com>	<AANLkTin7Q5ii7Zy+MmaKLmDYUxro7JVJX7eaTrecWsQA@mail.gmail.com>	<AANLkTinXMiv6eLooW0EBb36dLSX1jjsLzJNthSR=y1HC@mail.gmail.com>
	<AANLkTi=azfQkwhBMjNA6vQJvev=QCbqrc+uiW75jYU+f@mail.gmail.com>
Message-ID: <4CC6ED92.2080801@rabbitmq.com>

Rauan,

Rauan Maemirov wrote:
> # rabbitmqctl status
> Status of node rabbit at smotrelka ...
> Error: unable to connect to node rabbit at smotrelka: nodedown
> diagnostics:
> - nodes and their ports on smotrelka: [{rabbit,33213},
>                                        {rabbitmqctl13935,47497}]

That shows that there is a rabbit running. Unless it died w/o epmd 
noticing, which is not something I've see before.

To find out the process, use 'lsof' and look for the port number of the 
rabbit node (33213 in this case), e.g.

   lsof -n -iTCP | grep 33213

NB: you may have to be root to do this, otherwise not all processes may 
show up.


Regards,

Matthias.

From davide.maestroni at gmail.com  Tue Oct 26 16:14:13 2010
From: davide.maestroni at gmail.com (Davide Maestroni)
Date: Tue, 26 Oct 2010 17:14:13 +0200
Subject: [rabbitmq-discuss] Fwd: Batch Acknowledge
In-Reply-To: <4CC6E720.1060602@rabbitmq.com>
References: <AANLkTinAtxUzD8yC-xQ4knjZEQXyzL_bcuUfCKGw8tFO@mail.gmail.com>
	<4CBEC12F.8000303@rabbitmq.com>
	<AANLkTikiO8drH23VQsDAzW9UTFaa7FTB_4Q5T9m8Gt_t@mail.gmail.com>
	<AANLkTinqyX=cpUijEAA7kwa541ijaYLSbKyQMgvGMtB-@mail.gmail.com>
	<4CBF0428.8020403@rabbitmq.com>
	<AANLkTi=vQWBbjY-cGAsaB5wCzrZYNEKB=HBmKV3=uctx@mail.gmail.com>
	<4CC6E720.1060602@rabbitmq.com>
Message-ID: <AANLkTi=HXtK5jpNhiEYsmYayeKe7Smr-w3-A4xBPZy4X@mail.gmail.com>

Hi Matthias,

yes, I finally decided to handle the reordering in the consumer. Anyway,
thank you for the 'redelivered' flag hint, it could be very helpful.

Best,

Davide


On Tue, Oct 26, 2010 at 4:35 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Davide,
>
>
> Davide Maestroni wrote:
>
>> My problem here is that, in the architecture I have to implement, I could
>> receive a lot of messages in a very short time, so if the broker re-enqueues
>> not acknowledged ones they can end up to be re-sent thousands of messages
>> later. Which means that there's no way I can do the re-ordering on the
>> consumer side.
>>
>
> Could you recover ordering by the producer sticking a sequence number into
> the message? That should work as long as all the produced messages end up in
> the same queue.
>
> Also note that rabbit sets the 'redelivered' flag on deliveries that have
> been sent to a consumer for the second and subsequent times. This too helps
> in recovering order.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101026/425e0191/attachment.htm>

From thomasbam at gmail.com  Tue Oct 26 16:41:29 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Tue, 26 Oct 2010 17:41:29 +0200
Subject: [rabbitmq-discuss] [Malformed Packet] in wireshark after a
	Channel.open frame
Message-ID: <AANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo@mail.gmail.com>

Hello rabbitmq list,


We try hard to understand what's happening with our integration tests :

When we don't send http request to our application after, say 10 to 15
min, when the first request is occuring, (sending stats messages to
rabbit), the shutdownListener is called with the cause
"java.net.SocketException: Connection reset".

The shutdownListener is launching a thread that is trying to reconnect
with rabbit (when its cause is not initiated by the application), and
during that time, the messages are put in a queue. When the connection
is reestablished, the messages in the queue are sent. We did this
reconnection thread because we needed to restart the webapps (messages
producers) when the rabbitmq broker was shutdown.

We did tcpdump traces, and when we analysed the frames, we saw that :
- there were not TCP connection resets
- whenever there was Channel.open frame, the next one is tagged as a
malformed packet by wireshark (the Open-Ok)

Is it normal to have these malformed packets ?

Then the connection is reestablished and the messages are sent and
received by consumers.

The problem is that the 2 first basicPublish (before the
shutdownListener is called) are sent without IOException so the
messages are lost. The consumers receive null messages.
Did you see this kind of situation ?

Thank you for your answers.

Bruno Thomas

From sustrik at 250bpm.com  Tue Oct 26 16:48:47 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Tue, 26 Oct 2010 17:48:47 +0200
Subject: [rabbitmq-discuss] [Malformed Packet] in wireshark after
 a	Channel.open frame
In-Reply-To: <AANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo@mail.gmail.com>
References: <AANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo@mail.gmail.com>
Message-ID: <4CC6F85F.1050406@250bpm.com>

Hi Bruno,

When I wrote the wireshark dissector for AMQP there wan no AMQP/0-9-1 by 
then, so it dissects AMQP/0-9. Maybe something have changed between two 
version of AMQP that makes it believed the frame is malformed?

Martin

On 10/26/2010 05:41 PM, Bruno Thomas wrote:
> Hello rabbitmq list,
>
>
> We try hard to understand what's happening with our integration tests :
>
> When we don't send http request to our application after, say 10 to 15
> min, when the first request is occuring, (sending stats messages to
> rabbit), the shutdownListener is called with the cause
> "java.net.SocketException: Connection reset".
>
> The shutdownListener is launching a thread that is trying to reconnect
> with rabbit (when its cause is not initiated by the application), and
> during that time, the messages are put in a queue. When the connection
> is reestablished, the messages in the queue are sent. We did this
> reconnection thread because we needed to restart the webapps (messages
> producers) when the rabbitmq broker was shutdown.
>
> We did tcpdump traces, and when we analysed the frames, we saw that :
> - there were not TCP connection resets
> - whenever there was Channel.open frame, the next one is tagged as a
> malformed packet by wireshark (the Open-Ok)
>
> Is it normal to have these malformed packets ?
>
> Then the connection is reestablished and the messages are sent and
> received by consumers.
>
> The problem is that the 2 first basicPublish (before the
> shutdownListener is called) are sent without IOException so the
> messages are lost. The consumers receive null messages.
> Did you see this kind of situation ?
>
> Thank you for your answers.
>
> Bruno Thomas
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sustrik at 250bpm.com  Tue Oct 26 16:51:47 2010
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Tue, 26 Oct 2010 17:51:47 +0200
Subject: [rabbitmq-discuss] [Malformed Packet] in wireshark after
 a	Channel.open frame
In-Reply-To: <4CC6F85F.1050406@250bpm.com>
References: <AANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo@mail.gmail.com>
	<4CC6F85F.1050406@250bpm.com>
Message-ID: <4CC6F913.20401@250bpm.com>

On 10/26/2010 05:48 PM, Martin Sustrik wrote:
> Hi Bruno,
>
> When I wrote the wireshark dissector for AMQP there wan no AMQP/0-9-1 by
> then, so it dissects AMQP/0-9. Maybe something have changed between two
> version of AMQP that makes it believed the frame is malformed?
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Oh my, I should type much slower than I do:

wan->was
version->versions
believed->believe

:(

Martin

From rwirth at demandware.com  Tue Oct 26 17:40:27 2010
From: rwirth at demandware.com (rjwirth)
Date: Tue, 26 Oct 2010 09:40:27 -0700 (PDT)
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <30057825.post@talk.nabble.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
	<30052745.post@talk.nabble.com>
	<392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>
	<30056951.post@talk.nabble.com> <30057825.post@talk.nabble.com>
Message-ID: <30059425.post@talk.nabble.com>



Dave Syer wrote:
> 
> We haven't implemented rollback in the asynch case yet in Spring AMQP
> (sync works but it's less useful) - it's on the list of things to do for
> M2.  The intention really is that for basic use cases like this you
> shouldn't care which version of the low-level Rabbit client you are using. 
> You shouldn't need to know how or when to call basicRecover() because the
> listener container will do it for you.
> 

Thanks! I am merely trying to be able to cause a onMessage() retry after a
failure, which I wasn't able to achieve with M1 (and amqp-rabbit 1.8.1) so I
have to decide if I should look into using the rabbit java API instead of
AMQP, or wait for AMQP M2.
That said, what is the intended model for retry?  I don't see a "delayed
retry" being part of AMQP. Some blogs suggest to have the application do its
own retry, always consuming the message and never throwing -- other MQ's
have the notion of a retryDelay/Limit, a convenience I got used to.
I now see a thread on exactly that topic:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/665520c0fcd26fa0/18d831c03a5ea4e4

-----
Rudi Wirth

-- 
View this message in context: http://old.nabble.com/spring-amqp-tp29209324p30059425.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From a.medhat.cs at gmail.com  Tue Oct 26 18:17:18 2010
From: a.medhat.cs at gmail.com (Ahmed M. Osman)
Date: Tue, 26 Oct 2010 19:17:18 +0200
Subject: [rabbitmq-discuss] RabbitMQ Backup
Message-ID: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>

Hello Friends,

i just have a little question about RabbitMQ backup and i hope that i can
found the answer here

simply, i want to make backup and and restore system to my Rabbit server,
mainly backup the persistent messages, do i have to handle this using extra
consumer that consume the messages then save it and enqueue it again in the
queue ?

or backuping Mnesia, but according to the following link
http://www.rabbitmq.com/faq.html#migrate-to-another-machine
i think backupping Mnesia won't be a good solution.

and if backuping Mnesia is the solution are there a way to use any other
language to make this backup other than using Erlang or any command or
command line tool.

*--
Kind Regards,

Ahmed
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101026/b8eb3bf0/attachment.htm>

From shane at digitalsanctum.com  Tue Oct 26 21:54:39 2010
From: shane at digitalsanctum.com (Shane)
Date: Tue, 26 Oct 2010 13:54:39 -0700 (PDT)
Subject: [rabbitmq-discuss] integration testing with Rabbit and Java
Message-ID: <2e74ec1d-e5af-438f-820b-5cc5ddc544ed@j18g2000yqd.googlegroups.com>

Anyone have any pointers on how best to do integration testing with
RabbitMQ, java client, and Spring AMQP?

I'd also like to know how to easily setup/start/stop more than one
broker per machine programmatically to test things like failover. Is
there such a thing as a mock broker?

From david.syer at googlemail.com  Wed Oct 27 01:43:25 2010
From: david.syer at googlemail.com (Dave Syer)
Date: Tue, 26 Oct 2010 17:43:25 -0700 (PDT)
Subject: [rabbitmq-discuss] spring-amqp
In-Reply-To: <30059425.post@talk.nabble.com>
References: <D0F042F2-6666-4FE3-97B6-43934EC78985@npcinternational.com>
	<AANLkTik7LmNbRgf3KO3AtcKKHKl4l1Nc1kXfujbik1sZ@mail.gmail.com>
	<7ED8AEAC-2A10-498F-BB3D-AB53EFB77442@vmware.com>
	<392922E81643B245A905B42E3E34C24014D3516A6E@EXCH-MBX-1.vmware.com>
	<30052745.post@talk.nabble.com>
	<392922E81643B245A905B42E3E34C24014D3516FA4@EXCH-MBX-1.vmware.com>
	<30056951.post@talk.nabble.com> <30057825.post@talk.nabble.com>
	<30059425.post@talk.nabble.com>
Message-ID: <288738a0-1d7d-4184-aa21-74755b78b484@l17g2000yqe.googlegroups.com>

> That said, what is the intended model for retry? ?I don't see a "delayed
> retry" being part of AMQP.

Neither do I.  AMQP gives you redelivery of unacked messages.  That's
as far as we expect it to take us for now.  Rabbit happens to re-queue
unacked messages at the *back* of the queue, which gives you some
useful delay in practice under load, but not if volume is low.

We have a retry abstraction in Spring Batch, and it has moved to
Spring Commons so that Spring Data can use it for JDBC connection
retry in an Oracle cluster.  The Batch piece is used heavily by at
least one large client I know of purely to handle delayed retry (with
JMS in that case, but the idea is the same).  From Rabbit's point of
view I'dsay this is an "application" concern, but there are higher
level frameworks like the Spring family that can help to take the pain
out of implementing such concerns.  Spring AMQP could use Spring
Commons to implement a stateful retry (e.g. with a delay).  Out of the
box it is likely to use simple Java Thread APIs (e.g. sleeping) which
is best for short delays.  For longer delays of the sort that Jon was
talking about in that other thread you mentioned, we would need to
think about scheduling, triggers and persistence (all of which are
ingredients in existing Spring frameworks, so no reason why it
wouldn't be do-able - but maybe not the first thing we do).

Anyway, to summarize, if you want the AMQP behaviour (unacked message
= "rolled back" in Spring transaction terms, and re-delivered) you
will get that with no effort from Spring AMQP 1.0.0.M2.  More
complicated retry patterns will come later, and/or require some custom
components (e.g. implementation of retry policy or retry operations).

From bsellner at seegrid.com  Wed Oct 27 03:11:39 2010
From: bsellner at seegrid.com (Brennan Sellner)
Date: Tue, 26 Oct 2010 22:11:39 -0400
Subject: [rabbitmq-discuss] txAMQP and RPC
Message-ID: <1288145499.5134.13.camel@gear>

Hi folks,

Does anyone have example code floating around for implementing RPC using
txAMQP and Rabbit?  I'm familiar with the concepts, and am able to
declare, bind, and consume the private queue.  However, I've been
unsuccessful in my attempts to set the reply-to field when publishing:
basic_publish complains about an unexpected keyword argument when
provided with 'replyTo', 'reply to', 'reply-to', or 'reply_to' keywords
(with a value of a simple string).

We're using Rabbit 1.8.1, txAMQP 0.3.1, and the
amqp0-8.stripped.rabbitmq.xml spec file that comes with txAMQP.  I'm
guessing the issue is that the 'publish' method of the 'basic' class in
the spec doesn't have a reply-to field declared (although neither the
0.9 nor the 0.9.1 specs have such a field).  I tried adding one for
kicks, but then Rabbit complains that it can't decode basic.publish and
nukes the client connection.  I see Java implementations of RPC that
allude to a reply-to field, so I'm betting the issue isn't a lack of
support on Rabbit's end.

While we could add a reply-to field to all of our messages, that's
rather inelegant.  I'm pretty sure I'm missing something here: anyone
know what? :-)

Thanks,

-Brennan



From videlalvaro at gmail.com  Wed Oct 27 03:17:09 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 27 Oct 2010 10:17:09 +0800
Subject: [rabbitmq-discuss] txAMQP and RPC
In-Reply-To: <1288145499.5134.13.camel@gear>
References: <1288145499.5134.13.camel@gear>
Message-ID: <443E9302-9FCF-4580-8FC3-CD6CFD0266AB@gmail.com>

Hi,

First I don't know much about txAMQP, so I don't know where you will have to check, but reply_to is a property of the message, is not part of the basic_publish method.

Regards,

Alvaro

On Oct 27, 2010, at 10:11 AM, Brennan Sellner wrote:

> Hi folks,
> 
> Does anyone have example code floating around for implementing RPC using
> txAMQP and Rabbit?  I'm familiar with the concepts, and am able to
> declare, bind, and consume the private queue.  However, I've been
> unsuccessful in my attempts to set the reply-to field when publishing:
> basic_publish complains about an unexpected keyword argument when
> provided with 'replyTo', 'reply to', 'reply-to', or 'reply_to' keywords
> (with a value of a simple string).
> 
> We're using Rabbit 1.8.1, txAMQP 0.3.1, and the
> amqp0-8.stripped.rabbitmq.xml spec file that comes with txAMQP.  I'm
> guessing the issue is that the 'publish' method of the 'basic' class in
> the spec doesn't have a reply-to field declared (although neither the
> 0.9 nor the 0.9.1 specs have such a field).  I tried adding one for
> kicks, but then Rabbit complains that it can't decode basic.publish and
> nukes the client connection.  I see Java implementations of RPC that
> allude to a reply-to field, so I'm betting the issue isn't a lack of
> support on Rabbit's end.
> 
> While we could add a reply-to field to all of our messages, that's
> rather inelegant.  I'm pretty sure I'm missing something here: anyone
> know what? :-)
> 
> Thanks,
> 
> -Brennan
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bsellner at seegrid.com  Wed Oct 27 04:19:10 2010
From: bsellner at seegrid.com (Brennan Sellner)
Date: Tue, 26 Oct 2010 23:19:10 -0400
Subject: [rabbitmq-discuss] txAMQP and RPC
In-Reply-To: <443E9302-9FCF-4580-8FC3-CD6CFD0266AB@gmail.com>
References: <1288145499.5134.13.camel@gear>
	<443E9302-9FCF-4580-8FC3-CD6CFD0266AB@gmail.com>
Message-ID: <1288149550.5134.18.camel@gear>

<facepalm>  That would be it.  No idea why I was convinced that it was
part of publish.  Thanks!

For anyone else who might be curious, just set the "reply to" key of the
Content object before publishing it, thusly:

from txamqp.content import Content

def send ( msg, exchangeName, replyTo, routingKey ):
   txMsg = Content ( msg.SerializeToString() )
   txMsg["reply to"] = replyTo
   d = self.chan.basic_publish ( exchange = exchangeName,
                                 content = txMsg,
                                 routing_key = routingKey )

Thanks for the rapid response!

-Brennan

On Wed, 2010-10-27 at 10:17 +0800, Alvaro Videla wrote: 
> Hi,
> 
> First I don't know much about txAMQP, so I don't know where you will have to check, but reply_to is a property of the message, is not part of the basic_publish method.
> 
> Regards,
> 
> Alvaro
> 
> On Oct 27, 2010, at 10:11 AM, Brennan Sellner wrote:
> 
> > Hi folks,
> > 
> > Does anyone have example code floating around for implementing RPC using
> > txAMQP and Rabbit?  I'm familiar with the concepts, and am able to
> > declare, bind, and consume the private queue.  However, I've been
> > unsuccessful in my attempts to set the reply-to field when publishing:
> > basic_publish complains about an unexpected keyword argument when
> > provided with 'replyTo', 'reply to', 'reply-to', or 'reply_to' keywords
> > (with a value of a simple string).
> > 
> > We're using Rabbit 1.8.1, txAMQP 0.3.1, and the
> > amqp0-8.stripped.rabbitmq.xml spec file that comes with txAMQP.  I'm
> > guessing the issue is that the 'publish' method of the 'basic' class in
> > the spec doesn't have a reply-to field declared (although neither the
> > 0.9 nor the 0.9.1 specs have such a field).  I tried adding one for
> > kicks, but then Rabbit complains that it can't decode basic.publish and
> > nukes the client connection.  I see Java implementations of RPC that
> > allude to a reply-to field, so I'm betting the issue isn't a lack of
> > support on Rabbit's end.
> > 
> > While we could add a reply-to field to all of our messages, that's
> > rather inelegant.  I'm pretty sure I'm missing something here: anyone
> > know what? :-)
> > 
> > Thanks,
> > 
> > -Brennan
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From chen650 at yahoo.com  Wed Oct 27 07:28:25 2010
From: chen650 at yahoo.com (alex chen)
Date: Tue, 26 Oct 2010 23:28:25 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <454284.75080.qm@web31807.mail.mud.yahoo.com>

Matthias,


> have you had a chance to run your tests against the latest (2.1.1) broker release? We fixed an excessive queue memory usage bug > in that release, which might well have been the cause of the problems you were seeing.

Thanks for reminding me!
I tested 2.1.1 release today with 1000 queues.  When the message store reached 120 GB, the broker's memory reached 4GB and started to slow down the publishers.  Publish rate dropped from 80 MB/sec to less than 1 MB/sec.  The memory stayed around 4GB for long time.  If I stopped the publishers, the memory would drop to 2.8 GB.  However, as soon as i started the publishers again, memory would reach 4GB again and the publish rate dropped significantly.

I tried to change the memory threshold from 0.4 to 0.7, and restarted the broker.  Howerver, the log showed that the broker's memory limit is 3.2 GB (our machine has 8 GB   RAM).  It seems to me release 2.1.1 would not allow the broker to use more than 0.4 of the total RAM.  I remember with 2.0.0, I could set the memory threshold to 0.7 and the broker's memory would reach 10 GB with 120 GB message stored.  the publish rate was higher than 2.1.1 under this condition.

BTW, we are using erlang R14A, because it uses 200% of the CPU (8 core) comparing to 680% for R13B with our test cases.
the 2.1.1 release has build error from rabbitmq_ssl.erl.  I commented out "-include(ssl/src/ssl_int.hrl)" to make it work.
i will test R14B tomorrow.

thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101026/64255b78/attachment-0001.htm>

From alex.lovelltroy at gmail.com  Wed Oct 27 09:43:04 2010
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Wed, 27 Oct 2010 09:43:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
Message-ID: <AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>

We've been tackling this problem as well for transactional persistent
messages on durable queues in a very low traffic situation.  Our solution
was to write a small wrapper around the transaction that also commits the
message content to a database and then transactionally deletes the message
from the database as part of the ack.  The wrapper also stores information
about the queues and routing on startup.  With that, an additional small
script can recreate our queues in the case of host death.  It's certainly
not fast, but it is durable and keeps us from using the anti-pattern of
polling the database for status changes.

Since our queues and routing don't change very often, we think that a
slow/triggered update of that information is good enough which only leaves
the messages themselves.   We've been thinking of using erlang directly to
bind to the ETS table on the rabbitmq host and dump the messages to a fresh
ETS table on another node for a less db-centric backup/HA option.  We're
still not sure if that's a good idea or if it is workable, but it may point
you in another direction.

I'd be happy to hear if anyone else has already ascertained if this route is
fraught with danger.

-sascha



On Tue, Oct 26, 2010 at 6:17 PM, Ahmed M. Osman <a.medhat.cs at gmail.com>wrote:

> Hello Friends,
>
> i just have a little question about RabbitMQ backup and i hope that i can
> found the answer here
>
> simply, i want to make backup and and restore system to my Rabbit server,
> mainly backup the persistent messages, do i have to handle this using
> extra consumer that consume the messages then save it and enqueue it again
> in the queue ?
>
> or backuping Mnesia, but according to the following link
> http://www.rabbitmq.com/faq.html#migrate-to-another-machine
> i think backupping Mnesia won't be a good solution.
>
> and if backuping Mnesia is the solution are there a way to use any other
> language to make this backup other than using Erlang or any command or
> command line tool.
>
> *--
> Kind Regards,
>
> Ahmed
> *
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/1fd936a8/attachment.htm>

From thomasbam at gmail.com  Wed Oct 27 11:18:05 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Wed, 27 Oct 2010 12:18:05 +0200
Subject: [rabbitmq-discuss] [Malformed Packet] in wireshark after a
 Channel.open frame
In-Reply-To: <4CC6F913.20401@250bpm.com>
References: <AANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo@mail.gmail.com>
	<4CC6F85F.1050406@250bpm.com> <4CC6F913.20401@250bpm.com>
Message-ID: <AANLkTiny0GZk8PA6-Tiz8bvYjp=H2M_Ct3boZ-q=LFjZ@mail.gmail.com>

2010/10/26 Martin Sustrik <sustrik at 250bpm.com>:
> On 10/26/2010 05:48 PM, Martin Sustrik wrote:
>> When I wrote the wireshark dissector for AMQP there wan no AMQP/0-9-1 by
>> then, so it dissects AMQP/0-9. Maybe something have changed between two
>> version of AMQP that makes it believed the frame is malformed?

Ok, thank you. We use rabbit 1.8.0 with AMQP 0-9-1 specification. The
frame "Open-Ok" of Channel.open message has probably changed (I havent
checked the details). But the channels are functionnal.

We have seen thanks to wireshark, that the ipvadm machine that
loadbalances the 2 rabbit nodes was sending to the application server
machines TCP RST if the connections are not used for a 10 mn period
(we must see that with our op team).
In that case, the java socket that publish the message cannot know
that the connection will be reset by the VIP server. I guess also that
it must occur between connection heartbeats.

> Oh my, I should type much slower than I do:

We had understood :)

Thanks again for your answer.

Bruno Thomas

From matthias at rabbitmq.com  Wed Oct 27 11:21:55 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 27 Oct 2010 11:21:55 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <454284.75080.qm@web31807.mail.mud.yahoo.com>
References: <454284.75080.qm@web31807.mail.mud.yahoo.com>
Message-ID: <4CC7FD43.9050903@rabbitmq.com>

Alex,

alex chen wrote:
> I tested 2.1.1 release today with 1000 queues.  When the message store 
> reached 120 GB, the broker's memory reached 4GB and started to slow down 
> the publishers.  Publish rate dropped from 80 MB/sec to less than 1 
> MB/sec.  The memory stayed around 4GB for long time.

That is expected. When clients are publishing at a higher rate than the 
broker can write to disk, and consumers aren't draining the queues, then 
eventually rabbit will have to pause producers so it can page messages 
to disk and free up some memory.

> I tried to change the memory threshold from 0.4 to 0.7, and restarted 
> the broker.  Howerver, the log showed that the broker's memory limit is 
> 3.2 GB (our machine has 8 GB   RAM).  It seems to me release 2.1.1 would 
> not allow the broker to use more than 0.4 of the total RAM.

That threshold setting via vm_memory_high_watermark definitely still 
works in 2.1.1.

> the 2.1.1 release has build error from rabbitmq_ssl.erl.  I commented 
> out "-include(ssl/src/ssl_int.hrl)" to make it work.

Ah, that's a dependency on the Erlang/OTP sources. I thought we had 
eradicated all those. Clearly not. Have filed a bug.


Regards,

Matthias.

From simon at rabbitmq.com  Wed Oct 27 11:56:31 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Oct 2010 11:56:31 +0100
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <30028590.post@talk.nabble.com>
References: <30020890.post@talk.nabble.com>
	<4CC067BE.5040205@rabbitmq.com>	<30021317.post@talk.nabble.com>
	<30028590.post@talk.nabble.com>
Message-ID: <4CC8055F.6090401@rabbitmq.com>

On 22/10/10 14:16, Alext0 wrote:
>
> Unfortunately the R14B from http://repos.fedorapeople.org/ doesn't seem to be
> there yet.

Damn, you're quite right. I thought because it was listed it would exist...

> I've tried a couple of other things:
>
> 1) Built from src, but startup fails even with no plugins:
> Activating RabbitMQ plugins ...
> ERROR: generation of boot script file
> /opt/mnesia/flopsy/plugins-scratch/rabbit.script failed:
> {'EXIT',{{badmatch,{erl_prim_loader,error}},
>           [{xref_utils,find_beam,1},
>            {xref_base,'-make_libs/5-fun-0-',2},
>            {lists,foldl,3},
>            {xref_base,make_libs,5},
>            {xref_base,do_set_up,1},
>            {xref_base,do_set_up,2},
>            {xref_base,q,3},
>            {xref,handle_call,3}]}}

I'm not sure, but this looks strongly as if bits of Erlang are missing / 
not being found.

> 2) Tried a branch of Mochiweb that is R12B compatible from
> http://github.com/lemenkov/mochiweb.git

I wouldn't necessarily recommend this anyway; I think even if you got it 
working you'd run into similar problems with webmachine.

> Any other tips appreciated

I'm really not a Fedora / CentOS / RHEL expert (can you tell?) but I 
have seen someone build an R14B RPM by taking the R12B5 SRPM and 
substituting in the R14B tarball and tweaking the spec file (just for 
filenames ISTR). I don't think the overall shape of Erlang has changed 
enough for packaging to be different. That might be a useful approach.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Wed Oct 27 12:01:49 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Oct 2010 12:01:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ Cilent: Allow specifying the
 connect timeout
In-Reply-To: <AANLkTi=jY7CCcYnjtnftBuqaAVdZJFZ5F03RjH+Fhmi+@mail.gmail.com>
References: <AANLkTi=jY7CCcYnjtnftBuqaAVdZJFZ5F03RjH+Fhmi+@mail.gmail.com>
Message-ID: <4CC8069D.7080201@rabbitmq.com>

Hi Amr,

On 23/10/10 19:20, Amr Mostafa wrote:
> Hi,
> 
> I've been searching around for a way to specify a connect timeout in the
> Java client, but couldn't find an easy way to do that. There is one way,
> which is by extending ConnectionFactory with a custom createFrameHandler
> method, but that doesn't work with my case since I'm using Spring AMQP
> support on top of the client API.
> 
> It would be very useful to add an option for that in the
> ConnectionFactory which, if specified, would be passed to the socket
> connect call.

You can also set socket options by overriding
ConnectionFactory.configureSocket(). By default this hook disables
Nagle's algorithm, but it can be used to set the timeout as well
(socket.setSoTimeout()). Even when using Spring AMQP you should be able
to specify your own ConnectionFactory that inherits from the existing one.

Regards

Emile

From althomas at maninvestments.com  Wed Oct 27 12:17:49 2010
From: althomas at maninvestments.com (Alext0)
Date: Wed, 27 Oct 2010 04:17:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <4CC8055F.6090401@rabbitmq.com>
References: <30020890.post@talk.nabble.com> <4CC067BE.5040205@rabbitmq.com>
	<30021317.post@talk.nabble.com> <30028590.post@talk.nabble.com>
	<4CC8055F.6090401@rabbitmq.com>
Message-ID: <30066133.post@talk.nabble.com>


Thanks very much Simon, we'll probably take a look at the SRPM then.

-- 
View this message in context: http://old.nabble.com/Mgmt-plugin-%282.1.1%29-tp30020890p30066133.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Wed Oct 27 12:40:33 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Oct 2010 12:40:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ Cilent: Allow specifying the
 connect timeout
In-Reply-To: <4CC8069D.7080201@rabbitmq.com>
References: <AANLkTi=jY7CCcYnjtnftBuqaAVdZJFZ5F03RjH+Fhmi+@mail.gmail.com>
	<4CC8069D.7080201@rabbitmq.com>
Message-ID: <4CC80FB1.40305@rabbitmq.com>


Hi again Amr,

On 27/10/10 12:01, Emile Joubert wrote:
> Hi Amr,
> 
> On 23/10/10 19:20, Amr Mostafa wrote:
>> Hi,
>>
>> I've been searching around for a way to specify a connect timeout in the
>> Java client, but couldn't find an easy way to do that. There is one way,
>> which is by extending ConnectionFactory with a custom createFrameHandler
>> method, but that doesn't work with my case since I'm using Spring AMQP
>> support on top of the client API.
>>
>> It would be very useful to add an option for that in the
>> ConnectionFactory which, if specified, would be passed to the socket
>> connect call.
> 
> You can also set socket options by overriding
> ConnectionFactory.configureSocket(). By default this hook disables
> Nagle's algorithm, but it can be used to set the timeout as well
> (socket.setSoTimeout()). Even when using Spring AMQP you should be able
> to specify your own ConnectionFactory that inherits from the existing one.

My previous advice won't work, because SO_TIMEOUT doesn't affect the
connection timeout. Instead of overriding configureSocket(), you need to
override createFrameHandler(). The call to socket.connect(addr) needs to
be changed to the 2-parameter version that accepts a connection timeout.

Another option would be to supply your own SocketFactory that supplies
sockets that override connect().

Given the difficulty of both these options we will look at extending the
ConnectionFactory API to make this simpler, as you suggested.

Regards

Emile

From amr.mostafa at gmail.com  Wed Oct 27 13:19:55 2010
From: amr.mostafa at gmail.com (Amr Mostafa)
Date: Wed, 27 Oct 2010 14:19:55 +0200
Subject: [rabbitmq-discuss] RabbitMQ Cilent: Allow specifying the
	connect timeout
In-Reply-To: <4CC80FB1.40305@rabbitmq.com>
References: <AANLkTi=jY7CCcYnjtnftBuqaAVdZJFZ5F03RjH+Fhmi+@mail.gmail.com>
	<4CC8069D.7080201@rabbitmq.com> <4CC80FB1.40305@rabbitmq.com>
Message-ID: <AANLkTi=ZDuZ9YftvQGTx0+TeD7w=FU+e+_pQmvcRzgjx@mail.gmail.com>

Hi Emile,

Thank you very much, your response is much appreciated. It's great to know
we can expect to see this option (in the near future?).

As a side note: I would have been able to implement the first option you
suggested, except that I work with Spring AMQP. It's impossible to pass on a
custom ConnectionFactory instead of rabbit's own to it due to the lack of an
interface. If rabbit's ConnectionFactory was an interface, Spring AMQP (and
other frameworks) could use that interface instead of the direct
implementation, thus, allowing framework users to pass on custom connection
factories.

Have a great day.

Best Regards,

On Wed, Oct 27, 2010 at 1:40 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi again Amr,
>
> On 27/10/10 12:01, Emile Joubert wrote:
> > Hi Amr,
> >
> > On 23/10/10 19:20, Amr Mostafa wrote:
> >> Hi,
> >>
> >> I've been searching around for a way to specify a connect timeout in the
> >> Java client, but couldn't find an easy way to do that. There is one way,
> >> which is by extending ConnectionFactory with a custom createFrameHandler
> >> method, but that doesn't work with my case since I'm using Spring AMQP
> >> support on top of the client API.
> >>
> >> It would be very useful to add an option for that in the
> >> ConnectionFactory which, if specified, would be passed to the socket
> >> connect call.
> >
> > You can also set socket options by overriding
> > ConnectionFactory.configureSocket(). By default this hook disables
> > Nagle's algorithm, but it can be used to set the timeout as well
> > (socket.setSoTimeout()). Even when using Spring AMQP you should be able
> > to specify your own ConnectionFactory that inherits from the existing
> one.
>
> My previous advice won't work, because SO_TIMEOUT doesn't affect the
> connection timeout. Instead of overriding configureSocket(), you need to
> override createFrameHandler(). The call to socket.connect(addr) needs to
> be changed to the 2-parameter version that accepts a connection timeout.
>
> Another option would be to supply your own SocketFactory that supplies
> sockets that override connect().
>
> Given the difficulty of both these options we will look at extending the
> ConnectionFactory API to make this simpler, as you suggested.
>
> Regards
>
> Emile
>



-- 
Amr Mostafa
Egypt Development Center
Member of NTG
Mobile: +(2012)1700502
Office: +(202)24052355/6 - Ext.: 2005
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/7fd328c3/attachment.htm>

From amr.mostafa at egyptdc.com  Wed Oct 27 15:23:41 2010
From: amr.mostafa at egyptdc.com (Amr Mostafa)
Date: Wed, 27 Oct 2010 16:23:41 +0200
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
Message-ID: <AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>

Hi,

I've been looking into this, and one additional solution from the erlang
land seems to be possible using the functions described in this document:

http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#id74479

Assuming that backing up mnesia is all what's needed.

Unfortunately, I couldn't find any ready-to-use tools that abstract the
mnesia routines described in the document above, making them accessible to
the average system administrator.

Best Regards,

On Wed, Oct 27, 2010 at 10:43 AM, Alex Lovell-Troy <
alex.lovelltroy at gmail.com> wrote:

> We've been tackling this problem as well for transactional persistent
> messages on durable queues in a very low traffic situation.  Our solution
> was to write a small wrapper around the transaction that also commits the
> message content to a database and then transactionally deletes the message
> from the database as part of the ack.  The wrapper also stores information
> about the queues and routing on startup.  With that, an additional small
> script can recreate our queues in the case of host death.  It's certainly
> not fast, but it is durable and keeps us from using the anti-pattern of
> polling the database for status changes.
>
> Since our queues and routing don't change very often, we think that a
> slow/triggered update of that information is good enough which only leaves
> the messages themselves.   We've been thinking of using erlang directly to
> bind to the ETS table on the rabbitmq host and dump the messages to a fresh
> ETS table on another node for a less db-centric backup/HA option.  We're
> still not sure if that's a good idea or if it is workable, but it may point
> you in another direction.
>
> I'd be happy to hear if anyone else has already ascertained if this route
> is fraught with danger.
>
> -sascha
>
>
>
> On Tue, Oct 26, 2010 at 6:17 PM, Ahmed M. Osman <a.medhat.cs at gmail.com>wrote:
>
>> Hello Friends,
>>
>> i just have a little question about RabbitMQ backup and i hope that i can
>> found the answer here
>>
>> simply, i want to make backup and and restore system to my Rabbit server,
>> mainly backup the persistent messages, do i have to handle this using
>> extra consumer that consume the messages then save it and enqueue it again
>> in the queue ?
>>
>> or backuping Mnesia, but according to the following link
>> http://www.rabbitmq.com/faq.html#migrate-to-another-machine
>> i think backupping Mnesia won't be a good solution.
>>
>> and if backuping Mnesia is the solution are there a way to use any other
>> language to make this backup other than using Erlang or any command or
>> command line tool.
>>
>> *--
>> Kind Regards,
>>
>> Ahmed
>> *
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Amr Mostafa
Egypt Development Center
Member of NTG
Mobile: +(2012)1700502
Office: +(202)24052355/6 - Ext.: 2005
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/019f7b80/attachment-0001.htm>

From david at rabbitmq.com  Wed Oct 27 15:53:53 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 27 Oct 2010 15:53:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	(Amr Mostafa's message of "Wed, 27 Oct 2010 16:23:41 +0200")
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
Message-ID: <yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>

Hi,

Amr Mostafa <amr.mostafa at egyptdc.com> writes:
> I've been looking into this, and one additional solution from the erlang
> land seems to be possible using the functions described in this document:
>
> http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#id74479
>
> Assuming that backing up mnesia is all what's needed.

RabbitMQ does not store queue contents in mnesia, so just backing up the
mnesia database will not preserve the full state.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From rtrlists at googlemail.com  Wed Oct 27 16:19:35 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 27 Oct 2010 16:19:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
Message-ID: <AANLkTimDpHuQSuHi8swzAyr9PoO9a_uXj0Dsc2KBman9@mail.gmail.com>

On Wed, Oct 27, 2010 at 3:23 PM, Amr Mostafa <amr.mostafa at egyptdc.com>wrote:

>
> Unfortunately, I couldn't find any ready-to-use tools that abstract the
> mnesia routines described in the document above, making them accessible to
> the average system administrator.
>
>
As already mentioned backing up mnesia isn't the whole story.

But the mnesia:backup/1,2 and mnesia:restore/2 functions can take a simple
filename as their first parameter and do exactly what you expect for backing
up and restoring the same DB on the same Node (for moving stuff around, a
bit more effort is required). The documentation could be a little bit more
obvious on that, I guess.

Also have a look at the bup.erl in the mnesia examples folder for some of
the more complicated scenarios.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/d7f13be2/attachment.htm>

From amr.mostafa at egyptdc.com  Wed Oct 27 16:33:10 2010
From: amr.mostafa at egyptdc.com (Amr Mostafa)
Date: Wed, 27 Oct 2010 17:33:10 +0200
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	<yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>

Hi David,

On Wed, Oct 27, 2010 at 4:53 PM, David Wragg <david at rabbitmq.com> wrote:

> RabbitMQ does not store queue contents in mnesia, so just backing up the
> mnesia database will not preserve the full state.
>

In my case, all the queues are durable and all the messages are persistent.
Does that make any difference?

Best Regards,


-- 
Amr Mostafa
Egypt Development Center
Member of NTG
Mobile: +(2012)1700502
Office: +(202)24052355/6 - Ext.: 2005
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/951cc960/attachment.htm>

From david at rabbitmq.com  Wed Oct 27 16:40:05 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 27 Oct 2010 16:40:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>
	(Amr Mostafa's message of "Wed, 27 Oct 2010 17:33:10 +0200")
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	<yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
	<AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>
Message-ID: <yrv4c62wny78q.fsf@dwragg.eng.vmware.com>

Amr Mostafa <amr.mostafa at egyptdc.com> writes:
> On Wed, Oct 27, 2010 at 4:53 PM, David Wragg <david at rabbitmq.com> wrote:
>> RabbitMQ does not store queue contents in mnesia, so just backing up the
>> mnesia database will not preserve the full state.
>
> In my case, all the queues are durable and all the messages are persistent.
> Does that make any difference?

No.  Those messages will be stored using rabbit's message store, which
for performance reasons does not store them in mnesia, but instead does
direct file I/O.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From a.medhat.cs at gmail.com  Wed Oct 27 17:32:09 2010
From: a.medhat.cs at gmail.com (Ahmed M. Osman)
Date: Wed, 27 Oct 2010 18:32:09 +0200
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <yrv4c62wny78q.fsf@dwragg.eng.vmware.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	<yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
	<AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>
	<yrv4c62wny78q.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=A6_sLpgWziQmnpYvSfJqSwHOfpEhB8hPMpwM9@mail.gmail.com>

OK, i can get it now this two folders (Debian based system) :
/var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_persistent/
/var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_transient/
doesn't belongs to Mnesia am i right ?

to backing up my messaging system i have to
1- stop the rabbit server
2- copy the folder "/var/lib/rabbitmq/mnesia/"
3- start the rabbit server


to restore
1- stop the rabbit server
2- copy back the folder "/var/lib/rabbitmq/mnesia/"
3- start the rabbit server

are there any problem with this method ?
i tried it before and it works well with me, but i don't know, i can't fill
good with this method ( i don't know why :( )

On 27 October 2010 17:40, David Wragg <david at rabbitmq.com> wrote:

> Amr Mostafa <amr.mostafa at egyptdc.com> writes:
> > On Wed, Oct 27, 2010 at 4:53 PM, David Wragg <david at rabbitmq.com> wrote:
> >> RabbitMQ does not store queue contents in mnesia, so just backing up the
> >> mnesia database will not preserve the full state.
> >
> > In my case, all the queues are durable and all the messages are
> persistent.
> > Does that make any difference?
>
> No.  Those messages will be stored using rabbit's message store, which
> for performance reasons does not store them in mnesia, but instead does
> direct file I/O.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>



-- 
*--
Kind Regards,

Ahmed M. Osman
+20122870644
Software Engineer
Member of Research and Development Department
Egypt Development Center (EDC) <http://egyptdc.com>
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/ab6e7e70/attachment.htm>

From david at rabbitmq.com  Wed Oct 27 17:40:26 2010
From: david at rabbitmq.com (David Wragg)
Date: Wed, 27 Oct 2010 17:40:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <AANLkTi=A6_sLpgWziQmnpYvSfJqSwHOfpEhB8hPMpwM9@mail.gmail.com>
	(Ahmed M. Osman's message of "Wed, 27 Oct 2010 18:32:09 +0200")
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	<yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
	<AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>
	<yrv4c62wny78q.fsf@dwragg.eng.vmware.com>
	<AANLkTi=A6_sLpgWziQmnpYvSfJqSwHOfpEhB8hPMpwM9@mail.gmail.com>
Message-ID: <yrv4c1v7by4g5.fsf@dwragg.eng.vmware.com>

Hi,

"Ahmed M. Osman" <a.medhat.cs at gmail.com> writes:
> OK, i can get it now this two folders (Debian based system) :
> /var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_persistent/
> /var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_transient/
> doesn't belongs to Mnesia am i right ?
>
> to backing up my messaging system i have to
> 1- stop the rabbit server
> 2- copy the folder "/var/lib/rabbitmq/mnesia/"
> 3- start the rabbit server
>
>
> to restore
> 1- stop the rabbit server
> 2- copy back the folder "/var/lib/rabbitmq/mnesia/"
> 3- start the rabbit server
>
> are there any problem with this method ?
> i tried it before and it works well with me, but i don't know, i can't fill
> good with this method ( i don't know why :( )

Yes, this should work fine (as long as the machine name doesn't change).

Of course, it has the drawback that you have to stop rabbitmq-server.

An interesting question is whether the above backup procedure will work
without stopping rabbitmq-server.  It would probably seem to work, but
whether it works under all circumstances is uncertain.  Though it would
certainly work if you use a filesystem that can give you point-in-time
snapshots.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthew at rabbitmq.com  Wed Oct 27 17:54:30 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 27 Oct 2010 17:54:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ Backup
In-Reply-To: <yrv4c1v7by4g5.fsf@dwragg.eng.vmware.com>
References: <AANLkTimN_AyJnt+tmK7qZd-Vq_H2-2PAM+zvEDzZU1tg@mail.gmail.com>
	<AANLkTinF=avg+9j3KxObT4_ROGMDnr55sg4CYhPgFVeO@mail.gmail.com>
	<AANLkTin1EazkeCsOWYuETB-6Q0+jLWcyMG06xK1mTUYJ@mail.gmail.com>
	<yrv4cd3qvy9dq.fsf@dwragg.eng.vmware.com>
	<AANLkTimu_gZvdvn3ZOZo1Gy4tkNtENkDFDO1ai2F8mWw@mail.gmail.com>
	<yrv4c62wny78q.fsf@dwragg.eng.vmware.com>
	<AANLkTi=A6_sLpgWziQmnpYvSfJqSwHOfpEhB8hPMpwM9@mail.gmail.com>
	<yrv4c1v7by4g5.fsf@dwragg.eng.vmware.com>
Message-ID: <20101027165429.GN18475@rabbitmq.com>

On Wed, Oct 27, 2010 at 05:40:26PM +0100, David Wragg wrote:
> "Ahmed M. Osman" <a.medhat.cs at gmail.com> writes:
> > OK, i can get it now this two folders (Debian based system) :
> > /var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_persistent/
> > /var/lib/rabbitmq/mnesia/rabbit at machine-name/msg_store_transient/
> > doesn't belongs to Mnesia am i right ?

Yes. You also need the
/var/lib/rabbitmq/mnesia/rabbit at machine-name/queues/ dir.

Just coping around the whole of
/var/lib/rabbitmq/mnesia/rabbit at machine-name or even
/var/lib/rabbitmq/mnesia as you suggest, is your best bet.

> An interesting question is whether the above backup procedure will work
> without stopping rabbitmq-server.  It would probably seem to work, but
> whether it works under all circumstances is uncertain.  Though it would
> certainly work if you use a filesystem that can give you point-in-time
> snapshots.

Yes, though of course given the amount of buffering we do before any
write actually occurs, there's a good chance you'll miss many messages
(unless you're using transactions). Stopping rabbit cleanly causes all
such buffers to be flushed.

Matthew

From csharp4me at gmail.com  Wed Oct 27 23:15:31 2010
From: csharp4me at gmail.com (Dave Gorman)
Date: Wed, 27 Oct 2010 17:15:31 -0500
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
Message-ID: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>

I am testing the durability of my message app and noticed messages being
dropped if I restart the broker. I'm running the broker directly in a
console using
rabbitmq_server-2.1.1\sbin\rabbitmq-server.bat

I then publish 10,000 messages and I've set the exchange to durable, the
queue to durable, and the message delivery to "2" - as I understand this to
be the configuration for messages to be durable. I then use the rabbitmqctl
list_queues to show the 10,000 messages. I close the broker window, to mimic
a hard shutdown of a server. When I start the broker back up and list the
queues I see 8,428 messages.

Do you know why I would lose messages?

My environment is: Windows 7 64bit and am running RabbitMQ 2.1.1 (disk node)
on top of Erlang 8.1.1.

My publisher code looks like:

var connectionFactory = new ConnectionFactory();
connectionFactory.Address = "localhost";

using (IConnection connection = connectionFactory.CreateConnection())
{
using (IModel model = connection.CreateModel())
{
model.ExchangeDeclare("ug.message", ExchangeType.Topic, true);
model.QueueDeclare("ug.message.rtls", true);
model.QueueBind("ug.message.rtls", "ug.message", "#", false, null);

for (int i = 0; i < 10000; i++)
{
IBasicProperties messageProperties = model.CreateBasicProperties();
messageProperties.DeliveryMode = 2;

byte[] message = System.Text.Encoding.UTF8.GetBytes("Yo Mama soo fat..." +
i);
model.BasicPublish("ug.message", "ug.message.rtls.move", messageProperties,
message);

System.Console.WriteLine("Published message " + i);
}
}
}

Any help would be greatly appreciated.

Thank you,
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/dfec28ef/attachment.htm>

From matthew at rabbitmq.com  Wed Oct 27 23:23:58 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 27 Oct 2010 23:23:58 +0100
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
In-Reply-To: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>
References: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>
Message-ID: <20101027222357.GC18601@wellquite.org>

On Wed, Oct 27, 2010 at 05:15:31PM -0500, Dave Gorman wrote:
> I then publish 10,000 messages and I've set the exchange to durable, the
> queue to durable, and the message delivery to "2" - as I understand this to
> be the configuration for messages to be durable. I then use the rabbitmqctl
> list_queues to show the 10,000 messages. I close the broker window, to mimic
> a hard shutdown of a server. When I start the broker back up and list the
> queues I see 8,428 messages.
> 
> Do you know why I would lose messages?

Yes. The settings you've described result in Rabbit taking a "best
effort" approach to writing messages to disk. Rabbit will aggressively
buffer pending messages in RAM and may indeed never write some such
messages to disk.

If you really need messages to go safely to disk, then you should put
the channel into transactional mode (tx.select), and issue a tx.commit
when you have published your 10000 messages. When you get the
tx.commit-ok message back, it is guaranteed the messages are safely
written to disk (persistent messages sent to a durable queue).

Obviously, the frequency with which you issue the tx.commit determines
the number of messages that can be lost: if you do a tx.commit after
every single publish then you'll lose at most one message (death during
publish/commit). Doing that, whilst very safe, has a substantial impact
on performance.

Best wishes,

Matthew

From MVierling at attinteractive.com  Thu Oct 28 00:12:20 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Wed, 27 Oct 2010 16:12:20 -0700
Subject: [rabbitmq-discuss] Mgmt plugin (2.1.1)
In-Reply-To: <4CC8055F.6090401@rabbitmq.com>
References: <30020890.post@talk.nabble.com>	<4CC067BE.5040205@rabbitmq.com>
	<30021317.post@talk.nabble.com>	<30028590.post@talk.nabble.com>
	<4CC8055F.6090401@rabbitmq.com>
Message-ID: <237050FF255D844CBDF840D42334EB9B66C662772B@SFOEXM02.YELLOWPAGES.LOCAL>

>>> Can anyone confirm whether the latest mgmt plugin works on 2.1.1?

We're running the Management 2.1.1 plugin without any issues.  We're using the latest Erlang R14B, RabbitMQ 2.1.1 and Red Hat Linux 5.4.

We build Erlang from scratch, but use the Rabbit RPM, then copy/install the binary plugin files.

Michael Vierling
AT&T Interactive

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Wednesday, October 27, 2010 3:57 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mgmt plugin (2.1.1)

On 22/10/10 14:16, Alext0 wrote:
>
> Unfortunately the R14B from http://repos.fedorapeople.org/ doesn't seem to be
> there yet.

Damn, you're quite right. I thought because it was listed it would exist...

> I've tried a couple of other things:
>
> 1) Built from src, but startup fails even with no plugins:
> Activating RabbitMQ plugins ...
> ERROR: generation of boot script file
> /opt/mnesia/flopsy/plugins-scratch/rabbit.script failed:
> {'EXIT',{{badmatch,{erl_prim_loader,error}},
>           [{xref_utils,find_beam,1},
>            {xref_base,'-make_libs/5-fun-0-',2},
>            {lists,foldl,3},
>            {xref_base,make_libs,5},
>            {xref_base,do_set_up,1},
>            {xref_base,do_set_up,2},
>            {xref_base,q,3},
>            {xref,handle_call,3}]}}

I'm not sure, but this looks strongly as if bits of Erlang are missing / 
not being found.

> 2) Tried a branch of Mochiweb that is R12B compatible from
> http://github.com/lemenkov/mochiweb.git

I wouldn't necessarily recommend this anyway; I think even if you got it 
working you'd run into similar problems with webmachine.

> Any other tips appreciated

I'm really not a Fedora / CentOS / RHEL expert (can you tell?) but I 
have seen someone build an R14B RPM by taking the R12B5 SRPM and 
substituting in the R14B tarball and tweaking the spec file (just for 
filenames ISTR). I don't think the overall shape of Erlang has changed 
enough for packaging to be different. That might be a useful approach.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From chen650 at yahoo.com  Thu Oct 28 00:39:01 2010
From: chen650 at yahoo.com (alex chen)
Date: Wed, 27 Oct 2010 16:39:01 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <78396.91847.qm@web31808.mail.mud.yahoo.com>


Matthias,


> That is expected. When clients are publishing at a higher rate than the broker can write to disk, and consumers aren't draining the queues, then eventually rabbit will have to pause producers so it can page messages to disk and free up some memory.

i was able to increase the memory_high_watermark to 0.8 (6.4GB) and got 50 MB/sec publish rate all the way to 200 GB messages stored.  the broker used 5.9 GB and there was no throttling on publishers.   However, when i started 1000 consumers, the same old errors happen again as described in my first email:  lots of consumers got errors on login or basic_consume:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008420.html

i am using erlang R14B for this test.

> That threshold setting via vm_memory_high_watermark definitely still works in 2.1.1.

yes it works.  my /etc/rabbitmq/rabbitmq.config was a symlink instead of a regular file.  rabbitmq-server script uses -f instead of -e to check file exist, so it does not work for symlink.

thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/4954006b/attachment.htm>

From chen650 at yahoo.com  Thu Oct 28 06:03:53 2010
From: chen650 at yahoo.com (alex chen)
Date: Wed, 27 Oct 2010 22:03:53 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <637947.97940.qm@web31802.mail.mud.yahoo.com>

Matthias,


> i was able to increase the memory_high_watermark to 0.8 (6.4GB) and got 50 MB/sec publish rate all the way to 200 GB messages stored.  the broker used 5.9 GB and there was no throttling on publishers.   However, when i started 1000 consumers, the same old errors happen again as described in my first email:  lots of consumers got errors on login or basic_consume:

i increased the timeout of login from 10 sec to 5 minutes, then the consumers could consume the 200 GB of messages without any problems.  the 2.1.1 broker's memory kept below 6.2 GB.  (the memory usage for release 2.0.0 was 10 GB for this test case).  
thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101027/f1da9426/attachment-0001.htm>

From emile at rabbitmq.com  Thu Oct 28 13:26:30 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Oct 2010 13:26:30 +0100
Subject: [rabbitmq-discuss] problem with new persiter with
	1000	topics/queues
In-Reply-To: <78396.91847.qm@web31808.mail.mud.yahoo.com>
References: <78396.91847.qm@web31808.mail.mud.yahoo.com>
Message-ID: <4CC96BF6.90906@rabbitmq.com>


Hi alex,

On 28/10/10 00:39, alex chen wrote:

[...]

> yes it works.  my /etc/rabbitmq/rabbitmq.config was a symlink instead of
> a regular file.  rabbitmq-server script uses -f instead of -e to check
> file exist, so it does not work for symlink.

I'm not able to reproduce this, and there is some evidence to suggest
that -f succeeds if the symlink points to a regular file. Is there
anything odd about your shell or environment that could be causing the
problem?


Regards

Emile

From matthias at rabbitmq.com  Thu Oct 28 15:22:56 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Oct 2010 15:22:56 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <637947.97940.qm@web31802.mail.mud.yahoo.com>
References: <637947.97940.qm@web31802.mail.mud.yahoo.com>
Message-ID: <4CC98740.2070607@rabbitmq.com>

Alex,

On 28/10/10 06:03, alex chen wrote:
> i increased the timeout of login from 10 sec to 5 minutes, then the
> consumers could consume the 200 GB of messages without any problems. the
> 2.1.1 broker's memory kept below 6.2 GB. (the memory usage for release
> 2.0.0 was 10 GB for this test case).

That makes sense. Starting 1000+ consumer connections all at once will 
cause enough work at the broker end that the connection negotiation on 
at least some of the connections might take quite a while. And if the 
consumers are also declaring queues and bindings, and start consuming 
messages the broker has even more work to do and establishing new 
connections will take longer still.


Regards,

Matthias.

From rwirth at demandware.com  Thu Oct 28 19:50:43 2010
From: rwirth at demandware.com (Rudi Wirth)
Date: Thu, 28 Oct 2010 13:50:43 -0500
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
In-Reply-To: <20101027222357.GC18601@wellquite.org>
References: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>
	<20101027222357.GC18601@wellquite.org>
Message-ID: <5D226D9E05A7E342B774D1881408C3EB013B4B5B56@34093-MBX-C15.mex07a.mlsrvr.com>

> If you really need messages to go safely to disk, then you should put
> the channel into transactional mode (tx.select), and issue a tx.commit

What about unacknowledged messages? 

A Producer (rabbit 2.1.1 java client, not Spring Rabbit AMQP) commits some persistent messages on a durable queue/exchange. 

The Consumer is neither ack'ing nor rejecting the message to leave it on the queue (and let recovery retry it later), but I am committing periodically, e.g.:

  QueueingConsumer.Delivery delivery = consumer.nextDelivery();
  // neither channel.basicReject or Ack
  channel.txCommit();

Per ctl:

  $ rabbitmqctl list_queues name messages messages_unacknowledged messages_ready
  Listing queues ...
  testQueue       5       5       0

Using a soft "rabbitmqctl stop", a Broker restart will make the unacknowledged messages ready again (as expected). 
  testQueue       5       0       5

With a Broker hardkill, the unack'd messages disappear.
  testQueue       0       0       0

For our implementation, I was going to rely on unacknowledged messages, flow control (qos) and periodic channel.basicRecover() to implement a crude, controlled "delayed retry" behavior, without using a temporary parking queue or application-provided intermediate storage. Not that anyone would kill the broker but is there a way to flush unack'd messages to disk?

Thanks
-Rudi

This e-mail message and all attachments transmitted with it may contain privileged and/or confidential information intended solely for the use of the addressee(s). If the reader of this message is not the intended recipient, you are hereby notified that any reading, dissemination, distribution, copying, forwarding or other use of this message or its attachments is strictly prohibited. If you have received this message in error, please notify the sender immediately and delete this message, all attachments and all copies and backups thereof.


From ftian at vmware.com  Thu Oct 28 19:11:53 2010
From: ftian at vmware.com (Feng Tian)
Date: Thu, 28 Oct 2010 11:11:53 -0700
Subject: [rabbitmq-discuss] FW: RabbitMQ
In-Reply-To: <6A2287B3767A9B40BD27D6BA903A253D0131A74A3E78@EXCH-MBX-4.vmware.com>
References: <AANLkTikFg=19iC+MznzV5RxY3QyxPnUbargQEE7a1LEX@mail.gmail.com>
	<1429492792.220663.1287673148031.JavaMail.root@zimbra-mbox-1>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E4F@EXCH-MBX-4.vmware.com>
	<AANLkTikpaC=4jar2PjVXyi0g8mL4wL7EkM0nsUzGQStp@mail.gmail.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E53@EXCH-MBX-4.vmware.com>
	<AANLkTi=2WzioaqhEvVTC_M9uN7R7t3smWbDDqoA5jrLX@mail.gmail.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E5B@EXCH-MBX-4.vmware.com>
	<AANLkTimAa-HchOdK8qtMkjBoa5brp3yYa8YYVz_cGiw2@mail.gmail.com>,
	<4CC7FD81.2020803@rabbitmq.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E73@EXCH-MBX-4.vmware.com>,
	<4CC81465.8020509@rabbitmq.com>,
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E78@EXCH-MBX-4.vmware.com>
Message-ID: <6A2287B3767A9B40BD27D6BA903A253D0131A74A3E97@EXCH-MBX-4.vmware.com>

Hi, 

I am using pika to write a multi threaded python program.  From what I learned so far, the BlockingConnection is a better fit for my need.   At least for me, seems that the Asyncore is not really designed for multi threaded app.  I modified the test_threads.py so that it sort of "works", except I have the following

            while True:
                ch_a.basic_consume(hdler, queue=q)
                print "Wait for recv ..."
                time.sleep(5)

This have some problems that I cannot figure out how to resolve,
1. No one want to call sleep :-)
2. basic_consume seems to have a round trip talk with server, even though there is nothing to consume.

That is exactly what puzzled me in the first place, if using amqplib, I can do

ch.basic_consume ...
while True:
     ch.wait()

What can I do with pika to get this effect?  And of course,  ch.wait(timeout) would be even better.  Any clue how to do this with pika?

Thanks,
Feng

From sherifahmed at hotmail.com  Thu Oct 28 22:05:34 2010
From: sherifahmed at hotmail.com (Reefee)
Date: Thu, 28 Oct 2010 14:05:34 -0700 (PDT)
Subject: [rabbitmq-discuss]  queue architecture
Message-ID: <30079644.post@talk.nabble.com>


I am using the Java Client

I have a scenario where I'd like to get a message from a queue and do some
validations and decide if it needs processing , if not then put it back in
the queue for a later time.

Whats the best way to accomplish this.. Can I just get the message not and
not call baskcAck if I don't need to process it ? Not calling basicAck puts
the message back on teh queue after a while ?

Currently I have a working solution where I get the message, deserialize it
and then put the message back again into the queue. Is there a better way ?

-- 
View this message in context: http://old.nabble.com/queue-architecture-tp30079644p30079644.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/6573c4aa/attachment.htm>

From alexandru at rabbitmq.com  Thu Oct 28 22:27:55 2010
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Thu, 28 Oct 2010 22:27:55 +0100
Subject: [rabbitmq-discuss] queue architecture
In-Reply-To: <30079644.post@talk.nabble.com>
References: <30079644.post@talk.nabble.com>
Message-ID: <20101028212755.GA2393@dakota>

> I have a scenario where I'd like to get a message from a queue and do some
> validations and decide if it needs processing , if not then put it back in
> the queue for a later time.
> 
> Whats the best way to accomplish this.. Can I just get the message not and
> not call baskcAck if I don't need to process it ? Not calling basicAck puts
> the message back on teh queue after a while ?

Something like that.  When a message is delivered, it is taken off the queue
but not deleted.  If you close the channel without ack'ing the message,
it gets re-inserted into the queue.

So, the message will get requeued when you close the channel but not
before.

An alternative is basic.reject:
  http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-rabbitmq/

Basically, basic.reject{requeue=true} is exactly what you want.  It's a
way for a consumer to refuse a message from the broker.

> Currently I have a working solution where I get the message, deserialize it
> and then put the message back again into the queue. Is there a better way ?

That would also work.

Cheers,
Alex

On Thu, Oct 28, 2010 at 02:05:34PM -0700, Reefee wrote:
> 
> I am using the Java Client
> 
> I have a scenario where I'd like to get a message from a queue and do some
> validations and decide if it needs processing , if not then put it back in
> the queue for a later time.
> 
> Whats the best way to accomplish this.. Can I just get the message not and
> not call baskcAck if I don't need to process it ? Not calling basicAck puts
> the message back on teh queue after a while ?
> 
> Currently I have a working solution where I get the message, deserialize it
> and then put the message back again into the queue. Is there a better way ?
> 
> -- 
> View this message in context: http://old.nabble.com/queue-architecture-tp30079644p30079644.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From chen650 at yahoo.com  Thu Oct 28 23:02:21 2010
From: chen650 at yahoo.com (alex chen)
Date: Thu, 28 Oct 2010 15:02:21 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <798016.63886.qm@web31802.mail.mud.yahoo.com>

Matthias,

> i increased the timeout of login from 10 sec to 5 minutes, then the

> consumers could consume the 200 GB of messages without any problems. the
> 2.1.1 broker's memory kept below 6.2 GB. (the memory usage for release
> 2.0.0 was 10 GB for this test case).

There is another problem:   The broker's memory usage grew from 6.2GB to 10 GB 1 hour after the consumers were started.
This caused swapping and the consume rate dropped from 30 MB/sec to less than 10 MB/sec.  I think the broker only throttles the publisher when the mem high water mark is reached, but the consumers can still increase the broker's mem usage?
if this cannot be avoided, we have to increase the RAM to 16GB.

thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/86472d4d/attachment-0001.htm>

From chen650 at yahoo.com  Thu Oct 28 23:05:01 2010
From: chen650 at yahoo.com (alex chen)
Date: Thu, 28 Oct 2010 15:05:01 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <55873.15755.qm@web31807.mail.mud.yahoo.com>



Emile,

> I'm not able to reproduce this, and there is some evidence to suggest
that -f succeeds if the symlink points to a regular file. Is there
anything odd about your shell or environment that could be causing the
problem?

I found the problem was due to user  permission, not sym link.
Sorry about the false alarm.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/e3876610/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 28 23:17:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Oct 2010 23:17:51 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <798016.63886.qm@web31802.mail.mud.yahoo.com>
References: <798016.63886.qm@web31802.mail.mud.yahoo.com>
Message-ID: <4CC9F68F.8040201@rabbitmq.com>

Alex,

alex chen wrote:
> The broker's memory usage grew from 6.2GB to 10 GB 1 hour after the
> consumers were started.

A spike like that is not unusual if you are, say, starting a lot of 
connections all at once, have them all declare queues and then start 
consuming from them. But rabbit should reduce the memory usage down 
below the set limit eventually. Though see below.

> I think the broker only throttles the publisher when the mem high
> water mark is reached

Correct, as long as producers and consumers are on different connections.

> but the consumers can still increase the broker's mem usage?

Delivered but unacknowledged messages are held in RAM. This is something
we are going to change in a future release. Meanwhile, are you setting a 
prefetch count? That will bound the number of unacked messages and thus 
the memory taken up by them.

Regards,

Matthias.

From sherifahmed at hotmail.com  Thu Oct 28 23:25:51 2010
From: sherifahmed at hotmail.com (Sherif Ahmed)
Date: Thu, 28 Oct 2010 18:25:51 -0400
Subject: [rabbitmq-discuss] queue architecture
In-Reply-To: <20101028212755.GA2393@dakota>
References: <30079644.post@talk.nabble.com> <20101028212755.GA2393@dakota>
Message-ID: <BAY146-ds12C49BBE74A69D477698B4A9440@phx.gbl>

Great.. Exactly what I was looking for.
Far more efficient than what I was doing.

Thanks

-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru
Scvortov
Sent: Thursday, October 28, 2010 5:28 PM
To: Reefee
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] queue architecture

> I have a scenario where I'd like to get a message from a queue and do some
> validations and decide if it needs processing , if not then put it back in
> the queue for a later time.
> 
> Whats the best way to accomplish this.. Can I just get the message not and
> not call baskcAck if I don't need to process it ? Not calling basicAck
puts
> the message back on teh queue after a while ?

Something like that.  When a message is delivered, it is taken off the queue
but not deleted.  If you close the channel without ack'ing the message,
it gets re-inserted into the queue.

So, the message will get requeued when you close the channel but not
before.

An alternative is basic.reject:
 
http://www.rabbitmq.com/blog/2010/08/03/well-ill-let-you-go-basicreject-in-r
abbitmq/

Basically, basic.reject{requeue=true} is exactly what you want.  It's a
way for a consumer to refuse a message from the broker.

> Currently I have a working solution where I get the message, deserialize
it
> and then put the message back again into the queue. Is there a better way
?

That would also work.

Cheers,
Alex

On Thu, Oct 28, 2010 at 02:05:34PM -0700, Reefee wrote:
> 
> I am using the Java Client
> 
> I have a scenario where I'd like to get a message from a queue and do some
> validations and decide if it needs processing , if not then put it back in
> the queue for a later time.
> 
> Whats the best way to accomplish this.. Can I just get the message not and
> not call baskcAck if I don't need to process it ? Not calling basicAck
puts
> the message back on teh queue after a while ?
> 
> Currently I have a working solution where I get the message, deserialize
it
> and then put the message back again into the queue. Is there a better way
?
> 
> -- 
> View this message in context:
http://old.nabble.com/queue-architecture-tp30079644p30079644.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From chen650 at yahoo.com  Thu Oct 28 23:35:09 2010
From: chen650 at yahoo.com (alex chen)
Date: Thu, 28 Oct 2010 15:35:09 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <104757.10144.qm@web31809.mail.mud.yahoo.com>

Matthias,


> Delivered but unacknowledged messages are held in RAM. This is something
we are going to change in a future release. Meanwhile, are you setting a prefetch count? That will bound the number of unacked messages and thus the memory taken up by them.

I am setting prefetch count to 50.  each message is 20 KB.  so total usage should be
1000 queue * 20 KB * 50 which is about 1GB.   After all the messages were consumed, the broker's memory still remained at 4GB.  Is this expected or a problem with memory leak?   

Another observation with 2.1.1 is that the most rdq files in msg_store_persistent were not deleted until all the messages were consumed.  because the broker was so busy "rabbitmqctl list_queues" could not return the queue length, so i am not sure if the delay in deleting rdq files was caused by some consumers were lagging behind.  When i used release 2.0.0, the rdq files were deleted while the consumers were running.  Not sure if this contributed to the memory growth or not.

thank for looking into these problems!  it is greatly appreciated.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/2664a490/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 28 23:44:35 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Oct 2010 23:44:35 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <104757.10144.qm@web31809.mail.mud.yahoo.com>
References: <104757.10144.qm@web31809.mail.mud.yahoo.com>
Message-ID: <4CC9FCD3.5030505@rabbitmq.com>

Alex,

alex chen wrote:
> I am setting prefetch count to 50.  each message is 20 KB.  so total 
> usage should be 1000 queue * 20 KB * 50 which is about 1GB.

It's a bit more than that due to overheads and fragmentation. But not 
much more.

> After all the messages were consumed, the broker's memory still 
> remained at 4GB.  Is this expected or a problem with memory leak?

So rabbit is taking up 4GB when all the queues are empty? How many
queues are there? 1000? And how many connections?

> Another observation with 2.1.1 is that the most rdq files in 
> msg_store_persistent were not deleted until all the messages were 
> consumed.

2.1.1 is less eager in deleting rdq files than previous versions. This
helps in reducing the number of writes in cases where a message is
routed to multiple queues and consumed+ack'd very quickly. So this is
nothing to worry about.

> because the broker was so busy "rabbitmqctl list_queues" could not
> return the queue length

How frequently are you running 'rabbitmqctl list_queues'? If it is run 
fairly frequently it can significantly delay freeing up memory since 
queues don't get a chance to hibernate.


Regards,

Matthias.

From chen650 at yahoo.com  Fri Oct 29 00:05:16 2010
From: chen650 at yahoo.com (alex chen)
Date: Thu, 28 Oct 2010 16:05:16 -0700 (PDT)
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
Message-ID: <498688.98424.qm@web31802.mail.mud.yahoo.com>

Matthias,


> So rabbit is taking up 4GB when all the queues are empty? How many
queues are there? 1000? And how many connections?

yes 1000 queues and 1000 connections.  this 4 GB was after 200 GB messages were consumed.
If the broker is started fresh with 1000 queues and connections but no messages published, the mem usage is 260 MB.

> How frequently are you running 'rabbitmqctl list_queues'? If it is run fairly frequently it can significantly delay freeing up memory since queues don't get a chance to hibernate.

we run it once a minute to monitor the queue length.  i will disable it in my next test.

thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/83ed0b76/attachment.htm>

From matthias at rabbitmq.com  Fri Oct 29 00:18:22 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 29 Oct 2010 00:18:22 +0100
Subject: [rabbitmq-discuss] problem with new persiter with 1000
	topics/queues
In-Reply-To: <498688.98424.qm@web31802.mail.mud.yahoo.com>
References: <498688.98424.qm@web31802.mail.mud.yahoo.com>
Message-ID: <4CCA04BE.5000606@rabbitmq.com>

Alex,

alex chen wrote:
> yes 1000 queues and 1000 connections.  this 4 GB was after 200 GB 
> messages were consumed.
> If the broker is started fresh with 1000 queues and connections but no 
> messages published, the mem usage is 260 MB.

Memory fragmentation will result in a figure higher than 260MB when the 
broker goes idle, but 4GB seems a bit much. It's possible that the 
memory is being taken up by the processes handling connections and/or 
channels. That is not something we have seen before, but the scenario 
you are describing - lots of connections that are all idle - is not very 
common.

> we run it once a minute to monitor the queue length.

That should actually be fine; 60s is plenty for the queues to go to 
sleep. Though waking them all up again will cause some memory and CPU 
pressure. FWIW, the management plugin can monitor queues without 
interfering with their sleeping patterns.


Regards,

Matthias.

From stephanion2002 at gmail.com  Fri Oct 29 07:27:04 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Fri, 29 Oct 2010 11:57:04 +0530
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
Message-ID: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>

Hi,

I have just started working with RabbitMQ for my cloud messaging/eventing
application. The proof of concept worked well with rabbitMQ and Spring AMQP.
Now, I want to start preparing for scalability.
I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2
separate machines. Now I want to know what is achieved by "clustering" in
terms of rabbitMQ.

My spring amqp template has been given a connection Factory like this:
*
    <!-- RabbitMQ configurations -->
    <!-- Define a connectionFactory -->
    <bean id="connectionFactory"

class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
        <constructor-arg value="localhost" />
        <property name="username" value="guest" />
        <property name="password" value="guest" />
    </bean>

    <!-- Configure the admin class -->
    <bean id="amqpAdmin"
class="org.springframework.amqp.rabbit.core.RabbitAdmin">
        <constructor-arg ref="connectionFactory" />
    </bean>*

Here I have specified *localhost*, so now, if I send a amqp message through
rabbitMQ and this localhost broker is not up, will that message go through
its cluster node automatically ?

If that's the case, then what do we mean by high availability?

Thanks,
Kshitiz Garg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101029/6e0f662d/attachment.htm>

From sherifahmed at hotmail.com  Fri Oct 29 10:51:23 2010
From: sherifahmed at hotmail.com (Reefee)
Date: Fri, 29 Oct 2010 02:51:23 -0700 (PDT)
Subject: [rabbitmq-discuss]  Scaling
Message-ID: <30084291.post@talk.nabble.com>


I have a Java Servlet that listens to external messages delivered via HTTP
POST.
I am using the rabbitmq. Java SDK 
The servlet then processess them and stores them on to a RabbitMQ queue.

In order to offer best performance and scalability what is the reccomended
usage of Connections and channels ?
i.e. Have a single connection that gets re-used accross all requests and
with each message being posted to the queue by its own channel instance (as
it seems Channels being used by multiple threads is not a good idea).

Or should I create a seperate Connection for each request ?
-- 
View this message in context: http://old.nabble.com/Scaling-tp30084291p30084291.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From videlalvaro at gmail.com  Fri Oct 29 13:01:34 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 29 Oct 2010 20:01:34 +0800
Subject: [rabbitmq-discuss] Anyone going to the Erlang Factory Lite
Message-ID: <DDA3BEA0-C0E7-46AF-BF50-FA5204F7C7F8@gmail.com>

Hi guys,

Next week there will be the Erlang Factory Lite in LA which is a free event, BTW. 

Is anyone going there? I'm coming from the other side of the Pacific so it would be nice to meet up, go for some beers, talk about RabbitMQ or whatever not tech related.

More info here: http://www.erlang-factory.com/conference/ErlangFactoryLiteLA

Regards,

Alvaro

From jon.brisbin at npcinternational.com  Fri Oct 29 14:09:30 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 29 Oct 2010 08:09:30 -0500
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
Message-ID: <1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>

Do you want failover or clustering (or both)?

I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.

Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.

I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.


Jon Brisbin
Portal Webmaster
NPC International, Inc.


On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:

> Hi,
> 
> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability. 
> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ. 
> 
> My spring amqp template has been given a connection Factory like this:
> 
>     <!-- RabbitMQ configurations -->
>     <!-- Define a connectionFactory -->
>     <bean id="connectionFactory"
>         class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>         <constructor-arg value="localhost" />
>         <property name="username" value="guest" />
>         <property name="password" value="guest" />
>     </bean>
> 
>     <!-- Configure the admin class -->
>     <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
>         <constructor-arg ref="connectionFactory" />
>     </bean>
> 
> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
> 
> If that's the case, then what do we mean by high availability?
> 
> Thanks,
> Kshitiz Garg
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101029/e4869f23/attachment.htm>

From stephanion2002 at gmail.com  Fri Oct 29 14:31:48 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Fri, 29 Oct 2010 19:01:48 +0530
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
Message-ID: <AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>

Hi Jon,

Thanks for your reply. I want a similar setup as mentioned by you.

Should I refer to "RabbitMQ High Availability Guide" for setting up a
system like yours? does "haproxy" automatically decides the routing of
the message depending on the availability of rabbitMQ instances
sitting behind this ?

Regards,
Kshitiz

On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
>
> Do you want failover or clustering (or both)?
> I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.
> Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.
> I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.
>
> Jon?Brisbin
> Portal?Webmaster
> NPC?International,?Inc.
>
> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
>
> Hi,
>
> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ.
>
> My spring amqp template has been given a connection Factory like this:
>
> ??? <!-- RabbitMQ configurations -->
> ??? <!-- Define a connectionFactory -->
> ??? <bean id="connectionFactory"
> ??? ??? class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
> ??? ??? <constructor-arg value="localhost" />
> ??? ??? <property name="username" value="guest" />
> ??? ??? <property name="password" value="guest" />
> ??? </bean>
>
> ??? <!-- Configure the admin class -->
> ??? <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
> ??? ??? <constructor-arg ref="connectionFactory" />
> ??? </bean>
>
> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
>
> If that's the case, then what do we mean by high availability?
>
> Thanks,
> Kshitiz Garg
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>

From jon.brisbin at npcinternational.com  Fri Oct 29 14:42:37 2010
From: jon.brisbin at npcinternational.com (Jon Brisbin)
Date: Fri, 29 Oct 2010 08:42:37 -0500
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
Message-ID: <90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>


On Oct 29, 2010, at 8:31 AM, Kshitiz Garg wrote:

> Should I refer to "RabbitMQ High Availability Guide" for setting up a
> system like yours?

It's certainly a good idea to read that guide. But I'm using an intentionally simplistic setup that follows the transcript here:

http://www.rabbitmq.com/clustering.html#creating


> does "haproxy" automatically decides the routing of
> the message depending on the availability of rabbitMQ instances
> sitting behind this ?

Sort of. HAProxy is a TCP/IP "traffic cop". It knows nothing about the contents of the packets it proxies. It simply knows whether or not any of the configured backends is alive and able to receive data. 

Maybe a better way to say it is that it decides the routing of the TCP traffic to the broker. It knows nothing about messages.

http://haproxy.1wt.eu/

I'm also using a "best effort" approach. I'm not going to get my britches in a wrinkle if my broker goes down for a few minutes (or a few hours ;) until I get it fixed. I recognize others don't have that luxury.

jb



> 
> Regards,
> Kshitiz
> 
> On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
> <jon.brisbin at npcinternational.com> wrote:
>> 
>> Do you want failover or clustering (or both)?
>> I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.
>> Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.
>> I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.
>> 
>> Jon Brisbin
>> Portal Webmaster
>> NPC International, Inc.
>> 
>> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
>> 
>> Hi,
>> 
>> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
>> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ.
>> 
>> My spring amqp template has been given a connection Factory like this:
>> 
>>     <!-- RabbitMQ configurations -->
>>     <!-- Define a connectionFactory -->
>>     <bean id="connectionFactory"
>>         class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>>         <constructor-arg value="localhost" />
>>         <property name="username" value="guest" />
>>         <property name="password" value="guest" />
>>     </bean>
>> 
>>     <!-- Configure the admin class -->
>>     <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
>>         <constructor-arg ref="connectionFactory" />
>>     </bean>
>> 
>> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
>> 
>> If that's the case, then what do we mean by high availability?
>> 
>> Thanks,
>> Kshitiz Garg
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 


Jon Brisbin
Portal Webmaster
NPC International, Inc.




From emile at rabbitmq.com  Fri Oct 29 15:17:18 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 29 Oct 2010 15:17:18 +0100
Subject: [rabbitmq-discuss] Scaling
In-Reply-To: <30084291.post@talk.nabble.com>
References: <30084291.post@talk.nabble.com>
Message-ID: <4CCAD76E.3000107@rabbitmq.com>

Hi Reefee,

On 29/10/10 10:51, Reefee wrote:
> 
> I have a Java Servlet that listens to external messages delivered via HTTP
> POST.
> I am using the rabbitmq. Java SDK 
> The servlet then processess them and stores them on to a RabbitMQ queue.
> 
> In order to offer best performance and scalability what is the reccomended
> usage of Connections and channels ?
> i.e. Have a single connection that gets re-used accross all requests and
> with each message being posted to the queue by its own channel instance (as
> it seems Channels being used by multiple threads is not a good idea).

It is possible to share a channel, but you will need to serialise access
to it. It is simpler and recommended to establish a channel per thread
as you suggest.

> Or should I create a seperate Connection for each request ?

>From your description it sounds like this client only acts as an AMQP
producer. The normal pattern here would be use one or many long-lived
connections. Also look at the rabbitmq-java-messagepatterns for a
wrapper that maintains long-lived connections. If the client needs to
act as an AMQP consumer as well then establish separate connections for
this purpose.

Creating a new connection per request would make sense if on average
messages are less frequent than network failures and you can tolerate
the additional connection setup overhead.


Regards

Emile




From majek04 at gmail.com  Fri Oct 29 15:56:56 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 29 Oct 2010 15:56:56 +0100
Subject: [rabbitmq-discuss] FW: RabbitMQ
In-Reply-To: <6A2287B3767A9B40BD27D6BA903A253D0131A74A3E97@EXCH-MBX-4.vmware.com>
References: <AANLkTikFg=19iC+MznzV5RxY3QyxPnUbargQEE7a1LEX@mail.gmail.com>
	<1429492792.220663.1287673148031.JavaMail.root@zimbra-mbox-1>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E4F@EXCH-MBX-4.vmware.com>
	<AANLkTikpaC=4jar2PjVXyi0g8mL4wL7EkM0nsUzGQStp@mail.gmail.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E53@EXCH-MBX-4.vmware.com>
	<AANLkTi=2WzioaqhEvVTC_M9uN7R7t3smWbDDqoA5jrLX@mail.gmail.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E5B@EXCH-MBX-4.vmware.com>
	<AANLkTimAa-HchOdK8qtMkjBoa5brp3yYa8YYVz_cGiw2@mail.gmail.com>
	<4CC7FD81.2020803@rabbitmq.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E73@EXCH-MBX-4.vmware.com>
	<4CC81465.8020509@rabbitmq.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E78@EXCH-MBX-4.vmware.com>
	<6A2287B3767A9B40BD27D6BA903A253D0131A74A3E97@EXCH-MBX-4.vmware.com>
Message-ID: <AANLkTik6yKp+WVKJnqo7gYFvtN5f3gB1CagoHDOLRH9e@mail.gmail.com>

Feng,

On Thu, Oct 28, 2010 at 19:11, Feng Tian <ftian at vmware.com> wrote:
> I am using pika to write a multi threaded python program. ?From what I learned so far, the BlockingConnection is a better fit for my need. ? At least for me, seems that the Asyncore is not really designed for multi threaded app. ?I modified the test_threads.py so that it sort of "works", except I have the following
>
> ? ? ? ? ? ?while True:
> ? ? ? ? ? ? ? ?ch_a.basic_consume(hdler, queue=q)
> ? ? ? ? ? ? ? ?print "Wait for recv ..."
> ? ? ? ? ? ? ? ?time.sleep(5)
>
> This have some problems that I cannot figure out how to resolve,
> 1. No one want to call sleep :-)
> 2. basic_consume seems to have a round trip talk with server, even though there is nothing to consume.
>
> That is exactly what puzzled me in the first place, if using amqplib, I can do
>
> ch.basic_consume ...
> while True:
> ? ? ch.wait()
>
> What can I do with pika to get this effect? ?And of course, ?ch.wait(timeout) would be even better. ?Any clue how to do this with pika?

In all of the AMQP clients `basic_consume` takes a callback function
as an argument.
This function is later executed when a client receives a message. But,
in order for
this to work, someone, somewhere, needs to sit on the socket descriptor
and wait for incoming data from Rabbit.

That's usually done in some sort of `wait` function. As you mentioned py-amqplib
exposes `wait` function. Pika uses some kind of  event loop.

In AsyncoreConenction the main asyncore event loop is used.
In BlockingConnection the same role was taken by a `mainloop`
function. For example:

conn = pika.BlockingConnection(pika.ConnectionParameters(
        (len(sys.argv) > 1) and sys.argv[1] or '127.0.0.1',
        credentials = pika.PlainCredentials('guest', 'guest'),
        heartbeat = 0))

ch = conn.channel()
ch.queue_declare(queue=qname, durable=True, exclusive=False, auto_delete=False)

def handle_delivery(ch, method, header, body):
    print "method=%r" % (method,)
    print "header=%r" % (header,)
    print "  body=%r" % (body,)
    ch.basic_ack(delivery_tag = method.delivery_tag)

ch.basic_consume(handle_delivery, queue = qname)

conn.mainloop()


This function, also like the asyncore counterpart, blocks.
If you need to do something every few seconds, probably the
best idea is to:
 - spawn a separate thread for that
 - use blocking connection and use drain_events with timeout parameter
 - use asyncore loop, with 'timeout' parameter.


Marek

From irmo.manie at gmail.com  Fri Oct 29 16:09:12 2010
From: irmo.manie at gmail.com (Irmo Manie)
Date: Fri, 29 Oct 2010 17:09:12 +0200
Subject: [rabbitmq-discuss] Binding routing key to queue on default exchange
Message-ID: <AANLkTikyv_gtB-e0QFuRdAQuKQt31+dcnz-ANX2WJWam@mail.gmail.com>

If you declare a queue, there is an automatic binding where the queue
name is used as the routing key.
Now I want to bind a different routing key to that same queue name
without specifying an exchange name, which according to the specs
should be possible correct?

With the 1.8.0 server this was possible, but with the latest 2.1.1 I
get an access_refused back.

Is there an explanation for this, or do I understand the specs wrongly here?

Meta code:

    val connection = connectionFactory.newConnection
    val channel = connection.createChannel
    val queue = channel.queueDeclare.getQueue
    val queueBind = channel.queueBind(queue, "", "some.routing.key")


Cheers,
Irmo

From matthew at rabbitmq.com  Fri Oct 29 16:14:30 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Oct 2010 16:14:30 +0100
Subject: [rabbitmq-discuss] Binding routing key to queue on default
 exchange
In-Reply-To: <AANLkTikyv_gtB-e0QFuRdAQuKQt31+dcnz-ANX2WJWam@mail.gmail.com>
References: <AANLkTikyv_gtB-e0QFuRdAQuKQt31+dcnz-ANX2WJWam@mail.gmail.com>
Message-ID: <20101029151430.GC7262@wellquite.org>

On Fri, Oct 29, 2010 at 05:09:12PM +0200, Irmo Manie wrote:
> If you declare a queue, there is an automatic binding where the queue
> name is used as the routing key.
> Now I want to bind a different routing key to that same queue name
> without specifying an exchange name, which according to the specs
> should be possible correct?

Nope. See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_14

> With the 1.8.0 server this was possible, but with the latest 2.1.1 I
> get an access_refused back.

Yes, we corrected the behaviour! The default exchange is an exchange
that can only be used for publishing messages to. All other actions on
it are refused.

Matthew

From irmo.manie at gmail.com  Fri Oct 29 16:17:42 2010
From: irmo.manie at gmail.com (Irmo Manie)
Date: Fri, 29 Oct 2010 17:17:42 +0200
Subject: [rabbitmq-discuss] Binding routing key to queue on default
	exchange
In-Reply-To: <20101029151430.GC7262@wellquite.org>
References: <AANLkTikyv_gtB-e0QFuRdAQuKQt31+dcnz-ANX2WJWam@mail.gmail.com>
	<20101029151430.GC7262@wellquite.org>
Message-ID: <AANLkTi=A2h_-VNs7N9tHTtmXZgi1Bxkr77KLz3TKXXUP@mail.gmail.com>

Ah, I see. So the current specs still specify it's possible for a
queue bind ,but actually its now since that will be removed in 0.10.

Thanks :-)

On Fri, Oct 29, 2010 at 5:14 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Oct 29, 2010 at 05:09:12PM +0200, Irmo Manie wrote:
>> If you declare a queue, there is an automatic binding where the queue
>> name is used as the routing key.
>> Now I want to bind a different routing key to that same queue name
>> without specifying an exchange name, which according to the specs
>> should be possible correct?
>
> Nope. See http://dev.rabbitmq.com/wiki/Amqp091Errata#section_14
>
>> With the 1.8.0 server this was possible, but with the latest 2.1.1 I
>> get an access_refused back.
>
> Yes, we corrected the behaviour! The default exchange is an exchange
> that can only be used for publishing messages to. All other actions on
> it are refused.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jasonjwwilliams at gmail.com  Fri Oct 29 16:21:32 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 29 Oct 2010 09:21:32 -0600
Subject: [rabbitmq-discuss] Anyone going to the Erlang Factory Lite
In-Reply-To: <DDA3BEA0-C0E7-46AF-BF50-FA5204F7C7F8@gmail.com>
References: <DDA3BEA0-C0E7-46AF-BF50-FA5204F7C7F8@gmail.com>
Message-ID: <B4F5915A-5B8B-4CA3-B7E0-B9EEB21A30CB@gmail.com>

I'm hoping to be there!

-J

Sent via iPhone

Is your e-mail Premiere?

On Oct 29, 2010, at 6:01, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi guys,
> 
> Next week there will be the Erlang Factory Lite in LA which is a free event, BTW. 
> 
> Is anyone going there? I'm coming from the other side of the Pacific so it would be nice to meet up, go for some beers, talk about RabbitMQ or whatever not tech related.
> 
> More info here: http://www.erlang-factory.com/conference/ErlangFactoryLiteLA
> 
> Regards,
> 
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Oct 29 16:30:01 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Oct 2010 16:30:01 +0100
Subject: [rabbitmq-discuss] Binding routing key to queue on default
 exchange
In-Reply-To: <AANLkTi=A2h_-VNs7N9tHTtmXZgi1Bxkr77KLz3TKXXUP@mail.gmail.com>
References: <AANLkTikyv_gtB-e0QFuRdAQuKQt31+dcnz-ANX2WJWam@mail.gmail.com>
	<20101029151430.GC7262@wellquite.org>
	<AANLkTi=A2h_-VNs7N9tHTtmXZgi1Bxkr77KLz3TKXXUP@mail.gmail.com>
Message-ID: <20101029153000.GD7262@wellquite.org>

On Fri, Oct 29, 2010 at 05:17:42PM +0200, Irmo Manie wrote:
> Ah, I see. So the current specs still specify it's possible for a
> queue bind ,but actually its now since that will be removed in 0.10.

Well, don't forget that 0-9-1 came out after 0-10. And I don't think
it's a secret that we're extremely unlikely to ever implement 0-10. It's
more that 0-9-1 or 0-8 don't really specify clearly the role of the
default exchange. MikeB interprets it not as an exchange, but as a
separate publishing mechanism, that is accessible by publishing messages
with no exchange specified - there's no real reason why it has to be a
concrete exchange at all. Thus in light of that, there's substantial
debate whether it makes sense to be able to do any binding actions etc
to it.

Personally, I think the model is cleaner if that exchange/mechanism
doesn't exist at all! But it's clear that it has a lot of utility.

Matthew

From david_syer at hotmail.com  Fri Oct 29 18:53:22 2010
From: david_syer at hotmail.com (Dave Syer)
Date: Fri, 29 Oct 2010 10:53:22 -0700 (PDT)
Subject: [rabbitmq-discuss] integration testing with Rabbit and Java
In-Reply-To: <2e74ec1d-e5af-438f-820b-5cc5ddc544ed@j18g2000yqd.googlegroups.com>
References: <2e74ec1d-e5af-438f-820b-5cc5ddc544ed@j18g2000yqd.googlegroups.com>
Message-ID: <d6d36963-71a8-4ce5-a438-abba77d818a4@k22g2000yqh.googlegroups.com>

On Oct 26, 1:54?pm, Shane <sh... at digitalsanctum.com> wrote:
> Anyone have any pointers on how best to do integration testing with
> RabbitMQ, java client, and Spring AMQP?

There are some integration tests in Spring AMQP (look for
*IntegrationTests.java).  We use a JUnit rule to check for a broker
before we start testing.  At the moment this is just a convenient way
to prevent failures in a CI build, but we might extend it to be a
little more subtle (e.g. allow an assertion instead of an assumption
depending on a profile setting).

> I'd also like to know how to easily setup/start/stop more than one
> broker per machine programmatically to test things like failover. Is
> there such a thing as a mock broker?

There *are* some utilities in Spring AMQP for starting and stopping a
broker, but I'm not 100% happy with them yet (hence we don't use them
in our Rabbit integration tests yet).  The main problems are platform
variability (e.g. Windows behaves rather differently than Linux), and
occasional slow start up, which is hard to distinguish from failed
startup.  If you want to try it out and maybe give us some feedback,
or even help out with fixing problems, you can look at
RabbitBrokerAdmin (in the spring-rabbit-admin project).

Someone suggested that maybe JErlang might be usable to launch an
embedded broker for testing.  No-one tried it as far as I know, but
we'd be interested to hear of any experience or opinions on that as
well.

D.

From rwirth at demandware.com  Fri Oct 29 19:46:58 2010
From: rwirth at demandware.com (rjwirth)
Date: Fri, 29 Oct 2010 11:46:58 -0700 (PDT)
Subject: [rabbitmq-discuss]  unacknowledged messages lost after broker kill,
 despite consumer txCommit and noAck
Message-ID: <30088199.post@talk.nabble.com>


Sorry on the repeat post from the "Lose messages between restarts of broker"
thread.

> If you really need messages to go safely to disk, then you should put
> the channel into transactional mode (tx.select), and issue a tx.commit

What about unacknowledged messages?

A Producer (rabbit 2.1.1 java client, not Spring Rabbit AMQP) commits some
persistent messages on a durable queue/exchange.

The Consumer is neither ack'ing nor rejecting the message to leave it on the
queue (and let recovery retry it later), but I am committing periodically,
e.g.:

  QueueingConsumer.Delivery delivery = consumer.nextDelivery();
  // neither channel.basicReject or Ack
  channel.txCommit();

Per ctl:

  $ rabbitmqctl list_queues name messages messages_unacknowledged
messages_ready
  Listing queues ...
  testQueue       5       5       0

Using a soft "rabbitmqctl stop", a Broker restart will make the
unacknowledged messages ready again (as expected).
  testQueue       5       0       5

With a Broker hardkill, the unack'd messages disappear even after I have
just committed the channel
  testQueue       0       0       0

Is there anything to commit on the channel if the Broker didn't get an Ack? 
Shouldn't the "lease" of the message be at least committed?

For our implementation, I was going to rely on unacknowledged messages, flow
control (qos) and periodic channel.basicRecover() to implement a crude,
controlled "delayed retry" behavior, without using a temporary parking queue
or application-provided intermediate storage. Not that anyone would kill the
broker but is there a way to flush unack'd messages to disk?

Thanks much!
-Rudi 

-----
Rudi Wirth

-- 
View this message in context: http://old.nabble.com/unacknowledged-messages-lost-after-broker-kill%2C-despite-consumer-txCommit-and-noAck-tp30088199p30088199.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From clegnitto at mozilla.com  Fri Oct 29 19:55:41 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Fri, 29 Oct 2010 11:55:41 -0700
Subject: [rabbitmq-discuss] Missing features making me look at moving off
	RabbitMQ
Message-ID: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>

Just thought I'd send a note detailing why I am investigating moving off RabbitMQ. Please note that these are be specific to my use-case and may not apply to yours. Also note that many of these can be worked-around given enough time.

Background on what I am doing can be found @ http://pulse.mozilla.org

--
Built-in way to deal with the "slow consumer" problem

* For pulse, it is entirely conceivable that consumers will check in once and perhaps go away for weeks (or maybe forever)
* Ideally support would be configurable and similar to http://activemq.apache.org/slow-consumer-handling.html

--
Built-in HA

* It'd be nice to not have to cobble together multiple pieces to get this
* Clearly not a deal-breaker as there are existing solutions

--
Support custom authentication schemes

* I'd like to be able to hook authentication to different backends (like ldap, use bugzilla for auth, etc)
* I need this as I don't want to maintain lists and want to give permissions based on ldap groups

--
Support message-level permissions

* It'd be nice for a publisher to be able to include a security token and have the broker decide to vend to a consumer or not based on it
* Haven't really thought about this in-depth yet, but the problem we are trying to solve is publishing multiple-tiers of security-sensitive information where the message content itself determines who should see it

--
Support for WebSockets

* It'd be nice for there a plugin to support websockets
* More important for Mozilla as most tools are web-based
* I have set it up with orbitd, but it's a pain / another moving piece / easier to uncomment a line like http://activemq.apache.org/websockets.html

--
Public bugtracker

* Be nice to file bugs, learn from other's bugs, etc
* I understand there is a private one. Can you just set all existing bugs to restricted and provide public access? All new bugs could be public and as soon as old bugs are vetted you could open them up

--
Public roadmap

* Very critical when you are basing your entire organization on a product
* Management console / API was on this list, then all of a sudden someone started working on it (thanks!), but it would have been nice to know it was coming


Thanks,
Christian

From lemenkov at gmail.com  Fri Oct 29 20:15:31 2010
From: lemenkov at gmail.com (Peter Lemenkov)
Date: Fri, 29 Oct 2010 23:15:31 +0400
Subject: [rabbitmq-discuss] Missing features making me look at moving
	off RabbitMQ
In-Reply-To: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
Message-ID: <AANLkTi=TkP3Ji31N6GU-wepebV_jH=nujncJy_NZ8XA7@mail.gmail.com>

Hello!

2010/10/29 Christian Legnitto <clegnitto at mozilla.com>:

> Support for WebSockets

This doesn't look too complicated for me. Also there are already
several erlang-related projects to deal with them:

http://github.com/search?langOverride=Erlang&q=websockets&repo=&start_value=1&type=Repositories

Actually I'm not so familiar with RabbitMQ internals, but I believe
that it would not consume too much development power to add WebSockets
plugin.

> Public bugtracker

I believe that relocating to GitHub completely would help solving this :)

> Public roadmap

Likewise.

-- 
With best regards, Peter Lemenkov.

From MVierling at attinteractive.com  Sat Oct 30 01:13:12 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Fri, 29 Oct 2010 17:13:12 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
Message-ID: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>

We're developing a Splunk plugin for RabbitMQ.  Splunk is an excellent log search engine and we highly recommend it.  Anyway, while Splunk can ingest almost any log files, it prefers a key-value pair format.  You can see this page for more details:

http://www.splunk.com/wiki/Apps:Common_Information_Model

So in that spirit, I'd like to propose the following patch to the rabbitmqadmin script, which ships with your management 2.1.1 plugin.  This patch adds a key-value pair Splunk compatible option (kvp) to the script.  It would be very helpful if this could be incorporated into the official Management plugin.

Best,
Michael

[root at tdbrabbit1 bin]# diff attadmin rabbitmqadmin
9d8
< import datetime
124c123
<                       help="format for listing commands - one of [pretty_json, raw_json, table, tsv, kvp, long]  [default: %default]")
---
>                       help="format for listing commands - one of [pretty_json, raw_json, table, tsv, long]  [default: %default]")
284,285d282
<     elif format == "kvp":
<         formatter = KVPList
358,371d354
< class KVPList(Lister):
<     def __init__(self, options):
<         self.options = options
<
<     def display_list(self, columns, table):
<         fmt = "{0} = {1}, "
<         timestamp = datetime.datetime.now()
<         line = ""
<         for i in xrange(0, len(table)):
<             line = str(timestamp) + ", "
<             for j in xrange(0, len(columns)):
<                 line += fmt.format(columns[j], table[i][j])
<             print line
<


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101029/e3d048cb/attachment.htm>

From matthias at rabbitmq.com  Sat Oct 30 02:46:55 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 30 Oct 2010 02:46:55 +0100
Subject: [rabbitmq-discuss] Missing features making me look at moving
 off RabbitMQ
In-Reply-To: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
References: <92B24C14-FFA0-4FDF-849A-5AD08E27CF24@mozilla.com>
Message-ID: <4CCB790F.3000106@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> Just thought I'd send a note detailing why I am investigating moving 
> off RabbitMQ.

Thanks for letting us know. Let's see whether we can help you...

> -- Built-in way to deal with the "slow consumer" problem
> 
> * For pulse, it is entirely conceivable that consumers will check in 
> once and perhaps go away for weeks (or maybe forever) * Ideally
> support would be configurable and similar to 
> http://activemq.apache.org/slow-consumer-handling.html

RabbitMQ has several ways of dealing with consumers that go away:
- exclusive queues - go away when the connection dies
- auto-delete queues - go away when the last consumer disappears
- queues with leases - go away when unused for some time
- per-queue message ttl (in the next release) - messages expire after a
per-queue configured ttl

Would any of these work for your use case?

> -- Built-in HA
> 
> * It'd be nice to not have to cobble together multiple pieces to get 
> this

Instead of "cobbled together" I'd like to think of it as "using a 
combination of tried & trusted best-of-breed products" ;)

We are working on better and more integrated HA. Meanwhile, the 
instructions for the existing active/passive HA may look a bit
daunting, but it's actually not that hard to set up.

> -- Support custom authentication schemes
> 
> * I'd like to be able to hook authentication to different backends 
> (like ldap, use bugzilla for auth, etc) * I need this as I don't want
>  to maintain lists and want to give permissions based on ldap groups

This has been requested a few times but hasn't yet bubbled up far enough
our priority list to make it into the code base.

Tweaking the code s.t. it supports your particular authentication scheme
should only take a few hours. Implementing a more generally
applicable and pluggable mechanism would take a few days.

> -- Support message-level permissions
> 
> * It'd be nice for a publisher to be able to include a security token
>  and have the broker decide to vend to a consumer or not based on it
> * Haven't really thought about this in-depth yet, but the problem we 
> are trying to solve is publishing multiple-tiers of 
> security-sensitive information where the message content itself 
> determines who should see it

That sounds like a pretty hard problem. Are there any messaging systems
out there that do something close to what you need here?

> -- Support for WebSockets
> 
> * It'd be nice for there a plugin to support websockets * More 
> important for Mozilla as most tools are web-based *

I'd be surprised if some websockets support didn't find its way into
a rabbit plug-in soon.

Meanwhile, would any of existing Rabbit plug-ins/extensions for
messaging-over-HTTP, such as the jsonrpc-channel
(http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel) and
rabbithub (http://github.com/tonyg/rabbithub) work for you?

> -- Public bugtracker
> 
> * Be nice to file bugs, learn from other's bugs, etc

There is no official public rabbit bug tracker but you can (and people
occasionally do) file bugs in the rabbit bug trackers on github, ubuntu, 
debian, etc. That doesn't give you much insight into what the rabbit 
team is working on though, which is what I think you are after.

> * I understand there is a private one. Can you just set all existing
> bugs to restricted and provide public access? All new bugs could be
> public and as soon as old bugs are vetted you could open them up

Something like that will probably happen eventually. The issue tracking 
system plays a pivotal role in the work of the RabbitMQ team. We have 
more than 2500 bugs recorded in it, touch about 30 bugs a day and open 
~100 new ones per month. So there's a lot going on, which of course 
would make it an incredibly valuable resource for the community. But 
because it is so important to the rabbit team any fundamental changes to 
it require careful consideration.

> -- Public roadmap
> 
> * Very critical when you are basing your entire organization on a 
> product

Our to do list so far has resisted attempts to condense it into a 
roadmap that can be navigated without a personal guide ;) And our plans 
are quite fluid since the prioritisation of work items is often finely 
balanced and can change radically with just a single user request (e.g. 
for pluggable authentication ;), bug report, etc.

Having said that, we are always happy to discuss our current plans with 
potential customers / users. Shall I give you a ring?

> * Management console / API was on this list, then all of a 
> sudden someone started working on it (thanks!), but it would have 
> been nice to know it was coming

That is one example of the fluidity of our plans. Improvements to 
management had been on our todo list for a long time. It took a 
combination of various factors and events to push it near the top of our 
priority list. Once it had ended up there, exploratory work got underway 
very quickly. The first line of code was written on July 12th. We 
announced it to the world less than four weeks later, on August 6th, 
once we were confident it would make it into the product soon.

So if it looked like rabbitmq-management appeared out of the blue then 
that is because it did :)

Most features / fixes we decide to work on make it into the product 
within 1-2 months. Or they get parked or abandoned. For the few items 
that take several months we could perhaps be a bit more vocal about 
their progress. But doing so always carries the risk of disappointing 
people when the features subsequently get delayed or abandoned.


Regards,

Matthias.

From omp08 at doc.ic.ac.uk  Sat Oct 30 03:42:56 2010
From: omp08 at doc.ic.ac.uk (Olivier Pernet)
Date: Sat, 30 Oct 2010 03:42:56 +0100
Subject: [rabbitmq-discuss] Conversation initiation design
Message-ID: <AANLkTikOYckW93pnY2ampU14kLSTQ=mO25BScs2nFxag@mail.gmail.com>

Hi all,

I'm trying to design a conversation initiation scheme for multiple participants.
The participants communicate following a pre-established protocol
which lists roles, and specifies the exchange of messages between
roles.

Initiation needs to bind the participants (physical machines) to roles
in the protocol, and give them the name of an exchange they can use to
send messages to other roles in the protocol.
I need one participant to be able to invite others into the
conversation, and offer them to play a given role.

My idea is as follows:

- Have one special exchange, let's name it Init. It's a direct
exchange. It's bound to queues named with the IP address of
participants.

- The inviting participant creates Init, then creates a direct
exchange C1 and queues C1R1... C1Rn for each role in the conversation.
It then sends messages like the following to Init:
label: "xxx.xxx.xxx.p1" (ip address of participant 1 to be invited)
contents: "C1,R1" - invitation to play role R1 in conversation C1

- Each participant connects to the queue named for their IP address,
and gets their invitation from it. Some participants might not be
invited and wait here.

- Invited participants all connect to the queue that corresponds to
their invitation (eg. queue C1R1).

- When a participant wants to send a message to whoever plays role Rn,
it sends a message to C1 with label Rn. The message is put in queue
C1Rn, where the participant can pull it.

This will work for many concurrent conversations C1...Cn. There will
always be only one Init exchange.

There's a few unclear points however. Is it possible for a message to
trigger the creation of a queue? For the first step (sending
invitations), if the participants to be invited have not connected yet
and created their IP-address-named queue, the invitations may be lost.
The inviting process could always create the queues for whoever it
wants to invite in advance, I suppose.
I don't really like the first part of my design (the Init exchange and
the IP-address queues). Have you seen similar setups before? Do you
have any advice about how to do this better?

Cheers,
Olivier Pernet

From alexis at rabbitmq.com  Sat Oct 30 08:35:59 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 30 Oct 2010 08:35:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
References: <Act3xz1tOp7+38BGT92F2jzYjJcOUw==>
	<237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>

Michael

Very neat.

Will you make the Splunk plugin open source?

alexis



On Sat, Oct 30, 2010 at 1:13 AM, Michael Vierling
<MVierling at attinteractive.com> wrote:
> We're developing a Splunk plugin for RabbitMQ.? Splunk is an excellent log
> search engine and we highly recommend it.? Anyway, while Splunk can ingest
> almost any log files, it prefers a key-value pair format.? You can see this
> page for more details:
>
>
>
> http://www.splunk.com/wiki/Apps:Common_Information_Model
>
>
>
> So in that spirit, I'd like to propose the following patch to the
> rabbitmqadmin script, which ships with your management 2.1.1 plugin.? This
> patch adds a key-value pair Splunk compatible option (kvp) to the script.
> It would be very helpful if this could be incorporated into the official
> Management plugin.
>
>
>
> Best,
>
> Michael
>
>
>
> [root at tdbrabbit1 bin]# diff attadmin rabbitmqadmin
>
> 9d8
>
> < import datetime
>
> 124c123
>
> <?????????????????????? help="format for listing commands - one of
> [pretty_json, raw_json, table, tsv, kvp, long]? [default: %default]")
>
> ---
>
>>?????????????????????? help="format for listing commands - one of
>> [pretty_json, raw_json, table, tsv, long]? [default: %default]")
>
> 284,285d282
>
> <???? elif format == "kvp":
>
> <???????? formatter = KVPList
>
> 358,371d354
>
> < class KVPList(Lister):
>
> <??? ?def __init__(self, options):
>
> <???????? self.options = options
>
> <
>
> <???? def display_list(self, columns, table):
>
> <???????? fmt = "{0} = {1}, "
>
> <???????? timestamp = datetime.datetime.now()
>
> <???????? line = ""
>
> <???????? for i in xrange(0, len(table)):
>
> <????? ???????line = str(timestamp) + ", "
>
> <???????????? for j in xrange(0, len(columns)):
>
> <???????????????? line += fmt.format(columns[j], table[i][j])
>
> <???????????? print line
>
> <
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From stephanion2002 at gmail.com  Sat Oct 30 09:28:29 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Sat, 30 Oct 2010 13:58:29 +0530
Subject: [rabbitmq-discuss] Understanding RabbitMQ clustering
In-Reply-To: <90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>
References: <AANLkTikLP72QTn3D4XuN446EtnP5GPS7_13pPC8wa9Ns@mail.gmail.com>
	<1958A72B-4262-4CBB-AF37-2D60A9CE8940@npcinternational.com>
	<AANLkTi=mfTrcr4hwwzC36ZqNinGimGJ35aRpKNezxDse@mail.gmail.com>
	<90D7C49E-243D-4554-9C7A-678A666DFF19@npcinternational.com>
Message-ID: <AANLkTikrmpnkV8p8Bpzh6ytjUzuqU9e+F4PPj0SDEYkp@mail.gmail.com>

Hi Jon,

Thanks a lot for so much of informative stuff. Your configurations
look ideal to me.In my case, I want to have a broker setup which is
load balanced as well as scalable, which will be handling millions of
XML messages.

What I understand from your explanation that HA proxy can help me to
handle failure situations. That's brilliant.

Now if I use a HA proxy and have independent RabbitMQs sitting behind
that proxy, how will that be different from using a HA proxy and have
clustered RabbitMQs sitting behind that proxy. What is that these
clustered RabbitMQs have in common?  Actually I want to understand
"clustering" in this regard.

Thanks,
Kshitiz Garg


On Fri, Oct 29, 2010 at 7:12 PM, Jon Brisbin
<jon.brisbin at npcinternational.com> wrote:
>
> On Oct 29, 2010, at 8:31 AM, Kshitiz Garg wrote:
>
>> Should I refer to "RabbitMQ High Availability Guide" for setting up a
>> system like yours?
>
> It's certainly a good idea to read that guide. But I'm using an intentionally simplistic setup that follows the transcript here:
>
> http://www.rabbitmq.com/clustering.html#creating
>
>
>> does "haproxy" automatically decides the routing of
>> the message depending on the availability of rabbitMQ instances
>> sitting behind this ?
>
> Sort of. HAProxy is a TCP/IP "traffic cop". It knows nothing about the contents of the packets it proxies. It simply knows whether or not any of the configured backends is alive and able to receive data.
>
> Maybe a better way to say it is that it decides the routing of the TCP traffic to the broker. It knows nothing about messages.
>
> http://haproxy.1wt.eu/
>
> I'm also using a "best effort" approach. I'm not going to get my britches in a wrinkle if my broker goes down for a few minutes (or a few hours ;) until I get it fixed. I recognize others don't have that luxury.
>
> jb
>
>
>
>>
>> Regards,
>> Kshitiz
>>
>> On Fri, Oct 29, 2010 at 6:39 PM, Jon Brisbin
>> <jon.brisbin at npcinternational.com> wrote:
>>>
>>> Do you want failover or clustering (or both)?
>>> I use both. I have haproxy as a TCP proxy that sits in front of the RabbitMQ servers and acts as a failover and load balancer mechanism.
>>> Behind the proxy are clustered RabbitMQ instances, which means they use the standard RabbitMQ clustering mechanism and have the same queues, exchanges, and whatnot on each box.
>>> I then use Spring AMQP to connect to the *proxy*, who decides which of the RabbitMQ instances I actually get connected to.
>>>
>>> Jon Brisbin
>>> Portal Webmaster
>>> NPC International, Inc.
>>>
>>> On Oct 29, 2010, at 1:27 AM, Kshitiz Garg wrote:
>>>
>>> Hi,
>>>
>>> I have just started working with RabbitMQ for my cloud messaging/eventing application. The proof of concept worked well with rabbitMQ and Spring AMQP. Now, I want to start preparing for scalability.
>>> I am able to setup a rabbitMQ cluster with 2 rabbitMQs installed on 2 separate machines. Now I want to know what is achieved by "clustering" in terms of rabbitMQ.
>>>
>>> My spring amqp template has been given a connection Factory like this:
>>>
>>> ? ? <!-- RabbitMQ configurations -->
>>> ? ? <!-- Define a connectionFactory -->
>>> ? ? <bean id="connectionFactory"
>>> ? ? ? ? class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
>>> ? ? ? ? <constructor-arg value="localhost" />
>>> ? ? ? ? <property name="username" value="guest" />
>>> ? ? ? ? <property name="password" value="guest" />
>>> ? ? </bean>
>>>
>>> ? ? <!-- Configure the admin class -->
>>> ? ? <bean id="amqpAdmin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
>>> ? ? ? ? <constructor-arg ref="connectionFactory" />
>>> ? ? </bean>
>>>
>>> Here I have specified localhost, so now, if I send a amqp message through rabbitMQ and this localhost broker is not up, will that message go through its cluster node automatically ?
>>>
>>> If that's the case, then what do we mean by high availability?
>>>
>>> Thanks,
>>> Kshitiz Garg
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
>
>
>

From MVierling at attinteractive.com  Sun Oct 31 01:33:32 2010
From: MVierling at attinteractive.com (Michael Vierling)
Date: Sat, 30 Oct 2010 17:33:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Splunk
In-Reply-To: <AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>
References: <Act3xz1tOp7+38BGT92F2jzYjJcOUw==>
	<237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>,
	<AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>
Message-ID: <237050FF255D844CBDF840D42334EB9B66C6B27B4A@SFOEXM02.YELLOWPAGES.LOCAL>

Yes, the plugin will be open source :-)

Michael
________________________________________
From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
Sent: Saturday, October 30, 2010 12:35 AM
To: Michael Vierling
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ and Splunk

Michael

Very neat.

Will you make the Splunk plugin open source?

alexis



On Sat, Oct 30, 2010 at 1:13 AM, Michael Vierling
<MVierling at attinteractive.com> wrote:
> We're developing a Splunk plugin for RabbitMQ.  Splunk is an excellent log
> search engine and we highly recommend it.  Anyway, while Splunk can ingest
> almost any log files, it prefers a key-value pair format.  You can see this
> page for more details:
>
>
>
> http://www.splunk.com/wiki/Apps:Common_Information_Model
>
>
>
> So in that spirit, I'd like to propose the following patch to the
> rabbitmqadmin script, which ships with your management 2.1.1 plugin.  This
> patch adds a key-value pair Splunk compatible option (kvp) to the script.
> It would be very helpful if this could be incorporated into the official
> Management plugin.
>
>
>
> Best,
>
> Michael
>
>
>
> [root at tdbrabbit1 bin]# diff attadmin rabbitmqadmin
>
> 9d8
>
> < import datetime
>
> 124c123
>
> <?????????????????????? help="format for listing commands - one of
> [pretty_json, raw_json, table, tsv, kvp, long]? [default: %default]")
>
> ---
>
>>?????????????????????? help="format for listing commands - one of
>> [pretty_json, raw_json, table, tsv, long]? [default: %default]")
>
> 284,285d282
>
> <???? elif format == "kvp":
>
> <???????? formatter = KVPList
>
> 358,371d354
>
> < class KVPList(Lister):
>
> <???  def __init__(self, options):
>
> <???????? self.options = options
>
> <
>
> <???? def display_list(self, columns, table):
>
> <???????? fmt = "{0} = {1}, "
>
> <???????? timestamp = datetime.datetime.now()
>
> <???????? line = ""
>
> <???????? for i in xrange(0, len(table)):
>
> <?????        line = str(timestamp) + ", "
>
> <???????????? for j in xrange(0, len(columns)):
>
> <???????????????? line += fmt.format(columns[j], table[i][j])
>
> <???????????? print line
>
> <
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

